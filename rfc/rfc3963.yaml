- contents:
  - '             Network Mobility (NEMO) Basic Support Protocol

    '
  title: __initial_text__
- contents:
  - "Status of This Memo\n   This document specifies an Internet standards track protocol
    for the\n   Internet community, and requests discussion and suggestions for\n
    \  improvements.  Please refer to the current edition of the \"Internet\n   Official
    Protocol Standards\" (STD 1) for the standardization state\n   and status of this
    protocol.  Distribution of this memo is unlimited.\n"
  title: Status of This Memo
- contents:
  - "Copyright Notice\n   Copyright (C) The Internet Society (2005).\n"
  title: Copyright Notice
- contents:
  - "Abstract\n   This document describes the Network Mobility (NEMO) Basic Support\n
    \  protocol that enables Mobile Networks to attach to different points\n   in
    the Internet.  The protocol is an extension of Mobile IPv6 and\n   allows session
    continuity for every node in the Mobile Network as the\n   network moves.  It
    also allows every node in the Mobile Network to be\n   reachable while moving
    around.  The Mobile Router, which connects the\n   network to the Internet, runs
    the NEMO Basic Support protocol with\n   its Home Agent.  The protocol is designed
    so that network mobility is\n   transparent to the nodes inside the Mobile Network.\n"
  title: Abstract
- contents:
  - "Table of Contents\n   1.  Introduction . . . . . . . . . . . . . . . . . . .
    . . . . .    3\n   2.  Terminology. . . . . . . . . . . . . . . . . . . . . .
    . . .    4\n   3.  Overview of the NEMO Protocol. . . . . . . . . . . . . . .
    .    4\n   4.  Message Formats. . . . . . . . . . . . . . . . . . . . . . .    7\n
    \      4.1. Binding Update. . . . . . . . . . . . . . . . . . . . .    7\n       4.2.
    Binding Acknowledgement . . . . . . . . . . . . . . . .    7\n       4.3. Mobile
    Network Prefix Option. . . . . . . . . . . . . .    8\n   5.  Mobile Router Operation.
    . . . . . . . . . . . . . . . . . .    9\n       5.1. Data Structures . . . .
    . . . . . . . . . . . . . . . .   10\n       5.2. Sending Binding Updates . .
    . . . . . . . . . . . . . .   10\n       5.3. Receiving Binding Acknowledgements.
    . . . . . . . . . .   11\n       5.4. Error Processing  . . . . . . . . . . .
    . . . . . . . .   12\n            5.4.1. Implicit Mode. . . . . . . . . . . .
    . . . . . .   12\n            5.4.2. Explicit Mode. . . . . . . . . . . . . .
    . . . .   12\n       5.5. Establishment of Bi-directional Tunnel  . . . . . .
    . .   13\n       5.6. Neighbor Discovery for Mobile Router  . . . . . . . . .
    \  13\n       5.7. Multicast Groups for Mobile Router  . . . . . . . . . .   14\n
    \      5.8. Returning Home  . . . . . . . . . . . . . . . . . . . .   14\n   6.
    \ Home Agent Operation . . . . . . . . . . . . . . . . . . . .   15\n       6.1.
    Data Structures . . . . . . . . . . . . . . . . . . . .   15\n            6.1.1.
    Binding Cache. . . . . . . . . . . . . . . . . .   15\n            6.1.2. Prefix
    Table . . . . . . . . . . . . . . . . . .   15\n       6.2. Mobile Network Prefix
    Registration  . . . . . . . . . .   16\n       6.3. Advertising Mobile Network
    Reachability . . . . . . . .   17\n       6.4. Establishment of Bi-directional
    Tunnel  . . . . . . . .   18\n       6.5. Forwarding Packets  . . . . . . . .
    . . . . . . . . . .   18\n       6.6. Sending Binding Acknowledgements  . . .
    . . . . . . . .   19\n       6.7. Mobile Network Prefix De-Registration . . .
    . . . . . .   19\n   7.  Modifications to Dynamic Home Agent Address Discovery.
    . . .   20\n       7.1. Modified Dynamic Home Agent Discovery Request . . . .
    .   20\n       7.2. Modified Dynamic Home Agent Discovery Address Request .   20\n
    \      7.3. Modified Home Agent Information Option  . . . . . . . .   21\n   8.
    \ Support for Dynamic Routing Protocols. . . . . . . . . . . .   22\n   9.  Security
    Considerations. . . . . . . . . . . . . . . . . . .   23\n   10. IANA Considerations.
    . . . . . . . . . . . . . . . . . . . .   24\n   11. Contributors . . . . . .
    . . . . . . . . . . . . . . . . . .   25\n   12. Acknowledgements . . . . . .
    . . . . . . . . . . . . . . . .   25\n   13. References . . . . . . . . . . .
    . . . . . . . . . . . . . .   25\n   Appendix . . . . . . . . . . . . . . . .
    . . . . . . . . . . . .   27\n       A. Examples of NEMO Basic Support Operation.
    . . . . . . . .   27\n       B. Running Link State Routing Protocol with NEMO
    Basic\n          Support . . . . . . . . . . . . . . . . . . . . . . . . .   30\n
    \         B.1. Tunnel Interface Considerations. . . . . . . . . . .   30\n          B.2.
    OSPF Area Considerations . . . . . . . . . . . . . .   30\n   Authors' Addresses
    . . . . . . . . . . . . . . . . . . . . . . .   32\n   Full Copyright Statement
    . . . . . . . . . . . . . . . . . . . .   33\n"
  title: Table of Contents
- contents:
  - "1.  Introduction\n   This document describes protocol extensions to Mobile IPv6
    (MIPv6)\n   [1] to enable support for network mobility.  The extensions are\n
    \  backward compatible with Mobile IPv6.  In particular, a NEMO-\n   compliant
    Home Agent can operate as a Mobile IPv6 Home Agent.  The\n   solution described
    here satisfies the goals and requirements\n   identified in [11] for network mobility.\n
    \  The NEMO Basic Support ensures session continuity for all the nodes\n   in
    the Mobile Network, even as the Mobile Router changes its point of\n   attachment
    to the Internet.  It also provides connectivity and\n   reachability for all nodes
    in the Mobile Network as it moves.  The\n   solution supports both mobile nodes
    and hosts that do not support\n   mobility in the Mobile Network.\n   Within the
    context of this document, the definition of a Mobile\n   Router extends that of
    a Mobile IPv6 [1] Mobile Node, by adding\n   routing capability routing between
    its point of attachment (Care-of\n   Address) and a subnet that moves with the
    Mobile Router.\n   The solution described in this document proposes a bi-directional\n
    \  tunnel between the Mobile Router and its Home Agent.  This tunnel is\n   set
    up when the Mobile Router sends a successful Binding Update to\n   its Home Agent,
    informing the Home Agent of its current point of\n   attachment.\n   All traffic
    between the nodes in the Mobile Network and Correspondent\n   Nodes passes through
    the Home Agent.  This document does not describe\n   route optimization of this
    traffic.\n   The terminology document [10] describes Nested Mobility as a scenario\n
    \  where a Mobile Router allows another Mobile Router to attach to its\n   Mobile
    Network.  There could be arbitrary levels of nested mobility.\n   The operation
    of each Mobile Router remains the same whether the\n   Mobile Router attaches
    to another Mobile Router or to a fixed Access\n   Router on the Internet.  The
    solution described here does not place\n   any restriction on the number of levels
    for nested mobility.  But\n   note that this might introduce significant overhead
    on the data\n   packets as each level of nesting introduces another IPv6 header\n
    \  encapsulation.\n   This document does not discuss multihoming for Mobile Routers.\n"
  title: 1.  Introduction
- contents:
  - "2.  Terminology\n   The keywords \"MUST\", \"MUST NOT\", \"REQUIRED\", \"SHALL\",
    \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"MAY\", and \"OPTIONAL\"
    in this\n   document are to be interpreted as described in BCP 14, RFC 2119 [7].\n
    \  Network Mobility - related terminology is defined in [9] and [10].\n   This
    document in addition defines the following terms.\n      Mobile Network Prefix\n
    \        An IPv6 prefix delegated to a Mobile Router and advertised in\n         the
    Mobile Network.  More than one Mobile Network Prefix could\n         be advertised
    in a Mobile Network.\n      Prefix Table\n         A list of Mobile Network Prefixes
    indexed by the Home Address\n         of a Mobile Router.  The Home Agent manages
    and uses Prefix\n         Table to determine which Mobile Network Prefixes belong
    to a\n         particular Mobile Router.\n"
  title: 2.  Terminology
- contents:
  - "3.  Overview of the NEMO Protocol\n   A Mobile Network is a network segment or
    subnet that can move and\n   attach to arbitrary points in the routing infrastructure.
    \ A Mobile\n   Network can only be accessed via specific gateways called Mobile\n
    \  Routers that manage its movement.  Mobile Networks have at least one\n   Mobile
    Router serving them.  A Mobile Router does not distribute the\n   Mobile Network
    routes to the infrastructure at its point of\n   attachment (i.e., in the visited
    network).  Instead, it maintains a\n   bi-directional tunnel to a Home Agent that
    advertises an aggregation\n   of Mobile Networks to the infrastructure.  The Mobile
    Router is also\n   the default gateway for the Mobile Network.\n   A Mobile Network
    can also comprise of multiple and nested subnets.  A\n   router without mobility
    support may be permanently attached to a\n   Mobile Network for local distribution.
    \ Also, Mobile Routers may be\n   attached to Mobile Networks owned by different
    Mobile Routers and may\n   form a graph.  In particular, with Basic NEMO Support,
    each Mobile\n   Router is attached to another Mobile Network by a single interface.\n
    \  If loops are avoided, the graph is a tree.\n   A Mobile Router has a unique
    Home Address through which it is\n   reachable when it is registered with its
    Home Agent.  The Home\n   Address is configured from a prefix aggregated and advertised
    by its\n   Home Agent.  The prefix could be either the prefix advertised on the\n
    \  home link or the prefix delegated to the Mobile Router.  The Mobile\n   Router
    can have more than one Home Address if there are multiple\n   prefixes in the
    home link.  The Mobile Router also advertises one or\n   more prefixes in the
    Mobile Network attached to it.  The actual\n   mechanism for assigning these prefixes
    to a given Mobile Router is\n   outside the scope of this specification.\n   When
    the Mobile Router moves away from the home link and attaches to\n   a new access
    router, it acquires a Care-of Address from the visited\n   link.  The Mobile Router
    can at any time act either as a Mobile Host\n   or as a Mobile Router.  It acts
    as a Mobile Host as defined in [1]\n   for sessions it originates and provides
    connectivity to the Mobile\n   Network.  As soon as the Mobile Router acquires
    a Care-of Address, it\n   immediately sends a Binding Update to its Home Agent
    as described in\n   [1].  When the Home Agent receives this Binding Update, it
    creates a\n   cache entry binding the Mobile Router's Home Address to its Care-of\n
    \  Address at the current point of attachment.\n   If the Mobile Router seeks
    to act as a Mobile Router and provide\n   connectivity to nodes in the Mobile
    Network, it indicates this to the\n   Home Agent by setting a flag (R) in the
    Binding Update.  It MAY also\n   include information about the Mobile Network
    Prefix in the Binding\n   Update by using one of the modes described in section
    5.2, so that\n   the Home Agent can forward packets meant for nodes in the Mobile\n
    \  Network to the Mobile Router.  A new Mobility Header Option for\n   carrying
    prefix information is described in section 4.3.  If the\n   Mobile Network has
    more than one IPv6 prefix and wants the Home Agent\n   to setup forwarding for
    all of these prefixes, it includes multiple\n   prefix information options in
    a single Binding Update.  The Home\n   Agent sets up forwarding for each of these
    prefixes to the Mobile\n   Router's Care-of Address.  In some scenarios the Home
    Agent would\n   already know which prefixes belong to a Mobile Router by an alternate\n
    \  mechanism such as static configuration.  In these scenarios, the\n   Mobile
    Router does not include any prefix information in the Binding\n   Update.  The
    Home Agent sets up forwarding for all prefixes owned by\n   the Mobile Router
    when it receives a Binding Update from the Mobile\n   Router with the Mobile Router
    Flag (R) set.\n   The Home Agent acknowledges the Binding Update by sending a
    Binding\n   Acknowledgement to the Mobile Router.  A positive acknowledgement\n
    \  with the Mobile Router Flag (R) set means that the Home Agent has set\n   up
    forwarding for the Mobile Network.  Once the binding process\n   finishes, a bi-directional
    tunnel is established between the Home\n   Agent and the Mobile Router.  The tunnel
    end points are the Mobile\n   Router's Care-of Address and the Home Agent's address.
    \ If a packet\n   with a source address belonging to the Mobile Network Prefix
    is\n   received from the Mobile Network, the Mobile Router reverse-tunnels\n   the
    packet to the Home Agent through this tunnel.  This reverse-\n   tunneling is
    done by using IP-in-IP encapsulation [3].  The Home\n   Agent decapsulates this
    packet and forwards it to the Correspondent\n   Node.  For traffic originated
    by itself, the Mobile Router can use\n   either reverse tunneling or route optimization,
    as specified in [1].\n   When a Correspondent Node sends a data packet to a node
    in the Mobile\n   Network, the packet is routed to the Home Agent that currently
    has\n   the binding for the Mobile Router.  The Mobile Router's network\n   prefix
    would be aggregated at the Home Agent, which would advertise\n   the resulting
    aggregation.  Alternatively, the Home Agent may receive\n   the data packets destined
    to the Mobile Network by advertising routes\n   to the Mobile Network Prefix.
    \ The actual mechanism by which these\n   routes are advertised is outside the
    scope of this document.  When\n   the Home Agent receives a data packet meant
    for a node in the Mobile\n   Network, it tunnels the packet to the Mobile Router's
    current Care-of\n   Address.  The Mobile Router decapsulates the packet and forwards
    it\n   onto the interface where the Mobile Network is connected.  Before\n   decapsulating
    the tunneled packet, the Mobile Router has to check\n   whether the Source address
    on the outer IPv6 header is the Home\n   Agent's address.  This check is not necessary
    if the packet is\n   protected by IPsec in tunnel mode.  The Mobile Router also
    has to\n   make sure that the destination address on the inner IPv6 header\n   belongs
    to a prefix used in the Mobile Network before forwarding the\n   packet to the
    Mobile Network.  If it does not, the Mobile Router\n   should drop the packet.\n
    \  The Mobile Network could include nodes that do not support mobility\n   and
    nodes that do.  A node in the Mobile Network can also be a fixed\n   or a Mobile
    Router.  The protocol described here ensures complete\n   transparency of network
    mobility to the nodes in the Mobile Network.\n   Mobile Nodes that attach to the
    Mobile Network treat it as a normal\n   IPv6 access network and run the Mobile
    IPv6 protocol.\n   The Mobile Router and the Home Agent can run a routing protocol\n
    \  through the bi-directional tunnel.  In this case, the Mobile Router\n   need
    not include prefix information in the Binding Update.  Instead,\n   the Home Agent
    uses the routing protocol updates to set up forwarding\n   for the Mobile Network.
    \ When the routing protocol is running, the\n   bi-directional tunnel must be
    treated as a tunnel interface.  The\n   tunnel interface is included in the list
    of interfaces on which\n   routing protocol is active.  The Mobile Router should
    be configured\n   not to send any routing protocol messages on its egress interface\n
    \  when it is away from the home link and connected to a visited link.\n   Finally,
    the Home Agent may be configured with static routes to the\n   Mobile Network
    Prefix via the Mobile Router's Home Address.  In this\n   case, the routes are
    set independently of the binding flows and the\n   returning home of a Mobile
    Router.  The benefit is that such movement\n   does not induce additional signalling
    in the form of routing updates\n   in the home network.  The drawback is that
    the routes are present\n   even if the related Mobile Routers are not reachable
    (at home or\n   bound) at a given point of time.\n"
  title: 3.  Overview of the NEMO Protocol
- contents:
  - '4.  Message Formats

    '
  - contents:
    - "4.1.  Binding Update\n   A new flag (R) is included in the Binding Update to
      indicate to the\n   Home Agent whether the Binding Update is coming from a Mobile
      Router\n   and not from a mobile node.  The rest of the Binding Update format\n
      \  remains the same as defined in [1].\n    0                   1                   2
      \                  3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4
      5 6 7 8 9 0 1\n                                   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \                                  |          Sequence #           |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |A|H|L|K|M|R|      Reserved     |           Lifetime            |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                                                               |\n   |                                                               |\n
      \  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n      Mobile
      Router Flag (R)\n         The Mobile Router Flag is set to indicate to the Home
      Agent\n         that the Binding Update is from a Mobile Router.  If the flag\n
      \        is set to 0, the Home Agent assumes that the Mobile Router is\n         behaving
      as a Mobile Node, and it MUST NOT forward packets\n         destined for the
      Mobile Network to the Mobile Router.\n      Mobility Options\n         A variable
      length field that can include zero or more mobility\n         options.  This
      document defines a new mobility option in\n         addition to what is defined
      in [1].\n   For descriptions of the other fields in the message, see [1].\n"
    title: 4.1.  Binding Update
  - contents:
    - "4.2.  Binding Acknowledgement\n   A new flag (R) is included in the Binding
      Acknowledgement to indicate\n   that the Home Agent that processed the corresponding
      Binding Update\n   supports Mobile Routers.  The flag is set only if the corresponding\n
      \  Binding Update had the Mobile Router Flag (R) set to 1.  The rest of\n   the
      Binding Acknowledgement format remains the same, as defined in\n   [1].\n    0
      \                  1                   2                   3\n    0 1 2 3 4
      5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n                                   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \                                  |   Status      |K|R|  Reserved |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |         Sequence #            |           Lifetime            |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                                                               |\n   |                                                               |\n
      \  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n      Mobile
      Router Flag (R)\n         The Mobile Router Flag is set to indicate that the
      Home Agent\n         that processed the Binding Update supports Mobile Routers.
      \ It\n         is set to 1 only if the corresponding Binding Update had the\n
      \        Mobile Router Flag set to 1.\n   For descriptions of the other fields
      in the message, see [1].\n   This document also introduces the following new
      Binding\n   Acknowledgement status values.  The values shown below are decimal\n
      \  values.\n      140     Mobile Router Operation not permitted\n      141     Invalid
      Prefix\n      142     Not Authorized for Prefix\n      143     Forwarding Setup
      failed (prefixes missing)\n   Status values less than 128 indicate that the
      Binding Update was\n   processed successfully by the receiving nodes.  Values
      greater than\n   128 indicate that the Binding Update was rejected by the Home
      Agent.\n"
    title: 4.2.  Binding Acknowledgement
  - contents:
    - "4.3.  Mobile Network Prefix Option\n   The Mobile Network Prefix Option is
      included in the Binding Update to\n   indicate the prefix information for the
      Mobile Network to the Home\n   Agent.  There could be multiple Mobile Network
      Prefix Options if the\n   Mobile Router has more than one IPv6 prefix in the
      Mobile Network and\n   wants the Home Agent to forward packets for each of these
      prefixes to\n   the Mobile Router's current location.\n   The Mobile Network
      Prefix Option has an alignment requirement of\n   8n+4.  Its format is as follows.\n
      \   0                   1                   2                   3\n    0 1 2
      3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |      Type     |   Length      |   Reserved    | Prefix Length |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                                                               |\n   +                                                               +\n
      \  |                                                               |\n   +                   Mobile
      Network Prefix                       +\n   |                                                               |\n
      \  +                                                               +\n   |                                                               |\n
      \  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n      Type\n
      \        6\n      Length\n         Eight-bit unsigned integer indicating the
      length in octets of\n         the option, excluding the type and length fields.
      \ Set to 18.\n      Reserved\n         This field is unused for now.  The value
      MUST be initialized to\n         0 by the sender and MUST be ignored by the
      receiver.\n      Prefix Length\n         Eight-bit unsigned integer indicating
      the prefix length of the\n         IPv6 prefix contained in the option.\n      Mobile
      Network Prefix\n         A sixteen-byte field containing the Mobile Network
      Prefix\n"
    title: 4.3.  Mobile Network Prefix Option
  title: 4.  Message Formats
- contents:
  - "5.  Mobile Router Operation\n   Mobile Router operation is derived largely from
    the combined\n   behaviors of a host, of a router [5], and of a Mobile Node [1].\n
    \  A Mobile Node can act in two ways: (1) as a Mobile Host, in which\n   case
    the Home Agent doesn't maintain any prefix information related\n   to the Mobile
    Host's Home Address but does maintain a binding cache\n   entry related to the
    Mobile Host's Home Address, and (2) as a Mobile\n   Router, in which case, in
    addition to maintaining the binding cache\n   entry corresponding to the Mobile
    Router Home Address, the Home Agent\n   maintains forwarding information related
    to prefixes assigned to the\n   Mobile Network.  The distinction between the two
    modes is represented\n   by the value of the Mobile Router Flag (R).\n   A Mobile
    Router MUST implement all requirements for IPv6 Mobile Nodes\n   as described
    in section 8.5 of [1].\n"
  - contents:
    - "5.1.  Data Structures\n   Like a Mobile Host, a Mobile Router also maintains
      a Binding Update\n   List, described in section 11.1 of the Mobile IPv6 specification
      [1].\n   The Binding Update list is a conceptual data structure that records\n
      \  information sent in the Binding Updates.  There is one entry per each\n   destination
      to which the Mobile Router is currently sending Binding\n   Updates.\n   This
      document introduces a new Prefix Information field in the\n   Binding Update
      list structure.  This field is used to store any\n   prefix information that
      the Mobile Router includes in the Binding\n   Update.  If the Mobile Router
      sets the Mobile Router Flag (R) in the\n   Binding Update but does not include
      any prefix information in it this\n   field is set to null.  The Mobile Router
      does not include prefix\n   information in the Binding Update in the implicit
      mode or when it,\n   runs a dynamic routing protocol with its Home Agent.\n
      \  As does a Mobile Host, a Mobile Router stores the information\n   regarding
      status of flags of the Binding Update in the corresponding\n   Binding Update
      List entry.  This document introduces a new Mobile\n   Router Flag (R) for this
      entry.  The status of this flag is stored in\n   the Binding Update list whenever
      a Binding Update is sent.\n   A Mobile Router also maintains a Home Agent list
      populated according\n   to the same procedure as a Mobile Host.\n"
    title: 5.1.  Data Structures
  - contents:
    - "5.2.  Sending Binding Updates\n   A Mobile Router sends Binding Updates to
      its Home Agent, as described\n   in [1].  If the Mobile Router is not running
      a routing protocol as\n   described in section 8, it uses one of the following
      modes to tell\n   the Home Agent to determine which prefixes belong to the Mobile\n
      \  Router.  In both modes, the Mobile Router sets the Mobile Router Flag\n   (R).\n
      \     Implicit:\n         In this mode, the Mobile Router does not include a
      Mobile\n         Network Prefix Option in the Binding Update.  The Home Agent\n
      \        can use any mechanism (not defined in this document) to\n         determine
      the Mobile Network Prefix(es) owned by the Mobile\n         Router and to set
      up forwarding for the Mobile Network.  One\n         example would be manual
      configuration at the Home Agent mapping\n         the Mobile Router's Home Address
      to the information required\n         for setting up forwarding for the Mobile
      Network.\n      Explicit:\n         In this mode, the Mobile Router includes
      one or more Mobile\n         Network Prefix Options in the Binding Update.  These
      options\n         contain information about the Mobile Network Prefix(es)\n
      \        configured on the Mobile Network.\n   A Mobile Router MUST implement
      at least one mode and MAY implement\n   both.  In the latter case, local configuration
      on the Mobile Router\n   decides which mode to use.  This is out of scope for
      this document.\n   If the Mobile Router Flag is set, the Home Registration Flag
      (H) MUST\n   be set.\n   If the Mobile Router has a valid binding cache entry
      at the Home\n   Agent, subsequent Binding Updates for the same Home Address
      should\n   have the same value as the value in the binding cache for the Mobile\n
      \  Router Flag (R).  In explicit mode, the Mobile Router MUST include\n   prefix
      information in all Binding Updates, including those sent to\n   refresh existing
      binding cache entries, if it wants forwarding\n   enabled for the corresponding
      Mobile Network Prefixes.\n"
    title: 5.2.  Sending Binding Updates
  - contents:
    - "5.3.  Receiving Binding Acknowledgements\n   The Mobile Router receives Binding
      Acknowledgements from the Home\n   Agent corresponding to the Binding Updates
      it sent.  If the Binding\n   Acknowledgement status is set to 0 (Binding Update
      accepted) and the\n   Mobile Router Flag (R) is set to 1, the Mobile Router
      assumes that\n   the Home Agent has successfully processed the Binding Update
      and has\n   set up forwarding for the Mobile Network.  The Mobile Router can
      then\n   start using the bi-directional tunnel to reverse-tunnel traffic from\n
      \  the Mobile Network.  If the Mobile Router Flag (R) is not set, then\n   the
      Mobile Router concludes that its current Home Agent does not\n   support Mobile
      Routers and it performs Dynamic Home Agent Address\n   Discovery again to discover
      Home Agents that do.  The Mobile Router\n   MUST also de-register with the Home
      Agent that did not support it\n   before attempting registration with another.\n"
    title: 5.3.  Receiving Binding Acknowledgements
  - contents:
    - "5.4.  Error Processing\n   If the Binding Acknowledgement status is set to
      a value between 128\n   and 139, the Mobile Router takes necessary actions as
      described in\n   the Mobile IPv6 specification [1].  For the Binding Acknowledgement\n
      \  status values defined in this document, the following sections\n   explain
      the Mobile Router's behavior.\n"
    - contents:
      - "5.4.1.  Implicit Mode\n   In Implicit mode, the Mobile Router interprets
        only error statuses\n   140 (Mobile Router Operation not permitted) and 143
        (Forwarding Setup\n   failed).  The Mobile Router MUST treat Binding Acknowledgements
        with\n   statuses '141' and '142' as fatal errors, since they should not be\n
        \  sent by the Home Agent in implicit mode.\n   If the Binding Acknowledgement
        from the Home Agent has the status\n   140, the Mobile Router SHOULD send
        a Binding Update to another Home\n   Agent on the same home link.  If no Home
        Agent replies positively,\n   the Mobile Router MUST refrain from sending
        Binding Updates with the\n   Mobile Router Flag set to any Home Agent on the
        home link, and it\n   must log the information.\n   If the Binding Acknowledgement
        has the status 143, the Mobile Router\n   SHOULD send a Binding Update to
        another Home Agent on the same home\n   link.  If no Home Agent replies positively,
        the Mobile Router SHOULD\n   refrain from sending this Binding Update to any
        Home Agent on the\n   home link, and MAY send Binding Updates in Explicit
        mode to a Home\n   Agent on the same home link.\n"
      title: 5.4.1.  Implicit Mode
    - contents:
      - "5.4.2.  Explicit Mode\n   If the Mobile Router sent a Binding Update to the
        Home Agent in\n   explicit mode, then the Mobile Router interprets only error
        statuses\n   140 (Mobile Router Operation not permitted), 141 (Invalid Prefix),\n
        \  and 142 (Not Authorized for Prefix).  The Mobile Router MUST treat\n   Binding
        Acknowledgements with status '143' as a fatal error, since it\n   should not
        be sent by the Home Agent in explicit mode.\n   If the Binding Acknowledgement
        from the Home Agent has the status\n   140, the Mobile Router SHOULD send
        a Binding Update to another Home\n   Agent on the same home link.  If no Home
        Agent replies positively,\n   then the Mobile Router MUST refrain from sending
        Binding Updates with\n   the Mobile Router Flag set to any Home Agent on the
        home link, and it\n   must log the information.\n   If the Binding Acknowledgement
        has the status 141 or 142, the Mobile\n   Router SHOULD send a Binding Update
        to another Home Agent on the same\n   home link.  If no Home Agent replies
        positively, then the Mobile\n   Router SHOULD refrain from sending Binding
        Updates to any Home Agent\n   on the home link.  The Mobile Router MUST also
        stop advertising the\n   prefix in the Mobile Network and try to obtain new
        IPv6 prefix\n   information for the Mobile Network.  It would do this by the
        same\n   means that it initially got assigned the current Mobile Network\n
        \  Prefix.  Alternatively, the Mobile Router MAY send Binding Updates in\n
        \  Implicit mode to a Home Agent on the same home link.\n   If by the end
        of this Error Processing procedure, as described in\n   sections 5.4.1 and
        5.4.2, the Mobile Router has tried every available\n   mode and still has
        not received a positive Binding Acknowledgement,\n   the Mobile Router MUST
        stop sending Binding Updates with the Mobile\n   Router Flag set for this
        Home Address and it must log the\n   information.\n   In all cases above,
        the Mobile Router MUST conclude that the Home\n   Agent did not create a binding
        cache entry for the Mobile Router's\n   Home Address.\n"
      title: 5.4.2.  Explicit Mode
    title: 5.4.  Error Processing
  - contents:
    - "5.5.  Establishment of Bi-directional Tunnel\n   When a successful Binding
      Acknowledgement is received, the Mobile\n   Router sets up its endpoint of the
      bi-directional tunnel.\n   The bi-directional tunnel between the Mobile Router
      and the Home\n   Agent allows packets to flow in both directions, while the
      Mobile\n   Router is connected to a visited link.  The bi-directional tunnel
      is\n   created by merging two unidirectional tunnels, as described in RFC\n
      \  2473 [3].  The tunnel from the Mobile Router to the Home Agent has\n   the
      Care-of address of the Mobile Router as the tunnel entry point\n   and the Home
      Agent's address as the tunnel exit point.  The tunnel\n   from the Home Agent
      to the Mobile Router has the Home Agent's address\n   and the Mobile Router's
      Care-of Address as the tunnel entry point and\n   exit point, respectively.
      \ All IPv6 traffic to and from the Mobile\n   Network is sent through this bi-directional
      tunnel.\n   A Mobile Router uses the Tunnel Hop Limit normally assigned to\n
      \  routers (not to hosts).  Please refer to [3] for more details.\n"
    title: 5.5.  Establishment of Bi-directional Tunnel
  - contents:
    - "5.6.  Neighbor Discovery for Mobile Router\n   When the Mobile Router is at
      home, it MAY be configured to send\n   Router Advertisements and to reply to
      Router Solicitations on the\n   interface attached to the home link.  The value
      of the Router\n   Lifetime field SHOULD be set to 0 to prevent other nodes from\n
      \  configuring the Mobile Router as the default router.\n   A Mobile Router
      SHOULD NOT send unsolicited Router Advertisements and\n   SHOULD NOT reply to
      Router Solicitations on any egress interface when\n   that interface is attached
      to a visited link.  However, the Mobile\n   Router SHOULD reply with Neighbor
      Advertisements to Neighbor\n   Solicitations received on the egress interface,
      for addresses valid\n   on the visited link.\n   A router typically ignores
      Router Advertisements sent by other\n   routers on a link.  However, a Mobile
      Router MUST NOT ignore Router\n   Advertisements received on the egress interface.
      \ The received Router\n   Advertisements MAY be used for address configuration,
      default router\n   selection, or movement detection.\n"
    title: 5.6.  Neighbor Discovery for Mobile Router
  - contents:
    - "5.7.  Multicast Groups for Mobile Router\n   When at home, the Mobile Router
      joins the multicast group All Routers\n   Address with scopes 1 interface-local
      (on the home-advertising\n   interface), and 2 link-local, on any of its egress
      interfaces.  When\n   in a visited network, the Mobile Router MUST NOT join
      the above\n   multicast groups on the corresponding interface.\n"
    title: 5.7.  Multicast Groups for Mobile Router
  - contents:
    - "5.8.  Returning Home\n   When the Mobile Router detects that it has returned
      to its home link,\n   it MUST de-register with its Home Agent.  The Mobile Router
      MUST\n   implement and follow the returning-home procedures defined for a\n
      \  mobile node in [1].  In addition, the Mobile Router MAY start\n   behaving
      as a router on its egress interface, especially as follows:\n   -  The Mobile
      Router MAY send Router Advertisements on its egress\n      interfaces, but the
      router lifetime SHOULD be set to 0 so that\n      hosts on the home link do
      not pick the Mobile Router as the\n      default router.\n   -  The Mobile Router
      MAY join the All Routers Address multicast group\n      on the home link.\n
      \  -  The Mobile Router MAY send routing protocol messages on its egress\n      interface
      if it is configured to run a dynamic routing protocol.\n   When the Mobile Router
      sends a de-registration Binding Update in\n   Explicit mode, it SHOULD NOT include
      any Mobile Network Prefix\n   options in the Binding Update.  When the Home
      Agent removes a binding\n   cache entry, it deletes all associated Mobile Network
      Prefix routes.\n"
    title: 5.8.  Returning Home
  title: 5.  Mobile Router Operation
- contents:
  - "6.  Home Agent Operation\n   For a Mobile Router to operate correctly, the Home
    Agent MUST satisfy\n   all the requirements listed in section 8.4 of [1].  The
    Home Agent\n   MUST implement both modes described in section 5.2 of this document.\n"
  - contents:
    - '6.1.  Data Structures

      '
    - contents:
      - "6.1.1.  Binding Cache\n   The Home Agent maintains Binding Cache Entries
        for each Mobile Router\n   currently registered with the Home Agent.  The
        Binding Cache is a\n   conceptual data structure described in detail in [1].\n
        \  The Home Agent might need to store the Mobile Network Prefixes\n   associated
        with a Mobile Router in the corresponding Binding Cache\n   Entry.  This is
        required if the Binding Update that created the\n   Binding Cache Entry contained
        explicit prefix information.  This\n   information can be used later to clean
        up routes installed in\n   explicit mode, when the Binding Cache Entry is
        removed, and to\n   maintain the routing table, for instance, should the routes
        be\n   removed manually.\n   The Home Agent also stores the status of the
        Mobile Router Flag (R)\n   in the Binding Cache entry.\n"
      title: 6.1.1.  Binding Cache
    - contents:
      - "6.1.2.  Prefix Table\n   The Home Agent SHOULD be able to prevent a Mobile
        Router from\n   claiming Mobile Network Prefixes belonging to another Mobile
        Router.\n   The Home Agent can prevent such attacks if it maintains a Prefix\n
        \  Table and verifies the prefix information provided by the Mobile\n   Router
        against Prefix Table entries.  The Prefix Table SHOULD be used\n   by the
        Home Agent when it processes a Binding Update in explicit\n   mode.  It is
        not required when a dynamic routing protocol is run\n   between the Mobile
        Router and the Home Agent.\n   Each entry in the Prefix Table contains the
        following fields:\n   -  The Home Address of the Mobile Router.  This field
        is used as the\n      key for searching the pre-configured Prefix Table.\n
        \  -  The Mobile Network Prefix of the Mobile Router associated with the\n
        \     Home Address.\n"
      title: 6.1.2.  Prefix Table
    title: 6.1.  Data Structures
  - contents:
    - "6.2.  Mobile Network Prefix Registration\n   The Home Agent processes the Binding
      Update as described in section\n   10.3.1 of the Mobile IPv6 specification [1].
      \ This section describes\n   the processing of the Binding Update if the Mobile
      Router (R) Flag is\n   set.  The Home Agent performs the following check.\n
      \  -  The Home Registration (H) Flag MUST be set.  If it is not, the\n      Home
      Agent MUST reject the Binding Update and send a Binding\n      Acknowledgement
      with status set to 140.  Note: The basic support\n      does not allow sending
      a Binding Update for a Mobile Network\n      Prefix to correspondent nodes (for
      route optimization).\n   -  Mobile IPv6 specification [1] requires that the
      Home Address in\n      the Binding Update be configured from a prefix advertised
      on the\n      home link.  Otherwise the Binding Update is rejected with status\n
      \     value 132 [1].  This specification relaxes this requirement so\n      that
      the Home Agent rejects the Binding Update only if the Home\n      Address does
      not belong to the prefix that the Home Agent is\n      configured to serve.\n
      \  If the Home Agent has a valid binding cache entry for the Mobile\n   Router,
      and if the Binding Update has the Mobile Router Flag (R) set\n   to a value
      different from that in the existing binding cache entry,\n   then the Home Agent
      MUST reject the Binding Update and send a Binding\n   Acknowledgement with status
      set to 139 (Registration type change\n   disallowed).  However, if the Binding
      Update is a de-registration\n   Binding Update, the Home Agent ignores the value
      of the Mobile Router\n   Flag (R).\n   If the Lifetime specified in the Binding
      Update is 0 or the specified\n   Care-of address matches the Home Address in
      the Binding Update, then\n   this is a request to delete the cached binding
      for the home address\n   and specified Mobile Network Prefixes.  The Binding
      Update is\n   processed as described in section 6.7.\n   If the Home Agent does
      not reject the Binding Update as invalid, and\n   if a dynamic routing protocol
      is not run between the Home Agent and\n   the Mobile Router as described in
      section 8, then the Home Agent\n   retrieves the Mobile Network Prefix information
      as described below.\n   -  If a Mobile Network Prefix Option is present in the
      Binding\n      Update, the prefix information for the Mobile Network Prefix
      is\n      retrieved from the Mobile Network Prefix field and the Prefix\n      Length
      field of the option.  If the Binding Update contains more\n      than one option,
      the Home Agent MUST set up forwarding for all the\n      Mobile Network Prefixes.
      \ If the Home Agent fails to set up\n      forwarding to all the prefixes listed
      in the Binding Update, then\n      it MUST NOT forward traffic to any of the
      prefixes.  Furthermore,\n      it MUST reject the Binding Update and send a
      Binding\n      Acknowledgement with status set to 141 (Invalid Prefix).\n      If
      the Home Agent verifies the prefix information with the Prefix\n      Table
      and the check fails, the Home Agent MUST discard the Binding\n      Update and
      send a Binding Acknowledgement with status set to 142\n      (Not Authorized
      for Prefix).\n   -  If there is no option in the Binding Update carrying prefix\n
      \     information, the Home Agent uses manual pre-configured information\n      to
      determine the prefixes assigned to the Mobile Router and to set\n      up forwarding
      for the Mobile Network.  If there is no information\n      that the Home Agent
      can use, it MUST reject the Binding Update and\n      send a Binding Acknowledgement
      with status set to 143 (Forwarding\n      Setup failed).\n   If the Home Agent
      has a valid binding cache entry for the Mobile\n   Router, it should compare
      the list of prefixes in the Binding Update\n   against the prefixes stored in
      the binding cache entry.  If the\n   binding cache entry contains prefixes that
      do not appear in the\n   Binding Update, the Home Agent MUST disable forwarding
      for these\n   Mobile Network Prefixes.\n   If all checks are passed, the Home
      Agent creates a binding cache\n   entry for Mobile Router's Home Address or
      updates the entry if it\n   already exists.  Otherwise, the Home Agent MUST
      NOT register the\n   binding of the Mobile Router's Home Address.\n   The Home
      Agent defends the Mobile Router's Home Address through Proxy\n   Neighbor Discovery
      by multicasting a Neighbor Advertisement message\n   onto the home link on behalf
      of the Mobile Router.  All fields in the\n   Proxy Neighbor Advertisement message
      should be set the same way they\n   would be by the Mobile Router if it sent
      this Neighbor Advertisement\n   while at home, as described in [6].  There is
      an exception:  If the\n   Mobile Router (R) Flag has been set in the Binding
      Update, the Router\n   (R) bit in the Advertisement MUST be set.\n   The Home
      Agent also creates a bi-directional tunnel to the Mobile\n   Router for the
      requested Mobile Network Prefix or updates an existing\n   bi-directional tunnel
      as described in section 6.4.\n"
    title: 6.2.  Mobile Network Prefix Registration
  - contents:
    - "6.3.  Advertising Mobile Network Reachability\n   To receive packets meant
      for the Mobile Network, the Home Agent\n   advertises reachability to the Mobile
      Network.  If the Home Link is\n   configured with an aggregated prefix and the
      Mobile Network Prefix is\n   aggregated under that prefix, then the routing
      changes related to the\n   Mobile Network may be restricted to the Home Link.
      \ If the Home Agent\n   is the only default router on the Home Link, routes
      to the Mobile\n   Network Prefix are aggregated naturally under the Home Agent,
      which\n   does not have to do anything special.\n   If the Home Agent receives
      routing updates through a dynamic routing\n   protocol from the Mobile Router,
      it can be configured to propagate\n   those routes on the relevant interfaces.\n"
    title: 6.3.  Advertising Mobile Network Reachability
  - contents:
    - "6.4.  Establishment of Bi-directional Tunnel\n   The implementation of the
      bi-directional tunnels and the mechanism\n   for attaching them to the IP stack
      are outside the scope of this\n   specification.  However, all implementations
      MUST be capable of the\n   following operations:\n   -  The Home Agent can tunnel
      packets meant for the Mobile Network\n      prefix to the Mobile Router's current
      location, the Care-of\n      Address.\n   -  The Home Agent can accept packets
      tunneled by the Mobile Router\n      with the source address of the outer IPv6
      header set to the Mobile\n      Router's Care-of Address.\n"
    title: 6.4.  Establishment of Bi-directional Tunnel
  - contents:
    - "6.5.  Forwarding Packets\n   When the Home Agent receives a data packet destined
      for the Mobile\n   Network, it MUST forward the packet to the Mobile Router
      through the\n   bi-directional tunnel.  The Home Agent uses either the routing
      table,\n   the Binding Cache, or a combination to route packets to the Mobile\n
      \  Network.  This is implementation specific.  Two examples are shown\n   below.\n
      \  1. The Home Agent maintains a route to the Mobile Network Prefix with\n      the
      next hop set to the Mobile Router's Home Address.  When the\n      Home Agent
      tries to forward the packet to the next hop, it finds a\n      binding cache
      entry for the home address.  Then the Home Agent\n      extracts the Mobile
      Router's Care-of address and tunnels the\n      packet to the Care-of address.\n
      \  2. The Home Agent maintains a route to the Mobile Network Prefix with\n      the
      outgoing interface set to the bi-directional tunnel interface\n      between
      the Home Agent and the Mobile Router.  For this purpose,\n      the Home Agent
      MUST treat this tunnel as a tunnel interface.  When\n      the packets are forwarded
      through the tunnel interface, they are\n      encapsulated automatically, with
      the source address and\n      destination address in the outer IPv6 header set
      to the Home\n      Agent's address and the Mobile Router's Care-of address,\n
      \     respectively.\n"
    title: 6.5.  Forwarding Packets
  - contents:
    - "6.6.  Sending Binding Acknowledgements\n   A Home Agent serving a Mobile Router
      sends Binding Acknowledgements\n   with the same rules it uses for sending Binding
      Acknowledgements to\n   Mobile Hosts [1], with the following enhancements.\n
      \  The Home Agent sets the status code in the Binding Acknowledgement to\n   0
      (Binding Update accepted) to indicate to the Mobile Router that it\n   successfully
      processed the Binding Update.  It also sets the Mobile\n   Router Flag (R) to
      indicate to the Mobile Router that it has set up\n   forwarding for the Mobile
      Network.\n   If the Home Agent is not configured to support Mobile Routers,
      it\n   sets the status code in the Binding Acknowledgement to 140 (Mobile\n
      \  Router Operation not permitted).\n   If one or more prefixes received in
      the Binding Update are invalid\n   and the Home Agent cannot set up forwarding
      for the prefixes, the\n   Home Agent sets the status code in the Binding Acknowledgement
      to 141\n   (Invalid Prefix) to indicate this to the Mobile Router.\n   If the
      Mobile Router is not authorized to use this Home Address to\n   forward packets
      for one or more prefixes present in the Binding\n   Update, the Home Agent sets
      the status code in the Binding\n   Acknowledgement to 142 (Not Authorized for
      Prefix) to indicate this.\n   The Home Agent sets the status code to 143 (Forwarding
      Setup failed)\n   if it is unable to determine the information needed to set
      up\n   forwarding for the Mobile Network.  This is used in the Implicit\n   mode,
      in which the Mobile Router does not include any prefix\n   information in the
      Binding Update.\n"
    title: 6.6.  Sending Binding Acknowledgements
  - contents:
    - "6.7.  Mobile Network Prefix De-registration\n   When the Home Agent successfully
      processes the de-registration BU, it\n   deletes the Binding Cache Entry for
      the Mobile Router's Home Address\n   and stops proxying the Home Address.  This
      is described in detail in\n   the Mobile IPv6 specification [1].\n   In addition,
      the Home Agent removes the bi-directional tunnel and\n   stops forwarding packets
      to the Mobile Network.  The Home Agent\n   should keep all necessary information
      to clean up whichever routes it\n   installed, whether they come from an implicit
      or explicit source.\n   In Explicit mode, the Home Agent MUST ignore any Mobile
      Network\n   Prefix Options present in the de-registration Binding Update.\n"
    title: 6.7.  Mobile Network Prefix De-registration
  title: 6.  Home Agent Operation
- contents:
  - "7.  Modifications to Dynamic Home Agent Address Discovery\n   This document extends
    the Dynamic Home Agent Address Discovery\n   (DHAAD) defined in [1] so that Mobile
    Routers only attempt\n   registration with Home Agents that support them.\n"
  - contents:
    - "7.1.  Modified Dynamic Home Agent Discovery Address Request\n   A new flag
      (R) (Support for Mobile Routers) is introduced in the\n   DHAAD Request message,
      defined in [1].  The Mobile Router sets this\n   flag to indicate that it wants
      to discover Home Agents supporting\n   Mobile Routers.\n    0                   1
      \                  2                   3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4
      5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |     Type      |     Code      |            Checksum           |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |          Identifier           |R|          Reserved           |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \     Mobile Router Support Flag (R)\n         A one-bit flag that when set
      indicates that the Mobile Router\n         wants to discover Home Agents supporting
      Mobile Routers.\n      For a description of the other fields in the message,
      see [1].\n"
    title: 7.1.  Modified Dynamic Home Agent Discovery Address Request
  - contents:
    - "7.2.  Modified Dynamic Home Agent Discovery Address Request\n   A new flag
      (R) (Support for Mobile Routers) is introduced in the\n   DHAAD Reply message,
      defined in [1].  If a Home Agent receives a\n   Dynamic Home Agent Discovery
      request message with the Mobile Router\n   Support Flag set, it MUST reply with
      a list of Home Agents supporting\n   Mobile Routers.  The Mobile Router Support
      Flag MUST be set if there\n   is at least one Home Agent supporting Mobile Routers.
      \ If none of the\n   Home Agents support Mobile Routers, the Home Agent MAY
      reply with a\n   list of Home Agents that only support Mobile IPv6 Mobile Nodes.
      \ In\n   this case, the Mobile Router Support Flag MUST be set to 0.\n   The
      modified message format is as follows.\n    0                   1                   2
      \                  3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4
      5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |     Type      |     Code      |            Checksum           |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |           Identifier          |R|           Reserved          |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                                                               |\n   +                                                               +\n
      \  +                                                               +\n   |                                                               |\n
      \  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n      Mobile
      Router Support Flag (R)\n         A one-bit flag that when set indicates that
      the Home Agents\n         listed in this message support Mobile Routers.\n      For
      a description of the other fields in the message, see [1].\n"
    title: 7.2.  Modified Dynamic Home Agent Discovery Address Request
  - contents:
    - "7.3.  Modified Home Agent Information Option\n   A new flag (R) (Support for
      Mobile Routers) is introduced in the Home\n   Agent Information Option defined
      in [1].  If a Home Agent supports\n   Mobile Routers, it SHOULD set the flag.\n
      \   0                   1                   2                   3\n    0 1 2
      3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |     Type      |    Length     |R|         Reserved            |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |     Home Agent Preference     |      Home Agent Lifetime      |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \     Mobile Router Support Flag (R)\n         A one-bit flag that when set
      indicates that the Home Agent\n         supports Mobile Routers.\n      For
      a description of the other fields in the message, see [1].\n"
    title: 7.3.  Modified Home Agent Information Option
  title: 7.  Modifications to Dynamic Home Agent Address Discovery
- contents:
  - "8.  Support for Dynamic Routing Protocols\n   In the solution described so far,
    forwarding to the Mobile Network at\n   the Home Agent is set up when the Home
    Agent receives a Binding\n   Update from the Mobile Router.  An alternative to
    this is for the\n   Home Agent and the Mobile Router to run an intra-domain routing\n
    \  protocol such as RIPng [12] and OSPF [13] through the bi-directional\n   tunnel.
    \ The Mobile Router can continue running the same routing\n   protocol that it
    ran when attached to the home link.\n   Support for running a intra-domain routing
    protocol is optional and\n   is governed by the configuration on the Mobile Router
    and the Home\n   Agent.\n   This feature is very useful when the Mobile Network
    is large with\n   multiple subnets containing different IPv6 prefixes.  Routing
    changes\n   in the Mobile Network are quickly propagated to the Home Agent.\n
    \  Routing changes in the home link are quickly propagated to the Mobile\n   Router.\n
    \  When the Mobile Router is attached to the home link, it runs a\n   routing
    protocol by sending routing updates through its egress\n   interface.  When the
    Mobile Router moves and attaches to a visited\n   network, it should stop sending
    routing updates on the interface by\n   which it attaches to the visited link.
    \ This reduces the chances that\n   prefixes specific to the Mobile Network will
    be leaked to the visited\n   network if routing protocol authentication is not
    enabled in the\n   visited network and in the Mobile Network.  It is expected
    that\n   normal deployment practices will include proper authentication\n   mechanisms
    to prevent unauthorized route announcements on both the\n   home and visited networks.
    \ The Mobile Router then starts sending\n   routing protocol messages through
    the bi-directional tunnel toward\n   the Home Agent.  Most routing protocols use
    link-local addresses as\n   source addresses for the routing information messages.
    \ The Mobile\n   Router is allowed to use link-local addresses for the inner IPv6\n
    \  header of an encapsulated packet.  But these MUST NOT be forwarded to\n   another
    link by either the Mobile Router or the Home Agent.\n   When the Home Agent receives
    the inner packet, it processes the\n   encapsulated routing protocol messages
    and updates its routing table\n   accordingly.  As part of normal routing protocol
    operation, the next\n   hop information in these routing entries is filled with
    the Mobile\n   Router's link-local address, with the outgoing interface set to
    the\n   bi-directional tunnel.\n   Similarly, the Home Agent sends routing updates
    through the bi-\n   directional tunnel to the Mobile Router.  The Mobile Router
    processes\n   these routing protocol messages and updates its routing table.  For\n
    \  all routes advertised by the Home Agent, the Mobile Router sets the\n   outgoing
    interface to the bi-directional tunnel to the Home Agent.\n   When the Mobile
    Router and the Home Agent exchange routes through a\n   dynamic routing protocol,
    the Mobile Router SHOULD NOT include Mobile\n   Network Prefixes in the Binding
    Update to the Home Agent.  Depending\n   on its configuration, the Home Agent
    might not add routes based on\n   the prefix information in the Binding Updates
    and might use only the\n   routing protocol updates.  Moreover, including prefix
    information in\n   both the Binding Updates and the routing protocol updates is\n
    \  redundant.\n   As the routing protocol messages from the Home Agent to the
    Mobile\n   Router could potentially contain information about the internal\n   routing
    structure of the home network, these messages require\n   authentication and confidentiality
    protection.  Appropriate\n   authentication and confidentiality protection mechanisms,
    defined in\n   [14], MUST be used.  For protecting routing protocol messages by\n
    \  using IPsec ESP [4], the bi-directional tunnel between the Mobile\n   Router
    and the Home Agent should be treated as the outgoing\n   interface, with the Home
    Agent and Mobile Router's addresses as\n   source and destination addresses for
    the inner encapsulated messages.\n   If a link state routing protocol such as
    OSPFv3 is run by the Mobile\n   Router and the Home Agent, the recommendations
    in Appendix B should\n   be followed.\n"
  title: 8.  Support for Dynamic Routing Protocols
- contents:
  - "9.  Security Considerations\n   All signaling messages between the Mobile Router
    and the Home Agent\n   MUST be authenticated by IPsec [8].  The use of IPsec to
    protect\n   Mobile IPv6 signaling messages is described in detail in the HA-MN\n
    \  IPsec specification [2].  The signaling messages described in this\n   document
    extend Mobile IPv6 messages and do not require any changes\n   to what is described
    in [2].\n   The Mobile Router has to perform ingress filtering on packets\n   received
    from the Mobile Network to ensure that nodes in the Mobile\n   Network do not
    use the bi-directional tunnel to launch IP spoofing\n   attacks.  In particular,
    the Mobile Router SHOULD check that the IP\n   source addresses in the packets
    received belong to the Mobile Network\n   Prefix and are not the same as one of
    the addresses used by the\n   Mobile Router.  If the Mobile Router receives an
    IP-in-IP tunneled\n   packet from a node in the Mobile Network and it has to forward
    the\n   decapsulated packet, it SHOULD perform the above mentioned checks on\n
    \  the source address of the inner packet.\n   The Home Agent has to verify that
    packets received through the bi-\n   directional tunnel belong to the Mobile Network.
    \ This check is\n   necessary to prevent nodes from using the Home Agent to launch\n
    \  attacks that would have otherwise been prevented by ingress\n   filtering.
    \ The source address of the outer IPv6 header MUST be set\n   to the Mobile Router's
    current Care-of Address.  The source address\n   of the inner IPv6 header MUST
    be topologically correct with respect\n   to the IPv6 prefixes used in the Mobile
    Network.\n   If the Mobile Router sends a Binding Update with a one or more Mobile\n
    \  Network Prefix options, the Home Agent MUST be able to verify that\n   the
    Mobile Router is authorized for the prefixes before setting up\n   forwarding
    for the prefixes.\n   When the Mobile Router runs a dynamic routing protocol as
    described\n   in section 8, it injects routing update messages into the Home Link.\n
    \  As the routing protocol message could contain information about the\n   internal
    routing structure of the home network, these messages\n   require confidentiality
    protection.  The Mobile Router SHOULD use\n   confidentiality protection through
    IPsec ESP as described in [14].\n   If the bi-directional tunnel between the Mobile
    Router and the Home\n   Agent is protected by ESP, in tunnel mode for all IP traffic,
    then no\n   additional confidentiality protection specific to the routing\n   protocol
    is required.\n   Home Agents and Mobile Routers may use IPsec ESP to protect payload\n
    \  packets tunneled between themselves.  This is useful to protect\n   communications
    against attackers on the path of the tunnel.\n   Please refer to the Mobile IPv6
    specification [1] for security\n   considerations when the Mobile Router operates
    as a Mobile Host.\n"
  title: 9.  Security Considerations
- contents:
  - "10.  IANA Considerations\n   This document defines a new Mobility Header Option,
    the Mobile\n   Network Prefix Option as described in section 4.3.  The type value\n
    \  for this option MUST be assigned from the same space used by the\n   mobility
    options defined in [1].\n   This document also defines the following new Binding
    Acknowledgement\n   status values.  These status values are defined in section
    4.2 and\n   MUST be assigned from the same space used for Binding Acknowledgement\n
    \  status values in [1].\n      -  Mobile Router Operation not permitted\n      -
    \ Invalid Prefix\n      -  Not Authorized for Prefix\n      -  Forwarding Setup
    failed (prefixes missing)\n"
  title: 10.  IANA Considerations
- contents:
  - "11.  Contributors\n   We would like to acknowledge Ludovic Bellier, Claude Castelluccia,\n
    \  Thierry Ernst [15], Miguel Catalina-Gallego, Christophe Janneteau,\n   T.J.
    \ Kniveton, Hong-Yon Lach, Jari T. Malinen, Koshiro Mitsuya,\n   Alexis Olivereau,
    Charles E. Perkins, and Keisuke Uehara for their\n   work on earlier proposals
    for Network Mobility.  This document has\n   inherited a lot of ideas from these
    proposals.\n"
  title: 11.  Contributors
- contents:
  - "12.  Acknowledgements\n   We thank all members of the NEMO Working Group, and
    of the preceding\n   MONET BoF, for fruitful discussions on the mailing list and
    at IETF\n   meetings.\n   Kent Leung, Marco Molteni, and Patrick Wetterwald are
    acknowledged\n   for their work on Network Mobility for IPv4 and IPv6.\n   Tim
    Leinmueller is acknowledged for many insightful remarks and for\n   section 7.\n
    \  Jari Arkko, James Kempf, Chan-Wah Ng, and Erik Nordmark are\n   acknowledged
    for their thorough review and comments.\n   Souhwan Jung, Fan Zhao, S. Felix Wu,
    HyunGon Kim, and SungWon Sohn\n   are acknowledged for identifying threats related
    to tunneling between\n   the Mobile Network and the Home Agent.\n"
  title: 12.  Acknowledgements
- contents:
  - '13.  References

    '
  - contents:
    - "13.1.  Normative References\n   [1]  Johnson, D., Perkins, C., and J. Arkko,
      \"Mobility Support in\n        IPv6\", RFC 3775, June 2004.\n   [2]  Arkko,
      J., Devarapalli, V., and F. Dupont, \"Using IPsec to\n        Protect Mobile
      IPv6 Signaling between Mobile Nodes and Home\n        Agents\", RFC 3776, June
      2004.\n   [3]  Conta, A. and S. Deering, \"Generic Packet Tunneling in IPv6\n
      \       Specification\", RFC 2473, December 1998.\n   [4]  Kent, S. and R. Atkinson,
      \"IP Encapsulating Security Payload\n        (ESP)\", RFC 2406, November 1998.\n
      \  [5]  Deering, S. and R. Hinden, \"Internet Protocol, Version 6 (IPv6)\n        Specification\",
      RFC 2460, December 1998.\n   [6]  Narten, T., Nordmark, E., and W. Simpson,
      \"Neighbor Discovery\n        for IP Version 6 (IPv6)\", RFC 2461, December
      1998.\n   [7]  Bradner, S., \"Key words for use in RFCs to Indicate Requirement\n
      \       Levels\", BCP 14, RFC 2119, March 1997.\n"
    title: 13.1.  Normative References
  - contents:
    - "13.2.  Informative References\n   [8]  Kent, S. and R. Atkinson, \"Security
      Architecture for the\n        Internet Protocol\", RFC 2401, November 1998.\n
      \  [9]  Manner, J. and M. Kojo, Eds., \"Mobility Related Terminology\",\n        RFC
      3753, June 2004.\n   [10] Ernst, T., and H.-Y. Lach, \"Network Mobility Support\n
      \       Terminology\", Work in Progress, October 2004.\n   [11] Ernst, T., \"Network
      Mobility Support Goals and Requirements\",\n        Work in Progress, October
      2004.\n   [12] Malkin, G. and R. Minnear, \"RIPng for IPv6\", RFC 2080, January\n
      \       1997.\n   [13] Coltun, R., Ferguson, D., and J. Moy, \"OSPF for IPv6\",
      RFC 2740,\n        December 1999.\n   [14] Gupta, M. and N. Melam, \"Authentication/Confidentiality
      for\n        OSPFv3\", Work in Progress, December 2004.\n   [15] Ernst, T.,
      \"Network Mobility Support in IPv6\", PhD Thesis,\n        University Joseph
      Fourier, Grenoble, France. October 2001.\n   [16] Moy, J., \"Extending OSPF
      to Support Demand Circuits\", RFC 1793,\n        April 1995.\n   [17] Thubert,
      P., et al., \"NEMO Home Network models\", Work in\n        Progress, October
      2004.\n"
    title: 13.2.  Informative References
  title: 13.  References
- contents:
  - "Appendix A.  Examples of NEMO Basic Support Operation\n   This section tries
    to illustrate the NEMO protocol by using a Mobile\n   Router and a Mobile Node
    belonging to different administrative\n   domains.  The Mobile Router's Mobile
    Network consists of a Local\n   Fixed Node (LFN) and a Local Fixed Router (LFR)
    [10].  The LFR has an\n   access link to which other Mobile Nodes or Mobile Routers
    could\n   attach.\n   Figure 1 depicts the scenario where both the Mobile Router
    and the\n   Mobile Node are at home.\n                +----+       +-------+\n
    \               | MN |       | HA_MN |\n                +--+-+  1::  +---+---+\n
    \                 2+-------------+3\n                                 |\n                                 |\n
    \  +-------+2 2:: +-------------------+ 3:: 2+-------+\n   | CN_MN |------|     Internet
    \     |------| CN_MR |\n   +-------+      +-------------------+      +-------+\n
    \                       4::      |\n                                 |\n                  2+-------------+3\n
    \               +--+-+       +---+---+\n                | MR |       | HA_MR |\n
    \               +--+-+       +-------+\n               5:: |1\n           ----------\n
    \          2|      |3\n       +--+-+   +--+-+\n       | LFN|   | LFR|\n       +--+-+
    \  +--+-+\n               6:: |1\n           ----------\n   Figure 1.  Mobile
    Router and Mobile Node at home.\n   The Mobile Router then moves away from the
    home link and attaches to\n   a visited link.  This is shown in Figure 2.  The
    Mobile Router sends\n   a Binding Update to HA_MR when it attaches to a visited
    link and\n   configures a Care-of Address.  HA_MR creates a binding cache entry\n
    \  for the Mobile Router's Home Address and also sets up forwarding for\n   the
    prefixes on the Mobile Network.\n                +----+       +-------+\n                |
    MN |       | HA_MN |\n                +--+-+  1::  +---+---+\n                  2+-------------+3\n
    \                                |\n                                 |\n   +-------+2
    2:: +-------------------+ 3:: 2+-------+\n   | CN_MN |------|     Internet      |------|
    CN_MR |\n   +-------+      ++------------------+      +-------+\n                   |
    7::     4:: |           4::2->7::2\n                   |             |\n                  2+
    \            +3\n                +--+-+       +---+---+\n                | MR
    |       | HA_MR | 4::2->7::2\n                +--+-+       +-------+ 5::/prefixlen
    -> forward\n               5:: |1                                   to MR\n           ----------
    \                 6::/prefixlen -> forward\n           2|      |3                                   to
    MR\n       +--+-+   +--+-+\n       | LFN|   | LFR|\n       +--+-+   +--+-+\n               6::
    |1\n           ----------\n   Figure 2.  Mobile Router on a visited link.\n   Figure
    3 shows the Mobile Node moving away from its home link and\n   attaching to the
    Mobile Router.  The Mobile Node configures a Care-of\n   Address from the prefix
    advertised on the Mobile Network and sends a\n   Binding Update to its Home Agent
    (HA_MN) and to its Correspondent\n   Node (CN_MN).  Both HA_MN and CN_MN create
    binding cache entries for\n   the Mobile Node's Home Address.\n                              +-------+\n
    \                             | HA_MN | 1::2->6::2\n                         1::
    \ +---+---+\n                         ---------|3\n                                  |\n
    \                                 |\n    +-------+2 2:: +-------------------+
    3:: 2+-------+\n    | CN_MN |------|     Internet      |------| CN_MR |\n    +-------+
    \     ++------------------+      +-------+\n   1::2->6::2       | 7::     4::
    |           4::2->7::2\n                    |             |\n                   2+
    \            +3\n                 +--+-+       +---+---+\n                 | MR
    |       | HA_MR | 4::2->7::2\n                 +--+-+       +-------+ 5::/prefixlen
    -> forward\n                5:: |1                                   to MR\n            ----------
    \                 6::/prefixlen -> forward\n            2|      |3                                   to
    MR\n        +--+-+   +--+-+\n        | LFN|   | LFR|\n        +--+-+   +--+-+\n
    \               6:: |1\n            --------+-\n                    |2\n                 +--+-+\n
    \                | MN |\n                 +----+\n       Figure 3.  Mobile Node
    attached to Mobile\n                  Router on a visited link\n"
  title: Appendix A.  Examples of NEMO Basic Support Operation
- contents:
  - "Appendix B.  Running Link State Routing Protocol with NEMO Basic Support\n   The
    bi-directional tunnel between the Mobile Router and the Home\n   Agent is used
    as a virtual interface over which routing protocol\n   messages are exchanged.
    \ When a link state routing protocol is run,\n   the following recommendations
    should be followed.\n"
  - contents:
    - "B.1.  Tunnel Interface Considerations\n   If the tunnel interface goes up and
      down every time the Mobile Router\n   moves to a new visited network with a
      high level of mobility and a\n   sufficient number of Mobile Routers, the amount
      of interface state\n   changes will adversely affect the Home Agent's performance.
      \ This\n   also introduces a high level of instability in the home network.
      \ To\n   avoid this, the following should be considered when the bi-\n   directional
      tunnel is implemented:\n   -  A tunnel interface is consistently assigned to
      each Mobile Router,\n      as long as it has a valid binding cache at the Home
      Agent.\n   -  Every time the Mobile Router moves and updates the binding cache\n
      \     entry, the bi-directional tunnel should not be torn down and set\n      up
      again.  The tunnel end points should be updated dynamically\n      with the
      Mobile Router's current Care-of Address.\n   -  With a large number of interfaces,
      Hello packet processing may\n      become a burden.  Therefore, the tunnel interface
      should be\n      treated as On-Demand circuits for OSPF [16].\n"
    title: B.1.  Tunnel Interface Considerations
  - contents:
    - "B.2.  OSPF Area Considerations\n   The following should be considered when
      the Home Network is\n   configured for running OSPF:\n   -  The entire Home
      domain SHOULD NOT be configured as a single area\n      if a Home Agent supports
      Mobile Routers.  At least the home\n      network should be configured as a
      separate area.\n   -  The bi-directional tunnel interfaces to the Mobile Routers
      should\n      never be included in the same area as the backbone links.\n   For
      a more detailed discussion on configuring a home network for NEMO\n   Basic
      Support, please see [17].\n   One disadvantage of running OSPFv3 with NEMO Basic
      Support is the\n   possibility that the Mobile Networks will be told of the
      topology of\n   the entire home network, including all the fixed and Mobile
      Routers.\n   The only thing the Mobile Routers might really need is a default\n
      \  route through the Home Agent.\n   To reduce the amount of routing protocol
      messages received by a\n   Mobile Router, one can configure each bi-directional
      tunnel to a\n   Mobile Router as a separate area.  But this requires that the
      Home\n   Agent support a large number of OSPF areas if it supports a large\n
      \  number of Mobile Routers, and it might not be possible with most\n   router
      implementations.\n   Another option is to configure multiple areas on the Home
      Link and\n   group a number of Mobile Routers into each area.  This reduces
      the\n   number of areas that a Home Agent needs to support but also reduces\n
      \  the amount of routing protocol traffic that a Mobile Router receives.\n"
    title: B.2.  OSPF Area Considerations
  title: Appendix B.  Running Link State Routing Protocol with NEMO Basic Support
- contents:
  - "Authors' Addresses\n   Vijay Devarapalli\n   Nokia Research Center\n   313 Fairchild
    Drive\n   Mountain View, CA 94043\n   USA\n   EMail:  vijay.devarapalli@nokia.com\n
    \  Ryuji Wakikawa\n   Keio University and WIDE\n   5322 Endo Fujisawa Kanagawa\n
    \  252-8520\n   Japan\n   EMail:  ryuji@sfc.wide.ad.jp\n   Alexandru Petrescu\n
    \  Motorola Labs\n   Parc les Algorithmes Saint Aubin\n   Gif-sur-Yvette 91193\n
    \  France\n   EMail:  Alexandru.Petrescu@motorola.com\n   Pascal Thubert\n   Cisco
    Systems Technology Center\n   Village d'Entreprises Green Side\n   400, Avenue
    Roumanille\n   Biot - Sophia Antipolis 06410\n   France\n   EMail:  pthubert@cisco.com\n"
  title: Authors' Addresses
- contents:
  - "Full Copyright Statement\n   Copyright (C) The Internet Society (2005).\n   This
    document is subject to the rights, licenses and restrictions\n   contained in
    BCP 78, and except as set forth therein, the authors\n   retain all their rights.\n
    \  This document and the information contained herein are provided on an\n   \"AS
    IS\" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS\n   OR IS SPONSORED
    BY (IF ANY), THE INTERNET SOCIETY AND THE INTERNET\n   ENGINEERING TASK FORCE
    DISCLAIM ALL WARRANTIES, EXPRESS OR IMPLIED,\n   INCLUDING BUT NOT LIMITED TO
    ANY WARRANTY THAT THE USE OF THE\n   INFORMATION HEREIN WILL NOT INFRINGE ANY
    RIGHTS OR ANY IMPLIED\n   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
    PURPOSE.\n"
  title: Full Copyright Statement
- contents:
  - "Intellectual Property\n   The IETF takes no position regarding the validity or
    scope of any\n   Intellectual Property Rights or other rights that might be claimed
    to\n   pertain to the implementation or use of the technology described in\n   this
    document or the extent to which any license under such rights\n   might or might
    not be available; nor does it represent that it has\n   made any independent effort
    to identify any such rights.  Information\n   on the IETF's procedures with respect
    to rights in IETF Documents can\n   be found in BCP 78 and BCP 79.\n   Copies
    of IPR disclosures made to the IETF Secretariat and any\n   assurances of licenses
    to be made available, or the result of an\n   attempt made to obtain a general
    license or permission for the use of\n   such proprietary rights by implementers
    or users of this\n   specification can be obtained from the IETF on-line IPR repository
    at\n   http://www.ietf.org/ipr.\n   The IETF invites any interested party to bring
    to its attention any\n   copyrights, patents or patent applications, or other
    proprietary\n   rights that may cover technology that may be required to implement\n
    \  this standard.  Please address the information to the IETF at ietf-\n   ipr@ietf.org.\n"
  title: Intellectual Property
- contents:
  - "Acknowledgement\n   Funding for the RFC Editor function is currently provided
    by the\n   Internet Society.\n"
  title: Acknowledgement
