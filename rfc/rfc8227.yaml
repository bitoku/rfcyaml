- title: __initial_text__
  contents:
  - '   MPLS-TP Shared-Ring Protection (MSRP) Mechanism for Ring Topology

    '
- title: Abstract
  contents:
  - "Abstract\n   This document describes requirements, architecture, and solutions\
    \ for\n   MPLS-TP Shared-Ring Protection (MSRP) in a ring topology for point-\n\
    \   to-point (P2P) services.  The MSRP mechanism is described to meet the\n  \
    \ ring protection requirements as described in RFC 5654.  This document\n   defines\
    \ the Ring Protection Switching (RPS) protocol that is used to\n   coordinate\
    \ the protection behavior of the nodes on an MPLS ring.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This\
    \ document is a product of the Internet Engineering Task Force\n   (IETF).  It\
    \ represents the consensus of the IETF community.  It has\n   received public\
    \ review and has been approved for publication by the\n   Internet Engineering\
    \ Steering Group (IESG).  Further information on\n   Internet Standards is available\
    \ in Section 2 of RFC 7841.\n   Information about the current status of this document,\
    \ any errata,\n   and how to provide feedback on it may be obtained at\n   http://www.rfc-editor.org/info/rfc8227.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2017 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (http://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.  Code Components\
    \ extracted from this document must\n   include Simplified BSD License text as\
    \ described in Section 4.e of\n   the Trust Legal Provisions and are provided\
    \ without warranty as\n   described in the Simplified BSD License.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1.  Introduction  . . . . . . . . . . . . . . . . . . .\
    \ . . . . .   4\n     1.1.  Requirements Language . . . . . . . . . . . . . .\
    \ . . . .   4\n   2.  Terminology and Notation  . . . . . . . . . . . . . . .\
    \ . . .   4\n   3.  MPLS-TP Ring Protection Criteria and Requirements . . . .\
    \ . .   5\n   4.  Shared-Ring Protection Architecture . . . . . . . . . . . .\
    \ .   6\n     4.1.  Ring Tunnel . . . . . . . . . . . . . . . . . . . . . . .\
    \   6\n       4.1.1.  Establishment of the Ring Tunnel  . . . . . . . . . .  \
    \ 8\n       4.1.2.  Label Assignment and Distribution . . . . . . . . . .   9\n\
    \       4.1.3.  Forwarding Operation  . . . . . . . . . . . . . . . .   9\n  \
    \   4.2.  Failure Detection . . . . . . . . . . . . . . . . . . . .  10\n    \
    \ 4.3.  Ring Protection . . . . . . . . . . . . . . . . . . . . .  11\n      \
    \ 4.3.1.  Wrapping  . . . . . . . . . . . . . . . . . . . . . .  12\n       4.3.2.\
    \  Short-Wrapping  . . . . . . . . . . . . . . . . . . .  14\n       4.3.3.  Steering\
    \  . . . . . . . . . . . . . . . . . . . . . .  17\n     4.4.  Interconnected\
    \ Ring Protection  . . . . . . . . . . . . .  21\n       4.4.1.  Interconnected\
    \ Ring Topology  . . . . . . . . . . . .  21\n       4.4.2.  Interconnected Ring\
    \ Protection Mechanisms . . . . . .  22\n       4.4.3.  Ring Tunnels in Interconnected\
    \ Rings  . . . . . . . .  23\n       4.4.4.  Interconnected Ring-Switching Procedure\
    \ . . . . . . .  25\n       4.4.5.  Interconnected Ring Detection Mechanism .\
    \ . . . . . .  26\n   5.  Ring Protection Coordination Protocol . . . . . . .\
    \ . . . . .  27\n     5.1.  RPS and PSC Comparison on Ring Topology . . . . .\
    \ . . . .  27\n     5.2.  RPS Protocol  . . . . . . . . . . . . . . . . . . .\
    \ . . .  28\n       5.2.1.  Transmission and Acceptance of RPS Requests . . .\
    \ . .  30\n       5.2.2.  RPS Protocol Data Unit (PDU) Format . . . . . . . .\
    \ .  31\n       5.2.3.  Ring Node RPS States  . . . . . . . . . . . . . . . .\
    \  32\n       5.2.4.  RPS State Transitions . . . . . . . . . . . . . . . .  34\n\
    \     5.3.  RPS State Machine . . . . . . . . . . . . . . . . . . . .  36\n  \
    \     5.3.1.  Switch Initiation Criteria  . . . . . . . . . . . . .  36\n    \
    \   5.3.2.  Initial States  . . . . . . . . . . . . . . . . . . .  39\n      \
    \ 5.3.3.  State Transitions When Local Request Is Applied . . .  40\n       5.3.4.\
    \  State Transitions When Remote Request is Applied  . .  44\n       5.3.5.  State\
    \ Transitions When Request Addresses to Another\n               Node is Received\
    \  . . . . . . . . . . . . . . . . . .  47\n   6.  IANA Considerations . . . .\
    \ . . . . . . . . . . . . . . . . .  51\n     6.1.  G-ACh Channel Type  . . .\
    \ . . . . . . . . . . . . . . . .  51\n     6.2.  RPS Request Codes . . . . .\
    \ . . . . . . . . . . . . . . .  51\n   7.  Operational Considerations  . . .\
    \ . . . . . . . . . . . . . .  52\n   8.  Security Considerations . . . . . .\
    \ . . . . . . . . . . . . .  52\n   9.  References  . . . . . . . . . . . . .\
    \ . . . . . . . . . . . .  53\n     9.1.  Normative References  . . . . . . .\
    \ . . . . . . . . . . .  53\n     9.2.  Informative References  . . . . . . .\
    \ . . . . . . . . . .  54\n   Acknowledgements  . . . . . . . . . . . . . . .\
    \ . . . . . . . . .  55\n   Contributors  . . . . . . . . . . . . . . . . . .\
    \ . . . . . . . .  55\n   Authors' Addresses  . . . . . . . . . . . . . . . .\
    \ . . . . . . .  56\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   As described in Section 2.5.6.1 of [RFC5654], several service\n\
    \   providers have expressed much interest in operating an MPLS Transport\n  \
    \ Profile (MPLS-TP) in ring topologies and require a high-level\n   survivability\
    \ function in these topologies.  In operational transport\n   network deployment,\
    \ MPLS-TP networks are often constructed using ring\n   topologies.  This calls\
    \ for an efficient and optimized ring\n   protection mechanism to achieve simple\
    \ operation and fast, sub 50 ms,\n   recovery performance.\n   This document specifies\
    \ an MPLS-TP Shared-Ring Protection mechanism\n   that meets the criteria for\
    \ ring protection and the ring protection\n   requirements described in Section\
    \ 2.5.6.1 of [RFC5654].\n   The basic concept and architecture of the MPLS-TP\
    \ Shared-Ring\n   Protection mechanism are specified in this document.  This document\n\
    \   describes the solutions for point-to-point transport paths.  While\n   the\
    \ basic concept may also apply to point-to-multipoint transport\n   paths, the\
    \ solution for point-to-multipoint transport paths is out of\n   the scope of\
    \ this document.\n"
- title: 1.1.  Requirements Language
  contents:
  - "1.1.  Requirements Language\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\"\
    , \"SHALL\", \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"\
    NOT RECOMMENDED\", \"MAY\", and\n   \"OPTIONAL\" in this document are to be interpreted\
    \ as described in BCP\n   14 [RFC2119] [RFC8174] when, and only when, they appear\
    \ in all\n   capitals, as shown here.\n"
- title: 2.  Terminology and Notation
  contents:
  - "2.  Terminology and Notation\n   Terminology:\n   Ring node:  All nodes in the\
    \ ring topology are ring nodes, and they\n      MUST actively participate in the\
    \ ring protection.\n   Ring tunnel:  A ring tunnel provides a server layer for\
    \ the Label\n      Switched Paths (LSPs) traversing the ring.  The notation used\
    \ for\n      a ring tunnel is: R<d><p><X> where <d> = c (clockwise) or a\n   \
    \   (anticlockwise), <p> = W (working) or P (protecting), and <X> =\n      the\
    \ node name.\n   Ring map:  A ring map is present in each ring node.  The ring\
    \ map\n      contains the ring topology information, i.e., the nodes in the\n\
    \      ring, the adjacency of the ring nodes, and the status of the links\n  \
    \    between ring nodes (Intact or Severed).  The ring map is used by\n      every\
    \ ring node to determine the switchover behavior of the ring\n      tunnels.\n\
    \   Notation:\n   The following syntax will be used to describe the contents of\
    \ the\n   label stack:\n   1.  The label stack will be enclosed in square brackets\
    \ (\"[]\").\n   2.  Each level in the stack will be separated by the '|' character.\n\
    \       It should be noted that the label stack may contain additional\n     \
    \  layers.  However, we only present the layers that are related to\n       the\
    \ protection mechanism.\n   3.  If the label is assigned by Node X, the Node Name\
    \ is enclosed in\n       parentheses (\"()\").\n"
- title: 3.  MPLS-TP Ring Protection Criteria and Requirements
  contents:
  - "3.  MPLS-TP Ring Protection Criteria and Requirements\n   The generic requirements\
    \ for MPLS-TP protection are specified in\n   [RFC5654].  The requirements specific\
    \ for ring protection are\n   specified in Section 2.5.6.1 of [RFC5654].  This\
    \ section describes\n   how the criteria for ring protection are met:\n   a. \
    \ The number of Operations, Administration, and Maintenance (OAM)\n       entities\
    \ needed to trigger protection\n       Each ring node requires only one instance\
    \ of the RPS protocol per\n       ring.  The OAM of the links connected to the\
    \ adjacent ring nodes\n       has to be forwarded to only this instance in order\
    \ to trigger\n       protection.  For detailed information, see Section 5.2.\n\
    \   b.  The number of elements of recovery in the ring\n       Each ring node\
    \ requires only one instance of the RPS protocol and\n       is independent of\
    \ the number of LSPs that are protected.  For\n       detailed information, see\
    \ Section 5.2.\n   c.  The required number of labels required for the protection\
    \ paths\n       The RPS protocol uses ring tunnels, and each tunnel has a set\
    \ of\n       labels.  The number of ring tunnel labels is related to the\n   \
    \    number of ring nodes and is independent of the number of\n       protected\
    \ LSPs.  For detailed information, see Section 4.1.2.\n   d.  The amount of control\
    \ and management-plane transactions\n       Each ring node requires only one instance\
    \ of the RPS protocol per\n       ring.  This means that only one maintenance\
    \ operation is required\n       per ring node.  For detailed information, see\
    \ Section 5.2.\n   e.  Minimize the signaling and routing information exchange\
    \ during\n       protection\n       Information exchange during a protection switch\
    \ is using the\n       in-band RPS and OAM messages.  No control-plane interactions\
    \ are\n       required.  For detailed information, see Section 5.2.\n"
- title: 4.  Shared-Ring Protection Architecture
  contents:
  - '4.  Shared-Ring Protection Architecture

    '
- title: 4.1.  Ring Tunnel
  contents:
  - "4.1.  Ring Tunnel\n   This document introduces a new logical layer of the ring\
    \ for shared-\n   ring protection in MPLS-TP networks.  As shown in Figure 1,\
    \ the new\n   logical layer consists of ring tunnels that provide a server layer\n\
    \   for the LSPs traversing the ring.  Once a ring tunnel is established,\n  \
    \ the forwarding and protection switching of the ring are all performed\n   at\
    \ the ring tunnel level.  A port can carry multiple ring tunnels,\n   and a ring\
    \ tunnel can carry multiple LSPs.\n                                          \
    \    +-------------\n                                +-------------|\n       \
    \           +-------------|             |\n    ===Service1===|             | \
    \            |\n    ===Service2===|    LSP1     |             |\n            \
    \      +-------------|             |\n                                |Ring-Tunnel1\
    \ |\n                  +-------------|             |\n    ===Service3===|    \
    \         |             |\n    ===Service4===|    LSP2     |             |\n \
    \                 +-------------|             |\n                            \
    \    +-------------|  Physical\n                                +-------------|\n\
    \                  +-------------|             |    Port\n    ===Service5===|\
    \             |             |\n    ===Service6===|    LSP3     |             |\n\
    \                  +-------------|             |\n                           \
    \     |Ring-Tunnel2 |\n                  +-------------|             |\n    ===Service7===|\
    \             |             |\n    ===Service8===|    LSP4     |             |\n\
    \                  +-------------|             |\n                           \
    \     +-------------|\n                                              +-------------\n\
    \                 Figure 1: The Logical Layers of the Ring\n   The label stack\
    \ used in the MPLS-TP Shared-Ring Protection mechanism\n   is [Ring Tunnel Label|LSP\
    \ Label|Service Label](Payload) as\n   illustrated in Figure 2.\n            \
    \       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n                   |        \
    \   Ring Tunnel Label         |\n                   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \                   |               LSP Label             |\n                \
    \   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n                   |            \
    \ Service Label           |\n                   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \                   |                Payload              |\n                \
    \   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n       Figure 2: Label Stack Used\
    \ in MPLS-TP Shared-Ring Protection\n"
- title: 4.1.1.  Establishment of the Ring Tunnel
  contents:
  - "4.1.1.  Establishment of the Ring Tunnel\n   The Ring tunnels are established\
    \ based on the egress nodes.  The\n   egress node is the node where traffic leaves\
    \ the ring.  LSPs that\n   have the same egress node on the ring and travel along\
    \ the ring in\n   the same direction (clockwise or anticlockwise) share the same\
    \ ring\n   tunnels.  In other words, all the LSPs that traverse the ring in the\n\
    \   same direction and exit from the same node share the same working\n   ring\
    \ tunnel and protection ring tunnel.  For each egress node, four\n   ring tunnels\
    \ are established:\n   o  one clockwise working ring tunnel, which is protected\
    \ by the\n      anticlockwise protection ring tunnel\n   o  one anticlockwise\
    \ protection ring tunnel\n   o  one anticlockwise working ring tunnel, which is\
    \ protected by the\n      clockwise protection ring tunnel\n   o  one clockwise\
    \ protection ring tunnel\n   The structure of the protection tunnels is determined\
    \ by the selected\n   protection mechanism.  This will be detailed in subsequent\
    \ sections.\n   As shown in Figure 3, LSP1, LSP2, and LSP3 enter the ring from\
    \ Node\n   E, Node A, and Node B, respectively, and all leave the ring at Node\n\
    \   D.  To protect these LSPs that traverse the ring, a clockwise working\n  \
    \ ring tunnel (RcW_D) via E->F->A->B->C->D and its anticlockwise\n   protection\
    \ ring tunnel (RaP_D) via D->C->B->A->F->E->D are\n   established.  Also, an anticlockwise\
    \ working ring tunnel (RaW_D) via\n   C->B->A->F->E->D and its clockwise protection\
    \ ring tunnel (RcP_D) via\n   D->E->F->A->B->C->D are established.  For simplicity,\
    \ Figure 3 only\n   shows RcW_D and RaP_D.  A similar provisioning should be applied\
    \ for\n   any other node on the ring.  In summary, for each node in Figure 3,\n\
    \   when acting as an egress node, the ring tunnels are created as\n   follows:\n\
    \   o  To Node A: RcW_A, RaW_A, RcP_A, RaP_A\n   o  To Node B: RcW_B, RaW_B, RcP_B,\
    \ RaP_B\n   o  To Node C: RcW_C, RaW_C, RcP_C, RaP_C\n   o  To Node D: RcW_D,\
    \ RaW_D, RcP_D, RaP_D\n   o  To Node E: RcW_E, RaW_E, RcP_E, RaP_E\n   o  To Node\
    \ F: RcW_F, RaW_F, RcP_F, RaP_F\n                       +---+#############+---+\n\
    \                       | F |-------------| A | +-- LSP2\n                   \
    \    +---+*************+---+\n                       #/*                   *\\\
    #\n                      #/*                     *\\#\n                     #/*\
    \                       *\\#\n                   +---+                     +---+\n\
    \          LSP1 --+ | E |                     | B |+-- LSP3\n                \
    \   +---+                     +---+\n                     #\\                \
    \       */#\n                      #\\                     */#\n             \
    \          #\\                   */#\n                       +---+*************+---+\n\
    \               LSP1 +--| D |-------------| C |\n               LSP2    +---+#############+---+\n\
    \               LSP3\n                         ----- Physical Links\n        \
    \                 ***** RcW_D\n                         ##### RaP_D\n        \
    \              Figure 3: Ring Tunnels in MSRP\n   Through these working and protection\
    \ ring tunnels, LSPs that enter\n   the ring from any node can reach any egress\
    \ nodes on the ring and are\n   protected from failures on the ring.\n"
- title: 4.1.2.  Label Assignment and Distribution
  contents:
  - "4.1.2.  Label Assignment and Distribution\n   The ring tunnel labels are downstream-assigned\
    \ labels as defined in\n   [RFC3031].  The ring tunnel labels on each hop of the\
    \ ring tunnel can\n   be either configured statically, provisioned by a controller,\
    \ or\n   distributed dynamically via a control protocol.  For an LSP that\n  \
    \ traverses the ring tunnel, the ingress ring node and the egress ring\n   node\
    \ are considered adjacent at the LSP layer, and LSP label needs to\n   be allocated\
    \ at these two ring nodes.  The control plane for label\n   distribution is outside\
    \ the scope of this document.\n"
- title: 4.1.3.  Forwarding Operation
  contents:
  - "4.1.3.  Forwarding Operation\n   When an MPLS-TP transport path, i.e., an LSP,\
    \ enters the ring, the\n   ingress node on the ring pushes the working ring tunnel\
    \ label that is\n   used to reach the specific egress node and sends the traffic\
    \ to the\n   next hop.  The transit nodes on the working ring tunnel swap the\
    \ ring\n   tunnel labels and forward the packets to the next hop.  When the\n\
    \   packet arrives at the egress node, the egress node pops the ring\n   tunnel\
    \ label and forwards the packets based on the inner LSP label\n   and service\
    \ label.  Figure 4 shows the label operation in the MPLS-TP\n   Shared-Ring Protection\
    \ mechanism.  Assume that LSP1 enters the ring\n   at Node A and exits from Node\
    \ D, and the following label operations\n   are executed.\n   1.  Ingress node:\
    \ Packets of LSP1 arrive at Node A with a label stack\n       [LSP1] and are supposed\
    \ to be forwarded in the clockwise\n       direction of the ring.  The label of\
    \ the clockwise working ring\n       tunnel RcW_D will be pushed at Node A, the\
    \ label stack for the\n       forwarded packet at Node A is changed to [RcW_D(B)|LSP1].\n\
    \   2.  Transit nodes: In this case, Nodes B and C forward the packets by\n  \
    \     swapping the working ring tunnel labels.  For example, the label\n     \
    \  [RcW_D(B)|LSP1] is swapped to [RcW_D(C)|LSP1] at Node B.\n   3.  Egress node:\
    \ When the packet arrives at Node D (i.e., the egress\n       node) with label\
    \ stack [RcW_D(D)|LSP1], Node D pops RcW_D(D) and\n       subsequently deals with\
    \ the inner labels of LSP1.\n                      +---+#####[RaP_D(F)]######+---+\n\
    \                      | F |---------------------| A | +-- LSP1\n            \
    \          +---+*****[RcW_D(A)]******+---+\n                       #/*       \
    \                 *\\#\n            [RaP_D(E)]#/*[RcW_D(F)]      [RcW_D(B)]*\\\
    #[RaP_D(A)]\n                     #/*                            *\\#\n      \
    \             +---+                          +---+\n                   | E | \
    \                         | B |\n                   +---+                    \
    \      +---+\n                     #\\                            */#\n      \
    \      [RaP_D(D)]#\\                [RxW_D(C)]*/#[RaP_D(B)]\n                \
    \       #\\                        */#\n                       +---+*****[RcW_D(D)]****+---+\n\
    \             LSP1  +-- | D |-------------------| C |\n                      \
    \ +---+#####[RaP_D(C)]####+---+\n                            ----- Physical Links\n\
    \                            ***** RcW_D\n                            ##### RaP_D\n\
    \                     Figure 4: Label Operation of MSRP\n"
- title: 4.2.  Failure Detection
  contents:
  - "4.2.  Failure Detection\n   The MPLS-TP section-layer OAM is used to monitor\
    \ the connectivity\n   between each two adjacent nodes on the ring using the mechanisms\n\
    \   defined in [RFC6371].  Protection switching is triggered by the\n   failure\
    \ detected on the ring by the OAM mechanisms.\n   Two ports of a link form a Maintenance\
    \ Entity Group (MEG), and a MEG\n   End Point (MEP) function is installed in each\
    \ ring port.  Continuity\n   Check (CC) OAM packets are periodically exchanged\
    \ between each pair\n   of MEPs to monitor the link health.  Three consecutive\
    \ lost CC\n   packets MUST be interpreted as a link failure.\n   A node failure\
    \ is regarded as the failure of two links attached to\n   that node.  The two\
    \ nodes adjacent to the failed node detect the\n   failure in the links that are\
    \ connected to the failed node.\n"
- title: 4.3.  Ring Protection
  contents:
  - "4.3.  Ring Protection\n   This section specifies the ring protection mechanisms\
    \ in detail.  In\n   general, the description uses the clockwise working ring\
    \ tunnel and\n   the corresponding anticlockwise protection ring tunnel as an\
    \ example,\n   but the mechanism is applicable in the same way to the anticlockwise\n\
    \   working and clockwise protection ring tunnels.\n   In a ring network, each\
    \ working ring tunnel is associated with a\n   protection ring tunnel in the opposite\
    \ direction, and every node MUST\n   obtain the ring topology either by configuration\
    \ or via a topology\n   discovery mechanism.  The ring topology and the connectivity\
    \ (Intact\n   or Severed) between two adjacent ring nodes form the ring map. \
    \ Each\n   ring node maintains the ring map and uses it to perform ring\n   protection\
    \ switching.\n   Taking the topology in Figure 4 as an example, LSP1 enters the\
    \ ring\n   at Node A and leaves the ring at Node D.  In normal state, LSP1 is\n\
    \   carried by the clockwise working ring tunnel (RcW_D) through the path\n  \
    \ A->B->C->D.  The label operation is:\n   [LSP1](Payload) -> [RCW_D(B)|LSP1](NodeA)\
    \ -> [RCW_D(C)|LSP1](NodeB)\n   -> [RCW_D(D)| LSP1](NodeC) -> [LSP1](Payload).\n\
    \   Then at Node D, the packet will be forwarded based on the label stack\n  \
    \ of LSP1.\n   Three typical ring protection mechanisms are described in this\n\
    \   section: wrapping, short-wrapping, and steering.  All nodes on the\n   same\
    \ ring MUST use the same protection mechanism.  If the RPS\n   protocol in any\
    \ node detects an RPS message with a protection-\n   switching mode that was not\
    \ provisioned in that node, a failure of\n   protocol will be reported, and the\
    \ protection mechanism will not be\n   activated.\n   Wrapping ring protection:\
    \ the node that detects a failure or accepts\n   a switch request switches the\
    \ traffic impacted by the failure or the\n   switch request to the opposite direction\
    \ (away from the failure).  In\n   this way, the impacted traffic is switched\
    \ to the protection ring\n   tunnel by the switching node upstream of the failure,\
    \ then it travels\n   around the ring to the switching node downstream of the\
    \ failure\n   through the protection ring tunnel, where it is switched back onto\n\
    \   the working ring tunnel to reach the egress node.\n   Short-wrapping ring\
    \ protection provides some optimization to wrapping\n   protection, in which the\
    \ impacted traffic is only switched once to\n   the protection ring tunnel by\
    \ the switching node upstream to the\n   failure.  At the egress node, the traffic\
    \ leaves the ring from the\n   protection ring tunnel.  This can reduce the traffic\
    \ detour of\n   wrapping protection.\n   Steering ring protection implies that\
    \ the node that detects a failure\n   sends a request along the ring to the other\
    \ node adjacent to the\n   failure, and all nodes in the ring process this information.\
    \  For the\n   impacted traffic, the ingress node (which adds traffic to the ring)\n\
    \   performs switching of the traffic from working to the protection ring\n  \
    \ tunnel, and the egress node will drop the traffic received from the\n   protection\
    \ ring tunnel.\n   The following sections describe these protection mechanisms\
    \ in\n   detail.\n"
- title: 4.3.1.  Wrapping
  contents:
  - "4.3.1.  Wrapping\n   With the wrapping mechanism, the protection ring tunnel\
    \ is a closed\n   ring identified by the egress node.  As shown in Figure 4, the\
    \ RaP_D\n   is the anticlockwise protection ring tunnel for the clockwise working\n\
    \   ring tunnel RcW_D.  As specified in the following sections, the\n   closed\
    \ ring protection tunnel can protect both link failures and node\n   failures.\
    \  Wrapping can be applicable for the protection of\n   Point-to-Multipoint (P2MP)\
    \ LSPs on the ring; the details of which are\n   outside the scope of this document.\n"
- title: 4.3.1.1.  Wrapping for Link Failure
  contents:
  - "4.3.1.1.  Wrapping for Link Failure\n   When a link failure between Nodes B and\
    \ C occurs, if it is a\n   bidirectional failure, both Nodes B and C can detect\
    \ the failure via\n   the OAM mechanism; if it is a unidirectional failure, one\
    \ of the two\n   nodes would detect the failure via the OAM mechanism.  In both\
    \ cases,\n   the node at the other side of the detected failure will be determined\n\
    \   by the ring map and informed using the RPS protocol, which is\n   specified\
    \ in Section 5.  Then Node B switches the clockwise working\n   ring tunnel (RcW_D)\
    \ to the anticlockwise protection ring tunnel\n   (RaP_D), and Node C switches\
    \ the anticlockwise protection ring tunnel\n   (RaP_D) back to the clockwise working\
    \ ring tunnel (RcW_D).  The\n   payload that enters the ring at Node A and leaves\
    \ the ring at Node D\n   follows the path A->B->A->F->E->D->C->D.  The label operation\
    \ is:\n   [LSP1](Payload) -> [RcW_D(B)|LSP1](Node A) -> [RaP_D(A)|LSP1](Node B)\n\
    \   -> [RaP_D(F)|LSP1](Node A) -> [RaP_D(E)|LSP1] (Node F) ->\n   [RaP_D(D)|LSP1]\
    \ (Node E) -> [RaP_D(C)|LSP1] (Node D) ->\n   [RcW_D(D)|LSP1](Node C) -> [LSP1](Payload).\n\
    \                      +---+#####[RaP_D(F)]######+---+\n                     \
    \ | F |---------------------| A | +-- LSP1\n                      +---+*****[RcW_D(A)]******+---+\n\
    \                      #/*                        *\\#\n           [RaP_D(E)]#/*[RcW_D(F)]\
    \      [RcW_D(B)]*\\#RaP_D(A)\n                    #/*                       \
    \     *\\#\n                  +---+                          +---+\n         \
    \         | E |                          | B |\n                  +---+      \
    \                    +---+\n                    #\\                          \
    \  *x#\n           [RaP_D(D)]#\\                [RcW_D(C)]*x#RaP_D(B)\n      \
    \                #\\                        *x#\n                      +---+*****[RcW_D(D)]****+---+\n\
    \            LSP1  +-- | D |-------------------| C |\n                      +---+#####[RaP_D(C)]####+---+\n\
    \                 ----- Physical Links    xxxxx Failure Links\n              \
    \   ***** RcW_D             ##### RaP_D\n                    Figure 5: Wrapping\
    \ for Link Failure\n"
- title: 4.3.1.2.  Wrapping for Node Failure
  contents:
  - "4.3.1.2.  Wrapping for Node Failure\n   As shown in Figure 6, when Node B fails,\
    \ Node A detects the failure\n   between A and B and switches the clockwise working\
    \ ring tunnel\n   (RcW_D) to the anticlockwise protection ring tunnel (RaP_D);\
    \ Node C\n   detects the failure between C and B and switches the anticlockwise\n\
    \   protection ring tunnel (RaP_D) to the clockwise working ring tunnel\n   (RcW_D).\
    \  The node at the other side of the failed node will be\n   determined by the\
    \ ring map and informed using the RPS protocol\n   specified in Section 5.\n \
    \  The payload that enters the ring at Node A and exits at Node D\n   follows\
    \ the path A->F->E->D->C->D.  The label operation is:\n   [LSP1](Payload)-> [RaP_D(F)|LSP1](NodeA)\
    \ -> [RaP_D(E)|LSP1](NodeF) ->\n   [RaP_D(D)|LSP1](NodeE) -> [RaP_D(C)|LSP1] (NodeD)\
    \ -> [RcW_D(D)|LSP1]\n   (NodeC) -> [LSP1](Payload).\n   In one special case where\
    \ Node D fails, all the ring tunnels with\n   Node D as the egress will become\
    \ unusable.  The ingress node will\n   update its ring map according to received\
    \ RPS messages and determine\n   that the egress node is not reachable; thus,\
    \ it will not send traffic\n   to either the working or the protection tunnel.\
    \  However, before the\n   failure location information is propagated to all the\
    \ ring nodes, the\n   wrapping protection mechanism may cause a temporary traffic\
    \ loop:\n   Node C detects the failure and switches the traffic from the\n   clockwise\
    \ working ring tunnel (RcW_D) to the anticlockwise protection\n   ring tunnel\
    \ (RaP_D); Node E also detects the failure and switches the\n   traffic from the\
    \ anticlockwise protection ring tunnel (RaP_D) back to\n   the clockwise working\
    \ ring tunnel (RcW_D).  A possible mechanism to\n   mitigate the temporary loop\
    \ problem is: the TTL of the ring tunnel\n   label is set to 2*N by the ingress\
    \ ring node of the traffic, where N\n   is the number of nodes on the ring.\n\
    \                         +---+#####[RaP_D(F)]######+---+\n                  \
    \       | F |---------------------| A | +-- LSP1\n                         +---+*****[RcW_D(A)]******+---+\n\
    \                         #/*                        *\\#\n              [RaP_D(E)]#/*[RcW_D(F)]\
    \      [RcW_D(B)]*\\#RaP_D(A)\n                       #/*                    \
    \        *\\#\n                     +---+                          xxxxx\n   \
    \                  | E |                          x B x\n                    \
    \ +---+                          xxxxx\n                       #\\           \
    \                 */#\n              [RaP_D(D)]#\\                [RcW_D(C)]*/#RaP_D(B)\n\
    \                         #\\                       */#\n                    \
    \     +---+*****[RcW_D(D)]****+---+\n               LSP1  +-- | D |-------------------|\
    \ C |\n                         +---+#####[RaP_D(C)]####+---+\n              \
    \      ----- Physical Links    xxxxx Failure Nodes\n                    *****\
    \ RcW_D             ##### RaP_D\n                    Figure 6: Wrapping for Node\
    \ Failure\n"
- title: 4.3.2.  Short-Wrapping
  contents:
  - "4.3.2.  Short-Wrapping\n   With the wrapping protection scheme, protection switching\
    \ is executed\n   at both nodes adjacent to the failure; consequently, the traffic\
    \ will\n   be wrapped twice.  This mechanism will cause additional latency and\n\
    \   bandwidth consumption when traffic is switched to the protection\n   path.\n\
    \   With short-wrapping protection, protection switching is executed only\n  \
    \ at the node upstream to the failure, and the packet leaves the ring\n   in the\
    \ protection ring tunnel at the egress node.  This scheme can\n   reduce the additional\
    \ latency and bandwidth consumption when traffic\n   is switched to the protection\
    \ path.  However, the two directions of a\n   protected bidirectional LSP are\
    \ no longer co-routed under the\n   protection-switching conditions.\n   In the\
    \ traditional wrapping solution, the protection ring tunnel is\n   configured\
    \ as a closed ring, while in the short-wrapping solution,\n   the protection ring\
    \ tunnel is configured as ended at the egress node,\n   which is similar to the\
    \ working ring tunnel.  Short-wrapping is easy\n   to implement in shared-ring\
    \ protection because both the working and\n   protection ring tunnels are terminated\
    \ on the egress nodes.  Figure 7\n   shows the clockwise working ring tunnel and\
    \ the anticlockwise\n   protection ring tunnel with Node D as the egress node.\n"
- title: 4.3.2.1.  Short-Wrapping for Link Failure
  contents:
  - "4.3.2.1.  Short-Wrapping for Link Failure\n   As shown in Figure 7, in normal\
    \ state, LSP1 is carried by the\n   clockwise working ring tunnel (RcW_D) through\
    \ the path A->B->C->D.\n   When a link failure between Nodes B and C occurs, Node\
    \ B switches the\n   working ring tunnel RcW_D to the protection ring tunnel RaP_D\
    \ in the\n   opposite direction.  The difference with wrapping occurs in the\n\
    \   protection ring tunnel at the egress node.  In short-wrapping\n   protection,\
    \ Rap_D ends in Node D, and then traffic will be forwarded\n   based on the LSP\
    \ labels.  Thus, with the short-wrapping mechanism,\n   LSP1 will follow the path\
    \ A->B->A->F->E->D when a link failure\n   between Node B and Node C happens.\
    \  The protection switch at Node D\n   is based on the information from its ring\
    \ map and the information\n   received via the RPS protocol.\n               \
    \          +---+#####[RaP_D(F)]######+---+\n                         | F |---------------------|\
    \ A | +-- LSP1\n                         +---+*****[RcW_D(A)]******+---+\n   \
    \                      #/*                        *\\#\n              [RaP_D(E)]#/*[RcW_D(F)]\
    \      [RcW_D(B)]*\\#RaP_D(A)\n                       #/*                    \
    \        *\\#\n                     +---+                           +---+\n  \
    \                   | E |                           | B |\n                  \
    \   +---+                           +---+\n                       #\\        \
    \                    *x#\n              [RaP_D(D)]#\\                [RcW_D(C)]*x#RaP_D(B)\n\
    \                         #\\                        *x#\n                   \
    \      +---+*****[RcW_D(D)]****+---+\n               LSP1  +-- | D |-------------------|\
    \ C |\n                         +---+                   +---+\n              \
    \     ----- Physical Links    xxxxx Failure Links\n                   ***** RcW_D\
    \             ##### RaP_D\n                 Figure 7: Short-Wrapping for Link\
    \ Failure\n"
- title: 4.3.2.2.  Short-Wrapping for Node Failure
  contents:
  - "4.3.2.2.  Short-Wrapping for Node Failure\n   For the node failure that happens\
    \ on a non-egress node, the short-\n   wrapping protection switching is similar\
    \ to the link failure case as\n   described in the previous section.  This section\
    \ specifies the\n   scenario of an egress node failure.\n   As shown in Figure\
    \ 8, LSP1 enters the ring on Node A and leaves the\n   ring on Node D.  In normal\
    \ state, LSP1 is carried by the clockwise\n   working ring tunnel (RcW_D) through\
    \ the path A->B->C->D.  When Node D\n   fails, the traffic of LSP1 cannot be protected\
    \ by any ring tunnels\n   that use Node D as the egress node.  The ingress node\
    \ will update its\n   ring map according to received RPS messages and determine\
    \ that the\n   egress node is not reachable; thus, it will not send traffic to\n\
    \   either the working or the protection tunnel.  However, before the\n   failure\
    \ location information is propagated to all the ring nodes\n   using the RPS protocol,\
    \ Node C switches all the traffic on the\n   working ring tunnel RcW_D to the\
    \ protection ring tunnel RaP_D in the\n   opposite direction based on the information\
    \ in the ring map.  When\n   the traffic arrives at Node E, which also detects\
    \ the failure of Node\n   D, the protection ring tunnel RaP_D cannot be used to\
    \ forward traffic\n   to Node D.  With the short-wrapping mechanism, protection\
    \ switching\n   can only be performed once from the working ring tunnel to the\n\
    \   protection ring tunnel; thus, Node E MUST NOT switch the traffic that\n  \
    \ is already carried on the protection ring tunnel back to the working\n   ring\
    \ tunnel in the opposite direction.  Instead, Node E will discard\n   the traffic\
    \ received on RaP_D locally.  This can avoid the temporary\n   traffic loop when\
    \ the failure happens on the egress node of the ring\n   tunnel.  This also illustrates\
    \ one of the benefits of having separate\n   working and protection ring tunnels\
    \ in each ring direction.\n                         +---+#####[RaP_D(F)]######+---+\n\
    \                         | F |---------------------| A | +-- LSP1\n         \
    \                +---+*****[RcW_D(A)]******+---+\n                         #/*\
    \                        *\\#\n              [RaP_D(E)]#/*[RcW_D(F)]      [RcW_D(B)]*\\\
    #RaP_D(A)\n                       #/*                            *\\#\n      \
    \               +---+                          +---+\n                     | E\
    \ |                          | B |\n                     +---+               \
    \           +---+\n                       #\\                            */#\n\
    \              [RaP_D(D)]#\\                [RcW_D(C)]*/#RaP_D(B)\n          \
    \               #\\                       */#\n                         xxxxx*****[RcW_D(D)]****+---+\n\
    \               LSP1  +-- x D x-------------------| C |\n                    \
    \     xxxxx                   +---+\n                   ----- Physical Links \
    \   xxxxx Failure Nodes\n                   ***** RcW_D             ##### RaP_D\n\
    \             Figure 8: Short-Wrapping for Egress Node Failure\n"
- title: 4.3.3.  Steering
  contents:
  - "4.3.3.  Steering\n   With the steering protection mechanism, the ingress node\
    \ (which adds\n   traffic to the ring) performs switching from the working to\
    \ the\n   protection ring tunnel, and at the egress node, the traffic leaves\n\
    \   the ring from the protection ring tunnel.\n   When a failure occurs in the\
    \ ring, the node that detects the failure\n   with an OAM mechanism sends the\
    \ failure information in the opposite\n   direction of the failure hop by hop\
    \ along the ring using an RPS\n   request message and the ring-map information.\
    \  When a ring node\n   receives the RPS message that identifies a failure, it\
    \ can determine\n   the location of the fault by using the topology information\
    \ of the\n   ring map and updating the ring map accordingly; then, it can\n  \
    \ determine whether the LSPs entering the ring locally need to switch\n   over\
    \ or not.  For LSPs that need to switch over, it will switch the\n   LSPs from\
    \ the working ring tunnels to their corresponding protection\n   ring tunnels.\n"
- title: 4.3.3.1.  Steering for Link Failure
  contents:
  - "4.3.3.1.  Steering for Link Failure\n   Ring Map of F                       \
    \           +--LSP1\n  +-+-+-+-+-+-+-+     +---+ ###[RaP_D(F)]### +---/  +-+-+-+-+-+-+-+\n\
    \  |F|A|B|C|D|E|F|     | F | ---------------- | A |  |A|B|C|D|E|F|A|\n  +-+-+-+-+-+-+-+\
    \     +---+ ***[RcW_D(A)]*** +---+  +-+-+-+-+-+-+-+\n   |I|I|I|S|I|I|       #/*\
    \                    *\\#    |I|I|S|I|I|I|\n   +-+-+-+-+-+-+      #/*        \
    \              *\\#   +-+-+-+-+-+-+\n         [RaP_D(E)]  #/*           [RcW_D(B)]\
    \   *\\# [RaP_D(A)]\n                    #/* [RcW_D(F)]               *\\#\n +-+-+-+-+-+-+-+\
    \   #/*                            *\\#\n |E|F|A|B|C|D|E| +---+              \
    \              +---+ +-- LSP2\n +-+-+-+-+-+-+-+ | E |                        \
    \    | B |  +-+-+-+-+-+-+-+\n  |I|I|I|I|S|I|  +---+                          \
    \  +---+  |B|C|D|E|F|A|B|\n  +-+-+-+-+-+-+     #\\*                          \
    \  */#   +-+-+-+-+-+-+-+\n                     #\\* [RcW_D(E)]    [RcW_D(C)] */#\
    \     |I|S|I|I|I|I|\n         [RaP_D(D)]   #\\*                        */#   \
    \   +-+-+-+-+-+-+\n                       #\\*                      */# [RaP_D(B)]\n\
    \ +-+-+-+-+-+-+-+       +---+     [RcW_D(D)]    +---+    +-+-+-+-+-+-+-+\n |D|E|F|A|B|C|D|\
    \  +--  | D | xxxxxxxxxxxxxxxxx | C |    |C|D|E|F|A|B|C|\n +-+-+-+-+-+-+-+ LSP1\
    \  +---+     [RaP_D(C)]    +---+    +-+-+-+-+-+-+-+\n  |I|I|I|I|I|S|  LSP2   \
    \                                 |S|I|I|I|I|I|\n  +-+-+-+-+-+-+             \
    \                             +-+-+-+-+-+-+\n                            -----\
    \ Physical Links\n                            ***** RcW_D\n                  \
    \          ##### RaP_D\n                               I: Intact\n           \
    \                    S: Severed\n           Figure 9: Steering Operation and Protection\
    \ Switching\n                            When Link C-D Fails\n   As shown in Figure\
    \ 9, LSP1 enters the ring from Node A while LSP2\n   enters the ring from Node\
    \ B, and both of them have the same\n   destination, which is Node D.\n   In normal\
    \ state, LSP1 is carried by the clockwise working ring tunnel\n   (RcW_D) through\
    \ the path A->B->C->D, and the label operation is:\n   [LSP1](Payload) -> [RcW_D(B)|LSP1](NodeA)\
    \ -> [RcW_D(C)| LSP1](NodeB)\n   -> [RcW_D(D)|LSP1](NodeC) -> [LSP1](Payload).\n\
    \   LSP2 is carried by the clockwise working ring tunnel (RcW_D) through\n   the\
    \ path B->C->D, and the label operation is: [LSP2](Payload) ->\n   [RcW_D(C)|LSP2](NodeB)\
    \ -> [RcW_D(D)|LSP2](NodeC) -> [LSP2](Payload).\n   If the link between Nodes\
    \ C and D fails, according to the fault\n   detection and distribution mechanisms,\
    \ Node D will find out that\n   there is a failure in the link between C and D,\
    \ and it will update\n   the link state of its ring topology, changing the link\
    \ between C and\n   D from normal to fault.  In the direction that is opposite\
    \ to the\n   failure position, Node D will send the state report message to Node\n\
    \   E, informing Node E of the fault between C and D, and E will update\n   the\
    \ link state of its ring topology accordingly, changing the link\n   between C\
    \ and D from normal to fault.  In this way, the state report\n   message is sent\
    \ hop by hop in the clockwise direction.  Similar to\n   Node D, Node C will send\
    \ the failure information in the anticlockwise\n   direction.\n   When Node A\
    \ receives the failure report message and updates the link\n   state of its ring\
    \ map, it is aware that there is a fault on the\n   clockwise working ring tunnel\
    \ to Node D (RcW_D), and LSP1 enters the\n   ring locally and is carried by this\
    \ ring tunnel; thus, Node A will\n   decide to switch the LSP1 onto the anticlockwise\
    \ protection ring\n   tunnel to Node D (RaP_D).  After the switchover, LSP1 will\
    \ follow the\n   path A->F->E->D, and the label operation is: [LSP1](Payload)\
    \ ->\n   [RaP_D(F)| LSP1](NodeA) -> [RaP_D(E)|LSP1](NodeF) ->\n   [RaP_D(D)|LSP1](NodeE)\
    \ -> [LSP1](Payload).\n   The same procedure also applies to the operation of\
    \ LSP2.  When Node\n   B updates the link state of its ring topology, and finds\
    \ out that the\n   working ring tunnel RcW_D has failed, it will switch the LSP2\
    \ to the\n   anticlockwise protection tunnel RaP_D.  After the switchover, LSP2\n\
    \   goes through the path B->A->F->E->D, and the label operation is:\n   [LSP2](Payload)\
    \ -> [RaP_D(A)|LSP2](NodeB) -> [RaP_D(F)|LSP2](NodeA)\n   -> [RaP_D(E)|LSP2](NodeF)\
    \ -> [RaP_D(D)|LSP2](NodeE) ->\n   [LSP2](Payload).\n   Assume the link between\
    \ Nodes A and B breaks down, as shown in\n   Figure 10.  Similar to the above\
    \ failure case, Node B will detect a\n   fault in the link between A and B, and\
    \ it will update its ring map,\n   changing the link state between A and B from\
    \ normal to fault.  The\n   state report message is sent hop by hop in the clockwise\
    \ direction,\n   notifying every node that there is a fault between Nodes A and\
    \ B, and\n   every node updates the link state of its ring topology.  As a result,\n\
    \   Node A will detect a fault in the working ring tunnel to Node D, and\n   switch\
    \ LSP1 to the protection ring tunnel, while Node B determines\n   that the working\
    \ ring tunnel for LSP2 still works fine, and it will\n   not perform the switchover.\n\
    \                                                   /+-- LSP1\n"
- title: '+-+-+-+-+-+-+-+      +---+ ###[RaP_D(F)]####  +---/  +-+-+-+-+-+-+-+'
  contents:
  - '+-+-+-+-+-+-+-+      +---+ ###[RaP_D(F)]####  +---/  +-+-+-+-+-+-+-+

    '
- title: '|F|A|B|C|D|E|F|      | F | -----------------  | A |  |A|B|C|D|E|F|A|'
  contents:
  - '|F|A|B|C|D|E|F|      | F | -----------------  | A |  |A|B|C|D|E|F|A|

    '
- title: +-+-+-+-+-+-+-+      +---+ ***[RcW_D(A)]****  +---+  +-+-+-+-+-+-+-+
  contents:
  - "+-+-+-+-+-+-+-+      +---+ ***[RcW_D(A)]****  +---+  +-+-+-+-+-+-+-+\n |I|S|I|I|I|I|\
    \       #/*                       x      |S|I|I|I|I|I|\n +-+-+-+-+-+-+      #/*\
    \                         x     +-+-+-+-+-+-+\n       [RaP_D(E)]  #/*[RcW_D(F)]\
    \       [RcW_D(B)]x [RaP_D(A)]\n                  #/*                        \
    \     x     /+-- LSP2\n"
- title: +-+-+-+-+-+-+-+  +---+                             +---/ +-+-+-+-+-+-+-+
  contents:
  - '+-+-+-+-+-+-+-+  +---+                             +---/ +-+-+-+-+-+-+-+

    '
- title: '|E|F|A|B|C|D|E|  | E |                             | B | |B|C|D|E|F|A|B|'
  contents:
  - '|E|F|A|B|C|D|E|  | E |                             | B | |B|C|D|E|F|A|B|

    '
- title: +-+-+-+-+-+-+-+  +---+                             +---+ +-+-+-+-+-+-+-+
  contents:
  - "+-+-+-+-+-+-+-+  +---+                             +---+ +-+-+-+-+-+-+-+\n |I|I|S|I|I|I|\
    \     #\\*                            */#     |I|I|I|I|I|S|\n +-+-+-+-+-+-+  \
    \    #\\*[RcW_D(E)]    [RcW_D(C)]  */#      +-+-+-+-+-+-+\n         [RaP_D(D)]\
    \  #\\*                        */# [RaP_D(B)]\n"
- title: '+-+-+-+-+-+-+-+       #\*                      */#     +-+-+-+-+-+-+-+'
  contents:
  - '+-+-+-+-+-+-+-+       #\*                      */#     +-+-+-+-+-+-+-+

    '
- title: '|D|E|F|A|B|C|D|       +---+ ***[RcW_D(D)]*** +---+     |C|D|E|F|A|B|C|'
  contents:
  - '|D|E|F|A|B|C|D|       +---+ ***[RcW_D(D)]*** +---+     |C|D|E|F|A|B|C|

    '
- title: +-+-+-+-+-+-+-+  +--  | D | ---------------- | C |     +-+-+-+-+-+-+-+
  contents:
  - "+-+-+-+-+-+-+-+  +--  | D | ---------------- | C |     +-+-+-+-+-+-+-+\n |I|I|I|S|I|I|\
    \   LSP1 +---+ ###[RaP_D(C)]### +---+      |I|I|I|I|S|I|\n +-+-+-+-+-+-+   LSP2\
    \                                   +-+-+-+-+-+-+\n                          -----\
    \ Physical Links\n                          ***** RcW_D\n                    \
    \      ##### RaP_D\n          Figure 10: Steering Operation and Protection Switching\n\
    \                            When Link A-B Fails\n"
- title: 4.3.3.2.  Steering for Node Failure
  contents:
  - "4.3.3.2.  Steering for Node Failure\n   For a node failure that happens on a\
    \ non-egress node, steering\n   protection switching is similar to the link failure\
    \ case as described\n   in the previous section.\n   If the failure occurs at\
    \ the egress node of the LSP, the ingress node\n   will update its ring map according\
    \ to the received RPS messages; it\n   will also determine that the egress node\
    \ is not reachable after the\n   failure, thus it will not send traffic to either\
    \ the working or the\n   protection tunnel, and a traffic loop can be avoided.\n"
- title: 4.4.  Interconnected Ring Protection
  contents:
  - '4.4.  Interconnected Ring Protection

    '
- title: 4.4.1.  Interconnected Ring Topology
  contents:
  - "4.4.1.  Interconnected Ring Topology\n   Interconnected ring topology is widely\
    \ used in MPLS-TP networks.  For\n   a given ring, the interconnection node acts\
    \ as the egress node for\n   that ring, meaning that all LSPs using the interconnection\
    \ node as an\n   egress from one specific ring to another will use the same group\
    \ of\n   ring tunnels within the ring.  This document will discuss two typical\n\
    \   interconnected ring topologies:\n   1.  Single-node interconnected rings\n\
    \          In single-node interconnected rings, the connection between\n     \
    \     the two rings is through a single node.  Because the\n          interconnection\
    \ node is in fact a single point of failure,\n          this topology should be\
    \ avoided in real transport networks.\n          Figure 11 shows the topology\
    \ of single-node interconnected\n          rings.  Node C is the interconnection\
    \ node between Ring1 and\n          Ring2.\n          +---+      +---+       \
    \                 +---+      +---+\n          | A |------| B |-----          \
    \    -----| G |------| H |\n          +---+      +---+      \\           /   \
    \  +---+      +---+\n            |                    \\         /           \
    \        |\n            |                     \\ +---+ /                    |\n\
    \            |        Ring1          | C |         Ring2        |\n          \
    \  |                     / +---+ \\                    |\n            |      \
    \              /         \\                   |\n          +---+      +---+  \
    \    /           \\     +---+      +---+\n          | F |------| E |-----    \
    \          -----| J |------| I |\n          +---+      +---+                 \
    \       +---+      +---+\n                Figure 11: Single-Node Interconnected\
    \ Rings\n   2.  Dual-node interconnected rings\n          In dual-node interconnected\
    \ rings, the connection between the\n          two rings is through two nodes.\
    \  The two interconnection nodes\n          belong to both interconnected rings.\
    \  This topology can\n          recover from one interconnection node failure.\n\
    \          Figure 12 shows the topology of dual-node interconnected\n        \
    \  rings.  Nodes C and D are the interconnection nodes between\n          Ring1\
    \ and Ring2.\n             +---+      +---+      +---+      +---+      +---+\n\
    \             | A |------| B |------| C |------| G |------| H |\n            \
    \ +---+      +---+      +---+      +---+      +---+\n               |        \
    \             |                     |\n               |                     |\
    \                     |\n               |        Ring1        |        Ring2 \
    \       |\n               |                     |                     |\n    \
    \           |                     |                     |\n             +---+\
    \      +---+      +---+      +---+      +---+\n             | F |------| E |------|\
    \ D |------| J |------| I |\n             +---+      +---+      +---+      +---+\
    \      +---+\n                 Figure 12: Dual-Node Interconnected Rings\n"
- title: 4.4.2.  Interconnected Ring Protection Mechanisms
  contents:
  - "4.4.2.  Interconnected Ring Protection Mechanisms\n   Interconnected rings can\
    \ be treated as two independent rings.  The\n   RPS protocol operates on each\
    \ ring independently.  A failure that\n   happens in one ring only triggers protection\
    \ switching in the ring\n   itself and does not affect the other ring, unless\
    \ the failure is on\n   the interconnection node.  In this way, protection switching\
    \ on each\n   ring is the same as the mechanisms described in Section 4.3.\n \
    \  The service LSPs that traverse the interconnected rings use the ring\n   tunnels\
    \ in each ring; within a given ring, the tunnel is selected\n   using normal ring-selection\
    \ procedures.  The traversing LSPs are\n   stitched on the interconnection node.\
    \  On the interconnection node,\n   the ring tunnel label of the source ring is\
    \ popped, then LSP label is\n   swapped; after that, the ring tunnel label of\
    \ the destination ring is\n   pushed.\n   In the dual-node interconnected ring\
    \ scenario, the two\n   interconnection nodes can be managed as a virtual node\
    \ group.  In\n   addition to the ring tunnels to each physical ring node, each\
    \ ring\n   SHOULD assign the working and protection ring tunnels to the virtual\n\
    \   interconnection node group.  In addition, on both nodes in the\n   virtual\
    \ interconnection node group, the same LSP label is assigned\n   for each traversed\
    \ LSP.  This way, any interconnection node in the\n   virtual node group can terminate\
    \ the working or protection ring\n   tunnels targeted to the virtual node group\
    \ and stitch the service LSP\n   from the source ring tunnel to the destination\
    \ ring tunnel.\n   When the service LSP passes through the interconnected rings,\
    \ the\n   direction of the working ring tunnels used on both rings SHOULD be\n\
    \   the same.  In dual-node interconnected rings, this ensures that in\n   normal\
    \ state the traffic passes only one of the two interconnection\n   nodes and does\
    \ not pass the link between the two interconnection\n   nodes.  The traffic will\
    \ then only be switched to the protection path\n   if the interconnection node\
    \ that is in working path fails.  For\n   example, if the service LSP uses the\
    \ clockwise working ring tunnel on\n   Ring1, when the service LSP leaves Ring1\
    \ and enters Ring2, the\n   working ring tunnel used on Ring2 should also follow\
    \ the clockwise\n   direction.\n"
- title: 4.4.3.  Ring Tunnels in Interconnected Rings
  contents:
  - "4.4.3.  Ring Tunnels in Interconnected Rings\n   The same ring tunnels as described\
    \ in Section 4.1 are used in each\n   ring of the interconnected rings.  In addition,\
    \ ring tunnels to the\n   virtual interconnection node group are established on\
    \ each ring of\n   the interconnected rings, that is:\n   o  one clockwise working\
    \ ring tunnel to the virtual interconnection\n      node group\n   o  one anticlockwise\
    \ protection ring tunnel to the virtual\n      interconnection node group\n  \
    \ o  one anticlockwise working ring tunnel to the virtual\n      interconnection\
    \ node group\n   o  one clockwise protection ring tunnel to the virtual\n    \
    \  interconnection node group\n   The ring tunnels to the virtual interconnection\
    \ node group are shared\n   by all LSPs that need to be forwarded to other rings.\
    \  These ring\n   tunnels can terminate at any node in the virtual interconnection\
    \ node\n   group.\n   For example, all the ring tunnels on Ring1 in Figure 13\
    \ are\n   provisioned as follows:\n   o  To Node A: R1cW_A, R1aW_A, R1cP_A, R1aP_A\n\
    \   o  To Node B: R1cW_B, R1aW_B, R1cP_B, R1aP_B\n   o  To Node C: R1cW_C, R1aW_C,\
    \ R1cP_C, R1aP_C\n   o  To Node D: R1cW_D, R1aW_D, R1cP_D, R1aP_D\n   o  To Node\
    \ E: R1cW_E, R1aW_E, R1cP_E, R1aP_E\n   o  To Node F: R1cW_F, R1aW_F, R1cP_F,\
    \ R1aP_F\n   o  To the virtual interconnection node group (including Nodes F and\n\
    \      A): R1cW_F&A, R1aW_F&A, R1cP_F&A, R1aP_F&A\n   All the ring tunnels on\
    \ Ring2 in Figure 13 are provisioned as\n   follows:\n   o  To Node A: R2cW_A,\
    \ R2aW_A, R2cP_A, R2aP_A\n   o  To Node F: R2cW_F, R2aW_F, R2cP_F, R2aP_F\n  \
    \ o  To Node G: R2cW_G, R2aW_G, R2cP_G, R2aP_G\n   o  To Node H: R2cW_H, R2aW_H,\
    \ R2cP_H, R2aP_H\n   o  To Node I: R2cW_I, R2aW_I, R2cP_I, R2aP_I\n   o  To Node\
    \ J: R2cW_J, R2aW_J, R2cP_J, R2aP_J\n   o  To the virtual interconnection node\
    \ group (including Nodes F and\n      A): R2cW_F&A, R2aW_F&A, R2cP_F&A, R2aP_F&A\n\
    \                          +---+ccccccccccccc+---+\n                         \
    \ | H |-------------| I |--->LSP1\n                          +---+           \
    \  +---+\n                          c/a                   a\\\n              \
    \           c/a                     a\\\n                        c/a         \
    \              a\\\n                      +---+                     +---+\n  \
    \                    | G |        Ring2        | J |\n                      +---+\
    \                     +---+\n                        c\\a                    \
    \  a/c\n                         c\\a                    a/c\n               \
    \           c\\a  aaaaaaaaaaaaa   a/c\n                          +---+ccccccccccccc+---+\n\
    \                          | F |-------------| A |\n                         \
    \ +---+ccccccccccccc+---+\n                          c/aaaaaaaaaaaaaaaaaaa a\\\
    \n                         c/                      a\\\n                     \
    \   c/                        a\\\n                      +---+               \
    \      +---+\n                      | E |        Ring1        | B |\n        \
    \              +---+                     +---+\n                        c\\a \
    \                     a/c\n                         c\\a                    a/c\n\
    \                          c\\a                  a/c\n                       \
    \   +---+aaaaaaaaaaaaa+---+\n                  LSP1--->| D |-------------| C |\n\
    \                          +---+ccccccccccccc+---+\n                         \
    \ Ring1:\n                           ccccccccccc  R1cW_F&A\n                 \
    \          aaaaaaaaaaa  R1aP_F&A\n                          Ring2:\n         \
    \                  ccccccccccc  R2cW_I\n                           aaaaaaaaaaa\
    \  R2aP_I\n           Figure 13: Ring Tunnels for the Interconnected Rings\n"
- title: 4.4.4.  Interconnected Ring-Switching Procedure
  contents:
  - "4.4.4.  Interconnected Ring-Switching Procedure\n   As shown in Figure 13, for\
    \ the service LSP1 that enters Ring1 at Node\n   D and leaves Ring1 at Node F\
    \ and continues to enter Ring2 at Node F\n   and leaves Ring2 at Node I, the short-wrapping\
    \ protection scheme is\n   described as below.\n   In normal state, LSP1 follows\
    \ R1cW_F&A in Ring1 and R2cW_I in Ring2.\n   At the interconnection Node F, the\
    \ label used for the working ring\n   tunnel R1cW_F&A in Ring1 is popped, the\
    \ LSP label is swapped, and the\n   label used for the working ring tunnel R2cW_I\
    \ in Ring2 will be pushed\n   based on the inner LSP label lookup.  The working\
    \ path that the\n   service LSP1 follows is: LSP1->R1cW_F&A\n   (D->E->F)->R2cW_I(F->G->H->I)->LSP1.\n\
    \   In case of link failure, for example, when a failure occurs on the\n   link\
    \ between Nodes F and E, Node E will detect the failure and\n   execute protection\
    \ switching as described in Section 4.3.2.  The path\n   that the service LSP1\
    \ follows after switching change to: LSP1->R1cW_F\n   &A(D->E)->R1aP_F&A(E->D->C->B->A)->R2cW_I(A->F->G->H->I)->LSP1.\n\
    \   In case of a non-interconnection node failure, for example, when the\n   failure\
    \ occurs at Node E in Ring1, Node D will detect the failure and\n   execute protection\
    \ switching as described in Section 4.3.2.  The path\n   that the service LSP1\
    \ follows after switching becomes:\n   LSP1->R1aP_F&A(D->C->B->A)->R2cW_I(A->F->G->H->I)->LSP1.\n\
    \   In case of an interconnection node failure, for example, when the\n   failure\
    \ occurs at the interconnection Node F, Node E in Ring1 will\n   detect the failure\
    \ and execute protection switching as described in\n   Section 4.3.2.  Node A\
    \ in Ring2 will also detect the failure and\n   execute protection switching as\
    \ described in Section 4.3.2.  The path\n   that the service traffic LSP1 follows\
    \ after switching is:\n   LSP1->R1cW_F&A(D->E)->R1aP_F&A(E->D->C->B->A)->R2aP_I(A->J->I)->LSP1.\n"
- title: 4.4.5.  Interconnected Ring Detection Mechanism
  contents:
  - "4.4.5.  Interconnected Ring Detection Mechanism\n   As shown in Figure 13, in\
    \ normal state, the service traffic LSP1\n   traverses D->E->F in Ring1 and F->G->H->I\
    \ in Ring2.  Nodes A and F\n   are the interconnection nodes.  When both links\
    \ between Nodes F and G\n   and between Nodes F and A fail, the ring tunnel from\
    \ Node F to Node I\n   in Ring2 becomes unreachable.  However, the other interconnection\n\
    \   Node A is still available, and LSP1 can still reach Node I via Node\n   A.\n\
    \   In order to achieve this, the interconnection nodes need to know the\n   ring\
    \ topology of each ring so that they can judge whether a node is\n   reachable.\
    \  This judgment is based on the knowledge of the ring map\n   and the fault location.\
    \  The ring map can be obtained from the\n   Network Management System (NMS) or\
    \ topology discovery mechanisms.\n   The fault location can be obtained by transmitting\
    \ the fault\n   information around the ring.  The nodes that detect the failure\
    \ will\n   transmit the fault information in the opposite direction hop by hop\n\
    \   using the RPS protocol message.  When the interconnection node\n   receives\
    \ the message that informs the failure, it will calculate the\n   location of\
    \ the fault according to the topology information that is\n   maintained by itself\
    \ and determines whether the LSPs entering the\n   ring at itself can reach the\
    \ destination.  If the destination node is\n   reachable, the LSP will leave the\
    \ source ring and enter the\n   destination ring.  If the destination node is\
    \ not reachable, the LSP\n   will switch to the anticlockwise protection ring\
    \ tunnel.\n   In Figure 13, Node F determines that the ring tunnel to Node I is\n\
    \   unreachable; the service LSP1 for which the destination node on Ring2\n  \
    \ is Node I MUST switch to the protection ring tunnel (R1aP_F&A), and\n   consequently,\
    \ the service traffic LSP1 traverses the interconnected\n   rings at Node A. \
    \ Node A will pop the ring tunnel label of Ring1 and\n   push the ring tunnel\
    \ label of Ring2 and send the traffic to Node I\n   via the ring tunnel (R2aW_I).\n"
- title: 5.  Ring Protection Coordination Protocol
  contents:
  - '5.  Ring Protection Coordination Protocol

    '
- title: 5.1.  RPS and PSC Comparison on Ring Topology
  contents:
  - "5.1.  RPS and PSC Comparison on Ring Topology\n   This section provides comparison\
    \ between RPS and Protection State\n   Coordination (PSC) [RFC6378] [RFC6974]\
    \ on ring topologies.  This can\n   be helpful to explain the reason of defining\
    \ a new protocol for ring\n   protection switching.\n   The PSC protocol [RFC6378]\
    \ is designed for point-to-point LSPs, on\n   which the protection switching can\
    \ only be performed on one or both\n   of the endpoints of the LSP.  The RPS protocol\
    \ is designed for ring\n   tunnels, which consist of multiple ring nodes, and\
    \ the failure could\n   happen on any segment of the ring; thus, RPS is capable\
    \ of\n   identifying and handling the different failures on the ring and\n   coordinating\
    \ the protection-switching behavior of all the nodes on\n   the ring.  As will\
    \ be specified in the following sections, this is\n   achieved with the introduction\
    \ of the \"pass-through\" state for the\n   ring nodes, and the location of the\
    \ protection request is identified\n   via the node IDs in the RPS request message.\n\
    \   Taking a ring topology with N nodes as an example:\n   With the mechanism\
    \ specified in [RFC6974], on every ring node, a\n   linear protection configuration\
    \ has to be provisioned with every\n   other node in the ring, i.e., with (N-1)\
    \ other nodes.  This means\n   that on every ring node there will be (N-1) instances\
    \ of the PSC\n   protocol.  And in order to detect faults and to transport the\
    \ PSC\n   message, each instance shall have a MEP on the working path and a MEP\n\
    \   on the protection path, respectively.  This means that every node on\n   the\
    \ ring needs to be configured with (N-1) * 2 MEPs.\n   With the mechanism defined\
    \ in this document, on every ring node there\n   will only be a single instance\
    \ of the RPS protocol.  In order to\n   detect faults and to transport the RPS\
    \ message, each node only needs\n   to have a MEP on the section to its adjacent\
    \ nodes, respectively.  In\n   this way, every ring node only needs to be configured\
    \ with 2 MEPs.\n   As shown in the above example, RPS is designed for ring topologies\n\
    \   and can achieve ring protection efficiently with minimum protection\n   instances\
    \ and OAM entities, which meets the requirements on topology-\n   specific recovery\
    \ mechanisms as specified in [RFC5654].\n"
- title: 5.2.  RPS Protocol
  contents:
  - "5.2.  RPS Protocol\n   The RPS protocol defined in this section is used to coordinate\
    \ the\n   protection-switching action of all the ring nodes in the same ring.\n\
    \   The protection operation of the ring tunnels is controlled with the\n   help\
    \ of the RPS protocol.  The RPS processes in each of the\n   individual ring nodes\
    \ that form the ring MUST communicate using the\n   Generic Associated Channel\
    \ (G-ACh).  The RPS protocol is applicable\n   to all the three ring protection\
    \ modes.  This section takes the\n   short-wrapping mechanism described in Section\
    \ 4.3.2 as an example.\n   The RPS protocol is used to distribute the ring status\
    \ information\n   and RPS requests to all the ring nodes.  Changes in the ring\
    \ status\n   information and RPS requests can be initiated automatically based\
    \ on\n   link status or caused by external commands.\n   Each node on the ring\
    \ is uniquely identified by assigning it a node\n   ID.  The node ID MUST be unique\
    \ on each ring.  The maximum number of\n   nodes on the ring supported by the\
    \ RPS protocol is 127.  The node ID\n   SHOULD be independent of the order in\
    \ which the nodes appear on the\n   ring.  The node ID is used to identify the\
    \ source and destination\n   nodes of each RPS request.\n   Every node obtains\
    \ the ring topology either by configuration or via\n   some topology discovery\
    \ mechanism.  The ring map consists of the ring\n   topology information, and\
    \ connectivity status (Intact or Severed)\n   between the adjacent ring nodes,\
    \ which is determined via the OAM\n   message exchanged between the adjacent nodes.\
    \  The ring map is used\n   by every ring node to determine the switchover behavior\
    \ of the ring\n   tunnels.\n   As shown in Figure 14, when no protection switching\
    \ is active on the\n   ring, each node MUST send RPS requests with No Request\
    \ (NR) to its\n   two adjacent nodes periodically.  The transmission interval\
    \ of RPS\n   requests is specified in Section 5.2.1.\n                   +---+\
    \ A->B(NR)    +---+ B->C(NR)    +---+ C->D(NR)\n            -------| A |-------------|\
    \ B |-------------| C |-------\n          (NR)F<-A +---+    (NR)A<-B +---+   \
    \ (NR)B<-C +---+\n          Figure 14: RPS Communication between the Ring Nodes\
    \ in\n                      Case of No Failure in the Ring\n   As shown in Figure\
    \ 15, when a node detects a failure and determines\n   that protection switching\
    \ is required, it MUST send the appropriate\n   RPS request in both directions\
    \ to the destination node.  The\n   destination node is the other node that is\
    \ adjacent to the identified\n   failure.  When a node that is not the destination\
    \ node receives an\n   RPS request and it has no higher-priority local request,\
    \ it MUST\n   transfer in the same direction the RPS request as received.  In\
    \ this\n   way, the switching nodes can maintain RPS protocol communication in\n\
    \   the ring.  The RPS request MUST be terminated by the destination node\n  \
    \ of the message.  If an RPS request with the node itself set as the\n   source\
    \ node is received, this message MUST be dropped and not be\n   forwarded to the\
    \ next node.\n                    +---+ C->B(SF)    +---+ B->C(SF)    +---+ C->B(SF)\n\
    \             -------| A |-------------| B |----- X -----| C |-------\n      \
    \     (SF)C<-B +---+    (SF)C<-B +---+    (SF)B<-C +---+\n          Figure 15:\
    \ RPS Communication between the Ring Nodes in\n                   Case of Failure\
    \ between Nodes B and C\n   Note that in the case of a bidirectional failure such\
    \ as a cable cut,\n   the two adjacent nodes detect the failure and send each\
    \ other an RPS\n   request in opposite directions.\n   o  In rings utilizing the\
    \ wrapping protection, each node detects the\n      failure or receives the RPS\
    \ request as the destination node MUST\n      perform the switch from/to the working\
    \ ring tunnels to/from the\n      protection ring tunnels if it has no higher-priority\
    \ active RPS\n      request.\n   o  In rings utilizing the short-wrapping protection,\
    \ each node\n      detects the failure or receives the RPS request as the destination\n\
    \      node MUST perform the switch only from the working ring tunnels to\n  \
    \    the protection ring tunnels.\n   o  In rings utilizing the steering protection,\
    \ when a ring switch is\n      required, any node MUST perform the switches if\
    \ its added/dropped\n      traffic is affected by the failure.  Determination\
    \ of the affected\n      traffic MUST be performed by examining the RPS requests\n\
    \      (indicating the nodes adjacent to the failure or failures) and the\n  \
    \    stored ring map (indicating the relative position of the failure\n      and\
    \ the added traffic destined towards that failure).\n   When the failure has cleared\
    \ and the Wait-to-Restore (WTR) timer has\n   expired, the nodes that generate\
    \ the RPS requests MUST drop their\n   respective switches and MUST generate an\
    \ RPS request carrying the NR\n   code.  The node receiving such an RPS request\
    \ from both directions\n   MUST drop its protection switches.\n   A protection\
    \ switch MUST be initiated by one of the criteria\n   specified in Section 5.3.\
    \  A failure of the RPS protocol or\n   controller MUST NOT trigger a protection\
    \ switch.\n   Ring switches MUST be preempted by higher-priority RPS requests.\
    \  For\n   example, consider a protection switch that is active due to a manual\n\
    \   switch request on the given link, and another protection switch is\n   required\
    \ due to a failure on another link.  Then an RPS request MUST\n   be generated,\
    \ the former protection switch MUST be dropped, and the\n   latter protection\
    \ switch established.\n   The MPLS-TP Shared-Ring Protection mechanism supports\
    \ multiple\n   protection switches in the ring, resulting in the ring being\n\
    \   segmented into two or more separate segments.  This may happen when\n   several\
    \ RPS requests of the same priority exist in the ring due to\n   multiple failures\
    \ or external switch commands.\n   Proper operation of the MSRP mechanism relies\
    \ on all nodes using\n   their ring map to determine the state of the ring (nodes\
    \ and links).\n   In order to accommodate ring state knowledge, the RPS requests\
    \ MUST\n   be sent in both directions during a protection switch.\n"
- title: 5.2.1.  Transmission and Acceptance of RPS Requests
  contents:
  - "5.2.1.  Transmission and Acceptance of RPS Requests\n   A new RPS request MUST\
    \ be transmitted immediately when a change in\n   the transmitted status occurs.\n\
    \   The first three RPS protocol messages carrying a new RPS request MUST\n  \
    \ be transmitted as fast as possible.  For fast protection switching\n   within\
    \ 50 ms, the interval of the first three RPS protocol messages\n   SHOULD be 3.3\
    \ ms.  The successive RPS requests SHOULD be transmitted\n   with the interval\
    \ of 5 seconds.  A ring node that is not the\n   destination of the received RPS\
    \ message MUST forward it to the next\n   node along the ring immediately.\n"
- title: 5.2.2.  RPS Protocol Data Unit (PDU) Format
  contents:
  - "5.2.2.  RPS Protocol Data Unit (PDU) Format\n   Figure 16 depicts the format\
    \ of an RPS packet that is sent on the\n   G-ACh.  The Channel Type field is set\
    \ to indicate that the message is\n   an RPS message.\n       0              \
    \     1                   2                   3\n       0 1 2 3 4 5 6 7 8 9 0\
    \ 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      |0 0 0 1|Version|   Reserved    |    RPS Channel Type (0x002A)  |\n   \
    \   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n      |\
    \ Dest Node ID  | Src Node ID   |   Request     | M | Reserved  |\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \                    Figure 16: G-ACh RPS Packet Format\n   The following fields\
    \ MUST be provided:\n   o  Destination Node ID: The destination node ID MUST always\
    \ be set to\n      the value of the node ID of the adjacent node.  The node ID\
    \ MUST\n      be unique on each ring.  Valid destination node ID values are\n\
    \      1-127.\n   o  Source Node ID: The source node ID MUST always be set to\
    \ the ID\n      value of the node generating the RPS request.  The node ID MUST\
    \ be\n      unique on each ring.  Valid source node ID values are 1-127.\n   o\
    \  Protection-Switching Mode (M): This 2-bit field indicates the\n      protection-switching\
    \ mode used by the sending node of the RPS\n      message.  This can be used to\
    \ check that the ring nodes on the\n      same ring use the same protection-switching\
    \ mechanism.  The\n      defined values of the M field are listed as below:\n\
    \             +------------------+-----------------------------+\n           \
    \  | Bits (MSB - LSB) |  Protection-Switching Mode  |\n             +------------------+-----------------------------+\n\
    \             |       0 0        |         Reserved            |\n           \
    \  |       0 1        |         Wrapping            |\n             |       1\
    \ 0        |       Short-Wrapping        |\n             |       1 1        |\
    \         Steering            |\n             +------------------+-----------------------------+\n\
    \             Note:\n             MSB = most significant bit\n             LSB\
    \ = least significant bit\n   o  RPS Request Code: A code consisting of 8 bits\
    \ as specified below:\n       +------------------+-----------------------------+----------+\n\
    \       |      Bits        |     Condition, State,       | Priority |\n      \
    \ |   (MSB - LSB)    |    or External Request      |          |\n       +------------------+-----------------------------+----------+\n\
    \       | 0 0 0 0 1 1 1 1  |  Lockout of Protection (LP) |  highest |\n      \
    \ | 0 0 0 0 1 1 0 1  |  Forced Switch (FS)         |          |\n       | 0 0\
    \ 0 0 1 0 1 1  |  Signal Fail (SF)           |          |\n       | 0 0 0 0 0\
    \ 1 1 0  |  Manual Switch (MS)         |          |\n       | 0 0 0 0 0 1 0 1\
    \  |  Wait-to-Restore (WTR)      |          |\n       | 0 0 0 0 0 0 1 1  |  Exercise\
    \ (EXER)            |          |\n       | 0 0 0 0 0 0 0 1  |  Reverse Request\
    \ (RR)       |          |\n       | 0 0 0 0 0 0 0 0  |  No Request (NR)      \
    \      |  lowest  |\n       +------------------+-----------------------------+----------+\n"
- title: 5.2.3.  Ring Node RPS States
  contents:
  - "5.2.3.  Ring Node RPS States\n   Idle state: A node is in the idle state when\
    \ it has no RPS request\n   and is sending and receiving an NR code to/from both\
    \ directions.\n   Switching state: A node not in the idle or pass-through states\
    \ is in\n   the switching state.\n   Pass-through state: A node is in the pass-through\
    \ state when its\n   highest priority RPS request is a request not destined to\
    \ it or\n   generated by it.  The pass-through is bidirectional.\n"
- title: 5.2.3.1.  Idle State
  contents:
  - "5.2.3.1.  Idle State\n   A node in the idle state MUST generate the NR request\
    \ in both\n   directions.\n   A node in the idle state MUST terminate RPS requests\
    \ that flow in\n   both directions.\n   A node in the idle state MUST block the\
    \ traffic flow on protection\n   ring tunnels in both directions.\n"
- title: 5.2.3.2.  Switching State
  contents:
  - "5.2.3.2.  Switching State\n   A node in the switching state MUST generate an\
    \ RPS request to its\n   adjacent node with its highest RPS request code in both\
    \ directions\n   when it detects a failure or receives an external command.\n\
    \   In a bidirectional failure condition, both of the nodes adjacent to\n   the\
    \ failure detect the failure and send the RPS request in both\n   directions with\
    \ the destination set to each other; while each node\n   can only receive the\
    \ RPS request via the long path, the message sent\n   via the short path will\
    \ get lost due to the bidirectional failure.\n   Here, the short path refers to\
    \ the shorter path on the ring between\n   the source and destination node of\
    \ the RPS request, and the long path\n   refers to the longer path on the ring\
    \ between the source and\n   destination node of the RPS request.  Upon receipt\
    \ of the RPS request\n   on the long path, the destination node of the RPS request\
    \ MUST send\n   an RPS request with its highest request code periodically along\
    \ the\n   long path to the other node adjacent to the failure.\n   In a unidirectional\
    \ failure condition, the node that detects the\n   failure MUST send the RPS request\
    \ in both directions with the\n   destination node set to the other node adjacent\
    \ to the failure.  The\n   destination node of the RPS request cannot detect the\
    \ failure itself\n   but will receive an RPS request from both the short path\
    \ and the long\n   path.  The destination node MUST acknowledge the received RPS\n\
    \   requests by replying with an RPS request with the RR code on the\n   short\
    \ path and an RPS request with the received RPS request code on\n   the long path.\
    \  Accordingly, when the node that detects the failure\n   receives the RPS request\
    \ with RR code on the short path, then the RPS\n   request received from the same\
    \ node along the long path SHOULD be\n   ignored.\n   A node in the switching\
    \ state MUST terminate the received RPS\n   requests in both directions and not\
    \ forward it further along the\n   ring.\n   The following switches as defined\
    \ in Section 5.3.1 MUST be allowed to\n   coexist:\n   o  LP and LP\n   o  FS\
    \ and FS\n   o  SF and SF\n   o  FS and SF\n   When multiple MS RPS requests exist\
    \ at the same time addressing\n   different links and there is no higher-priority\
    \ request on the ring,\n   no switch SHOULD be executed and existing switches\
    \ MUST be dropped.\n   The nodes MUST still signal an RPS request with the MS\
    \ code.\n   Multiple EXER requests MUST be allowed to coexist in the ring.\n \
    \  A node in a ring-switching state that receives the external command\n   LP\
    \ for the affected link MUST drop its switch and MUST signal NR for\n   the locked\
    \ link if there is no other RPS request on another link.\n   The node still SHOULD\
    \ signal a relevant RPS request for another link.\n"
- title: 5.2.3.3.  Pass-Through State
  contents:
  - "5.2.3.3.  Pass-Through State\n   When a node is in a pass-through state, it MUST\
    \ transfer the received\n   RPS request unchanged in the same direction.\n   When\
    \ a node is in a pass-through state, it MUST enable the traffic\n   flow on protection\
    \ ring tunnels in both directions.\n"
- title: 5.2.4.  RPS State Transitions
  contents:
  - "5.2.4.  RPS State Transitions\n   All state transitions are triggered by an incoming\
    \ RPS request\n   change, a WTR expiration, an externally initiated command, or\
    \ locally\n   detected MPLS-TP section failure conditions.\n   RPS requests due\
    \ to a locally detected failure, an externally\n   initiated command, or a received\
    \ RPS request shall preempt existing\n   RPS requests in the prioritized order\
    \ given in Section 5.2.2, unless\n   the requests are allowed to coexist.\n"
- title: 5.2.4.1.  Transitions between Idle and Pass-Through States
  contents:
  - "5.2.4.1.  Transitions between Idle and Pass-Through States\n   The transition\
    \ from the idle state to pass-through state MUST be\n   triggered by a valid RPS\
    \ request change, in any direction, from the\n   NR code to any other code, as\
    \ long as the new request is not destined\n   to the node itself.  Both directions\
    \ move then into a pass-through\n   state, so that traffic entering the node through\
    \ the protection ring\n   tunnels are transferred transparently through the node.\n\
    \   A node MUST revert from pass-through state to the idle state when an\n   RPS\
    \ request with an NR code is received in both directions.  Then\n   both directions\
    \ revert simultaneously from the pass-through state to\n   the idle state.\n"
- title: 5.2.4.2.  Transitions between Idle and Switching States
  contents:
  - "5.2.4.2.  Transitions between Idle and Switching States\n   Transition of a node\
    \ from the idle state to the switching state MUST\n   be triggered by one of the\
    \ following conditions:\n   o  A valid RPS request change from the NR code to\
    \ any code received\n      on either the long or the short path and is destined\
    \ to this node\n   o  An externally initiated command for this node\n   o  The\
    \ detection of an MPLS-TP section-layer failure at this node\n   Actions taken\
    \ at a node in the idle state upon transition to the\n   switching state are:\n\
    \   o  For all protection-switch requests, except EXER and LP, the node\n    \
    \  MUST execute the switch\n   o  For EXER, and LP, the node MUST signal the appropriate\
    \ request but\n      not execute the switch\n   In one of the following conditions,\
    \ transition from the switching\n   state to the idle state MUST be triggered:\n\
    \   o  On the node that triggers the protection switching, when the WTR\n    \
    \  time expires or an externally initiated command is cleared, the\n      node\
    \ MUST transit from switching state to Idle State and signal\n      the NR code\
    \ using RPS message in both directions.\n   o  On the node that enters the switching\
    \ state due to the received\n      RPS request: upon reception of the NR code\
    \ from both directions,\n      the head-end node MUST drop its switch, transition\
    \ to idle state,\n      and signal the NR code in both directions.\n"
- title: 5.2.4.3.  Transitions between Switching States
  contents:
  - "5.2.4.3.  Transitions between Switching States\n   When a node that is currently\
    \ executing any protection switch\n   receives a higher-priority RPS request (due\
    \ to a locally detected\n   failure, an externally initiated command, or a ring\
    \ protection switch\n   request destined to it) for the same link, it MUST update\
    \ the\n   priority of the switch it is executing to the priority of the\n   received\
    \ RPS request.\n   When a failure condition clears at a node, the node MUST enter\
    \ WTR\n   condition and remain in it for the appropriate time-out interval,\n\
    \   unless:\n   o  A different RPS request with a higher priority than WTR is\n\
    \      received\n   o  Another failure is detected\n   o  An externally initiated\
    \ command becomes active\n   The node MUST send out a WTR code on both the long\
    \ and short paths.\n   When a node that is executing a switch in response to an\
    \ incoming SF\n   RPS request (not due to a locally detected failure) receives\
    \ a WTR\n   code (unidirectional failure case), it MUST send out the RR code on\n\
    \   the short path and the WTR on the long path.\n"
- title: 5.2.4.4.  Transitions between Switching and Pass-Through States
  contents:
  - "5.2.4.4.  Transitions between Switching and Pass-Through States\n   When a node\
    \ that is currently executing a switch receives an RPS\n   request for a non-adjacent\
    \ link of higher priority than the switch it\n   is executing, it MUST drop its\
    \ switch immediately and enter the pass-\n   through state.\n   The transition\
    \ of a node from pass-through to switching state MUST be\n   triggered by:\n \
    \  o  An equal priority, a higher priority, or an allowed coexisting\n      externally\
    \ initiated command\n   o  The detection of an equal priority, a higher priority,\
    \ or an\n      allowed coexisting automatic initiated command\n   o  The receipt\
    \ of an equal, a higher priority, or an allowed\n      coexisting RPS request\
    \ destined to this node\n"
- title: 5.3.  RPS State Machine
  contents:
  - '5.3.  RPS State Machine

    '
- title: 5.3.1.  Switch Initiation Criteria
  contents:
  - '5.3.1.  Switch Initiation Criteria

    '
- title: 5.3.1.1.  Administrative Commands
  contents:
  - "5.3.1.1.  Administrative Commands\n   Administrative commands can be initiated\
    \ by the network operator\n   through the Network Management System (NMS).  The\
    \ operator command\n   may be transmitted to the appropriate node via the MPLS-TP\
    \ RPS\n   message.\n   The following commands can be transferred by the RPS message:\n\
    \   o  Lockout of Protection (LP): This command prevents any protection\n    \
    \  activity and prevents using ring switches anywhere in the ring.\n      If any\
    \ ring switches exist in the ring, this command causes the\n      switches to\
    \ drop.\n   o  Forced Switch (FS) to protection: This command performs the ring\n\
    \      switch of normal traffic from the working entity to the protection\n  \
    \    entity for the link between the node at which the command is\n      initiated\
    \ and the adjacent node to which the command is directed.\n      This switch occurs\
    \ regardless of the state of the MPLS-TP section\n      for the requested link,\
    \ unless a higher-priority switch request\n      exists.\n   o  Manual Switch\
    \ (MS) to protection: This command performs the ring\n      switch of the normal\
    \ traffic from the working entity to the\n      protection entity for the link\
    \ between the node at which the\n      command is initiated and the adjacent node\
    \ to which the command is\n      directed.  This occurs if the MPLS-TP section\
    \ for the requested\n      link is not satisfying an equal or higher priority\
    \ switch request.\n   o  Exercise (EXER): This command exercises ring protection\
    \ switching\n      on the addressed link without completing the actual switch.\
    \  The\n      command is issued and the responses (RRs) are checked, but no\n\
    \      normal traffic is affected.\n   The following commands are not transferred\
    \ by the RPS message:\n   o  Clear: This command clears the administrative command\
    \ and WTR\n      timer at the node to which the command was addressed.  The\n\
    \      node-to-node signaling after the removal of the externally\n      initiated\
    \ commands is performed using the NR code.\n   o  Lockout of Working (LW): This\
    \ command prevents the normal traffic\n      transported over the addressed link\
    \ from being switched to the\n      protection entity by disabling the node's\
    \ capability of requesting\n      a switch for this link in case of failure. \
    \ If any normal traffic\n      is already switched on the protection entity, the\
    \ switch is\n      dropped.  If no other switch requests are active on the ring,\
    \ the\n      NR code is transmitted.  This command has no impact on any other\n\
    \      link.  If the node receives the switch request from the adjacent\n    \
    \  node from any side, it will perform the requested switch.  If the\n      node\
    \ receives the switch request addressed to the other node, it\n      will enter\
    \ the pass-through state.\n"
- title: 5.3.1.2.  Automatically Initiated Commands
  contents:
  - "5.3.1.2.  Automatically Initiated Commands\n   Automatically initiated commands\
    \ can be initiated based on MPLS-TP\n   section-layer OAM indication and the received\
    \ switch requests.\n   The node can initiate the following switch requests automatically:\n\
    \   o  Signal Fail (SF): This command is issued when the MPLS-TP section-\n  \
    \    layer OAM detects a signal failure condition.\n   o  Wait-to-Restore (WTR):\
    \ This command is issued when the MPLS-TP\n      section detects that the SF condition\
    \ has cleared.  It is used to\n      maintain the state during the WTR period\
    \ unless it is preempted by\n      a higher-priority switch request.  The WTR\
    \ time may be configured\n      by the operator in 1 minute steps between 0 and\
    \ 12 minutes; the\n      default value is 5 minutes.\n   o  Reverse Request (RR):\
    \ This command is transmitted to the source\n      node of the received RPS message\
    \ over the short path as an\n      acknowledgment for receiving the switch request.\n"
- title: 5.3.2.  Initial States
  contents:
  - "5.3.2.  Initial States\n   This section describes the possible states of a ring\
    \ node, the\n   corresponding action of the working and protection ring tunnels\
    \ on\n   the node, and the RPS request that should be generated in that state.\n\
    \            +-----------------------------------+----------------+\n        \
    \    |        State                      |  Signaled RPS  |\n            +-----------------------------------+----------------+\n\
    \            |  A  |  Idle                       |  NR            |\n        \
    \    |     |  Working: no switch         |                |\n            |   \
    \  |  Protection: no switch      |                |\n            +-----+-----------------------------+----------------+\n\
    \            |  B  |  Pass-through               |  N/A           |\n        \
    \    |     |  Working: no switch         |                |\n            |   \
    \  |  Protection: pass-through   |                |\n            +-----+-----------------------------+----------------+\n\
    \            |  C  |  Switching - LP             |  LP            |\n        \
    \    |     |  Working: no switch         |                |\n            |   \
    \  |  Protection: no switch      |                |\n            +-----+-----------------------------+----------------+\n\
    \            |  D  |  Idle - LW                  |  NR            |\n        \
    \    |     |  Working: no switch         |                |\n            |   \
    \  |  Protection: no switch      |                |\n            +-----+-----------------------------+----------------+\n\
    \            |  E  |  Switching - FS             |  FS            |\n        \
    \    |     |  Working: switched          |                |\n            |   \
    \  |  Protection: switched       |                |\n            +-----+-----------------------------+----------------+\n\
    \            |  F  |  Switching - SF             |  SF            |\n        \
    \    |     |  Working: switched          |                |\n            |   \
    \  |  Protection: switched       |                |\n            +-----+-----------------------------+----------------+\n\
    \            |  G  |  Switching - MS             |  MS            |\n        \
    \    |     |  Working: switched          |                |\n            |   \
    \  |  Protection: switched       |                |\n            +-----+-----------------------------+----------------+\n\
    \            |  H  |  Switching - WTR            |  WTR           |\n        \
    \    |     |  Working: switched          |                |\n            |   \
    \  |  Protection: switched       |                |\n            +-----+-----------------------------+----------------+\n\
    \            |  I  |  Switching - EXER           |  EXER          |\n        \
    \    |     |  Working: no switch         |                |\n            |   \
    \  |  Protection: no switch      |                |\n            +-----+-----------------------------+----------------+\n"
- title: 5.3.3.  State Transitions When Local Request Is Applied
  contents:
  - "5.3.3.  State Transitions When Local Request Is Applied\n   In the state description\
    \ below, 'O' means that a new local request\n   will be rejected because of an\
    \ existing request.\n   =====================================================================\n\
    \   Initial state        New request       New state\n   -------------       \
    \ -----------       ---------\n   A (Idle)             LP                C (Switching\
    \ - LP)\n                        LW                D (Idle - LW)\n           \
    \             FS                E (Switching - FS)\n                        SF\
    \                F (Switching - SF)\n                        Recover from SF \
    \  N/A\n                        MS                G (Switching - MS)\n       \
    \                 Clear             N/A\n                        WTR expires \
    \      N/A\n                        EXER              I (Switching - EXER)\n \
    \  =====================================================================\n   Initial\
    \ state        New request       New state\n   -------------        -----------\
    \       ---------\n   B (Pass-through)     LP                C (Switching - LP)\n\
    \                        LW                B (Pass-through)\n                \
    \        FS                O - if current state is due to\n                  \
    \                            LP sent by another node\n                       \
    \                   E (Switching - FS) - otherwise\n                        SF\
    \                O - if current state is due to\n                            \
    \                  LP sent by another node\n                                 \
    \         F (Switching - SF) - otherwise\n                        Recover from\
    \ SF   N/A\n                        MS                O - if current state is\
    \ due to\n                                              LP, SF, or FS sent by\n\
    \                                              another node\n                \
    \                          G (Switching - MS) - otherwise\n                  \
    \      Clear             N/A\n                        WTR expires       N/A\n\
    \                        EXER              O\n   =====================================================================\n\
    \   Initial state        New request       New state\n   -------------       \
    \ -----------       ---------\n   C (Switching - LP)   LP                N/A\n\
    \                        LW                O\n                        FS     \
    \           O\n                        SF                O\n                 \
    \       Recover from SF   N/A\n                        MS                O\n \
    \                       Clear             A (Idle) - if there is no\n        \
    \                                     failure in the ring\n                  \
    \                        F (Switching - SF) - if there\n                     \
    \                        is a failure at this node\n                         \
    \                 B (Pass-through) - if there is\n                           \
    \                  a failure at another node\n                        WTR expires\
    \       N/A\n                        EXER              O\n   =====================================================================\n\
    \   Initial state        New request       New state\n   -------------       \
    \ -----------       ---------\n   D (Idle - LW)        LP                C (Switching\
    \ - LP)\n                        LW                N/A - if on the same link\n\
    \                                          D (Idle - LW) - if on another\n   \
    \                                          link\n                        FS  \
    \              O - if on the same link\n                                     \
    \     E (Switching - FS) - if on\n                                           \
    \  another link\n                        SF                O - if on the addressed\
    \ link\n                                          F (Switching - SF) - if on\n\
    \                                             another link\n                 \
    \       Recover from SF   N/A\n                        MS                O - if\
    \ on the same link\n                                          G (Switching - MS)\
    \ - if on\n                                             another link\n       \
    \                 Clear             A (Idle) - if there is no\n              \
    \                               failure on addressed link\n                  \
    \                        F (Switching - SF) - if there\n                     \
    \                        is a failure on this link\n                        WTR\
    \ expires       N/A\n                        EXER              O\n   =====================================================================\n\
    \   Initial state        New request       New state\n   -------------       \
    \ -----------       ---------\n   E (Switching - FS)   LP                C (Switching\
    \ - LP)\n                        LW                O - if on another link\n  \
    \                                        D (Idle - LW) - if on the same\n    \
    \                                         link\n                        FS   \
    \             N/A - if on the same link\n                                    \
    \      E (Switching - FS) - if on\n                                          \
    \   another link\n                        SF                O - if on the addressed\
    \ link\n                                          E (Switching - FS) - if on\n\
    \                                             another link\n                 \
    \       Recover from SF   N/A\n                        MS                O\n \
    \                       Clear             A (Idle) - if there is no\n        \
    \                                     failure in the ring\n                  \
    \                        F (Switching - SF) - if there\n                     \
    \                        is a failure at this node\n                         \
    \                 B (Pass-through) - if there is\n                           \
    \                  a failure at another node\n                        WTR expires\
    \       N/A\n                        EXER              O\n   =====================================================================\n\
    \   Initial state        New request       New state\n   -------------       \
    \ -----------       ---------\n   F (Switching - SF)   LP                C (Switching\
    \ - LP)\n                        LW                O - if on another link\n  \
    \                                        D (Idle - LW) - if on the same\n    \
    \                                         link\n                        FS   \
    \             E (Switching - FS)\n                        SF                N/A\
    \ - if on the same link\n                                          F (Switching\
    \ - SF) - if on\n                                             another link\n \
    \                       Recover from SF   H (Switching - WTR)\n              \
    \          MS                O\n                        Clear             N/A\n\
    \                        WTR expires       N/A\n                        EXER \
    \             O\n   =====================================================================\n\
    \   Initial state        New request       New state\n   -------------       \
    \ -----------       ---------\n   G (Switching - MS)   LP                C (Switching\
    \ - LP)\n                        LW                O - if on another link\n  \
    \                                        D (Idle - LW) - if on the same\n    \
    \                                         link\n                        FS   \
    \             E (Switching - FS)\n                        SF                F\
    \ (Switching - SF)\n                        Recover from SF   N/A\n          \
    \              MS                N/A - if on the same link\n                 \
    \                         G (Switching - MS) - if on\n                       \
    \                      another link, release the\n                           \
    \                  switches but signal MS\n                        Clear     \
    \        A\n                        WTR expires       N/A\n                  \
    \      EXER              O\n   =====================================================================\n\
    \   Initial state        New request       New state\n   -------------       \
    \ -----------       ---------\n   H (Switching - WTR)  LP                C (Switching\
    \ - LP)\n                        LW                D (Idle - W)\n            \
    \            FS                E (Switching - FS)\n                        SF\
    \                F (Switching - SF)\n                        Recover from SF \
    \  N/A\n                        MS                G (Switching - MS)\n       \
    \                 Clear             A\n                        WTR expires   \
    \    A\n                        EXER              O\n   =====================================================================\n\
    \   Initial state        New request       New state\n   -------------       \
    \ -----------       ---------\n   I (Switching - EXER) LP                C (Switching\
    \ - LP)\n                        LW                D (Idle - W)\n            \
    \            FS                E (Switching - FS)\n                        SF\
    \                F (Switching - SF)\n                        Recover from SF \
    \  N/A\n                        MS                G (Switching - MS)\n       \
    \                 Clear             A\n                        WTR expires   \
    \    N/A\n                        EXER              N/A - if on the same link\n\
    \                                          I (Switching - EXER)\n   =====================================================================\n"
- title: 5.3.4.  State Transitions When Remote Request is Applied
  contents:
  - "5.3.4.  State Transitions When Remote Request is Applied\n   The priority of\
    \ a remote request does not depend on the side from\n   which the request is received.\n\
    \   =====================================================================\n  \
    \ Initial state        New request       New state\n   -------------        -----------\
    \       ---------\n   A (Idle)             LP                C (Switching - LP)\n\
    \                        FS                E (Switching - FS)\n              \
    \          SF                F (Switching - SF)\n                        MS  \
    \              G (Switching - MS)\n                        WTR               N/A\n\
    \                        EXER              I (Switching - EXER)\n            \
    \            RR                N/A\n                        NR               \
    \ A (Idle)\n   =====================================================================\n\
    \   Initial state        New request       New state\n   -------------       \
    \ -----------       ---------\n   B (Pass-through)     LP                C (Switching\
    \ - LP)\n                        FS                N/A - cannot happen when there\n\
    \                                                is an LP request in the\n   \
    \                                             ring\n                         \
    \                 E (Switching - FS) - otherwise\n                        SF \
    \               N/A - cannot happen when there\n                             \
    \                   is an LP request in the\n                                \
    \                ring\n                                          F (Switching\
    \ - SF) - otherwise\n                        MS                N/A - cannot happen\
    \ when there\n                                                is an LP, FS, or\
    \ SF\n                                                request in the ring\n  \
    \                                        G (Switching - MS) - otherwise\n    \
    \                    WTR               N/A - cannot happen when there\n      \
    \                                          is an LP, FS, SF, or MS\n         \
    \                                       request in the ring\n                \
    \        EXER              N/A - cannot happen when there\n                  \
    \                              is an LP, FS, SF, MS, or\n                    \
    \                            a WTR request in the\n                          \
    \                      ring\n                                          I (Switching\
    \ - EXER) -\n                                                otherwise\n     \
    \                   RR                N/A\n                        NR        \
    \        A (Idle) - if received from\n                                       \
    \              both sides\n   =====================================================================\n\
    \   Initial state        New request       New state\n   -------------       \
    \ -----------       ---------\n   C (Switching - LP)   LP                C (Switching\
    \ - LP)\n                        FS                N/A - cannot happen when there\n\
    \                                                is an LP request in the\n   \
    \                                             ring\n                        SF\
    \                N/A - cannot happen when there\n                            \
    \                    is an LP request in the\n                               \
    \                 ring\n                        MS                N/A - cannot\
    \ happen when there\n                                                is an LP\
    \ request in the\n                                                ring\n     \
    \                   WTR               N/A\n                        EXER      \
    \        N/A - cannot happen when there\n                                    \
    \            is an LP request in the\n                                       \
    \         ring\n                        RR                C (Switching - LP)\n\
    \                        NR                N/A\n   =====================================================================\n\
    \   Initial state        New request       New state\n   -------------       \
    \ -----------       ---------\n   D (Idle - LW)        LP                C (Switching\
    \ - LP)\n                        FS                E (Switching - FS)\n      \
    \                  SF                F (Switching - SF)\n                    \
    \    MS                G (Switching - MS)\n                        WTR       \
    \        N/A\n                        EXER              I (Switching - EXER)\n\
    \                        RR                N/A\n                        NR   \
    \             D (Idle - LW)\n   =====================================================================\n\
    \   Initial state        New request       New state\n   -------------       \
    \ -----------       ---------\n   E (Switching - FS)   LP                C (Switching\
    \ - LP)\n                        FS                E (Switching - FS)\n      \
    \                  SF                E (Switching - FS)\n                    \
    \    MS                N/A - cannot happen when there\n                      \
    \                          is an FS request in the\n                         \
    \                       ring\n                        WTR               N/A\n\
    \                        EXER              N/A - cannot happen when there\n  \
    \                                              is an FS request in the\n     \
    \                                           ring\n                        RR \
    \               E (Switching - FS)\n                        NR               \
    \ N/A\n   =====================================================================\n\
    \   Initial state        New request       New state\n   -------------       \
    \ -----------       ---------\n   F (Switching - SF)   LP                C (Switching\
    \ - LP)\n                        FS                F (Switching - SF)\n      \
    \                  SF                F (Switching - SF)\n                    \
    \    MS                N/A - cannot happen when there\n                      \
    \                          is an SF request in the\n                         \
    \                       ring\n                        WTR               N/A\n\
    \                        EXER              N/A - cannot happen when there\n  \
    \                                              is an SF request in the\n     \
    \                                           ring\n                        RR \
    \               F (Switching - SF)\n                        NR               \
    \ N/A\n   =====================================================================\n\
    \   Initial state        New request       New state\n   -------------       \
    \ -----------       ---------\n   G (Switching - MS)   LP                C (Switching\
    \ - LP)\n                        FS                E (Switching - FS)\n      \
    \                  SF                F (Switching - SF)\n                    \
    \    MS                G (Switching - MS) - release\n                        \
    \                     the switches but signal MS\n                        WTR\
    \               N/A\n                        EXER              N/A - cannot happen\
    \ when there\n                                                is an MS request\
    \ in the\n                                                ring\n             \
    \           RR                G (Switching - MS)\n                        NR \
    \               N/A\n   =====================================================================\n\
    \   Initial state        New request       New state\n   -------------       \
    \ -----------       ---------\n   H (Switching - WTR)  LP                C (Switching\
    \ - LP)\n                        FS                E (Switching - FS)\n      \
    \                  SF                F (Switching - SF)\n                    \
    \    MS                G (Switching - MS)\n                        WTR       \
    \        H (Switching - WTR)\n                        EXER              N/A -\
    \ cannot happen when there\n                                                is\
    \ a WTR request in the\n                                                ring\n\
    \                        RR                H (Switching - WTR)\n             \
    \           NR                N/A\n   =====================================================================\n\
    \   Initial state        New request       New state\n   -------------       \
    \ -----------       ---------\n   I (Switching - EXER) LP                C (Switching\
    \ - LP)\n                        FS                E (Switching - FS)\n      \
    \                  SF                F (Switching - SF)\n                    \
    \    MS                G (Switching - MS)\n                        WTR       \
    \        N/A\n                        EXER              I (Switching - EXER)\n\
    \                        RR                I (Switching - EXER)\n            \
    \            NR                N/A\n   =====================================================================\n"
- title: 5.3.5.  State Transitions When Request Addresses to Another Node is
  contents:
  - "5.3.5.  State Transitions When Request Addresses to Another Node is\n       \
    \ Received\n   The priority of a remote request does not depend on the side from\n\
    \   which the request is received.\n   =====================================================================\n\
    \   Initial state        New request       New state\n   -------------       \
    \ -----------       ---------\n   A (Idle)             LP                B (Pass-through)\n\
    \                        FS                B (Pass-through)\n                \
    \        SF                B (Pass-through)\n                        MS      \
    \          B (Pass-through)\n                        WTR               B (Pass-through)\n\
    \                        EXER              B (Pass-through)\n                \
    \        RR                N/A\n                        NR                N/A\n\
    \   =====================================================================\n  \
    \ Initial state        New request       New state\n   -------------        -----------\
    \       ---------\n   B (Pass-through)     LP                B (Pass-through)\n\
    \                        FS                N/A - cannot happen when there\n  \
    \                                              is an LP request in the\n     \
    \                                           ring\n                           \
    \               B (Pass-through) - otherwise\n                        SF     \
    \           N/A - cannot happen when there\n                                 \
    \               is an LP request in the\n                                    \
    \            ring\n                                          B (Pass-through)\
    \ - otherwise\n                        MS                N/A - cannot happen when\
    \ there\n                                                is an LP, FS, or SF\n\
    \                                                request in the ring\n       \
    \                                   B (Pass-through) - otherwise\n           \
    \             WTR               N/A - cannot happen when there\n             \
    \                                   is an LP, FS, SF, or MS\n                \
    \                                request in the ring\n                       \
    \                   B (Pass-through) - otherwise\n                        EXER\
    \              N/A - cannot happen when there\n                              \
    \                  is an LP, FS, SF, MS, or\n                                \
    \                a WTR request in the\n                                      \
    \          ring\n                                          B (Pass-through) -\
    \ otherwise\n                        RR                N/A\n                 \
    \       NR                N/A\n   =====================================================================\n\
    \   Initial state        New request       New state\n   -------------       \
    \ -----------       ---------\n   C (Switching - LP)   LP                C (Switching\
    \ - LP)\n                        FS                N/A - cannot happen when there\n\
    \                                                is an LP request in the\n   \
    \                                             ring\n                        SF\
    \                N/A - cannot happen when there\n                            \
    \                    is an LP request in the\n                               \
    \                 ring\n                        MS                N/A - cannot\
    \ happen when there\n                                                is an LP\
    \ request in the\n                                                ring\n     \
    \                   WTR               N/A - cannot happen when there\n       \
    \                                         is an LP request in the\n          \
    \                                      ring\n                        EXER    \
    \          N/A - cannot happen when there\n                                  \
    \              is an LP request in the\n                                     \
    \           ring\n                        RR                N/A\n            \
    \            NR                N/A\n   =====================================================================\n\
    \   Initial state        New request       New state\n   -------------       \
    \ -----------       ---------\n   D (Idle - LW)        LP                B (Pass-through)\n\
    \                        FS                B (Pass-through)\n                \
    \        SF                B (Pass-through)\n                        MS      \
    \          B (Pass-through)\n                        WTR               B (Pass-through)\n\
    \                        EXER              B (Pass-through)\n                \
    \        RR                N/A\n                        NR                N/A\n\
    \   =====================================================================\n  \
    \ Initial state        New request       New state\n   -------------        -----------\
    \       ---------\n   E (Switching - FS)   LP                B (Pass-through)\n\
    \                        FS                E (Switching - FS)\n              \
    \          SF                E (Switching - FS)\n                        MS  \
    \              N/A - cannot happen when there\n                              \
    \                  is an FS request in the\n                                 \
    \               ring\n                        WTR               N/A - cannot happen\
    \ when there\n                                                is an FS request\
    \ in the\n                                                ring\n             \
    \           EXER              N/A - cannot happen when there\n               \
    \                                 is an FS request in the\n                  \
    \                              ring\n                        RR              \
    \  N/A\n                        NR                N/A\n   =====================================================================\n\
    \   Initial state        New request       New state\n   -------------       \
    \ -----------       ---------\n   F (Switching - SF)   LP                B (Pass-through)\n\
    \                        FS                F (Switching - SF)\n              \
    \          SF                F (Switching - SF)\n                        MS  \
    \              N/A - cannot happen when there\n                              \
    \                  is an SF request in the\n                                 \
    \               ring\n                        WTR               N/A - cannot happen\
    \ when there\n                                                is an SF request\
    \ in the\n                                                ring\n             \
    \           EXER              N/A - cannot happen when there\n               \
    \                                 is an SF request in the\n                  \
    \                              ring\n                        RR              \
    \  N/A\n                        NR                N/A\n   =====================================================================\n\
    \   Initial state        New request       New state\n   -------------       \
    \ -----------       ---------\n   G (Switching - MS)   LP                B (Pass-through)\n\
    \                        FS                B (Pass-through)\n                \
    \        SF                B (Pass-through)\n                        MS      \
    \          G (Switching - MS) - release\n                                    \
    \         the switches but signal MS\n                        WTR            \
    \   N/A - cannot happen when there\n                                         \
    \       is an MS request in the\n                                            \
    \    ring\n                        EXER              N/A - cannot happen when\
    \ there\n                                                is an MS request in the\n\
    \                                                ring\n                      \
    \  RR                N/A\n                        NR                N/A\n   =====================================================================\n\
    \   Initial state        New request       New state\n   -------------       \
    \ -----------       ---------\n   H (Switching - WTR)  LP                B (Pass-through)\n\
    \                        FS                B (Pass-through)\n                \
    \        SF                B (Pass-through)\n                        MS      \
    \          B (Pass-through)\n                        WTR               N/A\n \
    \                       EXER              N/A - cannot happen when there\n   \
    \                                             is a WTR request in the\n      \
    \                                          ring\n                        RR  \
    \              N/A\n                        NR                N/A\n   =====================================================================\n\
    \   Initial state        New request       New state\n   -------------       \
    \ -----------       ---------\n   I (Switching - EXER) LP                B (Pass-through)\n\
    \                        FS                B (Pass-through)\n                \
    \        SF                B (Pass-through)\n                        MS      \
    \          B (Pass-through)\n                        WTR               N/A\n \
    \                       EXER              I (Switching - EXER)\n             \
    \           RR                N/A\n                        NR                N/A\n\
    \   =====================================================================\n"
- title: 6.  IANA Considerations
  contents:
  - "6.  IANA Considerations\n   IANA has assigned the values listed in the sections\
    \ below.\n"
- title: 6.1.  G-ACh Channel Type
  contents:
  - "6.1.  G-ACh Channel Type\n   The Channel Types for G-ACh are allocated from the\
    \ PW Associated\n   Channel Type registry defined in [RFC4446] and updated by\
    \ [RFC5586].\n   IANA has allocated the following new G-ACh Channel Type in the\
    \ \"MPLS\n   Generalized Associated Channel (G-ACh) Types (including Pseudowire\n\
    \   Associated Channel Types)\" registry:\n      Value |          Description\
    \            | Reference\n     -------+---------------------------------+--------------\n\
    \     0x002A | Ring Protection Switching (RPS) | this document\n            |\
    \ Protocol                        |\n     -------+---------------------------------+--------------\n"
- title: 6.2.  RPS Request Codes
  contents:
  - "6.2.  RPS Request Codes\n   IANA has created the subregistry \"MPLS RPS Request\
    \ Code Registry\"\n   under the \"Generic Associated Channel (G-ACh) Parameters\"\
    \ registry.\n   All code points within this registry shall be allocated according\
    \ to\n   the \"Specification Required\" procedure as specified in [RFC8126].\n\
    \   The RPS request field is 8 bits; the allocated values are as follows:\n  \
    \    Value    Description                  Reference\n      -------  ---------------------------\
    \  -------------\n         0     No Request (NR)              this document\n\
    \         1     Reverse Request (RR)         this document\n         2     Unassigned\n\
    \         3     Exercise (EXER)              this document\n         4     Unassigned\n\
    \         5     Wait-to-Restore (WTR)        this document\n         6     Manual\
    \ Switch (MS)           this document\n        7-10   Unassigned\n        11 \
    \    Signal Fail (SF)             this document\n        12     Unassigned\n \
    \       13     Forced Switch (FS)           this document\n        14     Unassigned\n\
    \        15     Lockout of Protection (LP)   this document\n      16-254   Unassigned\n\
    \        255    Reserved\n"
- title: 7.  Operational Considerations
  contents:
  - "7.  Operational Considerations\n   This document describes three protection modes\
    \ of the RPS protocol.\n   Operators could choose the appropriate protection mode\
    \ according to\n   their network and service requirement.\n   Wrapping mode provides\
    \ a ring protection mechanism in which the\n   protected traffic will reach every\
    \ node of the ring and is applicable\n   to protect both the point-to-point LSPs\
    \ and LSPs that need to be\n   dropped in several ring nodes, i.e., the point-to-multipoint\n\
    \   applications.  When protection is inactive, the protected traffic is\n   switched\
    \ (wrapped) to/from the protection ring tunnel at both sides\n   of the defective\
    \ link/node.  Due to the wrapping, the additional\n   propagation delay and bandwidth\
    \ consumption of the protection tunnel\n   are considerable.  For bidirectional\
    \ LSPs, the protected traffic in\n   both directions is co-routed.\n   Short-wrapping\
    \ mode provides a ring protection mechanism that can be\n   used to protect only\
    \ point-to-point LSPs.  When protection is\n   inactive, the protected traffic\
    \ is wrapped to the protection ring\n   tunnel at the defective link/node and\
    \ leaves the ring when the\n   protection ring tunnel reaches the egress node.\
    \  Compared with the\n   wrapping mode, short-wrapping can reduce the propagation\
    \ latency and\n   bandwidth consumption of the protection tunnel.  However, the\
    \ two\n   directions of a protected bidirectional LSP are not totally co-\n  \
    \ routed.\n   Steering mode provides a ring protection mechanism that can be used\n\
    \   to protect only point-to-point LSPs.  When protection is inactive,\n   the\
    \ protected traffic is switched to the protection ring tunnel at\n   the ingress\
    \ node and leaves the ring when the protection ring tunnel\n   reaches the egress\
    \ node.  The steering mode has the least propagation\n   delay and bandwidth consumption\
    \ of the three modes, and the two\n   directions of a protected bidirectional\
    \ LSP can be kept co-routed.\n   Note that only one protection mode can be provisioned\
    \ in the whole\n   ring for all protected traffic.\n"
- title: 8.  Security Considerations
  contents:
  - "8.  Security Considerations\n   MPLS-TP is a subset of MPLS, thus it builds upon\
    \ many of the aspects\n   of the security model of MPLS.  Please refer to [RFC5920]\
    \ for generic\n   MPLS security issues and methods for securing traffic privacy\
    \ and\n   integrity.\n   The RPS message defined in this document is used for\
    \ protection\n   coordination on the ring; if it is injected or modified by an\n\
    \   attacker, the ring nodes might not agree on the protection action,\n   and\
    \ the improper protection-switching action may cause a temporary\n   break to\
    \ services traversing the ring.  It is important that the RPS\n   message is used\
    \ within a trusted MPLS-TP network domain as described\n   in [RFC6941].\n   The\
    \ RPS message is carried in the G-ACh [RFC5586], so it is dependent\n   on the\
    \ security of the G-ACh itself.  The G-ACh is a generalization\n   of the Associated\
    \ Channel defined in [RFC4385].  Thus, this document\n   relies on the security\
    \ mechanisms provided for the Associated Channel\n   as described in those two\
    \ documents.\n   As described in the security considerations of [RFC6378], the\
    \ G-ACh\n   is essentially connection oriented, so injection or modification of\n\
    \   control messages requires the subversion of a transit node.  Such\n   subversion\
    \ is generally considered hard in connection-oriented MPLS\n   networks and impossible\
    \ to protect against at the protocol level.\n   Management-level techniques are\
    \ more appropriate.  The procedures and\n   protocol extensions defined in this\
    \ document do not affect the\n   security model of MPLS-TP linear protection as\
    \ defined in [RFC6378].\n"
- title: 9.  References
  contents:
  - '9.  References

    '
- title: 9.1.  Normative References
  contents:
  - "9.1.  Normative References\n   [RFC2119]  Bradner, S., \"Key words for use in\
    \ RFCs to Indicate\n              Requirement Levels\", BCP 14, RFC 2119,\n  \
    \            DOI 10.17487/RFC2119, March 1997,\n              <https://www.rfc-editor.org/info/rfc2119>.\n\
    \   [RFC3031]  Rosen, E., Viswanathan, A., and R. Callon, \"Multiprotocol\n  \
    \            Label Switching Architecture\", RFC 3031,\n              DOI 10.17487/RFC3031,\
    \ January 2001,\n              <https://www.rfc-editor.org/info/rfc3031>.\n  \
    \ [RFC4385]  Bryant, S., Swallow, G., Martini, L., and D. McPherson,\n       \
    \       \"Pseudowire Emulation Edge-to-Edge (PWE3) Control Word for\n        \
    \      Use over an MPLS PSN\", RFC 4385, DOI 10.17487/RFC4385,\n             \
    \ February 2006, <https://www.rfc-editor.org/info/rfc4385>.\n   [RFC4446]  Martini,\
    \ L., \"IANA Allocations for Pseudowire Edge to Edge\n              Emulation\
    \ (PWE3)\", BCP 116, RFC 4446,\n              DOI 10.17487/RFC4446, April 2006,\n\
    \              <https://www.rfc-editor.org/info/rfc4446>.\n   [RFC5586]  Bocci,\
    \ M., Ed., Vigoureux, M., Ed., and S. Bryant, Ed.,\n              \"MPLS Generic\
    \ Associated Channel\", RFC 5586,\n              DOI 10.17487/RFC5586, June 2009,\n\
    \              <https://www.rfc-editor.org/info/rfc5586>.\n   [RFC5654]  Niven-Jenkins,\
    \ B., Ed., Brungard, D., Ed., Betts, M., Ed.,\n              Sprecher, N., and\
    \ S. Ueno, \"Requirements of an MPLS\n              Transport Profile\", RFC 5654,\
    \ DOI 10.17487/RFC5654,\n              September 2009, <https://www.rfc-editor.org/info/rfc5654>.\n\
    \   [RFC8174]  Leiba, B., \"Ambiguity of Uppercase vs Lowercase in RFC\n     \
    \         2119 Key Words\", BCP 14, RFC 8174, DOI 10.17487/RFC8174,\n        \
    \      May 2017, <https://www.rfc-editor.org/info/rfc8174>.\n"
- title: 9.2.  Informative References
  contents:
  - "9.2.  Informative References\n   [RFC5920]  Fang, L., Ed., \"Security Framework\
    \ for MPLS and GMPLS\n              Networks\", RFC 5920, DOI 10.17487/RFC5920,\
    \ July 2010,\n              <https://www.rfc-editor.org/info/rfc5920>.\n   [RFC6371]\
    \  Busi, I., Ed. and D. Allan, Ed., \"Operations,\n              Administration,\
    \ and Maintenance Framework for MPLS-Based\n              Transport Networks\"\
    , RFC 6371, DOI 10.17487/RFC6371,\n              September 2011, <https://www.rfc-editor.org/info/rfc6371>.\n\
    \   [RFC6378]  Weingarten, Y., Ed., Bryant, S., Osborne, E., Sprecher,\n     \
    \         N., and A. Fulignoli, Ed., \"MPLS Transport Profile (MPLS-\n       \
    \       TP) Linear Protection\", RFC 6378, DOI 10.17487/RFC6378,\n           \
    \   October 2011, <https://www.rfc-editor.org/info/rfc6378>.\n   [RFC6941]  Fang,\
    \ L., Ed., Niven-Jenkins, B., Ed., Mansfield, S., Ed.,\n              and R. Graveman,\
    \ Ed., \"MPLS Transport Profile (MPLS-TP)\n              Security Framework\"\
    , RFC 6941, DOI 10.17487/RFC6941, April\n              2013, <https://www.rfc-editor.org/info/rfc6941>.\n\
    \   [RFC6974]  Weingarten, Y., Bryant, S., Ceccarelli, D., Caviglia, D.,\n   \
    \           Fondelli, F., Corsi, M., Wu, B., and X. Dai,\n              \"Applicability\
    \ of MPLS Transport Profile for Ring\n              Topologies\", RFC 6974, DOI\
    \ 10.17487/RFC6974, July 2013,\n              <https://www.rfc-editor.org/info/rfc6974>.\n\
    \   [RFC8126]  Cotton, M., Leiba, B., and T. Narten, \"Guidelines for\n      \
    \        Writing an IANA Considerations Section in RFCs\", BCP 26,\n         \
    \     RFC 8126, DOI 10.17487/RFC8126, June 2017,\n              <https://www.rfc-editor.org/info/rfc8126>.\n"
- title: Acknowledgements
  contents:
  - "Acknowledgements\n   The authors would like to thank Gregory Mirsky, Yimin Shen,\
    \ Eric\n   Osborne, Spencer Jackson, and Eric Gray for their valuable comments\n\
    \   and suggestions.\n"
- title: Contributors
  contents:
  - "Contributors\n   The following people contributed significantly to the content\
    \ of this\n   document and should be considered co-authors:\n   Kai Liu\n   Huawei\
    \ Technologies\n   Email: alex.liukai@huawei.com\n   Jia He\n   Huawei Technologies\n\
    \   Email: hejia@huawei.com\n   Fang Li\n   China Academy of Telecommunication\
    \ Research MIIT\n   China\n   Email: lifang@catr.cn\n   Jian Yang\n   ZTE Corporation\n\
    \   China\n   Email: yang.jian90@zte.com.cn\n   Junfang Wang\n   Fiberhome Telecommunication\
    \ Technologies Co., LTD.\n   Email: wjf@fiberhome.com.cn\n   Wen Ye\n   China\
    \ Mobile\n   Email: yewen@chinamobile.com\n   Minxue Wang\n   China Mobile\n \
    \  Email: wangminxue@chinamobile.com\n   Sheng Liu\n   China Mobile\n   Email:\
    \ liusheng@chinamobile.com\n   Guanghui Sun\n   Huawei Technologies\n   Email:\
    \ sunguanghui@huawei.com\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Weiqiang Cheng\n   China Mobile\n   Email: chengweiqiang@chinamobile.com\n\
    \   Lei Wang\n   China Mobile\n   Email: wangleiyj@chinamobile.com\n   Han Li\n\
    \   China Mobile\n   Email: lihan@chinamobile.com\n   Huub van Helvoort\n   Hai\
    \ Gaoming BV\n   Email: huubatwork@gmail.com\n   Jie Dong\n   Huawei Technologies\n\
    \   Email: jie.dong@huawei.com\n"
