- contents:
  - ''
  title: __initial_text__
- contents:
  - 'Multicast Control Extensions for the Access Node Control Protocol (ANCP)

    '
  title: Multicast Control Extensions for the Access Node Control Protocol (ANCP)
- contents:
  - "Abstract\n   This document specifies the extensions to the Access Node Control\n
    \  Protocol (ANCP) (RFC 6320) required for support of the multicast use\n   cases
    defined in the Access Node Control Protocol framework document\n   (RFC 5851)
    and one additional use case described in this document.\n   These use cases are
    organized into the following ANCP capabilities:\n   o  multicast replication initiated
    by the Network Access Server\n      (NAS);\n   o  conditional access and admission
    control with white and black\n      lists;\n   o  conditional access and admission
    control with grey lists;\n   o  bandwidth delegation; and\n   o  committed bandwidth
    reporting.\n   These capabilities may be combined according to the rules given
    in\n   this specification.\n   This document updates RFC 6320 by assigning capability
    type 3 to a\n   capability specified in this document and by changing the starting\n
    \  point for IANA allocation of result codes determined by IETF\n   Consensus
    from 0x100 to 0x64.\n"
  title: Abstract
- contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This
    document is a product of the Internet Engineering Task Force\n   (IETF).  It represents
    the consensus of the IETF community.  It has\n   received public review and has
    been approved for publication by the\n   Internet Engineering Steering Group (IESG).
    \ Further information on\n   Internet Standards is available in Section 2 of RFC
    5741.\n   Information about the current status of this document, any errata,\n
    \  and how to provide feedback on it may be obtained at\n   http://www.rfc-editor.org/info/rfc7256.\n"
  title: Status of This Memo
- contents:
  - "Copyright Notice\n   Copyright (c) 2014 IETF Trust and the persons identified
    as the\n   document authors.  All rights reserved.\n   This document is subject
    to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n
    \  (http://trustee.ietf.org/license-info) in effect on the date of\n   publication
    of this document.  Please review these documents\n   carefully, as they describe
    your rights and restrictions with respect\n   to this document.  Code Components
    extracted from this document must\n   include Simplified BSD License text as described
    in Section 4.e of\n   the Trust Legal Provisions and are provided without warranty
    as\n   described in the Simplified BSD License.\n"
  title: Copyright Notice
- contents:
  - "Table of Contents\n   1. Introduction ....................................................5\n
    \     1.1. A Note on Scope ............................................7\n   2.
    Terminology .....................................................7\n   3. Multicast
    Use Cases .............................................7\n      3.1. NAS-Initiated
    Multicast Replication Control Use Case .......8\n           3.1.1. Goals ...............................................8\n
    \          3.1.2. Message Flow ........................................9\n      3.2.
    Conditional Access and Admission Control Use Case ..........9\n           3.2.1.
    Goals ...............................................9\n           3.2.2. Message
    Flow .......................................10\n      3.3. Multicast Flow Reporting
    Use Case .........................11\n           3.3.1. Goals ..............................................11\n
    \          3.3.2. Message Flow .......................................11\n      3.4.
    Committed Bandwidth Reporting Use Case ....................11\n           3.4.1.
    Goals ..............................................11\n           3.4.2. Message
    Flow .......................................12\n   4. ANCP Messages ..................................................13\n
    \     4.1. Provisioning Message ......................................13\n           4.1.1.
    Sender Behavior ....................................14\n           4.1.2. Receiver
    Behavior ..................................14\n      4.2. Port Management Message
    ...................................15\n           4.2.1. Sender Behavior ....................................16\n
    \          4.2.2. Receiver Behavior ..................................16\n      4.3.
    Multicast Replication Control Message .....................17\n           4.3.1.
    Sender Behavior ....................................21\n           4.3.2. Receiver
    Behavior ..................................21\n      4.4. Multicast Admission
    Control Message .......................24\n           4.4.1. Sender Behavior ....................................25\n
    \          4.4.2. Receiver Behavior ..................................26\n      4.5.
    Bandwidth Reallocation Request Message ....................27\n           4.5.1.
    Sender Behavior ....................................28\n           4.5.2. Receiver
    Behavior ..................................28\n      4.6. Bandwidth Transfer Message
    ................................31\n           4.6.1. Sender Behavior ....................................32\n
    \          4.6.2. Receiver Behavior ..................................32\n      4.7.
    Delegated Bandwidth Query Request Message .................34\n           4.7.1.
    Sender Behavior ....................................34\n           4.7.2. Receiver
    Behavior ..................................34\n      4.8. Delegated Bandwidth
    Query Response Message ................34\n           4.8.1. Sender Behavior ....................................35\n
    \          4.8.2. Receiver Behavior ..................................35\n      4.9.
    Multicast Flow Query Request and Response Messages ........36\n           4.9.1.
    Sender Behavior ....................................36\n           4.9.2. Receiver
    Behavior ..................................37\n      4.10. Committed Bandwidth
    Report Message .......................38\n           4.10.1. Sender Behavior ...................................38\n
    \          4.10.2. Receiver Behavior .................................39\n   5.
    ANCP TLVs For Multicast ........................................39\n      5.1.
    Multicast-Service-Profile TLV .............................39\n      5.2. Multicast-Service-Profile-Name
    TLV ........................41\n      5.3. List-Action TLV ...........................................41\n
    \     5.4. Sequence-Number TLV .......................................44\n      5.5.
    Bandwidth-Allocation TLV ..................................45\n      5.6. White-List-CAC
    TLV ........................................45\n      5.7. MRepCtl-CAC TLV ...........................................46\n
    \     5.8. Bandwidth-Request TLV .....................................46\n      5.9.
    Request-Source-IP TLV .....................................47\n      5.10. Request-Source-MAC
    TLV ...................................48\n      5.11. Request-Source-Device-Id
    TLV .............................48\n      5.12. Multicast-Flow TLV .......................................49\n
    \     5.13. Report-Buffering-Time TLV ................................50\n      5.14.
    Committed-Bandwidth TLV ..................................51\n   6. Multicast
    Capabilities .........................................51\n      6.1. Required
    Protocol Support .................................52\n           6.1.1. Protocol
    Requirements for NAS-Initiated\n                  Multicast Replication ..............................52\n
    \          6.1.2. Protocol Requirements for Committed\n                  Multicast
    Bandwidth Reporting ......................54\n           6.1.3. Protocol Requirements
    for Conditional\n                  Access and Admission Control with White\n                  and
    Black Lists ....................................55\n           6.1.4. Protocol
    Requirements for Conditional\n                  Access and Admission Control with
    Grey Lists .......56\n           6.1.5. Protocol Requirements for Bandwidth Delegation
    .....57\n      6.2. Capability-Specific Procedures for Providing\n           Multicast
    Service .........................................57\n           6.2.1. Procedures
    for NAS-Initiated Multicast\n                  Replication ........................................58\n
    \          6.2.2. Procedures for Committed Bandwidth Reporting .......58\n           6.2.3.
    Procedures for Conditional Access and\n                  Admission Control with
    Black and White Lists .......59\n           6.2.4. Procedures for Conditional
    Access and\n                  Admission Control with Grey Lists ..................61\n
    \          6.2.5. Procedures for Bandwidth Delegation ................63\n      6.3.
    Combinations of Multicast Capabilities ....................64\n           6.3.1.
    Combination of Conditional Access and\n                  Admission Control with
    White and Black Lists\n                  and Conditional Access and Admission
    Control\n                  with Grey Lists ....................................64\n
    \          6.3.2. Combination of Conditional Access and\n                  Admission
    Control with Bandwidth Delegation ........65\n           6.3.3. Combination of
    NAS-Initiated Replication\n                  with Other Capabilities ............................65\n
    \          6.3.4. Combinations of Committed Bandwidth\n                  Reporting
    with Other Multicast Capabilities ........66\n   7. Miscellaneous Considerations
    ...................................66\n      7.1. Report Buffering Considerations
    ...........................66\n      7.2. Congestion Considerations .................................67\n
    \  8. Security Considerations ........................................67\n   9.
    IANA Considerations ............................................69\n   10. Acknowledgements
    ..............................................72\n   11. References ....................................................73\n
    \     11.1. Normative References .....................................73\n      11.2.
    Informative References ...................................73\n   Appendix A.  Example
    of Messages and Message Flows ................75\n     A.1.  Provisioning Phase
    ........................................75\n     A.2.  Handling Grey-Listed Flows
    ................................81\n     A.3.  Handling White-Listed Flows ...............................87\n
    \    A.4.  Handling of Black-Listed Join Requests ....................92\n     A.5.
    \ Handling of Requests to Join and Leave the On-Line Game ...92\n     A.6.  Example
    Flow for Multicast Flow Reporting .................95\n"
  title: Table of Contents
- contents:
  - "1.  Introduction\n   [RFC5851] defines a framework and requirements for an Access
    Node\n   (AN) control mechanism between a Network Access Server (NAS) and an\n
    \  Access Node (e.g., a Digital Subscriber Line Access Multiplexer\n   (DSLAM))
    in a multi-service reference architecture in order to\n   perform QoS-related,
    service-related, and subscriber-related\n   operations.  [RFC6320] specifies a
    protocol for Access Node Control\n   in broadband networks in line with this framework.\n
    \  [RFC6320] supports, specifically for DSL access, three use cases\n   defined
    in [RFC5851]: the Topology Discovery use case, the Line\n   Configuration use
    case, and the Remote Connectivity Test use case.\n   However, it does not support
    the multicast use cases defined in\n   [RFC5851].  The present document specifies
    the extensions to the\n   Access Node Control Protocol required for support of
    these multicast\n   use cases.  In addition, it supports the Committed Bandwidth\n
    \  Reporting use case, described below.  In terms of ANCP, these use\n   cases
    are organized into five capabilities:\n   o  NAS-initiated multicast replication;\n
    \  o  conditional access and admission control with white and black\n      lists;\n
    \  o  conditional access and admission control with grey lists;\n   o  bandwidth
    delegation; and\n   o  committed bandwidth reporting.\n   NAS-initiated multicast
    replication assumes that multicast join and\n   leave requests are terminated
    on the NAS or that the NAS receives\n   requests to establish multicast sessions
    through other means (e.g.,\n   application-level signaling).  The NAS sends commands
    to the AN to\n   start or stop replication of specific multicast flows on specific\n
    \  subscriber ports.  This use case is described briefly in the next-to-\n   last
    paragraph of Section 3.4 of [RFC5851].\n   Conditional access is described in
    Section 3.4.1 of [RFC5851].\n   Section 3.4.2.2 of [RFC5851] mentions a way in
    which conditional\n   access can be combined with admission control to allow best-effort\n
    \  multicast flows, and Section 3.4.2.3 points out the necessary\n   conditions
    for using both conditional access and admission control.\n   In the case of \"conditional
    access and admission control with white\n   and black lists\", multicast join
    and leave requests are terminated at\n   the AN and accepted or ignored in accordance
    with the direction\n   provided by white and black lists, respectively.  The white
    and black\n   lists are provisioned per port at startup time and may be modified\n
    \  thereafter.  The NAS may combine conditional access with admission\n   control
    of white-listed flows by appropriate provisioning.\n   Conditional access and
    admission control with grey lists is similar\n   to conditional access and admission
    control with white lists, except\n   that before accepting any request matching
    a grey list entry, the AN\n   sends a request to the NAS for permission to replicate
    the flow.\n   Again, the NAS can enable admission control of grey-listed flows
    at\n   the AN.\n   Bandwidth delegation is described in Section 3.4.2.1 of [RFC5851].\n
    \  It allows flexible sharing of total video bandwidth on an access line\n   between
    the AN and the NAS.  One application of such bandwidth\n   sharing is where the
    AN does multicast admission control, while the\n   NAS or Policy Server does unicast
    admission control.  In that case,\n   bandwidth delegation allows dynamic sharing
    of bandwidth between\n   unicast and multicast video traffic on each access line.\n
    \  Committed bandwidth reporting is described in Section 3.4.  The AN\n   reports
    the amount of multicast bandwidth it has granted to a given\n   access line each
    time that value changes.  These reports may be\n   buffered for a NAS-provisionable
    interval so that reports for\n   multiple access lines can be bundled into the
    same message.\n   The formal specification of the behaviors associated with each
    of\n   these capabilities, singly and in combination, is given in Section 6.\n
    \  In addition to the multicast service processing behavior just\n   sketched,
    the definition of each capability includes support for the\n   multicast accounting
    and reporting services described in\n   Section 3.4.3 of [RFC5851].  Because of
    this common content and\n   because of other protocol overlaps between the different\n
    \  capabilities, the protocol descriptions for the multicast extensions\n   specified
    in this document are merged into a single non-redundant\n   narrative.  Tables
    in Section 6 then indicate the specific sub-\n   sections of the protocol description
    that have to be implemented to\n   support each capability.\n   This document
    updates RFC 6320 by assigning capability type 3 to the\n   NAS-initiated multicast
    replication capability and by changing the\n   starting point for IANA allocation
    of result codes determined by IETF\n   Consensus from 0x100 to 0x64.\n"
  - contents:
    - "1.1.  A Note on Scope\n   The requirements in [RFC5851] were formulated with
      the IPTV\n   application in mind.  Two basic assumptions underlie the use case\n
      \  descriptions:\n   o  that the Home Gateway operates in bridged mode, and\n
      \  o  that multicast signaling uses IGMP ([RFC2236] [RFC3376]) or\n      Multicast
      Listener Discovery (MLD) [RFC3810] rather than PIM\n      [RFC4601].\n   Without
      the first assumption the AN may lose sight of individual\n   subscriber devices
      making requests for multicast service.  This has a\n   very minor effect on
      the capabilities described below but prevents\n   the application of per-device
      policies at the NAS.  Changing the\n   second assumption would require that,
      in applications where the AN is\n   responsible for snooping IGMP and MLD, it
      now also monitors for PIM\n   signaling.  The capabilities described in the
      present document do not\n   depend explicitly on what type of multicast signaling
      is used, but\n   the multiple phases of PIM setup could add complexity to their\n
      \  implementation.\n"
    title: 1.1.  A Note on Scope
  title: 1.  Introduction
- contents:
  - "2.  Terminology\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\", \"SHALL\",
    \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"MAY\", and \"OPTIONAL\"
    in this\n   document are to be interpreted as described in [RFC2119].\n   This
    document uses the terms \"connection admission control\" (\"CAC\" or\n   simply
    \"admission control\") and \"conditional access\" as they are used\n   in [RFC5851].\n
    \  The expression \"delegated bandwidth\" is used as a shorter way of\n   saying:
    \"the total amount of video bandwidth delegated to the AN for\n   multicast admission
    control\".\n"
  title: 2.  Terminology
- contents:
  - "3.  Multicast Use Cases\n   Quoting from [RFC5851]:\n      ... the Access Node,
    aggregation node(s), and the NAS must all be\n      involved in the multicast
    replication process.  This prevents\n      several copies of the same stream from
    being sent within the\n      access/aggregation network.  In case of an Ethernet-based
    access/\n      aggregation network, this may, for example, be achieved by means\n
    \     of IGMP snooping or IGMP proxy in the Access Node and aggregation\n      node(s).\n
    \     By introducing IGMP processing in the access/aggregation nodes,\n      the
    multicast replication process is now divided between the NAS,\n      the aggregation
    node(s), and Access Nodes.  In order to ensure\n      backward compatibility with
    the ATM-based model, the NAS,\n      aggregation node, and Access Node need to
    behave as a single\n      logical device.  This logical device must have exactly
    the same\n      functionality as the NAS in the ATM access/aggregation network.\n
    \     The Access Node Control Mechanism can be used to make sure that\n      this
    logical/functional equivalence is achieved by exchanging the\n      necessary
    information between the Access Node and the NAS.\n   [RFC5851] describes the use
    cases for ANCP associated with such\n   multicast operations and identifies the
    associated ANCP requirements.\n   This section describes a subset of these use
    cases as background to\n   facilitate reading of this document, but the reader
    is referred to\n   [RFC5851] for a more exhaustive description of the ANCP multicast
    use\n   cases.  Detailed example message flows can also be found in\n   Appendix
    A.\n   In the diagrams below, participation of the Home Gateway is optional,\n
    \  depending on whether it is operating in bridged or routed mode.  Note\n   that
    devices behind the Home Gateway may require the Home Gateway to\n   operate in
    routed mode to ensure that they can obtain access to non-\n   IPTV multicast services.\n"
  - contents:
    - '3.1.  NAS-Initiated Multicast Replication Control Use Case

      '
    - contents:
      - "3.1.1.  Goals\n   One option for multicast handling is for the subscriber
        to\n   communicate the join/leave information to the NAS.  This can be done,\n
        \  for instance, by terminating all subscriber IGMP ([RFC3376]) or MLD\n   ([RFC2710]
        [RFC3810]) signaling on the NAS.  Another example could be\n   a subscriber
        using some form of application-level signaling, which is\n   redirected to
        the NAS.  In any case, this option is transparent to\n   the access and aggregation
        network.  In this scenario, the NAS uses\n   ANCP to create and remove replication
        state in the AN for efficient\n   multicast replication.  Thus, the NAS only
        sends a single copy of the\n   multicast stream towards the AN, which, in
        turn, performs replication\n   to multiple subscribers as instructed by the
        NAS via ANCP.  The NAS\n   performs conditional access and admission control
        when processing\n   multicast join requests and only creates replication state
        in the AN\n   if admission succeeds.\n"
      title: 3.1.1.  Goals
    - contents:
      - "3.1.2.  Message Flow\n   With the NAS-initiated use case, a Multicast Replication
        Control\n   message is sent by the NAS to the AN with a directive to either
        join\n   or leave one (or more) multicast flow(s).  In the example message\n
        \  flow, the AN uses a Generic Response message to convey the outcome of\n
        \  the directive.  Figure 1 illustrates such an ANCP message exchange as\n
        \  well as the associated AN behavior.\n   +----------+    +-------+     +-----+
        \       ANCP          +-----+\n   |Subscriber|    | Home  |     | AN  |<-------------------->|
        NAS |\n   +----------+    |Gateway|     +-----+                      +-----+\n
        \        |         +-------+         |                           |\n         |
        \           |              |                          (*)\n         |            |
        \             | Multicast-Replication-Ctl |\n         |            |              |
        \  (Target, add, Flow 1)   |\n         |            |              |<--------------------------|\n
        \        |       Mcast Flow 1        |                           |\n         |<===========+==============+
        \                          |\n         |            |              |     Generic
        Response      |\n         |            |              |-------------------------->|\n
        \        |            |              |                           |\n         |
        \           |              |                           |\n         ~            ~
        \             ~                           ~\n         |            |              |
        \                          |\n         |            |              | Multicast-Replication-Ctl
        |\n         |            |              |   (Target,delete, Flow 1) |\n         |
        \           |              |<--------------------------|\n         |            |
        \             |                           |\n         |  <Stop Replication
        of     X                           |\n         |            Mcast Flow 1>
        \ |     Generic Response      |\n         |            |              |-------------------------->|\n
        \       (*) The NAS may optionally seek direction from an external\n       Authorization/Policy
        Server before admitting the flow.\n           Figure 1: NAS-Initiated Multicast
        Replication Control\n"
      title: 3.1.2.  Message Flow
    title: 3.1.  NAS-Initiated Multicast Replication Control Use Case
  - contents:
    - '3.2.  Conditional Access and Admission Control Use Case

      '
    - contents:
      - "3.2.1.  Goals\n   One option for multicast handling is for the access/aggregation
        nodes\n   to participate in IGMP/MLD processing (e.g., via IGMP/MLD snooping).\n
        \  In this scenario, on detecting a join/leave request from an end user\n
        \  for a multicast flow (in the grey list), the AN uses ANCP to request\n
        \  a conditional access and admission control decision from the NAS.  In\n
        \  turn, after conditional access and admission control checks, the NAS\n
        \  uses ANCP to instruct the AN to change the replication states\n   accordingly.\n"
      title: 3.2.1.  Goals
    - contents:
      - "3.2.2.  Message Flow\n   For support of the conditional access and admission
        control use case,\n   on detection of an IGMP/MLD join request, the AN sends
        a Multicast\n   Admission Control message to the NAS to request a conditional
        access\n   and admission control check.  In the case of a positive outcome,
        the\n   NAS sends a Multicast Replication Control message to the AN with a\n
        \  directive to replicate the multicast flow to the corresponding user.\n
        \  Similarly, on detection of an IGMP/MLD leave, a Multicast Admission\n   Control
        message is sent by the AN to the NAS to keep the NAS aware of\n   user departure
        for the flow.  This message flow is illustrated in\n   Figure 2.\n   +----------+
        \   +-------+   +-----+      ANCP           +-----+\n   |Subscriber|    |
        Home  |   | AN  |<------------------->| NAS |\n   +----------+    |Gateway|
        \  +-----+                     +-----+\n         |         +-------+      |
        \                          |\n         |            |           |                           |\n
        \        |       Join(Gr-Flow1)   |  Multicast-Admission-Crl  |\n         |------------+---------->|
        \  (Target,add,Gr-Flow1)   |\n         |            |           |-------------------------->|\n
        \        |            |           |                          (*)\n         |
        \           |           | Multicast-Replication-Crl |\n         |            |
        \          |   (Target,add,Gr-Flow1)   |\n         |            |           |<--------------------------|\n
        \        |     Mcast Gr-Flow1     |                           |\n         |<===========+===========+
        \                          |\n         |            |           |                           |\n
        \        ~            ~           ~                           ~\n         |
        \           |           |                           |\n         |      Leave(Gr-Flow1)
        \  |  Multicast-Admission-Crl  |\n         |------------+---------->| (Target,delete,Gr-Flow1)
        \ |\n         |            |           |-------------------------->|\n         |
        <Stop Replication of   X                           |\n         |       Mcast
        Gr-Flow1>  |                           |\n         |            |           |
        \                          |\n   Gr-Flow1: a multicast flow matching the grey
        list for that port\n   (*) The NAS may optionally seek direction from an external\n
        \      Authorization/Policy Server before admitting the flow.\n       Figure
        2: Multicast Conditional Access and Admission Control\n"
      title: 3.2.2.  Message Flow
    title: 3.2.  Conditional Access and Admission Control Use Case
  - contents:
    - '3.3.  Multicast Flow Reporting Use Case

      '
    - contents:
      - "3.3.1.  Goals\n   The multicast flow reporting use case allows the NAS to\n
        \  asynchronously query the AN to obtain an instantaneous status report\n
        \  related to multicast flows currently replicated by the AN.\n"
      title: 3.3.1.  Goals
    - contents:
      - "3.3.2.  Message Flow\n   The NAS sends a Multicast Flow Query Request message
        to the AN in\n   order to query the AN about information such as which multicast
        flows\n   are currently active on a given AN port or which ports are currently\n
        \  replicating a given multicast flow.  The AN conveys the requested\n   information
        to the NAS in a Multicast Flow Query Response message.\n   This message flow
        is illustrated in Figure 3.\n   +----------+    +-------+   +-----+    ANCP
        \   +-----+\n   |Subscriber|    | Home  |   | AN  |<---------->| NAS |\n   +----------+
        \   |Gateway|   +-----+            +-----+\n         |         +-------+     |
        \                  |\n         |           |           |  Multicast Flow   |\n
        \        |           |           |  Query Request    |\n         |           |
        \          |<------------------|\n         |           |           |                   |\n
        \        |           |           | Multicast Flow    |\n         |           |
        \          | Query Response    |\n         |           |           |------------------>|\n
        \        |           |           |                   |\n         |           |
        \          |                   |\n                    Figure 3: Multicast
        Flow Reporting\n"
      title: 3.3.2.  Message Flow
    title: 3.3.  Multicast Flow Reporting Use Case
  - contents:
    - '3.4.  Committed Bandwidth Reporting Use Case

      '
    - contents:
      - "3.4.1.  Goals\n   The committed bandwidth reporting use case allows the NAS
        to maintain\n   current awareness of how much multicast bandwidth the AN has\n
        \  committed to a given access line, so that the NAS can adjust its\n   forwarding
        scheduler to ensure the associated QoS.  Note that this\n   involves a finer
        level of detail than provided by bandwidth\n   delegation, since the amount
        of delegated bandwidth is an upper limit\n   on the amount of bandwidth committed
        rather than an actual value.  To\n   reduce the volume of messaging, reports
        from the AN may be buffered\n   so that one message reports on changes for
        multiple access lines.\n"
      title: 3.4.1.  Goals
    - contents:
      - "3.4.2.  Message Flow\n   The message flow associated with this use case is
        shown in Figure 4.\n   The figure assumes that a non-zero buffering interval
        was previously\n   provisioned on the AN.\n   +-----+    +-------+       +-----+
        \   ANCP    +-----+\n   |Subs |+   | Home  |+      | AN  |<---------->| NAS
        |\n   |1,2  ||   |GW 1,2 ||      +-----+            +-----+\n   +-----+|   +-------+|
        \        |                   |\n    +|----+    +|------+         |                   |\n
        \    | |        | |              |                   |\n     | |Join(Subs1,
        Ch1)         |                   |\n     |----------+--------------->|  Start
        buffering  |\n     | |        | Multicast flow |  timer. Create    |\n     |<=========+================|
        \ message with     |\n     | |        | |              |  initial contents
        |\n     | |        | |              |  reporting new    |\n     | |        |
        |              |  Subs1 bandwidth. |\n     | | Join(Subs2, Ch2)        |                   |\n
        \    | |----------+------------->|  Add report for   |\n     | |        |
        Multicast flow |  new Subs2 b/w.   |\n     | |<=========+==============|                   |\n
        \    | |        | |              |                   |\n     | |Leave(Subs1,
        Ch1)        |                   |\n     |----------+--------------->|  Replace
        report   |\n     | |        | |              |  for Subs1 with   |\n     |
        |      Stop replication   X  new value (which |\n     | |        | |              |
        \ happens to be    |\n     | |        | |              |  the same as the
        \ |\n     | |        | |              |  starting value). |\n     | |        |
        |              |                   |\n     | |        | |             >|<
        TIMER expires    |\n     | |        | |              |                   |\n
        \    | |        | |              |Committed          |\n     | |        |
        |              |  Bandwidth Report |\n     | |        | |              |------------------>|\n
        \    | |        | |              |   (for latest     |\n     | |        |
        |              |   Subs1 and Subs2 |\n     | |        | |              |   bandwidth)
        \     |\n     | |        | |              |                   |\n         Figure
        4: Message Flow for Committed Bandwidth Reporting\n"
      title: 3.4.2.  Message Flow
    title: 3.4.  Committed Bandwidth Reporting Use Case
  title: 3.  Multicast Use Cases
- contents:
  - "4.  ANCP Messages\n   This section defines new ANCP messages and new usage of
    existing ANCP\n   messages as well as procedures associated with the use of these\n
    \  messages.\n   Unless stated otherwise, receivers MUST ignore message contents
    that\n   are not supported by the set of capabilities negotiated between the\n
    \  NAS and the Access Node.\n"
  - contents:
    - "4.1.  Provisioning Message\n   Section 4.1 of [RFC6320] defines the Provisioning
      message that is\n   sent by the NAS to the AN to provision information in the
      AN.\n   The present document specifies that the Provisioning message MAY be\n
      \  used by the NAS to provision multicast-related information (e.g.,\n   multicast
      service profiles).  The ANCP Provisioning message payload\n   MAY contain:\n
      \  o  one or more instances of the Multicast-Service-Profile TLV.  The\n      Multicast-Service-Profile
      TLV is defined in the present document\n      in Section 5.1.  Each instance
      of the Multicast-Service-Profile\n      TLV contains a multicast service profile
      name and one or more list\n      actions.  A list action consists of an action
      (add, delete,\n      replace), a list type (white, black, or grey), and list
      content\n      (multicast source and group addresses).\n   o  an instance of
      the White-List-CAC TLV.  The White-List-CAC TLV is\n      defined in Section
      5.6.  If present, this TLV indicates that the\n      AN is required to do admission
      control before replicating white-\n      listed flows.\n   o  an instance of
      the MRepCtl-CAC TLV.  The MRepCtl-CAC TLV is\n      defined in Section 5.7.
      \ If present, this TLV indicates that the\n      AN is required to do admission
      control before replicating flows\n      specified in Multicast Replication Control
      messages.\n   o  an instance of the Report-Buffering-Time TLV.  The Report-\n
      \     Buffering-Time TLV is defined in Section 5.13.  If present, this\n      TLV
      indicates Committed Bandwidth Report messages should be\n      buffered for
      the amount of time given by the TLV before being\n      transmitted to the NAS.\n
      \  See Section 6 for information on which multicast capabilities require\n   support
      of these TLVs in the Provisioning message.\n"
    - contents:
      - "4.1.1.  Sender Behavior\n   When directed by the Policy Server or by management
        action, the NAS\n   sends the Provisioning message to initially provision
        or to update\n   the white, black, and/or grey multicast channel lists associated
        with\n   a set of named multicast service profiles or to direct the AN to\n
        \  perform admission control for specific classes of flows.\n   To provision
        or update a multicast service profile, the NAS MUST\n   include within the
        message one or more instances of the Multicast-\n   Service-Profile TLV specifying
        the content to be provisioned or\n   updated.  The NAS MUST NOT include any
        list type (white, black, or\n   grey) that is not supported by the set of
        multicast capabilities\n   negotiated between the NAS and the AN.  The NAS
        MUST NOT use the\n   Provisioning message to send instances of the Multicast-Service-\n
        \  Profile TLV to the AN unless the Multicast-Service-Profile TLV is\n   supported
        by the set of multicast capabilities negotiated between the\n   NAS and the
        AN.\n   To require admission control to be performed at the AN on white-\n
        \  listed flows, the NAS MUST include a copy of the White-List-CAC TLV\n   in
        the Provisioning message.  The White-List-CAC TLV MUST NOT be\n   provided
        unless the negotiated set of capabilities includes\n   conditional access
        and admission control with white and black lists.\n   To require admission
        control to be performed at the AN on grey-listed\n   flows or on NAS-initiated
        flows, the NAS MUST include a copy of the\n   MRepCtl-CAC TLV in the Provisioning
        message.  The MRepCtl-CAC TLV\n   MUST NOT be provided unless the negotiated
        set of capabilities\n   includes NAS-initiated multicast replication or conditional
        access\n   and admission control with grey lists.\n   To require buffering
        of Committed Bandwidth Report messages so that\n   reports for multiple access
        lines can be included in the same\n   message, the NAS MUST include a copy
        of the Report-Buffering-Time TLV\n   containing a non-zero time value in a
        Provisioning message sent to\n   the AN.  The Report-Buffering-Time TLV MUST
        NOT be provided unless\n   the negotiated set of capabilities includes committed
        bandwidth\n   reporting.\n"
      title: 4.1.1.  Sender Behavior
    - contents:
      - "4.1.2.  Receiver Behavior\n   The receiving AN provisions/updates the white,
        black, and/or grey\n   lists associated with the multicast service profile
        names contained\n   in the Multicast-Service-Profile TLV instances within
        the message\n   according to the contents of the associated List-Action TLVs.
        \ The AN\n   MUST process List-Action TLVs in the order in which they appear\n
        \  within the message.  In keeping with the general rule stated in\n   Section
        4, the AN MUST ignore instances of the List-Action TLV\n   referring to any
        list type (white, black, or grey) that is not\n   supported by the set of
        multicast capabilities negotiated between the\n   NAS and the AN.\n   When
        a new multicast service profile is identified by a Multicast-\n   Service-Profile
        TLV, the initial state of all lists associated with\n   that profile according
        to the negotiated set of multicast\n   capabilities is empty until changed
        by the contents of Multicast-\n   Service-Profile TLVs.\n   The receipt of
        a Provisioning message containing updates to an\n   existing multicast service
        profile subsequent to startup will cause\n   the AN to review the status of
        active flows on all ports to which\n   that profile has been assigned.  For
        further details, see Section 6.\n   If the White-List-CAC and/or MRepCtl-CAC
        TLV is present in the\n   Provisioning message and the respective associated
        capabilities have\n   been negotiated, the AN prepares (or continues) to do
        admission\n   control on the indicated class(es) of flow.  If one or both
        of these\n   TLVs was present in an earlier Provisioning message but is absent
        in\n   the latest message received, the AN ceases to do admission control
        on\n   the indicated class(es) of flow.\n   The buffering time specified in
        an instance of the Report-Buffering-\n   Time TLV will not be applied until
        the current accumulation process\n   of Committed Bandwidth Report messages
        finishes.\n   As indicated in [RFC6320], the AN MUST NOT reply to the Provisioning\n
        \  message if it processed it successfully.  If an error prevents\n   successful
        processing of the message content, the AN MUST return a\n   Generic Response
        message as defined in [RFC6320], containing a\n   Status-Info TLV with the
        appropriate content describing the error.\n   For this purpose, the presence
        of a list type in a Multicast-Service-\n   Profile TLV, which was ignored
        because it was not supported by the\n   negotiated set of capabilities, is
        not considered to be an error.\n"
      title: 4.1.2.  Receiver Behavior
    title: 4.1.  Provisioning Message
  - contents:
    - "4.2.  Port Management Message\n   As specified in [RFC6320], the NAS may send
      DSL line configuration\n   information to the AN (ANCP-based DSL line configuration
      use case)\n   using ANCP Port Management messages.  See Section 7.3 of [RFC6320]\n
      \  for the format of the Port Management message in that usage.\n   This document
      specifies that the Port Management message MAY be used\n   to convey either
      or both of the following TLVs:\n   o  Multicast-Service-Profile-Name TLV (defined
      in Section 5.2).  This\n      TLV associates a Multicast Service Profile with
      the access line\n      specified by the extension block and, in the case of
      white and\n      black lists, delegates conditional access to the AN for the\n
      \     specified access line and channels.\n   o  Bandwidth-Allocation TLV (defined
      in Section 5.5).  This TLV\n      specifies the total multicast bandwidth available
      to the AN for\n      admission control at the access line.\n   When the Port
      Management message is used for this purpose:\n   o  the Function field in the
      Port Management message MUST be set to\n      8, \"Configure Connection Service
      Data\".\n   o  the message MUST include TLV(s) to identify the access line\n
      \     concerned.  If the access line is a DSL loop, the line-identifying\n      TLV(s)
      MUST be as specified in Section 5.1.2 of [RFC6320].  For\n      non-DSL access
      lines, the appropriate alternative line-identifying\n      TLV(s) MUST be present.
      \ Line configuration data other than the\n      two TLVs listed in the previous
      paragraph MAY be present.\n"
    - contents:
      - "4.2.1.  Sender Behavior\n   The NAS sends the Port Management message at
        startup time to\n   initialize parameters associated with the access line
        specified in\n   the message and with the multicast capabilities negotiated
        between\n   the NAS and the AN.  The NAS MAY send additional Port Management\n
        \  messages subsequent to startup, to update or, in the case of the\n   Bandwidth-Allocation
        TLV, reset these parameters.  If the NAS\n   includes a Multicast-Service-Profile-Name
        TLV in the Port Management\n   message, the name MUST match a profile name
        provided in a Multicast-\n   Service-Profile TLV in a prior Provisioning message.
        \ The NAS MUST\n   NOT include a TLV unless it is supported by the set of
        multicast\n   capabilities negotiated between the NAS and the AN.  See Section
        6\n   for further information.\n"
      title: 4.2.1.  Sender Behavior
    - contents:
      - "4.2.2.  Receiver Behavior\n   If the Port Management message contains a Multicast-Service-Profile-\n
        \  Name TLV, the AN associates the named profile with the specified\n   access
        line.  This association replaces any previous association.\n   That is, a
        given access line is associated with at most one multicast\n   service profile.
        \ The replacement of one multicast service profile\n   with another will cause
        the AN to review the status of all active\n   flows on the target port.  For
        further details see Section 6.\n   If the Port Management message contains
        a Bandwidth-Allocation TLV,\n   the AN adopts this as the current value of
        its total multicast\n   bandwidth limit for the target port.  If the AN has
        already committed\n   multicast bandwidth exceeding the amount given in the
        Bandwidth-\n   Allocation TLV, the AN SHOULD NOT discontinue any multicast
        streams\n   in order to bring bandwidth down to within the new limit, unless
        such\n   action is required by local policy.  However, the AN MUST NOT admit\n
        \  new multicast streams that are subject to admission control until it\n
        \  can do so within the limit specified by the Bandwidth-Allocation TLV.\n
        \  If the Port Management request cannot be processed due to error and\n   the
        Result field of the request is Nack (0x1) or AckAll (0x2), the AN\n   SHOULD
        add a Status-Info TLV to the Extension Value field in its\n   reply if this
        will provide useful information beyond what is provided\n   by the Result
        Code value returned in the response header.  In\n   particular, if the name
        within the Multicast-Service-Profile-Name TLV\n   does not match a profile
        name given in a prior Provisioning message,\n   the AN SHOULD return a reply
        where the Result Code field in the\n   header indicates 0x55, \"Invalid TLV
        contents\", the Error Message\n   field in the Status-Info TLV contains the
        text \"Multicast profile\n   name not provisioned\", and the Status-Info TLV
        contains a copy of the\n   Multicast-Service-Profile-Name TLV.\n"
      title: 4.2.2.  Receiver Behavior
    title: 4.2.  Port Management Message
  - contents:
    - "4.3.  Multicast Replication Control Message\n   This section defines a new
      message called the Multicast Replication\n   Control message.  The Multicast
      Replication Control message is sent\n   by the NAS to the AN with one or more
      directives to add (join) or\n   delete (leave) a multicast flow on a target
      object identified in the\n   content of the message.\n   The Message Type for
      the Multicast Replication Control message is\n   144.\n   The ANCP Multicast
      Replication Control message payload contains the\n   following TLVs:\n   o  Target
      TLV: The Target TLV is defined in Section 4.3 of [RFC6320].\n      It MUST appear
      once and only once.  It is encoded as specified in\n      [RFC6320] or extensions
      and identifies the AN port subject to the\n      request for admission or release.\n
      \  o  Command TLV: The Command TLV is defined in Section 4.4 of\n      [RFC6320].
      \ It MUST be present.  It MAY appear multiple times.\n   As [RFC6320] indicates,
      the contents of the Command Info field within\n   the Command TLV are specific
      to the message in which the TLV occurs.\n   For the Multicast Replication Control
      message, these contents consist\n   of:\n   o  a Command Code field;\n   o  an
      Accounting field; and\n   o  an instance of the Multicast-Flow TLV.\n   Figure
      5 illustrates the complete Command TLV with the contents\n   specific to the
      Multicast Replication Control message.\n                         1                   2
      \                  3\n     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4
      5 6 7 8 9 0 1\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \   | TLV Type = Command     0x0011 |       Command TLV Length      |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \   |Command Code |  Accounting     |         Reserved              |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \   |                     Multicast-Flow TLV                        |\n    |
      \                          ...                                 |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \   |   Other embedded TLV Type     |   Other embedded TLV Length   |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \   |                                                               |\n    ~
      \                  Other embedded TLV data                     ~\n    |                                                               |\n
      \   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n    Figure
      5: Contents of the Command TLV in the Multicast Replication\n                              Control
      Message\n   o  Command Code: One of the following command directives:\n         1
      \"Add\"\n         2 \"Delete\"\n         3 \"Delete All\"\n         4 \"Admission
      Control Reject\"\n         5 \"Conditional Access Reject\"\n         6 \"Admission
      Control and Conditional Access Reject\"\n      Directives 4 through 6 are used
      as described in Section 4.4.2.\n   o  Accounting: Meaningful only when the Command
      Code is \"Add\" (1).\n      In that case, 0 indicates flow accounting is disabled,
      and 1\n      indicates that octet accounting for the flow is requested.  The\n
      \     sender MUST set the Accounting field to 0, and the receiver MUST\n      ignore
      the Accounting field for other Command Code values.\n   o  Reserved: Reserved
      for future use.  MUST be set to zeroes by the\n      sender and ignored by the
      receiver.\n   o  Multicast-Flow TLV: An instance of the Multicast-Flow TLV\n
      \     (Section 5.12) specifying the flow to be added or deleted.  The\n      Multicast-Flow
      TLV is omitted if the Command Code has value\n      \"Delete All\" (3).\n   o
      \ Other embedded TLV data: No other embedded TLVs are currently\n      specified
      within the Multicast Replication Control message and\n      Command TLV.  However,
      see the description of the Multicast\n      Admission Control message (Section
      4.4).  Unrecognized embedded\n      TLVs SHOULD be silently discarded.\n   The
      figure below is an example of a Multicast Replication Control\n   message that
      would result in a swap from multicast Source-Specific\n   Multicast (SSM) flows
      2001:DB8::1, FF34::2 to 2001:DB8::2, FF34::3 on\n   the target identified by
      the Access Loop Circuit ID:\n                            1                   2
      \                  3\n      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3
      4 5 6 7 8 9 0 1\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \    |        Type (0x880C)          |           Length              |\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \    |   Version     |  MsgType=144  | Res=2 |   Result Code = 0     |\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \    | Partition ID  |            Transaction Identifier = 18        |\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \    |I|      SubMessage Number      |           Length              |\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \    |    TLV Type = Target   0x1000 |        Target TLV Length      |\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \    | Access-Loop-Circuit-ID 0x0001 |        Circuit-ID Length      |\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \    |                                                               |\n     ~
      \                   Access Loop Circuit ID                     ~\n     |                                                               |\n
      \    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n     |
      \   TLV Type = Command  0x0011 |     Command TLV Length = 44   |\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \    | Cmd Code = 2  |   Acctg = 0   |      Reserved = 0x0000        |\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \    | Type = Multicast-Flow  0x0019 |        TLV Length = 36        |\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \    | Flow Type = 2 |  AddrFam = 2  |      Reserved = 0x0000        |\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \    |                                                               |\n     ~
      \                  Multicast Group Address                     ~\n     |                          =
      FF34::2                            |\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \    |                                                               |\n     ~
      \                        Source Address                        ~\n     |                          =
      2001:DB8::1                        |\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \    |    TLV Type = Command  0x0011 |     Command-TLV Length = 44   |\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \    | Cmd Code = 1  |   Acctg = 1   |      Reserved = 0x0000        |\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \    | Type = Multicast-Flow  0x0019 |        TLV Length = 36        |\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \    | Flow Type = 2 |  AddrFam = 2  |      Reserved = 0x0000        |\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \    |                                                               |\n     ~
      \                  Multicast Group Address                     ~\n     |                          =
      FF34::3                            |\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \    |                                                               |\n     ~
      \                        Source Address                        ~\n     |                          =
      2001:DB8::2                        |\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \   Figure 6: Example Change of Source Flow Using Multicast Replication\n                              Control
      Message\n"
    - contents:
      - "4.3.1.  Sender Behavior\n   The NAS MAY issue a Multicast Replication Control
        message to the AN\n   to convey one or more directives to add (join) or delete
        (leave) one\n   or more multicast flows.\n   The NAS MAY send this message
        on its own initiative to support the\n   NAS-initiated multicast control use
        case presented in [RFC5851] and\n   summarized in Section 3.1.  In that case,
        the NAS MUST set the Result\n   field to AckAll (0x2) or Nack (0x1) according
        to its requirements.\n   The NAS MAY also send this message in response to
        a Multicast\n   Admission Control message (defined in Section 4.4) received
        from the\n   AN to support the conditional access and admission control use
        case\n   presented in [RFC5851] and summarized in Section 3.2.  In that case,\n
        \  the NAS MUST set the Result field to Nack (0x1).\n   In either case, the
        sender MUST populate the Result Code field with\n   the value 0 and the ANCP
        Transaction Identifier field with a unique\n   value, as described in Section
        3.6.1.6 of [RFC6320].\n   Each Multicast Replication Control message MUST
        contain one or more\n   commands, each encapsulated in its own Command TLV.
        \ The sender MUST\n   use a separate Command TLV for each distinct multicast
        flow.\n   When the order of processing of two commands does not matter, the\n
        \  commands MUST be transmitted in separate Multicast Replication\n   Control
        messages.\n"
      title: 4.3.1.  Sender Behavior
    - contents:
      - "4.3.2.  Receiver Behavior\n   When successive commands (in the same or different
        messages) relate\n   to the same target and multicast flow, the state of each
        feature\n   controlled or affected by attributes received in the Multicast\n
        \  Replication Control message SHALL be as set by the last command or\n   message
        referring to that target and flow and containing the\n   controlling attribute.
        \ As an example, successive Multicast\n   Replication Control messages containing
        add commands for a given port\n   and flow but differing only in the Accounting
        field update the state\n   of the accounting feature to what is set in the
        final command\n   received, but all other features are unaffected by the second\n
        \  message.\n   If more than one Command TLV is present in a Multicast Replication\n
        \  Control message, the AN MUST act on the commands in the order in\n   which
        they are presented in the message.  The AN SHALL assign a\n   sequence number
        to each command in a given Multicast Replication\n   Control message, starting
        from 1 for the first command.\n   If a Command TLV adds one or more flows
        and the AN is performing\n   admission control for Multicast Replication Control
        messages, then\n   the AN MUST perform admission control before replicating
        the flows.\n   If the admission control check fails, the AN MUST treat the
        failure\n   as an error as described below.  The appropriate Result Code value\n
        \  for the response is 0x13 \"Out of resources\".\n   If the AN processes
        the complete Multicast Replication Control\n   message successfully and the
        Result field of the Multicast\n   Replication Control message was set to AckAll
        (0x2), the AN MUST\n   respond with a Generic Response message where the Result
        field is set\n   to Success (0x3), the Result Code field is set to 0, and
        the\n   Transaction Identifier field is copied from the Multicast Replication\n
        \  Control message.  The body of the response MAY be empty or MAY be\n   copied
        from the Multicast Replication Control message.\n   If the AN processes the
        complete Multicast Replication Control\n   message successfully and the Result
        field of the Multicast\n   Replication Control message was set to Nack (0x1),
        the AN MUST NOT\n   respond to the message.\n   The processing/execution of
        multiple commands contained in a single\n   Multicast Replication Control
        message MUST be interrupted at the\n   first error encountered and the remaining
        commands in the Multicast\n   Replication Control message discarded.  Similarly,
        if a given command\n   specifies multiple Single-Source Multicast (SSM) flows
        and an error\n   occurs, processing MUST be interrupted at that point, and
        the\n   remainder of the Command TLV discarded.\n   If the AN detects an error
        in a received Multicast Replication\n   Control message and the Result field
        in that message was set to Nack\n   (0x1) or AckAll(0x2), the AN MUST generate
        a Generic Response message\n   providing error information to the NAS.  This
        specification\n   identifies the following new Result Code values beyond those\n
        \  specified in [RFC6320], which MAY be used in a Generic Response sent\n
        \  in reply to a Multicast Replication Control message:\n   0x64  Command
        error.\n         Where detected: ANCP agent at the AN.\n         Further description:
        an invalid command code has been received.\n         Required additional information
        in the message: see below.\n         Target: ANCP agent at the NAS.\n         Action
        RECOMMENDED for the receiving ANCP agent: Report the\n         error to the
        control application with an indication of the\n         erroneous information
        associated with the invalid TLV(s).\n   0x65  Invalid flow address.\n         Where
        detected: ANCP agent at the AN.\n         Further description: either inconsistent
        flow address\n         information has been provided or the address family
        is\n         unsupported.\n         Required additional information in the
        message: see below.\n         Target: ANCP agent at the NAS.\n         Action
        RECOMMENDED for the receiving ANCP agent: Report the\n         error to the
        control application with an indication of the\n         erroneous information
        associated with the invalid TLV(s).\n   0x66  Multicast flow does not exist.\n
        \        Where detected: control application at the AN.\n         Further
        description: the NAS has attempted to delete a flow\n         that is not
        active on the given access line.\n         Required additional information
        in the message: see below.\n         Target: control application at the NAS.\n
        \        Action RECOMMENDED for the receiving ANCP agent: report the\n         error
        to the control application with an indication of the\n         erroneous information
        associated with the invalid TLV(s).\n   A Generic Response message responding
        to the Multicast Replication\n   Control message and containing one of the
        above Result Code values\n   MUST include a Status-Info TLV, which includes
        one or two embedded\n   TLVs as follows:\n   o  a Sequence-Number TLV as described
        in Section 5.4, giving the\n      sequence number of the failed command, MUST
        be included; and\n   o  the failed Command TLV itself SHOULD be included.\n
        \     Note: The Error Message field of the Status-Info TLV MAY be used\n      to
        report more details than implied by the Result Code value in\n      the message
        header.  For example, the Result Code value could be\n      0x65, and the
        Error Message field could contain the text: \"Source\n      address present
        for ASM flow\".\n"
      title: 4.3.2.  Receiver Behavior
    title: 4.3.  Multicast Replication Control Message
  - contents:
    - "4.4.  Multicast Admission Control Message\n   This section defines a new message
      called the Multicast Admission\n   Control message.  The Multicast Admission
      Control message is sent by\n   the AN to the NAS to request admission of a multicast
      flow, or to\n   notify of the removal of a multicast flow, for a given target.\n
      \  The Message Type for the Multicast Admission Control message is 145.\n   The
      ANCP Multicast Admission Control message payload contains two\n   TLVs:\n   o
      \ Target TLV: The Target TLV is defined in [RFC6320].  It MUST\n      appear
      once and only once in the Multicast Admission Control\n      message.  It is
      encoded as specified in [RFC6320] or extensions\n      and identifies the AN
      port subject to the request for admission or\n      release.\n   o  Command
      TLV: The Command TLV is defined in [RFC6320].  It MUST be\n      present.  If
      it appears more than once, only the first instance is\n      considered meaningful
      in the present version of this\n      specification, and the other instances
      are ignored.\n      Note: In the future, the specification of the Multicast
      Admission\n      Control message may be extended to allow transport of more
      than a\n      single directive (e.g., to carry both a leave from one group and
      a\n      join to another group for the same target).  It is expected that\n
      \     this would support a similar notion of strict sequenced processing\n      as
      currently defined for handling multiple directives in the\n      Multicast Replication
      Control message whereby all directives\n      following the first directive
      that cannot be executed are not\n      executed either.  When the strict sequenced
      processing of the\n      directives is not required, the directives are distributed
      across\n      separate messages.\n   The Command TLV has the same contents as
      were described above for the\n   Multicast Replication Control message, with
      the following additions:\n   o  A Request-Source-IP TLV MAY be appended to the
      Command TLV as an\n      additional embedded TLV.\n   o  Similarly, a Request-Source-MAC
      TLV MAY be appended to the Command\n      TLV as an additional embedded TLV.\n
      \  o  Finally and preferably, a Request-Source-Device-Id TLV MAY be\n      appended
      to the Command TLV as an additional embedded TLV.\n   Note that the Command
      TLV length includes the length of any embedded\n   TLVs, including the embedded
      TLV headers.\n"
    - contents:
      - "4.4.1.  Sender Behavior\n   The AN sending the Multicast Admission Control
        message MUST set the\n   Result field to Ignore (0x0).\n   The AN MUST populate
        the ANCP Transaction Identifier field with a\n   unique value, as described
        in Section 3.6.1.6 of [RFC6320].\n   The AN MUST encode the Command TLV as
        specified in Section 4.3 with\n   the following additional rules:\n   o  The
        Accounting field MUST be set to 0.\n   o  The Command Code field MUST be set
        to \"Add\" (1) when the message\n      conveys a join request, to \"Delete\"
        (2) when the message conveys a\n      leave, and to \"Delete All\" (3) when
        the message conveys a leave of\n      all channels (on the target).\n   o
        \ The Multicast-Flow TLV within the Command TLV identifies the\n      multicast
        flow subject to the request for admission or release.\n      When the Command
        Code is 3, the Multicast-Flow TLV is omitted.\n   o  The Request-Source-IP
        embedded TLV MAY be included by the AN to\n      convey the IP address of
        the sender of the join/leave message\n      (e.g., IGMP/MLD join/leave) that
        triggered the AN to include the\n      corresponding Command TLV in the Multicast
        Admission Control\n      message.  If it appears more than once, only the
        first instance is\n      considered meaningful, and the other instances are
        ignored.\n   o  The Request-Source-MAC embedded TLV MAY be included by the
        AN to\n      convey the Media Access Control (MAC) address of the sender of
        the\n      join/leave message (e.g., IGMP/MLD join/leave) that triggered the\n
        \     AN to include the corresponding Command TLV in the Multicast\n      Admission
        Control message.  If it appears more than once, only the\n      first instance
        is considered meaningful, and the other instances\n      are ignored.\n   o
        \ As a third alternative, the Request-Source-Device-Id embedded TLV\n      MAY
        be included by the AN to convey a local identifier of the\n      sender of
        the join/leave message (e.g., IGMP/MLD join/leave) that\n      triggered the
        AN to include the corresponding Command TLV in the\n      Multicast Admission
        Control message.  If it appears more than\n      once, only the first instance
        is considered meaningful, and the\n      other instances are ignored.\n   The
        inclusion of Request-Source-IP or Request-Source-MAC in the\n   Multicast
        Admission Control message is typically done to allow the\n   application of
        policies applicable to specific devices within the\n   customer's network.
        \ However, transmission of either of these fields\n   beyond the AN introduces
        potential privacy issues.  Instead of\n   transmitting either of these identifiers,
        it is RECOMMENDED that the\n   AN map the required identifier to a local value
        known to the AN and\n   Authentication, Authorization, and Accounting (AAA)
        but not to the\n   NAS, as discussed in Section 8.  The local identifier is
        transmitted\n   using the Request-Source-Device-Id TLV.\n"
      title: 4.4.1.  Sender Behavior
    - contents:
      - "4.4.2.  Receiver Behavior\n   On receipt of a Multicast Admission Control
        message:\n   o  The NAS MUST ignore the Result field.\n   o  If the directive
        in the Multicast Admission Control message is\n      \"Delete\" (2) or \"Delete
        All\" (3) and is processed correctly by the\n      NAS, the NAS MUST NOT generate
        any ANCP message in response to the\n      Multicast Admission Control message.\n
        \  o  If the directive in the Multicast Admission Control message is\n      \"Add\"
        (1) and is accepted by the NAS, the NAS MUST generate a\n      Multicast Replication
        Control message in response to the Multicast\n      Admission Control message.
        \ The Multicast Replication Control\n      message:\n      *  MUST contain
        a Result set to Nack (0x1);\n      *  MUST contain a Transaction ID with a
        unique value, as described\n         in Section 3.6.1.6 of [RFC6320]; and\n
        \     *  MUST contain the directive as accepted by the NAS.  The NAS MAY\n
        \        modify the Accounting field if flow accounting is required.\n   o
        \ If the directive in the Multicast Admission Control message is\n      \"Add\"
        (1) and is processed correctly but not accepted by the NAS\n      (i.e., it
        does not pass the conditional access and admission\n      control check),
        the NAS MAY generate a Multicast Replication\n      Control message in response
        to the Multicast Admission Control\n      message.  This optional message
        can be used by the AN to maintain\n      statistics about admission control
        rejections.  When used in this\n      situation, the Multicast Replication
        Control message:\n      *  MUST contain a Result set to 0x0;\n      *  MUST
        contain a Transaction ID with a unique value, as described\n         in Section
        3.6.1.6 of [RFC6320]; and\n      *  MUST contain the directive rejected by
        the NAS (i.e., Target\n         TLV and Command TLV) but with a Command Code
        set to \"Admission\n         Control Reject\" (4), \"Conditional Access Reject\"
        (5), or\n         \"Admission Control and Conditional Access Reject\" (6)
        as\n         applicable.\n   o  If the Multicast Admission Control message
        cannot be processed\n      correctly by the NAS (e.g., the message is malformed,
        the\n      multicast flow does not exist, etc.), the NAS MUST generate a\n
        \     Generic Response message (defined in Section 4.2 of [RFC6320])\n      with
        appropriate content indicating the reason for the failure.\n"
      title: 4.4.2.  Receiver Behavior
    title: 4.4.  Multicast Admission Control Message
  - contents:
    - "4.5.  Bandwidth Reallocation Request Message\n   The Bandwidth Reallocation
      Request message is used when the bandwidth\n   delegation capability is included
      in the negotiated set.  It MAY be\n   sent either by the NAS or by the AN to
      request an adjustment in the\n   amount of delegated bandwidth.  It will be
      sent by the NAS typically\n   to reduce the multicast bandwidth allocated to
      the AN in order for\n   the NAS to satisfy a request to add one or more flows.
      \ Conversely,\n   the AN will send a Bandwidth Reallocation Request message
      to obtain\n   additional bandwidth to satisfy a request to add a multicast channel.\n
      \  In each case, the requestor has a minimum requirement for additional\n   bandwidth
      and MAY ask for additional bandwidth beyond this amount\n   (e.g., to handle
      anticipated future requests).\n   The Bandwidth Reallocation Request message
      contains two TLVs:\n   o  the Target TLV (Section 4.3 of [RFC6320] or an extension),\n
      \     specifying a single access line; and\n   o  the Bandwidth-Request TLV
      (Section 5.8), specifying the required\n      and preferred amounts of delegated
      bandwidth.\n   The Message Type for the Bandwidth Reallocation Request message
      is\n   146.\n"
    - contents:
      - "4.5.1.  Sender Behavior\n   The Result field in the header of the Bandwidth
        Reallocation Request\n   message is not used, and the sender MUST set it to
        Ignore (0x0).\n   The bandwidth values in the Bandwidth-Request TLV are expressed
        in\n   terms of total multicast bandwidth allocated to the AN.\n      Note:
        The choice of \"total bandwidth\" rather than \"incremental\n      bandwidth\"
        was made so that it would be easier for the AN and NAS\n      to keep their
        respective views of the current amount of delegated\n      bandwidth synchronized.\n
        \  Because the values are totals rather than desired increments/\n   decrements,
        the relationship between the required amount and the\n   preferred amount
        will differ depending on whether the Bandwidth\n   Reallocation Request message
        is issued by the NAS or the AN.\n   o  If the NAS is making the request, the
        preferred amount MUST be\n      less than or equal to the required amount.
        \ The required amount\n      MUST be less than the current amount of delegated
        bandwidth.\n   o  If the AN is making the request, the preferred amount MUST
        be\n      greater than or equal to the required amount.  The required amount\n
        \     MUST be greater than the current amount of delegated bandwidth.\n"
      title: 4.5.1.  Sender Behavior
    - contents:
      - "4.5.2.  Receiver Behavior\n   When the peer receives a valid Bandwidth Reallocation
        Request\n   message, it SHOULD determine whether it can satisfy the request
        from\n   its existing allocation of unused video bandwidth.  If it decides\n
        \  that it can reallocate bandwidth to the peer, it MAY choose to return\n
        \  any amount between the required and the preferred amounts indicated\n   in
        the Bandwidth Reallocation Request message.\n   The peer MUST return a Bandwidth
        Transfer message (Section 4.6)\n   indicating its decision.  If the request
        is met, the Result field of\n   the Bandwidth Transfer message MUST be set
        to Success (0x3), the\n   Result Code field MUST be set to 0x000, and the
        Bandwidth-Allocation\n   TLV (Section 5.5) MUST contain the new value of total
        multicast\n   bandwidth.  This new value MUST lie between the required and\n
        \  preferred values, inclusive, from the request message.  If the\n   request
        is not met, the Result field of the Bandwidth Transfer\n   message MUST be
        set to Failure (0x4), the Result Code field MUST be\n   set to 0, and the
        Bandwidth-Allocation TLV MUST contain the value of\n   the currently allocated
        amount of delegated bandwidth as the\n   responder views it.\n   The following
        cases indicate that the sender holds a different view\n   of the amount of
        delegated bandwidth from the receiver:\n   o  The NAS receives a request where
        the required amount is less than\n      its view of the current amount of
        delegated bandwidth.\n   o  The AN receives a request where the required amount
        is greater\n      than its view of the current amount of delegated bandwidth.\n
        \  If one of these cases occurs, the receiver, with one exception, MUST\n
        \  send a Bandwidth Transfer message indicating Success.\n   o  If the NAS
        received the request, the allocated amount in the NAS's\n      response MUST
        be at least equal to the NAS's view of the current\n      amount of delegated
        bandwidth.\n   o  If the AN received the request, the allocated amount in
        the AN's\n      response MUST be no greater than the AN's view of the current\n
        \     amount of delegated bandwidth.\n   The exception is when the NAS receives
        a request while it has a\n   request of its own outstanding.  Handling of
        that case is described\n   below.\n      Note: While the cases just described
        are an error condition, the\n      success response achieves a graceful recovery.\n
        \  To avoid deadlock due to race conditions, the following rules MUST be\n
        \  applied:\n   a.  If the NAS receives a Bandwidth Reallocation Request message\n
        \      while it has a Bandwidth Reallocation Request message of its own\n
        \      outstanding for the same access line, the NAS MUST provide an\n       immediate
        failure response to the request from the AN, with a\n       Result Code value
        set to 0x68 \"Inconsistent views of delegated\n       bandwidth amount\" or
        0x69 \"Bandwidth request conflict\" as\n       applicable.  (See below for
        more information).\n   b.  If the AN receives a Bandwidth Reallocation Request
        message while\n       it has a Bandwidth Reallocation Request message of its
        own\n       outstanding for the same access line, the AN MUST release any\n
        \      bandwidth it has already committed to an outstanding join request\n
        \      while it is awaiting a response from the NAS.  It MUST decide\n       upon
        and send its response to the NAS taking the released\n       bandwidth into
        account.\n   If the receiver is unable to process the Bandwidth Reallocation\n
        \  Request message due to an error, then the receiver MUST return a\n   Bandwidth
        Transfer message where:\n   o  the Result field is set to Failure (0x4),\n
        \  o  the Result Code field is set appropriately to indicate the type of\n
        \     error that was detected,\n   o  the Bandwidth-Allocation TLV contains
        the value of the current\n      amount of delegated bandwidth as the responder
        views it, and\n   o  a Status-Info TLV MAY follow the Bandwidth-Allocation
        TLV giving\n      further information about the error.\n   This specification
        provides three new Result Code values applicable\n   specifically to the contents
        of the Bandwidth-Request TLV.  These\n   Result Code values by their nature
        MUST only be used when the error\n   is being reported in a Bandwidth Transfer
        message rather than a\n   Generic Response message.\n   0x67  Invalid preferred
        bandwidth amount.\n         Where detected: control application at the receiver
        of the\n         Bandwidth Reallocation Request message.\n         Further
        description: the preferred and required amounts of\n         bandwidth in
        the TLV do not have the numerical relationship\n         described above.\n
        \        Required additional information in the message: as described\n         above.\n
        \        Target: control application at the sender of the Bandwidth\n         Reallocation
        Request message.\n         Action RECOMMENDED for the receiving ANCP agent:
        report the\n         error to the control application with the returned value
        of the\n         Bandwidth-Allocation TLV.  See also Section 4.6.2.2.\n   0x68
        \ Inconsistent views of delegated bandwidth amount.\n         Where detected:
        control application at the NAS.\n         Further description: the NAS has
        an outstanding Bandwidth\n         Reallocation Request, so it is rejecting
        a similar request from\n         the AN.  In the AN request, the required
        amount was less than\n         the NAS's view of the current amount of delegated
        bandwidth.\n         Required additional information in the message: as described\n
        \        above.\n         Target: control application at the AN.\n         Action
        RECOMMENDED for the receiving ANCP agent: report the\n         error to the
        AN control application with the returned value of\n         the Bandwidth-Allocation
        TLV.  See also Section 4.6.2.2.\n   0x69  Bandwidth request conflict.\n         Where
        detected: control application at the NAS.\n         Further description: the
        NAS has an outstanding Bandwidth\n         Reallocation Request, so it is
        rejecting a similar, valid\n         request from the AN.\n         Required
        additional information in the message: as described\n         above.\n         Target:
        control application at the AN.\n         Action RECOMMENDED for the receiving
        ANCP agent: report the\n         error to the AN control application with
        the returned value of\n         the Bandwidth-Allocation TLV.  See also Section
        4.6.2.2.\n"
      title: 4.5.2.  Receiver Behavior
    title: 4.5.  Bandwidth Reallocation Request Message
  - contents:
    - "4.6.  Bandwidth Transfer Message\n   The Bandwidth Transfer message is used
      to transfer video bandwidth\n   from the sender to the peer for a specific access
      line.  This message\n   MAY be sent either from the AN or from the NAS.  As
      described in the\n   previous section, it is the required response to a valid
      Bandwidth\n   Reallocation Request message.\n   The Bandwidth Transfer message
      MAY also be used to transfer bandwidth\n   autonomously from one peer to another.
      \ One example of this usage is\n   to release bandwidth borrowed earlier by
      means of the Bandwidth\n   Reallocation Request message.  When the message is
      used in this way,\n   the Result field in the Bandwidth Transfer message MUST
      be set to\n   Ignore (0x0).\n      Note: This allows the receiver to distinguish
      between an\n      autonomous transfer and a response to a previous Bandwidth\n
      \     Reallocation Request message, for purposes of validation.\n   The Message
      Type for the Bandwidth Transfer message is 147.  The\n   Bandwidth Transfer
      message contains the following TLVs:\n   o  the Target TLV, designating the
      access line concerned;\n   o  an instance of the Bandwidth-Allocation TLV (Section
      5.5).  The\n      bandwidth value in the Bandwidth-Allocation TLV is the new
      amount\n      of delegated bandwidth allocated to the target.\n"
    - contents:
      - "4.6.1.  Sender Behavior\n   When sending a Bandwidth Transfer message where
        the Result value is\n   Ignore (0x0) or Success (0x3), the following relationships
        MUST hold:\n   o  If the message is sent by the NAS, the bandwidth value in
        the\n      Bandwidth-Allocation TLV MUST be greater than or equal to the\n
        \     sender's view of the current amount of delegated bandwidth for the\n
        \     access line concerned.\n   o  If the message is sent by the AN, the
        bandwidth value in the\n      Bandwidth-Allocation TLV MUST be less than or
        equal to the\n      sender's view of the current amount of delegated bandwidth
        for the\n      access line concerned.\n   Further sender behavior is specified
        above, in Section 4.5.2.\n"
      title: 4.6.1.  Sender Behavior
    - contents:
      - '4.6.2.  Receiver Behavior

        '
      - contents:
        - "4.6.2.1.  Behavior of the NAS\n   If the amount of delegated bandwidth
          provided in the Bandwidth-\n   Allocation TLV is not greater than the NAS's
          view of the current\n   amount of delegated bandwidth, the NAS MUST update
          its view of the\n   current amount of delegated bandwidth to the amount
          indicated in the\n   Bandwidth Transfer message.  This is required regardless
          of whether\n   the Result field of that message indicates Success or Failure.\n
          \  If the amount of delegated bandwidth provided in the Bandwidth-\n   Allocation
          TLV is greater than the NAS's view of the current amount\n   of delegated
          bandwidth, the NAS MAY accept the given value as its new\n   value of delegated
          bandwidth.  Alternatively, the NAS MAY force the\n   AN to modify its view
          of the amount of delegated bandwidth to that\n   held by the NAS by sending
          a Port Management message for the target\n   access line concerned that
          contains a Bandwidth-Allocation TLV with a\n   value equal to the amount
          of delegated bandwidth the NAS wishes to\n   enforce.\n"
        title: 4.6.2.1.  Behavior of the NAS
      - contents:
        - "4.6.2.2.  Behavior of the AN\n   If the amount of delegated bandwidth provided
          in the Bandwidth-\n   Allocation TLV of the Bandwidth Transfer message differs
          from the\n   AN's view of the current amount of delegated bandwidth, the
          AN MUST\n   update its view of the current amount of delegated bandwidth
          to the\n   amount indicated in the Bandwidth Transfer message.  This is
          required\n   with the exception of a Bandwidth Transfer message with a Result\n
          \  field equal to Failure (0x4) and a Result Code field equal to 0x68\n
          \  \"Inconsistent views of delegated bandwidth amount\" or 0x69 \"Bandwidth\n
          \  request conflict\".  If Result Code value 0x68 is received, the AN\n
          \  MUST issue a Delegated Bandwidth Query Request message to determine\n
          \  the NAS's current view of the amount of delegated bandwidth.  The AN\n
          \  MUST update its own view based on the value returned in the Delegated\n
          \  Bandwidth Query Response message.  If Result Code value 0x69 is\n   received,
          the AN SHOULD carry out this procedure unless it can\n   account for the
          discrepancy as a result of a transfer of bandwidth to\n   the NAS that was
          carried out just before the incoming Bandwidth\n   Transfer message was
          processed.\n      Note: The two Result Code values indicate a race condition
          where\n      the AN may have just completed a transfer of bandwidth to the
          NAS.\n      As a result, the value given in the Bandwidth Transfer message
          may\n      be outdated, and the AN needs to query the NAS to find its latest\n
          \     view.  The procedure assumes that ordering is preserved between\n
          \     the Bandwidth Transfer message sent by the AN in response to the\n
          \     NAS's request and the subsequent Delegated Bandwidth Query Request\n
          \     message.\n   If the AN has already committed multicast bandwidth exceeding
          the\n   amount given in the Bandwidth-Allocation TLV, the AN SHOULD NOT\n
          \  discontinue any multicast streams in order to bring bandwidth down to\n
          \  within the new limit, unless such action is required by local policy.\n
          \  However, the AN MUST NOT admit new multicast streams that are subject\n
          \  to admission control until it can do so within the limit specified by\n
          \  the Bandwidth-Allocation TLV.  As specified in Section 6.2.5.2, the\n
          \  AN MAY attempt to correct the situation by sending a request to the\n
          \  NAS for an increased allocation of delegated bandwidth using the\n   Bandwidth
          Reallocation Request message.\n"
        title: 4.6.2.2.  Behavior of the AN
      title: 4.6.2.  Receiver Behavior
    title: 4.6.  Bandwidth Transfer Message
  - contents:
    - "4.7.  Delegated Bandwidth Query Request Message\n   The Message Type for the
      Delegated Bandwidth Query Request (and\n   Response) messages is 148.\n   The
      Delegated Bandwidth Query Request message MAY be sent either by\n   the NAS
      or by the AN to retrieve the peer's view of the amount of\n   delegated bandwidth.
      \ The request contains one TLV:\n   o  a Target TLV designating the access line
      for which the information\n      is requested.\n"
    - contents:
      - "4.7.1.  Sender Behavior\n   The sender MUST set the Result field in the header
        of the Delegated\n   Bandwidth Query Request message to AckAll (0x2).  The
        Result Code\n   value MUST be set to 0.  The sender MUST populate the ANCP\n
        \  Transaction Identifier field with a unique value, as described in\n   Section
        3.6.1.6 of [RFC6320].\n"
      title: 4.7.1.  Sender Behavior
    - contents:
      - "4.7.2.  Receiver Behavior\n   If the AN or NAS receives a valid Delegated
        Bandwidth Query Request\n   message, it MUST respond with a Delegated Bandwidth
        Query Response\n   message.  The Result field in the header of the response
        MUST be set\n   to Success (0x3).  The Result Code field MUST be set to 0.
        \ The\n   Transaction Identifier field MUST be copied from the request message.\n
        \  The body of the response MUST contain the Target TLV, copied from the\n
        \  request message.  Finally, the body of the response MUST contain a\n   Bandwidth-Allocation
        TLV, containing the current amount of delegated\n   bandwidth from the point
        of view of the receiver of the request.\n   If the contents of the Delegated
        Bandwidth Query Request message are\n   in error, the receiver MUST return
        a Delegated Bandwidth Query\n   Response message with the Result field in
        the header set to Failure\n   (0x3).  The Result Code field MUST be set to
        the value that indicates\n   the nature of the error (e.g., 0x500 \"One or
        more of the specified\n   ports do not exist\").  The Transaction Identifier
        field MUST be\n   copied from the request.  The body of the response MUST
        contain the\n   Target TLV copied from the request.  This MAY be followed
        by a\n   Status-Info TLV giving further information about the error.\n"
      title: 4.7.2.  Receiver Behavior
    title: 4.7.  Delegated Bandwidth Query Request Message
  - contents:
    - "4.8.  Delegated Bandwidth Query Response Message\n   The Delegated Bandwidth
      Query Response message is sent in reply to a\n   Delegated Bandwidth Query Request
      message.  The response to a valid\n   request contains two TLVs:\n   o  the
      Target TLV, copied from the request; and\n   o  a Bandwidth-Allocation TLV,
      giving the responder's view of the\n      current amount of multicast bandwidth
      delegated to the AN.\n   The Message Type for the Delegated Bandwidth Query
      Response message\n   is 148.\n"
    - contents:
      - "4.8.1.  Sender Behavior\n   Sender behavior for the Delegated Bandwidth Query
        Response message is\n   specified in Section 4.7.2.\n"
      title: 4.8.1.  Sender Behavior
    - contents:
      - "4.8.2.  Receiver Behavior\n   If the Delegated Bandwidth Query Response message
        indicates Success\n   (0x3), the actions described in Sections 4.8.2.1 and
        4.8.2.2 apply.\n"
      - contents:
        - "4.8.2.1.  Behavior at the NAS\n   If the amount of delegated bandwidth
          provided in the Bandwidth-\n   Allocation TLV is less than the NAS's view
          of the current amount of\n   delegated bandwidth, the NAS MUST update its
          view of the current\n   amount of delegated bandwidth to the amount indicated
          in the\n   Delegated Bandwidth Query Response message.\n   If the amount
          of delegated bandwidth provided in the Bandwidth-\n   Allocation TLV is
          greater than the NAS's view of the current amount\n   of delegated bandwidth,
          the NAS MAY accept the given value as its new\n   value of delegated bandwidth.
          \ Alternatively, the NAS MAY force the\n   AN to modify its view of the
          amount of delegated bandwidth to that\n   held by the NAS by sending a Port
          Management message for the target\n   access line concerned that contains
          a Bandwidth-Allocation TLV with a\n   value equal to the amount of delegated
          bandwidth the NAS wishes to\n   enforce.\n"
        title: 4.8.2.1.  Behavior at the NAS
      - contents:
        - "4.8.2.2.  Behavior at the AN\n   The AN SHOULD accept the value returned
          in the Bandwidth-Allocation\n   TLV of the Delegated Bandwidth Query Response
          message as the correct\n   value of the current amount of delegated bandwidth.
          \ If the AN has\n   already committed multicast bandwidth exceeding the
          amount given in\n   the Bandwidth-Allocation TLV, the AN SHOULD NOT discontinue
          any\n   multicast streams in order to bring bandwidth down to within the
          new\n   limit, unless such action is required by local policy.  However,
          the\n   AN MUST NOT admit new multicast streams that are subject to admission\n
          \  control until it can do so within the limit specified by the\n   Bandwidth-Allocation
          TLV.  As specified in Section 6.2.5.2, the AN\n   MAY attempt to correct
          the situation by sending a request to the NAS\n   for an increased allocation
          of delegated bandwidth using the\n   Bandwidth Reallocation Request message.\n
          \     Note: A race condition is possible where the AN sends a query, the\n
          \     NAS requests more bandwidth, then receives and responds to the\n      query,
          and then receives the Bandwidth Transfer message responding\n      to its
          request.  It is up to the AN to take appropriate action in\n      this case.
          \ The best action appears to be not to act on the result\n      of the first
          query but to repeat the query after sending the\n      Bandwidth Transfer
          message.  Similar considerations apply to a\n      race between queries
          from both sides.\n"
        title: 4.8.2.2.  Behavior at the AN
      title: 4.8.2.  Receiver Behavior
    title: 4.8.  Delegated Bandwidth Query Response Message
  - contents:
    - "4.9.  Multicast Flow Query Request and Response Messages\n   This section defines
      two new messages called the Multicast Flow Query\n   Request and Multicast Flow
      Query Response.  The Multicast Flow Query\n   Request message is sent by the
      NAS to request information about the\n   multicast flows that are active on
      the AN.  The Multicast Flow Query\n   Response message is sent in response by
      the AN to provide the\n   requested information to the NAS.\n   The Message
      Type for the Multicast Flow Query Request and Multicast\n   Flow Query Response
      messages is 149.\n   The contents of the Multicast Flow Query Request and Multicast
      Flow\n   Query Response messages depend on the nature of the query, as\n   described
      below.\n"
    - contents:
      - "4.9.1.  Sender Behavior\n   The sender of a Multicast Flow Query Request
        message MUST set the\n   Result field to AckAll (0x2).  The Result Code field
        MUST be set to\n   0x000.  The sender MUST populate the ANCP Transaction Identifier\n
        \  field with a unique value, as described in Section 3.6.1.6 of\n   [RFC6320].\n
        \  The Multicast Flow Query Request message MAY be used by the NAS to\n   retrieve:\n
        \  o  the AN's view of which multicast flows are currently active on a\n      specified
        set of access ports; or\n   o  the AN's view of the access ports on which
        a specified set of\n      multicast flows are currently active; or\n   o  the
        AN's view of all the multicast flows currently active on each\n      access
        port of the AN.\n   To retrieve the AN's view of which multicast flows are
        currently\n   active on a given port of the AN, the NAS MUST include a Target
        TLV\n   in the Multicast Flow Query Request payload identifying that port.\n
        \  The Target TLV is encoded as specified in [RFC6320].\n   To retrieve the
        AN's view of the ports currently receiving a given\n   multicast flow, the
        NAS MUST include a Multicast-Flow TLV in the\n   Multicast Flow Query Request
        payload identifying that flow.  The\n   Multicast-Flow TLV is encoded as specified
        in Section 5.12.\n   The NAS MAY include multiple Target TLVs or multiple
        Multicast-Flow\n   TLVs in the Multicast Flow Query Request message but MUST
        NOT include\n   both Target and Multicast-Flow TLVs in the same message.\n
        \  To retrieve the AN's view of all of the multicast flows currently\n   active
        on each port of the AN, the NAS MUST send a Multicast Flow\n   Query Request
        message that does not contain any instance of the\n   Target TLV or the Multicast-Flow
        TLV.\n"
      title: 4.9.1.  Sender Behavior
    - contents:
      - "4.9.2.  Receiver Behavior\n   The AN MUST respond to a Multicast Flow Query
        Request message that\n   has a valid format and a valid content with a Multicast
        Flow Query\n   Response message.  The Result field in the response MUST be
        set to\n   Success (0x3).  The Result Code field MUST be set to 0.  The\n
        \  Transaction Identifier field MUST be copied from the request.\n   If the
        Multicast Flow Query Request contains one (or more) Target\n   TLVs, the AN
        MUST include, for each of these Target TLVs, the\n   following set of TLVs:\n
        \  o  Target TLV.  This MUST be identical to the Target TLV in the\n      received
        Multicast Flow Query Request message.\n   o  Multicast-Flow TLV(s).  The Multicast-Flow
        TLV MUST appear once\n      per multicast flow that is currently active on
        the AN port\n      identified in the preceding Target TLV.\n   The Target
        TLVs MUST appear in the response from the AN in the same\n   order as in the
        query from the NAS.\n   If the Multicast Flow Query Request message contains
        one (or more)\n   Multicast-Flow TLVs, the AN MUST include, for each of these\n
        \  Multicast-Flow TLVs, the following set of TLVs:\n   o  Multicast-Flow TLV.
        \ This MUST be identical to the Multicast-Flow\n      TLV in the received
        Multicast Flow Query Request message.\n   o  Target TLV(s).  The Target TLV
        MUST appear once per AN port on\n      which the multicast flow identified
        in the preceding Multicast-\n      Flow TLV is active.\n   The Multicast-Flow
        TLVs MUST appear in the response from the AN in\n   the same order as in the
        query from the NAS.\n   If the Multicast Flow Query Request message contains
        no Target TLV\n   and no Multicast Flow TLV, the AN MUST include, for each
        AN port\n   currently receiving multicast flow(s), the following set of TLVs:\n
        \  o  Target TLV.  This MUST identify one AN port.\n   o  Multicast-Flow TLV(s).
        \ The Multicast-Flow TLV MUST appear once\n      per Multicast Flow that is
        currently active on the AN port\n      identified in the preceding Target
        TLV.\n   If the contents of the Multicast Flow Query Request message are in\n
        \  error, the AN MUST reply with a Multicast Flow Query Response message\n
        \  with the Result field set to Failure (0x4) and the Result Code field\n
        \  set to indicate the nature of the error.  If the request contained\n   multiple
        instances of the Target TLV or the Multicast-Flow TLV and\n   one of these
        is in error, the response message MUST contain the\n   results for the preceding
        instances of the TLV as if there had been\n   no error.  These successful
        results MUST be followed by the TLV in\n   error, copied from the request.
        \ The AN MUST NOT do further\n   processing of the request.  The AN MAY add
        a Status-Info TLV to\n   provide further information on the nature of the
        error.\n"
      title: 4.9.2.  Receiver Behavior
    title: 4.9.  Multicast Flow Query Request and Response Messages
  - contents:
    - "4.10.  Committed Bandwidth Report Message\n   This section describes the Committed
      Bandwidth Report message, which\n   is sent from the AN to the NAS to report
      the most recent amount of\n   multicast bandwidth usage committed to one or
      more access lines.\n   The Message Type for the Committed Bandwidth Report message
      is 150.\n   The Committed Bandwidth Report message contains one or more instances\n
      \  of the Committed-Bandwidth TLV, as described in Section 5.14.\n"
    - contents:
      - "4.10.1.  Sender Behavior\n   The sender of a Committed Bandwidth Report message
        MUST set the\n   Result field to Ignore (0x0).  The Result Code field MUST
        be set to\n   0x000.  The sender MUST populate the ANCP Transaction Identifier\n
        \  field with a unique value, as described in Section 3.6.1.6 of\n   [RFC6320].\n
        \  Each instance of the Committed-Bandwidth TLV included in the message\n
        \  MUST identify an access line for which the amount of committed\n   multicast
        bandwidth has changed since the previous Committed\n   Bandwidth Report message
        was sent and MUST report the latest amount\n   of multicast bandwidth committed
        to that line.  There MUST be only\n   one instance of the Committed-Bandwidth
        TLV present in the message\n   for any given access line.  The message MUST
        include an instance of\n   the Committed-Bandwidth TLV for every access line
        for which committed\n   multicast bandwidth has changed since the previous
        Committed\n   Bandwidth Report message was sent.\n   Further behavior at the
        AN is specified in Section 6.2.2.\n"
      title: 4.10.1.  Sender Behavior
    - contents:
      - "4.10.2.  Receiver Behavior\n   The usage of the contents of a Committed Bandwidth
        Report message\n   received by the NAS is implementation-dependent.  One example
        is that\n   the NAS uses the reports of multicast bandwidth commitments to
        adjust\n   its forwarding scheduler operation to provide the intended level
        of\n   QoS.\n   The NAS MUST NOT reply to a valid Committed Bandwidth Report
        message.\n   The NAS MAY send a Generic Response message indicating the nature
        of\n   any errors detected in a Committed Bandwidth Report message that it\n
        \  has received.\n"
      title: 4.10.2.  Receiver Behavior
    title: 4.10.  Committed Bandwidth Report Message
  title: 4.  ANCP Messages
- contents:
  - "5.  ANCP TLVs For Multicast\n   This section defines new ANCP TLVs for the control
    of multicast\n   flows.\n"
  - contents:
    - "5.1.  Multicast-Service-Profile TLV\n   This document defines the new Multicast-Service-Profile
      TLV.\n   The Multicast-Service-Profile TLV MAY be included in a Provisioning\n
      \  message as specified in Section 4.1.\n   The Multicast-Service-Profile TLV
      is illustrated in Figure 7.  It\n   consists of a TLV header encapsulating a
      single instance of the\n   Multicast-Service-Profile-Name TLV and one or more
      instances of the\n   List-Action TLV.\n                        1                   2
      \                  3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4
      5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |  Mcast-Service-Profile 0x0013 |             TLV Length        |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |   Multicast-Service-Profile-Name TLV                          |\n   |                                                               |\n
      \  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n   |   List-Action
      TLV                                             |\n   |                                                               |\n
      \  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n   |                          ...
      \                                 |\n   |                                                               |\n
      \  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n   |   List-Action
      TLV                                             |\n   |                                                               |\n
      \  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n                  Figure
      7: Multicast-Service-Profile TLV\n   The Multicast-Service-Profile TLV has the
      following fields:\n   o  TLV Type: 0x0013\n   o  TLV Length: determined by the
      contents following the TLV header.\n   o  Multicast-Service-Profile-Name TLV:
      described in Section 5.2.  The\n      Multicast-Service-Profile-Name TLV MUST
      contain an identifier that\n      is unique over all profiles provisioned to
      the same AN partition.\n      This identifier will be used to refer to the profile
      when\n      activating it for a given target within a Port Management message\n
      \     (see Section 4.2).\n   o  List-Action TLV: described in Section 5.3.  The
      List-Action TLV(s)\n      provide the content of a newly defined multicast service
      profile\n      or modify the existing content.  If more than one List-Action
      TLV\n      is present, the order of the TLVs may be significant, since List-\n
      \     Action TLVs are processed in the order in which they appear.\n"
    title: 5.1.  Multicast-Service-Profile TLV
  - contents:
    - "5.2.  Multicast-Service-Profile-Name TLV\n   The Multicast-Service-Profile-Name
      TLV carries the identifier of a\n   multicast service profile provisioned on
      the AN.  It is illustrated\n   in Figure 8.\n                        1                   2
      \                  3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4
      5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Mcast-Svc-Profile-Name 0x0018 |             TLV Length        |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |   Multicast service profile identifier                        |\n   |                                                               |\n
      \  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n               Figure
      8: Multicast-Service-Profile-Name TLV\n   The Multicast-Service-Profile-Name
      TLV has the following fields:\n   o  TLV Type: 0x0018\n   o  TLV Length: up
      to 255 octets.\n   o  Multicast service profile identifier: an opaque sequence
      of octets\n      identifying a specific multicast service profile.\n         Note:
      The identifier could have the form of human-readable text\n         or an arbitrary
      binary value, depending on the operator's\n         practices.\n"
    title: 5.2.  Multicast-Service-Profile-Name TLV
  - contents:
    - "5.3.  List-Action TLV\n   The List-Action TLV identifies multicast flows to
      be added to or\n   removed from a list of white-, black-, or grey-listed flows.
      \ It is\n   meaningful only in association with a Multicast-Service-Profile-Name\n
      \  TLV identifying the profile to which the List-Action TLV applies.\n   Such
      an association can be achieved by placing both TLVs in the same\n   base message
      payload or as embedded TLVs of another TLV such as the\n   Multicast-Service-Profile
      TLV.  The List-Action TLV is shown in\n   Figure 9.\n                        1
      \                  2                   3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4
      5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | TLV Type = List-Action 0x0021 |          TLV Length           |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Operation     | List Type     |           Reserved            |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Address Family                |     Number of flow fields     |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                    Multicast flow fields                      |\n                             ......\n
      \  |                                                               |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Address Family                |     Number of flow fields     |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                    Multicast flow fields                      |\n                                    ......\n
      \  |                                                               |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \                        Figure 9: List-Action TLV\n   The List-Action TLV contains
      the following fields:\n   o  TLV Type: 0x0021\n   o  TLV Length: length of the
      subsequent contents.\n   o  Operation: operation to be performed upon the white,
      black, or\n      grey list identified by the List Type field within the profile\n
      \     identified by the associated Multicast-Service-Profile-Name\n      embedded
      TLV.  The possible values are:\n      *  1 \"Add\": the multicast flow fields
      are to be added to the list.\n      *  2 \"Delete\": the multicast flow fields
      are to be removed from\n         the list.  Each multicast flow field in the
      List-Action MUST\n         match exactly an existing entry in the list concerned.
      \ Thus,\n         to remove part of the range provided by a wildcarded list\n
      \        entry, it is necessary to remove the entire entry and add back\n         the
      remaining partial range(s).\n      *  3 \"Replace\": the multicast flow fields
      replace the existing\n         contents of the list.\n   o  List Type: the list
      type being modified by this List-Action TLV.\n      The possible values are
      1 \"White\", 2 \"Black\", or 3 \"Grey\".\n   o  Reserved: a sender MUST set
      this field to zeroes.  A receiver MUST\n      ignore the contents of this field.\n
      \  o  Address Family: the IP version of the set of multicast flow fields\n      that
      follow, encoded according to [PIMreg].  Possible values are 1\n      \"IPv4\"
      or 2 \"IPv6\".  Either an IPv4 list or an IPv6 list or both\n      MAY be present
      in the List-Action TLV.\n   o  Number of flow fields: the number of multicast
      flow fields of the\n      given address family that follows.\n   o  Multicast
      flow field: a field identifying one or more multicast\n      flows.  It consists
      of an 8-bit group address prefix length, an\n      8-bit source address prefix
      length, a group prefix of 0-16 octets,\n      and a source prefix of 0-16 octets,
      as shown in Figure 10.\n   Each multicast flow field refers either to a Source-Specific\n
      \  Multicast (SSM) channel or to an Any-Source Multicast (ASM) group.\n   The
      scope of the designation may be broadened to multiple channels or\n   groups
      through use of prefix length values smaller than the total\n   address length
      for the given address family.  Multicast flow fields\n   MUST be placed consecutively
      within the embedded TLV without\n   intervening padding except to round out
      individual addresses to the\n   nearest octet boundary.\n   A multicast flow
      field consists of two single-octet prefix lengths\n   followed by zero to two
      prefix values as shown in Figure 10:\n    +-+-+-+-+-+-+-+-+\n    | Group PrefLen
      |\n    +-+-+-+-+-+-+-+-+\n    | Source PrefLen|\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \   | Group Prefix (multicast)  (0 to 16 octets)                    |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \   | Source Prefix (unicast, SSM only) (0 to 16 octets)            |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \        Figure 10: Organization of a Single Multicast Flow Field\n   The prefix
      length has its usual meaning.  It is the number of most-\n   significant bits
      specified within the corresponding prefix.  The\n   prefix length MAY vary from
      0 to 32 in the IPv4 sub-list and from 0\n   to 128 in the IPv6 sub-list.\n   A
      value of 0 for either the Group PrefLen (prefix length) or the\n   Source PrefLen
      indicates that any value of the corresponding address\n   will match (wildcard).
      \ If the value 0 is provided for a particular\n   prefix length, the corresponding
      prefix MUST be omitted from the\n   field contents.\n   The length of a Source
      or Group Prefix field is equal to (PrefLen +\n   7)/8 octets, truncated to the
      nearest integer.  Unused bits at the\n   end of the prefix MUST be set to zeroes.\n"
    title: 5.3.  List-Action TLV
  - contents:
    - "5.4.  Sequence-Number TLV\n   The Sequence-Number TLV conveys a sequence number
      of some sort.  The\n   specific meaning of the sequence number is message-specific.
      \ Within\n   this specification, the Sequence-Number TLV is used as an embedded\n
      \  TLV in a Status-Info TLV in a Generic Response message reporting a\n   failed
      command in a Multicast Replication Control or Multicast\n   Admission Request
      message.  It identifies the sequence number within\n   the message of the command
      that failed.\n   The Sequence-Number TLV has the format shown in Figure 11.\n
      \                       1                   2                   3\n    0 1 2
      3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Type = Sequence-Number 0x0022 |          TLV Length = 4       |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                       Sequence number                         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \                     Figure 11: Sequence-Number TLV\n   The Sequence-Number
      TLV has the following fields:\n   o  TLV Type: 0x0022\n   o  TLV Length: 4\n
      \  o  Sequence number: the sequence number of a specific entity within a\n      series,
      where numbering starts from 1 for the first entity in the\n      series.  Represented
      as a 32-bit binary number, most significant\n      bit first.\n"
    title: 5.4.  Sequence-Number TLV
  - contents:
    - "5.5.  Bandwidth-Allocation TLV\n   The Bandwidth-Allocation TLV is used to
      indicate the total amount of\n   video bandwidth delegated to the AN for multicast
      admission control\n   for a given access line, in kilobits per second.  The
      TLV has the\n   format shown in Figure 12.\n                        1                   2
      \                  3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4
      5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |   Bandwidth-Allocation 0x0015 |          TLV Length = 4       |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |          Delegated amount (kbits/s)                           |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \                   Figure 12: Bandwidth-Allocation TLV\n   The Bandwidth-Allocation
      TLV has the following fields:\n   o  TLV Type: 0x0015\n   o  TLV Length: 4\n
      \  o  Delegated amount: the bandwidth amount delegated to the AN for\n      admission
      of multicast video on a given port, kilobits per second.\n      Represented
      as a 32-bit binary value, most significant bit first.\n"
    title: 5.5.  Bandwidth-Allocation TLV
  - contents:
    - "5.6.  White-List-CAC TLV\n   The White-List-CAC TLV is used to indicate that
      the NAS wishes the AN\n   to do admission control for white-listed flows.  Details
      on when the\n   White-List-CAC TLV may be provisioned are specified in Section
      6.\n   The White-List-CAC TLV is illustrated in Figure 13.\n                        1
      \                  2                   3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4
      5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |  Type = White-List-CAC 0x0024 |          TLV Length = 0       |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \                      Figure 13: White-List-CAC TLV\n   The White-List-CAC
      TLV contains the following fields:\n   o  TLV Type: 0x0024\n   o  TLV Length:
      0, since the TLV contains no data other than the TLV\n      header.\n"
    title: 5.6.  White-List-CAC TLV
  - contents:
    - "5.7.  MRepCtl-CAC TLV\n   The MRepCtl-CAC TLV is used to indicate that the
      NAS wishes the AN to\n   do admission control for flows added by the Multicast
      Replication\n   Control message.  Details on when the MRepCtl-CAC TLV may be\n
      \  provisioned are specified in Section 6.  The MRepCtl-CAC TLV is\n   illustrated
      in Figure 14.\n                        1                   2                   3\n
      \   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |TLV Type = MRepCtl-CAC  0x0025 |          TLV Length = 0       |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \                       Figure 14: MRepCtl-CAC TLV\n   The MRepCtl-CAC TLV contains
      the following fields:\n   o  TLV Type: 0x0025\n   o  TLV Length: 0, since the
      TLV contains no data other than the TLV\n      header.\n"
    title: 5.7.  MRepCtl-CAC TLV
  - contents:
    - "5.8.  Bandwidth-Request TLV\n   The Bandwidth-Request TLV is used to request
      an adjustment of the\n   total amount of video bandwidth allocated to the AN
      for multicast\n   admission control for a given line.  The \"Required amount\"
      field\n   indicates the minimum adjustment required to meet the request.  The\n
      \  \"Preferred amount\" field indicates the adjustment the requestor would\n
      \  prefer to have, if possible.  Section 4.5 discusses the required\n   relationships
      between the \"Required amount\", \"Preferred amount\", and\n   current values
      of total bandwidth allocated to the AN.\n   The Bandwidth-Request TLV has the
      format shown in Figure 15.\n                        1                   2                   3\n
      \   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Type=Bandwidth-Request 0x0016 |          TLV Length = 8       |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |           Required amount  (kbits/s)                          |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |           Preferred amount (kbits/s)                          |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \                    Figure 15: Bandwidth-Request TLV\n   The Bandwidth-Request
      TLV has the following fields:\n   o  TLV Type: 0x0016\n   o  TLV Length: 8 octets\n
      \  o  Required amount: the minimum or maximum amount, depending on\n      whether
      the sender is the AN or the NAS respectively, of delegated\n      video bandwidth
      that is being requested, in kilobits per second.\n      Represented as a 32-bit
      binary value, most significant bit first.\n   o  Preferred amount: the preferred
      amount of delegated video\n      bandwidth that is being requested, in kilobits
      per second.\n      Represented as a 32-bit binary value, most significant bit
      first.\n"
    title: 5.8.  Bandwidth-Request TLV
  - contents:
    - "5.9.  Request-Source-IP TLV\n   The Request-Source-IP TLV provides the IP address
      of the entity that\n   originated a specific request to join or leave a multicast
      channel.\n   The TLV is illustrated in Figure 16.\n                         1
      \                  2                   3\n     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4
      5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |  TLV Type = Request-Source-IP |   TLV Length = 4 or 16        |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                    Unicast Address                            |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \                    Figure 16: Request-Source-IP TLV\n   The Request-Source-IP
      TLV contains the following fields:\n   o  TLV Type: 0x0092\n   o  TLV Length:
      4 for an IPv4 address or 16 for an IPv6 address.\n   o  Unicast address: IP
      address of the source of a multicast flow join\n      request, in network byte
      order.\n"
    title: 5.9.  Request-Source-IP TLV
  - contents:
    - "5.10.  Request-Source-MAC TLV\n   The Request-Source-MAC TLV provides the MAC
      address of the entity\n   that originated a specific request to join or leave
      a multicast\n   channel.  The TLV is illustrated in Figure 17.\n                        1
      \                  2                   3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4
      5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |TLV Type=Request-Source-MAC    |     TLV Length = 6 or 8       |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                                                               |\n   +-+-+-
      \                     IEEE MAC Address              +-+-+-+\n   |                                                               |\n
      \  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n                     Figure
      17: Request-Source-MAC TLV\n   The Request-Source-MAC TLV contains the following
      fields:\n   o  TLV Type: 0x0093.\n   o  TLV Length: either 6 octets (MAC-48
      or EUI-48) or 8 octets (EUI-\n      64).\n   o  IEEE MAC Address: MAC address
      of the device originating the\n      request to join a multicast flow.  Within
      the address, bytes and\n      bits, respectively, shall be ordered from most
      to least\n      significant, consistent with [IEEE48] for MAC-48 and EUI-48
      and\n      with [IEEE64] for EUI-64.\n         Note: EUI-48 and EUI-64 are registered
      trademarks of the IEEE.\n"
    title: 5.10.  Request-Source-MAC TLV
  - contents:
    - "5.11.  Request-Source-Device-Id TLV\n   The Request-Source-Device-Id TLV provides
      a local identifier of the\n   entity that originated a specific request to join
      or leave a\n   multicast channel.  The TLV is illustrated in Figure 18.\n                         1
      \                  2                   3\n     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4
      5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |    Request-Source-Device-Id   |       TLV Length = 4          |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                    Identifier value                           |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \                 Figure 18: Request-Source-Device-Id TLV\n   The Request-Source-Device-Id
      TLV contains the following fields:\n   o  TLV Type: 0x0096.\n   o  TLV Length:
      4\n   o  Identifier value: local device identifier value, known to the AN\n
      \     and AAA.  Given that the scope of the identifier is a single\n      customer
      network, 32 bits is a more-than-sufficient numbering\n      space.\n"
    title: 5.11.  Request-Source-Device-Id TLV
  - contents:
    - "5.12.  Multicast-Flow TLV\n   IGMPv3 [RFC3376] and MLDv2 [RFC3810] allow multicast
      listeners to\n   specify multiple source addresses for the same multicast group.\n
      \  Similarly, the Multicast-Flow TLV specifies a multicast flow in terms\n   of
      its multicast group address and, if applicable, one or more\n   unicast source
      addresses.  The Multicast-Flow TLV is illustrated in\n   Figure 19.\n                        1
      \                  2                   3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4
      5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Type = Multicast-Flow  0x0019 |      TLV Length               |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |   Flow Type   |  Addr Family  |   Number of Source Addresses  |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |              Multicast Group Address                          |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+--+\n
      \  |           Unicast Source Address (for SSM flows only)         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \                      Figure 19: Multicast-Flow TLV\n   The Multicast-Flow
      TLV has the following fields:\n   o  TLV Type: 0x0019\n   o  TLV Length: ranges
      from a minimum of 8 (for an ASM IPv4 flow)\n      upwards.  Total length is
      4 + 4*(Number of Source Addresses +1)\n      for IPv4 or 4 + 16*(Number of Source
      Addresses + 1) for IPv6.\n   o  Flow Type: 1 \"Any-Source Multicast (ASM)\",
      2 \"Source-Specific\n      Multicast (SSM)\".\n   o  Addr Family: address family
      of the multicast source and group\n      addresses, encoded in accordance with
      the IANA \"PIM Address\n      Family\" registry ([PIMreg]). 1 indicates IPv4;
      2 indicates IPv6.\n   o  Number of Source Addresses: 0 for ASM, 1 or more for
      SSM.\n   o  Multicast Group Address: a multicast group address within the\n
      \     given address family.  The group address MUST always be present.\n   o
      \ Unicast Source Address: unicast address within the given address\n      family.
      \ If the Flow Type is \"ASM\" (1), a source address MUST NOT\n      be present.
      \ If the Flow Type is \"SSM\" (2), the number of source\n      addresses given
      by the Number of Source Addresses field MUST be\n      present.\n   The full
      versions of IGMPv3 and MLDv2 support both INCLUDE and\n   EXCLUDE modes for
      specifying the desired sources for SSM flows.  The\n   Multicast-Flow TLV supports
      INCLUDE mode only.  [RFC5790]\n   (Lightweight IGMPv3 and MLDv2) provides guidance
      on converting\n   EXCLUDE mode IGMP/MLD records to INCLUDE mode for the Multicast-Flow\n
      \  TLV.\n"
    title: 5.12.  Multicast-Flow TLV
  - contents:
    - "5.13.  Report-Buffering-Time TLV\n   The Report-Buffering-Time TLV provides
      the time for which a Committed\n   Bandwidth Report message must be held with
      the intention of\n   accumulating multiple reports of changed committed multicast\n
      \  bandwidth in one report, to reduce the volume of messages sent to the\n   NAS.
      \ For further information see Section 6.2.2.  The TLV is\n   illustrated in
      Figure 20.\n                        1                   2                   3\n
      \   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Report-Buffering-Time  0x0094 |      TLV Length = 4           |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                       Buffering Time (ms)                     |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \                  Figure 20: Report-Buffering-Time TLV\n   The Report-Buffering-Time
      TLV contains the following fields:\n   o  TLV Type: 0x0094\n   o  TLV Length:
      4 octets\n   o  Buffering Time is a 32-bit unsigned integer containing a time\n
      \     value in milliseconds (ms).\n"
    title: 5.13.  Report-Buffering-Time TLV
  - contents:
    - "5.14.  Committed-Bandwidth TLV\n   The Committed-Bandwidth TLV identifies an
      access line and provides\n   the current amount of multicast bandwidth that
      the AN has committed\n   to it.  The TLV is illustrated in Figure 21.\n                        1
      \                  2                   3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4
      5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Committed-Bandwidth    0x0095 |      TLV Length (variable)    |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |             Committed Multicast Bandwidth   (kbits/s)         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                                                               |\n   ~                           Target
      TLV                          ~\n   |                                                               |\n
      \  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n                    Figure
      21: Committed-Bandwidth TLV\n   The Committed-Bandwidth TLV contains the following
      fields:\n   o  TLV Type: 0x0095\n   o  TLV Length: 4 octets plus the length
      of the Target TLV, including\n      its header and any padding.\n   o  Committed
      Multicast Bandwidth: a 32-bit unsigned integer providing\n      a bandwidth
      amount in kbits/s.\n   o  Target TLV: identifies the access line to which this
      amount of\n      multicast bandwidth is currently committed.\n"
    title: 5.14.  Committed-Bandwidth TLV
  title: 5.  ANCP TLVs For Multicast
- contents:
  - "6.  Multicast Capabilities\n   Section 3.5 of [RFC6320] defines a capability
    negotiation mechanism\n   as well as a number of capabilities.  This section defines
    five new\n   capabilities in support of different modes of multicast operation:\n
    \  o  NAS-initiated multicast replication (capability type 3);\n   o  committed
    bandwidth reporting (capability type 5);\n   o  conditional access and admission
    control with white and black\n      lists (capability type 6);\n   o  conditional
    access and admission control with grey lists\n      (capability type 7); and\n
    \  o  bandwidth delegation (capability type 8).\n   The \"Capability Data\" field
    within the Capability TLV for all of\n   these capabilities is empty.  All of
    these capabilities are\n   independent of the access technology.\n   The remainder
    of this section consists of three sub-sections.\n   Section 6.1 specifies the
    protocol elements that must be implemented\n   in order to support each capability.
    \ Section 6.2 specifies the\n   procedures that apply to each capability on its
    own.  Section 6.3\n   specifies how the capabilities interact if more than one
    multicast\n   capability is included in the set of capabilities negotiated between\n
    \  the AN and the NAS.\n"
  - contents:
    - "6.1.  Required Protocol Support\n   This section specifies the protocol elements
      that MUST be implemented\n   to support each of the five multicast capabilities.
      \ Support of\n   multiple multicast capabilities requires implementation of
      the union\n   of the sets of protocol elements applying to each of the individual\n
      \  capabilities in the supported set.\n   In addition to the elements listed
      below, implementation of the\n   Target TLV (Section 4.3 of [RFC6320]) is REQUIRED
      for all of the\n   capabilities specified in this document.\n"
    - contents:
      - "6.1.1.  Protocol Requirements for NAS-Initiated Multicast Replication\n   Table
        1 specifies the protocol elements within Section 4 and\n   Section 5 that
        MUST be implemented to support the NAS-initiated\n   multicast replication
        capability.  Additionally, implementation of\n   the Multicast Replication
        Control message requires implementation of\n   the Command TLV (Section 4.4
        of [RFC6320] with additional details in\n   Section 4.3 of this document).\n
        \  +--------------+----------------------------------------------------+\n
        \  | Reference    | Protocol Element                                   |\n
        \  +--------------+----------------------------------------------------+\n
        \  | Section 4.1  | Provisioning message with MRepCtl-CAC TLV          |\n
        \  |              |                                                    |\n
        \  | Section 4.2  | Port Management message with Bandwidth-Allocation  |\n
        \  |              | TLV                                                |\n
        \  |              |                                                    |\n
        \  | Section 4.3  | Multicast Replication Control message              |\n
        \  |              |                                                    |\n
        \  | Section 4.9  | Multicast Flow Query Request and Response messages |\n
        \  |              |                                                    |\n
        \  | Section 5.4  | Sequence Number TLV                                |\n
        \  |              |                                                    |\n
        \  | Section 5.5  | Bandwidth-Allocation TLV                           |\n
        \  |              |                                                    |\n
        \  | Section 5.7  | MRepCtl-CAC TLV                                    |\n
        \  |              |                                                    |\n
        \  | Section 5.12 | Multicast-Flow TLV                                 |\n
        \  +--------------+----------------------------------------------------+\n
        \       Table 1: Protocol Requirements for NAS-Initiated Multicast\n                                Replication\n"
      title: 6.1.1.  Protocol Requirements for NAS-Initiated Multicast Replication
    - contents:
      - "6.1.2.  Protocol Requirements for Committed Multicast Bandwidth\n        Reporting\n
        \  Table 2 specifies the protocol elements within Section 4 and\n   Section
        5 that MUST be implemented to support the committed multicast\n   bandwidth
        reporting capability.\n   +--------------+----------------------------------------------------+\n
        \  | Reference    | Protocol Element                                   |\n
        \  +--------------+----------------------------------------------------+\n
        \  | Section 4.1  | Provisioning message with Report-Buffering-Time    |\n
        \  |              | TLV                                                |\n
        \  |              |                                                    |\n
        \  | Section 4.10 | Committed Bandwidth Report message                 |\n
        \  |              |                                                    |\n
        \  | Section 4.9  | Multicast Flow Query Request and Response messages |\n
        \  |              |                                                    |\n
        \  | Section 5.13 | Report-Buffering-Timer TLV                         |\n
        \  |              |                                                    |\n
        \  | Section 5.14 | Committed-Bandwidth TLV                            |\n
        \  |              |                                                    |\n
        \  | Section 5.12 | Multicast-Flow TLV                                 |\n
        \  +--------------+----------------------------------------------------+\n
        \    Table 2: Protocol Requirements for Committed Multicast Bandwidth\n                                 Reporting\n"
      title: 6.1.2.  Protocol Requirements for Committed Multicast Bandwidth
    - contents:
      - "6.1.3.  Protocol Requirements for Conditional Access and Admission\n        Control
        with White and Black Lists\n   Table 3 specifies the protocol elements within
        Section 4 and\n   Section 5 that MUST be implemented to support the conditional
        access\n   and admission control with white and black lists multicast\n   capability.\n
        \  +--------------+----------------------------------------------------+\n
        \  | Reference    | Protocol Element                                   |\n
        \  +--------------+----------------------------------------------------+\n
        \  | Section 4.1  | Provisioning message with Multicast-Service-       |\n
        \  |              | Profile TLV, white and black lists only, and       |\n
        \  |              | White-List-CAC TLV                                 |\n
        \  |              |                                                    |\n
        \  | Section 4.2  | Port Management message with Multicast-Service-    |\n
        \  |              | Profile-Name and Bandwidth-Allocation TLVs         |\n
        \  |              |                                                    |\n
        \  | Section 4.9  | Multicast Flow Query Request and Response messages |\n
        \  |              |                                                    |\n
        \  | Section 5.1  | Multicast-Service-Profile TLV                      |\n
        \  |              |                                                    |\n
        \  | Section 5.2  | Multicast-Service-Profile-Name TLV                 |\n
        \  |              |                                                    |\n
        \  | Section 5.3  | List-Action TLV, white and black lists only        |\n
        \  |              |                                                    |\n
        \  | Section 5.5  | Bandwidth-Allocation TLV                           |\n
        \  |              |                                                    |\n
        \  | Section 5.6  | White-List-CAC TLV                                 |\n
        \  |              |                                                    |\n
        \  | Section 5.12 | Multicast-Flow TLV                                 |\n
        \  +--------------+----------------------------------------------------+\n
        \   Table 3: Protocol Requirements for Conditional Access and Admission\n
        \                   Control with White and Black Lists\n"
      title: 6.1.3.  Protocol Requirements for Conditional Access and Admission
    - contents:
      - "6.1.4.  Protocol Requirements for Conditional Access and Admission\n        Control
        with Grey Lists\n   Table 4 specifies the protocol elements within Section
        4 and\n   Section 5 that MUST be implemented to support the conditional access\n
        \  and admission control with grey lists multicast capability.\n   Additionally,
        implementation of the Multicast Replication Control\n   message requires implementation
        of the Command TLV (Section 4.4 of\n   [RFC6320] with additional details in
        Section 4.3 of this document).\n   +--------------+----------------------------------------------------+\n
        \  | Reference    | Protocol Element                                   |\n
        \  +--------------+----------------------------------------------------+\n
        \  | Section 4.1  | Provisioning message with Multicast-Service-       |\n
        \  |              | Profile TLV, grey lists only, and MRepCtl-CAC TLV  |\n
        \  |              |                                                    |\n
        \  | Section 4.2  | Port Management message with Multicast-Service-    |\n
        \  |              | Profile-Name and Bandwidth-Allocation TLVs         |\n
        \  |              |                                                    |\n
        \  | Section 4.3  | Multicast Replication Control message              |\n
        \  |              |                                                    |\n
        \  | Section 4.4  | Multicast Admission Control message                |\n
        \  |              |                                                    |\n
        \  | Section 4.9  | Multicast Flow Query Request and Response messages |\n
        \  |              |                                                    |\n
        \  | Section 5.1  | Multicast-Service-Profile TLV, grey lists only     |\n
        \  |              |                                                    |\n
        \  | Section 5.2  | Multicast-Service-Profile-Name TLV                 |\n
        \  |              |                                                    |\n
        \  | Section 5.3  | List-Action TLV, grey lists only                   |\n
        \  |              |                                                    |\n
        \  | Section 5.4  | Sequence Number TLV                                |\n
        \  |              |                                                    |\n
        \  | Section 5.5  | Bandwidth-Allocation TLV                           |\n
        \  |              |                                                    |\n
        \  | Section 5.7  | MRepCtl-CAC TLV                                    |\n
        \  |              |                                                    |\n
        \  | Section 5.9  | Request-Source-IP TLV                              |\n
        \  |              |                                                    |\n
        \  | Section 5.10 | Request-Source-MAC TLV                             |\n
        \  |              |                                                    |\n
        \  | Section 5.11 | Request-Source-Device-Id TLV                       |\n
        \  |              |                                                    |\n
        \  | Section 5.12 | Multicast-Flow TLV                                 |\n
        \  +--------------+----------------------------------------------------+\n
        \   Table 4: Protocol Requirements for Conditional Access and Admission\n
        \                         Control with Grey Lists\n"
      title: 6.1.4.  Protocol Requirements for Conditional Access and Admission
    - contents:
      - "6.1.5.  Protocol Requirements for Bandwidth Delegation\n   Table 5 specifies
        the protocol elements within Section 4 and\n   Section 5 that MUST be implemented
        to support the bandwidth\n   delegation capability.\n   +--------------+----------------------------------------------------+\n
        \  | Reference    | Protocol Element                                   |\n
        \  +--------------+----------------------------------------------------+\n
        \  | Section 4.2  | Port Management message with Bandwidth-Allocation  |\n
        \  |              | TLV                                                |\n
        \  |              |                                                    |\n
        \  | Section 4.5  | Bandwidth Reallocation Request message             |\n
        \  |              |                                                    |\n
        \  | Section 4.6  | Bandwidth Transfer message                         |\n
        \  |              |                                                    |\n
        \  | Section 4.7  | Delegated Bandwidth Query Request message          |\n
        \  |              |                                                    |\n
        \  | Section 4.8  | Delegated Bandwidth Query Response message         |\n
        \  |              |                                                    |\n
        \  | Section 4.9  | Multicast Flow Query Request and Response messages |\n
        \  |              |                                                    |\n
        \  | Section 5.5  | Bandwidth-Allocation TLV                           |\n
        \  |              |                                                    |\n
        \  | Section 5.8  | Bandwidth-Request TLV                              |\n
        \  |              |                                                    |\n
        \  | Section 5.12 | Multicast-Flow TLV                                 |\n
        \  +--------------+----------------------------------------------------+\n
        \         Table 5: Protocol Requirements for Bandwidth Delegation\n"
      title: 6.1.5.  Protocol Requirements for Bandwidth Delegation
    title: 6.1.  Required Protocol Support
  - contents:
    - "6.2.  Capability-Specific Procedures for Providing Multicast Service\n   This
      section describes multicast service procedures for each\n   capability as if
      it were the only multicast capability within the\n   negotiated set.  Procedures
      involving combinations of multicast\n   capabilities are described in Section
      6.3.\n   The use of the Multicast Flow Query Request and Response messages to\n
      \  determine the association between multicast flows and ports is common\n   to
      all multicast capabilities.  No additional text is required here,\n   beyond
      that already given in Section 4.9 to describe the use of those\n   messages.\n"
    - contents:
      - "6.2.1.  Procedures for NAS-Initiated Multicast Replication\n   NAS-initiated
        multicast replication may be negotiated to support a\n   mode of operation
        where IGMP/MLD requests are terminated on the NAS.\n   Alternatively, it may
        be negotiated to allow the NAS to respond to\n   requests sent by other means
        (e.g., through application signaling)\n   that require the replication of
        multicast channels to a given access\n   line.\n"
      - contents:
        - "6.2.1.1.  Provisioning\n   The NAS MAY perform admission control for NAS-initiated
          replication.\n   In this case, it MUST NOT include the MRepCtl-CAC TLV in
          a\n   Provisioning message sent to the AN.  Alternatively, the NAS MAY\n
          \  enable admission control at the AN for NAS-initiated multicast\n   replication.
          \ To do this, it MUST include the MRepCtl-CAC TLV in a\n   Provisioning
          message sent to the AN, and it MUST also include a\n   Bandwidth-Allocation
          TLV in a Port Management message for each access\n   line.\n"
        title: 6.2.1.1.  Provisioning
      - contents:
        - "6.2.1.2.  Multicast Service Procedures\n   The procedures associated with
          NAS-initiated multicast replication\n   are straightforward.  To initiate
          replication, the NAS MUST send a\n   Multicast Replication Control message
          to the AN, containing one or\n   more commands adding flows, as described
          in Section 4.3.1.  To\n   terminate replication, the NAS MUST send a Multicast
          Replication\n   Control message where the commands delete instead of adding
          the\n   flows.  The AN acts upon these messages as specified in\n   Section
          4.3.2.\n"
        title: 6.2.1.2.  Multicast Service Procedures
      title: 6.2.1.  Procedures for NAS-Initiated Multicast Replication
    - contents:
      - "6.2.2.  Procedures for Committed Bandwidth Reporting\n   Committed bandwidth
        reporting may be negotiated if the NAS requires\n   current knowledge of the
        amount of multicast bandwidth committed to\n   each access line and cannot
        obtain this information by other means.\n"
      - contents:
        - "6.2.2.1.  Provisioning\n   The default buffering time when committed bandwidth
          reporting is\n   enabled is zero (immediate reporting).  To change this,
          the NAS MAY\n   send an instance of the Report-Buffering-Time TLV containing
          a non-\n   zero time value to the AN in a Provisioning message.  If the
          NAS\n   subsequently wishes to change the buffering time again, it MAY do
          so\n   in another Provisioning message.\n"
        title: 6.2.2.1.  Provisioning
      - contents:
        - "6.2.2.2.  Multicast Service Procedures\n   If the buffering time for committed
          bandwidth reporting is zero, the\n   AN MUST send a Committed Bandwidth
          Report message to the NAS each\n   time the amount of multicast bandwidth
          committed to any access line\n   under its control changes.\n   If a non-zero
          value is provided in the Report-Buffering-Time TLV, the\n   AN is in one
          of two states at any given moment: not-buffering or\n   buffering.  The
          AN enters buffering state if it is in not-buffering\n   state and the multicast
          bandwidth amount committed to some access\n   line changes.  It leaves buffering
          state when the AN sends a\n   Committed Bandwidth Report message.\n   Upon
          entry to the buffering state, the AN MUST start a buffering\n   timer and
          create a Committed Bandwidth Report message containing a\n   Committed-Bandwidth
          TLV for the triggering access line, but it MUST\n   NOT send it.  If a multicast
          bandwidth change occurs for another\n   access line, the AN MUST add a new
          Committed-Bandwidth TLV to the\n   message for that additional line.  If
          a multicast bandwidth change\n   occurs for a line for which a Committed-Bandwidth
          TLV is already\n   present in the buffered report, the AN MUST update the
          corresponding\n   Committed-Bandwidth TLV to contain the new bandwidth value
          rather\n   than adding another Committed-Bandwidth TLV for the same access
          line.\n   The buffering timer expires after the period provided by the Report-\n
          \  Buffering-Time TLV.  When it expires, the AN MUST send the Committed\n
          \  Bandwidth Report message that it has been accumulating to the NAS.\n
          \  Exceptionally, the AN MAY choose to send the message before the timer\n
          \  expires, in which case it MUST clear the buffering timer when the\n   message
          is sent.  In either case, the AN enters the not-buffering\n   state as a
          result.\n      Note: Report buffering implies that NAS reaction to changes
          in\n      multicast bandwidth usage is delayed by the amount of the\n      buffering
          period.  The choice of buffering period must take this\n      into consideration.\n"
        title: 6.2.2.2.  Multicast Service Procedures
      title: 6.2.2.  Procedures for Committed Bandwidth Reporting
    - contents:
      - "6.2.3.  Procedures for Conditional Access and Admission Control with\n        Black
        and White Lists\n"
      - contents:
        - "6.2.3.1.  Provisioning\n   The NAS provisions named multicast service profiles
          containing white\n   and black lists on the AN using the Provisioning message
          containing\n   one or more Multicast-Service-Profile TLVs.  The NAS MAY
          update the\n   contents of these profiles from time to time as required
          by sending\n   additional Provisioning messages with Multicast-Service-Profile
          TLVs\n   containing incremental modifications to the existing white and
          black\n   lists or replacements for them.\n   The NAS assigns a specific
          multicast service profile to an individual\n   access line using the Port
          Management message containing a Multicast-\n   Service-Profile-Name TLV.
          \ The NAS MAY change the multicast service\n   profile for a given access
          line at any time by sending a Port\n   Management message identifying a
          new multicast service profile.\n   The NAS MAY choose to enable admission
          control at the AN for white-\n   listed flows.  To do this, it MUST send
          a Provisioning message as\n   described in Section 4.1, which includes the
          White-List-CAC TLV, and\n   it MUST provide a multicast bandwidth allocation
          for each access line\n   by including a Bandwidth-Allocation TLV in a Port
          Management message.\n"
        title: 6.2.3.1.  Provisioning
      - contents:
        - "6.2.3.2.  Multicast Service Procedures\n   The conditional access and admission
          control with white and black\n   lists capability assumes that IGMP/MLD
          requests are terminated on the\n   AN.  When the AN receives a join request,
          it MUST check to see\n   whether the requested flow is white-listed or black-listed
          as\n   described below.  Requests for black-listed flows MUST be discarded.\n
          \  If the NAS has enabled admission control on the AN as described in\n
          \  the previous section, but a white-listed flow would cause the amount\n
          \  of committed multicast bandwidth to exceed the provisioned limit, the\n
          \  request MUST be discarded.  The AN replicates flows passing these\n   checks
          to the access line.\n   To determine if a requested flow is white-listed,
          the AN searches for\n   a best match to the flow in the applicable multicast
          service profile.\n   Matching is done on the prefixes specified in the profile,
          ignoring\n   the address bits of lower order than those in the prefix.\n
          \  If the requested multicast flow matches multiple lists associated\n   with
          the access line, then the most specific match will be considered\n   by
          the AN.  If the most specific match occurs in multiple lists, the\n   black
          list entry takes precedence over the white list.  In this\n   context, the
          most specific match is defined as:\n   o  first, most specific match (longest
          prefix length) on the\n      multicast group address (i.e., on G of <S,G>),
          and\n   o  then, most specific match (longest prefix length) on the unicast\n
          \     source address (i.e., on S of <S,G>).\n   If the requested multicast
          flow is not part of any list, the join\n   message SHOULD be discarded by
          the AN.  This default behavior can\n   easily be changed by means of a \"catch-all\"
          statement in the white\n   list.  For instance, adding (<S=*,G=*>) in the
          white List would make\n   the default behavior to accept join messages for
          a multicast flow\n   that has no other match on any list.\n   When the AN
          receives a leave request, it terminates replication of\n   the multicast
          flow.\n   If the AN receives a Provisioning message that updates an existing\n
          \  multicast service profile, the AN MUST review the status of active\n
          \  flows on all ports to which the updated profile is currently\n   assigned.
          \ Similarly, if a Port Management message assigns a new\n   multicast service
          profile to a given port, the AN MUST review all\n   active flows on that
          port.  If the most specific match for any flow\n   is a black list entry,
          the flow MUST be terminated immediately.  If\n   any of the remaining flows
          do not match an entry in the white list,\n   they also MUST be terminated
          immediately.  White-listed flows MUST be\n   allowed to continue.\n"
        title: 6.2.3.2.  Multicast Service Procedures
      title: 6.2.3.  Procedures for Conditional Access and Admission Control with
    - contents:
      - "6.2.4.  Procedures for Conditional Access and Admission Control with\n        Grey
        Lists\n"
      - contents:
        - "6.2.4.1.  Provisioning\n   The NAS provisions named multicast service profiles
          containing grey\n   lists on the AN using the Provisioning message containing
          one or more\n   Multicast-Service-Profile TLVs.  The NAS MAY update the
          contents of\n   these profiles from time to time as required by sending
          additional\n   Provisioning messages with Multicast-Service-Profile TLVs
          containing\n   incremental modifications to the existing grey lists or replacements\n
          \  for them.\n   The NAS assigns a specific multicast service profile to
          an individual\n   access line using the Port Management message containing
          a Multicast-\n   Service-Profile-Name TLV.  The NAS MAY change profiles
          on the line by\n   sending a subsequent Port Management message identifying
          a new\n   profile.\n   The NAS MAY perform admission control for grey-listed
          flows.  In that\n   case, the NAS MUST NOT include the MRepCtl-CAC TLV in
          a Provisioning\n   message sent to the AN.  Alternatively, the NAS MAY enable
          admission\n   control at the AN for grey-listed flows.  To do this, it MUST
          include\n   the MRepCtl-CAC TLV in a Provisioning message sent to the AN
          and MUST\n   also provide a Bandwidth-Allocation TLV in a Port Management
          message\n   for each access line.\n"
        title: 6.2.4.1.  Provisioning
      - contents:
        - "6.2.4.2.  Multicast Service Procedures\n   The conditional access and admission
          control with grey lists\n   capability assumes that IGMP/MLD requests are
          terminated on the AN.\n   When the AN receives a join request, it MUST determine
          whether there\n   is a match to the requested flow in the grey list of the
          multicast\n   service profile provisioned against the given access line.
          \ If there\n   is no match, the request is discarded.  Otherwise, the AN
          MUST send a\n   Multicast Admission Control message to the NAS with content\n
          \  identifying the access line and the multicast flow to be added.  As\n
          \  indicated in Section 4.4, the AN MAY add information identifying the\n
          \  requesting device.\n   If the NAS decides to enable the flow, it MUST
          send a Multicast\n   Replication Control message to the AN to replicate
          the flow to the\n   access line with the Result field set to Nack (0x1),
          as described in\n   Section 4.3.1.\n   When the AN receives the Multicast
          Replication Control message, it\n   performs admission control if that has
          been enabled as described in\n   the previous section.  If admitting the
          flow would cause the\n   committed multicast bandwidth at the access line
          to exceed the\n   provisioned limit, the AN reports an error to the NAS
          as described in\n   Section 4.3.2.  Otherwise, it replicates the multicast
          flow as\n   requested.\n   If the NAS decides not to permit the flow, it
          MAY send a Multicast\n   Replication Control message in response to the
          Multicast Admission\n   Control message to allow the AN to update its internal
          records.  The\n   content of this message is described in Section 4.4.2.\n
          \  When the AN receives a leave request, it MUST terminate replication\n
          \  of the flow to the access line.  It MUST then send a Multicast\n   Admission
          Control message to the NAS indicating the deletion.  The\n   NAS updates
          its internal records but MUST NOT respond to the message.\n   If the AN
          receives a Provisioning message that updates an existing\n   multicast service
          profile, the AN MUST review the status of active\n   flows on all ports
          to which the updated profile has been assigned.\n   Similarly, if the AN
          receives a Port Management message that assigns\n   a new profile to a given
          port, the AN MUST review all active flows on\n   that port.  In either case,
          if any flow does not match an entry in\n   the grey list, it MUST be terminated
          immediately.\n"
        title: 6.2.4.2.  Multicast Service Procedures
      title: 6.2.4.  Procedures for Conditional Access and Admission Control with
    - contents:
      - '6.2.5.  Procedures for Bandwidth Delegation

        '
      - contents:
        - "6.2.5.1.  Provisioning\n   The NAS SHOULD provision an initial amount of
          delegated multicast\n   bandwidth for each access line using the Port Management
          message\n   containing the Bandwidth-Allocation TLV.\n      Note: If it
          fails to do so and a value has not been provisioned on\n      the AN by
          other means, the AN will be forced to request a\n      bandwidth allocation
          as soon as it receives a join request.\n   The NAS MAY, at any time, force
          an update of the amount of delegated\n   bandwidth by the same means.\n"
        title: 6.2.5.1.  Provisioning
      - contents:
        - "6.2.5.2.  Multicast Service Procedures\n   The bandwidth delegation capability
          assumes that IGMP/MLD requests\n   are terminated on the AN.  When the AN
          receives a join request, it\n   checks whether it has sufficient remaining
          uncommitted multicast\n   bandwidth on the access line to accommodate the
          new multicast flow.\n   If not, it MAY send a request to the NAS for an
          increased allocation\n   of delegated bandwidth using the Bandwidth Reallocation
          Request\n   message.  The NAS MUST return a Bandwidth Transfer message indicating\n
          \  whether it has granted the request and, if so, the new amount of\n   delegated
          bandwidth.\n   If the AN has sufficient uncommitted multicast capacity to
          admit the\n   request, either originally or as the result of a successful
          request\n   to the NAS, it replicates the requested flow to the access line.\n
          \  Otherwise, it discards the request.\n   When the AN receives a leave
          request for an active flow, it ceases\n   replication.\n   The NAS or AN
          MAY, at some point, detect that their respective views\n   of the amount
          of delegated bandwidth are inconsistent.  If so, they\n   can recover using
          procedures described in Sections 4.5 and 4.6.  As a\n   further aid to synchronization,
          either the NAS or the AN MAY from\n   time to time check the peer's view
          of the amount of delegated\n   bandwidth using the Delegated Bandwidth Query
          message.\n   The NAS or AN MAY, at any time, release bandwidth to the peer
          using\n   an autonomous Bandwidth Transfer message.  The contents of this\n
          \  message are described in Section 4.6.\n"
        title: 6.2.5.2.  Multicast Service Procedures
      title: 6.2.5.  Procedures for Bandwidth Delegation
    title: 6.2.  Capability-Specific Procedures for Providing Multicast Service
  - contents:
    - '6.3.  Combinations of Multicast Capabilities

      '
    - contents:
      - "6.3.1.  Combination of Conditional Access and Admission Control with\n        White
        and Black Lists and Conditional Access and Admission\n        Control with
        Grey Lists\n   If conditional access and admission control with white and
        black\n   lists is combined with conditional access and admission control
        with\n   grey lists, provisioning of the multicast service profiles is as\n
        \  described in Section 6.2.3.1 except that multicast service profiles\n   will
        also include grey lists.  Admission control is enabled\n   independently on
        the AN for white lists by including the White-List-\n   CAC TLV in the Provisioning
        message and for grey lists by including\n   the MRepCtl-CAC TLV in the Provisioning
        message.  The Bandwidth-\n   Allocation TLV provisions an amount that applies
        to both white- and\n   grey-listed flows if admission control is enabled for
        both.\n   With regard to multicast service procedures, one point of difference\n
        \  from the individual capabilities must be noted.  This is an\n   interaction
        during the profile matching procedure.  The AN MUST seek\n   the best match
        among multiple lists as described in Section 6.2.3.2.\n   However, if there
        are multiple matches of equal precision, the order\n   of priority is black
        list first, grey list second, and white list\n   last.\n   Once profile matching
        has been completed, processing of a join\n   request is as described in Section
        6.2.3.2 for white- or black-listed\n   flows or Section 6.2.4.2 for grey-listed
        flows.  Requests that do not\n   match any list SHOULD be discarded.\n   When
        the AN receives a leave request, it MUST terminate replication\n   of the
        flow to the access line.  If the flow was grey-listed, the AN\n   MUST then
        send a Multicast Admission Control message to the NAS\n   indicating the deletion.\n
        \  If the AN receives a Provisioning message that updates an existing\n   multicast
        service profile, the AN MUST review the status of active\n   flows on all
        ports to which the updated profile is currently\n   assigned.  Similarly,
        if a Port Management message assigns a new\n   multicast service profile to
        a given port, the AN MUST review all\n   active flows on that port.  If any
        flow has its most specific match\n   in a black list entry, it MUST be terminated
        immediately.  If any of\n   the remaining flows do not match an entry in the
        white or grey list,\n   they MUST also be terminated immediately.  Finally,
        if any remaining\n   flows were originally admitted because they were white-listed
        but\n   after the change they are grey-listed, the AN MUST generate a\n   Multicast
        Flow Query Response message autonomously as if it were\n   responding to a
        Multicast Flow Query Request message, listing all\n   such flows.  These flows
        MUST be allowed to continue until the NAS or\n   the subscriber terminates
        them.  Flows with their most specific match\n   in the white list MUST be
        allowed to continue.\n   The autonomously generated Multicast Flow Query Response
        message MUST\n   be formatted as if it were a successful response to a request\n
        \  containing no Target and no Multicast-Flow TLV, as described in\n   Section
        4.9.2, with the exception that the Transaction Identifier\n   field MUST be
        set to all zeroes.\n      Note: The procedures in the previous paragraphs
        imply that the AN\n      has to retain a memory of whether an admitted flow
        was white-\n      listed or grey-listed at the time of its admission/readmission.\n"
      title: 6.3.1.  Combination of Conditional Access and Admission Control with
    - contents:
      - "6.3.2.  Combination of Conditional Access and Admission Control with\n        Bandwidth
        Delegation\n   The provisioning and bandwidth management procedures of Section
        6.2.5\n   apply in addition to the procedures in Sections 6.2.3, 6.2.4, or\n
        \  6.3.1 as applicable.  Conditional access follows the rules given in\n   those
        sections in terms of matching flows against white and black\n   and/or grey
        lists.  When admission control is enabled at the AN, the\n   amount of bandwidth
        used by the AN is negotiable as described in\n   Section 6.2.5.2.\n"
      title: 6.3.2.  Combination of Conditional Access and Admission Control with
    - contents:
      - "6.3.3.  Combination of NAS-Initiated Replication with Other Capabilities\n
        \  NAS-initiated multicast replication can coexist with the other\n   capabilities,
        but some means must exist to prevent double replication\n   of flows.  The
        simplest way to do this is to terminate all IGMP/MLD\n   requests on the AN,
        so that NAS-initiated multicast replication is\n   stimulated only by signaling
        through other channels.  Other\n   arrangements are possible but need not
        be discussed here.\n   Assuming the necessary separation of responsibilities,
        the only point\n   of interaction between NAS-initiated multicast replication
        and the\n   other multicast capabilities is in the area of admission control.\n
        \  Specifically, if the AN is to do admission control for flows added by\n
        \  Multicast Replication Control messages, regardless of whether they\n   are
        part of NAS-initiated replication or grey list multicast service\n   processing,
        the NAS includes the MRepCtl-CAC TLV in a Provisioning\n   message and the
        Bandwidth-Allocation TLV in a Port Management\n   message.  If, instead, the
        NAS will do admission control for flows\n   added by Multicast Replication
        Control messages, regardless of\n   whether they are part of NAS-initiated
        replication or grey list\n   multicast service processing, it does not send
        the MRepCtl-CAC TLV in\n   a Provisioning message to the AN.  The NAS can
        independently enable\n   admission control for white flows on the AN by including
        the White-\n   List-CAC TLV in the Provisioning message.\n"
      title: 6.3.3.  Combination of NAS-Initiated Replication with Other Capabilities
    - contents:
      - "6.3.4.  Combinations of Committed Bandwidth Reporting with Other\n        Multicast
        Capabilities\n   Committed bandwidth reporting can take place independently
        of other\n   multicast capabilities that have been negotiated.  However, some\n
        \  combinations do not make sense because of redundancy.  In particular,\n
        \  the NAS obtains the same information that committed bandwidth\n   reporting
        gives if the only other capabilities operating are NAS-\n   initiated replication
        and/or conditional access and admission control\n   with grey lists.\n"
      title: 6.3.4.  Combinations of Committed Bandwidth Reporting with Other
    title: 6.3.  Combinations of Multicast Capabilities
  title: 6.  Multicast Capabilities
- contents:
  - "7.  Miscellaneous Considerations\n   This section deals with two sets of considerations.
    \ \"Report\n   Buffering Considerations\" considers requirements for configuration
    in\n   support of some of the committed bandwidth reporting capability.\n   \"Congestion
    Considerations\" is a warning to implementors about the\n   possibility of control-plane
    congestion, with suggestions for\n   mitigation.\n"
  - contents:
    - "7.1.  Report Buffering Considerations\n   The committed bandwidth reporting
      capability allows the provisioning\n   of a report buffering period to reduce
      the number of messages the AN\n   passes to the NAS.  An appropriate value for
      this period, if\n   buffering is allowed at all, depends first on the effect
      of delay in\n   reporting bandwidth changes and secondly on the rate at which\n
      \  bandwidth changes are expected to occur.\n   Let us assume, in the first
      instance, that a delay in adjusting\n   hierarchical scheduling at the NAS causes
      additional bandwidth demand\n   to be served momentarily on a best-effort basis,
      introducing the\n   possibility of jitter and, more crucially, packet loss.
      \ Appendix IV\n   of ITU-T Recommendation G.1080 [ITU-T_G.1080] indicates that
      the\n   maximum tolerable duration of a loss episode is less than 16 ms.\n   This
      would more likely apply in the middle of a program rather than\n   when it was
      starting up but at least gives an (extremely\n   conservative) order of magnitude
      for setting the buffering period.\n   The next question is whether enough messaging
      is likely to be\n   generated that multiple bandwidth changes would be observed
      within\n   such an interval.  Let us consider a reasonable example in a DSL\n
      \  environment, where during the busiest hour of the day subscribers\n   start
      watching at the rate of one program per subscriber per hour.\n   Typically,
      because of program scheduling, the new channel requests\n   might be concentrated
      within a three-minute period, giving an\n   effective request rate of 1/(3 minutes
      * 60 seconds * 1000 ms/second)\n   * 16 ms = 0.00009 requests per buffering
      interval of 16 ms.  With\n   these figures, an AN serving 10,000 subscribers
      will report an\n   average of 0.9 bandwidth changes per 16 ms buffering interval.
      \ It\n   appears that buffering is worthwhile only for larger-scale\n   deployments.\n
      \  Note that simple replacement of one channel with another -- channel\n   surfing
      -- does not require reporting or adjustment at the NAS end.\n"
    title: 7.1.  Report Buffering Considerations
  - contents:
    - "7.2.  Congestion Considerations\n   Implementors must beware of the possibility
      that a single channel-\n   surfing subscriber could generate enough control
      messaging to\n   overload the AN or the messaging channel between the AN and
      the NAS.\n   The implementation problem is to strike the right balance between\n
      \  minimizing the processing of requests that have been overtaken by\n   subsequent
      events and meeting requirements for what is termed\n   \"channel zapping delay\".
      \ Nominally, such a requirement is to be\n   found in Section 8.1 of [ITU-T_G.1080],
      but unfortunately no\n   quantitative value was available at the time of publication
      of this\n   document.  Implementors will therefore have to base their work on\n
      \  discussions with customers until standardized requirements become\n   available.
      \ (It is possible that regional bodies or more specialized\n   bodies have overtaken
      the ITU-T in this regard.)\n   A typical strategy for minimizing the work associated
      with request\n   processing includes deliberate buffering of join requests for
      a short\n   period in case matching Release requests are detected, followed
      by\n   discard of both requests.  More generally, processing of requests\n   from
      individual subscribers may be rate limited, and the global rate\n   of messaging
      to the NAS can also be limited.  If the AN gets\n   overloaded, deliberate dropping
      of stale requests can be implemented,\n   for some definitions of \"stale\".\n"
    title: 7.2.  Congestion Considerations
  title: 7.  Miscellaneous Considerations
- contents:
  - "8.  Security Considerations\n   The security considerations of ANCP are discussed
    in [RFC6320] and in\n   [RFC5713].  Multicast does not, in principle, introduce
    any new\n   security considerations, although it does increase the attractiveness\n
    \  of ANCP as a means of denial of service (e.g., through direction of\n   multicast
    streams onto the target) or theft of service.\n   As mentioned in Section 4.4,
    the inclusion of the Request-Source-MAC\n   TLV or Request-Source-IP TLV in the
    Multicast Admission Control\n   message presents privacy issues.  An attacker
    able to get access to\n   the contents of this message would, like the content
    provider, be\n   able to track consumption of multicast content to the individual\n
    \  device and potentially to individual persons if they are associated\n   with
    particular devices.  To make the connection between devices and\n   individuals,
    the attacker needs to get information from sources other\n   than ANCP, of course,
    but let us assume that this has happened.\n   The protection specified for ANCP
    in [RFC6320] will apply to the\n   transmission of the Multicast Admission Control
    message across the\n   access network to the NAS.  Hence, the attacker's potential
    points of\n   access are between the subscriber and the AN, at the AN and at the\n
    \  NAS.  Moreover, if the MAC or IP address are transmitted onwards from\n   the
    NAS to AAA in a request for policy, that whole onward path has to\n   be examined
    for vulnerability.\n   The question is how many of these potential points of attack
    can be\n   eliminated through operational practice.  The segment from the\n   subscriber
    through the AN itself seems out of the scope of this\n   discussion -- protection
    of this segment is basic to subscriber\n   privacy in any event and likely a business
    requirement.  The segment\n   from the AN to the NAS is covered by the basic ANCP
    protection\n   specified in [RFC6320].  This leaves the NAS and the path between
    the\n   NAS and AAA for consideration.\n   The operator can eliminate the path
    between the NAS and AAA as a\n   point where the attacker can access per-device
    information by\n   downloading per-device policy to the NAS for all identified
    user\n   devices for the particular subscriber.  The NAS then selects the\n   applicable
    policy based on the particular device identifier it has\n   received.  This is
    as opposed to the NAS sending the identifier of\n   the device in question to
    AAA and getting policy just for that\n   device.\n   The alternative is to protect
    the path between the NAS and AAA.  If\n   Diameter is used as the AAA protocol,
    Section 2.2 of [RFC6733]\n   mandates use of IPsec, TLS/TCP, or DTLS/SCTP for
    that purpose.  If\n   RADIUS is used, the operator should deploy TLS transport
    as specified\n   in [RFC6614].\n   This leaves the NAS itself as a point of attack.
    \ In theory, the NAS\n   could be eliminated if the AN remapped the requesting
    MAC or IP\n   address to an identifier known to itself and AAA but not the NAS.\n
    \  This would require local configuration on the AN, which may be\n   possible
    under some circumstances.  The Request-Source-Device-Id TLV\n   specified in Section
    5.11 is available to transmit such an identifier\n   in place of the Request-Source-MAC
    TLV or Request-Source-IP TLV.\n"
  title: 8.  Security Considerations
- contents:
  - "9.  IANA Considerations\n   This document defines the following additional values
    within the\n   \"ANCP Message Types\" registry:\n       +--------------+--------------------------------+-----------+\n
    \      | Message Type | Message Name                   | Reference |\n       +--------------+--------------------------------+-----------+\n
    \      | 144          | Multicast Replication Control  | RFC 7256  |\n       |
    \             |                                |           |\n       | 145          |
    Multicast Admission Control    | RFC 7256  |\n       |              |                                |
    \          |\n       | 146          | Bandwidth Reallocation Request | RFC 7256
    \ |\n       |              |                                |           |\n       |
    147          | Bandwidth Transfer             | RFC 7256  |\n       |              |
    \                               |           |\n       | 148          | Delegated
    Bandwidth Query      | RFC 7256  |\n       |              |                                |
    \          |\n       | 149          | Multicast Flow Query           | RFC 7256
    \ |\n       |              |                                |           |\n       |
    150          | Committed Bandwidth Report     | RFC 7256  |\n       +--------------+--------------------------------+-----------+\n
    \  This document defines the following additional values for the \"ANCP\n   Result
    Codes\" registry.  In support of these assignments, IANA has\n   changed the lower
    limit of 0x100 specified by [RFC6320] for\n   assignments by IETF Consensus to
    0x64.\n   +------------+------------------------------------------+-----------+\n
    \  | Result     | One-Line Description                     | Reference |\n   |
    Code       |                                          |           |\n   +------------+------------------------------------------+-----------+\n
    \  | 0x64       | Command error.                           | RFC 7256  |\n   |
    \           |                                          |           |\n   | 0x65
    \      | Invalid flow address.                    | RFC 7256  |\n   |            |
    \                                         |           |\n   | 0x66       | Multicast
    flow does not exist.           | RFC 7256  |\n   |            |                                          |
    \          |\n   | 0x67       | Invalid preferred bandwidth amount.      | RFC
    7256  |\n   |            |                                          |           |\n
    \  | 0x68       | Inconsistent views of delegated          | RFC 7256  |\n   |
    \           | bandwidth amount.                        |           |\n   |            |
    \                                         |           |\n   | 0x69       | Bandwidth
    request conflict.              | RFC 7256  |\n   +------------+------------------------------------------+-----------+\n
    \  This document defines the following additional values for the \"ANCP\n   Command
    Codes\" registry:\n   +----------------+--------------------------------------+-----------+\n
    \  | Command Code   | Command Code Directive Name          | Reference |\n   |
    Value          |                                      |           |\n   +----------------+--------------------------------------+-----------+\n
    \  | 1              | Add                                  | RFC 7256  |\n   |
    \               |                                      |           |\n   | 2              |
    Delete                               | RFC 7256  |\n   |                |                                      |
    \          |\n   | 3              | Delete All                           | RFC
    7256  |\n   |                |                                      |           |\n
    \  | 4              | Admission Control Reject             | RFC 7256  |\n   |
    \               |                                      |           |\n   | 5              |
    Conditional Access Reject            | RFC 7256  |\n   |                |                                      |
    \          |\n   | 6              | Admission Control and Conditional    | RFC
    7256  |\n   |                | Access Reject                        |           |\n
    \  +----------------+--------------------------------------+-----------+\n   This
    document defines the following additional values within the\n   \"ANCP TLV Types\"
    registry:\n        +-----------+--------------------------------+-----------+\n
    \       | Type Code | TLV Name                       | Reference |\n        +-----------+--------------------------------+-----------+\n
    \       | 0x0013    | Multicast-Service-Profile      | RFC 7256  |\n        |
    \          |                                |           |\n        | 0x0015    |
    Bandwidth-Allocation           | RFC 7256  |\n        |           |                                |
    \          |\n        | 0x0016    | Bandwidth-Request              | RFC 7256
    \ |\n        |           |                                |           |\n        |
    0x0018    | Multicast-Service-Profile-Name | RFC 7256  |\n        |           |
    \                               |           |\n        | 0x0019    | Multicast-Flow
    \                | RFC 7256  |\n        |           |                                |
    \          |\n        | 0x0021    | List-Action                    | RFC 7256
    \ |\n        |           |                                |           |\n        |
    0x0022    | Sequence-Number                | RFC 7256  |\n        |           |
    \                               |           |\n        | 0x0024    | White-List-CAC
    \                | RFC 7256  |\n        |           |                                |
    \          |\n        | 0x0025    | MRepCtl-CAC                    | RFC 7256
    \ |\n        |           |                                |           |\n        |
    0x0092    | Request-Source-IP              | RFC 7256  |\n        |           |
    \                               |           |\n        | 0x0093    | Request-Source-MAC
    \            | RFC 7256  |\n        |           |                                |
    \          |\n        | 0x0094    | Report-Buffering-Time          | RFC 7256
    \ |\n        |           |                                |           |\n        |
    0x0095    | Committed-Bandwidth            | RFC 7256  |\n        |           |
    \                               |           |\n        | 0x0096    | Request-Source-Device-Id
    \      | RFC 7256  |\n        +-----------+--------------------------------+-----------+\n
    \  This document defines the following additional values for the \"ANCP\n   Capability
    Types\" registry:\n   +-------+-------------------------+--------+------------+-----------+\n
    \  | Value | Capability Type Name    | Tech   | Capability | Reference |\n   |
    \      |                         | Type   | Data?      |           |\n   +-------+-------------------------+--------+------------+-----------+\n
    \  | 3     | NAS-Initiated Multicast | 0      | No         | RFC 7256  |\n   |
    \      | Replication             |        |            |           |\n   |       |
    \                        |        |            |           |\n   | 5     | Committed
    Bandwidth     | 0      | No         | RFC 7256  |\n   |       | Reporting               |
    \       |            |           |\n   |       |                         |        |
    \           |           |\n   | 6     | Conditional Access and  | 0      | No
    \        | RFC 7256  |\n   |       | Admission Control with  |        |            |
    \          |\n   |       | White and Black Lists   |        |            |           |\n
    \  |       |                         |        |            |           |\n   |
    7     | Conditional Access and  | 0      | No         | RFC 7256  |\n   |       |
    Admission Control with  |        |            |           |\n   |       | Grey
    Lists              |        |            |           |\n   |       |                         |
    \       |            |           |\n   | 8     | Bandwidth Delegation    | 0      |
    No         | RFC 7256  |\n   +-------+-------------------------+--------+------------+-----------+\n"
  title: 9.  IANA Considerations
- contents:
  - "10.  Acknowledgements\n   The authors would like to acknowledge Wojciech Dec
    for providing\n   useful input to this document, Robert Rennison for his help
    in\n   shaping the definition of the Multicast-Service-Profile TLV, Shridhar\n
    \  Rao for his comments and suggestions, and Aniruddha A for his\n   proposal
    that formed the base of the Multicast Flow Reporting\n   solution.  Philippe Champagne,
    Sanjay Wadhwa, and Stefaan De Cnodder\n   provided substantial contributions on
    the solution for the NAS-\n   initiated multicast control use case.  Kristian
    Poscic provided the\n   committed bandwidth reporting use case.\n   Thanks to
    the Document Shepherd, Matthew Bocci, and Area Director,\n   Ted Lemon, for points
    raised by their reviews following Working Group\n   Last Call.\n   Further thanks
    to Dacheng Zhang, Mehmet Ersue, and Christer Holmberg\n   for their reviews on
    behalf of the Security, Operations, and Gen-Art\n   directorates.  Dacheng's comments
    led to changes at several points in\n   the document, while Mehmet's led to creation
    of the Miscellaneous\n   Considerations section.  Finally, thanks to Brian Haberman
    for\n   stimulating a review of the architectural assumptions and their\n   relationship
    to the ability of user devices to obtain access to non-\n   IPTV multicast services.
    \ This also led to changes in the document.\n"
  title: 10.  Acknowledgements
- contents:
  - '11.  References

    '
  - contents:
    - "11.1.  Normative References\n   [PIMreg]   IANA, \"Protocol Independent Multicast
      (PIM) Parameters\",\n              <http://www.iana.org/assignments/pim-parameters>.\n
      \  [RFC2119]  Bradner, S., \"Key words for use in RFCs to Indicate\n              Requirement
      Levels\", BCP 14, RFC 2119, March 1997.\n   [RFC2710]  Deering, S., Fenner,
      W., and B. Haberman, \"Multicast\n              Listener Discovery (MLD) for
      IPv6\", RFC 2710, October\n              1999.\n   [RFC3376]  Cain, B., Deering,
      S., Kouvelas, I., Fenner, B., and A.\n              Thyagarajan, \"Internet
      Group Management Protocol, Version\n              3\", RFC 3376, October 2002.\n
      \  [RFC3810]  Vida, R. and L. Costa, \"Multicast Listener Discovery\n              Version
      2 (MLDv2) for IPv6\", RFC 3810, June 2004.\n   [RFC5790]  Liu, H., Cao, W.,
      and H. Asaeda, \"Lightweight Internet\n              Group Management Protocol
      Version 3 (IGMPv3) and Multicast\n              Listener Discovery Version 2
      (MLDv2) Protocols\", RFC 5790,\n              February 2010.\n   [RFC6320]  Wadhwa,
      S., Moisand, J., Haag, T., Voigt, N., and T.\n              Taylor, \"Protocol
      for Access Node Control Mechanism in\n              Broadband Networks\", RFC
      6320, October 2011.\n"
    title: 11.1.  Normative References
  - contents:
    - "11.2.  Informative References\n   [IEEE48]   IEEE, \"Guidelines for 48-Bit
      Global Identifier\",\n              <http://standards.ieee.org/regauth/oui/tutorials/\n
      \             EUI48.html>.\n   [IEEE64]   IEEE, \"Guidelines for 64-Bit Global
      Identifier\",\n              <http://standards.ieee.org/regauth/oui/tutorials/\n
      \             EUI64.html>.\n   [ITU-T_G.1080]\n              ITU-T, \"Quality
      of experience requirements for IPTV\n              services\", ITU-T Recommendation
      G.1080, December 2008.\n   [RFC2236]  Fenner, W., \"Internet Group Management
      Protocol, Version\n              2\", RFC 2236, November 1997.\n   [RFC4601]
      \ Fenner, B., Handley, M., Holbrook, H., and I. Kouvelas,\n              \"Protocol
      Independent Multicast - Sparse Mode (PIM-SM):\n              Protocol Specification
      (Revised)\", RFC 4601, August 2006.\n   [RFC5713]  Moustafa, H., Tschofenig,
      H., and S. De Cnodder, \"Security\n              Threats and Security Requirements
      for the Access Node\n              Control Protocol (ANCP)\", RFC 5713, January
      2010.\n   [RFC5851]  Ooghe, S., Voigt, N., Platnic, M., Haag, T., and S.\n              Wadhwa,
      \"Framework and Requirements for an Access Node\n              Control Mechanism
      in Broadband Multi-Service Networks\",\n              RFC 5851, May 2010.\n
      \  [RFC6614]  Winter, S., McCauley, M., Venaas, S., and K. Wierenga,\n              \"Transport
      Layer Security (TLS) Encryption for RADIUS\",\n              RFC 6614, May 2012.\n
      \  [RFC6733]  Fajardo, V., Arkko, J., Loughney, J., and G. Zorn,\n              \"Diameter
      Base Protocol\", RFC 6733, October 2012.\n"
    title: 11.2.  Informative References
  title: 11.  References
- contents:
  - "Appendix A.  Example of Messages and Message Flows\n   This appendix provides
    an example in which most of the possible\n   message flows for multicast control
    are illustrated.  This appendix\n   is for informational purposes only.  In case
    of discrepancy with text\n   in the body of this document, the text in the body
    of the document is\n   to be considered as the normative text.\n   Assume the
    following, for a given access port:\n   o  The basic subscribed service is white-listed.
    \ The AN will be\n      responsible for admission control for this service.\n
    \  o  Some premium services are available, but requests for these\n      services
    must be referred to the Policy Server for proper credit\n      processing.  For
    this reason, they are grey-listed.  The NAS will\n      be responsible for admission
    control for these services.\n   o  The subscriber has asked that certain services
    be blocked so that\n      his children cannot view them.  These services are black-listed.\n
    \  o  All of the above services are Source-Specific Multicast (SSM).  In\n      addition,
    by means that bypass the AN, the subscriber can signal\n      intent to join an
    on-line game service that is Any-Source\n      Multicast (ASM).  The NAS is responsible
    for admission control for\n      this service.\n   o  Bandwidth delegation is,
    in effect, to share video bandwidth\n      between the AN and the NAS.\n   The
    stated conditions require the use of four of the five\n   capabilities specified
    in this memo.\n"
  - contents:
    - "A.1.  Provisioning Phase\n   Assume that capability negotiation has been completed
      between the AN\n   and NAS and that the set of negotiated capabilities includes
      the\n   following four multicast capabilities: NAS-initiated multicast\n   replication,
      conditional access and admission control with white and\n   black lists, conditional
      access and admission control with grey\n   lists, and bandwidth delegation.
      \ At this point, the NAS can\n   provision the service profiles on the AN and
      enable admission control\n   at the AN for white-listed flows.  To do this,
      the NAS sends the AN a\n   Provisioning message containing this information.
      \ An example message\n   providing the profile for our assumed subscriber is
      shown in\n   Figure 22.  The message has the following contents:\n   o  Message
      Type is 93.\n   o  The Result and Result Code fields in the header are set to
      zeroes,\n      as specified [RFC6320].\n   o  A Transaction Identifier is assigned
      by the NAS.\n   o  The Multicast-Service-Profile TLV (of which typically there
      would\n      be multiple instances) contains a Multicast-Service-Profile-Name\n
      \     TLV (with a length of 20 octets assumed for the example) and three\n      List-Action
      TLVs, one each for the white, grey, and black lists\n      within the profile.
      \ The white list flows come in two sets of\n      group addresses: 233.252.0.0/29,
      coming from a server at\n      192.0.2.15, and 233.252.0.32/29, coming from
      a server at\n      192.0.2.16.  The grey-listed flows are in the band\n      233.252.0.64/29,
      coming from a server at 192.0.2.21.  Finally, the\n      black list flows are
      two individual flows that happen to overlap\n      with the grey list band:
      233.252.0.65 and 233.252.0.69, also with\n      source 192.0.2.21.\n   o  The
      White-List-CAC TLV indicates that the AN does admission\n      control on white-listed
      flows.\n                        1                   2                   3\n
      \   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |        Type (0x880C)          |           Length = 132        |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |   Version     | Msg Type = 93 | Res=0 |    Result Code = 0    |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Partition ID  |            Transaction Identifier             |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |I|      SubMessage Number      |       Length = 132            |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Mcast-Service-Profile  0x0013 |       TLV Length = 112        |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Mcast-Svc-Profile-Name 0x0018 |  Embedded TLV Length = 20     |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                  Multicast service profile name               |\n   ~                  =
      \"Cust 0127-53681-0003\"                     ~\n   |                                                               |\n
      \  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n   | TLV
      Type = List-Action 0x0021 |   Embedded TLV Length = 28    |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Operation = 1 | List Type = 1 |        Reserved = 0x0000      |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |    Address Family = 1         |       List Length = 20        |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | G PrefLen = 29| S PrefLen = 32| Group prefix =                |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |      233.252.0.0              | Source prefix =               |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |      192.0.2.15               | G PrefLen = 29| S PrefLen = 32|\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |         Group prefix = 233.252.0.32                           |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |        Source prefix = 192.0.2.16                             |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | TLV Type = List-Action 0x0021 |   Embedded TLV Length = 18    |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Operation = 1 | List Type = 3 |        Reserved = 0x0000      |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |    Address Family = 1         |       List Length = 10        |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | G PrefLen = 29| S PrefLen = 32| Group prefix =                /\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  /      233.252.0.64             | Source prefix =               /\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  /      192.0.2.21               |   Padding = 0x0000            |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | TLV Type = List-Action 0x0021 |   Embedded TLV Length = 28    |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Operation = 1 | List Type = 2 |        Reserved = 0x0000      |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |    Address Family = 1         |       List Length = 20        |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | G PrefLen = 32| S PrefLen = 32| Group prefix =                /\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  /      233.252.0.65             | Source prefix =               /\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  /      192.0.2.21               | G PrefLen = 32| S PrefLen = 32|\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |         Group prefix = 233.252.0.69                           |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |        Source prefix = 192.0.2.21                             |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Type = White-List-CAC  0x0024 |          TLV Length = 0       |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \                 Figure 22: Example Provisioning Message\n   Note that the
      padding after the middle List-Action TLV is counted as\n   part of the length
      of the Multicast-Service-Profile TLV but is not\n   included in the length of
      that List-Action TLV.  Note also that the\n   Length field in the message header,
      unlike those in the TLVs,\n   includes the message header itself, as required
      by [RFC6320].\n   Finally, note that the Provisioning message does not include
      a\n   MRepCtl-CAC TLV since in our example admission control for grey-\n   listed
      flows and for NAS-initiated replication is performed by the\n   NAS.\n   As
      soon as the AN port comes up, the AN sends an ANCP PORT_UP message\n   to the
      NAS specifying the Access Loop Circuit ID.  The NAS replies\n   with an ANCP
      Port Management message that, together with the other\n   parameters, includes
      the multicast service profile name to be\n   associated to that port along with
      the initial amount of delegated\n   bandwidth.  The corresponding message flow
      is illustrated in\n   Figure 23.\n    +----------+      +---------+         +-----+
      \              +-----+\n    |Subscriber|      |  Home   |         | AN  |               |
      NAS |\n    +----------+      | Gateway |         +-----+               +-----+\n
      \        |            +---------+            |                     |\n         |
      \                |                 |                     |\n         |                 |
      \                |                     |\n         |                 |   DSL
      Synch.    |                     |\n         |                 |---------------->|
      \                    |\n         |                 |                 |(M1)PORT_UP(Port
      ID) |\n         |                 |                 |-------------------->|\n
      \        |                 |                 |                    (*)\n         |
      \                |                 |(M2) PORT_MNGT       |\n         |                 |
      \                |    (Port ID,        |\n         |                 |                 |Mcast
      S Profile Name,|\n         |                 |                 |Bandwidth Allocation)|\n
      \        |                 |                 |<--------------------|\n   (*)
      The NAS may optionally seek direction from an external\n       Authorization/Policy
      Server\n    Figure 23: Configuring an AN Port with Multicast Service Profile
      ID\n                      and Delegated Bandwidth Amount\n   The Port Management
      message will typically contain other TLVs, but\n   our example (Figure 24) just
      shows the Target, Multicast-Service-\n   Profile-Name, and Bandwidth-Allocation
      TLVs.  The Target TLV\n   identifies the subscriber line, the Multicast-Service-Profile-Name\n
      \  TLV is identical to the one contained in the Provisioning message,\n   and
      the Bandwidth-Allocation TLV provides just enough bandwidth (2000\n   kbits/s)
      for one channel to start with.\n   The following fields in the Port Management
      message header are shown\n   with specific values either as directed by the
      base protocol document\n   or for the sake of our example:\n   o  Message Type
      is 32.\n   o  Result is set to Nack (0x1) for this example.\n   o  Result Code
      is 0.\n   o  A Transaction Identifier is assigned by the NAS.\n   o  Port is
      set to 0.\n   o  Event Sequence Number, the R flag and the other bits marked
      x,\n      Duration, the Event Flags, and the Flow Control Flags are all\n      irrelevant
      for this function and are set to 0.\n   o  Function is set to \"Configure Connection
      Service Data\" (8).\n   o  X-Function is set to 0.\n   o  Tech Type is \"DSL\"
      (5).\n   o  Block lengths are calculated assuming a Circuit-Id length of 4 in\n
      \     our example.  Recall that the example Multicast-Service-Profile-\n      Name
      TLV length is 20.\n                        1                   2                   3\n
      \   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |        Type (0x880C)          |           Length = 84         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |   Version     | Msg Type = 32 | Res=1 |    Result Code = 0    |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Partition ID  |            Transaction Identifier             |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |I|      SubMessage Number      |           Length = 84         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                             Port = 0                          |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                      Port Session Number                      |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                     Event Sequence Number = 0                 |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |R|x|x|x|x|x|x|x| Duration = 0  | Function = 0x8| X-Function = 0|\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |           Event Flags         |        Flow Control Flags     |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |x|x|x|x|x|x|x|x| Msg Type = 32 |  Tech Type=5  | Blk Len = 56  |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |     # of TLVs = 3             | Extension Block length = 44   |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | TLV Type = Target      0x1000 |        Target TLV Length = 8  |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Access-Loop-Circuit-ID 0x0001 |        Circuit-ID Length = 4  |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                    Access Loop Circuit ID                     |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Mcast-Svc-Profile-Name 0x0018 |       TLV Length = 20         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                  Multicast service profile name               |\n   ~                  =
      \"Cust 0127-53681-0003\"                     ~\n   |                                                               |\n
      \  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n   |  Bandwidth-Allocation
      \ 0x0015 |       TLV Length = 4          |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                Bandwidth value = 2000 (kbits/s)               |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \               Figure 24: Example Port Management Message\n"
    title: A.1.  Provisioning Phase
  - contents:
    - "A.2.  Handling Grey-Listed Flows\n   Suppose now that the subscriber chooses
      to watch the premium channel\n   characterized by source 192.0.2.21, group 233.252.0.67.
      \ Upon\n   receiving the join request, the AN matches it against the multicast\n
      \  service profile for the port and determines that it is a grey-listed\n   flow.
      \ Figure 25 illustrates the resulting ANCP message flow for the\n   case of
      a simple join and leave, when admission control for grey-\n   listed flows is
      not activated on the AN.\n   To start the flow, the AN sends a Multicast Admission
      Control message\n   (M1) to the NAS.  The NAS decides whether the flow can be
      admitted,\n   applying both policy and bandwidth criteria.  It returns its decision\n
      \  (positive in this example) in a Multicast Replication Control message\n   (M2).
      \ Later, when the subscriber leaves the flow, the AN informs the\n   NAS by
      sending another Multicast Admission Control message.\n   +----------+    +-------+
      \  +-----+    ANCP    +-----+\n   |Subscriber|    | Home  |   | AN  |<---------->|
      NAS |\n   +----------+    |Gateway|   +-----+            +-----+\n         |
      \        +-------+     |                   |\n         |           |           |
      \    Multicast     |\n         |      Join(Grey-Fl)    |     Admission     |\n
      \        |-----------+---------->|      Control (M1) |\n         |           |
      \          |------------------>|\n         |           |           |                   |
      \ (NAS performs\n         |           |           |     Multicast     |   admission\n
      \        |           |           |     Replication  (*)  control)\n         |
      \          |           |     Control (M2)  |\n         |     Mcast Grey Flow
      \  |<------------------|\n         |<======================+                   |\n
      \        |           |           |                   |\n         ~           ~
      \          ~                   ~\n         |           |           |     Multicast
      \    |\n         |     Leave(Grey-Fl)    |     Admission     |\n         |-----------+---------->|
      \     Control (M3) |\n         |           |           |------------------>|\n
      \        |           |           |                   |\n   Grey-Fl: multicast
      flow matching an entry in grey list\n   (*) The NAS may optionally seek direction
      from an external\n   Authorization/Policy Server.\n       Figure 25: Successful
      Join/Leave Operations, Grey-Listed Flow\n   The Multicast Admission Control
      message M1 contains:\n   o  an ANCP Header with:\n      *  Message Type is 145;\n
      \     *  Result = Ignore (0x0); and\n      *  a Transaction Identifier assigned
      by the AN.\n   o  a Target TLV identifying the AN Port\n   o  a Command TLV
      containing:\n      *  Command Code = \"Add\" (1);\n      *  Accounting = \"No\"
      (0);\n      *  a Multicast-Flow embedded TLV indicating the multicast flow for\n
      \        which the AN received the IGMP join: flow type \"SSM\" (2),\n         address
      family \"IPv4\" (1), Group address = 233.252.0.67, Source\n         Address
      = 192.0.2.21; and\n      *  a Request-Source-Device-Id embedded TLV containing
      the IGMP\n         join source local device identifier value 5.\n   The Multicast
      Admission Control message M1 is illustrated in\n   Figure 26:\n                        1
      \                  2                   3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4
      5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |        Type (0x880C)          |           Length = 98         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |   Version     | Msg Type=145  | Res=0 |    Result Code = 0    |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Partition ID  |            Transaction Identifier             |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |I|      SubMessage Number      |           Length = 98         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | TLV Type = Target      0x1000 |        Target TLV Length = 8  |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Access-Loop-Circuit-ID 0x0001 |        Circuit-ID Length = 4  |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                    Access Loop Circuit ID                     |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | TLV Type = Command     0x0011 |       TLV Length = 28         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |  Cmd Code = 1 |   Acctg = 0   |      Reserved = 0x0000        |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Type = Multicast-Flow  0x0019 |   Embedded TLV Length = 12    |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Flow Type = 2 |  Addr Fam = 1 |     Reserved = 0x0000         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |             Multicast Group Address = 233.252.0.67            |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |               Unicast Source Address =  192.0.2.21            |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+--+\n
      \  |Request-Source-Device-Id 0x0092|   Embedded TLV length = 4     |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                         Value = 5                             |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  Figure 26: Multicast Admission Control Message Seeking to Add a Flow\n   The
      Multicast Replication Control message M2 contains:\n   o  an ANCP Header with:\n
      \     *  Message Type = \"Multicast Replication Control\" (144);\n      *  Result=
      0x1 (Nack); and\n      *  a Transaction Identifier assigned by the NAS;\n   o
      \ a Target TLV identifying the AN Port\n   o  a Command TLV containing:\n      *
      \ Command Code = \"Add\" (1);\n      *  Accounting = \"Yes\" (1), since in our
      example the operator wants\n         accounting on this flow; and\n      *  a
      Multicast-Flow embedded TLV indicating the multicast flow\n         that the
      NAS is admitting for this access line: flow type \"SSM\"\n         (2), address
      family \"IPv4\" (1), Group address = 233.252.0.67,\n         Source Address
      = 192.0.2.21.\n   The Multicast Admission Control message M2 is illustrated
      in\n   Figure 27.\n                        1                   2                   3\n
      \   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |        Type (0x880C)          |           Length = 48         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |   Version     | Msg Type=144  | Res=1 |    Result Code =  0   |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Partition ID  |            Transaction Identifier             |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |I|      SubMessage Number      |           Length = 48         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Target          Type = 0x1000 |        Target TLV Length = 8  |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Access-Loop-Circuit-ID 0x0001 |        Circuit-ID Length = 4  |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                    Access Loop Circuit ID                     |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | TLV Type = Command     0x0011 |       TLV Length = 20         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |  Cmd Code = 1 |   Acctg = 1   |      Reserved = 0x0000        |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Type = Multicast-Flow  0x0019 |   Embedded TLV Length = 12    |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Flow Type = 2 |  Addr Fam = 1 |     Reserved = 0x0000         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |             Multicast Group Address = 233.252.0.67            |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |               Unicast Source Address =  192.0.2.21            |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \    Figure 27: Multicast Replication Control Message Admitting a Flow\n   The
      Multicast Admission Control message M3 advising the NAS that the\n   flow has
      been terminated contains:\n   o  an ANCP Header with:\n      *  Message Type
      is 145;\n      *  Result = Ignore (0x0); and\n      *  a Transaction Identifier
      assigned by the AN.\n   o  a Target TLV identifying the access line\n   o  a
      Command TLV containing:\n      *  a Command Code = \"Delete\" (2);\n      *
      \ Accounting = \"No\" (0);\n      *  a Multicast-Flow embedded TLV indicating
      the multicast flow for\n         which the AN received the IGMP leave: flow
      type \"SSM\" (2),\n         address family \"IPv4\" (1), Group address = 233.252.0.67,
      Source\n         Address = 192.0.2.21; and\n      *  a Request-Source-Device-Id
      embedded TLV containing the IGMP\n         leave request source, the device
      identified by the local value\n         5.\n   The Multicast Admission Control
      message M3 is illustrated in\n   Figure 28.\n                        1                   2
      \                  3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4
      5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |        Type (0x880C)          |           Length              |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |   Version     | Msg Type=145  | Res=0 |    Result Code = 0    |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Partition ID  |            Transaction Identifier             |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |I|      SubMessage Number      |           Length              |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | TLV Type = Target      0x1000 |        Target TLV Length = 8  |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Access-Loop-Circuit-ID 0x0001 |        Circuit-ID Length = 4  |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                    Access Loop Circuit ID                     |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | TLV Type = Command     0x0011 |       TLV Length = 28         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |  Cmd Code = 2 |    Acctg = 0  |      Reserved = 0x0000        |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Multicast-Flow  Type = 0x0019 |   Embedded TLV Length = 12    |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Flow Type = 2 |  Addr Fam = 1 |     Reserved = 0x0000         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |             Multicast Group Address = 233.252.0.67            |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |               Unicast Source Address =  192.0.2.21            |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |Request-Source-Device-Id 0x0092|   Embedded TLV length = 4     |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                          Value = 5                            |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \      Figure 28: Multicast Admission Control Message Signaling Flow\n                                Termination\n"
    title: A.2.  Handling Grey-Listed Flows
  - contents:
    - "A.3.  Handling White-Listed Flows\n   The NAS has enabled white list admission
      control on the AN, and the\n   bandwidth delegation capability has been negotiated.
      \ White-listed\n   flows in themselves require no messages to the NAS, either
      upon\n   admission or upon termination, but the AN may request an increase in\n
      \  the amount of delegated bandwidth if it needs the increase to admit a\n   flow.\n
      \  Consider an example where the AN has already admitted one white-\n   listed
      flow, thereby using up the initially provisioned amount of\n   delegated bandwidth
      (2000 kbits/s).  A request is received to join a\n   new flow in the white list
      range.  The AN chooses to send a Bandwidth\n   Reallocation Request message
      to the NAS, requesting that the\n   delegated bandwidth allocation be increased
      to 4000 kbits/s at a\n   minimum and preferably to 6000 kbits/s.\n   In our
      example, the NAS is managing bandwidth tightly, as witnessed\n   by its minimal
      initial allocation of just enough for one flow.  It is\n   willing to provide
      the minimum additional amount only and therefore\n   returns a Bandwidth Transfer
      message where the delegated bandwidth\n   value is given as 4000 kbits/s.  With
      this amount, the AN is able to\n   admit the second white-listed flow.  The
      AN could send a similar\n   Bandwidth Transfer message back to the NAS bringing
      the delegated\n   bandwidth amount back down to 2000 kbits/s when one of the
      flows is\n   terminated, but this shows nothing new and is omitted.\n   As one
      more point of illustration, suppose that the NAS chooses to\n   audit the current
      amount of delegated bandwidth to ensure it is\n   synchronized with the AN.
      \ It sends a Delegated Bandwidth Query\n   Request message to the AN and receives
      a Delegated Bandwidth Query\n   Response message with the current allocation
      as the AN sees it.\n   The complete message flow is shown in Figure 29.\n   +----------+
      \   +-------+   +-----+    ANCP    +-----+\n   |Subscriber|    | Home  |   |
      AN  |<---------->| NAS |\n   +----------+    |Gateway|   +-----+            +-----+\n
      \        |         +-------+     |                   |\n         |           |
      \          |                   |\n         |      Join(White-F1)   |                   |\n
      \        |-----------+---------->|                   |\n         |           |
      \          |AN performs        |\n         |  Mcast White Flow 1   | admission
      control |\n         |<======================+                   |\n         |
      \          |           |                   |\n         |      Join(White-F2)
      \  |                   |\n         |-----------+---------->|No bandwidth left
      \ |\n         |           |           |                   |\n         |           |
      \          |Bandwidth          |\n         |           |           | Reallocation
      Req  |\n         |           |           |------------------>|(M1)\n         |
      \          |           |                   |\n         |           |           |
      \                 (*)\n         |           |           |Bandwidth Transfer
      |\n         |           AN can now  |<------------------|(M2)\n         |           admit
      flow  |                   |\n         |   Mcast White Flow 2  |                   |\n
      \        |<======================+                   |\n         |           |
      \          |                   |\n         ~           ~           ~                   ~\n
      \        |           |           |Delegated Bandwidth|\n         |           |
      \          | Query request     |\n         |           |           |<------------------|(M3)\n
      \        |           |           |                   |\n         |           |
      \          |Delegated Bandwidth|\n         |           |           | Query response
      \   |\n         |           |           |------------------>|(M4)\n         |
      \          |           |                   |\n   (*) The NAS may optionally
      seek direction from an external\n   Authorization/Policy Server.\n      Figure
      29: Successful Join/Leave Operations, White-Listed Flow\n   The Bandwidth Reallocation
      Request message (M1) is shown in\n   Figure 30.  The contents require little
      explanation.  The Message\n   Type for the Bandwidth Reallocation Request is
      146.  The Result field\n   is set to Ignore (0x0).  Besides the Target TLV,
      the message has one\n   other TLV, the Bandwidth-Request, with a TLV Type of
      0x0016.  The TLV\n   contains Required Amount and Preferred Amount fields, set
      to 4000 and\n   6000 kbits/s respectively.\n                        1                   2
      \                  3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4
      5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |        Type (0x880C)          |           Length = 36         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |   Version     | Msg Type=146  | Res=0 |     Result Code = 0   |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Partition ID  |            Transaction Identifier             |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |I|      SubMessage Number      |           Length = 36         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | TLV Type = Target      0x1000 |        Target TLV Length = 8  |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Access-Loop-Circuit-ID 0x0001 |        Circuit-ID Length = 4  |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                    Access Loop Circuit ID                     |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |   Bandwidth-Request    0x0016 |          TLV Length = 8       |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |               Required Amount = 4000 (kbits/s)                |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |               Preferred Amount = 6000 (kbits/s)               |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \            Figure 30: Bandwidth Reallocation Request Message\n   The Bandwidth
      Transfer message (M2) is shown in Figure 31.  Again,\n   the contents are easily
      understood.  The Message Type for the\n   Bandwidth Transfer message is 147.
      \ The Result field is set to\n   Success (0x3).  The message contains the Target
      TLV and the\n   Bandwidth-Allocation TLV.  The latter has a TLV Type of 0x0015
      and\n   contains a Delegated Amount field, set to 4000 kbits/s.\n                        1
      \                  2                   3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4
      5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |        Type (0x880C)          |           Length = 32         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |   Version     | Msg Type=147  | Res=3 |     Result Code = 0   |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Partition ID  |            Transaction Identifier             |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |I|      SubMessage Number      |           Length = 32         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | TLV Type = Target      0x1000 |        Target TLV Length = 8  |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Access-Loop-Circuit-ID 0x0001 |        Circuit-ID Length = 4  |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                    Access Loop Circuit ID                     |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |  Bandwidth-Allocation  0x0015 |          TLV Length = 4       |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                Delegated Amount = 4000 (kbits/s)              |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \           Figure 31: NAS Response, Bandwidth Transfer Message\n   The Delegated
      Bandwidth Query Request message (M3) is shown in\n   Figure 32.  The Message
      Type for the Delegated Bandwidth Query\n   request message is 148.  The Result
      field is set to AckAll (0x2).\n   The message contains the Target TLV only.\n
      \                       1                   2                   3\n    0 1 2
      3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |        Type (0x880C)          |           Length = 24         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |   Version     | Msg Type=148  | Res=2 |     Result Code = 0   |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Partition ID  |            Transaction Identifier             |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |I|      SubMessage Number      |           Length = 24         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | TLV Type = Target      0x1000 |        Target TLV Length = 8  |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Access-Loop-Circuit-ID 0x0001 |        Circuit-ID Length = 4  |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                    Access Loop Circuit ID                     |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \          Figure 32: Delegated Bandwidth Query Request Message\n   Finally,
      the Delegated Bandwidth Query Response message (M4) is shown\n   in Figure 33.
      \ The Message Type for the Delegated Bandwidth Query\n   response message is
      148.  The Result field is set to Success (0x3).\n   The message contains the
      Target TLV and the Bandwidth-Allocation TLV\n   with the Delegated Amount field
      set to 4000 kbits/s.\n                        1                   2                   3\n
      \   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |        Type (0x880C)          |           Length = 32         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |   Version     | Msg Type=148  | Res=3 |     Result Code = 0   |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Partition ID  | Transaction Identifier (copied from request)  |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |I|      SubMessage Number      |           Length = 32         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | TLV Type = Target      0x1000 |        Target TLV Length = 8  |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Access-Loop-Circuit-ID 0x0001 |        Circuit-ID Length = 4  |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                    Access Loop Circuit ID                     |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |  Bandwidth-Allocation  0x0015 |          TLV Length = 4       |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                Delegated Amount = 4000 (kbits/s)              |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \          Figure 33: Delegated Bandwidth Query Response Message\n"
    title: A.3.  Handling White-Listed Flows
  - contents:
    - "A.4.  Handling of Black-Listed Join Requests\n   This section introduces no
      new messages, since requests for flows in\n   the black list are simply ignored.
      \ The one thing to point out is the\n   overlap in our example between the set
      of flows in the grey list and\n   the flows in the black list.  This does not
      create any ambiguity,\n   since not only does the black list have priority for
      equally good\n   matches, but also the black list entries are more specific
      (group\n   prefix lengths of 32 versus 29 in the grey list) than the grey list\n
      \  flow prefixes.\n"
    title: A.4.  Handling of Black-Listed Join Requests
  - contents:
    - "A.5.  Handling of Requests to Join and Leave the On-Line Game\n   The final
      class of multicast control actions in our example allows\n   the subscriber
      to enter and leave the on-line game.  As described at\n   the beginning of this
      example, the game uses Any-Source Multicast\n   (ASM).  Subscriber signaling
      bypasses the AN, going directly to the\n   NAS (e.g., through a web interface).\n
      \  When the subscriber requests to join the game, the NAS (after\n   applying
      policy and bandwidth checks) sends a Multicast Replication\n   Control message
      to the AN to enable the flow on the port concerned.\n   The AN knows not to
      apply admission control, since it has not\n   received an MRepCtl-CAC TLV in
      the Provisioning message.  When the\n   subscriber leaves, the NAS sends another
      Multicast Replication\n   Control message to delete the flow.  This message
      sequence is shown\n   in Figure 34.\n   It is possible that the NAS finds that
      there is not enough bandwidth\n   available to accommodate the subscriber's
      request.  In this case, the\n   NAS could send a Bandwidth Reallocation Request
      message to the AN,\n   asking it to release some of the bandwidth delegated
      to it.  This is\n   not shown in the present example, since the messages are
      the same as\n   those already presented with the exception that the Preferred
      Amount\n   in the request will be *less than* or equal to the Required amount,\n
      \  rather than *greater than* or equal to it.\n   +----------+    +-------+
      \  +-----+    ANCP    +-----+\n   |Subscriber|    | Home  |   | AN  |<---------->|
      NAS |\n   +----------+    |Gateway|   +-----+            +-----+\n         |
      \        +-------+     |                   |\n         |           |           |
      \                  |\n         |      Join game        |                   |\n
      \        |-----------+------------------------------>|\n         |           |
      \          |     Multicast     |   NAS performs\n         |           |           |
      \    Replication  (*)  admission\n         |           |           |     Control
      (M1)  |   control\n         |     Mcast Game Flow   |<------------------|\n
      \        |<=====================>+                   |\n         |           |
      \          |                   |\n         ~           ~           ~                   ~\n
      \        |           |           |                   |\n         |     Leave
      game        |                   |\n         |-----------+------------------------------>|\n
      \        |           |           |     Multicast     |\n         |           |
      \          |     Replication   |\n         |           |           |     Control
      (M2)  |\n         |     Mcast Game Flow   |<------------------|\n         |
      \      discontinued    |                   |\n         |           |           |
      \                  |\n   (*) The NAS may optionally seek direction from an external\n
      \  Authorization/Policy Server.\n             Figure 34: NAS-Initiated Flows
      for On-Line Gaming\n   The Multicast Replication Control message (M1) in Figure
      35 looks\n   like the message in Figure 27 with two exceptions.  The first is
      that\n   the NAS has the option to set the Result field to AckAll (0x02) if
      it\n   needs positive reassurance that the flow has been enabled.  This was\n
      \  not done here to save having to depict a response differing only in\n   the
      Result field.  The larger difference in this example is that the\n   flow description
      in the Multicast-Flow embedded TLV is that of an ASM\n   multicast group (Flow
      Type = 1) with IPv4 (1) group address\n   233.252.0.100.\n                        1
      \                  2                   3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4
      5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |        Type (0x880C)          |           Length = 44         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |   Version     | Msg Type=144  | Res=1 |     Result Code = 0   |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Partition ID  |            Transaction Identifier             |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |I|      SubMessage Number      |           Length = 44         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | TLV Type = Target      0x1000 |        Target TLV Length = 8  |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Access-Loop-Circuit-ID 0x0001 |        Circuit-ID Length = 4  |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                    Access Loop Circuit ID                     |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | TLV Type = Command     0x0011 |       TLV Length = 16         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |  Cmd Code = 1 |   Acctg = 1   |      Reserved = 0x0000        |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Type = Multicast-Flow  0x0019 |   Embedded TLV Length = 12    |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Flow Type = 1 |  Addr Fam = 1 |     Reserved = 0x0000         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |            Multicast Group Address =  233.252.0.100           |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+--+\n
      \       Figure 35: Enabling the Subscriber to Join an On-Line Game\n   Message
      M2 terminating the flow when the subscriber leaves the game\n   looks the same
      as the message in Figure 35 with two exceptions: the\n   Command Code becomes
      \"Delete\" (2), and Accounting is set to \"No\" (0)\n   to turn off flow accounting.
      \ Of course, the Transaction Identifier\n   values will differ between the two
      messages.\n"
    title: A.5.  Handling of Requests to Join and Leave the On-Line Game
  - contents:
    - "A.6.  Example Flow for Multicast Flow Reporting\n   The example in this section
      is independent of the example in the\n   preceding sections.\n   Figure 36 illustrates
      a message flow in a case where the NAS queries\n   the AN about which multicast
      flows are active on port 10, port 11,\n   and port 20 of the AN.\n   +----------+
      \   +-------+   +-----+    ANCP    +-----+\n   |Subscriber|    | Home  |   |
      AN  |<---------->| NAS |\n   +----------+    |Gateway|   +-----+            +-----+\n
      \        |         +-------+     |                   |\n         |             |
      \        |  Multicast Flow   |\n         |             |         |  Query Request
      \   |\n         |             |         |      (M1)         |\n         |             |
      \        |<------------------|\n         |             |         |                   |\n
      \        |             |         | Multicast Flow    |\n         |             |
      \        | Query Response    |\n         |             |         |      (M2)
      \        |\n         |             |         |------------------>|\n         |
      \            |         |                   |\n         |             |         |
      \                  |\n               Figure 36: Per-Port Multicast Flow Reporting\n
      \  The Multicast Flow Query Request message (M1) is illustrated in\n   Figure
      37.  The Message Type is 149.  The Result field is set to\n   AckAll (0x2).
      \ Three Target TLVs are present, identifying port 10,\n   port 20, and port
      11, respectively.\n    0                   1                   2                   3\n
      \   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |        Type (0x880C)          |           Length              |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |   Version     | Msg Type = 149| Res=2 |     Result Code = 0   |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Partition ID  |            Transaction Identifier             |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |I|      SubMessage Number      |           Length              |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | TLV Type = Target      0x1000 |        Target TLV Length      |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Access-Loop-Circuit-ID 0x0001 |        Circuit-ID Length      |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                                                               |\n   ~                    Access
      Loop Circuit ID (port10)            ~\n   |                                                               |\n
      \  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n   | TLV
      Type = Target      0x1000 |        Target TLV Length      |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Access-Loop-Circuit-ID 0x0001 |        Circuit-ID Length      |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                                                               |\n   ~                    Access
      Loop Circuit ID (port20)            ~\n   |                                                               |\n
      \  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n   | TLV
      Type = Target      0x1000 |        Target TLV Length      |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Access-Loop-Circuit-ID 0x0001 |        Circuit-ID Length      |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                                                               |\n   ~                    Access
      Loop Circuit ID (port11)            ~\n   |                                                               |\n
      \  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n       Figure
      37: Multicast Flow Query Request Message for Per-Port\n                         Multicast
      Flow Reporting\n   The Multicast Flow Query Response message (M2) is illustrated
      in\n   Figure 38.  It indicates that there is one active multicast flow\n   [(192.0.2.1,
      233.252.0.4)] on port 10, no active multicast flow on\n   port 20, and two active
      multicast flows [(192.0.2.1, 233.252.0.4) and\n   (192.0.2.2, 233.252.0.10)]
      on port 11.\n    0                   1                   2                   3\n
      \   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |        Type (0x880C)          |           Length              |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |   Version     | Msg Type = 149|Rslt=3 |    Result Code = 0    |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Partition ID  |            Transaction Identifier             |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |I|      SubMessage Number      |           Length              |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | TLV Type = Target      0x1000 |        Target TLV Length      |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Access-Loop-Circuit-ID 0x0001 |        Circuit-ID Length      |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                                                               |\n   ~                   Access
      Loop Circuit ID (port10)             ~\n   |                                                               |\n
      \  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n   | Type
      = Multicast-Flow  0x0019 |    Embedded TLV Length = 12   |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Flow Type = 2 |  Addr Fam = 1 |       Reserved = 0x0000       |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |             Multicast Group Address = 233.252.0.4             |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                Unicast Source Address = 192.0.2.1             |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+--+\n
      \  | TLV Type = Target      0x1000 |        Target TLV Length      |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Access-Loop-Circuit-ID 0x0001 |        Circuit-ID Length      |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                                                               |\n   ~                   Access
      Loop Circuit ID (port20)             ~\n   |                                                               |\n
      \  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n   | TLV
      Type = Target      0x1000 |        Target TLV Length      |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Access-Loop-Circuit-ID 0x0001 |        Circuit-ID Length      |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                                                               |\n   ~                    Access
      Loop Circuit ID (port11)            ~\n   |                                                               |\n
      \  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n   | Type
      = Multicast-Flow  0x0019 |    Embedded TLV Length = 12   |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Flow Type = 2 |  Addr Fam = 1 |       Reserved = 0x0000       |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |             Multicast Group Address = 233.252.0.4             |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                Unicast Source Address = 192.0.2.1             |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+--+\n
      \  | Type = Multicast-Flow  0x0019 |   Embedded TLV Length = 12    |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | Flow Type = 2 |  Addr Fam = 1 |       Reserved = 0x0000       |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |             Multicast Group Address: 233.252.0.10             |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |                Unicast Source Address = 192.0.2.2             |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+--+\n
      \      Figure 38: Multicast Flow Query Response Message for Per-Port\n                         Multicast
      Flow Reporting\n"
    title: A.6.  Example Flow for Multicast Flow Reporting
  title: Appendix A.  Example of Messages and Message Flows
- contents:
  - "Authors' Addresses\n   Francois Le Faucheur\n   Cisco Systems\n   45 Allee des
    Ormes\n   Mougins  06250\n   France\n   Phone: +33 4 97 23 26 19\n   EMail: flefauch@cisco.com\n
    \  Roberta Maglione\n   Cisco Systems\n   181 Bay Street\n   Toronto, ON  M5J
    2T3\n   Canada\n   EMail: robmgl@cisco.com\n   Tom Taylor\n   Huawei Technologies\n
    \  Ottawa\n   Canada\n   EMail: tom.taylor.stds@gmail.com\n"
  title: Authors' Addresses
