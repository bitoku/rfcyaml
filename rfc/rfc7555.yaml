- title: __initial_text__
  contents:
  - '                        Proxy MPLS Echo Request

    '
- title: Abstract
  contents:
  - "Abstract\n   This document defines a means of remotely initiating Multiprotocol\n\
    \   Label Switched Protocol (MPLS) Pings on Label Switched Paths.  An\n   MPLS\
    \ Proxy Ping Request is sent to any Label Switching Router along a\n   Label Switched\
    \ Path.  The primary motivations for this facility are\n   first to limit the\
    \ number of messages and related processing when\n   using LSP Ping in large Point-to-Multipoint\
    \ LSPs, and second to\n   enable tracing from leaf to leaf (or root).\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This\
    \ document is a product of the Internet Engineering Task Force\n   (IETF).  It\
    \ represents the consensus of the IETF community.  It has\n   received public\
    \ review and has been approved for publication by the\n   Internet Engineering\
    \ Steering Group (IESG).  Further information on\n   Internet Standards is available\
    \ in Section 2 of RFC 5741.\n   Information about the current status of this document,\
    \ any errata,\n   and how to provide feedback on it may be obtained at\n   http://www.rfc-editor.org/info/rfc7555.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2015 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (http://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.  Code Components\
    \ extracted from this document must\n   include Simplified BSD License text as\
    \ described in Section 4.e of\n   the Trust Legal Provisions and are provided\
    \ without warranty as\n   described in the Simplified BSD License.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1. Introduction ....................................................3\n\
    \      1.1. Requirements Language ......................................4\n  \
    \    1.2. Terminology ................................................5\n   2.\
    \ Proxy Ping Overview .............................................5\n      2.1.\
    \ Initiating Proxy Ping ......................................6\n      2.2. Handling\
    \ at Proxy LSR ......................................6\n           2.2.1. Backward\
    \ Compatibility ..............................6\n   3. Proxy MPLS Echo Request/Reply\
    \ Procedures ........................7\n      3.1. Procedures for the Initiator\
    \ ...............................7\n      3.2. Procedures for the Proxy LSR ...............................9\n\
    \           3.2.1. Proxy LSR Handling When It Is Egress for FEC .......11\n  \
    \         3.2.2. Downstream Detailed Maps and Downstream\n                  Maps\
    \ in Proxy Reply ................................12\n           3.2.3. Sending\
    \ an MPLS Proxy Ping Reply ...................12\n           3.2.4. Sending the\
    \ MPLS Echo Requests .....................13\n                  3.2.4.1. Forming\
    \ the Base MPLS Echo Request ........13\n                  3.2.4.2. Per-Interface\
    \ Sending Procedures ..........14\n   4. Proxy Ping Request/Reply Messages ..............................15\n\
    \      4.1. Proxy Ping Request/Reply Message Formats ..................15\n  \
    \    4.2. Proxy Ping Request Message Contents .......................15\n    \
    \  4.3. Proxy Ping Reply Message Contents .........................16\n   5. TLV\
    \ Formats ....................................................16\n      5.1. Proxy\
    \ Echo Parameters TLV .................................16\n           5.1.1. Next\
    \ Hop Sub-TLV ...................................20\n      5.2. Reply-to Address\
    \ TLV ......................................21\n      5.3. Upstream Neighbor Address\
    \ TLV .............................21\n      5.4. Downstream Neighbor Address\
    \ TLV ...........................22\n   6. Security Considerations ........................................23\n\
    \   7. IANA Considerations ............................................24\n  \
    \    7.1. Proxy Echo Parameters Sub-TLVs ............................24\n    \
    \  7.2. Proxy Flags ...............................................25\n      7.3.\
    \ Downstream Address Mapping Registry .......................25\n      7.4. Next\
    \ Hop Sub-TLV Address Type Registry ....................25\n   8. References .....................................................26\n\
    \      8.1. Normative References ......................................26\n  \
    \    8.2. Informative References ....................................27\n   Acknowledgements\
    \ ..................................................27\n   Authors' Addresses\
    \ ................................................28\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   This document is motivated by two broad issues in connection\
    \ with\n   diagnosing Point-to-Multipoint (P2MP) Label Switched Paths (LSPs).\n\
    \   The first is scalability due to the automatic replication of\n   Multiprotocol\
    \ Label Switching (MPLS) Echo Request messages as they\n   proceed down the tree.\
    \  The second, which is primarily motivated by\n   LDP-based P2MP and Multipoint-to-Multipoint\
    \ (MP2MP) LSPs [RFC6388],\n   is the ability to trace a sub-LSP from leaf node\
    \ to root node.\n   When tracing from a source to a particular leaf in a P2MP\
    \ or MP2MP\n   tree, nodes not along that path will need to process MPLS Echo\n\
    \   Request messages that are received.  The number of MPLS Echo Replies\n   sent\
    \ in response to an MPLS Echo Request quickly multiplies, as the\n   Label Switching\
    \ Routers (LSRs), which are part of the tree but not\n   along the path of the\
    \ trace, could be responding to the received MPLS\n   Echo Request as well.  This\
    \ could also overwhelm the source to\n   process all the MPLS Echo Reply messages\
    \ it receives.  It is\n   anticipated that many of the applications for P2MP/MP2MP\
    \ tunnels will\n   require OAM that is both rigorous and scalable.\n   Suppose\
    \ one wishes to trace a P2MP LSP to localize a fault that is\n   affecting one\
    \ egress or a set of egresses.  Suppose one follows the\n   normal procedure for\
    \ tracing -- namely, repeatedly pinging from the\n   root, incrementing the Time\
    \ to Live (TTL) by one after each three or\n   so pings.  Such a procedure has\
    \ the potential for producing a large\n   amount of processing at the P2MP-LSP\
    \ midpoints and egresses.  It also\n   could produce an unwieldy number of replies\
    \ back to the root.\n   One alternative would be to begin sending pings from points\
    \ at or\n   near the affected egress(es) and then work backwards toward the root.\n\
    \   The TTL could be held constant (say, two), limiting the number of\n   responses\
    \ to the number of next-next-hops of the point where a ping\n   is initiated.\n\
    \   In the case of Resource Reservation Protocol Traffic Engineering\n   (RSVP-TE),\
    \ all setup is initiated from the root of the tree.  Thus,\n   the root of the\
    \ tree has knowledge of all the leaf nodes and usually\n   the topology of the\
    \ entire tree.  Thus, the above alternative can\n   easily be initiated by the\
    \ root node.\n   In [RFC6388], the situation is quite different.  Leaf nodes initiate\n\
    \   connectivity to the tree, which is granted by the first node toward\n   the\
    \ root that is part of the tree.  The root node may only be aware\n   of the immediately\
    \ adjacent (downstream) nodes of the tree.\n   Initially, the leaf node only has\
    \ knowledge of the (upstream) node to\n   which it is immediately adjacent.  However,\
    \ this is sufficient\n   information to initiate a trace.  First, the above procedure\
    \ is\n   applied by asking that node to ping across the final link.  That is,\n\
    \   a message is sent from the leaf to the upstream node requesting it to\n  \
    \ send an MPLS Echo Request for the Forward Equivalence Class (FEC) of\n   the\
    \ tree in question on said link.  The leaf node also requests the\n   identity\
    \ of the upstream neighbor's upstream neighbor for that FEC.\n   With this information,\
    \ the procedure can iteratively be applied until\n   the fault is localized or\
    \ the root node is reached.  In all cases,\n   the TTL for the request need only\
    \ be at most 2.  Thus, the processing\n   load of each request is small, since\
    \ only a limited number of nodes\n   will receive the request.\n   This document\
    \ defines protocol extensions to MPLS ping [RFC4379] to\n   allow a third party\
    \ to remotely cause an MPLS Echo Request message to\n   be sent down an LSP or\
    \ part of an LSP.  The procedure described in\n   the paragraphs above does require\
    \ that the initiator know the\n   previous-hop node to the one which was pinged\
    \ on the prior iteration.\n   This information is readily available in [RFC4875].\
    \  This document\n   also provides a means for obtaining this information for\
    \ P2MP and\n   MP2MP LSPs that are set up with LDP as described in [RFC6388].\n\
    \   While the motivation for this document came from multicast scaling\n   concerns,\
    \ its applicability may be wider.  The procedures presented\n   in this document\
    \ are applicable to all LSP Ping FEC types where the\n   MPLS Echo Request/Reply\
    \ are IP encapsulated and the MPLS Echo Reply\n   can be sent out of band of the\
    \ LSP over IP.  Remote pinging of LSPs\n   that involves the use of in-band control\
    \ channels is beyond the scope\n   of this document.\n   Other uses of this facility\
    \ are beyond the scope of this document.\n   In particular, the procedures defined\
    \ in this document only allow\n   testing of a FEC stack consisting of a single\
    \ FEC.  The procedures\n   also do not allow the initiator to specify the label\
    \ assigned to that\n   FEC, nor do the procedures allow the initiator to cause\
    \ any\n   additional labels to be added to the label stack of the actual MPLS\n\
    \   Echo Request message.\n"
- title: 1.1.  Requirements Language
  contents:
  - "1.1.  Requirements Language\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\"\
    , \"SHALL\", \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"\
    MAY\", and \"OPTIONAL\" in this\n   document are to be interpreted as described\
    \ in [RFC2119].\n   The term \"Must Be Zero\" (MBZ) is used in TLV descriptions\
    \ for\n   reserved fields.  These fields MUST be set to zero when sent and\n \
    \  ignored on receipt.\n   Based on context, the terms \"leaf\" and \"egress\"\
    \ are used\n   interchangeably.  \"Egress\" is used where consistency with [RFC4379]\n\
    \   was deemed appropriate.  \"Receiver\" is used in the context of\n   receiving\
    \ protocol messages.\n"
- title: 1.2.  Terminology
  contents:
  - "1.2.  Terminology\n      Term  Definition\n      ----- -------------------------------------------\n\
    \      LSP   Label Switched Path\n      LSR   Label Switching Router\n      mLDP\
    \  Multipoint LDP\n      MP2MP Multipoint to Multipoint\n      MTU   Maximum Transmission\
    \ Unit\n      P2MP  Point to Multipoint\n      TTL   Time to Live\n"
- title: 2.  Proxy Ping Overview
  contents:
  - "2.  Proxy Ping Overview\n   This document defines a protocol interaction between\
    \ a first LSR and\n   another LSR that is part of an LSP in order to allow the\
    \ first LSR to\n   request that the second LSR initiate an LSP Ping for the LSP\
    \ on the\n   first LSR's behalf.  Since the second LSR sends the LSP Ping on\n\
    \   behalf of the first LSR, it does not maintain state to be able to\n   handle\
    \ the corresponding LSP Ping response.  Instead, the responder\n   to the LSP\
    \ Ping sends the LSP Ping response to either the first LSR\n   or another LSR\
    \ configured to handle it.  Two new LSP Ping messages\n   are defined for remote\
    \ pinging: the MPLS Proxy Ping Request and the\n   MPLS Proxy Ping Reply.\n  \
    \ A remote ping operation on a P2MP LSP generally involves at least\n   three\
    \ LSRs; in some scenarios, none of these are the ingress (root)\n   or an egress\
    \ (leaf) of the LSP.\n   We refer to these LSRs with the following terms:\n  \
    \    Initiator - the LSR that initiates the ping operation by sending\n      an\
    \ MPLS Proxy Ping Request message\n      Proxy LSR - the LSR that is the destination\
    \ of the MPLS Proxy Ping\n      Request message and the potential initiator of\
    \ the MPLS Echo\n      Request\n      Receiver(s) - the LSR(s) that receive the\
    \ MPLS Echo Request\n      message\n      Responder - A receiver that responds\
    \ to an MPLS Proxy Ping Request\n      or an MPLS Echo Request\n   We note that\
    \ in some scenarios, the initiator could also be the\n   responder; in that case,\
    \ the response would be internal to the LSR.\n"
- title: 2.1.  Initiating Proxy Ping
  contents:
  - "2.1.  Initiating Proxy Ping\n   The initiator formats an MPLS Proxy Ping Request\
    \ message and sends it\n   to the Proxy LSR, an LSR it believes to be on the path\
    \ of the LSP.\n   This message instructs the Proxy LSR either to reply with Proxy\n\
    \   information or to send an MPLS Echo Request in-band of the LSP.  The\n   initiator\
    \ requests Proxy information so that it can learn additional\n   information it\
    \ needs to use to form a subsequent MPLS Proxy Ping\n   Request.  For example,\
    \ during LSP traceroute, an initiator needs the\n   downstream map information\
    \ to form an MPLS Echo Request.  An\n   initiator may also want to learn a Proxy\
    \ LSR's FEC neighbor\n   information so that it can form Proxy Ping Requests to\
    \ various LSRs\n   along the LSP.\n"
- title: 2.2.  Handling at Proxy LSR
  contents:
  - "2.2.  Handling at Proxy LSR\n   The Proxy LSR either replies with the requested\
    \ Proxy information or\n   validates that it has a label mapping for the specified\
    \ FEC and that\n   it is authorized to send the specified MPLS Echo Request on\
    \ behalf of\n   the initiator.\n   If the Proxy LSR has a label mapping for the\
    \ FEC and all\n   authorization checks have passed, the Proxy LSR formats an MPLS\
    \ Echo\n   Request.  If the source address of the MPLS Echo Request is not set\n\
    \   to the Proxy Request source address, the initiator MUST include a\n   Reply-to\
    \ Address TLV containing the source address to use in the MPLS\n   Echo Request.\
    \  It then sends the MPLS Echo Request in-band of the\n   LSP.\n   The receivers\
    \ process the MPLS Echo Request as normal, sending their\n   MPLS Echo Replies\
    \ back to the initiator.\n   If the Proxy LSR failed to send an MPLS Echo Request\
    \ as normal\n   because it encountered an issue while attempting to send, an MPLS\n\
    \   Proxy Ping Reply message is sent back with a Return Code indicating\n   that\
    \ the MPLS Echo Request could not be sent.\n"
- title: 2.2.1.  Backward Compatibility
  contents:
  - "2.2.1.  Backward Compatibility\n   As described in Section 4.4 of [RFC4379],\
    \ if the packet is not well-\n   formed, LSR X SHOULD send an MPLS Echo Reply\
    \ with the Return Code set\n   to \"Malformed echo request received\" and the\
    \ Return Subcode to zero.\n   If there are any TLVs not marked as \"Ignore\" that\
    \ the Proxy LSR does\n   not understand, the Proxy LSR SHOULD send an MPLS \"\
    TLV not\n   understood\" (as appropriate), and the Return Subcode is set to zero.\n\
    \   In the case where the targeted Proxy LSR does not understand the LSP\n   Ping\
    \ Echo Request at all, like any other LSR that does not understand\n   the messages,\
    \ it MUST drop the message and MUST NOT send any message\n   back to the initiator.\n"
- title: 3.  Proxy MPLS Echo Request/Reply Procedures
  contents:
  - '3.  Proxy MPLS Echo Request/Reply Procedures

    '
- title: 3.1.  Procedures for the Initiator
  contents:
  - "3.1.  Procedures for the Initiator\n   The initiator creates an MPLS Proxy Ping\
    \ request message.\n   The message MUST contain a Target FEC Stack that describes\
    \ the FEC\n   being tested.  The topmost FEC in the target FEC stack is used at\
    \ the\n   Proxy LSR to look up the MPLS label stack that will be used to\n   encapsulate\
    \ the MPLS Echo Request packet.\n   The MPLS Proxy Ping Request message MUST contain\
    \ a Proxy Echo\n   Parameters TLV.  In that TLV, the address type is set to either\
    \ IPv4\n   or IPv6.  The Destination IP Address is set to the value to be used\n\
    \   by the Proxy LSR to build the MPLS Echo Request packet.  The MPLS\n   Echo\
    \ Request IP header destination address is as specified in\n   [RFC4379].  If\
    \ the Address Type is IPv4, it MUST be an address is\n   from the range 127/8;\
    \ if the Address Type is IPv6, MUST be an address\n   from the range ::ffff:7f00:0/104.\n\
    \   The Reply Mode and Global Flags of the Proxy Echo Parameters TLV are\n   set\
    \ to the values to be used in the MPLS Echo Request message header.\n   The Source\
    \ UDP Port is set to the value to be used in the MPLS Echo\n   Request (the source\
    \ port is supplied by the Proxy Ping initiator\n   because it or an LSR known\
    \ to it handles the LSP Ping responses).\n   The TTL is set to the value to be\
    \ used in the outgoing MPLS label\n   stack.  See Section 5.1 for further details.\n\
    \   If the FEC's Upstream/Downstream Neighbor address information is\n   required,\
    \ the initiator sets the \"Request for FEC neighbor\n   information\" Proxy Flags\
    \ in the Proxy Echo Parameters TLV.\n   If a Downstream Detailed Mapping TLV (or\
    \ Downstream Mapping TLV,\n   which is deprecated) is required in an MPLS Proxy\
    \ Ping Reply, the\n   initiator sets the \"Request for Downstream Detailed Mapping\"\
    \ (or\n   \"Request for Downstream Mapping\") Proxy Flag in the Proxy Echo\n \
    \  Parameters TLV.  Only one of the two flags can be set.\n   The Proxy Request\
    \ Reply Mode is set with one of the Reply Modes\n   defined in [RFC4379] as appropriate.\n\
    \   A list of next-hop IP addresses MAY be included to limit the next\n   hops\
    \ towards which the MPLS Echo Request message will be sent.  These\n   are encoded\
    \ as Next Hop sub-TLVs and included in the Proxy Echo\n   Parameters TLV.\n  \
    \ Although not explicitly spelled out in [RFC4379], LSP Ping packets\n   can be\
    \ formed to a desired size using a Pad TLV and then used to test\n   the Maximum\
    \ Transmission Unit (MTU) of an LSP.  When testing an LSP's\n   MTU, if the message\
    \ is transported as an IP datagram, the IP header\n   DF bit MUST be set to prevent\
    \ IP fragmentation by the IP forwarding\n   layer.  The Proxy Echo Parameter TLV\
    \ MPLS Payload Size field is\n   defined for this purpose and may be set to request\
    \ that the MPLS Echo\n   Request (including any IP and UDP header) be zero-padded\
    \ to the\n   specified size.  When a non-zero MPLS payload size is specified,\
    \ the\n   Proxy LSR introduces a Pad TLV to build the MPLS Echo Request packet,\n\
    \   so in this case, the Proxy Ping Request MUST NOT include a Pad TLV.\n   Any\
    \ of following TLVs MAY be included.  These TLVs are used to form\n   the MPLS\
    \ Echo Request messages by the Proxy LSR:\n      Pad\n      Vendor Enterprise\
    \ Number\n      Reply TOS Byte\n      P2MP Responder Identifier [RFC6425]\n  \
    \    Echo Jitter [RFC6425]\n      Vendor Private TLVs\n   Downstream Detailed\
    \ Mapping (DDMAP) or Downstream Mapping (DSMAP)\n   TLVs MAY be included.  These\
    \ TLVs will be matched to the next-hop\n   address for inclusion in those particular\
    \ MPLS Echo Request messages.\n   The message is then encapsulated in a UDP packet.\
    \  The source UDP\n   port for the MPLS Proxy Ping Request message is chosen by\
    \ the\n   initiator; the destination UDP port is set to 3503.  The IP header is\n\
    \   set as follows: the source IP address is a routable address of the\n   initiator;\
    \ the destination IP address is a routable address to the\n   Proxy LSR.  The\
    \ packet is then sent with the IP TTL set to 255.\n"
- title: 3.2.  Procedures for the Proxy LSR
  contents:
  - "3.2.  Procedures for the Proxy LSR\n   A Proxy LSR that receives an MPLS Proxy\
    \ Ping Request message parses\n   the packet to ensure that it is a well-formed\
    \ packet.  It checks that\n   the TLVs that are not marked \"Ignore\" are understood.\
    \  If any part of\n   the message is malformed, it sets the Return Code to \"\
    Malformed echo\n   request received\".  If all the TLVs are well-formed and any\
    \ TLVs are\n   not understood, the Return Code is set to \"TLV not understood\"\
    .  The\n   Return Subcode is set to zero for both cases.\n   If the Reply Mode\
    \ of the message header is not 1 (\"Do not reply\"), an\n   MPLS Proxy Ping Reply\
    \ message SHOULD be sent as described below.\n   If the Return Code is \"TLV not\
    \ understood\", no more processing of the\n   MPLS Proxy Ping Request message\
    \ is required.  The Proxy LSR sends an\n   MPLS Proxy Ping Reply message with\
    \ an Errored TLVs TLV containing\n   (only) the TLVs that were not understood.\n\
    \   The MPLS Proxy Ping Request is expected to be transported to the\n   Proxy\
    \ LSR via IP forwarding mechanisms instead of using the same\n   techniques that\
    \ are employed to inject an MPLS Echo Request packet\n   into an LSP.  The MPLS\
    \ Echo Request would use IP TTL, MPLS TTL,\n   and/or loopback addresses (IPv4\
    \ 127.x.x.x or IPv6 ::ffff:7f00/104) in\n   the IP header destination address\
    \ field to trigger the packet to be\n   handled via an LSR's forwarding exception\
    \ processing path.  The Proxy\n   LSR MUST check whether or not MPLS Proxy Ping\
    \ Request packets arrive\n   via exception path.  Packets arriving via IP TTL\
    \ expiry, IP\n   destination address set to a loopback address, or label TTL expiry\n\
    \   MUST be treated as \"Unauthorized\" packets.  An MPLS Proxy Ping Reply\n \
    \  message MAY be sent with a Return Code of 16, \"Proxy Ping not\n   authorized\"\
    .\n   The header fields Sender's Handle and Sequence Number are not\n   examined,\
    \ but they are included in the MPLS Proxy Ping Reply or MPLS\n   Echo Request\
    \ message, if either is sent as a direct result of the\n   received message.\n\
    \   The Proxy LSR validates that it has a label mapping for the specified\n  \
    \ FEC, determines if it is an ingress, egress, transit or bud node, and\n   then\
    \ sets the Return Code as appropriate.  A new Return Code of 19,\n   \"Replying\
    \ router has FEC mapping for topmost FEC\", has been defined\n   for the case\
    \ where the Proxy LSR is an ingress (for example, the head\n   of the TE tunnel\
    \ or a transit router) because the existing Return\n   Codes defined by RFC 4379\
    \ don't match the situation.  For example,\n   when a Proxy LSR is a transit router,\
    \ it's not appropriate for the\n   Return Code to describe how the packet would\
    \ transit because the MPLS\n   Proxy Ping Request doesn't contain information\
    \ about what input\n   interface the MPLS Echo Request would be switched from\
    \ at the Proxy\n   LSR.\n   The Proxy LSR then determines if it is authorized\
    \ to send the\n   specified MPLS Echo Request on behalf of the initiator.  A Proxy\
    \ LSR\n   MUST be capable of filtering addresses to validate initiators.  Other\n\
    \   filters on FECs or MPLS Echo Request contents MAY be applied.  If a\n   configured\
    \ filter has been invoked and an address does not pass the\n   filter, then an\
    \ MPLS Echo Request message MUST NOT be sent, and the\n   event SHOULD be logged.\
    \  An MPLS Proxy Ping Reply message MAY be sent\n   with a Return Code of 16,\
    \ \"Proxy Ping not authorized\".\n   The destination address specified in the\
    \ Proxy Echo Parameters TLV is\n   checked to ensure that it conforms to the allowed\
    \ IPv4 or IPv6\n   address range.  If not, the Return Code is set to \"Malformed\
    \ echo\n   request received\" and the Return Subcode is set to zero.  If the\n\
    \   Reply Mode of the message header is not 1, an MPLS Proxy Ping Reply\n   message\
    \ SHOULD be sent as described below.\n   The TTL specified in the Proxy Echo Parameters\
    \ TLV is checked to\n   ensure it contains a value in the range [1,255].  If not,\
    \ the Return\n   Code MUST be set to 17, \"Proxy Ping parameters need to be modified\"\
    .\n   If the Reply Mode of the message header is not 1, an MPLS Proxy Ping\n \
    \  Reply message SHOULD be sent as described below.\n   If the \"Request for FEC\
    \ Neighbor Address info\" flag is set, the\n   Upstream Neighbor Address and Downstream\
    \ Neighbor Address TLVs are\n   formatted for inclusion in the MPLS Proxy Ping\
    \ reply.  If the\n   Upstream or Downstream address is unknown, the corresponding\
    \ TLV is\n   omitted.\n   If there are Next Hop sub-TLVs in the Proxy Echo Parameters\
    \ TLV, each\n   address is examined to determine if it is a valid next hop for\
    \ this\n   FEC.  If any are not, the Proxy Echo Parameters TLV SHOULD be updated\n\
    \   to remove unrecognized Next Hop sub-TLVs.  The updated Proxy Echo\n   Parameters\
    \ TLV MUST be included in the MPLS Proxy Ping Reply.\n   If the \"Request for\
    \ Downstream Detailed Mapping\" or \"Request for\n   Downstream Mapping\" flag\
    \ is set, the Proxy LSR formats (for inclusion\n   in the MPLS Proxy Ping Reply)\
    \ a DS/DDMAP TLV for each interface over\n   which the MPLS Echo Request will\
    \ be sent.\n   If the Proxy LSR is the egress for the FEC, the behavior of the\
    \ Proxy\n   LSR varies depending on whether the LSR is an egress of a P2P LSP,\
    \ a\n   P2MP LSP, or MP2MP LSP.  Additional details can be found in Section\n\
    \   3.2.1, \"Proxy LSR Handling When It Is Egress for FEC\".\n   If the Reply\
    \ Mode of the MPLS Proxy Ping Request message header is 1\n   (\"Do not reply\"\
    ), no MPLS Proxy Ping Reply is sent.  Otherwise, an\n   MPLS Proxy Ping Reply\
    \ message or MPLS Echo Request SHOULD be sent as\n   described below.\n"
- title: 3.2.1.  Proxy LSR Handling When It Is Egress for FEC
  contents:
  - "3.2.1.  Proxy LSR Handling When It Is Egress for FEC\n   This section describes\
    \ the different behaviors for the Proxy LSR when\n   it's the egress for the FEC.\
    \  In the P2MP bud node and MP2MP bud node\n   egress cases, different behavior\
    \ is required.\n   In the case where an MPLS Echo Request is originated by an\
    \ LSR that\n   is a bud or egress node of a P2MP/MP2MP, MPLS Echo Replies are\n\
    \   returned from downstream/upstream LSRs and will not include an MPLS\n   Echo\
    \ Reply from the LSR that originated the MPLS Echo Request.  This\n   section\
    \ describes the behavior required at a bud or egress node to\n   return or not\
    \ return information from MPLS Echo Replies in the Proxy\n   Echo Reply so that\
    \ no changes are required in implementations that\n   are compliant with [RFC4379].\
    \  The Proxy Initiator should receive the\n   same MPLS Echo Replies as in the\
    \ case of the originator of the LSP\n   Ping; any additional information (such\
    \ as the Proxy LSR being a bud\n   or egress node) is returned in the MPLS Proxy\
    \ Ping Reply.\n   When the Proxy LSR is the egress of a P2P FEC, an MPLS Proxy\
    \ Ping\n   Reply SHOULD be sent to the initiator with the Return Code set to 3,\n\
    \   \"Replying router is an egress for the FEC at stack-depth\", with\n   Return\
    \ Subcode set to zero.\n   When the Proxy LSR is the egress of a P2MP FEC, it\
    \ can be either a\n   bud node or just an egress.  If the Proxy LSR is a bud node,\
    \ an MPLS\n   Proxy Ping Reply SHOULD be sent to the initiator with the return\
    \ code\n   set to 3, \"Replying router is an egress for the FEC at stack-depth\"\
    ,\n   and Return Subcode set to zero.  DS/DDMAPs are included only if the\n  \
    \ Proxy Initiator requested information be returned in an MPLS Proxy\n   Ping\
    \ Reply.  If the Proxy LSR is a bud node but there has not been a\n   request\
    \ to return an MPLS Proxy Ping Reply, the Proxy LSR SHOULD send\n   MPLS Echo\
    \ Request packet(s) to the downstream neighbors (no MPLS Echo\n   Reply is sent\
    \ to the Proxy Initiator to indicate that the Proxy LSR\n   is an egress).  If\
    \ the Proxy LSR is just an egress, an MPLS Proxy\n   Ping Reply SHOULD be sent\
    \ to the initiator with the Return Code set\n   to 3, \"Replying router is an\
    \ egress for the FEC at stack-depth\", and\n   Return Subcode set to zero.\n \
    \  When the Proxy LSR is the egress of a MP2MP FEC, it can be either a\n   bud\
    \ node or just an egress.  LSP Pings sent from a leaf of a MP2MP\n   have different\
    \ behavior in this case.  MPLS Echo Requests are sent to\n   all upstream/downstream\
    \ neighbors.  The Proxy LSRs need to be\n   consistent with this variation in\
    \ behavior.  If the Proxy LSR is a\n   bud node or just an egress, an MPLS Proxy\
    \ Ping Reply SHOULD be sent\n   to the Proxy Initiator with the return code set\
    \ to 3, \"Replying\n   router is an egress for the FEC at stack-depth\", with\
    \ Return Subcode\n   set to zero and DS/DDMAPs included only if the Proxy Initiator\n\
    \   requested information be returned in an MPLS Proxy Ping Reply.  If\n   the\
    \ Proxy LSR is not requested to return information in an MPLS Proxy\n   Ping Reply,\
    \ the Proxy LSR SHOULD send MPLS Echo Request packets to\n   all upstream/downstream\
    \ neighbors as would be done when sourcing an\n   LSP Ping from a MP2MP leaf (no\
    \ MPLS Echo Reply is sent to the Proxy\n   Initiator indicating that the Proxy\
    \ LSR is an egress).\n"
- title: 3.2.2.  Downstream Detailed Maps and Downstream Maps in Proxy Reply
  contents:
  - "3.2.2.  Downstream Detailed Maps and Downstream Maps in Proxy Reply\n   When\
    \ the Proxy LSR is a transit or bud node, downstream maps\n   corresponding to\
    \ how the packet is transited cannot be supplied\n   unless an ingress interface\
    \ for the MPLS Echo Request is specified.\n   Since this information is not available\
    \ and all valid output paths\n   are of interest, the Proxy LSR SHOULD include\
    \ DS/DDMAP(s) to describe\n   the entire set of paths that the packet can be replicated.\
    \  This is\n   similar to the case in which an LSP Ping is initiated at the Proxy\n\
    \   LSR.  For mLDP, there is a DS/DDMAP per upstream/downstream neighbor\n   for\
    \ MP2MP LSPs, or per downstream neighbor in the P2MP LSP case.\n   When the Proxy\
    \ LSR is a bud node or egress in an MP2MP LSP or a bud\n   node in a P2MP LSP,\
    \ an LSP Ping initiated from the Proxy LSR would\n   source packets only to the\
    \ neighbors but not itself, despite the fact\n   that the Proxy LSR is itself\
    \ an egress for the FEC.  In order to\n   match the behavior as seen from LSP\
    \ Ping initiated at the Proxy LSR,\n   the Proxy Reply SHOULD contain DS/DDMAPs\
    \ for only the paths to the\n   upstream/downstream neighbors, but no DS/DDMAP\
    \ describing its own\n   egress paths.  The proxy LSR identifies that it's an\
    \ egress for the\n   FEC using a different Proxy Reply Return Code.  The Proxy\
    \ Reply\n   Return Code is either set to 19, \"Replying router has FEC mapping\
    \ for\n   topmost FEC\", or 3, \"Replying router is an egress for the FEC at\n\
    \   stack-depth\".\n"
- title: 3.2.3.  Sending an MPLS Proxy Ping Reply
  contents:
  - "3.2.3.  Sending an MPLS Proxy Ping Reply\n   The Reply Mode, Sender's Handle,\
    \ and Sequence Number fields are\n   copied from the Proxy Ping Request message.\
    \  The TLVs specified above\n   are included.  The message is encapsulated in\
    \ a UDP packet.  The\n   source IP address is a routable address of the Proxy\
    \ LSR; the source\n   port is the well-known UDP port for LSP Ping.  The destination\
    \ IP\n   address and UDP port are copied from the source IP address and UDP\n\
    \   port of the MPLS Proxy Ping Request.  The IP TTL is set to 255.\n"
- title: 3.2.4.  Sending the MPLS Echo Requests
  contents:
  - "3.2.4.  Sending the MPLS Echo Requests\n   An MPLS Echo Request is formed as\
    \ described in the next section.  The\n   section below describes how the MPLS\
    \ Echo Request is sent on each\n   interface.\n"
- title: 3.2.4.1.  Forming the Base MPLS Echo Request
  contents:
  - "3.2.4.1.  Forming the Base MPLS Echo Request\n   If Next Hop sub-TLVs were included\
    \ in the received Proxy Echo\n   Parameters TLV, the Next_Hop_List is created\
    \ from the addresses in\n   those sub-TLVs adjusted as described in Section 3.2.\
    \  Otherwise, the\n   list is set to all the next hops to which the FEC would\
    \ be forwarded.\n   The Proxy LSR then formats an MPLS Echo Request message. \
    \ The Global\n   Flags and Reply Mode are copied from the Proxy Echo Parameters\
    \ TLV.\n   The Return Code and Return Subcode are set to zero.\n   The Sender's\
    \ Handle and Sequence Number are copied from the remote\n   MPLS Echo Request\
    \ message.\n   The TimeStamp Sent is set to the time of day (in seconds and\n\
    \   microseconds) that the MPLS Echo Request is sent.  The TimeStamp\n   Received\
    \ is set to zero.\n   If the Reply-to Address TLV is present, it is used to set\
    \ the MPLS\n   Echo Request source address; otherwise, the MPLS Echo Request source\n\
    \   address is set to the Proxy Request source address.\n   The following TLVs\
    \ are copied from the MPLS Proxy Ping Request\n   message.  Note that, of these,\
    \ only the Target FEC Stack is REQUIRED\n   to appear in the MPLS Proxy Ping Request\
    \ message.  The Pad TLV is not\n   copied if the Proxy Echo Parameter TLV MPLS\
    \ payload size is set to a\n   non-zero value.\n      Target FEC Stack\n     \
    \ Pad\n      Vendor Enterprise Number\n      Reply TOS Byte\n      P2MP Responder\
    \ Identifier [RFC6425]\n      Echo Jitter [RFC6425]\n      Vendor Private TLVs\n\
    \   If the Proxy Echo Parameter TLV MPLS payload size is non-zero, the\n   Proxy\
    \ LSR introduces a Pad TLV such that size of the MPLS Echo\n   Request (including\
    \ any IP and UDP header) is zero-padded to the\n   specified MPLS payload size.\
    \  The first octet in the Value part of\n   the Pad TLV is set to 1, \"Drop Pad\
    \ TLV from reply\", and the remaining\n   octets of the Value part of the Pad\
    \ TLV are filled with zeros.  If\n   the IP header is used to encapsulate the\
    \ MPLS Echo Request, the DF\n   bit MUST be set to one.\n   The message is then\
    \ encapsulated in a UDP packet.  The source UDP\n   port is copied from the Proxy\
    \ Echo Parameters TLV.  The destination\n   port is copied from the MPLS Proxy\
    \ Ping Request message.\n   The source IP address is set to a routable address\
    \ specified in the\n   Reply-to Address TLV or the source address of the received\
    \ Proxy\n   Request.  Per usual, the TTL of the IP packet is set to 1.\n   If\
    \ the Explicit Differentiated Services Code Point (DSCP) flag is\n   set, the\
    \ Requested DSCP byte is examined.  If the setting is\n   permitted, then the\
    \ DSCP byte of the IP header of the MPLS Echo\n   Request message is set to that\
    \ value.  If the Proxy LSR does not\n   permit explicit control for the DSCP byte,\
    \ the MPLS Proxy Echo\n   Parameters with the Explicit DSCP flag cleared MUST\
    \ be included in\n   any MPLS Proxy Ping Reply message to indicate why an MPLS\
    \ Echo\n   Request was not sent.  The Return Code MUST be set to 17, \"Proxy Ping\n\
    \   parameters need to be modified\".  If the Explicit DSCP flag is not\n   set,\
    \ the Proxy LSR SHOULD set the MPLS Echo Request DSCP settings to\n   the value\
    \ normally used to source LSP Ping packets.\n"
- title: 3.2.4.2.  Per-Interface Sending Procedures
  contents:
  - "3.2.4.2.  Per-Interface Sending Procedures\n   The Proxy LSR now iterates through\
    \ the Next_Hop_List modifying the\n   base MPLS Echo Request to form the MPLS\
    \ Echo Request packet that is\n   then sent on that particular interface.\n  \
    \ The outgoing label stack is determined for each next-hop address.\n   The TTL\
    \ for the label corresponding to the FEC specified in the FEC\n   stack is set\
    \ such that the TTL on the wire will be the TTL specified\n   in the Proxy Echo\
    \ Parameters.  If any additional labels are pushed\n   onto the stack, their TTLs\
    \ are set to 255.  This will ensure that the\n   requestor will not have control\
    \ over tunnels not relevant to the FEC\n   being tested.\n   If the MPLS Proxy\
    \ Ping Request message contained Downstream Mapping\n   TLVs or Downstream Detailed\
    \ Mapping TLVs, they are examined.  If the\n   Downstream IP address matches the\
    \ next-hop address, that Downstream\n   Mapping TLV is included in the MPLS Echo\
    \ Request.\n   The packet is then transmitted on this interface.\n"
- title: 4.  Proxy Ping Request/Reply Messages
  contents:
  - "4.  Proxy Ping Request/Reply Messages\n   This document defines two new LSP Ping\
    \ messages, the MPLS Proxy Ping\n   Request and the MPLS Proxy Ping Reply.\n"
- title: 4.1.  Proxy Ping Request/Reply Message Formats
  contents:
  - "4.1.  Proxy Ping Request/Reply Message Formats\n   The packet format is as defined\
    \ in [RFC4379].  Two new message types,\n   Proxy Ping Request and Reply, are\
    \ being added.\n   Message Type\n   Type    Message\n   ----    -------\n    \
    \  3    MPLS Proxy Ping Request\n      4    MPLS Proxy Ping Reply\n"
- title: 4.2.  Proxy Ping Request Message Contents
  contents:
  - "4.2.  Proxy Ping Request Message Contents\n   The MPLS Proxy Ping Request message\
    \ MAY contain the following\n   TLVs:\n          Type    TLV\n          ---- \
    \   -----------\n             1    Target FEC Stack\n             2    Downstream\
    \ Mapping (DEPRECATED)\n             3    Pad\n             5    Vendor Enterprise\
    \ Number\n            10    Reply TOS Byte\n            11    P2MP Responder Identifier\
    \ [RFC6425]\n            12    Echo Jitter [RFC6425]\n            20    Downstream\
    \ Detailed Mapping\n            21    Reply Path [RFC7110]\n            22   \
    \ Reply TC [RFC7110]\n            23    Proxy Echo Parameters\n            24\
    \    Reply-to Address\n             *    Vendor Private TLVs\n         * TLVs\
    \ types in the Vendor Private TLV Space MUST be ignored if\n           not understood\n"
- title: 4.3.  Proxy Ping Reply Message Contents
  contents:
  - "4.3.  Proxy Ping Reply Message Contents\n   The MPLS Proxy Ping Reply message\
    \ MAY contain the following TLVs:\n          Type    TLV\n          ----    -----------\n\
    \             1    Target FEC Stack\n             2    Downstream Mapping (DEPRECATED)\n\
    \             5    Vendor Enterprise Number\n             9    Errored TLVs\n\
    \            20    Downstream Detailed Mapping\n            23    Proxy Echo Parameters\n\
    \            25    Upstream Neighbor Address\n            26    Downstream Neighbor\
    \ Address (0 or more)\n             *    Vendor Private TLVs\n         * TLVs\
    \ types in the Vendor Private TLV Space MUST be ignored if\n           not understood\n"
- title: 5.  TLV Formats
  contents:
  - '5.  TLV Formats

    '
- title: 5.1.  Proxy Echo Parameters TLV
  contents:
  - "5.1.  Proxy Echo Parameters TLV\n   The Proxy Echo Parameters TLV is a TLV that\
    \ MUST be included in an\n   MPLS Proxy Ping Request message.  The length of the\
    \ TLV is 12 + K +\n   S, where K is the length of the Destination IP Address field\
    \ and S is\n   the total length of the sub-TLVs.  The Proxy Echo Parameters TLV\
    \ can\n   be used either to 1) control attributes used in composing and sending\n\
    \   an MPLS Echo Request or 2) query the Proxy LSR for information about\n   the\
    \ topmost FEC in the target FEC stack, but not both.  In the case\n   where the\
    \ Proxy LSR is being queried (i.e., information needs to be\n   returned in an\
    \ MPLS Proxy Ping Reply), no MPLS Echo Request will be\n   sent from the Proxy\
    \ LSR.  The MPLS Proxy Ping Request Proxy Echo\n   Parameters TLV's Proxy Flags\
    \ SHOULD be set appropriately, as\n   described below.\n    0                \
    \   1                   2                   3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3\
    \ 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |  Address Type |   Reply Mode  |        Proxy Flags            |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |      TTL      |  Rqst'd DSCP  |        Source UDP Port        |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |          Global Flags         |       MPLS Payload Size       |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                                                               |\n   :  \
    \                    Destination IP Address                   :\n   |        \
    \                                                       |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                                                               |\n   :  \
    \                                                             :\n   :        \
    \                    Sub-TLVs                           :\n   :              \
    \                                                 :\n   |                    \
    \                                           |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   Address Type\n      The type and length of the address found in the in the\
    \ Destination\n      IP Address and Next Hop IP Addresses fields.  The values\
    \ are\n      shared with the Downstream Mapping Address Type Registry.\n     \
    \ The type codes applicable in this case appear in the table below:\n        \
    \   Address Family   Type     Length\n                IPv4          1        \
    \ 4\n                IPv6          3        16\n   Reply Mode\n      The reply\
    \ mode to be sent in the MPLS Echo Request message; the\n      values are as specified\
    \ in [RFC4379].\n   Proxy Flags\n      The Proxy Request Initiator sets zero,\
    \ one, or more of these flags\n      to request actions at the Proxy LSR.\n  \
    \       0x0001 Request for FEC Neighbor Address info\n            When set, this\
    \ requests that the Proxy LSR supply the\n            Upstream and Downstream\
    \ neighbor address information in the\n            MPLS Proxy Ping Reply message.\
    \  This flag is only applicable\n            for the topmost FEC in the FEC stack\
    \ if the FEC type\n            corresponds with a P2MP or MP2MP LSP.  The Proxy\
    \ LSR MUST\n            respond (as applicable) with Upstream Neighbor Address\
    \ and\n            Downstream Neighbor Address TLV(s) in the MPLS Proxy Ping\n\
    \            Reply message.  The Upstream Neighbor Address TLV needs be\n    \
    \        included only if there is an upstream neighbor.  Similarly,\n       \
    \     one Downstream Neighbor Address TLV needs to be included for\n         \
    \   each Downstream Neighbor from which the LSR learned\n            bindings.\n\
    \            Setting this flag will cause the Proxy LSR to cancel sending\n  \
    \          any MPLS Echo Request.  The initiator may use information\n       \
    \     learned from the MPLS Proxy Ping Reply that is sent instead\n          \
    \  to generate subsequent proxy requests.\n         0x0002 Request for Downstream\
    \ Mapping\n            When set, this requests that the Proxy LSR supply a\n \
    \           Downstream Mapping TLV (see [RFC4379]) in the MPLS Proxy\n       \
    \     Ping Reply message.  Either this flag may be set or the\n            \"\
    Request for Downstream Detailed Mapping\" flag may be set,\n            but not\
    \ both.\n            Setting this flag will cause the Proxy LSR to cancel sending\n\
    \            an MPLS Echo Request.  Information learned with such a Proxy\n  \
    \          Reply may be used by the Proxy Initiator to generate\n            subsequent\
    \ Proxy Requests.\n         0x0004 Request for Downstream Detailed Mapping\n \
    \           When set, this requests that the Proxy LSR supply a\n            Downstream\
    \ Detailed Mapping TLV (see [RFC6424]) in the MPLS\n            Proxy Ping Reply\
    \ message.  It's not valid to have the\n            \"Request for Downstream Mapping\"\
    \ flag set when this flag is\n            set.  Setting this flag will cause the\
    \ Proxy LSR to cancel\n            sending an MPLS Echo Request.  The initiator\
    \ may use\n            information learned from the MPLS Proxy Ping Reply that\
    \ is\n            sent instead to generate subsequent proxy requests.\n      \
    \   0x0008 Explicit DSCP Request\n            When set, this requests that the\
    \ Proxy LSR use the supplied\n            \"Rqst'd DSCP\" byte in the Echo Request\
    \ message\n      TTL\n         The TTL to be used in the label stack entry corresponding\
    \ to\n         the topmost FEC in the MPLS Echo Request packet.  Valid values\n\
    \         are in the range [1,255].\n      Requested DSCP\n         This field\
    \ is valid only if the Explicit DSCP flag is set.  If\n         not set, the field\
    \ MUST be zero on transmission and ignored on\n         receipt.  When the flag\
    \ is set, this field contains the DSCP\n         value to be used in the MPLS\
    \ Echo Request packet IP header.\n      Source UDP Port\n         The source UDP\
    \ port to be sent in the MPLS Echo Request packet\n      Global Flags\n      \
    \   The Global Flags to be sent in the MPLS Echo Request message\n      MPLS Payload\
    \ Size\n         Used to request that the MPLS payload (IP header + UDP header\
    \ +\n         MPLS Echo Request) be padded using a zero-filled Pad TLV so\n  \
    \       that the IP header, UDP header, and MPLS Echo Request total the\n    \
    \     specified size.  Having the field set to zero means no size\n         request\
    \ is being made.  If the requested size is less than the\n         minimum size\
    \ required to form the MPLS Echo Request, the\n         request will be treated\
    \ as a best-effort request with the Proxy\n         LSR building the smallest\
    \ possible packet (i.e., not using a\n         Pad TLV).  The IP header DF bit\
    \ MUST be set when this field is\n         non-zero.\n      Destination IP Address\n\
    \         If the Address Type is IPv4, an address from the range 127/8;\n    \
    \     if the Address Type is IPv6, an address from the range\n         ::ffff:7f00:0/104\n\
    \      Sub-TLVs\n         List of TLV-encoded sub-TLVs.  Currently one is defined.\n\
    \          Sub-Type       Length            Sub-TLV Name\n          -------- \
    \      ------            ------------\n                 1         8+         \
    \     Next Hop\n"
- title: 5.1.1.  Next Hop Sub-TLV
  contents:
  - "5.1.1.  Next Hop Sub-TLV\n   This sub-TLV is used to describe a particular next\
    \ hop towards which\n   the Echo Request packet should be sent.  If the topmost\
    \ FEC in the\n   FEC stack is a multipoint LSP, this sub-TLV may appear multiple\n\
    \   times.\n    0                   1                   2                   3\n\
    \    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |   Addr Type   |                      MBZ                      |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |              Next Hop IP Address (4 or 16 octets)             |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |             Next Hop Interface  (0, 4, or 16 octets)          |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \       Address Type\n           Type     Type of Next Hop   Addr Length  Interface\
    \ Field (IF)\n                                                          Length\n\
    \             1        IPv4 Numbered           4             4\n             2\
    \        IPv4 Unnumbered         4             4\n             3        IPv6 Numbered\
    \          16            16\n             4        IPv6 Unnumbered        16 \
    \            4\n             5        Reserved\n             6        IPv4 Protocol\
    \ Adj       4             0\n             7        IPv6 Protocol Adj      16 \
    \            0\n         Note:  Types 1-4 correspond to the types in the DSMAP\
    \ TLV.\n                They are expected to be populated with information\n \
    \               obtained through a previously returned DSMAP TLV.  Types\n   \
    \             6 and 7 are intended to be populated from the local\n          \
    \      address information obtained from a previously returned\n             \
    \   Downstream Neighbor Address TLV or Upstream Neighbor\n                Address\
    \ TLV.\n       Next Hop IP Address\n         A next hop address that the Echo\
    \ Request message is to be sent\n         towards\n       Next Hop Interface\n\
    \         Identifier of the interface through which the Echo Request\n       \
    \  message is to be sent.  For Addr Type 5 and 6, the Next Hop\n         interface\
    \ field isn't used and MUST be of an associated byte\n         length of zero\
    \ octets.\n"
- title: 5.2.  Reply-to Address TLV
  contents:
  - "5.2.  Reply-to Address TLV\n   Used to specify the MPLS Echo Request IP source\
    \ address.  This\n   address MUST be IP reachable via the Proxy LSR; otherwise,\
    \ it will be\n   rejected.\n    0                   1                   2    \
    \               3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7\
    \ 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |  Address Type |                      MBZ                      |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                                                               |\n   :  \
    \                     Reply-to Address                        :\n   |        \
    \                                                       |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \       Address Type\n         A type code as specified in the table below:\n\
    \            Type     Type of Address\n              1        IPv4\n         \
    \     3        IPv6\n"
- title: 5.3.  Upstream Neighbor Address TLV
  contents:
  - "5.3.  Upstream Neighbor Address TLV\n    0                   1              \
    \     2                   3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2\
    \ 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |Upst Addr Type |Local Addr Type|             MBZ               |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                                                               |\n   :  \
    \                   Upstream Address                          :\n   |        \
    \                                                       |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                                                               |\n   :  \
    \                       Local Address                         :\n   |        \
    \                                                       |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \       Upst Addr Type; Local Addr Type\n         These two fields determine the\
    \ type and length of the\n         respective addresses.  The codes are specified\
    \ in the table\n         below:\n           Type     Type of Address         \
    \ Length\n             0        No Address Supplied       0\n             1  \
    \      IPv4                      4\n             3        IPv6               \
    \      16\n       Upstream Address\n         The address of the immediate upstream\
    \ neighbor for the topmost\n         FEC in the FEC stack.  If the protocol adjacency\
    \ exists by\n         which the label for this FEC was exchanged, this address\
    \ MUST\n         be the address used in that protocol exchange.\n       Local\
    \ Address\n         The local address used in the protocol adjacency by which\
    \ the\n         label for this FEC was exchanged.\n"
- title: 5.4.  Downstream Neighbor Address TLV
  contents:
  - "5.4.  Downstream Neighbor Address TLV\n    0                   1            \
    \       2                   3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\
    \ 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |Dnst Addr Type |Local Addr Type|             MBZ               |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                                                               |\n   :  \
    \                   Downstream Address                        :\n   |        \
    \                                                       |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                                                               |\n   :  \
    \                       Local Address                         :\n   |        \
    \                                                       |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \       Dnst Addr Type; Local Addr Type\n         These two fields determine the\
    \ type and length of the\n         respective addresses.  The codes are specified\
    \ in the table\n         below:\n            Type     Type of Address        \
    \  Length\n              0        No Address Supplied       0\n              1\
    \        IPv4                      4\n              3        IPv6            \
    \         16\n       Downstream Address\n         The address of an immediate\
    \ downstream neighbor for the topmost\n         FEC in the FEC stack.  If the\
    \ protocol adjacency exists by\n         which the label for this FEC was exchanged,\
    \ this address MUST\n         be the address used in that protocol exchange.\n\
    \       Local Address\n         The local address used in the protocol adjacency\
    \ by which the\n         label for this FEC was exchanged.\n"
- title: 6.  Security Considerations
  contents:
  - "6.  Security Considerations\n   The mechanisms described in this document are\
    \ intended to be used\n   within a service provider network and to be initiated\
    \ only under the\n   authority of that administration.\n   If such a network also\
    \ carries Internet traffic, or permits IP access\n   from other administrations,\
    \ the MPLS Proxy Ping message SHOULD be\n   discarded at the points where IP packets\
    \ are received from other\n   administrations.  This can be accomplished by filtering\
    \ on source\n   address or by filtering all MPLS ping messages on UDP port.\n\
    \   Any node that acts as a Proxy LSR SHOULD validate requests against a\n   set\
    \ of valid source addresses.  An implementation MUST provide such\n   filtering\
    \ capabilities.\n   MPLS Proxy Ping Request messages are IP addressed directly\
    \ to the\n   Proxy LSR.  If a Proxy LSR receives an MPLS Proxy Ping message via\n\
    \   expiration of the IP or Label Stack Entry TTL, it MUST NOT be acted\n   upon.\n\
    \   If an MPLS Proxy Ping Request IP source address is not IP reachable\n   by\
    \ the Proxy LSR, the Proxy Request MUST NOT be acted upon.\n   MPLS Proxy Ping\
    \ Requests are limited to making their request via the\n   specification of a\
    \ FEC.  This ensures that only valid MPLS Echo\n   Request messages can be created.\
    \  No label-spoofing attacks are\n   possible.\n"
- title: 7.  IANA Considerations
  contents:
  - "7.  IANA Considerations\n   Per this document, IANA has made the following assignments.\n\
    \   MPLS LSP Ping Message Types\n        Value      Meaning\n        -----   \
    \   -------\n            3      MPLS Proxy Ping Request\n            4      MPLS\
    \ Proxy Ping Reply\n   TLVs\n         Type      TLV Name\n         ----      --------\n\
    \           23      Proxy Echo Parameters\n           24      Reply-to Address\n\
    \           25      Upstream Neighbor Address\n           26      Downstream Neighbor\
    \ Address\n   Return Codes\n        Value      Meaning\n        -----      -------\n\
    \           16      Proxy Ping not authorized\n           17      Proxy Ping parameters\
    \ need to be modified\n           18      MPLS Echo Request could not be sent\n\
    \           19      Replying router has FEC mapping for topmost FEC\n"
- title: 7.1.  Proxy Echo Parameters Sub-TLVs
  contents:
  - "7.1.  Proxy Echo Parameters Sub-TLVs\n   The IANA has created and maintains this\
    \ new registry for Proxy Echo\n   Parameters Sub-TLVs.  Assignments will use the\
    \ same rules spelled out\n   in Section 7.2 of [RFC4379].\n         Sub-Type \
    \    Sub-TLV Name\n         --------     ------------\n            0         Reserved\n\
    \            1         Next Hop\n"
- title: 7.2.  Proxy Flags
  contents:
  - "7.2.  Proxy Flags\n   IANA has created and maintains a new registry for the Proxy\
    \ Flags\n   that are used with the Proxy Echo Parameters TLV.  See Section 5.1\n\
    \   for details.  The registry is in the \"Multi-Protocol Label Switching\n  \
    \ (MPLS) Label Switched Paths (LSPs) Ping Parameters\" registry in the\n   \"\
    Multiprotocol Label Switching Architecture (MPLS)\" name space.  The\n   registration\
    \ procedure is Standards Action [RFC5226].  The initial\n   values are as follows.\n\
    \         Bit Number     Name\n         ----------     ----\n             0  \
    \        Request for FEC Neighbor Address info\n             1          Request\
    \ for Downstream Mapping\n             2          Request for Downstream Detailed\
    \ Mapping\n             3          Explicit DSCP Request\n             4-15  \
    \     Unassigned\n"
- title: 7.3.  Downstream Address Mapping Registry
  contents:
  - "7.3.  Downstream Address Mapping Registry\n   This document makes the following\
    \ assignments in the Downstream\n   Address Mapping Registry.  This document updates\
    \ the registry defined\n   by [RFC6426].  The registration procedure remains Standards\
    \ Action\n   and a note has been added as follows:\n      When a code point is\
    \ assigned that is not also assigned in the\n      Next Hop Address Type Registry,\
    \ the code point there must be\n      marked \"Reserved\".\n   Type #      Address\
    \ Type         K Octets\n   ------      ------------         --------\n      \
    \  6      Reserved             N/A       RFC 7555\n        7      Reserved   \
    \          N/A       RFC 7555\n"
- title: 7.4.  Next Hop Sub-TLV Address Type Registry
  contents:
  - "7.4.  Next Hop Sub-TLV Address Type Registry\n   IANA has created a new registry\
    \ called the \"Next Hop Address Type\n   Registry\".  The allocation policy for\
    \ this registry is Standards\n   Action.  Further, a note has been added as follows:\n\
    \      When a code point is assigned that is not also assigned in the\n      Downstream\
    \ Address Mapping Registry, the code point there must be\n      marked \"Reserved\"\
    .\n   The initial allocations are:\n      Type     Type of Next Hop   Addr Length\
    \  IF Length   Reference\n      1        IPv4 Numbered           4          4\
    \        [RFC4379]\n      2        IPv4 Unnumbered         4          4      \
    \  [RFC4379]\n      3        IPv6 Numbered          16         16        [RFC4379]\n\
    \      4        IPv6 Unnumbered        16          4        [RFC4379]\n      5\
    \        Reserved                                     RFC 7555\n      6      \
    \  IPv4 Protocol Adj       4          0         RFC 7555\n      7        IPv6\
    \ Protocol Adj      16          0         RFC 7555\n      8-255    Unassigned\n"
- title: 8.  References
  contents:
  - '8.  References

    '
- title: 8.1.  Normative References
  contents:
  - "8.1.  Normative References\n   [RFC2119]  Bradner, S., \"Key words for use in\
    \ RFCs to Indicate\n              Requirement Levels\", BCP 14, RFC 2119,\n  \
    \            DOI 10.17487/RFC2119, March 1997,\n              <http://www.rfc-editor.org/info/rfc2119>.\n\
    \   [RFC4379]  Kompella, K. and G. Swallow, \"Detecting Multi-Protocol\n     \
    \         Label Switched (MPLS) Data Plane Failures\", RFC 4379,\n           \
    \   DOI 10.17487/RFC4379, February 2006,\n              <http://www.rfc-editor.org/info/rfc4379>.\n\
    \   [RFC6424]  Bahadur, N., Kompella, K., and G. Swallow, \"Mechanism for\n  \
    \            Performing Label Switched Path Ping (LSP Ping) over MPLS\n      \
    \        Tunnels\", RFC 6424, DOI 10.17487/RFC6424, November 2011,\n         \
    \     <http://www.rfc-editor.org/info/rfc6424>.\n   [RFC6425]  Saxena, S., Ed.,\
    \ Swallow, G., Ali, Z., Farrel, A.,\n              Yasukawa, S., and T. Nadeau,\
    \ \"Detecting Data-Plane\n              Failures in Point-to-Multipoint MPLS -\
    \ Extensions to LSP\n              Ping\", RFC 6425, DOI 10.17487/RFC6425, November\
    \ 2011,\n              <http://www.rfc-editor.org/info/rfc6425>.\n   [RFC6426]\
    \  Gray, E., Bahadur, N., Boutros, S., and R. Aggarwal, \"MPLS\n             \
    \ On-Demand Connectivity Verification and Route Tracing\",\n              RFC\
    \ 6426, DOI 10.17487/RFC6426, November 2011,\n              <http://www.rfc-editor.org/info/rfc6426>.\n\
    \   [RFC7110]  Chen, M., Cao, W., Ning, S., Jounay, F., and S. Delord,\n     \
    \         \"Return Path Specified Label Switched Path (LSP) Ping\",\n        \
    \      RFC 7110, DOI 10.17487/RFC7110, January 2014,\n              <http://www.rfc-editor.org/info/rfc7110>.\n"
- title: 8.2.  Informative References
  contents:
  - "8.2.  Informative References\n   [RFC4875]  Aggarwal, R., Ed., Papadimitriou,\
    \ D., Ed., and S.\n              Yasukawa, Ed., \"Extensions to Resource Reservation\n\
    \              Protocol - Traffic Engineering (RSVP-TE) for Point-to-\n      \
    \        Multipoint TE Label Switched Paths (LSPs)\", RFC 4875,\n            \
    \  DOI 10.17487/RFC4875, May 2007,\n              <http://www.rfc-editor.org/info/rfc4875>.\n\
    \   [RFC5226]  Narten, T. and H. Alvestrand, \"Guidelines for Writing an\n   \
    \           IANA Considerations Section in RFCs\", BCP 26, RFC 5226,\n       \
    \       DOI 10.17487/RFC5226, May 2008,\n              <http://www.rfc-editor.org/info/rfc5226>.\n\
    \   [RFC6388]  Wijnands, IJ., Ed., Minei, I., Ed., Kompella, K., and B.\n    \
    \          Thomas, \"Label Distribution Protocol Extensions for Point-\n     \
    \         to-Multipoint and Multipoint-to-Multipoint Label Switched\n        \
    \      Paths\", RFC 6388, DOI 10.17487/RFC6388, November 2011,\n             \
    \ <http://www.rfc-editor.org/info/rfc6388>.\n"
- title: Acknowledgements
  contents:
  - "Acknowledgements\n   The authors would like to thank Nobo Akiya, Adrian Farrel,\
    \ Tom Yu,\n   Tom Taylor, and Warren Kumari for their detailed reviews and\n \
    \  insightful comments.\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   George Swallow\n   Cisco Systems\n   1414 Massachusetts\
    \ Ave\n   Boxborough, MA  01719\n   United States\n   EMail: swallow@cisco.com\n\
    \   Vanson Lim\n   Cisco Systems\n   1414 Massachusetts Avenue\n   Boxborough,\
    \ MA  01719\n   United States\n   EMail: vlim@cisco.com\n   Sam Aldrin\n   Huawei\
    \ Technologies\n   2330 Central Express Way\n   Santa Clara, CA  95951\n   United\
    \ States\n   EMail: aldrin.ietf@gmail.com\n"
