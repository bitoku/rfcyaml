- title: __initial_text__
  contents:
  - '         Proxy Mobile IPv6 Extensions to Support Flow Mobility

    '
- title: Abstract
  contents:
  - "Abstract\n   Proxy Mobile IPv6 (PMIPv6) allows a mobile node to connect to the\n\
    \   same PMIPv6 domain through different interfaces.  This document\n   describes\
    \ extensions to the PMIPv6 protocol that are required to\n   support network-based\
    \ flow mobility over multiple physical\n   interfaces.\n   This document updates\
    \ RFC 5213.  The extensions described in this\n   document consist of the operations\
    \ performed by the local mobility\n   anchor and the mobile access gateway to\
    \ manage the prefixes assigned\n   to the different interfaces of the mobile node,\
    \ as well as how the\n   forwarding policies are handled by the network to ensure\
    \ consistent\n   flow mobility management.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This\
    \ document is a product of the Internet Engineering Task Force\n   (IETF).  It\
    \ represents the consensus of the IETF community.  It has\n   received public\
    \ review and has been approved for publication by the\n   Internet Engineering\
    \ Steering Group (IESG).  Further information on\n   Internet Standards is available\
    \ in Section 2 of RFC 5741.\n   Information about the current status of this document,\
    \ any errata,\n   and how to provide feedback on it may be obtained at\n   http://www.rfc-editor.org/info/rfc7864.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2016 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (http://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.  Code Components\
    \ extracted from this document must\n   include Simplified BSD License text as\
    \ described in Section 4.e of\n   the Trust Legal Provisions and are provided\
    \ without warranty as\n   described in the Simplified BSD License.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1.  Introduction  . . . . . . . . . . . . . . . . . . .\
    \ . . . . .   3\n   2.  Terminology . . . . . . . . . . . . . . . . . . . . .\
    \ . . . .   3\n   3.  Overview of the PMIPv6 Flow Mobility Extensions . . . .\
    \ . . .   4\n     3.1.  Use Case Scenarios  . . . . . . . . . . . . . . . . .\
    \ . .   4\n     3.2.  Basic Operation . . . . . . . . . . . . . . . . . . . .\
    \ .   5\n       3.2.1.  MN Sharing a Common Set of Prefixes on All MAGs . . .\
    \   6\n       3.2.2.  MN with Different Sets of Prefixes on Each MAG  . . .  \
    \ 9\n     3.3.  Use of PBU/PBA Signaling  . . . . . . . . . . . . . . . .  11\n\
    \     3.4.  Use of Flow-Level Information . . . . . . . . . . . . . .  12\n  \
    \ 4.  Message Formats . . . . . . . . . . . . . . . . . . . . . . .  12\n    \
    \ 4.1.  Home Network Prefix . . . . . . . . . . . . . . . . . . .  13\n     4.2.\
    \  Flow Mobility Initiate (FMI)  . . . . . . . . . . . . . .  13\n     4.3.  Flow\
    \ Mobility Acknowledgement (FMA) . . . . . . . . . . .  14\n   5.  Conceptual\
    \ Data Structures  . . . . . . . . . . . . . . . . .  14\n     5.1.  Multiple\
    \ Proxy Care-of Address Registration . . . . . . .  14\n     5.2.  Flow Mobility\
    \ Cache (FMC) . . . . . . . . . . . . . . . .  15\n   6.  Mobile Node Considerations\
    \  . . . . . . . . . . . . . . . . .  16\n   7.  IANA Considerations . . . . .\
    \ . . . . . . . . . . . . . . . .  16\n   8.  Security Considerations . . . .\
    \ . . . . . . . . . . . . . . .  17\n   9.  References  . . . . . . . . . . .\
    \ . . . . . . . . . . . . . .  17\n     9.1.  Normative References  . . . . .\
    \ . . . . . . . . . . . . .  17\n     9.2.  Informative References  . . . . .\
    \ . . . . . . . . . . . .  18\n   Acknowledgments . . . . . . . . . . . . . .\
    \ . . . . . . . . . . .  18\n   Contributors  . . . . . . . . . . . . . . . .\
    \ . . . . . . . . . .  19\n   Author's Address  . . . . . . . . . . . . . . .\
    \ . . . . . . . . .  19\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   Proxy Mobile IPv6 (PMIPv6), specified in [RFC5213], provides\
    \ network-\n   based mobility management to hosts connecting to a PMIPv6 domain.\n\
    \   PMIPv6 introduces two new functional entities, the Local Mobility\n   Anchor\
    \ (LMA) and the Mobile Access Gateway (MAG).  The MAG is the\n   entity detecting\
    \ the Mobile Node's (MN's) attachment and providing IP\n   connectivity.  The\
    \ LMA is the entity assigning one or more Home\n   Network Prefixes (HNPs) to\
    \ the MN and is the topological anchor for\n   all traffic belonging to the MN.\n\
    \   PMIPv6 allows an MN to connect to the same PMIPv6 domain through\n   different\
    \ interfaces.  This document specifies protocol extensions to\n   Proxy Mobile\
    \ IPv6 between the LMA and MAGs to enable \"flow mobility\"\n   and, hence, distribute\
    \ specific traffic flows on different physical\n   interfaces.  It is assumed\
    \ that the MN IP-layer interface can\n   simultaneously and/or sequentially attach\
    \ to multiple MAGs, possibly\n   over multiple media.  One form to achieve this\
    \ multiple attachment is\n   described in [RFC7847], which allows the MN supporting\
    \ traffic flows\n   on different physical interfaces, regardless of the assigned\
    \ prefixes\n   on those physical interfaces.  Another alternative is to configure\n\
    \   the IP stack of the MN to behave according to the Weak ES Model\n   (commonly\
    \ referred to as the weak host model) [RFC1122].\n   In particular, this document\
    \ specifies how to enable \"flow mobility\"\n   in the PMIPv6 network (i.e., LMAs\
    \ and MAGs).  In order to do so, two\n   main operations are required: i) proper\
    \ prefix management by the\n   PMIPv6 network and ii) consistent flow forwarding\
    \ policies.  This\n   memo analyzes different potential use case scenarios, involving\n\
    \   different prefix assignment requirements and, therefore, different\n   PMIPv6\
    \ network extensions to enable \"flow mobility\".\n"
- title: 2.  Terminology
  contents:
  - "2.  Terminology\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\", \"SHALL\"\
    , \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"MAY\", and\
    \ \"OPTIONAL\" in this\n   document are to be interpreted as described in RFC\
    \ 2119 [RFC2119].\n   The following terms used in this document are defined in\
    \ the Proxy\n   Mobile IPv6 [RFC5213]:\n   o  Local Mobility Anchor (LMA)\n  \
    \ o  Mobile Access Gateway (MAG)\n   o  Proxy Mobile IPv6 Domain (PMIPv6-Domain)\n\
    \   o  LMA Address (LMAA)\n   o  Proxy Care-of Address (Proxy-CoA)\n   o  Home\
    \ Network Prefix (HNP)\n   The following terms used in this document are defined\
    \ in the Multiple\n   Care-of Addresses Registration [RFC5648] and Flow Bindings\
    \ in Mobile\n   IPv6 and Network Mobility (NEMO) Basic Support [RFC6089]:\n  \
    \ o  Binding Identification (BID) Number\n   o  Flow Identifier (FID)\n   o  Traffic\
    \ Selector (TS)\n   The following terms are defined and used in this document:\n\
    \   o  Flow Mobility Initiate (FMI): Message sent by the LMA to the MAG\n    \
    \  conveying the information required to enable flow mobility in a\n      PMIPv6-Domain.\n\
    \   o  Flow Mobility Acknowledgement (FMA): Message sent by the MAG in\n     \
    \ reply to an FMI message.\n   o  Flow Mobility Cache (FMC): Conceptual data structure\
    \ to support\n      the flow mobility management operations described in this\n\
    \      document.\n"
- title: 3.  Overview of the PMIPv6 Flow Mobility Extensions
  contents:
  - '3.  Overview of the PMIPv6 Flow Mobility Extensions

    '
- title: 3.1.  Use Case Scenarios
  contents:
  - "3.1.  Use Case Scenarios\n   In contrast to a typical handover where connectivity\
    \ to a physical\n   medium is relinquished and then re-established, flow mobility\
    \ assumes\n   that an MN can have simultaneous access to more than one network.\
    \  In\n   this specification, it is assumed that the LMA is aware of the MN's\n\
    \   ability to have simultaneous access to both access networks and the\n   ability\
    \ to handle the same or a different set of prefixes on each\n   access.  How this\
    \ is done is outside the scope of this specification.\n   There are different\
    \ flow mobility scenarios.  In some of them, the MN\n   might share a common set\
    \ of prefixes among all its physical\n   interfaces; in others, the MN might have\
    \ a different subset of\n   prefixes configured on each of the physical interfaces.\
    \  The\n   different scenarios are the following:\n   1.  At the time of a new\
    \ network attachment, the MN obtains the same\n       prefix or the same set of\
    \ prefixes as already assigned to an\n       existing session.  This is not the\
    \ default behavior with basic\n       PMIPv6 [RFC5213], and the LMA needs to be\
    \ able to provide the\n       same assignment even for the simultaneous attachment\
    \ (as opposed\n       to the handover scenario only).\n   2.  At the time of a\
    \ new network attachment, the MN obtains a new\n       prefix or a new set of\
    \ prefixes for the new session.  This is the\n       default behavior with basic\
    \ PMIPv6 [RFC5213].\n   A combination of the two above-mentioned scenarios is\
    \ also possible.\n   At the time of a new network attachment, the MN obtains a\
    \ combination\n   of prefix(es) in use and new prefix(es).  This is a hybrid of\
    \ the two\n   scenarios described before.  The local policy determines whether\
    \ the\n   new prefix is exclusive to the new attachment or can be assigned to\n\
    \   an existing attachment as well.\n   The operational description of how to\
    \ enable flow mobility in each of\n   these scenarios is provided in Sections\
    \ 3.2.1 and 3.2.2.\n   The extensions described in this document support all the\n\
    \   aforementioned scenarios.\n"
- title: 3.2.  Basic Operation
  contents:
  - "3.2.  Basic Operation\n   This section describes how the PMIPv6 extensions described\
    \ in this\n   document enable flow mobility support.\n   Both the MN and the LMA\
    \ MUST have local policies in place to ensure\n   that packets are forwarded coherently\
    \ for unidirectional and\n   bidirectional communications.  The details about\
    \ how this consistency\n   is ensured are out of the scope of this document. \
    \ Either the MN or\n   the LMA can initiate IP flow mobility.  If the MN makes\
    \ the flow\n   mobility decision, then the LMA follows that decision and updates\
    \ its\n   forwarding state accordingly.  The network can also trigger mobility\n\
    \   on the MN side via out-of-band mechanisms (e.g., 3GPP / Access\n   Network\
    \ Discovery and Selection Function (ANDSF) sends updated\n   routing policies\
    \ to the MN).  In a given scenario and MN, the\n   decision on IP flow mobility\
    \ MUST be taken either by the MN or the\n   LMA, but it MUST NOT be taken by both.\n"
- title: 3.2.1.  MN Sharing a Common Set of Prefixes on All MAGs
  contents:
  - "3.2.1.  MN Sharing a Common Set of Prefixes on All MAGs\n   This scenario corresponds\
    \ to the first use case scenario described in\n   Section 3.1.  Extensions to\
    \ basic PMIPv6 [RFC5213] signaling at the\n   time of a new attachment are needed\
    \ to ensure that the same prefix\n   (or set of prefixes) is assigned to all the\
    \ interfaces of the same MN\n   that are simultaneously attached.  Subsequently,\
    \ no further signaling\n   is necessary between the local mobility anchor and\
    \ the MAG, and flows\n   are forwarded according to policy rules on the LMA and\
    \ the MN.\n   If the LMA assigns a common prefix (or set of prefixes) to the\n\
    \   different physical interfaces attached to the domain, then every MAG\n   already\
    \ has all the routing knowledge required to forward uplink or\n   downlink packets\
    \ after the Proxy Binding Update / Proxy Binding\n   Acknowledgement (PBU/PBA)\
    \ registration for each MAG, and the LMA does\n   not need to send any kind of\
    \ signaling in order to move flows across\n   the different physical interfaces\
    \ (because moving flows is a local\n   decision of the LMA).  Optionally, signaling\
    \ MAY be exchanged in case\n   the MAG needs to know about flow-level information\
    \ (e.g., to link\n   flows with proper QoS paths and/or inform the MN [RFC7222]).\n\
    \   The LMA needs to know when to assign the same set of prefixes to all\n   the\
    \ different physical interfaces of the MN.  This can be achieved by\n   different\
    \ means, such as policy configuration, default policies, etc.\n   In this document,\
    \ a new Handoff Indicator (HI) (\"Attachment over a\n   new interface sharing\
    \ prefixes\" (6) value) is defined that allows the\n   MAG to indicate to the\
    \ LMA that the same set of prefixes MUST be\n   assigned to the MN.  The considerations\
    \ of Section 5.4.1 of [RFC5213]\n   are updated by this specification as follows:\n\
    \   o  If there is at least one Home Network Prefix Option present in the\n  \
    \    request with a NON_ZERO prefix value, there exists a Binding Cache\n    \
    \  Entry (BCE) (with all HNPs in the BCE matching the prefix values\n      of\
    \ all Home Network Prefix Options of the received Proxy Binding\n      Update\
    \ message), and the entry matches the MN identifier in the\n      Mobile Node\
    \ Identifier Option of the received Proxy Binding Update\n      message, and the\
    \ value of the HI of the received Proxy Binding\n      Update is equal to \"Attachment\
    \ over a new interface sharing\n      prefixes\".\n      1.  If there is a Mobile\
    \ Node Link-layer Identifier Option present\n          in the request, and the\
    \ BCE matches the Access Technology Type\n          (ATT) and the MN-LL-Identifier,\
    \ then the request MUST be\n          considered as a request for updating that\
    \ BCE.\n      2.  If there is a Mobile Node Link-layer Identifier Option present\n\
    \          in the request, and the BCE does not match the Access\n          Technology\
    \ Type (ATT) and the MN-LL-Identifier, then the\n          request MUST be considered\
    \ as a request for creating a new\n          mobility session sharing the same\
    \ set of HNPs assigned to the\n          existing BCE found.\n      3.  If there\
    \ is not a Mobile Node Link-layer Identifier Option\n          present in the\
    \ request, then the request MUST be considered as\n          a request for creating\
    \ a new mobility session sharing the same\n          set of HNPs assigned to the\
    \ existing BCE found.\n                                      LMA Binding Cache\n\
    \                       +---+       ========================\n               \
    \        |LMA|        MN1, ATT1, pref1, MAG1\n                       +---+   \
    \     MN1, ATT2, pref1, MAG2\n                        //\\\\\n             +---------//--\\\
    \\-------------+\n            (         //    \\\\             ) PMIPv6 domain\n\
    \            (        //      \\\\            )\n             +------//--------\\\
    \\----------+\n                   //          \\\\\n                  //     \
    \       \\\\\n               +----+           +----+\n               |MAG1|  \
    \         |MAG2|\n               +----+           +----+\n                 | \
    \               |\n                 |   +-------+    |\n                 |   |\
    \  I P  |    |\n                 |   +---+---+    |\n                 |---|if1|if2|----|\n\
    \                     +---+---+\n                        MN1\n        Figure 1:\
    \ Shared Prefix Across Physical Interfaces Scenario\n   Next, an example of how\
    \ flow mobility works in this case is shown.\n   In Figure 1, a mobile node (MN1)\
    \ has two different physical\n   interfaces (if1 of access technology type ATT1,\
    \ and if2 of access\n   technology type ATT2).  Each physical interface is attached\
    \ to a\n   different MAG, both of them controlled by the same LMA.  Both\n   physical\
    \ interfaces are assigned the same prefix (pref1) upon\n   attachment to the MAGs.\
    \  If the IP layer at the MN shows one single\n   logical interface (e.g., as\
    \ described in [RFC7847]), then the mobile\n   node has one single IPv6 address\
    \ configured at the IP layer:\n   pref1::mn1.  Otherwise, per interface IPv6 addresses\
    \ (e.g.,\n   pref1::if1 and pref1::if2) would be configured; each address MUST\
    \ be\n   valid on every interface.  We assume the first case in the following\n\
    \   example (and in the rest of this document).  Initially, flow X goes\n   through\
    \ MAG1 and flow Y through MAG2.  At a certain point, flow Y can\n   be moved to\
    \ also go through MAG1.  Figure 2 shows the scenario in\n   which no flow-level\
    \ information needs to be exchanged, so there is no\n   signaling between the\
    \ LMA and the MAGs.\n   Note that if different IPv6 addresses are configured at\
    \ the IP layer,\n   IP-session continuity is still possible (for each of the configured\n\
    \   IP addresses).  This is achieved by the network delivering packets\n   destined\
    \ to a particular IP address of the MN to the right of MN's\n   physical interface\
    \ where the flow is selected to be moved, and the MN\n   also selecting the same\
    \ interface when sending traffic back uplink.\n                 +-----+      \
    \   +------+        +------+      +-----+\n   Internet      | LMA |         |\
    \ MAG1 |        | MAG2 |      | MN1 |\n                 +-----+         +------+\
    \        +------+      +-----+\n      |             |               |        \
    \       |             |\n      |  flow X to  |   flow X to   |           flow\
    \ X to         |\n      |  pref1::mn1 |   pref1::mn1  |           pref1::mn1 \
    \       |\n      |<----------->|<------------->|<-------------------------->if1\n\
    \      |  flow Y to  |           flow Y to           |  flow Y to  |\n      |\
    \  pref1::mn1 |           pref1::mn1          |  pref1::mn1 |\n      |<----------->|<----------------------------->|<---------->if2\n\
    \      |             |               |               |             |\n      |\
    \       ============          |               |       ============\n      |  \
    \     ||  flow  ||          |               |       ||  flow  ||\n      |    \
    \   || policy ||          |               |       || policy ||\n      |      \
    \ || update ||          |               |       || update ||\n      |       ============\
    \          |               |       ============\n      |             |       \
    \        |               |             |\n      |  flow Y to  |   flow Y to  \
    \ |          flow Y to          |\n      |  pref1::mn1 |   pref1::mn1  |     \
    \     pref1::mn1         |\n      |<----------->|<------------->|<-------------------------->if1\n\
    \      |             |               |               |             |\n       Figure\
    \ 2: Flow Mobility Message Sequence with a Common Set of\n                   \
    \              Prefixes\n   Figure 3 shows the state of the different network\
    \ entities after\n   moving flow Y in the previous example.  This document reuses\
    \ some of\n   the terminology and mechanisms of the flow bindings and multiple\n\
    \   care-of address registration specifications.  Note that, in this case\n  \
    \ the BIDs shown in the figure are assigned locally by the LMA, since\n   there\
    \ is no signaling required in this scenario.  In any case,\n   alternative implementations\
    \ of flow routing at the LMA MAY be used,\n   as it does not impact the operation\
    \ of the solution in this case.\n                           LMA Binding Cache\
    \         LMA flowmob state\n                      (BID, MN-ID, ATT, HNP, PCoA)\
    \       (BID, TS)\n                 +---+ ===========================  ===================\n\
    \                 |LMA|  1, MN1, ATT1, pref1, MAG1       1, flow X\n         \
    \        +---+  2, MN1, ATT2, pref1, MAG2       1, flow Y\n                  //\\\
    \\\n       +---------//--\\\\-------------+\n      (         //    \\\\      \
    \       ) PMIPv6 domain\n      (        //      \\\\            )\n       +------//--------\\\
    \\----------+\n             //          \\\\\n            //            \\\\ \
    \      MAG1 routing state\n         +----+           +----+  ================================\n\
    \         |MAG1|           |MAG2|     (dest)         (next hop)\n         +----+\
    \           +----+   pref1::/64   p2p-iface-with-MN1\n           |           \
    \     |         ::/0             LMA\n           |                |\n        \
    \   |                |      MAG2 routing state\n           |   +-------+    |\
    \     ================================\n           |   |  I P  |    |        (dest)\
    \         (next hop)\n           |   +---+---+    |      pref1::/64   p2p-iface-with-MN1\n\
    \           |---|if1|if2|----|         ::/0             LMA\n               +---+---+\n\
    \                  MN1\n          Figure 3: Data Structures with a Common Set\
    \ of Prefixes\n"
- title: 3.2.2.  MN with Different Sets of Prefixes on Each MAG
  contents:
  - "3.2.2.  MN with Different Sets of Prefixes on Each MAG\n   A different flow mobility\
    \ scenario happens when the LMA assigns\n   different sets of prefixes to physical\
    \ interfaces of the same mobile\n   node.  This covers the second case, or a combination\
    \ of scenarios,\n   described in Section 3.1.  In this case, additional signaling\
    \ is\n   required between the LMA and the MAG to enable relocating flows\n   between\
    \ the different attachments, so the MAGs are aware of the\n   prefixes for which\
    \ the MN is going to receive traffic, and local\n   routing entries are configured\
    \ accordingly.\n   In this case, signaling is required when a flow is to be moved\
    \ from\n   its original interface to a new one.  Since the LMA cannot send a PBA\n\
    \   message that has not been triggered in response to a received PBU\n   message,\
    \ the solution defined in this specification makes use of two\n   mobility messages:\
    \ FMI and FMA, which actually use the format of the\n   Update Notifications for\
    \ PMIPv6 defined in [RFC7077].  The trigger\n   for the flow movement can be on\
    \ the MN (e.g., by using layer-2\n   signaling with the MAG), or on the network\
    \ (e.g., based on congestion\n   and measurements), which then notifies the MN\
    \ for the final IP flow\n   mobility decision (as stated in Section 3.1).  Policy\
    \ management\n   functions (e.g., 3GPP/ANDSF) can be used for that purpose; however,\n\
    \   how the network notifies the MN is out of the scope of this document.\n  \
    \ If the flow is being moved from its default path (which is determined\n   by\
    \ the destination prefix) to a different one, the LMA constructs a\n   FMI message.\
    \  This message includes a Home Network Prefix Option for\n   each of the prefixes\
    \ that are requested to be provided with flow\n   mobility support on the new\
    \ MAG (note that these prefixes are not\n   anchored by the target MAG, and therefore\
    \ the MAG MUST NOT advertise\n   them on the MAG-MN link), with the off-link bit\
    \ (L) set to one.  This\n   message MUST be sent to the new target MAG, i.e.,\
    \ the one selected to\n   be used in the forwarding of the flow.  The MAG replies\
    \ with an FMA.\n   The message sequence is shown in Figure 4.\n              \
    \   +-----+         +------+        +------+      +-----+\n   Internet      |\
    \ LMA |         | MAG1 |        | MAG2 |      | MN1 |\n                 +-----+\
    \         +------+        +------+      +-----+\n      |             |       \
    \        |               |             |\n      |  flow X to  |   flow X to  \
    \ |           flow X to         |\n      |  pref1::mn1 |   pref1::mn1  |     \
    \      pref1::mn1        |\n      |<----------->|<------------->|<-------------------------->if1\n\
    \      |  flow Y to  |           flow Y to           |  flow Y to  |\n      |\
    \  pref2::mn1 |           pref2::mn1          |  pref2::mn1 |\n      |<----------->|<----------------------------->|<---------->if2\n\
    \      |             |               |               |             |\n      |\
    \       ============          |               |       ============\n      |  \
    \     ||  flow  ||          |               |       ||  flow  ||\n      |    \
    \   || policy ||          |               |       || policy ||\n      |      \
    \ || update ||          |               |       || update ||\n      |       ============\
    \          |               |       ============\n      |             |       \
    \        |               |             |\n      |             | FMI[MN1-ID, HNPs]\
    \             |             |\n      |             |-------------->|         \
    \      |             |\n      |             |          FMA  |               |\
    \             |\n      |             |<--------------|               |       \
    \      |\n      |  flow Y to  |   flow Y to   |          flow Y to          |\n\
    \      |  pref2::mn1 |   pref2::mn1  |          pref2::mn1         |\n      |<----------->|<------------->|<-------------------------->if1\n\
    \      |             |               |               |             |\n       Figure\
    \ 4: Flow Mobility Message Sequence When the LMA Assigns\n             Different\
    \ Sets of Prefixes per Physical Interface\n   The state in the network after moving\
    \ a flow, in the case where the\n   LMA assigns a different set of prefixes is\
    \ shown in Figure 5.\n                           LMA Binding Cache          LMA\
    \ flowmob state\n                      (BID, MN-ID, ATT, HNP, PCoA)        (BID,\
    \ TS)\n                 +---+ ============================  ===================\n\
    \                 |LMA|  1, MN1, ATT1, pref1,              1, flow X\n       \
    \          +---+                pref2,  MAG1        1, flow Y\n              \
    \    //\\\\  2, MN1, ATT2, pref2,  MAG2\n       +---------//--\\\\-------------+\n\
    \      (         //    \\\\             ) PMIPv6 domain\n      (        //   \
    \   \\\\            )\n       +------//--------\\\\----------+\n             //\
    \          \\\\\n            //            \\\\       MAG1 routing state\n   \
    \      +----+           +----+  ================================\n         |MAG1|\
    \           |MAG2|     (dest)         (next hop)\n         +----+           +----+\
    \   pref1::/64   p2p-iface-with-MN1\n           |                |      pref2::/64\
    \   p2p-iface-with-MN1\n           |                |         ::/0           \
    \  LMA\n           |                |\n           |   +-------+    |      MAG2\
    \ routing state\n           |   |  I P  |    |     ================================\n\
    \           |   +---+---+    |        (dest)         (next hop)\n           |---|if1|if2|----|\
    \      pref2::/64   p2p-iface-with-MN1\n               +---+---+             \
    \ ::/0             LMA\n                  MN1\n     Figure 5: Data Structures\
    \ When the LMA Assigns a Different Set of\n                                 Prefixes\n"
- title: 3.3.  Use of PBU/PBA Signaling
  contents:
  - "3.3.  Use of PBU/PBA Signaling\n   This specification introduces the FMI/FMA\
    \ signaling, which allows the\n   LMA to exchange required information with the\
    \ MAG to enable flow\n   mobility without waiting to receive a PBU.  However,\
    \ there are\n   scenarios in which the trigger for flow mobility might be related\
    \ to\n   a new MN's interface attachment.  In this case, the PBA sent in\n   response\
    \ to the PBU received from the new MAG can convey the same\n   signaling that\
    \ the FMI does.  In this case, the LMA MUST include a\n   Home Network Prefix\
    \ Option in the PBA for each of the prefixes that\n   are requested to be provided\
    \ with flow mobility support on the new\n   MAG with the off-link bit (L) set\
    \ to one.\n"
- title: 3.4.  Use of Flow-Level Information
  contents:
  - "3.4.  Use of Flow-Level Information\n   This specification does not mandate flow-level\
    \ information to be\n   exchanged between the LMA and the MAG to provide flow\
    \ mobility\n   support.  It only requires that the LMA keeps a flow-level state\n\
    \   (Section 5.2).  However, there are scenarios in which the MAG might\n   need\
    \ to know which flow(s) is/are coming within a prefix that has\n   been moved,\
    \ to link it/them to the proper QoS path(s) and optionally,\n   inform the MN\
    \ about it.  This section describes the extensions used\n   to include flow-level\
    \ information in the signaling defined between\n   the LMA and the MAG.\n   This\
    \ specification reuses some of the mobility extensions and message\n   formats\
    \ defined in [RFC5648] and [RFC6089], namely the Flow\n   Identification Mobility\
    \ Option and the Flow Mobility Sub-Options.\n   If the LMA wants to convey flow-level\
    \ information to the MAG, it MUST\n   include in the FMI (or the PBA) a Flow Identification\
    \ Mobility Option\n   for all the flows that the MAG needs to be aware of with\
    \ flow\n   granularity.  Each Flow Identification Mobility Option MUST include\
    \ a\n   Traffic Selector Sub-Option including such flow-level information.\n \
    \  To remove a flow-binding state at the MAG, the LMA simply sends an\n   FMI\
    \ (or a PBA, if it is in response to a PBU) message that includes\n   flow identification\
    \ options for all the flows that need to be\n   refreshed, modified, or added,\
    \ and simply omits those that need to be\n   removed.\n   Note that even if a\
    \ common set of prefixes is used, providing the MAG\n   with flow-level information\
    \ requires signaling to be exchanged, in\n   this case between the LMA and the\
    \ MAG.  This is done by sending an\n   FMI message (or a PBA, if it is sent in\
    \ response to a PBU).\n"
- title: 4.  Message Formats
  contents:
  - "4.  Message Formats\n   This section defines modifications to the PMIPv6 [RFC5213]\
    \ protocol\n   messages.\n   This specification requires implementation of Update\
    \ Notification\n   (UPN) [RFC7077] and Update Notification Ack (UPA) [RFC7077]\
    \ messages\n   with the specific Notification Reason and Status Code values as\n\
    \   defined by this document.  This document does not require\n   implementation\
    \ of any other aspects of [RFC7077].\n"
- title: 4.1.  Home Network Prefix
  contents:
  - "4.1.  Home Network Prefix\n   A new flag (L) is included in the Home Network\
    \ Prefix Option to\n   indicate to the MAG whether the conveyed prefix has to\
    \ be hosted on-\n   link or not on the point-to-point interface with the MN. \
    \ A prefix is\n   hosted off-link for the flow mobility purposes defined in this\n\
    \   document.  The rest of the Home Network Prefix Option format remains\n   the\
    \ same as defined in [RFC5213].\n     0                   1                  \
    \ 2                   3\n     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3\
    \ 4 5 6 7 8 9 0 1\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |      Type     |   Length      |L|  Reserved   | Prefix Length |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |                                                               |\n    +\
    \                                                               +\n    |     \
    \                                                          |\n    +          \
    \          Home Network Prefix                        +\n    |               \
    \                                                |\n    +                    \
    \                                           +\n    |                         \
    \                                      |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   Off-link Home Network Prefix Flag (L):\n      The Off-link Home Network Prefix\
    \ Flag is set to indicate to the\n      MAG that the HNP conveyed in the option\
    \ is not to be hosted on-\n      link, but has to be considered for flow mobility\
    \ purposes, and\n      therefore added to the MAG routing table.  If the flag\
    \ is set to\n      0, the MAG assumes that the HNP has to be hosted on-link.\n"
- title: 4.2.  Flow Mobility Initiate (FMI)
  contents:
  - "4.2.  Flow Mobility Initiate (FMI)\n   The FMI message used in this specification\
    \ is the UPN message\n   specified in [RFC7077].  The message format, transport,\
    \ and security\n   considerations are as specified in [RFC7077].  The format of\
    \ the\n   message is specified in Section 4.1 of [RFC7077].  This specification\n\
    \   does not modify the UPN message; however, it defines the following\n   new\
    \ notification reason value for use in this specification:\n   Notification Reason:\n\
    \      FLOW-MOBILITY (8).  Request to add/refresh the prefix(es) conveyed\n  \
    \    in the Home Network Prefix Options included in the message to the\n     \
    \ set of prefixes for which flow mobility is provided.\n   The Mobility Options\
    \ field of an FMI MUST contain the MN-ID, followed\n   by one or more Home Network\
    \ Prefix Options.  Prefixes for which flow\n   mobility was provided that are\
    \ not present in the message MUST be\n   removed from the set of flow mobility-enabled\
    \ prefixes.\n"
- title: 4.3.  Flow Mobility Acknowledgement (FMA)
  contents:
  - "4.3.  Flow Mobility Acknowledgement (FMA)\n   The FMA message used in this specification\
    \ is the UPA message\n   specified in Section 4.2 of [RFC7077].  The message format,\n\
    \   transport, and security considerations are as specified in [RFC7077].\n  \
    \ The format of the message is specified in Section 4.2 of [RFC7077].\n   This\
    \ specification does not modify the UPA message, however, it\n   defines the following\
    \ new status code values for use in this\n   specification:\n   Status Code:\n\
    \      0: Success\n      131: Reason unspecified\n      132: MN not attached\n\
    \   When the Status code is 0, the Mobility Options field of an FMA MUST\n   contain\
    \ the MN-ID, followed by one or more Home Network Prefix\n   Options.\n"
- title: 5.  Conceptual Data Structures
  contents:
  - "5.  Conceptual Data Structures\n   This section summarizes the extensions to\
    \ PMIPv6 that are necessary\n   to manage flow mobility.\n"
- title: 5.1.  Multiple Proxy Care-of Address Registration
  contents:
  - "5.1.  Multiple Proxy Care-of Address Registration\n   The binding cache structure\
    \ of the LMA is extended to allow multiple\n   proxy care-of address (Proxy-CoA)\
    \ registrations, and support the\n   mobile node using the same address (prefix)\
    \ beyond a single interface\n   and MAG.  The LMA maintains multiple BCEs for\
    \ an MN.  The number of\n   BCEs for an MN is equal to the number of the MN's\
    \ interfaces attached\n   to any MAGs.\n   This specification reuses the extensions\
    \ defined in [RFC5648] to\n   manage multiple registrations, but in the context\
    \ of PMIPv6.  The\n   binding cache is therefore extended to include more than\
    \ one proxy\n   care-of address and to associate each of them with a BID.  Note\
    \ that\n   the BID is a local identifier, assigned and used by the local\n   mobility\
    \ anchor to identify which entry of the FMC is used to decide\n   how to route\
    \ a given flow.\n            +---------+-----+-------+------+-----------+------------+\n\
    \            | BID-PRI | BID | MN-ID |  ATT |   HNP(s)  | Proxy-CoA  |\n     \
    \       +---------+-----+-------+------+-----------+------------+\n          \
    \  |    20   |  1  |  MN1  | WiFi | HNP1,HNP2 | IP1 (MAG1) |\n            |  \
    \  30   |  2  |  MN1  | 3GPP | HNP1,HNP3 | IP2 (MAG2) |\n            +---------+-----+-------+------+-----------+------------+\n\
    \                     Figure 6: Extended Binding Cache\n   Figure 6 shows an example\
    \ of an extended binding cache, containing\n   two BCEs of a mobile node MN1 attached\
    \ to the network using two\n   different access technologies.  Both of the attachments\
    \ share the\n   same prefix (HNP1), but they are bound to two different Proxy-CoAs\n\
    \   (two MAGs).\n"
- title: 5.2.  Flow Mobility Cache (FMC)
  contents:
  - "5.2.  Flow Mobility Cache (FMC)\n   Each LMA MUST maintain an FMC as shown in\
    \ Figure 7.  The FMC is a\n   conceptual list of entries that is separate from\
    \ the binding cache.\n   This conceptual list contains an entry for each of the\
    \ registered\n   flows.  This specification reuses the format of the flow-binding\
    \ list\n   defined in [RFC6089].  Each entry includes the following fields:\n\
    \   o  Flow Identifier Priority (FID-PRI)\n   o  Flow Identifier (FID)\n   o \
    \ Traffic Selector (TS)\n   o  Binding Identification (BID)\n   o  Action\n  \
    \ o  Active/Inactive\n               +---------+-----+-----+------+---------+----------+\n\
    \               | FID-PRI | FID | TS  | BIDs |  Action |   A/I    |\n        \
    \       +---------+-----+-----+------+---------+----------+\n               |\
    \   10    |  2  | TCP |  1   | Forward |  Active  |\n               |   20   \
    \ |  4  | UDP | 1,2  | Forward | Inactive |\n               +---------+-----+-----+------+---------+----------+\n\
    \                       Figure 7: Flow Mobility Cache\n   The BID field contains\
    \ the identifier of the BCE to which the packets\n   matching the flow information\
    \ described in the TS field will be\n   forwarded.  When it is decided that a\
    \ flow is to be moved, the\n   affected BID(s) of the table are updated.\n   Similar\
    \ to the flow binding described in [RFC6089], each entry of the\n   FMC points\
    \ to a specific BID.  When a flow is moved, the LMA simply\n   updates the pointer\
    \ of the flow-binding entry with the BID of the\n   interface to which the flow\
    \ will be moved.  The TS in the flow-\n   binding table is defined in [RFC6088].\
    \  TS is used to classify the\n   packets of flows based on specific parameters\
    \ such as service type,\n   source, and destination address, etc.  The packets\
    \ matching with the\n   same TS will be applied the same forwarding policy.  FID-PRI\
    \ is the\n   order of precedence to take action on the traffic.  The action may\
    \ be\n   to forward or drop.  If a binding entry becomes \"Inactive\", it does\n\
    \   not affect data traffic.  An entry becomes \"Inactive\" only if all of\n \
    \  the BIDs are de-registered.\n   The MAG MAY also maintain a similar data structure.\
    \  In case no full\n   flow mobility state is required at the MAG, the Binding\
    \ Update List\n   (BUL) data structure is enough: no extra conceptual data entries\
    \ are\n   needed.  If full per-flow state is required at the MAG, it SHOULD\n\
    \   also maintain an FMC structure.\n"
- title: 6.  Mobile Node Considerations
  contents:
  - "6.  Mobile Node Considerations\n   This specification assumes that the mobile\
    \ node IP-layer interface\n   can simultaneously and/or sequentially attach to\
    \ multiple MAGs,\n   possibly over multiple media.  The MN MUST be able to enforce\
    \ uplink\n   policies to select the right outgoing interface.  One alternative\
    \ to\n   achieve this multiple attachment is described in [RFC7847], which\n \
    \  allows the MN supporting traffic flows on different physical\n   interfaces,\
    \ regardless of the assigned prefixes on those physical\n   interfaces.  Another\
    \ alternative is configuring the IP stack of the\n   MN to behave according to\
    \ the weak host model [RFC1122].\n"
- title: 7.  IANA Considerations
  contents:
  - "7.  IANA Considerations\n   This specification establishes new assignments to\
    \ the IANA mobility\n   parameters registry:\n   o  Handoff Indicator Option type:\
    \ \"Attachment over a new interface\n      sharing prefixes\" has been assigned\
    \ the value 6 from the \"Handoff\n      Indicator Option type values\" registry\
    \ defined in\n      <http://www.iana.org/assignments/mobility-parameters>.\n \
    \  o  Update Notification Reason: \"FLOW-MOBILITY\" has been assigned the\n  \
    \    value 8 from the \"Update Notification Reasons Registry\" defined in\n  \
    \    <http://www.iana.org/assignments/mobility-parameters>.\n   o  Update Notification\
    \ Acknowledgement Status: \"Reason unspecified\"\n      has been assigned the\
    \ value 131 and \"MN not attached\" has been\n      assigned the value 132 from\
    \ the \"Update Notification\n      Acknowledgement Status Registry\".\n"
- title: 8.  Security Considerations
  contents:
  - "8.  Security Considerations\n   The protocol-signaling extensions defined in\
    \ this document share the\n   same security concerns of Proxy Mobile IPv6 [RFC5213]\
    \ and do not pose\n   any additional security threats to those already identified\
    \ in\n   [RFC5213] and [RFC7077].\n   The MAG and the LMA MUST use the IPsec security\
    \ mechanism mandated by\n   Proxy Mobile IPv6 [RFC5213] to secure the signaling\
    \ described in this\n   document.\n"
- title: 9.  References
  contents:
  - '9.  References

    '
- title: 9.1.  Normative References
  contents:
  - "9.1.  Normative References\n   [RFC2119]  Bradner, S., \"Key words for use in\
    \ RFCs to Indicate\n              Requirement Levels\", BCP 14, RFC 2119,\n  \
    \            DOI 10.17487/RFC2119, March 1997,\n              <http://www.rfc-editor.org/info/rfc2119>.\n\
    \   [RFC5213]  Gundavelli, S., Ed., Leung, K., Devarapalli, V.,\n            \
    \  Chowdhury, K., and B. Patil, \"Proxy Mobile IPv6\",\n              RFC 5213,\
    \ DOI 10.17487/RFC5213, August 2008,\n              <http://www.rfc-editor.org/info/rfc5213>.\n\
    \   [RFC5648]  Wakikawa, R., Ed., Devarapalli, V., Tsirtsis, G., Ernst,\n    \
    \          T., and K. Nagami, \"Multiple Care-of Addresses\n              Registration\"\
    , RFC 5648, DOI 10.17487/RFC5648, October\n              2009, <http://www.rfc-editor.org/info/rfc5648>.\n\
    \   [RFC6088]  Tsirtsis, G., Giarreta, G., Soliman, H., and N. Montavont,\n  \
    \            \"Traffic Selectors for Flow Bindings\", RFC 6088,\n            \
    \  DOI 10.17487/RFC6088, January 2011,\n              <http://www.rfc-editor.org/info/rfc6088>.\n\
    \   [RFC6089]  Tsirtsis, G., Soliman, H., Montavont, N., Giaretta, G.,\n     \
    \         and K. Kuladinithi, \"Flow Bindings in Mobile IPv6 and\n           \
    \   Network Mobility (NEMO) Basic Support\", RFC 6089,\n              DOI 10.17487/RFC6089,\
    \ January 2011,\n              <http://www.rfc-editor.org/info/rfc6089>.\n   [RFC7077]\
    \  Krishnan, S., Gundavelli, S., Liebsch, M., Yokota, H., and\n              J.\
    \ Korhonen, \"Update Notifications for Proxy Mobile IPv6\",\n              RFC\
    \ 7077, DOI 10.17487/RFC7077, November 2013,\n              <http://www.rfc-editor.org/info/rfc7077>.\n"
- title: 9.2.  Informative References
  contents:
  - "9.2.  Informative References\n   [RFC1122]  Braden, R., Ed., \"Requirements for\
    \ Internet Hosts -\n              Communication Layers\", STD 3, RFC 1122,\n \
    \             DOI 10.17487/RFC1122, October 1989,\n              <http://www.rfc-editor.org/info/rfc1122>.\n\
    \   [RFC7222]  Liebsch, M., Seite, P., Yokota, H., Korhonen, J., and S.\n    \
    \          Gundavelli, \"Quality-of-Service Option for Proxy Mobile\n        \
    \      IPv6\", RFC 7222, DOI 10.17487/RFC7222, May 2014,\n              <http://www.rfc-editor.org/info/rfc7222>.\n\
    \   [RFC7847]  Melia, T., Ed. and S. Gundavelli, Ed., \"Logical-Interface\n  \
    \            Support for IP Hosts with Multi-Access Support\", RFC 7847,\n   \
    \           DOI 10.17487/RFC7847, May 2016,\n              <http://www.rfc-editor.org/info/rfc7847>.\n"
- title: Acknowledgments
  contents:
  - "Acknowledgments\n   The authors would like to thank Vijay Devarapalli, Mohana\n\
    \   Dahamayanthi Jeyatharan, Kent Leung, Bruno Mongazon-Cazavet, Chan-Wah\n  \
    \ Ng, Behcet Sarikaya, and Tran Minh Trung for their valuable\n   contributions,\
    \ which helped generate this document.\n   The authors would also like to thank\
    \ Juan-Carlos Zuniga, Pierrick\n   Seite, and Julien Laganier for all the useful\
    \ discussions on this\n   topic.\n   Finally, the authors would like to thank\
    \ Marco Liebsch, Juan-Carlos\n   Zuniga, Dirk von Hugo, Fabio Giust, and Daniel\
    \ Corujo for their\n   reviews of this document.\n   The work of Carlos J. Bernardos\
    \ has been partially performed in the\n   framework of the H2020-ICT-2014-2 project\
    \ 5G NORMA.\n"
- title: Contributors
  contents:
  - "Contributors\n   This document reflects contributions from the following authors\
    \ (in\n   alphabetical order).\n   Kuntal Chowdhury\n   Email: kc@altiostar.com\n\
    \   Sri Gundavelli\n   Email: sgundave@cisco.com\n   Youn-Hee Han\n   Email: yhhan@kut.ac.kr\n\
    \   Yong-Geun Hong\n   Email: yonggeun.hong@gmail.com\n   Rajeev Koodli\n   Email:\
    \ rajeevkoodli@google.com\n   Telemaco Melia\n   Email: telemaco.melia@googlemail.com\n\
    \   Frank Xia\n   Email: xiayangsong@huawei.com\n"
- title: Author's Address
  contents:
  - "Author's Address\n   Carlos J. Bernardos (editor)\n   Universidad Carlos III\
    \ de Madrid\n   Av. Universidad, 30\n   Leganes, Madrid  28911\n   Spain\n   Phone:\
    \ +34 91624 6236\n   Email: cjbc@it.uc3m.es\n   URI:   http://www.it.uc3m.es/cjbc/\n"
