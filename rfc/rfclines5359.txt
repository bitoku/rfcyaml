Abstract This document gives examples of Session Initiation Protocol (SIP) services.
This covers most features offered in so called IP Centrex offerings from local exchange carriers and PBX (Private Branch Exchange) features.
Most of the services shown in this document are implemented in the SIP user agents, although some require the assistance of a SIP proxy.
Some require some extensions to SIP including the REFER, SUBSCRIBE, and NOTIFY methods and the Replaces and Join header fields.
These features are not intended to be an exhaustive set, but rather show implementations of common features likely to be implemented on SIP IP telephones in a business environment.
This document provides example call flows detailing a SIP implementation of the following traditional telephony services:
3 Way Conference Consultation Hold
Find Me Music on Hold
The call flows shown in this document were developed in the design of a SIP IP communications network.
They represent an example set of so called IP Centrex services or PBX services.
It is the hope of the authors that this document will be useful for SIP implementers, designers, and protocol researchers alike and will help further the goal of a standard implementation of RFC 3261
[RFC3261] and some of its extensions.
These flows represent carefully checked and working group reviewed scenarios of SIP service examples as a companion to the specifications.
These call flows are based on the current version 2.0 of SIP in RFC 3261
[RFC3261] with Session Description Protocol (SDP) usage described in RFC 3264 [RFC3264].
Other RFCs also form part of the SIP standard and are used and referenced in these call flows.
The SIP specification and the other referenced documents are definitive as far as protocol issues are concerned.
Also, these flows do not represent the only way to implement these services   other approaches such as 3pcc (Third Party Call Control)
[RFC3725] or Back to Back User Agents (B2BUAs)
This specification does not preclude these or other approaches for implementing such services.
The peer to peer design and principles of these service examples are described in the Multiparty Framework document [FRAMEWORK].
These flows assume the functionality described in the SIP Call Flow Examples document [RFC3665], which explores basic SIP behavior.
Some of the scenarios described herein make use of the SIP method extension REFER [RFC3515], the SIP header extension Replaces [RFC3891], and the SIP header extension Join [RFC3911].
The SIP Events document [RFC3265] describes the use of SUBSCRIBE and NOTIFY, while the SIP Dialog Event Package document [RFC4235] describes the dialog event package.
Some examples make use of the GRUU (Globally Routable User Agent URI) extension [GRUU].
These flows were prepared assuming a network of proxies, registrars, and other SIP servers.
The use of Secure SIP URIs (sips) is shown throughout this document, implying TLS transport on each hop with assumed certificate validation.
However, other security approaches can be used.
The use of Digest authentication is shown in some examples.
The emphasis in these call flows is the SIP signaling exchange.
As a result, only very simple SDP offer/answer exchanges are shown with audio media.
These flows apply equally well for other media and multimedia sessions.
For more advanced examples of SDP offer/answer exchanges, refer to [RFC4317].
Each call flow is presented with a textual description of the scenario, a message flow diagram showing the messages exchanged between separate network elements, and the detailed contents of each message shown in the diagram.
For simplicity in reading and editing the document, there are a number of differences between some of the examples and actual SIP messages.
For example, the HTTP Digest responses are not actual MD5 encodings.
Call IDs are often repeated, and CSeq counts often begin at 1.
Header fields are usually shown in the same order.
Usually only the minimum required header field set is shown.
These control messages can be SIP signaling.
Messages with parentheses around the name represent optional control messages.
Messages are identified in the figures as F1, F2, etc.
This references the message details in the table that follows the figure.
Lines longer than 72 characters are handled using the <allOneLine> convention defined in Section 2.1 of RFC 4475 [RFC4475].
In this scenario, Alice calls Bob, then Bob places the call on hold.
Bob then takes the call off hold, then Alice hangs up the call.
Note that hold is unidirectional in nature.
However, a UA that places the other party on hold will generally also stop sending media, resulting in no media exchange between the UAs.
Older UAs may set the connection address to 0.0.0.0 when initiating hold.
However, this behavior has been deprecated in favor or using the a inactive SDP attribute if no media is sent, or the a sendonly attribute if media is still sent.
Also note the use of the rendering feature tag defined in RFC 4235
[RFC4235] used in F10 and F11 to indicate that Bob's UA is no longer rendering media to Bob, i.e., that Bob has placed the call on hold.
Message Details F1 INVITE Alice   Proxy 1 INVITE
branch z9hG4bK74bf9 Max Forwards: 70
Call ID: 12345601@atlanta.example.com CSeq: 1 INVITE Contact: <sips:alice@client.atlanta.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 F2 INVITE Proxy 1
TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
Call ID: 12345601@atlanta.example.com CSeq: 1 INVITE Contact: <sips:alice@client.atlanta.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 F3 (100 Trying)
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
Call ID: 12345601@atlanta.example.com CSeq: 1 INVITE Content Length: 0 F4 180
/TLS ss1.example.com:5061 ;branch z9hG4bK83749.1 ;received 192.0.2.54
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
314159 Call ID: 12345601@atlanta.example.com CSeq: 1 INVITE Contact: <sips:bob@client.biloxi.example.com>
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
314159 Call ID: 12345601@atlanta.example.com CSeq: 1 INVITE Contact: <sips:bob@client.biloxi.example.com>
Content Length: 0 F6 200 OK Bob   Proxy 1
/TLS ss1.example.com:5061 ;branch z9hG4bK83749.1 ;received 192.0.2.54
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
314159 Call ID: 12345601@atlanta.example.com CSeq: 1 INVITE Contact:
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
IN IP4 client.biloxi.example.com s  c IN IP4 client.biloxi.example.com
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F7 200
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
314159 Call ID: 12345601@atlanta.example.com CSeq: 1 INVITE Contact:
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
IN IP4 client.biloxi.example.com s  c IN IP4 client.biloxi.example.com
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F8 ACK Alice   Proxy 1 ACK sips:bob@client.biloxi.example.com
314159 Call ID: 12345601@atlanta.example.com CSeq:
ACK Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
replaces Content Length: 0 F9 ACK Proxy 1   Bob ACK sips:bob@client.biloxi.example.com
TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf92 ;received 192.0.2.103 Max Forwards: 69 From:
314159 Call ID: 12345601@atlanta.example.com CSeq:
ACK Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
/  Bob places Alice on hold.
Note that the version is incremented in the o  field of the SDP.
/ F10 INVITE Bob   Proxy 1 INVITE sips:alice@client.atlanta.example.com
TLS client.biloxi.example.com:5061 ;branch z9hG4bKnashds7 Route:
alice@atlanta.example.com>;tag 1234567 Call ID: 12345601@atlanta.example.com CSeq: 1 INVITE Contact:
<sips:bob@client.biloxi.example.com>; sip.rendering "no" Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
IN IP4 client.biloxi.example.com s  c IN IP4 client.biloxi.example.com t 0
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 a sendonly F11 INVITE
Proxy 1   Alice INVITE sips:alice@client.atlanta.example.com
alice@atlanta.example.com>;tag 1234567 Call ID: 12345601@atlanta.example.com CSeq: 1 INVITE Contact:
<sips:bob@client.biloxi.example.com>; sip.rendering "no" Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
IN IP4 client.biloxi.example.com s  c IN IP4 client.biloxi.example.com t 0
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000
a sendonly /  Alice replies to hold.
/TLS ss1.example.com:5061 ;branch z9hG4bK83749.1 ;received 192.0.2.54
alice@atlanta.example.com>;tag 1234567 Call ID: 12345601@atlanta.example.com CSeq: 1 INVITE Contact: <sips:alice@client.atlanta.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000
alice@atlanta.example.com>;tag 1234567 Call ID: 12345601@atlanta.example.com CSeq: 1 INVITE Contact: <sips:alice@client.atlanta.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 a recvonly
F14 ACK Bob   Proxy 1 ACK sips:alice@client.atlanta.example.com
alice@atlanta.example.com>;tag 1234567 Call ID: 12345601@atlanta.example.com CSeq:
ACK Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
replaces Content Length: 0 F15 ACK Proxy 1   Alice ACK sips:alice@client.atlanta.example.com
;received 192.0.2.105 Max Forwards: 69 From: Bob
alice@atlanta.example.com>;tag 1234567 Call ID: 12345601@atlanta.example.com CSeq:
ACK Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
/  Bob takes the call off hold.
/ F16 INVITE Bob   Proxy 1 INVITE sips:alice@client.atlanta.example.com
alice@atlanta.example.com>;tag 1234567 Call ID: 12345601@atlanta.example.com CSeq: 2 INVITE Contact:
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
bob 2890844527 2890844529 IN IP4 client.biloxi.example.com s  c IN IP4 client.biloxi.example.com
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F17 INVITE Proxy 1
alice@atlanta.example.com>;tag 1234567 Call ID: 12345601@atlanta.example.com CSeq: 2 INVITE Contact:
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
bob 2890844527 2890844529 IN IP4 client.biloxi.example.com s  c IN IP4 client.biloxi.example.com
0 m audio 3456 RTP/AVP 0 a rtpmap:0
alice@atlanta.example.com>;tag 1234567 Call ID: 12345601@atlanta.example.com CSeq: 2 INVITE Contact: <sips:alice@client.atlanta.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
v 0 o alice 2890844526 2890844528 IN IP4 client.atlanta.example.com s
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 F19 200
alice@atlanta.example.com>;tag 1234567 Call ID: 12345601@atlanta.example.com CSeq: 2 INVITE Contact: <sips:alice@client.atlanta.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
v 0 o alice 2890844526 2890844528 IN IP4 client.atlanta.example.com s
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 F20 ACK Bob   Proxy 1 ACK sips:alice@client.atlanta.example.com
TLS client.biloxi.example.com:5061 ;branch z9hG4bKnashds74 Route:
alice@atlanta.example.com>;tag 1234567 Call ID: 12345601@atlanta.example.com CSeq: 2
ACK Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
replaces Content Length: 0 F21 ACK Proxy 1
TLS client.biloxi.example.com:5061 ;branch z9hG4bKnashds74 ;received 192.0.2.105 Max Forwards: 69 From: Bob
alice@atlanta.example.com>;tag 1234567 Call ID: 12345601@atlanta.example.com CSeq: 2
ACK Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
0 /  RTP Media stream re established.
Alice   Proxy 1 BYE sips:bob@client.biloxi.example.com
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf97 Route:
314159 Call ID: 12345601@atlanta.example.com CSeq: 2 BYE Content Length: 0
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf97 ;received 192.0.2.103 Max Forwards: 69 From:
314159 Call ID: 12345601@atlanta.example.com CSeq: 2 BYE Content Length:
/TLS ss1.example.com:5061 ;branch z9hG4bK837497.1 ;received 192.0.2.54
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf97 ;received 192.0.2.103 From:
314159 Call ID: 12345601@atlanta.example.com CSeq: 2 BYE Content Length: 0 F25 200 OK
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf97 ;received 192.0.2.103 From:
314159 Call ID: 12345601@atlanta.example.com CSeq: 2 BYE Content Length: 0 2.2.
In this scenario, Alice calls Bob.
Bob places call on hold.
Bob then disconnects with Carol, then takes the call with Alice off hold.
The call ends when Alice hangs up.
Also note the use of the rendering feature tag defined in RFC 4235
[RFC4235] used in F10 to indicate that Bob's UA is no longer rendering media to Bob, i.e., that Bob has placed the call on hold.
Message Details F1 INVITE Alice   Proxy 1 INVITE
branch z9hG4bK74bf9 Max Forwards: 70
Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:alice@client.atlanta.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 F2 INVITE Proxy 1
TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:alice@client.atlanta.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 F3 (100 Trying)
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
1 INVITE Content Length: 0 F4 180
/TLS ss1.example.com:5061 ;branch z9hG4bK83749.1 ;received 192.0.2.54
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
314159 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:bob@client.biloxi.example.com>
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
314159 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:bob@client.biloxi.example.com>
Content Length: 0 F6 200 OK Bob   Proxy 1
/TLS ss1.example.com:5061 ;branch z9hG4bK83749.1 ;received 192.0.2.54
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
314159 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact:
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
IN IP4 client.biloxi.example.com s  c IN IP4 client.biloxi.example.com
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F7 200
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
314159 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact:
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
IN IP4 client.biloxi.example.com s  c IN IP4 client.biloxi.example.com
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F8 ACK Alice   Proxy 1 ACK sips:bob@client.biloxi.example.com
314159 Call ID: 12345600@atlanta.example.com CSeq:
ACK Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
replaces Content Length: 0 F9 ACK Proxy 1   Bob ACK sips:bob@client.biloxi.example.com
TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf45 ;received 192.0.2.103 Max Forwards: 69 From:
314159 Call ID: 12345600@atlanta.example.com CSeq:
ACK Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
/  Bob places Alice on hold.
/ F10 INVITE Bob   Proxy 1 INVITE sips:alice@client.atlanta.example.com
TLS client.biloxi.example.com:5061 ;branch z9hG4bKnashds7 Route:
alice@atlanta.example.com>;tag 1234567 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact:
<sips:bob@client.biloxi.example.com>; sip.rendering "no" Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
IN IP4 client.biloxi.example.com s  c IN IP4 client.biloxi.example.com t 0
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 a sendonly F11 INVITE
Proxy 1   Alice INVITE sips:alice@client.atlanta.example.com
alice@atlanta.example.com>;tag 1234567 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact:
<sips:bob@client.biloxi.example.com>; sip.rendering "no" Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
IN IP4 client.biloxi.example.com s  c IN IP4 client.biloxi.example.com t 0
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 a sendonly F12 200
/TLS ss1.example.com:5061 ;branch z9hG4bK837497.1 ;received 192.0.2.54
alice@atlanta.example.com>;tag 1234567 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:alice@client.atlanta.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000
alice@atlanta.example.com>;tag 1234567 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:alice@client.atlanta.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 a recvonly
F14 ACK Bob   Proxy 1 ACK sips:alice@client.atlanta.example.com
TLS client.biloxi.example.com:5061 ;branch z9hG4bKnashdsg Route:
alice@atlanta.example.com>;tag 1234567 Call ID: 12345600@atlanta.example.com CSeq:
ACK Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
replaces Content Length: 0 F15 ACK Proxy 1   Alice ACK sips:alice@client.atlanta.example.com
TLS client.biloxi.example.com:5061 ;branch z9hG4bKnashdsg ;received 192.0.2.105 Max Forwards: 69 From: Bob
alice@atlanta.example.com>;tag 1234567 Call ID: 12345600@atlanta.example.com CSeq:
1 ACK Content Length: 0
F16 INVITE Bob   Proxy 1
branch z9hG4bKnashds22 Max Forwards: 70
> Call ID: 9876543210@biloxi.example.com CSeq: 1 INVITE Contact:
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
v 0 o bob 2890844834 2890844834
0 m audio 50170 RTP/AVP 0 a rtpmap:0 PCMU/8000 F17 INVITE Proxy 1
> Call ID: 9876543210@biloxi.example.com CSeq: 1 INVITE Contact:
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
v 0 o bob 2890844834 2890844834
0 m audio 50170 RTP/AVP 0 a rtpmap:0 PCMU/8000 F18 (100 Trying)
> Call ID: 9876543210@biloxi.example.com CSeq:
1 INVITE Content Length: 0
F19 180 Ringing Carol   Proxy 1
/TLS ss1.example.com:5061 ;branch z9hG4bK83749a.1 ;received 192.0.2.54
456654 Call ID: 9876543210@atlanta.example.com CSeq: 1 INVITE Contact: <sips:carol@client.chicago.example.com
> Content Length:0 F20 180 Ringing Proxy 1
456654 Call ID: 9876543210@biloxi.example.com CSeq: 1 INVITE Contact: <sips:carol@client.chicago.example.com> Content Length: 0
F21 200 OK Carol   Proxy 1
/TLS ss1.example.com:5061 ;branch z9hG4bK83749a.1 ;received 192.0.2.54
456654 Call ID: 9876543210@biloxi.example.com CSeq: 1 INVITE Contact: <sips:carol@client.chicago.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
IN IP4 client.chicago.example.com s  c IN IP4 client.chicago.example.com t 0
0 m audio 3456 RTP/AVP 0
456654 Call ID: 9876543210@biloxi.example.com CSeq: 1 INVITE Contact: <sips:carol@client.chicago.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
IN IP4 client.chicago.example.com s  c IN IP4 client.chicago.example.com t 0
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F23 ACK Bob   Proxy 1 ACK sips:carol@client.chicago.example.com
456654 Call ID: 9876543210@biloxi.example.com CSeq:
ACK Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
replaces Content Length: 0 F24 ACK Proxy 1
TLS client.biloxi.example.com:5061 ;branch z9hG4bKnashds24 ;received 192.0.2.105 Max Forwards: 69 From: Bob
456654 Call ID: 9876543210@biloxi.example.com CSeq:
ACK Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
replaces Content Length: 0 F25 BYE Bob   Proxy 1
branch z9hG4bKnashds7j Route: <sips:ss1.example.com;lr> Max Forwards: 70
456654 Call ID: 9876543210@biloxi.example.com CSeq:
2 BYE Content Length: 0
TLS client.biloxi.example.com:5061 ;branch z9hG4bKnashds7j ;received 192.0.2.105 Max Forwards: 69 From: Bob
456654 Call ID: 9876543210@biloxi.example.com CSeq:
2 BYE Content Length: 0
F27 200 OK Carol   Proxy 1
/TLS ss1.example.com:5061 ;branch z9hG4bK83749k.1 ;received 192.0.2.54
TLS client.biloxi.example.com:5061 ;branch z9hG4bKnashds7j ;received 192.0.2.105 From: Bob
456654 Call ID: 9876543210@biloxi.example.com CSeq:
2 BYE Content Length: 0 F28 200 OK
TLS client.biloxi.example.com:5061 ;branch z9hG4bKnashds7j ;received 192.0.2.105 From: Bob
456654 Call ID: 9876543210@biloxi.example.com CSeq:
2 BYE Content Length: 0
/  Bob takes the call off hold.
/ F29 INVITE Bob   Proxy 1 INVITE sips:alice@client.atlanta.example.com
TLS client.biloxi.example.com:5061 ;branch z9hG4bKnashds7b Route:
alice@atlanta.example.com>;tag 1234567 Call ID: 12345600@atlanta.example.com CSeq: 2 INVITE Contact: <sips:bob@client.biloxi.example.com>
bob 2890844527 2890844529 IN IP4 client.biloxi.example.com s  c IN IP4 client.biloxi.example.com
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F30 INVITE Proxy 1   Alice INVITE sips:alice@client.atlanta.example.com
TLS client.biloxi.example.com:5061 ;branch z9hG4bKnashds7b ;received 192.0.2.105 Record Route:
alice@atlanta.example.com>;tag 1234567 Call ID: 12345600@atlanta.example.com CSeq: 2 INVITE Contact:
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
bob 2890844527 2890844529 IN IP4 client.biloxi.example.com s  c IN IP4 client.biloxi.example.com
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F31 200
/TLS ss1.example.com:5061 ;branch z9hG4bK83749q.1 ;received 192.0.2.54
TLS client.biloxi.example.com:5061 ;branch z9hG4bKnashds7b ;received 192.0.2.105 Record Route:
alice@atlanta.example.com>;tag 1234567 Call ID: 12345600@atlanta.example.com CSeq: 2 INVITE Contact: <sips:alice@client.atlanta.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
v 0 o alice 2890844526 2890844528 IN IP4 client.atlanta.example.com s
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 F32 200
TLS client.biloxi.example.com:5061 ;branch z9hG4bKnashds7b ;received 192.0.2.105 Record Route:
alice@atlanta.example.com>;tag 1234567 Call ID: 12345600@atlanta.example.com CSeq: 2 INVITE Contact: <sips:alice@client.atlanta.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
v 0 o alice 2890844526 2890844528 IN IP4 client.atlanta.example.com s
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 F33 ACK Bob   Proxy 1 ACK sips:alice@client.atlanta.example.com
TLS client.biloxi.example.com:5061 ;branch z9hG4bKnashds7d7 Route:
alice@atlanta.example.com>;tag 1234567 Call ID: 12345600@atlanta.example.com CSeq:
ACK Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
replaces Content Length: 0 F34 ACK Proxy 1   Alice ACK sips:alice@client.atlanta.example.com
TLS client.biloxi.example.com:5061 ;branch z9hG4bKnashds7d7 ;received 192.0.2.105 Max Forwards: 69 From: Bob
alice@atlanta.example.com>;tag 1234567 Call ID: 12345600@atlanta.example.com CSeq:
ACK Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
replaces Content Length: 0 F35 BYE Alice   Proxy 1 BYE sips:bob@client.biloxi.example.com
TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf10 Route:
314159 Call ID: 12345600@atlanta.example.com CSeq:
2 BYE Content Length: 0 F36 BYE Proxy 1
TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf10 ;received 192.0.2.103 Max Forwards: 69 From:
314159 Call ID: 12345600@atlanta.example.com CSeq:
2 BYE Content Length: 0
OK Bob   Proxy 1 SIP/2.0 200
/TLS ss1.example.com:5061 ;branch z9hG4bK8379.1 ;received 192.0.2.54
TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf10 ;received 192.0.2.103 From:
314159 Call ID: 12345600@atlanta.example.com CSeq:
2 BYE Content Length: 0 F38 200
TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf10 ;received 192.0.2.103 From:
314159 Call ID: 12345600@atlanta.example.com CSeq:
2 BYE Content Length: 0 2.3.
The music on hold is complete
Bob takes Alice off hold
In this flow, Bob places Alice on hold with music.
This is performed by Bob sending a REFER to a Music Server that sends an INVITE with Replaces to Alice.
The Music Server then sends RTP music to Alice.
Bob picks the call up from hold by sending an INVITE with Replaces to Alice.
Note the use of the rendering feature tag defined in RFC 4235
[RFC4235] used in F5 to indicate that Bob's UA is no longer rendering media to Bob, i.e., that Bob has placed the call on hold.
Feature tags are also used in F12 with the automaton (defined in RFC 3840
[RFC3840]) and byeless feature tags (defined in RFC 4235 [RFC4235])
to describe the capabilities of the Music Server.
Should Alice not wish to receive music on hold, her UA could refuse F12 and she will remain on hold with Bob, but in silence.
branch z9hG4bK74bf9 Max Forwards: 70
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s  c IN IP4 client.atlanta.example.com
0 m audio 49170 RTP/AVP 0 a rtpmap:0
PCMU/8000 F2 180 Ringing Bob   Alice
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
23431 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:bob@client.biloxi.example.com>
Content Length: 0 F3 200 OK
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
23431 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact:
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
IN IP4 client.biloxi.example.com s  c IN IP4 client.biloxi.example.com
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F4 ACK Alice   Bob ACK sips:bob@client.biloxi.example.com
23431 Call ID: 12345600@atlanta.example.com CSeq:
ACK Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
/  Bob places Alice on hold.
To: Alice <sips:alice@atlanta.example.com>;tag 1234567 From:
23431 Call ID: 12345600@atlanta.example.com CSeq:
712 INVITE Contact: <sips:bob@client.biloxi.example.com>; sip.rendering "no" Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
IN IP4 client.biloxi.example.com s  c IN IP4 client.biloxi.example.com t 0
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 a sendonly F6 200
TLS client.biloxi.example.com:5061 ;branch z9hG4bK874bk ;received 192.0.2.105
To: Alice <sips:alice@atlanta.example.com>;tag 1234567 From:
23431 Call ID: 12345600@atlanta.example.com CSeq:
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
v 0 o alice 2890844526 2890844527 IN IP4 client.atlanta.example.com s  c IN IP4 client.atlanta.example.com
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 a recvonly F7
23431 Call ID: 12345600@atlanta.example.com CSeq:
ACK Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
replaces Content Length: 0 /  Bob REFERs Music Server to establish session with Alice which replaces the established session between Alice and Bob.
branch z9hG4bKnashds9 Max Forwards: 70
> Call ID: 4802029847@biloxi.example.com CSeq:
12345600%40atlanta.example.com%3Bfrom tag%3D23431 %3Bto tag%3D1234567&Require replaces> </allOneLine
Content Length: 0 F9 202 Accepted Music Server   Bob SIP/2.0 202
1 REFER Content Length: 0 F10 NOTIFY Music Server
Max Forwards: 70 From: Music Server <sips:music@server.example.com>;tag 56323
Call ID: 4802029847@biloxi.example.com CSeq: 1 NOTIFY Event: refer Subscription State: active;expires
/TLS server.example.com:5061 ;branch z9hG4bK74bT6 ;received 192.0.2.103
From: Music Server <sips:music@server.example.com>;tag 56323
1 NOTIFY Content Length: 0 /  Music Server places call to Alice to replace session between Alice and Bob.
/ F12 INVITE Music Server
> Call ID: a5 75 34
sip.byeless; sip.rendering "no" Require: replaces Replaces: 12345600@atlanta.example.com
;from tag 23431;to tag 1234567 Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE, NOTIFY
MusicServer 2890844576 2890844576 IN IP4
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000
/TLS server.example.com:5061 ;branch z9hG4bK74rf ;received 192.0.2.103 From:
Call ID: a5 75 34
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE, NOTIFY
v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s  c IN IP4 client.atlanta.example.com
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000
a recvonly F14 ACK Music Server
/TLS server.example.com:5061 ;branch z9hG4bK7rfF Max Forwards: 70 From: <sips:music@server.example.com>;tag 0111
Call ID: a5 75 34
1 ACK Content Length: 0 F15 BYE Alice   Bob BYE sips:bob@client.biloxi.example.com
branch z9hG4bKnashds7 Max Forwards: 70
23431 Call ID: 12345600@atlanta.example.com CSeq:
2 BYE Content Length: 0
/TLS client.atlanta.example.com:5061 ;branch z9hG4bKnashds7 ;received 192.0.2.105 From:
23431 Call ID: 12345600@atlanta.example.com CSeq:
0 /  Music Server reports success back to Bob by returning a 200 OK response.
Bob obtains the dialog identifiers from the headers included in the response.
/ F17 NOTIFY Music Server
Max Forwards: 70 From: Music Server <sips:music@server.example.com>;tag 56323
Call ID: 4802029847@biloxi.example.com CSeq: 2 NOTIFY Event: refer Subscription State: terminated;reason noresource Contact:
/TLS server.example.com:5061 ;branch z9hG4bK74rf ;received 192.0.2.103 From:
Call ID: a5 75 34
/TLS server.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103
From: Music Server <sips:music@server.example.com>;tag 56323
Call ID: 4802029847@biloxi.example.com CSeq: 2 NOTIFY Content Length: 0 /  Alice is now parked at the Music Server.
> Call ID: uioewrjk2k2were CSeq:
INVITE Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE,
NOTIFY Replaces: a5 75 34 12 76@server.example.com ;to tag 098594;from tag 0111
0 m audio 3458 RTP/AVP 0 a rtpmap:0 PCMU/8000
TLS client.biloxi.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.105 From: Bob
6654323 Call ID: uioewrjk2k2were CSeq:
INVITE Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE,
IN IP4 client.atlanta.example.com s  c IN IP4 client.atlanta.example.com t
0 0 m audio 49170 RTP/AVP 0
a rtpmap:0 PCMU/8000 a sendrecv F21 200
ACK Bob   Alice ACK sips:alice@client.atlanta.example.com
6654323 Call ID: uioewrjk2k2were CSeq:
ACK Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE, NOTIFY
replaces Content Length: 0 F22 BYE Alice
Call ID: a5 75 34
15 BYE Content Length: 0
F23 200 OK Music Server
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74rf ;received 192.0.2.103 To: <sips:music@server.example.com>;tag 0111
Call ID: a5 75 34
15 BYE Content Length: 0 /  Normal media session between Alice and Bob is resumed.
In this scenario, Bob calls Alice.
Alice then transfers Bob to Carol, then Alice disconnects with Bob.
Bob establishes the session to Carol
then reports the success back to Alice in the NOTIFY in F15.
If the transfer fails, Bob can send a new INVITE back to Alice to re  establish the session.
Despite the BYE sent by Alice in F9, the dialog between Alice and Bob still exists until the subscription created by the REFER has terminated (either due to a NOTIFY containing a Subscription State: terminated;reason noresource header field, as in F15, or a 481 response to a NOTIFY).
For more about call transfer, see the transfer document [TRANSFER].
TLS client.biloxi.example.com:5061 ;branch z9hG4bKnashds7 Max Forwards: 70
> Call ID: 12345601@atlanta.example.com CSeq: 1 INVITE Contact:
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
IN IP4 client.biloxi.example.com s  c IN IP4 client.biloxi.example.com
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F2 180 Ringing Alice
alice@atlanta.example.com>;tag 1234567 Call ID: 12345601@atlanta.example.com CSeq: 1 INVITE Contact: <sips:alice@client.atlanta.example.com
> Content Length: 0 F3 200
alice@atlanta.example.com>;tag 1234567 Call ID: 12345601@atlanta.example.com CSeq: 1 INVITE Contact: <sips:alice@client.atlanta.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 F4 ACK Bob   Alice ACK sips:alice@client.atlanta.example.com
branch z9hG4bKnashds2 Max Forwards: 70
alice@atlanta.example.com>;tag 1234567 Call ID: 12345601@atlanta.example.com CSeq:
ACK Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
0 /  Session is established between Alice and Bob.
Alice performs unattended transfer of Bob to Carol.
branch z9hG4bKnashds8 Max Forwards: 70
314159 Call ID: 12345601@atlanta.example.com CSeq:
> Content Length: 0 F6 202 Accepted
;received 192.0.2.105 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
314159 Call ID: 12345601@atlanta.example.com Contact: <sips:bob@client.biloxi.example.com
101 REFER Content Length: 0 F7 NOTIFY
alice@atlanta.example.com>;tag 1234567 Call ID: 12345601@atlanta.example.com CSeq: 2 NOTIFY Event: refer Subscription State: active;expires
alice@atlanta.example.com>;tag 1234567 Call ID: 12345601@atlanta.example.com CSeq: 2 NOTIFY Content Length: 0 /  Alice
branch z9hG4bKnashds43 Max Forwards: 70
314159 Call ID: 12345601@atlanta.example.com CSeq:
102 BYE Content Length: 0 F10 200 OK
;received 192.0.2.105 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
314159 Call ID: 12345601@atlanta.example.com CSeq:
102 BYE Content Length: 0 /  Bob attempts the transfer to Carol.
TLS client.biloxi.example.com:5061 ;branch z9hG4bKnashds1 Max Forwards: 70
> Call ID: 7436222@atlanta.example.com CSeq: 1 INVITE Contact:
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
v 0 o bob 2890844539 2890844539
0 m audio 3458 RTP/AVP 0
a rtpmap:0 PCMU/8000 F12 180 Ringing Carol
928287 Call ID: 7436222@atlanta.example.com CSeq: 1 INVITE Contact: <sips:carol@client.chicago.example.com> Content Length: 0
928287 Call ID: 7436222@atlanta.example.com CSeq: 1 INVITE Contact: <sips:carol@client.chicago.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
IN IP4 client.chicago.example.com s  c IN IP4 client.chicago.example.com t 0
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F14 ACK Bob   Carol
branch z9hG4bKnashds9 Max Forwards: 70
928287 Call ID: 7436222@atlanta.example.com CSeq:
1 ACK Content Length: 0 /  Bob and Carol now have established a session.
Bob reports success to Alice, which Alice probably ignores.
branch z9hG4bKnashds67 Max Forwards: 70
alice@atlanta.example.com>;tag 1234567 Call ID: 12345601@atlanta.example.com CSeq: 3 NOTIFY Event: refer Subscription State: terminated;reason noresource Contact: <sips:bob@client.biloxi.example.com
alice@atlanta.example.com>;tag 1234567 Call ID: 12345601@atlanta.example.com CSeq: 3 NOTIFY Content Length: 0 2.5.
In this scenario, Alice calls Bob.
Bob puts Alice on hold then calls Carol to announce transfer, then places Carol on hold.
Bob transfers Alice to Carol, which replaces the session between Bob and Carol.
Carol then disconnects session with Bob.
Alice reports success of transfer to Bob, who then disconnects with Alice.
In this example, the Replaces header field [RFC3891] is inserted into the Refer To URI by Bob.
Note that the Refer To URI is the Contact URI returned by Carol in the 200 OK response F10.
This ensures that only the correct instance of Carol is reached.
The presence of the gr URI parameter in the Contact URI in message F10 indicates that the Contact URI is a GRUU [GRUU] and will be globally routable outside of the dialog.
Without knowing the Contact URI is a gruu, Bob must be prepared, if the triggered INVITE had failed, to retry the REFER with a Refer To URI of the URI used to reach Carol but with a Require: replaces header escaped in the Refer To header field, as discussed in the transfer document [TRANSFER].
branch z9hG4bK74bf9 Max Forwards: 70
Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:alice@client.atlanta.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
0 m audio 49170 RTP/AVP 0 a rtpmap:0
PCMU/8000 F2 180 Ringing Bob   Alice
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
23431 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:bob@client.biloxi.example.com>
Content Length: 0 F3 200 OK
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
23431 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact:
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
IN IP4 client.biloxi.example.com s  c IN IP4 client.biloxi.example.com
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F4 ACK Alice   Bob ACK sips:bob@client.biloxi.example.com
23431 Call ID: 12345600@atlanta.example.com CSeq:
ACK Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
/  Alice and Bob have established a session.
Bob puts Alice on hold.
TLS client.biloxi.example.com:5061 ;branch z9hG4bKnashds7 Max Forwards: 70
alice@atlanta.example.com>;tag 1234567 Call ID: 12345600@atlanta.example.com CSeq:
<sips:bob@client.biloxi.example.com>; sip.rendering "no" Content Type: application/sdp
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
IN IP4 client.biloxi.example.com s  c IN IP4 client.biloxi.example.com t 0
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 a sendonly F6 200
alice@atlanta.example.com>;tag 1234567 Call ID: 12345600@atlanta.example.com CSeq:
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 a recvonly F7 ACK Bob   Alice ACK sips:alice@client.atlanta.example.com
TLS client.biloxi.example.com:5061 ;branch z9hG4bKnashds3 Max Forwards: 70 From: Bob
alice@atlanta.example.com>;tag 1234567 Call ID: 12345600@atlanta.example.com CSeq:
1024 ACK Content Length: 0 /  Bob calls Carol.
branch z9hG4bKnash Max Forwards: 70
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
0 m audio 3458 RTP/AVP 0 a rtpmap:0 PCMU/8000 F9 180 Ringing Carol
carol@chicago.example.com>;tag 5f35a3 Call ID: sdjfdjfskdf@biloxi.example.com
> Content Length: 0 F10 200 OK
carol@chicago.example.com>;tag 5f35a3 Call ID: sdjfdjfskdf@biloxi.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
v 0 o carol 2890844922 2890844922 IN IP4 client.chicago.example.com s  c IN IP4 client.chicago.example.com t
0 0 m audio 3456 RTP/AVP 0 a rtpmap:0
PCMU/8000 F11 ACK Bob   Carol ACK sips:39itp34klkd@chicago.example.com;gr
branch z9hG4bKnashd5 Max Forwards: 70
carol@chicago.example.com>;tag 5f35a3 Call ID: sdjfdjfskdf@biloxi.example.com CSeq:
42 ACK Content Length: 0 /  Bob puts Carol on hold.
branch z9hG4bKnashds0 Max Forwards: 70
carol@chicago.example.com>;tag 5f35a3 Call ID: sdjfdjfskdf@biloxi.example.com
<sips:bob@client.biloxi.example.com>; sip.rendering "no" Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
IN IP4 client.biloxi.example.com s  c IN IP4 client.biloxi.example.com
0 m audio 3458 RTP/AVP 0 a rtpmap:0 PCMU/8000
carol@chicago.example.com>;tag 5f35a3 Call ID: sdjfdjfskdf@biloxi.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
v 0 o carol 2890844922 2890844923 IN IP4 client.chicago.example.com s  c IN IP4 client.chicago.example.com t
0 0 m audio 3456 RTP/AVP 0
a recvonly F14 ACK Bob   Carol
branch z9hG4bKnash334 Max Forwards: 70
carol@chicago.example.com>;tag 5f35a3 Call ID: sdjfdjfskdf@biloxi.example.com CSeq:
43 ACK Content Length: 0
/  Bob transfers Alice to Carol.
branch z9hG4bKnashds2g Max Forwards: 70
alice@atlanta.example.com>;tag 1234567 Call ID: 12345600@atlanta.example.com CSeq:
sdjfdjfskdf%40biloxi.example.com%3Bto tag%3D5f35a3 %3Bfrom tag%3D8675309&Require replaces
/TLS client.biloxi.example.com:5061 ;branch z9hG4bKnashds2g ;received 192.0.2.113 From: Bob
alice@atlanta.example.com>;tag 1234567 Call ID: 12345600@atlanta.example.com Contact: <sips:alice@client.atlanta.example.com
1025 REFER Content Length: 0 F17 NOTIFY
branch z9hG4bK74bfK Max Forwards: 70
23431 Call ID: 12345600@atlanta.example.com CSeq:
> Event: refer Subscription State: active;expires
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bfK ;received 192.0.2.103 From:
23431 Call ID: 12345600@atlanta.example.com CSeq:
2 NOTIFY Content Length: 0 /  Alice establishes session with Carol, which replaces the session between Bob and Carol.
alice@atlanta.example.com>;tag 3461 Call ID: 9435674543@atlanta.example.com CSeq:
1 INVITE Require: replaces Referred By: <
to tag 5f35a3;from tag 8675309 Contact: <sips:alice@client.atlanta.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
v 0 o alice 2890844989 2890844989 IN IP4 client.atlanta.example.com s  c IN IP4 client.atlanta.example.com t 0
0 m audio 3458 RTP/AVP 0 a rtpmap:0 PCMU/8000 F20 200 OK Carol
/TLS chicago.example.com:5061 ;branch z9hG4bKadfe4ko ;received 192.0.2.103
From: Alice <sips:alice@atlanta.example.com>;tag 3461 Call ID: 9435674543@atlanta.example.com CSeq: 1 INVITE Contact:
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
v 0 o carol 2890844221 2890844221
IN IP4 client.chicago.example.com s  c IN IP4 client.chicago.example.com t 0
0 m audio 49172 RTP/AVP 0
a rtpmap:0 PCMU/8000 F21 ACK Alice   Carol
sips:39itp34klkd@chicago.example.com>;tag ff3a Max Forwards: 70
alice@atlanta.example.com>;tag 3461 Call ID: 9435674543@atlanta.example.com CSeq:
ACK Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
replaces Content Length: 0 /  Carol then disconnects from Bob.
From: Carol <sips:carol@chicago.example.com>;tag 5f35a3 Call ID: sdjfdjfskdf@biloxi.example.com CSeq: 1 BYE Content Length: 0 F23 200
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bfE ;received 192.0.2.123
1 BYE Content Length: 0 /
Alice tells Bob that the call has been successfully transferred.
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf2N Max Forwards: 70 From:
23431 Call ID: 12345600@atlanta.example.com CSeq: 3 NOTIFY Event: refer Subscription State: terminated;reason noresource Contact: <sips:alice@client.atlanta.example.com>
/TLS chicago.example.com:5061 ;branch z9hG4bKadfe4ko ;received 192.0.2.103
From: Alice <sips:alice@atlanta.example.com>;tag 3461 Call ID: 9435674543@atlanta.example.com CSeq: 1 INVITE Contact:
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
23431 Call ID: 12345600@atlanta.example.com CSeq:
3 NOTIFY Content Length: 0 /  Bob disconnects with Alice.
F26 BYE Bob   Alice BYE sips:alice@client.atlanta.example.com
branch z9hG4bKnashds7P Max Forwards: 70
alice@atlanta.example.com>;tag 1234567 Call ID: 12345600@atlanta.example.com CSeq:
1026 BYE Content Length: 0 F27 200 OK
alice@atlanta.example.com>;tag 1234567 Call ID: 12345600@atlanta.example.com CSeq:
1026 BYE Content Length: 0 2.6.
In this scenario, Alice and Bob establish a session between them.
Bob wants Carol to take the call and so sends an Instant Message (IM) to Carol containing Alice's URI and an embedded Replaces header field.
If Carol clicks on the URI, Carol's SIP UA sends an INVITE to Alice, which replaces the session with Bob.
This scenario shows the use of the SIP MESSAGE [RFC3428] method to pass the URI.
However, another IM protocol or other method could have been used to pass the URI from Bob to Carol.
branch z9hG4bK74bf9 Max Forwards: 70
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s  c IN IP4 client.atlanta.example.com
0 m audio 49170 RTP/AVP 0 a rtpmap:0
PCMU/8000 F2 180 Ringing Bob   Alice
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
3145678 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:bob@client.biloxi.example.com>
Content Length: 0 F3 200 OK
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
3145678 Call ID: 12345600@atlanta.example.com Contact: <sips:bob@client.biloxi.example.com
INVITE Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY,
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F4 ACK Alice   Bob ACK sips:bob@client.biloxi.example.com
branch z9hG4bK74r Max Forwards: 70 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
replaces CSeq: 1 ACK Content Length: 0 /  Bob IMs Carol.
branch z9hG4bKnash Max Forwards: 70
42 MESSAGE Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY,
Do you want to take this call from <allOneLine
12345600@atlanta.example.com%3Bto tag%3D3145678 %3Bfrom tag%3D1234567&Require replaces">
carol@chicago.example.com>;tag 5f35a3 Call ID: sdjfdjfskdf@biloxi.example.com CSeq: 42 MESSAGE Contact: <sips:carol@client.chicago.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY,
0 /  Carol takes the call from Bob.
branch z9hG4bK74HH Max Forwards: 70
> Call ID: 563456212@b2.chicago.example.com CSeq:
1 INVITE Require: replaces Replaces: 12345600@atlanta.example.com ;to tag 3145678;from tag 1234567 Contact: <sips:carol@client.chicago.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY,
o carol 2890843122 2890843122 IN IP4 client.chicago.example.com s
0 m audio 5342 RTP/AVP 0 a rtpmap:0 PCMU/8000 /  Alice matches the dialog information in the Replaces header and accepts the INVITE.
SIP/2.0/TLS pc.biloxi.example.com:5061 ;branch z9hG4bK74HH ;received 192.0.2.114 From: Carol <sips:carol@chicago.example.com>;tag 8675310
a8342043f@atlanta.example.com;gr>;tag 131256 Call ID: 563456212@b2.chicago.example.com CSeq:
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
v 0 o alice 289084543 289084543 IN IP4 client.atlanta.example.com s  c IN IP4 client.atlanta.example.com
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 F9 ACK  Carol
/TLS b2.biloxi.example.com:5061 ;branch z9hG4bK7435 Max Forwards: 70 From: Carol <sips:carol@chicago.example.com>;tag 8675310
a8342043f@atlanta.example.com;gr>;tag 131256 Call ID: 563456212@b2.chicago.example.com CSeq:
1 ACK Content Length: 0
/  RTP streams are established between Alice and Carol.
Alice hangs up with Bob due to the Replaces header field.
3145678 Call ID: 12345600@atlanta.example.com CSeq:
2 BYE Content Length: 0
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf ;received 192.0.2.103 From:
3145678 Call ID: 12345600@atlanta.example.com CSeq:  2 BYE Content Length: 0 2.7.
(181 Call Is Being Forwarded)
The proxy server rewrites the Request URI, and forwards the INVITE to a Gateway.
Details of messaging behind the Gateway are not shown.
Note that the 181 Call is Being Forwarded response is shown as sent by the proxy.
Strictly speaking, the proxy is behaving as a user agent in this case as a proxy cannot generate non 100 provisional responses.
Note also that forwarding could be accomplished using a redirect (302
Message Details F1 INVITE Alice   Proxy INVITE
branch z9hG4bK74bf9 Max Forwards: 70
Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:alice@client.atlanta.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY Content Type:
v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s  c IN IP4 client.atlanta.example.com
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 F2 (100 Trying)
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
1 INVITE Content Length: 0 F3 (181 Call is Being Forwarded)
181 Call is Being Forwarded
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
1 INVITE Content Length: 0 /  Proxy forwards call by rewriting Request URI.
/ F4 INVITE Proxy   Gateway INVITE sips:
TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:alice@client.atlanta.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY Content Type:
v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s  c IN IP4 client.atlanta.example.com
0 m audio 49170 RTP/AVP 0
a rtpmap:0 PCMU/8000 F5 180 Ringing Gateway   Proxy
/TLS ss1.example.com:5061 ;branch z9hG4bK83749.1 ;received 192.0.2.54
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
314159 Call ID: 12345600@atlanta.example.com CSeq:
19727293660@gw1.example.com;user phone> Content Length:0 F6 180
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
314159 Call ID: 12345600@atlanta.example.com CSeq:
19727293660@gw1.example.com;user phone> Content Length: 0 F7 200 OK
/TLS ss1.example.com:5061 ;branch z9hG4bK83749.1 ;received 192.0.2.54
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
314159 Call ID: 12345600@atlanta.example.com CSeq:
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY Content Type:
IN IP4 gatewayone.example.com s  c IN IP4 gatewayone.example.com t
0 0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F8 200
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
314159 Call ID: 12345600@atlanta.example.com CSeq:
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY Content Type:
IN IP4 gatewayone.example.com s  c IN IP4 gatewayone.example.com t
0 0 m audio 3456 RTP/AVP 0
a rtpmap:0 PCMU/8000 F9 ACK Alice   Proxy ACK sips: 19727293660@gw1.example.com;user phone
314159 Call ID: 12345600@atlanta.example.com CSeq:
1 ACK Content Length: 0
Gateway ACK sips: 19727293660@gw1.example.com;user phone
z9hG4bK74bf31 ;received 192.0.2.103 Max Forwards: 69 From:
314159 Call ID: 12345600@atlanta.example.com CSeq:
1 ACK Content Length: 0 F11 BYE Alice   Proxy BYE sips: 19727293660@gw1.example.com;user phone
TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bfJe Route:
314159 Call ID: 12345600@atlanta.example.com CSeq:
2 BYE Content Length: 0
F12 BYE Proxy   Gateway BYE sips:
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bfJe ;received 192.0.2.103 Max Forwards: 69 From:
314159 Call ID: 12345600@atlanta.example.com CSeq:
2 BYE Content Length: 0
F13 200 OK Gateway   Proxy
/TLS ss1.example.com:5061 ;branch z9hG4bK83749G1 ;received 192.0.2.54
TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bfJe ;received 192.0.2.103 From:
314159 Call ID: 12345600@atlanta.example.com CSeq:
2 BYE Content Length: 0 F14 200 OK Proxy
TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bfJe ;received 192.0.2.103 From:
314159 Call ID: 12345600@atlanta.example.com CSeq:  2 BYE Content Length: 0 2.8.
(181 Call is Being Forwarded
Bob wants calls to B1 forwarded to B2 if B1 is busy (this information is known to the proxy).
Alice calls B1, B1 is busy, the proxy server places call to B2.
Message Details F1 INVITE Alice   Proxy INVITE
branch z9hG4bK74bf9 Max Forwards: 70
Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:alice@client.atlanta.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY Content Type:
v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s  c IN IP4 client.atlanta.example.com
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 F2 INVITE Proxy   B1 INVITE sips:bob@client.biloxi.example.com
TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:alice@client.atlanta.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY Content Type:
v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s  c IN IP4 client.atlanta.example.com
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 F3 (100 Trying)
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
1 INVITE Content Length: 0 F4 486 Busy
/TLS ss1.example.com:5061 ;branch z9hG4bK83749.1 ;received 192.0.2.54
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
765432 Call ID: 12345600@atlanta.example.com CSeq:
1 INVITE Content Length: 0 F5 ACK Proxy   B1 ACK sips:bob@client.biloxi.example.com
765432 Call ID: 12345600@atlanta.example.com CSeq:
1 ACK Content Length: 0 F6 (
181 Call is Being Forwarded)
181 Call is Being Forwarded
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
1 INVITE Content Length: 0
The proxy now forwards the call to B2.
/ F7 INVITE Proxy   B2 INVITE
TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:alice@client.atlanta.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY Content Type:
v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s  c IN IP4 client.atlanta.example.com
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 F8 180 Ringing B2
/TLS ss1.example.com:5061 ;branch z9hG4bK83749.2 ;received 192.0.2.54
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
7654321 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact:
Content Length: 0 F9 180 Ringing Proxy   Alice
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
7654321 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact:
Content Length: 0 F10 200 OK B2   Proxy
/TLS ss1.example.com:5061 ;branch z9hG4bK83749.2 ;received 192.0.2.54
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
7654321 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact:
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY Content Type:
0 m audio 3456 RTP/AVP 0
a rtpmap:0 PCMU/8000 F11 200
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
7654321 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact:
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY Content Type:
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F12 ACK Alice   Proxy ACK
7654321 Call ID: 12345600@atlanta.example.com CSeq:
1 ACK Content Length: 0
F13 ACK Proxy   B2 ACK
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bfX ;received 192.0.2.103 Max Forwards: 69 From:
7654321 Call ID: 12345600@atlanta.example.com CSeq:
1 ACK Content Length: 0
/  RTP streams are established between Alice and B2.
/ F14 BYE Alice   Proxy BYE
branch z9hG4bK74bW4 Route: <sips:ss1.example.com;lr> Max Forwards: 70
7654321 Call ID: 12345600@atlanta.example.com CSeq:
2 BYE Content Length: 0
F15 BYE Proxy   B2 BYE
TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bW4 ;received 192.0.2.103 Max Forwards: 69 From:
7654321 Call ID: 12345600@atlanta.example.com CSeq:
2 BYE Content Length: 0 F16 200 OK B2   Proxy SIP/2.0
/TLS ss1.example.com:5061 ;branch z9hG4bK837493 ;received 192.0.2.54
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bW4 ;received 192.0.2.103 From:
7654321 Call ID: 12345600@atlanta.example.com CSeq:
2 BYE Content Length: 0 F17 200 OK
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bW4 ;received 192.0.2.103 From:
7654321 Call ID: 12345600@atlanta.example.com CSeq:
2 BYE Content Length: 0 2.9.
(181 Call is Being Forwarded)
Bob wants calls to B1 forwarded to B2 if B1 is not answered (information is known to the proxy server).
Alice calls B1 and no one answers.
The proxy server then places the call to B2.
Message Details F1 INVITE Alice   Proxy INVITE
branch z9hG4bK74bf9 Max Forwards: 70
Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:alice@client.atlanta.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY Content Type:
v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s  c IN IP4 client.atlanta.example.com
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 F2 INVITE Proxy   B1 INVITE sips:bob@client.biloxi.example.com
TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:alice@client.atlanta.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY Content Type:
v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s  c IN IP4 client.atlanta.example.com
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 F3 (100 Trying)
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
1 INVITE Content Length: 0 F4 180 Ringing B1
/TLS ss1.example.com:5061 ;branch z9hG4bK83749.1 ;received 192.0.2.54
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
3145678 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:bob@client.biloxi.example.com>
Content Length: 0 F5 180
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
3145678 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:bob@client.biloxi.example.com>
Content Length: 0 /  B1 rings until a configurable timer expires in the proxy.
The proxy sends Cancel and proceeds down the list of routes.
1 CANCEL Content Length: 0 F7 200 OK B1
/TLS ss1.example.com:5061 ;branch z9hG4bK83749.1 ;received 192.0.2.54 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
1 CANCEL Content Length: 0 F8 487 Request Terminated B1
/TLS ss1.example.com:5061 ;branch z9hG4bK83749.1 ;received 192.0.2.54
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
3145678 Call ID: 12345600@atlanta.example.com CSeq:
1 INVITE Content Length: 0 F9
3145678 Call ID: 12345600@atlanta.example.com CSeq:
1 ACK Content Length: 0 F10 (181 Call is Being Forwarded)
181 Call is Being Forwarded
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
1 INVITE Content Length: 0
TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:alice@client.atlanta.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY Content Type:
v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s  c IN IP4 client.atlanta.example.com
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 F12 180 Ringing B2
/TLS ss1.example.com:5061 ;branch z9hG4bK83749.2 ;received 192.0.2.54
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
765432 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact:
Content Length: 0 F13 180
Proxy   Alice SIP/2.0 180 Ringing
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
765432 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact:
Content Length: 0 F14 200 OK B2   Proxy
/TLS ss1.example.com:5061 ;branch z9hG4bK83749.2 ;received 192.0.2.54
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
765432 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact:
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY Content Type:
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F15 200 OK
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
765432 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact:
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY Content Type:
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F16 ACK Alice   Proxy ACK
765432 Call ID: 12345600@atlanta.example.com CSeq:
1 ACK Content Length: 0
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf3 ;received 192.0.2.103 Max Forwards: 69 From:
765432 Call ID: 12345600@atlanta.example.com CSeq:
1 ACK Content Length: 0
/  RTP streams are established between Alice and B2.
Alice hangs up with User B2.
/ F18 BYE Alice   Proxy BYE
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74b3f Route:
765432 Call ID: 12345600@atlanta.example.com CSeq:
2 BYE Content Length: 0
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74b3f ;received 192.0.2.103 Max Forwards: 69 From:
765432 Call ID: 12345600@atlanta.example.com CSeq:
2 BYE Content Length: 0 F20 200 OK B2   Proxy SIP/2.0
/TLS ss1.example.com:5061 ;branch z9hG4bK837.1 ;received 192.0.2.54
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74b3f ;received 192.0.2.103 From:
765432 Call ID: 12345600@atlanta.example.com CSeq:
2 BYE Content Length: 0
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74b3f ;received 192.0.2.103 From:
765432 Call ID: 12345600@atlanta.example.com CSeq:
2 BYE Content Length: 0 2.10.
3 Way Conference Third Party Is Added Alice
In this scenario, Alice and Bob are in a 2 party call (session) when Bob wishes to add Carol into the conversation.
Bob is capable of media mixing in a 3 party call.
Bob first sends a re INVITE to Alice, changing Contact URIs to one that indicates Bob's mixer and acts like a focus.
As a result, Bob includes the "isfocus" feature tag [RFC3840] as described in [RFC4579].
Bob then INVITEs Carol using the same Contact URI.
Note that Bob could wait to re INVITE Alice until after Carol has answered.
Bob could also put Alice on hold before calling Carol.
branch z9hG4bK74bf9 Max Forwards: 70
Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:alice@client.atlanta.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
0 m audio 49170 RTP/AVP 0 a rtpmap:0
PCMU/8000 F2 180 Ringing Bob   Alice
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
23431 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact:
> Content Length: 0 F3 200 OK
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
23431 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact:
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
IN IP4 client.biloxi.example.com s  c IN IP4 client.biloxi.example.com
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F4 ACK Alice
branch z9hG4bK74bfL Max Forwards: 70
23431 Call ID: 12345600@atlanta.example.com CSeq:
1 ACK Content Length: 0
/  Alice and Bob have established a session.
branch z9hG4bKnashds Max Forwards: 70
alice@atlanta.example.com>;tag 1234567 Call ID: 12345600@atlanta.example.com CSeq:
<sips:bob Mixer@client.biloxi.example.com>;isfocus Content Type: application/sdp
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
IN IP4 client.biloxi.example.com s  c IN IP4 client.biloxi.example.com t 0
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 F6 200
alice@atlanta.example.com>;tag 1234567 Call ID: 12345600@atlanta.example.com CSeq:
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 F7 ACK Bob   Alice ACK sips:alice@client.atlanta.example.com
branch z9hG4bKnash3G Max Forwards: 70
alice@atlanta.example.com>;tag 1234567 Call ID: 12345600@atlanta.example.com CSeq:
1024 ACK Content Length: 0 /  Bob calls Carol.
Mixer@client.biloxi.example.com>;isfocus Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
0 m audio 48174 RTP/AVP 0 a rtpmap:0 PCMU/8000 F9 180 Ringing Carol
TLS client.biloxi.example.com:5061 ;branch z9hG4bKnashJfd ;received 192.0.2.113 From: Bob
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
replaces Content Length: 0 F10 200 OK
TLS client.biloxi.example.com:5061 ;branch z9hG4bKnashJfd ;received 192.0.2.113 From: Bob
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
IN IP4 client.chicago.example.com s  c IN IP4 client.chicago.example.com t 0
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F11 ACK Bob   Carol ACK sips:carol@client.chicago.example.com
branch z9hG4bKnash431 Max Forwards: 70
42 ACK Content Length: 0 /  Bob's mixer now mixes media from both Alice and Carol to create the 3 way conference.
3 Way Conference Third Party Joins Alice
In this scenario, Alice and Bob are in a 2 party call and Carol wishes to join, resulting in a 3 party call.
Carol could have learned Bob's dialog identifier using some non SIP means, or possibly from a NOTIFY with the dialog package sent by Bob.
Carol sends an INVITE to Bob containing a Join header identifying the dialog between Alice and Bob.
INVITEs Alice to switch to focus mode and includes the "isfocus" feature tag [RFC3840] as described in [RFC4579].
Bob then accepts the INVITE from Carol, resulting in the 3 way call.
branch z9hG4bK74bf9 Max Forwards: 70
Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:alice@client.atlanta.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
0 m audio 49170 RTP/AVP 0 a rtpmap:0
PCMU/8000 F2 180 Ringing Bob   Alice
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
23431 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact:
> Content Length: 0 F3 200 OK
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
23431 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact:
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
IN IP4 client.biloxi.example.com s  c IN IP4 client.biloxi.example.com
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F4 ACK Alice
branch z9hG4bK74bf6 Max Forwards: 70
23431 Call ID: 12345600@atlanta.example.com CSeq:
1 ACK Content Length: 0
/  Alice and Bob have established a session.
Carol requests to join the session.
/TLS chicago.example.com:5061 ;branch z9hG4bKnashds7 Max Forwards: 70 From: Carol <sips:carol@chicago.example.com>;tag 8675309
Call ID: 452k499sk@chicago.example.com CSeq: 99 INVITE Contact: <sips:carol@client.chicago.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
12345600@atlanta.example.com;from tag 1234567;to tag 23431
IN IP4 client.chicago.example.com s  c IN IP4 client.chicago.example.com t 0
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F6
0982 Call ID: 452k499sk@chicago.example.com CSeq: 99 INVITE Contact:
Mixer@client.biloxi.example.com>;isfocus Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
replaces Content Length: 0 F7 INVITE Bob   Alice INVITE sips:alice@client.atlanta.example.com
branch z9hG4bKnashdyKL Max Forwards: 70
alice@atlanta.example.com>;tag 1234567 Call ID: 12345600@atlanta.example.com CSeq:
<sips:bob Mixer@client.biloxi.example.com>;isfocus Content Type: application/sdp
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
IN IP4 client.biloxi.example.com s  c IN IP4 client.biloxi.example.com t 0
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 F8 200
TLS client.biloxi.example.com:5061 ;branch z9hG4bKnashdyKL ;received 192.0.2.113 From: Bob
alice@atlanta.example.com>;tag 1234567 Call ID: 12345600@atlanta.example.com CSeq:
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 F9 ACK Bob   Alice ACK sips:alice@client.atlanta.example.com
branch z9hG4bKnash3g Max Forwards: 70
alice@atlanta.example.com>;tag 1234567 Call ID: 12345600@atlanta.example.com CSeq:
1024 ACK Content Length: 0 F10 200 OK
0982 Call ID: 452k499sk@chicago.example.com CSeq: 99 INVITE Contact:
Mixer@client.biloxi.example.com>;isfocus Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
0 m audio 48174 RTP/AVP 0 a rtpmap:0 PCMU/8000 F11 ACK OK Carol
/TLS chicago.example.com:5061 ;branch z9hG4bKnash4Gf Max Forwards: 70 From:
0982 Call ID: 452k499sk@chicago.example.com CSeq:
99 ACK Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
replaces, join Content Length:0 2.12.
Alice's call to Bob will result in an attempt to locate Bob by calling locations from a list of contacts.
The location to answer the call becomes the active set; no other sets may join the call.
While this flow shows a sequential search, the search could be accomplished using parallel forking.
Message Details F1 INVITE Alice   Proxy INVITE
branch z9hG4bK74bf9 Max Forwards: 70
Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:alice@client.atlanta.example.com
v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s  c IN IP4 client.atlanta.example.com
m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 F2 INVITE Proxy   B1 INVITE sips:bob@client.biloxi.example.com
TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:alice@client.atlanta.example.com
v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s  c IN IP4 client.atlanta.example.com
m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 F3 (100 Trying)
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
1 INVITE Content Length: 0 F4 180 Ringing B1
/TLS ss1.example.com:5061 ;branch z9hG4bK83749.1 ;received 192.0.2.54
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
765432 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:bob@client.biloxi.example.com>
Content Length: 0 F5 180
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
765432 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:bob@client.biloxi.example.com>
Content Length: 0 /  B1 rings until a configurable timer in the proxy expires.
The proxy then sends Cancel and proceeds down the list of routes.
1 CANCEL Content Length: 0 F7 200 OK B1
/TLS ss1.example.com:5061 ;branch z9hG4bK83749.1 ;received 192.0.2.54 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
765432 Call ID: 12345600@atlanta.example.com CSeq:
1 CANCEL Content Length: 0 F8 487 Request Terminated B1
/TLS ss1.example.com:5061 ;branch z9hG4bK83749.1 ;received 192.0.2.54
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
765432 Call ID: 12345600@atlanta.example.com CSeq:
1 INVITE Content Length: 0 F9
765432 Call ID: 12345600@atlanta.example.com CSeq:
1 ACK Content Length: 0
TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:alice@client.atlanta.example.com
v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s  c IN IP4 client.atlanta.example.com
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 F11 480
In Via: SIP/2.0/TLS ss1.example.com:5061 ;branch z9hG4bK83749.2
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
314756 Call ID: 12345600@atlanta.example.com CSeq:
1 INVITE Content Length: 0
314756 Call ID: 12345600@atlanta.example.com CSeq:
1 ACK Content Length: 0
TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:alice@client.atlanta.example.com
v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s  c IN IP4 client.atlanta.example.com
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 F14 486 Busy
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
7654321 Call ID: 12345600@atlanta.example.com CSeq:
1 INVITE Content Length: 0
F15 ACK Proxy   B3 ACK
7654321 Call ID: 12345600@atlanta.example.com CSeq:
1 ACK Content Length: 0
TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:alice@client.atlanta.example.com
v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s  c IN IP4 client.atlanta.example.com
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 F17 180 Ringing B4   Proxy SIP/2.0 180 Ringing
/TLS ss1.example.com:5061 ;branch z9hG4bK83749.4 ;received 192.0.2.54
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
7137136 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact:
> Content Length: 0 F18 180
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
7137136 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact:
> Content Length: 0 F19 200 OK B4   Proxy SIP/2.0
/TLS ss1.example.com:5061 ;branch z9hG4bK83749.4 ;received 192.0.2.54
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
7137136 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact:
IN IP4 client4.biloxi.example.com s  c IN IP4 client4.biloxi.example.com
0 m audio 3456 RTP/AVP 0
a rtpmap:0 PCMU/8000 F20 200
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 Record Route:
7137136 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact:
IN IP4 client4.biloxi.example.com s  c IN IP4 client4.biloxi.example.com
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F21 ACK Alice   Proxy ACK
7137136 Call ID: 12345600@atlanta.example.com CSeq:
1 ACK Content Length: 0
F22 ACK Proxy   B4 ACK
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf ;received 192.0.2.103 Max Forwards: 69 From:
7137136 Call ID: 12345600@atlanta.example.com CSeq:
1 ACK Content Length: 0
/  RTP streams are established between Alice and B4.
/ F23 BYE B4   Proxy BYE sips:alice@client.atlanta.example.com
TLS client4.biloxi.example.com:5061 ;branch z9hG4bKnashds7 Route: <sips:ss1.example.com;lr>
alice@atlanta.example.com>;tag 1234567 Call ID: 12345600@atlanta.example.com CSeq:
1 BYE Content Length: 0
F24 BYE Proxy   Alice BYE sips:alice@client.atlanta.example.com
;branch z9hG4bKnashds7 ;received 192.0.2.105 Max Forwards: 69 From: Bob
alice@atlanta.example.com>;tag 1234567 Call ID: 12345600@atlanta.example.com CSeq:
1 BYE Content Length: 0 F25 200 OK
TLS client4.biloxi.example.com:5061 ;branch z9hG4bKnashds7 ;received 192.0.2.105 From: Bob
alice@atlanta.example.com>;tag 1234567 Call ID: 12345600@atlanta.example.com CSeq:
1 BYE Content Length: 0 F26 200 OK Proxy   B4
TLS client4.biloxi.example.com:5061 ;branch z9hG4bKnashds7 ;received 192.0.2.105 From: Bob
alice@atlanta.example.com>;tag 1234567 Call ID: 12345600@atlanta.example.com CSeq:
1 BYE Content Length: 0 2.13.
Call Management (Incoming Call Screening)
Alice attempts to call Bob.
Messages F1, F2, and F3 are included to show that Bob does not accept INVITEs that have not been screened by the proxy.
Note that call screening cannot be done using the From header
instead some form of authentication credentials must be used.
The screening proxy inserts an announcement URI in an Error Info header field, which Alice accesses by sending an INVITE to listen to the Announcement.
The Announcement Server uses the automaton and rendering feature tags in F12 and F13 to indicate that it is a media server only capable of playing announcements.
branch z9hG4bK74bf9 Max Forwards: 70
Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:alice@client.atlanta.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY Content Type:
v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s  c IN IP4 client.atlanta.example.com
0 m audio 49170 RTP/AVP 0 a rtpmap:0
Bob only accepts INVITEs that have been screened by the proxy.
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
342123 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact:
> Content Length: 0 F3 ACK Alice
branch z9hG4bK74bf9 Max Forwards: 70
342123 Call ID: 12345600@atlanta.example.com CSeq:
1 ACK Content Length: 0 /
A retries the call through the proxy.
/ F4 INVITE Alice   Proxy 1 INVITE
branch z9hG4bK74bf0 Max Forwards: 70 Route:
Call ID: 12345600@atlanta.example.com CSeq: 2 INVITE Contact: <sips:alice@client.atlanta.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY Content Type:
v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s  c IN IP4 client.atlanta.example.com
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 /  Proxy 1 challenges Alice for authentication.
/ F5 407 Proxy Authentication Required Proxy 1
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf0 ;received 192.0.2.103 From:
7886765 Call ID: 12345600@atlanta.example.com CSeq: 2 INVITE Proxy Authenticate:
Digest realm "example.com", nonce "ea9c8e88df84f1cec4341ae6cbe5a359", qop "auth", nc 00000001, cnonce "0a4f113b
0 F6 ACK Alice   Proxy 1 ACK sips:bob@biloxi.example.com SIP/2.0
branch z9hG4bK74bf0 Max Forwards: 70
7886765 Call ID: 12345600@atlanta.example.com CSeq:
2 ACK Content Length: 0 /
Alice responds by sending an INVITE with authentication credentials in it.
branch z9hG4bK74bf2 Max Forwards: 70
Call ID: 12345600@atlanta.example.com CSeq: 3 INVITE Contact: <sips:alice@client.atlanta.example.com
Proxy Authorization: Digest username "alice", realm "example.com", qop auth, nc 00000001, cnonce "4gr84543ft2",
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY Content Type:
v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s  c IN IP4 client.atlanta.example.com
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 F8 403 Screening Failure (Terminating)
TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf2 ;received 192.0.2.103 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
ffe254 Call ID: 12345600@atlanta.example.com CSeq: 3 INVITE Error Info:
> Content Length: 0 F9 ACK Alice   Proxy 1 ACK
branch z9hG4bK74bf2 Max Forwards: 70
ffe254 Call ID: 12345600@atlanta.example.com Proxy Authorization:
Digest username "alice", realm "example.com",
sips:bob@biloxi.example.com", response "bbaec39f943bdcb3620d90afc548a45c" CSeq: 3 ACK Content Length: 0
/  To hear the recording, Alice connects to the Error Info URI.
Alice   Proxy 1 INVITE sips:
Call ID: 12345600@atlanta.example.com CSeq: 4 INVITE Contact: <sips:alice@client.atlanta.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY Content Type:
v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s  c IN IP4 client.atlanta.example.com
0 m audio 49170 RTP/AVP 0
a rtpmap:0 PCMU/8000 F11 200
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bfj ;received 192.0.2.103 From:
234934 Call ID: 12345600@atlanta.example.com CSeq: 4 INVITE Contact:
sip.rendering "no" Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY Content Type:
v 0 o annc 2890844543 2890844543
IN IP4 announce.biloxi.example.com s  c IN IP4 announce.biloxi.example.com
0 m audio 49174 RTP/AVP 0 a rtpmap:0 PCMU/8000 F12 ACK Alice
234934 Call ID: 12345600@atlanta.example.com CSeq:
4 ACK Content Length: 0 /
Announcement Server plays announcement then disconnects.
/ F13 BYE Announcement Server
branch z9hG4bK74bKS Max Forwards: 70 From: Bob
alice@atlanta.example.com>;tag 1234567 Call ID: 12345600@atlanta.example.com CSeq:
2334 BYE Content Length: 0
branch z9hG4bK74bKS ;received 192.0.2.103 From: Bob
alice@atlanta.example.com>;tag 1234567 Call ID: 12345600@atlanta.example.com CSeq:
2334 BYE Content Length: 0 2.14.
Call Management (Outgoing Call Screening)
Alice has an outgoing call screening list; Bob is included on the list of addresses to which Alice will not be able to place a call.
Alice attempts to call Bob.
Alice could establish a session to listen to the announcement in the Error Info header field.
Message Details F1 INVITE Alice   Proxy 1 INVITE
branch z9hG4bK74bf9 Max Forwards: 70
Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:alice@client.atlanta.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY Content Type:
v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s  c IN IP4 client.atlanta.example.com
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 /  Proxy 1 challenges Alice for authentication.
/ F2 407 Proxy Authentication Required Proxy 1
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
90210 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Proxy Authenticate:
Digest realm "example.com", nonce "ea9c8e88df84f1cec4341ae6cbe5a359", qop "auth", nc 00000001, cnonce "0a4f113b
F3 ACK Alice   Proxy 1 ACK sips:bob@biloxi.example.com SIP/2.0
branch z9hG4bK74bf9 Max Forwards: 70
90210 Call ID: 12345600@atlanta.example.com CSeq:
1 ACK Content Length: 0 /
Alice responds be sending an INVITE with authentication credentials in it.
/ F4 INVITE Alice   Proxy 1 INVITE
branch z9hG4bK74b4 Max Forwards: 70
Call ID: 12345600@atlanta.example.com CSeq: 2 INVITE Contact: <sips:alice@client.atlanta.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY Content Type:
v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s  c IN IP4 client.atlanta.example.com
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 F5 403 Screening Failure (Originating)
TLS client.atlanta.example.com:5061 ;branch z9hG4bK74b4 ;received 192.0.2.103 From:
18017 Call ID: 12345600@atlanta.example.com CSeq: 2 INVITE Error Info:
> Content Length: 0 F6 ACK Alice   Proxy 1 ACK
branch z9hG4bK74b4 Max Forwards: 70
18017 Call ID: 12345600@atlanta.example.com CSeq:
sips:bob@biloxi.example.com", response "b9d2e5bcdec9f69ab2a9b44f270285a6" Content Length: 0 2.15.
In this example, Alice calls Bob.
Bob then parks the call at the Park Server by sending a REFER to the Park Server.
The server sends an INVITE to Alice, which replaces the session between Alice and Bob.
The Park Server utilizes the automaton, rendering, and byeless feature tags in F9 to indicate its capabilities to Alice.
The call is accepted by Alice and causes Alice to send a BYE to Bob.
Bob receives notification of the successful park, and also receives the dialog identifiers in the application/sip body of the NOTIFY response.
Carol wishes to retrieve the call, so she sends an INVITE containing the dialog identifiers to Alice, which replaces the session with the Park Server.
Alice accepts the call and sends a BYE to the Park Server.
Carol obtains the dialog identifiers from a NOTIFY from the Park Server.
Note that this call flow is a special case of call transfer.
Note also that this flow could also be used for Music on Hold.
TLS client.alice.example.com:5061 ;branch z9hG4bKnashds7 Max Forwards: 70
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE, NOTIFY
v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s  c IN IP4 client.atlanta.example.com
0 m audio 49170 RTP/AVP 0 a rtpmap:0
PCMU/8000 F2 180 Ringing Bob   Alice
/TLS client.atlanta.example.com:5061 ;branch z9hG4bKnashds7 ;received 192.0.2.105 From:
314159 Call ID: 12345601@atlanta.example.com CSeq: 1 INVITE Contact: <sips:bob@client.biloxi.example.com>
Content Length: 0 F3 200 OK
/TLS client.atlanta.example.com:5061 ;branch z9hG4bKnashds7 ;received 192.0.2.105 From:
314159 Call ID: 12345601@atlanta.example.com CSeq: 1 INVITE Contact:
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE, NOTIFY
IN IP4 client.biloxi.example.com s  c IN IP4 client.biloxi.example.com
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F4 ACK Alice   Bob ACK sips:bob@client.biloxi.example.com
branch z9hG4bKnashds7 Max Forwards: 70
314159 Call ID: 12345601@atlanta.example.com CSeq:
ACK Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE, NOTIFY
replaces Content Length: 0 /  Bob REFERs Park Server to establish session with Alice, which replaces the established session between Alice and Bob.
Note that there is no session established between Bob and the Park Server.
/ F5 REFER Bob   Park Server REFER sips:park@server.example.com
branch z9hG4bKnashds9 Max Forwards: 70
> Call ID: 4802029847@biloxi.example.com CSeq:
tag%3D314159 %3Bto tag%3D1234567&Require replaces> </allOneLine
Content Length: 0 F6 202 Accepted Park Server   Bob SIP/2.0 202
1 REFER Content Length: 0 F7 NOTIFY Park Server
Call ID: 4802029847@biloxi.example.com CSeq: 1 NOTIFY Event:
/TLS server.example.com:5061 ;branch z9hG4bK74bT6 ;received 192.0.2.103
1 NOTIFY Content Length: 0 /  Park Server places call to Alice to replace session between Alice and Bob.
/ F9 INVITE Park Server
Max Forwards: 70 From: <sips:park@server.example.com>;tag
> Call ID: a5 75 34
sip.byeless; sip.rendering "no" Require: replaces Replaces: 12345601@atlanta.example.com
;from tag 314159;to tag 1234567 Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE, NOTIFY
IN IP4 Park.server.example.com s  c IN IP4 server.example.com t 0 0
m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 F10 200
/TLS server.example.com:5061 ;branch z9hG4bK74rf ;received 192.0.2.103 From: <sips:park@server.example.com>;tag 0111
Call ID: a5 75 34
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE, NOTIFY
v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s  c IN IP4 client.atlanta.example.com
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 a recvonly F11 ACK Park Server
/TLS server.example.com:5061 ;branch z9hG4bK7rfF Max Forwards: 70 From: <sips:park@server.example.com>;tag 0111
Call ID: a5 75 34
1 ACK Content Length: 0
branch z9hG4bKnashds7 Max Forwards: 70
314159 Call ID: 12345601@atlanta.example.com CSeq: 2 BYE Content Length:
/TLS client.atlanta.example.com:5061 ;branch z9hG4bKnashds7 ;received 192.0.2.105 From:
314159 Call ID: 12345601@atlanta.example.com CSeq: 2 BYE Content Length: 0 /
Park Server reports success back to Bob by returning a 200 OK response.
Bob obtains the dialog identifiers from the headers included in the response.
Call ID: 4802029847@biloxi.example.com CSeq: 2 NOTIFY Event: refer Subscription State: terminated;reason noresource Contact:
/TLS server.example.com:5061 ;branch z9hG4bK74rf ;received 192.0.2.103 From: <sips:park@server.example.com>;tag 0111
Call ID: a5 75 34
/TLS server.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103
Call ID: 4802029847@biloxi.example.com CSeq: 2 NOTIFY Content Length: 0 /  Alice is now parked at the Park Server.
Carol picks up the call by sending an INVITE to A, which replaces the existing session with the Park Server.
Carol needs to know the dialog information to construct the Replaces header.
/ F16 SUBSCRIBE  Carol   Park Server SUBSCRIBE
branch z9hG4bK74b232 Max Forwards: 70
> Event: dialog Expires: 0
Accept: application/dialog info xml Content Length: 0
F17 200 OK Park Server   Carol
TLS client.chicago.example.com:5061 ;branch z9hG4bK74b232 ;received 192.0.2.105 From: Carol <sips:carol@chicago.example.com>;tag 158x93461
sip.byeless; sip.rendering "no" Content Length: 0 F18 NOTIFY
/TLS server.example.com:5061 ;branch z9hG4bK74b8skd Max Forwards: 70
<dialog info xmlns "urn:ietf:params:xml:ns:dialog info" version "0" state "full" entity "sips:park@server.example.com">
12 76@server.example.com" local tag "0111
" remote tag "098594" direction "initiator"> <duration>1</duration> <local> <target
/TLS server.example.com:5061 ;branch z9hG4bK74b8skd ;received 192.0.2.103
Content Length: 0 F20 INVITE Carol
> Call ID: 6485356@chicago.example.com CSeq: 1 INVITE Contact: <sips:carol@client.chicago.example.com
a5 75 34 12 76@server.example.com ;to tag 098594;from tag
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE, NOTIFY
IN IP4 client.chicago.example.com s  c IN IP4 client.chicago.example.com t 0
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F21 200
TLS client.chicago.example.com:5061 ;branch z9hG4bK74bQ2 ;received 192.0.2.105 From: Carol <sips:carol@chicago.example.com>;tag 5893461
222 Call ID: 6485356@chicago.example.com CSeq:
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE, NOTIFY
v 0 o alice 2890844527 2890844527 IN IP4 client.atlanta.example.com s  c IN IP4 client.atlanta.example.com t
0 0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 F22 ACK Carol
222 Call ID: 6485356@chicago.example.com CSeq:
1 ACK Content Length: 0 /
A replaces the session to the Park Server with the new session with C and generates a BYE to disconnect the Park Server.
branch z9hG4bK74b4N Max Forwards: 70
Call ID: a5 75 34
1 BYE Content Length: 0 F24 200 OK Park Server
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74b4N ;received 192.0.2.103 From:
Call ID: a5 75 34
1 BYE Content Length: 0 2.16.
Alice calls Bob, who does not answer.
Bill wishes to pick up the call and sends a SUBSCRIBE to Bob to retrieve the dialog information.
Bill then generates an INVITE with a Replaces to Alice.
Alice answers the INVITE and sends a CANCEL to stop Bob's phone ringing.
Note that the relative order of the 487/ACK sequence (F11/F12) and the 200 OK to the CANCEL (F10) is not deterministic.
This call flow shows the use of the "early only" parameter [RFC3891] in the Replaces header field of F7.
This parameter prevents Alice from accepting the INVITE if Bob has already accepted the INVITE.
If Bill had wished to "take" the call from Bob regardless of whether he had answered, the parameter would not have been present in F7.
Also note that the subscription between Bob and Carol could have been established prior to Alice's call.
branch z9hG4bK74bf9 Max Forwards: 70
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s  c IN IP4 client.atlanta.example.com
0 m audio 49170 RTP/AVP 0 a rtpmap:0
PCMU/8000 F2 180 Ringing Bob   Alice
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
3145678 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:bob@client.biloxi.example.com>
0 /  Bill decides to pick up the call.
1 SUBSCRIBE Contact: <sips:bill@pc.biloxi.example.com> Event:
Accept: application/dialog info xml Content Length: 0 F4 200 OK Bob   Bill
SIP/2.0/TLS pc.biloxi.example.com:5061 ;branch z9hG4bK74bf ;received 192.0.2.114 Max Forwards: 70 From: Bill
1 SUBSCRIBE Content Length: 0 F5 NOTIFY
branch z9hG4bK74br Max Forwards: 70
<dialog info xmlns "urn:ietf:params:xml:ns:dialog info" version "0" state "full" entity "sips:bob@biloxi.example.com"
> <dialog id "94992014524" call id "12345600@atlanta.example.com" local tag "3145678
" remote tag "1234567" direction "recipient"> <duration>1</duration> <local>
> <remote> <identity display "Alice">sips:alice@atlanta.example.com </identity> <target
TLS client.biloxi.example.com:5061 ;branch z9hG4bK74br ;received 192.0.2.105 From: Bob
sips:bill@pc.biloxi.example.com> Content Length: 0 F7 INVITE  Bill
branch z9hG4bK74HH Max Forwards: 70
> Call ID: 563456212@b2.biloxi.example.com CSeq:
1 INVITE Require: replaces Replaces: 12345600@atlanta.example.com ;from tag 314578;to tag 1234567;early
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
o bill 2890843122 2890843122 IN IP4 pc.biloxi.example.com s  c IN IP4 pc.biloxi.example.com t
0 0 m audio 5342 RTP/AVP 0 a rtpmap:0 PCMU/8000 /  Alice matches the dialog information in the Replaces header and accepts the INVITE.
SIP/2.0/TLS pc.biloxi.example.com:5061 ;branch z9hG4bK74HH ;received 192.0.2.114 From: Bill <sips:
alice@atlanta.example.com>;tag 131256 Call ID: 563456212@b2.biloxi.example.com CSeq:
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
v 0 o alice 289084543 289084543 IN IP4 client.atlanta.example.com s  c IN IP4 client.atlanta.example.com
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 /  Alice stops Bob's phone from ringing by sending a CANCEL.
branch z9hG4bK74bf9 Max Forwards: 70
1 CANCEL Content Length: 0 F10 200 OK
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
3145678 Call ID: 12345600@atlanta.example.com CSeq:
1 CANCEL Content Length: 0 F11 487 Request Terminated
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
3145678 Call ID: 12345600@atlanta.example.com CSeq:
1 INVITE Content Length: 0 F12 ACK Alice
3145678 Call ID: 12345600@atlanta.example.com CSeq:
1 ACK Content Length: 0 F13 ACK  Bill   Alice ACK sips:
alice@atlanta.example.com>;tag 131256 Call ID: 563456212@b2.biloxi.example.com CSeq:
1 ACK Content Length: 0
/  RTP streams are established between Alice and Bill.
Later, Alice hangs up with Bill.
/ F14 BYE Alice   Bill BYE sips:bill@pc.biloxi.example.com
branch z9hG4bK74bf2 Max Forwards: 70
alice@atlanta.example.com>;tag 131256 Call ID: 563456212@b2.biloxi.example.com CSeq:
1 BYE Content Length: 0
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf2 ;received 192.0.2.105
alice@atlanta.example.com>;tag 131256 Call ID: 563456212@b2.biloxi.example.com CSeq:
1 BYE Content Length: 0 2.17.
Alice subscribes to Bob's call state using a SUBSCRIBE F4.
Bob sends a NOTIFY F8 when Bob is available.
Alice is alerted, then Alice sends an INVITE to Bob to establish the session.
The subscription is terminated using SUBSCRIBE F16.
branch z9hG4bK74bf9 Max Forwards: 70
Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Contact: <sips:alice@client.atlanta.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE, NOTIFY
0 m audio 49170 RTP/AVP 0 a rtpmap:0 PCMU/8000 F2 486 Busy
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK74bf9 ;received 192.0.2.103 From: Alice <sips:alice@atlanta.example.com>;tag 1234567
982039i4 Call ID: 12345600@atlanta.example.com CSeq: 1 INVITE Content Length: 0 F3 ACK Alice
branch z9hG4bK74bf9 Max Forwards: 70
982039i4 Call ID: 12345600@atlanta.example.com CSeq:
1 ACK Content Length: 0 F4 SUBSCRIBE Alice   Bob SUBSCRIBE
1 SUBSCRIBE Contact: sips:alice@client.atlanta.example.com Event:
dialog Accept: application/dialog info xml Content Length: 0 F5 200
TLS client.atlanta.example.com:5061 ;branch z9hG4bK74b8G ;received 192.0.2.103 From:
4524526232@atlanta.example.com Expires: 60 CSeq: 1 SUBSCRIBE Contact: sips:bob@client.biloxi.example.com Content Length: 0 F6 NOTIFY
branch z9hG4bK74bn2 Max Forwards: 70
<dialog info xmlns "urn:ietf:params:xml:ns:dialog info" version "0" state "full" entity "sips:bob@biloxi.example.com"> <dialog id "562623442g3
> </dialog info> F7 200
TLS client.biloxi.example.com:5061 ;branch z9hG4bK74bn2 ;received 192.0.2.105 From: Bob
1 NOTIFY Content Length: 0 /  Bob is now available.
TLS client.biloxi.example.com:5061 ;branch z9hG4bK74bVi Max Forwards: 70
Call ID: 4524526232@atlanta.example.com CSeq: 2 NOTIFY Event:
<dialog info xmlns "urn:ietf:params:xml:ns:dialog info" version "0" state "full" entity "sips:bob@biloxi.example.com"> <dialog id "562623442g3
TLS client.biloxi.example.com:5061 ;branch z9hG4bK74bVi ;received 192.0.2.105 From: Bob
2 NOTIFY Content Length: 0 F10 INVITE Alice   Bob INVITE
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE, NOTIFY
IN IP4 client.atlanta.example.com s  c IN IP4 client.atlanta.example.com t
0 0 m audio 49170 RTP/AVP 0 a rtpmap:0
PCMU/8000 F11 180 Ringing Bob   Alice
Content Length: 0 F12 200 OK
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE, NOTIFY
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F13 ACK Alice
1 ACK Content Length: 0
branch z9hG4bK4bnd2 Max Forwards: 70
<dialog info xmlns "urn:ietf:params:xml:ns:dialog info" version "0" state "full" entity "sips:bob@biloxi.example.com"> <dialog
TLS client.biloxi.example.com:5061 ;branch z9hG4bK4bnd2 ;received 192.0.2.105 From: Bob
3 NOTIFY Content Length: 0 /  Alice terminates the subscription.
/ F16 SUBSCRIBE Alice   Bob SUBSCRIBE sips:bob@client.biloxi.example.com
2 SUBSCRIBE Contact: sips:alice@client.atlanta.example.com Event: dialog Expires: 0
Accept: application/dialog info xml Content Length: 0 F17 200 OK
/TLS client.atlanta.example.com:5061 ;branch z9hG4bK474b8 ;received 192.0.2.103 From:
4524526232@atlanta.example.com Expires: 0 CSeq: 2 SUBSCRIBE Contact: sips:bob@client.biloxi.example.com Content Length: 0 F18 NOTIFY
branch z9hG4bKb5n2j Max Forwards: 70
Call ID: 4524526232@atlanta.example.com CSeq: 4 NOTIFY Contact: <sips:bob@client.biloxi.example.com
<dialog info xmlns "urn:ietf:params:xml:ns:dialog info" version "0" state "full" entity "sips:bob@biloxi.example.com"> <dialog
Call ID: 4524526232@atlanta.example.com CSeq: 4 NOTIFY Content Length: 0 2.18.
Click to Dial Bob's PC
In this example, while browsing the web on his PC, Bob clicks on Carol's SIP URI, intending to establish a session with Carol.
Bob's web browser passes the SIP URI to the SIP client on Bob's PC.
The PC client is configured with the URI of Bob's SIP phone.
A REFER is sent to the SIP phone, which results in the establishment of the session between Bob and Carol.
Note that Bob's PC requests that no REFER dialog be established by the use of the Refer Sub: false header field [RFC4488].
This flow is preferable to the 3pcc flow because the end to end SIP signaling is not interrupted by the 3pcc controller, and because Bob's experience of the call will not be marred by the lack of ringback tone or possible clipping.
Suitable authorization of the REFER and explicit authorization of the triggered INVITE by Bob are necessary.
Message Details /  Bob's PC SIP client sends a REFER to Bob's SIP phone.
/ F1 REFER PC   Bob REFER
SIP/2.0/TLS pc.biloxi.example.com:5061 ;branch z9hG4bKnashds7 Max Forwards: 70
Call ID: 1234560183434 CSeq: 1 REFER
<sips:pc.biloxi.example.com> Content Length: 0 F2 202 Accepted Bob   PC
1 REFER Refer Sub: false Content Length: 0 F3 INVITE Bob   Carol INVITE
branch z9hG4bKnashdK9 Max Forwards: 70
> Call ID: 7436222@atlanta.example.com CSeq: 1 INVITE Contact:
> Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
v 0 o bob 2890844539 2890844539
0 m audio 3458 RTP/AVP 0 a rtpmap:0 PCMU/8000 F4 180 Ringing Carol
TLS client.biloxi.example.com:5061 ;branch z9hG4bKnashdK9 ;received 192.0.2.113 From: Bob
928287 Call ID: 7436222@atlanta.example.com CSeq: 1 INVITE Contact: <sips:carol@client.chicago.example.com> Content Length: 0 F5 200 OK Carol
TLS client.biloxi.example.com:5061 ;branch z9hG4bKnashdK9 ;received 192.0.2.113 From: Bob
928287 Call ID: 7436222@atlanta.example.com CSeq: 1 INVITE Contact: <sips:carol@client.chicago.example.com
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
IN IP4 client.chicago.example.com s  c IN IP4 client.chicago.example.com t 0
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F6 ACK Bob   Carol ACK sips:carol@client.chicago.example.com
branch z9hG4bKnashd43 Max Forwards: 70
928287 Call ID: 7436222@atlanta.example.com CSeq:
1 ACK Content Length: 0 /  Bob and Carol now have established a session.
Security Considerations Since many of the examples in this document involve SIP call control, either peer to peer or 3pcc, the security considerations in the Multiparty Framework document [FRAMEWORK] apply.
Many of the services shown in this document rely on a particular user agent being part of a group.
Members of a group could be, for example, employees within a particular department, a set of home phone extensions, members of a call center, etc.
As such, user agents that are part of the group permit other group members special privileges and features.
For example, while a user agent may not in general allow another user agent to learn detailed dialog information, this information might be shared with another group member in order to facilitate a service such as call pickup.
Group members must be authenticated using normal SIP means such as certificates or shared secrets.
The service examples in this document make extensive use of the SIP call control primitives REFER, Replaces, Join, and the dialog package.
The security considerations associated with each of these extensions [RFC3515], [RFC3891], [RFC3911], [RFC4235] apply to the scenarios in this document.
