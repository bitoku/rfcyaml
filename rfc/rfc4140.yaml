- title: __initial_text__
  contents:
  - '         Hierarchical Mobile IPv6 Mobility Management (HMIPv6)

    '
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This memo defines an Experimental Protocol for the Internet\n\
    \   community.  It does not specify an Internet standard of any kind.\n   Discussion\
    \ and suggestions for improvement are requested.\n   Distribution of this memo\
    \ is unlimited.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (C) The Internet Society (2005).\n"
- title: Abstract
  contents:
  - "Abstract\n   This document introduces extensions to Mobile IPv6 and IPv6 Neighbour\n\
    \   Discovery to allow for local mobility handling.  Hierarchical\n   mobility\
    \ management for Mobile IPv6 is designed to reduce the amount\n   of signalling\
    \ between the Mobile Node, its Correspondent Nodes, and\n   its Home Agent.  The\
    \ Mobility Anchor Point (MAP) described in this\n   document can also be used\
    \ to improve the performance of Mobile IPv6\n   in terms of handover speed.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1. Introduction ....................................................3\n\
    \   2. Terminology .....................................................4\n  \
    \ 3. Overview of HMIPv6 ..............................................5\n    \
    \  3.1. HMIPv6 Operation ...........................................6\n   4. Mobile\
    \ IPv6 Extensions ..........................................8\n      4.1. Local\
    \ Binding Update .......................................8\n   5. Neighbour Discovery\
    \ Extension: The MAP Option Message Format ....9\n   6. Protocol Operation .............................................10\n\
    \      6.1. Mobile Node Operation .....................................10\n  \
    \         6.1.1. Sending Packets to Correspondent Nodes .............12\n    \
    \  6.2. MAP Operations ............................................12\n      6.3.\
    \ Home Agent Operations .....................................13\n      6.4. Correspondent\
    \ Node Operations .............................13\n      6.5. Local Mobility Management\
    \ Optimisation within a\n           MAP Domain ................................................13\n\
    \      6.6. Location Privacy ..........................................14\n  \
    \ 7. MAP Discovery ..................................................14\n    \
    \  7.1. Dynamic MAP Discovery .....................................14\n      \
    \     7.1.1. Router Operation for Dynamic MAP Discovery .........15\n        \
    \   7.1.2. MAP Operation for Dynamic MAP Discovery ............15\n      7.2.\
    \ Mobile Node Operation .....................................16\n   8. Updating\
    \ Previous MAPs .........................................16\n   9. Notes on MAP\
    \ Selection by the Mobile Node ......................17\n      9.1. MAP Selection\
    \ in a Distributed-MAP Environment ............17\n      9.2. MAP Selection in\
    \ a Flat Mobility Management Architecture ..19\n   10. Detection and Recovery\
    \ from MAP Failures ......................19\n   11. IANA Considerations ...........................................20\n\
    \   12. Security Considerations .......................................20\n  \
    \     12.1. Mobile Node-MAP Security ................................20\n    \
    \   12.2. Mobile Node-Correspondent Node Security .................22\n      \
    \ 12.3. Mobile Node-Home Agent Security .........................22\n   13. Acknowledgments\
    \ ...............................................22\n   14. References ....................................................23\n\
    \       14.1. Normative References ....................................23\n  \
    \     14.2. Informative References ..................................23\n   Appendix\
    \ A: Fast Mobile IPv6 Handovers and HMIPv6 .................24\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   This memo introduces the concept of a Hierarchical Mobile\
    \ IPv6\n   network, utilising a new node called the Mobility Anchor Point (MAP).\n\
    \   Mobile IPv6 [1] allows nodes to move within the Internet topology\n   while\
    \ maintaining reachability and on-going connections between\n   mobile and correspondent\
    \ nodes.  To do this a mobile node sends\n   Binding Updates (BUs) to its Home\
    \ Agent (HA) and all Correspondent\n   Nodes (CNs) it communicates with, every\
    \ time it moves.\n   Authenticating binding updates requires approximately 1.5\
    \ round-trip\n   times between the mobile node and each correspondent node (for\
    \ the\n   entire return routability procedure in a best case scenario, i.e., no\n\
    \   packet loss).  In addition, one round-trip time is needed to update\n   the\
    \ Home Agent; this can be done simultaneously while updating\n   correspondent\
    \ nodes.  The re-use of the home cookie (i.e.,\n   eliminating HOTI/HOT) will\
    \ not reduce the number of round trip times\n   needed to update correspondent\
    \ nodes.  These round trip delays will\n   disrupt active connections every time\
    \ a handoff to a new AR is\n   performed.  Eliminating this additional delay element\
    \ from the time-\n   critical handover period will significantly improve the performance\n\
    \   of Mobile IPv6.  Moreover, in the case of wireless links, such a\n   solution\
    \ reduces the number of messages sent over the air interface\n   to all correspondent\
    \ nodes and the Home Agent.  A local anchor point\n   will also allow Mobile IPv6\
    \ to benefit from reduced mobility\n   signalling with external networks.\n  \
    \ For these reasons a new Mobile IPv6 node, called the Mobility Anchor\n   Point,\
    \ is used and can be located at any level in a hierarchical\n   network of routers,\
    \ including the Access Router (AR).  Unlike Foreign\n   Agents in IPv4, a MAP\
    \ is not required on each subnet.  The MAP will\n   limit the amount of Mobile\
    \ IPv6 signalling outside the local domain.\n   The introduction of the MAP provides\
    \ a solution to the issues\n   outlined earlier in the following way:\n   - The\
    \ mobile node sends Binding Updates to the local MAP rather than\n     the HA\
    \ (which is typically further away) and CNs\n   - Only one Binding Update message\
    \ needs to be transmitted by the MN\n     before traffic from the HA and all CNs\
    \ is re-routed to its new\n     location.  This is independent of the number of\
    \ CNs that the MN is\n     communicating with.\n   A MAP is essentially a local\
    \ Home Agent.  The aim of introducing the\n   hierarchical mobility management\
    \ model in Mobile IPv6 is to enhance\n   the performance of Mobile IPv6 while\
    \ minimising the impact on Mobile\n   IPv6 or other IPv6 protocols.  It also supports\
    \ Fast Mobile IPv6\n   Handovers to help Mobile Nodes achieve seamless mobility\
    \ (see\n   Appendix A).  Furthermore, HMIPv6 allows mobile nodes to hide their\n\
    \   location from correspondent nodes and Home Agents while using Mobile\n   IPv6\
    \ route optimisation.\n"
- title: 2.  Terminology
  contents:
  - "2.  Terminology\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\", \"SHALL\"\
    , \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"MAY\", and\
    \ \"OPTIONAL\" in this\n   document are to be interpreted as described in RFC\
    \ 2119 [3].\n   In addition, new terms are defined below:\n   Access Router (AR)\
    \     The AR is the Mobile Node's default router.\n                          The\
    \ AR aggregates the outbound traffic of\n                          mobile nodes.\n\
    \   Mobility Anchor Point  A Mobility Anchor Point is a router located\n   (MAP)\
    \                  in a network visited by the mobile node.  The\n           \
    \               MAP is used by the MN as a local HA.  One or\n               \
    \           more MAPs can exist within a visited network.\n   Regional Care-of\
    \       An RCoA is an address obtained by the\n   Address (RCoA)         mobile\
    \ node from the visited network.  An RCoA\n                          is an address\
    \ on the MAP's subnet.  It is\n                          auto-configured by the\
    \ mobile node when\n                          receiving the MAP option.\n   HMIPv6-aware\
    \           An HMIPv6-aware mobile node is a mobile\n   Mobile Node          \
    \  node that can receive and process the MAP\n                          option\
    \ received from its default router.  An\n                          HMIPv6-aware\
    \ Mobile Node must also be able to\n                          send local binding\
    \ updates (Binding Update\n                          with the M flag set).\n \
    \  On-link Care-of        The LCoA is the on-link CoA configured on\n   Address\
    \ (LCoA)        a mobile node's interface based on the prefix\n              \
    \            advertised by its default router.  In [1],\n                    \
    \      this is simply referred to as the Care-of-\n                          address.\
    \  However, in this memo LCoA is used\n                          to distinguish\
    \ it from the RCoA.\n   Local Binding Update   The MN sends a Local Binding Update\
    \ to the MAP\n                          in order to establish a binding between\
    \ the\n                          RCoA and LCoA.\n"
- title: 3.  Overview of HMIPv6
  contents:
  - "3.  Overview of HMIPv6\n   This Hierarchical Mobile IPv6 scheme introduces a\
    \ new function, the\n   MAP, and minor extensions to the mobile node operation.\
    \  The\n   correspondent node and Home Agent operation will not be affected.\n\
    \   Just like Mobile IPv6, this solution is independent of the underlying\n  \
    \ access technology, allowing mobility within or between different\n   types of\
    \ access networks.\n   A mobile node entering a MAP domain will receive Router\n\
    \   Advertisements containing information on one or more local MAPs.  The\n  \
    \ MN can bind its current location (on-link CoA) with an address on the\n   MAP's\
    \ subnet (RCoA).  Acting as a local HA, the MAP will receive all\n   packets on\
    \ behalf of the mobile node it is serving and will\n   encapsulate and forward\
    \ them directly to the mobile node's current\n   address.  If the mobile node\
    \ changes its current address within a\n   local MAP domain (LCoA), it only needs\
    \ to register the new address\n   with the MAP.  Hence, only the Regional CoA\
    \ (RCoA) needs to be\n   registered with correspondent nodes and the HA.  The\
    \ RCoA does not\n   change as long as the MN moves within a MAP domain (see below\
    \ for\n   definition).  This makes the mobile node's mobility transparent to\n\
    \   the correspondent nodes it is communicating with.\n   A MAP domain's boundaries\
    \ are defined by the Access Routers (ARs)\n   advertising the MAP information\
    \ to the attached Mobile Nodes.  The\n   detailed extensions to Mobile IPv6 and\
    \ operations of the different\n   nodes will be explained later in this document.\n\
    \   It should be noted that the HMIPv6 concept is simply an extension to\n   the\
    \ Mobile IPv6 protocol.  An HMIPv6-aware mobile node with an\n   implementation\
    \ of Mobile IPv6 SHOULD choose to use the MAP when\n   discovering such capability\
    \ in a visited network.  However, in some\n   cases the mobile node may prefer\
    \ to simply use the standard Mobile\n   IPv6 implementation.  For instance, the\
    \ mobile node may be located in\n   a visited network within its home site.  In\
    \ this case, the HA is\n   located near the visited network and could be used\
    \ instead of a MAP.\n   In this scenario, the mobile node would only update the\
    \ HA whenever\n   it moves.  The method to determine whether the HA is in the\
    \ vicinity\n   of the MN (e.g., same site) is outside the scope of this document.\n"
- title: 3.1.  HMIPv6 Operation
  contents:
  - "3.1.  HMIPv6 Operation\n   The network architecture shown in Figure 1 illustrates\
    \ an example of\n   the use of the MAP in a visited network.\n   In Figure 1,\
    \ the MAP can help in providing seamless mobility for the\n   mobile node as it\
    \ moves from Access Router 1 (AR1) to Access Router 2\n   (AR2), while communicating\
    \ with the correspondent node.  A multi-\n   level hierarchy is not required for\
    \ a higher handover performance.\n   Hence, it is sufficient to locate one or\
    \ more MAPs (possibly covering\n   the same domain) at any position in the operator's\
    \ network.\n                +-------+\n                |  HA   |\n           \
    \     +-------+       +----+\n                    |           | CN |\n       \
    \             |           +----+\n                    |             |\n      \
    \              +-------+-----+\n                            |\n              \
    \              |RCoA\n                        +-------+\n                    \
    \    |  MAP  |\n                        +-------+\n                         |\
    \     |\n                         |     +--------+\n                         |\
    \              |\n                         |              |\n                \
    \     +-----+         +-----+\n                     | AR1 |         | AR2 |\n\
    \                     +-----+         +-----+\n                        LCoA1 \
    \        LCoA2\n                    +----+\n                    | MN |\n     \
    \               +----+   ------------>\n                               Movement\n\
    \             Figure 1: Hierarchical Mobile IPv6 domain\n   Upon arrival in a\
    \ visited network, the mobile node will discover the\n   global address of the\
    \ MAP.  This address is stored in the Access\n   Routers and communicated to the\
    \ mobile node via Router Advertisements\n   (RAs).  A new option for RAs is defined\
    \ later in this specification.\n   This is needed to inform mobile nodes about\
    \ the presence of the MAP\n   (MAP discovery).  The discovery phase will also\
    \ inform the mobile\n   node of the distance of the MAP from the mobile node.\
    \  For example,\n   the MAP function could be implemented as shown in Figure 1,\
    \ and, at\n   the same time, also be implemented in AR1 and AR2.  In this case\
    \ the\n   mobile node can choose the first hop MAP or one further up in the\n\
    \   hierarchy of routers.  The details on how to choose a MAP are\n   provided\
    \ in section 10.\n   The process of MAP discovery continues as the mobile node\
    \ moves from\n   one subnet to the next.  Every time the mobile node detects movement,\n\
    \   it will also detect whether it is still in the same MAP domain.  The\n   router\
    \ advertisement used to detect movement will also inform the\n   mobile node,\
    \ through the MAP option, whether it is still in the same\n   MAP domain.  As\
    \ the mobile node roams within a MAP domain, it will\n   continue to receive the\
    \ same MAP option included in router\n   advertisements from its AR.  If a change\
    \ in the advertised MAP's\n   address is received, the mobile node MUST act on\
    \ the change by\n   sending Binding Updates to its HA and correspondent nodes.\n\
    \   If the mobile node is not HMIPv6-aware, then no MAP Discovery will be\n  \
    \ performed, resulting in the mobile node using the Mobile IPv6 [1]\n   protocol\
    \ for its mobility management.  On the other hand, if the\n   mobile node is HMIPv6-aware\
    \ it SHOULD choose to use its HMIPv6\n   implementation.  If so, the mobile node\
    \ will first need to register\n   with a MAP by sending it a BU containing its\
    \ Home Address and on-link\n   address (LCoA).  The Home address used in the BU\
    \ is the RCoA.  The\n   MAP MUST store this information in its Binding Cache to\
    \ be able to\n   forward packets to their final destination when received from\
    \ the\n   different correspondent nodes or HAs.\n   The mobile node will always\
    \ need to know the original sender of any\n   received packets to determine if\
    \ route optimisation is required.\n   This information will be available to the\
    \ mobile node because the MAP\n   does not modify the contents of the original\
    \ packet.  Normal\n   processing of the received packets (as described in [1])\
    \ will give\n   the mobile node the necessary information.\n   To use the network\
    \ bandwidth in a more efficient manner, a mobile\n   node may decide to register\
    \ with more than one MAP simultaneously and\n   to use each MAP address for a\
    \ specific group of correspondent nodes.\n   For example, in Fig 1, if the correspondent\
    \ node happens to exist on\n   the same link as the mobile node, it would be more\
    \ efficient to use\n   the first hop MAP (in this case assume it is AR1) for communication\n\
    \   between them.  This will avoid sending all packets via the \"highest\"\n \
    \  MAP in the hierarchy and thus will result in more efficient usage of\n   network\
    \ bandwidth.  The mobile node can also use its current on-link\n   address (LCoA)\
    \ as a CoA, as specified in [1].  Note that the mobile\n   node MUST NOT present\
    \ an RCoA from a MAP's subnet as an LCoA in a\n   binding update sent to another\
    \ MAP.  The LCoA included in the binding\n   update MUST be the mobile node's\
    \ address derived from the prefix\n   advertised on its link.\n   If a router\
    \ advertisement is used for MAP discovery, as described in\n   this document,\
    \ all ARs belonging to the MAP domain MUST advertise the\n   MAP's IP address.\
    \  The same concept (advertising the MAP's presence\n   within its domain) should\
    \ be used if other methods of MAP discovery\n   are introduced in future.\n"
- title: 4.  Mobile IPv6 Extensions
  contents:
  - "4.  Mobile IPv6 Extensions\n   This section outlines the extensions proposed\
    \ to the binding update\n   specified in [1].\n"
- title: 4.1.  Local Binding Update
  contents:
  - "4.1.  Local Binding Update\n   A new flag is added: the M flag, which indicates\
    \ MAP registration.\n   When a mobile node registers with the MAP, the M and A\
    \ flags MUST be\n   set to distinguish this registration from a BU being sent\
    \ to the HA\n   or a correspondent node.\n    0                   1          \
    \         2                   3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0\
    \ 1 2 3 4 5 6 7 8 9 0 1\n                                   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \                                   |            Sequence #         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |A|H|L|K|M|      Reserved       |            Lifetime           |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                                                               |\n   |  \
    \                                                             |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   Description of extensions to the binding update:\n       M              If\
    \ set to 1 it indicates a MAP registration.\n   It should be noted that this is\
    \ an extension to the Binding update\n   specified in [1].\n"
- title: '5.  Neighbour Discovery Extension: The MAP Option Message Format'
  contents:
  - "5.  Neighbour Discovery Extension: The MAP Option Message Format\n    0     \
    \              1                   2                   3\n    0 1 2 3 4 5 6 7\
    \ 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |     Type      |    Length     |  Dist |  Pref |R|  Reserved   |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                      Valid Lifetime                           |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                                                               |\n   +  \
    \                                                             +\n   |        \
    \                                                       |\n   +              \
    \    Global IP Address for MAP                    +\n   |                    \
    \                                           |\n   +                          \
    \                                     +\n   |                                \
    \                               |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   Fields:\n      Type            IPv6 Neighbor Discovery option.  23.\n    \
    \  Length          8-bit unsigned integer.  The length of the option\n       \
    \               and MUST be set to 3.\n      Dist            A 4-bit unsigned\
    \ integer identifying the Distance\n                      Between MAP and the\
    \ receiver of the advertisement.\n                      Its default value SHOULD\
    \ be set to 1 if Dynamic\n                      MAP discovery is used.  The Distance\
    \ MUST be set\n                      to 1 if the MAP is on the same link as the\
    \ mobile\n                      node.  This field need not be interpreted as the\n\
    \                      number of hops between MAP and the mobile node.\n     \
    \                 The only requirement is that the meaning of the\n          \
    \            Distance field is consistently interpreted within\n             \
    \         one Domain.  A Distance value of Zero MUST NOT be\n                \
    \      used.\n      Pref            The preference of a MAP.  A 4-bit unsigned\n\
    \                      integer.  A decimal value of 15 indicates the\n       \
    \               highest availability.\n      R               When set to 1, it\
    \ indicates that the mobile node\n                      MUST form an RCoA based\
    \ on the prefix in the MAP\n                      option.\n      Valid Lifetime\
    \  The minimum value (in seconds) of both the\n                      preferred\
    \ and valid lifetimes of the prefix\n                      assigned to the MAP's\
    \ subnet.  This value\n                      indicates the validity of the MAP's\
    \ address and\n                      consequently the time for which the RCoA\
    \ is valid.\n      Global Address  One of the MAP's global addresses.  The 64-bit\n\
    \                      prefix extracted from this address MUST be\n          \
    \            configured in the MAP to be used for RCoA\n                     \
    \ construction by the mobile node.\n   Although not explicitly included in the\
    \ MAP option, the prefix length\n   of the MAP's Global IP address MUST be 64.\
    \  This prefix is the one\n   used by the mobile node to form an RCoA, by appending\
    \ a 64-bit\n   identifier to the prefix.  Thus, it necessitates a static prefix\n\
    \   length for the MAP's subnet.\n"
- title: 6.  Protocol Operation
  contents:
  - "6.  Protocol Operation\n   This section describes the HMIPv6 protocol.  In HMIPv6,\
    \ the mobile\n   node has two addresses, an RCoA on the MAP's link and an on-link\
    \ CoA\n   (LCoA).  This RCoA is formed in a stateless manner by combining the\n\
    \   mobile node's interface identifier and the subnet prefix received in\n   the\
    \ MAP option.\n   As illustrated in this section, this protocol requires updating\
    \ the\n   mobile nodes' implementation only.  The HA and correspondent node are\n\
    \   unchanged.  The MAP performs the function of a \"local\" HA that binds\n \
    \  the mobile node's RCoA to an LCoA.\n"
- title: 6.1.  Mobile Node Operation
  contents:
  - "6.1.  Mobile Node Operation\n   When a mobile node moves into a new MAP domain\
    \ (i.e., its MAP\n   changes), it needs to configure two CoAs: an RCoA on the\
    \ MAP's link\n   and an on-link CoA (LCoA).  The RCoA is formed in a stateless\
    \ manner.\n   After forming the RCoA based on the prefix received in the MAP\n\
    \   option, the mobile node sends a local BU to the MAP with the A and M\n   flags\
    \ set.  The local BU is a BU defined in [1] and includes the\n   mobile node's\
    \ RCoA in the Home Address Option.  No alternate-CoA\n   option is needed in this\
    \ message.  The LCoA is used as the source\n   address of the BU.  This BU will\
    \ bind the mobile node's RCoA (similar\n   to a Home Address) to its LCoA.  The\
    \ MAP (acting as a HA) will then\n   perform DAD (when a new binding is being\
    \ created) for the mobile\n   node's RCoA on its link and return a Binding Acknowledgement\
    \ to the\n   MN.  This acknowledgement identifies the binding as successful or\n\
    \   contains the appropriate fault code.  No new error codes need to be\n   supported\
    \ by the mobile node for this operation.  The mobile node\n   MUST silently ignore\
    \ binding acknowledgements that do not contain a\n   routing header type 2, which\
    \ includes the mobile node's RCoA.\n   Following a successful registration with\
    \ the MAP, a bi-directional\n   tunnel between the mobile node and the MAP is\
    \ established.  All\n   packets sent by the mobile node are tunnelled to the MAP.\
    \  The outer\n   header contains the mobile node's LCoA in the source address\
    \ field\n   and the MAP's address in the destination address field.  The inner\n\
    \   header contains the mobile node's RCoA in the source address field\n   and\
    \ the peer's address in the destination address field.  Similarly,\n   all packets\
    \ addressed to the mobile node's RCoA are intercepted by\n   the MAP and tunnelled\
    \ to the mobile node's LCoA.\n   This specification allows a mobile node to use\
    \ more than one RCoA if\n   it received more than one MAP option.  In this case,\
    \ the mobile node\n   MUST perform the binding update procedure for each RCoA.\
    \  In\n   addition, the mobile node MUST NOT use one RCoA (e.g., RCoA1) derived\n\
    \   from a MAP's prefix (e.g., MAP1) as a care-of address in its binding\n   update\
    \ to another MAP (e.g., MAP2).  This would force packets to be\n   encapsulated\
    \ several times (twice in this example) on their path to\n   the mobile node.\
    \  This form of multi-level hierarchy will reduce the\n   protocol's efficiency\
    \ and performance.\n   After registering with the MAP, the mobile node MUST register\
    \ its new\n   RCoA with its HA by sending a BU that specifies the binding (RCoA,\n\
    \   Home Address) as in Mobile IPv6.  The mobile node's Home Address is\n   used\
    \ in the home address option and the RCoA is used as the care-of\n   address in\
    \ the source address field.  The mobile node may also send a\n   similar BU (i.e.,\
    \ that specifies the binding between the Home Address\n   and the RCoA) to its\
    \ current correspondent nodes.\n   The mobile node SHOULD wait for the binding\
    \ acknowledgement from the\n   MAP before registering with its HA.  It should\
    \ be noted that when\n   binding the RCoA with the HA and correspondent nodes,\
    \ the binding\n   lifetime MUST NOT be larger than the mobile node's binding lifetime\n\
    \   with the MAP, which is received in the Binding Acknowledgement.\n   In order\
    \ to speed up the handover between MAPs and reduce packet\n   loss, a mobile node\
    \ SHOULD send a local BU to its previous MAP,\n   specifying its new LCoA.  Packets\
    \ in transit that reach the previous\n   MAP are then forwarded to the new LCoA.\n\
    \   The MAP will receive packets addressed to the mobile node's RCoA\n   (from\
    \ the HA or correspondent nodes).  Packets will be tunnelled from\n   the MAP\
    \ to the mobile node's LCoA.  The mobile node will de-capsulate\n   the packets\
    \ and process them in the normal manner.\n   When the mobile node moves within\
    \ the same MAP domain, it should only\n   register its new LCoA with its MAP.\
    \  In this case, the RCoA remains\n   unchanged.\n   Note that a mobile node may\
    \ send a BU containing its LCoA (instead of\n   its RCoA) to correspondent nodes,\
    \ which are connected to its same\n   link.  Packets will then be routed directly\
    \ without going through the\n   MAP.\n"
- title: 6.1.1.  Sending Packets to Correspondent Nodes
  contents:
  - "6.1.1.  Sending Packets to Correspondent Nodes\n   The mobile node can communicate\
    \ with a correspondent node through the\n   HA, or in a route-optimised manner,\
    \ as described in [1].  When\n   communicating through the HA, the message formats\
    \ in [1] can be re-\n   used.\n   If the mobile node communicates directly with\
    \ the correspondent node\n   (i.e., the CN has a binding cache entry for the mobile\
    \ node), the\n   mobile node MUST use the same care-of address used to create\
    \ a\n   binding cache entry in the correspondent node (RCoA) as a source\n   address.\
    \  According to [1], the mobile node MUST also include a Home\n   Address option\
    \ in outgoing packets.  The Home address option MUST\n   contain the mobile node's\
    \ home address.\n"
- title: 6.2.  MAP Operations
  contents:
  - "6.2.  MAP Operations\n   The MAP acts like a HA; it intercepts all packets addressed\
    \ to\n   registered mobile nodes and tunnels them to the corresponding LCoA,\n\
    \   which is stored in its binding cache.\n   A MAP has no knowledge of the mobile\
    \ node's Home address.  The mobile\n   node will send a local BU to the MAP with\
    \ the M and A flags set.  The\n   aim of this BU is to inform the MAP that the\
    \ mobile node has formed\n   an RCoA (contained in the BU as a Home address).\
    \  If successful, the\n   MAP MUST return a binding acknowledgement to the mobile\
    \ node,\n   indicating a successful registration.  This is identical to the HA\n\
    \   operation in [1].  No new error codes are introduced for HMIPv6.  The\n  \
    \ binding acknowledgement MUST include a routing header type 2 that\n   contains\
    \ the mobile node's RCoA.\n   The MAP MUST be able to accept packets tunnelled\
    \ from the mobile\n   node, with the mobile node being the tunnel entry point\
    \ and the MAP\n   being the tunnel exit point.\n   The MAP acts as a HA for the\
    \ RCoA.  Packets addressed to the RCOA are\n   intercepted by the MAP, using proxy\
    \ Neighbour Advertisement, and then\n   encapsulated and routed to the mobile\
    \ node's LCoA.  This operation is\n   identical to that of the HA described in\
    \ [1].\n   A MAP MAY be configured with the list of valid on-link prefixes that\n\
    \   mobile nodes can use to derive LCoAs.  This is useful for network\n   operators\
    \ to stop mobile nodes from continuing to use the MAP after\n   moving to a different\
    \ administrative domain.  If a mobile node sent a\n   binding update containing\
    \ an LCoA that is not in the MAP's \"valid\n   on-link prefixes\" list, the MAP\
    \ could reject the binding update using\n   existing error code 129 (administratively\
    \ prohibited).\n"
- title: 6.3.  Home Agent Operations
  contents:
  - "6.3.  Home Agent Operations\n   The support of HMIPv6 is completely transparent\
    \ to the HA's\n   operation.  Packets addressed to a mobile node's Home Address\
    \ will be\n   forwarded by the HA to its RCoA, as described in [1].\n"
- title: 6.4.  Correspondent Node Operations
  contents:
  - "6.4.  Correspondent Node Operations\n   HMIPv6 is completely transparent to correspondent\
    \ nodes.\n"
- title: 6.5.  Local Mobility Management Optimisation within a MAP Domain
  contents:
  - "6.5.  Local Mobility Management Optimisation within a MAP Domain\n   In [1],\
    \ it is stated that for short-term communication, particularly\n   communication\
    \ that may easily be retried upon failure, the mobile\n   node MAY choose to directly\
    \ use one of its care-of addresses as the\n   source of the packet, thus not requiring\
    \ the use of a Home Address\n   option in the packet.  Such use of the CoA will\
    \ reduce the overhead\n   of sending each packet due to the absence of additional\
    \ options.  In\n   addition, it will provide an optimal route between the mobile\
    \ node\n   and correspondent node.\n   In HMIPv6, a mobile node can use its RCoA\
    \ as the source address\n   without using a Home Address option.  In other words,\
    \ the RCoA can be\n   used as a potential source address for upper layers.  Using\
    \ this\n   feature, the mobile node will be seen by the correspondent node as\
    \ a\n   fixed node while moving within a MAP domain.\n   This usage of the RCoA\
    \ does not have the cost of Mobile IPv6 (i.e.,\n   no bindings or home address\
    \ options are sent over the Internet), but\n   still provides local mobility management\
    \ to the mobile nodes.\n   Although such use of RCoA does not provide global mobility\
    \ (i.e.,\n   communication is broken when a mobile host moves to a new MAP), it\n\
    \   would be useful for several applications (e.g., web browsing).  The\n   validity\
    \ of the RCoA as a source address used by applications will\n   depend on the\
    \ size of a MAP domain and the speed of the mobile node.\n   Furthermore, because\
    \ the support for BU processing in correspondent\n   nodes is not mandated in\
    \ [1], this mechanism can provide a way of\n   obtaining route optimisation without\
    \ sending BUs to the correspondent\n   nodes.\n   Enabling this mechanism can\
    \ be done by presenting the RCoA as a\n   temporary home address for the mobile\
    \ node.  This may require an\n   implementation to augment its source address\
    \ selection algorithm with\n   the knowledge of the RCoA in order to use it for\
    \ the appropriate\n   applications.\n"
- title: 6.6.  Location Privacy
  contents:
  - "6.6.  Location Privacy\n   In HMIPv6, a mobile node hides its LCoA from its corresponding\
    \ nodes\n   and its home agent by using its RCoA in the source field of the\n\
    \   packets that it sends.  As a result, the location tracking of a\n   mobile\
    \ node by its corresponding nodes or its home agent is difficult\n   because they\
    \ only know its RCoA and not its LCoA.\n"
- title: 7.  MAP Discovery
  contents:
  - "7.  MAP Discovery\n   This section describes how a mobile node obtains the MAP\
    \ address and\n   subnet prefix, and how ARs in a domain discover MAPs.  Two different\n\
    \   methods for MAP discovery are defined below.\n   Dynamic MAP Discovery is\
    \ based on propagating the MAP option in\n   Router Advertisements from the MAP\
    \ to the mobile node through certain\n   (configured) router interfaces within\
    \ the routers in an operator's\n   network.  This requires manual configuration\
    \ of the MAP and also that\n   the routers receiving the MAP option allow them\
    \ to propagate the\n   option on certain interfaces.  To ensure a secure communication\n\
    \   between routers, router advertisements that are sent between routers\n   for\
    \ Dynamic MAP discovery SHOULD be authenticated (e.g., using AH,\n   ESP, or SEND).\
    \  In the case where this authentication is not possible\n   (e.g., third party\
    \ routers exist between the MAP and ARs), a network\n   operator may prefer to\
    \ manually configure all the ARs to send the MAP\n   option, as described in this\
    \ document.\n   Manual configuration of the MAP option information in ARs and\
    \ other\n   MAPs in the same domain is the default mechanism.  It should also\
    \ be\n   possible to configure ARs and MAPs to enable dynamic mechanisms for\n\
    \   MAP Discovery.\n"
- title: 7.1.  Dynamic MAP Discovery
  contents:
  - "7.1.  Dynamic MAP Discovery\n   The process of MAP discovery can be performed\
    \ in different ways.\n   Router advertisements are used for Dynamic MAP Discovery\
    \ by\n   introducing a new option.  The access router is required to send the\n\
    \   MAP option in its router advertisements.  This option includes the\n   distance\
    \ vector from the mobile node (which may not imply the real\n   distance in terms\
    \ of the number of hops), the preference for this\n   particular MAP, the MAP's\
    \ global IP address and subnet prefix\n"
- title: 7.1.1.  Router Operation for Dynamic MAP Discovery
  contents:
  - "7.1.1.  Router Operation for Dynamic MAP Discovery\n   The ARs within a MAP domain\
    \ may be configured dynamically with the\n   information related to the MAP options.\
    \  ARs may obtain this\n   information by listening for RAs with MAP options.\
    \  Each MAP in the\n   network needs to be configured with a default preference,\
    \ the right\n   interfaces to send this option on, and the IP address to be sent.\n\
    \   The initial value of the \"Distance\" field MAY be set to a default\n   value\
    \ of 1 and MUST NOT be set to zero.  Routers in the MAP domain\n   should be configured\
    \ to re-send the MAP option on certain interfaces.\n   Upon reception of a router\
    \ advertisement with the MAP option, the\n   receiving router MUST copy the option\
    \ and re-send it after\n   incrementing the Distance field by one.  If the receiving\
    \ router was\n   also a MAP, it MUST send its own option, together with the received\n\
    \   option, in the same advertisement.  If a router receives more than\n   one\
    \ MAP option for the same MAP (i.e., the same IP address in the MAP\n   option),\
    \ from two different interfaces, it MUST choose the option\n   with the smallest\
    \ distance field.\n   In this manner, information about one or more MAPs can be\
    \ dynamically\n   passed to a mobile node.  Furthermore, by performing the discovery\n\
    \   phase in this way, different MAP nodes are able to change their\n   preferences\
    \ dynamically based on the local policies, node overload or\n   other load-sharing\
    \ protocols being used.\n"
- title: 7.1.2.  MAP Operation for Dynamic MAP Discovery
  contents:
  - "7.1.2.  MAP Operation for Dynamic MAP Discovery\n   A MAP will be configured\
    \ to send its option or relay MAP options\n   belonging to other MAPs onto certain\
    \ interfaces.  The choice of\n   interfaces is done by the network administrator\
    \ (i.e., manual\n   configuration) and depends on the network topology.  A default\n\
    \   preference value of 10 may be assigned to each MAP.  It should be\n   noted\
    \ that a MAP can change its preference value at any time due to\n   various reasons\
    \ (e.g., node overload or load sharing).  A preference\n   value of zero means\
    \ the MAP SHOULD NOT be chosen by new mobile nodes.\n   This value could be reached\
    \ in cases of node overload or partial node\n   failures.\n   The MAP option is\
    \ propagated towards ARs in its domain.  Each router\n   along the path to an\
    \ AR will increment the Distance field by one.  If\n   a router that is also a\
    \ MAP receives advertisements from other MAPs,\n   it MUST add its own MAP option\
    \ and propagate both options to the next\n   router or to the AR (if it has direct\
    \ connectivity with the AR).\n"
- title: 7.2.  Mobile Node Operation
  contents:
  - "7.2.  Mobile Node Operation\n   When an HMIPv6-aware mobile node receives a router\
    \ advertisement, it\n   should search for the MAP option.  One or more options\
    \ may be found\n   for different MAP IP addresses.\n   A mobile node SHOULD register\
    \ with the MAP having the highest\n   preference value.  A MAP with a preference\
    \ value of zero SHOULD NOT\n   be used for new local BUs (i.e., the mobile node\
    \ can refresh existing\n   bindings but cannot create new ones).  However, a mobile\
    \ node MAY\n   choose to register with one MAP over another, depending on the\
    \ value\n   received in the Distance field, provided that the preference value\
    \ is\n   above zero.\n   A MAP option containing a valid lifetime value of zero\
    \ means that\n   this MAP MUST NOT be selected by the MN.  A valid lifetime of\
    \ zero\n   indicates a MAP failure.  When this option is received, a mobile node\n\
    \   MUST choose another MAP and create new bindings.  Any existing\n   bindings\
    \ with this MAP can be assumed to be lost.  If no other MAP is\n   available,\
    \ the mobile node MUST revert to using the Mobile IPv6\n   protocol, as specified\
    \ in [1].\n   If a multihomed mobile node has access to several ARs simultaneously\n\
    \   (on different interfaces), it SHOULD use an LCoA on the link defined\n   by\
    \ the AR that advertises its current MAP.\n   A mobile node MUST store the received\
    \ option(s) in order to choose at\n   least one MAP to register with.  Storing\
    \ the options is essential, as\n   they will be compared to other options received\
    \ later for the purpose\n   of the movement detection algorithm.\n   If no MAP\
    \ options are found in the router advertisement, the mobile\n   node MUST use\
    \ the Mobile IPv6 protocol, as specified in [1].\n   If the R flag is set, the\
    \ mobile node MUST use its RCoA as the Home\n   Address when performing the MAP\
    \ registration.  RCoA is then bound to\n   the LCoA in the MAP's Binding Cache.\n\
    \   A mobile node MAY choose to register with more than one MAP\n   simultaneously,\
    \ or use both the RCoA and its LCoA as care-of\n   addresses simultaneously with\
    \ different correspondent nodes.\n"
- title: 8.  Updating Previous MAPs
  contents:
  - "8.  Updating Previous MAPs\n   When a mobile node moves into a new MAP domain,\
    \ the mobile node may\n   send a BU to the previous MAP requesting it to forward\
    \ packets\n   addressed to the mobile node's new CoA.  An administrator MAY\n\
    \   restrict the MAP from forwarding packets to LCoAs outside the MAP's\n   domain.\
    \  However, it is RECOMMENDED that MAPs be allowed to forward\n   packets to LCoAs\
    \ associated with some of the ARs in neighbouring MAP\n   domains, provided that\
    \ they are located within the same\n   administrative domain.\n   For instance,\
    \ a MAP could be configured to forward packets to LCoAs\n   associated with ARs\
    \ that are geographically adjacent to ARs on the\n   boundary of its domain. \
    \ This will allow for a smooth inter-MAP\n   handover as it allows the mobile\
    \ node to continue to receive packets\n   while updating the new MAP, its HA and,\
    \ potentially, correspondent\n   nodes.\n"
- title: 9.  Notes on MAP Selection by the Mobile Node
  contents:
  - "9.  Notes on MAP Selection by the Mobile Node\n   HMIPv6 provides a flexible\
    \ mechanism for local mobility management\n   within a visited network.  As explained\
    \ earlier, a MAP can exist\n   anywhere in the operator's network (including the\
    \ AR).  Several MAPs\n   can be located within the same domain independently of\
    \ each other.\n   In addition, overlapping MAP domains are also allowed and\n\
    \   recommended.  Both static and dynamic hierarchies are supported.\n   When\
    \ the mobile node receives a router advertisement including a MAP\n   option,\
    \ it should perform actions according to the following movement\n   detection\
    \ mechanisms.  In a Hierarchical Mobile IP network such as\n   the one described\
    \ in this document, the mobile node should be:\n      - \"Eager\" to perform new\
    \ bindings\n      - \"Lazy\" in releasing existing bindings\n   The above means\
    \ that the mobile node should register with any \"new\"\n   MAP advertised by\
    \ the AR (Eager).  The method by which the mobile\n   node determines whether\
    \ the MAP is a \"new\" MAP is described in\n   section 9.1.  The mobile node should\
    \ not release existing bindings\n   until it no longer receives the MAP option\
    \ (or receives it with a\n   lifetime of zero) or the lifetime of its existing\
    \ binding expires\n   (Lazy).  This Eager-Lazy approach, described above, will\
    \ assist in\n   providing a fallback mechanism in case of the failure of one of\
    \ the\n   MAP routers, as it will reduce the time it takes for a mobile node to\n\
    \   inform its correspondent nodes and HA about its new care-of address.\n"
- title: 9.1.  MAP Selection in a Distributed-MAP Environment
  contents:
  - "9.1.  MAP Selection in a Distributed-MAP Environment\n   The mobile node needs\
    \ to consider several factors to optimally select\n   one or more MAPs, where\
    \ several MAPs are available in the same\n   domain.\n   There are no benefits\
    \ foreseen in selecting more than one MAP and\n   forcing packets to be sent from\
    \ the higher MAP down through a\n   hierarchy of MAPs.  This approach may add\
    \ forwarding delays and\n   eliminate the robustness of IP routing between the\
    \ highest MAP and\n   the mobile node; therefore, it is prohibited by this specification.\n\
    \   Allowing more than one MAP (\"above\" the AR) within a network should\n  \
    \ not imply that the mobile node forces packets to be routed down the\n   hierarchy\
    \ of MAPs.  However, placing more than one MAP \"above\" the AR\n   can be used\
    \ for redundancy and as an optimisation for the different\n   mobility scenarios\
    \ experienced by mobile nodes.  The MAPs are used\n   independently of each other\
    \ by the MN (e.g., each MAP is used for\n   communication to a certain set of\
    \ CNs).\n   In terms of the Distance-based selection in a network with several\n\
    \   MAPs, a mobile node may choose to register with the furthest MAP to\n   avoid\
    \ frequent re-registrations.  This is particularly important for\n   fast mobile\
    \ nodes that will perform frequent handoffs.  In this\n   scenario, the choice\
    \ of a more distant MAP would reduce the\n   probability of having to change a\
    \ MAP and informing all correspondent\n   nodes and the HA.  This specification\
    \ does not provide an algorithm\n   for the distance-based MAP selection.  However,\
    \ such an algorithm may\n   be introduced in future extensions utilising information\
    \ about the\n   speed of mobility from lower layers.\n   In a scenario where several\
    \ MAPs are discovered by the mobile node in\n   one domain, the mobile node may\
    \ need some sophisticated algorithms to\n   be able to select the appropriate\
    \ MAP.  These algorithms would have\n   the mobile node speed as an input (for\
    \ distance based selection)\n   combined with the preference field in the MAP\
    \ option.  However, this\n   specification proposes that the mobile node uses\
    \ the following\n   algorithm as a default, where other optimised algorithms are\
    \ not\n   available.  The following algorithm is simply based on selecting the\n\
    \   MAP that is most distant, provided that its preference value did not\n   reach\
    \ a value of zero.  The mobile node operation is shown below:\n   1.  Receive\
    \ and parse all MAP options\n   2.  Arrange MAPs in a descending order, starting\
    \ with the furthest\n       away MAP (i.e., MAP option having largest Dist field)\n\
    \   3.  Select first MAP in list\n   4.  If either the preference value or the\
    \ valid lifetime fields are\n       set to zero, select the following MAP in the\
    \ list.\n   5.  Repeat step (4) while new MAP options still exist, until a MAP\
    \ is\n       found with a non-zero preference value and a non-zero valid\n   \
    \    lifetime.\n   Implementing the steps above would result in mobile nodes selecting,\n\
    \   by default, the most distant or furthest available MAP.  This will\n   continue\
    \ until the preference value reduces to zero.  Following this,\n   mobile nodes\
    \ will start selecting another MAP.\n"
- title: 9.2.  MAP Selection in a Flat Mobility Management Architecture
  contents:
  - "9.2.  MAP Selection in a Flat Mobility Management Architecture\n   Network operators\
    \ may choose a flat architecture in some cases where\n   a Mobile IPv6 handover\
    \ may be considered a rare event.  In these\n   scenarios, operators may choose\
    \ to include the MAP function in ARs\n   only.  The inclusion of the MAP function\
    \ in ARs can still be useful\n   to reduce the time required to update all correspondent\
    \ nodes and the\n   HA.  In this scenario, a mobile node may choose a MAP (in\
    \ the AR) as\n   an anchor point when performing a handoff.  This kind of dynamic\n\
    \   hierarchy (or anchoring) is only recommended for cases where inter-AR\n  \
    \ u0movement is not frequent.\n"
- title: 10.  Detection and Recovery from MAP Failures
  contents:
  - "10.  Detection and Recovery from MAP Failures\n   This specification introduces\
    \ a MAP that can be seen as a local Home\n   Agent in a visited network.  A MAP,\
    \ like a Home Agent, is a single\n   point of failure.  If a MAP fails, its binding\
    \ cache content will be\n   lost, resulting in loss of communication between mobile\
    \ and\n   correspondent nodes.  This situation may be avoided by using more\n\
    \   than one MAP on the same link and by utilising some form of context\n   transfer\
    \ protocol between them.  Alternatively, future versions of\n   the Virtual Router\
    \ Redundancy Protocol [4] or HA redundancy protocols\n   may allow networks to\
    \ recover from MAP failures.\n   In cases where such protocols are not supported,\
    \ the mobile node\n   would need to detect MAP failures.  The mobile node can\
    \ detect this\n   situation when it receives a router advertisement containing\
    \ a MAP\n   option with a lifetime of zero.  The mobile node should start the\
    \ MAP\n   discovery process and attempt to register with another MAP.  After it\n\
    \   has selected and registered with another MAP, it will also need to\n   inform\
    \ correspondent nodes and the Home Agent if its RCoA has\n   changed.  Note that\
    \ in the presence of a protocol that transfers\n   binding cache entries between\
    \ MAPs for redundancy purposes, a new MAP\n   may be able to provide the same\
    \ RCoA to the mobile node (e.g., if\n   both MAPs advertise the same prefix in\
    \ the MAP option).  This would\n   save the mobile node from updating correspondent\
    \ nodes and the Home\n   Agent.\n   Access routers can be triggered to advertise\
    \ a MAP option with a\n   lifetime of zero (indicating MAP failure) in different\
    \ ways:\n      - By manual intervention.\n      - In a dynamic manner.\n   ARs\
    \ can perform Dynamic detection of MAP failure by sending ICMP Echo\n   request\
    \ messages to the MAP regularly (e.g., every ten seconds).  If\n   no response\
    \ is received, an AR may try to aggressively send echo\n   requests to the MAP\
    \ for a short period of time (e.g., once every 5\n   seconds for 15 seconds);\
    \ if no reply is received, a MAP option may be\n   sent with a valid lifetime\
    \ value of zero.\n   This specification does not mandate a particular recovery\
    \ mechanism.\n   However, any similar mechanism between the MAP and an AR SHOULD\
    \ be\n   secure to allow for message authentication, integrity protection, and\n\
    \   protection against replay attacks.\n"
- title: 11.  IANA Considerations
  contents:
  - "11.  IANA Considerations\n   Section 4 introduces a new flag (M) to the Binding\
    \ Update specified\n   in RFC 3775.\n   Section 5 introduces a new IPv6 Neighbour\
    \ Discovery Option called the\n   MAP Option.  IANA has assigned the Option Type\
    \ value 23 for the MAP\n   Option within the option numbering space for IPv6 Neighbour\
    \ Discovery\n   messages.\n"
- title: 12.  Security Considerations
  contents:
  - "12.  Security Considerations\n   This specification introduces a new concept\
    \ to Mobile IPv6, namely, a\n   Mobility Anchor Point that acts as a local Home\
    \ Agent.  It is crucial\n   that the security relationship between the mobile\
    \ node and the MAP is\n   strong; it MUST involve mutual authentication, integrity\
    \ protection,\n   and protection against replay attacks.  Confidentiality may\
    \ be needed\n   for payload traffic, but is not required for binding updates to\
    \ the\n   MAP.  The absence of any of these protections may lead to malicious\n\
    \   mobile nodes impersonating other legitimate ones or impersonating a\n   MAP.\
    \  Any of these attacks will undoubtedly cause undesirable impacts\n   to the\
    \ mobile node's communication with all correspondent nodes\n   having knowledge\
    \ of the mobile node's RCoA.\n   Three different relationships (related to securing\
    \ binding updates)\n   need to be considered:\n      1) The mobile node - MAP\n\
    \      2) The mobile node - Home Agent\n      3) The mobile node - correspondent\
    \ node\n"
- title: 12.1.  Mobile Node-MAP Security
  contents:
  - "12.1.  Mobile Node-MAP Security\n   In order to allow a mobile node to use the\
    \ MAP's forwarding service,\n   initial authorisation (specifically for the service,\
    \ not for the\n   RCoA) MAY be needed.  Authorising a mobile node to use the MAP\n\
    \   service can be done based on the identity of the mobile node\n   exchanged\
    \ during the SA negotiation process.  The authorisation may\n   be granted based\
    \ on the mobile node's identity, or based on the\n   identity of a Certificate\
    \ Authority (CA) that the MAP trusts.  For\n   instance, if the mobile node presents\
    \ a certificate signed by a\n   trusted entity (e.g., a CA that belongs to the\
    \ same administrative\n   domain, or another trusted roaming partner), it would\
    \ be sufficient\n   for the MAP to authorise the use of its service.  Note that\
    \ this\n   level of authorisation is independent of authorising the use of a\n\
    \   particular RCoA.  Similarly, the mobile node would trust the MAP if\n   it\
    \ presents a certificate signed by the same CA or by another CA that\n   the mobile\
    \ node is configured to trust (e.g., a roaming partner).\n   HMIPv6 uses an additional\
    \ registration between the mobile node and\n   its current MAP.  As explained\
    \ in this document, when a mobile node\n   moves into a new domain (i.e., served\
    \ by a new MAP), it obtains an\n   RCoA, an LCoA and registers the binding between\
    \ these two addresses\n   with the new MAP.  The MAP then verifies whether the\
    \ RCoA has not\n   been registered yet and, if so, it creates a binding cache\
    \ entry with\n   the RCoA and LCoA.  Whenever the mobile node gets a new LCoA,\
    \ it\n   needs to send a new BU that specifies the binding between RCoA and\n\
    \   its new LCoA.  This BU needs to be authenticated, otherwise any host\n   could\
    \ send a BU for the mobile node's RCoA and hijack the mobile\n   node's packets.\
    \  However, because the RCoA is temporary and is not\n   bound to a particular\
    \ node, a mobile node does not have to initially\n   (before the first binding\
    \ update) prove that it owns its RCoA (unlike\n   the requirement on home addresses\
    \ in Mobile IPv6) when it establishes\n   a Security Association with its MAP.\
    \  A MAP only needs to ensure that\n   a BU for a particular RCoA was issued by\
    \ the same mobile node that\n   established the Security Association for that\
    \ RCoA.\n   The MAP does not need to have prior knowledge of the identity of the\n\
    \   mobile node nor its Home Address.  As a result the SA between the\n   mobile\
    \ node and the MAP can be established using any key\n   establishment protocols\
    \ such as IKE.  A return routability test is\n   not necessary.\n   The MAP needs\
    \ to set the SA for the RCoA (not the LCoA).  This can be\n   performed with IKE\
    \ [2].  The mobile node uses its LCoA as the source\n   address, but specifies\
    \ that the RCoA should be used in the SA.  This\n   is achieved by using the RCoA\
    \ as the identity in IKE Phase 2\n   negotiation.  This step is identical to the\
    \ use of the home address\n   in IKE phase 2.\n   If a binding cache entry exists\
    \ for a given RCoA, the MAP's IKE\n   policy check MUST point to the SA used to\
    \ install the entry.  If the\n   mobile node's credentials stored in the existing\
    \ SA do not match the\n   ones provided in the current negotiation, the MAP MUST\
    \ reject the new\n   SA establishment request for such RCoA with an INVALID-ID-INFORMATION\n\
    \   notification [2].  This is to prevent two different mobile nodes from\n  \
    \ registering (intentionally or not) the same RCoA.  Upon receiving\n   this notification,\
    \ the mobile node SHOULD generate a new RCoA and\n   restart the IKE negotiation.\
    \  Alternatively, a MAP may decide that,\n   if a binding cache entry already\
    \ exists for a particular RCoA, no new\n   security association should be established\
    \ for such RCoA; this is\n   independent of the mobile node credentials.  This\
    \ prevents the mobile\n   node from being able to re-establish a security association\
    \ for the\n   same RCoA (i.e., to change session keys).  However, this is not\
    \ a\n   major problem because the SA will typically only be used to protect\n\
    \   signalling traffic when a MN moves, and not for the actual data\n   traffic\
    \ sent to arbitrary nodes.\n   Binding updates between the MAP and the mobile\
    \ node MUST be protected\n   with either AH or ESP in transport mode.  When ESP\
    \ is used, a non-\n   null authentication algorithm MUST be used.\n"
- title: 12.2.  Mobile Node-Correspondent Node Security
  contents:
  - "12.2.  Mobile Node-Correspondent Node Security\n   Mobile IPv6 [1] defines a\
    \ return routability procedure that allows\n   mobile and correspondent nodes\
    \ to authenticate binding updates and\n   acknowledgements.  This specification\
    \ does not impact the return\n   routability test defined in [1].  However, it\
    \ is important to note\n   that mobile node implementers need to be careful when\
    \ selecting the\n   source address of the HOTI and COTI messages, defined in [1].\
    \  The\n   source address used in HOTI messages MUST be the mobile node's home\n\
    \   address.  The packet containing the HOTI message is encapsulated\n   twice.\
    \  The inner encapsulating header contains the RCoA in the\n   source address\
    \ field and the home agent's address in the destination\n   address field.  The\
    \ outer encapsulating header contains the mobile\n   node's LCoA in the source\
    \ address field and the MAP's address in the\n   destination field.\n"
- title: 12.3.  Mobile Node-Home Agent Security
  contents:
  - "12.3.  Mobile Node-Home Agent Security\n   The security relationship between\
    \ the mobile node and its Home Agent,\n   as discussed in [1], is not impacted\
    \ by this specification.\n"
- title: 13.  Acknowledgments
  contents:
  - "13.  Acknowledgments\n   The authors would like to thank Conny Larsson (Ericsson)\
    \ and Mattias\n   Pettersson (Ericsson) for their valuable input to this document.\
    \  The\n   authors would also like to thank the members of the French RNRT\n \
    \  MobiSecV6 project (BULL, France Telecom and INRIA) for testing the\n   first\
    \ implementation and for their valuable feedback.  The INRIA\n   HMIPv6 project\
    \ is partially funded by the French Government.\n   In addition, the authors would\
    \ like to thank the following members of\n   the working group in alphabetical\
    \ order: Samita Chakrabarti (Sun),\n   Gregory Daley (Monash University), Francis\
    \ Dupont (GET/Enst\n   Bretagne), Gopal Dommety (Cisco), Eva Gustaffson (Ericsson),\
    \ Dave\n   Johnson (Rice University), Annika Jonsson (Ericsson), James Kempf\n\
    \   (Docomo labs), Martti Kuparinen (Ericsson) Fergal Ladley, Gabriel\n   Montenegro\
    \ (Sun), Nick \"Sharkey\" Moore (Monash University) Erik\n   Nordmark (Sun), Basavaraj\
    \ Patil (Nokia), Brett Pentland (Monash\n   University), and Alper Yegin (Samsung)\
    \ for their comments on the\n   document.\n"
- title: 14.  References
  contents:
  - '14.  References

    '
- title: 14.1.  Normative References
  contents:
  - "14.1.  Normative References\n   [1]  Johnson, D., Perkins, C., and J. Arkko,\
    \ \"Mobility Support in\n        IPv6\", RFC 3775, June 2004.\n   [2]  Kent, S.\
    \ and R. Atkinson, \"IP Authentication Header\", RFC 2402,\n        November 1998.\n\
    \   [3]  Bradner, S., \"Key words for use in RFCs to Indicate Requirement\n  \
    \      Levels\", BCP 14, RFC 2119, March 1997.\n"
- title: 14.2.  Informative References
  contents:
  - "14.2.  Informative References\n   [4]  Koodli, R., \"Fast Handovers for Mobile\
    \ IPv6\", RFC 4068, July\n        2005.\n   [5]  Ferguson, P. and D. Senie, \"\
    Network Ingress Filtering: Defeating\n        Denial of Service Attacks which\
    \ employ IP Source Address\n        Spoofing\", BCP 38, RFC 2827, May 2000.\n\
    \   [6]  Arkko, J., Kempf, J., Zill, B., and P. Nikander, \"SEcure\n        Neighbor\
    \ Discovery (SEND)\", RFC 3971, March 2005.\n"
- title: 'Appendix A: Fast Mobile IPv6 Handovers and HMIPv6'
  contents:
  - "Appendix A: Fast Mobile IPv6 Handovers and HMIPv6\n   Fast Handovers are required\
    \ to ensure that the layer 3 (Mobile IP)\n   handover delay is minimised, thus\
    \ also minimising, and possibly\n   eliminating, the period of service disruption\
    \ which normally occurs\n   when a mobile node moves between two ARs.  This period\
    \ of service\n   disruption usually occurs due to the time required by the mobile\
    \ node\n   to update its HA using Binding Updates after it moves between ARs.\n\
    \   During this time period the mobile node cannot resume or continue\n   communications.\
    \  The mechanism to achieve Fast Handovers with Mobile\n   IPv6 is described in\
    \ [5] and is briefly summarised here.  This\n   mechanism allows the anticipation\
    \ of the layer 3 handover, such that\n   data traffic can be redirected to the\
    \ mobile node's new location\n   before it moves there.\n   While the mobile node\
    \ is connected to its previous Access Router\n   (PAR) and is about to move to\
    \ a new Access Router (NAR), the Fast\n   Handovers in Mobile IPv6 requires in\
    \ sequence:\n   1) The mobile node to obtain a new care-of address at the NAR\
    \ while\n      connected to the PAR.\n   2) New CoA to be used at NAR case: the\
    \ mobile node to send a F-BU\n      (Fast BU) to its previous anchor point (i.e.,\
    \ PAR) to update its\n      binding cache with the mobile node's new CoA while\
    \ still attached\n      to PAR.\n   3) The previous anchor point (i.e., PAR) to\
    \ start forwarding packets\n      destined for the mobile node to the mobile node's\
    \ new CoA at NAR\n      (or old CoA tunnelled to NAR, if new CoA is not applicable).\n\
    \   4) Old CoA to be used at NAR case: the mobile node to send a F-BU\n      (Fast\
    \ BU) to its previous anchor point (i.e., PAR), after it has\n      moved and\
    \ attached to NAR, in order to update its binding cache\n      with the mobile\
    \ node's new CoA.\n   The mobile node or PAR may initiate the Fast Handover procedure\
    \ by\n   using wireless link-layer information or link-layer triggers that\n \
    \  inform that the mobile node will soon be handed off between two\n   wireless\
    \ access points respectively attached to PAR and NAR.  If the\n   \"trigger\"\
    \ is received at the mobile node, the mobile node will\n   initiate the layer-3\
    \ handover process by sending a Proxy Router\n   Solicitation message to PAR.\
    \  Instead, if the \"trigger\" is received\n   at PAR, then it will transmit a\
    \ Proxy Router Advertisement to the\n   appropriate mobile node, without the need\
    \ for solicitations.  The\n   basic Fast Handover message exchanges are illustrated\
    \ in Figure A.1.\n                        +-----------+  1a. HI          +-----+\n\
    \                        |           | ---------------->| NAR |\n            \
    \            |    PAR    |  1b. HAck        |     |\n                        +-----------+\
    \ <--------------- +-----+\n                        ^  |        ^\n          (2a.\
    \ RtSolPr) |  | 2b     |\n                        |  | Pr     | 3. Fast BU (F-BU)\n\
    \                        |  | RtAdv  | 4. Fast BA  (F-BACK)\n                \
    \        |  v        v\n                        +------------+\n             \
    \           |    MN      |\n                        +------------+    - - - -\
    \ - ->\n                                          Movement\n             Figure\
    \ A.1: Fast Mobile IPv6 Handover Protocol\n   The mobile node obtains a new care-of\
    \ address while connected to PAR\n   by means of router advertisements containing\
    \ information from the NAR\n   (Proxy Router Advertisement, which may be sent\
    \ due to a Proxy Router\n   Solicitation).  The PAR will validate the mobile node's\
    \ new CoA by\n   sending a Handover Initiate (HI) message to the NAR.  The new\
    \ CoA\n   sent in the HI message is formed by appending the mobile node's\n  \
    \ current interface identifier to the NAR's prefix.  Based on the\n   response\
    \ generated in the Handover Acknowledge (HAck) message, the\n   PAR will either\
    \ generate a tunnel to the mobile node's new CoA (if\n   the address was valid)\
    \ or generate a tunnel to the NAR's address (if\n   the address was already in\
    \ use on the new subnet).  If the address\n   was already in use on the new subnet,\
    \ it is assumed that there will\n   be no time to perform another attempt to configure\
    \ the mobile node\n   with a CoA on the new link.  Therefore, the NAR will generate\
    \ a host\n   route for the mobile node using its old CoA.  Note that message 1a\n\
    \   may precede message 2b or occur at the same time.\n   In [5], the ARs act\
    \ as local Home Agents, which hold binding caches\n   for the mobile nodes and\
    \ receive Binding Updates.  This makes these\n   ARs function like the MAP specified\
    \ in this document.  Also, it is\n   quite possible that the ARs are not directly\
    \ connected, but\n   communicate through an aggregation router.  Therefore, such\
    \ an\n   aggregation router is also an ideal position for the MAP\n   functionality.\
    \  These are two ways of integrating the HMIPv6 and Fast\n   Handover mechanisms.\
    \  The first involves placing MAPs in place of the\n   ARs, which is a natural\
    \ step.  The second scenario involves placing\n   the MAP in an aggregation router\
    \ \"above\" the ARs.  In this case, [5]\n   specifies forwarding of packets between\
    \ PAR and NAR.  This could be\n   inefficient in terms of delay and bandwidth\
    \ efficiency because\n   packets will traverse the MAP-PAR link twice and packets\
    \ will arrive\n   out of order at the mobile node.  Using the MAP in the aggregation\n\
    \   router would improve the efficiency of Fast Handovers, which could\n   make\
    \ use of the MAP to redirect traffic, thus saving delay and\n   bandwidth between\
    \ the aggregation router and the PAR.\n                                      \
    \           +---------+\n                                                 |  \
    \ MAP   |\n                                 +-------------->|         |\n    \
    \                             |               +---------+\n                  \
    \               |                 |     ^\n                                 |\
    \          1a. HI |     |\n                                 |                \
    \ |     |\n                                 |                 |     | 1b. HAck\n\
    \                                 |                 v     |\n                \
    \  +---------+    |               +---------+\n                  |         | \
    \   |               |   NAR   |\n                  |   PAR   |    |          \
    \     |         |\n                  +---------+    |               +---------+\n\
    \                     ^  |        |\n       (2a. RtSolPr) |  | 2b     |\n    \
    \                 |  | Pr     | 3. Fast BU (F-BU) from mobile node to\n      \
    \               |  |             MAP\n                     |  | RtAdv  | 4. Fast\
    \ BA (F-BACK) from MAP to\n                     |  |        |    mobile node\n\
    \                     |  v        v\n                    +------------+\n    \
    \                |     MN     |    Movement\n                    +------------+\
    \    - - - - - ->\n       Figure A.2: Fast Mobile IPv6 Handover Protocol using\
    \ HMIPv6\n   In Figure A.2, the HI/HAck messages now occur between the MAP and\
    \ NAR\n   in order to check the validity of the newly requested care-of address\n\
    \   and to establish a temporary tunnel should the new care-of address\n   not\
    \ be valid.  Therefore, the same functionality of the Fast Handover\n   procedure\
    \ is kept, but the anchor point is moved from the PAR to the\n   MAP.\n   As in\
    \ the previous Fast Handover procedure, in the network-determined\n   case the\
    \ layer-2 \"triggers\" at the PAR will cause the PAR to send a\n   Proxy Router\
    \ Advertisement to the mobile node with the MAP option.\n   In the mobile-determined\
    \ case, this is preceded by a Proxy Router\n   Solicitation from the mobile node.\
    \  The same layer-2 trigger at PAR\n   in the network-determined case could be\
    \ used to independently\n   initiate Context Transfer (e.g., QoS) between PAR\
    \ and NAR.  In the\n   mobile-determined case, the trigger at PAR could be replaced\
    \ by the\n   reception of a Proxy Router Solicitation or F-BU.  Context Transfer\n\
    \   is being worked on in the IETF Seamoby WG.\n   The combination of Fast Handover\
    \ and HMIPv6 allows the anticipation\n   of the layer 3 handoff, such that data\
    \ traffic can be efficiently\n   redirected to the mobile node's new location\
    \ before it moves there.\n   However, it is not easy to determine the correct\
    \ time to start\n   forwarding traffic from the MAP to the mobile node's new location,\n\
    \   which has an impact on how smooth the handoff will be.  The same\n   issues\
    \ arise in [5] with respect to when to start forwarding between\n   PAR and NAR.\
    \  Packet loss will occur if this is performed too late or\n   too early with\
    \ respect to the time in which the mobile node detaches\n   from PAR and attaches\
    \ to NAR.  Such packet loss is likely to occur if\n   the MAP updates its binding\
    \ cache upon receiving the anticipated\n   F-BU, because it is not known exactly\
    \ when the mobile node will\n   perform or complete the layer-2 handover to NAR,\
    \ relative to when the\n   mobile node transmits the F-BU.  Also, some measure\
    \ is needed to\n   support the case in which the mobile node's layer-2 handover\n\
    \   unexpectedly fails (after Fast Handover has been initiated) or when\n   the\
    \ mobile node moves quickly back-and-forth between ARs (ping-pong).\n   Simultaneous\
    \ bindings [6] provide a solution to these issues.  In\n   [6], a new Simultaneous\
    \ Bindings Flag is added to the Fast Binding\n   Update (F-BU) message and a new\
    \ Simultaneous Bindings suboption is\n   defined for the Fast Binding Acknowledgement\
    \ (F-BAck) message.  Using\n   this enhanced mechanism, upon layer-3 handover,\
    \ traffic for the\n   mobile node will be sent from the MAP to both PAR and NAR\
    \ for a\n   certain period, thus isolating the mobile node from layer-2 effects\n\
    \   such as handover timing, ping-pong, or handover failure and providing\n  \
    \ the mobile node with uninterrupted layer-3 connectivity.\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Hesham Soliman\n   Flarion Technologies\n   EMail: h.soliman@flarion.com\n\
    \   Claude Castelluccia\n   INRIA Rhone-Alpes\n   655 avenue de l'Europe\n   38330\
    \ Montbonnot Saint-Martin\n   France\n   EMail: claude.castelluccia@inria.fr\n\
    \   Phone: +33 4 76 61 52 15\n   Karim El Malki\n   Ericsson AB\n   LM Ericssons\
    \ Vag. 8\n   126 25 Stockholm\n   Sweden\n   EMail: karim@elmalki.homeip.net\n\
    \   Ludovic Bellier\n   INRIA Rhone-Alpes\n   655 avenue de l'Europe\n   38330\
    \ Montbonnot Saint-Martin\n   France\n   EMail: ludovic.bellier@inria.fr\n"
- title: Full Copyright Statement
  contents:
  - "Full Copyright Statement\n   Copyright (C) The Internet Society (2005).\n   This\
    \ document is subject to the rights, licenses and restrictions\n   contained in\
    \ BCP 78, and except as set forth therein, the authors\n   retain all their rights.\n\
    \   This document and the information contained herein are provided on an\n  \
    \ \"AS IS\" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS\n  \
    \ OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY AND THE INTERNET\n   ENGINEERING\
    \ TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS OR IMPLIED,\n   INCLUDING BUT NOT\
    \ LIMITED TO ANY WARRANTY THAT THE USE OF THE\n   INFORMATION HEREIN WILL NOT\
    \ INFRINGE ANY RIGHTS OR ANY IMPLIED\n   WARRANTIES OF MERCHANTABILITY OR FITNESS\
    \ FOR A PARTICULAR PURPOSE.\n"
- title: Intellectual Property
  contents:
  - "Intellectual Property\n   The IETF takes no position regarding the validity or\
    \ scope of any\n   Intellectual Property Rights or other rights that might be\
    \ claimed to\n   pertain to the implementation or use of the technology described\
    \ in\n   this document or the extent to which any license under such rights\n\
    \   might or might not be available; nor does it represent that it has\n   made\
    \ any independent effort to identify any such rights.  Information\n   on the\
    \ procedures with respect to rights in RFC documents can be\n   found in BCP 78\
    \ and BCP 79.\n   Copies of IPR disclosures made to the IETF Secretariat and any\n\
    \   assurances of licenses to be made available, or the result of an\n   attempt\
    \ made to obtain a general license or permission for the use of\n   such proprietary\
    \ rights by implementers or users of this\n   specification can be obtained from\
    \ the IETF on-line IPR repository at\n   http://www.ietf.org/ipr.\n   The IETF\
    \ invites any interested party to bring to its attention any\n   copyrights, patents\
    \ or patent applications, or other proprietary\n   rights that may cover technology\
    \ that may be required to implement\n   this standard.  Please address the information\
    \ to the IETF at ietf-\n   ipr@ietf.org.\n"
- title: Acknowledgement
  contents:
  - "Acknowledgement\n   Funding for the RFC Editor function is currently provided\
    \ by the\n   Internet Society.\n"
