- title: __initial_text__
  contents:
  - '          Packet Loss and Delay Measurement for MPLS Networks

    '
- title: Abstract
  contents:
  - "Abstract\n   Many service provider service level agreements (SLAs) depend on\
    \ the\n   ability to measure and monitor performance metrics for packet loss\n\
    \   and one-way and two-way delay, as well as related metrics such as\n   delay\
    \ variation and channel throughput.  This measurement capability\n   also provides\
    \ operators with greater visibility into the performance\n   characteristics of\
    \ their networks, thereby facilitating planning,\n   troubleshooting, and network\
    \ performance evaluation.  This document\n   specifies protocol mechanisms to\
    \ enable the efficient and accurate\n   measurement of these performance metrics\
    \ in MPLS networks.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This\
    \ document is a product of the Internet Engineering Task Force\n   (IETF).  It\
    \ represents the consensus of the IETF community.  It has\n   received public\
    \ review and has been approved for publication by the\n   Internet Engineering\
    \ Steering Group (IESG).  Further information on\n   Internet Standards is available\
    \ in Section 2 of RFC 5741.\n   Information about the current status of this document,\
    \ any errata,\n   and how to provide feedback on it may be obtained at\n   http://www.rfc-editor.org/info/rfc6374.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2011 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (http://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.  Code Components\
    \ extracted from this document must\n   include Simplified BSD License text as\
    \ described in Section 4.e of\n   the Trust Legal Provisions and are provided\
    \ without warranty as\n   described in the Simplified BSD License.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1. Introduction ....................................................3\n\
    \      1.1. Applicability and Scope ....................................5\n  \
    \    1.2. Terminology ................................................6\n    \
    \  1.3. Requirements Language ......................................6\n   2. Overview\
    \ ........................................................6\n      2.1. Basic\
    \ Bidirectional Measurement ............................6\n      2.2. Packet Loss\
    \ Measurement ....................................7\n      2.3. Throughput Measurement\
    \ ....................................10\n      2.4. Delay Measurement .........................................10\n\
    \      2.5. Delay Variation Measurement ...............................12\n  \
    \    2.6. Unidirectional Measurement ................................12\n    \
    \  2.7. Dyadic Measurement ........................................13\n      2.8.\
    \ Loopback Measurement ......................................13\n      2.9. Measurement\
    \ Considerations ................................14\n           2.9.1. Types of\
    \ Channels ..................................14\n           2.9.2. Quality of\
    \ Service .................................14\n           2.9.3. Measurement Point\
    \ Location .........................14\n           2.9.4. Equal Cost Multipath\
    \ ...............................15\n           2.9.5. Intermediate Nodes .................................15\n\
    \           2.9.6. Different Transmit and Receive Interfaces ..........16\n  \
    \         2.9.7. External Post-Processing ...........................16\n    \
    \       2.9.8. Loss Measurement Modes .............................16\n      \
    \     2.9.9. Loss Measurement Scope .............................18\n        \
    \   2.9.10. Delay Measurement Accuracy ........................18\n          \
    \ 2.9.11. Delay Measurement Timestamp Format ................18\n   3. Message\
    \ Formats ................................................19\n      3.1. Loss\
    \ Measurement Message Format ...........................19\n      3.2. Delay Measurement\
    \ Message Format ..........................25\n      3.3. Combined Loss/Delay\
    \ Measurement Message Format ............27\n      3.4. Timestamp Field Formats\
    \ ...................................28\n      3.5. TLV Objects ...............................................29\n\
    \           3.5.1. Padding ............................................30\n  \
    \         3.5.2. Addressing .........................................31\n    \
    \       3.5.3. Loopback Request ...................................31\n      \
    \     3.5.4. Session Query Interval .............................32\n   4. Operation\
    \ ......................................................33\n      4.1. Operational\
    \ Overview ......................................33\n      4.2. Loss Measurement\
    \ Procedures ...............................34\n           4.2.1. Initiating a\
    \ Loss Measurement Operation ............34\n           4.2.2. Transmitting a\
    \ Loss Measurement Query ..............34\n           4.2.3. Receiving a Loss\
    \ Measurement Query .................35\n           4.2.4. Transmitting a Loss\
    \ Measurement Response ...........35\n           4.2.5. Receiving a Loss Measurement\
    \ Response ..............36\n           4.2.6. Loss Calculation ...................................36\n\
    \           4.2.7. Quality of Service .................................37\n  \
    \         4.2.8. G-ACh Packets ......................................37\n    \
    \       4.2.9. Test Messages ......................................37\n      \
    \     4.2.10. Message Loss and Packet Misorder Conditions .......38\n      4.3.\
    \ Delay Measurement Procedures ..............................39\n           4.3.1.\
    \ Transmitting a Delay Measurement Query .............39\n           4.3.2. Receiving\
    \ a Delay Measurement Query ................39\n           4.3.3. Transmitting\
    \ a Delay Measurement Response ..........40\n           4.3.4. Receiving a Delay\
    \ Measurement Response .............41\n           4.3.5. Timestamp Format Negotiation\
    \ .......................41\n                  4.3.5.1. Single-Format Procedures\
    \ ..................42\n           4.3.6. Quality of Service .................................42\n\
    \      4.4. Combined Loss/Delay Measurement Procedures ................42\n  \
    \ 5. Implementation Disclosure Requirements .........................42\n   6.\
    \ Congestion Considerations ......................................44\n   7. Manageability\
    \ Considerations ...................................44\n   8. Security Considerations\
    \ ........................................45\n   9. IANA Considerations ............................................46\n\
    \      9.1. Allocation of PW Associated Channel Types .................47\n  \
    \    9.2. Creation of Measurement Timestamp Type Registry ...........47\n    \
    \  9.3. Creation of MPLS Loss/Delay Measurement Control\n           Code Registry\
    \ .............................................47\n      9.4. Creation of MPLS\
    \ Loss/Delay Measurement TLV Object\n           Registry ..................................................49\n\
    \   10. Acknowledgments ...............................................49\n  \
    \ 11. References ....................................................49\n    \
    \  11.1. Normative References .....................................49\n      11.2.\
    \ Informative References ...................................50\n   Appendix A.\
    \ Default Timestamp Format Rationale ....................52\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   Many service provider service level agreements (SLAs) depend\
    \ on the\n   ability to measure and monitor performance metrics for packet loss\n\
    \   and one-way and two-way delay, as well as related metrics such as\n   delay\
    \ variation and channel throughput.  This measurement capability\n   also provides\
    \ operators with greater visibility into the performance\n   characteristics of\
    \ their networks, thereby facilitating planning,\n   troubleshooting, and network\
    \ performance evaluation.  This document\n   specifies protocol mechanisms to\
    \ enable the efficient and accurate\n   measurement of these performance metrics\
    \ in MPLS networks.\n   This document specifies two closely related protocols,\
    \ one for packet\n   loss measurement (LM) and one for packet delay measurement\
    \ (DM).\n   These protocols have the following characteristics and capabilities:\n\
    \   o  The LM and DM protocols are intended to be simple and to support\n    \
    \  efficient hardware processing.\n   o  The LM and DM protocols operate over\
    \ the MPLS Generic Associated\n      Channel (G-ACh) [RFC5586] and support measurement\
    \ of loss, delay,\n      and related metrics over Label Switched Paths (LSPs),\
    \ pseudowires,\n      and MPLS sections (links).\n   o  The LM and DM protocols\
    \ are applicable to the LSPs, pseudowires,\n      and sections of networks based\
    \ on the MPLS Transport Profile\n      (MPLS-TP), because the MPLS-TP is based\
    \ on a standard MPLS data\n      plane.  The MPLS-TP is defined and described\
    \ in [RFC5921], and\n      MPLS-TP LSPs, pseudowires, and sections are discussed\
    \ in detail in\n      [RFC5960].  A profile describing the minimal functional\
    \ subset of\n      the LM and DM protocols in the MPLS-TP context is provided\
    \ in\n      [RFC6375].\n   o  The LM and DM protocols can be used both for continuous/proactive\n\
    \      and selective/on-demand measurement.\n   o  The LM and DM protocols use\
    \ a simple query/response model for\n      bidirectional measurement that allows\
    \ a single node -- the querier\n      -- to measure the loss or delay in both\
    \ directions.\n   o  The LM and DM protocols use query messages for unidirectional\
    \ loss\n      and delay measurement.  The measurement can be carried out either\n\
    \      at the downstream node(s) or at the querier if an out-of-band\n      return\
    \ path is available.\n   o  The LM and DM protocols do not require that the transmit\
    \ and\n      receive interfaces be the same when performing bidirectional\n  \
    \    measurement.\n   o  The DM protocol is stateless.\n   o  The LM protocol\
    \ is \"almost\" stateless: loss is computed as a delta\n      between successive\
    \ messages, and thus the data associated with the\n      last message received\
    \ must be retained.\n   o  The LM protocol can perform two distinct kinds of loss\n\
    \      measurement: it can measure the loss of specially generated test\n    \
    \  messages in order to infer the approximate data-plane loss level\n      (inferred\
    \ measurement) or it can directly measure data-plane\n      packet loss (direct\
    \ measurement).  Direct measurement provides\n      perfect loss accounting, but\
    \ may require specialized hardware\n      support and is only applicable to some\
    \ LSP types.  Inferred\n      measurement provides only approximate loss accounting\
    \ but is\n      generally applicable.\n      The direct LM method is also known\
    \ as \"frame-based\" in the context\n      of Ethernet transport networks [Y.1731].\
    \  Inferred LM is a\n      generalization of the \"synthetic\" measurement approach\
    \ currently\n      in development for Ethernet networks, in the sense that it\
    \ allows\n      test messages to be decoupled from measurement messages.\n   o\
    \  The LM protocol supports measurement in terms of both packet\n      counts\
    \ and octet counts.\n   o  The LM protocol supports both 32-bit and 64-bit counters.\n\
    \   o  The LM protocol can be used to measure channel throughput as well\n   \
    \   as packet loss.\n   o  The DM protocol supports multiple timestamp formats,\
    \ and provides\n      a simple means for the two endpoints of a bidirectional\
    \ connection\n      to agree on a preferred format.  This procedure reduces to\
    \ a\n      triviality for implementations supporting only a single timestamp\n\
    \      format.\n   o  The DM protocol supports varying the measurement message\
    \ size in\n      order to measure delays associated with different packet sizes.\n\
    \   The One-Way Active Measurement Protocol (OWAMP) [RFC4656] and Two-Way\n  \
    \ Active Measurement Protocol (TWAMP) [RFC5357] provide capabilities\n   for the\
    \ measurement of various performance metrics in IP networks.\n   These protocols\
    \ are not streamlined for hardware processing and rely\n   on IP and TCP, as well\
    \ as elements of the Network Time Protocol\n   (NTP), which may not be available\
    \ or optimized in some network\n   environments; they also lack support for IEEE\
    \ 1588 timestamps and\n   direct-mode LM, which may be required in some environments.\
    \  The\n   protocols defined in this document thus are similar in some respects\n\
    \   to, but also differ from, these IP-based protocols.\n"
- title: 1.1.  Applicability and Scope
  contents:
  - "1.1.  Applicability and Scope\n   This document specifies measurement procedures\
    \ and protocol messages\n   that are intended to be applicable in a wide variety\
    \ of circumstances\n   and amenable to implementation by a wide range of hardware-\
    \ and\n   software-based measurement systems.  As such, it does not attempt to\n\
    \   mandate measurement quality levels or analyze specific end-user\n   applications.\n"
- title: 1.2.  Terminology
  contents:
  - "1.2.  Terminology\n   Term  Definition\n   ----- -------------------------------------------\n\
    \   ACH   Associated Channel Header\n   DM    Delay Measurement\n   ECMP  Equal\
    \ Cost Multipath\n   G-ACh Generic Associated Channel\n   LM    Loss Measurement\n\
    \   LSE   Label Stack Entry\n   LSP   Label Switched Path\n   NTP   Network Time\
    \ Protocol\n   OAM   Operations, Administration, and Maintenance\n   PTP   Precision\
    \ Time Protocol\n   TC    Traffic Class\n"
- title: 1.3.  Requirements Language
  contents:
  - "1.3.  Requirements Language\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\"\
    , \"SHALL\", \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"\
    MAY\", and \"OPTIONAL\" in this\n   document are to be interpreted as described\
    \ in RFC 2119 [RFC2119].\n"
- title: 2.  Overview
  contents:
  - "2.  Overview\n   This section begins with a summary of the basic methods used\
    \ for the\n   bidirectional measurement of packet loss and delay.  These\n   measurement\
    \ methods are then described in detail.  Finally, a list of\n   practical considerations\
    \ is discussed that may come into play to\n   inform or modify these simple procedures.\
    \  This section is limited to\n   theoretical discussion; for protocol specifics,\
    \ the reader is\n   referred to Sections 3 and 4.\n"
- title: 2.1.  Basic Bidirectional Measurement
  contents:
  - "2.1.  Basic Bidirectional Measurement\n   The following figure shows the reference\
    \ scenario.\n                             T1              T2\n               \
    \    +-------+/     Query       \\+-------+\n                   |       | - -\
    \ - - - - - - ->|       |\n                   |   A   |===================|  \
    \ B   |\n                   |       |<- - - - - - - - - |       |\n          \
    \         +-------+\\     Response    /+-------+\n                           \
    \  T4              T3\n   This figure shows a bidirectional channel between two\
    \ nodes, A and B,\n   and illustrates the temporal reference points T1-T4 associated\
    \ with a\n   measurement operation that takes place at A.  The operation consists\n\
    \   of A sending a query message to B, and B sending back a response.\n   Each\
    \ reference point indicates the point in time at which either the\n   query or\
    \ the response message is transmitted or received over the\n   channel.\n   In\
    \ this situation, A can arrange to measure the packet loss over the\n   channel\
    \ in the forward and reverse directions by sending Loss\n   Measurement (LM) query\
    \ messages to B, each of which contains the\n   count of packets transmitted prior\
    \ to time T1 over the channel to B\n   (A_TxP).  When the message reaches B, it\
    \ appends two values and\n   reflects the message back to A: the count of packets\
    \ received prior\n   to time T2 over the channel from A (B_RxP) and the count\
    \ of packets\n   transmitted prior to time T3 over the channel to A (B_TxP). \
    \ When the\n   response reaches A, it appends a fourth value: the count of packets\n\
    \   received prior to time T4 over the channel from B (A_RxP).\n   These four\
    \ counter values enable A to compute the desired loss\n   statistics.  Because\
    \ the transmit count at A and the receive count at\n   B (and vice versa) may\
    \ not be synchronized at the time of the first\n   message, and to limit the effects\
    \ of counter wrap, the loss is\n   computed in the form of a delta between messages.\n\
    \   To measure at A the delay over the channel to B, a Delay Measurement\n   (DM)\
    \ query message is sent from A to B containing a timestamp\n   recording the instant\
    \ at which it is transmitted, i.e., T1.  When the\n   message reaches B, a timestamp\
    \ is added recording the instant at\n   which it is received (T2).  The message\
    \ can now be reflected from B\n   to A, with B adding its transmit timestamp (T3)\
    \ and A adding its\n   receive timestamp (T4).  These four timestamps enable A\
    \ to compute\n   the one-way delay in each direction, as well as the two-way delay\
    \ for\n   the channel.  The one-way delay computations require that the clocks\n\
    \   of A and B be synchronized; mechanisms for clock synchronization are\n   outside\
    \ the scope of this document.\n"
- title: 2.2.  Packet Loss Measurement
  contents:
  - "2.2.  Packet Loss Measurement\n   Suppose a bidirectional channel exists between\
    \ the nodes A and B.\n   The objective is to measure at A the following two quantities\n\
    \   associated with the channel:\n      A_TxLoss (transmit loss): the number of\
    \ packets transmitted by A\n      over the channel but not received at B;\n  \
    \    A_RxLoss (receive loss): the number of packets transmitted by B\n      over\
    \ the channel but not received at A.\n   This is accomplished by initiating a\
    \ Loss Measurement (LM) operation\n   at A, which consists of transmission of\
    \ a sequence of LM query\n   messages (LM[1], LM[2], ...) over the channel at\
    \ a specified rate,\n   such as one every 100 milliseconds.  Each message LM[n]\
    \ contains the\n   following value:\n      A_TxP[n]: the total count of packets\
    \ transmitted by A over the\n      channel prior to the time this message is transmitted.\n\
    \   When such a message is received at B, the following value is recorded\n  \
    \ in the message:\n      B_RxP[n]: the total count of packets received by B over\
    \ the\n      channel at the time this message is received (excluding the\n   \
    \   message itself).\n   At this point, B transmits the message back to A, recording\
    \ within it\n   the following value:\n      B_TxP[n]: the total count of packets\
    \ transmitted by B over the\n      channel prior to the time this response is\
    \ transmitted.\n   When the message response is received back at A, the following\
    \ value\n   is recorded in the message:\n      A_RxP[n]: the total count of packets\
    \ received by A over the\n      channel at the time this response is received\
    \ (excluding the\n      message itself).\n   The transmit loss A_TxLoss[n-1,n]\
    \ and receive loss A_RxLoss[n-1,n]\n   within the measurement interval marked\
    \ by the messages LM[n-1] and\n   LM[n] are computed by A as follows:\n   A_TxLoss[n-1,n]\
    \ = (A_TxP[n] - A_TxP[n-1]) - (B_RxP[n] - B_RxP[n-1])\n   A_RxLoss[n-1,n] = (B_TxP[n]\
    \ - B_TxP[n-1]) - (A_RxP[n] - A_RxP[n-1])\n   where the arithmetic is modulo the\
    \ counter size.\n   (Strictly speaking, it is not necessary that the fourth count,\n\
    \   A_RxP[n], actually be written in the message, but this is convenient\n   for\
    \ some implementations and useful if the message is to be forwarded\n   on to\
    \ an external measurement system.)\n   The derived values\n      A_TxLoss = A_TxLoss[1,2]\
    \ + A_TxLoss[2,3] + ...\n      A_RxLoss = A_RxLoss[1,2] + A_RxLoss[2,3] + ...\n\
    \   are updated each time a response to an LM message is received and\n   processed,\
    \ and they represent the total transmit and receive loss\n   over the channel\
    \ since the LM operation was initiated.\n   When computing the values A_TxLoss[n-1,n]\
    \ and A_RxLoss[n-1,n], the\n   possibility of counter wrap must be taken into\
    \ account.  For example,\n   consider the values of the A_TxP counter at sequence\
    \ numbers n-1 and\n   n.  Clearly if A_TxP[n] is allowed to wrap to 0 and then\
    \ beyond to a\n   value equal to or greater than A_TxP[n-1], the computation of\
    \ an\n   unambiguous A_TxLoss[n-1,n] value will be impossible.  Therefore, the\n\
    \   LM message rate MUST be sufficiently high, given the counter size and\n  \
    \ the speed and minimum packet size of the underlying channel, that\n   this condition\
    \ cannot arise.  For example, a 32-bit counter for a\n   100-Gbps link with a\
    \ minimum packet size of 64 bytes can wrap in 2^32\n   / (10^11/(64*8)) = ~22\
    \ seconds, which is therefore an upper bound on\n   the LM message interval under\
    \ such conditions.  This bound will be\n   referred to as the MaxLMInterval of\
    \ the channel.  It is clear that\n   the MaxLMInterval will be a more restrictive\
    \ constraint in the case\n   of direct LM and for smaller counter sizes.\n   The\
    \ loss measurement approach described in this section has the\n   characteristic\
    \ of being stateless at B and \"almost\" stateless at A.\n   Specifically, A must\
    \ retain the data associated with the last LM\n   response received, in order\
    \ to use it to compute loss when the next\n   response arrives.  This data MAY\
    \ be discarded, and MUST NOT be used\n   as a basis for measurement, if MaxLMInterval\
    \ elapses before the next\n   response arrives, because in this case an unambiguous\
    \ measurement\n   cannot be made.\n   The foregoing discussion has assumed the\
    \ counted objects are packets,\n   but this need not be the case.  In particular,\
    \ octets may be counted\n   instead.  This will, of course, reduce the MaxLMInterval\
    \ accordingly.\n   In addition to absolute aggregate loss counts, the individual\
    \ loss\n   counts yield other metrics, such as the average loss rate over any\n\
    \   multiple of the measurement interval.  An accurate loss rate can be\n   determined\
    \ over time even in the presence of anomalies affecting\n   individual measurements,\
    \ such as those due to packet misordering\n   (Section 4.2.10).\n   Note that\
    \ an approach for conducting packet loss measurement in IP\n   networks is documented\
    \ in [RFC2680].  This approach differs from the\n   one described here, for example\
    \ by requiring clock synchronization\n   between the measurement points and lacking\
    \ support for direct-mode\n   LM.\n"
- title: 2.3.  Throughput Measurement
  contents:
  - "2.3.  Throughput Measurement\n   If LM query messages contain a timestamp recording\
    \ their time of\n   transmission, this data can be combined with the packet or\
    \ octet\n   counts to yield measurements of the throughput offered and delivered\n\
    \   over the channel during the interval in terms of the counted units.\n   For\
    \ a bidirectional channel, for example, given any two LM response\n   messages\
    \ (separated in time by not more than the MaxLMInterval), the\n   difference between\
    \ the counter values tells the querier the number of\n   units successfully transmitted\
    \ and received in the interval between\n   the timestamps.  Absolute offered throughput\
    \ is the number of data\n   units transmitted and absolute delivered throughput\
    \ is the number of\n   data units received.  Throughput rate is the number of\
    \ data units\n   sent or received per unit time.\n   Just as for loss measurement,\
    \ the interval counts can be accumulated\n   to arrive at the absolute throughput\
    \ of the channel since the start\n   of the measurement operation or be used to\
    \ derive related metrics\n   such as the throughput rate.  This procedure also\
    \ enables out-of-\n   service throughput testing when combined with a simple packet\n\
    \   generator.\n"
- title: 2.4.  Delay Measurement
  contents:
  - "2.4.  Delay Measurement\n   Suppose a bidirectional channel exists between the\
    \ nodes A and B.\n   The objective is to measure at A one or more of the following\n\
    \   quantities associated with the channel:\n   o  The one-way delay associated\
    \ with the forward (A to B) direction\n      of the channel;\n   o  The one-way\
    \ delay associated with the reverse (B to A) direction\n      of the channel;\n\
    \   o  The two-way delay (A to B to A) associated with the channel.\n   The one-way\
    \ delay metric for packet networks is described in\n   [RFC2679].  In the case\
    \ of two-way delay, there are actually two\n   possible metrics of interest. \
    \ The \"two-way channel delay\" is the sum\n   of the one-way delays in each direction\
    \ and reflects the delay of the\n   channel itself, irrespective of processing\
    \ delays within the remote\n   endpoint B.  The \"round-trip delay\" is described\
    \ in [RFC2681] and\n   includes in addition any delay associated with remote endpoint\n\
    \   processing.\n   Measurement of the one-way delay quantities requires that\
    \ the clocks\n   of A and B be synchronized, whereas the two-way delay metrics\
    \ can be\n   measured directly even when this is not the case (provided A and\
    \ B\n   have stable clocks).\n   A measurement is accomplished by sending a Delay\
    \ Measurement (DM)\n   query message over the channel to B that contains the following\n\
    \   timestamp:\n      T1: the time the DM query message is transmitted from A.\n\
    \   When the message arrives at B, the following timestamp is recorded in\n  \
    \ the message:\n      T2: the time the DM query message is received at B.\n  \
    \ At this point, B transmits the message back to A, recording within it\n   the\
    \ following timestamp:\n      T3: the time the DM response message is transmitted\
    \ from B.\n   When the message arrives back at A, the following timestamp is\n\
    \   recorded in the message:\n      T4: the time the DM response message is received\
    \ back at A.\n   (Strictly speaking, it is not necessary that the fourth timestamp,\n\
    \   T4, actually be written in the message, but this is convenient for\n   some\
    \ implementations and useful if the message is to be forwarded on\n   to an external\
    \ measurement system.)\n   At this point, A can compute the two-way channel delay\
    \ associated\n   with the channel as\n      two-way channel delay = (T4 - T1)\
    \ - (T3 - T2)\n   and the round-trip delay as\n      round-trip delay = T4 - T1.\n\
    \   If the clocks of A and B are known at A to be synchronized, then both\n  \
    \ one-way delay values, as well as the two-way channel delay, can be\n   computed\
    \ at A as\n      forward one-way delay = T2 - T1\n      reverse one-way delay\
    \ = T4 - T3\n      two-way channel delay = forward delay + reverse delay.\n  \
    \ Note that this formula for the two-way channel delay reduces to the\n   one\
    \ previously given, and clock synchronization is not required to\n   compute this\
    \ metric.\n"
- title: 2.5.  Delay Variation Measurement
  contents:
  - "2.5.  Delay Variation Measurement\n   Inter-Packet Delay Variation (IPDV) and\
    \ Packet Delay Variation (PDV)\n   [RFC5481] are performance metrics derived from\
    \ one-way delay\n   measurement and are important in some applications.  IPDV\
    \ represents\n   the difference between the one-way delays of successive packets\
    \ in a\n   stream.  PDV, given a measurement test interval, represents the\n \
    \  difference between the one-way delay of a packet in the interval and\n   that\
    \ of the packet in the interval with the minimum delay.\n   IPDV and PDV measurements\
    \ can therefore be derived from delay\n   measurements obtained through the procedures\
    \ in Section 2.4.  An\n   important point regarding delay variation measurement,\
    \ however, is\n   that it can be carried out based on one-way delay measurements\
    \ even\n   when the clocks of the two systems involved in those measurements are\n\
    \   not synchronized with one another.\n"
- title: 2.6.  Unidirectional Measurement
  contents:
  - "2.6.  Unidirectional Measurement\n   In the case that the channel from A to (B1,\
    \ ..., Bk) (where B2, ...,\n   Bk refers to the point-to-multipoint case) is unidirectional,\
    \ i.e.,\n   is a unidirectional LSP, LM and DM measurements can be carried out\
    \ at\n   B1, ..., Bk instead of at A.\n   For LM, this is accomplished by initiating\
    \ an LM operation at A and\n   carrying out the same procedures as used for bidirectional\
    \ channels,\n   except that no responses from B1, ..., Bk to A are generated.\n\
    \   Instead, each terminal node B uses the A_TxP and B_RxP values in the\n   LM\
    \ messages it receives to compute the receive loss associated with\n   the channel\
    \ in essentially the same way as described previously, that\n   is:\n   B_RxLoss[n-1,n]\
    \ = (A_TxP[n] - A_TxP[n-1]) - (B_RxP[n] - B_RxP[n-1])\n   For DM, of course, only\
    \ the forward one-way delay can be measured and\n   the clock synchronization\
    \ requirement applies.\n   Alternatively, if an out-of-band channel from a terminal\
    \ node B back\n   to A is available, the LM and DM message responses can be\n\
    \   communicated to A via this channel so that the measurements can be\n   carried\
    \ out at A.\n"
- title: 2.7.  Dyadic Measurement
  contents:
  - "2.7.  Dyadic Measurement\n   The basic procedures for bidirectional measurement\
    \ assume that the\n   measurement process is conducted by and for the querier\
    \ node A.\n   Instead, it is possible, with only minor variation of these\n  \
    \ procedures, to conduct a dyadic or \"dual-ended\" measurement process\n   in\
    \ which both nodes A and B perform loss or delay measurement based\n   on the\
    \ same message flow.  This is achieved by stipulating that A\n   copy the third\
    \ and fourth counter or timestamp values from a response\n   message into the\
    \ third and fourth slots of the next query, which are\n   otherwise unused, thereby\
    \ providing B with equivalent information to\n   that learned by A.\n   The dyadic\
    \ procedure has the advantage of halving the number of\n   messages required for\
    \ both A and B to perform a given kind of\n   measurement, but comes at the expense\
    \ of each node's ability to\n   control its own measurement process independently,\
    \ and introduces\n   additional operational complexity into the measurement protocols.\n\
    \   The quantity of measurement traffic is also expected to be low\n   relative\
    \ to that of user traffic, particularly when 64-bit counters\n   are used for\
    \ LM.  Consequently, this document does not specify a\n   dyadic operational mode.\
    \  However, it is still possible, and may be\n   useful, for A to perform the\
    \ extra copy, thereby providing additional\n   information to B even when its\
    \ participation in the measurement\n   process is passive.\n"
- title: 2.8.  Loopback Measurement
  contents:
  - "2.8.  Loopback Measurement\n   Some bidirectional channels may be placed into\
    \ a loopback state such\n   that messages are looped back to the sender without\
    \ modification.  In\n   this situation, LM and DM procedures can be used to carry\
    \ out\n   measurements associated with the circular path.  This is done by\n \
    \  generating \"queries\" with the Response flag set to 1.\n   For LM, the loss\
    \ computation in this case is:\n   A_Loss[n-1,n] = (A_TxP[n] - A_TxP[n-1]) - (A_RxP[n]\
    \ - A_RxP[n-1])\n   For DM, the round-trip delay is computed.  In this case, however,\
    \ the\n   remote endpoint processing time component reflects only the time\n \
    \  required to loop the message from channel input to channel output.\n"
- title: 2.9.  Measurement Considerations
  contents:
  - "2.9.  Measurement Considerations\n   A number of additional considerations apply\
    \ in practice to the\n   measurement methods summarized above.\n"
- title: 2.9.1.  Types of Channels
  contents:
  - "2.9.1.  Types of Channels\n   There are several types of channels in MPLS networks\
    \ over which loss\n   and delay measurement may be conducted.  The channel type\
    \ may\n   restrict the kinds of measurement that can be performed.  In all\n \
    \  cases, LM and DM messages flow over the MPLS Generic Associated\n   Channel\
    \ (G-ACh), which is described in detail in [RFC5586].\n   Broadly, a channel in\
    \ an MPLS network may be either a link, a Label\n   Switched Path (LSP) [RFC3031],\
    \ or a pseudowire [RFC3985].  Links are\n   bidirectional and are also referred\
    \ to as MPLS sections; see\n   [RFC5586] and [RFC5960].  Pseudowires are bidirectional.\
    \  Label\n   Switched Paths may be either unidirectional or bidirectional.\n \
    \  The LM and DM protocols discussed in this document are initiated from\n   a\
    \ single node: the querier.  A query message may be received either\n   by a single\
    \ node or by multiple nodes, depending on the nature of the\n   channel.  In the\
    \ latter case, these protocols provide point-to-\n   multipoint measurement capabilities.\n"
- title: 2.9.2.  Quality of Service
  contents:
  - "2.9.2.  Quality of Service\n   Quality of Service (QoS) capabilities, in the\
    \ form of the\n   Differentiated Services architecture, apply to MPLS as specified\
    \ in\n   [RFC3270] and [RFC5462].  Different classes of traffic are\n   distinguished\
    \ by the three-bit Traffic Class (TC) field of an MPLS\n   Label Stack Entry (LSE).\
    \  Delay measurement applies on a per-traffic-\n   class basis, and the TC values\
    \ of LSEs above the G-ACh Label (GAL)\n   that precedes a DM message are significant.\
    \  Packet loss can be\n   measured with respect either to the channel as a whole\
    \ or to a\n   specific traffic class.\n"
- title: 2.9.3.  Measurement Point Location
  contents:
  - "2.9.3.  Measurement Point Location\n   The location of the measurement points\
    \ for loss and delay within the\n   sending and receiving nodes is implementation\
    \ dependent but directly\n   affects the nature of the measurements.  For example,\
    \ a sending\n   implementation may or may not consider a packet to be \"lost\"\
    , for LM\n   purposes, that was discarded prior to transmission for queuing-\n\
    \   related reasons; conversely, a receiving implementation may or may\n   not\
    \ consider a packet to be \"lost\", for LM purposes, if it was\n   physically\
    \ received but discarded during receive-path processing.\n   The location of delay\
    \ measurement points similarly determines what,\n   precisely, is being measured.\
    \  The principal consideration here is\n   that the behavior of an implementation\
    \ in these respects MUST be made\n   clear to the user.\n"
- title: 2.9.4.  Equal Cost Multipath
  contents:
  - "2.9.4.  Equal Cost Multipath\n   Equal Cost Multipath (ECMP) is the behavior\
    \ of distributing packets\n   across multiple alternate paths toward a destination.\
    \  The use of\n   ECMP in MPLS networks is described in BCP 128 [RFC4928].  The\
    \ typical\n   result of ECMP being performed on an LSP that is subject to delay\n\
    \   measurement will be that only the delay of one of the available paths\n  \
    \ is, and can be, measured.\n   The effects of ECMP on loss measurement will depend\
    \ on the LM mode.\n   In the case of direct LM, the measurement will account for\
    \ any\n   packets lost between the sender and the receiver, regardless of how\n\
    \   many paths exist between them.  However, the presence of ECMP\n   increases\
    \ the likelihood of misordering both of LM messages relative\n   to data packets\
    \ and of the LM messages themselves.  Such misorderings\n   tend to create unmeasurable\
    \ intervals and thus degrade the accuracy\n   of loss measurement.  The effects\
    \ of ECMP are similar for inferred\n   LM, with the additional caveat that, unless\
    \ the test packets are\n   specially constructed so as to probe all available\
    \ paths, the loss\n   characteristics of one or more of the alternate paths cannot\
    \ be\n   accounted for.\n"
- title: 2.9.5.  Intermediate Nodes
  contents:
  - "2.9.5.  Intermediate Nodes\n   In the case of an LSP, it may be desirable to\
    \ measure the loss or\n   delay to or from an intermediate node as well as between\
    \ LSP\n   endpoints.  This can be done in principle by setting the Time to Live\n\
    \   (TTL) field in the outer LSE appropriately when targeting a\n   measurement\
    \ message to an intermediate node.  This procedure may\n   fail, however, if hardware-assisted\
    \ measurement is in use, because\n   the processing of the packet by the intermediate\
    \ node occurs only as\n   the result of TTL expiry, and the handling of TTL expiry\
    \ may occur at\n   a later processing stage in the implementation than the hardware-\n\
    \   assisted measurement function.  The motivation for conducting\n   measurements\
    \ to intermediate nodes is often an attempt to localize a\n   problem that has\
    \ been detected on the LSP.  In this case, if\n   intermediate nodes are not capable\
    \ of performing hardware-assisted\n   measurement, a less accurate -- but usually\
    \ sufficient -- software-\n   based measurement can be conducted instead.\n"
- title: 2.9.6.  Different Transmit and Receive Interfaces
  contents:
  - "2.9.6.  Different Transmit and Receive Interfaces\n   The overview of the bidirectional\
    \ measurement process presented in\n   Section 2 is also applicable when the transmit\
    \ and receive interfaces\n   at A or B differ from one another.  Some additional\
    \ considerations,\n   however, do apply in this case:\n   o  If different clocks\
    \ are associated with transmit and receive\n      processing, these clocks must\
    \ be synchronized in order to compute\n      the two-way delay.\n   o  The DM\
    \ protocol specified in this document requires that the\n      timestamp formats\
    \ used by the interfaces that receive a DM query\n      and transmit a DM response\
    \ agree.\n   o  The LM protocol specified in this document supports both 32-bit\n\
    \      and 64-bit counter sizes, but the use of 32-bit counters at any of\n  \
    \    the up to four interfaces involved in an LM operation will result\n     \
    \ in 32-bit LM calculations for both directions of the channel.\n"
- title: 2.9.7.  External Post-Processing
  contents:
  - "2.9.7.  External Post-Processing\n   In some circumstances, it may be desirable\
    \ to carry out the final\n   measurement computation at an external post-processing\
    \ device\n   dedicated to the purpose.  This can be achieved in supporting\n \
    \  implementations by, for example, configuring the querier, in the case\n   of\
    \ a bidirectional measurement session, to forward each response it\n   receives\
    \ to the post-processor via any convenient protocol.  The\n   unidirectional case\
    \ can be handled similarly through configuration of\n   the receiver or by including\
    \ an instruction in query messages for the\n   receiver to respond out-of-band\
    \ to the appropriate return address.\n   Post-processing devices may have the\
    \ ability to store measurement\n   data for an extended period and to generate\
    \ a variety of useful\n   statistics from them.  External post-processing also\
    \ allows the\n   measurement process to be completely stateless at the querier\
    \ and\n   responder.\n"
- title: 2.9.8.  Loss Measurement Modes
  contents:
  - "2.9.8.  Loss Measurement Modes\n   The summary of loss measurement at the beginning\
    \ of Section 2 made\n   reference to the \"count of packets\" transmitted and\
    \ received over a\n   channel.  If the counted packets are the packets flowing\
    \ over the\n   channel in the data plane, the loss measurement is said to operate\
    \ in\n   \"direct mode\".  If, on the other hand, the counted packets are\n  \
    \ selected control packets from which the approximate loss\n   characteristics\
    \ of the channel are being inferred, the loss\n   measurement is said to operate\
    \ in \"inferred mode\".\n   Direct LM has the advantage of being able to provide\
    \ perfect loss\n   accounting when it is available.  There are, however, several\n\
    \   constraints associated with direct LM.\n   For accurate direct LM to occur,\
    \ packets must not be sent between the\n   time the transmit count for an outbound\
    \ LM message is determined and\n   the time the message is actually transmitted.\
    \  Similarly, packets\n   must not be received and processed between the time\
    \ an LM message is\n   received and the time the receive count for the message\
    \ is\n   determined.  If these \"synchronization conditions\" do not hold, the\n\
    \   LM message counters will not reflect the true state of the data\n   plane,\
    \ with the result that, for example, the receive count of B may\n   be greater\
    \ than the transmit count of A, and attempts to compute loss\n   by taking the\
    \ difference will yield an invalid result.  This\n   requirement for synchronization\
    \ between LM message counters and the\n   data plane may require special support\
    \ from hardware-based forwarding\n   implementations.\n   A limitation of direct\
    \ LM is that it may be difficult or impossible\n   to apply in cases where the\
    \ channel is an LSP and the LSP label at\n   the receiver is either nonexistent\
    \ or fails to identify a unique\n   sending node.  The first case happens when\
    \ Penultimate Hop Popping\n   (PHP) is used on the LSP, and the second case generally\
    \ holds for\n   LSPs based on the Label Distribution Protocol (LDP) [RFC5036]\
    \ as\n   opposed to, for example, those based on Traffic Engineering\n   extensions\
    \ to the Resource Reservation Protocol (RSVP-TE) [RFC3209].\n   These conditions\
    \ may make it infeasible for the receiver to identify\n   the data-plane packets\
    \ associated with a particular source and LSP in\n   order to count them, or to\
    \ infer the source and LSP context\n   associated with an LM message.  Direct\
    \ LM is also vulnerable to\n   disruption in the event that the ingress or egress\
    \ interface\n   associated with an LSP changes during the LSP's lifetime.\n  \
    \ Inferred LM works in the same manner as direct LM except that the\n   counted\
    \ packets are special control packets, called test messages,\n   generated by\
    \ the sender.  Test messages may be either packets\n   explicitly constructed\
    \ and used for LM or packets with a different\n   primary purpose, such as those\
    \ associated with a Bidirectional\n   Forwarding Detection (BFD) [RFC5884] session.\n\
    \   The synchronization conditions discussed above for direct LM also\n   apply\
    \ to inferred LM, the only difference being that the required\n   synchronization\
    \ is now between the LM counters and the test message\n   generation process.\
    \  Protocol and application designers MUST take\n   these synchronization requirements\
    \ into account when developing tools\n   for inferred LM, and make their behavior\
    \ in this regard clear to the\n   user.\n   Inferred LM provides only an approximate\
    \ view of the loss level\n   associated with a channel, but is typically applicable\
    \ even in cases\n   where direct LM is not.\n"
- title: 2.9.9.  Loss Measurement Scope
  contents:
  - "2.9.9.  Loss Measurement Scope\n   In the case of direct LM, where data-plane\
    \ packets are counted, there\n   are different possibilities for which kinds of\
    \ packets are included\n   in the count and which are excluded.  The set of packets\
    \ counted for\n   LM is called the \"loss measurement scope\".  As noted above,\
    \ one\n   factor affecting the LM scope is whether all data packets are counted\n\
    \   or only those belonging to a particular traffic class.  Another is\n   whether\
    \ various \"auxiliary\" flows associated with a data channel are\n   counted,\
    \ such as packets flowing over the G-ACh.  Implementations\n   MUST make their\
    \ supported LM scopes clear to the user, and care must\n   be taken to ensure\
    \ that the scopes of the channel endpoints agree.\n"
- title: 2.9.10.  Delay Measurement Accuracy
  contents:
  - "2.9.10.  Delay Measurement Accuracy\n   The delay measurement procedures described\
    \ in this document are\n   designed to facilitate hardware-assisted measurement\
    \ and to function\n   in the same way whether or not such hardware assistance\
    \ is used.  The\n   measurement accuracy will be determined by how closely the\
    \ transmit\n   and receive timestamps correspond to actual packet departure and\n\
    \   arrival times.\n   As noted in Section 2.4, measurement of one-way delay requires\
    \ clock\n   synchronization between the devices involved, while two-way delay\n\
    \   measurement does not involve direct comparison between non-local\n   timestamps\
    \ and thus has no synchronization requirement.  The\n   measurement accuracy will\
    \ be limited by the quality of the local\n   clock and, in the case of one-way\
    \ delay measurement, by the quality\n   of the synchronization.\n"
- title: 2.9.11.  Delay Measurement Timestamp Format
  contents:
  - "2.9.11.  Delay Measurement Timestamp Format\n   There are two significant timestamp\
    \ formats in common use: the\n   timestamp format of the Network Time Protocol\
    \ (NTP), described in\n   [RFC5905], and the timestamp format used in the IEEE\
    \ 1588 Precision\n   Time Protocol (PTP) [IEEE1588].\n   The NTP format has the\
    \ advantages of wide use and long deployment in\n   the Internet, and it was specifically\
    \ designed to make the\n   computation of timestamp differences as simple and\
    \ efficient as\n   possible.  On the other hand, there is now also a significant\n\
    \   deployment of equipment designed to support the PTP format.\n   The approach\
    \ taken in this document is therefore to include in DM\n   messages fields that\
    \ identify the timestamp formats used by the two\n   devices involved in a DM\
    \ operation.  This implies that a node\n   attempting to carry out a DM operation\
    \ may be faced with the problem\n   of computing with and possibly reconciling\
    \ different timestamp\n   formats.  To ensure interoperability, it is necessary\
    \ that support of\n   at least one timestamp format is mandatory.  This specification\n\
    \   requires the support of the IEEE 1588 PTP format.  Timestamp format\n   support\
    \ requirements are discussed in detail in Section 3.4.\n"
- title: 3.  Message Formats
  contents:
  - "3.  Message Formats\n   Loss Measurement and Delay Measurement messages flow\
    \ over the MPLS\n   Generic Associated Channel (G-ACh) [RFC5586].  Thus, a packet\n\
    \   containing an LM or DM message contains an MPLS label stack, with the\n  \
    \ G-ACh Label (GAL) at the bottom of the stack.  The GAL is followed by\n   an\
    \ Associated Channel Header (ACH), which identifies the message\n   type, and\
    \ the message body follows the ACH.\n   This document defines the following ACH\
    \ Channel Types:\n      MPLS Direct Loss Measurement (DLM)\n      MPLS Inferred\
    \ Loss Measurement (ILM)\n      MPLS Delay Measurement (DM)\n      MPLS Direct\
    \ Loss and Delay Measurement (DLM+DM)\n      MPLS Inferred Loss and Delay Measurement\
    \ (ILM+DM)\n   The message formats for direct and inferred LM are identical. \
    \ The\n   formats of the DLM+DM and ILM+DM messages are also identical.\n   For\
    \ these channel types, the ACH SHALL NOT be followed by the ACH TLV\n   Header\
    \ defined in [RFC5586].\n   The fixed-format portion of a message MAY be followed\
    \ by a block of\n   Type-Length-Value (TLV) fields.  The TLV block provides an\
    \ extensible\n   way of attaching subsidiary information to LM and DM messages.\n\
    \   Several such TLV fields are defined below.\n   All integer values for fields\
    \ defined in this document SHALL be\n   encoded in network byte order.\n"
- title: 3.1.  Loss Measurement Message Format
  contents:
  - "3.1.  Loss Measurement Message Format\n   The format of a Loss Measurement message,\
    \ which follows the\n   Associated Channel Header (ACH), is as follows:\n    \
    \    0                   1                   2                   3\n        0\
    \ 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \       |Version| Flags |  Control Code |        Message Length         |\n  \
    \     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n    \
    \   | DFlags|  OTF  |                   Reserved                    |\n      \
    \ +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n       |\
    \                       Session Identifier          |    DS     |\n       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \       |                        Origin Timestamp                       |\n  \
    \     |                                                               |\n    \
    \   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n      \
    \ |                           Counter 1                           |\n       |\
    \                                                               |\n       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \       .                                                               .\n  \
    \     .                                                               .\n    \
    \   .                                                               .\n      \
    \ +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n       |\
    \                           Counter 4                           |\n       |  \
    \                                                             |\n       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \       ~                           TLV Block                           ~\n  \
    \     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n    \
    \                  Loss Measurement Message Format\n   Reserved fields MUST be\
    \ set to 0 and ignored upon receipt.  The\n   possible values for the remaining\
    \ fields are as follows.\n   Field                 Meaning\n   ---------------------\
    \ -----------------------------------------------\n   Version               Protocol\
    \ version\n   Flags                 Message control flags\n   Control Code   \
    \       Code identifying the query or response type\n   Message Length       \
    \ Total length of this message in bytes\n   Data Format Flags     Flags specifying\
    \ the format of message data\n   (DFlags)\n   Origin Timestamp      Format of\
    \ the Origin Timestamp field\n   Format (OTF)\n   Reserved              Reserved\
    \ for future specification\n   Session Identifier    Set arbitrarily by the querier\n\
    \   Differentiated        Differentiated Services Code Point (DSCP) being\n  \
    \ Services (DS) Field   measured\n   Origin Timestamp      64-bit field for query\
    \ message transmission\n                         timestamp\n   Counter 1-4   \
    \        64-bit fields for LM counter values\n   TLV Block             Optional\
    \ block of Type-Length-Value fields\n   The possible values for these fields are\
    \ as follows.\n   Version: Currently set to 0.\n   Flags: The format of the Flags\
    \ field is shown below.\n                               +-+-+-+-+\n          \
    \                     |R|T|0|0|\n                               +-+-+-+-+\n  \
    \                    Loss Measurement Message Flags\n   The meanings of the flag\
    \ bits are:\n      R: Query/Response indicator.  Set to 0 for a Query and 1 for\
    \ a\n      Response.\n      T: Traffic-class-specific measurement indicator. \
    \ Set to 1 when\n      the measurement operation is scoped to packets of a particular\n\
    \      traffic class (DSCP value), and 0 otherwise.  When set to 1, the\n    \
    \  DS field of the message indicates the measured traffic class.\n      0: Set\
    \ to 0.\n   Control Code: Set as follows according to whether the message is a\n\
    \   Query or a Response as identified by the R flag.\n      For a Query:\n   \
    \      0x0: In-band Response Requested.  Indicates that this query has\n     \
    \    been sent over a bidirectional channel and the response is\n         expected\
    \ over the same channel.\n         0x1: Out-of-band Response Requested.  Indicates\
    \ that the\n         response should be sent via an out-of-band channel.\n   \
    \      0x2: No Response Requested.  Indicates that no response to the\n      \
    \   query should be sent.  This mode can be used, for example, if\n         all\
    \ nodes involved are being controlled by a Network Management\n         System.\n\
    \      For a Response:\n         Codes 0x0-0xF are reserved for non-error responses.\
    \  Error\n         response codes imply that the response does not contain valid\n\
    \         measurement data.\n         0x1: Success.  Indicates that the operation\
    \ was successful.\n         0x2: Notification - Data Format Invalid.  Indicates\
    \ that the\n         query was processed, but the format of the data fields in\
    \ this\n         response may be inconsistent.  Consequently, these data fields\n\
    \         MUST NOT be used for measurement.\n         0x3: Notification - Initialization\
    \ in Progress.  Indicates that\n         the query was processed but this response\
    \ does not contain\n         valid measurement data because the responder's initialization\n\
    \         process has not completed.\n         0x4: Notification - Data Reset\
    \ Occurred.  Indicates that the\n         query was processed, but a reset has\
    \ recently occurred that may\n         render the data in this response inconsistent\
    \ relative to\n         earlier responses.\n         0x5: Notification - Resource\
    \ Temporarily Unavailable.\n         Indicates that the query was processed, but\
    \ resources were\n         unavailable to complete the requested measurement and\
    \ that,\n         consequently, this response does not contain valid measurement\n\
    \         data.\n         0x10: Error - Unspecified Error.  Indicates that the\
    \ operation\n         failed for an unspecified reason.\n         0x11: Error\
    \ - Unsupported Version.  Indicates that the\n         operation failed because\
    \ the protocol version supplied in the\n         query message is not supported.\n\
    \         0x12: Error - Unsupported Control Code.  Indicates that the\n      \
    \   operation failed because the Control Code requested an\n         operation\
    \ that is not available for this channel.\n         0x13: Error - Unsupported\
    \ Data Format.  Indicates that the\n         operation failed because the data\
    \ format specified in the query\n         is not supported.\n         0x14: Error\
    \ - Authentication Failure.  Indicates that the\n         operation failed because\
    \ the authentication data supplied in\n         the query was missing or incorrect.\n\
    \         0x15: Error - Invalid Destination Node Identifier.  Indicates\n    \
    \     that the operation failed because the Destination Node\n         Identifier\
    \ supplied in the query is not an identifier of this\n         node.\n       \
    \  0x16: Error - Connection Mismatch.  Indicates that the\n         operation\
    \ failed because the channel identifier supplied in the\n         query did not\
    \ match the channel over which the query was\n         received.\n         0x17:\
    \ Error - Unsupported Mandatory TLV Object.  Indicates that\n         the operation\
    \ failed because a TLV Object received in the query\n         and marked as mandatory\
    \ is not supported.\n         0x18: Error - Unsupported Query Interval.  Indicates\
    \ that the\n         operation failed because the query message rate exceeded\
    \ the\n         configured threshold.\n         0x19: Error - Administrative Block.\
    \  Indicates that the\n         operation failed because it has been administratively\n\
    \         disallowed.\n         0x1A: Error - Resource Unavailable.  Indicates\
    \ that the\n         operation failed because node resources were not available.\n\
    \         0x1B: Error - Resource Released.  Indicates that the operation\n   \
    \      failed because node resources for this measurement session were\n     \
    \    administratively released.\n         0x1C: Error - Invalid Message.  Indicates\
    \ that the operation\n         failed because the received query message was malformed.\n\
    \         0x1D: Error - Protocol Error.  Indicates that the operation\n      \
    \   failed because a protocol error was found in the received query\n        \
    \ message.\n   Message Length: Set to the total length of this message in bytes,\n\
    \   including the Version, Flags, Control Code, and Message Length fields\n  \
    \ as well as the TLV Block, if any.\n   DFlags: The format of the DFlags field\
    \ is shown below.\n                               +-+-+-+-+\n                \
    \               |X|B|0|0|\n                               +-+-+-+-+\n        \
    \                     Data Format Flags\n   The meanings of the DFlags bits are:\n\
    \      X: Extended counter format indicator.  Indicates the use of\n      extended\
    \ (64-bit) counter values.  Initialized to 1 upon creation\n      (and prior to\
    \ transmission) of an LM Query and copied from an LM\n      Query to an LM response.\
    \  Set to 0 when the LM message is\n      transmitted or received over an interface\
    \ that writes 32-bit\n      counter values.\n      B: Octet (byte) count.  When\
    \ set to 1, indicates that the Counter\n      1-4 fields represent octet counts.\
    \  The octet count applies to all\n      packets within the LM scope (Section\
    \ 2.9.9), and the octet count\n      of a packet sent or received over a channel\
    \ includes the total\n      length of that packet (but excludes headers, labels,\
    \ or framing of\n      the channel itself).  When set to 0, indicates that the\
    \ Counter\n      1-4 fields represent packet counts.\n      0: Set to 0.\n   Origin\
    \ Timestamp Format: The format of the Origin Timestamp field, as\n   specified\
    \ in Section 3.4.\n   Session Identifier: Set arbitrarily in a query and copied\
    \ in the\n   response, if any.  This field uniquely identifies a measurement\n\
    \   operation (also called a session) that consists of a sequence of\n   messages.\
    \  All messages in the sequence have the same Session\n   Identifier.\n   DS:\
    \ When the T flag is set to 1, this field is set to the DSCP value\n   [RFC3260]\
    \ that corresponds to the traffic class being measured.  For\n   MPLS, where the\
    \ traffic class of a channel is identified by the\n   three-bit Traffic Class\
    \ in the channel's LSE [RFC5462], this field\n   SHOULD be set to the Class Selector\
    \ Codepoint [RFC2474] that\n   corresponds to that Traffic Class.  When the T\
    \ flag is set to 0, the\n   value of this field is arbitrary, and the field can\
    \ be considered\n   part of the Session Identifier.\n   Origin Timestamp: Timestamp\
    \ recording the transmit time of the query\n   message.\n   Counter 1-4: Referring\
    \ to Section 2.2, when a query is sent from A,\n   Counter 1 is set to A_TxP and\
    \ the other counter fields are set to 0.\n   When the query is received at B,\
    \ Counter 2 is set to B_RxP.  At this\n   point, B copies Counter 1 to Counter\
    \ 3 and Counter 2 to Counter 4,\n   and re-initializes Counter 1 and Counter 2\
    \ to 0.  When B transmits\n   the response, Counter 1 is set to B_TxP.  When the\
    \ response is\n   received at A, Counter 2 is set to A_RxP.\n   The mapping of\
    \ counter types such as A_TxP to the Counter 1-4 fields\n   is designed to ensure\
    \ that transmit counter values are always written\n   at the same fixed offset\
    \ in the packet, and likewise for receive\n   counters.  This property may be\
    \ important for hardware processing.\n   When a 32-bit counter value is written\
    \ to one of the counter fields,\n   that value SHALL be written to the low-order\
    \ 32 bits of the field;\n   the high-order 32 bits of the field MUST, in this\
    \ case, be set to 0.\n   TLV Block: Zero or more TLV fields.\n"
- title: 3.2.  Delay Measurement Message Format
  contents:
  - "3.2.  Delay Measurement Message Format\n   The format of a Delay Measurement\
    \ message, which follows the\n   Associated Channel Header (ACH), is as follows:\n\
    \        0                   1                   2                   3\n     \
    \   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \       |Version| Flags |  Control Code |        Message Length         |\n  \
    \     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n    \
    \   |  QTF  |  RTF  | RPTF  |              Reserved                 |\n      \
    \ +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n       |\
    \                       Session Identifier          |    DS     |\n       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \       |                           Timestamp 1                         |\n  \
    \     |                                                               |\n    \
    \   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n      \
    \ .                                                               .\n       .\
    \                                                               .\n       .  \
    \                                                             .\n       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \       |                           Timestamp 4                         |\n  \
    \     |                                                               |\n    \
    \   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n      \
    \ ~                           TLV Block                           ~\n       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \                     Delay Measurement Message Format\n   The meanings of the\
    \ fields are summarized in the following table.\n   Field                 Meaning\n\
    \   --------------------- -----------------------------------------------\n  \
    \ Version               Protocol version\n   Flags                 Message control\
    \ flags\n   Control Code          Code identifying the query or response type\n\
    \   Message Length        Total length of this message in bytes\n   QTF      \
    \             Querier timestamp format\n   RTF                   Responder timestamp\
    \ format\n   RPTF                  Responder's preferred timestamp format\n  \
    \ Reserved              Reserved for future specification\n   Session Identifier\
    \    Set arbitrarily by the querier\n   Differentiated        Differentiated Services\
    \ Code Point (DSCP) being\n   Services (DS) Field   measured\n   Timestamp 1-4\
    \         64-bit timestamp values\n   TLV Block             Optional block of\
    \ Type-Length-Value fields\n   Reserved fields MUST be set to 0 and ignored upon\
    \ receipt.  The\n   possible values for the remaining fields are as follows.\n\
    \   Version: Currently set to 0.\n   Flags: As specified in Section 3.1.  The\
    \ T flag in a DM message is\n   set to 1.\n   Control Code: As specified in Section\
    \ 3.1.\n   Message Length: Set to the total length of this message in bytes,\n\
    \   including the Version, Flags, Control Code, and Message Length fields\n  \
    \ as well as the TLV Block, if any.\n   Querier Timestamp Format: The format of\
    \ the timestamp values written\n   by the querier, as specified in Section 3.4.\n\
    \   Responder Timestamp Format: The format of the timestamp values\n   written\
    \ by the responder, as specified in Section 3.4.\n   Responder's Preferred Timestamp\
    \ Format: The timestamp format\n   preferred by the responder, as specified in\
    \ Section 3.4.\n   Session Identifier: As specified in Section 3.1.\n   DS: As\
    \ specified in Section 3.1.\n   Timestamp 1-4: Referring to Section 2.4, when\
    \ a query is sent from A,\n   Timestamp 1 is set to T1 and the other timestamp\
    \ fields are set to 0.\n   When the query is received at B, Timestamp 2 is set\
    \ to T2.  At this\n   point, B copies Timestamp 1 to Timestamp 3 and Timestamp\
    \ 2 to\n   Timestamp 4, and re-initializes Timestamp 1 and Timestamp 2 to 0.\n\
    \   When B transmits the response, Timestamp 1 is set to T3.  When the\n   response\
    \ is received at A, Timestamp 2 is set to T4.  The actual\n   formats of the timestamp\
    \ fields written by A and B are indicated by\n   the Querier Timestamp Format\
    \ and Responder Timestamp Format fields\n   respectively.\n   The mapping of timestamps\
    \ to the Timestamp 1-4 fields is designed to\n   ensure that transmit timestamps\
    \ are always written at the same fixed\n   offset in the packet, and likewise\
    \ for receive timestamps.  This\n   property is important for hardware processing.\n\
    \   TLV Block: Zero or more TLV fields.\n"
- title: 3.3.  Combined Loss/Delay Measurement Message Format
  contents:
  - "3.3.  Combined Loss/Delay Measurement Message Format\n   The format of a combined\
    \ Loss and Delay Measurement message, which\n   follows the Associated Channel\
    \ Header (ACH), is as follows:\n        0                   1                \
    \   2                   3\n        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\
    \ 2 3 4 5 6 7 8 9 0 1\n       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \       |Version| Flags |  Control Code |        Message Length         |\n  \
    \     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n    \
    \   | DFlags|  QTF  |  RTF  | RPTF  |           Reserved            |\n      \
    \ +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n       |\
    \                       Session Identifier          |    DS     |\n       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \       |                           Timestamp 1                         |\n  \
    \     |                                                               |\n    \
    \   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n      \
    \ .                                                               .\n       .\
    \                                                               .\n       .  \
    \                                                             .\n       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \       |                           Timestamp 4                         |\n  \
    \     |                                                               |\n    \
    \   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n      \
    \ |                           Counter 1                           |\n       |\
    \                                                               |\n       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \       .                                                               .\n  \
    \     .                                                               .\n    \
    \   .                                                               .\n      \
    \ +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n       |\
    \                           Counter 4                           |\n       |  \
    \                                                             |\n       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \       ~                           TLV Block                           ~\n  \
    \     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n    \
    \               Loss/Delay Measurement Message Format\n   The fields of this message\
    \ have the same meanings as the\n   corresponding fields in the LM and DM message\
    \ formats, except that\n   the roles of the OTF and Origin Timestamp fields for\
    \ LM are here\n   played by the QTF and Timestamp 1 fields, respectively.\n"
- title: 3.4.  Timestamp Field Formats
  contents:
  - "3.4.  Timestamp Field Formats\n   The following timestamp format field values\
    \ are specified in this\n   document:\n      0: Null timestamp format.  This value\
    \ is a placeholder indicating\n      that the timestamp field does not contain\
    \ a meaningful timestamp.\n      1: Sequence number.  This value indicates that\
    \ the timestamp field\n      is to be viewed as a simple 64-bit sequence number.\
    \  This provides\n      a simple solution for applications that do not require\
    \ a real\n      absolute timestamp, but only an indication of message ordering;\
    \ an\n      example is LM exception detection.\n      2: Network Time Protocol\
    \ version 4 64-bit timestamp format\n      [RFC5905].  This format consists of\
    \ a 32-bit seconds field\n      followed by a 32-bit fractional seconds field,\
    \ so that it can be\n      regarded as a fixed-point 64-bit quantity.\n      3:\
    \ Low-order 64 bits of the IEEE 1588-2008 (1588v2) Precision Time\n      Protocol\
    \ timestamp format [IEEE1588].  This truncated format\n      consists of a 32-bit\
    \ seconds field followed by a 32-bit\n      nanoseconds field, and is the same\
    \ as the IEEE 1588v1 timestamp\n      format.\n   Timestamp formats of n < 64\
    \ bits in size SHALL be encoded in the\n   64-bit timestamp fields specified in\
    \ this document using the n high-\n   order bits of the field.  The remaining\
    \ 64 - n low-order bits in the\n   field SHOULD be set to 0 and MUST be ignored\
    \ when reading the field.\n   To ensure that it is possible to find an interoperable\
    \ mode between\n   implementations, it is necessary to select one timestamp format\
    \ as\n   the default.  The timestamp format chosen as the default is the\n   truncated\
    \ IEEE 1588 PTP format (format code 3 in the list above);\n   this format MUST\
    \ be supported.  The rationale for this choice is\n   discussed in Appendix A.\
    \  Implementations SHOULD also be capable of\n   reading timestamps written in\
    \ NTPv4 64-bit format and reconciling\n   them internally with PTP timestamps\
    \ for measurement purposes.\n   Support for other timestamp formats is OPTIONAL.\n\
    \   The implementation MUST make clear which timestamp formats it\n   supports\
    \ and the extent of its support for computation with and\n   reconciliation of\
    \ different formats for measurement purposes.\n"
- title: 3.5.  TLV Objects
  contents:
  - "3.5.  TLV Objects\n   The TLV Block in LM and DM messages consists of zero or\
    \ more objects\n   with the following format:\n        0                   1 \
    \                  2                   3\n        0 1 2 3 4 5 6 7 8 9 0 1 2 3\
    \ 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \       |     Type      |    Length     |        Value                  ~\n  \
    \     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n    \
    \                            TLV Format\n   The Type and Length fields are each\
    \ 8 bits long, and the Length field\n   indicates the size in bytes of the Value\
    \ field, which can therefore\n   be up to 255 bytes long.\n   The Type space is\
    \ divided into Mandatory and Optional subspaces:\n   Type Range     Semantics\n\
    \   -------------- ---------\n   0-127          Mandatory\n   128-255        Optional\n\
    \   Upon receipt of a query message including an unrecognized mandatory\n   TLV\
    \ object, the recipient MUST respond with an Unsupported Mandatory\n   TLV Object\
    \ error code.\n   The types defined are as follows:\n   Type           Definition\n\
    \   -------------- ---------------------------------\n   Mandatory\n   0     \
    \         Padding - copy in response\n   1              Return Address\n   2 \
    \             Session Query Interval\n   3              Loopback Request\n   4-126\
    \          Unallocated\n   127            Experimental use\n   Optional\n   128\
    \            Padding - do not copy in response\n   129            Destination\
    \ Address\n   130            Source Address\n   131-254        Unallocated\n \
    \  255            Experimental use\n"
- title: 3.5.1.  Padding
  contents:
  - "3.5.1.  Padding\n   The two padding objects permit the augmentation of packet\
    \ size; this\n   is mainly useful for delay measurement.  The type of padding\n\
    \   indicates whether the padding supplied by the querier is to be copied\n  \
    \ to, or omitted from, the response.  Asymmetrical padding may be\n   useful when\
    \ responses are delivered out-of-band or when different\n   maximum transmission\
    \ unit sizes apply to the two components of a\n   bidirectional channel.\n   More\
    \ than one padding object MAY be present, in which case they MUST\n   be contiguous.\
    \  The Value field of a padding object is arbitrary.\n"
- title: 3.5.2.  Addressing
  contents:
  - "3.5.2.  Addressing\n   The addressing objects have the following format:\n  \
    \      0                   1                   2                   3\n       \
    \ 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \       |     Type      |    Length     |        Address Family         |\n  \
    \     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n    \
    \   ~                           Address                             ~\n      \
    \ +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n        \
    \                 Addressing Object Format\n   The Address Family field indicates\
    \ the type of the address, and it\n   SHALL be set to one of the assigned values\
    \ in the \"IANA Address\n   Family Numbers\" registry.\n   The Source and Destination\
    \ Address objects indicate the addresses of\n   the sender and the intended recipient\
    \ of the message, respectively.\n   The Source Address of a query message SHOULD\
    \ be used as the\n   destination for an out-of-band response unless some other\
    \ out-of-band\n   response mechanism has been configured, and unless a Return\
    \ Address\n   object is present, in which case the Return Address specifies the\n\
    \   target of the response.  The Return Address object MUST NOT appear in\n  \
    \ a response.\n"
- title: 3.5.3.  Loopback Request
  contents:
  - "3.5.3.  Loopback Request\n   The Loopback Request object, when included in a\
    \ query, indicates a\n   request that the query message be returned to the sender\
    \ unmodified.\n   This object has a Length of 0.\n   Upon receiving the reflected\
    \ query message back from the responder,\n   the querier MUST NOT retransmit the\
    \ message.  Information that\n   uniquely identifies the original query source,\
    \ such as a Source\n   Address object, can be included to enable the querier to\n\
    \   differentiate one of its own loopback queries from a loopback query\n   initiated\
    \ by the far end.\n   This object may be useful, for example, when the querier\
    \ is\n   interested only in the round-trip delay metric.  In this case, no\n \
    \  support for delay measurement is required at the responder at all,\n   other\
    \ than the ability to recognize a DM query that includes this\n   object and return\
    \ it unmodified.\n"
- title: 3.5.4.  Session Query Interval
  contents:
  - "3.5.4.  Session Query Interval\n   The Value field of the Session Query Interval\
    \ object is a 32-bit\n   unsigned integer that specifies a time interval in milliseconds.\n\
    \        0                   1                   2                   3\n     \
    \   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \       |     Type      |    Length     |            Session Query      >\n  \
    \     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n    \
    \   <        Interval (ms)          |\n       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \                   Session Query Interval Object Format\n   This time interval\
    \ indicates the interval between successive query\n   messages in a specific measurement\
    \ session.  The purpose of the\n   Session Query Interval (SQI) object is to enable\
    \ the querier and\n   responder of a measurement session to agree on a query rate.\
    \  The\n   procedures for handling this object SHALL be as follows:\n   1.  The\
    \ querier notifies the responder that it wishes to be informed\n       of the\
    \ responder's minimum query interval for this session by\n       including the\
    \ SQI object in its query messages, with a Value of\n       0.\n   2.  When the\
    \ responder receives a query that includes an SQI object\n       with a Value\
    \ of 0, the responder includes an SQI object in the\n       response with the\
    \ Value set to the minimum query interval it\n       supports for this session.\n\
    \   3.  When the querier receives a response that includes an SQI object,\n  \
    \     it selects a query interval for the session that is greater than\n     \
    \  or equal to the Value specified in the SQI object and adjusts its\n       query\
    \ transmission rate accordingly, including in each subsequent\n       query an\
    \ SQI object with a Value equal to the selected query\n       interval.  Once\
    \ a response to one of these subsequent queries has\n       been received, the\
    \ querier infers that the responder has been\n       apprised of the selected\
    \ query interval and MAY then stop\n       including the SQI object in queries\
    \ associated with this session.\n   Similar procedures allow the query rate to\
    \ be changed during the\n   course of the session by either the querier or the\
    \ responder.  For\n   example, to inform the querier of a change in the minimum\
    \ supported\n   query interval, the responder begins including a corresponding\
    \ SQI\n   object in its responses, and the querier adjusts its query rate if\n\
    \   necessary and includes a corresponding SQI object in its queries\n   until\
    \ a response is received.\n   Shorter query intervals (i.e., higher query rates)\
    \ provide finer\n   measurement granularity at the expense of additional load\
    \ on\n   measurement endpoints and the network; see Section 6 for further\n  \
    \ discussion.\n"
- title: 4.  Operation
  contents:
  - '4.  Operation

    '
- title: 4.1.  Operational Overview
  contents:
  - "4.1.  Operational Overview\n   A loss or delay measurement operation, also called\
    \ a session, is\n   controlled by the querier and consists of a sequence of query\n\
    \   messages associated with a particular channel and a common set of\n   measurement\
    \ parameters.  If the session parameters include a response\n   request, then\
    \ the receiving node or nodes will (under normal\n   conditions) generate a response\
    \ message for each query message\n   received, and these responses are also considered\
    \ part of the\n   session.  All query and response messages in a session carry\
    \ a common\n   session identifier.\n   Measurement sessions are initiated at the\
    \ discretion of the network\n   operator and are terminated either at the operator's\
    \ request or as\n   the result of an error condition.  A session may be as brief\
    \ as a\n   single message exchange, for example when a DM query is used by the\n\
    \   operator to \"ping\" a remote node, or it may extend throughout the\n   lifetime\
    \ of the channel.\n   When a session is initiated for which responses are requested,\
    \ the\n   querier SHOULD initialize a timer, called the SessionResponseTimeout,\n\
    \   that indicates how long the querier will wait for a response before\n   abandoning\
    \ the session and notifying the user that a timeout has\n   occurred.  This timer\
    \ persists for the lifetime of the session and is\n   reset each time a response\
    \ message for the session is received.\n   When a query message is received that\
    \ requests a response, a variety\n   of exceptional conditions may arise that\
    \ prevent the responder from\n   generating a response that contains valid measurement\
    \ data.  Such\n   conditions fall broadly into two classes: transient exceptions\
    \ from\n   which recovery is possible and fatal exceptions that require\n   termination\
    \ of the session.  When an exception arises, the responder\n   SHOULD generate\
    \ a response with an appropriate Notification or Error\n   control code according\
    \ to whether the exception is, respectively,\n   transient or fatal.  When the\
    \ querier receives an Error response, the\n   session MUST be terminated and the\
    \ user informed.\n   A common example of a transient exception occurs when a new\
    \ session\n   is initiated and the responder requires a period of time to become\n\
    \   ready before it can begin providing useful responses.  The response\n   control\
    \ code corresponding to this situation is Notification -\n   Initialization in\
    \ Progress.  Typical examples of fatal exceptions are\n   cases where the querier\
    \ has requested a type of measurement that the\n   responder does not support\
    \ or where a query message is malformed.\n   When initiating a session, the querier\
    \ SHOULD employ the Session\n   Query Interval mechanism (Section 3.5.4) to establish\
    \ a mutually\n   agreeable query rate with the responder.  Responders SHOULD employ\n\
    \   rate-limiting mechanisms to guard against the possibility of\n   receiving\
    \ an excessive quantity of query messages.\n"
- title: 4.2.  Loss Measurement Procedures
  contents:
  - '4.2.  Loss Measurement Procedures

    '
- title: 4.2.1.  Initiating a Loss Measurement Operation
  contents:
  - "4.2.1.  Initiating a Loss Measurement Operation\n   An LM operation for a particular\
    \ channel consists of sending a\n   sequence (LM[1], LM[2], ...) of LM query messages\
    \ over the channel at\n   a specific rate and processing the responses received,\
    \ if any.  As\n   described in Section 2.2, the packet loss associated with the\
    \ channel\n   during the operation is computed as a delta between successive\n\
    \   messages; these deltas can be accumulated to obtain a running total\n   of\
    \ the packet loss for the channel or be used to derive related\n   metrics such\
    \ as the average loss rate.\n   The query message transmission rate MUST be sufficiently\
    \ high, given\n   the LM message counter size (which can be either 32 or 64 bits)\
    \ and\n   the speed and minimum packet size of the underlying channel, that the\n\
    \   ambiguity condition noted in Section 2.2 cannot arise.  In evaluating\n  \
    \ this rate, the implementation SHOULD assume that the counter size is\n   32\
    \ bits unless explicitly configured otherwise or unless (in the case\n   of a\
    \ bidirectional channel) all local and remote interfaces involved\n   in the LM\
    \ operation are known to be 64-bit-capable, which can be\n   inferred from the\
    \ value of the X flag in an LM response.\n"
- title: 4.2.2.  Transmitting a Loss Measurement Query
  contents:
  - "4.2.2.  Transmitting a Loss Measurement Query\n   When transmitting an LM Query,\
    \ the Version field MUST be set to 0.\n   The R flag MUST be set to 0.  The T\
    \ flag SHALL be set to 1 if, and\n   only if, the measurement is specific to a\
    \ particular traffic class,\n   in which case the DS field SHALL identify that\
    \ traffic class.\n   The X flag MUST be set to 1 if the transmitting interface\
    \ writes\n   64-bit LM counters and otherwise MUST be set to 0 to indicate that\n\
    \   32-bit counters are written.  The B flag SHALL be set to 1 to\n   indicate\
    \ that the counter fields contain octet counts or to 0 to\n   indicate packet\
    \ counts.\n   The Control Code field MUST be set to one of the values for Query\n\
    \   messages listed in Section 3.1; if the channel is unidirectional,\n   this\
    \ field MUST NOT be set to 0x0 (Query: In-band Response\n   Requested).\n   The\
    \ Session Identifier field can be set arbitrarily.\n   The Origin Timestamp field\
    \ SHALL be set to the time at which this\n   message is transmitted, and the Origin\
    \ Timestamp Format field MUST be\n   set to indicate its format, according to\
    \ Section 3.4.\n   The Counter 1 field SHOULD be set to the total count of units\n\
    \   (packets or octets, according to the B flag) transmitted over the\n   channel\
    \ prior to this LM Query, or to 0 if this is the beginning of a\n   measurement\
    \ session for which counter data is not yet available.  The\n   Counter 2 field\
    \ MUST be set to 0.  If a response was previously\n   received in this measurement\
    \ session, the Counter 1 and Counter 2\n   fields of the most recent such response\
    \ MAY be copied to the Counter\n   3 and Counter 4 fields, respectively, of this\
    \ query; otherwise, the\n   Counter 3 and Counter 4 fields MUST be set to 0.\n"
- title: 4.2.3.  Receiving a Loss Measurement Query
  contents:
  - "4.2.3.  Receiving a Loss Measurement Query\n   Upon receipt of an LM Query message,\
    \ the Counter 2 field SHOULD be\n   set to the total count of units (packets or\
    \ octets, according to the\n   B flag) received over the channel prior to this\
    \ LM Query.  If the\n   receiving interface writes 32-bit LM counters, the X flag\
    \ MUST be set\n   to 0.\n   At this point, the LM Query message must be inspected.\
    \  If the\n   Control Code field is set to 0x2 (No Response Requested), an LM\n\
    \   Response message MUST NOT be transmitted.  If the Control Code field\n   is\
    \ set to 0x0 (In-band Response Requested) or 0x1 (Out-of-band\n   Response Requested),\
    \ then an in-band or out-of-band response,\n   respectively, SHOULD be transmitted\
    \ unless this has been prevented by\n   an administrative, security, or congestion\
    \ control mechanism.\n   In the case of a fatal exception that prevents the requested\n\
    \   measurement from being made, the error SHOULD be reported, via either\n  \
    \ a response, if one was requested, or else as a notification to the\n   user.\n"
- title: 4.2.4.  Transmitting a Loss Measurement Response
  contents:
  - "4.2.4.  Transmitting a Loss Measurement Response\n   When constructing a Response\
    \ to an LM Query, the Version field MUST\n   be set to 0.  The R flag MUST be\
    \ set to 1.  The value of the T flag\n   MUST be copied from the LM Query.\n \
    \  The X flag MUST be set to 0 if the transmitting interface writes\n   32-bit\
    \ LM counters; otherwise, its value MUST be copied from the LM\n   Query.  The\
    \ B flag MUST be copied from the LM Query.\n   The Session Identifier, Origin\
    \ Timestamp, and Origin Timestamp Format\n   fields MUST be copied from the LM\
    \ Query.  The Counter 1 and Counter 2\n   fields from the LM Query MUST be copied\
    \ to the Counter 3 and Counter\n   4 fields, respectively, of the LM Response.\n\
    \   The Control Code field MUST be set to one of the values for Response\n   messages\
    \ listed in Section 3.1.  The value 0x10 (Unspecified Error)\n   SHOULD NOT be\
    \ used if one of the other more specific error codes is\n   applicable.\n   If\
    \ the response is transmitted in-band, the Counter 1 field SHOULD be\n   set to\
    \ the total count of units transmitted over the channel prior to\n   this LM Response.\
    \  If the response is transmitted out-of-band, the\n   Counter 1 field MUST be\
    \ set to 0.  In either case, the Counter 2\n   field MUST be set to 0.\n"
- title: 4.2.5.  Receiving a Loss Measurement Response
  contents:
  - "4.2.5.  Receiving a Loss Measurement Response\n   Upon in-band receipt of an\
    \ LM Response message, the Counter 2 field\n   is set to the total count of units\
    \ received over the channel prior to\n   this LM Response.  If the receiving interface\
    \ writes 32-bit LM\n   counters, the X flag is set to 0.  (Since the life of the\
    \ LM message\n   in the network has ended at this point, it is up to the receiver\n\
    \   whether these final modifications are made to the packet.  If the\n   message\
    \ is to be forwarded on for external post-processing\n   (Section 2.9.7), then\
    \ these modifications MUST be made.)\n   Upon out-of-band receipt of an LM Response\
    \ message, the Counter 1 and\n   Counter 2 fields MUST NOT be used for purposes\
    \ of loss measurement.\n   If the Control Code in an LM Response is anything other\
    \ than 0x1\n   (Success), the counter values in the response MUST NOT be used\
    \ for\n   purposes of loss measurement.  If the Control Code indicates an error\n\
    \   condition, or if the response message is invalid, the LM operation\n   MUST\
    \ be terminated and an appropriate notification to the user\n   generated.\n"
- title: 4.2.6.  Loss Calculation
  contents:
  - "4.2.6.  Loss Calculation\n   Calculation of packet loss is carried out according\
    \ to the procedures\n   in Section 2.2.  The X flag in an LM message informs the\
    \ device\n   performing the calculation whether to perform 32-bit or 64-bit\n\
    \   arithmetic.  If the flag value is equal to 1, all interfaces involved\n  \
    \ in the LM operation have written 64-bit counter values, and 64-bit\n   arithmetic\
    \ can be used.  If the flag value is equal to 0, at least\n   one interface involved\
    \ in the operation has written a 32-bit counter\n   value, and 32-bit arithmetic\
    \ is carried out using the low-order 32\n   bits of each counter value.\n   Note\
    \ that the semantics of the X flag allow all devices to\n   interoperate regardless\
    \ of their counter size support.  Thus, an\n   implementation MUST NOT generate\
    \ an error response based on the value\n   of this flag.\n"
- title: 4.2.7.  Quality of Service
  contents:
  - "4.2.7.  Quality of Service\n   The TC field of the LSE corresponding to the channel\
    \ (e.g., LSP)\n   being measured SHOULD be set to a traffic class equal to or\
    \ better\n   than the best TC within the measurement scope to minimize the chance\n\
    \   of out-of-order conditions.\n"
- title: 4.2.8.  G-ACh Packets
  contents:
  - "4.2.8.  G-ACh Packets\n   By default, direct LM MUST exclude packets transmitted\
    \ and received\n   over the Generic Associated Channel (G-ACh).  An implementation\
    \ MAY\n   provide the means to alter the direct LM scope to include some or all\n\
    \   G-ACh messages.  Care must be taken when altering the LM scope to\n   ensure\
    \ that both endpoints are in agreement.\n"
- title: 4.2.9.  Test Messages
  contents:
  - "4.2.9.  Test Messages\n   In the case of inferred LM, the packets counted for\
    \ LM consist of\n   test messages generated for this purpose, or of some other\
    \ class of\n   packets deemed to provide a good proxy for data packets flowing\
    \ over\n   the channel.  The specification of test protocols and proxy packets\n\
    \   is outside the scope of this document, but some guidelines are\n   discussed\
    \ below.\n   An identifier common to both the test or proxy messages and the LM\n\
    \   messages may be required to make correlation possible.  The combined\n   value\
    \ of the Session Identifier and DS fields SHOULD be used for this\n   purpose\
    \ when possible.  That is, test messages in this case will\n   include a 32-bit\
    \ field that can carry the value of the combined\n   Session Identifier + DS field\
    \ present in LM messages.  When TC-\n   specific LM is conducted, the DS field\
    \ of the LSE in the label stack\n   of a test message corresponding to the channel\
    \ (e.g., LSP) over which\n   the message is sent MUST correspond to the DS value\
    \ in the associated\n   LM messages.\n   A separate test message protocol SHOULD\
    \ include a timeout value in\n   its messages that informs the responder when\
    \ to discard any state\n   associated with a specific test.\n"
- title: 4.2.10.  Message Loss and Packet Misorder Conditions
  contents:
  - "4.2.10.  Message Loss and Packet Misorder Conditions\n   Because an LM operation\
    \ consists of a message sequence with state\n   maintained from one message to\
    \ the next, LM is subject to the effects\n   of lost messages and misordered packets\
    \ in a way that DM is not.\n   Because this state exists only on the querier,\
    \ the handling of these\n   conditions is, strictly speaking, a local matter.\
    \  This section,\n   however, presents recommended procedures for handling such\n\
    \   conditions.  Note that in the absence of ECMP, packet misordering\n   within\
    \ a traffic class is a relatively rare event.\n   The first kind of anomaly that\
    \ may occur is that one or more LM\n   messages may be lost in transit.  The effect\
    \ of such loss is that\n   when an LM Response is next received at the querier,\
    \ an unambiguous\n   interpretation of the counter values it contains may be impossible,\n\
    \   for the reasons described at the end of Section 2.2.  Whether this is\n  \
    \ so depends on the number of messages lost and the other variables\n   mentioned\
    \ in that section, such as the LM message rate and the\n   channel parameters.\n\
    \   Another possibility is that LM messages are misordered in transit, so\n  \
    \ that, for instance, the response to LM[n] is received prior to the\n   response\
    \ to LM[n-1].  A typical implementation will discard the late\n   response to\
    \ LM[n-1], so that the effect is the same as the case of a\n   lost message.\n\
    \   Finally, LM is subject to the possibility that data packets are\n   misordered\
    \ relative to LM messages.  This condition can result, for\n   example, in a transmit\
    \ count of 100 and a corresponding receive count\n   of 101.  The effect here\
    \ is that the A_TxLoss[n-1,n] value (for\n   example) for a given measurement\
    \ interval will appear to be extremely\n   (if not impossibly) large.  The other\
    \ case, where an LM message\n   arrives earlier than some of the packets, simply\
    \ results in those\n   packets being counted as lost.\n   An implementation SHOULD\
    \ identify a threshold value that indicates\n   the upper bound of lost packets\
    \ measured in a single computation\n   beyond which the interval is considered\
    \ unmeasurable.  This is called\n   the \"MaxLMIntervalLoss threshold\".  It is\
    \ clear that this threshold\n   should be no higher than the maximum number of\
    \ packets (or bytes) the\n   channel is capable of transmitting over the interval,\
    \ but it may be\n   lower.  Upon encountering an unmeasurable interval, the LM\
    \ state\n   (i.e., data values from the last LM message received) SHOULD be\n\
    \   discarded.\n   With regard to lost LM messages, the MaxLMInterval (see Section\
    \ 2.2)\n   indicates the maximum amount of time that can elapse before the LM\n\
    \   state is discarded.  If some messages are lost, but a message is\n   subsequently\
    \ received within MaxLMInterval, its timestamp or sequence\n   number will quantify\
    \ the loss, and it MAY still be used for\n   measurement, although the measurement\
    \ interval will in this case be\n   longer than usual.\n   If an LM message is\
    \ received that has a timestamp less than or equal\n   to the timestamp of the\
    \ last LM message received, this indicates that\n   an exception has occurred,\
    \ and the current interval SHOULD be\n   considered unmeasurable unless the implementation\
    \ has some other way\n   of handling this condition.\n"
- title: 4.3.  Delay Measurement Procedures
  contents:
  - '4.3.  Delay Measurement Procedures

    '
- title: 4.3.1.  Transmitting a Delay Measurement Query
  contents:
  - "4.3.1.  Transmitting a Delay Measurement Query\n   When transmitting a DM Query,\
    \ the Version and Reserved fields MUST be\n   set to 0.  The R flag MUST be set\
    \ to 0, the T flag MUST be set to 1,\n   and the remaining flag bits MUST be set\
    \ to 0.\n   The Control Code field MUST be set to one of the values for Query\n\
    \   messages listed in Section 3.1; if the channel is unidirectional,\n   this\
    \ field MUST NOT be set to 0x0 (Query: In-band Response\n   Requested).\n   The\
    \ Querier Timestamp Format field MUST be set to the timestamp\n   format used\
    \ by the querier when writing timestamp fields in this\n   message; the possible\
    \ values for this field are listed in\n   Section 3.4.  The Responder Timestamp\
    \ Format and Responder's\n   Preferred Timestamp Format fields MUST be set to\
    \ 0.\n   The Session Identifier field can be set arbitrarily.  The DS field\n\
    \   MUST be set to the traffic class being measured.\n   The Timestamp 1 field\
    \ SHOULD be set to the time at which this DM\n   Query is transmitted, in the\
    \ format indicated by the Querier\n   Timestamp Format field.  The Timestamp 2\
    \ field MUST be set to 0.  If\n   a response was previously received in this measurement\
    \ session, the\n   Timestamp 1 and Timestamp 2 fields of the most recent such\
    \ response\n   MAY be copied to the Timestamp 3 and Timestamp 4 fields,\n   respectively,\
    \ of this query; otherwise, the Timestamp 3 and Timestamp\n   4 fields MUST be\
    \ set to 0.\n"
- title: 4.3.2.  Receiving a Delay Measurement Query
  contents:
  - "4.3.2.  Receiving a Delay Measurement Query\n   Upon receipt of a DM Query message,\
    \ the Timestamp 2 field SHOULD be\n   set to the time at which this DM Query was\
    \ received.\n   At this point, the DM Query message must be inspected.  If the\n\
    \   Control Code field is set to 0x2 (No Response Requested), a DM\n   Response\
    \ message MUST NOT be transmitted.  If the Control Code field\n   is set to 0x0\
    \ (In-band Response Requested) or 0x1 (Out-of-band\n   Response Requested), then\
    \ an in-band or out-of-band response,\n   respectively, SHOULD be transmitted\
    \ unless this has been prevented by\n   an administrative, security, or congestion\
    \ control mechanism.\n   In the case of a fatal exception that prevents the requested\n\
    \   measurement from being made, the error SHOULD be reported, via either\n  \
    \ a response, if one was requested, or else as a notification to the\n   user.\n"
- title: 4.3.3.  Transmitting a Delay Measurement Response
  contents:
  - "4.3.3.  Transmitting a Delay Measurement Response\n   When constructing a Response\
    \ to a DM Query, the Version and Reserved\n   fields MUST be set to 0.  The R\
    \ flag MUST be set to 1, the T flag\n   MUST be set to 1, and the remaining flag\
    \ bits MUST be set to 0.\n   The Session Identifier and Querier Timestamp Format\
    \ (QTF) fields MUST\n   be copied from the DM Query.  The Timestamp 1 and Timestamp\
    \ 2 fields\n   from the DM Query MUST be copied to the Timestamp 3 and Timestamp\
    \ 4\n   fields, respectively, of the DM Response.\n   The Responder Timestamp\
    \ Format (RTF) field MUST be set to the\n   timestamp format used by the responder\
    \ when writing timestamp fields\n   in this message, i.e., Timestamp 4 and (if\
    \ applicable) Timestamp 1;\n   the possible values for this field are listed in\
    \ Section 3.4.\n   Furthermore, the RTF field MUST be set equal to either the\
    \ QTF or the\n   RPTF field.  See Section 4.3.5 for guidelines on the selection\
    \ of the\n   value for this field.\n   The Responder's Preferred Timestamp Format\
    \ (RPTF) field MUST be set\n   to one of the values listed in Section 3.4 and\
    \ SHOULD be set to\n   indicate the timestamp format with which the responder\
    \ can provide\n   the best accuracy for purposes of delay measurement.\n   The\
    \ Control Code field MUST be set to one of the values for Response\n   messages\
    \ listed in Section 3.1.  The value 0x10 (Unspecified Error)\n   SHOULD NOT be\
    \ used if one of the other more specific error codes is\n   applicable.\n   If\
    \ the response is transmitted in-band, the Timestamp 1 field SHOULD\n   be set\
    \ to the time at which this DM Response is transmitted.  If the\n   response is\
    \ transmitted out-of-band, the Timestamp 1 field MUST be\n   set to 0.  In either\
    \ case, the Timestamp 2 field MUST be set to 0.\n   If the response is transmitted\
    \ in-band and the Control Code in the\n   message is 0x1 (Success), then the Timestamp\
    \ 1 and Timestamp 4 fields\n   MUST have the same format, which will be the format\
    \ indicated in the\n   Responder Timestamp Format field.\n"
- title: 4.3.4.  Receiving a Delay Measurement Response
  contents:
  - "4.3.4.  Receiving a Delay Measurement Response\n   Upon in-band receipt of a\
    \ DM Response message, the Timestamp 2 field\n   is set to the time at which this\
    \ DM Response was received.  (Since\n   the life of the DM message in the network\
    \ has ended at this point, it\n   is up to the receiver whether this final modification\
    \ is made to the\n   packet.  If the message is to be forwarded on for external\
    \ post-\n   processing (Section 2.9.7), then these modifications MUST be made.)\n\
    \   Upon out-of-band receipt of a DM Response message, the Timestamp 1\n   and\
    \ Timestamp 2 fields MUST NOT be used for purposes of delay\n   measurement.\n\
    \   If the Control Code in a DM Response is anything other than 0x1\n   (Success),\
    \ the timestamp values in the response MUST NOT be used for\n   purposes of delay\
    \ measurement.  If the Control Code indicates an\n   error condition, or if the\
    \ response message is invalid, the DM\n   operation MUST be terminated and an\
    \ appropriate notification to the\n   user generated.\n"
- title: 4.3.5.  Timestamp Format Negotiation
  contents:
  - "4.3.5.  Timestamp Format Negotiation\n   In case either the querier or the responder\
    \ in a DM transaction is\n   capable of supporting multiple timestamp formats,\
    \ it is desirable to\n   determine the optimal format for purposes of delay measurement\
    \ on a\n   particular channel.  The procedures for making this determination\n\
    \   SHALL be as follows.\n   Upon sending an initial DM Query over a channel,\
    \ the querier sets the\n   Querier Timestamp Format (QTF) field to its preferred\
    \ timestamp\n   format.\n   Upon receiving any DM Query message, the responder\
    \ determines whether\n   it is capable of writing timestamps in the format specified\
    \ by the\n   QTF field.  If so, the Responder Timestamp Format (RTF) field is\
    \ set\n   equal to the QTF field.  If not, the RTF field is set equal to the\n\
    \   Responder's Preferred Timestamp Format (RPTF) field.\n   The process of changing\
    \ from one timestamp format to another at the\n   responder may result in the\
    \ Timestamp 1 and Timestamp 4 fields in an\n   in-band DM Response having different\
    \ formats.  If this is the case,\n   the Control Code in the response MUST NOT\
    \ be set to 0x1 (Success).\n   Unless an error condition has occurred, the Control\
    \ Code MUST be set\n   to 0x2 (Notification - Data Format Invalid).\n   Upon receiving\
    \ a DM Response, the querier knows from the RTF field in\n   the message whether\
    \ the responder is capable of supporting its\n   preferred timestamp format: if\
    \ it is, the RTF will be equal to the\n   QTF.  The querier also knows the responder's\
    \ preferred timestamp\n   format from the RPTF field.  The querier can then decide\
    \ whether to\n   retain its current QTF or to change it and repeat the negotiation\n\
    \   procedures.\n"
- title: 4.3.5.1.  Single-Format Procedures
  contents:
  - "4.3.5.1.  Single-Format Procedures\n   When an implementation supports only one\
    \ timestamp format, the\n   procedures above reduce to the following simple behavior:\n\
    \   o  All DM Queries are transmitted with the same QTF;\n   o  All DM Responses\
    \ are transmitted with the same RTF, and the RPTF\n      is always set equal to\
    \ the RTF;\n   o  All DM Responses received with RTF not equal to QTF are discarded;\n\
    \   o  On a unidirectional channel, all DM Queries received with QTF not\n   \
    \   equal to the supported format are discarded.\n"
- title: 4.3.6.  Quality of Service
  contents:
  - "4.3.6.  Quality of Service\n   The TC field of the LSE corresponding to the channel\
    \ (e.g., LSP)\n   being measured MUST be set to the value that corresponds to\
    \ the DS\n   field in the DM message.\n"
- title: 4.4.  Combined Loss/Delay Measurement Procedures
  contents:
  - "4.4.  Combined Loss/Delay Measurement Procedures\n   The combined LM/DM message\
    \ defined in Section 3.3 allows loss and\n   delay measurement to be carried out\
    \ simultaneously.  This message\n   SHOULD be treated as an LM message that happens\
    \ to carry additional\n   timestamp data, with the timestamp fields processed\
    \ as per delay\n   measurement procedures.\n"
- title: 5.  Implementation Disclosure Requirements
  contents:
  - "5.  Implementation Disclosure Requirements\n   This section summarizes the requirements\
    \ placed on implementations\n   for capabilities disclosure.  The purpose of these\
    \ requirements is to\n   ensure that end users have a clear understanding of implementation\n\
    \   capabilities and characteristics that have a direct impact on how\n   loss\
    \ and delay measurement mechanisms function in specific\n   situations.  Implementations\
    \ are REQUIRED to state:\n   o  METRICS: Which of the following metrics are supported:\
    \ packet\n      loss, packet throughput, octet loss, octet throughput, average\n\
    \      loss rate, one-way delay, round-trip delay, two-way channel delay,\n  \
    \    packet delay variation.\n   o  MP-LOCATION: The location of loss and delay\
    \ measurement points\n      with respect to other stages of packet processing,\
    \ such as\n      queuing.\n   o  CHANNEL-TYPES: The types of channels for which\
    \ LM and DM are\n      supported, including LSP types, pseudowires, and sections\
    \ (links).\n   o  QUERY-RATE: The minimum supported query intervals for LM and\
    \ DM\n      sessions, both in the querier and responder roles.\n   o  LOOP: Whether\
    \ loopback measurement (Section 2.8) is supported.\n   o  LM-TYPES: Whether direct\
    \ or inferred LM is supported, and for the\n      latter, which test protocols\
    \ or proxy message types are supported.\n   o  LM-COUNTERS: Whether 64-bit counters\
    \ are supported.\n   o  LM-ACCURACY: The expected measurement accuracy levels\
    \ for the\n      supported forms of LM, and the expected impact of exception\n\
    \      conditions such as lost and misordered messages.\n   o  LM-SYNC: The implementation's\
    \ behavior in regard to the\n      synchronization conditions discussed in Section\
    \ 2.9.8.\n   o  LM-SCOPE: The supported LM scopes (Sections 2.9.9 and 4.2.8).\n\
    \   o  DM-ACCURACY: The expected measurement accuracy levels for the\n      supported\
    \ forms of DM.\n   o  DM-TS-FORMATS: The supported timestamp formats and the extent\
    \ of\n      support for computation with and reconciliation of different\n   \
    \   formats.\n"
- title: 6.  Congestion Considerations
  contents:
  - "6.  Congestion Considerations\n   An MPLS network may be traffic-engineered in\
    \ such a way that the\n   bandwidth required both for client traffic and for control,\n\
    \   management, and OAM traffic is always available.  The following\n   congestion\
    \ considerations therefore apply only when this is not the\n   case.\n   The proactive\
    \ generation of Loss Measurement and Delay Measurement\n   messages for purposes\
    \ of monitoring the performance of an MPLS\n   channel naturally results in a\
    \ degree of additional load placed on\n   both the network and the terminal nodes\
    \ of the channel.  When\n   configuring such monitoring, operators should be mindful\
    \ of the\n   overhead involved and should choose transmit rates that do not stress\n\
    \   network resources unduly; such choices must be informed by the\n   deployment\
    \ context.  In case of slower links or lower-speed devices,\n   for example, lower\
    \ Loss Measurement message rates can be chosen, up\n   to the limits noted at\
    \ the end of Section 2.2.\n   In general, lower measurement message rates place\
    \ less load on the\n   network at the expense of reduced granularity.  For delay\n\
    \   measurement, this reduced granularity translates to a greater\n   possibility\
    \ that the delay associated with a channel temporarily\n   exceeds the expected\
    \ threshold without detection.  For loss\n   measurement, it translates to a larger\
    \ gap in loss information in\n   case of exceptional circumstances such as lost\
    \ LM messages or\n   misordered packets.\n   When carrying out a sustained measurement\
    \ operation such as an LM\n   operation or continuous proactive DM operation,\
    \ the querier SHOULD\n   take note of the number of lost measurement messages\
    \ (queries for\n   which a response is never received) and set a corresponding\n\
    \   Measurement Message Loss Threshold.  If this threshold is exceeded,\n   the\
    \ measurement operation SHOULD be suspended so as not to exacerbate\n   the possible\
    \ congestion condition.  This suspension SHOULD be\n   accompanied by an appropriate\
    \ notification to the user so that the\n   condition can be investigated and corrected.\n\
    \   From the receiver perspective, the main consideration is the\n   possibility\
    \ of receiving an excessive quantity of measurement\n   messages.  An implementation\
    \ SHOULD employ a mechanism such as rate-\n   limiting to guard against the effects\
    \ of this case.\n"
- title: 7.  Manageability Considerations
  contents:
  - "7.  Manageability Considerations\n   The measurement protocols described in this\
    \ document are intended to\n   serve as infrastructure to support a wide range\
    \ of higher-level\n   monitoring and diagnostic applications, from simple command-line\n\
    \   diagnostic tools to comprehensive network performance monitoring and\n   analysis\
    \ packages.  The specific mechanisms and considerations for\n   protocol configuration,\
    \ initialization, and reporting thus depend on\n   the nature of the application.\n\
    \   In the case of on-demand diagnostics, the diagnostic application may\n   provide\
    \ parameters such as the measurement type, the channel, the\n   query rate, and\
    \ the test duration when initiating the diagnostic;\n   results and exception\
    \ conditions are then reported directly to the\n   application.  The system may\
    \ discard the statistics accumulated\n   during the test after the results have\
    \ been reported or retain them\n   to provide a historical measurement record.\n\
    \   Alternatively, measurement configuration may be supplied as part of\n   the\
    \ channel configuration itself in order to support continuous\n   monitoring of\
    \ the channel's performance characteristics.  In this\n   case, the configuration\
    \ will typically include quality thresholds\n   depending on the service level\
    \ agreement, the crossing of which will\n   trigger warnings or alarms, and result\
    \ reporting and exception\n   notification will be integrated into the system-wide\
    \ network\n   management and reporting framework.\n"
- title: 8.  Security Considerations
  contents:
  - "8.  Security Considerations\n   This document describes procedures for the measurement\
    \ of performance\n   metrics over a pre-existing MPLS path (a pseudowire, LSP,\
    \ or\n   section).  As such, it assumes that a node involved in a measurement\n\
    \   operation has previously verified the integrity of the path and the\n   identity\
    \ of the far end using existing MPLS mechanisms such as\n   Bidirectional Forwarding\
    \ Detection (BFD) [RFC5884]; tools,\n   techniques, and considerations for securing\
    \ MPLS paths are discussed\n   in detail in [RFC5920].\n   When such mechanisms\
    \ are not available, and where security of the\n   measurement operation is a\
    \ concern, reception of Generic Associated\n   Channel messages with the Channel\
    \ Types specified in this document\n   SHOULD be disabled.  Implementations MUST\
    \ provide the ability to\n   disable these protocols on a per-Channel-Type basis.\n\
    \   Even when the identity of the far end has been verified, the\n   measurement\
    \ protocols remain vulnerable to injection and man-in-the-\n   middle attacks.\
    \  The impact of such an attack would be to compromise\n   the quality of performance\
    \ measurements on the affected path.  An\n   attacker positioned to disrupt these\
    \ measurements is, however,\n   capable of causing much greater damage by disrupting\
    \ far more\n   critical elements of the network such as the network control plane\
    \ or\n   user traffic flows.  At worst, a disruption of the measurement\n   protocols\
    \ would interfere with the monitoring of the performance\n   aspects of the service\
    \ level agreement associated with the path; the\n   existence of such a disruption\
    \ would imply that a serious breach of\n   basic path integrity had already occurred.\n\
    \   If desired, such attacks can be mitigated by performing basic\n   validation\
    \ and sanity checks, at the querier, of the counter or\n   timestamp fields in\
    \ received measurement response messages.  The\n   minimal state associated with\
    \ these protocols also limits the extent\n   of measurement disruption that can\
    \ be caused by a corrupt or invalid\n   message to a single query/response cycle.\n\
    \   Cryptographic mechanisms capable of signing or encrypting the\n   contents\
    \ of the measurement packets without degrading the measurement\n   performance\
    \ are not currently available.  In light of the preceding\n   discussion, the\
    \ absence of such cryptographic mechanisms does not\n   raise significant security\
    \ issues.\n   Users concerned with the security of out-of-band responses over\
    \ IP\n   networks SHOULD employ suitable security mechanisms such as IPsec\n \
    \  [RFC4301] to protect the integrity of the return path.\n"
- title: 9.  IANA Considerations
  contents:
  - "9.  IANA Considerations\n   Per this document, IANA has completed the following\
    \ actions:\n   o  Allocation of Channel Types in the \"PW Associated Channel Type\"\
    \n      registry\n   o  Creation of a \"Measurement Timestamp Type\" registry\n\
    \   o  Creation of an \"MPLS Loss/Delay Measurement Control Code\" registry\n\
    \   o  Creation of an \"MPLS Loss/Delay Measurement Type-Length-Value\n      (TLV)\
    \ Object\" registry\n"
- title: 9.1.  Allocation of PW Associated Channel Types
  contents:
  - "9.1.  Allocation of PW Associated Channel Types\n   As per the IANA considerations\
    \ in [RFC5586], IANA has allocated the\n   following Channel Types in the \"PW\
    \ Associated Channel Type\" registry:\n   Value  Description                 \
    \             TLV Follows Reference\n   ------ ----------------------------------------\
    \ ----------- ---------\n   0x000A MPLS Direct Loss Measurement (DLM)       No\
    \          RFC 6374\n   0x000B MPLS Inferred Loss Measurement (ILM)     No   \
    \       RFC 6374\n   0x000C MPLS Delay Measurement (DM)              No      \
    \    RFC 6374\n   0x000D MPLS Direct Loss and Delay Measurement   No         \
    \ RFC 6374\n          (DLM+DM)\n   0x000E MPLS Inferred Loss and Delay Measurement\
    \ No          RFC 6374\n          (ILM+DM)\n"
- title: 9.2.  Creation of Measurement Timestamp Type Registry
  contents:
  - "9.2.  Creation of Measurement Timestamp Type Registry\n   IANA has created a\
    \ new \"Measurement Timestamp Type\" registry, with\n   format and initial allocations\
    \ as follows:\n   Type Description                               Size in Bits\
    \ Reference\n   ---- ----------------------------------------- ------------ ---------\n\
    \   0    Null Timestamp                            64           RFC 6374\n   1\
    \    Sequence Number                           64           RFC 6374\n   2   \
    \ Network Time Protocol version 4 64-bit    64           RFC 6374\n        Timestamp\n\
    \   3    Truncated IEEE 1588v2 PTP Timestamp       64           RFC 6374\n   The\
    \ range of the Type field is 0-15.\n   The allocation policy for this registry\
    \ is IETF Review.\n"
- title: 9.3.  Creation of MPLS Loss/Delay Measurement Control Code Registry
  contents:
  - "9.3.  Creation of MPLS Loss/Delay Measurement Control Code Registry\n   IANA\
    \ has created a new \"MPLS Loss/Delay Measurement Control Code\"\n   registry.\
    \  This registry is divided into two separate parts, one for\n   Query Codes and\
    \ the other for Response Codes, with formats and\n   initial allocations as follows:\n\
    \   Query Codes\n   Code Description                    Reference\n   ---- ------------------------------\
    \ ---------\n   0x0  In-band Response Requested     RFC 6374\n   0x1  Out-of-band\
    \ Response Requested RFC 6374\n   0x2  No Response Requested          RFC 6374\n\
    \   Response Codes\n   Code Description                         Reference\n  \
    \ ---- ----------------------------------- ---------\n   0x0  Reserved       \
    \                     RFC 6374\n   0x1  Success                             RFC\
    \ 6374\n   0x2  Data Format Invalid                 RFC 6374\n   0x3  Initialization\
    \ in Progress          RFC 6374\n   0x4  Data Reset Occurred                 RFC\
    \ 6374\n   0x5  Resource Temporarily Unavailable    RFC 6374\n   0x10 Unspecified\
    \ Error                   RFC 6374\n   0x11 Unsupported Version              \
    \   RFC 6374\n   0x12 Unsupported Control Code            RFC 6374\n   0x13 Unsupported\
    \ Data Format             RFC 6374\n   0x14 Authentication Failure           \
    \   RFC 6374\n   0x15 Invalid Destination Node Identifier RFC 6374\n   0x16 Connection\
    \ Mismatch                 RFC 6374\n   0x17 Unsupported Mandatory TLV Object\
    \    RFC 6374\n   0x18 Unsupported Query Interval          RFC 6374\n   0x19 Administrative\
    \ Block                RFC 6374\n   0x1A Resource Unavailable                RFC\
    \ 6374\n   0x1B Resource Released                   RFC 6374\n   0x1C Invalid\
    \ Message                     RFC 6374\n   0x1D Protocol Error               \
    \       RFC 6374\n   IANA has indicated that the values 0x0 - 0xF in the Response\
    \ Code\n   section are reserved for non-error response codes.\n   The range of\
    \ the Code field is 0 - 255.\n   The allocation policy for this registry is IETF\
    \ Review.\n"
- title: 9.4.  Creation of MPLS Loss/Delay Measurement TLV Object Registry
  contents:
  - "9.4.  Creation of MPLS Loss/Delay Measurement TLV Object Registry\n   IANA has\
    \ created a new \"MPLS Loss/Delay Measurement TLV Object\"\n   registry, with\
    \ format and initial allocations as follows:\n   Type Description            \
    \           Reference\n   ---- --------------------------------- ---------\n \
    \  0    Padding - copy in response        RFC 6374\n   1    Return Address   \
    \                 RFC 6374\n   2    Session Query Interval            RFC 6374\n\
    \   3    Loopback Request                  RFC 6374\n   127  Experimental use\
    \                  RFC 6374\n   128  Padding - do not copy in response RFC 6374\n\
    \   129  Destination Address               RFC 6374\n   130  Source Address  \
    \                  RFC 6374\n   255  Experimental use                  RFC 6374\n\
    \   IANA has indicated that Types 0-127 are classified as Mandatory, and\n   that\
    \ Types 128-255 are classified as Optional.\n   The range of the Type field is\
    \ 0 - 255.\n   The allocation policy for this registry is IETF Review.\n"
- title: 10.  Acknowledgments
  contents:
  - "10.  Acknowledgments\n   The authors wish to thank the many participants of the\
    \ MPLS working\n   group who provided detailed review and feedback on this document.\n\
    \   The authors offer special thanks to Alexander Vainshtein, Loa\n   Andersson,\
    \ and Hiroyuki Takagi for many helpful thoughts and\n   discussions, to Linda\
    \ Dunbar for the idea of using LM messages for\n   throughput measurement, and\
    \ to Ben Niven-Jenkins, Marc Lasserre, and\n   Ben Mack-Crane for their valuable\
    \ comments.\n"
- title: 11.  References
  contents:
  - '11.  References

    '
- title: 11.1.  Normative References
  contents:
  - "11.1.  Normative References\n   [IEEE1588]  IEEE, \"1588-2008 IEEE Standard for\
    \ a Precision Clock\n               Synchronization Protocol for Networked Measurement\
    \ and\n               Control Systems\", March 2008.\n   [RFC2119]   Bradner,\
    \ S., \"Key words for use in RFCs to Indicate\n               Requirement Levels\"\
    , BCP 14, RFC 2119, March 1997.\n   [RFC2474]   Nichols, K., Blake, S., Baker,\
    \ F., and D. Black,\n               \"Definition of the Differentiated Services\
    \ Field (DS\n               Field) in the IPv4 and IPv6 Headers\", RFC 2474,\n\
    \               December 1998.\n   [RFC3031]   Rosen, E., Viswanathan, A., and\
    \ R. Callon, \"Multiprotocol\n               Label Switching Architecture\", RFC\
    \ 3031, January 2001.\n   [RFC3270]   Le Faucheur, F., Wu, L., Davie, B., Davari,\
    \ S., Vaananen,\n               P., Krishnan, R., Cheval, P., and J. Heinanen,\
    \ \"Multi-\n               Protocol Label Switching (MPLS) Support of Differentiated\n\
    \               Services\", RFC 3270, May 2002.\n   [RFC5462]   Andersson, L.\
    \ and R. Asati, \"Multiprotocol Label\n               Switching (MPLS) Label Stack\
    \ Entry: \"EXP\" Field Renamed\n               to \"Traffic Class\" Field\", RFC\
    \ 5462, February 2009.\n   [RFC5586]   Bocci, M., Vigoureux, M., and S. Bryant,\
    \ \"MPLS Generic\n               Associated Channel\", RFC 5586, June 2009.\n\
    \   [RFC5905]   Mills, D., Martin, J., Burbank, J., and W. Kasch,\n          \
    \     \"Network Time Protocol Version 4: Protocol and Algorithms\n           \
    \    Specification\", RFC 5905, June 2010.\n"
- title: 11.2.  Informative References
  contents:
  - "11.2.  Informative References\n   [RFC2679]   Almes, G., Kalidindi, S., and M.\
    \ Zekauskas, \"A One-way\n               Delay Metric for IPPM\", RFC 2679, September\
    \ 1999.\n   [RFC2680]   Almes, G., Kalidindi, S., and M. Zekauskas, \"A One-way\n\
    \               Packet Loss Metric for IPPM\", RFC 2680, September 1999.\n   [RFC2681]\
    \   Almes, G., Kalidindi, S., and M. Zekauskas, \"A Round-trip\n             \
    \  Delay Metric for IPPM\", RFC 2681, September 1999.\n   [RFC3209]   Awduche,\
    \ D., Berger, L., Gan, D., Li, T., Srinivasan, V.,\n               and G. Swallow,\
    \ \"RSVP-TE: Extensions to RSVP for LSP\n               Tunnels\", RFC 3209, December\
    \ 2001.\n   [RFC3260]   Grossman, D., \"New Terminology and Clarifications for\n\
    \               Diffserv\", RFC 3260, April 2002.\n   [RFC3985]   Bryant, S. and\
    \ P. Pate, \"Pseudo Wire Emulation Edge-to-\n               Edge (PWE3) Architecture\"\
    , RFC 3985, March 2005.\n   [RFC4301]   Kent, S. and K. Seo, \"Security Architecture\
    \ for the\n               Internet Protocol\", RFC 4301, December 2005.\n   [RFC4656]\
    \   Shalunov, S., Teitelbaum, B., Karp, A., Boote, J., and M.\n              \
    \ Zekauskas, \"A One-way Active Measurement Protocol\n               (OWAMP)\"\
    , RFC 4656, September 2006.\n   [RFC4928]   Swallow, G., Bryant, S., and L. Andersson,\
    \ \"Avoiding\n               Equal Cost Multipath Treatment in MPLS Networks\"\
    ,\n               BCP 128, RFC 4928, June 2007.\n   [RFC5036]   Andersson, L.,\
    \ Minei, I., and B. Thomas, \"LDP\n               Specification\", RFC 5036, October\
    \ 2007.\n   [RFC5357]   Hedayat, K., Krzanowski, R., Morton, A., Yum, K., and\
    \ J.\n               Babiarz, \"A Two-Way Active Measurement Protocol (TWAMP)\"\
    ,\n               RFC 5357, October 2008.\n   [RFC5481]   Morton, A. and B. Claise,\
    \ \"Packet Delay Variation\n               Applicability Statement\", RFC 5481,\
    \ March 2009.\n   [RFC5884]   Aggarwal, R., Kompella, K., Nadeau, T., and G. Swallow,\n\
    \               \"Bidirectional Forwarding Detection (BFD) for MPLS Label\n  \
    \             Switched Paths (LSPs)\", RFC 5884, June 2010.\n   [RFC5920]   Fang,\
    \ L., \"Security Framework for MPLS and GMPLS\n               Networks\", RFC\
    \ 5920, July 2010.\n   [RFC5921]   Bocci, M., Bryant, S., Frost, D., Levrau, L.,\
    \ and L.\n               Berger, \"A Framework for MPLS in Transport Networks\"\
    ,\n               RFC 5921, July 2010.\n   [RFC5960]   Frost, D., Bryant, S.,\
    \ and M. Bocci, \"MPLS Transport\n               Profile Data Plane Architecture\"\
    , RFC 5960, August 2010.\n   [RFC6375]   Frost, D., Ed. and S. Bryant, Ed., \"\
    A Packet Loss and\n               Delay Measurement Profile for MPLS-Based Transport\n\
    \               Networks\", RFC 6375, September 2011.\n   [Y.1731]    ITU-T Recommendation\
    \ Y.1731, \"OAM Functions and\n               Mechanisms for Ethernet based Networks\"\
    , February 2008.\n"
- title: Appendix A.  Default Timestamp Format Rationale
  contents:
  - "Appendix A.  Default Timestamp Format Rationale\n   This document initially proposed\
    \ the Network Time Protocol (NTP)\n   timestamp format as the mandatory default,\
    \ as this is the normal\n   default timestamp in IETF protocols and thus would\
    \ seem the \"natural\"\n   choice.  However, a number of considerations have led\
    \ instead to the\n   specification of the truncated IEEE 1588 Precision Time Protocol\n\
    \   (PTP) timestamp as the default.  NTP has not gained traction in\n   industry\
    \ as the protocol of choice for high-quality timing\n   infrastructure, whilst\
    \ IEEE 1588 PTP has become the de facto time\n   transfer protocol in networks\
    \ that are specially engineered to\n   provide high-accuracy time distribution\
    \ service.  The PTP timestamp\n   format is also the ITU-T format of choice for\
    \ packet transport\n   networks, which may rely on MPLS protocols.  Applications\
    \ such as\n   one-way delay measurement need the best time service available,\
    \ and\n   converting between the NTP and PTP timestamp formats is not a trivial\n\
    \   transformation, particularly when it is required that this be done in\n  \
    \ real time without loss of accuracy.\n   The truncated IEEE 1588 PTP format specified\
    \ in this document is\n   considered to provide a more than adequate wrap time\
    \ and greater time\n   resolution than it is expected will be needed for the operational\n\
    \   lifetime of this protocol.  By truncating the timestamp at both the\n   high\
    \ and low order bits, the protocol achieves a worthwhile reduction\n   in system\
    \ resources.\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Dan Frost\n   Cisco Systems\n   EMail: danfrost@cisco.com\n\
    \   Stewart Bryant\n   Cisco Systems\n   EMail: stbryant@cisco.com\n"
