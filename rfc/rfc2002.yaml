- title: __initial_text__
  contents:
  - '                          IP Mobility Support

    '
- title: Status of this Memo
  contents:
  - "Status of this Memo\n   This document specifies an Internet standards track protocol\
    \ for the\n   Internet community, and requests discussion and suggestions for\n\
    \   improvements.  Please refer to the current edition of the \"Internet\n   Official\
    \ Protocol Standards\" (STD 1) for the standardization state\n   and status of\
    \ this protocol.  Distribution of this memo is unlimited.\n"
- title: Abstract
  contents:
  - "Abstract\n   This document specifies protocol enhancements that allow transparent\n\
    \   routing of IP datagrams to mobile nodes in the Internet.  Each mobile\n  \
    \ node is always identified by its home address, regardless of its\n   current\
    \ point of attachment to the Internet.  While situated away\n   from its home,\
    \ a mobile node is also associated with a care-of\n   address, which provides\
    \ information about its current point of\n   attachment to the Internet.  The\
    \ protocol provides for registering\n   the care-of address with a home agent.\
    \  The home agent sends\n   datagrams destined for the mobile node through a tunnel\
    \ to the care-\n   of address.  After arriving at the end of the tunnel, each\
    \ datagram\n   is then delivered to the mobile node.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n 1. Introduction                                         \
    \              3\n     1.1. Protocol Requirements . . . . . . . . . . . . . .\
    \ . . . .    3\n     1.2. Goals . . . . . . . . . . . . . . . . . . . . . . .\
    \ . . .    4\n     1.3. Assumptions . . . . . . . . . . . . . . . . . . . . .\
    \ . .    4\n     1.4. Applicability . . . . . . . . . . . . . . . . . . . . .\
    \ .    4\n     1.5. New Architectural Entities  . . . . . . . . . . . . . . .\
    \    5\n     1.6. Terminology . . . . . . . . . . . . . . . . . . . . . . .  \
    \  6\n     1.7. Protocol Overview . . . . . . . . . . . . . . . . . . . .    8\n\
    \     1.8. Specification Language  . . . . . . . . . . . . . . . . .   11\n  \
    \   1.9. Message Format and Protocol Extensibility . . . . . . . .   12\n 2. Agent\
    \ Discovery                                                   14\n     2.1. Agent\
    \ Advertisement . . . . . . . . . . . . . . . . . . .   14\n           2.1.1.\
    \ Mobility Agent Advertisement Extension  . . . . .   16\n           2.1.2. Prefix-Lengths\
    \ Extension  . . . . . . . . . . . .   18\n           2.1.3. One-byte Padding\
    \ Extension  . . . . . . . . . . .   19\n     2.2. Agent Solicitation  . . . .\
    \ . . . . . . . . . . . . . . .   19\n     2.3. Foreign Agent and Home Agent Considerations\
    \ . . . . . . .   19\n           2.3.1. Advertised Router Addresses . . . . .\
    \ . . . . . .   20\n           2.3.2. Sequence Numbers and Rollover Handling \
    \ . . . . .   21\n     2.4. Mobile Node Considerations  . . . . . . . . . . .\
    \ . . . .   21\n           2.4.1. Registration Required . . . . . . . . . . .\
    \ . . .   22\n           2.4.2. Move Detection  . . . . . . . . . . . . . . .\
    \ . .   22\n           2.4.3. Returning Home  . . . . . . . . . . . . . . . .\
    \ .   24\n           2.4.4. Sequence Numbers and Rollover Handling  . . . . .\
    \   24\n 3. Registration                                                     \
    \ 24\n     3.1. Registration Overview . . . . . . . . . . . . . . . . . .   25\n\
    \     3.2. Authentication  . . . . . . . . . . . . . . . . . . . . .   26\n  \
    \   3.3. Registration Request  . . . . . . . . . . . . . . . . . .   26\n    \
    \ 3.4. Registration Reply  . . . . . . . . . . . . . . . . . . .   29\n     3.5.\
    \ Registration Extensions . . . . . . . . . . . . . . . . .   32\n           3.5.1.\
    \ Computing Authentication Extension Values . . . .   32\n           3.5.2. Mobile-Home\
    \ Authentication Extension  . . . . . .   33\n           3.5.3. Mobile-Foreign\
    \ Authentication Extension . . . . .   33\n           3.5.4. Foreign-Home Authentication\
    \ Extension . . . . . .   34\n     3.6. Mobile Node Considerations  . . . . .\
    \ . . . . . . . . . .   34\n           3.6.1. Sending Registration Requests .\
    \ . . . . . . . . .   36\n           3.6.2. Receiving Registration Replies  .\
    \ . . . . . . . .   40\n           3.6.3. Registration Retransmission . . . .\
    \ . . . . . . .   42\n     3.7. Foreign Agent Considerations  . . . . . . . .\
    \ . . . . . .   43\n           3.7.1. Configuration and Registration Tables .\
    \ . . . . .   44\n           3.7.2. Receiving Registration Requests . . . . .\
    \ . . . .   44\n           3.7.3. Receiving Registration Replies  . . . . . .\
    \ . . .   47\n     3.8. Home Agent Considerations . . . . . . . . . . . . . .\
    \ . .   49\n           3.8.1. Configuration and Registration Tables . . . . .\
    \ .   49\n           3.8.2. Receiving Registration Requests . . . . . . . . .\
    \   49\n           3.8.3. Sending Registration Replies  . . . . . . . . . .  \
    \ 53\n 4. Routing Considerations                                            55\n\
    \     4.1. Encapsulation Types . . . . . . . . . . . . . . . . . . .   56\n  \
    \   4.2. Unicast Datagram Routing  . . . . . . . . . . . . . . . .   56\n    \
    \       4.2.1. Mobile Node Considerations  . . . . . . . . . . .   56\n      \
    \     4.2.2. Foreign Agent Considerations  . . . . . . . . . .   57\n        \
    \   4.2.3. Home Agent Considerations . . . . . . . . . . . .   58\n     4.3. Broadcast\
    \ Datagrams . . . . . . . . . . . . . . . . . . .   59\n     4.4. Multicast Datagram\
    \ Routing  . . . . . . . . . . . . . . .   60\n     4.5. Mobile Routers  . . .\
    \ . . . . . . . . . . . . . . . . . .   61\n     4.6. ARP, Proxy ARP, and Gratuitous\
    \ ARP  . . . . . . . . . . .   62\n 5. Security Considerations               \
    \                            66\n     5.1. Message Authentication Codes  . . .\
    \ . . . . . . . . . . .   66\n     5.2. Areas of Security Concern in this Protocol\
    \  . . . . . . .   66\n     5.3. Key Management  . . . . . . . . . . . . . . .\
    \ . . . . . .   67\n     5.4. Picking Good Random Numbers . . . . . . . . . .\
    \ . . . . .   67\n     5.5. Privacy . . . . . . . . . . . . . . . . . . . . .\
    \ . . . .   67\n     5.6. Replay Protection for Registration Requests . . . .\
    \ . . .   68\n           5.6.1. Replay Protection using Timestamps  . . . . .\
    \ . .   68\n           5.6.2. Replay Protection using Nonces  . . . . . . . .\
    \ .   69\n 6. Acknowledgments                                                \
    \   71\n A. Patent Issues                                                    \
    \ 72\n     A.1. IBM Patent #5,159,592 . . . . . . . . . . . . . . . . . .   72\n\
    \     A.2. IBM Patent #5,148,479 . . . . . . . . . . . . . . . . . .   72\n B.\
    \ Link-Layer Considerations                                         73\n C. TCP\
    \ Considerations                                                73\n     C.1.\
    \ TCP Timers  . . . . . . . . . . . . . . . . . . . . . . .   73\n     C.2. TCP\
    \ Congestion Management . . . . . . . . . . . . . . . .   73\n D. Example Scenarios\
    \                                                 74\n     D.1. Registering with\
    \ a Foreign Agent Care-of Address  . . . .   74\n     D.2. Registering with a\
    \ Co-Located Care-of Address . . . . . .   75\n     D.3. Deregistration  . . .\
    \ . . . . . . . . . . . . . . . . . .   76\n E. Applicability of Prefix Lengths\
    \ Extension                         76\n"
- title: Editor's Address                                                      79
  contents:
  - 'Editor''s Address                                                      79

    '
- title: 1. Introduction
  contents:
  - "1. Introduction\n   IP version 4 assumes that a node's IP address uniquely identifies\
    \ the\n   node's point of attachment to the Internet.  Therefore, a node must\n\
    \   be located on the network indicated by its IP address in order to\n   receive\
    \ datagrams destined to it; otherwise, datagrams destined to\n   the node would\
    \ be undeliverable.  For a node to change its point of\n   attachment without\
    \ losing its ability to communicate, currently one\n   of the two following mechanisms\
    \ must typically be employed:\n      a)   the node must change its IP address\
    \ whenever it changes its\n           point of attachment, or\n      b)   host-specific\
    \ routes must be propagated throughout much of\n           the Internet routing\
    \ fabric.\n   Both of these alternatives are often unacceptable.  The first makes\n\
    \   it impossible for a node to maintain transport and higher-layer\n   connections\
    \ when the node changes location.  The second has obvious\n   and severe scaling\
    \ problems, especially relevant considering the\n   explosive growth in sales\
    \ of notebook (mobile) computers.\n   A new, scalable, mechanism is required for\
    \ accommodating node\n   mobility within the Internet.  This document defines\
    \ such a\n   mechanism, which enables nodes to change their point of attachment\
    \ to\n   the Internet without changing their IP address.\n"
- title: 1.1. Protocol Requirements
  contents:
  - "1.1. Protocol Requirements\n   A mobile node must be able to communicate with\
    \ other nodes after\n   changing its link-layer point of attachment to the Internet,\
    \ yet\n   without changing its IP address.\n   A mobile node must be able to communicate\
    \ with other nodes that do\n   not implement these mobility functions.  No protocol\
    \ enhancements are\n   required in hosts or routers that are not acting as any\
    \ of the new\n   architectural entities introduced in Section 1.5.\n   All messages\
    \ used to update another node as to the location of a\n   mobile node must be\
    \ authenticated in order to protect against remote\n   redirection attacks.\n"
- title: 1.2. Goals
  contents:
  - "1.2. Goals\n   The link by which a mobile node is directly attached to the Internet\n\
    \   may often be a wireless link.  This link may thus have a\n   substantially\
    \ lower bandwidth and higher error rate than traditional\n   wired networks. \
    \ Moreover, mobile nodes are likely to be battery\n   powered, and minimizing\
    \ power consumption is important.  Therefore,\n   the number of administrative\
    \ messages sent over the link by which a\n   mobile node is directly attached\
    \ to the Internet should be minimized,\n   and the size of these messages should\
    \ be kept as small as is\n   reasonably possible.\n"
- title: 1.3. Assumptions
  contents:
  - "1.3. Assumptions\n   The protocols defined in this document place no additional\n\
    \   constraints on the assignment of IP addresses.  That is, a mobile\n   node\
    \ can be assigned an IP address by the organization that owns the\n   machine.\n\
    \   This protocol assumes that mobile nodes will generally not change\n   their\
    \ point of attachment to the Internet more frequently than once\n   per second.\n\
    \   This protocol assumes that IP unicast datagrams are routed based on\n   the\
    \ destination address in the datagram header (and not, for example,\n   by source\
    \ address).\n"
- title: 1.4. Applicability
  contents:
  - "1.4. Applicability\n   Mobile IP is intended to enable nodes to move from one\
    \ IP subnet to\n   another.  It is just as suitable for mobility across homogeneous\n\
    \   media as it is for mobility across heterogeneous media.  That is,\n   Mobile\
    \ IP facilitates node movement from one Ethernet segment to\n   another as well\
    \ as it accommodates node movement from an Ethernet\n   segment to a wireless\
    \ LAN, as long as the mobile node's IP address\n   remains the same after such\
    \ a movement.\n   One can think of Mobile IP as solving the \"macro\" mobility\
    \ management\n   problem.  It is less well suited for more \"micro\" mobility\
    \ management\n   applications -- for example, handoff amongst wireless transceivers,\n\
    \   each of which covers only a very small geographic area.  As long as\n   node\
    \ movement does not occur between points of attachment on\n   different IP subnets,\
    \ link-layer mechanisms for mobility (i.e.,\n   link-layer handoff) may offer\
    \ faster convergence and far less\n   overhead than Mobile IP.\n"
- title: 1.5. New Architectural Entities
  contents:
  - "1.5. New Architectural Entities\n   Mobile IP introduces the following new functional\
    \ entities:\n      Mobile Node\n         A host or router that changes its point\
    \ of attachment from one\n         network or subnetwork to another.  A mobile\
    \ node may change its\n         location without changing its IP address; it may\
    \ continue to\n         communicate with other Internet nodes at any location\
    \ using its\n         (constant) IP address, assuming link-layer connectivity\
    \ to a\n         point of attachment is available.\n      Home Agent\n       \
    \  A router on a mobile node's home network which tunnels\n         datagrams\
    \ for delivery to the mobile node when it is away from\n         home, and maintains\
    \ current location information for the mobile\n         node.\n      Foreign Agent\n\
    \         A router on a mobile node's visited network which provides\n       \
    \  routing services to the mobile node while registered.  The\n         foreign\
    \ agent detunnels and delivers datagrams to the mobile\n         node that were\
    \ tunneled by the mobile node's home agent.  For\n         datagrams sent by a\
    \ mobile node, the foreign agent may serve as\n         a default router for registered\
    \ mobile nodes.\n   A mobile node is given a long-term IP address on a home network.\n\
    \   This home address is administered in the same way as a \"permanent\" IP\n\
    \   address is provided to a stationary host.  When away from its home\n   network,\
    \ a \"care-of address\" is associated with the mobile node and\n   reflects the\
    \ mobile node's current point of attachment.  The mobile\n   node uses its home\
    \ address as the source address of all IP datagrams\n   that it sends, except\
    \ where otherwise described in this document for\n   datagrams sent for certain\
    \ mobility management functions (e.g., as in\n   Section 3.6.1.1).\n"
- title: 1.6. Terminology
  contents:
  - "1.6. Terminology\n   This document frequently uses the following terms:\n   \
    \   Agent Advertisement\n               An advertisement message constructed by\
    \ attaching a\n               special Extension to a router advertisement [4]\
    \ message.\n      Care-of Address\n               The termination point of a tunnel\
    \ toward a mobile node,\n               for datagrams forwarded to the mobile\
    \ node while it is\n               away from home.  The protocol can use two different\
    \ types\n               of care-of address:  a \"foreign agent care-of address\"\
    \ is\n               an address of a foreign agent with which the mobile node\n\
    \               is registered, and a \"co-located care-of address\" is an\n  \
    \             externally obtained local address which the mobile node\n      \
    \         has associated with one of its own network interfaces.\n      Correspondent\
    \ Node\n               A peer with which a mobile node is communicating.  A\n\
    \               correspondent node may be either mobile or stationary.\n     \
    \ Foreign Network\n               Any network other than the mobile node's Home\
    \ Network.\n      Home Address\n               An IP address that is assigned\
    \ for an extended period of\n               time to a mobile node.  It remains\
    \ unchanged regardless\n               of where the node is attached to the Internet.\n\
    \      Home Network\n               A network, possibly virtual, having a network\
    \ prefix\n               matching that of a mobile node's home address.  Note\
    \ that\n               standard IP routing mechanisms will deliver datagrams\n\
    \               destined to a mobile node's Home Address to the mobile\n     \
    \          node's Home Network.\n      Link     A facility or medium over which\
    \ nodes can communicate at\n               the link layer.  A link underlies the\
    \ network layer.\n      Link-Layer Address\n               The address used to\
    \ identify an endpoint of some\n               communication over a physical link.\
    \  Typically, the\n               Link-Layer address is an interface's Media Access\
    \ Control\n               (MAC) address.\n      Mobility Agent\n             \
    \  Either a home agent or a foreign agent.\n      Mobility Binding\n         \
    \      The association of a home address with a care-of address,\n           \
    \    along with the remaining lifetime of that association.\n      Mobility Security\
    \ Association\n               A collection of security contexts, between a pair\n\
    \               of nodes, which may be applied to Mobile IP protocol\n       \
    \        messages exchanged between them.  Each context indicates\n          \
    \     an authentication algorithm and mode (Section 5.1), a\n               secret\
    \ (a shared key, or appropriate public/private\n               key pair), and\
    \ a style of replay protection in use\n               (Section 5.6).\n      Node\
    \     A host or a router.\n      Nonce    A randomly chosen value, different from\
    \ previous choices,\n               inserted in a message to protect against replays.\n\
    \      Security Parameter Index (SPI)\n               An index identifying a security\
    \ context between a pair\n               of nodes among the contexts available\
    \ in the Mobility\n               Security Association.  SPI values 0 through\
    \ 255 are\n               reserved and MUST NOT be used in any Mobility Security\n\
    \               Association.\n      Tunnel   The path followed by a datagram while\
    \ it is encapsulated.\n               The model is that, while it is encapsulated,\
    \ a datagram\n               is routed to a knowledgeable decapsulating agent,\
    \ which\n               decapsulates the datagram and then correctly delivers\
    \ it\n               to its ultimate destination.\n      Virtual Network\n   \
    \            A network with no physical instantiation beyond a router\n      \
    \         (with a physical network interface on another network).\n          \
    \     The router (e.g., a home agent) generally advertises\n               reachability\
    \ to the virtual network using conventional\n               routing protocols.\n\
    \      Visited Network\n               A network other than a mobile node's Home\
    \ Network, to\n               which the mobile node is currently connected.\n\
    \      Visitor List\n               The list of mobile nodes visiting a foreign\
    \ agent.\n"
- title: 1.7. Protocol Overview
  contents:
  - "1.7. Protocol Overview\n   The following support services are defined for Mobile\
    \ IP:\n      Agent Discovery\n               Home agents and foreign agents may\
    \ advertise their\n               availability on each link for which they provide\
    \ service.\n               A newly arrived mobile node can send a solicitation\
    \ on\n               the link to learn if any prospective agents are present.\n\
    \      Registration\n               When the mobile node is away from home, it\
    \ registers\n               its care-of address with its home agent.  Depending\
    \ on\n               its method of attachment, the mobile node will register\n\
    \               either directly with its home agent, or through a foreign\n  \
    \             agent which forwards the registration to the home agent.\n   The\
    \ following steps provide a rough outline of operation of the\n   Mobile IP protocol:\n\
    \    -  Mobility agents (i.e., foreign agents and home agents) advertise\n   \
    \    their presence via Agent Advertisement messages (Section 2).  A\n       mobile\
    \ node may optionally solicit an Agent Advertisement message\n       from any\
    \ locally attached mobility agents through an Agent\n       Solicitation message.\n\
    \    -  A mobile node receives these Agent Advertisements and determines\n   \
    \    whether it is on its home network or a foreign network.\n    -  When the\
    \ mobile node detects that it is located on its home\n       network, it operates\
    \ without mobility services.  If returning\n       to its home network from being\
    \ registered elsewhere, the mobile\n       node deregisters with its home agent,\
    \ through exchange of a\n       Registration Request and Registration Reply message\
    \ with it.\n    -  When a mobile node detects that it has moved to a foreign\n\
    \       network, it obtains a care-of address on the foreign network.\n      \
    \ The care-of address can either be determined from a foreign\n       agent's\
    \ advertisements (a foreign agent care-of address), or by\n       some external\
    \ assignment mechanism such as DHCP [6] (a co-located\n       care-of address).\n\
    \    -  The mobile node operating away from home then registers its\n       new\
    \ care-of address with its home agent through exchange of a\n       Registration\
    \ Request and Registration Reply message with it,\n       possibly via a foreign\
    \ agent (Section 3).\n    -  Datagrams sent to the mobile node's home address\
    \ are intercepted\n       by its home agent, tunneled by the home agent to the\
    \ mobile\n       node's care-of address, received at the tunnel endpoint (either\n\
    \       at a foreign agent or at the mobile node itself), and finally\n      \
    \ delivered to the mobile node (Section 4.2.3).\n    -  In the reverse direction,\
    \ datagrams sent by the mobile node\n       are generally delivered to their destination\
    \ using standard IP\n       routing mechanisms, not necessarily passing through\
    \ the home\n       agent.\n   When away from home, Mobile IP uses protocol tunneling\
    \ to hide a\n   mobile node's home address from intervening routers between its\
    \ home\n   network and its current location.  The tunnel terminates at the\n \
    \  mobile node's care-of address.  The care-of address must be an\n   address\
    \ to which datagrams can be delivered via conventional IP\n   routing.  At the\
    \ care-of address, the original datagram is removed\n   from the tunnel and delivered\
    \ to the mobile node.\n   Mobile IP provides two alternative modes for the acquisition\
    \ of a\n   care-of address:\n    -  A \"foreign agent care-of address\" is a care-of\
    \ address provided\n       by a foreign agent through its Agent Advertisement\
    \ messages.  In\n       this case, the care-of address is an IP address of the\
    \ foreign\n       agent.  In this mode, the foreign agent is the endpoint of the\n\
    \       tunnel and, upon receiving tunneled datagrams, decapsulates them\n   \
    \    and delivers the inner datagram to the mobile node.  This mode\n       of\
    \ acquisition is preferred because it allows many mobile nodes\n       to share\
    \ the same care-of address and therefore does not place\n       unnecessary demands\
    \ on the already limited IPv4 address space.\n    -  A \"co-located care-of address\"\
    \ is a care-of address acquired\n       by the mobile node as a local IP address\
    \ through some external\n       means, which the mobile node then associates with\
    \ one of its own\n       network interfaces.  The address may be dynamically acquired\
    \ as\n       a temporary address by the mobile node such as through DHCP [6],\n\
    \       or may be owned by the mobile node as a long-term address for its\n  \
    \     use only while visiting some foreign network.  Specific external\n     \
    \  methods of acquiring a local IP address for use as a co-located\n       care-of\
    \ address are beyond the scope of this document.  When\n       using a co-located\
    \ care-of address, the mobile node serves as the\n       endpoint of the tunnel\
    \ and itself performs decapsulation of the\n       datagrams tunneled to it.\n\
    \   The mode of using a co-located care-of address has the advantage that\n  \
    \ it allows a mobile node to function without a foreign agent, for\n   example,\
    \ in networks that have not yet deployed a foreign agent.\n   It does, however,\
    \ place additional burden on the IPv4 address space\n   because it requires a\
    \ pool of addresses within the foreign network to\n   be made available to visiting\
    \ mobile nodes.  It is difficult to\n   efficiently maintain pools of addresses\
    \ for each subnet that may\n   permit mobile nodes to visit.\n   It is important\
    \ to understand the distinction between the care-of\n   address and the foreign\
    \ agent functions.  The care-of address is\n   simply the endpoint of the tunnel.\
    \  It might indeed be an address of\n   a foreign agent (a foreign agent care-of\
    \ address), but it might\n   instead be an address temporarily acquired by the\
    \ mobile node (a co-\n   located care-of address).  A foreign agent, on the other\
    \ hand, is a\n   mobility agent that provides services to mobile nodes.  See Sections\n\
    \   3.7 and 4.2.2 for additional details.\n   A home agent MUST be able to attract\
    \ and intercept datagrams that are\n   destined to the home address of any of\
    \ its registered mobile nodes.\n   Using the proxy and gratuitous ARP mechanisms\
    \ described in Section\n   4.6, this requirement can be satisfied if the home\
    \ agent has a\n   network interface on the link indicated by the mobile node's\
    \ home\n   address.  Other placements of the home agent relative to the mobile\n\
    \   node's home location MAY also be possible using other mechanisms for\n   intercepting\
    \ datagrams destined to the mobile node's home address.\n   Such placements are\
    \ beyond the scope of this document.\n   Similarly, a mobile node and a prospective\
    \ or current foreign agent\n   MUST be able to exchange datagrams without relying\
    \ on standard IP\n   routing mechanisms; that is, those mechanisms which make\
    \ forwarding\n   decisions based upon the network-prefix of the destination address\
    \ in\n   the IP header.  This requirement can be satisfied if the foreign\n  \
    \ agent and the visiting mobile node have an interface on the same\n   link. \
    \ In this case, the mobile node and foreign agent simply bypass\n   their normal\
    \ IP routing mechanism when sending datagrams to each\n   other, addressing the\
    \ underlying link-layer packets to their\n   respective link-layer addresses.\
    \  Other placements of the foreign\n   agent relative to the mobile node MAY also\
    \ be possible using other\n   mechanisms to exchange datagrams between these nodes,\
    \ but such\n   placements are beyond the scope of this document.\n   If a mobile\
    \ node is using a co-located care-of address (as described\n   in (b) above),\
    \ the mobile node MUST be located on the link identified\n   by the network prefix\
    \ of this care-of address.  Otherwise, datagrams\n   destined to the care-of address\
    \ would be undeliverable.\n   For example, the figure below illustrates the routing\
    \ of datagrams to\n   and from a mobile node away from home, once the mobile node\
    \ has\n   registered with its home agent.  In the figure below, the mobile node\n\
    \   is using a foreign agent care-of address:\n                2) Datagram is\
    \ intercepted   3) Datagram is\n                   by home agent and         \
    \   detunneled and\n                   is tunneled to the           delivered\
    \ to the\n                   care-of address.             mobile node.\n     \
    \                +-----+          +-------+         +------+\n               \
    \      |home | =======> |foreign| ------> |mobile|\n                     |agent|\
    \          | agent | <------ | node |\n                     +-----+          +-------+\
    \         +------+\n     1) Datagram to    /|\\         /\n        mobile node\
    \     |        /   4) For datagrams sent by the\n        arrives on      |   \
    \   /        mobile node, standard IP\n        home network    |    /        \
    \  routing delivers each to its\n        via standard    |  |_           destination.\
    \  In this figure,\n        IP routing.   +----+            the foreign agent\
    \ is the\n                      |host|            mobile node's default router.\n\
    \                      +----+\n"
- title: 1.8. Specification Language
  contents:
  - "1.8. Specification Language\n   In this document, several words are used to signify\
    \ the requirements\n   of the specification.  These words are often capitalized.\n\
    \      MUST       This word, or the adjective \"required\", means that\n     \
    \            the definition is an absolute requirement of the\n              \
    \   specification.\n      MUST NOT   This phrase means that the definition is\
    \ an absolute\n                 prohibition of the specification.\n      SHOULD\
    \     This word, or the adjective \"recommended\", means\n                 that,\
    \ in some circumstances, valid reasons may exist\n                 to ignore this\
    \ item, but the full implications must\n                 be understood and carefully\
    \ weighed before choosing\n                 a different course.  Unexpected results\
    \ may result\n                 otherwise.\n      MAY        This word, or the\
    \ adjective \"optional\", means that this\n                 item is one of an\
    \ allowed set of alternatives.  An\n                 implementation which does\
    \ not include this option MUST\n                 be prepared to interoperate with\
    \ another implementation\n                 which does include the option.\n  \
    \    silently discard\n                 The implementation discards the datagram\
    \ without\n                 further processing, and without indicating an error\n\
    \                 to the sender.  The implementation SHOULD provide the\n    \
    \             capability of logging the error, including the contents\n      \
    \           of the discarded datagram, and SHOULD record the event\n         \
    \        in a statistics counter.\n"
- title: 1.9. Message Format and Protocol Extensibility
  contents:
  - "1.9. Message Format and Protocol Extensibility\n   Mobile IP defines a set of\
    \ new control messages, sent with UDP [17]\n   using well-known port number 434.\
    \  Currently, the following two\n   message types are defined:\n      1  Registration\
    \ Request\n      3  Registration Reply\n   Up-to-date values for the message types\
    \ for Mobile IP control\n   messages are specified in the most recent \"Assigned\
    \ Numbers\" [20].\n   In addition, for Agent Discovery, Mobile IP makes use of\
    \ the existing\n   Router Advertisement and Router Solicitation messages defined\
    \ for\n   ICMP Router Discovery [4].\n   Mobile IP defines a general Extension\
    \ mechanism to allow optional\n   information to be carried by Mobile IP control\
    \ messages or by ICMP\n   Router Discovery messages.  Each of these Extensions\
    \ (with one\n   exception) is encoded in the following Type-Length-Value format:\n\
    \    0                   1                   2\n    0 1 2 3 4 5 6 7 8 9 0 1 2\
    \ 3 4 5 6 7 8 9 0 1 2\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-\n   |\
    \     Type      |    Length     |    Data ...\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-\n\
    \      Type     Indicates the particular type of Extension.\n      Length   Indicates\
    \ the length (in bytes) of the data field within\n               this Extension.\
    \  The length does NOT include the Type and\n               Length bytes.\n  \
    \    Data     The particular data associated with this Extension.  This\n    \
    \           field may be zero or more bytes in length.  The format\n         \
    \      and length of the data field is determined by the type\n              \
    \ and length fields.\n   Extensions allow variable amounts of information to be\
    \ carried within\n   each datagram.  The end of the list of Extensions is indicated\
    \ by the\n   total length of the IP datagram.\n   Two separately maintained sets\
    \ of numbering spaces, from which\n   Extension Type values are allocated, are\
    \ used in Mobile IP:\n    -  The first set consists of those Extensions which\
    \ may appear only\n       in Mobile IP control messages (those sent to and from\
    \ UDP port\n       number 434).  Currently, the following Types are defined for\n\
    \       Extensions appearing in Mobile IP control messages:\n          32  Mobile-Home\
    \ Authentication\n          33  Mobile-Foreign Authentication\n          34  Foreign-Home\
    \ Authentication\n    -  The second set consists of those extensions which may\
    \ appear only\n       in ICMP Router Discovery messages [4].  Currently, Mobile\
    \ IP\n       defines the following Types for Extensions appearing in ICMP\n  \
    \     Router Discovery messages:\n           0  One-byte Padding (encoded with\
    \ no Length nor Data field)\n          16  Mobility Agent Advertisement\n    \
    \      19  Prefix-Lengths\n   Each individual Extension is described in detail\
    \ in a separate\n   section later in this document.  Up-to-date values for these\n\
    \   Extension Type numbers are specified in the most recent \"Assigned\n   Numbers\"\
    \ [20].\n   Due to the separation (orthogonality) of these sets, it is\n   conceivable\
    \ that two Extensions that are defined at a later date\n   could have identical\
    \ Type values, so long as one of the Extensions\n   may be used only in Mobile\
    \ IP control messages and the other may be\n   used only in ICMP Router Discovery\
    \ messages.\n   When an Extension numbered in either of these sets within the\
    \ range 0\n   through 127 is encountered but not recognized, the message containing\n\
    \   that Extension MUST be silently discarded.  When an Extension\n   numbered\
    \ in the range 128 through 255 is encountered which is not\n   recognized, that\
    \ particular Extension is ignored, but the rest of the\n   Extensions and message\
    \ data MUST still be processed.  The Length\n   field of the Extension is used\
    \ to skip the Data field in searching\n   for the next Extension.\n"
- title: 2. Agent Discovery
  contents:
  - "2. Agent Discovery\n   Agent Discovery is the method by which a mobile node determines\n\
    \   whether it is currently connected to its home network or to a foreign\n  \
    \ network, and by which a mobile node can detect when it has moved from\n   one\
    \ network to another.  When connected to a foreign network, the\n   methods specified\
    \ in this section also allow the mobile node to\n   determine the foreign agent\
    \ care-of address being offered by each\n   foreign agent on that network.\n \
    \  Mobile IP extends ICMP Router Discovery [4] as its primary mechanism\n   for\
    \ Agent Discovery.  An Agent Advertisement is formed by including a\n   Mobility\
    \ Agent Advertisement Extension in an ICMP Router\n   Advertisement message (Section\
    \ 2.1).  An Agent Solicitation message\n   is identical to an ICMP Router Solicitation,\
    \ except that its IP TTL\n   MUST be set to 1 (Section 2.2).  This section describes\
    \ the message\n   formats and procedures by which mobile nodes, foreign agents,\
    \ and\n   home agents cooperate to realize Agent Discovery.\n   Agent Advertisement\
    \ and Agent Solicitation may not be necessary for\n   link layers that already\
    \ provide this functionality.  The method by\n   which mobile nodes establish\
    \ link-layer connections with prospective\n   agents is outside the scope of this\
    \ document (but see Appendix B).\n   The procedures described below assume that\
    \ such link-layer\n   connectivity has already been established.\n   No authentication\
    \ is required for Agent Advertisement and Agent\n   Solicitation messages.  They\
    \ MAY be authenticated using the IP\n   Authentication Header [1], which is unrelated\
    \ to the messages\n   described in this document.  Further specification of the\
    \ way in\n   which Advertisement and Solicitation messages may be authenticated\
    \ is\n   outside of the scope of this document.\n"
- title: 2.1. Agent Advertisement
  contents:
  - "2.1. Agent Advertisement\n   Agent Advertisements are transmitted by a mobility\
    \ agent to advertise\n   its services on a link.  Mobile nodes use these advertisements\
    \ to\n   determine their current point of attachment to the Internet.  An\n  \
    \ Agent Advertisement is an ICMP Router Advertisement that has been\n   extended\
    \ to also carry an Mobility Agent Advertisement Extension\n   (Section 2.1.1)\
    \ and, optionally, a Prefix-Lengths Extension (Section\n   2.1.2), One-byte Padding\
    \ Extension (Section 2.1.3), or other\n   Extensions that might be defined in\
    \ the future.\n   Within an Agent Advertisement message, ICMP Router Advertisement\n\
    \   fields of the message are required to conform to the following\n   additional\
    \ specifications:\n    -  Link-Layer Fields\n          Destination Address\n \
    \                  The link-layer destination address of a unicast\n         \
    \          Agent Advertisement MUST be the same as the source\n              \
    \     link-layer address of the Agent Solicitation which\n                   prompted\
    \ the Advertisement.\n    -  IP Fields\n          TTL      The TTL for all Agent\
    \ Advertisements MUST be set\n                   to 1.\n          Destination\
    \ Address\n                   As specified for ICMP Router Discovery [4], the\
    \ IP\n                   destination address of an Agent Advertisement MUST\n\
    \                   be either the \"all systems on this link\" multicast\n   \
    \                address (224.0.0.1) [5] or the \"limited broadcast\"\n      \
    \             address (255.255.255.255).  The subnet-directed\n              \
    \     broadcast address of the form <prefix>.<-1> cannot be\n                \
    \   used since mobile nodes will not generally know the\n                   prefix\
    \ of the foreign network.\n    -  ICMP Fields\n          Code     The Code field\
    \ of the agent advertisement is\n                   interpreted as follows:\n\
    \                    0 The mobility agent handles common traffic -- that\n   \
    \                   is, it acts as a router for IP datagrams not\n           \
    \           necessarily related to mobile nodes.\n                   16 The mobility\
    \ agent does not route common traffic.\n                      However, all foreign\
    \ agents MUST (minimally)\n                      forward to a default router any\
    \ datagrams received\n                      from a registered mobile node (Section\
    \ 4.2.2).\n          Lifetime\n                   The maximum length of time that\
    \ the Advertisement\n                   is considered valid in the absence of\
    \ further\n                   Advertisements.\n          Router Address(es)\n\
    \                   See Section 2.3.1 for a discussion of the addresses\n    \
    \               that may appear in this portion of the Agent\n               \
    \    Advertisement.\n          Num Addrs\n                   The number of Router\
    \ Addresses advertised in this\n                   message.  Note that in an Agent\
    \ Advertisement\n                   message, the number of router addresses specified\
    \ in\n                   the ICMP Router Advertisement portion of the message\n\
    \                   MAY be set to 0.  See Section 2.3.1 for details.\n   If sent\
    \ periodically, the nominal interval at which Agent\n   Advertisements are sent\
    \ SHOULD be 1/3 of the advertisement Lifetime\n   given in the ICMP header.  This\
    \ allows a mobile node to miss three\n   successive advertisements before deleting\
    \ the agent from its list of\n   valid agents.  The actual transmission time for\
    \ each advertisement\n   SHOULD be slightly randomized [4] in order to avoid synchronization\n\
    \   and subsequent collisions with other Agent Advertisements that may be\n  \
    \ sent by other agents (or with other Router Advertisements sent by\n   other\
    \ routers).  Note that this field has no relation to the\n   \"Registration Lifetime\"\
    \ field within the Mobility Agent Advertisement\n   Extension defined below.\n"
- title: 2.1.1. Mobility Agent Advertisement Extension
  contents:
  - "2.1.1. Mobility Agent Advertisement Extension\n   The Mobility Agent Advertisement\
    \ Extension follows the ICMP Router\n   Advertisement fields.  It is used to indicate\
    \ that an ICMP Router\n   Advertisement message is also an Agent Advertisement\
    \ being sent by a\n   mobility agent.  The Mobility Agent Advertisement Extension\
    \ is\n   defined as follows:\n    0                   1                   2  \
    \                 3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6\
    \ 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |     Type      |    Length     |        Sequence Number        |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |    Registration Lifetime      |R|B|H|F|M|G|V|    reserved     |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                  zero or more Care-of Addresses               |\n   |  \
    \                            ...                              |\n      Type  \
    \   16\n      Length   (6 + 4*N), where N is the number of care-of addresses\n\
    \               advertised.\n      Sequence Number\n               The count of\
    \ Agent Advertisement messages sent since the\n               agent was initialized\
    \ (Section 2.3.2).\n      Registration Lifetime\n               The longest lifetime\
    \ (measured in seconds) that this\n               agent is willing to accept in\
    \ any Registration Request.\n               A value of 0xffff indicates infinity.\
    \  This field has no\n               relation to the \"Lifetime\" field within\
    \ the ICMP Router\n               Advertisement portion of the Agent Advertisement.\n\
    \      R        Registration required.  Registration with this foreign\n     \
    \          agent (or another foreign agent on this link) is required\n       \
    \        rather than using a co-located care-of address.\n      B        Busy.\
    \  The foreign agent will not accept registrations\n               from additional\
    \ mobile nodes.\n      H        Home agent.  This agent offers service as a home\
    \ agent\n               on the link on which this Agent Advertisement message\
    \ is\n               sent.\n      F        Foreign agent.  This agent offers service\
    \ as a foreign\n               agent on the link on which this Agent Advertisement\n\
    \               message is sent.\n      M        Minimal encapsulation.  This\
    \ agent implements receiving\n               tunneled datagrams that use minimal\
    \ encapsulation [15].\n      G        GRE encapsulation.  This agent implements\
    \ receiving\n               tunneled datagrams that use GRE encapsulation [8].\n\
    \      V        Van Jacobson header compression.  This agent supports use\n  \
    \             of Van Jacobson header compression [10] over the link\n        \
    \       with any registered mobile node.\n      reserved\n               Sent\
    \ as zero; ignored on reception.\n      Care-of Address(es)\n               The\
    \ advertised foreign agent care-of address(es) provided\n               by this\
    \ foreign agent.  An Agent Advertisement MUST\n               include at least\
    \ one care-of address if the 'F' bit\n               is set.  The number of care-of\
    \ addresses present is\n               determined by the Length field in the Extension.\n\
    \   A home agent MUST always be prepared to serve the mobile nodes for\n   which\
    \ it is the home agent.  A foreign agent may at times be too busy\n   to serve\
    \ additional mobile nodes; even so, it must continue to send\n   Agent Advertisements,\
    \ so that any mobile nodes already registered\n   with it will know that they\
    \ have not moved out of range of the\n   foreign agent and that the foreign agent\
    \ has not failed.  A foreign\n   agent may indicate that it is \"too busy\" to\
    \ allow new mobile nodes to\n   register with it, by setting the 'B' bit in its\
    \ Agent Advertisements.\n   An Agent Advertisement message MUST NOT have the 'B'\
    \ bit set if the\n   'F' bit is not also set, and at least one of the 'F' bit\
    \ and the 'H'\n   bit MUST be set in any Agent Advertisement message sent.\n \
    \  When a foreign agent wishes to require registration even from those\n   mobile\
    \ nodes which have acquired a co-located care-of address, it\n   sets the 'R'\
    \ bit to one.  Because this bit applies only to foreign\n   agents, an agent MUST\
    \ NOT set the 'R' bit to one unless the 'F' bit\n   is also set to one.\n"
- title: 2.1.2. Prefix-Lengths Extension
  contents:
  - "2.1.2. Prefix-Lengths Extension\n   The Prefix-Lengths Extension MAY follow the\
    \ Mobility Agent\n   Advertisement Extension.  It is used to indicate the number\
    \ of bits\n   of network prefix that applies to each Router Address listed in\
    \ the\n   ICMP Router Advertisement portion of the Agent Advertisement.  Note\n\
    \   that the prefix lengths given DO NOT apply to care-of address(es)\n   listed\
    \ in the Mobility Agent Advertisement Extension.  The Prefix-\n   Lengths Extension\
    \ is defined as follows:\n    0                   1                   2      \
    \             3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8\
    \ 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |     Type      |    Length     | Prefix Length |      ....\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      Type     19 (Prefix-Lengths Extension)\n      Length   N, where N is the\
    \ value of the Num Addrs field in\n               the ICMP Router Advertisement\
    \ portion of the Agent\n               Advertisement.\n      Prefix Length(s)\n\
    \               The number of leading bits that define the network number\n  \
    \             of the corresponding Router Address listed in the ICMP\n       \
    \        Router Advertisement portion of the message.  The prefix\n          \
    \     length for each Router Address is encoded as a separate\n              \
    \ byte, in the order that the Router Addresses are listed\n               in the\
    \ ICMP Router Advertisement portion of the message.\n   See Section 2.4.2 for\
    \ information about how the Prefix Lengths\n   Extension MAY be used by a mobile\
    \ node when determining whether it\n   has moved.  See Appendix E for implementation\
    \ details about the use\n   of this Extension.\n"
- title: 2.1.3. One-byte Padding Extension
  contents:
  - "2.1.3. One-byte Padding Extension\n   Some IP protocol implementations insist\
    \ upon padding ICMP messages to\n   an even number of bytes.  If the ICMP length\
    \ of an Agent\n   Advertisement is odd, this Extension MAY be included in order\
    \ to make\n   the ICMP length even.  Note that this Extension is NOT intended\
    \ to be\n   a general-purpose Extension to be included in order to word- or\n\
    \   long-align the various fields of the Agent Advertisement.  An Agent\n   Advertisement\
    \ SHOULD NOT include more than one One-byte Padding\n   Extension and if present,\
    \ this Extension SHOULD be the last Extension\n   in the Agent Advertisement.\n\
    \   Note that unlike other Extensions used in Mobile IP, the One-byte\n   Padding\
    \ Extension is encoded as a single byte, with no \"Length\" nor\n   \"Data\" field\
    \ present.  The One-byte Padding Extension is defined as\n   follows:\n    0 1\
    \ 2 3 4 5 6 7\n   +-+-+-+-+-+-+-+-+\n   |     Type      |\n   +-+-+-+-+-+-+-+-+\n\
    \      Type 0 (One-byte Padding Extension)\n"
- title: 2.2. Agent Solicitation
  contents:
  - "2.2. Agent Solicitation\n   An Agent Solicitation is identical to an ICMP Router\
    \ Solicitation\n   with the further restriction that the IP TTL Field MUST be\
    \ set to 1.\n"
- title: 2.3. Foreign Agent and Home Agent Considerations
  contents:
  - "2.3. Foreign Agent and Home Agent Considerations\n   Any mobility agent which\
    \ cannot be discovered by a link-layer\n   protocol MUST send Agent Advertisements.\
    \  An agent which can be\n   discovered by a link-layer protocol SHOULD also implement\
    \ Agent\n   Advertisements.  However, the Advertisements need not be sent, except\n\
    \   when the site policy requires registration with the agent (i.e., when\n  \
    \ the 'R' bit is set), or as a response to a specific Agent\n   Solicitation.\
    \  All mobility agents SHOULD respond to Agent\n   Solicitations.\n   The same\
    \ procedures, defaults, and constants are used in Agent\n   Advertisement messages\
    \ and Agent Solicitation messages as specified\n   for ICMP Router Discovery [4],\
    \ except that:\n    -  a mobility agent MUST limit the rate at which it sends\
    \ broadcast\n       or multicast Agent Advertisements; a recommended maximum rate\
    \ is\n       once per second, AND\n    -  a mobility agent that receives a Router\
    \ Solicitation MUST NOT\n       require that the IP Source Address is the address\
    \ of a neighbor\n       (i.e., an address that matches one of the router's own\
    \ addresses\n       on the arrival interface, under the subnet mask associated\
    \ with\n       that address of the router).\n    -  a mobility agent MAY be configured\
    \ to send Agent Advertisements\n       only in response to an Agent Solicitation\
    \ message.\n   If the home network is not a virtual network, then the home agent\
    \ for\n   any mobile node SHOULD be located on the link identified by the\n  \
    \ mobile node's home address, and Agent Advertisement messages sent by\n   the\
    \ home agent on this link MUST have the 'H' bit set.  In this way,\n   mobile\
    \ nodes on their own home network will be able to determine that\n   they are\
    \ indeed at home.  Any Agent Advertisement messages sent by\n   the home agent\
    \ on another link to which it may be attached (if it is\n   a mobility agent serving\
    \ more than one link), MUST NOT have the 'H'\n   bit set, unless the home agent\
    \ also serves as a home agent (to other\n   mobile nodes) on that other link.\n\
    \   If the home network is a virtual network, the home network has no\n   physical\
    \ realization external to the home agent itself.  In this\n   case, there is no\
    \ physical network link on which to send Agent\n   Advertisement messages advertising\
    \ the home agent.  Mobile nodes for\n   which this is the home network are always\
    \ treated as being away from\n   home.\n   On a particular subnet, either all\
    \ mobility agents MUST include the\n   Prefix-Lengths Extension or all of them\
    \ MUST NOT include this\n   Extension.  Equivalently, it is prohibited for some\
    \ agents on a given\n   subnet to include the Extension but for others not to\
    \ include it.\n   Otherwise, one of the move detection algorithms designed for\
    \ mobile\n   nodes will not function properly (Section 2.4.2).\n"
- title: 2.3.1. Advertised Router Addresses
  contents:
  - "2.3.1. Advertised Router Addresses\n   The ICMP Router Advertisement portion\
    \ of the Agent Advertisement MAY\n   contain one or more router addresses.  Thus,\
    \ an agent MAY include one\n   of its own addresses in the advertisement.  A foreign\
    \ agent MAY\n   discourage use of this address as a default router by setting\
    \ the\n   preference to a low value and by including the address of another\n\
    \   router in the advertisement (with a correspondingly higher\n   preference).\
    \  Nevertheless, a foreign agent MUST route datagrams it\n   receives from registered\
    \ mobile nodes (Section 4.2.2).\n"
- title: 2.3.2. Sequence Numbers and Rollover Handling
  contents:
  - "2.3.2. Sequence Numbers and Rollover Handling\n   The sequence number in Agent\
    \ Advertisements ranges from 0 to 0xffff.\n   After booting, an agent MUST use\
    \ the number 0 for its first\n   advertisement.  Each subsequent advertisement\
    \ MUST use the sequence\n   number one greater, with the exception that the sequence\
    \ number\n   0xffff MUST be followed by sequence number 256.  In this way, mobile\n\
    \   nodes can distinguish reductions in sequence numbers that result from\n  \
    \ reboots, from reductions that result in rollover of the sequence\n   number\
    \ after it attains the value 0xffff.\n"
- title: 2.4. Mobile Node Considerations
  contents:
  - "2.4. Mobile Node Considerations\n   Every mobile node MUST implement Agent Solicitation.\
    \  Solicitations\n   SHOULD only be sent in the absence of Agent Advertisements\
    \ and when a\n   care-of address has not been determined through a link-layer\
    \ protocol\n   or other means.  The mobile node uses the same procedures, defaults,\n\
    \   and constants for Agent Solicitation as specified for ICMP Router\n   Solicitation\
    \ messages [4], except that the mobile node MAY solicit\n   more often than once\
    \ every three seconds, and that a mobile node that\n   is currently not connected\
    \ to any foreign agent MAY solicit more\n   times than MAX_SOLICITATIONS.\n  \
    \ The rate at which a mobile node sends Solicitations MUST be limited\n   by the\
    \ mobile node.  The mobile node MAY send three initial\n   Solicitations at a\
    \ maximum rate of one per second while searching for\n   an agent.  After this,\
    \ the rate at which Solicitations are sent MUST\n   be reduced so as to limit\
    \ the overhead on the local link.  Subsequent\n   Solicitations MUST be sent using\
    \ a binary exponential backoff\n   mechanism, doubling the interval between consecutive\
    \ Solicitations,\n   up to a maximum interval.  The maximum interval SHOULD be\
    \ chosen\n   appropriately based upon the characteristics of the media over which\n\
    \   the mobile node is soliciting.  This maximum interval SHOULD be at\n   least\
    \ one minute between Solicitations.\n   While still searching for an agent, the\
    \ mobile node MUST NOT increase\n   the rate at which it sends Solicitations unless\
    \ it has received a\n   positive indication that it has moved to a new link. \
    \ After\n   successfully registering with an agent, the mobile node SHOULD also\n\
    \   increase the rate at which it will send Solicitations when it next\n   begins\
    \ searching for a new agent with which to register.  The\n   increased solicitation\
    \ rate MAY revert to the maximum rate, but then\n   MUST be limited in the manner\
    \ described above.  In all cases, the\n   recommended solicitation intervals are\
    \ nominal values.  Mobile nodes\n   MUST randomize their solicitation times around\
    \ these nominal values\n   as specified for ICMP Router Discovery [4].\n   Mobile\
    \ nodes MUST process received Agent Advertisements.  A mobile\n   node can distinguish\
    \ an Agent Advertisement message from other uses\n   of the ICMP Router Advertisement\
    \ message by examining the number of\n   advertised addresses and the IP Total\
    \ Length field.  When the IP\n   total length indicates that the ICMP message\
    \ is longer than needed\n   for the number of advertised addresses, the remaining\
    \ data is\n   interpreted as one or more Extensions.  The presence of a Mobility\n\
    \   Agent Advertisement Extension identifies the advertisement as an\n   Agent\
    \ Advertisement.\n   When multiple methods of agent discovery are in use, the\
    \ mobile node\n   SHOULD first attempt registration with agents including Mobility\n\
    \   Agent Advertisement Extensions in their advertisements, in preference\n  \
    \ to those discovered by other means.  This preference maximizes the\n   likelihood\
    \ that the registration will be recognized, thereby\n   minimizing the number\
    \ of registration attempts.\n"
- title: 2.4.1. Registration Required
  contents:
  - "2.4.1. Registration Required\n   When the mobile node receives an Agent Advertisement\
    \ with the 'R' bit\n   set, the mobile node SHOULD register through the foreign\
    \ agent, even\n   when the mobile node might be able to acquire its own co-located\n\
    \   care-of address.  This feature is intended to allow sites to enforce\n   visiting\
    \ policies (such as accounting) which require exchanges of\n   authorization.\n"
- title: 2.4.2. Move Detection
  contents:
  - "2.4.2. Move Detection\n   Two primary mechanisms are provided for mobile nodes\
    \ to detect when\n   they have moved from one subnet to another.  Other mechanisms\
    \ MAY\n   also be used.  When the mobile node detects that it has moved, it\n\
    \   SHOULD register (Section 3) with a suitable care-of address on the\n   new\
    \ foreign network.  However, the mobile node MUST NOT register more\n   frequently\
    \ than once per second on average, as specified in Section\n   3.6.3.\n"
- title: 2.4.2.1. Algorithm 1
  contents:
  - "2.4.2.1. Algorithm 1\n   The first method of move detection is based upon the\
    \ Lifetime field\n   within the main body of the ICMP Router Advertisement portion\
    \ of the\n   Agent Advertisement.  A mobile node SHOULD record the Lifetime\n\
    \   received in any Agent Advertisements, until that Lifetime expires.\n   If\
    \ the mobile node fails to receive another advertisement from the\n   same agent\
    \ within the specified Lifetime, it SHOULD assume that it\n   has lost contact\
    \ with that agent.  If the mobile node has previously\n   received an Agent Advertisement\
    \ from another agent for which the\n   Lifetime field has not yet expired, the\
    \ mobile node MAY immediately\n   attempt registration with that other agent.\
    \  Otherwise, the mobile\n   node SHOULD attempt to discover a new agent with\
    \ which to register.\n"
- title: 2.4.2.2. Algorithm 2
  contents:
  - "2.4.2.2. Algorithm 2\n   The second method uses network prefixes.  The Prefix-Lengths\n\
    \   Extension MAY be used in some cases by a mobile node to determine\n   whether\
    \ or not a newly received Agent Advertisement was received on\n   the same subnet\
    \ as the mobile node's current care-of address.  If the\n   prefixes differ, the\
    \ mobile node MAY assume that it has moved.  If a\n   mobile node is currently\
    \ using a foreign agent care-of address, the\n   mobile node SHOULD NOT use this\
    \ method of move detection unless both\n   the current agent and the new agent\
    \ include the Prefix-Lengths\n   Extension in their respective Agent Advertisements;\
    \ if this Extension\n   is missing from one or both of the advertisements, this\
    \ method of\n   move detection SHOULD NOT be used.  Similarly, if a mobile node\
    \ is\n   using a co-located care-of address, it SHOULD not use this method of\n\
    \   move detection unless the new agent includes the Prefix-Lengths\n   Extension\
    \ in its Advertisement and the mobile node knows the network\n   prefix of its\
    \ current co-located care-of address.  On the expiration\n   of its current registration,\
    \ if this method indicates that the mobile\n   node has moved, rather than re-registering\
    \ with its current care-of\n   address, a mobile node MAY choose instead to register\
    \ with a the\n   foreign agent sending the new Advertisement with the different\n\
    \   network prefix.  The Agent Advertisement on which the new\n   registration\
    \ is based MUST NOT have expired according to its Lifetime\n   field.\n"
- title: 2.4.3. Returning Home
  contents:
  - "2.4.3. Returning Home\n   A mobile node can detect that it has returned to its\
    \ home network\n   when it receives an Agent Advertisement from its own home agent.\
    \  If\n   so, it SHOULD deregister with its home agent (Section 3).  Before\n\
    \   attempting to deregister, the mobile node SHOULD configure its\n   routing\
    \ table appropriately for its home network (Section 4.2.1).  In\n   addition,\
    \ if the home network is using ARP [16], the mobile node MUST\n   follow the procedures\
    \ described in Section 4.6 with regard to ARP,\n   proxy ARP, and gratuitous ARP.\n"
- title: 2.4.4. Sequence Numbers and Rollover Handling
  contents:
  - "2.4.4. Sequence Numbers and Rollover Handling\n   If a mobile node detects two\
    \ successive values of the sequence number\n   in the Agent Advertisements from\
    \ the foreign agent with which it is\n   registered, the second of which is less\
    \ than the first and inside the\n   range 0 to 255, the mobile node SHOULD register\
    \ again.  If the second\n   value is less than the first but is greater than or\
    \ equal to 256, the\n   mobile node SHOULD assume that the sequence number has\
    \ rolled over\n   past its maximum value (0xffff), and that reregistration is\
    \ not\n   necessary (Section 2.3).\n"
- title: 3. Registration
  contents:
  - "3. Registration\n   Mobile IP registration provides a flexible mechanism for\
    \ mobile nodes\n   to communicate their current reachability information to their\
    \ home\n   agent.  It is the method by which mobile nodes:\n    -  request forwarding\
    \ services when visiting a foreign network,\n    -  inform their home agent of\
    \ their current care-of address,\n    -  renew a registration which is due to\
    \ expire, and/or\n    -  deregister when they return home.\n   Registration messages\
    \ exchange information between a mobile node,\n   (optionally) a foreign agent,\
    \ and the home agent.  Registration\n   creates or modifies a mobility binding\
    \ at the home agent, associating\n   the mobile node's home address with its care-of\
    \ address for the\n   specified Lifetime.\n   Several other (optional) capabilities\
    \ are available through the\n   registration procedure, which enable a mobile\
    \ node to:\n    -  maintain multiple simultaneous registrations, so that a copy\
    \ of\n       each datagram will be tunneled to each active care-of address\n \
    \   -  deregister specific care-of addresses while retaining other\n       mobility\
    \ bindings, and\n    -  discover the address of a home agent if the mobile node\
    \ is not\n       configured with this information.\n"
- title: 3.1. Registration Overview
  contents:
  - "3.1. Registration Overview\n   Mobile IP defines two different registration procedures,\
    \ one via a\n   foreign agent that relays the registration to the mobile node's\
    \ home\n   agent, and one directly with the mobile node's home agent.  The\n \
    \  following rules determine which of these two registration procedures\n   to\
    \ use in any particular circumstance:\n    -  If a mobile node is registering\
    \ a foreign agent care-of address,\n       the mobile node MUST register via that\
    \ foreign agent.\n    -  If a mobile node is using a co-located care-of address,\
    \ and\n       receives an Agent Advertisement from a foreign agent on the\n  \
    \     link on which it is using this care-of address, the mobile node\n      \
    \ SHOULD register via that foreign agent (or via another foreign\n       agent\
    \ on this link) if the 'R' bit is set in the received Agent\n       Advertisement\
    \ message.\n    -  If a mobile node is otherwise using a co-located care-of address,\n\
    \       the mobile node MUST register directly with its home agent.\n    -  If\
    \ a mobile node has returned to its home network and is\n       (de)registering\
    \ with its home agent, the mobile node MUST\n       register directly with its\
    \ home agent.\n   Both registration procedures involve the exchange of Registration\n\
    \   Request and Registration Reply messages (Sections 3.3 and 3.4).  When\n  \
    \ registering via a foreign agent, the registration procedure requires\n   the\
    \ following four messages:\n      a)   The mobile node sends a Registration Request\
    \ to the\n           prospective foreign agent to begin the registration process.\n\
    \      b)   The foreign agent processes the Registration Request and then\n  \
    \         relays it to the home agent.\n      c)   The home agent sends a Registration\
    \ Reply to the foreign\n           agent to grant or deny the Request.\n     \
    \ d)   The foreign agent processes the Registration Reply and then\n         \
    \  relays it to the mobile node to inform it of the disposition\n           of\
    \ its Request.\n   When the mobile node instead registers directly with its home\
    \ agent,\n   the registration procedure requires only the following two messages:\n\
    \         a)   The mobile node sends a Registration Request to the home\n    \
    \          agent.\n         b)   The home agent sends a Registration Reply to\
    \ the mobile\n              node, granting or denying the Request.\n   The registration\
    \ messages defined in Sections 3.3 and 3.4 use the\n   User Datagram Protocol\
    \ (UDP) [17].  A nonzero UDP checksum SHOULD be\n   included in the header, and\
    \ MUST be checked by the recipient.\n"
- title: 3.2. Authentication
  contents:
  - "3.2. Authentication\n   Each mobile node, foreign agent, and home agent MUST\
    \ be able to\n   support a mobility security association for mobile entities,\
    \ indexed\n   by their SPI and IP address.  In the case of the mobile node, this\n\
    \   must be its Home Address.  See Section 5.1 for requirements for\n   support\
    \ of authentication algorithms.  Registration messages between\n   a mobile node\
    \ and its home agent MUST be authenticated with the\n   Mobile-Home Authentication\
    \ Extension (Section 3.5.2).  This Extension\n   immediately follows all non-authentication\
    \ Extensions, except those\n   foreign agent-specific Extensions which may be\
    \ added to the message\n   after the mobile node computes the authentication.\n"
- title: 3.3. Registration Request
  contents:
  - "3.3. Registration Request\n   A mobile node registers with its home agent using\
    \ a Registration\n   Request message so that its home agent can create or modify\
    \ a\n   mobility binding for that mobile node (e.g., with a new lifetime).\n \
    \  The Request may be relayed to the home agent by the foreign agent\n   through\
    \ which the mobile node is registering, or it may be sent\n   directly to the\
    \ home agent in the case in which the mobile node is\n   registering a co-located\
    \ care-of address.\n   IP fields:\n      Source Address Typically the interface\
    \ address from which the\n               message is sent.\n      Destination Address\
    \ Typically that of the foreign agent or the\n               home agent.\n   See\
    \ Sections 3.6.1.1 and 3.7.2.2 for details.\n   UDP fields:\n      Source Port\
    \        variable\n      Destination Port   434\n   The UDP header is followed\
    \ by the Mobile IP fields shown below:\n    0                   1            \
    \       2                   3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\
    \ 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |     Type      |S|B|D|M|G|V|rsv|          Lifetime             |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                          Home Address                         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                           Home Agent                          |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                        Care-of Address                        |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                                                               |\n   +  \
    \                       Identification                        +\n   |        \
    \                                                       |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   | Extensions ...\n   +-+-+-+-+-+-+-+-\n      Type     1 (Registration Request)\n\
    \      S        Simultaneous bindings.  If the 'S' bit is set, the mobile\n  \
    \             node is requesting that the home agent retain its prior\n      \
    \         mobility bindings, as described in Section 3.6.1.2.\n      B       \
    \ Broadcast datagrams.  If the 'B' bit is set, the mobile\n               node\
    \ requests that the home agent tunnel to it any\n               broadcast datagrams\
    \ that it receives on the home network,\n               as described in Section\
    \ 4.3.\n      D        Decapsulation by mobile node.  If the 'D' bit is set, the\n\
    \               mobile node will itself decapsulate datagrams which are\n    \
    \           sent to the care-of address.  That is, the mobile node is\n      \
    \         using a co-located care-of address.\n      M        Minimal encapsulation.\
    \  If the 'M' bit is set, the\n               mobile node requests that its home\
    \ agent use minimal\n               encapsulation [15] for datagrams tunneled\
    \ to the mobile\n               node.\n      G        GRE encapsulation.  If the\
    \ 'G' bit is set, the\n               mobile node requests that its home agent\
    \ use GRE\n               encapsulation [8] for datagrams tunneled to the mobile\n\
    \               node.\n      V        The mobile node requests that its mobility\
    \ agent use Van\n               Jacobson header compression [10] over its link\
    \ with the\n               mobile node.\n      rsv      Reserved bits; sent as\
    \ zero\n      Lifetime\n               The number of seconds remaining before\
    \ the registration\n               is considered expired.  A value of zero indicates\
    \ a\n               request for deregistration.  A value of 0xffff indicates\n\
    \               infinity.\n      Home Address\n               The IP address of\
    \ the mobile node.\n      Home Agent\n               The IP address of the mobile\
    \ node's home agent.\n      Care-of Address\n               The IP address for\
    \ the end of the tunnel.\n      Identification\n               A 64-bit number,\
    \ constructed by the mobile node, used for\n               matching Registration\
    \ Requests with Registration Replies,\n               and for protecting against\
    \ replay attacks of registration\n               messages.  See Sections 5.4 and\
    \ 5.6.\n      Extensions\n               The fixed portion of the Registration\
    \ Request is followed\n               by one or more of the Extensions listed\
    \ in Section 3.5.\n               The Mobile-Home Authentication Extension MUST\
    \ be included\n               in all Registration Requests.  See Sections 3.6.1.3\n\
    \               and  3.7.2.2 for information on the relative order in\n      \
    \         which different extensions, when present, MUST be placed\n         \
    \      in a Registration Request message.\n"
- title: 3.4. Registration Reply
  contents:
  - "3.4. Registration Reply\n   A mobility agent returns a Registration Reply message\
    \ to a mobile\n   node which has sent a Registration Request (Section 3.3) message.\
    \  If\n   the mobile node is requesting service from a foreign agent, that\n \
    \  foreign agent will receive the Reply from the home agent and\n   subsequently\
    \ relay it to the mobile node.  The Reply message contains\n   the necessary codes\
    \ to inform the mobile node about the status of its\n   Request, along with the\
    \ lifetime granted by the home agent, which MAY\n   be smaller than the original\
    \ Request.\n   The foreign agent MUST NOT increase the Lifetime selected by the\n\
    \   mobile node in the Registration Request, since the Lifetime is\n   covered\
    \ by the Mobile-Home Authentication Extension, which cannot be\n   correctly (re)computed\
    \ by the foreign agent.  The home agent MUST NOT\n   increase the Lifetime selected\
    \ by the mobile node in the Registration\n   Request, since doing so could increase\
    \ it beyond the maximum\n   Registration Lifetime allowed by the foreign agent.\
    \  If the Lifetime\n   received in the Registration Reply is greater than that\
    \ in the\n   Registration Request, the Lifetime in the Request MUST be used. \
    \ When\n   the Lifetime received in the Registration Reply is less than that in\n\
    \   the Registration Request, the Lifetime in the Reply MUST be used.\n   IP fields:\n\
    \      Source Address        Typically copied from the destination\n         \
    \                   address of the Registration Request to which\n           \
    \                 the agent is replying.  See Sections 3.7.2.3\n             \
    \               and 3.8.3.1 for complete details.\n      Destination Address \
    \  Copied from the source address of the\n                            Registration\
    \ Request to which the agent is\n                            replying\n   UDP\
    \ fields:\n      Source Port           <variable>\n      Destination Port    \
    \  Copied from the source port of the\n                            corresponding\
    \ Registration Request\n                            (Section 3.7.1).\n   The UDP\
    \ header is followed by the Mobile IP fields shown below:\n    0             \
    \      1                   2                   3\n    0 1 2 3 4 5 6 7 8 9 0 1\
    \ 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |     Type      |     Code      |           Lifetime            |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                          Home Address                         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                           Home Agent                          |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                                                               |\n   +  \
    \                       Identification                        +\n   |        \
    \                                                       |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   | Extensions ...\n   +-+-+-+-+-+-+-+-\n      Type     3 (Registration Reply)\n\
    \      Code     A value indicating the result of the Registration\n          \
    \     Request.  See below for a list of currently defined Code\n             \
    \  values.\n      Lifetime\n               If the Code field indicates that the\
    \ registration was\n               accepted, the Lifetime field is set to the\
    \ number of\n               seconds remaining before the registration is considered\n\
    \               expired.  A value of zero indicates that the mobile node\n   \
    \            has been deregistered.  A value of 0xffff indicates\n           \
    \    infinity.  If the Code field indicates that the\n               registration\
    \ was denied, the contents of the Lifetime\n               field are unspecified\
    \ and MUST be ignored on reception.\n      Home Address\n               The IP\
    \ address of the mobile node.\n      Home Agent\n               The IP address\
    \ of the mobile node's home agent.\n      Identification\n               A 64-bit\
    \ number used for matching Registration Requests\n               with Registration\
    \ Replies, and for protecting against\n               replay attacks of registration\
    \ messages.  The value is\n               based on the Identification field from\
    \ the Registration\n               Request message from the mobile node, and on\
    \ the style of\n               replay protection used in the security context\
    \ between\n               the mobile node and its home agent (defined by the\n\
    \               mobility security association between them, and SPI\n        \
    \       value in the Mobile-Home Authentication Extension).  See\n           \
    \    Sections 5.4 and 5.6.\n      Extensions\n               The fixed portion\
    \ of the Registration Reply is followed\n               by one or more of the\
    \ Extensions listed in Section 3.5.\n               The Mobile-Home Authentication\
    \ Extension MUST be included\n               in all Registration Replies returned\
    \ by the home agent.\n               See Sections 3.7.2.2 and 3.8.3.3 for rules\
    \ on placement\n               of extensions to Reply messages.\n   The following\
    \ values are defined for use within the Code field.\n   Registration successful:\n\
    \        0 registration accepted\n        1 registration accepted, but simultaneous\
    \ mobility\n          bindings unsupported\n   Registration denied by the foreign\
    \ agent:\n       64 reason unspecified\n       65 administratively prohibited\n\
    \       66 insufficient resources\n       67 mobile node failed authentication\n\
    \       68 home agent failed authentication\n       69 requested Lifetime too\
    \ long\n       70 poorly formed Request\n       71 poorly formed Reply\n     \
    \  72 requested encapsulation unavailable\n       73 requested Van Jacobson compression\
    \ unavailable\n       80 home network unreachable (ICMP error received)\n    \
    \   81 home agent host unreachable (ICMP error received)\n       82 home agent\
    \ port unreachable (ICMP error received)\n       88 home agent unreachable (other\
    \ ICMP error received)\n   Registration denied by the home agent:\n      128 reason\
    \ unspecified\n      129 administratively prohibited\n      130 insufficient resources\n\
    \      131 mobile node failed authentication\n      132 foreign agent failed authentication\n\
    \      133 registration Identification mismatch\n      134 poorly formed Request\n\
    \      135 too many simultaneous mobility bindings\n      136 unknown home agent\
    \ address\n   Up-to-date values of the Code field are specified in the most recent\n\
    \   \"Assigned Numbers\" [20].\n"
- title: 3.5. Registration Extensions
  contents:
  - '3.5. Registration Extensions

    '
- title: 3.5.1. Computing Authentication Extension Values
  contents:
  - "3.5.1. Computing Authentication Extension Values\n   The Authenticator value\
    \ computed for each authentication Extension\n   MUST protect the following fields\
    \ from the registration message:\n    -  the UDP payload (that is, the Registration\
    \ Request or\n       Registration Reply data),\n    -  all prior Extensions in\
    \ their entirety, and\n    -  the Type and Length of this Extension.\n   The default\
    \ authentication algorithm uses keyed-MD5 [21] in\n   \"prefix+suffix\" mode to\
    \ compute a 128-bit \"message digest\" of the\n   registration message.  The default\
    \ authenticator is a 128-bit value\n   computed as the MD5 checksum over the the\
    \ following stream of bytes:\n    -  the shared secret defined by the mobility\
    \ security association\n       between the nodes and by SPI value specified in\
    \ the\n       authentication Extension, followed by\n    -  the protected fields\
    \ from the registration message, in the order\n       specified above, followed\
    \ by\n    -  the shared secret again.\n   Note that the Authenticator field itself\
    \ and the UDP header are NOT\n   included in the computation of the default Authenticator\
    \ value.  See\n   Section 5.1 for information about support requirements for message\n\
    \   authentication codes, which are to be used with the various\n   authentication\
    \ Extensions.\n   The Security Parameter Index (SPI) within any of the authentication\n\
    \   Extensions defines the security context which is used to compute the\n   Authenticator\
    \ value and which MUST be used by the receiver to check\n   that value.  In particular,\
    \ the SPI selects the authentication\n   algorithm and mode (Section 5.1) and\
    \ secret (a shared key, or\n   appropriate public/private key pair) used in computing\
    \ the\n   Authenticator.  In order to ensure interoperability between different\n\
    \   implementations of the Mobile IP protocol, an implementation MUST be\n   able\
    \ to associate any SPI value with any authentication algorithm and\n   mode which\
    \ it implements.  In addition, all implementations of Mobile\n   IP MUST implement\
    \ the default authentication algorithm (keyed-MD5)\n   and mode (\"prefix+suffix\"\
    ) defined above.\n"
- title: 3.5.2. Mobile-Home Authentication Extension
  contents:
  - "3.5.2. Mobile-Home Authentication Extension\n   Exactly one Mobile-Home Authentication\
    \ Extension MUST be present in\n   all Registration Requests and Registration\
    \ Replies, and is intended\n   to eliminate problems [2] which result from the\
    \ uncontrolled\n   propagation of remote redirects in the Internet.  The location\
    \ of the\n   extension marks the end of the authenticated data.\n    0       \
    \            1                   2                   3\n    0 1 2 3 4 5 6 7 8\
    \ 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |     Type      |     Length    |         SPI  ....\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \          ... SPI (cont.)          |       Authenticator ...\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      Type            32\n      Length          4 plus the number of bytes in\
    \ the Authenticator.\n      SPI             Security Parameter Index (4 bytes).\
    \  An opaque\n                      identifier (see Section 1.6).\n      Authenticator\
    \   (variable length) (See Section 3.5.1.)\n"
- title: 3.5.3. Mobile-Foreign Authentication Extension
  contents:
  - "3.5.3. Mobile-Foreign Authentication Extension\n   This Extension MAY be included\
    \ in Registration Requests and Replies\n   in cases in which a mobility security\
    \ association exists between the\n   mobile node and the foreign agent.  See Section\
    \ 5.1 for information\n   about support requirements for message authentication\
    \ codes.\n    0                   1                   2                   3\n\
    \    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |     Type      |     Length    |         SPI  ....\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \          ... SPI (cont.)          |       Authenticator ...\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      Type            33\n      Length          4 plus the number of bytes in\
    \ the Authenticator.\n      SPI             Security Parameter Index (4 bytes).\
    \  An opaque\n                      identifier (see Section 1.6).\n      Authenticator\
    \   (variable length) (See Section 3.5.1.)\n"
- title: 3.5.4. Foreign-Home Authentication Extension
  contents:
  - "3.5.4. Foreign-Home Authentication Extension\n   This Extension MAY be included\
    \ in Registration Requests and Replies\n   in cases in which a mobility security\
    \ association exists between the\n   foreign agent and the home agent.  See Section\
    \ 5.1 for information\n   about support requirements for message authentication\
    \ codes.\n    0                   1                   2                   3\n\
    \    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |     Type      |     Length    |         SPI  ....\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \          ... SPI (cont.)          |       Authenticator ...\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      Type            34\n      Length          4 plus the number of bytes in\
    \ the Authenticator.\n      SPI             Security Parameter Index (4 bytes).\
    \  An opaque\n                      identifier (see Section 1.6).\n      Authenticator\
    \   (variable length) (See Section 3.5.1.)\n"
- title: 3.6. Mobile Node Considerations
  contents:
  - "3.6. Mobile Node Considerations\n   A mobile node MUST be configured with its\
    \ home address, a netmask,\n   and a mobility security association for each home\
    \ agent.  In\n   addition, a mobile node MAY be configured with the IP address\
    \ of one\n   or more of its home agents; otherwise, the mobile node MAY discover\
    \ a\n   home agent using the procedures described in Section 3.6.1.2.\n   For\
    \ each pending registration, the mobile node maintains the\n   following information:\n\
    \    - the link-layer address of the foreign agent to which the\n      Registration\
    \ Request was sent, if applicable,\n    - the IP destination address of the Registration\
    \ Request,\n    - the care-of address used in the registration,\n    - the Identification\
    \ value sent in the registration,\n    - the originally requested Lifetime, and\n\
    \    - the remaining Lifetime of the pending registration.\n   A mobile node SHOULD\
    \ initiate a registration whenever it detects a\n   change in its network connectivity.\
    \  See Section 2.4.2 for methods by\n   which mobile nodes MAY make such a determination.\
    \  When it is away\n   from home, the mobile node's Registration Request allows\
    \ its home\n   agent to create or modify a mobility binding for it.  When it is\
    \ at\n   home, the mobile node's (de)Registration Request allows its home\n  \
    \ agent to delete any previous mobility binding(s) for it.  A mobile\n   node\
    \ operates without the support of mobility functions when it is at\n   home.\n\
    \   There are other conditions under which the mobile node SHOULD\n   (re)register\
    \ with its foreign agent, such as when the mobile node\n   detects that the foreign\
    \ agent has rebooted (as specified in Section\n   2.4.4) and when the current\
    \ registration's Lifetime is near\n   expiration.\n   In the absence of link-layer\
    \ indications of changes in point of\n   attachment, Agent Advertisements from\
    \ new agents SHOULD NOT cause a\n   mobile node to attempt a new registration,\
    \ if its current\n   registration has not expired and it is still also receiving\
    \ Agent\n   Advertisements from the foreign agent with which it is currently\n\
    \   registered.  In the absence of link-layer indications, a mobile node\n   MUST\
    \ NOT attempt to register more often than once per second.\n   A mobile node MAY\
    \ register with a different agent when transport-\n   layer protocols indicate\
    \ excessive retransmissions.  A mobile node\n   MUST NOT consider reception of\
    \ an ICMP Redirect from a foreign agent\n   that is currently providing service\
    \ to it as reason to register with\n   a new foreign agent.  Within these constraints,\
    \ the mobile node MAY\n   register again at any time.\n   Appendix D shows some\
    \ examples of how the fields in registration\n   messages would be set up in some\
    \ typical registration scenarios.\n"
- title: 3.6.1. Sending Registration Requests
  contents:
  - "3.6.1. Sending Registration Requests\n   The following sections specify details\
    \ for the values the mobile node\n   MUST supply in the fields of Registration\
    \ Request messages.\n"
- title: 3.6.1.1. IP Fields
  contents:
  - "3.6.1.1. IP Fields\n   This section provides the specific rules by which mobile\
    \ nodes pick\n   values for the IP header fields of a Registration Request.\n\
    \   IP Source Address:\n    -  When registering on a foreign network with a co-located\
    \ care-of\n       address, the IP source address MUST be the care-of address.\n\
    \    -  In all other circumstances, the IP source address MUST be the\n      \
    \ mobile node's home address.\n   IP Destination Address:\n    -  When the mobile\
    \ node has discovered the agent with which it is\n       registering, through\
    \ some means (e.g., link-layer) that does not\n       provide the IP address of\
    \ the agent (the IP address of the agent\n       is unknown to the mobile node),\
    \ then the \"All Mobility Agents\"\n       multicast address (224.0.0.11) MUST\
    \ be used.  In this case, the\n       mobile node MUST use the agent's link-layer\
    \ unicast address in\n       order to deliver the datagram to the correct agent.\n\
    \    -  When registering with a foreign agent, the address of the agent\n    \
    \   as learned from the IP source address of the corresponding Agent\n       Advertisement\
    \ MUST be used.  In addition, when transmitting\n       this Registration Request\
    \ message, the mobile node MUST use a\n       link-layer destination address copied\
    \ from the link-layer source\n       address of the Agent Advertisement message\
    \ in which it learned\n       this foreign agent's IP address.\n    -  When the\
    \ mobile node is registering directly with its home\n       agent and knows the\
    \ (unicast) IP address of its home agent, the\n       destination address MUST\
    \ be set to this address.\n    -  If the mobile node is registering directly with\
    \ its home\n       agent, but does not know the IP address of its home agent,\n\
    \       the mobile node may use dynamic home agent address resolution\n      \
    \ to automatically determine the IP address of its home agent\n       (Section\
    \ 3.6.1.2).  In this case, the IP destination address is\n       set to the subnet-directed\
    \ broadcast address of the mobile node's\n       home network.  This address MUST\
    \ NOT be used as the destination\n       IP address if the mobile node is registering\
    \ via a foreign agent,\n       although it MAY be used as the Home Agent address\
    \ in the body of\n       the Registration Request when registering via a foreign\
    \ agent.\n   IP Time to Live:\n    -  The IP TTL field MUST be set to 1 if the\
    \ IP destination address\n       is set to the \"All Mobility Agents\" multicast\
    \ address as\n       described above.  Otherwise a suitable value should be chosen\
    \ in\n       accordance with standard IP practice [19].\n"
- title: 3.6.1.2. Registration Request Fields
  contents:
  - "3.6.1.2. Registration Request Fields\n   This section provides specific rules\
    \ by which mobile nodes pick\n   values for the fields within the fixed portion\
    \ of a Registration\n   Request.\n   A mobile node MAY set the 'S' bit in order\
    \ to request that the home\n   agent maintain prior mobility binding(s).  Otherwise,\
    \ the home agent\n   deletes any previous binding(s) and replaces them with the\
    \ new\n   binding specified in the Registration Request.  Multiple simultaneous\n\
    \   mobility bindings are likely to be useful when a mobile node using at\n  \
    \ least one wireless network interface moves within wireless\n   transmission\
    \ range of more than one foreign agent.  IP explicitly\n   allows duplication\
    \ of datagrams.  When the home agent allows\n   simultaneous bindings, it will\
    \ tunnel a separate copy of each\n   arriving datagram to each care-of address,\
    \ and the mobile node will\n   receive multiple copies of datagrams destined to\
    \ it.\n   The mobile node SHOULD set the 'D' bit if it is registering with a\n\
    \   co-located care-of address.  Otherwise, the 'D' bit MUST NOT be set.\n   A\
    \ mobile node MAY set the 'B' bit to request its home agent to\n   forward to\
    \ it, a copy of broadcast datagrams received by its home\n   agent from the home\
    \ network.  The method used by the home agent to\n   forward broadcast datagrams\
    \ depends on the type of care-of address\n   registered by the mobile node, as\
    \ determined by the 'D' bit in the\n   mobile node's Registration Request:\n \
    \   -  If the 'D' bit is set, then the mobile node has indicated that it\n   \
    \    will decapsulate any datagrams tunneled to this care-of address\n       itself\
    \ (the mobile node is using a co-located care-of address).\n       In this case,\
    \ to forward such a received broadcast datagram to\n       the mobile node, the\
    \ home agent MUST tunnel it to this care-of\n       address.  The mobile node\
    \ de-tunnels the received datagram in the\n       same way as any other datagram\
    \ tunneled directly to it.\n    -  If the 'D' bit is NOT set, then the mobile\
    \ node has indicated\n       that it is using a foreign agent care-of address,\
    \ and that the\n       foreign agent will thus decapsulate arriving datagrams\
    \ before\n       forwarding them to the mobile node.  In this case, to forward\n\
    \       such a received broadcast datagram to the mobile node, the home\n    \
    \   agent MUST first encapsulate the broadcast datagram in a unicast\n       datagram\
    \ addressed to the mobile node's home address, and then\n       MUST tunnel this\
    \ resulting datagram to the mobile node's care-of\n       address.\n      When\
    \ decapsulated by the foreign agent, the inner datagram will\n      thus be a\
    \ unicast IP datagram addressed to the mobile node,\n      identifying to the\
    \ foreign agent the intended destination of the\n      encapsulated broadcast\
    \ datagram, and will be delivered to the\n      mobile node in the same way as\
    \ any tunneled datagram arriving for\n      the mobile node.  The foreign agent\
    \ MUST NOT decapsulate the\n      encapsulated broadcast datagram and MUST NOT\
    \ use a local network\n      broadcast to transmit it to the mobile node.  The\
    \ mobile node thus\n      MUST decapsulate the encapsulated broadcast datagram\
    \ itself, and\n      thus MUST NOT set the 'B' bit in its Registration Request\
    \ in this\n      case unless it is capable of decapsulating datagrams.\n   The\
    \ mobile node MAY request alternative forms of encapsulation by\n   setting the\
    \ 'M' bit and/or the 'G' bit, but only if the mobile node\n   is decapsulating\
    \ its own datagrams (the mobile node is using a co-\n   located care-of address)\
    \ or if its foreign agent has indicated\n   support for these forms of encapsulation\
    \ by setting the corresponding\n   bits in the Mobility Agent Advertisement Extension\
    \ of an Agent\n   Advertisement received by the mobile node.  Otherwise, the mobile\n\
    \   node MUST NOT set these bits.\n   The Lifetime field is chosen as follows:\n\
    \    -  If the mobile node is registering with a foreign agent, the\n       Lifetime\
    \ SHOULD NOT exceed the value in the Registration Lifetime\n       field of the\
    \ Agent Advertisement message received from the\n       foreign agent.  When the\
    \ method by which the care-of address is\n       learned does not include a Lifetime,\
    \ the default ICMP Router\n       Advertisement Lifetime (1800 seconds) MAY be\
    \ used.\n    -  The mobile node MAY ask a home agent to delete a particular\n\
    \       mobility binding, by sending a Registration Request with the\n       care-of\
    \ address for this binding, with the Lifetime field set to\n       zero (Section\
    \ 3.8.2).\n    -  Similarly, a Lifetime of zero is used when the mobile node\n\
    \       deregisters all care-of addresses, such as upon returning home.\n   The\
    \ Home Agent field MUST be set to the address of the mobile node's\n   home agent,\
    \ if the mobile node knows this address.  Otherwise, the\n   mobile node MAY use\
    \ dynamic home agent address resolution to learn\n   the address of its home agent.\
    \  In this case, the mobile node MUST\n   set the Home Agent field to the subnet-directed\
    \ broadcast address of\n   the mobile node's home network.  Each home agent receiving\
    \ such a\n   Registration Request with a broadcast destination address MUST reject\n\
    \   the mobile node's registration and SHOULD return a rejection\n   Registration\
    \ Reply indicating its unicast IP address for use by the\n   mobile node in a\
    \ future registration attempt.\n   The Care-of Address field MUST be set to the\
    \ value of the particular\n   care-of address that the mobile node wishes to (de)register.\
    \  In the\n   special case in which a mobile node wishes to deregister all care-of\n\
    \   addresses, it MUST set this field to its home address.\n   The mobile node\
    \ chooses the Identification field in accordance with\n   the style of replay\
    \ protection it uses with its home agent.  This is\n   part of the mobility security\
    \ association the mobile node shares with\n   its home agent.  See Section 5.6\
    \ for the method by which the mobile\n   node computes the Identification field.\n"
- title: 3.6.1.3. Extensions
  contents:
  - "3.6.1.3. Extensions\n   This section describes the ordering of any mandatory\
    \ and any optional\n   Extensions that a mobile node appends to a Registration\
    \ Request.\n   This following ordering MUST be followed:\n      a)   The IP header,\
    \ followed by the UDP header, followed by the\n           fixed-length portion\
    \ of the Registration Request, followed by\n      b)   If present, any non-authentication\
    \ Extensions expected to be\n           used by the home agent (which may or may\
    \ not also be used by\n           the foreign agent), followed by\n      c)  \
    \ The Mobile-Home Authentication Extension, followed by\n      d)   If present,\
    \ any non-authentication Extensions used only by\n           the foreign agent,\
    \ followed by\n      e)   The Mobile-Foreign Authentication Extension, if present.\n\
    \   Note that items (a) and (c) MUST appear in every Registration Request\n  \
    \ sent by the mobile node.  Items (b), (d), and (e) are optional.\n   However,\
    \ item (e) MUST be included when the mobile node and the\n   foreign agent share\
    \ a mobility security association.\n"
- title: 3.6.2. Receiving Registration Replies
  contents:
  - "3.6.2. Receiving Registration Replies\n   Registration Replies will be received\
    \ by the mobile node in response\n   to its Registration Requests.  Registration\
    \ Replies generally fall\n   into three categories:\n    - the registration was\
    \ accepted,\n    - the registration was denied by the foreign agent, or\n    -\
    \ the registration was denied by the home agent.\n   The remainder of this section\
    \ describes the Registration Reply\n   handling by a mobile node in each of these\
    \ three categories.\n"
- title: 3.6.2.1. Validity Checks
  contents:
  - "3.6.2.1. Validity Checks\n   Registration Replies with an invalid, non-zero UDP\
    \ checksum MUST be\n   silently discarded.\n   In addition, the low-order 32 bits\
    \ of the Identification field in the\n   Registration Reply MUST be compared to\
    \ the low-order 32 bits of the\n   Identification field in the most recent Registration\
    \ Request sent to\n   the replying agent.  If they do not match, the Reply MUST\
    \ be silently\n   discarded.\n   Also, the authentication in the Registration\
    \ Reply MUST be checked.\n   That is, the mobile node MUST check for the presence\
    \ of a valid\n   authentication Extension, acting in accordance with the Code\
    \ field in\n   the Reply.  The rules are as follows:\n      a)   If the mobile\
    \ node and the foreign agent share a\n           mobility security association,\
    \ exactly one Mobile-Foreign\n           Authentication Extension MUST be present\
    \ in the Registration\n           Reply, and the mobile node MUST check the Authenticator\n\
    \           value in the Extension.  If no Mobile-Foreign Authentication\n   \
    \        Extension is found, or if more than one Mobile-Foreign\n           Authentication\
    \ Extension is found, or if the Authenticator is\n           invalid, the mobile\
    \ node MUST silently discard the Reply and\n           SHOULD log the event as\
    \ a security exception.\n      b)   If the Code field indicates that service is\
    \ denied by\n           the home agent, or if the Code field indicates that the\n\
    \           registration was accepted by the home agent, exactly one\n       \
    \    Mobile-Home Authentication Extension MUST be present in\n           the Registration\
    \ Reply, and the mobile node MUST check the\n           Authenticator value in\
    \ the Extension.  If no Mobile-Home\n           Authentication Extension is found,\
    \ or if more than one\n           Mobile-Home Authentication Extension is found,\
    \ or if the\n           Authenticator is invalid, the mobile node MUST silently\n\
    \           discard the Reply and SHOULD log the event as a security\n       \
    \    exception.\n   If the Code field indicates an authentication failure, either\
    \ at the\n   foreign agent or the home agent, then it is quite possible that any\n\
    \   authenticators in the Registration Reply will also be in error.  This\n  \
    \ could happen, for example, if the shared secret between the mobile\n   node\
    \ and home agent was erroneously configured.  The mobile node\n   SHOULD log such\
    \ errors as security exceptions.\n"
- title: 3.6.2.2. Registration Request Accepted
  contents:
  - "3.6.2.2. Registration Request Accepted\n   If the Code field indicates that the\
    \ request has been accepted, the\n   mobile node SHOULD configure its routing\
    \ table appropriately for its\n   current point of attachment (Section 4.2.1).\n\
    \   If the mobile node is returning to its home network and that network\n   is\
    \ one which implements ARP, the mobile node MUST follow the\n   procedures described\
    \ in Section 4.6 with regard to ARP, proxy ARP,\n   and gratuitous ARP.\n   If\
    \ the mobile node has registered on a foreign network, it SHOULD\n   re-register\
    \ before the expiration of the Lifetime of its\n   registration.  As described\
    \ in Section 3.6, for each pending\n   Registration Request, the mobile node MUST\
    \ maintain the remaining\n   lifetime of this pending registration, as well as\
    \ the original\n   Lifetime from the Registration Request.  When the mobile node\n\
    \   receives a valid Registration Reply, the mobile node MUST decrease\n   its\
    \ view of the remaining lifetime of the registration by the amount\n   by which\
    \ the home agent decreased the originally requested Lifetime.\n   This procedure\
    \ is equivalent to the mobile node starting a timer for\n   the granted Lifetime\
    \ at the time it sent the Registration Request,\n   even though the granted Lifetime\
    \ is not known to the mobile node\n   until the Registration Reply is received.\
    \  Since the Registration\n   Request is certainly sent before the home agent\
    \ begins timing the\n   registration Lifetime (also based on the granted Lifetime),\
    \ this\n   procedure ensures that the mobile node will re-register before the\n\
    \   home agent expires and deletes the registration, in spite of possibly\n  \
    \ non-negligible transmission delays for the original Registration\n   Request\
    \ and Reply that started the timing of the Lifetime at the\n   mobile node and\
    \ its home agent.\n"
- title: 3.6.2.3. Registration Request Denied
  contents:
  - "3.6.2.3. Registration Request Denied\n   If the Code field indicates that service\
    \ is being denied, the mobile\n   node SHOULD log the error.  In certain cases\
    \ the mobile node may be\n   able to \"repair\" the error.  These include:\n \
    \     Code 69:  (Denied by foreign agent, Lifetime too long)\n         In this\
    \ case, the Lifetime field in the Registration Reply will\n         contain the\
    \ maximum Lifetime value which that foreign agent is\n         willing to accept\
    \ in any Registration Request.  The mobile node\n         MAY attempt to register\
    \ with this same agent, using a Lifetime\n         in the Registration Request\
    \ that MUST be less than or equal to\n         the value specified in the Reply.\n\
    \      Code 133:  (Denied by home agent, Identification mismatch)\n         In\
    \ this case, the Identification field in the Registration\n         Reply will\
    \ contain a value that allows the mobile node to\n         synchronize with the\
    \ home agent, based upon the style of replay\n         protection in effect (Section\
    \ 5.6).  The mobile node MUST\n         adjust the parameters it uses to compute\
    \ the Identification\n         field based upon the information in the Registration\
    \ Reply,\n         before issuing any future Registration Requests.\n      Code\
    \ 136:  (Denied by home agent, Unknown home agent address)\n         This code\
    \ is returned by a home agent when the mobile node is\n         performing dynamic\
    \ home agent address resolution as described\n         in Sections 3.6.1.1 and\
    \ 3.6.1.2.  In this case, the Home Agent\n         field within the Reply will\
    \ contain the unicast IP address of\n         the home agent returning the Reply.\
    \  The mobile node MAY then\n         attempt to register with this home agent\
    \ in future Registration\n         Requests.  In addition, the mobile node SHOULD\
    \ adjust the\n         parameters it uses to compute the Identification field\
    \ based\n         upon the corresponding field in the Registration Reply, before\n\
    \         issuing any future Registration Requests.\n"
- title: 3.6.3. Registration Retransmission
  contents:
  - "3.6.3. Registration Retransmission\n   When no Registration Reply has been received\
    \ within a reasonable\n   time, another Registration Request MAY be transmitted.\
    \  When\n   timestamps are used, a new registration Identification is chosen for\n\
    \   each retransmission; thus it counts as a new registration.  When\n   nonces\
    \ are used, the unanswered Request is retransmitted unchanged;\n   thus the retransmission\
    \ does not count as a new registration (Section\n   5.6).  In this way a retransmission\
    \ will not require the home agent\n   to resynchronize with the mobile node by\
    \ issuing another nonce in the\n   case in which the original Registration Request\
    \ (rather than its\n   Registration Reply) was lost by the network.\n   The maximum\
    \ time until a new Registration Request is sent SHOULD be\n   no greater than\
    \ the requested Lifetime of the Registration Request.\n   The minimum value SHOULD\
    \ be large enough to account for the size of\n   the messages, twice the round\
    \ trip time for transmission to the home\n   agent, and at least an additional\
    \ 100 milliseconds to allow for\n   processing the messages before responding.\
    \  The round trip time for\n   transmission to the home agent will be at least\
    \ as large as the time\n   required to transmit the messages at the link speed\
    \ of the mobile\n   node's current point of attachment.  Some circuits add another\
    \ 200\n   milliseconds of satellite delay in the total round trip time to the\n\
    \   home agent.  The minimum time between Registration Requests MUST NOT\n   be\
    \ less than 1 second.  Each successive retransmission timeout period\n   SHOULD\
    \ be at least twice the previous period, as long as that is less\n   than the\
    \ maximum as specified above.\n"
- title: 3.7. Foreign Agent Considerations
  contents:
  - "3.7. Foreign Agent Considerations\n   The foreign agent plays a mostly passive\
    \ role in Mobile IP\n   registration.  It relays Registration Requests between\
    \ mobile nodes\n   and home agents, and, when it provides the care-of address,\n\
    \   decapsulates datagrams for delivery to the mobile node.  It SHOULD\n   also\
    \ send periodic Agent Advertisement messages to advertise its\n   presence as\
    \ described in Section 2.3, if not detectable by link-layer\n   means.\n   A foreign\
    \ agent MUST NOT transmit a Registration Request except when\n   relaying a Registration\
    \ Request received from a mobile node, to the\n   mobile node's home agent.  A\
    \ foreign agent MUST NOT transmit a\n   Registration Reply except when relaying\
    \ a Registration Reply received\n   from a mobile node's home agent, or when replying\
    \ to a Registration\n   Request received from a mobile node in the case in which\
    \ the foreign\n   agent is denying service to the mobile node.  In particular,\
    \ a\n   foreign agent MUST NOT generate a Registration Request or Reply\n   because\
    \ a mobile node's registration Lifetime has expired.  A foreign\n   agent also\
    \ MUST NOT originate a Registration Request message that\n   asks for deregistration\
    \ of a mobile node; however, it MUST relay\n   valid (de)Registration Requests\
    \ originated by a mobile node.\n"
- title: 3.7.1. Configuration and Registration Tables
  contents:
  - "3.7.1. Configuration and Registration Tables\n   Each foreign agent MUST be configured\
    \ with a care-of address.  In\n   addition, for each pending or current registration,\
    \ the foreign agent\n   MUST maintain a visitor list entry containing the following\n\
    \   information obtained from the mobile node's Registration Request:\n    - the\
    \ link-layer source address of the mobile node\n    - the IP Source Address (the\
    \ mobile node's Home Address)\n    - the IP Destination Address (as specified\
    \ in 3.6.2.3)\n    - the UDP Source Port\n    - the Home Agent address\n    -\
    \ the Identification field\n    - the requested registration Lifetime, and\n \
    \   - the remaining Lifetime of the pending or current registration.\n   As with\
    \ any node on the Internet, a foreign agent MAY also share\n   mobility security\
    \ associations with any other nodes.  When relaying a\n   Registration Request\
    \ from a mobile node to its home agent, if the\n   foreign agent shares a mobility\
    \ security association with the home\n   agent, it MUST add a Foreign-Home Authentication\
    \ Extension to the\n   Request and MUST check the required Foreign-Home Authentication\n\
    \   Extension in the Registration Reply from the home agent (Sections 3.3\n  \
    \ and 3.4).  Similarly, when receiving a Registration Request from a\n   mobile\
    \ node, if the foreign agent shares a mobility security\n   association with the\
    \ mobile node, it MUST check the required Mobile-\n   Foreign Authentication Extension\
    \ in the Request and MUST add a\n   Mobile-Foreign Authentication Extension to\
    \ the Registration Reply to\n   the mobile node.\n"
- title: 3.7.2. Receiving Registration Requests
  contents:
  - "3.7.2. Receiving Registration Requests\n   If the foreign agent accepts a Registration\
    \ Request from a mobile\n   node, it then MUST relay the Request to the indicated\
    \ home agent.\n   Otherwise, if the foreign agent denies the Request, it MUST\
    \ send a\n   Registration Reply to the mobile node with an appropriate denial\n\
    \   Code, except in cases where the foreign agent would be required to\n   send\
    \ out more than one such denial per second to the same mobile\n   node.  The following\
    \ sections describe this behavior in more detail.\n   If a foreign agent receives\
    \ a Registration Request from a mobile node\n   in its visitor list, the existing\
    \ visitor list entry for the mobile\n   node SHOULD NOT be deleted or modified\
    \ until the foreign agent\n   receives a valid Registration Reply from the home\
    \ agent with a Code\n   indicating success.  The foreign agent MUST record the\
    \ new pending\n   Request separately from the existing visitor list entry for\
    \ the\n   mobile node.  If the Registration Request requests deregistration,\n\
    \   the existing visitor list entry for the mobile node SHOULD NOT be\n   deleted\
    \ until the foreign agent has received a successful\n   Registration Reply.  If\
    \ the Registration Reply indicates that the\n   Request (for registration or deregistration)\
    \ was denied by the home\n   agent, the existing visitor list entry for the mobile\
    \ node MUST NOT\n   be modified as a result of receiving the Registration Reply.\n"
- title: 3.7.2.1. Validity Checks
  contents:
  - "3.7.2.1. Validity Checks\n   Registration Requests with an invalid, non-zero\
    \ UDP checksum MUST be\n   silently discarded.\n   Also, the authentication in\
    \ the Registration Request MUST be checked.\n   If the foreign agent and the mobile\
    \ node share a mobility security\n   association, exactly one Mobile-Foreign Authentication\
    \ Extension MUST\n   be present in the Registration Request, and the foreign agent\
    \ MUST\n   check the Authenticator value in the Extension.  If no Mobile-Foreign\n\
    \   Authentication Extension is found, or if more than one Mobile-Foreign\n  \
    \ Authentication Extension is found, or if the Authenticator is\n   invalid, the\
    \ foreign agent MUST silently discard the Request and\n   SHOULD log the event\
    \ as a security exception.  The foreign agent also\n   SHOULD send a Registration\
    \ Reply to the mobile node with Code 67.\n"
- title: 3.7.2.2. Forwarding a Valid Request to the Home Agent
  contents:
  - "3.7.2.2. Forwarding a Valid Request to the Home Agent\n   If the foreign agent\
    \ accepts the mobile node's Registration Request,\n   it MUST relay the Request\
    \ to the mobile node's home agent as\n   specified in the Home Agent field of\
    \ the Registration Request.  The\n   foreign agent MUST NOT modify any of the\
    \ fields beginning with the\n   fixed portion of the Registration Request up through\
    \ and including\n   the Mobile-Home Authentication Extension.  Otherwise, an\n\
    \   authentication failure is very likely to occur at the home agent.  In\n  \
    \ addition, the foreign agent proceeds as follows:\n    - It MUST process and\
    \ remove any Extensions following the\n      Mobile-Home Authentication Extension,\n\
    \    - It MAY append any of its own non-authentication Extensions of\n      relevance\
    \ to the home agent, if applicable, and\n    - It MUST append the Foreign-Home\
    \ Authentication Extension, if the\n      foreign agent shares a mobility security\
    \ association with the home\n      agent.\n   Specific fields within the IP header\
    \ and the UDP header of the\n   relayed Registration Request MUST be set as follows:\n\
    \      IP Source Address\n               The foreign agent's address on the interface\
    \ from which\n               the message will be sent.\n      IP Destination Address\n\
    \               Copied from the Home Agent field within the Registration\n   \
    \            Request.\n      UDP Source Port\n               <variable>\n    \
    \  UDP Destination Port\n               434\n   After forwarding a valid Registration\
    \ Request to the home agent, the\n   foreign agent MUST begin timing the remaining\
    \ lifetime of the pending\n   registration based on the Lifetime in the Registration\
    \ Request.  If\n   this lifetime expires before receiving a valid Registration\
    \ Reply,\n   the foreign agent MUST delete its visitor list entry for this pending\n\
    \   registration.\n"
- title: 3.7.2.3. Denying Invalid Requests
  contents:
  - "3.7.2.3. Denying Invalid Requests\n   If the foreign agent denies the mobile\
    \ node's Registration Request\n   for any reason, it SHOULD send the mobile node\
    \ a Registration Reply\n   with a suitable denial Code.  In such a case, the Home\
    \ Address, Home\n   Agent, and Identification fields within the Registration Reply\
    \ are\n   copied from the corresponding fields of the Registration Request.\n\
    \   If the Reserved field is nonzero, the foreign agent MUST deny the\n   Request\
    \ and SHOULD return a Registration Reply with status code 70 to\n   the mobile\
    \ node.  If the Request is being denied because the\n   requested Lifetime is\
    \ too long, the foreign agent sets the Lifetime\n   in the Reply to the maximum\
    \ Lifetime value it is willing to accept in\n   any Registration Request, and\
    \ sets the Code field to 69.  Otherwise,\n   the Lifetime SHOULD be copied from\
    \ the Lifetime field in the Request.\n   Specific fields within the IP header\
    \ and the UDP header of the\n   Registration Reply MUST be set as follows:\n \
    \     IP Source Address\n               Copied from the IP Destination Address\
    \ of Registration\n               Request, unless the \"All Agents Multicast\"\
    \ address was\n               used.  In this case, the foreign agent's address\
    \ (on the\n               interface from which the message will be sent) MUST\
    \ be\n               used.\n      IP Destination Address\n               Copied\
    \ from the IP Source Address of the Registration\n               Request.\n  \
    \    UDP Source Port\n               434\n      UDP Destination Port\n       \
    \        Copied from the UDP Source Port of the Registration\n               Request.\n"
- title: 3.7.3. Receiving Registration Replies
  contents:
  - "3.7.3. Receiving Registration Replies\n   The foreign agent updates its visitor\
    \ list when it receives a valid\n   Registration Reply from a home agent.  It\
    \ then relays the\n   Registration Reply to the mobile node.  The following sections\n\
    \   describe this behavior in more detail.\n   If upon relaying a Registration\
    \ Request to a home agent, the foreign\n   agent receives an ICMP error message\
    \ instead of a Registration Reply,\n   then the foreign agent SHOULD send to the\
    \ mobile node a Registration\n   Reply with an appropriate \"Home Agent Unreachable\"\
    \ failure Code\n   (within the range 80-95, inclusive).  See Section 3.7.2.3 for\
    \ details\n   on building the Registration Reply.\n"
- title: 3.7.3.1. Validity Checks
  contents:
  - "3.7.3.1. Validity Checks\n   Registration Replies with an invalid, non-zero UDP\
    \ checksum MUST be\n   silently discarded.\n   When a foreign agent receives a\
    \ Registration Reply message, it MUST\n   search its visitor list for a pending\
    \ Registration Request with the\n   same mobile node home address as indicated\
    \ in the Reply.  If no\n   pending Request is found, the foreign agent MUST silently\
    \ discard the\n   Reply.  The foreign agent MUST also silently discard the Reply\
    \ if the\n   low-order 32 bits of the Identification field in the Reply do not\n\
    \   match those in the Request.\n   Also, the authentication in the Registration\
    \ Reply MUST be checked.\n   If the foreign agent and the home agent share a mobility\
    \ security\n   association, exactly one Foreign-Home Authentication Extension\
    \ MUST\n   be present in the Registration Reply, and the foreign agent MUST\n\
    \   check the Authenticator value in the Extension.  If no Foreign-Home\n   Authentication\
    \ Extension is found, or if more than one Foreign-Home\n   Authentication Extension\
    \ is found, or if the Authenticator is\n   invalid, the foreign agent MUST silently\
    \ discard the Reply and SHOULD\n   log the event as a security exception.  The\
    \ foreign agent also MUST\n   reject the mobile node's registration and SHOULD\
    \ send a Registration\n   Reply to the mobile node with Code 68.\n"
- title: 3.7.3.2. Forwarding Replies to the Mobile Node
  contents:
  - "3.7.3.2. Forwarding Replies to the Mobile Node\n   A Registration Reply which\
    \ satisfies the validity checks of Section\n   3.8.2.1 is relayed to the mobile\
    \ node.  The foreign agent MUST also\n   update its visitor list entry for the\
    \ mobile node to reflect the\n   results of the Registration Request, as indicated\
    \ by the Code field\n   in the Reply.  If the Code indicates that the mobile node\
    \ has\n   accepted the registration and the Lifetime field is nonzero, the\n \
    \  foreign agent MUST set the Lifetime in the visitor list entry to the\n   value\
    \ specified in the Lifetime field of the Registration Reply.  If,\n   instead,\
    \ the Code indicates that the Lifetime field is zero, the\n   foreign agent MUST\
    \ delete its visitor list entry for the mobile node.\n   Finally, if the Code\
    \ indicates that the registration was denied by\n   the home agent, the foreign\
    \ agent MUST delete its pending\n   registration list entry, but not its visitor\
    \ list entry, for the\n   mobile node.\n   The foreign agent MUST NOT modify any\
    \ of the fields beginning with\n   the fixed portion of the Registration Reply\
    \ up through and including\n   the Mobile-Home Authentication Extension.  Otherwise,\
    \ an\n   authentication failure is very likely to occur at the mobile node.\n\
    \   In addition, the foreign agent SHOULD perform the following\n   additional\
    \ procedures:\n    - It MUST process and remove any Extensions following the\n\
    \      Mobile-Home Authentication Extension,\n    - It MAY append its own non-authentication\
    \ Extensions of relevance\n      to the mobile node, if applicable, and\n    -\
    \ It MUST append the Mobile-Foreign Authentication Extension, if\n      the foreign\
    \ agent shares a mobility security association with the\n      mobile node.\n\
    \   Specific fields within the IP header and the UDP header of the\n   relayed\
    \ Registration Reply are set according to the same rules\n   specified in Section\
    \ 3.7.2.3.\n   After forwarding a valid Registration Reply to the mobile node,\
    \ the\n   foreign agent MUST update its visitor list entry for this\n   registration\
    \ as follows.  If the Registration Reply indicates that\n   the registration was\
    \ accepted by the home agent, the foreign agent\n   resets its timer of the lifetime\
    \ of the registration to the Lifetime\n   granted in the Registration Reply; unlike\
    \ the mobile node's timing of\n   the registration lifetime as described in Section\
    \ 3.6.2.2, the\n   foreign agent considers this lifetime to begin when it forwards\
    \ the\n   Registration Reply message, ensuring that the foreign agent will not\n\
    \   expire the registration before the mobile node does.  On the other\n   hand,\
    \ if the Registration Reply indicates that the registration was\n   rejected by\
    \ the home agent, the foreign agent deletes its visitor\n   list entry for this\
    \ attempted registration.\n"
- title: 3.8. Home Agent Considerations
  contents:
  - "3.8. Home Agent Considerations\n   Home agents play a reactive role in the registration\
    \ process.  The\n   home agent receives Registration Requests from the mobile\
    \ node\n   (perhaps relayed by a foreign agent), updates its record of the\n \
    \  mobility bindings for this mobile node, and issues a suitable\n   Registration\
    \ Reply in response to each.\n   A home agent MUST NOT transmit a Registration\
    \ Reply except when\n   replying to a Registration Request received from a mobile\
    \ node.  In\n   particular, the home agent MUST NOT generate a Registration Reply\
    \ to\n   indicate that the Lifetime has expired.\n"
- title: 3.8.1. Configuration and Registration Tables
  contents:
  - "3.8.1. Configuration and Registration Tables\n   Each home agent MUST be configured\
    \ with an IP address and with the\n   prefix size for the home network.  The home\
    \ agent MUST be configured\n   with the home address and mobility security association\
    \ of each\n   authorized mobile node that it is serving as a home agent.  When\
    \ the\n   home agent accepts a valid Registration Request from a mobile node\n\
    \   that it serves as a home agent, the home agent MUST create or modify\n   the\
    \ entry for this mobile node in its mobility binding list\n   containing:\n  \
    \  - the mobile node's care-of address\n    - the Identification field from the\
    \ Registration Reply\n    - the remaining Lifetime of the registration\n   The\
    \ home agent MAY also maintain mobility security associations with\n   various\
    \ foreign agents.  When receiving a Registration Request from a\n   foreign agent,\
    \ if the home agent shares a mobility security\n   association with the foreign\
    \ agent, the home agent MUST check the\n   Authenticator in the required Foreign-Home\
    \ Authentication Extension\n   in the message, based on this mobility security\
    \ association.\n   Similarly, when sending a Registration Reply to a foreign agent,\
    \ if\n   the home agent shares a mobility security association with the\n   foreign\
    \ agent, the home agent MUST include a Foreign-Home\n   Authentication Extension\
    \ in the message, based on this mobility\n   security association.\n"
- title: 3.8.2. Receiving Registration Requests
  contents:
  - "3.8.2. Receiving Registration Requests\n   If the home agent accepts an incoming\
    \ Registration Request, it MUST\n   update its record of the the mobile node's\
    \ mobility binding(s) and\n   SHOULD send a Registration Reply with a suitable\
    \ Code.  Otherwise\n   (the home agent denies the Request), it SHOULD send a Registration\n\
    \   Reply with an appropriate Code specifying the reason the Request was\n   denied.\
    \  The following sections describe this behavior in more\n   detail.\n"
- title: 3.8.2.1. Validity Checks
  contents:
  - "3.8.2.1. Validity Checks\n   Registration Requests with an invalid, non-zero\
    \ UDP checksum MUST be\n   silently discarded by the home agent.\n   The authentication\
    \ in the Registration Request MUST be checked.  This\n   involves the following\
    \ operations:\n      a)   The home agent MUST check for the presence of a valid\n\
    \           Mobile-Home Authentication Extension, and perform the\n          \
    \ indicated authentication.  Exactly one Mobile-Home\n           Authentication\
    \ Extension MUST be present in the Registration\n           Request, and the home\
    \ agent MUST check the Authenticator\n           value in the Extension.  If no\
    \ Mobile-Home Authentication\n           Extension is found, or if more than one\
    \ Mobile-Home\n           Authentication Extension is found, or if the Authenticator\n\
    \           is invalid, the home agent MUST reject the mobile node's\n       \
    \    registration and SHOULD send a Registration Reply to the\n           mobile\
    \ node with Code 131.  The home agent MUST then discard\n           the Request\
    \ and SHOULD log the error as a security exception.\n      b)   The home agent\
    \ MUST check that the registration\n           Identification field is correct\
    \ using the context selected by\n           the SPI within the Mobile-Home Authentication\
    \ Extension.  See\n           Section 5.6 for a description of how this is performed.\
    \  If\n           incorrect, the home agent MUST reject the Request and SHOULD\n\
    \           send a Registration Reply to the mobile node with Code 133,\n    \
    \       including an Identification field computed in accordance with\n      \
    \     the rules specified in Section 5.6.  The home agent MUST do\n          \
    \ no further processing with such a Request, though it SHOULD\n           log\
    \ the error as a security exception.\n      c)   If the home agent shares a mobility\
    \ security association with\n           the foreign agent, the home agent MUST\
    \ check for the presence\n           of a valid Foreign-Home Authentication Extension.\
    \  Exactly\n           one Foreign-Home Authentication Extension MUST be present\
    \ in\n           the Registration Request in this case, and the home agent\n \
    \          MUST check the Authenticator value in the Extension.  If no\n     \
    \      Foreign-Home Authentication Extension is found, or if more\n          \
    \ than one Foreign-Home Authentication Extension is found, or\n           if the\
    \ Authenticator is invalid, the home agent MUST reject\n           the mobile\
    \ node's registration and SHOULD send a Registration\n           Reply to the\
    \ mobile node with Code 132.  The home agent\n           MUST then discard the\
    \ Request and SHOULD log the error as a\n           security exception.\n   In\
    \ addition to checking the authentication in the Registration\n   Request, home\
    \ agents MUST deny Registration Requests that are sent to\n   the subnet-directed\
    \ broadcast address of the home network (as opposed\n   to being unicast to the\
    \ home agent).  The home agent MUST discard the\n   Request and SHOULD returning\
    \ a Registration Reply with a Code of 136.\n   In this case, the Registration\
    \ Reply will contain the home agent's\n   unicast address, so that the mobile\
    \ node can re-issue the\n   Registration Request with the correct home agent address.\n"
- title: 3.8.2.2. Accepting a Valid Request
  contents:
  - "3.8.2.2. Accepting a Valid Request\n   If the Registration Request satisfies\
    \ the validity checks in Section\n   3.8.2.1, and the home agent is able to accommodate\
    \ the Request, the\n   home agent MUST update its mobility binding list for the\
    \ requesting\n   mobile node and MUST return a Registration Reply to the mobile\
    \ node.\n   In this case, the Reply Code will be either 0 if the home agent\n\
    \   supports simultaneous mobility bindings, or 1 if it does not.  See\n   Section\
    \ 3.8.3 for details on building the Registration Reply message.\n   The home agent\
    \ updates its record of the mobile node's mobility\n   bindings as follows, based\
    \ on the fields in the Registration Request:\n    -  If the Lifetime is zero and\
    \ the Care-of Address equals the mobile\n       node's home address, the home\
    \ agent deletes all of the entries in\n       the mobility binding list for the\
    \ requesting mobile node.  This\n       is how a mobile node requests that its\
    \ home agent cease providing\n       mobility services.\n    -  If the Lifetime\
    \ is zero and the Care-of Address does not equal\n       the mobile node's home\
    \ address, the home agent deletes only the\n       entry containing the specified\
    \ Care-of Address from the mobility\n       binding list for the requesting mobile\
    \ node.  Any other active\n       entries containing other care-of addresses will\
    \ remain active.\n    -  If the Lifetime is nonzero, the home agent adds an entry\n\
    \       containing the requested Care-of Address to the mobility binding\n   \
    \    list for the mobile node.  If the 'S' bit is set and the home\n       agent\
    \ supports simultaneous mobility bindings, the previous\n       mobility binding\
    \ entries are retained.  Otherwise, the home agent\n       removes all previous\
    \ entries in the mobility binding list for the\n       mobile node.\n   In all\
    \ cases, the home agent MUST send a Registration Reply to the\n   source of the\
    \ Registration Request, which might indeed be a different\n   foreign agent than\
    \ that whose care-of address is being\n   (de)registered.  If the home agent shares\
    \ a mobility security\n   association with the foreign agent whose care-of address\
    \ is being\n   deregistered, and that foreign agent is different from the one\
    \ which\n   relayed the Registration Request, the home agent MAY additionally\n\
    \   send a Registration Reply to the foreign agent whose care-of address\n   is\
    \ being deregistered.  The home agent MUST NOT send such a Reply if\n   it does\
    \ not share a mobility security association with the foreign\n   agent.  If no\
    \ Reply is sent, the foreign agent's visitor list will\n   expire naturally when\
    \ the original Lifetime expires.\n   The home agent MUST NOT increase the Lifetime\
    \ above that specified by\n   the mobile node in the Registration Request.  However,\
    \ it is not an\n   error for the mobile node to request a Lifetime longer than\
    \ the home\n   agent is willing to accept.  In this case, the home agent simply\n\
    \   reduces the Lifetime to a permissible value and returns this value in\n  \
    \ the Registration Reply.  The Lifetime value in the Registration Reply\n   informs\
    \ the mobile node of the granted lifetime of the registration,\n   indicating\
    \ when it SHOULD re-register in order to maintain continued\n   service.  After\
    \ the expiration of this registration lifetime, the\n   home agent MUST delete\
    \ its entry for this registration in its\n   mobility binding list.\n   If the\
    \ Registration Request duplicates an accepted current\n   Registration Request,\
    \ the new Lifetime MUST NOT extend beyond the\n   Lifetime originally granted.\
    \  A Registration Request is a duplicate\n   if the home address, care-of address,\
    \ and Identification fields all\n   equal those of an accepted current registration.\n\
    \   In addition, if the home network implements ARP [16], and the\n   Registration\
    \ Request asks the home agent to create a mobility binding\n   for a mobile node\
    \ which previously had no binding (the mobile node\n   was previously assumed\
    \ to be at home), then the home agent MUST\n   follow the procedures described\
    \ in Section 4.6 with regard to ARP,\n   proxy ARP, and gratuitous ARP.  If the\
    \ mobile node already had a\n   previous mobility binding, the home agent MUST\
    \ continue to follow the\n   rules for proxy ARP described in Section 4.6.\n"
- title: 3.8.2.3. Denying an Invalid Request
  contents:
  - "3.8.2.3. Denying an Invalid Request\n   If the Registration Reply does not satisfy\
    \ all of the validity checks\n   in Section 3.8.2.1, or the home agent is unable\
    \ to accommodate the\n   Request, the home agent SHOULD return a Registration\
    \ Reply to the\n   mobile node with a Code that indicates the reason for the error.\
    \  If\n   a foreign agent was involved in relaying the Request, this allows the\n\
    \   foreign agent to delete its pending visitor list entry.  Also, this\n   informs\
    \ the mobile node of the reason for the error such that it may\n   attempt to\
    \ fix the error and issue another Request.\n   This section lists a number of\
    \ reasons the home agent might reject a\n   Request, and provides the Code value\
    \ it should use in each instance.\n   See Section 3.8.3 for additional details\
    \ on building the Registration\n   Reply message.\n   Many reasons for rejecting\
    \ a registration are administrative in\n   nature.  For example, a home agent\
    \ can limit the number of\n   simultaneous registrations for a mobile node, by\
    \ rejecting any\n   registrations that would cause its limit to be exceeded, and\n\
    \   returning a Registration Reply with error code 135.  Similarly, a\n   home\
    \ agent may refuse to grant service to mobile nodes which have\n   entered unauthorized\
    \ service areas by returning a Registration Reply\n   with a Code of 129.\n  \
    \ If the Reserved field is nonzero, it MUST deny the Request with a\n   Code of\
    \ 134.\n"
- title: 3.8.3. Sending Registration Replies
  contents:
  - "3.8.3. Sending Registration Replies\n   If the home agent accepts a Registration\
    \ Request, it then MUST update\n   its record of the mobile node's mobility binding(s)\
    \ and SHOULD send a\n   Registration Reply with a suitable Code.  Otherwise (the\
    \ home agent\n   has denied the Request), it SHOULD send a Registration Reply\
    \ with an\n   appropriate Code specifying the reason the Request was denied. \
    \ The\n   following sections provide additional detail for the values the home\n\
    \   agent MUST supply in the fields of Registration Reply messages.\n"
- title: 3.8.3.1. IP/UDP Fields
  contents:
  - "3.8.3.1. IP/UDP Fields\n   This section provides the specific rules by which\
    \ mobile nodes pick\n   values for the IP and UDP header fields of a Registration\
    \ Reply.\n      IP Source Address\n               Copied from the IP Destination\
    \ Address of Registration\n               Request, unless a multicast or broadcast\
    \ address was\n               used.  If the IP Destination Address of the Registration\n\
    \               Request was a broadcast or multicast address, the IP\n       \
    \        Source Address of the Registration Reply MUST be set to\n           \
    \    the home agent's (unicast) IP address.\n      IP Destination Address\n  \
    \             Copied from the IP Source Address of the Registration\n        \
    \       Request.\n      UDP Source Port\n               Copied from the UDP Destination\
    \ Port of the Registration\n               Request.\n      UDP Destination Port\n\
    \               Copied from the UDP Source Port of the Registration\n        \
    \       Request.\n   When sending a Registration Reply in response to a Registration\n\
    \   Request that requested deregistration of the mobile node (the\n   Lifetime\
    \ is zero and the Care-of Address equals the mobile node's\n   home address) and\
    \ in which the IP Source Address was also set to the\n   mobile node's home address\
    \ (this is the normal method used by a\n   mobile node to deregister when it returns\
    \ to its home network), the\n   IP Destination Address in the Registration Reply\
    \ will be set to the\n   mobile node's home address, as copied from the IP Source\
    \ Address of\n   the Request.\n   In this case, when transmitting the Registration\
    \ Reply, the home\n   agent MUST transmit the Reply directly onto the home network\
    \ as if\n   the mobile node were at home, bypassing any mobility binding list\n\
    \   entry that may still exist at the home agent for the destination\n   mobile\
    \ node.  In particular, for a mobile node returning home after\n   being registered\
    \ with a care-of address, if the mobile node's new\n   Registration Request is\
    \ not accepted by the home agent, the mobility\n   binding list entry for the\
    \ mobile node will still indicate that\n   datagrams addressed to the mobile node\
    \ should be tunneled to the\n   mobile node's registered care-of address; when\
    \ sending the\n   Registration Reply indicating the rejection of this Request,\
    \ this\n   existing binding list entry MUST be ignored, and the home agent MUST\n\
    \   transmit this Reply as if the mobile node were at home.\n"
- title: 3.8.3.2. Registration Reply Fields
  contents:
  - "3.8.3.2. Registration Reply Fields\n   This section provides specific rules by\
    \ which home agents pick values\n   for the fields within the fixed portion of\
    \ a Registration Reply.  The\n   Code field of the Registration Reply is chosen\
    \ in accordance with the\n   rules specified in the previous sections.  When replying\
    \ to an\n   accepted registration, a home agent SHOULD respond with Code 1 if\
    \ it\n   does not support simultaneous registrations.\n   The Lifetime field MUST\
    \ be copied from the corresponding field in the\n   Registration Request, unless\
    \ the requested value is greater than the\n   maximum length of time the home\
    \ agent is willing to provide the\n   requested service.  In such a case, the\
    \ Lifetime MUST be set to the\n   length of time that service will actually be\
    \ provided by the home\n   agent.  This reduced Lifetime SHOULD be the maximum\
    \ Lifetime allowed\n   by the home agent (for this mobile node and care-of address).\n\
    \   The Home Address field MUST be copied from the corresponding field in\n  \
    \ the Registration Request.\n   If the Home Agent field in the Registration Request\
    \ contains a\n   unicast address of this home agent, then that field MUST be copied\n\
    \   into the Home Agent field of the Registration Reply.  Otherwise, the\n   home\
    \ agent MUST set the Home Agent field in the Registration Reply to\n   its unicast\
    \ address.  In this latter case, the home agent MUST reject\n   the registration\
    \ with a suitable code (e.g., Code 136) to prevent the\n   mobile node from possibly\
    \ being simultaneously registered with two or\n   more home agents.\n"
- title: 3.8.3.3. Extensions
  contents:
  - "3.8.3.3. Extensions\n   This section describes the ordering of any required and\
    \ any optional\n   Mobile IP Extensions that a home agent appends to a Registration\n\
    \   Reply.  The following ordering MUST be followed:\n      a)   The IP header,\
    \ followed by the UDP header, followed by the\n           fixed-length portion\
    \ of the Registration Reply,\n      b)   If present, any non-authentication Extensions\
    \ used by the\n           mobile node (which may or may not also be used by the\
    \ foreign\n           agent),\n      c)   The Mobile-Home Authentication Extension,\n\
    \      d)   If present, any non-authentication Extensions used only by\n     \
    \      the foreign agent, and\n      e)   The Foreign-Home Authentication Extension,\
    \ if present.\n   Note that items (a) and (c) MUST appear in every Registration\
    \ Reply\n   sent by the home agent.  Items (b), (d), and (e) are optional.\n \
    \  However, item (e) MUST be included when the home agent and the\n   foreign\
    \ agent share a mobility security association.\n"
- title: 4. Routing Considerations
  contents:
  - "4. Routing Considerations\n   This section describes how mobile nodes, home agents,\
    \ and (possibly)\n   foreign agents cooperate to route datagrams to/from mobile\
    \ nodes that\n   are connected to a foreign network.  The mobile node informs\
    \ its home\n   agent of its current location using the registration procedure\n\
    \   described in Section 3.  See the protocol overview in Section 1.7 for\n  \
    \ the relative locations of the mobile node's home address with respect\n   to\
    \ its home agent, and the mobile node itself with respect to any\n   foreign agent\
    \ with which it might attempt to register.\n"
- title: 4.1. Encapsulation Types
  contents:
  - "4.1. Encapsulation Types\n   Home agents and foreign agents MUST support tunneling\
    \ datagrams using\n   IP in IP encapsulation [14].  Any mobile node that uses\
    \ a co-located\n   care-of address MUST support receiving datagrams tunneled using\
    \ IP in\n   IP encapsulation.  Minimal encapsulation [15] and GRE encapsulation\n\
    \   [8] are alternate encapsulation methods which MAY optionally be\n   supported\
    \ by mobility agents and mobile nodes.  The use of these\n   alternative forms\
    \ of encapsulation, when requested by the mobile\n   node, is otherwise at the\
    \ discretion of the home agent.\n"
- title: 4.2. Unicast Datagram Routing
  contents:
  - '4.2. Unicast Datagram Routing

    '
- title: 4.2.1. Mobile Node Considerations
  contents:
  - "4.2.1. Mobile Node Considerations\n   When connected to its home network, a mobile\
    \ node operates without\n   the support of mobility services.  That is, it operates\
    \ in the same\n   way as any other (fixed) host or router.  The method by which\
    \ a\n   mobile node selects a default router when connected to its home\n   network,\
    \ or when away from home and using a co-located care-of\n   address, is outside\
    \ the scope of this document.  ICMP Router\n   Advertisement [4] is one such method.\n\
    \   When registered on a foreign network, the mobile node chooses a\n   default\
    \ router by the following rules:\n    -  If the mobile node is registered using\
    \ a foreign agent care-of\n       address, then the mobile node MUST choose its\
    \ default router\n       from among the Router Addresses advertised in the ICMP\
    \ Router\n       Advertisement portion of that Agent Advertisement message.  The\n\
    \       mobile node MAY also consider the IP source address of the Agent\n   \
    \    Advertisement as another possible choice for the IP address of a\n      \
    \ default router, along with the (possibly empty) list of Router\n       Addresses\
    \ from the ICMP Router Advertisement portion of the\n       message.  In such\
    \ cases, the IP source address MUST be considered\n       to be the worst choice\
    \ (lowest preference) for a default router.\n    -  If the mobile node is registered\
    \ directly with its home agent\n       using a co-located care-of address, then\
    \ the mobile node SHOULD\n       choose its default router from among those advertised\
    \ in any\n       ICMP Router Advertisement message that it receives for which\n\
    \       its externally obtained care-of address and the Router Address\n     \
    \  match under the network prefix.  If the mobile node's externally\n       obtained\
    \ care-of address matches the IP source address of the\n       Agent Advertisement\
    \ under the network prefix, the mobile node\n       MAY also consider that IP\
    \ source address as another possible\n       choice for the IP address of a default\
    \ router, along with the\n       (possibly empty) list of Router Addresses from\
    \ the ICMP Router\n       Advertisement portion of the message.  If so, the IP\
    \ source\n       address MUST be considered to be the worst choice (lowest\n \
    \      preference) for a default router.  The network prefix MAY\n       be obtained\
    \ from the Prefix-Lengths Extension in the Router\n       Advertisement, if present.\
    \  The prefix MAY also be obtained\n       through other mechanisms beyond the\
    \ scope of this document.\n   Beyond these rules, the actual selection of the\
    \ default router is\n   made by the selection method specified for ICMP Router\
    \ Discovery [4],\n   among the Router Addresses specified above.  In any case,\
    \ a mobile\n   node registered via a foreign agent MAY choose its foreign agent\
    \ as a\n   default router.\n   Note that Van Jacobson header compression [10]\
    \ will not function\n   properly unless all TCP IP datagrams to and from the mobile\
    \ node\n   pass, respectively, through the same first and last-hop router.  The\n\
    \   mobile node, therefore, MUST select its foreign agent as its default\n   router\
    \ if it performs Van Jacobson header compression with its\n   foreign agent.\n"
- title: 4.2.2. Foreign Agent Considerations
  contents:
  - "4.2.2. Foreign Agent Considerations\n   Upon receipt of an encapsulated datagram\
    \ sent to its advertised\n   care-of address, a foreign agent MUST compare the\
    \ inner destination\n   address to those entries in its visitor list.  When the\
    \ destination\n   does not match the address of any mobile node currently in the\n\
    \   visitor list, the foreign agent MUST NOT forward the datagram without\n  \
    \ modifications to the original IP header, because otherwise a routing\n   loop\
    \ is likely to result.  The datagram SHOULD be silently discarded.\n   ICMP Destination\
    \ Unreachable MUST NOT be sent when a foreign agent is\n   unable to forward an\
    \ incoming tunneled datagram.  Otherwise, the\n   foreign agent forwards the decapsulated\
    \ datagram to the mobile node.\n   The foreign agent MUST NOT advertise to other\
    \ routers in its routing\n   domain, nor to any other mobile node, the presence\
    \ of a mobile router\n   (Section 4.5).\n   The foreign agent MUST route datagrams\
    \ it receives from registered\n   mobile nodes.  At a minimum, this means that\
    \ the foreign agent must\n   verify the IP Header Checksum, decrement the IP Time\
    \ To Live,\n   recompute the IP Header Checksum, and forward such datagrams to\
    \ a\n   default router.  In addition, the foreign agent SHOULD send an\n   appropriate\
    \ ICMP Redirect message to the mobile node.\n"
- title: 4.2.3. Home Agent Considerations
  contents:
  - "4.2.3. Home Agent Considerations\n   The home agent MUST be able to intercept\
    \ any datagrams on the home\n   network addressed to the mobile node while the\
    \ mobile node is\n   registered away from home.  Proxy and gratuitous ARP MAY\
    \ be used in\n   enabling this interception, as specified in Section 4.6.\n  \
    \ The home agent must examine the IP Destination Address of all\n   arriving datagrams\
    \ to see if it is equal to the home address of any\n   of its mobile nodes registered\
    \ away from home.  If so, the home agent\n   tunnels the datagram to the mobile\
    \ node's currently registered care-\n   of address or addresses.  If the home\
    \ agent supports the optional\n   capability of multiple simultaneous mobility\
    \ bindings, it tunnels a\n   copy to each care-of address in the mobile node's\
    \ mobility binding\n   list.  If the mobile node has no current mobility bindings,\
    \ the home\n   agent MUST NOT attempt to intercept datagrams destined for the\
    \ mobile\n   node, and thus will not in general receive such datagrams.  However,\n\
    \   if the home agent is also a router handling common IP traffic, it is\n   possible\
    \ that it will receive such datagrams for forwarding onto the\n   home network.\
    \  In this case, the home agent MUST assume the mobile\n   node is at home and\
    \ simply forward the datagram directly onto the\n   home network.\n   See Section\
    \ 4.1 regarding methods of encapsulation that may be used\n   for tunneling. \
    \ Nodes implementing tunneling SHOULD also implement\n   the \"tunnel soft state\"\
    \ mechanism [14], which allows ICMP error\n   messages returned from the tunnel\
    \ to correctly be reflected back to\n   the original senders of the tunneled datagrams.\n\
    \   Home agents SHOULD be able to decapsulate and further deliver packets\n  \
    \ addressed to themselves, sent by a mobile node for the purpose of\n   maintaining\
    \ location privacy, as described in Section 5.5.\n   If the Lifetime for a given\
    \ mobility binding expires before the home\n   agent has received another valid\
    \ Registration Request for that mobile\n   node, then that binding is deleted\
    \ from the mobility binding list.\n   The home agent MUST NOT send any Registration\
    \ Reply message simply\n   because the mobile node's binding has expired.  The\
    \ entry in the\n   visitor list of the mobile node's current foreign agent will\
    \ expire\n   naturally, probably at the same time as the binding expired at the\n\
    \   home agent.  When a mobility binding's lifetime expires, the home\n   agent\
    \ MUST delete the binding, but it MUST retain any other (non-\n   expired) simultaneous\
    \ mobility bindings that it holds for the mobile\n   node.\n   When a home agent\
    \ receives a datagram, intercepted for one of its\n   mobile nodes registered\
    \ away from home, the home agent MUST examine\n   the datagram to check if it\
    \ is already encapsulated.  If so, special\n   rules apply in the forwarding of\
    \ that datagram to the mobile node:\n    -  If the inner (encapsulated) Destination\
    \ Address is the same\n       as the outer Destination Address (the mobile node),\
    \ then the\n       home agent MUST also examine the outer Source Address of the\n\
    \       encapsulated datagram (the source address of the tunnel).  If\n      \
    \ this outer Source Address is the same as the mobile node's\n       current care-of\
    \ address, the home agent MUST silently discard\n       that datagram in order\
    \ to prevent a likely routing loop.  If,\n       instead, the outer Source Address\
    \ is NOT the same as the mobile\n       node's current care-of address, then the\
    \ home agent SHOULD\n       forward the datagram to the mobile node.  In order\
    \ to forward\n       the datagram in this case, the home agent MAY simply alter\
    \ the\n       outer Destination Address to the care-of address, rather than\n\
    \       re-encapsulating the datagram.\n    -  Otherwise (the inner Destination\
    \ Address is NOT the same as the\n       outer Destination Address), the home\
    \ agent SHOULD encapsulate\n       the datagram again (recursive encapsulation),\
    \ with the new outer\n       Destination Address set equal to the mobile node's\
    \ care-of\n       address.  That is, the home agent forwards the entire datagram\n\
    \       to the mobile node in the same way as any other datagram\n       (encapsulated\
    \ already or not).\n"
- title: 4.3. Broadcast Datagrams
  contents:
  - "4.3. Broadcast Datagrams\n   When a home agent receives a broadcast datagram,\
    \ it MUST NOT forward\n   the datagram to any mobile nodes in its mobility binding\
    \ list other\n   than those that have requested forwarding of broadcast datagrams.\
    \  A\n   mobile node MAY request forwarding of broadcast datagrams by setting\n\
    \   the 'B' bit in its Registration Request message (Section 3.3).  For\n   each\
    \ such registered mobile node, the home agent SHOULD forward\n   received broadcast\
    \ datagrams to the mobile node, although it is a\n   matter of configuration at\
    \ the home agent as to which specific\n   categories of broadcast datagrams will\
    \ be forwarded to such mobile\n   nodes.\n   If the 'D' bit was set in the mobile\
    \ node's Registration Request\n   message, indicating that the mobile node is\
    \ using a co-located care-\n   of address, the home agent simply tunnels appropriate\
    \ broadcast IP\n   datagrams to the mobile node's care-of address.  Otherwise\
    \ (the 'D'\n   bit was NOT set), the home agent first encapsulates the broadcast\n\
    \   datagram in a unicast datagram addressed to the mobile node's home\n   address,\
    \ and then tunnels this encapsulated datagram to the foreign\n   agent.  This\
    \ extra level of encapsulation is required so that the\n   foreign agent can determine\
    \ which mobile node should receive the\n   datagram after it is decapsulated.\
    \  When received by the foreign\n   agent, the unicast encapsulated datagram is\
    \ detunneled and delivered\n   to the mobile node in the same way as any other\
    \ datagram.  In either\n   case, the mobile node must decapsulate the datagram\
    \ it receives in\n   order to recover the original broadcast datagram.\n"
- title: 4.4. Multicast Datagram Routing
  contents:
  - "4.4. Multicast Datagram Routing\n   As mentioned previously, a mobile node that\
    \ is connected to its home\n   network functions in the same way as any other\
    \ (fixed) host or\n   router.  Thus, when it is at home, a mobile node functions\n\
    \   identically to other multicast senders and receivers.  This section\n   therefore\
    \ describes the behavior of a mobile node that is visiting a\n   foreign network.\n\
    \   In order receive multicasts, a mobile node MUST join the multicast\n   group\
    \ in one of two ways.  First, a mobile node MAY join the group\n   via a (local)\
    \ multicast router on the visited subnet.  This option\n   assumes that there\
    \ is a multicast router present on the visited\n   subnet.  If the mobile node\
    \ is using a co-located care-of address, it\n   SHOULD use this address as the\
    \ source IP address of its IGMP [5]\n   messages.  Otherwise, it MUST use its\
    \ home address.\n   Alternatively, a mobile node which wishes to receive multicasts\
    \ MAY\n   join groups via a bi-directional tunnel to its home agent, assuming\n\
    \   that its home agent is a multicast router.  The mobile node tunnels\n   IGMP\
    \ messages to its home agent and the home agent forwards multicast\n   datagrams\
    \ down the tunnel to the mobile node.  The rules for\n   multicast datagram delivery\
    \ to mobile nodes in this case are\n   identical to those for broadcast datagrams\
    \ (Section 4.3).  Namely, if\n   the mobile node is using a co-located care-of\
    \ address (the 'D' bit\n   was set in the mobile node's Registration Request),\
    \ then the home\n   agent SHOULD tunnel the datagram to this care-of address;\
    \ otherwise,\n   the home agent MUST first encapsulate the datagram in a unicast\n\
    \   datagram addressed to the mobile node's home address and then MUST\n   tunnel\
    \ the resulting datagram (recursive tunneling) to the mobile\n   node's care-of\
    \ address.\n   A mobile node that wishes to send datagrams to a multicast group\
    \ also\n   has two options:  (1) send directly on the visited network; or (2)\n\
    \   send via a tunnel to its home agent.  Because multicast routing in\n   general\
    \ depends upon the IP source address, a mobile node which sends\n   multicast\
    \ datagrams directly on the visited network MUST use a co-\n   located care-of\
    \ address as the IP source address.  Similarly, a\n   mobile node which tunnels\
    \ a multicast datagram to its home agent MUST\n   use its home address as the\
    \ IP source address of both the (inner)\n   multicast datagram and the (outer)\
    \ encapsulating datagram.  This\n   second option assumes that the home agent\
    \ is a multicast router.\n"
- title: 4.5. Mobile Routers
  contents:
  - "4.5. Mobile Routers\n   A mobile node can be a router, which is responsible for\
    \ the mobility\n   of one or more entire networks moving together, perhaps on\
    \ an\n   airplane, a ship, a train, an automobile, a bicycle, or a kayak.  The\n\
    \   nodes connected to a network served by the mobile router may\n   themselves\
    \ be fixed nodes or mobile nodes or routers.  In this\n   document, such networks\
    \ are called \"mobile networks\".\n   A mobile router MAY act as a foreign agent\
    \ and provide a foreign\n   agent care-of address to mobile nodes connected to\
    \ the mobile\n   network.  Typical routing to a mobile node via a mobile router\
    \ in\n   this case is illustrated by the following example:\n      a)   A laptop\
    \ computer is disconnected from its home network and\n           later attached\
    \ to a network port in the seat back of an\n           aircraft.  The laptop computer\
    \ uses Mobile IP to register on\n           this foreign network, using a foreign\
    \ agent care-of address\n           discovered through an Agent Advertisement\
    \ from the aircraft's\n           foreign agent.\n      b)   The aircraft network\
    \ is itself mobile.  Suppose the node\n           serving as the foreign agent\
    \ on the aircraft also serves as\n           the default router that connects\
    \ the aircraft network to the\n           rest of the Internet.  When the aircraft\
    \ is at home, this\n           router is attached to some fixed network at the\
    \ airline's\n           headquarters, which is the router's home network.  While\n\
    \           the aircraft is in flight, this router registers from time\n     \
    \      to time over its radio link with a series of foreign agents\n         \
    \  below it on the ground.  This router's home agent is a node\n           on\
    \ the fixed network at the airline's headquarters.\n      c)   Some correspondent\
    \ node sends a datagram to the laptop\n           computer, addressing the datagram\
    \ to the laptop's home\n           address.  This datagram is initially routed\
    \ to the laptop's\n           home network.\n      d)   The laptop's home agent\
    \ intercepts the datagram on the home\n           network and tunnels it to the\
    \ laptop's care-of address, which\n           in this example is an address of\
    \ the node serving as router\n           and foreign agent on the aircraft.  Normal\
    \ IP routing will\n           route the datagram to the fixed network at the airline's\n\
    \           headquarters.\n      e)   The aircraft router and foreign agent's\
    \ home agent there\n           intercepts the datagram and tunnels it to its current\
    \ care-of\n           address, which in this example is some foreign agent on\
    \ the\n           ground below the aircraft.  The original datagram from the\n\
    \           correspondent node has now been encapsulated twice:  once\n      \
    \     by the laptop's home agent and again by the aircraft's home\n          \
    \ agent.\n      f)   The foreign agent on the ground decapsulates the datagram,\n\
    \           yielding a datagram still encapsulated by the laptop's home\n    \
    \       agent, with a destination address of the laptop's care-of\n          \
    \ address.  The ground foreign agent sends the resulting\n           datagram\
    \ over its radio link to the aircraft.\n      g)   The foreign agent on the aircraft\
    \ decapsulates the datagram,\n           yielding the original datagram from the\
    \ correspondent node,\n           with a destination address of the laptop's home\
    \ address.\n           The aircraft foreign agent delivers the datagram over the\n\
    \           aircraft network to the laptop's link-layer address.\n   This example\
    \ illustrated the case in which a mobile node is attached\n   to a mobile network.\
    \  That is, the mobile node is mobile with respect\n   to the network, which itself\
    \ is also mobile (here with respect to the\n   ground).  If, instead, the node\
    \ is fixed with respect to the mobile\n   network (the mobile network is the fixed\
    \ node's home network), then\n   either of two methods may be used to cause datagrams\
    \ from\n   correspondent nodes to be routed to the fixed node.\n   A home agent\
    \ MAY be configured to have a permanent registration for\n   the fixed node, that\
    \ indicates the mobile router's address as the\n   fixed host's care-of address.\
    \  The mobile router's home agent will\n   usually be used for this purpose. \
    \ The home agent is then responsible\n   for advertising connectivity using normal\
    \ routing protocols to the\n   fixed node.  Any datagrams sent to the fixed node\
    \ will thus use\n   recursive tunneling as described above.\n   Alternatively,\
    \ the mobile router MAY advertise connectivity to the\n   entire mobile network\
    \ using normal IP routing protocols through a\n   bi-directional tunnel to its\
    \ own home agent.  This method avoids the\n   need for recursive tunneling of\
    \ datagrams.\n"
- title: 4.6. ARP, Proxy ARP, and Gratuitous ARP
  contents:
  - "4.6. ARP, Proxy ARP, and Gratuitous ARP\n   The use of ARP [16] requires special\
    \ rules for correct operation when\n   wireless or mobile nodes are involved.\
    \  The requirements specified in\n   this section apply to all home networks in\
    \ which ARP is used for\n   address resolution.\n   In addition to the normal\
    \ use of ARP for resolving a target node's\n   link-layer address from its IP\
    \ address, this document distinguishes\n   two special uses of ARP:\n       -\
    \  A Proxy ARP [18] is an ARP Reply sent by one node on behalf\n          of another\
    \ node which is either unable or unwilling to answer\n          its own ARP Requests.\
    \  The sender of a Proxy ARP reverses the\n          Sender and Target Protocol\
    \ Address fields as described in [16],\n          but supplies some configured\
    \ link-layer address (generally, its\n          own) in the Sender Hardware Address\
    \ field.  The node receiving\n          the Reply will then associate this link-layer\
    \ address with the\n          IP address of the original target node, causing\
    \ it to transmit\n          future datagrams for this target node to the node\
    \ with that\n          link-layer address.\n       -  A Gratuitous ARP [23] is\
    \ an ARP packet sent by a node in order to\n          spontaneously cause other\
    \ nodes to update an entry in their ARP\n          cache.  A gratuitous ARP MAY\
    \ use either an ARP Request or an ARP\n          Reply packet.  In either case,\
    \ the ARP Sender Protocol Address\n          and ARP Target Protocol Address are\
    \ both set to the IP address\n          of the cache entry to be updated, and\
    \ the ARP Sender Hardware\n          Address is set to the link-layer address\
    \ to which this cache\n          entry should be updated.  When using an ARP Reply\
    \ packet, the\n          Target Hardware Address is also set to the link-layer\
    \ address to\n          which this cache entry should be updated (this field is\
    \ not used\n          in an ARP Request packet).\n          In either case, for\
    \ a gratuitous ARP, the ARP packet MUST be\n          transmitted as a local broadcast\
    \ packet on the local link.  As\n          specified in [16], any node receiving\
    \ any ARP packet (Request or\n          Reply) MUST update its local ARP cache\
    \ with the Sender Protocol\n          and Hardware Addresses in the ARP packet,\
    \ if the receiving node\n          has an entry for that IP address already in\
    \ its ARP cache.  This\n          requirement in the ARP protocol applies even\
    \ for ARP Request\n          packets, and for ARP Reply packets that do not match\
    \ any ARP\n          Request transmitted by the receiving node [16].\n   While\
    \ a mobile node is registered on a foreign network, its home\n   agent uses proxy\
    \ ARP [18] to reply to ARP Requests it receives that\n   seek the mobile node's\
    \ link-layer address.  When receiving an ARP\n   Request, the home agent MUST\
    \ examine the target IP address of the\n   Request, and if this IP address matches\
    \ the home address of any\n   mobile node for which it has a registered mobility\
    \ binding, the home\n   agent MUST transmit an ARP Reply on behalf of the mobile\
    \ node.  After\n   exchanging the sender and target addresses in the packet [18],\
    \ the\n   home agent MUST set the sender link-layer address in the packet to\n\
    \   the link-layer address of its own interface over which the Reply will\n  \
    \ be sent.\n   When a mobile node leaves its home network and registers a binding\
    \ on\n   a foreign network, its home agent uses gratuitous ARP to update the\n\
    \   ARP caches of nodes on the home network.  This causes such nodes to\n   associate\
    \ the link-layer address of the home agent with the mobile\n   node's home (IP)\
    \ address.  When registering a binding for a mobile\n   node for which the home\
    \ agent previously had no binding (the mobile\n   node was assumed to be at home),\
    \ the home agent MUST transmit a\n   gratuitous ARP on behalf of the mobile node.\
    \  This gratuitous ARP\n   packet MUST be transmitted as a broadcast packet on\
    \ the link on which\n   the mobile node's home address is located.  Since broadcasts\
    \ on the\n   local link (such as Ethernet) are typically not guaranteed to be\n\
    \   reliable, the gratuitous ARP packet SHOULD be retransmitted a small\n   number\
    \ of times to increase its reliability.\n   When a mobile node returns to its\
    \ home network, the mobile node\n   and its home agent use gratuitous ARP to cause\
    \ all nodes on the\n   mobile node's home network to update their ARP caches to\
    \ once again\n   associate the mobile node's own link-layer address with the mobile\n\
    \   node's home (IP) address.  Before transmitting the (de)Registration\n   Request\
    \ message to its home agent, the mobile node MUST transmit this\n   gratuitous\
    \ ARP on its home network as a local broadcast on this link.\n   The gratuitous\
    \ ARP packet SHOULD be retransmitted a small number of\n   times to increase its\
    \ reliability, but these retransmissions SHOULD\n   proceed in parallel with the\
    \ transmission and processing of its\n   (de)Registration Request.\n   When the\
    \ mobile node's home agent receives and accepts this\n   (de)Registration Request,\
    \ the home agent MUST also transmit a\n   gratuitous ARP on the mobile node's\
    \ home network.  This gratuitous\n   ARP also is used to associate the mobile\
    \ node's home address with\n   the mobile node's own link-layer address.  A gratuitous\
    \ ARP is\n   transmitted by both the mobile node and its home agent, since in\
    \ the\n   case of wireless network interfaces, the area within transmission\n\
    \   range of the mobile node will likely differ from that within range\n   of\
    \ its its home agent.  Th ARP packet from the home agent MUST be\n   transmitted\
    \ as a local broadcast on the mobile node's home link,\n   and SHOULD be retransmitted\
    \ a small number of times to increase\n   its reliability; these retransmissions,\
    \ however, SHOULD proceed in\n   parallel with the transmission and processing\
    \ of its (de)Registration\n   Reply.\n   While the mobile node is away from home,\
    \ it MUST NOT transmit any\n   broadcast ARP Request or ARP Reply messages.  Finally,\
    \ while the\n   mobile node is away from home, it MUST NOT reply to ARP Requests\n\
    \   in which the target IP address is its own home address, unless the\n   ARP\
    \ Request is sent by a foreign agent with which the mobile node\n   is attempting\
    \ to register or a foreign agent with which the mobile\n   node has an unexpired\
    \ registration.  In the latter case, the mobile\n   node MUST use a unicast ARP\
    \ Reply to respond to the foreign agent.\n   Note that if the mobile node is using\
    \ a co-located care-of address\n   and receives an ARP Request in which the target\
    \ IP address is this\n   care-of address, then the mobile node SHOULD reply to\
    \ this ARP\n   Request.  Note also that, when transmitting a Registration Request\
    \ on\n   a foreign network, a mobile node may discover the link-layer address\n\
    \   of a foreign agent by storing the address as it is received from the\n   Agent\
    \ Advertisement from that foreign agent, but not by transmitting\n   a broadcast\
    \ ARP Request message.\n   The specific order in which each of the above requirements\
    \ for the\n   use of ARP, proxy ARP, and gratuitous ARP are applied, relative\
    \ to\n   the transmission and processing of the mobile node's Registration\n \
    \  Request and Registration Reply messages when leaving home or\n   returning\
    \ home, are important to the correct operation of the\n   protocol.\n   To summarize\
    \ the above requirements, when a mobile node leaves its\n   home network, the\
    \ following steps, in this order, MUST be performed:\n    -  The mobile node decides\
    \ to register away from home, perhaps\n       because it has received an Agent\
    \ Advertisement from a foreign\n       agent and has not recently received one\
    \ from its home agent.\n    -  Before transmitting the Registration Request, the\
    \ mobile node\n       disables its own future processing of any ARP Requests it\n\
    \       may subsequently receive requesting the link-layer address\n       corresponding\
    \ to its home address, except insofar as necessary to\n       communicate with\
    \ foreign agents on visited networks.\n    -  The mobile node transmits its Registration\
    \ Request.\n    -  When the mobile node's home agent receives and accepts the\n\
    \       Registration Request, it performs a gratuitous ARP on behalf\n       of\
    \ the mobile node, and begins using proxy ARP to reply to ARP\n       Requests\
    \ that it receives requesting the mobile node's link-layer\n       address.  If,\
    \ instead, the home agent rejects the Registration\n       Request, no ARP processing\
    \ (gratuitous nor proxy) is performed by\n       the home agent.\n   When a mobile\
    \ node later returns to its home network, the following\n   steps, in this order,\
    \ MUST be performed:\n    -  The mobile node decides to register at home, perhaps\
    \ because it\n       has received an Agent Advertisement from its home agent.\n\
    \    -  Before transmitting the Registration Request, the mobile node\n      \
    \ re-enables its own future processing of any ARP Requests it may\n       subsequently\
    \ receive requesting its link-layer address.\n    -  The mobile node performs\
    \ a gratuitous ARP for itself.\n    -  The mobile node transmits its Registration\
    \ Request.\n    -  When the mobile node's home agent receives and accepts the\n\
    \       Registration Request, it stops using proxy ARP to reply to\n       ARP\
    \ Requests that it receives requesting the mobile node's\n       link-layer address,\
    \ and then performs a gratuitous ARP on behalf\n       of the mobile node.  If,\
    \ instead, the home agent rejects the\n       Registration Request, no ARP processing\
    \ (gratuitous nor proxy) is\n       performed by the home agent.\n"
- title: 5. Security Considerations
  contents:
  - "5. Security Considerations\n   The mobile computing environment is potentially\
    \ very different from\n   the ordinary computing environment.  In many cases,\
    \ mobile computers\n   will be connected to the network via wireless links.  Such\
    \ links are\n   particularly vulnerable to passive eavesdropping, active replay\n\
    \   attacks, and other active attacks.\n"
- title: 5.1. Message Authentication Codes
  contents:
  - "5.1. Message Authentication Codes\n   Home agents and mobile nodes MUST be able\
    \ to perform authentication.\n   The default algorithm is keyed MD5 [21], with\
    \ a key size of 128 bits.\n   The default mode of operation is to both precede\
    \ and follow the data\n   to be hashed, by the 128-bit key; that is, MD5 is to\
    \ be used in\n   \"prefix+suffix\" mode.  The foreign agent MUST also support\n\
    \   authentication using keyed MD5 and key sizes of 128 bits or greater,\n   with\
    \ manual key distribution.  More authentication algorithms,\n   algorithm modes,\
    \ key distribution methods, and key sizes MAY also be\n   supported.\n"
- title: 5.2. Areas of Security Concern in this Protocol
  contents:
  - "5.2. Areas of Security Concern in this Protocol\n   The registration protocol\
    \ described in this document will result in a\n   mobile node's traffic being\
    \ tunneled to its care-of address.  This\n   tunneling feature could be a significant\
    \ vulnerability if the\n   registration were not authenticated.  Such remote redirection,\
    \ for\n   instance as performed by the mobile registration protocol, is widely\n\
    \   understood to be a security problem in the current Internet if not\n   authenticated\
    \ [2].  Moreover, the Address Resolution Protocol (ARP)\n   is not authenticated,\
    \ and can potentially be used to steal another\n   host's traffic.  The use of\
    \ \"Gratuitous ARP\" (Section 4.6) brings\n   with it all of the risks associated\
    \ with the use of ARP.\n"
- title: 5.3. Key Management
  contents:
  - "5.3. Key Management\n   This specification requires a strong authentication mechanism\
    \ (keyed\n   MD5) which precludes many potential attacks based on the Mobile IP\n\
    \   registration protocol.  However, because key distribution is\n   difficult\
    \ in the absence of a network key management protocol,\n   messages with the foreign\
    \ agent are not all required to be\n   authenticated.  In a commercial environment\
    \ it might be important to\n   authenticate all messages between the foreign agent\
    \ and the home\n   agent, so that billing is possible, and service providers do\
    \ not\n   provide service to users that are not legitimate customers of that\n\
    \   service provider.\n"
- title: 5.4. Picking Good Random Numbers
  contents:
  - "5.4. Picking Good Random Numbers\n   The strength of any authentication mechanism\
    \ depends on several\n   factors, including the innate strength of the authentication\n\
    \   algorithm, the secrecy of the key used, the strength of the key used,\n  \
    \ and the quality of the particular implementation.  This specification\n   requires\
    \ implementation of keyed MD5 for authentication, but does not\n   preclude the\
    \ use of other authentication algorithms and modes.  For\n   keyed MD5 authentication\
    \ to be useful, the 128-bit key must be both\n   secret (that is, known only to\
    \ authorized parties) and pseudo-random.\n   If nonces are used in connection\
    \ with replay protection, they must\n   also be selected carefully.  Eastlake,\
    \ et al. [7] provides more\n   information on generating pseudo-random numbers.\n"
- title: 5.5. Privacy
  contents:
  - "5.5. Privacy\n   Users who have sensitive data that they do not wish others to\
    \ see\n   should use mechanisms outside the scope of this document (such as\n\
    \   encryption) to provide appropriate protection.  Users concerned about\n  \
    \ traffic analysis should consider appropriate use of link encryption.\n   If\
    \ absolute location privacy is desired, the mobile node can create a\n   tunnel\
    \ to its home agent.  Then, datagrams destined for correspondent\n   nodes will\
    \ appear to emanate from the home network, and it may be\n   more difficult to\
    \ pinpoint the location of the mobile node.  Such\n   mechanisms are all beyond\
    \ the scope of this document.\n"
- title: 5.6. Replay Protection for Registration Requests
  contents:
  - "5.6. Replay Protection for Registration Requests\n   The Identification field\
    \ is used to let the home agent verify that a\n   registration message has been\
    \ freshly generated by the mobile node,\n   not replayed by an attacker from some\
    \ previous registration.  Two\n   methods are described in this section:  timestamps\
    \ (mandatory) and\n   \"nonces\" (optional).  All mobile nodes and home agents\
    \ MUST implement\n   timestamp-based replay protection.  These nodes MAY also\
    \ implement\n   nonce-based replay protection (but see Appendix A.2 for a patent\
    \ that\n   may apply to nonce-based replay protection).\n   The style of replay\
    \ protection in effect between a mobile node and\n   its home agent is part of\
    \ the mobile security association.  A mobile\n   node and its home agent MUST\
    \ agree on which method of replay\n   protection will be used.  The interpretation\
    \ of the Identification\n   field depends on the method of replay protection as\
    \ described in the\n   subsequent subsections.\n   Whatever method is used, the\
    \ low-order 32 bits of the Identification\n   MUST be copied unchanged from the\
    \ Registration Request to the Reply.\n   The foreign agent uses those bits (and\
    \ the mobile node's home\n   address) to match Registration Requests with corresponding\
    \ replies.\n   The mobile node MUST verify that the low-order 32 bits of any\n\
    \   Registration Reply are identical to the bits it sent in the\n   Registration\
    \ Request.\n   The Identification in a new Registration Request MUST NOT be the\
    \ same\n   as in an immediately preceding Request, and SHOULD NOT repeat while\n\
    \   the same security context is being used between the mobile node and\n   the\
    \ home agent.  Retransmission as in Section 3.6.3 is allowed.\n"
- title: 5.6.1. Replay Protection using Timestamps
  contents:
  - "5.6.1. Replay Protection using Timestamps\n   The basic principle of timestamp\
    \ replay protection is that the node\n   generating a message inserts the current\
    \ time of day, and the node\n   receiving the message checks that this timestamp\
    \ is sufficiently\n   close to its own time of day.  Obviously the two nodes must\
    \ have\n   adequately synchronized time-of-day clocks.  As with any messages,\n\
    \   time synchronization messages may be protected against tampering by\n   an\
    \ authentication mechanism determined by the security context\n   between the\
    \ two nodes.\n   If timestamps are used, the mobile node MUST set the Identification\n\
    \   field to a 64-bit value formatted as specified by the Network Time\n   Protocol\
    \ [13].  The low-order 32 bits of the NTP format represent\n   fractional seconds,\
    \ and those bits which are not available from a\n   time source SHOULD be generated\
    \ from a good source of randomness.\n   Note, however, that when using timestamps,\
    \ the 64-bit Identification\n   used in a Registration Request from the mobile\
    \ node MUST be greater\n   than that used in any previous Registration Request,\
    \ as the home\n   agent uses this field also as a sequence number.  Without such\
    \ a\n   sequence number, it would be possible for a delayed duplicate of an\n\
    \   earlier Registration Request to arrive at the home agent (within the\n   clock\
    \ synchronization required by the home agent), and thus be\n   applied out of\
    \ order, mistakenly altering the mobile node's current\n   registered care-of\
    \ address.\n   Upon receipt of a Registration Request with a valid Mobile-Home\n\
    \   Authentication Extension, the home agent MUST check the\n   Identification\
    \ field for validity.  In order to be valid, the\n   timestamp contained in the\
    \ Identification field MUST be close enough\n   to the home agent's time of day\
    \ clock and the timestamp MUST be\n   greater than all previously accepted timestamps\
    \ for the requesting\n   mobile node.  Time tolerances and resynchronization details\
    \ are\n   specific to a particular mobility security association.\n   If the timestamp\
    \ is valid, the home agent copies the entire\n   Identification field into the\
    \ Registration Reply it returns the Reply\n   to the mobile node.  If the timestamp\
    \ is not valid, the home agent\n   copies only the low-order 32 bits into the\
    \ Registration Reply, and\n   supplies the high-order 32 bits from its own time\
    \ of day.  In this\n   latter case, the home agent MUST reject the registration\
    \ by returning\n   Code 133 (identification mismatch) in the Registration Reply.\n\
    \   As described in Section 3.6.2.1, the mobile node MUST verify that the\n  \
    \ low-order 32 bits of the Identification in the Registration Reply are\n   identical\
    \ to those in the rejected registration attempt, before using\n   the high-order\
    \ bits for clock resynchronization.\n"
- title: 5.6.2. Replay Protection using Nonces
  contents:
  - "5.6.2. Replay Protection using Nonces\n   Implementors of this optional mechanism\
    \ should examine Appendix A.2\n   for a patent that may be applicable to nonce-based\
    \ replay protection.\n   The basic principle of nonce replay protection is that\
    \ node A\n   includes a new random number in every message to node B, and checks\n\
    \   that node B returns that same number in its next message to node A.\n   Both\
    \ messages use an authentication code to protect against\n   alteration by an\
    \ attacker.  At the same time node B can send its own\n   nonces in all messages\
    \ to node A (to be echoed by node A), so that it\n   too can verify that it is\
    \ receiving fresh messages.\n   The home agent may be expected to have resources\
    \ for computing\n   pseudo-random numbers useful as nonces [7].  It inserts a\
    \ new nonce\n   as the high-order 32 bits of the identification field of every\n\
    \   Registration Reply.  The home agent copies the low-order 32 bits of\n   the\
    \ Identification from the Registration Request message into the\n   low-order\
    \ 32 bits of the Identification in the Registration Reply.\n   When the mobile\
    \ node receives an authenticated Registration Reply\n   from the home agent, it\
    \ saves the high-order 32 bits of the\n   identification for use as the high-order\
    \ 32 bits of its next\n   Registration Request.\n   The mobile node is responsible\
    \ for generating the low-order 32 bits\n   of the Identification in each Registration\
    \ Request.  Ideally it\n   should generate its own random nonces.  However it\
    \ may use any\n   expedient method, including duplication of the random value\
    \ sent by\n   the home agent.  The method chosen is of concern only to the mobile\n\
    \   node, because it is the node that checks for valid values in the\n   Registration\
    \ Reply.  The high-order and low-order 32 bits of the\n   identification chosen\
    \ SHOULD both differ from their previous values.\n   The home agent uses a new\
    \ high-order value and the mobile node uses a\n   new low-order value for each\
    \ registration message.  The foreign agent\n   uses the low-order value (and the\
    \ mobile host's home address) to\n   correctly match registration replies with\
    \ pending Requests (Section\n   3.7.1).\n   If a registration message is rejected\
    \ because of an invalid nonce,\n   the Reply always provides the mobile node with\
    \ a new nonce to be used\n   in the next registration.  Thus the nonce protocol\
    \ is self-\n   synchronizing.\n"
- title: 6. Acknowledgments
  contents:
  - "6. Acknowledgments\n   Special thanks to Steve Deering (Xerox PARC), along with\
    \ Dan Duchamp\n   and John Ioannidis (JI) (Columbia), for forming the working\
    \ group,\n   chairing it, and putting so much effort into its early development.\n\
    \   Thanks also to Kannan Alaggapan, Greg Minshall, and Tony Li for their\n  \
    \ contributions to the group while performing the duties of\n   chairperson, as\
    \ well as for their many useful comments.\n   Thanks to the active members of\
    \ the Mobile IP Working Group,\n   particularly those who contributed text, including\
    \ (in alphabetical\n   order)\n    - Ran Atkinson (Naval Research Lab),\n    -\
    \ Dave Johnson (Carnegie Mellon University),\n    - Frank Kastenholz (FTP Software),\n\
    \    - Anders Klemets (KTH),\n    - Chip Maguire (KTH),\n    - Andrew Myles (Macquarie\
    \ University),\n    - Al Quirt (Bell Northern Research),\n    - Yakov Rekhter\
    \ (IBM), and\n    - Fumio Teraoka (Sony).\n   Thanks to Charlie Kunzinger and\
    \ to Bill Simpson, the editors who\n   produced the first drafts for of this document,\
    \ reflecting the\n   discussions of the Working Group.  Much of the new text of\
    \ this memo\n   is due to Jim Solomon and Dave Johnson.\n   Thanks to Greg Minshall\
    \ (Novell), Phil Karn (Qualcomm), and Frank\n   Kastenholz (FTP Software) for\
    \ their generous support in hosting\n   interim Working Group meetings.\n"
- title: A. Patent Issues
  contents:
  - "A. Patent Issues\n   As of the time of publication, the IETF had been made aware\
    \ of two\n   patents that may be relevant to implementors of the protocol\n  \
    \ described in this technical specification.\n"
- title: 'A.1. IBM Patent #5,159,592'
  contents:
  - "A.1. IBM Patent #5,159,592\n   Charles Perkins, editor of this memo, is sole\
    \ inventor of U.S. Patent\n   No. 5,159,592, assigned to IBM.  In a letter dated\
    \ May 30, 1995, IBM\n   brought this patent to the attention of the IETF, stating\
    \ that this\n   patent \"relates to the Mobile IP.\" We understand that IBM did\
    \ not\n   intend to assert that any particular implementation of Mobile IP\n \
    \  would or would not infringe the patent, but rather that IBM was\n   meeting\
    \ what it viewed as a duty to disclose information that could\n   be relevant\
    \ to the process of adopting a standard.\n   Based on a review of the claims of\
    \ the patent, IETF believes that a\n   system of registering an address obtained\
    \ from a foreign agent, as\n   described in the document, would not necessarily\
    \ infringe any of the\n   claims of the patent; and that a system in which an\
    \ address is\n   obtained elsewhere and then registered can be implemented without\n\
    \   necessarily infringing any claims of the patent.  Accordingly, our\n   view\
    \ is that the proposed protocol can be implemented without\n   necessarily infringing\
    \ the Perkins Patent.\n   Parties considering adopting this protocol must be aware\
    \ that some\n   specific implementations, or features added to otherwise non-\n\
    \   infringing implementations, may raise an issue of infringement with\n   respect\
    \ to this patent or to some other patent.\n   This statement is for the IETF's\
    \ assistance in its standard-setting\n   procedure, and should not be relied upon\
    \ by any party as an opinion\n   or guarantee that any implementation it might\
    \ make or use would not\n   be covered by the Perkins Patent and any other patents.\
    \  In\n   particular, IBM might disagree with the interpretation of this patent\n\
    \   described herein.\n"
- title: 'A.2. IBM Patent #5,148,479'
  contents:
  - "A.2. IBM Patent #5,148,479\n   This patent, also assigned to IBM, may be relevant\
    \ to those who\n   implement nonce-based replay protection as described in Section\n\
    \   5.6.2.  Note that nonce-based replay protection is an optional\n   feature\
    \ of this specification.  Timestamp-based replay protection, on\n   the other\
    \ hand, (Section 5.6.1) is a requirement of this\n   specification.\n"
- title: B. Link-Layer Considerations
  contents:
  - "B. Link-Layer Considerations\n   The mobile node MAY use link-layer mechanisms\
    \ to decide that its\n   point of attachment has changed.  Such indications include\
    \ the\n   Down/Testing/Up interface status [11], and changes in cell or\n   administration.\
    \  The mechanisms will be specific to the particular\n   link-layer technology,\
    \ and are outside the scope of this document.\n   The Point-to-Point-Protocol\
    \ (PPP) [22] and its Internet Protocol\n   Control Protocol (IPCP) [12], negotiates\
    \ the use of IP addresses.\n   The mobile node SHOULD first attempt to specify\
    \ its home address, so\n   that if the mobile node is attaching to its home network,\
    \ the\n   unrouted link will function correctly.  When the home address is not\n\
    \   accepted by the peer, but a transient IP address is dynamically\n   assigned\
    \ to the mobile node, and the mobile node is capable of\n   supporting a co-located\
    \ care-of address, the mobile node MAY register\n   that address as a co-located\
    \ care-of address.  When the peer\n   specifies its own IP address, that address\
    \ MUST NOT be assumed to be\n   a foreign agent care-of address or the IP address\
    \ of a home agent.\n"
- title: C. TCP Considerations
  contents:
  - 'C. TCP Considerations

    '
- title: C.1. TCP Timers
  contents:
  - "C.1. TCP Timers\n   Most hosts and routers which implement TCP/IP do not permit\
    \ easy\n   configuration of the TCP timer values.  When high-delay (e.g.,\n  \
    \ SATCOM) or low-bandwidth (e.g., High-Frequency Radio) links are in\n   use,\
    \ the default TCP timer values in many systems may cause\n   retransmissions or\
    \ timeouts, even when the link and network are\n   actually operating properly\
    \ with greater than usual delays because of\n   the medium in use.  This can cause\
    \ an inability to create or maintain\n   TCP connections over such links, and\
    \ can also cause unneeded\n   retransmissions which consume already scarce bandwidth.\
    \  Vendors are\n   encouraged to make TCP timers more configurable.  Vendors of\
    \ systems\n   designed for the mobile computing markets should pick default timer\n\
    \   values more suited to low-bandwidth, high-delay links.  Users of\n   mobile\
    \ nodes should be sensitive to the possibility of timer-related\n   difficulties.\n"
- title: C.2. TCP Congestion Management
  contents:
  - "C.2. TCP Congestion Management\n   Mobile nodes often use media which are more\
    \ likely to introduce\n   errors, effectively causing more packets to be dropped.\
    \  This\n   introduces a conflict with the mechanisms for congestion management\n\
    \   found in modern versions of TCP [9].  Now, when a packet is dropped,\n   the\
    \ correspondent node's TCP implementation is likely to react as if\n   there were\
    \ a source of network congestion, and initiate the slow-\n   start mechanisms\
    \ [9] designed for controlling that problem.  However,\n   those mechanisms are\
    \ inappropriate for overcoming errors introduced\n   by the links themselves,\
    \ and have the effect of magnifying the\n   discontinuity introduced by the dropped\
    \ packet.  This problem has\n   been analyzed by Caceres, et al. [3]; there is\
    \ no easy solution\n   available, and certainly no solution likely to be installed\
    \ soon on\n   all correspondent nodes.  While this problem is beyond the scope\
    \ of\n   this document, it does illustrate that providing performance\n   transparency\
    \ to mobile nodes involves understanding mechanisms\n   outside the network layer.\
    \  It also indicates the need to avoid\n   designs which systematically drop packets;\
    \ such designs might\n   otherwise be considered favorably when making engineering\
    \ tradeoffs.\n"
- title: D. Example Scenarios
  contents:
  - "D. Example Scenarios\n   This section shows example Registration Requests for\
    \ several common\n   scenarios.\n"
- title: D.1. Registering with a Foreign Agent Care-of Address
  contents:
  - "D.1. Registering with a Foreign Agent Care-of Address\n   The mobile node receives\
    \ an Agent Advertisement from a foreign agent\n   and wishes to register with\
    \ that agent using the advertised foreign\n   agent care-of address.  The mobile\
    \ node wishes only IP-in-IP\n   encapsulation, does not want broadcasts, and does\
    \ not want\n   simultaneous mobility bindings:\n       IP fields:\n         Source\
    \ Address = mobile node's home address\n         Destination Address = copied\
    \ from the IP source address of the\n           Agent Advertisement\n        \
    \ Time to Live = 1\n       UDP fields:\n         Source Port = <any>\n       \
    \  Destination Port = 434\n       Registration Request fields:\n         Type\
    \ = 1\n         S=0,B=0,D=0,M=0,G=0\n         Lifetime = the Registration Lifetime\
    \ copied from the\n           Mobility Agent Advertisement Extension of the\n\
    \           Router Advertisement message\n         Home Address = the mobile node's\
    \ home address\n         Home Agent = IP address of mobile node's home agent\n\
    \         Care-of Address = the Care-of Address copied from the\n           Mobility\
    \ Agent Advertisement Extension of the\n           Router Advertisement message\n\
    \         Identification = Network Time Protocol timestamp or Nonce\n       Extensions:\n\
    \         The Mobile-Home Authentication Extension\n"
- title: D.2. Registering with a Co-Located Care-of Address
  contents:
  - "D.2. Registering with a Co-Located Care-of Address\n   The mobile node enters\
    \ a foreign network that contains no foreign\n   agents.  The mobile node obtains\
    \ an address from a DHCP server [6]\n   for use as a co-located care-of address.\
    \  The mobile node supports\n   all forms of encapsulation (IP-in-IP, minimal\
    \ encapsulation, and\n   GRE), desires a copy of broadcast datagrams on the home\
    \ network, and\n   does not want simultaneous mobility bindings:\n       IP fields:\n\
    \         Source Address = care-of address obtained from DHCP server\n       \
    \  Destination Address = IP address of home agent\n         Time to Live = 64\n\
    \       UDP fields:\n         Source Port = <any>\n         Destination Port =\
    \ 434\n       Registration Request fields:\n         Type = 1\n         S=0,B=1,D=1,M=1,G=1\n\
    \         Lifetime = 1800 (seconds)\n         Home Address = the mobile node's\
    \ home address\n         Home Agent = IP address of mobile node's home agent\n\
    \         Care-of Address = care-of address obtained from DHCP server\n      \
    \   Identification = Network Time Protocol timestamp or Nonce\n       Extensions:\n\
    \         The Mobile-Home Authentication Extension\n"
- title: D.3. Deregistration
  contents:
  - "D.3. Deregistration\n   The mobile node returns home and wishes to deregister\
    \ all care-of\n   addresses with its home agent.\n       IP fields:\n        \
    \ Source Address = mobile node's home address\n         Destination Address =\
    \ IP address of home agent\n         Time to Live = 1\n       UDP fields:\n  \
    \       Source Port = <any>\n         Destination Port = 434\n       Registration\
    \ Request fields:\n         Type = 1\n         S=0,B=0,D=0,M=0,G=0\n         Lifetime\
    \ = 0\n         Home Address = the mobile node's home address\n         Home Agent\
    \ = IP address of mobile node's home agent\n         Care-of Address = the mobile\
    \ node's home address\n         Identification = Network Time Protocol timestamp\
    \ or Nonce\n       Extensions:\n         The Mobile-Home Authentication Extension\n"
- title: E. Applicability of Prefix Lengths Extension
  contents:
  - "E. Applicability of Prefix Lengths Extension\n   Caution is indicated with the\
    \ use of the Prefix Lengths Extension\n   over wireless links, due to the irregular\
    \ coverage areas provided by\n   wireless transmitters.  As a result, it is possible\
    \ that two foreign\n   agents advertising the same prefix might indeed provide\
    \ different\n   connectivity to prospective mobile nodes.  The Prefix-Lengths\n\
    \   Extension SHOULD NOT be included in the advertisements sent by agents\n  \
    \ in such a configuration.\n   Foreign agents using different wireless interfaces\
    \ would have to\n   cooperate using special protocols to provide identical coverage\
    \ in\n   space, and thus be able to claim to have wireless interfaces situated\n\
    \   on the same subnetwork.  In the case of wired interfaces, a mobile\n   node\
    \ disconnecting and subsequently connecting to a new point of\n   attachment,\
    \ may well send in a new Registration Request no matter\n   whether the new advertisement\
    \ is on the same medium as the last\n   recorded advertisement.  And, finally,\
    \ in areas with dense\n   populations of foreign agents it would seem unwise to\
    \ require the\n   propagation via routing protocols of the subnet prefixes associated\n\
    \   with each individual wireless foreign agent; such a strategy could\n   lead\
    \ to quick depletion of available space for routing tables,\n   unwarranted increases\
    \ in the time required for processing routing\n   updates, and longer decision\
    \ times for route selection if routes\n   (which are almost always unnecessary)\
    \ are stored for wireless\n   \"subnets\".\n"
- title: References
  contents:
  - "References\n   [1] Atkinson, R., \"IP Authentication Header\", RFC 1826, August\
    \ 1995.\n   [2] S. M. Bellovin.  Security Problems in the TCP/IP Protocol Suite.\n\
    \       ACM Computer Communications Review, 19(2), March 1989.\n   [3] Ramon Caceres\
    \ and Liviu Iftode.  Improving the Performance\n       of Reliable Transport Protocols\
    \ in Mobile Computing\n       Environments.  IEEE Journal on Selected Areas in\
    \ Communications,\n       13(5):850--857, June 1995.\n   [4] Deering, S., Editor,\
    \ \"ICMP Router Discovery Messages\",\n       RFC 1256, September 1991.\n   [5]\
    \ Deering, S., \"Host Extensions for IP Multicasting\", STD 5,\n       RFC 1112,\
    \ August 1989.\n   [6] Droms, R., \"Dynamic Host Configuration Protocol\", RFC\
    \ 1541,\n       October 1993.\n   [7] Eastlake, D., Crocker, S., and J. Schiller,\
    \ \"Randomness\n       Requirements for Security\", RFC 1750, December 1994.\n\
    \   [8] Hanks, S., Li, R., Farinacci, D., and P. Traina, \"Generic\n       Routing\
    \ Encapsulation (GRE)\", RFC 1701, October 1994.\n   [9] Van Jacobson.  Congestion\
    \ Avoidance and Control.  In Proceedings\n       of the SIGCOMM '88 Symposium:\
    \  Communications Architectures &\n       Protocols, pages 314--329, August 1988.\n\
    \   [10] Jacobson, V., \"Compressing TCP/IP Headers for Low-Speed Serial\n   \
    \     Links\", RFC 1144, February 1990.\n   [11] McCloghrie, K., and F. Kastenholz,\
    \ \"Evolution of the\n        Interfaces Group of MIB-II\", RFC 1573, January\
    \ 1994.\n   [12] McGregor, G., \"The PPP Internet Protocol Control Protocol\n\
    \        (IPCP)\", RFC 1332, May 1992.\n   [13] Mills, D., \"Network Time Protocol\
    \ (Version 3):\n        Specification, Implementation and Analysis\", RFC 1305,\
    \ March\n        1992.\n   [14] Perkins, C., \"IP Encapsulation within IP\", RFC\
    \ 2003,\n        October 1996.\n   [15] Perkins, C., \"Minimal Encapsulation within\
    \ IP\", RFC 2004,\n        October 1996.\n   [16] Plummer, D., \"An Ethernet Address\
    \ Resolution Protocol:\n        Or Converting Network Protocol Addresses to 48.bit\
    \ Ethernet\n        Addresses for Transmission on Ethernet Hardware\", STD 37,\n\
    \        RFC 826, November 1982.\n   [17] Postel, J., \"User Datagram Protocol\"\
    , STD 6, RFC 768, August\n        1980.\n   [18] Postel, J., \"Multi-LAN Address\
    \ Resolution\", RFC 925, October\n        1984.\n   [19] Postel, J., Editor, \"\
    Internet Protocol\", STD 5, RFC 791,\n        September 1981.\n   [20] Reynolds,\
    \ J., and J. Postel, \"Assigned Numbers\", STD 2,\n        RFC 1700, October 1994.\n\
    \   [21] Rivest, R., \"The MD5 Message-Digest Algorithm\", RFC 1321,\n       \
    \ April 1992.\n   [22] Simpson, W., Editor, \"The Point-to-Point Protocol\n  \
    \      (PPP)\", STD 51, RFC 1661, July 1994.\n   [23] W. Richard Stevens.  TCP/IP\
    \ Illustrated, Volume 1:  The\n        Protocols.  Addison-Wesley, Reading, Massachusetts,\
    \ 1994.\n"
- title: Editor's Address
  contents:
  - "Editor's Address\n   Questions about this memo can also be directed to the editor:\n\
    \   Charles Perkins\n   Room H3-D34\n   T. J. Watson Research Center\n   IBM Corporation\n\
    \   30 Saw Mill River Rd.\n   Hawthorne, NY  10532\n   Work:   +1-914-784-7350\n\
    \   Fax:    +1-914-784-6205\n   EMail: perk@watson.ibm.com\n   The working group\
    \ can be contacted via the current chair:\n      Jim Solomon\n      Motorola,\
    \ Inc.\n      1301 E. Algonquin Rd.\n      Schaumburg, IL  60196\n      Work:\
    \   +1-847-576-2753\n      EMail: solomon@comm.mot.com\n"
