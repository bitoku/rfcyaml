- title: __initial_text__
  contents:
  - '                 OSPFv3 Extensions for Segment Routing

    '
- title: Abstract
  contents:
  - "Abstract\n   Segment Routing (SR) allows a flexible definition of end-to-end\
    \ paths\n   within IGP topologies by encoding paths as sequences of topological\n\
    \   subpaths called \"segments\".  These segments are advertised by the\n   link-state\
    \ routing protocols (IS-IS and OSPF).\n   This document describes the OSPFv3 extensions\
    \ required for Segment\n   Routing with the MPLS data plane.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This\
    \ document is a product of the Internet Engineering Task Force\n   (IETF).  It\
    \ represents the consensus of the IETF community.  It has\n   received public\
    \ review and has been approved for publication by the\n   Internet Engineering\
    \ Steering Group (IESG).  Further information on\n   Internet Standards is available\
    \ in Section 2 of RFC 7841.\n   Information about the current status of this document,\
    \ any errata,\n   and how to provide feedback on it may be obtained at\n   https://www.rfc-editor.org/info/rfc8666.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2019 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (https://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.  Code Components\
    \ extracted from this document must\n   include Simplified BSD License text as\
    \ described in Section 4.e of\n   the Trust Legal Provisions and are provided\
    \ without warranty as\n   described in the Simplified BSD License.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1.  Introduction\n   2.  Terminology\n   3.  Segment Routing\
    \ Identifiers\n     3.1.  SID/Label Sub-TLV\n   4.  Segment Routing Capabilities\n\
    \   5.  OSPFv3 Extended Prefix Range TLV\n   6.  Prefix-SID Sub-TLV\n   7.  Adjacency\
    \ Segment Identifier (Adj-SID)\n     7.1.  Adj-SID Sub-TLV\n     7.2.  LAN Adj-SID\
    \ Sub-TLV\n   8.  Elements of Procedure\n     8.1.  Intra-area Segment Routing\
    \ in OSPFv3\n     8.2.  Inter-area Segment Routing in OSPFv3\n     8.3.  Segment\
    \ Routing for External Prefixes\n     8.4.  Advertisement of Adj-SID\n       8.4.1.\
    \  Advertisement of Adj-SID on Point-to-Point Links\n       8.4.2.  Adjacency\
    \ SID on Broadcast or NBMA Interfaces\n   9.  IANA Considerations\n     9.1. \
    \ \"OSPFv3 Extended-LSA TLVs\" Registry\n     9.2.  \"OSPFv3 Extended-LSA Sub-TLVs\"\
    \ Registry\n   10. TLV/Sub-TLV Error Handling\n   11. Security Considerations\n\
    \   12. References\n     12.1.  Normative References\n     12.2.  Informative\
    \ References\n   Contributors\n   Authors' Addresses\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   Segment Routing (SR) allows a flexible definition of end-to-end\
    \ paths\n   within IGP topologies by encoding paths as sequences of topological\n\
    \   subpaths called \"segments\".  These segments are advertised by the\n   link-state\
    \ routing protocols (IS-IS and OSPF).  Prefix segments\n   represent an ECMP-aware\
    \ shortest path to a prefix (or a node) as per\n   the state of the IGP topology.\
    \  Adjacency segments represent a hop\n   over a specific adjacency between two\
    \ nodes in the IGP.  A prefix\n   segment is typically a multi-hop path while\
    \ an adjacency segment, in\n   most cases, is a one-hop path.  SR's control plane\
    \ can be applied to\n   both IPv6 and MPLS data planes, and it does not require\
    \ any\n   additional signaling (other than IGP extensions).  The IPv6 data\n \
    \  plane is out of the scope of this specification; the OSPFv3 extension\n   for\
    \ SR with the IPv6 data plane will be specified in a separate\n   document.  When\
    \ used in MPLS networks, SR paths do not require any\n   LDP or RSVP-TE signaling.\
    \  However, SR can interoperate in the\n   presence of Label Switched Paths (LSPs)\
    \ established with RSVP or LDP.\n   This document describes the OSPFv3 extensions\
    \ required for Segment\n   Routing with the MPLS data plane.\n   Segment Routing\
    \ architecture is described in [RFC8402].\n   Segment Routing use cases are described\
    \ in [RFC7855].\n"
- title: 2.  Terminology
  contents:
  - "2.  Terminology\n   This section lists some of the terminology used in this document:\n\
    \   ABR:        Area Border Router\n   Adj-SID:    Adjacency Segment Identifier\n\
    \   AS:         Autonomous System\n   ASBR:       Autonomous System Boundary Router\n\
    \   DR:         Designated Router\n   IS-IS:      Intermediate System to Intermediate\
    \ System\n   LDP:        Label Distribution Protocol\n   LSP:        Label Switched\
    \ Path\n   MPLS:       Multiprotocol Label Switching\n   OSPF:       Open Shortest\
    \ Path First\n   SPF:        Shortest Path First\n   RSVP:       Resource Reservation\
    \ Protocol\n   SID:        Segment Identifier\n   SR:         Segment Routing\n\
    \   SRGB:       Segment Routing Global Block\n   SRLB:       Segment Routing Local\
    \ Block\n   SRMS:       Segment Routing Mapping Server\n   TLV:        Type Length\
    \ Value\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\", \"SHALL\", \"\
    SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"NOT RECOMMENDED\"\
    , \"MAY\", and\n   \"OPTIONAL\" in this document are to be interpreted as described\
    \ in BCP\n   14 [RFC2119] [RFC8174] when, and only when, they appear in all\n\
    \   capitals, as shown here.\n"
- title: 3.  Segment Routing Identifiers
  contents:
  - "3.  Segment Routing Identifiers\n   Segment Routing defines various types of\
    \ Segment Identifiers (SIDs):\n   Prefix-SID, Adjacency SID, and LAN Adjacency\
    \ SID.\n"
- title: 3.1.  SID/Label Sub-TLV
  contents:
  - "3.1.  SID/Label Sub-TLV\n   The SID/Label sub-TLV appears in multiple TLVs or\
    \ sub-TLVs defined\n   later in this document.  It is used to advertise the SID\
    \ or label\n   associated with a prefix or adjacency.  The SID/Label sub-TLV has\
    \ the\n   following format:\n    0                   1                   2   \
    \                3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6\
    \ 7 8 9 0 1\n   |              Type             |             Length         \
    \   |\n   |                      SID/Label (variable)                     |\n\
    \   where:\n      Type:  7\n      Length:  3 or 4 octets.\n      SID/Label:  If\
    \ the length is set to 3, then the 20 rightmost bits\n         represent a label.\
    \  If the length is set to 4, then the value\n         represents a 32-bit SID.\n"
- title: 4.  Segment Routing Capabilities
  contents:
  - "4.  Segment Routing Capabilities\n   Segment Routing requires some additional\
    \ router capabilities to be\n   advertised to other routers in the area.\n   These\
    \ SR capabilities are advertised in the OSPFv3 Router Information\n   Opaque LSA\
    \ (defined in [RFC7770]) and specified in [RFC8665].\n"
- title: 5.  OSPFv3 Extended Prefix Range TLV
  contents:
  - "5.  OSPFv3 Extended Prefix Range TLV\n   In some cases, it is useful to advertise\
    \ attributes for a range of\n   prefixes in a single advertisement.  The SR Mapping\
    \ Server, which is\n   described in [RFC8661], is an example of where SIDs for\
    \ multiple\n   prefixes can be advertised.  To optimize such advertisement in\
    \ case\n   of multiple prefixes from a contiguous address range, OSPFv3 Extended\n\
    \   Prefix Range TLV is defined.\n   The OSPFv3 Extended Prefix Range TLV is a\
    \ top-level TLV of the\n   following LSAs defined in [RFC8362]:\n      E-Intra-Area-Prefix-LSA\n\
    \      E-Inter-Area-Prefix-LSA\n      E-AS-External-LSA\n      E-Type-7-LSA\n\
    \   Multiple OSPFv3 Extended Prefix Range TLVs MAY be advertised in each\n   LSA\
    \ mentioned above.  The OSPFv3 Extended Prefix Range TLV has the\n   following\
    \ format:\n    0                   1                   2                   3\n\
    \    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   |   \
    \           Type             |             Length            |\n   | Prefix Length\
    \ |       AF      |         Range Size            |\n   |    Flags      |    \
    \             Reserved                      |\n   |                     Address\
    \ Prefix (variable)                 |\n   |                      Sub-TLVs (variable)\
    \                      |\n   where:\n      Type:  9\n      Length:  Variable,\
    \ in octets, depending on the sub-TLVs.\n      Prefix Length:  Length of prefix\
    \ in bits.\n      AF:  Address family for the prefix.\n         AF:  0 - IPv4\
    \ unicast\n         AF:  1 - IPv6 unicast\n      Range Size:  Represents the number\
    \ of prefixes that are covered by\n         the advertisement.  The Range Size\
    \ MUST NOT exceed the number\n         of prefixes that could be satisfied by\
    \ the Prefix Length\n         without including:\n            Addresses from the\
    \ IPv4 multicast address range\n            (224.0.0.0/3), if the AF is IPv4 unicast.\n\
    \            Addresses other than the IPv6 unicast addresses, if the AF\n    \
    \        is IPv6 unicast.\n      Flags:  Reserved.  MUST be zero when sent and\
    \ are ignored when\n         received.\n      Reserved:  SHOULD be set to 0 on\
    \ transmission and MUST be ignored\n         on reception.\n      Address Prefix:\
    \  For the address family IPv4 unicast, the\n            prefix itself is encoded\
    \ as a 32-bit value.  The default\n            route is represented by a prefix\
    \ of length 0.\n            For the address family IPv6 unicast, the\n       \
    \     prefix is encoded as an even multiple of 32-bit words and\n            padded\
    \ with zeroed bits as necessary.  This encoding\n            consumes ((PrefixLength\
    \ + 31) / 32) 32-bit words.\n            Prefix encoding for other address families\
    \ is\n            beyond the scope of this specification.  Prefix encoding for\n\
    \            other address families can be defined in future Standards\n     \
    \       Track specifications from the IETF stream.\n   The range represents the\
    \ contiguous set of prefixes with the same\n   prefix length as specified by the\
    \ Prefix Length field.  The set\n   starts with the prefix that is specified by\
    \ the Address Prefix field.\n   The number of prefixes in the range is equal to\
    \ the Range Size.\n   If the OSPFv3 Extended Prefix Range TLVs advertising the\
    \ exact same\n   range appears in multiple LSAs of the same type, originated by\
    \ the\n   same OSPFv3 router, the LSA with the numerically smallest Instance ID\n\
    \   MUST be used, and subsequent instances of the OSPFv3 Extended Prefix\n   Range\
    \ TLVs MUST be ignored.\n"
- title: 6.  Prefix-SID Sub-TLV
  contents:
  - "6.  Prefix-SID Sub-TLV\n   The Prefix-SID sub-TLV is a sub-TLV of the following\
    \ OSPFv3 TLVs as\n   defined in [RFC8362] and in Section 5:\n      Intra-Area\
    \ Prefix TLV\n      Inter-Area Prefix TLV\n      External Prefix TLV\n      OSPFv3\
    \ Extended Prefix Range TLV\n   It MAY appear more than once in the parent TLV\
    \ and has the following\n   format:\n    0                   1               \
    \    2                   3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2\
    \ 3 4 5 6 7 8 9 0 1\n   |               Type            |            Length  \
    \           |\n   |     Flags     |  Algorithm    |           Reserved       \
    \     |\n   |                       SID/Index/Label (variable)              |\n\
    \   where:\n      Type:  4\n      Length:  7 or 8 octets, depending on the V-Flag.\n\
    \      Flags:  Single-octet field.  The following flags are defined:\n       \
    \    0  1  2  3  4  5  6  7\n         |  |NP|M |E |V |L |  |  |\n         where:\n\
    \         NP-Flag:  No-PHP (Penultimate Hop Popping) Flag.  If set, then\n   \
    \         the penultimate hop MUST NOT pop the Prefix-SID before\n           \
    \ delivering packets to the node that advertised the Prefix-\n            SID.\n\
    \         M-Flag:  Mapping Server Flag.  If set, the SID was advertised\n    \
    \        by an SR Mapping Server as described in [RFC8661].\n         E-Flag:\
    \  Explicit Null Flag.  If set, any upstream neighbor of\n            the Prefix-SID\
    \ originator MUST replace the Prefix-SID with\n            the Explicit NULL label\
    \ (0 for IPv4, 2 for IPv6) before\n            forwarding the packet.\n      \
    \   V-Flag:  Value/Index Flag.  If set, then the Prefix-SID carries\n        \
    \    an absolute value.  If not set, then the Prefix-SID carries\n           \
    \ an index.\n         L-Flag:  Local/Global Flag.  If set, then the value/index\n\
    \            carried by the Prefix-SID has local significance.  If not\n     \
    \       set, then the value/index carried by this sub-TLV has global\n       \
    \     significance.\n         Other bits:  Reserved.  These MUST be zero when\
    \ sent and are\n            ignored when received.\n      Reserved:  SHOULD be\
    \ set to 0 on transmission and MUST be ignored\n         on reception.\n     \
    \ Algorithm:  Single octet identifying the algorithm the Prefix-SID\n        \
    \ is associated with as defined in the IGP Algorithm Types\n         registry\
    \ [ALGOREG].\n         A router receiving a Prefix-SID from a remote node and\
    \ with an\n         algorithm value that the remote node has not advertised in\
    \ the\n         SR-Algorithm TLV [RFC8665] MUST ignore the Prefix-SID sub-TLV.\n\
    \      SID/Index/Label:  According to the V-Flag and L-Flag, it contains:\n  \
    \          V-Flag is set to 0 and L-Flag is set to 0: The SID/Index/\n       \
    \     Label field is a 4-octet index defining the offset in the\n            SID/Label\
    \ space advertised by this router.\n            V-Flag is set to 1 and L-Flag\
    \ is set to 1: The SID/Index/\n            Label field is a 3-octet local label\
    \ where the 20 rightmost\n            bits are used for encoding the label value.\n\
    \            All other combinations of V-Flag and L-Flag are invalid and\n   \
    \         any SID Advertisement received with an invalid setting for\n       \
    \     V- and L-Flags MUST be ignored.\n   If an OSPFv3 router advertises multiple\
    \ Prefix-SIDs for the same\n   prefix, topology, and algorithm, all of them MUST\
    \ be ignored.\n   When calculating the outgoing label for the prefix, the router\
    \ MUST\n   take into account, as described below, the E-, NP-, and M-Flags\n \
    \  advertised by the next-hop router if that router advertised the SID\n   for\
    \ the prefix.  This MUST be done regardless of whether the next-hop\n   router\
    \ contributes to the best path to the prefix.\n   The NP-Flag (No-PHP) MUST be\
    \ set and the E-Flag MUST be clear for\n   Prefix-SIDs allocated to prefixes that\
    \ are propagated between areas\n   by an ABR based on intra-area or inter-area\
    \ reachability, unless the\n   advertised prefix is directly attached to such\
    \ ABR.\n   The NP-Flag (No-PHP) MUST be set and the E-Flag MUST be clear for\n\
    \   Prefix-SIDs allocated to redistributed prefixes, unless the\n   redistributed\
    \ prefix is directly attached to the advertising ASBR.\n   If the NP-Flag is not\
    \ set, then:\n      Any upstream neighbor of the Prefix-SID originator MUST pop\
    \ the\n      Prefix-SID.  This is equivalent to the penultimate hop-popping\n\
    \      mechanism used in the MPLS data plane.\n      The received E-Flag is ignored.\n\
    \   If the NP-Flag is set and the E-Flag is not set, then:\n      Any upstream\
    \ neighbor of the Prefix-SID originator MUST keep the\n      Prefix-SID on top\
    \ of the stack.  This is useful when the\n      originator of the Prefix-SID needs\
    \ to stitch the incoming packet\n      into a continuing MPLS LSP to the final\
    \ destination.  This could\n      occur at an ABR (prefix propagation from one\
    \ area to another) or\n      at an ASBR (prefix propagation from one domain to\
    \ another).\n   If both the NP-Flag and E-Flag are set, then:\n      Any upstream\
    \ neighbor of the Prefix-SID originator MUST replace\n      the Prefix-SID with\
    \ an Explicit NULL label.  This is useful, e.g.,\n      when the originator of\
    \ the Prefix-SID is the final destination for\n      the related prefix and the\
    \ originator wishes to receive the packet\n      with the original Traffic Class\
    \ field [RFC5462].\n   When the M-Flag is set, the NP-Flag and the E-Flag MUST\
    \ be ignored on\n   reception.\n   As the Mapping Server does not specify the\
    \ originator of a prefix\n   advertisement, it is not possible to determine PHP\
    \ behavior solely\n   based on the Mapping Server Advertisement.  However, PHP\
    \ behavior\n   SHOULD be done in the following cases:\n      The Prefix is intra-area\
    \ type and the downstream neighbor is the\n      originator of the prefix.\n \
    \     The Prefix is inter-area type and the downstream neighbor is an\n      ABR,\
    \ which is advertising prefix reachability and is setting the\n      LA-bit in\
    \ the Prefix Options as described in [RFC8362].\n      The Prefix is external\
    \ type and the downstream neighbor is an\n      ASBR, which is advertising prefix\
    \ reachability and is setting the\n      LA-bit in the Prefix Options as described\
    \ in [RFC8362].\n   When a Prefix-SID is advertised in the OSPFv3 Extended Prefix\
    \ Range\n   TLV, then the value advertised in the Prefix-SID sub-TLV is\n   interpreted\
    \ as a starting SID/Label value.\n   Example 1: If the following router addresses\
    \ (loopback addresses)\n   need to be mapped into the corresponding Prefix-SID\
    \ indexes:\n             Router-A: 2001:DB8::1/128, Prefix-SID: Index 1\n    \
    \         Router-B: 2001:DB8::2/128, Prefix-SID: Index 2\n             Router-C:\
    \ 2001:DB8::3/128, Prefix-SID: Index 3\n             Router-D: 2001:DB8::4/128,\
    \ Prefix-SID: Index 4\n   then the Address Prefix field in the OSPFv3 Extended\
    \ Prefix Range TLV\n   would be set to 2001:DB8::1, the Prefix Length would be\
    \ set to 128,\n   the Range Size would be set to 4, and the Index value in the\
    \ Prefix-\n   SID sub-TLV would be set to 1.\n   Example 2: If the following prefixes\
    \ need to be mapped into the\n   corresponding Prefix-SID indexes:\n         \
    \    2001:DB8:1::0/120,   Prefix-SID: Index 51\n             2001:DB8:1::100/120,\
    \ Prefix-SID: Index 52\n             2001:DB8:1::200/120, Prefix-SID: Index 53\n\
    \             2001:DB8:1::300/120, Prefix-SID: Index 54\n             2001:DB8:1::400/120,\
    \ Prefix-SID: Index 55\n             2001:DB8:1::500/120, Prefix-SID: Index 56\n\
    \             2001:DB8:1::600/120, Prefix-SID: Index 57\n   then the Prefix field\
    \ in the OSPFv3 Extended Prefix Range TLV would\n   be set to 2001:DB8:1::0, the\
    \ Prefix Length would be set to 120, the\n   Range Size would be set to 7, and\
    \ the Index value in the Prefix-SID\n   sub-TLV would be set to 51.\n"
- title: 7.  Adjacency Segment Identifier (Adj-SID)
  contents:
  - "7.  Adjacency Segment Identifier (Adj-SID)\n   An Adjacency Segment Identifier\
    \ (Adj-SID) represents a router\n   adjacency in Segment Routing.\n"
- title: 7.1.  Adj-SID Sub-TLV
  contents:
  - "7.1.  Adj-SID Sub-TLV\n   The Adj-SID sub-TLV is an optional sub-TLV of the Router-Link\
    \ TLV as\n   defined in [RFC8362].  It MAY appear multiple times in the Router-\n\
    \   Link TLV.  The Adj-SID sub-TLV has the following format:\n    0          \
    \         1                   2                   3\n    0 1 2 3 4 5 6 7 8 9 0\
    \ 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   |               Type         \
    \   |              Length           |\n   | Flags         |     Weight    |  \
    \           Reserved          |\n   |                   SID/Label/Index (variable)\
    \                  |\n   where:\n      Type:  5\n      Length:  7 or 8 octets,\
    \ depending on the V-Flag.\n      Flags:  Single-octet field containing the following\
    \ flags:\n             0 1 2 3 4 5 6 7\n            +-+-+-+-+-+-+-+-+\n      \
    \      |B|V|L|G|P|     |\n            +-+-+-+-+-+-+-+-+\n         where:\n   \
    \      B-Flag:  Backup Flag.  If set, the Adj-SID refers to an\n            adjacency\
    \ that is eligible for protection (e.g., using IP\n            Fast Reroute (IPFRR)\
    \ or MPLS-FRR (MPLS Fast Reroute)) as\n            described in Section 3.4 of\
    \ [RFC8402].\n         V-Flag:  Value/Index Flag.  If set, then the Adj-SID carries\
    \ an\n            absolute value.  If not set, then the Adj-SID carries an\n \
    \           index.\n         L-Flag:  Local/Global Flag.  If set, then the value/index\n\
    \            carried by the Adj-SID has local significance.  If not set,\n   \
    \         then the value/index carried by this sub-TLV has global\n          \
    \  significance.\n         G-Flag:  Group Flag.  When set, the G-Flag indicates\
    \ that the\n            Adj-SID refers to a group of adjacencies (and therefore\
    \ MAY\n            be assigned to other adjacencies as well).\n         P-Flag.\
    \  Persistent Flag.  When set, the P-Flag indicates that\n            the Adj-SID\
    \ is persistently allocated, i.e., the Adj-SID\n            value remains the\
    \ same across router restart and/or\n            interface flap.\n         Other\
    \ bits:  Reserved.  These MUST be zero when sent and are\n            ignored\
    \ when received.\n      Reserved:  SHOULD be set to 0 on transmission and MUST\
    \ be ignored\n         on reception.\n      Weight:  Weight used for load-balancing\
    \ purposes.  The use of the\n         weight is defined in [RFC8402].\n      SID/Index/Label:\
    \  As described in Section 6.\n   An SR-capable router MAY allocate an Adj-SID\
    \ for each of its\n   adjacencies and set the B-Flag when the adjacency is eligible\
    \ for\n   protection by an FRR mechanism (IP or MPLS) as described in\n   [RFC8402].\n\
    \   An SR-capable router MAY allocate more than one Adj-SID to an\n   adjacency.\n\
    \   An SR-capable router MAY allocate the same Adj-SID to different\n   adjacencies.\n\
    \   When the P-Flag is not set, the Adj-SID MAY be persistent.  When the\n   P-Flag\
    \ is set, the Adj-SID MUST be persistent.\n"
- title: 7.2.  LAN Adj-SID Sub-TLV
  contents:
  - "7.2.  LAN Adj-SID Sub-TLV\n   The LAN Adjacency SID is an optional sub-TLV of\
    \ the Router-Link TLV.\n   It MAY appear multiple times in the Router-Link TLV.\
    \  It is used to\n   advertise a SID/Label for an adjacency to a non-DR router\
    \ on a\n   broadcast, Non-Broadcast Multi-Access (NBMA), or hybrid [RFC6845]\n\
    \   network.\n    0                   1                   2                  \
    \ 3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   |\
    \              Type             |            Length             |\n   |     Flags\
    \     |     Weight    |            Reserved           |\n   |                \
    \           Neighbor ID                         |\n   |                    SID/Label/Index\
    \ (variable)                 |\n   where:\n      Type:  6\n      Length:  11 or\
    \ 12 octets, depending on the V-Flag.\n      Flags:  Same as in Section 7.1.\n\
    \      Weight:  Weight used for load-balancing purposes.  The use of the\n   \
    \      weight is defined in [RFC8402].\n      Reserved:  SHOULD be set to 0 on\
    \ transmission and MUST be ignored\n         on reception.\n      Neighbor ID:\
    \  The Router ID of the neighbor for which the LAN\n         Adjacency SID is\
    \ advertised.\n      SID/Index/Label:  As described in Section 6.\n         When\
    \ the P-Flag is not set, the LAN Adjacency SID MAY be\n         persistent.  When\
    \ the P-Flag is set, the LAN Adjacency SID MUST\n         be persistent.\n"
- title: 8.  Elements of Procedure
  contents:
  - '8.  Elements of Procedure

    '
- title: 8.1.  Intra-area Segment Routing in OSPFv3
  contents:
  - "8.1.  Intra-area Segment Routing in OSPFv3\n   An OSPFv3 router that supports\
    \ Segment Routing MAY advertise Prefix-\n   SIDs for any prefix to which it is\
    \ advertising reachability (e.g., a\n   loopback IP address as described in Section\
    \ 6).\n   A Prefix-SID can also be advertised by SR Mapping Servers (as\n   described\
    \ in [RFC8661]).  A Mapping Server advertises Prefix-SIDs for\n   remote prefixes\
    \ that exist in the OSPFv3 routing domain.  Multiple\n   Mapping Servers can advertise\
    \ Prefix-SIDs for the same prefix, in\n   which case the same Prefix-SID MUST\
    \ be advertised by all of them.\n   The SR Mapping Server could use either area\
    \ flooding scope or\n   autonomous system flooding scope when advertising Prefix-SIDs\
    \ for\n   prefixes, based on the configuration of the SR Mapping Server.\n   Depending\
    \ on the flooding scope used, the SR Mapping Server chooses\n   the OSPFv3 LSA\
    \ type that will be used.  If the area flooding scope is\n   needed, an E-Intra-Area-Prefix-LSA\
    \ [RFC8362] is used.  If autonomous\n   system flooding scope is needed, an E-AS-External-LSA\
    \ [RFC8362] is\n   used.\n   When a Prefix-SID is advertised by the Mapping Server,\
    \ which is\n   indicated by the M-Flag in the Prefix-SID sub-TLV (Section 6),\
    \ the\n   route type as implied by the LSA type is ignored and the Prefix-SID\n\
    \   is bound to the corresponding prefix independent of the route type.\n   Advertisement\
    \ of the Prefix-SID by the Mapping Server using an Inter-\n   Area Prefix TLV,\
    \ External-Prefix TLV, or Intra-Area-Prefix TLV\n   [RFC8362] does not itself\
    \ contribute to the prefix reachability.  The\n   NU-bit [RFC5340] MUST be set\
    \ in the PrefixOptions field of the LSA,\n   which is used by the Mapping Server\
    \ to advertise SID or SID Range,\n   which prevents the advertisement from contributing\
    \ to prefix\n   reachability.\n   An SR Mapping Server MUST use the OSPFv3 Extended\
    \ Prefix Range TLVs\n   when advertising SIDs for prefixes.  Prefixes of different\
    \ route\n   types can be combined in a single OSPFv3 Extended Prefix Range TLV\n\
    \   advertised by an SR Mapping Server.\n   Area-scoped OSPFv3 Extended Prefix\
    \ Range TLVs are propagated between\n   areas, similar to propagation of prefixes\
    \ between areas.  Same rules\n   that are used for propagating prefixes between\
    \ areas [RFC5340] are\n   used for the propagation of the prefix ranges.\n"
- title: 8.2.  Inter-area Segment Routing in OSPFv3
  contents:
  - "8.2.  Inter-area Segment Routing in OSPFv3\n   In order to support SR in a multiarea\
    \ environment, OSPFv3 MUST\n   propagate Prefix-SID information between areas.\
    \  The following\n   procedure is used to propagate Prefix-SIDs between areas.\n\
    \   When an OSPFv3 ABR advertises an Inter-Area-Prefix-LSA from an intra-\n  \
    \ area prefix to all its connected areas, it will also include the\n   Prefix-SID\
    \ sub-TLV as described in Section 6.  The Prefix-SID value\n   will be set as\
    \ follows:\n      The ABR will look at its best path to the prefix in the source\n\
    \      area and find the advertising router associated with the best path\n  \
    \    to that prefix.\n      The ABR will then determine if this router advertised\
    \ a Prefix-SID\n      for the prefix and use it when advertising the Prefix-SID\
    \ to other\n      connected areas.\n      If no Prefix-SID was advertised for\
    \ the prefix in the source area\n      by the router that contributes to the best\
    \ path to the prefix, the\n      originating ABR will use the Prefix-SID advertised\
    \ by any other\n      router when propagating the Prefix-SID for the prefix to\
    \ other\n      areas.\n   When an OSPFv3 ABR advertises an Inter-Area-Prefix-LSA\
    \ from an inter-\n   area route to all its connected areas, it will also include\
    \ the\n   Prefix-SID sub-TLV as described in Section 6.  The Prefix-SID value\n\
    \   will be set as follows:\n      The ABR will look at its best path to the prefix\
    \ in the backbone\n      area and find the advertising router associated with\
    \ the best path\n      to that prefix.\n      The ABR will then determine if this\
    \ router advertised a Prefix-SID\n      for the prefix and use it when advertising\
    \ the Prefix-SID to other\n      connected areas.\n      If no Prefix-SID was\
    \ advertised for the prefix in the backbone\n      area by the ABR that contributes\
    \ to the best path to the prefix,\n      the originating ABR will use the Prefix-SID\
    \ advertised by any\n      other router when propagating the Prefix-SID for the\
    \ prefix to\n      other areas.\n"
- title: 8.3.  Segment Routing for External Prefixes
  contents:
  - "8.3.  Segment Routing for External Prefixes\n   AS-External-LSAs are flooded\
    \ domain wide.  When an ASBR, which\n   supports SR, originates an E-AS-External-LSA,\
    \ it SHOULD also include\n   a Prefix-SID sub-TLV as described in Section 6. \
    \ The Prefix-SID value\n   will be set to the SID that has been reserved for that\
    \ prefix.\n   When a Not-So-Stubby Area (NSSA) [RFC3101] ABR translates an E-NSSA-\n\
    \   LSA into an E-AS-External-LSA, it SHOULD also advertise the Prefix-\n   SID\
    \ for the prefix.  The NSSA ABR determines its best path to the\n   prefix advertised\
    \ in the translated E-NSSA-LSA and finds the\n   advertising router associated\
    \ with that path.  If the advertising\n   router has advertised a Prefix-SID for\
    \ the prefix, then the NSSA ABR\n   uses it when advertising the Prefix-SID for\
    \ the E-AS-External-LSA.\n   Otherwise, the Prefix-SID advertised by any other\
    \ router will be\n   used.\n"
- title: 8.4.  Advertisement of Adj-SID
  contents:
  - "8.4.  Advertisement of Adj-SID\n   The Adjacency Segment Routing Identifier (Adj-SID)\
    \ is advertised\n   using the Adj-SID sub-TLV as described in Section 7.\n"
- title: 8.4.1.  Advertisement of Adj-SID on Point-to-Point Links
  contents:
  - "8.4.1.  Advertisement of Adj-SID on Point-to-Point Links\n   An Adj-SID MAY be\
    \ advertised for any adjacency on a point-to-point\n   (P2P) link that is in neighbor\
    \ state 2-Way or higher.  If the\n   adjacency on a P2P link transitions from\
    \ the FULL state, then the\n   Adj-SID for that adjacency MAY be removed from\
    \ the area.  If the\n   adjacency transitions to a state lower than 2-Way, then\
    \ the Adj-SID\n   Advertisement MUST be withdrawn from the area.\n"
- title: 8.4.2.  Adjacency SID on Broadcast or NBMA Interfaces
  contents:
  - "8.4.2.  Adjacency SID on Broadcast or NBMA Interfaces\n   Broadcast, NBMA, or\
    \ hybrid [RFC6845] networks in OSPFv3 are\n   represented by a star topology where\
    \ the DR is the central point to\n   which all other routers on the broadcast,\
    \ NBMA, or hybrid network\n   connect.  As a result, routers on the broadcast,\
    \ NBMA, or hybrid\n   network advertise only their adjacency to the DR.  Routers\
    \ that do\n   not act as DR do not form or advertise adjacencies with each other.\n\
    \   They do, however, maintain 2-Way adjacency state with each other and\n   are\
    \ directly reachable.\n   When Segment Routing is used, each router on the broadcast,\
    \ NBMA, or\n   hybrid network MAY advertise the Adj-SID for its adjacency to the\
    \ DR\n   using the Adj-SID sub-TLV as described in Section 7.1.\n   SR-capable\
    \ routers MAY also advertise a LAN Adjacency SID for other\n   neighbors (e.g.,\
    \ Backup Designated Router (BDR), DR-OTHER, etc.) on\n   the broadcast, NBMA,\
    \ or hybrid network using the LAN Adj-SID sub-TLV\n   as described in Section\
    \ 7.2.\n"
- title: 9.  IANA Considerations
  contents:
  - "9.  IANA Considerations\n   This specification updates two existing OSPFv3 registries.\n"
- title: 9.1.  "OSPFv3 Extended-LSA TLVs" Registry
  contents:
  - "9.1.  \"OSPFv3 Extended-LSA TLVs\" Registry\n   The following values have been\
    \ allocated:\n   | Value | Description                      | Reference     |\n\
    \   | 9     | OSPFv3 Extended Prefix Range TLV | This document |\n           \
    \     Table 1: OSPFv3 Extended-LSA TLVs\n"
- title: 9.2.  "OSPFv3 Extended-LSA Sub-TLVs" Registry
  contents:
  - "9.2.  \"OSPFv3 Extended-LSA Sub-TLVs\" Registry\n   The following values have\
    \ been allocated:\n   | Value | Description         | Reference     |\n   | 4\
    \     | Prefix-SID sub-TLV  | This document |\n   | 5     | Adj-SID sub-TLV  \
    \   | This document |\n   | 6     | LAN Adj-SID sub-TLV | This document |\n  \
    \ | 7     | SID/Label sub-TLV   | This document |\n        Table 2: OSPFv3 Extended-LSA\
    \ Sub-TLVs\n"
- title: 10.  TLV/Sub-TLV Error Handling
  contents:
  - "10.  TLV/Sub-TLV Error Handling\n   For any new TLVs/sub-TLVs defined in this\
    \ document, if the length is\n   invalid, the LSA in which it is advertised is\
    \ considered malformed\n   and MUST be ignored.  Errors SHOULD be logged subject\
    \ to rate\n   limiting.\n"
- title: 11.  Security Considerations
  contents:
  - "11.  Security Considerations\n   With the OSPFv3 Segment Routing extensions defined\
    \ herein, OSPFv3\n   will now program the MPLS data plane [RFC3031].  Previously,\
    \ LDP\n   [RFC5036] or another label distribution mechanism was required to\n\
    \   advertise MPLS labels and program the MPLS data plane.\n   In general, the\
    \ same types of attacks that can be carried out on the\n   IP control plane can\
    \ be carried out on the MPLS control plane\n   resulting in traffic being misrouted\
    \ in the respective data planes.\n   However, the latter can be more difficult\
    \ to detect and isolate.\n   Existing security extensions, as described in [RFC5340]\
    \ and\n   [RFC8362], apply to these Segment Routing extensions.  While OSPFv3\n\
    \   is under a single administrative domain, there can be deployments\n   where\
    \ potential attackers have access to one or more networks in the\n   OSPFv3 routing\
    \ domain.  In these deployments, stronger authentication\n   mechanisms, such\
    \ as those specified in [RFC4552] or [RFC7166], SHOULD\n   be used.\n   Implementations\
    \ MUST ensure that malformed TLVs and sub-TLVs defined\n   in this document are\
    \ detected and that they do not provide a\n   vulnerability for attackers to crash\
    \ the OSPFv3 router or routing\n   process.  Reception of a malformed TLV or sub-TLV\
    \ SHOULD be counted\n   and/or logged for further analysis.  Logging of malformed\
    \ TLVs and\n   sub-TLVs SHOULD be rate limited to prevent a Denial-of-Service\
    \ (DoS)\n   attack (distributed or otherwise) from overloading the OSPFv3 control\n\
    \   plane.\n"
- title: 12.  References
  contents:
  - '12.  References

    '
- title: 12.1.  Normative References
  contents:
  - "12.1.  Normative References\n   [ALGOREG]  IANA, \"Interior Gateway Protocol\
    \ (IGP) Parameters\",\n              <https://www.iana.org/assignments/igp-parameters>.\n\
    \   [RFC2119]  Bradner, S., \"Key words for use in RFCs to Indicate\n        \
    \      Requirement Levels\", BCP 14, RFC 2119,\n              DOI 10.17487/RFC2119,\
    \ March 1997,\n              <https://www.rfc-editor.org/info/rfc2119>.\n   [RFC3031]\
    \  Rosen, E., Viswanathan, A., and R. Callon, \"Multiprotocol\n              Label\
    \ Switching Architecture\", RFC 3031,\n              DOI 10.17487/RFC3031, January\
    \ 2001,\n              <https://www.rfc-editor.org/info/rfc3031>.\n   [RFC3101]\
    \  Murphy, P., \"The OSPF Not-So-Stubby Area (NSSA) Option\",\n              RFC\
    \ 3101, DOI 10.17487/RFC3101, January 2003,\n              <https://www.rfc-editor.org/info/rfc3101>.\n\
    \   [RFC5036]  Andersson, L., Ed., Minei, I., Ed., and B. Thomas, Ed.,\n     \
    \         \"LDP Specification\", RFC 5036, DOI 10.17487/RFC5036,\n           \
    \   October 2007, <https://www.rfc-editor.org/info/rfc5036>.\n   [RFC5340]  Coltun,\
    \ R., Ferguson, D., Moy, J., and A. Lindem, \"OSPF\n              for IPv6\",\
    \ RFC 5340, DOI 10.17487/RFC5340, July 2008,\n              <https://www.rfc-editor.org/info/rfc5340>.\n\
    \   [RFC5462]  Andersson, L. and R. Asati, \"Multiprotocol Label Switching\n \
    \             (MPLS) Label Stack Entry: \"EXP\" Field Renamed to \"Traffic\n \
    \             Class\" Field\", RFC 5462, DOI 10.17487/RFC5462, February\n    \
    \          2009, <https://www.rfc-editor.org/info/rfc5462>.\n   [RFC6845]  Sheth,\
    \ N., Wang, L., and J. Zhang, \"OSPF Hybrid Broadcast\n              and Point-to-Multipoint\
    \ Interface Type\", RFC 6845,\n              DOI 10.17487/RFC6845, January 2013,\n\
    \              <https://www.rfc-editor.org/info/rfc6845>.\n   [RFC7770]  Lindem,\
    \ A., Ed., Shen, N., Vasseur, JP., Aggarwal, R., and\n              S. Shaffer,\
    \ \"Extensions to OSPF for Advertising Optional\n              Router Capabilities\"\
    , RFC 7770, DOI 10.17487/RFC7770,\n              February 2016, <https://www.rfc-editor.org/info/rfc7770>.\n\
    \   [RFC8174]  Leiba, B., \"Ambiguity of Uppercase vs Lowercase in RFC\n     \
    \         2119 Key Words\", BCP 14, RFC 8174, DOI 10.17487/RFC8174,\n        \
    \      May 2017, <https://www.rfc-editor.org/info/rfc8174>.\n   [RFC8362]  Lindem,\
    \ A., Roy, A., Goethals, D., Reddy Vallem, V., and\n              F. Baker, \"\
    OSPFv3 Link State Advertisement (LSA)\n              Extensibility\", RFC 8362,\
    \ DOI 10.17487/RFC8362, April\n              2018, <https://www.rfc-editor.org/info/rfc8362>.\n\
    \   [RFC8402]  Filsfils, C., Ed., Previdi, S., Ed., Ginsberg, L.,\n          \
    \    Decraene, B., Litkowski, S., and R. Shakir, \"Segment\n              Routing\
    \ Architecture\", RFC 8402, DOI 10.17487/RFC8402,\n              July 2018, <https://www.rfc-editor.org/info/rfc8402>.\n\
    \   [RFC8661]  Bashandy, A., Ed., Filsfils, C., Ed., Previdi, S.,\n          \
    \    Decraene, B., and S. Litkowski, \"Segment Routing MPLS\n              Interworking\
    \ with LDP\", RFC 8661, DOI 10.17487/RFC8661,\n              December 2019, <https://www.rfc-editor.org/info/rfc8661>.\n\
    \   [RFC8665]  Psenak, P., Ed., Previdi, S., Ed., Filfils, C., Gredler,\n    \
    \          H., Shakir, R., Henderickx, W., and J. Tantsura, \"OSPF\n         \
    \     Extensions for Segment Routing\", RFC 8665,\n              DOI 10.17487/RFC8665,\
    \ December 2019,\n              <https://www.rfc-editor.org/info/rfc8665>.\n"
- title: 12.2.  Informative References
  contents:
  - "12.2.  Informative References\n   [RFC4552]  Gupta, M. and N. Melam, \"Authentication/Confidentiality\n\
    \              for OSPFv3\", RFC 4552, DOI 10.17487/RFC4552, June 2006,\n    \
    \          <https://www.rfc-editor.org/info/rfc4552>.\n   [RFC7166]  Bhatia, M.,\
    \ Manral, V., and A. Lindem, \"Supporting\n              Authentication Trailer\
    \ for OSPFv3\", RFC 7166,\n              DOI 10.17487/RFC7166, March 2014,\n \
    \             <https://www.rfc-editor.org/info/rfc7166>.\n   [RFC7855]  Previdi,\
    \ S., Ed., Filsfils, C., Ed., Decraene, B.,\n              Litkowski, S., Horneffer,\
    \ M., and R. Shakir, \"Source\n              Packet Routing in Networking (SPRING)\
    \ Problem Statement\n              and Requirements\", RFC 7855, DOI 10.17487/RFC7855,\
    \ May\n              2016, <https://www.rfc-editor.org/info/rfc7855>.\n"
- title: Contributors
  contents:
  - "Contributors\n   The following people gave a substantial contribution to the\
    \ content\n   of this document and should be considered coauthors:\n      Clarence\
    \ Filsfils\n      Cisco Systems, Inc.\n      Brussels\n      Belgium\n      Email:\
    \ cfilsfil@cisco.com\n      Hannes Gredler\n      RtBrick Inc.\n      Austria\n\
    \      Email: hannes@rtbrick.com\n      Rob Shakir\n      Google, Inc.\n     \
    \ United States of America\n      Email: robjs@google.com\n      Wim Henderickx\n\
    \      Nokia\n      Belgium\n      Email: wim.henderickx@nokia.com\n      Jeff\
    \ Tantsura\n      Apstra, Inc.\n      United States of America\n      Email: jefftant.ietf@gmail.com\n\
    \   Thanks to Acee Lindem for his substantial contribution to the content\n  \
    \ of this document.\n   We would like to thank Anton Smirnov for his contribution\
    \ as well.\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Peter Psenak (editor)\n   Cisco Systems, Inc.\n   Eurovea\
    \ Centre, Central 3, Pribinova Street 10\n   81109 Bratislava\n   Slovakia\n \
    \  Email: ppsenak@cisco.com\n   Stefano Previdi (editor)\n"
