- title: __initial_text__
  contents:
  - '    A Scalable and Topology-Aware MPLS Data-Plane Monitoring System

    '
- title: Abstract
  contents:
  - "Abstract\n   This document describes features of an MPLS path monitoring system\n\
    \   and related use cases.  Segment-based routing enables a scalable and\n   simple\
    \ method to monitor data-plane liveliness of the complete set of\n   paths belonging\
    \ to a single domain.  The MPLS monitoring system adds\n   features to the traditional\
    \ MPLS ping and Label Switched Path (LSP)\n   trace, in a very complementary way.\
    \  MPLS topology awareness reduces\n   management and control-plane involvement\
    \ of Operations,\n   Administration, and Maintenance (OAM) measurements while\
    \ enabling new\n   OAM features.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This document is not an Internet Standards Track specification;\
    \ it is\n   published for informational purposes.\n   This document is a product\
    \ of the Internet Engineering Task Force\n   (IETF).  It represents the consensus\
    \ of the IETF community.  It has\n   received public review and has been approved\
    \ for publication by the\n   Internet Engineering Steering Group (IESG).  Not\
    \ all documents\n   approved by the IESG are candidates for any level of Internet\n\
    \   Standard; see Section 2 of RFC 7841.\n   Information about the current status\
    \ of this document, any errata,\n   and how to provide feedback on it may be obtained\
    \ at\n   https://www.rfc-editor.org/info/rfc8403.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2018 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (https://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.  Code Components\
    \ extracted from this document must\n   include Simplified BSD License text as\
    \ described in Section 4.e of\n   the Trust Legal Provisions and are provided\
    \ without warranty as\n   described in the Simplified BSD License.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1.  Introduction  . . . . . . . . . . . . . . . . . . .\
    \ . . . . .   3\n   2.  Terminology and Abbreviations . . . . . . . . . . . .\
    \ . . . .   5\n     2.1.  Terminology . . . . . . . . . . . . . . . . . . . .\
    \ . . .   5\n     2.2.  Abbreviations . . . . . . . . . . . . . . . . . . . .\
    \ . .   6\n   3.  An MPLS Topology-Aware Path Monitoring System . . . . . . .\
    \ .   6\n   4.  Illustration of an SR-Based Path Monitoring Use Case  . . . .\
    \   8\n     4.1.  Use Case 1: LSP Data-Plane Monitoring . . . . . . . . . .  \
    \ 8\n     4.2.  Use Case 2: Monitoring a Remote Bundle  . . . . . . . . .  11\n\
    \     4.3.  Use Case 3: Fault Localization  . . . . . . . . . . . . .  12\n  \
    \ 5.  Path Trace and Failure Notification . . . . . . . . . . . . .  12\n   6.\
    \  Applying SR to Monitoring LSPs That Are Not SR Based (LDP and\n       Possibly\
    \ RSVP-TE) . . . . . . . . . . . . . . . . . . . . . .  13\n   7.  PMS Monitoring\
    \ of Different Segment ID Types  . . . . . . . .  14\n   8.  Connectivity Verification\
    \ Using PMS . . . . . . . . . . . . .  14\n   9.  IANA Considerations . . . .\
    \ . . . . . . . . . . . . . . . . .  15\n   10. Security Considerations . . .\
    \ . . . . . . . . . . . . . . . .  15\n   11. References  . . . . . . . . . .\
    \ . . . . . . . . . . . . . . .  17\n     11.1.  Normative References . . . .\
    \ . . . . . . . . . . . . . .  17\n     11.2.  Informative References . . . .\
    \ . . . . . . . . . . . . .  17\n   Acknowledgements  . . . . . . . . . . . .\
    \ . . . . . . . . . . . .  19\n   Authors' Addresses  . . . . . . . . . . . .\
    \ . . . . . . . . . . .  19\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   Network operators need to be able to monitor the forwarding\
    \ paths\n   used to transport user packets.  Monitoring packets are expected to\n\
    \   be forwarded in the data plane in a similar way to user packets.\n   Segment\
    \ Routing (SR) enables forwarding of packets along predefined\n   paths and segments;\
    \ thus, an SR monitoring packet can stay in the\n   data plane while passing along\
    \ one or more segments to be monitored.\n   This document describes a system as\
    \ a functional component called\n   (MPLS) Path Monitoring System or PMS.  The\
    \ PMS uses capabilities for\n   MPLS data-plane path monitoring.  The use cases\
    \ introduced here are\n   limited to a single Interior Gateway Protocol (IGP)\
    \ MPLS domain.  The\n   use cases of this document refer to the PMS realized as\
    \ a separate\n   node.  Although many use cases depict the PMS as a physical node,\
    \ no\n   assumption should be made, and the node could be virtual.  This\n   system\
    \ is defined as a functional component abstracted to have many\n   realizations.\
    \  The terms \"PMS\" and \"system\" are used interchangeably\n   here.\n   The\
    \ system applies to the monitoring of non-SR LSPs like Label\n   Distribution\
    \ Protocol (LDP) as well as to the monitoring of SR LSPs\n   (Section 7 offers\
    \ some more information).  As compared to non-SR\n   approaches, SR is expected\
    \ to simplify such a monitoring system by\n   enabling MPLS topology detection\
    \ based on IGP-signaled segments.  The\n   MPLS topology should be detected and\
    \ correlated with the IGP\n   topology, which is also detected by IGP signaling.\
    \  Thus, a\n   centralized and MPLS-topology-aware monitoring unit can be realized\n\
    \   in an SR domain.  This topology awareness can be used for Operation,\n   Administration,\
    \ and Maintenance (OAM) purposes as described by this\n   document.\n   Benefits\
    \ offered by the system:\n   o  The ability to set up an SR-domain-wide centralized\
    \ connectivity\n      validation.  Many operators of large networks regard a centralized\n\
    \      monitoring system as useful.\n   o  The MPLS ping (or continuity check)\
    \ packets never leave the MPLS\n      user data plane.\n   o  SR allows the transport\
    \ of MPLS path trace or connectivity\n      validation packets for every LSP to\
    \ all nodes of an SR domain.\n      This use case doesn't describe new path-trace\
    \ features.  The\n      system described here allows for the set up of an SR-domain-wide\n\
    \      centralized connectivity validation, which is useful in large\n      network\
    \ operator domains.\n   o  The system sending the monitoring packet is also receiving\
    \ it.\n      The payload of the monitoring packet may be chosen freely.  This\n\
    \      allows probing packets to be sent that represent customer traffic,\n  \
    \    possibly from multiple services (e.g., small Voice over IP\n      packets,\
    \ larger HTTP packets), and allows the embedding of useful\n      monitoring data\
    \ (e.g., accurate timestamps since both sender and\n      receiver have the same\
    \ clock and sequence numbers to ease the\n      measurement).\n   o  Set up of\
    \ a flexible MPLS monitoring system in terms of\n      deployment: from one single\
    \ centralized one to a set of\n      distributed systems (e.g., on a per-region\
    \ or service basis), and\n      in terms of redundancy from 1+1 to N+1.\n   In\
    \ addition to monitoring paths, problem localization is required.\n   Topology\
    \ awareness is an important feature of link-state IGPs\n   deployed by operators\
    \ of large networks.  MPLS topology awareness\n   combined with IGP topology awareness\
    \ enables a simple and scalable\n   data-plane-based monitoring mechanism.  Faults\
    \ can be localized:\n   o  by capturing the IGP topology and analyzing IGP messages\n\
    \      indicating changes of it.\n   o  by correlation between different SR-based\
    \ monitoring probes.\n   o  by setting up an MPLS traceroute packet for a path\
    \ (or segment) to\n      be tested and transporting it to a node to validate path\n\
    \      connectivity from that node on.\n   MPLS OAM offers flexible traceroute\
    \ (connectivity verification)\n   features to detect and execute data paths of\
    \ an MPLS domain.  By\n   utilizing the ECMP-related tool set offered, e.g., by\
    \ RFC 8029\n   [RFC8029], an SR-based MPLS monitoring system can be enabled to:\n\
    \   o  detect how to route packets along different ECMP-routed paths.\n   o  Construct\
    \ ping packets that can be steered along a single path or\n      ECMP towards\
    \ a particular LER/LSR whose connectivity is to be\n      checked.\n   o  limit\
    \ the MPLS label stack of such a ping packet, checking\n      continuity of every\
    \ single IGP segment to the maximum number of 3\n      labels.  A smaller label\
    \ stack may also be helpful, if any router\n      interprets a limited number\
    \ of packet header bytes to determine an\n      ECMP along which to route a packet.\n\
    \   Alternatively, any path may be executed by building suitable label\n   stacks.\
    \  This allows path execution without ECMP awareness.\n   The MPLS PMS may be\
    \ any server residing at a single interface of the\n   domain to be monitored.\
    \  The PMS doesn't need to support the complete\n   MPLS routing or control plane.\
    \  It needs to be capable of learning\n   and maintaining an accurate MPLS and\
    \ IGP topology.  MPLS ping and\n   traceroute packets need to be set up and sent\
    \ with the correct\n   segment stack.  The PMS must further be able to receive\
    \ and decode\n   returning ping or traceroute packets.  Packets from a variety\
    \ of\n   protocols can be used to check continuity.  These include Internet\n\
    \   Control Message Protocol (ICMP) [RFC0792] [RFC4443] [RFC4884]\n   [RFC4950],\
    \ Bidirectional Forwarding Detection (BFD) [RFC5884],\n   Seamless Bidirectional\
    \ Forwarding Detection (S-BFD) [RFC7880]\n   [RFC7881] (see Section 3.4 of [RFC7882]),\
    \ and MPLS LSP ping\n   [RFC8029].  They can also have any other OAM format supported\
    \ by the\n   PMS.  As long as the packet used to check continuity returns to the\n\
    \   server while no IGP change is detected, the monitored path can be\n   considered\
    \ as validated.  If monitoring requires pushing a large\n   label stack, a software-based\
    \ implementation is usually more flexible\n   than a hardware-based one.  Hence,\
    \ router label stack depth and label\n   composition limitations don't limit MPLS\
    \ OAM choices.\n   RFC 8287 [RFC8287] discusses SR OAM applicability and MPLS\
    \ traceroute\n   enhancements adding functionality to the use cases described\
    \ by this\n   document.\n   The document describes both use cases and a standalone\
    \ monitoring\n   framework.  The monitoring system reuses existing IETF OAM protocols\n\
    \   and leverage Segment Routing (Source Routing) to allow a single\n   device\
    \ to send, have exercised, and receive its own probing packets.\n   As a consequence,\
    \ there are no new interoperability considerations.\n   A Standards Track RFC\
    \ is not required; Informational status for this\n   document is appropriate\n"
- title: 2.  Terminology and Abbreviations
  contents:
  - '2.  Terminology and Abbreviations

    '
- title: 2.1.  Terminology
  contents:
  - "2.1.  Terminology\n   Continuity Check\n       See Section 2.2.7 of RFC 7276\
    \ [RFC7276].\n   Connectivity Verification\n       See Section 2.2.7 of RFC 7276\
    \ [RFC7276].\n   MPLS topology\n       The MPLS topology of an MPLS domain is\
    \ the complete set of MPLS-\n       and IP-address information and all routing\
    \ and data-plane\n       information required to address and utilize every MPLS\
    \ path\n       within this domain from an MPLS PMS attached to this MPLS domain\n\
    \       at an arbitrary access.  This document assumes availability of\n     \
    \  the MPLS topology (which can be detected with available protocols\n       and\
    \ interfaces).  None of the use cases will describe how to set\n       it up.\n\
    \   This document further adopts the terminology and framework described\n   in\
    \ [RFC8402].\n"
- title: 2.2.  Abbreviations
  contents:
  - "2.2.  Abbreviations\n   ECMP    Equal-Cost Multipath\n   IGP     Interior Gateway\
    \ Protocol\n   LER     Label Edge Router\n   LSP     Label Switched Path\n   LSR\
    \     Label Switching Router\n   OAM     Operations, Administration, and Maintenance\n\
    \   PMS     Path Monitoring System\n   RSVP-TE Resource Reservation Protocol -\
    \ Traffic Engineering\n   SID     Segment Identifier\n   SR      Segment Routing\n\
    \   SRGB    Segment Routing Global Block\n"
- title: 3.  An MPLS Topology-Aware Path Monitoring System
  contents:
  - "3.  An MPLS Topology-Aware Path Monitoring System\n   Any node at least listening\
    \ to the IGP of an SR domain is MPLS\n   topology aware (the node knows all related\
    \ IP addresses, SR SIDs and\n   MPLS labels).  An MPLS PMS that is able to learn\
    \ the IGP Link State\n   Database (LSDB) (including the SIDs) is able to execute\
    \ arbitrary\n   chains of LSPs.  To monitor an MPLS SR domain, a PMS needs to\
    \ set up\n   a topology database of the MPLS SR domain to be monitored.  It may\
    \ be\n   used to send ping-type packets to only check continuity along such a\n\
    \   path chain based only on the topology information.  In addition, the\n   PMS\
    \ can be used to trace MPLS LSP and, thus, verify their\n   connectivity and correspondence\
    \ between control and data planes,\n   respectively.  The PMS can direct suitable\
    \ MPLS traceroute packets to\n   any node along a path segment.\n   Let us describe\
    \ how the PMS constructs a label stack to transport a\n   packet to LER i, monitor\
    \ its path to LER j, and then receive the\n   packet back.\n   The PMS may do\
    \ so by sending packets carrying the following MPLS\n   label stack information:\n\
    \   o  Top Label: a path from PMS to LER i, which is expressed as Node-\n    \
    \  SID of LER i.\n   o  Next Label: the path that needs to be monitored from LER\
    \ i to LER\n      j.  If this path is a single physical interface (or a bundle\
    \ of\n      connected interfaces), it can be expressed by the related Adj-SID.\n\
    \      If the shortest path from LER i to LER j is supposed to be\n      monitored,\
    \ the Node-SID (LER j) can be used.  Another option is to\n      insert a list\
    \ of segments expressing the desired path (hop by hop\n      as an extreme case).\
    \  If LER i pushes a stack of labels based on\n      an SR policy decision and\
    \ this stack of LSPs is to be monitored,\n      the PMS needs an interface to\
    \ collect the information enabling it\n      to address this SR-created path.\n\
    \   o  Next Label or address: the path back to the PMS.  Likely, no\n      further\
    \ segment/label is required here.  Indeed, once the packet\n      reaches LER\
    \ j, the 'steering' part of the solution is done, and\n      the probe just needs\
    \ to return to the PMS.  This is best achieved\n      by popping the MPLS stack\
    \ and revealing a probe packet with PMS as\n      destination address (note that\
    \ in this case, the source and\n      destination addresses could be the same).\
    \  If an IP address is\n      applied, no SID/label has to be assigned to the\
    \ PMS (if it is a\n      host/server residing in an IP subnet outside the MPLS\
    \ domain).\n   The PMS should be physically connected to a router that is part\
    \ of\n   the SR domain.  It must be able to send and receive MPLS packets via\n\
    \   this interface.  As mentioned above, the routing protocol support\n   isn't\
    \ required, and the PMS itself doesn't have to be involved in IGP\n   or MPLS\
    \ routing.  A static route will do.  The option to connect a\n   PMS to an MPLS\
    \ domain by a tunnel may be attractive to some\n   operators.  So far, MPLS separates\
    \ networks securely by avoiding\n   tunnel access to MPLS domains.  Tunnel-based\
    \ access of a PMS to an\n   MPLS domain is out of scope of this document, as it\
    \ implies\n   additional security aspects.\n"
- title: 4.  Illustration of an SR-Based Path Monitoring Use Case
  contents:
  - '4.  Illustration of an SR-Based Path Monitoring Use Case

    '
- title: '4.1.  Use Case 1: LSP Data-Plane Monitoring'
  contents:
  - "4.1.  Use Case 1: LSP Data-Plane Monitoring\n   Figure 1 shows an example of\
    \ this functional component as a system,\n   which can be physical or virtual.\n\
    \                  +---+     +----+     +-----+\n                  |PMS|     |LSR1|-----|LER\
    \ i|\n                  +---+     +----+     +-----+\n                     | \
    \     /      \\    /\n                     |     /        \\__/\n            \
    \       +-----+/           /|\n                   |LER m|           / |\n    \
    \               +-----+\\         /  \\\n                           \\       /\
    \    \\\n                            \\+----+     +-----+\n                  \
    \           |LSR2|-----|LER j|\n                             +----+     +-----+\n\
    \        Figure 1: Example of a PMS-Based LSP Data-Plane Monitoring\n   For the\
    \ sake of simplicity, let's assume that all the nodes are\n   configured with\
    \ the same SRGB [RFC8402].\n   Let's assign the following Node-SIDs to the nodes\
    \ of the figure:\n   PMS = 10, LER i = 20, LER j = 30.\n   The aim is to set up\
    \ a continuity check of the path between LER i and\n   LER j.  As has been said,\
    \ the monitoring packets are to be sent and\n   received by the PMS.  Let's assume\
    \ the design aim is to be able to\n   work with the smallest possible SR label\
    \ stack.  In the given\n   topology, a fairly simple option is to perform an MPLS\
    \ path trace, as\n   specified by RFC 8029 [RFC8029] (using the Downstream (Detailed)\n\
    \   Mapping information resulting from a path trace).  The starting point\n  \
    \ for the path trace is LER i and the PMS sends the MPLS path trace\n   packet\
    \ to LER i.  The MPLS echo reply of LER i should be sent to the\n   PMS.  As a\
    \ result, the IP destination address choices are detected,\n   which are then\
    \ used to target any one of the ECMP-routed paths\n   between LER i and LER j\
    \ by the MPLS ping packets to later check path\n   continuity.  The label stack\
    \ of these ping packets doesn't need to\n   consist of more than 3 labels.  Finally,\
    \ the PMS sets up and sends\n   packets to monitor connectivity of the ECMP routed\
    \ paths.  The PMS\n   does this by creating a measurement packet with the following\
    \ label\n   stack (top to bottom): 20 - 30 - 10.  The ping packets reliably use\n\
    \   the monitored path, if the IP-address information that has been\n   detected\
    \ by the MPLS traceroute is used as the IP destination address\n   (note that\
    \ this IP address isn't used or required for any IP\n   routing).\n   LER m forwards\
    \ the packet received from the PMS to LSR1.  Assuming\n   Penultimate Hop Popping\
    \ is deployed, LSR1 pops the top label and\n   forwards the packet to LER i. \
    \ There the top label has a value 30 and\n   LER i forwards it to LER j.  This\
    \ will be done transmitting the\n   packet via LSR1 or LSR2.  The LSR will again\
    \ pop the top label.  LER\n   j will forward the packet now carrying the top label\
    \ 10 to the PMS\n   (and it will pass a LSR and LER m).\n   A few observations\
    \ on the example given in Figure 1:\n   o  The path from PMS to LER i must be\
    \ available (i.e., a continuity\n      check along the path to LER i must succeed).\
    \  If desired, an MPLS\n      traceroute may be used to exactly detect the data-plane\
    \ path taken\n      for this MPLS segment.  It is usually sufficient to just apply\
    \ any\n      of the existing Shortest Path routed paths.\n   o  If ECMP is deployed,\
    \ separate continuity checks monitoring all\n      possible paths that a packet\
    \ may use between LER i and LER j may\n      be desired.  This can be done by\
    \ applying an MPLS traceroute\n      between LER i and LER j.  Another option\
    \ is to use SR, but this\n      will likely require additional label information\
    \ within the label\n      stack of the ping packet.  Further, if multiple links\
    \ are deployed\n      between two nodes, SR methods to address each individual\
    \ path\n      require an Adj-SID to be assigned to each single interface.  This\n\
    \      method is based on control-plane information -- a connectivity\n      verification\
    \ based on MPLS traceroute seems to be a fairly good\n      option to deal with\
    \ ECMP and validation of correlation between\n      control and data planes.\n\
    \   o  The path LER j to PMS must be available (i.e., a continuity check\n   \
    \   only along the path from LER j to PMS must succeed).  If desired,\n      an\
    \ MPLS traceroute may be used to exactly detect the data-plane\n      path taken\
    \ for this MPLS segment.  It is usually sufficient to\n      just apply any of\
    \ the existing Shortest Path routed paths.\n   Once the MPLS paths (Node-SIDs)\
    \ and the required information to deal\n   with ECMP have been detected, the path\
    \ continuity between LER i and\n   LER j can be monitored by the PMS.  Path continuity\
    \ monitoring by\n   ping packets does not require the MPLS OAM functionality described\
    \ in\n   RFC 8029 [RFC8029].  All monitoring packets stay on the data plane;\n\
    \   hence, path continuity monitoring does not require control-plane\n   interaction\
    \ in any LER or LSR of the domain.  To ensure consistent\n   interpretation of\
    \ the results, the PMS should be aware of any changes\n   in IGP or MPLS topology\
    \ or ECMP routing.  While this document\n   describes path connectivity checking\
    \ as a basic application,\n   additional monitoring (like checking continuity\
    \ of underlying\n   physical infrastructure or performing delay measurements)\
    \ may be\n   desired.  A change in ECMP routing that is not caused by an IGP or\n\
    \   MPLS topology change may not be desirable for connectivity checks and\n  \
    \ delay measurements.  Therefore, a PMS should also periodically verify\n   connectivity\
    \ of the SR paths that are monitored for continuity.\n   Determining a path to\
    \ be executed prior to a measurement may also be\n   done by setting up a label\
    \ stack including all Node-SIDs along that\n   path (if LSR1 has Node-SID 40 in\
    \ the example and it should be passed\n   between LER i and LER j, the label stack\
    \ is 20 - 40 - 30 - 10).  The\n   advantage of this method is that it does not\
    \ involve connectivity\n   verification as specified in RFC 8029 [RFC8029] and,\
    \ if there's only\n   one physical connection between all nodes, the approach\
    \ is\n   independent of ECMP functionalities.  The method still is able to\n \
    \  monitor all link combinations of all paths of an MPLS domain.  If\n   correct\
    \ forwarding along the desired paths has to be checked, or\n   multiple physical\
    \ connections exist between any two nodes, all Adj-\n   SIDs along that path should\
    \ be part of the label stack.\n   While a single PMS can detect the complete MPLS\
    \ control- and data-\n   plane topology, a reliable deployment requires two separated\
    \ PMSs.\n   Scalable permanent surveillance of a set of LSPs could require\n \
    \  deployment of several PMSs.  The PMS may be a router, but could also\n   be\
    \ a dedicated monitoring system.  If measurement system reliability\n   is an\
    \ issue, more than a single PMS may be connected to the MPLS\n   domain.\n   Monitoring\
    \ an MPLS domain by a PMS based on SR offers the option of\n   monitoring complete\
    \ MPLS domains with limited effort and a unique\n   possibility to scale a flexible\
    \ monitoring solution as required by\n   the operator (the number of PMSs deployed\
    \ is independent of the\n   locations of the origin and destination of the monitored\
    \ paths).  The\n   PMS can be enabled to send MPLS OAM packets with the label\
    \ stacks and\n   address information identical to those of the monitoring packets\
    \ to\n   any node of the MPLS domain.  The routers of the monitored domain\n \
    \  should support MPLS LSP ping RFC 8029 [RFC8029].  They may also\n   incorporate\
    \ the additional enhancements defined in RFC 8287 [RFC8287]\n   to incorporate\
    \ further MPLS traceroute features.  ICMP-ping-based\n   continuity checks don't\
    \ require router-control-plane activity.  Prior\n   to monitoring a path, MPLS\
    \ OAM may be used to detect ECMP-dependent\n   forwarding of a packet.  A PMS\
    \ may be designed to learn the IP\n   address information required to execute\
    \ a particular ECMP-routed path\n   and interfaces along that path.  This allows\
    \ for the monitoring of\n   these paths with label stacks reduced to a limited\
    \ number of Node-\n   SIDs resulting from Shortest Path First (SPF) routing. \
    \ The PMS does\n   not require access to information about LSR/LER management\
    \ or data\n   planes to do so.\n"
- title: '4.2.  Use Case 2: Monitoring a Remote Bundle'
  contents:
  - "4.2.  Use Case 2: Monitoring a Remote Bundle\n               +---+    _   +--+\
    \                    +-------+\n               |   |   { }  |  |---991---L1---662---|\
    \       |\n               |PMS|--{   }-|R1|---992---L2---663---|R2 (72)|\n   \
    \            |   |   {_}  |  |---993---L3---664---|       |\n               +---+\
    \        +--+                    +-------+\n      Figure 2: SR-Based Probing of\
    \ All the Links of a Remote Bundle\n   In the figure, R1 addresses Link \"x\"\
    \ Lx by the Adj-SID 99x, while R2\n   addresses Link Lx by the Adj-SID 66(x+1).\n\
    \   In the above figure, the PMS needs to assess the data-plane\n   availability\
    \ of all the links within a remote bundle connected to\n   routers R1 and R2.\n\
    \   The monitoring system retrieves the SID/label information from the\n   IGP\
    \ LSDB and appends the following segment list/label stack: {72,\n   662, 992,\
    \ 664} on its IP probe (whose source and destination\n   addresses are the address\
    \ of the PMS).\n   The PMS sends the probe to its connected router.  The MPLS/SR\
    \ domain\n   then forwards the probe to R2 (72 is the Node-SID of R2).  R2\n \
    \  forwards the probe to R1 over link L1 (Adj-SID 662).  R1 forwards the\n   probe\
    \ to R2 over link L2 (Adj-SID 992).  R2 forwards the probe to R1\n   over link\
    \ L3 (Adj-SID 664).  R1 then forwards the IP probe to the PMS\n   as per classic\
    \ IP forwarding.\n   As was mentioned in Section 4.1, the PMS must be able to\
    \ monitor the\n   continuity of the path PMS to R2 (Node-SID 72) as well as the\n\
    \   continuity from R1 to the PMS.  If both are given and packets are\n   lost,\
    \ forwarding on one of the three interfaces connecting R1 to R2\n   must be disturbed.\n"
- title: '4.3.  Use Case 3: Fault Localization'
  contents:
  - "4.3.  Use Case 3: Fault Localization\n   In the previous example, a unidirectional\
    \ fault on the middle link in\n   direction of R2 to R1 would be localized by\
    \ sending the following two\n   probes with respective segment lists:\n   o  72,\
    \ 662, 992, 664\n   o  72, 663, 992, 664\n   The first probe would succeed while\
    \ the second would fail.\n   Correlation of the measurements reveals that the\
    \ only difference is\n   using the Adj-SID 663 of the middle link from R2 to R1\
    \ in the\n   unsuccessful measurement.  Assuming the second probe has been routed\n\
    \   correctly, the problem is that, for some (possibly unknown) reason,\n   SR\
    \ packets to be forwarded from R2 via the interface identified by\n   Adj-SID\
    \ 663 are lost.\n   The example above only illustrates a method to localize a\
    \ fault by\n   correlated continuity checks.  Any operational deployment requires\n\
    \   well-designed engineering to allow for the desired unambiguous\n   diagnosis\
    \ on the monitored section of the SR network.  'Section' here\n   could be a path,\
    \ a single physical interface, the set of all links of\n   a bundle, or an adjacency\
    \ of two nodes (just to name a few).\n"
- title: 5.  Path Trace and Failure Notification
  contents:
  - "5.  Path Trace and Failure Notification\n   Sometimes, forwarding along a single\
    \ path doesn't work, even though\n   the control-plane information is healthy.\
    \  Such a situation may occur\n   after maintenance work within a domain.  An\
    \ operator may perform on-\n   demand tests, but execution of automated PMS path\
    \ trace checks may be\n   set up as well (scope may be limited to a subset of\
    \ important end-to-\n   end paths crossing the router or network section after\
    \ completion of\n   the maintenance work there).  Upon detection of a path that\
    \ can't be\n   used, the operator needs to be notified.  A check ensuring that\
    \ a re-\n   routing event is differed from a path facing whose forwarding\n  \
    \ behavior doesn't correspond to the control-plane information is\n   necessary\
    \ (but out of scope of this document).\n   Adding an automated problem solution\
    \ to the PMS features only makes\n   sense if the root cause of the symptom appears\
    \ often, can be assumed\n   to be unambiguous by its symptoms, can be solved by\
    \ a predetermined\n   chain of commands, is not collaterally damaged by the automated\
    \ PMS\n   reaction.  A closer analysis is out of scope of this document.\n   The\
    \ PMS is expected to check control-plane liveliness after a path\n   repair effort\
    \ was executed.  It doesn't matter whether the path\n   repair was triggered manually\
    \ or by an automated system.\n"
- title: 6.  Applying SR to Monitoring LSPs That Are Not SR Based (LDP and
  contents:
  - "6.  Applying SR to Monitoring LSPs That Are Not SR Based (LDP and\n    Possibly\
    \ RSVP-TE)\n   The MPLS PMS described by this document can be realized with\n\
    \   technology that is not SR based.  Making such a monitoring system\n   that\
    \ is not SR MPLS based aware of a domain's complete MPLS topology\n   requires,\
    \ e.g., management-plane access to the routers of the domain\n   to be monitored\
    \ or set up of a dedicated tLDP tunnel per router to\n   set up an LDP adjacency.\
    \  To avoid the use of stale MPLS label\n   information, the IGP must be monitored\
    \ and MPLS topology must be\n   aligned with IGP topology in a timely manner.\
    \  Enhancing IGPs to the\n   exchange of MPLS-topology information as done by\
    \ SR significantly\n   simplifies and stabilizes such an MPLS PMS.\n   An SR-based\
    \ PMS connected to an MPLS domain consisting of LER and\n   LSRs supporting SR\
    \ and LDP or RSVP-TE in parallel in all nodes may\n   use SR paths to transmit\
    \ packets to and from the start and endpoints\n   of LSPs that are not SR based\
    \ to be monitored.  In the example given\n   in Figure 1, the label stack top\
    \ to bottom may be as follows, when\n   sent by the PMS:\n   o  Top: SR-based\
    \ Node-SID of LER i at LER m.\n   o  Next: LDP or RSVP-TE label identifying the\
    \ path or tunnel,\n      respectively, from LER i to LER j (at LER i).\n   o \
    \ Bottom: SR-based Node-SID identifying the path to the PMS at LER\n      j.\n\
    \   While the mixed operation shown here still requires the PMS to be\n   aware\
    \ of the LER LDP-MPLS topology, the PMS may learn the SR MPLS\n   topology by\
    \ the IGP and use this information.\n   An implementation report on a PMS operating\
    \ in an LDP domain is given\n   in [MPLS-PMS-REPORT].  In addition, this report\
    \ compares delays\n   measured with a single PMS to the results measured by systems\
    \ that\n   are conformant with IP Performance Metrics (IPPM) connected to the\n\
    \   MPLS domain at three sites (see [RFC6808] for IPPM conformance).  The\n  \
    \ delay measurements of the PMS and the IPPM Measurement Agents were\n   compared\
    \ based on a statistical test in [RFC6576].  The Anderson\n   Darling k-sample\
    \ test showed that the PMS round-trip delay\n   measurements are equal to those\
    \ captured by an IPPM-conformant IP\n   measurement system for 64 Byte measurement\
    \ packets with 95%\n   confidence.\n   The authors are not aware of similar deployment\
    \ for RSVP-TE.\n   Identification of tunnel entry- and transit-nodes may add complexity.\n\
    \   They are not within scope of this document.\n"
- title: 7.  PMS Monitoring of Different Segment ID Types
  contents:
  - "7.  PMS Monitoring of Different Segment ID Types\n   MPLS SR topology awareness\
    \ should allow the PMS to monitor liveliness\n   of SIDs related to interfaces\
    \ within the SR and IGP domain,\n   respectively.  Tracing a path where an SR-capable\
    \ node assigns an\n   Adj-SID for a node that is not SR capable may fail.  This\
    \ and other\n   backward compatibility with non-SR devices are discussed by RFC\
    \ 8287\n   [RFC8287].\n   To match control-plane information with data-plane information\
    \ for\n   all relevant types of Segment IDs, RFC 8287 [RFC8287] enhances MPLS\n\
    \   OAM functions defined by RFC 8029 [RFC8029].\n"
- title: 8.  Connectivity Verification Using PMS
  contents:
  - "8.  Connectivity Verification Using PMS\n   While the PMS-based use cases explained\
    \ in Section 5 are sufficient\n   to provide continuity checks between LER i and\
    \ LER j, they may not\n   help perform connectivity verification.\n          \
    \             +---+\n                       |PMS|\n                       +---+\n\
    \                         |\n                         |\n                    \
    \  +----+     +----+     +-----+\n                      |LSRa|-----|LSR1|-----|LER\
    \ i|\n                      +----+     +----+     +-----+\n                  \
    \       |      /      \\    /\n                         |     /        \\__/\n\
    \                       +-----+/           /|\n                       |LER m|\
    \           / |\n                       +-----+\\         /  \\\n            \
    \                   \\       /    \\\n                                \\+----+\
    \     +-----+\n                                 |LSR2|     |LER j|\n         \
    \                        +----+     +-----+\n              Figure 3: Connectivity\
    \ Verification with a PMS\n   Let's assign the following Node-SIDs to the nodes\
    \ of the figure:\n   PMS = 10, LER i = 20, LER j = 30, LER m = 40.  The PMS is\
    \ intended to\n   validate the path between LER m and LER j.  In order to validate\
    \ this\n   path, the PMS will send the probe packet with a label stack of (top\n\
    \   to bottom): {40} {30} {10}.  Imagine any of the below forwarding\n   entry\
    \ misprogrammed situation:\n   o  LSRa receiving any packet with top label 40\
    \ will POP and forwards\n      to LSR1 instead of LER m.\n   o  LSR1 receiving\
    \ any packet with top label 30 will pop and forward\n      to LER i instead of\
    \ LER j.\n   In either of the above situations, the probe packet will be delivered\n\
    \   back to the PMS leading to a falsified path liveliness indication by\n   the\
    \ PMS.\n   Connectivity Verification functions help us to verify if the probe\
    \ is\n   taking the expected path.  For example, the PMS can intermittently\n\
    \   send the probe packet with a label stack of (top to bottom):\n   {40;ttl=255}\
    \ {30;ttl=1} {10;ttl=255}.  The probe packet may carry\n   information about LER\
    \ m, which could be carried in the Target FEC\n   Stack in case of an MPLS Echo\
    \ Request or Discriminator in the case of\n   Seamless BFD.  When LER m receives\
    \ the packet, it will punt due to\n   Time-To-Live (TTL) expiry and send a positive\
    \ response.  In the\n   above-mentioned misprogramming situation, LSRa will forward\
    \ to LSR1,\n   which will send a negative response to the PMS as the information\
    \ in\n   probe does not match the local node.  The PMS can do the same for\n \
    \  bottom label as well.  This will help perform connectivity\n   verification\
    \ and ensure that the path between LER m and LER j is\n   working as expected.\n"
- title: 9.  IANA Considerations
  contents:
  - "9.  IANA Considerations\n   This document has no IANA actions.\n"
- title: 10.  Security Considerations
  contents:
  - "10.  Security Considerations\n   The PMS builds packets with the intent of performing\
    \ OAM tasks.  It\n   uses address information based on topology information rather\
    \ than a\n   protocol.\n   The PMS allows the insertion of traffic into non-SR\
    \ domains.  This\n   may be required in the case of an LDP domain attached to\
    \ the SR\n   domain, but it can be used to maliciously insert traffic in the case\n\
    \   of external IP domains and MPLS-based VPNs.\n   To prevent a PMS from inserting\
    \ traffic into an MPLS VPN domain, one\n   or more sets of label ranges may be\
    \ reserved for service labels\n   within an SR domain.  The PMS should be configured\
    \ to reject usage of\n   these service label values.  In the same way, misuse\
    \ of IP\n   destination addresses is blocked if only IP destination address\n\
    \   values conforming to RFC 8029 [RFC8029] are settable by the PMS.\n   To limit\
    \ potential misuse, access to a PMS needs to be authorized and\n   should be logged.\
    \  OAM supported by a PMS requires skilled personnel;\n   hence, only experts\
    \ requiring PMS access should be allowed to access\n   such a system.  It is recommended\
    \ to directly attach a PMS to an SR\n   domain.  Connecting a PMS to an SR domain\
    \ by a tunnel is technically\n   possible, but adds further security issues. \
    \ A tunnel-based access of\n   a PMS to an SR domain is not recommended.\n   Use\
    \ of stale MPLS or IGP routing information could cause a PMS-\n   monitoring packet\
    \ to leave the domain where it originated.  PMS-\n   monitoring packets should\
    \ not be sent using stale MPLS- or IGP-\n   routing information.  To carry out\
    \ a desired measurement properly,\n   the PMS must be aware of and respect the\
    \ actual route changes,\n   convergence events, as well as the assignment of Segment\
    \ IDs relevant\n   for measurements.  At a minimum, the PMS must be able to listen\
    \ to\n   IGP topology changes or pull routing and segment information from\n \
    \  routers signaling topology changes.\n   Traffic insertion by a PMS may be unintended,\
    \ especially if the IGP\n   or MPLS topology stored locally is in stale state.\
    \  As soon as the\n   PMS has an indication that its IGP or MPLS topology are\
    \ stale, it\n   should stop operations involving network sections whose topology\
    \ may\n   not be accurate.  However, note that it is the task of an OAM system\n\
    \   to discover and locate network sections where forwarding behavior is\n   not\
    \ matching control-plane state.  As soon as a PMS or an operator of\n   a PMS\
    \ has the impression that the PMS topology information is stale,\n   measures\
    \ need to be taken to refresh the topology information.  These\n   measures should\
    \ be part of the PMS design.  Matching forwarding and\n   control-plane state\
    \ by periodically automated execution of the\n   mechanisms described in RFC 8029\
    \ [RFC8029] may be such a feature.\n   Whenever network maintenance tasks are\
    \ performed by operators, the\n   PMS topology discovery should be started asynchronously\
    \ after network\n   maintenance has been finished.\n   A PMS that is losing network\
    \ connectivity or crashing must remove all\n   IGP- and MPLS-topology information\
    \ prior to restarting operation.\n   A PMS may operate routine measurements on\
    \ a large scale.  Care must\n   be taken to avoid unintended traffic insertion\
    \ after topology changes\n   that result in, e.g., changes of label assignments\
    \ to routes or\n   interfaces within a domain.  If the labels concerned are part\
    \ of the\n   label stack composed by the PMS for any measurement packet and their\n\
    \   state is stale, the measurement initially needs to be stopped.  Setup\n  \
    \ and operation of routine measurements may be automated.  Secure\n   automated\
    \ PMS operation requires a working automated detection and\n   recognition of\
    \ stale routing state.\n"
- title: 11.  References
  contents:
  - '11.  References

    '
- title: 11.1.  Normative References
  contents:
  - "11.1.  Normative References\n   [RFC7276]  Mizrahi, T., Sprecher, N., Bellagamba,\
    \ E., and Y.\n              Weingarten, \"An Overview of Operations, Administration,\n\
    \              and Maintenance (OAM) Tools\", RFC 7276,\n              DOI 10.17487/RFC7276,\
    \ June 2014,\n              <https://www.rfc-editor.org/info/rfc7276>.\n   [RFC8402]\
    \  Filsfils, C., Ed., Previdi, S., Ed., Ginsberg, L.,\n              Decraene,\
    \ B., Litkowski, S., and R. Shakir, \"Segment\n              Routing Architecture\"\
    , RFC 8402, DOI 10.17487/RFC8402,\n              July 2018, <https://www.rfc-editor.org/info/rfc8402>.\n"
- title: 11.2.  Informative References
  contents:
  - "11.2.  Informative References\n   [MPLS-PMS-REPORT]\n              Leipnitz,\
    \ R., Ed. and R. Geib, \"A scalable and topology\n              aware MPLS data\
    \ plane monitoring system\", Work in\n              Progress, draft-leipnitz-spring-pms-implementation-\n\
    \              report-00, June 2016.\n   [RFC0792]  Postel, J., \"Internet Control\
    \ Message Protocol\", STD 5,\n              RFC 792, DOI 10.17487/RFC0792, September\
    \ 1981,\n              <https://www.rfc-editor.org/info/rfc792>.\n   [RFC4443]\
    \  Conta, A., Deering, S., and M. Gupta, Ed., \"Internet\n              Control\
    \ Message Protocol (ICMPv6) for the Internet\n              Protocol Version 6\
    \ (IPv6) Specification\", STD 89,\n              RFC 4443, DOI 10.17487/RFC4443,\
    \ March 2006,\n              <https://www.rfc-editor.org/info/rfc4443>.\n   [RFC4884]\
    \  Bonica, R., Gan, D., Tappan, D., and C. Pignataro,\n              \"Extended\
    \ ICMP to Support Multi-Part Messages\", RFC 4884,\n              DOI 10.17487/RFC4884,\
    \ April 2007,\n              <https://www.rfc-editor.org/info/rfc4884>.\n   [RFC4950]\
    \  Bonica, R., Gan, D., Tappan, D., and C. Pignataro, \"ICMP\n              Extensions\
    \ for Multiprotocol Label Switching\", RFC 4950,\n              DOI 10.17487/RFC4950,\
    \ August 2007,\n              <https://www.rfc-editor.org/info/rfc4950>.\n   [RFC5884]\
    \  Aggarwal, R., Kompella, K., Nadeau, T., and G. Swallow,\n              \"Bidirectional\
    \ Forwarding Detection (BFD) for MPLS Label\n              Switched Paths (LSPs)\"\
    , RFC 5884, DOI 10.17487/RFC5884,\n              June 2010, <https://www.rfc-editor.org/info/rfc5884>.\n\
    \   [RFC6576]  Geib, R., Ed., Morton, A., Fardid, R., and A. Steinmitz,\n    \
    \          \"IP Performance Metrics (IPPM) Standard Advancement\n            \
    \  Testing\", BCP 176, RFC 6576, DOI 10.17487/RFC6576, March\n              2012,\
    \ <https://www.rfc-editor.org/info/rfc6576>.\n   [RFC6808]  Ciavattone, L., Geib,\
    \ R., Morton, A., and M. Wieser, \"Test\n              Plan and Results Supporting\
    \ Advancement of RFC 2679 on the\n              Standards Track\", RFC 6808, DOI\
    \ 10.17487/RFC6808, December\n              2012, <https://www.rfc-editor.org/info/rfc6808>.\n\
    \   [RFC7880]  Pignataro, C., Ward, D., Akiya, N., Bhatia, M., and S.\n      \
    \        Pallagatti, \"Seamless Bidirectional Forwarding Detection\n         \
    \     (S-BFD)\", RFC 7880, DOI 10.17487/RFC7880, July 2016,\n              <https://www.rfc-editor.org/info/rfc7880>.\n\
    \   [RFC7881]  Pignataro, C., Ward, D., and N. Akiya, \"Seamless\n           \
    \   Bidirectional Forwarding Detection (S-BFD) for IPv4, IPv6,\n             \
    \ and MPLS\", RFC 7881, DOI 10.17487/RFC7881, July 2016,\n              <https://www.rfc-editor.org/info/rfc7881>.\n\
    \   [RFC7882]  Aldrin, S., Pignataro, C., Mirsky, G., and N. Kumar,\n        \
    \      \"Seamless Bidirectional Forwarding Detection (S-BFD) Use\n           \
    \   Cases\", RFC 7882, DOI 10.17487/RFC7882, July 2016,\n              <https://www.rfc-editor.org/info/rfc7882>.\n\
    \   [RFC8029]  Kompella, K., Swallow, G., Pignataro, C., Ed., Kumar, N.,\n   \
    \           Aldrin, S., and M. Chen, \"Detecting Multiprotocol Label\n       \
    \       Switched (MPLS) Data-Plane Failures\", RFC 8029,\n              DOI 10.17487/RFC8029,\
    \ March 2017,\n              <https://www.rfc-editor.org/info/rfc8029>.\n   [RFC8287]\
    \  Kumar, N., Ed., Pignataro, C., Ed., Swallow, G., Akiya,\n              N.,\
    \ Kini, S., and M. Chen, \"Label Switched Path (LSP)\n              Ping/Traceroute\
    \ for Segment Routing (SR) IGP-Prefix and\n              IGP-Adjacency Segment\
    \ Identifiers (SIDs) with MPLS Data\n              Planes\", RFC 8287, DOI 10.17487/RFC8287,\
    \ December 2017,\n              <https://www.rfc-editor.org/info/rfc8287>.\n"
- title: Acknowledgements
  contents:
  - "Acknowledgements\n   The authors would like to thank Nobo Akiya for his contribution.\n\
    \   Raik Leipnitz kindly provided an editorial review.  The authors would\n  \
    \ also like to thank Faisal Iqbal for an insightful review and a useful\n   set\
    \ of comments and suggestions.  Finally, Bruno Decraene's Document\n   Shepherd\
    \ review led to a clarified document.\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Ruediger Geib (editor)\n   Deutsche Telekom\n   Heinrich\
    \ Hertz Str. 3-7\n   Darmstadt  64295\n   Germany\n   Phone: +49 6151 5812747\n\
    \   Email: Ruediger.Geib@telekom.de\n   Clarence Filsfils\n   Cisco Systems, Inc.\n\
    \   Brussels\n   Belgium\n   Email: cfilsfil@cisco.com\n   Carlos Pignataro (editor)\n\
    \   Cisco Systems, Inc.\n   7200 Kit Creek Road\n   Research Triangle Park, NC\
    \  27709-4987\n   United States of America\n   Email: cpignata@cisco.com\n   Nagendra\
    \ Kumar\n   Cisco Systems, Inc.\n   7200 Kit Creek Road\n   Research Triangle\
    \ Park, NC  27709-4987\n   United States of America\n   Email: naikumar@cisco.com\n"
