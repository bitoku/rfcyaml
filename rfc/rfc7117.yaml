- title: __initial_text__
  contents:
  - '            Multicast in Virtual Private LAN Service (VPLS)

    '
- title: Abstract
  contents:
  - "Abstract\n   RFCs 4761 and 4762 describe a solution for Virtual Private LAN\n\
    \   Service (VPLS) multicast that relies on the use of point-to-point or\n   multipoint-to-point\
    \ unicast Label Switched Paths (LSPs) for carrying\n   multicast traffic.  This\
    \ solution has certain limitations for certain\n   VPLS multicast traffic profiles.\
    \  For example, it may result in\n   highly non-optimal bandwidth utilization\
    \ when a large amount of\n   multicast traffic is to be transported.\n   This\
    \ document describes solutions for overcoming a subset of the\n   limitations\
    \ of the existing VPLS multicast solution.  It describes\n   procedures for VPLS\
    \ multicast that utilize multicast trees in the\n   service provider (SP) network.\
    \  The solution described in this\n   document allows sharing of one such multicast\
    \ tree among multiple\n   VPLS instances.  Furthermore, the solution described\
    \ in this document\n   allows a single multicast tree in the SP network to carry\
    \ traffic\n   belonging only to a specified set of one or more IP multicast streams\n\
    \   from one or more VPLS instances.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This\
    \ document is a product of the Internet Engineering Task Force\n   (IETF).  It\
    \ represents the consensus of the IETF community.  It has\n   received public\
    \ review and has been approved for publication by the\n   Internet Engineering\
    \ Steering Group (IESG).  Further information on\n   Internet Standards is available\
    \ in Section 2 of RFC 5741.\n   Information about the current status of this document,\
    \ any errata,\n   and how to provide feedback on it may be obtained at\n   http://www.rfc-editor.org/info/rfc7117.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2014 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (http://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.  Code Components\
    \ extracted from this document must\n   include Simplified BSD License text as\
    \ described in Section 4.e of\n   the Trust Legal Provisions and are provided\
    \ without warranty as\n   described in the Simplified BSD License.\n   This document\
    \ may contain material from IETF Documents or IETF\n   Contributions published\
    \ or made publicly available before November\n   10, 2008.  The person(s) controlling\
    \ the copyright in some of this\n   material may not have granted the IETF Trust\
    \ the right to allow\n   modifications of such material outside the IETF Standards\
    \ Process.\n   Without obtaining an adequate license from the person(s) controlling\n\
    \   the copyright in such materials, this document may not be modified\n   outside\
    \ the IETF Standards Process, and derivative works of it may\n   not be created\
    \ outside the IETF Standards Process, except to format\n   it for publication\
    \ as an RFC or to translate it into languages other\n   than English.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1. Introduction ....................................................4\n\
    \   2. Terminology .....................................................5\n  \
    \    2.1. Specification of Requirements ..............................6\n   3.\
    \ Overview ........................................................6\n      3.1.\
    \ Inclusive and Selective Multicast Trees ....................7\n      3.2. BGP-Based\
    \ VPLS Membership Auto-discovery ...................8\n      3.3. IP Multicast\
    \ Group Membership Discovery ....................8\n      3.4. Advertising P-Multicast\
    \ Tree to VPLS/C-Multicast Binding ...9\n      3.5. Aggregation ...............................................10\n\
    \      3.6. Inter-AS VPLS Multicast ...................................11\n  \
    \ 4. Intra-AS Inclusive P-Multicast Tree Auto-discovery/Binding .....12\n    \
    \  4.1. Originating Intra-AS VPLS A-D Routes ......................13\n      4.2.\
    \ Receiving Intra-AS VPLS A-D Routes ........................14\n   5. Demultiplexing\
    \ P-Multicast Tree Traffic ........................15\n      5.1. One P-Multicast\
    \ Tree - One VPLS Mapping ...................15\n      5.2. One P-Multicast Tree\
    \ - Many VPLS Mapping ..................15\n   6. Establishing P-Multicast Trees\
    \ .................................16\n      6.1. Common Procedures .........................................16\n\
    \      6.2. RSVP-TE P2MP LSPs .........................................16\n  \
    \         6.2.1. P2MP TE LSP - VPLS Mapping .........................17\n    \
    \  6.3. Receiver-Initiated P2MP LSP ...............................18\n      \
    \     6.3.1. P2MP LSP - VPLS Mapping ............................18\n      6.4.\
    \ Encapsulation of Aggregate P-Multicast Trees ..............18\n   7. Inter-AS\
    \ Inclusive P-Multicast Tree A-D/Binding ................18\n      7.1. VSIs on\
    \ the ASBRs .........................................19\n           7.1.1. Option\
    \ (a): VSIs on the ASBRs ......................19\n           7.1.2. Option (e):\
    \ VSIs on the ASBRs ......................20\n      7.2. Option (b) - Segmented\
    \ Inter-AS Trees .....................20\n           7.2.1. Segmented Inter-AS\
    \ Trees VPLS Inter-AS\n                  A-D/Binding ........................................20\n\
    \           7.2.2. Propagating BGP VPLS A-D Routes to Other\n                \
    \  ASes: Overview .....................................21\n                  7.2.2.1.\
    \ Propagating Intra-AS VPLS A-D\n                           Routes in EBGP ............................23\n\
    \                  7.2.2.2. Inter-AS A-D Route Received via EBGP ......23\n  \
    \                7.2.2.3. Leaf A-D Route Received via EBGP ..........25\n    \
    \              7.2.2.4. Inter-AS A-D Route Received via IBGP ......25\n      7.3.\
    \ Option (c): Non-segmented Tunnels .........................26\n   8. Optimizing\
    \ Multicast Distribution via Selective Trees ..........27\n      8.1. Protocol\
    \ for Switching to Selective Trees .................29\n      8.2. Advertising\
    \ (C-S, C-G) Binding to a Selective Tree ........30\n      8.3. Receiving S-PMSI\
    \ A-D Routes by PEs ........................32\n      8.4. Inter-AS Selective\
    \ Tree ...................................34\n           8.4.1. VSIs on the ASBRs\
    \ ..................................35\n                  8.4.1.1. VPLS Inter-AS\
    \ Selective Tree A-D Binding ..35\n           8.4.2. Inter-AS Segmented Selective\
    \ Trees .................35\n                  8.4.2.1. Handling S-PMSI A-D Routes\
    \ by ASBRs .......36\n                           8.4.2.1.1. Merging Selective\
    \ Tree\n                                      into an Inclusive Tree .........37\n\
    \           8.4.3. Inter-AS Non-segmented Selective Trees .............38\n  \
    \ 9. BGP Extensions .................................................38\n    \
    \  9.1. Inclusive Tree/Selective Tree Identifier ..................38\n      9.2.\
    \ MCAST-VPLS NLRI ...........................................39\n           9.2.1.\
    \ S-PMSI A-D Route ...................................40\n           9.2.2. Leaf\
    \ A-D Route .....................................41\n   10. Aggregation Considerations\
    \ ....................................41\n   11. Data Forwarding ...............................................43\n\
    \      11.1. MPLS Tree Encapsulation ..................................43\n  \
    \         11.1.1. Mapping Multiple VPLS Instances to a P2MP LSP .....43\n    \
    \       11.1.2. Mapping One VPLS Instance to a P2MP LSP ...........44\n   12.\
    \ VPLS Data Packet Treatment ....................................45\n   13. Security\
    \ Considerations .......................................46\n   14. IANA Considerations\
    \ ...........................................47\n   15. References ....................................................47\n\
    \      15.1. Normative References .....................................47\n  \
    \    15.2. Informative References ...................................48\n   16.\
    \ Acknowledgments ...............................................50\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   [RFC4761] and [RFC4762] describe a solution for VPLS\n \
    \  multicast/broadcast that relies on the use of pseudowires transported\n   over\
    \ unicast point-to-point (P2P) RSVP Traffic Engineering (RSVP-TE)\n   or multipoint-to-point\
    \ (MP2P) LDP Label Switched Paths (LSPs)\n   ([RFC3209] [RFC5036]).  In this document,\
    \ we refer to this solution\n   as \"ingress replication\".\n   With ingress replication,\
    \ when an ingress Provider Edge (PE) of a\n   given VPLS instance receives a multicast/broadcast\
    \ packet from one of\n   the Customer Edges (CEs) that belong to that instance,\
    \ the ingress PE\n   replicates the packet for each egress PE that belong to that\n\
    \   instance, and it sends the packet to each such egress PE using\n   unicast\
    \ tunnels.\n   The solution based on ingress replication has certain limitations\
    \ for\n   certain VPLS multicast/broadcast traffic profiles.  For example, it\n\
    \   may result in highly non-optimal bandwidth utilization in the MPLS\n   network\
    \ when a large amount of multicast/broadcast traffic is to be\n   transported\
    \ (for more see [RFC5501]).\n   Ingress replication may be an acceptable model\
    \ when the bandwidth of\n   the multicast/broadcast traffic is low and/or there\
    \ is a small number\n   of replications performed on each outgoing interface for\
    \ a particular\n   VPLS customer multicast stream.  If this is not the case, it\
    \ is\n   desirable to utilize multicast trees in the SP network to transmit\n\
    \   VPLS multicast and/or broadcast packets [RFC5501].\n   This document describes\
    \ procedures for overcoming the limitations of\n   existing VPLS multicast solutions.\
    \  It describes procedures for using\n   MPLS point-to-multipoint (P2MP) LSPs\
    \ in the SP network to transport\n   VPLS multicast and/or broadcast packets,\
    \ where these LSPs are\n   signaled by either P2MP RSVP-TE [RFC4875] or Multipoint\
    \ LDP (mLDP)\n   [RFC6388].\n   The procedures described in this document are\
    \ applicable to both\n   [RFC4761] and [RFC4762].\n"
- title: 2.  Terminology
  contents:
  - "2.  Terminology\n   This document uses terminology described in [RFC4761] and\
    \ [RFC4762].\n   In this document, we refer to various auto-discovery routes,\
    \ as \"A-D\n   routes\".\n   This document uses the prefix 'C' to refer to the\
    \ customer control or\n   data packets and 'P' to refer to the provider control\
    \ or data\n   packets.  An IP (multicast source, multicast group) tuple is\n \
    \  abbreviated to (S, G).\n   An \"Inclusive tree\" is a single multicast distribution\
    \ tree in the SP\n   network that carries all the multicast traffic from one VPLS\
    \ instance\n   on a given PE.\n   An \"Aggregate Inclusive tree\" is a single\
    \ multicast distribution tree\n   in the SP network that carries all the multicast\
    \ traffic from more\n   than one VPLS instance on a given PE.\n   A \"Selective\
    \ tree\" is a single multicast distribution tree in the SP\n   network that carries\
    \ multicast traffic belonging only to a specified\n   set of IP multicast streams,\
    \ and all these streams belong to the same\n   VPLS instance on a given PE.  A\
    \ Selective tree differs from an\n   Inclusive tree in that it may reach a subset\
    \ of the PEs reached by an\n   Inclusive tree.\n   An \"Aggregate Selective tree\"\
    \ is a single multicast distribution tree\n   in the SP network that carries multicast\
    \ traffic belonging only to a\n   specified set of IP multicast streams, and all\
    \ these streams belong\n   to more than one VPLS instance on a given PE.\n"
- title: 2.1.  Specification of Requirements
  contents:
  - "2.1.  Specification of Requirements\n   The key words \"MUST\", \"MUST NOT\"\
    , \"REQUIRED\", \"SHALL\", \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\"\
    , \"MAY\", and \"OPTIONAL\" in this\n   document are to be interpreted as described\
    \ in [RFC2119].\n"
- title: 3.  Overview
  contents:
  - "3.  Overview\n   Procedures described in this document provide mechanisms that\
    \ allow a\n   single multicast distribution tree in the SP network to carry all\
    \ the\n   multicast traffic from one or more VPLS sites connected to a given\n\
    \   PE, irrespective of whether these sites belong to the same or\n   different\
    \ VPLS instances.  We refer to such a tree as an \"Inclusive\n   tree\" if it\
    \ carries multicast traffic from one VPLS instance on a\n   given PE.  We refer\
    \ to such a tree as an \"Aggregate Inclusive tree\"\n   if it carries multicast\
    \ traffic from more than one VPLS instance on a\n   given PE.  See the \"Inclusive\
    \ and Selective Multicast Trees\" section\n   for further discussion on Inclusive\
    \ trees.\n   To further improve bandwidth utilization for IP multicast streams,\n\
    \   this document also provides procedures by which a single multicast\n   distribution\
    \ tree in the SP network can be used to carry traffic\n   belonging only to a\
    \ specified set of IP multicast streams, originated\n   in one or more VPLS sites\
    \ connected to a given PE, irrespective of\n   whether these sites belong to the\
    \ same or different VPLS instances.\n   We refer to such a tree as a \"Selective\
    \ tree\" if it carries the IP\n   multicast stream(s) that belongs to the same\
    \ VPLS instance on a given\n   PE.  We refer to such a tree as an \"Aggregate\
    \ Selective tree\" if it\n   carries the IP multicast streams that belong to different\
    \ VPLS\n   instances on a given PE.  Use of Selective and/or Aggregate Selective\n\
    \   trees allows multicast traffic, by default, to be carried on an\n   Inclusive\
    \ tree, while traffic from some specific IP multicast\n   streams, e.g., high-bandwidth\
    \ streams, could be carried on one of the\n   Selective trees.  See the \"Inclusive\
    \ and Selective Multicast Trees\"\n   section for further discussion on Selective\
    \ trees.\n   Note that this document covers the use of Selective trees only for\n\
    \   carrying IP multicast streams.  Any other use of such trees is\n   outside\
    \ the scope of this document.\n   Unicast packets destined to unknown Media Access\
    \ Control (MAC)\n   addresses (i.e., not learned yet at the ingress PE) in a given\
    \ VPLS\n   instance are flooded to remote PEs participating in the same VPLS\n\
    \   instance.  This flooding MAY still use ingress replication (as\n   specified\
    \ in [RFC4761] and [RFC4762]), or MAY use the procedures\n   defined in this document\
    \ to optimize flooding across the SP core.\n   While the use of multicast trees\
    \ in the SP network can be beneficial\n   when the bandwidth of the multicast\
    \ traffic is high, or when it is\n   desirable to optimize the number of copies\
    \ of a multicast packet\n   transmitted on a given link, this benefit comes at\
    \ a cost of state in\n   the SP network to build multicast trees and overhead\
    \ to maintain this\n   state.\n"
- title: 3.1.  Inclusive and Selective Multicast Trees
  contents:
  - "3.1.  Inclusive and Selective Multicast Trees\n   Multicast trees used for VPLS\
    \ can be of two types:\n     + Inclusive trees.  This option supports the use\
    \ of a single\n       multicast distribution tree, referred to as an \"Inclusive\n\
    \       P-multicast tree\", in the SP network to carry all the multicast\n   \
    \    traffic from a specified set of VPLS sites connected to a given\n       PE.\
    \  There is no assumption made with respect to whether or not\n       this traffic\
    \ is IP encapsulated.  A particular P-multicast tree\n       can be set up to\
    \ carry the traffic originated by sites belonging\n       to a single VPLS instance\
    \ or to carry the traffic originated by\n       sites belonging to different VPLS\
    \ instances.  In the context of\n       this document, the ability to carry the\
    \ traffic of more than one\n       VPLS instance on the same P-multicast tree\
    \ is called\n       \"aggregation\".  The tree includes every PE that is a member\
    \ of\n       any of the VPLS instances that are using the tree.  This implies\n\
    \       that a PE may receive multicast traffic for a multicast stream\n     \
    \  even if it doesn't have any receivers that are interested in\n       receiving\
    \ traffic for that stream.\n       An Inclusive P-multicast tree, as defined in\
    \ this document, is a\n       P2MP tree.  Thus, a P2MP tree is used to carry traffic\
    \ only from\n       VPLS sites that are connected to the PE that is the root of\
    \ the\n       tree.\n     + Selective trees.  A Selective P-multicast tree is\
    \ used by a PE to\n       send IP multicast traffic for one or more specific IP\
    \ multicast\n       streams, received by the PE over PE-CE interfaces that belong\
    \ to\n       the same or different VPLS instances, to a subset of the PEs that\n\
    \       belong to those VPLS instances.  Each of the PEs in the subset\n     \
    \  should be on the path to a receiver of one or more multicast\n       streams\
    \ that are mapped onto the tree.  In the context of this\n       document, the\
    \ ability to use the same P-multicast tree for\n       multicast streams that\
    \ belong to different VPLS instances is\n       called \"aggregation\".  The reason\
    \ for having Selective\n       P-multicast trees is to provide a PE the ability\
    \ to create\n       separate SP multicast trees for specific multicast streams,\
    \ e.g.,\n       high-bandwidth multicast streams.  This allows traffic for these\n\
    \       multicast streams to reach only those PE routers that have\n       receivers\
    \ for these streams.  This avoids flooding other PE\n       routers in the VPLS\
    \ instance.\n   An SP can use both Inclusive P-multicast trees and Selective\n\
    \   P-multicast trees or either of them for a given VPLS on a PE, based\n   on\
    \ local configuration.  Inclusive P-multicast trees can be used for\n   both IP\
    \ and non-IP data multicast traffic, while Selective\n   P-multicast trees, as\
    \ previously stated, must be used only for IP\n   multicast data traffic.  The\
    \ use of Selective P-multicast trees for\n   non-IP multicast traffic is outside\
    \ the scope of this document.\n   P-multicast trees in the SP network can be realized\
    \ via a variety of\n   technologies.  For both Inclusive and Selective P-multicast\
    \ trees,\n   these technologies include P2MP LSPs created by RSVP-TE or mLDP.\n\
    \   This document also describes the data plane encapsulations for\n   supporting\
    \ these technologies.  Other technologies for realizing\n   P-multicast trees\
    \ are outside the scope of this document.\n"
- title: 3.2.  BGP-Based VPLS Membership Auto-discovery
  contents:
  - "3.2.  BGP-Based VPLS Membership Auto-discovery\n   Inclusive P-multicast trees\
    \ may be established for one or more VPLS\n   instances.  In this case, aggregation\
    \ can be performed (using either\n   mLDP or P2MP RSVP-TE as the tunneling technology)\
    \ or simple tunneling\n   can be performed (using P2MP RSVP-TE tunneling).  If\
    \ either of these\n   approaches is used, the PE acting as the root of a P2MP\
    \ LSP must be\n   able to discover the other PEs that have membership of each\
    \ of the\n   VPLS instances.  Once the root PE discovers these other PEs, it\n\
    \   includes them as leaves in the P-multicast tree (i.e., P2MP LSP).\n   This\
    \ document uses the BGP-based procedures described in [RFC4761]\n   and [RFC6074]\
    \ for discovering the VPLS membership of all PEs.  For\n   more on aggregation,\
    \ see the \"Aggregation Considerations\" section.\n   When no aggregation is performed\
    \ and the tunneling technology is\n   mLDP, then the root of the P2MP LSP need\
    \ not discover the other PEs\n   that are the leaves of that LSP tree.\n   The\
    \ leaves of the Inclusive P-multicast tree must also be able to\n   auto-discover\
    \ the identifier of the tree (note that this applies when\n   the tree is established\
    \ by either mLDP or P2MP RSVP-TE).  Procedures\n   to accomplish this are described\
    \ in the \"Advertising P-Multicast Tree\n   to VPLS/C-Multicast Binding\" section.\n"
- title: 3.3.  IP Multicast Group Membership Discovery
  contents:
  - "3.3.  IP Multicast Group Membership Discovery\n   The setup of a Selective P-multicast\
    \ tree for one or more IP\n   multicast (C-S, C-G)s, requires the ingress PE to\
    \ learn the PEs that\n   have receivers in one or more of these (C-S, C-G)s, in\
    \ the following\n   cases:\n     + When aggregation is used (with either mLDP\
    \ or P2MP RSVP-TE as the\n       tunneling technology), OR\n     + When the tunneling\
    \ technology is P2MP RSVP-TE\n     + If ingress replication is used and the ingress\
    \ PE wants to send\n       traffic for (C-S, C-G)s to only those PEs that are\
    \ on the path to\n       receivers for the (C-S, C-G)s.\n   For more on aggregation,\
    \ see the \"Aggregation Considerations\"\n   section.\n   For discovering the\
    \ IP multicast group membership, this document\n   describes procedures that allow\
    \ an ingress PE to enable explicit\n   tracking of IP multicast membership.  Thus,\
    \ an ingress PE can request\n   the IP multicast membership from egress PEs for\
    \ one or more\n   C-multicast streams.  These procedures are described in the\n\
    \   \"Optimizing Multicast Distribution via Selective Trees\" section.\n   These\
    \ procedures are applicable when IGMP ([RFC2236] [RFC3376]) or\n   MLD ([RFC2710]\
    \ [RFC3810]) is used as the multicast signaling protocol\n   between the VPLS\
    \ CEs.  They are also applicable when PIM ([RFC4601])\n   in either the Any-Source\
    \ Multicast (ASM) or the Source-Specific\n   Multicast (SSM) service model is\
    \ used as the multicast routing\n   protocol between the VPLS CEs, and PIM join\
    \ suppression is disabled\n   on all the CEs.\n   However, these procedures do\
    \ not apply when PIM is used as the\n   multicast routing protocol between the\
    \ VPLS CEs and PIM join\n   suppression is not disabled on all the CEs.  This\
    \ is because when PIM\n   join suppression is not disabled on all the CEs, PEs\
    \ connected to\n   these CEs can not rely on PIM to determine IP multicast membership\
    \ of\n   the receivers behind these CEs.  Procedures for this case are outside\n\
    \   the scope of this document.\n   The leaves of the Selective P-multicast trees\
    \ must also be able to\n   discover the identifier of these trees.  Procedures\
    \ to accomplish\n   this are described in the \"Advertising P-Multicast Tree to\n\
    \   VPLS/C-Multicast Binding\" section.\n"
- title: 3.4.  Advertising P-Multicast Tree to VPLS/C-Multicast Binding
  contents:
  - "3.4.  Advertising P-Multicast Tree to VPLS/C-Multicast Binding\n   This document\
    \ describes procedures based on BGP VPLS Auto-Discovery\n   (A-D) routes ([RFC4761]\
    \ [RFC6074]) that are used by the root of an\n   Aggregate P-multicast tree to\
    \ advertise the Inclusive or Selective\n   P-multicast tree binding and the demultiplexing\
    \ information to the\n   leaves of the tree.  This document uses the Provider\
    \ Multicast\n   Service Interface (PMSI) Tunnel attribute defined [RFC6514] for\
    \ this\n   purpose.\n   Once an ingress PE decides to bind a set of VPLS instances\
    \ or\n   customer multicast groups to an Inclusive P-multicast tree or a\n   Selective\
    \ P-multicast tree, the PE needs to announce this binding to\n   other PEs in\
    \ the network.  This procedure is referred to as\n   \"Inclusive P-multicast tree\
    \ binding distribution\" or \"Selective\n   P-multicast tree binding distribution\"\
    \ and is performed using BGP.\n   The decision to bind a set of VPLS instances\
    \ or customer multicast\n   groups is a local matter to the ingress, and is controlled\
    \ via\n   provisioning/configuration on that PE.\n   When an Aggregated Inclusive\
    \ P-multicast tree is used by an ingress\n   PE, this binding distribution implies\
    \ that (a) an ingress PE MUST\n   announce the binding of all VPLS instances bound\
    \ to the Inclusive\n   P-multicast tree and (b) other PEs that have these instances\
    \ receive\n   these announcements.  The inner label assigned by the ingress PE\
    \ for\n   each VPLS MUST be included if more than one VPLS is bound to the same\n\
    \   P-multicast tree.  The Inclusive P-multicast tree Identifier MUST be\n   included.\n\
    \   For a Selective P-multicast tree, this binding distribution implies\n   announcing\
    \ all the specific <C-S, C-G> entries bound to this\n   P-multicast tree along\
    \ with the Selective P-multicast tree\n   Identifier.  The inner label assigned\
    \ for each <C-S, C-G> MUST be\n   included if <C-S, C-G> from different VPLS instances\
    \ are bound to the\n   same P-multicast tree.  The labels MUST be distinct on\
    \ a per-VPLS\n   basis and MAY be distinct per <C-S, C-G> entry.  The Selective\n\
    \   P-multicast tree Identifier MUST be included.\n"
- title: 3.5.  Aggregation
  contents:
  - "3.5.  Aggregation\n   As described earlier in this document, the ability to carry\
    \ the\n   traffic of more than one VPLS on the same P-multicast tree is called\n\
    \   aggregation.\n   Aggregation enables the SP to place a bound on the amount\
    \ of\n   multicast tree forwarding and control plane state that the P-routers\n\
    \   must have.  Let us call the number of VPLS instances aggregated onto\n   a\
    \ single P-multicast tree the \"Aggregation Factor\".  When Inclusive\n   source\
    \ P-multicast trees are used, the number of trees that a PE is\n   the root of\
    \ is proportional to the number of VPLS instances on the PE\n   divided by the\
    \ Aggregation Factor.\n   In this case, the state maintained by a P-router is\
    \ proportional to:\n        AveVPLS            NPE\n        -------    X    --------\n\
    \          Aggr          AvePTree\n      Where:\n      AveVPLS is the average\
    \ number of VPLS instances on a PE\n      Aggr is the Aggregation Factor\n   \
    \   NPE is the number of PEs\n      AvePTree is the average number of P-multicast\
    \ that transit a given\n      P-router\n   Thus, the state does not grow linearly\
    \ with the number of VPLS\n   instances.\n   Aggregation requires a mechanism\
    \ for the egresses of the P-multicast\n   tree to demultiplex the multicast traffic\
    \ received over the\n   P-multicast tree.  To enable the egress nodes to perform\
    \ this\n   demultiplexing, upstream-assigned labels [RFC5331] MUST be assigned\n\
    \   and distributed by the root of the aggregate P-multicast tree.\n   Aggregation\
    \ procedures would require two MPLS labels in the label\n   stack.  This does\
    \ not introduce any new implications on MTU, as even\n   VPLS multicast supported\
    \ by ingress replication requires two MPLS\n   labels in the label stack.\n"
- title: 3.6.  Inter-AS VPLS Multicast
  contents:
  - "3.6.  Inter-AS VPLS Multicast\n   This document defines four models of inter-AS\
    \ (Autonomous System)\n   VPLS service, referred here as options (a), (b), (c),\
    \ and (e).\n   Options (a), (b), and (c) defined in this document are very similar\n\
    \   to methods (a), (b), and (c), described in the \"Multi-AS VPLS\"\n   section\
    \ of [RFC4761], which in turn extends the concepts of [RFC4364]\n   to inter-AS\
    \ VPLS.\n   For option (a) and option (b) support, this document specifies a\n\
    \   model where inter-AS VPLS service can be offered without requiring a\n   single\
    \ P-multicast tree to span multiple ASes.  There are two\n   variants of this\
    \ model, and they are described in the \"Inter-AS\n   Inclusive P-Multicast Tree\
    \ A-D/Binding\" section.\n   For option (c) support, this document specifies a\
    \ model where inter-\n   AS VPLS service is offered by requiring a single P-multicast\
    \ tree to\n   span multiple ASes.  This is because in the case of option (c),\
    \ the\n   Autonomous System Border Routers (ASBRs) do not exchange BGP-VPLS\n\
    \   Network Layer Reachability Information (NLRI) or A-D routes.\n   In addition\
    \ to options (a), (b), and (c), this document also\n   specifies option (e), which\
    \ one may think of as a variant of option\n   (a).\n   For more on these inter-AS\
    \ options, see the \"Inter-AS Inclusive\n   P-Multicast Tree A-D/Binding\" section.\n"
- title: 4.  Intra-AS Inclusive P-Multicast Tree Auto-discovery/Binding
  contents:
  - "4.  Intra-AS Inclusive P-Multicast Tree Auto-discovery/Binding\n   This section\
    \ specifies procedures for the intra-AS auto-discovery of\n   VPLS membership\
    \ and the distribution of information used to\n   instantiate P-multicast Tunnels.\n\
    \   VPLS auto-discovery/binding consists of two components: intra-AS and\n   inter-AS.\
    \  The former provides VPLS auto-discovery/binding within a\n   single AS.  The\
    \ latter provides VPLS auto-discovery/binding across\n   multiple ASes.  Inter-AS\
    \ auto-discovery/binding is described in the\n   \"Inter-AS Inclusive P-Multicast\
    \ Tree A-D/Binding\" section.\n   VPLS auto-discovery using BGP, as described\
    \ in [RFC4761] and\n   [RFC6074], enables a PE to learn the VPLS instance membership\
    \ of\n   other PEs.  A PE that belongs to a particular VPLS instance announces\n\
    \   a BGP NLRI that identifies the Virtual Switch Instance (VSI).  This\n   NLRI\
    \ is constructed from the <Route Distinguisher (RD), VPLS Edge\n   Device Identifier\
    \ (VE-ID)> tuple.  The NLRI defined in [RFC4761]\n   comprises the <RD, VE-ID>\
    \ tuple and label blocks for pseudowire (PW)\n   signaling.  The VE-ID in this\
    \ case is a two-octet number encoded in\n   the VE-ID of NLRI defined in [RFC4761].\
    \  The NLRI defined in\n   [RFC6074] comprises only the <RD, PE_addr>.  The VE-ID\
    \ in this case\n   is a four-octet number encoded in the PE_addr of the NLRI defined\
    \ in\n   [RFC6074].\n   The procedures for constructing Inclusive Intra-AS and\
    \ Inter-AS\n   trees, as specified in this document, require the BGP A-D NLRI\
    \ to\n   carry only the <RD, VE-ID>.  Hence, these procedures can be used for\n\
    \   both BGP-VPLS and LDP-VPLS with BGP A-D.\n   It is to be noted that BGP A-D\
    \ is an inherent feature of BGP-VPLS.\n   However, it is not an inherent feature\
    \ of LDP-VPLS.  In fact, there\n   are deployments and/or implementations of LDP-VPLS\
    \ that require\n   configuration to enable a PE in a particular VPLS to determine\
    \ other\n   PEs in the VPLS and exchange PW labels using Forwarding Equivalence\n\
    \   Class (FEC) 128 (PWid FEC) [RFC4447].  The use of BGP A-D for LDP-\n   VPLS\
    \ [RFC6074], to enable automatic setup of PWs, requires FEC 129\n   (Generalized\
    \ PWid FEC) [RFC4447].  However, FEC 129 is not required\n   in order to use procedures\
    \ in this document for LDP-VPLS.  An LDP-\n   VPLS implementation that supports\
    \ this document MUST support the BGP\n   A-D procedures to set up P-multicast\
    \ trees, as described here, and it\n   MAY support FEC 129 to automate the signaling\
    \ of PWs.\n"
- title: 4.1.  Originating Intra-AS VPLS A-D Routes
  contents:
  - "4.1.  Originating Intra-AS VPLS A-D Routes\n   To participate in the VPLS auto-discovery/binding,\
    \ a PE router that\n   has a given VSI of a given VPLS instance originates a BGP\
    \ VPLS Intra-\n   AS A-D route and advertises this route in Multiprotocol (MP)\
    \ IBGP.\n   The route is constructed as described in [RFC4761] and [RFC6074].\n\
    \   The route carries a single Layer 2 Virtual Private Network (L2VPN)\n   NLRI\
    \ with the RD set to the RD of the VSI and the VE-ID set to the\n   VE-ID of the\
    \ VSI.  The route also carries one or more Route Targets\n   (RTs), as specified\
    \ in [RFC4761] and [RFC6074].\n   If an Inclusive P-multicast tree is used to\
    \ instantiate the provider\n   tunnel for VPLS multicast on the PE, the advertising\
    \ PE MUST\n   advertise the type and the identity of the P-multicast tree in the\n\
    \   PMSI Tunnel attribute.  This attribute is described in the \"Inclusive\n \
    \  Tree/Selective Tree Identifier\" section.\n   A PE that uses an Inclusive P-multicast\
    \ tree to instantiate the\n   provider tunnel MAY aggregate two or more VPLS instances\
    \ present on\n   the PE onto the same tree.  If the PE decides to perform aggregation\n\
    \   after it has already advertised the intra-AS VPLS A-D routes for\n   these\
    \ VPLS instances, then aggregation requires the PE to\n   re-advertise these routes.\
    \  The re-advertised routes MUST be the same\n   as the original ones, except\
    \ for the PMSI Tunnel attribute (the\n   re-advertised route will replace the\
    \ previously advertised route).\n   If the PE has not previously advertised Intra-AS\
    \ A-D routes for these\n   VPLS instances, then the aggregation requires the PE\
    \ to advertise\n   (new) Intra-AS A-D routes for these VPLS instances.  The PMSI\
    \ Tunnel\n   attribute in the newly advertised/re-advertised routes MUST carry\
    \ the\n   identity of the P-multicast tree that aggregates the VPLS instances\n\
    \   as well as an MPLS upstream-assigned label [RFC5331].  Each\n   re-advertised\
    \ or newly advertised route MUST have a label that is\n   distinct within the\
    \ scope of the PE that advertises the route.\n   Discovery of PE capabilities\
    \ in terms of what tunnel types they\n   support is outside the scope of this\
    \ document.  Within a given AS,\n   PEs participating in a VPLS are expected to\
    \ advertise tunnel bindings\n   whose tunnel types are supported by all other\
    \ PEs that are\n   participating in this VPLS and are part of the same AS.\n"
- title: 4.2.  Receiving Intra-AS VPLS A-D Routes
  contents:
  - "4.2.  Receiving Intra-AS VPLS A-D Routes\n   When a PE receives a BGP Update\
    \ message that carries an Intra-AS A-D\n   route such that (a) the route was originated\
    \ by some other PE within\n   the same AS as the local PE, (b) at least one of\
    \ the RTs of the route\n   matches one of the import RTs configured for a particular\
    \ VSI on the\n   local PE, (c) the BGP route selection determines that this is\
    \ the\n   best route with respect to the NLRI carried by the route, and (d) the\n\
    \   route carries the PMSI Tunnel attribute, the PE performs the\n   following:\n\
    \     + If the Tunnel Type in the PMSI Tunnel attribute is set to LDP\n      \
    \ P2MP LSP, the PE SHOULD join the P-multicast tree whose identity\n       is\
    \ carried in the PMSI Tunnel attribute.\n     + If the Tunnel Type in the PMSI\
    \ Tunnel attribute is set to RSVP-TE\n       P2MP LSP, the receiving PE has to\
    \ establish the appropriate state\n       to properly handle the traffic received\
    \ over that LSP.  The PE\n       that originated the route MUST establish an RSVP-TE\
    \ P2MP LSP with\n       the local PE as a leaf.  This LSP MAY have been established\n\
    \       before the local PE receives the route.\n     + If the PMSI Tunnel attribute\
    \ does not carry a label, then all\n       packets that are received on the P-multicast\
    \ tree, as identified\n       by the PMSI Tunnel attribute, are forwarded using\
    \ the VSIs that\n       have at least one of their import RTs that matches one\
    \ of the RTs\n       of the received A-D route.\n     + If the PMSI Tunnel attribute\
    \ has the Tunnel Type set to LDP P2MP\n       LSP or RSVP-TE P2MP LSP, and the\
    \ attribute also carries an MPLS\n       label, then the egress PE MUST treat\
    \ this as an upstream-assigned\n       label, and all packets that are received\
    \ on the P-multicast tree,\n       as identified by the PMSI Tunnel attribute,\
    \ with that upstream\n       label are forwarded using the VSIs that have at least\
    \ one of\n       their import RTs that matches one of the RTs of the received\n\
    \       Intra-AS A-D route.\n   Furthermore, if the local PE uses RSVP-TE P2MP\
    \ LSP for sending\n   (multicast) traffic, originated by VPLS sites connected\
    \ to the PE, to\n   the sites attached to other PEs, then the local PE MUST use\
    \ the\n   Originating Router's IP Address information carried in the Intra-AS\n\
    \   A-D route to add the PE, that originated the route, as a leaf node to\n  \
    \ the LSP.  This MUST be done irrespective of whether or not the\n   received\
    \ Intra-AS A-D route carries the PMSI Tunnel attribute.\n"
- title: 5.  Demultiplexing P-Multicast Tree Traffic
  contents:
  - "5.  Demultiplexing P-Multicast Tree Traffic\n   Demultiplexing received VPLS\
    \ traffic requires the receiving PE to\n   determine the VPLS instance to which\
    \ the packet belongs.  The egress\n   PE can then perform a VPLS lookup to further\
    \ forward the packet.  It\n   also requires the egress PE to determine the identity\
    \ of the ingress\n   PE for MAC learning, as described in the \"VPLS Data Packet\
    \ Treatment\"\n   section.\n"
- title: 5.1.  One P-Multicast Tree - One VPLS Mapping
  contents:
  - "5.1.  One P-Multicast Tree - One VPLS Mapping\n   When a P-multicast tree is\
    \ mapped to only one VPLS, determining the\n   tree on which the packet is received\
    \ is sufficient to determine the\n   VPLS instance on which the packet is received.\
    \  The tree is\n   determined based on the tree encapsulation.  If MPLS encapsulation\
    \ is\n   used, e.g., RSVP-TE P2MP LSPs, the outer MPLS label is used to\n   determine\
    \ the tree.  Penultimate Hop Popping (PHP) MUST be disabled\n   on the MPLS LSP\
    \ (RSVP-TE P2MP LSP or mLDP P2MP LSP).\n"
- title: 5.2.  One P-Multicast Tree - Many VPLS Mapping
  contents:
  - "5.2.  One P-Multicast Tree - Many VPLS Mapping\n   As traffic belonging to multiple\
    \ VPLS instances can be carried over\n   the same tree, there is a need to identify\
    \ the VPLS to which the\n   packet belongs.  This is done by using an inner label\
    \ that determines\n   the VPLS for which the packet is intended.  The ingress\
    \ PE uses this\n   label as the inner label while encapsulating a customer multicast\n\
    \   data packet.  Each of the egress PEs must be able to associate this\n   inner\
    \ label with the same VPLS and use it to demultiplex the traffic\n   received\
    \ over the Aggregate Inclusive tree or the Aggregate Selective\n   tree.\n   If\
    \ traffic from multiple VPLS instances is carried on a single tree,\n   upstream-assigned\
    \ labels [RFC5331] MUST be used.  Hence, the inner\n   label is assigned by the\
    \ ingress PE.  When the egress PE receives a\n   packet over an Aggregate tree,\
    \ the outer encapsulation (in the case\n   of MPLS P2MP LSPs, the outer MPLS label)\
    \ specifies the label space to\n   perform the inner-label lookup.  The same label\
    \ space MUST be used by\n   the egress PE for all P-multicast trees that have\
    \ the same root\n   [RFC5331].\n   If the tree uses MPLS encapsulation, as in\
    \ RSVP-TE P2MP LSPs, the\n   outer MPLS label and, optionally, the incoming interface\
    \ provide the\n   label space of the label beneath it.  This assumes that PHP\
    \ is\n   disabled.  The egress PE MUST NOT advertise IMPLICIT NULL or EXPLICIT\n\
    \   NULL for that tree once it is known to the egress PE that the tree is\n  \
    \ bound to one or more VPLS instances.  Once the label representing the\n   tree\
    \ is popped off the MPLS label stack, the next label is the\n   demultiplexing\
    \ information that allows the proper VPLS instance to be\n   determined.\n   The\
    \ ingress PE informs the egress PEs about the inner label as part\n   of the tree\
    \ binding procedures described in the \"BGP Extensions\"\n   section.\n"
- title: 6.  Establishing P-Multicast Trees
  contents:
  - "6.  Establishing P-Multicast Trees\n   This document supports only P2MP P-multicast\
    \ trees wherein it is\n   possible for egress PEs to identify the ingress PE to\
    \ perform MAC\n   learning.  Specific procedures are identified only for RSVP-TE\
    \ P2MP\n   LSPs and mLDP P2MP LSPs.  An implementation that supports this\n  \
    \ document MUST support RSVP-TE P2MP LSPs and mLDP P2MP LSPs.\n"
- title: 6.1.  Common Procedures
  contents:
  - "6.1.  Common Procedures\n   The following procedures apply to both RSVP-TE P2MP\
    \ and mLDP P2MP\n   LSPs.\n   Demultiplexing the C-multicast data packets at the\
    \ egress PE requires\n   that the PE must be able to determine the P2MP LSP on\
    \ which the\n   packets are received.  This enables the egress PE to determine\
    \ the\n   VPLS instances to which the packet belongs.  To achieve this, the LSP\n\
    \   MUST be signaled with PHP off and a non-special purpose MPLS label\n   off\
    \ as described in the \"Demultiplexing P-Multicast Tree Traffic\"\n   section.\
    \  In other words, an egress PE MUST NOT advertise IMPLICIT\n   NULL or EXPLICIT\
    \ NULL for a P2MP LSP that is carrying traffic for one\n   or more VPLS instances.\
    \  This is because the egress PE needs to rely\n   on the MPLS label, that it\
    \ advertises to its upstream neighbor, to\n   determine the P2MP LSP on which\
    \ a C-multicast data packet is\n   received.\n   The egress PE also needs to identify\
    \ the ingress PE to perform MAC\n   learning.  When P2MP LSPs are used as P2MP\
    \ trees, determining the\n   P2MP LSP on which the packets are received is sufficient\
    \ to determine\n   the ingress PE.  This is because the ingress PE is the root\
    \ of the\n   P2MP LSP.\n   The egress PE relies on receiving the PMSI Tunnel attribute\
    \ in BGP to\n   determine the VPLS instance to P2MP LSP mapping.\n"
- title: 6.2.  RSVP-TE P2MP LSPs
  contents:
  - "6.2.  RSVP-TE P2MP LSPs\n   This section describes procedures that are specific\
    \ to the usage of\n   RSVP-TE P2MP LSPs for instantiating a P-multicast tree.\
    \  Procedures\n   in [RFC4875] are used to signal the P2MP LSP.  The LSP is signaled\
    \ as\n   the root of the P2MP LSP discovers the leaves.  The egress PEs are\n\
    \   discovered using the procedures described in the \"Intra-AS Inclusive\n  \
    \ P-Multicast Tree Auto-discovery/Binding\" section.  Aggregation, as\n   described\
    \ in this document, is supported.\n"
- title: 6.2.1.  P2MP TE LSP - VPLS Mapping
  contents:
  - "6.2.1.  P2MP TE LSP - VPLS Mapping\n   P2MP TE LSP to VPLS mapping is learned\
    \ at the egress PEs using BGP-\n   based advertisements of the P2MP TE LSP - VPLS\
    \ mapping.  They require\n   that the root of the tree include in the BGP advertisements\
    \ the P2MP\n   TE LSP identifier as the P-multicast tree identifier.  This\n \
    \  P-multicast tree identifier contains the following information\n   elements:\n\
    \           - The type of the tunnel is set to RSVP-TE P2MP LSP\n           -\
    \ RSVP-TE P2MP LSP's SESSION Object\n   See the \"Inclusive Tree/Selective Tree\
    \ Identifier\" section for more\n   details on how this tree identifier is carried\
    \ in BGP advertisements.\n   Once the egress PE receives the P2MP TE LSP to VPLS\
    \ mapping:\n     + If the egress PE already has RSVP-TE state for the P2MP TE\
    \ LSP,\n       it MUST begin to assign an MPLS label from the non-special\n  \
    \     purpose label range, for the P2MP TE LSP and signal this to the\n      \
    \ previous hop of the P2MP TE LSP.  Further, it MUST create\n       forwarding\
    \ state to forward packets received on the P2MP LSP.\n     + If the egress PE\
    \ does not have RSVP-TE state for the P2MP TE LSP,\n       it MUST retain this\
    \ mapping.  Subsequently, when the egress PE\n       receives the RSVP-TE P2MP\
    \ signaling message, it creates the RSVP-\n       TE P2MP LSP state.  It MUST\
    \ then assign an MPLS label from the\n       non-reserved label range, for the\
    \ P2MP TE LSP, and signal this to\n       the previous hop of the P2MP TE LSP.\n\
    \       Note that if the signaling to set up an RSVP-TE P2MP LSP is\n       completed\
    \ before a given egress PE learns, via a PMSI Tunnel\n       attribute, of the\
    \ VPLS or set of VPLS instances to which the LSP\n       is bound, the PE MUST\
    \ discard any traffic received on that LSP\n       until the binding is received.\
    \  In order for the egress PE to be\n       able to discard such traffic, it needs\
    \ to know that the LSP is\n       associated with one or more VPLS instances and\
    \ that the VPLS A-D\n       route that binds the LSP to a VPLS has not yet been\
    \ received.\n       This is provided by extending [RFC4875] with [RFC6511].\n"
- title: 6.3.  Receiver-Initiated P2MP LSP
  contents:
  - "6.3.  Receiver-Initiated P2MP LSP\n   Receiver-initiated P2MP LSPs can also be\
    \ used.  The mLDP procedures\n   ([RFC6388]) MUST be used to signal such LSPs.\
    \  The LSP is signaled\n   once the leaves receive the LDP FEC for the tree from\
    \ the root, as\n   described in the \"Intra-AS Inclusive P-Multicast Tree Auto-\n\
    \   discovery/Binding\" section.  When aggregation is used, an ingress PE\n  \
    \ is required to discover the egress PEs (see the \"Aggregation\n   Considerations\"\
    \ section for the rationale), and this is achieved\n   using the procedures in\
    \ the \"Intra-AS Inclusive P-Multicast Tree\n   Auto-discovery/Binding\" section.\n"
- title: 6.3.1.  P2MP LSP - VPLS Mapping
  contents:
  - "6.3.1.  P2MP LSP - VPLS Mapping\n   P2MP LSP to VPLS mapping is learned at the\
    \ egress PEs using BGP-based\n   advertisements of the P2MP LSP - VPLS mapping.\
    \  They require that the\n   root of the tree include in the BGP advertisements\
    \ the P2MP LSP\n   identifier as the P-multicast tree identifier.  This P-multicast\
    \ tree\n   identifier contains the following information elements:\n      - The\
    \ type of the tunnel is set to LDP P2MP LSP\n      - LDP P2MP FEC that includes\
    \ an identifier generated by the root.\n   See the \"Inclusive Tree/Selective\
    \ Tree Identifier\" section for more\n   details on how this tree identifier is\
    \ carried in BGP advertisements.\n   Each egress PE SHOULD \"join\" the P2MP MPLS\
    \ tree by sending LDP label\n   mapping messages for the LDP P2MP FEC, that was\
    \ learned in the BGP\n   advertisement, using procedures described in [RFC6388].\n"
- title: 6.4.  Encapsulation of Aggregate P-multicast Trees
  contents:
  - "6.4.  Encapsulation of Aggregate P-multicast Trees\n   An Aggregate Inclusive\
    \ P-multicast tree or an Aggregate Selective\n   P-multicast tree MUST use MPLS\
    \ encapsulation, as described in\n   [RFC5332].\n"
- title: 7.  Inter-AS Inclusive P-Multicast Tree A-D/Binding
  contents:
  - "7.  Inter-AS Inclusive P-Multicast Tree A-D/Binding\n   As stated earlier, this\
    \ document defines four models of inter-AS VPLS\n   service, referred here as\
    \ option (a), (b), (c), and (e).  This\n   section contains procedures to support\
    \ these models.\n   For supporting option (a), (b), and (e), this section specifies\
    \ a\n   model where inter-AS VPLS service can be offered without requiring a\n\
    \   single P-multicast tree to span multiple ASes.  This allows\n   individual\
    \ ASes to potentially use different P-tunneling\n   technologies.  There are two\
    \ variants of this model.  One that\n   requires MAC lookup on the ASBRs and applies\
    \ to option (a) and (e).\n   The other is one that does not require MAC lookup\
    \ on the ASBRs, and\n   instead it builds segmented Inter-AS Inclusive or Selective\
    \ trees.\n   This applies only to option (b).\n   For supporting option (c), this\
    \ section specifies a model where\n   Inter-AS VPLS service is offered by requiring\
    \ a single Inclusive\n   P-multicast tree to span multiple ASes.  This is referred\
    \ to as a\n   \"non-segmented P-multicast tree\".  This is because in the case\
    \ of\n   option (c), the ASBRs do not exchange BGP-VPLS NLRIs or VPLS A-D\n  \
    \ routes.  Support for Inter-AS Selective trees for option (c) may be\n   segmented\
    \ or non-segmented.\n   An implementation MUST support options (a), (b), and (c),\
    \ and MAY\n   support option (e).  When there are multiple ways for implementing\n\
    \   one of these options, this section specifies which one is mandatory.\n"
- title: 7.1.  VSIs on the ASBRs
  contents:
  - "7.1.  VSIs on the ASBRs\n   When VSIs are configured on ASBRs, the ASBRs MUST\
    \ perform a MAC\n   lookup, in addition to any MPLS lookups, to determine the\
    \ forwarding\n   decision on a VPLS packet.  The P-multicast trees are confined\
    \ to an\n   AS.  An ASBR on receiving a VPLS packet from another ASBR is required\n\
    \   to perform a MAC lookup to determine how to forward the packet.\n   Thus,\
    \ an ASBR is required to keep a VSI for the VPLS instance and\n   MUST be configured\
    \ with its own VE-ID for the VPLS instance.  The BGP\n   VPLS A-D routes generated\
    \ by PEs in an AS MUST NOT be propagated\n   outside the AS.\n"
- title: '7.1.1.  Option (a): VSIs on the ASBRs'
  contents:
  - "7.1.1.  Option (a): VSIs on the ASBRs\n   In option (a), an ASBR acts as a PE\
    \ for the VPLSs that span the AS of\n   the ASBR and an AS to which the ASBR is\
    \ connected.  The local ASBR\n   views the ASBR in the neighboring AS as a CE\
    \ connected to it by a\n   link with separate VLAN sub-interfaces for each such\
    \ VPLS.\n   Similarly, the ASBR in the neighboring AS acts as a PE for such VPLS\n\
    \   from the neighboring AS's point of view, and views the local ASBR as\n   a\
    \ CE.\n   The local ASBR uses a combination of the incoming link and a\n   particular\
    \ VLAN sub-interface on that link to determine the VSI for\n   the packets it\
    \ receives from the ASBR in the neighboring AS.\n   In option (a), the ASBRs do\
    \ not exchange VPLS A-D routes.\n   An implementation MUST support option (a).\n"
- title: '7.1.2.  Option (e): VSIs on the ASBRs'
  contents:
  - "7.1.2.  Option (e): VSIs on the ASBRs\n   The VSIs on the ASBRs scheme can be\
    \ used such that the interconnect\n   between the ASBRs is a PW and MPLS encapsulation\
    \ is used between the\n   ASBRs.  An ASBR in one AS determines the VSI for packets\
    \ received\n   from an adjoining ASBR in another AS based on the incoming MPLS\
    \ PW\n   label.  This is referred to as \"option (e)\".  The only VPLS A-D\n \
    \  routes that are propagated outside the AS are the ones originated by\n   ASBRs.\
    \  This MPLS PW connects the VSIs on the ASBRs and MUST be\n   signaled using\
    \ the procedures defined in [RFC4761] or [RFC4762].\n   The P-multicast trees\
    \ for a VPLS are confined to each AS and the VPLS\n   auto-discovery/binding MUST\
    \ follow the intra-AS procedures described\n   in the \"Demultiplexing P-Multicast\
    \ Tree Traffic\" section.\n   An implementation MAY support option (e).\n"
- title: 7.2.  Option (b) - Segmented Inter-AS Trees
  contents:
  - "7.2.  Option (b) - Segmented Inter-AS Trees\n   In this model, an inter-AS P-multicast\
    \ tree, rooted at a particular\n   PE for a particular VPLS instance, consists\
    \ of a number of\n   \"segments\", one per AS, which are stitched together at\
    \ ASBRs.  These\n   are known as \"segmented inter-AS trees\".  Each segment of\
    \ a segmented\n   inter-AS tree may use a different multicast transport technology.\
    \  In\n   this model, an ASBR is not required to keep a VSI for the VPLS\n   instance,\
    \ and is not required to perform a MAC lookup in order to\n   forward the VPLS\
    \ packet.  This implies that an ASBR is not required\n   to be configured with\
    \ a VE-ID for the VPLS.\n   An implementation MUST support option (b) using this\
    \ model.\n   The construction of segmented inter-AS trees requires the BGP-VPLS\n\
    \   A-D NLRI described in [RFC4761] and [RFC6074].  A BGP VPLS A-D route\n   for\
    \ an <RD, VE-ID> tuple advertised outside the AS, to which the\n   originating\
    \ PE belongs, will be referred to as an \"Inter-AS VPLS A-D\n   route\" (though\
    \ this route is originated by a PE as an intra-AS route,\n   and is referred to\
    \ as an \"inter-AS route outside the AS\").\n   In addition to this, segmented\
    \ inter-AS trees require support for the\n   PMSI Tunnel attribute described in\
    \ the \"Inclusive Tree/Selective Tree\n   Identifier\" section.  They also require\
    \ additional procedures in BGP\n   to signal leaf A-D routes between ASBRs as\
    \ explained in subsequent\n   sections.\n"
- title: 7.2.1.  Segmented Inter-AS Trees VPLS Inter-AS A-D/Binding
  contents:
  - "7.2.1.  Segmented Inter-AS Trees VPLS Inter-AS A-D/Binding\n   This section specifies\
    \ the procedures for inter-AS VPLS A-D/binding\n   for segmented Inter-AS trees.\n\
    \   An ASBR must be configured to support a particular VPLS as follows:\n    \
    \ + An ASBR MUST be configured with a set of (import) RTs that\n       specify\
    \ the set of VPLS instances supported by the ASBR.  These\n       RTs control\
    \ acceptance of BGP VPLS auto-discovery routes by the\n       ASBR.  Note that\
    \ instead of being configured, the ASBR MAY obtain\n       this set of (import)\
    \ RTs by using Route Target Constrain\n       [RFC4684].\n     + The ASBR MUST\
    \ be configured with the tunnel types for the intra-\n       AS segments of the\
    \ VPLS instances supported by the ASBR, as well\n       as (depending on the tunnel\
    \ type) the information needed to\n       create the PMSI Tunnel attribute for\
    \ these tunnel types.  Note\n       that instead of being configured, the ASBR\
    \ MAY derive the tunnel\n       types from the Intra-AS A-D routes received by\
    \ the ASBR from the\n       PEs in its own AS.\n   If an ASBR is configured to\
    \ support a particular VPLS instance, the\n   ASBR MUST participate in the intra-AS\
    \ VPLS auto-discovery/binding\n   procedures for that VPLS instance within the\
    \ ASBR's own AS, as\n   defined in this document.\n   Moreover, in addition to\
    \ the above, the ASBR performs procedures\n   specified in the \"Propagating BGP\
    \ VPLS A-D Routes to Other ASes:\n   Overview\" section.\n"
- title: '7.2.2.  Propagating BGP VPLS A-D Routes to Other ASes: Overview'
  contents:
  - "7.2.2.  Propagating BGP VPLS A-D Routes to Other ASes: Overview\n   A BGP VPLS\
    \ A-D route for a given VPLS, originated by a PE within a\n   given AS, is propagated\
    \ via BGP to other ASes.  The precise rules for\n   distributing and processing\
    \ the Inter-AS A-D routes are given in\n   subsequent sections.\n   Suppose that\
    \ an ASBR \"A\" receives and installs a BGP VPLS A-D route\n   for VPLS \"X\"\
    \ and VE-ID \"V\" that originated at a particular PE \"PE1\"\n   that is in the\
    \ same AS as A.  The BGP next hop of that received route\n   becomes A's \"upstream\
    \ neighbor\" on a multicast distribution tree for\n   (X, V) that is rooted at\
    \ PE1.  Likewise, when A re-advertises this\n   route to ASBRs in A's neighboring\
    \ ASes, from the perspective of these\n   ASBRs A becomes their \"upstream neighbor\"\
    \ on the multicast\n   distribution tree for (X, V) that is rooted at PE1.\n \
    \  When the BGP VPLS A-D routes have been distributed to all the\n   necessary\
    \ ASes, they define a \"reverse path\" from any AS that\n   supports VPLS X and\
    \ VE-ID V back to PE1.  For instance, if AS2\n   supports VPLS X, then there will\
    \ be a reverse path for VPLS X and VE\n   ID V from AS2 to AS1.  This path is\
    \ a sequence of ASBRs, the first of\n   which is in AS2 and the last of which\
    \ is in AS1.  Each ASBR in the\n   sequence is the BGP next hop of the previous\
    \ ASBR in the sequence.\n   This reverse path information can be used to construct\
    \ a\n   unidirectional multicast distribution tree for VPLS X and VE-ID V,\n \
    \  containing all the ASes that support X, and having PE1 at the root.\n   We\
    \ call such a tree an \"inter-AS tree\".  Multicast data originating\n   in VPLS\
    \ sites for VPLS X connected to PE1 will travel downstream\n   along the tree\
    \ which is rooted at PE1.\n   The path along an inter-AS tree is a sequence of\
    \ ASBRs.  It is still\n   necessary to specify how the multicast data gets from\
    \ a given ASBR to\n   the set of ASBRs that are immediately downstream of the\
    \ given ASBR\n   along the tree.  This is done by creating \"segments\".  ASBRs\
    \ in\n   adjacent ASes will be connected by inter-AS segments; ASBRs in the\n\
    \   same AS will be connected by \"intra-AS segments\".\n   For a given inter-AS\
    \ tree and a given AS, there MUST be only one ASBR\n   within that AS that accepts\
    \ traffic flowing on that tree.  Further,\n   for a given inter-AS tree and a\
    \ given AS, there MUST be only one ASBR\n   in that AS that sends the traffic\
    \ flowing on that tree to a\n   particular adjacent AS.  The precise rules for\
    \ accomplishing this are\n   given in subsequent sections.\n   An ASBR initiates\
    \ creation of an intra-AS segment when the ASBR\n   receives an Inter-AS A-D route\
    \ from an External BGP (EBGP) neighbor.\n   Creation of the segment is completed\
    \ as a result of distributing, via\n   IBGP, this route within the ASBR's own\
    \ AS.\n   For a given inter-AS tunnel, each of its intra-AS segments could be\n\
    \   constructed by its own independent mechanism.  Moreover, by using\n   upstream-assigned\
    \ labels within a given AS, multiple intra-AS\n   segments of different inter-AS\
    \ tunnels of either the same or\n   different VPLS instances may share the same\
    \ P-multicast tree.\n   If the P-multicast tree instantiating a particular segment\
    \ of an\n   inter-AS tunnel is created by a multicast control protocol that uses\n\
    \   receiver-initiated joins (e.g, mLDP), and this P-multicast tree does\n   not\
    \ aggregate multiple segments, then all the information needed to\n   create that\
    \ segment will be present in the Inter-AS A-D routes\n   received by the ASBR\
    \ from the neighboring ASBR.  But if the\n   P-multicast tree instantiating the\
    \ segment is created by a protocol\n   that does not use receiver-initiated joins\
    \ (e.g., RSVP-TE, ingress\n   unicast replication), or if this P-multicast tree\
    \ aggregates multiple\n   segments (irrespective of the multicast control protocol\
    \ used to\n   create the tree), then the ASBR needs to learn the leaves of the\n\
    \   segment.  These leaves are learned from A-D routes received from\n   other\
    \ PEs in the AS, for the same VPLS as the one to which the\n   segment belongs.\n\
    \   The following sections specify procedures for propagation of Inter-AS\n  \
    \ A-D routes across ASes in order to construct inter-AS segmented\n   trees.\n"
- title: 7.2.2.1.  Propagating Intra-AS VPLS A-D Routes in EBGP
  contents:
  - "7.2.2.1.  Propagating Intra-AS VPLS A-D Routes in EBGP\n   For a given VPLS configured\
    \ on an ASBR when the ASBR receives Intra-\n   AS A-D routes originated by PEs\
    \ in its own AS, the ASBR MUST\n   propagate each of these route in EBGP.  This\
    \ procedure MUST be\n   performed for each of the VPLS instances configured on\
    \ the ASBR.\n   Each of these routes is constructed as follows:\n     + The route\
    \ carries a single BGP VPLS A-D NLRI with the RD and\n       VE-ID being the same\
    \ as the NLRI in the received Intra-AS A-D\n       route.\n     + The Next Hop\
    \ field of the MP_REACH_NLRI attribute is set to a\n       routable IP address\
    \ of the ASBR.\n     + The route carries the PMSI Tunnel attribute with the Tunnel\
    \ Type\n       set to Ingress Replication; the attribute carries no MPLS labels.\n\
    \     + The route MUST carry the export RT used by the VPLS.\n"
- title: 7.2.2.2.  Inter-AS A-D Route Received via EBGP
  contents:
  - "7.2.2.2.  Inter-AS A-D Route Received via EBGP\n   When an ASBR receives from\
    \ one of its EBGP neighbors a BGP Update\n   message that carries an Inter-AS\
    \ A-D route, if (a) at least one of\n   the RTs carried in the message matches\
    \ one of the import RTs\n   configured on the ASBR, and (b) the ASBR determines\
    \ that the received\n   route is the best route to the destination carried in\
    \ the NLRI of the\n   route, the ASBR re-advertises this Inter-AS A-D route to\
    \ other PEs\n   and ASBRs within its own AS.  The best route selection procedures\n\
    \   MUST ensure that for the same destination, all ASBRs in an AS pick\n   the\
    \ same route as the best route.  The best route selection\n   procedures are specified\
    \ in [RFC4761] and clarified in\n   [MULTI-HOMING].  The best route procedures\
    \ ensure that if multiple\n   ASBRs, in an AS, receive the same Inter-AS A-D route\
    \ from their EBGP\n   neighbors, only one of these ASBRs propagates this route\
    \ in Internal\n   BGP (IBGP).  This ASBR becomes the root of the intra-AS segment\
    \ of\n   the inter-AS tree and ensures that this is the only ASBR that accepts\n\
    \   traffic into this AS from the inter-AS tree.\n   When re-advertising an Inter-AS\
    \ A-D route, the ASBR MUST set the Next\n   Hop field of the MP_REACH_NLRI attribute\
    \ to a routable IP address of\n   the ASBR.\n   Depending on the type of a P-multicast\
    \ tunnel used to instantiate the\n   intra-AS segment of the inter-AS tunnel,\
    \ the PMSI Tunnel attribute of\n   the re-advertised Inter-AS A-D route is constructed\
    \ as follows:\n     + If the ASBR uses ingress replication to instantiate the\
    \ intra-AS\n       segment of the inter-AS tunnel, the re-advertised route MUST\
    \ NOT\n       carry the PMSI Tunnel attribute.\n     + If the ASBR uses a P-multicast\
    \ tree to instantiate the intra-AS\n       segment of the inter-AS tunnel, the\
    \ PMSI Tunnel attribute MUST\n       contain the identity of the tree that is\
    \ used to instantiate the\n       segment (note that the ASBR could create the\
    \ identity of the tree\n       prior to the actual instantiation of the segment).\
    \  If, in order\n       to instantiate the segment, the ASBR needs to know the\
    \ leaves of\n       the tree, then the ASBR obtains this information from the\
    \ A-D\n       routes received from other PEs/ASBRs in the ASBR's own AS.\n   \
    \  + An ASBR that uses a P-multicast tree to instantiate the intra-AS\n      \
    \ segment of the inter-AS tunnel MAY aggregate two or more VPLS\n       instances\
    \ present on the ASBR onto the same tree.  If the ASBR\n       already advertises\
    \ Inter-AS A-D routes for these VPLS instances,\n       then aggregation requires\
    \ the ASBR to re-advertise these routes.\n       The re-advertised routes MUST\
    \ be the same as the original ones,\n       except for the PMSI Tunnel attribute.\
    \  If the ASBR has not\n       previously advertised Inter-AS A-D routes for these\
    \ VPLS\n       instances, then the aggregation requires the ASBR to advertise\n\
    \       (new) Inter-AS A-D routes for these VPLS instances.  The PMSI\n      \
    \ Tunnel attribute in the newly advertised/re-advertised routes\n       MUST carry\
    \ the identity of the P-multicast tree that aggregates\n       the VPLS instances,\
    \ as well as an MPLS upstream-assigned label\n       [RFC5331].  Each newly advertised\
    \ or re-advertised route MUST\n       have a label that is distinct within the\
    \ scope of the ASBR.\n   In addition, the ASBR MUST send to the EBGP neighbor,\
    \ from whom it\n   receives the Inter-AS A-D route, a BGP Update message that\
    \ carries a\n   leaf A-D route.  The exact encoding of this route is described\
    \ in the\n   \"BGP Extensions\" section.  This route contains the following\n\
    \   information elements:\n     + The route carries a single NLRI with the Route\
    \ Key field set to\n       the <RD, VE-ID> tuple of the BGP VPLS A-D NLRI of the\
    \ Inter-AS\n       A-D route received from the EBGP neighbor.  The NLRI also carries\n\
    \       the IP address of the ASBR (this MUST be a routable IP address).\n   \
    \  + The leaf A-D route MUST include the PMSI Tunnel attribute with\n       the\
    \ Tunnel Type set to Ingress Replication, and the Tunnel\n       Identifier set\
    \ to a routable address of the advertising router.\n       The PMSI Tunnel attribute\
    \ MUST carry a downstream-assigned MPLS\n       label that is used to demultiplex\
    \ the VPLS traffic received over\n       a unicast tunnel by the advertising router.\n\
    \     + The Next Hop field of the MP_REACH_NLRI attribute of the route\n     \
    \  SHOULD be set to the same IP address as the one carried in the\n       Originating\
    \ Router's IP Address field of the route.\n     + To constrain the distribution\
    \ scope of this route, the route MUST\n       carry the NO_ADVERTISE BGP Community\
    \ ([RFC1997]).\n     + The ASBR constructs an IP-address-specific RT by placing\
    \ the IP\n       address carried in the Next Hop field of the received Inter-AS\n\
    \       VPLS A-D route in the Global Administrator field of the\n       community,\
    \ with the Local Administrator field of this community\n       set to 0.  It also\
    \ sets the Extended Communities attribute of the\n       leaf A-D route to that\
    \ community.  Note that this RT is the same\n       as the ASBR Import RT of the\
    \ EBGP neighbor from which the ASBR\n       received the Inter-AS VPLS A-D route.\n"
- title: 7.2.2.3.  Leaf A-D Route Received via EBGP
  contents:
  - "7.2.2.3.  Leaf A-D Route Received via EBGP\n   When an ASBR receives, via EBGP,\
    \ a leaf A-D route, the ASBR accepts\n   the route only if (a) at least one of\
    \ the RTs carried in the message\n   matches one of the import RTs configured\
    \ on the ASBR and (b) the ASBR\n   determines that the received route is the best\
    \ route to the\n   destination carried in the NLRI of the route.\n   If the ASBR\
    \ accepts the leaf A-D route, the ASBR looks for an\n   existing A-D route whose\
    \ BGP-VPLS A-D NLRI has the same value as the\n   <RD, VE-ID> field of the leaf\
    \ A-D route just accepted.  If such an\n   A-D route is found, then the MPLS label\
    \ carried in the PMSI Tunnel\n   attribute of the leaf A-D route is used to stitch\
    \ a one hop ASBR-ASBR\n   LSP to the tail of the intra-AS tunnel segment associated\
    \ with the\n   found A-D route.\n"
- title: 7.2.2.4.  Inter-AS A-D Route Received via IBGP
  contents:
  - "7.2.2.4.  Inter-AS A-D Route Received via IBGP\n   In the context of this section,\
    \ we use the term \"PE/ASBR router\" to\n   denote either a PE or an ASBR router.\n\
    \   Note that a given Inter-AS A-D route is advertised within a given AS\n   by\
    \ only one ASBR, as described above.\n   When a PE/ASBR router receives, from\
    \ one of its IBGP neighbors, a BGP\n   Update message that carries an Inter-AS\
    \ A-D route, if (a) at least\n   one of the RTs carried in the message matches\
    \ one of the import RTs\n   configured on the PE/ASBR and (b) the PE/ASBR determines\
    \ that the\n   received route is the best route to the destination carried in\
    \ the\n   NLRI of the route, the PE/ASBR performs the following operations.\n\
    \   The best route determination is as described in [RFC4761] and\n   clarified\
    \ in [MULTI-HOMING].\n   If the router is an ASBR, then the ASBR propagates the\
    \ route to its\n   EBGP neighbors.  When propagating the route to the EBGP neighbors,\n\
    \   the ASBR MUST set the Next Hop field of the MP_REACH_NLRI attribute\n   to\
    \ a routable IP address of the ASBR.\n   If the received Inter-AS A-D route carries\
    \ the PMSI Tunnel attribute\n   with the Tunnel Type set to LDP P2MP LSP, the\
    \ PE/ASBR SHOULD join the\n   P-multicast tree whose identity is carried in the\
    \ PMSI Tunnel\n   attribute.\n   If the received Inter-AS A-D route carries the\
    \ PMSI Tunnel attribute\n   with the Tunnel Identifier set to RSVP-TE P2MP LSP,\
    \ then the ASBR\n   that originated the route MUST establish an RSVP-TE P2MP LSP\
    \ with the\n   local PE/ASBR as a leaf.  This LSP MAY have been established before\n\
    \   the local PE/ASBR receives the route, or it MAY be established after\n   the\
    \ local PE receives the route.\n   If the received Inter-AS A-D route carries\
    \ the PMSI Tunnel attribute\n   with the Tunnel Type set to LDP P2MP LSP, or RSVP-TE\
    \ P2MP LSP, but\n   the attribute does not carry a label, then the P-multicast\
    \ tree, as\n   identified by the PMSI Tunnel attribute, is an intra-AS LSP segment\n\
    \   that is part of the inter-AS tunnel for the <VPLS, VE-ID> advertised\n   by\
    \ the Inter-AS A-D route and rooted at the PE that originated the\n   A-D route.\
    \  If the PMSI Tunnel attribute carries a (upstream-\n   assigned) label, then\
    \ a combination of this tree and the label\n   identifies the intra-AS segment.\
    \  If the receiving router is an ASBR,\n   this intra-AS segment may further be\
    \ stitched to ASBR-ASBR inter-AS\n   segment of the inter-AS tunnel.  If the PE/ASBR\
    \ has local receivers\n   in the VPLS, packets received over the intra-AS segment\
    \ must be\n   forwarded to the local receivers using the local VSI.\n"
- title: '7.3.  Option (c): Non-segmented Tunnels'
  contents:
  - "7.3.  Option (c): Non-segmented Tunnels\n   In this model, there is a multi-hop\
    \ EBGP peering between the PEs (or\n   BGP Route Reflector) in one AS and the\
    \ PEs (or BGP Route Reflector)\n   in another AS.  The PEs exchange BGP-VPLS NLRI\
    \ or BGP-VPLS A-D NLRI,\n   along with the PMSI Tunnel attribute, as in the intra-AS\
    \ case\n   described in the \"Demultiplexing P-Multicast Tree Traffic\" section.\n\
    \   The PEs in different ASes use a non-segmented inter-AS P2MP tunnel\n   for\
    \ VPLS multicast.  A non-segmented inter-AS tunnel is a single\n   tunnel that\
    \ spans AS boundaries.  The tunnel technology cannot change\n   from one point\
    \ in the tunnel to the next, so all ASes through which\n   the tunnel passes must\
    \ support that technology.  In essence, AS\n   boundaries are of no significance\
    \ to a non-segmented inter-AS P2MP\n   tunnel.\n   This model requires no VPLS\
    \ A-D routes in the control plane or VPLS\n   MAC address learning in the data\
    \ plane on the ASBRs.  The ASBRs only\n   need to participate in the non-segmented\
    \ P2MP tunnel setup in the\n   control plane and do MPLS label forwarding in the\
    \ data plane.\n   When the tunneling technology is P2MP LSP signaled with mLDP,\
    \ and one\n   does not use [RFC6512], the setup of non-segmented inter-AS P2MP\n\
    \   tunnels requires the P-routers in one AS to have IP reachability to\n   the\
    \ loopback addresses of the PE routers in another AS.  That is, the\n   reachability\
    \ to the loopback addresses of PE routers in one AS MUST\n   be present in the\
    \ IGP in another AS.\n   The data forwarding in this model is the same as in the\
    \ intra-AS case\n   described in the \"Demultiplexing P-Multicast Tree Traffic\"\
    \ section.\n   An implementation MUST support this model.\n"
- title: 8.  Optimizing Multicast Distribution via Selective Trees
  contents:
  - "8.  Optimizing Multicast Distribution via Selective Trees\n   Whenever a particular\
    \ multicast stream is being sent on an Inclusive\n   P-multicast tree, it is likely\
    \ that the data of that stream is being\n   sent to PEs that do not require it,\
    \ as the sites connected to these\n   PEs may have no receivers for the stream.\
    \  If a particular stream has\n   a significant amount of traffic, it may be beneficial\
    \ to move it to a\n   Selective P-multicast tree that has, at its leaves, only\
    \ those PEs,\n   connected to sites that have receivers for the multicast stream\
    \ (or\n   at least includes fewer PEs that are attached to sites with no\n   receivers\
    \ compared to an Inclusive tree).\n   A PE connected to the multicast source of\
    \ a particular multicast\n   stream may be performing explicit tracking; that\
    \ is, it may know the\n   PEs that have receivers in the multicast stream.  The\
    \ \"Receiving\n   S-PMSI A-D Routes by PEs\" section describes procedures that\
    \ enable\n   explicit tracking.  If this is the case, Selective P-multicast trees\n\
    \   can also be triggered on other criteria.  For instance, there could\n   be\
    \ a \"pseudo-wasted bandwidth\" criterion: switching to a Selective\n   tree would\
    \ be done if the bandwidth multiplied by the number of\n   \"uninterested\" PEs\
    \ (PEs that are receiving the stream but have no\n   receivers) is above a specified\
    \ threshold.  The motivation is that\n   (a) the total bandwidth wasted by many\
    \ sparsely subscribed low-\n   bandwidth groups may be large and (b) there's no\
    \ point to moving a\n   high-bandwidth group to a Selective tree if all the PEs\
    \ have\n   receivers for it.\n   Switching a (C-S, C-G) stream to a Selective\
    \ P-multicast tree may\n   require the root of the tree to determine the egress\
    \ PEs that need to\n   receive the (C-S, C-G) traffic.  This is true in the following\
    \ cases:\n     + If the tunnel is a P2MP tree, such as an RSVP-TE P2MP Tunnel,\
    \ the\n       PE needs to know the leaves of the tree before it can instantiate\n\
    \       the Selective tree.\n     + If a PE decides to send traffic for multicast\
    \ streams, belonging\n       to different VPLS instances, using one P-multicast\
    \ Selective\n       tree, such a tree is called an \"Aggregate tree with a selective\n\
    \       mapping\".  The setting up of such an Aggregate tree requires the\n  \
    \     ingress PE to know all the other PEs that have receivers for\n       multicast\
    \ groups that are mapped onto the tree (see the\n       \"Aggregation Considerations\"\
    \ section for the rationale).\n     + If ingress replication is used and the ingress\
    \ PE wants to send\n       traffic for (C-S, C-G)s to only those PEs that are\
    \ on the path to\n       receivers to the (C-S, C-G)s.\n   For discovering the\
    \ IP multicast group membership, for the above\n   cases, this document describes\
    \ procedures that allow an ingress PE to\n   enable explicit tracking.  Thus,\
    \ an ingress PE can request the IP\n   multicast membership from egress PEs for\
    \ one or more C-multicast\n   streams.  These procedures are described in the\
    \ \"Receiving S-PMSI A-D\n   Routes by PEs\" section.\n   The root of the Selective\
    \ P-multicast tree MAY decide to do explicit\n   tracking of the IP multicast\
    \ stream only after it has decided to move\n   the stream to a Selective tree,\
    \ or it MAY have been doing explicit\n   tracking all along.  This document also\
    \ describes explicit tracking\n   for a wildcard source and/or group in the \"\
    Receiving S-PMSI A-D\n   Routes by PEs\" section, which facilitates a Selective\
    \ P-multicast\n   tree only mode in which IP multicast streams are always carried\
    \ on a\n   Selective P-multicast tree.  In the description on Selective\n   P-multicast\
    \ trees, the notation C-S is intended to represent either a\n   specific source\
    \ address or a wildcard.  Similarly, C-G is intended to\n   represent either a\
    \ specific group address or a wildcard.\n   The PE at the root of the tree MUST\
    \ signal the leaves of the tree\n   that the (C-S, C-G) stream is now bound to\
    \ the Selective tree.  Note\n   that the PE could create the identity of the P-multicast\
    \ tree prior\n   to the actual instantiation of the tunnel.\n   If the Selective\
    \ tree is instantiated by an RSVP-TE P2MP LSP, the PE\n   at the root of the tree\
    \ MUST establish the P2MP RSVP-TE LSP to the\n   leaves.  This LSP MAY have been\
    \ established before the leaves receive\n   the Selective tree binding, or it\
    \ MAY be established after the leaves\n   receive the binding.  A leaf MUST NOT\
    \ switch to the Selective tree\n   until it receives the binding and the RSVP-TE\
    \ P2MP LSP is set up to\n   the leaf.\n"
- title: 8.1.  Protocol for Switching to Selective Trees
  contents:
  - "8.1.  Protocol for Switching to Selective Trees\n   Selective trees provide a\
    \ PE the ability to create separate\n   P-multicast trees for certain (C-S, C-G)\
    \ streams.  The source PE,\n   which originates the Selective tree, and the egress\
    \ PEs MUST use the\n   Selective tree for the (C-S, C-G) streams that are mapped\
    \ to it.\n   This may require the source and egress PEs to switch to the Selective\n\
    \   tree from an Inclusive tree if they were already using an Inclusive\n   tree\
    \ for the (C-S, C-G) streams mapped to the Selective tree.\n   Once a source PE\
    \ decides to set up a Selective tree, it MUST announce\n   the mapping of the\
    \ (C-S, C-G) streams (which may be in different VPLS\n   instances) that are mapped\
    \ to the tree to the other PEs using BGP.\n   After the egress PEs receive the\
    \ announcement, they set up their\n   forwarding path to receive traffic on the\
    \ Selective tree if they have\n   one or more receivers interested in the (C-S,\
    \ C-G) streams mapped to\n   the tree.  Setting up the forwarding path requires\
    \ setting up the\n   demultiplexing forwarding entries based on the top MPLS label\
    \ (if\n   there is no inner label) or the inner label (if present) as described\n\
    \   in the \"Establishing P-Multicast Trees\" section.\n   When the P2MP LSP is\
    \ established using mLDP, the egress PEs MAY\n   perform this switch to the Selective\
    \ tree once the announcement from\n   the ingress PE is received, or they MAY\
    \ wait for a preconfigured\n   timer to do so after receiving the announcement.\n\
    \   When the P2MP LSP protocol is P2MP RSVP-TE, an egress PE MUST perform\n  \
    \ this switch to the Selective tree only after the announcement from\n   the ingress\
    \ PE is received and the RSVP-TE P2MP LSP has been set up\n   to the egress PE.\
    \  This switch MAY be done after waiting for a\n   preconfigured timer after these\
    \ two steps have been accomplished.\n   A source PE MUST use the following approach\
    \ to decide when to start\n   transmitting data on the Selective tree, if it is\
    \ currently using an\n   Inclusive tree.  After announcing the (C-S, C-G) stream\
    \ mapping to a\n   Selective tree, the source PE MUST wait for a \"switchover\"\
    \ delay\n   before sending (C-S, C-G) stream on the Selective tree.  It is\n \
    \  RECOMMENDED to allow this delay to be configurable.  Once the\n   \"switchover\"\
    \ delay has elapsed, the source PE MUST send (C-S, C-G)\n   stream on the Selective\
    \ tree.  In no case is any (C-S, C-G) packet\n   sent on both Selective and Inclusive\
    \ trees.\n   When a (C-S, C-G) stream is switched from an Inclusive to a Selective\n\
    \   tree, the purpose of running a switchover timer is to minimize packet\n  \
    \ loss without introducing packet duplication.  However, jitter may be\n   introduced\
    \ due to the difference in transit delays between the\n   Inclusive and Selective\
    \ trees.\n   For best effect, the switchover timer should be configured to a value\n\
    \   that is \"just long enough\" (a) to allow all the PEs to learn about\n   the\
    \ new binding of (C-S, C-G) to a Selective tree and (b) to allow\n   the PEs to\
    \ construct the P-tunnel associated with the Selective tree,\n   if it doesn't\
    \ already exist.\n"
- title: 8.2.  Advertising (C-S, C-G) Binding to a Selective Tree
  contents:
  - "8.2.  Advertising (C-S, C-G) Binding to a Selective Tree\n   The ingress PE informs\
    \ all the PEs that are on the path to receivers\n   of the (C-S, C-G) of the binding\
    \ of the Selective tree to the (C-S,\n   C-G), using BGP.  The BGP announcement\
    \ is done by sending update for\n   the MCAST-VPLS address family using what we\
    \ referred to as an \"S-PMSI\n   A-D route\".  The format of the NLRI of this\
    \ route is described in the\n   \"Inclusive Tree/Selective Tree Identifier\" section.\
    \  The NLRI MUST be\n   constructed as follows:\n     + The Route Distinguisher\
    \ (RD) MUST be set to the RD configured\n       locally for the VPLS.  This is\
    \ required to uniquely identify the\n       <C-S, C-G> as the addresses could\
    \ overlap between different VPLS\n       instances.  This MUST be the same RD\
    \ value used in the VPLS auto-\n       discovery process.\n     + The Multicast\
    \ Source field MUST contain the source address\n       associated with the C-multicast\
    \ stream, and the Multicast Source\n       Length field is set appropriately to\
    \ reflect this.  If the source\n       address is a wildcard, the source address\
    \ is set to 0.\n     + The Multicast Group field MUST contain the group address\n\
    \       associated with the C-multicast stream, and the Multicast Group\n    \
    \   Length field is set appropriately to reflect this.  If the group\n       address\
    \ is a wildcard, the group address is set to 0.\n     + The Originating Router's\
    \ IP Address field MUST be set to the IP\n       address that the (local) PE places\
    \ in the BGP Next Hop of the\n       BGP-VPLS A-D routes.  Note that the <RD,\
    \ Originating Router's IP\n       Address> tuple uniquely identifies a given VPLS\
    \ instance on a PE.\n   The PE constructs the rest of the Selective A-D route\
    \ as follows.\n   Depending on the type of a P-multicast tree used for the P-tunnel,\n\
    \   the PMSI Tunnel attribute of the S-PMSI A-D route is constructed as\n   follows:\n\
    \     + The PMSI Tunnel attribute MUST contain the identity of the\n       P-multicast\
    \ tree (note that the PE could create the identity of\n       the tree prior to\
    \ the actual instantiation of the tree).\n     + If, in order to establish the\
    \ P-multicast tree, the PE needs to\n       know the leaves of the tree within\
    \ its own AS, then the PE\n       obtains this information from the leaf A-D routes\
    \ received from\n       other PEs/ASBRs within its own AS (as other PEs/ASBRs\
    \ originate\n       leaf A-D routes in response to receiving the S-PMSI A-D route)\
    \ by\n       setting the Leaf Information Required flag in the PMSI Tunnel\n \
    \      attribute to 1.  This enables explicit tracking for the multicast\n   \
    \    stream(s) advertised by the S-PMSI A-D route.\n     + If a PE originates\
    \ S-PMSI A-D routes with the Leaf Information\n       Required flag in the PMSI\
    \ Tunnel attribute set to 1, then the PE\n       MUST be (auto-)configured with\
    \ an import RT, which controls\n       acceptance of leaf A-D routes by the PE.\
    \  (Procedures for\n       originating leaf A-D routes by the PEs that receive\
    \ the S-PMSI\n       A-D route are described in the \"Receiving S-PMSI A-D Routes\
    \ by\n       PEs\" section.)\n       This RT is IP address specific.  The Global\
    \ Administrator field\n       of this RT MUST be set to the IP address carried\
    \ in the Next Hop\n       field of all the S-PMSI A-D routes advertised by this\
    \ PE (if the\n       PE uses different Next Hop fields, then the PE MUST be\n\
    \       (auto-)configured with multiple import RTs, one per each such\n      \
    \ Next Hop field).  The Local Administrator field of this Route\n       Target\
    \ MUST be set to 0.\n       If the PE supports Route Target Constrain [RFC4684],\
    \ the PE\n       SHOULD advertise this import RT within its own AS using Route\n\
    \       Target Constrain.  To constrain distribution of the Route Target\n   \
    \    Constrain routes to the AS of the advertising PE these routes\n       SHOULD\
    \ carry the NO_EXPORT Community ([RFC1997]).\n     + A PE MAY aggregate two or\
    \ more S-PMSIs originated by the PE onto\n       the same P-multicast tree.  If\
    \ the PE already advertises S-PMSI\n       A-D routes for these S-PMSIs, then\
    \ aggregation requires the PE to\n       re-advertise these routes.  The re-advertised\
    \ routes MUST be the\n       same as the original ones, except for the PMSI Tunnel\
    \ attribute.\n       If the PE has not previously advertised S-PMSI A-D routes\
    \ for\n       these S-PMSIs, then the aggregation requires the PE to advertise\n\
    \       (new) S-PMSI A-D routes for these S-PMSIs.  The PMSI Tunnel\n       attribute\
    \ in the newly advertised/re-advertised routes MUST carry\n       the identity\
    \ of the P-multicast tree that aggregates the S-PMSIs.\n       If at least some\
    \ of the S-PMSIs aggregated onto the same\n       P-multicast tree belong to different\
    \ VPLS instances, then all\n       these routes MUST carry an MPLS upstream-assigned\
    \ label\n       [RFC5331].  If all these aggregated S-PMSIs belong to the same\n\
    \       VPLS, then the routes MAY carry an MPLS upstream-assigned label\n    \
    \   [RFC5331].  The labels MUST be distinct on a per-VPLS-instance\n       basis,\
    \ and they MAY be distinct on a per-route basis.\n   The Next Hop field of the\
    \ MP_REACH_NLRI attribute of the route SHOULD\n   be set to the same IP address\
    \ as the one carried in the Originating\n   Router's IP Address field.\n   By\
    \ default, the set of RTs carried by the route MUST be the same as\n   the RTs\
    \ carried in the BGP-VPLS A-D route originated from the VSI.\n   The default could\
    \ be modified via configuration.\n"
- title: 8.3.  Receiving S-PMSI A-D Routes by PEs
  contents:
  - "8.3.  Receiving S-PMSI A-D Routes by PEs\n   Consider a PE that receives an S-PMSI\
    \ A-D route.  If one or more of\n   the VSIs on the PE have their import RTs that\
    \ contain one or more of\n   the RTs carried by the received S-PMSI A-D route,\
    \ then for each such\n   VSI, the PE performs the following.\n   Procedures for\
    \ receiving an S-PMSI A-D route by a PE (both within and\n   outside of the AS\
    \ of the PE that originates the route) are the same\n   as specified in the \"\
    Inter-AS A-D Route Received via IBGP\" section,\n   except that (a) instead of\
    \ Inter-AS A-D routes the procedures apply\n   to S-PMSI A-D routes, (b) the rules\
    \ for determining whether the\n   received S-PMSI A-D route is the best route\
    \ to the destination\n   carried in the NLRI of the route are the same as BGP\
    \ path selection\n   rules and may be modified by policy, and (c) a PE performs\
    \ procedures\n   specified in that section only if in addition to the criteria\n\
    \   specified in that section the following is true:\n     + If, as a result of\
    \ multicast state snooping on the PE-CE\n       interfaces, the PE has snooped\
    \ state for at least one multicast\n       join that matches the multicast source\
    \ and group advertised in\n       the S-PMSI A-D route.  Further, the oifs (outgoing\
    \ interfaces)\n       for this state contain one or more interfaces to the locally\n\
    \       attached CEs.  When the multicast signaling protocol among the\n     \
    \  CEs is IGMP, then snooping and associated procedures are defined\n       in\
    \ [RFC4541].  The snooped state is determined using these\n       procedures.\
    \  When the multicast signaling protocol among the CEs\n       is PIM, the procedures\
    \ in [RFC4541] are not sufficient to\n       determine the snooped state.  The\
    \ additional details required to\n       determine the snooped state when CE-CE\
    \ protocol is PIM are for\n       further study.  When such procedures are defined,\
    \ it is expected\n       that the procedures in this section will apply to the\
    \ snooped\n       state created as a result of PIM as PE-CE protocol.\n   The\
    \ snooped state is said to \"match\" the S-PMSI A-D route if any of\n   the following\
    \ is true:\n     + The S-PMSI A-D route carries (C-S, C-G) and the snooped state\
    \ is\n       for (C-S, C-G) or for (C-*, C-G), OR\n     + The S-PMSI A-D route\
    \ carries (C-*, C-G) and (a) the snooped state\n       is for (C-*, C-G) OR (b)\
    \ the snooped state is for at least one\n       multicast join with the multicast\
    \ group address equal to C-G and\n       there doesn't exist another S-PMSI A-D\
    \ route that carries (C-S,\n       C-G) where C-S is the source address of the\
    \ snooped state.\n     + The S-PMSI A-D route carries (C-S, C-*) and (a) the snooped\
    \ state\n       is for at least one multicast join with the multicast source\n\
    \       address equal to C-S, and (b) there doesn't exist another S-PMSI\n   \
    \    A-D route that carries (C-S, C-G) where C-G is the group address\n      \
    \ of the snooped state.\n     + The S-PMSI A-D route carries (C-*, C-*) and there\
    \ is no other\n       S-PMSI A-D route that matches the snooped state as per the\
    \ above\n       conditions.\n   Note if the above conditions are true, and if\
    \ the received S-PMSI A-D\n   route has a PMSI Tunnel attribute with the Leaf\
    \ Information Required\n   flag set to 1, then the PE originates a leaf A-D route,\
    \ constructed\n   as follows:\n     + The route carries a single MCAST-VPLS NLRI\
    \ with the Route Key\n       field set to the MCAST-VPLS NLRI of the received\
    \ S-PMSI A-D\n       route.\n     + The Originating Router's IP Address set to\
    \ the IP address of the\n       PE (this MUST be a routable IP address).\n   \
    \  + The PE constructs an IP-address-specific RT by placing the IP\n       address\
    \ carried in the Next Hop field of the received S-PMSI A-D\n       route in the\
    \ Global Administrator field of the Community, with\n       the Local Administrator\
    \ field of this Community set to 0 and\n       setting the Extended Communities\
    \ attribute of the leaf A-D route\n       to that Community.\n     + The Next\
    \ Hop field of the MP_REACH_NLRI attribute of the route\n       MUST be set to\
    \ the same IP address as the one carried in the\n       Originating Router's IP\
    \ Address field of the route.\n     + To constrain the distribution scope of this\
    \ route, the route MUST\n       carry the NO_EXPORT Community [RFC1997], except\
    \ for the inter-AS\n       scenario with option (c).\n   Once the leaf A-D route\
    \ is constructed, the PE advertises this route\n   into IBGP.\n   In addition\
    \ to the procedures specified in the \"Inter-AS A-D Route\n   Received via IBGP\"\
    \ section, the PE MUST set up its forwarding path to\n   receive traffic, for\
    \ each multicast stream in the matching snooped\n   state, from the tunnel advertised\
    \ by the S-PMSI A-D route (the PE\n   MUST switch to the Selective tree).\n  \
    \ When a new snooped state is created by a PE, then the PE MUST first\n   determine\
    \ if there is an S-PMSI A-D route that matches the snooped\n   state as per the\
    \ conditions described above.  If such an S-PMSI A-D\n   route is found, then\
    \ the PE MUST follow the procedures described in\n   this section, for that particular\
    \ S-PMSI A-D route.  If later on the\n   snooped state ages out and is deleted\
    \ from the PE, the PE SHOULD\n   withdraw the leaf A-D route that it had originated\
    \ in response to the\n   S-PMSI A-D route.\n"
- title: 8.4.  Inter-AS Selective Tree
  contents:
  - "8.4.  Inter-AS Selective Tree\n   Inter-AS Selective trees support all three\
    \ options of inter-AS VPLS\n   service, option (a), (b), and (c), that are supported\
    \ by Inter-AS\n   Inclusive trees.  They are constructed in a manner that is very\n\
    \   similar to Inter-AS Inclusive trees.\n   For option (a) and option (b), support\
    \ Inter-AS Selective trees are\n   constructed without requiring a single P-multicast\
    \ tree to span\n   multiple ASes.  This allows individual ASes to potentially\
    \ use\n   different P-tunneling technologies.  There are two variants of this.\n\
    \   One that requires MAC and IP multicast lookup on the ASBRs and\n   another\
    \ that does not require MAC/IP multicast lookup on the ASBRs\n   and instead builds\
    \ segmented Inter-AS Selective trees.\n   Segmented Inter-AS Selective trees can\
    \ also be used with option (c),\n   unlike Segmented Inter-AS Inclusive trees.\
    \  This is because the\n   S-PMSI A-D routes can be exchanged via ASBRs (even\
    \ though BGP VPLS\n   A-D routes are not exchanged via ASBRs).\n   In the case\
    \ of Option (c), an Inter-AS Selective tree may also be a\n   non-segmented P-multicast\
    \ tree that spans multiple ASes.\n"
- title: 8.4.1.  VSIs on the ASBRs
  contents:
  - "8.4.1.  VSIs on the ASBRs\n   The requirements on ASBRs, when VSIs are present\
    \ on the ABSRs,\n   include the requirements presented in the \"Inter-AS Inclusive\n\
    \   P-Multicast Tree A-D/Binding\" section.  The source ASBR (that\n   receives\
    \ traffic from another AS) may independently decide whether or\n   not it wishes\
    \ to use Selective trees.  If it uses Selective trees,\n   the source ASBR MUST\
    \ perform a MAC lookup to determine the Selective\n   tree to forward the VPLS\
    \ packet on.\n"
- title: 8.4.1.1.  VPLS Inter-AS Selective Tree A-D Binding
  contents:
  - "8.4.1.1.  VPLS Inter-AS Selective Tree A-D Binding\n   The mechanisms for propagating\
    \ S-PMSI A-D routes are the same as the\n   intra-AS case described in the \"\
    MCAST-VPLS NLRI\" section.  The BGP\n   Selective tree A-D routes generated by\
    \ PEs in an AS MUST NOT be\n   propagated outside the AS.\n"
- title: 8.4.2.  Inter-AS Segmented Selective Trees
  contents:
  - "8.4.2.  Inter-AS Segmented Selective Trees\n   Inter-AS Segmented Selective trees\
    \ MUST be implemented when option\n   (b) is used to provide the inter-AS VPLS\
    \ service.  They MAY be used\n   when option (c) is implemented to provide the\
    \ inter-AS VPLS service.\n   A Segmented inter-AS Selective Tunnel is constructed\
    \ similar to an\n   inter-AS Segmented Inclusive Tunnel.  Namely, such a tunnel\
    \ is\n   constructed as a concatenation of tunnel segments.  There are two\n \
    \  types of tunnel segments: an intra-AS tunnel segment (a segment that\n   spans\
    \ ASBRs within the same AS) and inter-AS tunnel segment (a\n   segment that spans\
    \ adjacent ASBRs in adjacent ASes).  ASes that are\n   spanned by a tunnel are\
    \ not required to use the same tunneling\n   mechanism to construct the tunnel\
    \ -- each AS may pick up a tunneling\n   mechanism to construct the intra-AS tunnel\
    \ segment of the tunnel, in\n   its AS.\n   The PE that decides to set up a Selective\
    \ tree advertises the\n   Selective tree to multicast stream binding using an\
    \ S-PMSI A-D route,\n   as per procedures in the \"Advertising (C-S, C-G) Binding\
    \ to a\n   Selective Tree\" section, to the routers in its own AS.\n   An S-PMSI\
    \ A-D route advertised outside the AS, to which the\n   originating PE belongs,\
    \ will be referred to as an Inter-AS S-PMSI\n   tree A-D route (although this\
    \ route is originated by a PE as an\n   intra-AS S-PMSI A-D route, it is referred\
    \ to as an Inter-AS route\n   outside the AS).\n"
- title: 8.4.2.1.  Handling S-PMSI A-D Routes by ASBRs
  contents:
  - "8.4.2.1.  Handling S-PMSI A-D Routes by ASBRs\n   Procedures for handling an\
    \ S-PMSI A-D route by ASBRs (both within and\n   outside of the AS of the PE that\
    \ originates the route) are the same\n   as specified in the \"Propagating BGP\
    \ VPLS A-D Routes to Other ASes\"\n   section, except that instead of Inter-AS\
    \ A-D routes and their NLRI,\n   these procedures apply to S-PMSI A-D routes and\
    \ their NLRI.\n   In addition to these procedures, an ASBR advertises a leaf A-D\
    \ route\n   in response to an S-PMSI A-D route only if:\n     + The S-PMSI A-D\
    \ route was received via EBGP from another ASBR and\n       the ASBR merges the\
    \ S-PMSI A-D route into an Inter-AS BGP VPLS\n       A-D route as described in\
    \ the next section.  OR\n     + The ASBR receives a leaf A-D route from a downstream\
    \ PE or ASBR\n       in response to the S-PMSI A-D route, received from an upstream\
    \ PE\n       or ASBR, that the ASBR propagated inter-AS to downstream ASBRs\n\
    \       and PEs.\n     + The ASBR has snooped state from local CEs that matches\
    \ the NLRI\n       carried in the S-PMSI A-D route as per the following rules:\n\
    \      i) The NLRI encodes (C-S, C-G), which is the same as the snooped\n    \
    \     (C-S, C-G)\n     ii) The NLRI encodes (*, C-G), there is snooped state for\
    \ at least\n         one (C-S, C-G), and there is no other matching S-PMSI A-D\
    \ route\n         for (C-S, C-G) OR there is snooped state for (*, C-G)\n    iii)\
    \ The NLRI encodes (*, *), there is snooped state for at least\n         one (C-S,\
    \ C-G) or (*, C-G), and there is no other matching\n         S-PMSI A-D route\
    \ for that (C-S, C-G) or (*, C-G), respectively.\n   The C-multicast data traffic\
    \ is sent on the Selective tree by the\n   originating PE.  When it reaches an\
    \ ASBR that is on the inter-AS\n   segmented tree, it is delivered to local receivers,\
    \ if any.  It is\n   then forwarded on any inter-AS or intra-AS segments that\
    \ exist on the\n   Inter-AS Selective segmented tree.  If the Inter-AS Selective\n\
    \   segmented tree is merged onto an Inclusive tree, as described in the\n   next\
    \ section, the data traffic is forwarded onto the Inclusive tree.\n"
- title: 8.4.2.1.1.  Merging Selective Tree into an Inclusive Tree
  contents:
  - "8.4.2.1.1.  Merging Selective Tree into an Inclusive Tree\n   Consider the situation\
    \ where:\n     + An ASBR is receiving (or expecting to receive) inter-AS\n   \
    \    (C-S, C-G) data from upstream via a Selective tree.\n     + The ASBR is sending\
    \ (or expecting to send) the inter-AS\n       (C-S, C-G) data downstream via an\
    \ Inclusive tree.\n   This situation may arise if the upstream providers have\
    \ a policy of\n   using Selective trees but the downstream providers have a policy\
    \ of\n   using Inclusive trees.  To support this situation, an ASBR MAY, under\n\
    \   certain conditions, merge one or more upstream Selective trees into a\n  \
    \ downstream Inclusive tree.  Note that this can be the case only for\n   option\
    \ (b) and not for option (c) as, for option (c), the ASBRs do\n   not have Inclusive\
    \ tree state.\n   A Selective tree (corresponding to a particular S-PMSI A-D route)\
    \ MAY\n   be merged by a particular ASBR into an Inclusive tree (corresponding\n\
    \   to a particular Inter-AS BGP VPLS A-D route) if and only if the\n   following\
    \ conditions all hold:\n     + The S-PMSI A-D route and the Inter-AS BGP VPLS\
    \ A-D route\n       originate in the same AS.  The Inter-AS BGP VPLS A-D route\n\
    \       carries the originating AS in the AS_PATH attribute of the route.\n  \
    \     The S-PMSI A-D route carries the originating AS in the AS_PATH\n       attribute\
    \ of the route.\n     + The S-PMSI A-D route and the Inter-AS BGP VPLS A-D route\
    \ have\n       exactly the same set of RTs.\n   An ASBR performs merging by stitching\
    \ the tail end of the P-tunnel,\n   as specified in the PMSI Tunnel attribute\
    \ of the S-PMSI A-D route\n   received by the ASBR, to the head of the P-tunnel,\
    \ as specified in\n   the PMSI Tunnel attribute of the Inter-AS BGP VPLS A-D route\n\
    \   re-advertised by the ASBR.\n   An ASBR that merges an S-PMSI A-D route into\
    \ an Inter-AS BGP VPLS A-D\n   route MUST NOT re-advertise the S-PMSI A-D route.\n"
- title: 8.4.3.  Inter-AS Non-segmented Selective Trees
  contents:
  - "8.4.3.  Inter-AS Non-segmented Selective Trees\n   Inter-AS Non-segmented Selective\
    \ trees MAY be used in the case of\n   option (c).\n   In this method, there is\
    \ a multi-hop EBGP peering between the PEs (or\n   a Route Reflector) in one AS\
    \ and the PEs (or Route Reflector) in\n   another AS.  The PEs exchange BGP Selective\
    \ tree A-D routes, along\n   with PMSI Tunnel attribute, as in the intra-AS case\
    \ described in the\n   \"Option (c): Non-segmented Tunnels\" section.\n   The\
    \ PEs in different ASes use a non-segmented Selective inter-AS P2MP\n   tunnel\
    \ for VPLS multicast.\n   This method requires no VPLS information (in either\
    \ the control or\n   the data plane) on the ASBRs.  The ASBRs only need to participate\
    \ in\n   the non-segmented P2MP tunnel setup in the control plane and do MPLS\n\
    \   label forwarding in the data plane.\n   The data forwarding in this model\
    \ is the same as in the intra-AS case\n   described in the \"Establishing P-Multicast\
    \ Trees\" section.\n"
- title: 9.  BGP Extensions
  contents:
  - "9.  BGP Extensions\n   This section describes the encoding of the BGP extensions\
    \ required by\n   this document.\n"
- title: 9.1.  Inclusive Tree/Selective Tree Identifier
  contents:
  - "9.1.  Inclusive Tree/Selective Tree Identifier\n   Inclusive P-multicast tree\
    \ and Selective P-multicast tree\n   advertisements carry the P-multicast tree\
    \ identifier.  For the\n   purpose of carrying this identifier, this document\
    \ reuses the BGP\n   attribute, called \"PMSI_TUNNEL\" that is defined in [RFC6514].\n\
    \   This document supports only the following Tunnel Types when the PMSI\n   Tunnel\
    \ attribute is carried in VPLS A-D or VPLS S-PMSI A-D routes:\n     + 0 - No tunnel\
    \ information present\n     + 1 - RSVP-TE P2MP LSP\n     + 2 - LDP P2MP LSP\n\
    \     + 6 - Ingress Replication\n"
- title: 9.2.  MCAST-VPLS NLRI
  contents:
  - "9.2.  MCAST-VPLS NLRI\n   This document defines a new BGP NLRI, called the \"\
    MCAST-VPLS NLRI\".\n   Following is the format of the MCAST-VPLS NLRI:\n     \
    \           +-----------------------------------+\n                |    Route\
    \ Type (1 octet)           |\n                +-----------------------------------+\n\
    \                |     Length (1 octet)              |\n                +-----------------------------------+\n\
    \                |    Route Type specific (variable) |\n                +-----------------------------------+\n\
    \   The Route Type field defines encoding of the Route Type specific\n   field\
    \ of MCAST-VPLS NLRI.\n   The Length field indicates the length in octets of the\
    \ Route Type\n   specific field of MCAST-VPLS NLRI.\n   This document defines\
    \ the following route types for A-D routes:\n     + 3 - Selective Tree A-D route;\n\
    \     + 4 - Leaf A-D route.\n   The MCAST-VPLS NLRI is carried in BGP using BGP\
    \ Multiprotocol\n   Extensions [RFC4760] with an Address Family Identifier (AFI)\
    \ of 25\n   (L2VPN AFI), and a Subsequent Address Family Identifier (SAFI) of\n\
    \   MCAST-VPLS.  The NLRI field in the MP_REACH_NLRI/MP_UNREACH_NLRI\n   attribute\
    \ contains the MCAST-VPLS NLRI (encoded as specified above).\n   In order for\
    \ two BGP speakers to exchange labeled MCAST-VPLS NLRI,\n   they must use BGP\
    \ Capabilities Advertisement to ensure that they both\n   are capable of properly\
    \ processing such NLRI.  This is done as\n   specified in [RFC4760], by using\
    \ capability code 1 (multiprotocol\n   BGP) with an AFI of 25 and a SAFI of MCAST-VPLS.\n\
    \   The following describes the format of the Route Type specific field\n   of\
    \ MCAST-VPLS NLRI for various route types defined in this document.\n"
- title: 9.2.1.  S-PMSI A-D Route
  contents:
  - "9.2.1.  S-PMSI A-D Route\n   The Route Type specific field of MCAST-VPLS NLRI\
    \ of an S-PMSI A-D\n   route consists of the following:\n                +-----------------------------------+\n\
    \                |      RD   (8 octets)              |\n                +-----------------------------------+\n\
    \                | Multicast Source Length (1 octet) |\n                +-----------------------------------+\n\
    \                |  Multicast Source (Variable)      |\n                +-----------------------------------+\n\
    \                |  Multicast Group Length (1 octet) |\n                +-----------------------------------+\n\
    \                |  Multicast Group   (Variable)     |\n                +-----------------------------------+\n\
    \                |   Originating Router's IP Addr    |\n                +-----------------------------------+\n\
    \   The RD is encoded as described in [RFC4364].\n   The Multicast Source field\
    \ contains the C-S address, i.e., the\n   address of the multicast source.  If\
    \ the Multicast Source field\n   contains an IPv4 address, then the value of the\
    \ Multicast Source\n   Length field is 32.  If the Multicast Source field contains\
    \ an IPv6\n   address, then the value of the Multicast Source Length field is\
    \ 128.\n   The value of the Multicast Source Length field may be set to 0 to\n\
    \   indicate a wildcard.\n   The Multicast Group field contains the C-G address,\
    \ i.e., the address\n   of the multicast group.  If the Multicast Group field\
    \ contains an\n   IPv4 address, then the value of the Multicast Group Length field\
    \ is\n   32.  If the Multicast Group field contains an IPv6 address, then the\n\
    \   value of the Multicast Group Length field is 128.  The Multicast\n   Group\
    \ Length field may be set to 0 to indicate a wildcard.\n   Whether the Originating\
    \ Router's IP Address field carries an IPv4 or\n   IPv6 address is determined\
    \ by the value of the Length field of the\n   MCAST-VPLS NLRI.  If the Multicast\
    \ Source field contains an IPv4\n   address and the Multicast Group field contains\
    \ an IPv4 address, then\n   the value of the Length field is 22 bytes if the Originating\
    \ Router's\n   IP Address carries an IPv4 address and 34 bytes if it is an IPv6\n\
    \   address.  If the Multicast Source and Multicast Group fields contain\n   IPv6\
    \ addresses, then the value of the Length field is 46 bytes if the\n   Originating\
    \ Router's IP Address carries an IPv4 address and 58 bytes\n   if it is an IPv6\
    \ address.  The following table summarizes the above.\n      Multicast   Multicast\
    \                Originating Router's   Length\n      Source      Group      \
    \                 IP Address\n        IPv4      IPv4                        IPv4\
    \                  22\n        IPv4      IPv4                        IPv6    \
    \              34\n        IPv6      IPv6                        IPv4        \
    \          46\n        IPv6      IPv6                        IPv6            \
    \      58\n   Usage of Selective Tree A-D routes is described in the \"Optimizing\n\
    \   Multicast Distribution via Selective Trees\" section.\n"
- title: 9.2.2.  Leaf A-D Route
  contents:
  - "9.2.2.  Leaf A-D Route\n   The Route Type specific field of MCAST-VPLS NLRI of\
    \ a leaf A-D route\n   consists of the following:\n                +-----------------------------------+\n\
    \                |      Route Key (variable)         |\n                +-----------------------------------+\n\
    \                |   Originating Router's IP Addr    |\n                +-----------------------------------+\n\
    \   Whether the Originating Router's IP Address field carries an IPv4 or\n   IPv6\
    \ address is determined by the Length field of the MCAST-VPLS NLRI\n   and the\
    \ length of the Route Key field.  From these two length fields,\n   one can compute\
    \ the length of the Originating Router's IP Address.\n   If this computed length\
    \ is 4, then the address is an IPv4 address; if\n   its 16, then the address is\
    \ an IPv6 address.\n   Usage of leaf A-D routes is described in the \"Inter-AS\
    \ Inclusive\n   P-Multicast Tree A-D/Binding\" and \"Optimizing Multicast Distribution\n\
    \   via Selective Trees\" sections.\n"
- title: 10.  Aggregation Considerations
  contents:
  - "10.  Aggregation Considerations\n   This document does not specify the mandatory\
    \ implementation of any\n   particular set of rules for determining whether or\
    \ not the Inclusive\n   or Selective trees of two particular VPLS instances are\
    \ to be\n   instantiated by the same Aggregate Inclusive/Selective tree.  This\n\
    \   determination can be made by implementation-specific heuristics, by\n   configuration,\
    \ or even perhaps by the use of offline tools.\n   This section discusses potential\
    \ methodologies with respect to\n   aggregation.\n   In general, the heuristic\
    \ used to decide which VPLS instances or\n   <C-S, C-G> entries to aggregate is\
    \ implementation dependent.  It is\n   also conceivable that offline tools can\
    \ be used for this purpose.\n   This section discusses some trade-offs with respect\
    \ to aggregation.\n   The \"congruency\" of aggregation is defined by the amount\
    \ of overlap\n   in the leaves of the client trees that are aggregated on an SP\
    \ tree.\n   For Aggregate Inclusive trees, the congruency depends on the overlap\n\
    \   in the membership of the VPLS instances that are aggregated on the\n   Aggregate\
    \ Inclusive tree.  If there is complete overlap, aggregation\n   is perfectly\
    \ congruent.  As the overlap between the VPLS instances\n   that are aggregated\
    \ reduces, the congruency reduces.\n   From the above definition of \"congruency\"\
    , it follows that in order\n   for a given PE to determine the congruency of the\
    \ client trees that\n   this PE could aggregate, the PE has to know the leaves\
    \ of these\n   client trees.  This is irrespective of whether the aggregated SP\
    \ tree\n   is established using mLDP or RSVP-TE.\n   If aggregation is done such\
    \ that it is not perfectly congruent, a PE\n   may receive traffic for VPLS instances\
    \ to which it doesn't belong.\n   As the amount of multicast traffic in these\
    \ unwanted VPLS instances\n   increases, aggregation becomes less optimal with\
    \ respect to delivered\n   traffic.  Hence, there is a trade-off between reducing\
    \ multicast\n   state in the core and delivering unwanted traffic.\n   An implementation\
    \ should provide knobs to control aggregation based\n   on the congruency of the\
    \ tree to be aggregated.  This will allow an\n   SP to deploy aggregation depending\
    \ on the VPLS membership and traffic\n   profiles in its network.  If different\
    \ PEs are setting up Aggregate\n   Inclusive trees, this will also allow an SP\
    \ to engineer the maximum\n   amount of unwanted VPLS instances for which a particular\
    \ PE may\n   receive traffic.\n   The state/bandwidth optimality trade-off can\
    \ be further improved by\n   having a versatile many-to-many association between\
    \ client trees and\n   provider trees.  Thus, a VPLS instance can be mapped to\
    \ multiple\n   Aggregate trees.  The mechanisms for achieving this are for further\n\
    \   study.  Also, it may be possible to use both ingress replication and\n   an\
    \ Aggregate tree for a particular VPLS.  Mechanisms for achieving\n   this are\
    \ also for further study.\n"
- title: 11.  Data Forwarding
  contents:
  - '11.  Data Forwarding

    '
- title: 11.1.  MPLS Tree Encapsulation
  contents:
  - '11.1.  MPLS Tree Encapsulation

    '
- title: 11.1.1.  Mapping Multiple VPLS Instances to a P2MP LSP
  contents:
  - "11.1.1.  Mapping Multiple VPLS Instances to a P2MP LSP\n   The following diagram\
    \ shows the progression of the VPLS multicast\n   packet as it enters and leaves\
    \ the SP network when MPLS trees are\n   being used for multiple VPLS instances.\
    \  RSVP-TE P2MP LSPs are\n   examples of such trees.\n      Packets received \
    \       Packets in transit      Packets forwarded\n      at ingress PE       \
    \    in the service          by egress PEs\n                              provider\
    \ network\n                              +---------------+\n                 \
    \             |MPLS Tree Label|\n                              +---------------+\n\
    \                              | VPLS Label    |\n      ++=============++    \
    \   ++=============++       ++=============++\n      ||C-Ether Hdr  ||       ||\
    \ C-Ether Hdr ||       || C-Ether Hdr ||\n      ++=============++ >>>>> ++=============++\
    \ >>>>> ++=============++\n      || C-IP Header ||       || C-IP Header ||   \
    \    || C-IP Header ||\n      ++=============++ >>>>> ++=============++ >>>>>\
    \ ++=============++\n      || C-Payload   ||       || C-Payload   ||       ||\
    \ C-Payload   ||\n      ++=============++       ++=============++       ++=============++\n\
    \   When an ingress PE receives a packet, the ingress PE using the\n   procedures\
    \ defined in [RFC4761] and [RFC4762] determines the VPLS\n   instance associated\
    \ with the packet.  If the packet is an IP\n   multicast packet, and the ingress\
    \ PE uses an Aggregate Selective tree\n   for the (C-S, C-G) carried in the packet,\
    \ then the ingress PE pushes\n   the VPLS Label associated with the VPLS instance\
    \ on the ingress PE\n   and the MPLS Tree Label associated with the Aggregate\
    \ Selective tree,\n   and it sends the packet over the P2MP LSP associated with\
    \ the\n   Aggregate Selective tree.  Otherwise, if the ingress PE does not use\n\
    \   an Aggregate Selective tree for the (C-S, C-G), or the packet is\n   either\
    \ non-IP multicast or broadcast, the ingress PE pushes the VPLS\n   label associated\
    \ with the VPLS instance on the ingress PE and the\n   MPLS Tree Label associated\
    \ with the Aggregate Inclusive tree, and it\n   sends the packet over the P2MP\
    \ LSP associated with the Aggregate\n   Inclusive tree.\n   The egress PE does\
    \ a lookup on the outer MPLS tree label, and\n   determines the MPLS forwarding\
    \ table in which to look up the inner\n   MPLS label (VPLS label).  This table\
    \ is specific to the tree label\n   space (as identified by the MPLS Tree Label).\
    \  The inner label (VPLS\n   label) is unique within the context of the root of\
    \ the tree (as it is\n   assigned by the root of the tree, without any coordination\
    \ with any\n   other nodes).  Thus, it is not unique across multiple roots.  So,\
    \ to\n   unambiguously identify a particular VPLS, one has to know the VPLS\n\
    \   label, and the context within which that label is unique.  The\n   context\
    \ is provided by the outer MPLS label (MPLS Tree Label)\n   [RFC5331].\n   The\
    \ outer MPLS label is popped.  The lookup of the resulting MPLS\n   label determines\
    \ the VSI in which the egress PE needs to do the\n   C-multicast data packet lookup.\
    \  It then pops the inner MPLS label\n   and sends the packet to the VSI for multicast\
    \ data forwarding.\n"
- title: 11.1.2.  Mapping One VPLS Instance to a P2MP LSP
  contents:
  - "11.1.2.  Mapping One VPLS Instance to a P2MP LSP\n   The following diagram shows\
    \ the progression of the VPLS multicast\n   packet as it enters and leaves the\
    \ SP network when a given MPLS tree\n   is being used for a single VPLS instance.\
    \  RSVP-TE P2MP LSPs are\n   examples of such trees.\n      Packets received \
    \       Packets in transit      Packets forwarded\n      at ingress PE       \
    \    in the service          by egress PEs\n                              provider\
    \ network\n                              +---------------+\n                 \
    \             |MPLS Tree Label|\n      ++=============++       ++=============++\
    \       ++=============++\n      ||C-Ether Hdr  ||       || C-Ether Hdr ||   \
    \    || C-Ether Hdr ||\n      ++=============++ >>>>> ++=============++ >>>>>\
    \ ++=============++\n      || C-IP Header ||       || C-IP Header ||       ||\
    \ C-IP Header ||\n      ++=============++ >>>>> ++=============++ >>>>> ++=============++\n\
    \      || C-Payload   ||       || C-Payload   ||       || C-Payload   ||\n   \
    \   ++=============++       ++=============++       ++=============++\n   When\
    \ an ingress PE receives a packet, the ingress PE using the\n   procedures defined\
    \ in [RFC4761] and [RFC4762] determines the VPLS\n   instance associated with\
    \ the packet.  If the packet is an IP\n   multicast packet, and the ingress PE\
    \ uses a Selective tree for the\n   (C-S, C-G) carried in the packet, then the\
    \ ingress PE pushes the MPLS\n   Tree Label associated with the Selective tree,\
    \ and it sends the\n   packet over the P2MP LSP associated with the Selective\
    \ tree.\n   Otherwise, if the ingress PE does not use a Selective tree for the\n\
    \   (C-S, C-G), or the packet is either non-IP multicast or broadcast,\n   the\
    \ ingress PE pushes the MPLS Tree Label associated with the\n   Inclusive tree,\
    \ and it sends the packet over the P2MP LSP associated\n   with the Inclusive\
    \ tree.\n   The egress PE does a lookup on the MPLS tree label and determines\
    \ the\n   VSI in which the receiver PE needs to do the C-multicast data packet\n\
    \   lookup.  It then pops the MPLS label and sends the packet to the VSI\n   for\
    \ multicast data forwarding.\n"
- title: 12.  VPLS Data Packet Treatment
  contents:
  - "12.  VPLS Data Packet Treatment\n   If the destination MAC address of a VPLS\
    \ packet received by an\n   ingress PE from a VPLS site is a multicast address,\
    \ a P-multicast\n   tree SHOULD be used to transport the packet, if possible.\
    \  If the\n   packet is an IP multicast packet and a Selective tree exists for\
    \ that\n   multicast stream, the Selective tree MUST be used.  Else, if a\n  \
    \ (C-*, C-*) Selective tree exists for the VPLS it SHOULD be used.\n   Else, if\
    \ an Inclusive tree exists for the VPLS, it SHOULD be used.\n   If the destination\
    \ MAC address of a VPLS packet is a broadcast\n   address, it is flooded.  If\
    \ a (C-*, C-*) Selective tree exists for\n   the VPLS, the PE SHOULD flood over\
    \ it.  Else, if an Inclusive tree\n   exists for the VPLS, the PE SHOULD flood\
    \ over it.  Else, the PE MUST\n   flood the packet using the procedures in [RFC4761]\
    \ or [RFC4762].\n   If the destination MAC address of a packet is a unicast address\
    \ and\n   it has not been learned, the packet MUST be sent to all PEs in the\n\
    \   VPLS.  Inclusive P-multicast trees or a Selective P-multicast tree\n   bound\
    \ to (C-*, C-*) SHOULD be used for sending unknown unicast MAC\n   packets to\
    \ all PEs.  When this is the case, the receiving PEs MUST\n   support the ability\
    \ to perform MAC address learning for packets\n   received on a multicast tree.\
    \  In order to perform such learning, the\n   receiver PE MUST be able to determine\
    \ the sender PE when a VPLS\n   packet is received on a P-multicast tree.  This\
    \ further implies that\n   the MPLS P-multicast tree technology MUST allow the\
    \ egress PE to\n   determine the sender PE from the received MPLS packet.\n  \
    \ When a receiver PE receives a VPLS packet with a source MAC address,\n   which\
    \ has not yet been learned, on a P-multicast tree, the receiver\n   PE determines\
    \ the PW to the sender PE.  The receiver PE then creates\n   forwarding state\
    \ in the VPLS instance with a destination MAC address\n   being the same as the\
    \ source MAC address being learned, and the PW\n   being the PW to the sender\
    \ PE.\n   It should be noted that when a sender PE that is sending packets\n \
    \  destined to an unknown unicast MAC address over a P-multicast tree\n   learns\
    \ the PW to use for forwarding packets destined to this unicast\n   MAC address,\
    \ it might immediately switch to transport such packets\n   over this particular\
    \ PW.  Since the packets were initially being\n   forwarded using a P-multicast\
    \ tree, this could lead to packet\n   reordering.  This constraint should be taken\
    \ into consideration if\n   unknown unicast frames are forwarded using a P-multicast\
    \ tree,\n   instead of multiple PWs based on [RFC4761] or [RFC4762].\n   An implementation\
    \ SHOULD support the ability to transport unknown\n   unicast traffic over Inclusive\
    \ P-multicast trees.  Furthermore, an\n   implementation MUST support the ability\
    \ to perform MAC address\n   learning for packets received on a P-multicast tree.\n"
- title: 13.  Security Considerations
  contents:
  - "13.  Security Considerations\n   Security considerations discussed in [RFC4761]\
    \ and [RFC4762] apply to\n   this document.  This section describes additional\
    \ considerations.\n   As mentioned in [RFC4761], there are two aspects to achieving\
    \ data\n   privacy and protecting against denial-of-service attacks in a VPLS:\n\
    \   securing the control plane and protecting the forwarding path.\n   Compromise\
    \ of the control plane could result in a PE sending\n   multicast data belonging\
    \ to some VPLS to another VPLS, or black-\n   holing VPLS multicast data, or even\
    \ sending it to an eavesdropper;\n   none of which are acceptable from a data\
    \ privacy point of view.  In\n   addition, compromise of the control plane could\
    \ result in black-\n   holing VPLS multicast data and could provide opportunities\
    \ for\n   unauthorized VPLS multicast usage (e.g., exploiting traffic\n   replication\
    \ within a multicast tree to amplify a denial-of-service\n   attack based on sending\
    \ large amounts of traffic).\n   The mechanisms in this document use BGP for the\
    \ control plane.\n   Hence, techniques such as in [RFC5925] help authenticate\
    \ BGP\n   messages, making it harder to spoof updates (which can be used to\n\
    \   divert VPLS traffic to the wrong VPLS) or withdrawals (denial-of-\n   service\
    \ attacks).  In the multi-AS methods (b) and (c) described in\n   the \"Inter-AS\
    \ Inclusive P-Multicast Tree A-D/Binding\" section, this\n   also means protecting\
    \ the inter-AS BGP sessions, between the ASBRs,\n   the PEs, or the Route Reflectors.\n\
    \   Note that [RFC5925] will not help in keeping MPLS labels, associated\n   with\
    \ P2MP LSPs or the upstream MPLS labels used for aggregation,\n   private -- knowing\
    \ the labels, one can eavesdrop on VPLS traffic.\n   However, this requires access\
    \ to the data path within an SP network,\n   which is assumed to be composed of\
    \ trusted nodes/links.\n   One of the requirements for protecting the data plane\
    \ is that the\n   MPLS labels be accepted only from valid interfaces.  This applies\n\
    \   both to MPLS labels associated with P2MP LSPs and to the upstream-\n   assigned\
    \ MPLS labels.  For a PE, valid interfaces comprise links from\n   other routers\
    \ in the PE's own AS.  For an ASBR, valid interfaces\n   comprise links from other\
    \ routers in the ASBR's own AS, and links\n   from other ASBRs in ASes that have\
    \ instances of a given VPLS.  It is\n   especially important in the case of multi-AS\
    \ VPLS instances that one\n   accept VPLS packets only from valid interfaces.\n"
- title: 14.  IANA Considerations
  contents:
  - "14.  IANA Considerations\n   This document defines a new NLRI, called \"MCAST-VPLS\"\
    , to be carried\n   in BGP using multiprotocol extensions.  IANA has assigned\
    \ it a SAFI\n   value of 8.\n   This document defines a BGP-optional transitive\
    \ attribute called\n   \"PMSI_TUNNEL\".  This is the same attribute as the one\
    \ defined in\n   [RFC6514] and the code point for this attribute has already been\n\
    \   assigned by IANA as 22 [BGP-IANA].  Hence, no further action is\n   required\
    \ from IANA regarding this attribute.\n"
- title: 15.  References
  contents:
  - '15.  References

    '
- title: 15.1.  Normative References
  contents:
  - "15.1.  Normative References\n   [RFC2119]   Bradner, S., \"Key words for use\
    \ in RFCs to Indicate\n               Requirement Levels\", BCP 14, RFC 2119,\
    \ March 1997.\n   [RFC3209]   Awduche, D., Berger, L., Gan, D., Li, T., Srinivasan,\
    \ V.,\n               and G. Swallow, \"RSVP-TE: Extensions to RSVP for LSP\n\
    \               Tunnels\", RFC 3209, December 2001.\n   [RFC4760]   Bates, T.,\
    \ Chandra, R., Katz, D., and Y. Rekhter,\n               \"Multiprotocol Extensions\
    \ for BGP-4\", RFC 4760, January\n               2007.\n   [RFC4761]   Kompella,\
    \ K., Ed., and Y. Rekhter, Ed., \"Virtual Private\n               LAN Service\
    \ (VPLS) Using BGP for Auto-Discovery and\n               Signaling\", RFC 4761,\
    \ January 2007.\n   [RFC4762]   Lasserre, M., Ed., and V. Kompella, Ed., \"Virtual\
    \ Private\n               LAN Service (VPLS) Using Label Distribution Protocol\n\
    \               (LDP) Signaling\", RFC 4762, January 2007.\n   [RFC5036]   Andersson,\
    \ L., Ed., Minei, I., Ed., and B. Thomas, Ed.,\n               \"LDP Specification\"\
    , RFC 5036, October 2007.\n   [RFC5331]   Aggarwal, R., Rekhter, Y., and E. Rosen,\
    \ \"MPLS Upstream\n               Label Assignment and Context-Specific Label\
    \ Space\", RFC\n               5331, August 2008.\n   [RFC6511]   Ali, Z., Swallow,\
    \ G., and R. Aggarwal, \"Non-Penultimate\n               Hop Popping Behavior\
    \ and Out-of-Band Mapping for RSVP-TE\n               Label Switched Paths\",\
    \ RFC 6511, February 2012.\n   [RFC6512]   Wijnands, IJ., Rosen, E., Napierala,\
    \ M., and N. Leymann,\n               \"Using Multipoint LDP When the Backbone\
    \ Has No Route to\n               the Root\", RFC 6512, February 2012.\n"
- title: 15.2.  Informative References
  contents:
  - "15.2.  Informative References\n   [RFC6514]   Aggarwal, R., Rosen, E., Morin,\
    \ T., and Y. Rekhter, \"BGP\n               Encodings and Procedures for Multicast\
    \ in MPLS/BGP IP\n               VPNs\", RFC 6514, February 2012.\n   [RFC6513]\
    \   Rosen, E., Ed., and R. Aggarwal, Ed., \"Multicast in\n               MPLS/BGP\
    \ IP VPNs\", RFC 6513, February 2012.\n   [RFC6388]   Wijnands, IJ., Ed., Minei,\
    \ I., Ed., Kompella, K., and B.\n               Thomas, \"Label Distribution Protocol\
    \ Extensions for\n               Point-to-Multipoint and Multipoint-to-Multipoint\
    \ Label\n               Switched Paths\", RFC 6388, November 2011.\n   [RFC6074]\
    \   Rosen, E., Davie, B., Radoaca, V., and W. Luo,\n               \"Provisioning,\
    \ Auto-Discovery, and Signaling in Layer 2\n               Virtual Private Networks\
    \ (L2VPNs)\", RFC 6074, January\n               2011.\n   [RFC5925]   Touch, J.,\
    \ Mankin, A., and R. Bonica, \"The TCP\n               Authentication Option\"\
    , RFC 5925, June 2010.\n   [RFC5501]   Kamite, Y., Ed., Wada, Y., Serbest, Y.,\
    \ Morin, T., and L.\n               Fang, \"Requirements for Multicast Support\
    \ in Virtual\n               Private LAN Services\", RFC 5501, March 2009.\n \
    \  [RFC5332]   Eckert, T., Rosen, E., Ed., Aggarwal, R., and Y. Rekhter,\n   \
    \            \"MPLS Multicast Encapsulations\", RFC 5332, August 2008.\n   [RFC4684]\
    \   Marques, P., Bonica, R., Fang, L., Martini, L., Raszuk,\n               R.,\
    \ Patel, K., and J. Guichard, \"Constrained Route\n               Distribution\
    \ for Border Gateway Protocol/MultiProtocol\n               Label Switching (BGP/MPLS)\
    \ Internet Protocol (IP) Virtual\n               Private Networks (VPNs)\", RFC\
    \ 4684, November 2006.\n   [RFC4875]   Aggarwal, R., Ed., Papadimitriou, D., Ed.,\
    \ and S.\n               Yasukawa, Ed., \"Extensions to Resource Reservation\n\
    \               Protocol - Traffic Engineering (RSVP-TE) for Point-to-\n     \
    \          Multipoint TE Label Switched Paths (LSPs)\", RFC 4875, May\n      \
    \         2007.\n   [RFC4601]   Fenner, B., Handley, M., Holbrook, H., and I.\
    \ Kouvelas,\n               \"Protocol Independent Multicast - Sparse Mode (PIM-SM):\n\
    \               Protocol Specification (Revised)\", RFC 4601, August 2006.\n \
    \  [RFC4541]   Christensen, M., Kimball, K., and F. Solensky,\n              \
    \ \"Considerations for Internet Group Management Protocol\n               (IGMP)\
    \ and Multicast Listener Discovery (MLD) Snooping\n               Switches\",\
    \ RFC 4541, May 2006.\n   [RFC4447]   Martini, L., Ed., Rosen, E., El-Aawar, N.,\
    \ Smith, T., and\n               G. Heron, \"Pseudowire Setup and Maintenance\
    \ Using the\n               Label Distribution Protocol (LDP)\", RFC 4447, April\
    \ 2006.\n   [RFC4364]   Rosen, E. and Y. Rekhter, \"BGP/MPLS IP Virtual Private\n\
    \               Networks (VPNs)\", RFC 4364, February 2006.\n   [RFC3810]   Vida,\
    \ R., Ed., and L. Costa, Ed., \"Multicast Listener\n               Discovery Version\
    \ 2 (MLDv2) for IPv6\", RFC 3810, June\n               2004.\n   [RFC3376]   Cain,\
    \ B., Deering, S., Kouvelas, I., Fenner, B., and A.\n               Thyagarajan,\
    \ \"Internet Group Management Protocol, Version\n               3\", RFC 3376,\
    \ October 2002.\n   [RFC2710]   Deering, S., Fenner, W., and B. Haberman, \"Multicast\n\
    \               Listener Discovery (MLD) for IPv6\", RFC 2710, October\n     \
    \          1999.\n   [RFC2236]   Fenner, W., \"Internet Group Management Protocol,\
    \ Version\n               2\", RFC 2236, November 1997.\n   [RFC1997]   Chandra,\
    \ R., Traina, P., and T. Li, \"BGP Communities\n               Attribute\", RFC\
    \ 1997, August 1996.\n   [MULTI-HOMING]\n               Kothari, B., Kompella,\
    \ K., Henderickx, W., Balus, F.,\n               Uttaro, J., Palislamovic, S.,\
    \ and W. Lin, \"BGP based\n               Multi-homing in Virtual Private LAN\
    \ Service\", Work in\n               Progress, July 2013.\n   [BGP-IANA]  IANA,\
    \ \"Border Gateway Protocol (BGP) Parameters\",\n               <http://www.iana.org/assignments/bgp-parameters>.\n"
- title: 16.  Acknowledgments
  contents:
  - "16.  Acknowledgments\n   Many thanks to Thomas Morin for his support of this\
    \ work.\n   We would also like to thank authors of [RFC6514] and [RFC6513], as\n\
    \   the details of the inter-AS segmented tree procedures in this\n   document,\
    \ as well as some text that describes these procedures have\n   benefited from\
    \ those in [RFC6514] and [RFC6513].  The same applies to\n   the notion of Inclusive\
    \ and Selective trees, as well as the\n   procedures for switching from Inclusive\
    \ to Selective trees.\n   We would also like to thank Nabil Bitar, Stewart Bryant,\
    \ Wim\n   Henderickx, and Eric Rosen for their review and comments.\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Rahul Aggarwal\n   998 Lucky Avenue\n   Menlo Park, CA\
    \ 94025\n   USA\n   Phone: +1-415-806-5527\n   EMail: raggarwa_1@yahoo.com\n \
    \  Yuji Kamite\n   NTT Communications Corporation\n   Granpark Tower\n   3-4-1\
    \ Shibaura, Minato-ku\n   Tokyo  108-8118\n   Japan\n   EMail: y.kamite@ntt.com\n\
    \   Luyuan Fang\n   Microsoft\n   EMail: lufang@microsoft.com\n   Yakov Rekhter\n\
    \   Juniper Networks\n   1194 North Mathilda Ave.\n   Sunnyvale, CA 94089\n  \
    \ USA\n   EMail: yakov@juniper.net\n   Chaitanya Kodeboniya\n   EMail: chaitk@yahoo.com\n"
