- contents:
  - "         Transparent Interconnection of Lots of Links (TRILL):\n                          Appointed
    Forwarders\n"
  title: __initial_text__
- contents:
  - "Abstract\n   TRILL (Transparent Interconnection of Lots of Links) supports multi-\n
    \  access LAN (Local Area Network) links where a single link can have\n   multiple
    end stations and TRILL switches attached.  Where multiple\n   TRILL switches are
    attached to a link, native traffic to and from end\n   stations on that link is
    handled by a subset of those TRILL switches\n   called \"Appointed Forwarders\"
    as originally specified in RFC 6325,\n   with the intent that native traffic in
    each VLAN be handled by at\n   most one TRILL switch.  This document clarifies
    and updates the\n   Appointed Forwarder mechanism.  It updates RFCs 6325 and 7177
    and\n   obsoletes RFC 6439.\n"
  title: Abstract
- contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This
    document is a product of the Internet Engineering Task Force\n   (IETF).  It represents
    the consensus of the IETF community.  It has\n   received public review and has
    been approved for publication by the\n   Internet Engineering Steering Group (IESG).
    \ Further information on\n   Internet Standards is available in Section 2 of RFC
    7841.\n   Information about the current status of this document, any errata,\n
    \  and how to provide feedback on it may be obtained at\n   http://www.rfc-editor.org/info/rfc8139.\n"
  title: Status of This Memo
- contents:
  - "Copyright Notice\n   Copyright (c) 2017 IETF Trust and the persons identified
    as the\n   document authors.  All rights reserved.\n   This document is subject
    to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n
    \  (http://trustee.ietf.org/license-info) in effect on the date of\n   publication
    of this document.  Please review these documents\n   carefully, as they describe
    your rights and restrictions with respect\n   to this document.  Code Components
    extracted from this document must\n   include Simplified BSD License text as described
    in Section 4.e of\n   the Trust Legal Provisions and are provided without warranty
    as\n   described in the Simplified BSD License.\n"
  title: Copyright Notice
- contents:
  - "Table of Contents\n   1. Introduction ....................................................4\n
    \     1.1. Appointed Forwarders and Active-Active .....................5\n      1.2.
    Terminology and Abbreviations ..............................6\n   2. Appointed
    Forwarders and Their Appointment ......................7\n      2.1. The Appointment
    Databases and DRB Actions ..................8\n      2.2. Appointment Effects
    of DRB Elections ......................10\n           2.2.1. Processing Forwarder
    Appointments in Hellos ........11\n           2.2.2. Frequency of Hello Appointments
    ....................13\n           2.2.3. Appointed Forwarders Hello Limit ...................13\n
    \     2.3. Effects of Local Configuration Actions on Appointments ....14\n      2.4.
    Overload and Appointed Forwarders .........................14\n      2.5. VLAN
    Mapping within a Link ................................15\n   3. The Inhibition
    Mechanism .......................................15\n      3.1. Inhibited Appointed
    Forwarder Behavior ....................18\n      3.2. Root Bridge Change Inhibition
    Optimizations ...............18\n           3.2.1. Optimization for Change to
    Lower Priority ..........19\n           3.2.2. Optimization for Change to Priority
    Only ...........19\n           3.2.3. Optimizing the Detection of Completed Settling
    .....19\n   4. Optional TRILL Hello Reduction .................................20\n
    \  5. Multiple Ports on the Same Link ................................22\n   6.
    Port-Shutdown Messages .........................................23\n      6.1.
    Planned Shutdown and Hellos ...............................23\n      6.2. Port-Shutdown
    Message Structure ...........................23\n      6.3. Port-Shutdown Message
    Transmission ........................24\n      6.4. Port-Shutdown Message Reception
    ...........................25\n      6.5. Port-Shutdown Message Security ............................25\n
    \     6.6. Port-Shutdown Configuration ...............................26\n   7.
    FGL-VLAN Mapping Consistency Checking ..........................26\n   8. Support
    of E-L1CS ..............................................27\n      8.1. Backward
    Compatibility ....................................27\n   9. Security Considerations
    ........................................28\n   10. Code Points and Data Structures
    ...............................28\n      10.1. IANA Considerations ......................................28\n
    \     10.2. AppointmentBitmap APPsub-TLV .............................29\n      10.3.
    AppointmentList APPsub-TLV ...............................30\n      10.4. FGL-VLAN-Bitmap
    APPsub-TLV ...............................31\n      10.5. FGL-VLAN-Pairs APPsub-TLV
    ................................32\n   11. Management Considerations .....................................33\n
    \  12. References ....................................................34\n      12.1.
    Normative References .....................................34\n      12.2. Informative
    References ...................................36\n   Appendix A. VLAN Inhibition
    Example ...............................37\n   Appendix B. Multi-Link VLAN Mapping
    Loop Example ..................38\n   Appendix C. Changes to RFCs 6325, 6439,
    and 7177 ..................39\n   Acknowledgments ...................................................40\n
    \  Authors' Addresses ................................................41\n"
  title: Table of Contents
- contents:
  - "1.  Introduction\n   The IETF TRILL (Transparent Interconnection of Lots of Links)\n
    \  protocol [RFC6325] [RFC7780] provides optimal pairwise data frame\n   forwarding
    without configuration in multi-hop networks with arbitrary\n   topology and link
    technology, safe forwarding even during periods of\n   temporary loops, and support
    for multipathing of both unicast and\n   multicast traffic.  TRILL accomplishes
    these by using IS-IS\n   (Intermediate System to Intermediate System) [IS-IS]
    [RFC7176]\n   link-state routing and encapsulating traffic using a header that\n
    \  includes a hop count.  The design supports VLANs, FGLs (Fine-Grained\n   Labels)
    [RFC7172], and optimization of the distribution of\n   multi-destination frames
    based on VLANs and multicast groups.\n   Devices that implement TRILL are called
    TRILL switches or \"RBridges\"\n   (Routing Bridges).\n   Section 2 of [RFC7177]
    discusses the environment for which the TRILL\n   protocol is designed and the
    differences between that environment and\n   the typical Layer 3 routing environment.\n
    \  TRILL supports multi-access LAN (Local Area Network) links that can\n   have
    multiple end stations and TRILL switches attached.  Where\n   multiple TRILL switches
    are attached to a link, native traffic to and\n   from end stations on that link
    is handled by a subset of those\n   switches called \"Appointed Forwarders\" as
    originally specified in\n   [RFC6325], with the intent that native traffic in
    each VLAN be\n   handled by at most one switch.  A TRILL switch can be Appointed\n
    \  Forwarder for many VLANs.\n   The purpose of this document is to update and
    improve the Appointed\n   Forwarder mechanism and free it from the limitations
    imposed by the\n   requirement in its initial design that all appointments fit
    within a\n   TRILL Hello Protocol Data Unit (PDU).  This is accomplished by\n
    \  requiring support of link-scoped FS-LSPs (Flooding Scope Link State\n   PDUs)
    (Section 8) and providing the option to send appointment\n   information in those
    LSPs.  In addition, this document provides a\n   number of other optional features
    to\n   1. detect inconsistent VLAN-ID-to-FGL [RFC7172] mappings among the\n      TRILL
    switch ports on a link, as discussed in Section 7,\n   2. expedite notification
    of ports going down so that Appointed\n      Forwarders can be adjusted, as discussed
    in Section 6, and\n   3. reduce or eliminate the need for \"inhibition\" of ports
    for loop\n      safety, as discussed in Section 3.2.\n   This document replaces
    and obsoletes [RFC6439], incorporating the\n   former material in [RFC6439] with
    these additions.  The various\n   optimizations are orthogonal and optional.  Implementers
    can choose\n   to provide all, some, or none of them, and TRILL switches will
    still\n   be interoperable.  In accordance with the TRILL design philosophy,\n
    \  these optimizations require zero or minimal configuration, but there\n   are
    a couple of configurable parameters, as summarized in Section 11.\n   As described
    in Appendix C, this document updates [RFC6325] by\n   mandating support of E-L1CS
    FS-LSPs and provides backward\n   compatibility in the presence of legacy TRILL
    switches that do not\n   provide this support.  It also updates [RFC7177] by providing,
    as an\n   optional optimization, that receipt of the Port-Shutdown message\n   specified
    herein be treated as an event in the state machine\n   specified in [RFC7177].\n
    \  This document includes reference implementation details.  Alternative\n   implementations
    that interoperate on the wire are permitted.\n   The Appointed Forwarder mechanism
    is irrelevant to any link on which\n   end-station service is not offered.  This
    includes links configured\n   as point-to-point IS-IS links and any link with
    all TRILL switch\n   ports on that link configured as trunk ports.  (In TRILL,\n
    \  configuration of a port as a \"trunk port\" just means that no\n   end-station
    service will be provided.  It does not imply that all\n   VLANs are enabled on
    that port.)\n   The Appointed Forwarder mechanism has no effect on the formation
    of\n   adjacencies, the election of the Designated RBridge (DRB) [RFC7177]\n   for
    a link, MTU matching, or pseudonode formation.  Those topics are\n   covered in
    [RFC7177].  Furthermore, Appointed Forwarder status has\n   no effect on the forwarding
    of TRILL Data frames; it only affects the\n   handling of native frames to and
    from end stations.\n   For other aspects of the TRILL base protocol, see [RFC6325],\n
    \  [RFC7177], and [RFC7780].  In cases of conflict between this document\n   and
    [RFC6325] or [RFC7177], this document prevails.\n"
  - contents:
    - "1.1.  Appointed Forwarders and Active-Active\n   As discussed in [RFC7379],
      TRILL active-active provides support for\n   end stations connected to multiple
      edge TRILL switches where these\n   connections are separate links.  Since TRILL
      Hellos are not forwarded\n   between these links, the Appointed Forwarder mechanism
      as described\n   herein operates separately on each such link.\n"
    title: 1.1.  Appointed Forwarders and Active-Active
  - contents:
    - "1.2.  Terminology and Abbreviations\n   This document uses the abbreviations
      and terms defined in [RFC6325],\n   some of which are repeated below for convenience,
      and additional\n   abbreviations and terms listed below.\n   Data Label mapping:
      The mapping from VLAN ID to FGL and from FGL to\n      VLAN ID.\n   DRB: Designated
      RBridge.  The RBridge on a link elected as specified\n      in [RFC7177] to
      handle certain decisions and tasks for that link,\n      including forwarder
      appointment as specified herein.\n   E-L1CS: Extended Level 1 Circuit Scope
      (Section 8).\n   FGL: Fine-Grained Label [RFC7172].\n   FS-LSP: Flooding Scope
      Link State PDU (Section 8).\n   Link: The means by which adjacent TRILL switches
      are connected.  A\n      TRILL link may be various technologies and, in the
      common case of\n      Ethernet, can be a \"bridged LAN\" -- that is to say,
      some\n      combination of Ethernet links with zero or more bridges, hubs,\n
      \     repeaters, or the like.\n   LSDB: Link State Database.\n   PDU: Protocol
      Data Unit.\n   RBridge: An alternative name for a TRILL switch.\n   TRILL: Transparent
      Interconnection of Lots of Links or Tunneled\n      Routing in the Link Layer.\n
      \  TRILL switch: A device implementing the TRILL protocol.  An\n      alternative
      name for an RBridge.\n   Trunk port: A TRILL switch port configured with the
      \"end-station\n      service disable\" bit on, as described in Section 4.9.1
      of\n      [RFC6325].\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\",
      \"SHALL\", \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"NOT
      RECOMMENDED\", \"MAY\", and\n   \"OPTIONAL\" in this document are to be interpreted
      as described in\n   BCP 14 [RFC2119] [RFC8174] when, and only when, they appear
      in all\n   capitals, as shown here.\n"
    title: 1.2.  Terminology and Abbreviations
  title: 1.  Introduction
- contents:
  - "2.  Appointed Forwarders and Their Appointment\n   The Appointed Forwarder on
    a link for VLAN-x is the TRILL switch\n   (RBridge) that ingresses native frames
    from the link and egresses\n   native frames to the link in VLAN-x.  By default,
    the DRB (Designated\n   RBridge) on a link is in charge of native traffic for
    all VLANs on\n   the link.  The DRB may, if it wishes, act as Appointed Forwarder
    for\n   any VLAN, and it may appoint other TRILL switches that have ports on\n
    \  the link as Appointed Forwarder for one or more VLANs.\n   By definition, the
    DRB considers the other ports on the link to be\n   the ports with which a DRB
    port has adjacency on that link [RFC7177].\n   If the DRB loses adjacency to a
    TRILL switch that it has appointed\n   as forwarder and the native traffic that
    was being handled by that\n   Appointed Forwarder is still to be ingressed and
    egressed, it SHOULD\n   immediately appoint another forwarder or itself become
    the forwarder\n   for that traffic.\n   It is important that there not be two
    Appointed Forwarders on a link\n   that are ingressing and egressing native frames
    for the same VLAN at\n   the same time.  Should this occur, it could form a loop
    where frames\n   are not protected by a TRILL Hop Count for part of the loop.
    \ (Such a\n   condition can even occur through two Appointed Forwarders for two\n
    \  different VLANs, VLAN-x and VLAN-y, if ports or bridges inside the\n   link
    are configured to map frames between VLAN-x and VLAN-y as\n   discussed in Section
    2.5.)  While TRILL tries to avoid such\n   situations, for loop safety there is
    also an \"inhibition\" mechanism\n   (see Section 3) that can cause a TRILL switch
    that is an Appointed\n   Forwarder not to ingress or egress native frames.  Appointed\n
    \  Forwarder status and port \"inhibition\" have no effect on the\n   reception,
    transmission, or forwarding of TRILL Data or TRILL IS-IS\n   frames.  Appointed
    Forwarder status and inhibition only affect the\n   handling of native frames.\n
    \  As discussed in Section 5, an RBridge may have multiple ports on a\n   link.
    \ As discussed in [RFC7177], if there are multiple ports with\n   the same Media
    Access Control (MAC) address on the same link, all but\n   one will be suspended.
    \ The case of multiple ports on a link for the\n   same TRILL switch and the case
    of multiple ports with the same MAC\n   address on a link, as well as combinations
    of these cases, are fully\n   accommodated; however, the case of multiple ports
    on a link for the\n   same TRILL switch is expected to be a rare condition, and
    the case of\n   duplicate MAC addresses is not recommended by either TRILL or\n
    \  IEEE 802.1 standards.\n   There are six mechanisms by which an RBridge can
    be appointed or\n   unappointed as Appointed Forwarder:\n   1. assumption of appointment,
    when the DRB decides to act as\n      Appointed Forwarder for a VLAN,\n   2. E-L1CS
    appointment, as a result of appointments sent by the DRB in\n      E-L1CS FS-LSPs,\n
    \  3. Hello appointment, as a result of appointments sent by the DRB in\n      TRILL
    Hellos,\n   4. as a result of the DRB elections [RFC7177] as discussed in\n      Section
    2.2,\n   5. as a result of a Port-Shutdown message as discussed in Section 6,\n
    \     and\n   6. as a result of a local configuration action as discussed in\n
    \     Section 2.3.\n   Mechanisms 2 and 3 are covered in Section 2.1.\n"
  - contents:
    - "2.1.  The Appointment Databases and DRB Actions\n   The DRB MAY appoint other
      RBridges on the link as Appointed\n   Forwarders through two mechanisms, \"A\"
      and \"B\", as described below.\n   Each RBridge maintains two databases of appointment
      information:\n   (1) its E-L1CS LSDB, which shows appointments that each RBridge
      on\n   the link would make using mechanism A if that RBridge were the DRB,\n
      \  and (2) its Hello appointment database, which shows the appointments\n   most
      recently sent by the DRB in a TRILL Hello.  The E-L1CS LSDB is\n   semi-permanent
      and is only changed by E-L1CS FS-LSPs or IS-IS purges.\n   The Hello appointment
      database is more transient and is completely\n   reset by each Hello received
      from the DRB that contains any\n   appointments; this database is also cleared
      under other\n   circumstances, as described below.  An RBridge considers itself
      to be\n   the Appointed Forwarder for VLAN-x if this is indicated by either
      its\n   Hello appointment database or its E-L1CS LSDB entries from the DRB.\n
      \  The two mechanisms by which the DRB can appoint other RBridges on a\n   link
      as Appointed Forwarders are as follows:\n   (A) The inclusion of one or more
      Appointed Forwarders sub-TLVs\n       [RFC7176], AppointmentBitmap APPsub-TLVs
      (Section 10.2), or\n       AppointmentList APPsub-TLVs (Section 10.3) in E-L1CS
      LSPs it\n       sends on a link.  Appointments sent using this method will not
      be\n       seen by legacy RBridges that do not support E-L1CS (Section 8).\n
      \  (B) The inclusion of one or more Appointed Forwarders sub-TLVs\n       [RFC7176]
      in a TRILL Hello it sends on the Designated VLAN out of\n       the port that
      won the DRB election.  When the DRB sends any\n       appointments in a TRILL
      Hello, it must send all appointments it\n       is sending in Hellos for that
      link in that Hello.  Any previous\n       appointment it has sent in a Hello
      that is not included is\n       implicitly revoked.\n   To avoid the size limitations
      of the Hello PDU, it is RECOMMENDED\n   that the E-L1CS FS-LSP method be used
      to distribute forwarder\n   appointments and that all RBridges on a link use
      this method to\n   advertise the appointments they would make if they were the
      DRB.\n   However, if some RBridges on a link do not support E-L1CS FS-LSPs,\n
      \  then Hello appointments must be used for the DRB to appoint such\n   legacy
      RBridges as Appointed Forwarders.\n   Although the DRB does not need to announce
      the VLANs for which it has\n   chosen to act as Appointed Forwarder by sending
      appointments for\n   itself, if the DRB wishes to revoke all appointments made
      in Hellos\n   for RBridges other than itself on the link, it can do so by sending
      a\n   TRILL Hello with just an appointment for itself for some VLAN.\n   How
      the DRB decides what other RBridges on the link, if any, to\n   appoint as forwarder
      for some VLAN or VLANs is beyond the scope of\n   this document.\n   Unnecessary
      changes in Appointed Forwarders SHOULD NOT be made, as\n   they may result in
      transient lack of end-station service.\n   Should the network manager have misconfigured
      the enabled VLANs and\n   Appointed Forwarders, resulting in two RBridges believing
      they are\n   Appointed Forwarders for the same VLAN, the scenario described
      in\n   item 4 in Section 3 will cause one or more of the RBridges to be\n   inhibited
      for that VLAN, thus avoiding persistent loops.\n   When forwarder appointments
      are being encoded for transmission,\n   different patterns of VLANs are most
      efficiently encoded in different\n   ways.  The following table gives advice
      regarding the most efficient\n   encoding for a given pattern:\n                            sub-TLV
      and Reference\n   Pattern of VLAN IDs          |enclosing TLV(s) and Reference\n
      \  -------------------      ------------------------------------\n   Blocks
      of consecutive VLANs\n                            Appointed Forwarders sub-TLV
      [RFC7176]\n                                |Router CAPABILITY TLV [RFC7981]\n
      \                               |or MT-Capability TLV [RFC6329]\n   Scattered
      VLANs within a small range\n                            AppointmentBitmap APPsub-TLV
      (Section 10.2)\n                                |TRILL GENINFO TLV [RFC7357]\n
      \  Scattered VLANs over a large range\n                            AppointmentList
      APPsub-TLV (Section 10.3)\n                                |TRILL GENINFO TLV
      [RFC7357]\n"
    title: 2.1.  The Appointment Databases and DRB Actions
  - contents:
    - "2.2.  Appointment Effects of DRB Elections\n   When a TRILL switch port on
      a link wins the DRB election, there are\n   four possible cases:\n   1. A TRILL
      switch believes that it was the DRB and remains the DRB:\n      there is no
      change in Appointed Forwarder status.  This also\n      applies in the corner
      case where a TRILL switch has more than one\n      port on a link, one of which
      was previously the DRB election\n      winner but has just lost the DRB election
      to a different port of\n      the same TRILL switch on the same link (possibly
      due to management\n      configuration of port priorities).  In this case, there
      also is no\n      change in which TRILL switch is the DRB.\n   2. A TRILL switch
      believes that it was not the DRB but has now won\n      the DRB election and
      become the DRB on a link: by default, it can\n      act as Appointed Forwarder
      for any VLANs on that link that it\n      chooses, as long as its port is not
      configured as a trunk port and\n      has that VLAN enabled (or at least one
      of its ports meets these\n      criteria, if it has more than one port on the
      link).  It ignores\n      any previous forwarder appointment information it
      received from\n      other TRILL switches on the link.\n   3. A TRILL switch
      was not the DRB and does not become the DRB, but it\n      observes that the
      port winning the DRB election has changed: the\n      TRILL switch loses all
      Hello appointments.  In addition, there are\n      two subcases:\n      a. The
      new winning port and the old winner are ports of different\n         TRILL switches
      on the link.  In this case, it switches to using\n         the E-L1CS FS-LSP
      appointments for the winning TRILL switch.\n      b. The new winning port and
      the old winner are ports of the same\n         TRILL switch, which has two (or
      more) ports on the link:\n         although the Hello appointments are still
      discarded, since the\n         same TRILL switch is the DRB, the E-L1CS FS-LSP
      appointments\n         are unchanged.\n   4. The winning port is unchanged:
      as in case 1, there is no change in\n      Appointed Forwarder status.\n"
    - contents:
      - "2.2.1.  Processing Forwarder Appointments in Hellos\n   When a non-DRB RBridge
        that can offer end-station service on a link\n   receives a TRILL Hello that
        is not discarded for one of the reasons\n   given in [RFC7177], it checks
        the source MAC address and the Port ID\n   and System ID in the Hello to determine
        if it is from the winning DRB\n   port.  If it is not from that port, any
        forwarder appointment\n   sub-TLVs in the Hello are ignored, and there is
        no change in the\n   receiving RBridge's Appointed Forwarder status due to
        that Hello.\n   Also, if no forwarder appointment sub-TLVs are present in
        the TRILL\n   Hello, there is no change in the receiver's Appointed Forwarder\n
        \  status due to that Hello.\n   However, if the TRILL Hello is from the winning
        DRB port and the\n   Hello includes one or more forwarder appointment sub-TLVs,
        then the\n   receiving RBridge sets its Hello appointment database to be the
        set\n   of VLANs that have both of the following characteristics:\n   o  The
        VLAN is listed as an appointment for the receiving RBridge in\n      the Hello,
        and\n   o  The VLAN is enabled on the port where the Hello was received.\n
        \  (If the appointment includes VLAN IDs 0x000 or 0xFFF, they are\n   ignored,
        but any other VLAN IDs are still effective.)  It then\n   becomes Appointed
        Forwarder for all the VLANs for which it is\n   appointed in either its Hello
        appointment database or its E-L1CS\n   FS-LSP appointment database from the
        DRB if the VLAN is enabled and\n   if the port is not configured as a trunk
        or IS-IS point-to-point\n   port.  If the receiver was Appointed Forwarder
        for any VLANs because\n   they were in the Hello appointment database and
        they are no longer in\n   the Hello appointment database, its Appointed Forwarder
        status for\n   such VLANs is revoked.  For example, if none of these sub-TLVs
        in a\n   Hello appoints the receiving RBridge, then it loses all Appointed\n
        \  Forwarder status on the port where the Hello was received due to\n   Hello
        appointment database entries, but it retains Appointed\n   Forwarder status
        due to E-L1CS FS-LSP appointments.\n   The handling of one or more forwarder
        appointment sub-TLVs in a Hello\n   from the winning port that appoints the
        receiving RBridge is as\n   follows: an appointment in an Appointed Forwarders
        sub-TLV is for a\n   specific RBridge and a contiguous interval of VLAN IDs;
        however, as\n   stated above, it actually appoints that RBridge as forwarder
        only for\n   the VLAN or VLANs in that range that are enabled on one or more
        ports\n   that RBridge has on the link (ignoring any ports configured as\n
        \  trunk ports or as IS-IS point-to-point ports).\n   There is no reason for
        an RBridge to remember that it received a\n   valid appointment Hello message
        for a VLAN that was ineffective\n   because the VLAN was not enabled on the
        port where the Hello was\n   received or because the port was a trunk or point-to-point
        port.  It\n   does not become Appointed Forwarder for such a VLAN just because
        that\n   VLAN is later enabled or the port is later reconfigured.\n   The
        limitations due to the size of the Hello PDU make it desirable to\n   use
        E-L1CS FS-LSPs for appointment.  But if Hellos need to be used,\n   due to
        TRILL switches on the link not supporting E-L1CS FS-LSPs, the\n   remainder
        of this section provides a method to maximize the use of\n   the limited space
        in Hellos for forwarder appointment.\n   It should be straightforward for
        the DRB to send, within one Hello,\n   the appointments for several dozen
        VLAN IDs or several dozen blocks\n   of contiguous VLAN IDs.  Should the VLANs
        that the DRB wishes to\n   appoint be inconveniently distributed (for example,
        the proverbial\n   case where a DRB (say RB1) wishes to appoint RB2 as forwarder
        for all\n   even-numbered VLANs and appoint RB3 as forwarder for all odd-numbered\n
        \  VLANs), the following method may be used:\n      The network manager normally
        controls what VLANs are enabled on an\n      RBridge port.  Thus, the network
        manager can appoint an RBridge as\n      forwarder for an arbitrary set of
        scattered VLANs by enabling only\n      those VLANs on the relevant port (or
        ports) and then having the\n      DRB send an appointment that appears to
        appoint the target RBridge\n      as forwarder for all VLANs.  However, for
        proper operation and\n      inter-RBridge communication, the Designated VLAN
        for a link SHOULD\n      be enabled on all RBridge ports on that link, and
        it may not be\n      desired to appoint the RBridge as forwarder for the\n
        \     Designated VLAN.  Thus, in the general case, two appointments\n      would
        be required, although only one appointment would be required\n      if the
        Designated VLAN value were extremely low or high (such as\n      VLAN 0xFFE)
        or the default value (VLAN 1).\n   For example, assume that the DRB wants
        RB2 to be Appointed Forwarder\n   for all even-numbered VLANs and the Designated
        VLAN for the link is\n   VLAN 101.  The network manager could cause all even-numbered
        VLANs\n   plus VLAN 101 to be enabled on the relevant port of RB2 and then,\n
        \  with the desired effect, cause the DRB to send appointments to RB2\n   appointing
        it forwarder for all VLANs from 1 through 100 and from 102\n   through 4,094.\n"
      title: 2.2.1.  Processing Forwarder Appointments in Hellos
    - contents:
      - "2.2.2.  Frequency of Hello Appointments\n   Appointments made through E-L1CS
        FS-LSPs use the same IS-IS timing\n   constants as those for LSP flooding.
        \ The general IS-IS link-state\n   flooding mechanism is robust and includes
        acknowledgments so that it\n   automatically recovers from lost PDUs, rebooted
        TRILL switches, and\n   the like.\n   For Hello appointments, it is not necessary
        for the DRB to include\n   the Hello forwarder appointments in every TRILL
        Hello that it sends\n   on the Designated VLAN for a link.  For loop safety,
        every RBridge is\n   required to indicate, in every TRILL Hello it sends in
        VLAN-x on a\n   link, whether it is an Appointed Forwarder for VLAN-x for
        that link\n   (see item 4 in Section 3, but see also Section 4).  It is also\n
        \  RECOMMENDED that the DRB have enabled all VLANs for which end-station\n
        \  service will be offered on the link as well as the Designated VLAN.\n   Thus,
        the DRB will generally be informed by other RBridges on the\n   link of the
        VLANs for which they believe that they are the Appointed\n   Forwarder.  If
        this matches the appointments the DRB wishes to make,\n   it is not required
        to resend its forwarder appointments; however, for\n   robustness, especially
        in cases such as VLAN misconfigurations in a\n   bridged LAN link, it is RECOMMENDED
        that the DRB send its forwarder\n   appointments on the Designated VLAN at
        least once per its Holding\n   Time on the port that won the DRB election.\n"
      title: 2.2.2.  Frequency of Hello Appointments
    - contents:
      - "2.2.3.  Appointed Forwarders Hello Limit\n   The Hello mechanism of DRB forwarder
        appointment and the limited\n   length of TRILL Hellos impose a limit on the
        number of RBridges on a\n   link that can be Appointed Forwarders when E-L1CS
        FS-LSP appointments\n   cannot be used due to the presence of legacy RBridges.
        \ To obtain a\n   conservative estimate of this limit, assume that no more
        than\n   1,000 bytes are available in a TRILL Hello for such appointments.\n
        \  Assume also that it is desired to appoint various RBridges on a link\n
        \  as forwarder for arbitrary non-intersecting sets of VLANs.  Using the\n
        \  technique discussed at the end of Section 2.2.1 would generally\n   require
        two appointments, or 12 bytes, per RBridge.  With allowance\n   for sub-TLV
        and TLV overhead, appointments for 83 RBridges would\n   fit in under 1,000
        bytes.  Including the DRB, this implies a link\n   with 84 or more RBridges
        attached.  Links with more than a handful of\n   RBridges attached are expected
        to be rare, and in any case such\n   limitations are easily avoided by using
        E-L1CS FS-LSP appointment.\n"
      title: 2.2.3.  Appointed Forwarders Hello Limit
    title: 2.2.  Appointment Effects of DRB Elections
  - contents:
    - "2.3.  Effects of Local Configuration Actions on Appointments\n   Disabling
      VLAN-x at an RBridge port cancels any Appointed Forwarder\n   status that RBridge
      has for VLAN-x, unless VLAN-x is enabled on some\n   other port that the RBridge
      has connected to the same link.\n   Configuring a port as a trunk port or point-to-point
      port revokes\n   any Appointed Forwarder status that depends on enabled VLANs
      at\n   that port.\n   Causing a port to no longer be configured as a trunk or\n
      \  point-to-point port or enabling VLAN-x on a port does not necessarily\n   cause
      the RBridge to become an Appointed Forwarder for the link that\n   port is on.
      \ However, such actions allow the port's RBridge to become\n   Appointed Forwarder
      by choice if it is the DRB or, if it is not the\n   DRB on the link, by appointment
      as indicated by the Hello appointment\n   database or the E-L1CS FS-LSP appointment
      database.\n"
    title: 2.3.  Effects of Local Configuration Actions on Appointments
  - contents:
    - "2.4.  Overload and Appointed Forwarders\n   A TRILL switch in link-state overload
      [RFC7780] will, in general, do\n   a poorer job of forwarding frames than a
      TRILL switch not in\n   overload, because the TRILL switch not in overload has
      full knowledge\n   of the campus topology.  For example, as explained in [RFC7780],
      an\n   overloaded TRILL switch may not be able to distribute\n   multi-destination
      TRILL Data packets at all.\n   Therefore, the DRB SHOULD NOT appoint an RBridge
      in overload as an\n   Appointed Forwarder, and if an Appointed Forwarder becomes\n
      \  overloaded, the DRB SHOULD reassign VLANs from the overloaded RBridge\n   to
      another RBridge on the link that is not overloaded, if one is\n   available.\n
      \  A counter-example where it would be best to appoint an RBridge in\n   overload
      as Appointed Forwarder would be if RB1 was in overload but\n   all end stations
      in the campus in VLAN-x were on links attached to\n   RB1.  In such a case,
      RB1 would never have to route VLAN-x\n   end-station traffic as TRILL Data packets
      but would always be\n   forwarding them locally as native frames.  In this case,
      RB1\n   SHOULD NOT be disadvantaged for selection as the VLAN-x Appointed\n
      \  Forwarder on any such links, even if RB1 is in overload.\n   There is also
      the case where it is unavoidable to appoint an RBridge\n   in overload as Appointed
      Forwarder, because all RBridges on the link\n   are in overload.\n   These cases
      do not violate the prohibition in the IS-IS standard\n   against routing through
      an overloaded node.  Designation as an\n   Appointed Forwarder has to do with
      the ingress and egress of native\n   frames and has nothing to do with the IS-IS
      routing of TRILL Data\n   packets through a TRILL switch.\n   Overload does
      not affect DRB election, but a TRILL switch in overload\n   MAY reduce its own
      priority to be the DRB.\n"
    title: 2.4.  Overload and Appointed Forwarders
  - contents:
    - "2.5.  VLAN Mapping within a Link\n   TRILL Hellos include a field that is set
      to the VLAN in which they\n   are sent when they are sent on a link technology
      such as Ethernet\n   that has outer VLAN labeling.  (For link technologies such
      as PPP\n   that do not have outer VLAN labeling, this Hello field is ignored.)\n
      \  If a TRILL Hello arrives on a different VLAN than the VLAN on which\n   it
      was sent, then VLAN mapping is occurring within the link.  VLAN\n   mapping
      between VLAN-x and VLAN-y can lead to a loop if the Appointed\n   Forwarders
      for the VLANs are different.  If such mapping within a\n   link was allowed
      and occurred on two or more links so that there was\n   a cycle of VLAN mappings,
      a multi-destination frame would loop\n   forever.  Such a frame would be \"immortal\".
      \ For a specific example,\n   see Appendix B.\n   To prevent this potential
      problem, if the DRB on a link detects VLAN\n   mapping by receiving a Hello
      in VLAN-x that was sent on VLAN-y, it\n   MUST make or revoke appointments so
      as to assure that the same TRILL\n   switch (possibly the DRB) is the Appointed
      Forwarder on the link for\n   both VLAN-x and VLAN-y.\n"
    title: 2.5.  VLAN Mapping within a Link
  title: 2.  Appointed Forwarders and Their Appointment
- contents:
  - "3.  The Inhibition Mechanism\n   A TRILL switch has, for every link on which
    it can offer end-station\n   service (that is, every link for which it can act
    as an Appointed\n   Forwarder), the following timers, denominated in seconds:\n
    \  -  a DRB inhibition timer,\n   -  a root bridge change inhibition timer, and\n
    \  -  up to 4,094 VLAN inhibition timers, one for each legal VLAN ID.\n   The
    DRB and root bridge change inhibition timers MUST be implemented.\n   The loss
    of native traffic due to inhibition will be minimized by\n   logically implementing
    a VLAN inhibition timer per each VLAN for\n   which end-station service will ever
    be offered by the RBridge on the\n   link; this SHOULD be done.  (See Appendix
    A for an example\n   illustrating a potential problem that is solved by VLAN inhibition\n
    \  timers.)  However, if implementation limitations make a full set of\n   such
    timers impractical, the VLAN inhibition timers for more than one\n   VLAN can,
    with care, be merged into one timer.  In particular, an\n   RBridge MUST NOT merge
    the VLAN inhibition timers for two VLANs if it\n   is the Appointed Forwarder
    for one but not for the other, as this can\n   lead to unnecessary indefinitely
    prolonged inhibition.  In a given\n   implementation limitation, there will be
    safe operations, albeit with\n   more loss of native frames than would otherwise
    be required, even if\n   only two VLAN inhibition timers are provided: one for
    the VLANs for\n   which the RBridge is the Appointed Forwarder and one for all
    other\n   VLANs.  Thus, at least two VLAN inhibition timers MUST be\n   implemented.
    \ Where a VLAN inhibition timer represents more than one\n   VLAN, an update or
    test that would have been done to the timer for\n   any of the VLANs is performed
    on the merged timer.\n   These timers are set as follows:\n   1. On booting or
    management reset, each port will have its own set of\n      timers, even if two
    or more such ports are on the same link,\n      because the TRILL switch will
    not have had a chance yet to learn\n      that they are on the same link.  All
    inhibition timers are set to\n      \"expired\", except the DRB inhibition timer
    that is set in\n      accordance with item 2 below.  The DRB inhibition timer
    is handled\n      differently, because each port will initially believe that it
    is\n      the DRB.\n   2. When a TRILL switch decides that it has become the DRB
    on a link,\n      including when it is first booted or reset by management, it
    sets\n      the DRB inhibition timer to the Holding Time of its port on that\n
    \     link that won the DRB election.\n   3. When a TRILL switch decides that
    it has lost DRB status on a link,\n      it sets the DRB inhibition timer to \"expired\".\n
    \  Note: In the corner case where one port of a TRILL switch was the DRB\n   election
    winner but later lost the DRB election to a different port\n   of the same TRILL
    switch on that link (perhaps due to management\n   configuration of port priorities),
    neither item 2 nor item 3 above\n   applies, and the DRB timer is not changed.\n
    \  4. When a TRILL switch RB1 receives a TRILL Hello asserting that the\n      sender
    is the Appointed Forwarder and that Hello either\n      (1) arrives on VLAN-x
    or (2) was sent on VLAN-x as indicated\n      inside the Hello, RB1 uses as its
    VLAN-x inhibition timer for the\n      link (1) that timer's existing value or
    (2) the Holding Time in\n      the received Hello, whichever is longer.  A TRILL
    switch MUST\n      maintain VLAN inhibition timers covering a link to which it\n
    \     connects if it can offer end-station service on that link, even if\n      it
    is not currently the Appointed Forwarder for any VLAN on that\n      link.\n   5.
    When a TRILL switch RB1 enables VLAN-x on a port connecting to a\n      link and
    VLAN-x was previously not enabled on any of RB1's ports\n      on that link, it
    sets its VLAN inhibition timer for VLAN-x for\n      that link to its Holding
    Time for that port.  This is done even if\n      the port is configured as a trunk
    or point-to-point port, as long\n      as there is some chance it might later
    be configured not to be a\n      trunk or point-to-point port.  Remember, inhibition
    has no effect\n      on TRILL Data or IS-IS packets; inhibition only affects native\n
    \     frames.\n   6. When a TRILL switch detects a change in the common spanning
    tree\n      root bridge on a port, it sets its root bridge change inhibition\n
    \     timer for the link to an amount of time that defaults to\n      30 seconds
    and is configurable to any value from 30 down to\n      0 seconds.  This condition
    will not occur unless the TRILL switch\n      is receiving Bridge PDUs (BPDUs)
    on the port from an attached\n      bridged LAN; if no BPDUs are being received,
    the root bridge\n      change inhibition timer will never be set.  It is safe
    to\n      configure this inhibition time to the settling time of an attached\n
    \     bridged LAN.  For example, if it is known that the Rapid Spanning\n      Tree
    Protocol (RSTP) [802.1Q] is running throughout the attached\n      bridged LAN,
    it is safe to configure this inhibition time to\n      7 seconds or, if the attached
    bridges have been configured to have\n      a minimum Bridge Hello Timer, it is
    safe to configure it to\n      4 seconds.  Further optimizations are specified
    in Section 3.2.\n   7. When a TRILL switch decides that one of its ports (or a
    set of its\n      ports) P1 is on the same link as another one of its ports (or
    set\n      of its ports) P2, the inhibition timers are merged into a single\n
    \     set of inhibition timers by using the longest value of the\n      corresponding
    timers as the initial value of the merged timers.\n   8. When an RBridge decides
    that a set of its ports that it had been\n      treating as being on the same
    link are no longer on the same link,\n      those ports will necessarily be on
    two or more links (up to one\n      link per port).  This is handled by cloning
    a copy of the timers\n      for each of the two or more links to which the TRILL
    switch has\n      decided these ports connect.\n"
  - contents:
    - "3.1.  Inhibited Appointed Forwarder Behavior\n   Inhibition has no effect on
      the receipt or forwarding of TRILL Data\n   packets or TRILL IS-IS packets.
      \ It only affects ingressing and\n   egressing native frames.\n   An Appointed
      Forwarder for a link is inhibited for VLAN-x if:\n   1. its DRB inhibition timer
      for that link is not expired,\n   2. its root bridge change inhibition timer
      for that link is not\n      expired, or\n   3. its VLAN inhibition timer for
      that link covering VLAN-x is not\n      expired.\n   If a VLAN-x Appointed Forwarder
      for a link is inhibited and receives\n   a TRILL Data packet whose encapsulated
      frame would normally be\n   egressed to that link in VLAN-x, it decapsulates
      the native frame as\n   usual.  However, it does not output it to, or queue
      it for, that\n   link, although, if appropriate (for example, the frame is\n
      \  multi-destination), it may output it to, or queue it for, other\n   links.\n
      \  If a VLAN-x Appointed Forwarder for a link is inhibited and receives\n   a
      native frame in VLAN-x that would normally be ingressed from that\n   link,
      the native frame is ignored, except for address learning.\n   A TRILL switch
      with one or more unexpired inhibition timers, possibly\n   including an unexpired
      inhibition timer covering VLAN-x, is still\n   required to indicate in TRILL
      Hellos it sends on VLAN-x whether or\n   not it is Appointed Forwarder for VLAN-x
      for the port on which it\n   sends the Hello.\n"
    title: 3.1.  Inhibited Appointed Forwarder Behavior
  - contents:
    - "3.2.  Root Bridge Change Inhibition Optimizations\n   The subsections below
      specify three optimizations that can reduce the\n   inhibition time of an RBridge
      port under certain circumstances for\n   changes in the root Bridge ID [802.1Q]
      being received by that port\n   and thus decrease any transient interruption
      in end-station service\n   due to inhibition.  TRILL switches MAY implement
      these optimizations.\n   In the first two optimizations, inhibition can be eliminated
      entirely\n   under some circumstances.  These optimizations are a bit heuristic
      in\n   that with some unlikely multiple changes in a bridged LAN that occur\n
      \  simultaneously, or nearly so, the optimizations make transient\n   looping
      more likely.\n"
    - contents:
      - "3.2.1.  Optimization for Change to Lower Priority\n   Assume that the root
        Bridge ID being received on an RBridge port\n   changes to a new root Bridge
        ID with lower priority and a different\n   root Bridge MAC address due to
        a single change in the bridged LAN.\n   There are two possible reasons for
        this:\n   1. The bridged LAN to which the port is connected has partitioned\n
        \     into two or more parts due to link failure or otherwise, and the\n      port
        is connected to a part that does not contain the original\n      root bridge.\n
        \  2. The original root bridge has been reconfigured to have a lower\n      priority,
        and a new root has taken over.\n   Both of these scenarios are safe conditions
        that do not require\n   inhibition.\n"
      title: 3.2.1.  Optimization for Change to Lower Priority
    - contents:
      - "3.2.2.  Optimization for Change to Priority Only\n   Assume that the root
        Bridge ID changes due to a single change in the\n   bridged LAN but only the
        explicit priority portion of it changes.\n   This means that the 48-bit MAC
        address portion of the root Bridge ID\n   is unchanged and the root bridge
        has been reconfigured to have a\n   different priority.  Thus, the same bridge
        is root, and a topology\n   change is not indicated.  Thus, it is safe to
        ignore this sort of\n   root Bridge ID change and not invoke the inhibition
        mechanism.\n"
      title: 3.2.2.  Optimization for Change to Priority Only
    - contents:
      - "3.2.3.  Optimizing the Detection of Completed Settling\n   A dangerous case
        is the merger of bridged LANs that had been separate\n   TRILL links in the
        same campus.  In general, these links may have had\n   different Appointed
        Forwarders on them for the same VLAN.  Without\n   inhibition, loops involving
        those VLANs could occur after the merger.\n   Only native frames egressed
        and ingressed by RBridges are a potential\n   problem.  TRILL Data packets
        are either\n   1. individually addressed (TRILL Header M bit = 0) and will
        be\n      ignored if delivered to any incorrect TRILL switch ports or\n   2.
        multicast (TRILL Header M bit = 1), in which case the Reverse Path\n      Forwarding
        Check discards any copies delivered to incorrect TRILL\n      switch ports.\n
        \  Thus, there is no need for inhibition to affect the sending or\n   receiving
        of TRILL Data packets, and inhibition does not do so.\n   However, root bridge
        change inhibition is only needed until TRILL\n   Hellos have been exchanged
        on the merged bridged LAN.  Hellos\n   indicate Appointed Forwarder status
        and, in general, after an\n   exchange of Hellos the new merged bridged LAN
        link will, if\n   necessary, be rendered TRILL loop safe by VLAN inhibition
        so that\n   root bridge change inhibition is no longer needed.\n   TRILL switches
        are required to advertise in their link state the IDs\n   of the root Bridge
        IDs they can see.  If an RBridge port sees a\n   change in root Bridge ID
        from Root1 to Root2, it is safe to terminate\n   root bridge change inhibition
        on that port as soon as Hellos have\n   been received on the port from all
        RBridges that can see Root1 or\n   Root2, except any such RBridge that is
        no longer reachable.\n   In further detail, when a change from Root1 to Root2
        is noticed at a\n   port of RB1, RB1 associates with that port a list of all
        of the\n   reachable RBridges, other than itself, that had reported in their\n
        \  LSPs that they could see either Root1 or Root2.  It then removes from\n
        \  this list any RBridge that becomes unreachable from RB1 or from which\n
        \  it has received a Hello on that port.  If there is a subsequent\n   change
        in root Bridge ID being received before this list is empty,\n   say to Root7,
        then those RBridges reporting in their LSPs that they\n   can see Root7 are
        added to the list.  Root bridge change inhibition\n   can be terminated for
        the port as soon as either the timeout is\n   reached or this list of RBridges
        is empty.\n   If the optimizations described in Sections 3.2.1 and/or 3.2.2
        are in\n   effect at an RBridge port and indicate that no inhibition is needed,\n
        \  then the mechanism described in this section is not needed either.\n"
      title: 3.2.3.  Optimizing the Detection of Completed Settling
    title: 3.2.  Root Bridge Change Inhibition Optimizations
  title: 3.  The Inhibition Mechanism
- contents:
  - "4.  Optional TRILL Hello Reduction\n   If a network manager has sufficient confidence
    that they know the\n   configuration of bridges, ports, and the like, within an
    Ethernet\n   link, they may be able to reduce the number of TRILL Hellos sent
    on\n   that link by sending Hellos in fewer VLANs -- for example, if all\n   TRILL
    switches on the link will see all Hellos without VLAN\n   constraints.  However,
    because adjacencies are established in the\n   Designated VLAN, an RBridge MUST
    always attempt to send Hellos in the\n   Designated VLAN.\n   Hello reduction
    makes TRILL less robust in the face of decreased VLAN\n   connectivity within
    a link, such as partitioned VLANs, VLANs disabled\n   on ports, or disagreement
    over the Designated VLAN; however, as long\n   as all RBridge ports on the link
    are configured for the same\n   Desired Designated VLAN [RFC6325], can see each
    other's frames in\n   that VLAN, and utilize the mechanisms specified below to
    update VLAN\n   inhibition timers, operations will be safe.  (These considerations\n
    \  do not arise on links between RBridges that are configured as\n   point to
    point, since, in that case, each RBridge sends\n   point-to-point Hellos, other
    TRILL IS-IS PDUs, and TRILL Data frames\n   only in what it believes to be the
    Designated VLAN of the link\n   (although it may send them untagged) and no native
    frame end-station\n   service is provided.  Thus, for such links, there is no
    reason to\n   send Hellos in any VLAN other than the Designated VLAN.)\n   The
    provision for a configurable set of \"Announcing VLANs\", as\n   described in
    Section 4.4.3 of [RFC6325], provides a mechanism in the\n   TRILL base protocol
    for a reduction in TRILL Hellos.\n   To maintain loop safety in the face of occasional
    lost frames,\n   RBridge failures, link failures, new RBridges coming up on a
    link,\n   and the like, the inhibition mechanism specified in Section 3 is\n   still
    required.  Strictly following Section 3, a VLAN inhibition\n   timer can only
    be set by the receipt of a Hello sent or received in\n   that VLAN.  Thus, to
    safely send a reduced number of TRILL Hellos on\n   a reduced number of VLANs
    requires additional mechanisms to set the\n   VLAN inhibition timers at an RBridge.
    \ Two such mechanisms, specified\n   below, expand upon the mechanisms provided
    in Section 3.  Support for\n   both of these mechanisms is indicated by a capability
    bit in the\n   PORT-TRILL-VER sub-TLV (Section 5.4 of [RFC7176]).  It may be unsafe\n
    \  for an RBridge to send TRILL Hellos on fewer VLANs than the set of\n   VLANs
    recommended in [RFC6325] on a link unless all its adjacencies\n   on that link
    (excluding those in the Down state [RFC7177]) indicate\n   support of these mechanisms
    and these mechanisms are in use.\n   1. An RBridge RB2 MAY include in any TRILL
    Hello an Appointed\n      Forwarders sub-TLV [RFC7176] appointing itself for one
    or more\n      ranges of VLANs.  The Appointee Nickname field(s) in the\n      self-appointment
    Appointed Forwarders sub-TLV MUST be the same as\n      the Sender Nickname in
    the Special VLANs and Flags sub-TLV in the\n      TRILL Hellos sent by RB2.  This
    indicates that the sending RBridge\n      believes that it is Appointed Forwarder
    for those VLANs.  For each\n      of an RBridge's VLAN inhibition timers for every
    VLAN in the block\n      or blocks listed in the Appointed Forwarders sub-TLV,
    the RBridge\n      sets that timer to either (1) its current value or (2) the
    Holding\n      Time of the Hello containing the sub-TLV, whichever is longer.\n
    \     This is backward compatible.  That is, such sub-TLVs will have no\n      effect
    on any legacy receiving RBridge not implementing this\n      mechanism unless
    RB2, the sending RBridge, is the DRB sending\n      Hellos on the Designated VLAN.
    \ If RB2 is the DRB, it MUST include\n      in the Hello all forwarder appointments,
    if any, for RBridges\n      other than itself on the link.\n   2. An RBridge MAY
    use the VLANs Appointed sub-TLV [RFC7176].  When\n      RB1 receives a VLANs Appointed
    sub-TLV in a TRILL Hello from RB2\n      on any VLAN, RB1 updates the VLAN inhibition
    timers for all the\n      VLANs that RB2 lists in that sub-TLV as VLANs for which
    RB2 is\n      Appointed Forwarder.  Each such timer is updated to (1) its\n      current
    value or (2) the Holding Time of the TRILL Hello\n      containing the VLANs Appointed
    sub-TLV, whichever is longer.  This\n      sub-TLV will be an unknown sub-TLV
    to RBridges not implementing\n      it, and such RBridges will ignore it.  Even
    if a TRILL Hello sent\n      by the DRB on the Designated VLAN includes one or
    more VLANs\n      Appointed sub-TLVs, as long as no Appointed Forwarders sub-TLVs\n
    \     appear, the Hello is not required to indicate all forwarder\n      appointments.\n
    \  Two different encodings are provided above to optimize the listing of\n   VLANs.
    \ Large blocks of contiguous VLANs are more efficiently encoded\n   with the Appointed
    Forwarders sub-TLV, and scattered VLANs are more\n   efficiently encoded with
    the VLANs Appointed sub-TLV.  These\n   encodings may be mixed in the same Hello.
    \ The use of these sub-TLVs\n   does not affect the requirement that the AF bit
    in the Special VLANs\n   and Flags sub-TLV MUST be set if the originating RBridge
    believes\n   that it is Appointed Forwarder for the VLAN in which the Hello\n
    \  is sent.\n   If the above mechanisms are used on a link, then each RBridge
    on the\n   link MUST send Hellos in one or more VLANs with such VLANs Appointed\n
    \  sub-TLV(s) and/or self-appointment Appointed Forwarders sub-TLV(s),\n   and
    the AF bit is appropriately set such that no VLAN inhibition\n   timer will improperly
    expire unless three or more Hellos are lost.\n   For example, an RBridge could
    announce all VLANs for which it\n   believes that it is Appointed Forwarder in
    a Hello sent on the\n   Designated VLAN three times per Holding Time.\n"
  title: 4.  Optional TRILL Hello Reduction
- contents:
  - "5.  Multiple Ports on the Same Link\n   A TRILL switch may have multiple ports
    on the same link.  Some of\n   these ports may be suspended due to MAC address
    duplication, as\n   described in [RFC7177].  Suspended ports never ingress or
    egress\n   native frames.\n   If a TRILL switch has one or more non-suspended
    ports on a link and\n   those ports offer end-station service -- that is, those
    ports are not\n   configured as point-to-point or trunk ports -- then that TRILL
    switch\n   is eligible to be an Appointed Forwarder for that link.  It can\n   become
    Appointed Forwarder in the ways discussed in Section 2.\n   If a TRILL switch
    that is the Appointed Forwarder for VLAN-x on a\n   link has multiple non-suspended
    ports on that link, it may load-share\n   the task of ingressing and egressing
    VLAN-x native frames across\n   those ports however it chooses, as long as there
    is no case in which\n   a frame it egresses onto the link from one port can be
    ingressed on\n   another one of its ports, creating a loop.  If the TRILL switch
    is\n   the Appointed Forwarder for multiple VLANs, a straightforward thing\n   to
    do would be to partition those VLANs among the ports it has on\n   the link.\n"
  title: 5.  Multiple Ports on the Same Link
- contents:
  - "6.  Port-Shutdown Messages\n   A TRILL switch may note that one of its ports
    has failed, or it\n   may be about to shut down that port.  If the port is on
    a link along\n   with ports of other TRILL switches, those TRILL switches will
    not\n   notice the port shutdown or failure using TRILL base protocol\n   mechanisms
    until there is a failure to receive a number of Hellos\n   from that port.  This
    can take many seconds.  Network topology\n   (adjacencies) and forwarder appointments
    can react more rapidly to\n   port shutdown or failure through explicit notification.
    \ As discussed\n   below, this notification SHOULD be provided through the Port-Shutdown\n
    \  message.\n"
  - contents:
    - "6.1.  Planned Shutdown and Hellos\n   A TRILL switch that is shutting down
      one of its ports (say P1) soon\n   SHOULD reduce its Holding Time on that port,
      so that the shutdown\n   will be more rapidly noticed by adjacent RBridges that
      might not\n   support the Port-Shutdown message.\n"
    title: 6.1.  Planned Shutdown and Hellos
  - contents:
    - "6.2.  Port-Shutdown Message Structure\n   The Port-Shutdown message is an RBridge
      Channel message [RFC7178]\n   using RBridge Channel Protocol number 0x006.  The
      payload specific to\n   the Channel Protocol consists of a list of Port IDs
      (see\n   Section 4.4.2 of [RFC6325]) for the port or ports that have failed
      or\n   are being shut down, as shown in the diagram below.  Support for the\n
      \  Port-Shutdown message is advertised by simply advertising support for\n   its
      RBridge Channel Protocol in the RBridge Channel Protocols sub-TLV\n   [RFC7176].\n
      \     0                   1                   2                   3\n      0
      1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   TRILL Header:
      \                    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n                                     |
      V |A|C|M| RESV  |F| Hop Count |\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \    |       Egress Nickname         |       Ingress Nickname        |\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \    |         Special Inner.MacDA = All-Egress-RBridges             |\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \    |  Special Inner.MacDA (cont.)  |         Inner.MacSA           |\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \    |                      Inner.MacSA (cont.)                      |\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \    |    VLAN Tag Ethertype=0x8100  | Priority=7, DEI=0, VLAN ID=1  |\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  RBridge Channel Header:\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \    | RBridge-Chan. Ethertype=0x8946| CHV=0 | Channel Protocol=0x006|\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \    |          Flags        | ERR=0 |\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  Information specific to the Port-Shutdown Channel Protocol:\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \    |    Port ID 1                  |\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \    |    Port ID 2                  |\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \    |   ...\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n     |    Port ID K                  |\n
      \    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n"
    title: 6.2.  Port-Shutdown Message Structure
  - contents:
    - "6.3.  Port-Shutdown Message Transmission\n   For robustness, a TRILL switch
      sends a configurable number of copies\n   of Port-Shutdown messages separated
      by a configurable time interval.\n   The default number of copies is two, although
      this can be configured\n   as one copy or as three copies, and the default interval
      is\n   20 milliseconds (see Section 6.6).  As with any \"adjacency critical\"\n
      \  message, the Port-Shutdown message SHOULD be sent with the highest\n   priority,
      which is priority 7, and SHOULD NOT be marked as\n   \"drop eligible\".\n   If
      a failure of port P1 on RBridge RB2 is detected by RB2, then the\n   Port-Shutdown
      message announcing this failure is sequentially unicast\n   through the rest
      of the TRILL campus to all RBridges (1) with which\n   P1 had an adjacency and
      (2) that are advertising support for the\n   Port-Shutdown RBridge Channel Protocol.\n
      \  If a port shutdown is planned within 1 second, then the TRILL switch\n   ceases
      to send Hellos out of the port being shut down and either\n   (1) sends the
      Port-Shutdown message to RBridge ports on the link\n   advertising support of
      the Port-Shutdown RBridge Channel Protocol or\n   (2) broadcasts the Port-Shutdown
      message announcing this event\n   through the port as follows:\n   -  The Outer.MacDA
      is the All-RBridges multicast address.\n   -  If an outer VLAN tag is present,
      it specifies the Designated VLAN\n      for the link, SHOULD specify priority
      7, and SHOULD NOT specify\n      \"drop eligible\".\n   -  In the TRILL Header,
      the egress nickname is All-RBridges, and the\n      M bit in the TRILL Header
      is set to 0.\n   -  In the RBridge Channel Header, the MH and NA bits are zero.\n
      \  There is no need for a special message to indicate that a port P1 has\n   come
      back up or that a shutdown has been \"canceled\".  This is\n   indicated by
      simply sending Hellos out of port P1.\n"
    title: 6.3.  Port-Shutdown Message Transmission
  - contents:
    - "6.4.  Port-Shutdown Message Reception\n   When a TRILL switch RB1 receives
      a Port-Shutdown message, RB1 checks\n   to see if the ingress nickname specifies
      some TRILL switch RB2 with\n   which RB1 has one or more adjacencies.  If so,
      it drops those\n   adjacencies that are to RB2 ports whose Port IDs are listed
      in the\n   Port-Shutdown message.  There could be more than one if RB2 had\n
      \  multiple ports on the link that are going down.\n   If RB1 is the DRB and
      this eliminates all adjacencies on a link\n   between the DRB and RB2, then,
      for all VLANs whose ingress/egress was\n   being handled by RB2, the DRB either
      starts acting as Appointed\n   Forwarder or appoints some new TRILL switch with
      which it has\n   adjacency as Appointed Forwarder.\n"
    title: 6.4.  Port-Shutdown Message Reception
  - contents:
    - "6.5.  Port-Shutdown Message Security\n   Port-Shutdown messages can be secured
      through the use of the RBridge\n   Channel Header Extension security feature
      [RFC7978].\n"
    title: 6.5.  Port-Shutdown Message Security
  - contents:
    - "6.6.  Port-Shutdown Configuration\n   There are two Port-Shutdown configuration
      parameters, as listed\n   below.  Section 6.3 provides details regarding their
      use.\n      Parameter            Default                 Range\n      ---------------
      \  ----------------   ---------------------\n      PShutdownRepeat     2                 1-3\n
      \     PShutdownDelay     20 milliseconds    0-1,000 milliseconds\n"
    title: 6.6.  Port-Shutdown Configuration
  title: 6.  Port-Shutdown Messages
- contents:
  - "7.  FGL-VLAN Mapping Consistency Checking\n   TRILL switches support 24-bit Fine-Grained
    Labels as specified in\n   [RFC7172].  Basically, a VLAN ID in native traffic
    between an edge\n   TRILL switch and an end station is mapped from/to an FGL as
    an\n   Inner.Label in TRILL Data packets.  Since the Appointed Forwarder for\n
    \  a VLAN will be ingressing and egressing such native traffic, the\n   mapping
    configured at the Appointed Forwarder is the mapping\n   performed.\n   However,
    the Appointed Forwarder for VLAN-x on a link can change for\n   reasons discussed
    elsewhere in this document.  Thus, all\n   TRILL switches on a link that are configured
    with an FGL-VLAN mapping\n   SHOULD be configured with the same mapping.  Otherwise,
    traffic might\n   unpredictably jump from one FGL to another when the Appointed\n
    \  Forwarder changes.  TRILL switches SHOULD advertise their mapping on\n   the
    link using the FGL-VLAN-Bitmap and FGL-VLAN-Pairs APPsub-TLVs\n   (Sections 10.4
    and 10.5) so that consistency checking can be\n   automated.\n   A TRILL switch
    SHOULD compare the FGL-VLAN mappings that it sees\n   advertised by other TRILL
    switches on a link with its own and alert\n   the network operator if they are
    inconsistent.  \"Inconsistent\" means\n   that (1) one TRILL switch maps FGL-z
    to VLAN-x while another maps\n   FGL-z to VLAN-y or (2) one TRILL switch maps
    VLAN-x to FGL-w while\n   another maps VLAN-x to FGL-z, all on the same link.\n
    \  Depending on how the network is being managed, a transient\n   inconsistency
    may not be a problem.  Thus, the network operator\n   SHOULD NOT be alerted unless
    the inconsistency persists for a period\n   of time that defaults to the TRILL
    switch's Holding Time and is\n   configurable to between 0 seconds and 2**16 -
    1 seconds,\n   where 2**16 - 1 is a special value and indicates that such alerts\n
    \  are disabled.\n"
  title: 7.  FGL-VLAN Mapping Consistency Checking
- contents:
  - "8.  Support of E-L1CS\n   All TRILL switches MUST support the E-L1CS flooding
    scope [RFC7356],\n   Extended Level 1 Flooding Scope (E-L1FS) [RFC7780], and base
    LSPs\n   [IS-IS].  It will be apparent to any TRILL switch on a link if any\n
    \  other TRILL switch on the link is a legacy implementation not\n   supporting
    E-L1CS because, as stated in [RFC7780], all TRILL switches\n   MUST include a
    Scope Flooding Support TLV [RFC7356] in all TRILL\n   Hellos they send.  This
    support of E-L1CS increases the amount of\n   information from each TRILL switch
    that can be synchronized on the\n   link, compared with the information capacity
    of Hellos, by several\n   orders of magnitude.\n   For robustness, E-L1CS PDUs
    (FS-LSP fragments, E-L1CS FS-CSNPs\n   (Flooding Scope Complete Sequence Number
    PDUs) [RFC7356], and E-L1CS\n   FS-PSNPs (Flooding Scope Partial Sequence Number
    PDUs) [RFC7356])\n   MUST NOT exceed 1,470 bytes in length; however, any such
    E-L1CS PDU\n   that is received that is longer than 1,470 bytes is processed\n
    \  normally.\n   As with any type of IS-IS LSP, FS-LSPs are identified by the\n
    \  System ID of the originating router (TRILL switch) and the\n   fragment number.
    \ In particular, there is no port identifier in the\n   header of an E-L1CS PDU.
    \ Thus, a TRILL switch RB1 with more than one\n   non-suspended port on a link
    (Section 5) transmitting such a PDU MAY\n   transmit it out of any one or more
    of such ports.  RB1 will generally\n   receive such a PDU that other TRILL switches
    send on all of RB1's\n   ports on the link.  In addition, with multiple ports
    on the link, it\n   will receive any such PDU that it sends on the ports it has
    on the\n   link other than the transmitting port.\n"
  - contents:
    - "8.1.  Backward Compatibility\n   Future TRILL specifications making use of
      E-L1CS MUST specify how\n   situations involving a TRILL link will be handled
      when one or more\n   TRILL switches attached to that link support E-L1CS and
      one or more\n   do not.\n"
    title: 8.1.  Backward Compatibility
  title: 8.  Support of E-L1CS
- contents:
  - "9.  Security Considerations\n   This document provides improved documentation
    of the TRILL Appointed\n   Forwarder mechanism.  It does not change the security
    considerations\n   of the TRILL base protocol as described in Section 6 of [RFC6325].\n
    \  The Port-Shutdown messages specified in Section 6 are sent using the\n   RBridge
    Channel facility [RFC7178].  Such messages SHOULD be secured\n   through the use
    of the RBridge Channel Header Extension [RFC7978].\n   If they are not adequately
    secured, they are a potential\n   denial-of-service vector.\n   The E-L1CS FS-LSPs
    added by Section 8 are a type of IS-IS PDU\n   [RFC7356].  As such, they are securable
    through the addition of\n   Authentication TLVs [RFC5310] in the same way as Hellos
    or other\n   IS-IS PDUs.\n"
  title: 9.  Security Considerations
- contents:
  - "10.  Code Points and Data Structures\n   This section provides IANA considerations
    for this document and\n   specifies the structures of the AppointmentBitmap, AppointmentList,\n
    \  VLAN-FGL Mapping Bit Map, and VLAN-FGL Mapping Pairs APPsub-TLVs.\n   These
    APPsub-TLVs appear within a TRILL GENINFO TLV [RFC7357] in\n   E-L1CS FS-LSPs
    [RFC7356].\n"
  - contents:
    - "10.1.  IANA Considerations\n   IANA has assigned four new APPsub-TLV type codes
      from the range below\n   255 and entered them in the \"TRILL APPsub-TLV Types
      under IS-IS TLV\n   251 Application Identifier 1\" registry as follows:\n      Type
      \  Name                 Reference\n      ----   -----------------    ---------\n
      \     17     AppointmentBitmap    [RFC8139]\n      18     AppointmentList      [RFC8139]\n
      \     19     FGL-VLAN-Bitmap      [RFC8139]\n      20     FGL-VLAN-Pairs       [RFC8139]\n
      \  IANA has assigned a new RBridge Channel Protocol number in the range\n   assigned
      by Standards Action [RFC5226] and updated the \"RBridge\n   Channel Protocols\"
      registry as follows:\n      Protocol  Description     Reference\n      --------
      \ --------------  ---------\n       0x006    Port-Shutdown   [RFC8139]\n   IANA
      has updated the reference for the \"Hello reduction support\" bit\n   in the
      \"PORT-TRILL-VER Sub-TLV Capability Flags\" registry to refer to\n   this document.\n"
    title: 10.1.  IANA Considerations
  - contents:
    - "10.2.  AppointmentBitmap APPsub-TLV\n   The AppointmentBitmap APPsub-TLV provides
      an efficient method for a\n   TRILL switch to indicate which TRILL switches
      it appoints as\n   forwarders for which VLAN IDs when those VLAN IDs are relatively\n
      \  compact (that is, they do not span a large numeric range).  Such an\n   appointment
      is only effective when the appointing TRILL switch is\n   the DRB.\n                              1
      1 1 1 1 1\n          0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5\n         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \        |       Type                    |   (2 bytes)\n         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \        |       Length                  |   (2 bytes)\n         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \        |       Appointee Nickname      |   (2 bytes)\n         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \        | RESV  |   Starting VLAN ID    |   (2 bytes)\n         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \        |  Bit Map ...                      (variable)\n         +-+-+-+-+-+-+-+-...\n
      \  o  Type: APPsub-TLV type, set to AppointmentBitmap sub-TLV 17.\n   o  Length:
      4 + size of bit map in bytes.  If Length is less than 4,\n      the APPsub-TLV
      is corrupt and MUST be ignored.\n   o  Appointee Nickname: The nickname of the
      TRILL switch being\n      appointed as forwarder.\n   o  RESV: 4 bits that MUST
      be sent as zero and ignored on receipt.\n   o  Starting VLAN ID: The smallest
      VLAN ID to which the bits in the\n      Bit Map correspond.\n   o  Bit Map:
      A bit map of the VLANs for which the TRILL switch with\n      Appointee Nickname
      is appointed as the forwarder.  The size of the\n      bit map is length minus
      4.  If the size of the bit map is zero,\n      no appointments are made.\n   Each
      bit in the Bit Map corresponds to a VLAN ID.  Bit 0 is for the\n   VLAN whose
      ID appears in the Starting VLAN ID field.  Bit 1 is for\n   that VLAN ID plus
      1 (treating VLAN IDs as unsigned integers) and\n   so on, with Bit N generally
      being Starting VLAN ID plus N.\n   VLAN 0x000 and VLAN 0xFFF, or any larger
      ID, are invalid and are\n   ignored.\n   If the AppointmentBitmap APPsub-TLV
      is originated by the DRB on a\n   link, it appoints the TRILL switch whose nickname
      appears in the\n   Appointee Nickname field for the VLAN IDs corresponding to
      1 bits in\n   the Bit Map and revokes any Hello appointment of that TRILL switch\n
      \  for VLANs corresponding to 0 bits in the Bit Map.\n"
    title: 10.2.  AppointmentBitmap APPsub-TLV
  - contents:
    - "10.3.  AppointmentList APPsub-TLV\n   The AppointmentList APPsub-TLV provides
      a convenient method for a\n   TRILL switch to indicate which TRILL switches
      it appoints as\n   forwarders for which VLAN IDs.  Such an appointment is only
      effective\n   when the appointing TRILL switch is the DRB.\n                              1
      1 1 1 1 1\n          0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5\n         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \        |       Type                    |   (2 bytes)\n         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \        |       Length                  |   (2 bytes)\n         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \        |       Appointee Nickname      |   (2 bytes)\n         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \        | RESV  |   VLAN ID 1           |   (2 bytes)\n         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \        | RESV  |   VLAN ID 2           |   (2 bytes)\n         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \        |  ...\n         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n         | RESV
      \ |   VLAN ID k           |   (2 bytes)\n         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  o  Type: APPsub-TLV type, set to AppointmentList sub-TLV 18.\n   o  Length:
      2 + 2 * k.  If Length is not an even number, the\n      APPsub-TLV is corrupt
      and MUST be ignored.\n   o  Appointee Nickname: The nickname of the TRILL switch
      being\n      appointed as forwarder.\n   o  RESV: 4 bits that MUST be sent as
      zero and ignored on receipt.\n   o  VLAN ID: A 12-bit VLAN ID for which the
      appointee is being\n      appointed as the forwarder.\n   Type and Length are
      2 bytes, because these are extended FS-LSPs.\n   This APPsub-TLV, when originated
      by the DRB, appoints the TRILL\n   switch with Appointee Nickname to be the
      Appointed Forwarder for the\n   VLAN IDs listed.\n"
    title: 10.3.  AppointmentList APPsub-TLV
  - contents:
    - "10.4.  FGL-VLAN-Bitmap APPsub-TLV\n   The FGL-VLAN-Bitmap APPsub-TLV provides
      a method for a TRILL switch\n   to indicate mappings of FGLs to VLAN IDs that
      it is configured to\n   perform when egressing and ingressing native frames.\n
      \  The coding is efficient when both of the following apply:\n   -  the VLAN
      IDs are compact (that is, they do not span a large\n      numeric range), and\n
      \  -  the FGLs and VLAN IDs are paired in a monotonically increasing\n      fashion.\n
      \                             1 1 1 1 1 1\n          0 1 2 3 4 5 6 7 8 9 0 1
      2 3 4 5\n         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n         |       Type                    |
      \                (2 bytes)\n         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n         |
      \      Length                  |                 (2 bytes)\n         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \        |  RESV |   Starting VLAN ID    |                 (2 bytes)\n         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \        |   Starting FGL                                | (3 bytes)\n         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \        |  Bit Map ...                                   (variable)\n         +-+-+-+-+-+-+-+-...\n
      \  o  Type: APPsub-TLV type, set to VLAN-FGL-Bitmap sub-TLV 19.\n   o  Length:
      5 + size of bit map in bytes.  If Length is less than 5,\n      the APPsub-TLV
      is corrupt and MUST be ignored.\n   o  RESV: 4 bits that MUST be sent as zero
      and ignored on receipt.\n   o  Starting VLAN ID: Initial VLAN ID for the mapping
      information as\n      discussed below.\n   o  Starting FGL: Fine-Grained Label
      [RFC7172].\n   o  Bit Map: Map of bits for VLAN-ID-to-FGL mappings.  The size
      of the\n      bit map is Length minus 5.  If the size of the bit map is zero,\n
      \     no mappings are indicated.\n   Each bit in the Bit Map corresponds to
      a VLAN ID and to an FGL.\n   Bit 0 is for the VLAN whose ID appears in the Starting
      VLAN ID field\n   and the Fine-Grained Label that appears in the FGL field.
      \ Bit 1 is\n   for that VLAN ID plus 1 and that FGL plus 1 (treating VLAN IDs
      and\n   FGLs as unsigned integers) and so on, with Bit N generally being\n   Starting
      VLAN ID plus N and FGL plus N.\n   If a Bit Map bit is a 1, it indicates that
      the advertising TRILL\n   switch will map between the corresponding VLAN ID
      and FGL on\n   ingressing native frames and egressing TRILL Data packets if
      it is\n   Appointed Forwarder for the VLAN.  If a Bit Map bit is a 0, it does\n
      \  not indicate any configured mapping of the VLAN ID to the FGL.\n   However,
      VLAN ID 0x000 and VLAN ID 0xFFF or any larger ID are\n   invalid, and FGLs larger
      than 0xFFFFFF are invalid; any Bit Map bits\n   that correspond to an illegal
      VLAN ID or an illegal FGL are ignored.\n"
    title: 10.4.  FGL-VLAN-Bitmap APPsub-TLV
  - contents:
    - "10.5.  FGL-VLAN-Pairs APPsub-TLV\n   The FGL-VLAN-Pairs APPsub-TLV provides
      a method for a TRILL switch to\n   indicate a list of the mappings of FGLs to
      VLAN IDs that it is\n   configured to perform when egressing and ingressing
      native frames.\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n      |       Type
      \                   |                 (2 bytes)\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \     |       Length                  |                 (2 bytes)\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-=-+-...-+-+-+\n
      \     |   Mapping RECORD 1                            | (5 bytes)\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-=-+-...-+-+-+\n
      \     |   Mapping RECORD 2                            | (5 bytes)\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-=-+-...-+-+-+\n
      \     |      ...\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-=-+-...-+-+-+\n
      \     |   Mapping RECORD k                            | (5 bytes)\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-=-+-...-+-+-+\n
      \     Where a Mapping RECORD has the following structure:\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \     |  RESV |   VLAN ID             |                 (2 bytes)\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \     |       FGL                                     | (3 bytes)\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  o  Type: APPsub-TLV type, set to VLAN-FGL-Pairs sub-TLV 20.\n   o  Length:
      5 * k.  If Length is not a multiple of 5, the APPsub-TLV\n      is corrupt and
      MUST be ignored.\n   o  RESV: 4 bits that MUST be sent as zero and ignored on
      receipt.\n   o  VLAN ID: 12-bit VLAN label.\n   o  FGL: Fine-Grained Label [RFC7172].\n
      \  Each Mapping RECORD indicates that the originating TRILL switch is\n   configured
      to map between the FGL and VLAN given on egressing and\n   ingressing native
      frames.  However, VLAN ID 0x000 and VLAN ID 0xFFF\n   are invalid; any Mapping
      RECORD that corresponds to an illegal\n   VLAN ID is ignored.\n"
    title: 10.5.  FGL-VLAN-Pairs APPsub-TLV
  title: 10.  Code Points and Data Structures
- contents:
  - "11.  Management Considerations\n   This document primarily adds optional enhancements
    or optimizations.\n   The only configuration parameters specified in this document
    are the\n   number and frequency of copies of Port-Shutdown messages sent, as\n
    \  specified in Section 6.6.\n   TRILL switch support of SNMPv3 is provided in
    the TRILL base protocol\n   document [RFC6325].  MIBs have been specified in [RFC6850]
    and\n   [RFC7784], but they do not include the configurable parameters\n   specified
    herein.  It is anticipated that YANG modules will be\n   specified for TRILL.\n"
  title: 11.  Management Considerations
- contents:
  - '12.  References

    '
  - contents:
    - "12.1.  Normative References\n   [802.1Q]   IEEE, \"IEEE Standard for Local
      and metropolitan area\n              networks--Bridges and Bridged Networks\",\n
      \             IEEE Std 802.1Q-2014, DOI 10.1109/ieeestd.2014.6991462,\n              <http://ieeexplore.ieee.org/\n
      \             servlet/opac?punumber=6991460>.\n   [IS-IS]    ISO/IEC 10589:2002,
      Second Edition, \"Intermediate System\n              to Intermediate System
      Intra-Domain Routeing Exchange\n              Protocol for use in Conjunction
      with the Protocol for\n              Providing the Connectionless-mode Network
      Service\n              (ISO 8473)\", November 2002.\n   [RFC2119]  Bradner,
      S., \"Key words for use in RFCs to Indicate\n              Requirement Levels\",
      BCP 14, RFC 2119,\n              DOI 10.17487/RFC2119, March 1997,\n              <http://www.rfc-editor.org/info/rfc2119>.\n
      \  [RFC6325]  Perlman, R., Eastlake 3rd, D., Dutt, D., Gai, S., and A.\n              Ghanwani,
      \"Routing Bridges (RBridges): Base Protocol\n              Specification\",
      RFC 6325, DOI 10.17487/RFC6325, July 2011,\n              <http://www.rfc-editor.org/info/rfc6325>.\n
      \  [RFC6329]  Fedyk, D., Ed., Ashwood-Smith, P., Ed., Allan, D., Bragg,\n              A.,
      and P. Unbehagen, \"IS-IS Extensions Supporting\n              IEEE 802.1aq
      Shortest Path Bridging\", RFC 6329,\n              DOI 10.17487/RFC6329, April
      2012,\n              <http://www.rfc-editor.org/info/rfc6329>.\n   [RFC7172]
      \ Eastlake 3rd, D., Zhang, M., Agarwal, P., Perlman, R., and\n              D.
      Dutt, \"Transparent Interconnection of Lots of Links\n              (TRILL):
      Fine-Grained Labeling\", RFC 7172,\n              DOI 10.17487/RFC7172, May
      2014,\n              <http://www.rfc-editor.org/info/rfc7172>.\n   [RFC7176]
      \ Eastlake 3rd, D., Senevirathne, T., Ghanwani, A., Dutt,\n              D.,
      and A. Banerjee, \"Transparent Interconnection of Lots\n              of Links
      (TRILL) Use of IS-IS\", RFC 7176,\n              DOI 10.17487/RFC7176, May 2014,\n
      \             <http://www.rfc-editor.org/info/rfc7176>.\n   [RFC7177]  Eastlake
      3rd, D., Perlman, R., Ghanwani, A., Yang, H., and\n              V. Manral,
      \"Transparent Interconnection of Lots of Links\n              (TRILL): Adjacency\",
      RFC 7177, DOI 10.17487/RFC7177,\n              May 2014, <http://www.rfc-editor.org/info/rfc7177>.\n
      \  [RFC7178]  Eastlake 3rd, D., Manral, V., Li, Y., Aldrin, S., and D.\n              Ward,
      \"Transparent Interconnection of Lots of Links\n              (TRILL): RBridge
      Channel Support\", RFC 7178,\n              DOI 10.17487/RFC7178, May 2014,\n
      \             <http://www.rfc-editor.org/info/rfc7178>.\n   [RFC7356]  Ginsberg,
      L., Previdi, S., and Y. Yang, \"IS-IS Flooding\n              Scope Link State
      PDUs (LSPs)\", RFC 7356,\n              DOI 10.17487/RFC7356, September 2014,\n
      \             <http://www.rfc-editor.org/info/rfc7356>.\n   [RFC7357]  Zhai,
      H., Hu, F., Perlman, R., Eastlake 3rd, D., and O.\n              Stokes, \"Transparent
      Interconnection of Lots of Links\n              (TRILL): End Station Address
      Distribution Information\n              (ESADI) Protocol\", RFC 7357, DOI 10.17487/RFC7357,\n
      \             September 2014, <http://www.rfc-editor.org/info/rfc7357>.\n   [RFC7780]
      \ Eastlake 3rd, D., Zhang, M., Perlman, R., Banerjee, A.,\n              Ghanwani,
      A., and S. Gupta, \"Transparent Interconnection\n              of Lots of Links
      (TRILL): Clarifications, Corrections, and\n              Updates\", RFC 7780,
      DOI 10.17487/RFC7780, February 2016,\n              <http://www.rfc-editor.org/info/rfc7780>.\n
      \  [RFC7978]  Eastlake 3rd, D., Umair, M., and Y. Li, \"Transparent\n              Interconnection
      of Lots of Links (TRILL): RBridge Channel\n              Header Extension\",
      RFC 7978, DOI 10.17487/RFC7978,\n              September 2016, <http://www.rfc-editor.org/info/rfc7978>.\n
      \  [RFC7981]  Ginsberg, L., Previdi, S., and M. Chen, \"IS-IS Extensions\n              for
      Advertising Router Information\", RFC 7981,\n              DOI 10.17487/RFC7981,
      October 2016,\n              <http://www.rfc-editor.org/info/rfc7981>.\n   [RFC8174]
      \ Leiba, B., \"Ambiguity of Uppercase vs Lowercase in\n              RFC 2119
      Key Words\", BCP 14, RFC 8174,\n              DOI 10.17487/RFC8174, May 2017,\n
      \             <http://www.rfc-editor.org/info/rfc8174>.\n"
    title: 12.1.  Normative References
  - contents:
    - "12.2.  Informative References\n   [RFC5226]  Narten, T. and H. Alvestrand,
      \"Guidelines for Writing an\n              IANA Considerations Section in RFCs\",
      BCP 26, RFC 5226,\n              DOI 10.17487/RFC5226, May 2008,\n              <http://www.rfc-editor.org/info/rfc5226>.\n
      \  [RFC5310]  Bhatia, M., Manral, V., Li, T., Atkinson, R., White, R.,\n              and
      M. Fanto, \"IS-IS Generic Cryptographic\n              Authentication\", RFC
      5310, DOI 10.17487/RFC5310,\n              February 2009, <http://www.rfc-editor.org/info/rfc5310>.\n
      \  [RFC6439]  Perlman, R., Eastlake, D., Li, Y., Banerjee, A., and F.\n              Hu,
      \"Routing Bridges (RBridges): Appointed Forwarders\",\n              RFC 6439,
      DOI 10.17487/RFC6439, November 2011,\n              <http://www.rfc-editor.org/info/rfc6439>.\n
      \  [RFC6850]  Rijhsinghani, A. and K. Zebrose, \"Definitions of Managed\n              Objects
      for Routing Bridges (RBridges)\", RFC 6850,\n              DOI 10.17487/RFC6850,
      January 2013,\n              <http://www.rfc-editor.org/info/rfc6850>.\n   [RFC7379]
      \ Li, Y., Hao, W., Perlman, R., Hudson, J., and H. Zhai,\n              \"Problem
      Statement and Goals for Active-Active Connection\n              at the Transparent
      Interconnection of Lots of Links\n              (TRILL) Edge\", RFC 7379, DOI
      10.17487/RFC7379,\n              October 2014, <http://www.rfc-editor.org/info/rfc7379>.\n
      \  [RFC7784]  Kumar, D., Salam, S., and T. Senevirathne, \"Transparent\n              Interconnection
      of Lots of Links (TRILL) Operations,\n              Administration, and Maintenance
      (OAM) MIB\", RFC 7784,\n              DOI 10.17487/RFC7784, February 2016,\n
      \             <http://www.rfc-editor.org/info/rfc7784>.\n"
    title: 12.2.  Informative References
  title: 12.  References
- contents:
  - "Appendix A.  VLAN Inhibition Example\n   The per-VLAN inhibition timers (or the
    equivalent) are needed to be\n   loop safe in the case of misconfigured bridges
    on a link.\n   For a simple example, assume that RB1 and RB2 are the only RBridges\n
    \  on the link, that RB1 is higher priority to be the DRB, and that they\n   both
    want VLAN 1 (the default) to be the Designated VLAN.  However,\n   there is a
    bridge between them configured so that RB1 can see all the\n   frames sent by
    RB2 but none of the frames from RB1 can get through\n   to RB2.\n   Both will
    think they are the DRB: RB1 because it is higher priority\n   even though it sees
    the Hellos from RB2, and RB2 because it doesn't\n   see the Hellos from RB1 and
    therefore thinks it is highest priority.\n   Say RB1 chooses to act as Appointed
    Forwarder for VLANs 2 and 3 while\n   RB2 chooses to act as Appointed Forwarder
    for VLANs 3 and 4.  There\n   is no problem with VLANs 2 and 4, but if you do
    not do something\n   about it, you could have a loop involving VLAN 3.  RB1 will
    see the\n   Hellos that RB2 issues on VLAN 3 declaring itself Appointed\n   Forwarder,
    so RB1 will be inhibited on VLAN 3.  RB2 does not see the\n   Hellos issued by
    RB1 on VLAN 3, so RB2 will become uninhibited and\n   will handle VLAN 3 native
    traffic.\n   However, this situation may change.  RB2 might crash, the bridge\n
    \  might crash, RB2 might be reconfigured so it no longer tried to act\n   as
    Appointed Forwarder for VLAN 3, or other issues may occur.  So,\n   RB1 has to
    maintain a VLAN 3 inhibition timer, and if it sees\n   no Hellos from any other
    RBridge on the link claiming to be Appointed\n   Forwarder for VLAN 3 for a long
    enough time, then RB1 becomes\n   uninhibited for that VLAN on the port in question
    and can handle\n   end-station traffic in VLAN 3.\n"
  title: Appendix A.  VLAN Inhibition Example
- contents:
  - "Appendix B.  Multi-Link VLAN Mapping Loop Example\n   Assume that RBridges RB1
    and RB2 have ports P1 and P2, respectively,\n   that are both on Link L1 and that
    RBridges RB3 and RB4 have ports P3\n   and P4, respectively, that are both on
    Link L2.  Assume further that\n   P1 and P3 are Appointed Forwarders for VLAN-x
    and P2 and P4 are\n   Appointed Forwarders for VLAN-y.  This situation is shown
    in the\n   figure below.\n          + - - - - - - - - - - - - - - - - - - - -
    - +\n          |                                           |\n          |                TRILL
    network              |\n          |                                           |\n
    \         |  +---+   +---+             +---+   +---+  |\n          + -|RB1|- -|RB2|-
    - - - - - -|RB3|- -|RB4|- +\n             +---+   +---+             +---+   +---+\n
    \           P1|       P2|             P3|       P4|\n              |         |
    \              |         |\n              |x        |y              |x        |y\n
    \             |   +-+   |               |   +-+   |\n        L1 ---+---|M|---+--+---
    \  L2 ---+---|M|---+---\n                  +-+      |                +-+\n                         +---+\n
    \                        |ES1|\n                         +---+\n   Further assume
    that L1 and L2 are each bridged LANs that include a\n   device M, presumably a
    bridge, that maps VLAN-x into VLAN-y and\n   VLAN-y into VLAN-x.\n   If end station
    ES1 originated a broadcast or other multi-destination\n   frame in VLAN-y, it
    would be ingressed by RB2.  (The frame would also\n   be mapped to VLAN-x and
    ingressed by RB1, but we initially ignore\n   that.)  RB2 will flood the resulting
    TRILL Data packet through the\n   campus, and, at least in the broadcast and unknown
    unicast cases,\n   it will get to RB4, where it will be egressed to L2.  Inside
    L2, this\n   broadcast frame is mapped to VLAN-x and then ingressed by RB3.  RB3\n
    \  then floods the resulting TRILL Data packet through the campus, this\n   time
    with an Inner.VLAN of VLAN-x, as a result of which it will be\n   egressed by
    RB1 into L1.  Inside L1, it will be mapped back to VLAN-y\n   and then ingressed
    by RB2, completing the loop.  The packet will loop\n   indefinitely, because in
    native form on L1 and L2 it has no TRILL\n   Hop Count, and an indefinitely large
    number of copies will be\n   delivered to ES1 and any other end station so situated.
    \ The same\n   problem would occur even if P1 and P2 were on the same RBridge
    and/or\n   P3 and P4 were on the same RBridge.  Actually, because the original\n
    \  frame was also mapped to VLAN-x inside L1 and ingressed by RB1, there\n   are
    two copies looping around in opposite directions.\n   The use of Fine-Grained
    Labels [RFC7172] complicates but does not\n   essentially change the potential
    problem.\n   This example shows why VLAN mapping between Appointed Forwarder ports\n
    \  on a TRILL link is loop unsafe.  When such a situation is detected,\n   the
    DRB on the link changes Appointed Forwarders as necessary to\n   assure that a
    single RBridge port is Appointed Forwarder for all\n   VLANs involved in mapping.
    \ This change makes the situation\n   loop safe.\n"
  title: Appendix B.  Multi-Link VLAN Mapping Loop Example
- contents:
  - "Appendix C.  Changes to RFCs 6325, 6439, and 7177\n   This document updates [RFC6325],
    obsoletes [RFC6439], and updates\n   [RFC7177].\n   The change to [RFC6325], the
    TRILL base protocol, is as follows:\n      Addition of mandatory support for E-L1CS
    FS-LSPs.\n   Changes to [RFC6439], which this document obsoletes, are as follows:\n
    \  1. Specification of APPsub-TLVs and procedures to be used in\n      E-L1CS
    FS-LSP forwarder appointments.\n   2. Incorporation of updates to [RFC6439] that
    appeared in Section 10\n      of RFC 7180, which has been obsoleted by [RFC7780].
    \ They appear\n      primarily in Section 4 of this document.\n   3. Addition
    of an optional FGL-VLAN consistency check feature,\n      including specification
    of APPsub-TLVs.\n   4. Deletion of references to the October 2011 version of the
    document\n      \"RBridges: Campus VLAN and Priority Regions\"\n      (draft-ietf-trill-rbridge-vlan-mapping),
    which has been dropped by\n      the TRILL WG.\n   5. Addition of the Port-Shutdown
    message.\n   6. Elimination of the requirement that the DRB not send appointments\n
    \     in Hellos until its DRB inhibition timer has expired.  This was an\n      unnecessary
    safety precaution that is pointless, given that\n      appointments in E-L1CS
    FS-LSPs are immediately visible.\n   7. Addition of three optional methods (Section
    3.2) to optimize\n      (reduce) inhibition time under various circumstances.\n
    \  8. Editorial changes.\n   Changes to [RFC7177] are as follows:\n      As provided
    in Section 6, TRILL switches SHOULD treat the\n      reception of a Port-Shutdown
    RBridge Channel message from RB1\n      listing port P1 as if it were an event
    A3 as specified in\n      [RFC7177], resulting in transition of any adjacency
    to P1 to the\n      Detect state.\n"
  title: Appendix C.  Changes to RFCs 6325, 6439, and 7177
- contents:
  - "Acknowledgments\n   The following are hereby thanked for their contributions
    to this\n   document:\n      Spencer Dawkins, Shawn M. Emery, Stephen Farrell,
    Joel Halpern,\n      Sue Hares, Christer Holmberg, Gayle Noble, Alvaro Retana,
    Dan\n      Romascanu, and Mingui Zhang.\n   The following are thanked for their
    contributions to [RFC6439], the\n   predecessor to this document:\n      Ron Bonica,
    Stewart Bryant, Linda Dunbar, Les Ginsberg, Erik\n      Nordmark, Dan Romascanu,
    and Mike Shand.\n      We also thank Radia Perlman, who coauthored [RFC6439].\n"
  title: Acknowledgments
- contents:
  - "Authors' Addresses\n   Donald Eastlake 3rd\n   Huawei Technologies\n   155 Beaver
    Street\n   Milford, MA  01757\n   United States of America\n   Phone: +1-508-333-2270\n
    \  Email: d3e3e3@gmail.com\n   Yizhou Li\n   Huawei Technologies\n   101 Software
    Avenue\n   Nanjing  210012\n   China\n   Phone: +86-25-56622310\n   Email: liyizhou@huawei.com\n
    \  Mohammed Umair\n   IP Infusion\n   Email: mohammed.umair2@ipinfusion.com\n
    \  Ayan Banerjee\n   Cisco Systems\n   170 West Tasman Drive\n   San Jose, CA
    \ 95134\n   United States of America\n   Phone: +1-408-333-7149\n   Email: ayabaner@cisco.com\n
    \  Fangwei Hu\n   ZTE Corporation\n   889 Bibo Road\n   Shanghai  201203\n   China\n
    \  Phone: +86-21-68896273\n   Email: hu.fangwei@zte.com.cn\n"
  title: Authors' Addresses
