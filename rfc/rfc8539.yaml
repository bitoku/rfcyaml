- title: __initial_text__
  contents:
  - '             Softwire Provisioning Using DHCPv4 over DHCPv6

    '
- title: Abstract
  contents:
  - "Abstract\n   DHCPv4 over DHCPv6 (RFC 7341) is a mechanism for dynamically\n \
    \  configuring IPv4 for use as an over-the-top service in an IPv6-only\n   network.\
    \  Softwires are an example of such a service.  For DHCPv4\n   over DHCPv6 (DHCP\
    \ 4o6) to function with some IPv4-over-IPv6 softwire\n   mechanisms and deployment\
    \ scenarios (e.g., RFC 7596 or RFC 7597), the\n   operator needs to know the IPv6\
    \ address that the client will use as\n   the source of an IPv4-in-IPv6 softwire\
    \ tunnel.  This address, in\n   conjunction with the client's IPv4 address, and\
    \ (in some deployments)\n   the Port Set ID are used to create a binding table\
    \ entry in the\n   operator's softwire tunnel concentrator.  This memo defines\
    \ a DHCPv6\n   option to convey IPv6 parameters for establishing the softwire\
    \ tunnel\n   and a DHCPv4 option (to be used only with DHCP 4o6) to communicate\n\
    \   the source tunnel IPv6 address between the DHCP 4o6 client and\n   server.\
    \  It is designed to work in conjunction with the IPv4 address\n   allocation\
    \ process.\n   \"DHCPv6 Options for Configuration of Softwire Address and Port-Mapped\n\
    \   Clients\" (RFC 7598) describes a deterministic DHCPv6-based mechanism\n  \
    \ for provisioning softwires.  This document updates RFC 7598, allowing\n   OPTION_S46_BR\
    \ (90) to be enumerated in the DHCPv6 client's Option\n   Request Option (ORO)\
    \ request and to appear directly within subsequent\n   messages sent by the DHCPv6\
    \ server.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This\
    \ document is a product of the Internet Engineering Task Force\n   (IETF).  It\
    \ represents the consensus of the IETF community.  It has\n   received public\
    \ review and has been approved for publication by the\n   Internet Engineering\
    \ Steering Group (IESG).  Further information on\n   Internet Standards is available\
    \ in Section 2 of RFC 7841.\n   Information about the current status of this document,\
    \ any errata,\n   and how to provide feedback on it may be obtained at\n   https://www.rfc-editor.org/info/rfc8539.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2019 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (https://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.  Code Components\
    \ extracted from this document must\n   include Simplified BSD License text as\
    \ described in Section 4.e of\n   the Trust Legal Provisions and are provided\
    \ without warranty as\n   described in the Simplified BSD License.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1.  Introduction  . . . . . . . . . . . . . . . . . . .\
    \ . . . . .   3\n   2.  Applicability . . . . . . . . . . . . . . . . . . . .\
    \ . . . .   4\n   3.  Requirements Language . . . . . . . . . . . . . . . . .\
    \ . . .   4\n   4.  Solution Overview . . . . . . . . . . . . . . . . . . . .\
    \ . .   5\n     4.1.  Updating RFC 7598 to Permit the Reuse of\n           OPTION_S46_BR\
    \ (90)  . . . . . . . . . . . . . . . . . . .   5\n   5.  DHCP 4o6 IPv6/IPv4 Binding\
    \ Message Flow . . . . . . . . . . .   6\n   6.  DHCP Options  . . . . . . . .\
    \ . . . . . . . . . . . . . . . .   7\n     6.1.  DHCPv6 Softwire Source Binding\
    \ Prefix Hint Option . . . .   7\n     6.2.  DHCP 4o6 Softwire Source Address\
    \ Option . . . . . . . . .   8\n   7.  Client Behavior . . . . . . . . . . . .\
    \ . . . . . . . . . . .   9\n     7.1.  Client Initialization . . . . . . . .\
    \ . . . . . . . . . .   9\n     7.2.  Renewing or Rebinding the IPv4 Address Lease\
    \ and\n           Softwire Source Address . . . . . . . . . . . . . . . . .  10\n\
    \       7.2.1.  Changing the Bound IPv6 Softwire Source Address . . .  10\n  \
    \   7.3.  Releasing the IPv4 Address Lease and Softwire\n           Source Address\
    \  . . . . . . . . . . . . . . . . . . . . .  11\n     7.4.  OPTION_S46_BIND_IPV6_PREFIX\
    \ Validation Behavior . . . . .  11\n     7.5.  Client and Server Softwire Source\
    \ Address Mismatch  . . .  11\n     7.6.  Use with Dynamic, Shared IPv4 Addresses\
    \ . . . . . . . . .  12\n   8.  Server Behavior . . . . . . . . . . . . . . .\
    \ . . . . . . . .  12\n     8.1.  Changing the Bound IPv6 Source Address  . .\
    \ . . . . . . .  12\n     8.2.  Handling Conflicts between Clients' Bound IPv6\
    \ Source\n           Addresses . . . . . . . . . . . . . . . . . . . . . . . .\
    \  12\n   9.  Security Considerations . . . . . . . . . . . . . . . . . . .  13\n\
    \     9.1.  Client Privacy Considerations . . . . . . . . . . . . . .  14\n  \
    \ 10. IANA Considerations . . . . . . . . . . . . . . . . . . . . .  15\n   11.\
    \ References  . . . . . . . . . . . . . . . . . . . . . . . . .  16\n     11.1.\
    \  Normative References . . . . . . . . . . . . . . . . . .  16\n     11.2.  Informative\
    \ References . . . . . . . . . . . . . . . . .  17\n   Acknowledgements  . . .\
    \ . . . . . . . . . . . . . . . . . . . . .  17\n   Authors' Addresses  . . .\
    \ . . . . . . . . . . . . . . . . . . . .  18\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   Deterministic IPv4-over-IPv6 transition technologies require\
    \ that\n   elements be preconfigured with binding rules for routing traffic to\n\
    \   clients.  This places a constraint on the choice of address used as\n   the\
    \ client's softwire source address: it must use a predetermined\n   prefix, which\
    \ is usually configured on the home gateway device.\n   [RFC7598] describes a\
    \ DHCPv6-based mechanism for provisioning such\n   deterministic softwires.\n\
    \   A dynamic provisioning model, such as using DHCPv4 over DHCPv6 (DHCP\n   4o6)\
    \ [RFC7341], allows much more flexibility in the location of the\n   IPv4-over-IPv6\
    \ softwire source address.  In this model, the IPv6\n   address is dynamically\
    \ communicated back to the service provider,\n   allowing the corresponding softwire\
    \ configuration to be created in\n   the border relay (BR).\n   The DHCP 4o6 client\
    \ and softwire client could be run on end devices\n   attached to a network segment\
    \ using any routable IPv6 prefix\n   allocated to an end user, located anywhere\
    \ within an arbitrary home\n   network topology.  Dynamic allocation also helps\
    \ to optimize IPv4\n   resource usage, because only clients that are actively\
    \ renewing their\n   IPv4 lease hold on to the address.\n   This document describes\
    \ a mechanism for dynamically provisioning\n   softwires created using DHCP 4o6,\
    \ including provisioning the client\n   with the address of the softwire BR and\
    \ informing the service\n   provider of a client's binding between the dynamically\
    \ allocated IPv4\n   address and Port Set ID and the IPv6 address that the softwire\n\
    \   initiator will use for accessing IPv4-over-IPv6 services.\n   The mechanism\
    \ operates alongside the DHCP 4o6 message flows to\n   communicate the binding\
    \ information over the IPv6-only network.  The\n   DHCP 4o6 server provides a\
    \ single point in the network that holds the\n   current client binding information.\
    \  The service provider can then\n   use this binding information to provision\
    \ other functional elements,\n   such as the BR(s).\n"
- title: 2.  Applicability
  contents:
  - "2.  Applicability\n   The mechanism described in this document is only suitable\
    \ for use for\n   provisioning softwire clients via DHCP 4o6.  The options described\n\
    \   here are only applicable within the DHCP 4o6 message-exchange\n   process.\
    \  Current softwire technologies suitable for extending to\n   incorporate DHCP\
    \ 4o6 with dynamic IPv4 address leasing include\n   [RFC7597] and [RFC7596].\n"
- title: 3.  Requirements Language
  contents:
  - "3.  Requirements Language\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\"\
    , \"SHALL\", \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"\
    NOT RECOMMENDED\", \"MAY\", and\n   \"OPTIONAL\" in this document are to be interpreted\
    \ as described in\n   BCP 14 [RFC2119] [RFC8174] when, and only when, they appear\
    \ in all\n   capitals, as shown here.\n"
- title: 4.  Solution Overview
  contents:
  - "4.  Solution Overview\n   In order to provision a softwire, both IPv6 and IPv4\
    \ configurations\n   need to be passed to the client.  To map this to the DHCP\
    \ 4o6\n   configuration process, the IPv6 configuration is carried in DHCPv6\n\
    \   options [RFC8415], carried inside the DHCPv6 message DHCPV4-RESPONSE\n   (21)\
    \ sent by the server.  OPTION_S46_BR (90) is used to provision the\n   remote\
    \ IPv6 address for the softwire BR (see Section 4.1).\n   OPTION_S46_BIND_IPV6_PREFIX\
    \ (137) is optionally sent by the DHCP 4o6\n   server to indicate to the client\
    \ a preferred IPv6 prefix for binding\n   the received IPv4 configuration and\
    \ sourcing tunnel traffic.  This\n   may be necessary if there are multiple IPv6\
    \ prefixes in use in the\n   customer network (e.g., Unique Local Addresses (ULAs))\
    \ or if the\n   specific IPv4-over-IPv6 transition mechanism requires the use\
    \ of a\n   particular prefix for any reason.\n   IPv4 configuration is carried\
    \ in DHCPv4 messages [RFC2131] (inside\n   the DHCP 4o6 option OPTION_DHCPV4_MSG\
    \ (87)) using the mechanism\n   described in [RFC7341].\n   In order for the client\
    \ to communicate the softwire source address, a\n   new DHCPv4 option OPTION_DHCP4O6_S46_SADDR\
    \ (109) is defined in this\n   document.  This is included in DHCPREQUEST messages\
    \ sent by the\n   client and is stored by the server for the lifetime of the IPv4\n\
    \   address lease.\n"
- title: 4.1.  Updating RFC 7598 to Permit the Reuse of OPTION_S46_BR (90)
  contents:
  - "4.1.  Updating RFC 7598 to Permit the Reuse of OPTION_S46_BR (90)\n   Section\
    \ 4.2 of [RFC7598] defines option OPTION_S46_BR (90) for\n   communicating remote\
    \ softwire BR IPv6 address(es) to a client, but it\n   mandates that the option\
    \ can only be used when encapsulated within\n   one of the softwire container\
    \ options: OPTION_S46_CONT_MAPE (94) or\n   OPTION_S46_CONT_LW (96).  From Section\
    \ 3 of [RFC7598]:\n      Softwire46 DHCPv6 clients that receive provisioning options\
    \ that\n      are not encapsulated in container options MUST silently ignore\n\
    \      these options.\n   This document updates [RFC7598], removing this restriction\
    \ for\n   OPTION_S46_BR (90), allowing it to be enumerated in the client's ORO\n\
    \   request and appear directly within subsequent messages sent by the\n   DHCPv6\
    \ server.\n"
- title: 5.  DHCP 4o6 IPv6/IPv4 Binding Message Flow
  contents:
  - "5.  DHCP 4o6 IPv6/IPv4 Binding Message Flow\n   Figure 1 shows the relevant extensions\
    \ to the successful DHCP 4o6\n   IPv4 allocation client/server message flow for\
    \ the softwire source\n   address function.  The full process, including error\
    \ handling, is\n   described in Section 7.\n   In each step, the DHCPv6 portion\
    \ of the message and any relevant\n   option is shown above the arrow.  The DHCP\
    \ 4o6 content of the message\n   and its relevant options are below the arrow.\
    \  All the DHCPv4\n   messages are encapsulated in DHCPV4-QUERY (20) or DHCPV4-RESPONSE\n\
    \   (21) messages.  Where relevant, the necessary options and their\n   contents\
    \ are shown.\n        DHCP 4o6                                              DHCP\
    \ 4o6\n         Client                                                Server\n\
    \           |                                                      |\n       \
    \    |       DHCPv6 - DHCPV4-QUERY message containing       |\n           |  \
    \         OPTION_ORO (6) listing (90, 137)           |\n    Step 1 |----------------------------------------------------->|\n\
    \           |            DHCPv4 - DHCPDISCOVER message             |\n       \
    \    |                                                      |\n           |  \
    \                                                    |\n           |     DHCPv6\
    \ - DHCPV4-RESPONSE message containing      |\n           | OPTION_S46_BR(90),\
    \ OPTION_S46_BIND_IPV6_PREFIX(137)  |\n           |     (bind-ipv6-prefix with\
    \ service provider's        |\n           |                  preferred prefix)\
    \                   |\n    Step 2 |<-----------------------------------------------------|\n\
    \           |              DHCPv4 - DHCPOFFER message              |\n       \
    \    |         containing an available IPv4 address         |\n           |  \
    \                                                    |\n           |         \
    \    DHCPv6 - DHCPV4-QUERY message            |\n    Step 3 |----------------------------------------------------->|\n\
    \           |     DHCPv4 - DHCPREQUEST message containing the      |\n       \
    \    | requested IPv4 address and OPTION_DHCP4O6_S46_SADDR  |\n           |  \
    \ (softwire-ipv6-src-address with client's bound     |\n           |         \
    \   IPv6 softwire source address)             |\n           |                \
    \                                      |\n           |                       \
    \                               |\n           |           DHCPv6 - DHCPV4-RESPONSE\
    \ message           |\n    Step 4 |<-----------------------------------------------------|\n\
    \           |          DHCPv4 - DHCPACK message containing         |\n       \
    \    | the leased IPv4 address and OPTION_DHCP4O6_S46_SADDR |\n           |  \
    \  (softwire-ipv6-src-address with client's bound    |\n           |         \
    \     IPv6 softwire source address)           |\n           |                \
    \                                      |\n                 Figure 1: IPv6/IPv4\
    \ Binding Message Flow\n   Step 1  The client constructs a DHCPv6 \"DHCPV4-QUERY\
    \ (20)\" message.\n           This message contains two options: DHCPv6 OPTION_ORO\
    \ (6) and\n           OPTION_DHCPV4_MSG (87).  OPTION_ORO lists \"90\"\n     \
    \      (OPTION_S46_BR) and \"137\" (OPTION_S46_BIND_IPV6_PREFIX).\n          \
    \ OPTION_DHCPV4_MSG contains a DHCPv4 DHCPDISCOVER message.\n   Step 2  The server\
    \ responds with a DHCPv6 \"DHCPV4-RESPONSE (21)\"\n           message.  This message\
    \ contains an OPTION_S46_BR (90)\n           containing the IPv6 address of the\
    \ BR for the client's\n           softwire configuration.  The message may also\
    \ optionally\n           contain OPTION_S46_BIND_IPV6_PREFIX (137).  OPTION_DHCPV4_MSG\n\
    \           contains a DHCPv4 DHCPOFFER message.  The DHCPv4 message\n       \
    \    contains an available IPv4 address.\n   Step 3  The client sends a DHCPv6\
    \ \"DHCPV4-QUERY (20)\" message\n           containing a DHCPv4 DHCPREQUEST message\
    \ with the requested\n           IPv4 address and OPTION_DHCP4O6_S46_SADDR (109)\
    \ with the IPv6\n           address that the client will use as its softwire source\n\
    \           address.\n   Step 4  The server sends a DHCPv6 \"DHCPV4-RESPONSE (21)\"\
    \ message.\n           OPTION_DHCPV4_MSG contains a DHCPv4 DHCPACK message with\
    \ the\n           allocated IPv4 address.  OPTION_DHCP4O6_S46_SADDR with the\n\
    \           client's bound softwire source address is included.\n"
- title: 6.  DHCP Options
  contents:
  - '6.  DHCP Options

    '
- title: 6.1.  DHCPv6 Softwire Source Binding Prefix Hint Option
  contents:
  - "6.1.  DHCPv6 Softwire Source Binding Prefix Hint Option\n   The format of the\
    \ DHCPv6 source binding prefix hint option is as\n   follows:\n      0       \
    \            1                   2                   3\n      0 1 2 3 4 5 6 7\
    \ 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \     |  OPTION_S46_BIND_IPV6_PREFIX  |         option-length         |\n    \
    \ +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n     |bindprefix6-len|\
    \                                               |\n     +-+-+-+-+-+-+-+-+    \
    \         bind-ipv6-prefix                  .\n     .                        \
    \    (variable length)                  .\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \              Figure 2: Format of OPTION_S46_BIND_IPV6_PREFIX\n   o  option-code:\
    \ OPTION_S46_BIND_IPV6_PREFIX (137)\n   o  option-length: 1 + length of bind-ipv6-prefix,\
    \ specified in bytes.\n   o  bindprefix6-len: 8-bit field expressing the bit mask\
    \ length of the\n      IPv6 prefix specified in bind-ipv6-prefix.  Valid values\
    \ are 0 to\n      128.\n   o  bind-ipv6-prefix: The IPv6 prefix indicating the\
    \ preferred prefix\n      for the client to bind the received IPv4 configuration\
    \ to.  The\n      length is (bindprefix6-len + 7) / 8.  The field is padded on\
    \ the\n      right with zero bits up to the next octet boundary when\n      bind-ipv6-prefix\
    \ is not evenly divisible by 8.  These padding bits\n      are ignored by the\
    \ receiver (see Section 7.4).\n   OPTION_S46_BIND_IPV6_PREFIX is a singleton.\
    \  Servers MUST NOT send\n   more than one instance of the OPTION_S46_BIND_IPV6_PREFIX\
    \ option.\n"
- title: 6.2.  DHCP 4o6 Softwire Source Address Option
  contents:
  - "6.2.  DHCP 4o6 Softwire Source Address Option\n   The format of the DHCPv4 over\
    \ DHCPv6 softwire source address option\n   is as follows:\n              0  \
    \                           1\n              0  1  2  3  4  5  6  7  8  9  0 \
    \ 1  2  3  4  5\n             +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+\n\
    \             |      option-code      |     option-length     |\n            \
    \ +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+\n             +          \
    \ softwire-ipv6-src-address           +\n             .                  (128\
    \ bits)                   .\n             +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+\n\
    \               Figure 3: Format of OPTION_DHCP4O6_S46_SADDR\n   o  option-code:\
    \ OPTION_DHCP4O6_S46_SADDR (109)\n   o  option-length: 16.\n   o  softwire-ipv6-src-address:\
    \ 16 bytes long; the IPv6 address that is\n      associated (either being requested\
    \ for binding or currently bound)\n      with the client's IPv4 configuration.\n\
    \   Note: The function of OPTION_DHCP4O6_S46_SADDR may seem similar to\n   the\
    \ DHCPv4 message's \"chaddr\" field or the Client Identifier (61)\n   option in\
    \ that it provides a unique lower-layer address that the\n   server can use for\
    \ identifying the client.  However, as both of these\n   are required to remain\
    \ constant throughout the address lease\n   lifetime, they cannot be used with\
    \ the mechanism described in this\n   document.  This is because the client may\
    \ only be able to construct\n   the IPv6 address to use as the source address\
    \ after it has received\n   the first DHCPV4-RESPONSE message from the server\
    \ containing\n   OPTION_S46_BIND_IPV6_PREFIX.\n"
- title: 7.  Client Behavior
  contents:
  - "7.  Client Behavior\n   A client requiring dynamic softwire configuration first\
    \ enables DHCP\n   4o6 configuration using the method described in Section 5 of\n\
    \   [RFC7341].  If OPTION_DHCP4_O_DHCP6_SERVER is received in the\n   corresponding\
    \ REPLY message, the client MAY continue with the\n   configuration process described\
    \ below.\n   Before the dynamic softwire configuration process can commence, the\n\
    \   client MUST be configured with a suitable IPv6 prefix to be used as\n   the\
    \ local softwire endpoint.  This could be obtained using DHCPv6,\n   Router Advertisement\
    \ (RA) / Prefix Information Option (PIO), or\n   another mechanism.\n"
- title: 7.1.  Client Initialization
  contents:
  - "7.1.  Client Initialization\n   When constructing the initial DHCP 4o6 DHCPDISCOVER\
    \ message, the\n   client includes a DHCPv6 OPTION_ORO (6) within the options\
    \ field of\n   the DHCP-QUERY message.  OPTION_ORO contains the option codes for\n\
    \   OPTION_S46_BR (90) and OPTION_S46_BIND_IPV6_PREFIX (137).\n   On receipt of\
    \ the DHCP 4o6 server's reply (a DHCPV4-RESPONSE\n   containing a DHCPOFFER message),\
    \ the client checks the contents of\n   the DHCPv4-RESPONSE for the presence of\
    \ a valid OPTION_S46_BR option.\n   If this option is not present, or does not\
    \ contain at least one valid\n   IPv6 address for a BR, then the client MUST discard\
    \ the message, as\n   without the address of the BR the client cannot configure\
    \ the\n   softwire and so has no interface to request IPv4 configuration for.\n\
    \   The DHCPV4-RESPONSE message may also include\n   OPTION_S46_BIND_IPV6_PREFIX,\
    \ which is used by the operator to\n   indicate a preferred prefix that the client\
    \ should bind IPv4\n   configuration to.  If received, the client first checks\
    \ the option\n   according to Section 7.4.  If valid, the client uses this prefix\
    \ as\n   the \"IPv6 binding prefix\" and follows to the process described in\n\
    \   Section 5.1 of [RFC7596] in order to select an active IPv6 prefix to\n   construct\
    \ the softwire.  If no match is found, or the client doesn't\n   receive OPTION_S46_BIND_IPV6_PREFIX,\
    \ the client MAY select any valid\n   IPv6 prefix (of a suitable scope) to use\
    \ as the tunnel source.\n   Once the client has selected a suitable prefix, it\
    \ MAY either use an\n   existing IPv6 address that is already configured on an\
    \ interface or\n   create a new address specifically for use as the softwire source\n\
    \   address (e.g., using an Interface Identifier constructed as per\n   Section\
    \ 6 of [RFC7597]).  If a new address is being created, the\n   client MUST complete\
    \ configuration of the new address, performing\n   duplicate address detection\
    \ (if required) before proceeding.\n   The client then constructs a DHCPV4-QUERY\
    \ message containing a DHCPv4\n   DHCPREQUEST message.  OPTION_DHCP4O6_S46_SADDR\
    \ is included in the\n   options field of the DHCPREQUEST message with the IPv6\
    \ address of its\n   softwire source address in the softwire-ipv6-src-address\
    \ field.\n   When the client receives a DHCPv4 DHCPACK message from the server,\
    \ it\n   checks the IPv6 address in OPTION_DHCP4O6_S46_SADDR against its\n   active\
    \ softwire source address.  If they match, the allocation\n   process has concluded.\
    \  If there is a discrepancy, then the process\n   described in Section 7.5 is\
    \ followed.\n   If the client receives a DHCPv4 DHCPNAK message from the server,\
    \ then\n   the configuration process has been unsuccessful.  The client then\n\
    \   restarts the process from Step 1 of Figure 1.\n"
- title: 7.2.  Renewing or Rebinding the IPv4 Address Lease and Softwire Source
  contents:
  - "7.2.  Renewing or Rebinding the IPv4 Address Lease and Softwire Source\n    \
    \  Address\n   Whenever the client attempts to extend the lease time of the IPv4\n\
    \   address, OPTION_DHCP4O6_S46_SADDR with the IPv6 address of its\n   softwire\
    \ source address in the softwire-ipv6-src-address field MUST\n   be included in\
    \ the DHCPREQUEST message.\n"
- title: 7.2.1.  Changing the Bound IPv6 Softwire Source Address
  contents:
  - "7.2.1.  Changing the Bound IPv6 Softwire Source Address\n   Across the lifetime\
    \ of the leased IPv4 address, it is possible that\n   the client's IPv6 address\
    \ will change, e.g., if there is an IPv6\n   renumbering event.\n   In this situation,\
    \ the client MUST inform the server of the new\n   address.  This is done by sending\
    \ a DHCPREQUEST message containing\n   OPTION_DHCP4O6_S46_SADDR with the new IPv6\
    \ source address.\n   When the client receives a DHCPv4 DHCPACK message from the\
    \ server, it\n   checks the IPv6 address in OPTION_DHCP4O6_S46_SADDR against its\n\
    \   active softwire source address.  If they match, the allocation\n   process\
    \ has concluded.  If there is a discrepancy, then the process\n   described in\
    \ Section 7.5 is followed.\n   If the client receives a DHCPv4 DHCPNAK message\
    \ in response from the\n   server, then the change of the bound IPv6 softwire\
    \ source address has\n   been unsuccessful.  In this case, the client MUST stop\
    \ using the new\n   IPv6 source address.  The client then restarts the process\
    \ from Step\n   1 of Figure 1.\n"
- title: 7.3.  Releasing the IPv4 Address Lease and Softwire Source Address
  contents:
  - "7.3.  Releasing the IPv4 Address Lease and Softwire Source Address\n   When the\
    \ client no longer requires the IPv4 resource, it sends a\n   DHCPv4 DHCPRELEASE\
    \ message to the server.  As the options field is\n   unused in this message type,\
    \ OPTION_DHCP4O6_S46_SADDR is not\n   included.\n"
- title: 7.4.  OPTION_S46_BIND_IPV6_PREFIX Validation Behavior
  contents:
  - "7.4.  OPTION_S46_BIND_IPV6_PREFIX Validation Behavior\n   On receipt of the OPTION_S46_BIND_IPV6_PREFIX\
    \ option, the client\n   makes the following validation checks:\n   o  The received\
    \ bindprefix6-len value is not larger than 128.\n   o  The number of bytes received\
    \ in the bind-ipv6-prefix field is\n      consistent with the received bindprefix6-len\
    \ value (calculated as\n      described in Section 6.1).\n   If either check fails,\
    \ the receiver discards the invalid option and\n   proceeds to attempt configuration\
    \ as if the option had not been\n   received.\n   The receiver MUST only use bits\
    \ from the bind-ipv6-prefix field up to\n   the value specified in the bindprefix6-len\
    \ when performing the\n   longest prefix match. bind-ipv6-prefix bits beyond this\
    \ value MUST be\n   ignored.\n"
- title: 7.5.  Client and Server Softwire Source Address Mismatch
  contents:
  - "7.5.  Client and Server Softwire Source Address Mismatch\n   If the client receives\
    \ a DHCPACK message with an\n   OPTION_DHCP4O6_S46_SADDR containing an IPv6 address\
    \ that differs from\n   its active softwire source address, the client SHOULD\
    \ wait for a\n   randomized time interval and then resend the DHCPREQUEST message\
    \ with\n   the correct softwire source address.  Section 4.1 of [RFC2131]\n  \
    \ describes the retransmission backoff interval process.\n   The default minimum\
    \ time for the client to attempt retransmission is\n   60 seconds.  If, after\
    \ this time has expired, the client has not\n   received a DHCPACK message with\
    \ the correct bound IPv6 address,\n   client MAY send a DHCPRELEASE message and\
    \ restart the process\n   described in Section 7.  The retry interval should be\
    \ configurable\n   and aligned with any server policy defining the minimum time\
    \ interval\n   for client address updates as described in Section 8.1.\n"
- title: 7.6.  Use with Dynamic, Shared IPv4 Addresses
  contents:
  - "7.6.  Use with Dynamic, Shared IPv4 Addresses\n   [RFC7618] describes a mechanism\
    \ for using DHCPv4 to distribute\n   dynamic, shared IPv4 addresses to clients.\
    \  The mechanism described\n   in this document is compatible with IPv4 address\
    \ sharing and can be\n   enabled by following the process described in Section\
    \ 6 of [RFC7618].\n"
- title: 8.  Server Behavior
  contents:
  - "8.  Server Behavior\n   Beyond the normal DHCP 4o6 functionality defined in [RFC7341],\
    \ the\n   server MUST also store the IPv6 softwire source address of the client\n\
    \   in the leasing address database, alongside the IPv4 address and\n   client\
    \ identifier.\n   An OPTION_DHCP4O6_S46_SADDR containing the bound softwire source\n\
    \   address MUST be sent in every DHCPACK message sent by the server.\n   The\
    \ binding entry between the client's IPv6 softwire source address\n   and the\
    \ leased IPv4 address is valid as long as the IPv4 lease\n   remains valid.\n"
- title: 8.1.  Changing the Bound IPv6 Source Address
  contents:
  - "8.1.  Changing the Bound IPv6 Source Address\n   In the event that the server\
    \ receives a DHCPREQUEST message for an\n   active IPv4 lease containing an OPTION_DHCP4O6_S46_SADDR\
    \ with an IPv6\n   address that differs from the address that is currently stored,\
    \ the\n   server updates the stored softwire source address with the new\n   address\
    \ supplied by the client and sends a DHCPACK message containing\n   the updated\
    \ softwire source address in OPTION_DHCP4O6_S46_SADDR.\n   The server MAY implement\
    \ a policy enforcing a minimum time interval\n   between a client updating its\
    \ softwire source IPv6 address.  If a\n   client attempts to update the softwire\
    \ source IPv6 address before the\n   minimum time has expired, the server can\
    \ either silently drop the\n   client's message or send back a DHCPACK message\
    \ containing the\n   existing IPv6 address binding in OPTION_DHCP4O6_S46_SADDR.\
    \  If\n   implemented, the default minimum client source address update\n   interval\
    \ is 60 seconds.\n"
- title: 8.2.  Handling Conflicts between Clients' Bound IPv6 Source Addresses
  contents:
  - "8.2.  Handling Conflicts between Clients' Bound IPv6 Source Addresses\n   In\
    \ order for traffic to be forwarded correctly, each customer edge's\n   (CE's)\
    \ softwire IPv6 source address must be unique.  To ensure this,\n   on receipt\
    \ of every client DHCPREQUEST message containing\n   OPTION_DHCP4O6_S46_SADDR,\
    \ the DHCP 4o6 server MUST check the received\n   IPv6 address against all existing\
    \ CE source addresses stored for\n   active client IPv4 leases.  If there is a\
    \ match for any active lease\n   other than the lease belonging to the client\
    \ sending the DHCPREQUEST,\n   then the client's IPv6 source address MUST NOT\
    \ be stored or updated.\n   Depending on where the client and server are in the\
    \ address leasing\n   lifecycle, the DHCP 4o6 server then takes the following\
    \ action:\n   o  If the DHCP 4o6 does not have a current, active IPv4 address\
    \ lease\n      for the client, then the DHCP address allocation process has not\n\
    \      been successful.  The server returns a DHCPNAK message to the\n      client.\n\
    \   o  If the DHCP 4o6 does have a current, active IPv4 address lease,\n     \
    \ then the source address update process (see Section 8.1) has not\n      been\
    \ successful.  The DHCP 4o6 server can either silently drop the\n      client's\
    \ message or return a DHCPACK message containing the\n      existing IPv6 address\
    \ binding in OPTION_DHCP4O6_S46_SADDR.\n"
- title: 9.  Security Considerations
  contents:
  - "9.  Security Considerations\n   Security considerations that are applicable to\
    \ [RFC7341] are also\n   applicable here.\n   A rogue client could attempt to\
    \ use the mechanism described in\n   Section 7.2.1 to redirect IPv4 traffic intended\
    \ for another client to\n   itself.  This would be performed by sending a DHCPREQUEST\
    \ message for\n   another client's active IPv4 lease containing the attacker's\
    \ softwire\n   IPv6 address in OPTION_DHCP4O6_S46_SADDR.\n   For such an attack\
    \ to be effective, the attacker would need to know\n   both the client identifier\
    \ and the active IPv4 address lease\n   currently in use by another client.  This\
    \ could be attempted in three\n   ways:\n   1.  One customer learning the active\
    \ IPv4 address lease and client\n       identifier of another customer via snooping\
    \ the DHCP4o6 message\n       flow between the client and server.  The mechanism\
    \ described in\n       this document is intended for use in a typical ISP network\n\
    \       topology with a dedicated Layer 2 access network per client,\n       meaning\
    \ that snooping of another client's traffic is not\n       possible.  If the access\
    \ network is a shared medium, then\n       provisioning softwire clients using\
    \ dynamic DHCP4o6 as described\n       here is NOT RECOMMENDED.\n   2.  Learning\
    \ the active IPv4 address lease and client identifier via\n       snooping the\
    \ DHCP4o6 message flow between the client and server\n       in the aggregation\
    \ or core ISP network.  In this case, the\n       attacker requires a level of\
    \ access to the ISP's infrastructure\n       that means they can already intercept\
    \ or interfere with traffic\n       flows to the client.\n   3.  An attacker attempting\
    \ to brute-force guess the IPv4 lease\n       address and client identifier tuple.\
    \  The risk of this can be\n       reduced by using a client identifier format\
    \ that is not easily\n       guessable, e.g., by using a random-based client identifier\
    \ (see\n       Section 3.5 of [RFC7844]).\n   An attacker could attempt to redirect\
    \ existing flows to a client\n   unable to process the traffic.  This type of\
    \ attack can be prevented\n   by implementing network ingress filtering [BCP38]\
    \ in conjunction with\n   the BR source address validation processes described\
    \ in [RFC7596]\n   Section 5.2 and [RFC7597] Section 8.1.\n   A client may attempt\
    \ to overload the server by sending multiple\n   source address update messages\
    \ (see Section 7.2.1) in a short time\n   frame.  This risk can be reduced by\
    \ implementing a server policy\n   enforcing a minimum time interval between client\
    \ address changes, as\n   described in Section 8.1.\n"
- title: 9.1.  Client Privacy Considerations
  contents:
  - "9.1.  Client Privacy Considerations\n   [RFC7844] describes anonymity profiles\
    \ for DHCP clients.  These\n   considerations and recommendations are also applicable\
    \ to clients\n   implementing the mechanism described in this document.  As DHCP\
    \ 4o6\n   only uses DHCPv6 as a stateless transport for DHCPv4 messages, the\n\
    \   \"Anonymity Profile for DHCPv4\" described in Section 3 is most\n   relevant\
    \ here.\n   In addition to the considerations given in [RFC7844], the mechanism\n\
    \   that the client uses for constructing the interface identifier for\n   its\
    \ IPv6 softwire source address (see Section 7.1) could result in\n   the device\
    \ being trackable across different networks and sessions,\n   e.g., if the client's\
    \ softwire Interface Identifier (IID) is\n   immutable.\n   This can be mitigated\
    \ by constructing the softwire source IPv6\n   address as per Section 6 of [RFC7597].\
    \  Here, the address's IID\n   contains only the allocated IPv4 address (and port\
    \ set identifier if\n   [RFC7618] is being used).  This means no additional client\n\
    \   information is exposed to the DHCP 4o6 server; it also means that the\n  \
    \ IID will change as the leased IPv4 address changes (e.g., between\n   sessions\
    \ when Section 3.5 of [RFC7844] is implemented).\n"
- title: 10.  IANA Considerations
  contents:
  - "10.  IANA Considerations\n   IANA has assigned the OPTION_S46_BIND_IPV6_PREFIX\
    \ (137) option code\n   from the DHCPv6 \"Option Codes\" registry maintained at\n\
    \   <http://www.iana.org/assignments/dhcpv6-parameters> as follows:\n       Value:\
    \             137\n       Description:       OPTION_S46_BIND_IPV6_PREFIX\n   \
    \    Client ORO:        Yes\n       Singleton Option:  Yes\n       Reference:\
    \         RFC 8539\n   IANA has assigned the OPTION_DHCP4O6_S46_SADDR (109) option\
    \ code from\n   the \"BOOTP Vendor Extensions and DHCP Options\" registry maintained\
    \ at\n   <http://www.iana.org/assignments/bootp-dhcp-parameters> as follows:\n\
    \       Tag:          109\n       Name:         OPTION_DHCP4O6_S46_SADDR\n   \
    \    Data Length:  16\n       Meaning:      DHCPv4 over DHCPv6 Softwire Source\
    \ Address Option\n       Reference:    RFC 8539\n   IANA has updated the entry\
    \ for DHCPv6 OPTION_S46_BR (90) in the\n   \"Option Codes\" registry maintained\
    \ at\n   <https://www.iana.org/assignments/dhcpv6-parameters> as follows:\n  \
    \ Old Entry:\n       Value:             90\n       Description:       OPTION_S46_BR\n\
    \       Client ORO:        No\n       Singleton Option:  No\n       Reference:\
    \         [RFC7598]\n   New Entry:\n       Value:             90\n       Description:\
    \       OPTION_S46_BR\n       Client ORO:        Yes\n       Singleton Option:\
    \  No\n       Reference:         [RFC7598], [RFC8539]\n"
- title: 11.  References
  contents:
  - '11.  References

    '
- title: 11.1.  Normative References
  contents:
  - "11.1.  Normative References\n   [RFC2119]  Bradner, S., \"Key words for use in\
    \ RFCs to Indicate\n              Requirement Levels\", BCP 14, RFC 2119,\n  \
    \            DOI 10.17487/RFC2119, March 1997,\n              <https://www.rfc-editor.org/info/rfc2119>.\n\
    \   [RFC2131]  Droms, R., \"Dynamic Host Configuration Protocol\",\n         \
    \     RFC 2131, DOI 10.17487/RFC2131, March 1997,\n              <https://www.rfc-editor.org/info/rfc2131>.\n\
    \   [RFC7341]  Sun, Q., Cui, Y., Siodelski, M., Krishnan, S., and I.\n       \
    \       Farrer, \"DHCPv4-over-DHCPv6 (DHCP 4o6) Transport\",\n              RFC\
    \ 7341, DOI 10.17487/RFC7341, August 2014,\n              <https://www.rfc-editor.org/info/rfc7341>.\n\
    \   [RFC7598]  Mrugalski, T., Troan, O., Farrer, I., Perreault, S., Dec,\n   \
    \           W., Bao, C., Yeh, L., and X. Deng, \"DHCPv6 Options for\n        \
    \      Configuration of Softwire Address and Port-Mapped\n              Clients\"\
    , RFC 7598, DOI 10.17487/RFC7598, July 2015,\n              <https://www.rfc-editor.org/info/rfc7598>.\n\
    \   [RFC8174]  Leiba, B., \"Ambiguity of Uppercase vs Lowercase in RFC\n     \
    \         2119 Key Words\", BCP 14, RFC 8174, DOI 10.17487/RFC8174,\n        \
    \      May 2017, <https://www.rfc-editor.org/info/rfc8174>.\n   [RFC8415]  Mrugalski,\
    \ T., Siodelski, M., Volz, B., Yourtchenko, A.,\n              Richardson, M.,\
    \ Jiang, S., Lemon, T., and T. Winters,\n              \"Dynamic Host Configuration\
    \ Protocol for IPv6 (DHCPv6)\",\n              RFC 8415, DOI 10.17487/RFC8415,\
    \ November 2018,\n              <https://www.rfc-editor.org/info/rfc8415>.\n"
- title: 11.2.  Informative References
  contents:
  - "11.2.  Informative References\n   [BCP38]    Ferguson, P. and D. Senie, \"Network\
    \ Ingress Filtering:\n              Defeating Denial of Service Attacks which\
    \ employ IP Source\n              Address Spoofing\", BCP 38, RFC 2827, May 2000,\n\
    \              <https://www.rfc-editor.org/info/bcp38>.\n   [RFC7596]  Cui, Y.,\
    \ Sun, Q., Boucadair, M., Tsou, T., Lee, Y., and I.\n              Farrer, \"\
    Lightweight 4over6: An Extension to the Dual-\n              Stack Lite Architecture\"\
    , RFC 7596, DOI 10.17487/RFC7596,\n              July 2015, <https://www.rfc-editor.org/info/rfc7596>.\n\
    \   [RFC7597]  Troan, O., Ed., Dec, W., Li, X., Bao, C., Matsushima, S.,\n   \
    \           Murakami, T., and T. Taylor, Ed., \"Mapping of Address and\n     \
    \         Port with Encapsulation (MAP-E)\", RFC 7597,\n              DOI 10.17487/RFC7597,\
    \ July 2015,\n              <https://www.rfc-editor.org/info/rfc7597>.\n   [RFC7618]\
    \  Cui, Y., Sun, Q., Farrer, I., Lee, Y., Sun, Q., and M.\n              Boucadair,\
    \ \"Dynamic Allocation of Shared IPv4 Addresses\",\n              RFC 7618, DOI\
    \ 10.17487/RFC7618, August 2015,\n              <https://www.rfc-editor.org/info/rfc7618>.\n\
    \   [RFC7844]  Huitema, C., Mrugalski, T., and S. Krishnan, \"Anonymity\n    \
    \          Profiles for DHCP Clients\", RFC 7844,\n              DOI 10.17487/RFC7844,\
    \ May 2016,\n              <https://www.rfc-editor.org/info/rfc7844>.\n"
- title: Acknowledgements
  contents:
  - "Acknowledgements\n   The authors would like to thank Ted Lemon, Lishan Li, Tatuya\
    \ Jinmei,\n   Jonas Gorski, and Razvan Becheriu for their contributions and\n\
    \   comments.\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Ian Farrer\n   Deutsche Telekom AG\n   Landgrabenweg 151\n\
    \   Bonn, NRW  53227\n   Germany\n   Email: ian.farrer@telekom.de\n   Qi Sun\n\
    \   Tsinghua University\n   Beijing  100084\n   China\n   Phone: +86-10-6278-5822\n\
    \   Email: sunqi.ietf@gmail.com\n   Yong Cui\n   Tsinghua University\n   Beijing\
    \  100084\n   China\n   Phone: +86-10-6260-3059\n   Email: yong@csnet1.cs.tsinghua.edu.cn\n\
    \   Linhui Sun\n   Tsinghua University\n   Beijing  100084\n   China\n   Phone:\
    \ +86-10-6278-5822\n   Email: lh.sunlinh@gmail.com\n"
