- title: __initial_text__
  contents:
  - '                   Distribution of Diverse BGP Paths

    '
- title: Abstract
  contents:
  - "Abstract\n   The BGP4 protocol specifies the selection and propagation of a single\n\
    \   best path for each prefix.  As defined and widely deployed today, BGP\n  \
    \ has no mechanisms to distribute alternate paths that are not\n   considered\
    \ best path between its speakers.  This behavior results in\n   a number of disadvantages\
    \ for new applications and services.\n   The main objective of this document is\
    \ to observe that by simply\n   adding a new session between a route reflector\
    \ and its client, the\n   Nth best path can be distributed.  This document also\
    \ compares\n   existing solutions and proposed ideas that enable distribution\
    \ of\n   more paths than just the best path.\n   This proposal does not specify\
    \ any changes to the BGP protocol\n   definition.  It does not require a software\
    \ upgrade of provider edge\n   (PE) routers acting as route reflector clients.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This document is not an Internet Standards Track specification;\
    \ it is\n   published for informational purposes.\n   This document is a product\
    \ of the Internet Engineering Task Force\n   (IETF).  It represents the consensus\
    \ of the IETF community.  It has\n   received public review and has been approved\
    \ for publication by the\n   Internet Engineering Steering Group (IESG).  Not\
    \ all documents\n   approved by the IESG are a candidate for any level of Internet\n\
    \   Standard; see Section 2 of RFC 5741.\n   Information about the current status\
    \ of this document, any errata,\n   and how to provide feedback on it may be obtained\
    \ at\n   http://www.rfc-editor.org/info/rfc6774.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2012 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (http://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.  Code Components\
    \ extracted from this document must\n   include Simplified BSD License text as\
    \ described in Section 4.e of\n   the Trust Legal Provisions and are provided\
    \ without warranty as\n   described in the Simplified BSD License.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1. Introduction ....................................................2\n\
    \   2. History .........................................................3\n  \
    \    2.1. BGP Add-Paths Proposal .....................................3\n   3.\
    \ Goals ...........................................................5\n   4. Multi-Plane\
    \ Route Reflection ....................................6\n      4.1. Co-located\
    \ Best- and Backup-Path RRs .......................8\n      4.2. Randomly Located\
    \ Best- and Backup-Path RRs ................10\n      4.3. Multi-Plane Route Servers\
    \ for Internet Exchanges ..........12\n   5. Discussion on Current Models of IBGP\
    \ Route Distribution ........13\n      5.1. Full Mesh .................................................13\n\
    \      5.2. Confederations ............................................14\n  \
    \    5.3. Route Reflectors ..........................................15\n   6.\
    \ Deployment Considerations ......................................15\n   7. Summary\
    \ of Benefits ............................................17\n   8. Applications\
    \ ...................................................18\n   9. Security Considerations\
    \ ........................................19\n   10. Contributors ..................................................19\n\
    \   11. Acknowledgments ...............................................20\n  \
    \ 12. References ....................................................20\n    \
    \   12.1. Normative References ....................................20\n      \
    \ 12.2. Informative References ..................................20\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   The current BGP4 protocol specification [RFC4271] allows\
    \ for the\n   selection and propagation of only one best path for each prefix.\
    \  As\n   defined today, the BGP protocol has no mechanism to distribute paths\n\
    \   other than best path between its speakers.  This behavior results in\n   a\
    \ number of problems in the deployment of new applications and\n   services.\n\
    \   This document presents a mechanism for solving the problem based on\n   the\
    \ conceptual creation of parallel route-reflector planes.  It also\n   compares\
    \ existing solutions and proposes ideas that enable\n   distribution of more paths\
    \ than just the best path.  The parallel\n   route-reflector planes solution brings\
    \ very significant benefits at a\n   negligible capex and opex deployment price\
    \ as compared to the\n   alternative techniques (full BGP mesh or add-paths [ADD-PATHS])\
    \ and\n   is being considered by a number of network operators for deployment\n\
    \   in their networks.\n   This proposal does not specify any changes to the BGP\
    \ protocol\n   definition.  It does not require upgrades to provider edge or core\n\
    \   routers, nor does it need network-wide upgrades.  The only upgrade\n   required\
    \ is the new functionality on the new or current route\n   reflectors.\n"
- title: 2.  History
  contents:
  - "2.  History\n   The need to disseminate more paths than just the best path is\n\
    \   primarily driven by three issues.  The first is the problem of BGP\n   oscillations\
    \ [RFC3345].  The second is the desire for faster\n   reachability restoration\
    \ in the event of failure of the network link\n   or network element.  The third\
    \ is a need to enhance BGP load-\n   balancing capabilities.  These issues have\
    \ led to the proposal of BGP\n   add-paths [ADD-PATHS].\n"
- title: 2.1.  BGP Add-Paths Proposal
  contents:
  - "2.1.  BGP Add-Paths Proposal\n   As it has been proven that distribution of only\
    \ the best path of a\n   route is not sufficient to meet the needs of the continuously\
    \ growing\n   number of services carried over BGP, the add-paths proposal was\n\
    \   submitted in 2002 to enable BGP to distribute more than one path.\n   This\
    \ is achieved by including an additional four-octet value called\n   the \"Path\
    \ Identifier\" as a part of the Network Layer Reachability\n   Information (NLRI).\n\
    \   The implication of this change on a BGP implementation is that it\n   must\
    \ now maintain a per-path, instead of per-prefix, peer\n   advertisement state\
    \ to track to which of the peers a given path was\n   advertised.  This new requirement\
    \ comes with its own memory and\n   processing cost.\n   An important observation\
    \ is that distribution of more than one best\n   path by the Autonomous System\
    \ Border Routers (ASBRs) with multiple\n   External BGP (EBGP) peers attached\
    \ where no \"next-hop self\" is set\n   may result in inconsistent best-path selection\
    \ within the autonomous\n   system.  Therefore, it is also required to attach\
    \ the possible\n   tiebreakers in the form of a new attribute and propagate those\
    \ within\n   the domain.  The example of such an attribute for the purpose of\
    \ fast\n   connectivity restoration to address that very case of ASBR injecting\n\
    \   multiple external paths into the Internal BGP (IBGP) mesh has been\n   presented\
    \ and discussed in \"Advertisement of Multiple Paths in BGP\"\n   [ADD-PATHS].\
    \  Based on the additionally propagated information, best-\n   path selection\
    \ is recommended to be modified to make sure that best-\n   and backup-path selection\
    \ within the domain stays consistent.  More\n   discussion on this particular\
    \ point is contained in Section 6,\n   \"Deployment Considerations\".  In the\
    \ proposed solution in this\n   document, we observe that to address most of the\
    \ applications, just\n   use of the best external advertisement is required. \
    \ For ASBRs that\n   are peering to multiple upstream domains, setting \"next-hop\
    \ self\" is\n   recommended.\n   The add-paths protocol extensions have to be\
    \ implemented by all the\n   routers within an Autonomous System (AS) in order\
    \ for the system to\n   work correctly.  Analyzing the benefits or risks associated\
    \ with\n   partial add-paths deployments remains quite a topic for research.\n\
    \   The risk becomes even greater in networks not using some form of\n   edge-to-edge\
    \ encapsulation.\n   The required code modifications can offer the foundation\
    \ for\n   enhancements, such as the \"Fast Connectivity Restoration Using BGP\n\
    \   Add-path\" [FAST-CONN].  The deployment of such technology in an\n   entire\
    \ service-provider network requires software, and perhaps\n   sometimes, in the\
    \ case of End-of-Engineering or End-of-Life\n   equipment, even hardware upgrades.\
    \  Such an operation may or may not\n   be economically feasible.  Even if add-path\
    \ functionality was\n   available today on all commercial routing equipment and\
    \ across all\n   vendors, experience indicates that it may easily take years to\n\
    \   achieve 100% deployment coverage within any medium or large global\n   network.\n\
    \   While it needs to be clearly acknowledged that the add-path mechanism\n  \
    \ provides the most general way to address the problem of distributing\n   many\
    \ paths between BGP speakers, this document provides a solution\n   that is much\
    \ easier to deploy and requires no modification to the BGP\n   protocol where\
    \ only a few additional paths may be required.  The\n   alternative method presented\
    \ is capable of addressing critical\n   service-provider requirements for disseminating\
    \ more than a single\n   path across an AS with a significantly lower deployment\
    \ cost.  That,\n   in light of the number of general network scaling concerns\
    \ documented\n   in RFC 4984 [RFC4984], \"Report from the IAB Workshop on Routing\
    \ and\n   Addressing\", may provide a significant advantage.\n"
- title: 3.  Goals
  contents:
  - "3.  Goals\n   The proposal described in this document is not intended to compete\n\
    \   with add-paths.  It provides an interim solution until add-paths are\n   standardized\
    \ and implemented and until support for that function can\n   be deployed across\
    \ the network.\n   It is presented to network operators as a possible choice and\n\
    \   provides those operators who need additional paths today an\n   alternative\
    \ from the need to transition to a full mesh.  The Nth best\n   path describes\
    \ a set of N paths with different BGP next hops with no\n   implication of ordering\
    \ or preference among said N paths.\n   It is intended as a way to buy more time,\
    \ allowing for a smoother and\n   gradual migration where router upgrades will\
    \ be required for,\n   perhaps, different reasons.  It will also allow the time\
    \ required so\n   that standard RP/RE memory size can easily accommodate the associated\n\
    \   overhead with other techniques without any compromises.\n"
- title: 4.  Multi-Plane Route Reflection
  contents:
  - "4.  Multi-Plane Route Reflection\n   The idea contained in the proposal assumes\
    \ the use of route\n   reflection within the network.\n   Let's observe today's\
    \ picture of a simple route-reflected domain:\n                              \
    \      ASBR3\n                                     ***\n                     \
    \               *   *\n                       +------------*   *-----------+\n\
    \                       | AS1        *   *           |\n                     \
    \  |             ***            |\n                       |                  \
    \          |\n                       |                            |\n        \
    \               |                            |\n                       | RR1 \
    \        ***        RR2 |\n                       | ***        *   *       ***\
    \ |\n                       |*   *       * P *      *   *|\n                 \
    \      |*   *       *   *      *   *|\n                       | ***         ***\
    \        *** |\n                       |                            |\n      \
    \                 |            IBGP            |\n                       |   \
    \                         |\n                       |                        \
    \    |\n                       |      ***           ***     |\n              \
    \         |     *   *         *   *    |\n                       +-----*   *---------*\
    \   *----+\n                             *   *         *   *\n               \
    \               ***           ***\n                             ASBR1        \
    \ ASBR2\n                                     EBGP\n                     Figure\
    \ 1: Simple route reflection\n   Abbreviations used:\n      RR - Route Reflector\n\
    \      P - Core router\n   Figure 1 shows an AS that is connected via EBGP peering\
    \ at ASBR1 and\n   ASBR2 to an upstream AS or set of ASes.  For a given destination\
    \ \"D\",\n   ASBR1 and ASBR2 may have an external path P1 and P2, respectively.\n\
    \   The AS network uses two route reflectors, RR1 and RR2, for redundancy\n  \
    \ reasons.  The route reflectors propagate the single BGP best path for\n   each\
    \ route to all clients.  All ASBRs are clients of RR1 and RR2.\n   Following are\
    \ the possible cases of the path information that ASBR3\n   may receive from route\
    \ reflectors RR1 and RR2:\n   1.  When the best-path tiebreaker is the IGP distance:\
    \ When paths P1\n       and P2 are considered to be equally good best-path candidates,\n\
    \       the selection will depend on the distance of the path's next hops\n  \
    \     from the route reflector making the decision.  Depending on the\n      \
    \ positioning of the route reflectors in the IGP topology, they may\n       choose\
    \ the same best path or a different one.  In such a case,\n       ASBR3 may receive\
    \ either the same path or different paths from\n       each of the route reflectors.\n\
    \   2.  When the best-path tiebreaker is MULTI_EXIT_DISC (MED) or\n       LOCAL_PREF:\
    \ In this case, only one path from the preferred exit\n       point ASBR will\
    \ be available to RRs since the other peering ASBR\n       will consider the IBGP\
    \ path as best and will not announce (or if\n       already announced will withdraw)\
    \ its own external path.  The\n       exception here is the use of the BGP Best-External\
    \ proposal\n       [EXT-PATH], which will allow a stated ASBR to still propagate\
    \ to\n       the RRs on its own external path.  Unfortunately, RRs will not be\n\
    \       able to distribute it any further to other clients, as only the\n    \
    \   overall best path will be reflected.\n   There is no requirement of path ordering.\
    \  The \"Nth best path\" really\n   describes set of N paths with different BGP\
    \ next hops.\n   The proposed solution is based on the use of additional route\n\
    \   reflectors or new functionality enabled on the existing route\n   reflectors\
    \ that, instead of distributing the best path for each\n   route, will distribute\
    \ an alternative path other than best.  The\n   best-path (main) reflector plane\
    \ distributes the best path for each\n   route as it does today.  The second plane\
    \ distributes the second best\n   path for each route, and so on.  Distribution\
    \ of N paths for each\n   route can be achieved by using N reflector planes.\n\
    \   As diverse-path functionality may be enabled on a per-peer basis, one\n  \
    \ of the deployment models can be realized to continue advertisement of\n   the\
    \ overall best path from both route reflectors, while in addition a\n   new session\
    \ can be provisioned to get an additional path.  This will\n   allow the uninterrupted\
    \ use of the best path, even if one of the RRs\n   goes down, provided that the\
    \ overall best path is still a valid one.\n   Each plane of the route reflectors\
    \ is a logical entity and may or may\n   not be co-located with the existing best-path\
    \ route reflectors.\n   Adding a route-reflector plane to a network may be as\
    \ easy as\n   enabling a logical router partition, new BGP process, or just a\
    \ new\n   configuration knob on an existing route reflector and configuring an\n\
    \   additional IBGP session from the current clients if required.  There\n   are\
    \ no code changes required on the route-reflector clients for this\n   mechanism\
    \ to work.  It is easy to observe that the installation of\n   one or more additional\
    \ route-reflector control planes is much cheaper\n   and is easier than upgrading\
    \ hundreds of route-reflector clients in\n   the entire network to support different\
    \ BGP protocol encoding.\n   Diverse-path route reflectors need the new ability\
    \ to calculate and\n   propagate the Nth best path instead of the overall best\
    \ path.  An\n   implementation is encouraged to enable this new functionality\
    \ on a\n   per-neighbor basis.\n   While this is an implementation detail, the\
    \ code to calculate the Nth\n   best path is also required by other BGP solutions.\
    \  For example, in\n   the application of fast connectivity restoration, BGP must\
    \ calculate\n   a backup path for installation into the Routing Information Base\n\
    \   (RIB) and Forwarding Information Base (FIB) ahead of the actual\n   failure.\n\
    \   To address the problem of external paths not being available to route\n  \
    \ reflectors due to LOCAL_PREF or MED factors, it is recommended that\n   ASBRs\
    \ enable [EXT-PATH] functionality in order to always inject their\n   external\
    \ paths to the route reflectors.\n"
- title: 4.1.  Co-located Best- and Backup-Path RRs
  contents:
  - "4.1.  Co-located Best- and Backup-Path RRs\n   To simplify the description, let's\
    \ assume that we only use two route-\n   reflector planes (N=2).  When co-located,\
    \ the additional second-best-\n   path reflectors are connected to the network\
    \ at the same points from\n   the perspective of the IGP as the existing best-path\
    \ RRs.  Let's also\n   assume that best-external functionality is enabled on all\
    \ ASBRs.\n                                    ASBR3\n                        \
    \             ***\n                                    *   *\n               \
    \        +------------*   *-----------+\n                       | AS1        *\
    \   *           |\n                       |             ***            |\n   \
    \                    |                            |\n                       |\
    \ RR1                    RR2 |\n                       | ***                 \
    \   *** |\n                       |*   *        ***       *   *|\n           \
    \            |*   *       *   *      *   *|\n                       | ***    \
    \    * P *       *** |\n                       |*   *       *   *      *   *|\n\
    \                       |*   *        ***       *   *|\n                     \
    \  | ***                    *** |\n                       | RR1'       IBGP  \
    \      RR2'|\n                       |                            |\n        \
    \               |                            |\n                       |     \
    \ ***           ***     |\n                       |     *   *         *   *  \
    \  |\n                       +-----*   *---------*   *----+\n                \
    \             *   *         *   *\n                              ***         \
    \  ***\n                             ASBR1         ASBR2\n                   \
    \                  EBGP\n              Figure 2: Co-located Second-Best-Path RR\
    \ Plane\n   The following is a list of configuration changes required to enable\n\
    \   the second-best-path route-reflector plane:\n   1.  Unless the same RR1/RR2\
    \ platform is being used, adding RR1' and\n       RR2' either as the logical or\
    \ physical new control-plane RRs in\n       the same IGP points as RR1 and RR2,\
    \ respectively.\n   2.  Enabling best-external functionality on ASBRs.\n   3.\
    \  Enabling RR1' and RR2' for second plane route reflection.\n       Alternatively,\
    \ instructing existing RR1 and RR2 to calculate the\n       second-best path also.\n\
    \   4.  Unless one of the existing RRs is set to advertise only diverse\n    \
    \   path to its current clients, configuring new ASBRs-RR' IBGP\n       sessions.\n\
    \   The expected behavior is that under any BGP condition, the ASBR3 and\n   P\
    \ routers will receive both paths P1 and P2 for destination D.  The\n   availability\
    \ of both paths will allow them to implement a number of\n   new services as listed\
    \ in Section 8 (\"Applications\").\n   As an alternative to fully meshing all\
    \ RRs and RRs', an operator that\n   has a large number of reflectors deployed\
    \ today may choose to peer\n   newly introduced RRs' to a hierarchical RR', which\
    \ would be an IBGP\n   interconnect point within the second plane as well as between\
    \ planes.\n   One deployment model of this scenario can be achieved by simply\n\
    \   upgrading the existing route reflectors without deploying any new\n   logical\
    \ or physical platforms.  Such an upgrade would allow route\n   reflectors to\
    \ service both peers that have upgraded to add-paths, as\n   well as those peers\
    \ that cannot be immediately upgraded while at the\n   same time allowing distribution\
    \ of more than a single best path.  The\n   obvious protocol benefit of using\
    \ existing RRs to distribute towards\n   their clients' best and diverse BGP paths\
    \ over different IBGP\n   sessions is the automatic assurance that such a client\
    \ would always\n   get different paths with their next hop being different.\n\
    \   The way to accomplish this would be to create a separate IBGP session\n  \
    \ for each Nth BGP path.  Such a session should be preferably\n   terminated at\
    \ a different loopback address of the route reflector.\n   At the BGP OPEN stage\
    \ of each such session, a different bgp_router_id\n   may be used.  Correspondingly,\
    \ the route reflector should also allow\n   its clients to use the same bgp_router_id\
    \ on each such session.\n"
- title: 4.2.  Randomly Located Best- and Backup-Path RRs
  contents:
  - "4.2.  Randomly Located Best- and Backup-Path RRs\n   Now let's consider a deployment\
    \ case in which an operator wishes to\n   enable a second RR' plane using only\
    \ a single additional router in a\n   different network location from his current\
    \ route reflectors.  This\n   model would be of particular use in networks in\
    \ which some form of\n   end-to-end encapsulation (IP or MPLS) is enabled between\
    \ provider-\n   edge routers.\n   Note that this model of operation assumes that\
    \ the present best-path\n   route reflectors are only control-plane devices. \
    \ If the route\n   reflector is in the data-forwarding path, then the implementation\n\
    \   must be able to clearly separate the Nth best-path selection from the\n  \
    \ selection of the paths to be used for data forwarding.  The basic\n   premise\
    \ of this mode of deployment assumes that all reflector planes\n   have the same\
    \ information to choose from, which includes the same set\n   of BGP paths.  It\
    \ also requires the ability to ignore the step of\n   comparison of the IGP metric\
    \ to reach the BGP next hop during best-\n   path calculation.\n             \
    \                       ASBR3\n                                     ***\n    \
    \                                *   *\n                       +------------*\
    \   *-----------+\n                       | AS1        *   *           |\n   \
    \                    | IBGP        ***            |\n                       |\
    \                            |\n                       |             ***     \
    \       |\n                       |            *   *           |\n           \
    \            | RR1        * P *       RR2 |\n                       | ***    \
    \    *   *       *** |\n                       |*   *        ***       *   *|\n\
    \                       |*   *                  *   *|\n                     \
    \  | ***         RR'        *** |\n                       |             ***  \
    \          |\n                       |            *   *           |\n        \
    \               |            *   *           |\n                       |     \
    \        ***            |\n                       |      ***           ***   \
    \  |\n                       |     *   *         *   *    |\n                \
    \       +-----*   *---------*   *----+\n                             *   *   \
    \      *   *\n                              ***           ***\n              \
    \               ASBR1         ASBR2\n                                     EBGP\n\
    \      Figure 3: Experimental Deployment of Second-Best-Path RR Plane\n   The\
    \ following is a list of configuration changes required to enable\n   the second-best-path\
    \ route reflector RR' as a single platform or to\n   enable one of the existing\
    \ control-plane RRs for diverse-path\n   functionality:\n   1.  If needed, adding\
    \ RR' logical or physical as a new route\n       reflector anywhere in the network.\n\
    \   2.  Enabling best-external functionality on ASBRs.\n   3.  Disabling IGP metric\
    \ check in BGP best path on all route\n       reflectors.\n   4.  Enabling RR'\
    \ or any of the existing RR for second plane path\n       calculation.\n   5.\
    \  If required, fully meshing newly added RRs' with all the other\n       reflectors\
    \ in both planes.  This condition does not apply if the\n       newly added RR'(s)\
    \ already have peering to all ASBRs/PEs.\n   6.  Configure new BGP sessions between\
    \ ASBRs and RRs (unless one of\n       the existing RRs is set to advertise only\
    \ diverse path to its\n       current clients).\n   In this scenario, the operator\
    \ has the flexibility to introduce the\n   new additional route-reflector functionality\
    \ on any existing or new\n   hardware in the network.  Any existing routers that\
    \ are not already\n   members of the best-path route-reflector plane can be easily\n\
    \   configured to serve the second plane either by using a\n   logical/virtual\
    \ router partition or by having their BGP\n   implementation compliant to this\
    \ specification.\n   Even if the IGP metric is not taken into consideration when\
    \ comparing\n   paths during the best-path calculation, an implementation still\
    \ has\n   to consider paths with unreachable next hops invalid.  It is worth\n\
    \   pointing out that some implementations today already allow for\n   configuration\
    \ that results in no IGP metric comparison during the\n   best-path calculation.\n\
    \   The additional planes of route reflectors do not need to be fully\n   redundant\
    \ as the primary plane does.  If we are preparing for a\n   single network failure\
    \ event, a failure of a non-backed-up Nth best-\n   path route reflector would\
    \ not result in a connectivity outage of the\n   actual data plane.  The reason\
    \ is that this would, at most, affect\n   the presence of a backup path (not an\
    \ active one) on the same parts\n   of the network.  If the operator chooses to\
    \ create the Nth best-path\n   plane redundantly by installing not one, but two\
    \ or more route\n   reflectors serving each additional plane, the additional robustness\n\
    \   will be achieved.\n   As a result of this solution, ASBR3 and other ASBRs\
    \ peering to RR'\n   will be receiving the second best path.\n   Similarly to\
    \ Section 4.1, as an alternative to fully meshing all RRs\n   and diverse path\
    \ RRs', operators may choose to peer newly introduced\n   RRs' to a hierarchical\
    \ RR', which would be an IBGP interconnect point\n   between planes.\n   It is\
    \ recommended that an implementation advertise the overall best\n   path over\
    \ the Nth diverse-path session if there is no other BGP path\n   with a different\
    \ next hop present.  This is equivalent to today's\n   case where the client is\
    \ connected to more than one RR.\n"
- title: 4.3.  Multi-Plane Route Servers for Internet Exchanges
  contents:
  - "4.3.  Multi-Plane Route Servers for Internet Exchanges\n   Another group of devices\
    \ in which the proposed multi-plane\n   architecture may be of particular applicability\
    \ is the EBGP route\n   servers used at many Internet exchange points.\n   In\
    \ such cases, hundreds of ISPs are interconnected on a common LAN.\n   Instead\
    \ of having hundreds of direct EBGP sessions on each exchange\n   client, a single\
    \ peering is created to the transparent route server.\n   The route server can\
    \ only propagate a single best path.  Mandating\n   the upgrade for hundreds of\
    \ different service providers in order to\n   implement add-path may be much more\
    \ difficult as compared to asking\n   them to provision one new EBGP session to\
    \ an Nth best path route\n   server plane.  This allows the distribution of more\
    \ than the single\n   best BGP path from a given route server to such an Internet\
    \ exchange\n   point (IX) peer.\n   The solution proposed in this document fits\
    \ very well with the\n   requirement of having broader EBGP path diversity among\
    \ the members\n   of any Internet exchange point.\n"
- title: 5.  Discussion on Current Models of IBGP Route Distribution
  contents:
  - "5.  Discussion on Current Models of IBGP Route Distribution\n   In today's networks,\
    \ BGP4 operates as specified in [RFC4271].\n   There are a number of technology\
    \ choices for intra-AS BGP route\n   distribution:\n   1.  Full mesh\n   2.  Confederations\n\
    \   3.  Route reflectors\n"
- title: 5.1.  Full Mesh
  contents:
  - "5.1.  Full Mesh\n   A full mesh, the most basic IBGP architecture, exists when\
    \ all BGP\n   speaking routers within the AS peer directly with all other BGP\n\
    \   speaking routers within the AS, irrespective of where a given router\n   resides\
    \ within the AS (e.g., P router, PE router, etc.).\n   While this is the simplest\
    \ intra-domain path-distribution method,\n   historically, there have been a number\
    \ of challenges in realizing\n   such an IBGP full mesh in a large-scale network.\
    \  While some of these\n   challenges are no longer applicable, the following\
    \ (as well as\n   others) may still apply:\n   1.  Number of TCP sessions: The\
    \ number of IBGP sessions on a single\n       router in a full-mesh topology of\
    \ a large-scale service provider\n       can easily reach hundreds.  Such numbers\
    \ could be a concern on\n       hardware and software used in the late 70s, 80s,\
    \ and 90s.  Today,\n       customer requirements for the number of BGP sessions\
    \ per box are\n       reaching thousands.  This is already an order of magnitude\
    \ more\n       than the potential number of IBGP sessions.  Advancements in the\n\
    \       hardware and software used in production routers means that\n       running\
    \ a full mesh of IBGP sessions should not be dismissed due\n       to the resulting\
    \ number of TCP sessions alone.\n   2.  Provisioning: When operating and troubleshooting\
    \ large networks,\n       one of the topmost requirements is to keep the design\
    \ as simple\n       as possible.  When the autonomous system's network is composed\
    \ of\n       hundreds of nodes, it becomes very difficult to manually\n      \
    \ provision a full mesh of IBGP sessions.  Adding or removing a\n       router\
    \ requires reconfiguration of all other routers in the AS.\n       While this\
    \ is a real concern today, there is already work in\n       progress in the IETF\
    \ to define IBGP peering automation through an\n       IBGP Auto Discovery mechanism\
    \ [AUTO-MESH].\n   3.  Number of paths: Another concern when deploying a full\
    \ IBGP mesh\n       is the number of BGP paths for each route that have to be\
    \ stored\n       at every node.  This number is very tightly related to the number\n\
    \       of external peerings of an AS, the use of LOCAL_PREF or MED\n       techniques,\
    \ and the presence of best-external [EXT-PATH]\n       advertisement configuration.\
    \  If we make a rough assumption that\n       the BGP4-path data structure consumes\
    \ about 80-100 bytes, the\n       resulting control-plane memory requirement for\
    \ 500,000 IPv4\n       routes with one additional external path is 38-48 MB, while\
    \ for 1\n       million IPv4 routes, it grows linearly to 76-95 MB.  It is not\n\
    \       possible to reach a general conclusion if this condition is\n       negligible\
    \ or if it is a show stopper for a full-mesh deployment\n       without direct\
    \ reference to a given network.\n   To summarize, a full-mesh IBGP peering can\
    \ offer natural\n   dissemination of multiple external paths among BGP speakers.\
    \  When\n   realized with the help of IBGP Auto Discovery peering automation,\n\
    \   this seems like a viable deployment, especially in medium- and small-\n  \
    \ scale networks.\n"
- title: 5.2.  Confederations
  contents:
  - "5.2.  Confederations\n   For the purpose of this document, let's observe that\
    \ confederations\n   [RFC5065] can be viewed as a hierarchical full-mesh model.\n\
    \   Within each sub-AS, BGP speakers are fully meshed, and as discussed\n   in\
    \ Section 2.1, all full-mesh characteristics (number of TCP\n   sessions, provisioning,\
    \ and potential concern over number of paths\n   still apply in the sub-AS scale).\n\
    \   In addition to the direct peering of all BGP speakers within each\n   sub-AS,\
    \ all sub-AS border routers must also be fully meshed with each\n   other.  Sub-AS\
    \ border routers configured with best-external\n   functionality can inject additional\
    \ (diverse) paths within a sub-AS.\n   To summarize, it is technically sound to\
    \ use confederations with the\n   combination of best-external to achieve distribution\
    \ of more than a\n   single best path per route in a large autonomous systems.\n\
    \   In topologies where route reflectors are deployed within the\n   confederation\
    \ sub-ASes, the technique described here applies.\n"
- title: 5.3.  Route Reflectors
  contents:
  - "5.3.  Route Reflectors\n   The main motivation behind the use of route reflectors\
    \ [RFC4456] is\n   the avoidance of the full-mesh session management problem described\n\
    \   above.  Route reflectors, for good or for bad, are the most common\n   solution\
    \ today for interconnecting BGP speakers within an internal\n   routing domain.\n\
    \   Route-reflector peerings follow the advertisement rules defined by\n   the\
    \ BGP4 protocol.  As a result, only a single best path per prefix\n   is sent\
    \ to client BGP peers.  This is the main reason many current\n   networks are\
    \ exposed to a phenomenon called BGP path starvation,\n   which essentially results\
    \ in the inability to deliver a number of\n   applications discussed later.\n\
    \   When interconnecting BGP speakers between domains, the route\n   reflection\
    \ equivalent is popularly called the \"Route Server\" and is\n   globally deployed\
    \ today in many Internet exchange points.\n"
- title: 6.  Deployment Considerations
  contents:
  - "6.  Deployment Considerations\n   Distribution of the diverse-BGP-paths proposal\
    \ allows the\n   dissemination of more paths than just the best path to the route-\n\
    \   reflector or route-server clients of today's BGP4 implementations.\n   As\
    \ a deployment recommendation, it needs to be mentioned that fast\n   connectivity\
    \ restoration as well as a majority of intra-domain BGP-\n   level load balancing\
    \ needs can be accommodated with only two paths\n   (overall best and second best).\
    \  Therefore, as a deployment\n   recommendation, this document suggests use of\
    \ N=2 with diverse-path.\n   From the client's point of view, receiving additional\
    \ paths via\n   separate IBGP sessions terminated at the new route-reflector plane\
    \ is\n   functionally equivalent to constructing a full-mesh peering without\n\
    \   the problems such a full mesh would come with, as discussed in\n   earlier\
    \ section.\n   By precisely defining the number of reflector planes, network\n\
    \   operators have full control over the number of redundant paths in the\n  \
    \ network.  This number can be defined to address the needs of the\n   service(s)\
    \ being deployed.\n   The Nth-plane route reflectors should act as control-plane\
    \ network\n   entities.  While they can be provisioned on the current production\n\
    \   routers, selected Nth-best BGP paths should not be used directly in\n   the\
    \ date plane with the exception of such paths being BGP multipath\n   eligible\
    \ and such functionality is enabled.  Regarding RRs being in\n   the data plane\
    \ unless multipath is enabled, the second best path is\n   expected to be a backup\
    \ path and should be installed as such into the\n   local RIB/FIB.\n   The use\
    \ of the term \"planes\" in this document is more of a conceptual\n   nature.\
    \  In practice, all paths are still kept in the single table\n   where normal\
    \ best path is calculated.  This means that tools like the\n   looking glass should\
    \ not observe any changes or impact when\n   diverse-path has been enabled.\n\
    \   The proposed architecture deployed along with the BGP best-external\n   functionality\
    \ covers all three cases where the classic BGP route-\n   reflection paradigm\
    \ would fail to distribute alternate (diverse)\n   paths.  These are\n   1.  ASBRs\
    \ advertising their single best-external paths with no\n       LOCAL_PREF or MED\
    \ present.\n   2.  ASBRs advertising their single best-external paths with\n \
    \      LOCAL_PREF or MED present and with BGP best-external\n       functionality\
    \ enabled.\n   3.  ASBRs with multiple external paths.\n   This section focuses\
    \ on discussion of case 3 above in more detail.\n   This describes the scenario\
    \ of a single ASBR connected to multiple\n   EBGP peers.  In practice, this peering\
    \ scenario is quite common.  It\n   is mostly due to the geographic location of\
    \ EBGP peers and the\n   diversity of those peers (for example, peering to multiple\
    \ tier-1\n   ISPs, etc.).  It is not designed for failure-recovery scenarios,\
    \ as\n   single failure of the ASBR would simultaneously result in loss of\n \
    \  connectivity to all of the peers.  In most medium and large\n   geographically\
    \ distributed networks, there is always another ASBR or\n   multiple ASBRs providing\
    \ peering backups, typically in other\n   geographically diverse locations in\
    \ the network.\n   When an operator uses ASBRs with multiple peerings, setting\
    \ next-hop\n   self will effectively allow local repair of the atomic failure\
    \ of any\n   external peer without any compromise to the data plane.\n   Traditionally,\
    \ the most common reason for not setting next-hop self\n   is the associated drawback\
    \ of losing the ability to signal the\n   external failures of peering ASBRs or\
    \ links to those ASBRs by fast\n   IGP flooding.  Such a potential drawback can\
    \ be easily avoided by\n   using a different peering address from the address\
    \ used for next-hop\n   mapping and removing the next-hop from the IGP at the\
    \ last possible\n   BGP path failure.\n   Herein, one may correctly observe that\
    \ in the case of setting next-\n   hop self on an ASBR, attributes of other external\
    \ paths such that the\n   ASBR is peering with may be different from the attributes\
    \ of its best\n   external path.  Therefore, not injecting all of those external\
    \ paths\n   with their corresponding attributes cannot be compared to equivalent\n\
    \   paths for the same prefix coming from different ASBRs.\n   While such observation,\
    \ in principle, is correct, one should put\n   things in perspective of the overall\
    \ goal, which is to provide data-\n   plane connectivity upon a single failure\
    \ with minimal\n   interruption/packet loss.  During such transient conditions,\
    \ using\n   even potentially suboptimal exit points is reasonable, so long as\n\
    \   forwarding information loops are not introduced.  In the mean time,\n   the\
    \ BGP control plane will on its own re-advertise the newly elected\n   best external\
    \ path, and route-reflector planes will calculate their\n   Nth best paths and\
    \ propagate them to its clients.  The result is that\n   after seconds, even if\
    \ potential suboptimality were encountered, it\n   will be quickly and naturally\
    \ healed.\n"
- title: 7.  Summary of Benefits
  contents:
  - "7.  Summary of Benefits\n   Distribution of the diverse-BGP-paths proposal provides\
    \ the following\n   benefits when compared to the alternatives:\n   1.  No modifications\
    \ to the BGP4 protocol.\n   2.  No requirement for upgrades to edge and core routers\
    \ (as required\n       in [ADD-PATHS]).  It is backward compatible with the existing\
    \ BGP\n       deployments.\n   3.  Can be easily enabled by the introduction of\
    \ a new route\n       reflector, a route server plane dedicated to the selection\
    \ and\n       distribution of Nth best-path, or just by new configuration of\n\
    \       the upgraded current route reflector(s).\n   4.  Does not require major\
    \ modification to BGP implementations in the\n       entire network, which would\
    \ result in an unnecessary increase of\n       memory and CPU consumption due\
    \ to the shift from today's per-\n       prefix to a per-path advertisement state\
    \ tracking.\n   5.  Can be safely deployed gradually on an RR cluster basis.\n\
    \   6.  The proposed solution is equally applicable to any BGP address\n     \
    \  family as described in \"Multiprotocol Extensions for BGP-4\"\n       [RFC4760].\
    \  In particular, it can be used \"as is\" without any\n       modifications to\
    \ both IPv4 and IPv6 address families.\n"
- title: 8.  Applications
  contents:
  - "8.  Applications\n   This section lists the most common applications that require\
    \ the\n   presence of redundant BGP paths:\n   1.  Fast connectivity restoration\
    \ in which backup paths with\n       alternate exit points would be pre-installed\
    \ as well as\n       pre-resolved in the FIB of routers.  This allows for a local\n\
    \       action upon reception of a critical event notification of\n       network/node\
    \ failure.  This failure recovery mechanism that is\n       based on the presence\
    \ of backup paths is also suitable for\n       gracefully addressing scheduled\
    \ maintenance requirements as\n       described in [BGP-SHUTDOWN].\n   2.  Multi-path\
    \ load balancing for both IBGP and EBGP.\n   3.  BGP control-plane churn reduction\
    \ for both intra-domain and\n       inter-domain.\n   An important point to observe\
    \ is that all of the above intra-domain\n   applications are based on the use\
    \ of reflector planes but are also\n   applicable in the inter-domain Internet\
    \ exchange point examples.  As\n   discussed in Section 4.3, an Internet exchange\
    \ can conceptually\n   deploy shadow route server planes, each responsible for\
    \ distribution\n   of an Nth best path to its EBGP peers.  In practice, it may\
    \ just be\n   equal to a new short configuration and establishment of new BGP\n\
    \   sessions to IX peers.\n"
- title: 9.  Security Considerations
  contents:
  - "9.  Security Considerations\n   The new mechanism for diverse BGP path dissemination\
    \ proposed in this\n   document does not introduce any new security concerns as\
    \ compared to\n   the base BGP4 specification [RFC4271] and especially when compared\n\
    \   against full-IBGP-mesh topology.\n   In addition, the authors observe that\
    \ all BGP security issues as\n   described in [RFC4272] apply to the additional\
    \ BGP session or\n   sessions as recommended by this specification.  Therefore,\
    \ all\n   recommended mitigation techniques to BGP security are applicable\n \
    \  here.\n"
- title: 10.  Contributors
  contents:
  - "10.  Contributors\n   The following people contributed significantly to the content\
    \ of the\n   document:\n   Selma Yilmaz\n   Cisco Systems\n   170 West Tasman\
    \ Drive\n   San Jose, CA 95134\n   US\n   Email: seyilmaz@cisco.com\n   Satish\
    \ Mynam\n   Juniper Networks\n   1194 N. Mathilda Ave\n   Sunnyvale, CA 94089\n\
    \   US\n   Email: smynam@juniper.net\n   Isidor Kouvelas\n   Cisco Systems\n \
    \  170 West Tasman Drive\n   San Jose, CA 95134\n   US\n   Email: kouvelas@cisco.com\n"
- title: 11.  Acknowledgments
  contents:
  - "11.  Acknowledgments\n   The authors would like to thank Bruno Decraene, Bart\
    \ Peirens, Eric\n   Rosen, Jim Uttaro, Renwei Li, Wes George, and Adrian Farrel\
    \ for their\n   valuable input.\n   The authors would also like to express a special\
    \ thank you to a\n   number of operators who helped optimize the provided solution\
    \ to be\n   as close as possible to their daily operational practices.  In\n \
    \  particular, many thanks to Ted Seely, Shane Amante, Benson\n   Schliesser,\
    \ and Seiichi Kawamura.\n"
- title: 12.  References
  contents:
  - '12.  References

    '
- title: 12.1.  Normative References
  contents:
  - "12.1.  Normative References\n   [RFC4271]   Rekhter, Y., Ed., Li, T., Ed., and\
    \ S. Hares, Ed., \"A\n               Border Gateway Protocol 4 (BGP-4)\", RFC\
    \ 4271, January\n               2006.\n   [RFC4456]   Bates, T., Chen, E., and\
    \ R. Chandra, \"BGP Route\n               Reflection: An Alternative to Full Mesh\
    \ Internal BGP\n               (IBGP)\", RFC 4456, April 2006.\n   [RFC4760] \
    \  Bates, T., Chandra, R., Katz, D., and Y. Rekhter,\n               \"Multiprotocol\
    \ Extensions for BGP-4\", RFC 4760, January\n               2007.\n   [RFC5226]\
    \   Narten, T. and H. Alvestrand, \"Guidelines for Writing an\n              \
    \ IANA Considerations Section in RFCs\", BCP 26, RFC 5226,\n               May\
    \ 2008.\n"
- title: 12.2.  Informative References
  contents:
  - "12.2.  Informative References\n   [ADD-PATHS] Walton, D., Chen, E., Retana, A.,\
    \ and J. Scudder,\n               \"Advertisement of Multiple Paths in BGP\",\
    \ Work in\n               Progress, June 2012.\n   [AUTO-MESH] Raszuk, R., \"\
    IBGP Auto Mesh\", Work in Progress, January\n               2004.\n   [BGP-SHUTDOWN]\n\
    \               Decraene, B., Francois, P., Pelsser, C., Ahmad, Z., and\n    \
    \           A.  Armengol, \"Requirements for the Graceful Shutdown of\n      \
    \         BGP Sessions\", Work in Progress, September 2009.\n   [EXT-PATH]  Marques,\
    \ P., Fernando, R., Chen, E., Mohapatra, P., and\n               H. Gredler, \"\
    Advertisement of the Best External Route in\n               BGP\", Work in Progress,\
    \ January 2012.\n   [FAST-CONN] Mohapatra, P., Fernando, R., Filsfils, C., and\
    \ R. Raszuk,\n               \"Fast Connectivity Restoration Using BGP Add-path\"\
    , Work\n               in Progress), October 2011.\n   [RFC3345]   McPherson,\
    \ D., Gill, V., Walton, D., and A. Retana,\n               \"Border Gateway Protocol\
    \ (BGP) Persistent Route\n               Oscillation Condition\", RFC 3345, August\
    \ 2002.\n   [RFC4272]   Murphy, S., \"BGP Security Vulnerabilities Analysis\"\
    , RFC\n               4272, January 2006.\n   [RFC5065]   Traina, P., McPherson,\
    \ D., and J. Scudder, \"Autonomous\n               System Confederations for BGP\"\
    , RFC 5065, August 2007.\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Robert Raszuk (editor)\n   NTT MCL\n   101 S Ellsworth\
    \ Avenue Suite 350\n   San Mateo, CA 94401\n   United States\n   EMail: robert@raszuk.net\n\
    \   Rex Fernando\n   Cisco Systems\n   170 West Tasman Drive\n   San Jose, CA\
    \ 95134\n   United States\n   EMail: rex@cisco.com\n   Keyur Patel\n   Cisco Systems\n\
    \   170 West Tasman Drive\n   San Jose, CA 95134\n   United States\n   EMail:\
    \ keyupate@cisco.com\n   Danny McPherson\n   Verisign, Inc.\n   12061 Bluemont\
    \ Way\n   Reston, VA  20190\n   United States\n   EMail: dmcpherson@verisign.com\n\
    \   Kenji Kumaki\n   KDDI Corporation\n   Garden Air Tower\n   Iidabashi, Chiyoda-ku,\
    \ Tokyo 102-8460\n   Japan\n   EMail: ke-kumaki@kddi.com\n"
