- title: __initial_text__
  contents:
  - "         5543, 5701, 6368                               Juniper Networks\n  \
    \           Revised Error Handling for BGP UPDATE Messages\n"
- title: Abstract
  contents:
  - "Abstract\n   According to the base BGP specification, a BGP speaker that receives\n\
    \   an UPDATE message containing a malformed attribute is required to\n   reset\
    \ the session over which the offending attribute was received.\n   This behavior\
    \ is undesirable because a session reset would impact not\n   only routes with\
    \ the offending attribute but also other valid routes\n   exchanged over the session.\
    \  This document partially revises the\n   error handling for UPDATE messages\
    \ and provides guidelines for the\n   authors of documents defining new attributes.\
    \  Finally, it revises\n   the error handling procedures for a number of existing\
    \ attributes.\n   This document updates error handling for RFCs 1997, 4271, 4360,\
    \ 4456,\n   4760, 5543, 5701, and 6368.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This\
    \ document is a product of the Internet Engineering Task Force\n   (IETF).  It\
    \ represents the consensus of the IETF community.  It has\n   received public\
    \ review and has been approved for publication by the\n   Internet Engineering\
    \ Steering Group (IESG).  Further information on\n   Internet Standards is available\
    \ in Section 2 of RFC 5741.\n   Information about the current status of this document,\
    \ any errata,\n   and how to provide feedback on it may be obtained at\n   http://www.rfc-editor.org/info/rfc7606.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2015 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (http://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.  Code Components\
    \ extracted from this document must\n   include Simplified BSD License text as\
    \ described in Section 4.e of\n   the Trust Legal Provisions and are provided\
    \ without warranty as\n   described in the Simplified BSD License.\n   This document\
    \ may contain material from IETF Documents or IETF\n   Contributions published\
    \ or made publicly available before November\n   10, 2008.  The person(s) controlling\
    \ the copyright in some of this\n   material may not have granted the IETF Trust\
    \ the right to allow\n   modifications of such material outside the IETF Standards\
    \ Process.\n   Without obtaining an adequate license from the person(s) controlling\n\
    \   the copyright in such materials, this document may not be modified\n   outside\
    \ the IETF Standards Process, and derivative works of it may\n   not be created\
    \ outside the IETF Standards Process, except to format\n   it for publication\
    \ as an RFC or to translate it into languages other\n   than English.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1.  Introduction  . . . . . . . . . . . . . . . . . . .\
    \ . . . . .   4\n     1.1.  Requirements Language . . . . . . . . . . . . . .\
    \ . . . .   4\n   2.  Error-Handling Approaches . . . . . . . . . . . . . . .\
    \ . . .   5\n   3.  Revision to BGP UPDATE Message Error Handling . . . . . .\
    \ . .   5\n   4.  Attribute Length Fields . . . . . . . . . . . . . . . . . .\
    \ .   7\n   5.  Parsing of Network Layer Reachability Information (NLRI)\n   \
    \    Fields  . . . . . . . . . . . . . . . . . . . . . . . . . . .   8\n     5.1.\
    \  Encoding NLRI . . . . . . . . . . . . . . . . . . . . . .   8\n     5.2.  Missing\
    \ NLRI  . . . . . . . . . . . . . . . . . . . . . .   8\n     5.3.  Syntactic\
    \ Correctness of NLRI Fields  . . . . . . . . . .   9\n     5.4.  Typed NLRI \
    \ . . . . . . . . . . . . . . . . . . . . . . .   9\n   6.  Operational Considerations\
    \  . . . . . . . . . . . . . . . . .  10\n   7.  Error-Handling Procedures for\
    \ Existing Attributes . . . . . .  11\n     7.1.  ORIGIN  . . . . . . . . . .\
    \ . . . . . . . . . . . . . . .  11\n     7.2.  AS_PATH . . . . . . . . . . .\
    \ . . . . . . . . . . . . . .  11\n     7.3.  NEXT_HOP  . . . . . . . . . . .\
    \ . . . . . . . . . . . . .  12\n     7.4.  MULTI_EXIT_DISC . . . . . . . . .\
    \ . . . . . . . . . . . .  12\n     7.5.  LOCAL_PREF  . . . . . . . . . . . .\
    \ . . . . . . . . . . .  12\n     7.6.  ATOMIC_AGGREGATE  . . . . . . . . . .\
    \ . . . . . . . . . .  12\n     7.7.  AGGREGATOR  . . . . . . . . . . . . . .\
    \ . . . . . . . . .  13\n     7.8.  Community . . . . . . . . . . . . . . . .\
    \ . . . . . . . .  13\n     7.9.  ORIGINATOR_ID . . . . . . . . . . . . . . .\
    \ . . . . . . .  13\n     7.10. CLUSTER_LIST  . . . . . . . . . . . . . . . .\
    \ . . . . . .  13\n     7.11. MP_REACH_NLRI . . . . . . . . . . . . . . . . .\
    \ . . . . .  14\n     7.12. MP_UNREACH_NLRI . . . . . . . . . . . . . . . . .\
    \ . . . .  14\n     7.13. Traffic Engineering Path Attribute  . . . . . . . .\
    \ . . .  14\n     7.14. Extended Community  . . . . . . . . . . . . . . . . .\
    \ . .  14\n     7.15. IPv6 Address Specific BGP Extended Community Attribute \
    \ .  15\n     7.16. ATTR_SET  . . . . . . . . . . . . . . . . . . . . . . . .\
    \  15\n   8.  Guidance for Authors of BGP Specifications  . . . . . . . . .  15\n\
    \   9.  Security Considerations . . . . . . . . . . . . . . . . . . .  16\n  \
    \ 10. References  . . . . . . . . . . . . . . . . . . . . . . . . .  17\n    \
    \ 10.1.  Normative References . . . . . . . . . . . . . . . . . .  17\n     10.2.\
    \  Informative References . . . . . . . . . . . . . . . . .  18\n   Acknowledgements\
    \  . . . . . . . . . . . . . . . . . . . . . . . .  19\n   Authors' Addresses\
    \  . . . . . . . . . . . . . . . . . . . . . . .  19\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   According to the base BGP specification [RFC4271], a BGP\
    \ speaker that\n   receives an UPDATE message containing a malformed attribute\
    \ is\n   required to reset the session over which the offending attribute was\n\
    \   received.  This behavior is undesirable because a session reset\n   impacts\
    \ not only routes with the offending attribute but also other\n   valid routes\
    \ exchanged over the session.  In the case of optional\n   transitive attributes,\
    \ the behavior is especially troublesome and may\n   present a potential security\
    \ vulnerability.  This is because\n   attributes may have been propagated without\
    \ being checked by\n   intermediate routers that don't recognize the attributes.\
    \  In effect,\n   the attributes may have been tunneled; when they reach a router\
    \ that\n   recognizes and checks the attributes, the session that is reset may\n\
    \   not be associated with the router that is at fault.  To make matters\n   worse,\
    \ in such cases, although the problematic attributes may have\n   originated with\
    \ a single update transmitted by a single BGP speaker,\n   by the time they encounter\
    \ a router that checks them they may have\n   been replicated many times and thus\
    \ may cause the reset of many\n   peering sessions.  Thus, the damage inflicted\
    \ may be multiplied\n   manyfold.\n   The goal for revising the error handling\
    \ for UPDATE messages is to\n   minimize the impact on routing by a malformed\
    \ UPDATE message while\n   maintaining protocol correctness to the extent possible.\
    \  This can be\n   achieved largely by maintaining the established session and\
    \ keeping\n   the valid routes exchanged but removing the routes carried in the\n\
    \   malformed UPDATE message from the routing system.\n   This document partially\
    \ revises the error handling for UPDATE\n   messages and provides guidelines for\
    \ the authors of documents\n   defining new attributes.  Finally, it revises the\
    \ error handling\n   procedures for a number of existing attributes.  Specifically,\
    \ the\n   error handling procedures of [RFC1997], [RFC4271], [RFC4360],\n   [RFC4456],\
    \ [RFC4760], [RFC5543], [RFC5701], and [RFC6368] are\n   revised.\n"
- title: 1.1.  Requirements Language
  contents:
  - "1.1.  Requirements Language\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\"\
    , \"SHALL\", \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"\
    MAY\", and \"OPTIONAL\" in this\n   document are to be interpreted as described\
    \ in RFC 2119 [RFC2119].\n"
- title: 2.  Error-Handling Approaches
  contents:
  - "2.  Error-Handling Approaches\n   In this document, we refer to four different\
    \ approaches to handle\n   errors found in a BGP UPDATE message.  They are as\
    \ follows (listed in\n   order, from the one with the \"strongest\" action to\
    \ the one with the\n   \"weakest\" action):\n   o  Session reset: This is the\
    \ approach used throughout the base BGP\n      specification [RFC4271], where\
    \ a NOTIFICATION is sent and the\n      session terminated.\n   o  AFI/SAFI disable:\
    \ Section 7 of [RFC4760] allows a BGP speaker that\n      detects an error in\
    \ a message for a given AFI/SAFI to optionally\n      \"ignore all the subsequent\
    \ routes with that AFI/SAFI received over\n      that session\".  We refer to\
    \ this as \"disabling a particular AFI/\n      SAFI\" or \"AFI/SAFI disable\"\
    .\n   o  Treat-as-withdraw: In this approach, the UPDATE message containing\n\
    \      the path attribute in question MUST be treated as though all\n      contained\
    \ routes had been withdrawn just as if they had been\n      listed in the WITHDRAWN\
    \ ROUTES field (or in the MP_UNREACH_NLRI\n      attribute if appropriate) of\
    \ the UPDATE message, thus causing them\n      to be removed from the Adj-RIB-In\
    \ according to the procedures of\n      [RFC4271].\n   o  Attribute discard: In\
    \ this approach, the malformed attribute MUST\n      be discarded and the UPDATE\
    \ message continues to be processed.\n      This approach MUST NOT be used except\
    \ in the case of an attribute\n      that has no effect on route selection or\
    \ installation.\n"
- title: 3.  Revision to BGP UPDATE Message Error Handling
  contents:
  - "3.  Revision to BGP UPDATE Message Error Handling\n   This specification amends\
    \ Section 6.3 of [RFC4271] in a number of\n   ways.  See Section 7 for treatment\
    \ of specific path attributes.\n   a.  The first paragraph is revised as follows:\n\
    \          Old Text:\n             All errors detected while processing the UPDATE\
    \ message\n             MUST be indicated by sending the NOTIFICATION message\
    \ with\n             the Error Code UPDATE Message Error.  The error subcode\n\
    \             elaborates on the specific nature of the error.\n          New Text:\n\
    \             An error detected while processing the UPDATE message for\n    \
    \         which a session reset is specified MUST be indicated by\n          \
    \   sending the NOTIFICATION message with the Error Code UPDATE\n            \
    \ Message Error.  The error subcode elaborates on the\n             specific nature\
    \ of the error.\n   b.  Error handling for the following case remains unchanged:\n\
    \             If the Withdrawn Routes Length or Total Attribute Length is\n  \
    \           too large (i.e., if Withdrawn Routes Length + Total\n            \
    \ Attribute Length + 23 exceeds the message Length), then the\n             Error\
    \ Subcode MUST be set to Malformed Attribute List.\n   c.  Attribute Flag error\
    \ handling is revised as follows:\n          Old Text:\n             If any recognized\
    \ attribute has Attribute Flags that\n             conflict with the Attribute\
    \ Type Code, then the Error\n             Subcode MUST be set to Attribute Flags\
    \ Error.  The Data\n             field MUST contain the erroneous attribute (type,\
    \ length,\n             and value).\n          New Text:\n             If the\
    \ value of either the Optional or Transitive bits in\n             the Attribute\
    \ Flags is in conflict with their specified\n             values, then the attribute\
    \ MUST be treated as malformed and\n             the \"treat-as-withdraw\" approach\
    \ used, unless the\n             specification for the attribute mandates different\
    \ handling\n             for incorrect Attribute Flags.\n   d.  If any of the\
    \ well-known mandatory attributes are not present in\n       an UPDATE message,\
    \ then \"treat-as-withdraw\" MUST be used.  (Note\n       that [RFC4760] reclassifies\
    \ NEXT_HOP as what is effectively\n       discretionary.)\n   e.  \"Treat-as-withdraw\"\
    \ MUST be used for the cases that specify a\n       session reset and involve\
    \ any of the attributes ORIGIN, AS_PATH,\n       NEXT_HOP, MULTI_EXIT_DISC, or\
    \ LOCAL_PREF.\n   f.  \"Attribute discard\" MUST be used for any of the cases\
    \ that\n       specify a session reset and involve ATOMIC_AGGREGATE or\n     \
    \  AGGREGATOR.\n   g.  If the MP_REACH_NLRI attribute or the MP_UNREACH_NLRI [RFC4760]\n\
    \       attribute appears more than once in the UPDATE message, then a\n     \
    \  NOTIFICATION message MUST be sent with the Error Subcode\n       \"Malformed\
    \ Attribute List\".  If any other attribute (whether\n       recognized or unrecognized)\
    \ appears more than once in an UPDATE\n       message, then all the occurrences\
    \ of the attribute other than the\n       first one SHALL be discarded and the\
    \ UPDATE message will continue\n       to be processed.\n   h.  When multiple\
    \ attribute errors exist in an UPDATE message, if the\n       same approach (as\
    \ described in Section 2) is specified for the\n       handling of these malformed\
    \ attributes, then the specified\n       approach MUST be used.  Otherwise, the\
    \ approach with the\n       strongest action MUST be used.\n   i.  The Withdrawn\
    \ Routes field MUST be checked for syntactic\n       correctness in the same manner\
    \ as the NLRI field.  This is\n       discussed further below and in Section 5.3.\n\
    \   j.  Finally, we observe that in order to use the approach of \"treat-\n  \
    \     as-withdraw\", the entire NLRI field and/or the MP_REACH_NLRI and\n    \
    \   MP_UNREACH_NLRI attributes need to be successfully parsed -- what\n      \
    \ this entails is discussed in more detail in Section 5.  If this\n       is not\
    \ possible, the procedures of [RFC4271] and/or [RFC4760]\n       continue to apply,\
    \ meaning that the \"session reset\" approach (or\n       the \"AFI/SAFI disable\"\
    \ approach) MUST be followed.\n"
- title: 4.  Attribute Length Fields
  contents:
  - "4.  Attribute Length Fields\n   There are two error cases in which the Total\
    \ Attribute Length value\n   can be in conflict with the enclosed path attributes,\
    \ which\n   themselves carry length values:\n   o  In the first case, the length\
    \ of the last encountered path\n      attribute would cause the Total Attribute\
    \ Length to be exceeded\n      when parsing the enclosed path attributes.\n  \
    \ o  In the second case, fewer than three octets remain (or fewer than\n     \
    \ four octets, if the Attribute Flags field has the Extended Length\n      bit\
    \ set) when beginning to parse the attribute.  That is, this\n      case exists\
    \ if there remains unconsumed data in the path\n      attributes but yet insufficient\
    \ data to encode a single minimum-\n      sized path attribute.\n   In either\
    \ of these cases, an error condition exists and the \"treat-\n   as-withdraw\"\
    \ approach MUST be used (unless some other, more severe\n   error is encountered\
    \ dictating a stronger approach), and the Total\n   Attribute Length MUST be relied\
    \ upon to enable the beginning of the\n   NLRI field to be located.\n   For all\
    \ path attributes other than those specified as having an\n   attribute length\
    \ that may be zero, it SHALL be considered a syntax\n   error for the attribute\
    \ to have a length of zero.  Of the path\n   attributes considered in this specification,\
    \ only AS_PATH and\n   ATOMIC_AGGREGATE may validly have an attribute length of\
    \ zero.\n"
- title: 5.  Parsing of Network Layer Reachability Information (NLRI) Fields
  contents:
  - '5.  Parsing of Network Layer Reachability Information (NLRI) Fields

    '
- title: 5.1.  Encoding NLRI
  contents:
  - "5.1.  Encoding NLRI\n   To facilitate the determination of the NLRI field in\
    \ an UPDATE\n   message with a malformed attribute:\n   o  The MP_REACH_NLRI or\
    \ MP_UNREACH_NLRI attribute (if present) SHALL\n      be encoded as the very first\
    \ path attribute in an UPDATE message.\n   o  An UPDATE message MUST NOT contain\
    \ more than one of the following:\n      non-empty Withdrawn Routes field, non-empty\
    \ Network Layer\n      Reachability Information field, MP_REACH_NLRI attribute,\
    \ and\n      MP_UNREACH_NLRI attribute.\n   Since older BGP speakers may not implement\
    \ these restrictions, an\n   implementation MUST still be prepared to receive\
    \ these fields in any\n   position or combination.\n   If the encoding of [RFC4271]\
    \ is used, the NLRI field for the IPv4\n   unicast address family is carried immediately\
    \ following all the\n   attributes in an UPDATE message.  When such an UPDATE\
    \ message is\n   received, we observe that the NLRI field can be determined using\
    \ the\n   Message Length, Withdrawn Route Length, and Total Attribute Length\n\
    \   (when they are consistent) carried in the message instead of relying\n   on\
    \ the length of individual attributes in the message.\n"
- title: 5.2.  Missing NLRI
  contents:
  - "5.2.  Missing NLRI\n   [RFC4724] specifies an End-of-RIB message (EoR) that can\
    \ be encoded\n   as an UPDATE message that contains only a MP_UNREACH_NLRI attribute\n\
    \   that encodes no NLRI (it can also be a completely empty UPDATE\n   message\
    \ in the case of the \"legacy\" encoding).  In all other well-\n   specified cases,\
    \ an UPDATE message either carries only withdrawn\n   routes (either in the Withdrawn\
    \ Routes field or the MP_UNREACH_NLRI\n   attribute) or it advertises reachable\
    \ routes (either in the Network\n   Layer Reachability Information field or the\
    \ MP_REACH_NLRI attribute).\n   Thus, if an UPDATE message is encountered that\
    \ does contain path\n   attributes other than MP_UNREACH_NLRI and doesn't encode\
    \ any\n   reachable NLRI, we cannot be confident that the NLRI have been\n   successfully\
    \ parsed as Section 3 (j) requires.  For this reason, if\n   any path attribute\
    \ errors are encountered in such an UPDATE message\n   and if any encountered\
    \ error specifies an error-handling approach\n   other than \"attribute discard\"\
    , then the \"session reset\" approach\n   MUST be used.\n"
- title: 5.3.  Syntactic Correctness of NLRI Fields
  contents:
  - "5.3.  Syntactic Correctness of NLRI Fields\n   The NLRI field or Withdrawn Routes\
    \ field SHALL be considered\n   \"syntactically incorrect\" if either of the following\
    \ are true:\n   o  The length of any of the included NLRI is greater than 32.\n\
    \   o  When parsing NLRI contained in the field, the length of the last\n    \
    \  NLRI found exceeds the amount of unconsumed data remaining in the\n      field.\n\
    \   Similarly, the MP_REACH_NLRI or MP_UNREACH_NLRI attribute of an\n   update\
    \ SHALL be considered to be incorrect if any of the following\n   are true:\n\
    \   o  The length of any of the included NLRI is inconsistent with the\n     \
    \ given AFI/SAFI (for example, if an IPv4 NLRI has a length greater\n      than\
    \ 32 or an IPv6 NLRI has a length greater than 128).\n   o  When parsing NLRI\
    \ contained in the attribute, the length of the\n      last NLRI found exceeds\
    \ the amount of unconsumed data remaining in\n      the attribute.\n   o  The\
    \ attribute flags of the attribute are inconsistent with those\n      specified\
    \ in [RFC4760].\n   o  The length of the MP_UNREACH_NLRI attribute is less than\
    \ 3, or the\n      length of the MP_REACH_NLRI attribute is less than 5.\n"
- title: 5.4.  Typed NLRI
  contents:
  - "5.4.  Typed NLRI\n   Certain address families, for example, MCAST-VPN [RFC6514],\
    \ MCAST-\n   VPLS [RFC7117], and EVPN [RFC7432] have NLRI that are typed.  Since\n\
    \   supported type values within the address family are not expressed in\n   the\
    \ Multiprotocol BGP (MP-BGP) capability [RFC4760], it is possible\n   for a BGP\
    \ speaker to advertise support for the given address family\n   and subaddress\
    \ family while still not supporting a particular type of\n   NLRI within that\
    \ AFI/SAFI.\n   A BGP speaker advertising support for such a typed address family\n\
    \   MUST handle routes with unrecognized NLRI types within that address\n   family\
    \ by discarding them, unless the relevant specification for that\n   address family\
    \ specifies otherwise.\n"
- title: 6.  Operational Considerations
  contents:
  - "6.  Operational Considerations\n   Although the \"treat-as-withdraw\" error-handling\
    \ behavior defined in\n   Section 2 makes every effort to preserve BGP's correctness,\
    \ we note\n   that if an UPDATE message received on an Internal BGP (IBGP) session\n\
    \   is subjected to this treatment, inconsistent routing within the\n   affected\
    \ Autonomous System may result.  The consequences of\n   inconsistent routing\
    \ can include long-lived forwarding loops and\n   black holes.  While lamentable,\
    \ this issue is expected to be rare in\n   practice, and, more importantly, is\
    \ seen as less problematic than the\n   session-reset behavior it replaces.\n\
    \   When a malformed attribute is indeed detected over an IBGP session,\n   we\
    \ recommend that routes with the malformed attribute be identified\n   and traced\
    \ back to the ingress router in the network where the routes\n   were sourced\
    \ or received externally and then a filter be applied on\n   the ingress router\
    \ to prevent the routes from being sourced or\n   received.  This will help maintain\
    \ routing consistency in the\n   network.\n   Even if inconsistent routing does\
    \ not arise, the \"treat-as-withdraw\"\n   behavior can cause either complete\
    \ unreachability or suboptimal\n   routing for the destinations whose routes are\
    \ carried in the affected\n   UPDATE message.\n   Note that \"treat-as-withdraw\"\
    \ is different from discarding an UPDATE\n   message.  The latter violates the\
    \ basic BGP principle of an\n   incremental update and could cause invalid routes\
    \ to be kept.\n   Because of these potential issues, a BGP speaker must provide\n\
    \   debugging facilities to permit issues caused by a malformed attribute\n  \
    \ to be diagnosed.  At a minimum, such facilities must include logging\n   an\
    \ error listing the NLRI involved and containing the entire\n   malformed UPDATE\
    \ message when such an attribute is detected.  The\n   malformed UPDATE message\
    \ should be analyzed, and the root cause\n   should be investigated.\n   Section\
    \ 8 mentions that \"attribute discard\" should not be used in\n   cases where\
    \ \"the attribute in question has or may have an effect on\n   route selection.\"\
    \  Although all cases that specify \"attribute\n   discard\" in this document\
    \ do not affect route selection by default,\n   in principle, routing policies\
    \ could be written that affect selection\n   based on such an attribute.  Operators\
    \ should take care when writing\n   such policies to consider the possible consequences\
    \ of an attribute\n   discard.  In general, as long as such policies are only\
    \ applied to\n   external BGP sessions, correctness issues are not expected to\
    \ arise.\n"
- title: 7.  Error-Handling Procedures for Existing Attributes
  contents:
  - "7.  Error-Handling Procedures for Existing Attributes\n   In the following subsections,\
    \ we elaborate on the conditions for\n   error-checking various path attributes\
    \ and specify what approach(es)\n   should be used to handle malformations.  It\
    \ is possible that\n   implementations may apply other error checks not contemplated\
    \ here.\n   If so, the error handling approach given here should generally be\n\
    \   applied.\n   This section addresses all path attributes that are defined at\
    \ the\n   time of this writing that were not defined with error handling\n   consistent\
    \ with Section 8 and that are not marked as \"deprecated\" in\n   the \"BGP Path\
    \ Attributes\" registry [IANA-BGP-ATTRS].  Attributes 17\n   (AS4_PATH), 18 (AS4_AGGREGATOR),\
    \ 22 (PMSI_TUNNEL), 23 (Tunnel\n   Encapsulation Attribute), 26 (AIGP), 27 (PE\
    \ Distinguisher Labels),\n   and 29 (BGP-LS Attribute) do have error handling\
    \ consistent with\n   Section 8 and thus are not further discussed herein.  Attributes\
    \ 11\n   (DPA), 12 (ADVERTISER), 13 (RCID_PATH / CLUSTER_ID), 19 (SAFI\n   Specific\
    \ Attribute), 20 (Connector Attribute), 21 (AS_PATHLIMIT), and\n   28 (BGP Entropy\
    \ Label Capability Attribute) are deprecated and thus\n   are not further discussed\
    \ herein.\n"
- title: 7.1.  ORIGIN
  contents:
  - "7.1.  ORIGIN\n   The attribute is considered malformed if its length is not 1\
    \ or if it\n   has an undefined value [RFC4271].\n   An UPDATE message with a\
    \ malformed ORIGIN attribute SHALL be handled\n   using the approach of \"treat-as-withdraw\"\
    .\n"
- title: 7.2.  AS_PATH
  contents:
  - "7.2.  AS_PATH\n   An AS_PATH is considered malformed if an unrecognized segment\
    \ type is\n   encountered or if it contains a malformed segment.  A segment is\n\
    \   considered malformed if any of the following are true:\n   o  There is an\
    \ overrun where the Path Segment Length field of the\n      last segment encountered\
    \ would cause the Attribute Length to be\n      exceeded.\n   o  There is an underrun\
    \ where after the last successfully parsed\n      segment there is only a single\
    \ octet remaining (that is, there is\n      not enough unconsumed data to provide\
    \ even an empty segment\n      header).\n   o  It has a Path Segment Length field\
    \ of zero.\n   An UPDATE message with a malformed AS_PATH attribute SHALL be handled\n\
    \   using the approach of \"treat-as-withdraw\".\n   [RFC4271] also says that\
    \ an implementation optionally \"MAY check\n   whether the leftmost ... AS in\
    \ the AS_PATH attribute is equal to the\n   autonomous system number of the peer\
    \ that sent the message\".  A BGP\n   implementation SHOULD also handle routes\
    \ that violate this check\n   using \"treat-as-withdraw\" but MAY follow the \"\
    session reset\" behavior\n   if configured to do so.\n"
- title: 7.3.  NEXT_HOP
  contents:
  - "7.3.  NEXT_HOP\n   The attribute is considered malformed if its length is not\
    \ 4\n   [RFC4271].\n   An UPDATE message with a malformed NEXT_HOP attribute SHALL\
    \ be\n   handled using the approach of \"treat-as-withdraw\".\n"
- title: 7.4.  MULTI_EXIT_DISC
  contents:
  - "7.4.  MULTI_EXIT_DISC\n   The attribute is considered malformed if its length\
    \ is not 4\n   [RFC4271].\n   An UPDATE message with a malformed MULTI_EXIT_DISC\
    \ attribute SHALL be\n   handled using the approach of \"treat-as-withdraw\".\n"
- title: 7.5.  LOCAL_PREF
  contents:
  - "7.5.  LOCAL_PREF\n   The error handling of [RFC4271] is revised as follows:\n\
    \   o  if the LOCAL_PREF attribute is received from an external neighbor,\n  \
    \    it SHALL be discarded using the approach of \"attribute discard\";\n    \
    \  or\n   o  if received from an internal neighbor, it SHALL be considered\n \
    \     malformed if its length is not equal to 4.  If malformed, the\n      UPDATE\
    \ message SHALL be handled using the approach of \"treat-as-\n      withdraw\"\
    .\n"
- title: 7.6.  ATOMIC_AGGREGATE
  contents:
  - "7.6.  ATOMIC_AGGREGATE\n   The attribute SHALL be considered malformed if its\
    \ length is not 0\n   [RFC4271].\n   An UPDATE message with a malformed ATOMIC_AGGREGATE\
    \ attribute SHALL\n   be handled using the approach of \"attribute discard\".\n"
- title: 7.7.  AGGREGATOR
  contents:
  - "7.7.  AGGREGATOR\n   The error conditions specified in [RFC4271] for the attribute\
    \ are\n   revised as follows:\n   The AGGREGATOR attribute SHALL be considered\
    \ malformed if any of the\n   following applies:\n   o  Its length is not 6 (when\
    \ the 4-octet AS number capability is not\n      advertised to or not received\
    \ from the peer [RFC6793]).\n   o  Its length is not 8 (when the 4-octet AS number\
    \ capability is both\n      advertised to and received from the peer).\n   An\
    \ UPDATE message with a malformed AGGREGATOR attribute SHALL be\n   handled using\
    \ the approach of \"attribute discard\".\n"
- title: 7.8.  Community
  contents:
  - "7.8.  Community\n   The error handling of [RFC1997] is revised as follows:\n\
    \   o  The Community attribute SHALL be considered malformed if its\n      length\
    \ is not a non-zero multiple of 4.\n   o  An UPDATE message with a malformed Community\
    \ attribute SHALL be\n      handled using the approach of \"treat-as-withdraw\"\
    .\n"
- title: 7.9.  ORIGINATOR_ID
  contents:
  - "7.9.  ORIGINATOR_ID\n   The error handling of [RFC4456] is revised as follows:\n\
    \   o  if the ORIGINATOR_ID attribute is received from an external\n      neighbor,\
    \ it SHALL be discarded using the approach of \"attribute\n      discard\"; or\n\
    \   o  if received from an internal neighbor, it SHALL be considered\n      malformed\
    \ if its length is not equal to 4.  If malformed, the\n      UPDATE message SHALL\
    \ be handled using the approach of \"treat-as-\n      withdraw\".\n"
- title: 7.10.  CLUSTER_LIST
  contents:
  - "7.10.  CLUSTER_LIST\n   The error handling of [RFC4456] is revised as follows:\n\
    \   o  if the CLUSTER_LIST attribute is received from an external\n      neighbor,\
    \ it SHALL be discarded using the approach of \"attribute\n      discard\"; or\n\
    \   o  if received from an internal neighbor, it SHALL be considered\n      malformed\
    \ if its length is not a non-zero multiple of 4.  If\n      malformed, the UPDATE\
    \ message SHALL be handled using the approach\n      of \"treat-as-withdraw\"\
    .\n"
- title: 7.11.  MP_REACH_NLRI
  contents:
  - "7.11.  MP_REACH_NLRI\n   If the Length of Next Hop Network Address field of the\
    \ MP_REACH\n   attribute is inconsistent with that which was expected, the attribute\n\
    \   is considered malformed.  Since the next hop precedes the NLRI field\n   in\
    \ the attribute, in this case it will not be possible to reliably\n   locate the\
    \ NLRI; thus, the \"session reset\" or \"AFI/SAFI disable\"\n   approach MUST\
    \ be used.\n   \"That which was expected\", while somewhat vague, is intended\
    \ to\n   encompass the next hop specified for the Address Family Identifier\n\
    \   and Subsequent Address Family Identifier fields and is potentially\n   modified\
    \ by any extensions in use.  For example, if [RFC5549] is in\n   use, then the\
    \ next hop would have to have a length of 4 or 16.\n   Sections 3 and 5 provide\
    \ further discussion of the handling of this\n   attribute.\n"
- title: 7.12.  MP_UNREACH_NLRI
  contents:
  - "7.12.  MP_UNREACH_NLRI\n   Sections 3 and 5 discuss the handling of this attribute.\n"
- title: 7.13.  Traffic Engineering Path Attribute
  contents:
  - "7.13.  Traffic Engineering Path Attribute\n   We note that [RFC5543] does not\
    \ detail what constitutes\n   \"malformation\" for the Traffic Engineering path\
    \ attribute.  A future\n   update to that specification may provide more guidance.\
    \  In the\n   interim, an implementation that determines (for whatever reason)\
    \ that\n   an UPDATE message contains a malformed Traffic Engineering path\n \
    \  attribute MUST handle it using the approach of \"treat-as-withdraw\".\n"
- title: 7.14.  Extended Community
  contents:
  - "7.14.  Extended Community\n   The error handling of [RFC4360] is revised as follows:\n\
    \   o  The Extended Community attribute SHALL be considered malformed if\n   \
    \   its length is not a non-zero multiple of 8.\n   o  An UPDATE message with\
    \ a malformed Extended Community attribute\n      SHALL be handled using the approach\
    \ of \"treat-as-withdraw\".\n   Note that a BGP speaker MUST NOT treat an unrecognized\
    \ Extended\n   Community Type or Sub-Type as an error.\n"
- title: 7.15.  IPv6 Address Specific BGP Extended Community Attribute
  contents:
  - "7.15.  IPv6 Address Specific BGP Extended Community Attribute\n   The error handling\
    \ of [RFC5701] is revised as follows:\n   o  The IPv6 Address Specific Extended\
    \ Community attribute SHALL be\n      considered malformed if its length is not\
    \ a non-zero multiple of\n      20.\n   o  An UPDATE message with a malformed\
    \ IPv6 Address Specific Extended\n      Community attribute SHALL be handled using\
    \ the approach of \"treat-\n      as-withdraw\".\n   Note that a BGP speaker MUST\
    \ NOT treat an unrecognized IPv6 Address\n   Specific Extended Community Type\
    \ or Sub-Type as an error.\n"
- title: 7.16.  ATTR_SET
  contents:
  - "7.16.  ATTR_SET\n   The final paragraph of Section 5 of [RFC6368] is revised\
    \ as follows:\n      Old Text:\n         An UPDATE message with a malformed ATTR_SET\
    \ attribute SHALL be\n         handled as follows.  If its Partial flag is set\
    \ and its\n         Neighbor-Complete flag is clear, the UPDATE message is treated\n\
    \         as a route withdraw as discussed in [OPT-TRANS-BGP].  Otherwise\n  \
    \       (i.e., Partial flag is clear or Neighbor-Complete is set), the\n     \
    \    procedures of the BGP-4 base specification [RFC4271] MUST be\n         followed\
    \ with respect to an Optional Attribute Error.\n      New Text:\n         An UPDATE\
    \ message with a malformed ATTR_SET attribute SHALL be\n         handled using\
    \ the approach of \"treat as withdraw\".\n   Furthermore, the normative reference\
    \ to [OPT-TRANS-BGP] in [RFC6368]\n   is removed.\n"
- title: 8.  Guidance for Authors of BGP Specifications
  contents:
  - "8.  Guidance for Authors of BGP Specifications\n   A document that specifies\
    \ a new BGP attribute MUST provide specifics\n   regarding what constitutes an\
    \ error for that attribute and how that\n   error is to be handled.  Allowable\
    \ error-handling approaches are\n   detailed in Section 2.  The \"treat-as-withdraw\"\
    \ approach is generally\n   preferred and the \"session reset\" approach is discouraged.\
    \  Authors\n   of BGP documents are also reminded to review the discussion of\n\
    \   optional transitive attributes in the first paragraph of the\n   Introduction\
    \ of this document.  The document SHOULD also provide\n   consideration of what\
    \ debugging facilities may be required to permit\n   issues caused by a malformed\
    \ attribute to be diagnosed.\n   For any malformed attribute that is handled by\
    \ the \"attribute\n   discard\" instead of the \"treat-as-withdraw\" approach,\
    \ it is critical\n   to consider the potential impact of doing so.  In particular,\
    \ if the\n   attribute in question has or may have an effect on route selection\
    \ or\n   installation, the presumption is that discarding it is unsafe unless\n\
    \   careful analysis proves otherwise.  The analysis should take into\n   account\
    \ the tradeoff between preserving connectivity and potential\n   side effects.\n\
    \   Authors can refer to Section 7 for examples.\n"
- title: 9.  Security Considerations
  contents:
  - "9.  Security Considerations\n   This specification addresses the vulnerability\
    \ of a BGP speaker to a\n   potential attack whereby a distant attacker can generate\
    \ a malformed\n   optional transitive attribute that is not recognized by intervening\n\
    \   routers.  Since the intervening routers do not recognize the\n   attribute,\
    \ they propagate it without checking it.  When the malformed\n   attribute arrives\
    \ at a router that does recognize the given attribute\n   type, that router resets\
    \ the session over which it arrived.  Since\n   significant fan-out can occur\
    \ between the attacker and the routers\n   that do recognize the attribute type,\
    \ this attack could potentially\n   be particularly harmful.\n   The improved\
    \ error handling of this specification could in theory\n   interact badly with\
    \ some now-known weaker cryptographic mechanisms\n   should such be used in future\
    \ to secure BGP.  For example, if a\n   (fictional) mechanism that did not supply\
    \ data integrity was used, an\n   attacker could manipulate ciphertext in any\
    \ attempt to change or\n   observe how the receiver reacts.  Absent this specification,\
    \ the BGP\n   session would have been terminated; with this specification, the\n\
    \   attacker could make potentially many attempts.  While such a\n   confidentiality-only\
    \ mechanism would not be defined today, we have in\n   the past seen mechanism\
    \ definitions that result in similar, though\n   not as obviously exploitable,\
    \ vulnerabilities [RFC7366].  The\n   approach recommended today to avoid such\
    \ issues is to prefer use of\n   Authenticated Encryption with Additional Data\
    \ (AEAD) ciphers\n   [RFC5116] and thus to discard messages that don't verify.\n\
    \   In other respects, this specification does not change BGP's security\n   characteristics.\n"
- title: 10.  References
  contents:
  - '10.  References

    '
- title: 10.1.  Normative References
  contents:
  - "10.1.  Normative References\n   [IANA-BGP-ATTRS]\n              IANA, \"BGP Path\
    \ Attributes\",\n              <http://www.iana.org/assignments/bgp-parameters>.\n\
    \   [RFC1997]  Chandra, R., Traina, P., and T. Li, \"BGP Communities\n       \
    \       Attribute\", RFC 1997, DOI 10.17487/RFC1997, August 1996,\n          \
    \    <http://www.rfc-editor.org/info/rfc1997>.\n   [RFC2119]  Bradner, S., \"\
    Key words for use in RFCs to Indicate\n              Requirement Levels\", BCP\
    \ 14, RFC 2119,\n              DOI 10.17487/RFC2119, March 1997,\n           \
    \   <http://www.rfc-editor.org/info/rfc2119>.\n   [RFC4271]  Rekhter, Y., Ed.,\
    \ Li, T., Ed., and S. Hares, Ed., \"A\n              Border Gateway Protocol 4\
    \ (BGP-4)\", RFC 4271,\n              DOI 10.17487/RFC4271, January 2006,\n  \
    \            <http://www.rfc-editor.org/info/rfc4271>.\n   [RFC4360]  Sangli,\
    \ S., Tappan, D., and Y. Rekhter, \"BGP Extended\n              Communities Attribute\"\
    , RFC 4360, DOI 10.17487/RFC4360,\n              February 2006, <http://www.rfc-editor.org/info/rfc4360>.\n\
    \   [RFC4456]  Bates, T., Chen, E., and R. Chandra, \"BGP Route\n            \
    \  Reflection: An Alternative to Full Mesh Internal BGP\n              (IBGP)\"\
    , RFC 4456, DOI 10.17487/RFC4456, April 2006,\n              <http://www.rfc-editor.org/info/rfc4456>.\n\
    \   [RFC4724]  Sangli, S., Chen, E., Fernando, R., Scudder, J., and Y.\n     \
    \         Rekhter, \"Graceful Restart Mechanism for BGP\", RFC 4724,\n       \
    \       DOI 10.17487/RFC4724, January 2007,\n              <http://www.rfc-editor.org/info/rfc4724>.\n\
    \   [RFC4760]  Bates, T., Chandra, R., Katz, D., and Y. Rekhter,\n           \
    \   \"Multiprotocol Extensions for BGP-4\", RFC 4760,\n              DOI 10.17487/RFC4760,\
    \ January 2007,\n              <http://www.rfc-editor.org/info/rfc4760>.\n   [RFC5543]\
    \  Ould-Brahim, H., Fedyk, D., and Y. Rekhter, \"BGP Traffic\n              Engineering\
    \ Attribute\", RFC 5543, DOI 10.17487/RFC5543,\n              May 2009, <http://www.rfc-editor.org/info/rfc5543>.\n\
    \   [RFC5701]  Rekhter, Y., \"IPv6 Address Specific BGP Extended Community\n \
    \             Attribute\", RFC 5701, DOI 10.17487/RFC5701, November 2009,\n  \
    \            <http://www.rfc-editor.org/info/rfc5701>.\n   [RFC6368]  Marques,\
    \ P., Raszuk, R., Patel, K., Kumaki, K., and T.\n              Yamagata, \"Internal\
    \ BGP as the Provider/Customer Edge\n              Protocol for BGP/MPLS IP Virtual\
    \ Private Networks (VPNs)\",\n              RFC 6368, DOI 10.17487/RFC6368, September\
    \ 2011,\n              <http://www.rfc-editor.org/info/rfc6368>.\n   [RFC6793]\
    \  Vohra, Q. and E. Chen, \"BGP Support for Four-Octet\n              Autonomous\
    \ System (AS) Number Space\", RFC 6793,\n              DOI 10.17487/RFC6793, December\
    \ 2012,\n              <http://www.rfc-editor.org/info/rfc6793>.\n"
- title: 10.2.  Informative References
  contents:
  - "10.2.  Informative References\n   [RFC5116]  McGrew, D., \"An Interface and Algorithms\
    \ for Authenticated\n              Encryption\", RFC 5116, DOI 10.17487/RFC5116,\
    \ January 2008,\n              <http://www.rfc-editor.org/info/rfc5116>.\n   [RFC5549]\
    \  Le Faucheur, F. and E. Rosen, \"Advertising IPv4 Network\n              Layer\
    \ Reachability Information with an IPv6 Next Hop\",\n              RFC 5549, DOI\
    \ 10.17487/RFC5549, May 2009,\n              <http://www.rfc-editor.org/info/rfc5549>.\n\
    \   [RFC6514]  Aggarwal, R., Rosen, E., Morin, T., and Y. Rekhter, \"BGP\n   \
    \           Encodings and Procedures for Multicast in MPLS/BGP IP\n          \
    \    VPNs\", RFC 6514, DOI 10.17487/RFC6514, February 2012,\n              <http://www.rfc-editor.org/info/rfc6514>.\n\
    \   [RFC7117]  Aggarwal, R., Ed., Kamite, Y., Fang, L., Rekhter, Y., and\n   \
    \           C. Kodeboniya, \"Multicast in Virtual Private LAN Service\n      \
    \        (VPLS)\", RFC 7117, DOI 10.17487/RFC7117, February 2014,\n          \
    \    <http://www.rfc-editor.org/info/rfc7117>.\n   [RFC7366]  Gutmann, P., \"\
    Encrypt-then-MAC for Transport Layer\n              Security (TLS) and Datagram\
    \ Transport Layer Security\n              (DTLS)\", RFC 7366, DOI 10.17487/RFC7366,\
    \ September 2014,\n              <http://www.rfc-editor.org/info/rfc7366>.\n \
    \  [RFC7432]  Sajassi, A., Ed., Aggarwal, R., Bitar, N., Isaac, A.,\n        \
    \      Uttaro, J., Drake, J., and W. Henderickx, \"BGP MPLS-Based\n          \
    \    Ethernet VPN\", RFC 7432, DOI 10.17487/RFC7432, February\n              2015,\
    \ <http://www.rfc-editor.org/info/rfc7432>.\n"
- title: Acknowledgements
  contents:
  - "Acknowledgements\n   The authors wish to thank Juan Alcaide, Deniz Bahadir, Ron\
    \ Bonica,\n   Mach Chen, Andy Davidson, Bruno Decraene, Stephen Farrell, Rex\n\
    \   Fernando, Jeff Haas, Chris Hall, Joel Halpern, Dong Jie, Akira Kato,\n   Miya\
    \ Kohno, Warren Kumari, Tony Li, Alton Lo, Shin Miyakawa, Tamas\n   Mondal, Jonathan\
    \ Oddy, Tony Przygienda, Robert Raszuk, Yakov Rekhter,\n   Eric Rosen, Shyam Sethuram,\
    \ Rob Shakir, Naiming Shen, Adam Simpson,\n   Ananth Suryanarayana, Kaliraj Vairavakkalai,\
    \ Lili Wang, and Ondrej\n   Zajicek for their observations and discussion of this\
    \ topic and\n   review of this document.\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Enke Chen (editor)\n   Cisco Systems, Inc.\n   Email:\
    \ enkechen@cisco.com\n   John G. Scudder (editor)\n   Juniper Networks\n   Email:\
    \ jgs@juniper.net\n   Pradosh Mohapatra\n   Sproute Networks\n   Email: mpradosh@yahoo.com\n\
    \   Keyur Patel\n   Cisco Systems, Inc.\n   Email: keyupate@cisco.com\n"
