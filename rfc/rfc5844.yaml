- title: __initial_text__
  contents:
  - '                   IPv4 Support for Proxy Mobile IPv6

    '
- title: Abstract
  contents:
  - "Abstract\n   This document specifies extensions to the Proxy Mobile IPv6 protocol\n\
    \   for adding IPv4 protocol support.  The scope of IPv4 protocol support\n  \
    \ is two-fold: 1) enable IPv4 home address mobility support to the\n   mobile\
    \ node, and 2) allow the mobility entities in the Proxy Mobile\n   IPv6 domain\
    \ to exchange signaling messages over an IPv4 transport\n   network.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This\
    \ document is a product of the Internet Engineering Task Force\n   (IETF).  It\
    \ represents the consensus of the IETF community.  It has\n   received public\
    \ review and has been approved for publication by the\n   Internet Engineering\
    \ Steering Group (IESG).  Further information on\n   Internet Standards is available\
    \ in Section 2 of RFC 5741.\n   Information about the current status of this document,\
    \ any errata,\n   and how to provide feedback on it may be obtained at\n   http://www.rfc-editor.org/info/rfc5844.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2010 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (http://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.  Code Components\
    \ extracted from this document must\n   include Simplified BSD License text as\
    \ described in Section 4.e of\n   the Trust Legal Provisions and are provided\
    \ without warranty as\n   described in the Simplified BSD License.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1.  Overview . . . . . . . . . . . . . . . . . . . . .\
    \ . . . . . .  3\n     1.1.  Stated Assumptions . . . . . . . . . . . . . . .\
    \ . . . . .  4\n     1.2.  Relevance to Dual-Stack Mobile IPv6  . . . . . . .\
    \ . . . .  5\n   2.  Conventions and Terminology  . . . . . . . . . . . . . .\
    \ . . .  6\n     2.1.  Conventions  . . . . . . . . . . . . . . . . . . . . .\
    \ . .  6\n     2.2.  Terminology  . . . . . . . . . . . . . . . . . . . . . .\
    \ .  6\n   3.  IPv4 Home Address Mobility Support . . . . . . . . . . . . . .\
    \  8\n     3.1.  Local Mobility Anchor Considerations . . . . . . . . . . .  9\n\
    \       3.1.1.  Extensions to Binding Cache Entry  . . . . . . . . . .  9\n  \
    \     3.1.2.  Signaling Considerations . . . . . . . . . . . . . . . 10\n    \
    \   3.1.3.  Routing Considerations for the Local Mobility\n               Anchor\
    \ . . . . . . . . . . . . . . . . . . . . . . . . 15\n       3.1.4.  ECN and Payload\
    \ Fragmentation Considerations . . . . . 16\n     3.2.  Mobile Access Gateway\
    \ Considerations . . . . . . . . . . . 17\n       3.2.1.  Extensions to Binding\
    \ Update List Entry  . . . . . . . 17\n       3.2.2.  Extensions to Mobile Node's\
    \ Policy Profile . . . . . . 17\n       3.2.3.  Signaling Considerations . . .\
    \ . . . . . . . . . . . . 17\n       3.2.4.  Routing Considerations for the Mobile\
    \ Access\n               Gateway  . . . . . . . . . . . . . . . . . . . . . .\
    \ . 21\n     3.3.  Mobility Options and Status Codes  . . . . . . . . . . . .\
    \ 22\n       3.3.1.  IPv4 Home Address Request Option . . . . . . . . . . . 22\n\
    \       3.3.2.  IPv4 Home Address Reply Option . . . . . . . . . . . . 23\n  \
    \     3.3.3.  IPv4 Default-Router Address Option . . . . . . . . . . 25\n    \
    \   3.3.4.  IPv4 DHCP Support Mode Option  . . . . . . . . . . . . 25\n      \
    \ 3.3.5.  Status Codes . . . . . . . . . . . . . . . . . . . . . 26\n     3.4.\
    \  Supporting DHCP-Based Address Configuration  . . . . . . . 27\n       3.4.1.\
    \  DHCP Server Co-Located with the Mobile Access\n               Gateway  . .\
    \ . . . . . . . . . . . . . . . . . . . . . 28\n       3.4.2.  DHCP Relay Agent\
    \ Co-Located with the Mobile Access\n               Gateway  . . . . . . . . .\
    \ . . . . . . . . . . . . . . 31\n       3.4.3.  Common DHCP Considerations .\
    \ . . . . . . . . . . . . . 33\n   4.  IPv4 Transport Support . . . . . . . .\
    \ . . . . . . . . . . . . 35\n     4.1.  Local Mobility Anchor Considerations\
    \ . . . . . . . . . . . 37\n       4.1.1.  Extensions to Binding Cache Entry \
    \ . . . . . . . . . . 37\n       4.1.2.  Extensions to Mobile Node's Policy Profile\
    \ . . . . . . 37\n       4.1.3.  Signaling Considerations . . . . . . . . . .\
    \ . . . . . 37\n       4.1.4.  Routing Considerations . . . . . . . . . . . .\
    \ . . . . 39\n     4.2.  Mobile Access Gateway Considerations . . . . . . . .\
    \ . . . 40\n       4.2.1.  Extensions to Binding Update List Entry  . . . . .\
    \ . . 40\n       4.2.2.  Signaling Considerations . . . . . . . . . . . . . .\
    \ . 40\n     4.3.  IPsec Considerations . . . . . . . . . . . . . . . . . . .\
    \ 43\n       4.3.1.  PBU and PBA  . . . . . . . . . . . . . . . . . . . . . 43\n\
    \       4.3.2.  Payload Packet . . . . . . . . . . . . . . . . . . . . 43\n  \
    \ 5.  Protocol Configuration Variables . . . . . . . . . . . . . . . 44\n    \
    \ 5.1.  Local Mobility Anchor - Configuration Variables  . . . . . 44\n     5.2.\
    \  Mobile Access Gateway - Configuration Variables  . . . . . 44\n   6.  IANA\
    \ Considerations  . . . . . . . . . . . . . . . . . . . . . 45\n   7.  Security\
    \ Considerations  . . . . . . . . . . . . . . . . . . . 46\n   8.  Contributors\
    \ . . . . . . . . . . . . . . . . . . . . . . . . . 46\n   9.  Acknowledgements\
    \ . . . . . . . . . . . . . . . . . . . . . . . 47\n   10. References . . . .\
    \ . . . . . . . . . . . . . . . . . . . . . . 47\n     10.1. Normative References\
    \ . . . . . . . . . . . . . . . . . . . 47\n     10.2. Informative References\
    \ . . . . . . . . . . . . . . . . . . 48\n"
- title: 1.  Overview
  contents:
  - "1.  Overview\n   The transition from IPv4 to IPv6 is a long process, and during\
    \ this\n   period of transition, both the protocols will be enabled over the\n\
    \   same network infrastructure.  Thus, it is reasonable to assume that a\n  \
    \ mobile node in a Proxy Mobile IPv6 domain may operate in an IPv4-\n   only,\
    \ IPv6-only, or dual-stack mode, and the network between the\n   mobile access\
    \ gateway and a local mobility anchor may be an IPv4 or\n   an IPv6 network. \
    \ It is also reasonable to expect the same mobility\n   infrastructure in the\
    \ Proxy Mobile IPv6 domain to provide mobility to\n   the mobile nodes operating\
    \ in IPv4, IPv6, or in dual mode and whether\n   the transport network is IPv4\
    \ or IPv6 network.  The motivation and\n   scope of IPv4 support in Mobile IPv6\
    \ is summarized in [RFC4977], and\n   all those requirements apply to Proxy Mobile\
    \ IPv6 protocol as well.\n   The Proxy Mobile IPv6 protocol [RFC5213] specifies\
    \ a mechanism for\n   providing IPv6 home address mobility support to a mobile\
    \ node in a\n   Proxy Mobile IPv6 domain.  The protocol requires IPv6 transport\n\
    \   network between the mobility entities.  The extensions defined in\n   this\
    \ document specify IPv4 support to the Proxy Mobile IPv6 protocol\n   [RFC5213].\n\
    \   The scope of IPv4 support in Proxy Mobile IPv6 includes the support\n   for\
    \ the following two features:\n   o  IPv4 Home Address Mobility Support: A mobile\
    \ node that is dual-\n      stack or IPv4-only enabled will be able to obtain\
    \ an IPv4 address\n      and be able to use that address from any of the access\
    \ networks in\n      that Proxy Mobile IPv6 domain.  The mobile node is not required\
    \ to\n      be allocated or assigned an IPv6 address to enable IPv4 home\n   \
    \   address support.\n   o  IPv4 Transport Network Support: The mobility entities\
    \ in the Proxy\n      Mobile IPv6 domain will be able to exchange Proxy Mobile\
    \ IPv6\n      signaling messages over an IPv4 transport.\n   These two features,\
    \ the IPv4 home address mobility support and the\n   IPv4 transport support features,\
    \ are independent of each other, and\n   deployments may choose to enable either\
    \ one or both of these features\n   as required.\n   Figure 1 shows a typical\
    \ Proxy Mobile IPv6 domain with an IPv4\n   transport network and with IPv4 enabled\
    \ mobile nodes.  The terms used\n   in this illustration are explained in the\
    \ Terminology section.\n               +----+                +----+\n        \
    \       |LMA1|                |LMA2|\n               +----+                +----+\n\
    \   IPv4-LMAA  -> |          IPv4-LMAA-> | <-- LMAA\n                 |      \
    \                |\n                 \\\\                    //\\\\\n        \
    \          \\\\                  //  \\\\\n                   \\\\           \
    \     //    \\\\\n                +---\\\\------------- //------\\\\----+\n  \
    \             (     \\\\  IPv4/IPv6 //        \\\\    )\n               (    \
    \  \\\\  Network //          \\\\   )\n                +------\\\\--------//------------\\\
    \\-+\n                        \\\\      //              \\\\\n               \
    \          \\\\    //                \\\\\n                          \\\\  //\
    \                  \\\\\n         IPv4-Proxy-CoA --> |                      |\
    \ <-- Proxy-CoA\n                         +----+                 +----+\n    \
    \                     |MAG1|-----{MN2}       |MAG2|\n                        \
    \ +----+    |            +----+\n        (MN-HoA)           |       |        \
    \      | <-- (MN-HoA)\n        (IPv4-MN-HoA) -->  |   (IPv4-MN-HoA)      | <--\
    \ (IPv4-MN-HoA)\n                         {MN1}                   {MN3}\n    \
    \           Figure 1: IPv4 Support for Proxy Mobile IPv6\n"
- title: 1.1.  Stated Assumptions
  contents:
  - "1.1.  Stated Assumptions\n   The following are the system and configuration requirements\
    \ from the\n   mobility entities in the Proxy Mobile IPv6 domain for supporting\
    \ the\n   extensions defined in this document.\n   o  Both the mobility entities,\
    \ the local mobility anchor and the\n      mobile access gateway are dual-stack\
    \ (IPv4/IPv6) enabled.\n      Irrespective of the type of transport network (IPv4\
    \ or IPv6)\n      separating these two entities, the mobility signaling is always\n\
    \      based on Proxy Mobile IPv6 protocol [RFC5213].\n   o  A deployment where\
    \ a mobile access gateway uses an IPv4 private\n      address with NAT [RFC3022]\
    \ translation devices in the path to a\n      local mobility anchor is not supported\
    \ by this specification.\n   o  The mobile node can be operating in IPv4-only,\
    \ IPv6-only or in\n      dual mode.  Based on the enabled configuration for a\
    \ mobile node,\n      the mobile node should be able to obtain IPv4-only, IPv6-only,\
    \ or\n      both IPv4 and IPv6 addresses for its interface and furthermore\n \
    \     achieve mobility support for those addresses.\n   o  For enabling IPv4 home\
    \ address mobility support to a mobile node,\n      it is not required that the\
    \ IPv6 home address mobility support\n      need be enabled.  However, the respective\
    \ protocol(s) support,\n      such as IPv4 or IPv6 packet forwarding, must be\
    \ enabled on the\n      access link between the mobile node and the mobile access\
    \ gateway.\n   o  The mobile node can obtain an IPv4 address for its attached\n\
    \      interface.  Based on the type of link, it may be able to acquire\n    \
    \  its IPv4 address configuration using standard IPv4 address\n      configuration\
    \ mechanisms such as DHCP [RFC2131], IP Control\n      Protocol (IPCP) [RFC1332],\
    \ Internet Key Exchange Protocol version\n      2 (IKEv2) [RFC4306], or static\
    \ address configuration.  However,\n      the details on how IPCP or IKEv2 can\
    \ be used for address delivery\n      are outside the scope of this document.\n\
    \   o  The mobile node's IPv4 home subnet is typically a shared address\n    \
    \  space.  It is not for the exclusive use of any one mobile node.\n      There\
    \ can be multiple mobile nodes that are assigned IPv4\n      addresses from the\
    \ same subnet.\n   o  The mobile access gateway is the IPv4 default router for\
    \ the\n      mobile node on its access link.  It will be in the forwarding path\n\
    \      for the mobile node's data traffic.  Additionally, as specified in\n  \
    \    Section 6.9.3 of [RFC5213], all the mobile access gateways in the\n     \
    \ Proxy Mobile IPv6 domain MUST use the same link-layer address on\n      any\
    \ of the access links wherever the mobile node attaches.\n"
- title: 1.2.  Relevance to Dual-Stack Mobile IPv6
  contents:
  - "1.2.  Relevance to Dual-Stack Mobile IPv6\n   IPv4 support for Mobile IPv6 is\
    \ specified in the Dual-Stack Mobile\n   IPv6 specification [RFC5555].  This document\
    \ leverages some of the\n   approaches, messaging options, and processing logic\
    \ defined in that\n   document for extending IPv4 support to Proxy Mobile IPv6,\
    \ except with\n   deviation in some aspects for obvious reasons of supporting\
    \ a\n   network-based mobility model.  The following are some of the related\n\
    \   considerations.\n   o  The Binding Update message flag 'F' and the NAT Detection\
    \ Option\n      defined in Sections 3.1.3 and 3.2.2 of [RFC5555] are used by this\n\
    \      specification in Proxy Binding Update and Proxy Binding\n      Acknowledgement\
    \ messages.  Their sole purpose is to allow forcing\n      of UDP encapsulation\
    \ between a mobile access gateway and a local\n      mobility anchor in situations\
    \ similar to those discussed in\n      Sections 4.1 and 4.4.1 of [RFC5555].\n\
    \   o  The necessary extensions to the conceptual data structures,\n      Binding\
    \ Cache entry and Binding Update List entry, for storing the\n      state related\
    \ to the IPv4 support defined in [RFC5555], will all\n      be needed and relevant\
    \ for this document.\n   o  In Mobile IPv6 [RFC3775] and in Dual-Stack Mobile\
    \ IPv6 [RFC5555],\n      IPsec security associations (SAs) are specific to a single\
    \ mobile\n      node; they use the identifier visible to upper-layer protocols\n\
    \      (HoA/IPv4-HoA) as traffic selector; and the IKE/IPsec SAs need to\n   \
    \   be updated when the mobile node moves.\n      In Proxy Mobile IPv6 (both [RFC5213]\
    \ and this document), the IPsec\n      SAs are specific to the mobile access gateway\
    \ (and used for a\n      potentially large number of mobile nodes); they use the\
    \ locators\n      used for routing (Proxy-CoA/IPv4-Proxy-CoA) as traffic selectors;\n\
    \      and they are not updated when the mobile node moves.\n      This means\
    \ the IPsec processing for Mobile IPv6 and Proxy Mobile\n      IPv6 (whether IPv6-only\
    \ or dual-stack) is very different.\n   o  The tunneling considerations specified\
    \ in [RFC5555] for supporting\n      IPv4 transport are relevant for this document\
    \ as well.\n"
- title: 2.  Conventions and Terminology
  contents:
  - '2.  Conventions and Terminology

    '
- title: 2.1.  Conventions
  contents:
  - "2.1.  Conventions\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\", \"\
    SHALL\", \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"MAY\"\
    , and \"OPTIONAL\" in this\n   document are to be interpreted as described in\
    \ RFC 2119 [RFC2119].\n"
- title: 2.2.  Terminology
  contents:
  - "2.2.  Terminology\n   All the mobility related terms used in this document are\
    \ to be\n   interpreted as defined in the Mobile IPv6 specification [RFC3775]\
    \ and\n   Proxy Mobile IPv6 specification [RFC5213].  In addition, this\n   document\
    \ introduces the following terms.\n   IPv4 Proxy Care-of Address (IPv4-Proxy-CoA)\n\
    \      The IPv4 address that is configured on the egress-interface of the\n  \
    \    mobile access gateway.  When using IPv4 transport, this address\n      will\
    \ be the registered care-of address in the mobile node's\n      Binding Cache\
    \ entry and will also be the transport-endpoint of the\n      tunnel between the\
    \ local mobility anchor and a mobile access\n      gateway.\n   IPv4 Local Mobility\
    \ Anchor Address (IPv4-LMAA)\n      The IPv4 address that is configured on the\
    \ egress-interface of the\n      local mobility anchor.  When using IPv4 transport,\
    \ the mobile\n      access gateway sends the Proxy Binding Update messages to\
    \ this\n      address and will be the transport-endpoint of the tunnel between\n\
    \      the local mobility anchor and the mobile access gateway.\n   Mobile Node's\
    \ IPv4 Home Address (IPv4-MN-HoA)\n      The IPv4 home address assigned to the\
    \ mobile node's attached\n      interface.  This address is topologically anchored\
    \ at the mobile\n      node's local mobility anchor.  The mobile node configures\
    \ this\n      address on its attached interface.  If the mobile node connects\
    \ to\n      the Proxy Mobile IPv6 domain via multiple interfaces each of the\n\
    \      interfaces are assigned a unique IPv4 address.  All the IPv6 home\n   \
    \   network prefixes and the IPv4 home address assigned to a given\n      interface\
    \ of a mobile node will be managed under one mobility\n      session.\n   Selective\
    \ De-registration\n      A procedure for partial de-registration of all the addresses\
    \ that\n      belong to one address family, i.e., de-registration of either the\n\
    \      IPv4 home address or one or more of the assigned IPv6 home network\n  \
    \    prefixes.\n   Encapsulation Modes\n      This document uses the following\
    \ terms when referring to the\n      different encapsulation modes.\n      IPv4-or-IPv6-over-IPv6\n\
    \         IPv4 or IPv6 packet carried as a payload of an IPv6 packet\n      IPv4-or-IPv6-over-IPv4\n\
    \         IPv4 or IPv6 packet carried as a payload of an IPv4 packet\n      IPv4-or-IPv6-over-IPv4-UDP\n\
    \         IPv4 or IPv6 packet carried as a payload in an IPv4 packet with\n  \
    \       a UDP header\n      IPv4-or-IPv6-over-IPv4-UDP-TLV\n         IPv4 or IPv6\
    \ packet carried as a payload in an IPv4 packet with\n         UDP and TLV headers\n\
    \      IPv4-or-IPv6-over-IPv4-GRE\n         IPv4 or IPv6 packet carried as a payload\
    \ in an IPv4 packet with\n         a Generic Routing Encapsulation (GRE) header\
    \ (but no UDP or TLV\n         header)\n"
- title: 3.  IPv4 Home Address Mobility Support
  contents:
  - "3.  IPv4 Home Address Mobility Support\n   The IPv4 home address mobility support\
    \ essentially enables a mobile\n   node in a Proxy Mobile IPv6 domain to obtain\
    \ IPv4 home address\n   configuration for its attached interfaces and be able\
    \ to retain that\n   address configuration even after performing a handoff anywhere\
    \ within\n   that Proxy Mobile IPv6 domain.  This section describes the protocol\n\
    \   operation and the required extensions to Proxy Mobile IPv6 protocol\n   for\
    \ extending IPv4 home address mobility support.\n   When an IPv4-enabled or a\
    \ dual-stack-enabled mobile node attaches to\n   the Proxy Mobile IPv6 domain,\
    \ the mobile access gateway on the access\n   link where the mobile node is attached\
    \ will identify the mobile node\n   and will initiate the Proxy Mobile IPv6 signaling\
    \ with the mobile\n   node's local mobility anchor.  The mobile access gateway\
    \ will follow\n   the signaling considerations specified in Section 3.2 for requesting\n\
    \   IPv4 home address mobility support.  Upon the completion of the\n   signaling,\
    \ the local mobility anchor and the mobile access gateway\n   will establish the\
    \ required routing states for allowing the mobile\n   node to use its IPv4 home\
    \ address from its current point of\n   attachment.\n   The mobile node on the\
    \ access link using any of the standard IPv4\n   address configuration mechanisms\
    \ supported on that access link, such\n   as IPCP [RFC1332], IKEv2 [RFC4306],\
    \ or DHCP [RFC2131], will be able\n   to obtain an IPv4 home address (IPv4-MN-HoA)\
    \ for its attached\n   interface.  Although the address configuration mechanisms\
    \ for\n   delivering the address configuration to the mobile node is\n   independent\
    \ of the Proxy Mobile IPv6 protocol operation, there needs\n   to be some interaction\
    \ between these two protocol flows.  Section 3.4\n   identifies these interactions\
    \ for supporting DHCP-based address\n   configuration.\n   The support for IPv4\
    \ home address mobility is not dependent on the\n   IPv6 home address mobility\
    \ support.  It is not required that the IPv6\n   home address mobility support\
    \ needs to be enabled for providing IPv4\n   home address mobility support.  A\
    \ mobile node will be able to obtain\n   IPv4-only, IPv6-only, or dual IPv4/IPv6\
    \ address configuration for its\n   attached interface.  The mobile node's policy\
    \ profile will determine\n   if the mobile node is entitled to both the protocol\
    \ versions or a\n   single protocol version.  Based on the policy, only those\
    \ protocols\n   will be enabled on the access link.  Furthermore, if the mobile\
    \ node,\n   after obtaining the address configuration on its interface, performs\n\
    \   a handoff, either by changing its point of attachment over the same\n   interface\
    \ or to a different interface, the network will ensure the\n   mobile node will\
    \ be able to use the same IPv4 address configuration\n   after the handoff.\n\
    \   Additionally, if the mobile node connects to the Proxy Mobile IPv6\n   domain,\
    \ through multiple interfaces and simultaneously through\n   different access\
    \ networks, each of the connected interfaces will\n   obtain a unique IPv4 home\
    \ address.  In such a scenario, there will be\n   multiple Binding Cache entries\
    \ for the mobile node on the local\n   mobility anchor.  All the addresses (IPv4/IPv6)\
    \ assigned to a given\n   interface will be managed as part of one mobility session,\
    \ as\n   specified in Section 5.4 of [RFC5213].\n"
- title: 3.1.  Local Mobility Anchor Considerations
  contents:
  - '3.1.  Local Mobility Anchor Considerations

    '
- title: 3.1.1.  Extensions to Binding Cache Entry
  contents:
  - "3.1.1.  Extensions to Binding Cache Entry\n   To support this feature, the conceptual\
    \ Binding Cache entry data\n   structure maintained by the local mobility anchor\
    \ needs to include\n   the following parameters.\n   o  The IPv4 home address\
    \ assigned to the mobile node's interface and\n      registered by the mobile\
    \ access gateway.  The IPv4 home address\n      entry also includes the corresponding\
    \ subnet mask.  It is to be\n      noted that this parameter is defined in [RFC5555]\
    \ and is presented\n      here for completeness.\n   o  The IPv4 default router\
    \ address assigned to the mobile node.\n"
- title: 3.1.2.  Signaling Considerations
  contents:
  - '3.1.2.  Signaling Considerations

    '
- title: 3.1.2.1.  Processing Proxy Binding Updates
  contents:
  - "3.1.2.1.  Processing Proxy Binding Updates\n   The processing rules specified\
    \ in Section 5.3 of [RFC5213] are\n   applied for processing the received Proxy\
    \ Binding Update message.\n   However, if the received Proxy Binding Update message\
    \ has an IPv4\n   Home Address Request option, the following considerations MUST\
    \ be\n   applied additionally.\n   o  If there is an IPv4 Home Address Request\
    \ option (Section 3.3.1)\n      present in the received Proxy Binding Update message,\
    \ but no Home\n      Network Prefix option [RFC5213] present in the received Proxy\n\
    \      Binding Update message, the local mobility anchor MUST NOT reject\n   \
    \   the request as specified in Section 5.3.1 of [RFC5213].  At least\n      one\
    \ instance of either of these two options, either the IPv4 Home\n      Address\
    \ Request option or the Home Network Prefix option, MUST be\n      present.  If\
    \ there is not a single instance of either of these two\n      options present\
    \ in the request, the local mobility anchor MUST\n      reject the request and\
    \ send a Proxy Binding Acknowledgement\n      message with the Status field set\
    \ to\n      MISSING_HOME_NETWORK_PREFIX_OPTION (missing the mobile node's home\n\
    \      network prefix option) [RFC5213].\n   o  If there is at least one instance\
    \ of the Home Network Prefix\n      option [RFC5213] present in the received Proxy\
    \ Binding Update\n      message, but it is known from the mobile node's policy\
    \ profile\n      that the mobile node is not authorized for IPv6 service, or IPv6\n\
    \      routing in not enabled in the home network, the local mobility\n      anchor\
    \ MUST reject the request and send a Proxy Binding\n      Acknowledgement message\
    \ with the Status field set to\n      NOT_AUTHORIZED_FOR_IPV6_MOBILITY_SERVICE\
    \ (mobile node not\n      authorized for IPv6 mobility service; see Section 3.3.5).\n\
    \   o  If there is an IPv4 Home Address Request option present in the\n      received\
    \ Proxy Binding Update message, but it is known from the\n      mobile node's\
    \ policy profile that the mobile node is not\n      authorized for IPv4 service,\
    \ or if IPv4 routing is not enabled in\n      the home network, the local mobility\
    \ anchor MUST reject the\n      request and send a Proxy Binding Acknowledgement\
    \ message with the\n      Status field set to NOT_AUTHORIZED_FOR_IPV4_MOBILITY_SERVICE\n\
    \      (mobile node not authorized for IPv4 mobility service; see\n      Section\
    \ 3.3.5).\n   o  If there is more than one instance of the IPv4 Home Address\n\
    \      Request option present in the request, then the local mobility\n      anchor\
    \ MUST reject the request and send a Proxy Binding\n      Acknowledgement message\
    \ with the Status field set to\n      MULTIPLE_IPV4_HOME_ADDRESS_ASSIGNMENT_NOT_SUPPORTED\
    \ (multiple IPv4\n      home address assignments not supported; see Section 3.3.5).\n\
    \   o  For associating the received Proxy Binding Update message to an\n     \
    \ existing mobility session, the local mobility anchor MUST perform\n      the\
    \ Binding Cache entry existence test by applying the following\n      considerations.\n\
    \      *  If there is at least one instance of the Home Network Prefix\n     \
    \    option [RFC5213] with a NON_ZERO prefix value, or, if there is\n        \
    \ an IPv4 Home Address Request option with the IPv4 address in\n         the option\
    \ set to ALL_ZERO, considerations from Section 5.4.1\n         of [RFC5213] MUST\
    \ be applied.\n      *  If there is an IPv4 Home Address Request option present\
    \ in the\n         request with the IPv4 address value in the option set to a\n\
    \         NON_ZERO value, considerations from Section 3.1.2.7 MUST be\n      \
    \   applied.\n   o  If there is no existing Binding Cache entry that can be associated\n\
    \      with the request, the local mobility anchor MUST consider this\n      request\
    \ as an initial binding registration request, and\n      considerations from Section\
    \ 3.1.2.2 MUST be applied.\n      Additionally, if there are one or more Home\
    \ Network Prefix options\n      [RFC5213] present in the request, considerations\
    \ from Section\n      5.3.2 of [RFC5213] MUST also be applied.\n   o  If there\
    \ exists a Binding Cache entry that can be associated with\n      the request,\
    \ the local mobility anchor MUST apply considerations\n      from Section 5.3.1\
    \ of [RFC5213], (point 13), to determine if the\n      request is a re-registration\
    \ or a de-registration request.  If the\n      request is a re-registration request,\
    \ considerations from\n      Section 3.1.2.3 MUST be applied, and if it is a de-registration\n\
    \      request, considerations from Section 3.1.2.5 MUST be applied.\n   o  If\
    \ there exists a Binding Cache entry that can be associated with\n      the request\
    \ and if it is determined that the request is a re-\n      registration request\
    \ for extending an IPv4 home address mobility\n      support to the existing IPv6-only\
    \ mobility session, considerations\n      from Section 3.1.2.2 MUST be applied\
    \ with respect to IPv4 support.\n"
- title: 3.1.2.2.  Initial Binding Registration (New Mobility Session)
  contents:
  - "3.1.2.2.  Initial Binding Registration (New Mobility Session)\n   o  If there\
    \ is an IPv4 Home Address Request option present in the\n      Proxy Binding Update\
    \ message with the IPv4 address value in the\n      option set to ALL_ZERO, the\
    \ local mobility anchor MUST allocate an\n      IPv4 home address to the mobile\
    \ node and associate it with the new\n      mobility session created for that\
    \ mobile node.\n   o  If there is an IPv4 Home Address Request option with the\
    \ IPv4\n      address in the option set to a NON_ZERO value, the local mobility\n\
    \      anchor, before accepting the request, MUST ensure that the address\n  \
    \    is topologically anchored on the local mobility anchor and\n      furthermore\
    \ that the mobile node is authorized to use that\n      address.  If the mobile\
    \ node is not authorized for that specific\n      address, the local mobility\
    \ anchor MUST reject the request and\n      send a Proxy Binding Acknowledgement\
    \ message with the Status field\n      set to NOT_AUTHORIZED_FOR_IPV4_HOME_ADDRESS\
    \ (mobile node not\n      authorized for the requesting IPv4 address; see Section\
    \ 3.3.5).\n      It MUST also include the IPv4 Home Address Reply option\n   \
    \   (Section 3.3.2). in the reply with the Status field value in the\n      option\
    \ set to 129 (Administratively prohibited).\n   o  If the local mobility anchor\
    \ is unable to allocate an IPv4 address\n      due to lack of resources, it MUST\
    \ reject the request and send a\n      Proxy Binding Acknowledgement message with\
    \ Status field set to 130\n      (Insufficient resources).  It MUST also include\
    \ the IPv4 Home\n      Address Reply option in the reply with the Status field\
    \ value in\n      the option set to 128 (Failure, reason unspecified).\n   o \
    \ Upon accepting the request, the local mobility anchor MUST create\n      a Binding\
    \ Cache entry for this mobility session.  However, if the\n      request also\
    \ contains one or more Home Network Prefix options\n      [RFC5213], there should\
    \ still be only one Binding Cache entry that\n      should be created for this\
    \ mobility session.  The created Binding\n      Cache entry MUST be used for managing\
    \ both IPv4 and IPv6 home\n      address bindings.  The fields in the Binding\
    \ Cache entry MUST be\n      updated with the accepted values for that session.\n\
    \   o  The local mobility anchor MUST establish a bidirectional tunnel to\n  \
    \    the mobile access gateway with the encapsulation mode set to the\n      negotiated\
    \ mode for carrying the IPv4 payload traffic.  When using\n      IPv6 transport,\
    \ the encapsulation mode is IPv4-or-IPv6-over-IPv6\n      (IPv4 or IPv6 packet\
    \ carried as a payload of an IPv6 packet).\n      When using IPv4 transport, the\
    \ encapsulation mode is as specified\n      in Section 4.\n   o  The local mobility\
    \ anchor MUST create an IPv4 host route (or a\n      platform-specific equivalent\
    \ function that sets up the forwarding)\n      for tunneling the packets received\
    \ for the mobile node's home\n      address associated with this mobility session.\n\
    \   o  The local mobility anchor MUST send the Proxy Binding\n      Acknowledgement\
    \ message with the Status field set to 0 (Proxy\n      Binding Update accepted).\
    \  The message MUST be constructed as\n      specified in Section 3.1.2.6.\n"
- title: 3.1.2.3.  Binding Lifetime Extension (No Handoff)
  contents:
  - "3.1.2.3.  Binding Lifetime Extension (No Handoff)\n   All the considerations\
    \ from Section 5.3.3 of [RFC5213] MUST be\n   applied.\n"
- title: 3.1.2.4.  Binding Lifetime Extension (after Handoff)
  contents:
  - "3.1.2.4.  Binding Lifetime Extension (after Handoff)\n   o  If there is no Home\
    \ Network Prefix option [RFC5213] present in the\n      request, but if the Binding\
    \ Cache entry associated with this\n      request has IPv6 home network prefix(es),\
    \ the local mobility\n      anchor MUST consider this as a request to extend lifetime\
    \ only for\n      the IPv4 home address and not for the IPv6 home network\n  \
    \    prefix(es).  Hence, the local mobility anchor SHOULD release all\n      the\
    \ IPv6 home network prefix(es) assigned to that mobile node and\n      for that\
    \ specific attached interface.  Similar considerations\n      apply for the case\
    \ where there is no IPv4 Home Address Request\n      option present in the request,\
    \ but if the Binding Cache entry\n      associated with that request has both\
    \ IPv4 home address and IPv6\n      home network prefix(es).\n   o  The local\
    \ mobility anchor MUST remove the previously created IPv4\n      host route (or\
    \ the forwarding state) and the dynamically created\n      bidirectional tunnel\
    \ for carrying the IPv4 payload traffic (if\n      there are no other mobile nodes\
    \ for which the tunnel is being\n      used).  This will remove the routing state\
    \ towards the mobile\n      access gateway where the mobile node was anchored\
    \ prior to the\n      handoff.\n   o  The local mobility anchor MUST create a\
    \ bidirectional tunnel to\n      the mobile access gateway that sent the request\
    \ (if there is no\n      existing bidirectional tunnel) and with the encapsulation\
    \ mode set\n      to the negotiated mode for carrying the IPv4 payload traffic.\
    \  An\n      IPv4 host route for tunneling the packets received for the mobile\n\
    \      node's IPv4 home address MUST also be added.\n   o  The required forwarding\
    \ state identified in Section 5.3.6 of\n      [RFC5213] is for IPv6 payload traffic.\
    \  Those considerations apply\n      for IPv4 payload traffic as well.  However,\
    \ if IPv4 transport is\n      in use, considerations from Section 4 MUST be applied.\n"
- title: 3.1.2.5.  Binding De-Registration
  contents:
  - "3.1.2.5.  Binding De-Registration\n   All the considerations from Section 5.3.5\
    \ of [RFC5213] MUST be\n   applied.  Additionally, to remove the IPv4 state as\
    \ part of the\n   Binding Cache entry deletion, the IPv4 host route and the dynamically\n\
    \   created bidirectional tunnel for carrying the IPv4 payload traffic\n   (if\
    \ there are no other mobile nodes for which the tunnel is being\n   used) MUST\
    \ be removed.  However, if the request is for a selective\n   de-registration\
    \ (IPv4 home address only, or all the IPv6 home network\n   prefixes), the Binding\
    \ Cache entry MUST NOT be deleted, only the\n   respective states related to those\
    \ addresses MUST be deleted.\n"
- title: 3.1.2.6.  Constructing the Proxy Binding Acknowledgement Message
  contents:
  - "3.1.2.6.  Constructing the Proxy Binding Acknowledgement Message\n   When sending\
    \ the Proxy Binding Acknowledgement message to the mobile\n   access gateway,\
    \ the local mobility anchor MUST construct the message\n   as specified in Section\
    \ 5.3.6 of [RFC5213].  Additionally, the\n   following considerations MUST be\
    \ applied.\n   o  Section 5.3.6 of [RFC5213] requires the local mobility anchor\
    \ to\n      include at least one instance of the Home Network Prefix option\n\
    \      [RFC5213] in the Proxy Binding Acknowledgement message that it\n      sends\
    \ to the mobile access gateway.  However, if the received\n      Proxy Binding\
    \ Update message has only the IPv4 Home Address\n      Request option and does\
    \ not contain the Home Network Prefix\n      option(s), then the local mobility\
    \ anchor MUST NOT include any\n      Home Network Prefix option(s) in the reply.\
    \  However, there MUST\n      be at least one instance of either the Home Network\
    \ Prefix option\n      [RFC5213] or the IPv4 Home Address Reply option present\
    \ in the\n      Proxy Binding Acknowledgement message.\n   o  The IPv4 Home Address\
    \ Reply option MUST be present in the Proxy\n      Binding Acknowledgement message.\n\
    \      1.  If the Status field is set to a value greater than or equal to\n  \
    \        128, i.e., if the Proxy Binding Update is rejected, then there\n    \
    \      MUST be an IPv4 Home Address Reply option corresponding to the\n      \
    \    IPv4 Home Address Request option present in the request and\n          with\
    \ the IPv4 address value and the prefix length fields in\n          the option\
    \ set to the corresponding values in the request.\n          The Status field\
    \ value in the option must be set to the\n          specific error code.\n   \
    \   2.  For all other cases, there MUST be an IPv4 Home Address Reply\n      \
    \    option to carry the IPv4 home address assigned for that\n          mobility\
    \ session and with the value in the option set to the\n          allocated IPv4\
    \ address.  The prefix length in the option MUST\n          be set to the prefix\
    \ length of the mobile node's IPv4 home\n          network.  The Status field\
    \ value in the option must be set to\n          0 (Success).\n   o  The IPv4 Default-Router\
    \ Address option (Section 3.3.3) MUST be\n      present, if the Status field value\
    \ in the Proxy Binding\n      Acknowledgement message is set to 0 (Proxy Binding\
    \ Update\n      accepted) [RFC5213].  Otherwise, the option MUST NOT be present.\n\
    \      If the option is present, the default router address in the option\n  \
    \    MUST be set to the mobile node's default router address.\n"
- title: 3.1.2.7.  Binding Cache Entry Lookup Considerations
  contents:
  - "3.1.2.7.  Binding Cache Entry Lookup Considerations\n   The Binding Cache entry\
    \ lookup considerations specified in Section\n   5.4.1.1 of [RFC5213] uses the\
    \ Home Network Prefix option [RFC5213] as\n   the key parameter for identifying\
    \ the Binding Cache entry.  However,\n   when there is not a single Home Network\
    \ Prefix option with a NON_ZERO\n   value present in the request, but there is\
    \ an IPv4 Home Address\n   option with a NON_ZERO value present in the request,\
    \ then the\n   following considerations MUST be applied.\n   o  The search rules\
    \ specified in Section 5.4.1.1 of [RFC5213], which\n      primarily uses IPv6\
    \ home network prefix set as the search key, are\n      equally valid when using\
    \ a single IPv4 home address as the key.\n      When applying those considerations,\
    \ instead of the IPv6 home\n      network prefix(es), the IPv4 home address from\
    \ the IPv4 Home\n      Address option present in the request MUST be used as the\
    \ search\n      key.\n   o  The rules specified in Section 5.4.1.1 of [RFC5213]\
    \ assume the\n      presence of one or more IPv6 home network prefixes in the\
    \ received\n      request and also in the Binding Cache entry.  But, when using\
    \ the\n      IPv4 home address as the search key, these considerations MUST\n\
    \      always assume just one single IPv4 home address, both in the\n      request\
    \ and also in the Binding Cache entry.\n"
- title: 3.1.3.  Routing Considerations for the Local Mobility Anchor
  contents:
  - "3.1.3.  Routing Considerations for the Local Mobility Anchor\n   Intercepting\
    \ Packets Sent to the Mobile Node's IPv4 Home Address:\n   o  When the local mobility\
    \ anchor is serving a mobile node, it MUST\n      advertise a connected route\
    \ into the Routing Infrastructure for\n      the mobile node's IPv4 home address\
    \ or for its home subnet, in\n      order to receive packets that are sent to\
    \ the mobile node's IPv4\n      home address.  This essentially enables IPv4 routers\
    \ in that\n      network to detect the local mobility anchor as the last-hop router\n\
    \      for that subnet.\n   Forwarding Packets to the Mobile Node:\n   o  On receiving\
    \ a packet from a corresponding node with the\n      destination address matching\
    \ the mobile node's IPv4 home address,\n      the local mobility anchor MUST forward\
    \ the packet through the\n      bidirectional tunnel setup for that mobile node.\n\
    \   o  The format of the tunneled packet when payload protection is not\n    \
    \  enabled:\n        IPv6 header (src= LMAA, dst= Proxy-CoA       /* Tunnel Header\
    \ */\n           IPv4 header (src= CN, dst= IPv4-MN-HOA )  /* Packet Header */\n\
    \              Upper-layer protocols                  /* Packet Content*/\n  \
    \    Figure 2: Tunneled Packets from the Local Mobility Anchor (LMA) to\n    \
    \                   the Mobile Access Gateway (MAG)\n   Forwarding Packets Sent\
    \ by the Mobile Node:\n   o  All the reverse tunneled packets that the local mobility\
    \ anchor\n      receives from the mobile access gateway, after removing the tunnel\n\
    \      header, MUST be routed to the destination specified in the inner\n    \
    \  IPv4 packet header.  These routed packets will have the Source\n      Address\
    \ field set to the mobile node's IPv4 home address.\n"
- title: 3.1.4.  ECN and Payload Fragmentation Considerations
  contents:
  - "3.1.4.  ECN and Payload Fragmentation Considerations\n   The Explicit Congestion\
    \ Notification (ECN) considerations specified\n   in Section 5.6.3 of [RFC5213]\
    \ apply for the IPv4 payload packets as\n   well.  The mobility agents at the\
    \ tunnel entry and exit points MUST\n   handle ECN information as specified in\
    \ that document.\n   The mobility agents at the tunnel entry and exit points MUST\
    \ apply\n   the IP packet fragmentation considerations as specified in Section\
    \ 7\n   of [RFC2473]; additionally, they MUST apply the considerations\n   related\
    \ to tunnel error processing and reporting as specified in\n   Section 8 of [RFC2473].\n"
- title: 3.2.  Mobile Access Gateway Considerations
  contents:
  - '3.2.  Mobile Access Gateway Considerations

    '
- title: 3.2.1.  Extensions to Binding Update List Entry
  contents:
  - "3.2.1.  Extensions to Binding Update List Entry\n   To support the IPv4 home\
    \ address mobility feature, the conceptual\n   Binding Update List entry data\
    \ structure needs to be extended with\n   the following additional fields.\n \
    \  o  The IPv4 home address assigned to the mobile node's attached\n      interface.\
    \  This IPv4 home address may have been statically\n      configured in the mobile\
    \ node's policy profile, or, may have been\n      dynamically allocated by the\
    \ local mobility anchor.  The IPv4 home\n      address entry also includes the\
    \ corresponding subnet mask.\n   o  The IPv4 default router address of the mobile\
    \ node.  This is\n      acquired from the mobile node's local mobility anchor\
    \ through the\n      received Proxy Binding Acknowledgement message.\n"
- title: 3.2.2.  Extensions to Mobile Node's Policy Profile
  contents:
  - "3.2.2.  Extensions to Mobile Node's Policy Profile\n   To support the IPv4 home\
    \ address mobility support feature, the mobile\n   node's policy profile, specified\
    \ in Section 6.2 of [RFC5213], MUST be\n   extended with the following additional\
    \ fields.\n   Extensions to the mandatory section of the policy profile:\n   o\
    \  This field identifies all the IP versions for which the home\n      address\
    \ mobility support needs to be extended to the mobile node.\n      The supported\
    \ modes are IPv4-only, IPv6-only, and dual IPv4/IPv6.\n   Extensions to the optional\
    \ section of the policy profile:\n   o  The IPv4 home address assigned to the\
    \ mobile node's attached\n      interface.  The specific details on how the network\
    \ maintains the\n      association between the address and the attached interface\
    \ is\n      outside the scope of this document.  This address field also\n   \
    \   includes the corresponding subnet mask.\n"
- title: 3.2.3.  Signaling Considerations
  contents:
  - '3.2.3.  Signaling Considerations

    '
- title: 3.2.3.1.  Mobile Node Attachment and Initial Binding Registration
  contents:
  - "3.2.3.1.  Mobile Node Attachment and Initial Binding Registration\n   After detecting\
    \ a new mobile node on its access link, the mobile\n   access gateway on the access\
    \ link MUST determine if IPv4 home address\n   mobility support needs to be enabled\
    \ for that mobile node.  The\n   mobile node's policy profile identifies the supported\
    \ modes (IPv4-\n   only, IPv6-only, or dual IPv4/IPv6) for that mobile node for\
    \ which\n   the mobile service needs to be enabled.  Based on those policy\n \
    \  considerations and from other triggers such as from the network, if\n   it\
    \ is determined that IPv4 home address mobility support needs to be\n   enabled\
    \ for the mobile node, considerations from Section 6.9.1.1 of\n   [RFC5213] MUST\
    \ be applied with the following exceptions.\n   o  The IPv4 Home Address Request\
    \ option MUST be present in the Proxy\n      Binding Update message.\n      *\
    \  If the mobile access gateway learns the mobile node's IPv4 home\n         address\
    \ either from its policy profile or from other means, the\n         mobile access\
    \ gateway MAY ask the local mobility anchor to\n         allocate that specific\
    \ address by including exactly one\n         instance of the IPv4 Home Address\
    \ Request option with the IPv4\n         home address and the prefix length fields\
    \ in the option set to\n         that specific IPv4 address and the prefix length\
    \ of the\n         corresponding home network.\n      *  The mobile access gateway\
    \ MAY also ask the local mobility\n         anchor for dynamic IPv4 home address\
    \ allocation.  It can\n         include exactly one instance of the IPv4 Home\
    \ Address option\n         with the IPv4 home address and the prefix length fields\
    \ in the\n         option set to the ALL_ZERO value.  Furthermore, the (P) flag\
    \ in\n         the option MUST be set to 0.  This serves as a request to the\n\
    \         local mobility anchor for the IPv4 home address allocation.\n   o  The\
    \ Proxy Binding Update message MUST be constructed as specified\n      in Section\
    \ 6.9.1.5 of [RFC5213].  However, the Home Network Prefix\n      option(s) [RFC5213]\
    \ MUST be present in the Proxy Binding Update\n      only if IPv6 home address\
    \ mobility support also needs to be\n      enabled for the mobile node.  Otherwise,\
    \ the Home Network Prefix\n      option(s) MUST NOT be present.\n   o  When using\
    \ IPv4 transport to carry the signaling messages, the\n      related considerations\
    \ from Section 4 MUST be applied\n      additionally.\n"
- title: 3.2.3.2.  Receiving Proxy Binding Acknowledgement
  contents:
  - "3.2.3.2.  Receiving Proxy Binding Acknowledgement\n   All the considerations\
    \ from Section 6.9.1.2 of [RFC5213] MUST be\n   applied with the following exceptions.\n\
    \   o  If the received Proxy Binding Acknowledgement message has the\n      Status\
    \ field value set to NOT_AUTHORIZED_FOR_IPV4_MOBILITY_SERVICE\n      (The mobile\
    \ node is not authorized for IPv4 mobility service), the\n      mobile access\
    \ gateway SHOULD NOT send a Proxy Binding Update\n      message including a IPv4\
    \ Home Address Request option until an\n      administrative action is taken.\n\
    \   o  If the received Proxy Binding Acknowledgement message has the\n      Status\
    \ field value set to NOT_AUTHORIZED_FOR_IPV4_HOME_ADDRESS\n      (The mobile node\
    \ is not authorized for the requesting IPv4 home\n      address), the mobile access\
    \ gateway SHOULD NOT request the same\n      IPv4 address again, but MAY request\
    \ the local mobility anchor to\n      perform the address assignment by including\
    \ exactly one instance\n      of the IPv4 Home Address Request option with the\
    \ IPv4 home address\n      and the prefix length fields in the option set to the\
    \ ALL_ZERO\n      value.\n   o  If the received Proxy Binding Acknowledgement\
    \ message has the\n      Status field value set to NOT_AUTHORIZED_FOR_IPV6_MOBILITY_SERVICE\n\
    \      (The mobile node is not authorized for IPv6 mobility service), the\n  \
    \    mobile access gateway SHOULD NOT send a Proxy Binding Update\n      message\
    \ including any Home Network Prefix option(s) until an\n      administrative action\
    \ is taken.\n   o  If there is no IPv4 Home Address Reply option present in the\n\
    \      received Proxy Binding Acknowledgement message, the mobile access\n   \
    \   gateway MUST NOT enable IPv4 support for the mobile node and the\n      rest\
    \ of the considerations from this section can be skipped.\n   o  If the received\
    \ Proxy Binding Acknowledgement message has the\n      Status field value in the\
    \ IPv4 Home Address Reply option set to a\n      value that indicates that the\
    \ request was rejected by the local\n      mobility anchor, the mobile access\
    \ gateway MUST NOT enable IPv4\n      mobility support.\n   o  If the received\
    \ Proxy Binding Acknowledgement message has the\n      Status field value set\
    \ to 0 (Proxy Binding Update accepted), the\n      mobile access gateway MUST\
    \ update a Binding Update List entry for\n      that mobile node.  The entry MUST\
    \ be updated with the assigned\n      IPv4 home address and other accepted registration\
    \ values.\n   o  If the received Proxy Binding Acknowledgement message has the\n\
    \      Status field value set to 0 (Proxy Binding Update accepted) and\n     \
    \ has the IPv4 Home Address Reply option set to a value that\n      indicates\
    \ that the request was accepted by the local mobility\n      anchor, the mobile\
    \ access gateway MUST establish a bidirectional\n      tunnel to the local mobility\
    \ anchor (if there is no existing\n      bidirectional tunnel to that local mobility\
    \ anchor) and with the\n      encapsulation mode set to IPv4-or-IPv6-over-IPv6\
    \ (an IPv4 or IPv6\n      packet carried as a payload of an IPv6 packet).  Considerations\n\
    \      from Section 5.6.1 of [RFC5213] MUST be applied for managing the\n    \
    \  dynamically created bidirectional tunnel.  However, when using\n      IPv4\
    \ transport, the encapsulation mode MUST be set to the\n      negotiated encapsulation\
    \ mode, as specified in Section 4 of this\n      document.\n   o  The mobile access\
    \ gateway MUST set up the route for forwarding the\n      IPv4 packets received\
    \ from the mobile node (using its IPv4 home\n      address) through the bidirectional\
    \ tunnel set up for that mobile\n      node.\n   o  The default router address\
    \ MUST be obtained from the IPv4 Default-\n      Router Address option present\
    \ in the received Proxy Binding\n      Acknowledgement message.  The mobile access\
    \ gateway SHOULD\n      configure this address on its interface and respond to\
    \ any Address\n      Resolution Protocol (ARP) requests sent by the mobile node\
    \ to\n      resolve the hardware address of the default router.  However,\n  \
    \    since the link between the mobile access gateway and the mobile\n      node\
    \ is a point-to-point link, implementations will be able\n      receive any packets\
    \ sent to the default router address without\n      having to explicitly configure\
    \ the default router address on its\n      interface.  The mobile access gateway\
    \ MAY also use the default\n      router address as the source address for any\
    \ datagrams sent to the\n      mobile node and originated by the mobile access\
    \ gateway itself.\n      It MUST also use this address in the DHCP Router option\
    \ [RFC2132]\n      in the DHCP messages.\n   o  If there is an IPv4 DHCP Support\
    \ Mode option (Section 3.3.4)\n      present in the received Proxy Binding Acknowledgement\
    \ message and\n      if the (S) flag in the option is set to a value of (1), then\
    \ the\n      mobile access gateway MUST function as a DHCP server for the\n  \
    \    mobile node.  If either the (S) flag in the option is set to a\n      value\
    \ of (0), or if the option is not present in the request, then\n      the mobile\
    \ access gateway MUST function as a DHCP Relay for the\n      mobile node.\n"
- title: 3.2.3.3.  Binding Re-Registration and De-Registrations
  contents:
  - "3.2.3.3.  Binding Re-Registration and De-Registrations\n   When sending a Proxy\
    \ Binding Update either to extend the lifetime of\n   a mobility session or to\
    \ de-register the mobility session, the\n   respective considerations from [RFC5213]\
    \ MUST be applied.\n   Furthermore, the following additional considerations MUST\
    \ also be\n   applied.\n   o  If there is an IPv4 home address assigned to the\
    \ mobility session,\n      then there MUST be exactly one instance of the IPv4\
    \ Home Address\n      Request option present in the Proxy Binding Update message.\
    \  The\n      IPv4 home address and the prefix length fields in the option MUST\n\
    \      be set to that specific address and its corresponding subnet-mask\n   \
    \   length.\n   o  If there was no IPv4 home address requested in the initial\
    \ Proxy\n      Binding Update message, but it is determined that the IPv4 home\n\
    \      address MUST be requested subsequently, then there MUST be exactly\n  \
    \    one instance of the IPv4 Home Address Request option present in\n      the\
    \ Proxy Binding Update message.  The IPv4 home address in the\n      option MUST\
    \ be set to either ALL_ZERO or to a specific address\n      that is being requested.\n\
    \   o  For performing selective de-registration of IPv4 home address but\n   \
    \   still retaining the mobility session with all the IPv6 home\n      network\
    \ prefixes, the Proxy Binding Update message with the\n      lifetime value of\
    \ (0) MUST NOT include any IPv6 Home Network\n      Prefix options [RFC5213].\
    \  It MUST include exactly one instance of\n      the IPv4 Home Address Request\
    \ option with the IPv4 home address\n      and the prefix length fields in the\
    \ option set to the IPv4 home\n      address that is being de-registered.  Similarly,\
    \ for selective de-\n      registration of all the IPv6 home network prefixes,\
    \ the Proxy\n      Binding Update message MUST NOT include the IPv4 Home address\n\
    \      option, it MUST include a Home Network Prefix option for each of\n    \
    \  the assigned home network prefixes assigned for that mobility\n      session\
    \ and with the prefix value in the option set to that\n      respective prefix\
    \ value.\n   o  The Home Network Prefix option(s) [RFC5213] MUST NOT be present\
    \ if\n      the same option(s) was not present in the initial Proxy Binding\n\
    \      Update message.  Otherwise, considerations from [RFC5213] with\n      respect\
    \ to this option MUST be applied.\n   o  If at any point the mobile access gateway\
    \ fails to extend the\n      binding lifetime with the local mobility anchor for\
    \ the mobile\n      node's IPv4 address, it MUST remove any forwarding state set\
    \ up\n      for the mobile node's IPv4 home address.\n"
- title: 3.2.4.  Routing Considerations for the Mobile Access Gateway
  contents:
  - "3.2.4.  Routing Considerations for the Mobile Access Gateway\n   o  On receiving\
    \ a packet from the bidirectional tunnel established\n      with the mobile node's\
    \ local mobility anchor, the mobile access\n      gateway MUST remove the outer\
    \ header before forwarding the packet\n      to the mobile node.\n   o  On receiving\
    \ a packet from a mobile node connected to its access\n      link, the packet\
    \ MUST be forwarded to the local mobility anchor\n      through the bidirectional\
    \ tunnel established with the local\n      mobility anchor.  However, when the\
    \ EnableMAGLocalRouting flag is\n      set, considerations from Section 6.10.3\
    \ of [RFC5213] MUST be\n      applied with respect to local routing.\n   o  When\
    \ forwarding the packet through the bidirectional tunnel, the\n      encapsulation\
    \ considerations as specified in Section 3.1.3 MUST be\n      applied (except\
    \ that the source and destination addresses fields\n      in the outer encapsulation\
    \ header are reversed).  However, before\n      forwarding the packet, the mobile\
    \ access gateway MUST ensure the\n      source address in the received packet\
    \ is the address allocated for\n      that mobile node and that there is an active\
    \ binding on the local\n      mobility anchor for that mobile node.\n   o  The\
    \ mobile access gateway SHOULD use the Proxy ARP [RFC0925] to\n      reply to\
    \ ARP Requests that it receives from the mobile node\n      seeking address resolutions\
    \ for the destinations on the mobile\n      node's home subnet.  When receiving\
    \ an ARP Request, the mobile\n      access gateway SHOULD examine the target IP\
    \ address of the\n      Request, and if this IP address matches the mobile node's\
    \ IPv4\n      home subnet, it SHOULD transmit a Proxy ARP Reply.  However, on\n\
    \      certain types of links, the mobile node does not use ARP for\n      address\
    \ resolutions, instead it forwards all the packets to the\n      mobile access\
    \ gateway.  On such types of links, the mobile access\n      gateway is not required\
    \ to support the Proxy ARP function.  At the\n      same time, implementations\
    \ not supporting the Proxy ARP function\n      on links where the mobile node\
    \ uses ARP for seeking address\n      resolutions for the destinations on the\
    \ mobile node's home subnet\n      will result in communication failure.\n"
- title: 3.3.  Mobility Options and Status Codes
  contents:
  - "3.3.  Mobility Options and Status Codes\n   To support the IPv4 home address\
    \ mobility feature, this specification\n   defines the following new options and\
    \ status codes.\n"
- title: 3.3.1.  IPv4 Home Address Request Option
  contents:
  - "3.3.1.  IPv4 Home Address Request Option\n   A new option, the IPv4 Home Address\
    \ Request option, is defined for\n   use with the Proxy Binding Update message\
    \ sent by the mobile access\n   gateway to the local mobility anchor.  This option\
    \ is used to request\n   IPv4 home address assignment for the mobile node.\n \
    \  The IPv4 Home Address Request option has an alignment requirement of\n   4n.\
    \  Its format is as follows:\n       0                   1                   2\
    \                   3\n       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3\
    \ 4 5 6 7 8 9 0 1\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      |     Type      |   Length      |Prefix-len |      Reserved     |\n   \
    \   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n      |\
    \                     IPv4 home address                         |\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \                Figure 3: IPv4 Home Address Request Option\n      Type\n    \
    \     36\n      Length\n         An 8-bit unsigned integer indicating the length\
    \ of the option\n         in octets, excluding the Type and Length fields.  This\
    \ field\n         MUST be set to (6).\n      Prefix-len\n         This 6-bit unsigned\
    \ integer indicating the prefix length of the\n         mobile node's IPv4 home\
    \ network corresponding to the IPv4 home\n         address contained in the option.\n\
    \      Reserved\n         This 10-bit field is unused for now.  The value MUST\
    \ be\n         initialized to (0) by the sender and MUST be ignored by the\n \
    \        receiver.\n      IPv4 home address\n         This 4-byte field containing\
    \ the IPv4 home address that is\n         being requested.  The value of 0.0.0.0\
    \ is used to request that\n         the local mobility anchor perform the address\
    \ allocation.\n"
- title: 3.3.2.  IPv4 Home Address Reply Option
  contents:
  - "3.3.2.  IPv4 Home Address Reply Option\n   A new option, the IPv4 Home Address\
    \ Reply option, is defined for use\n   in the Proxy Binding Acknowledgement message\
    \ sent by the local\n   mobility anchor to the mobile access gateway.  This option\
    \ can be\n   used to send the assigned mobile node's IPv4 home address.\n   The\
    \ IPv4 Home Address Reply option has an alignment requirement of\n   4n.  Its\
    \ format is as follows:\n       0                   1                   2    \
    \               3\n       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5\
    \ 6 7 8 9 0 1\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      |     Type      |    Length     |   Status      |Pref-len   |Res|\n   \
    \   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n      |\
    \                      IPv4 home address                        |\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \                 Figure 4: IPv4 Home Address Reply Option\n      Type\n     \
    \    37\n      Length\n         An 8-bit unsigned integer indicating the length\
    \ of the option\n         in octets, excluding the Type and Length fields.  This\
    \ field\n         MUST be set to (6).\n      Status\n         Indicates success\
    \ or failure for the IPv4 home address\n         assignment.  Values from 0 to\
    \ 127 indicate success.  Higher\n         values (128 to 255) indicate failure.\
    \  The following Status\n         values are currently allocated by this document:\n\
    \            0 Success\n            128 Failure, reason unspecified\n        \
    \    129 Administratively prohibited\n            130 Incorrect IPv4 home address\n\
    \            131 Invalid IPv4 address\n            132 Dynamic IPv4 home address\
    \ assignment not available\n      Prefix-len\n         This 6-bit unsigned integer\
    \ is used to carry the prefix length\n         of the mobile node's IPv4 home\
    \ network corresponding to the\n         IPv4 home address contained in the option.\n\
    \      Reserved (Res)\n         This 2-bit field is unused for now.  The value\
    \ MUST be\n         initialized to (0) by the sender and MUST be ignored by the\n\
    \         receiver.\n      IPv4 home address\n         This 4-byte field is used\
    \ to carry the IPv4 home address\n         assigned to the mobile node.\n"
- title: 3.3.3.  IPv4 Default-Router Address Option
  contents:
  - "3.3.3.  IPv4 Default-Router Address Option\n   A new option, the IPv4 Default-Router\
    \ Address option, is defined for\n   use in the Proxy Binding Acknowledgement\
    \ message sent by the local\n   mobility anchor to the mobile access gateway.\
    \  This option can be\n   used to send the mobile node's IPv4 default router address.\n\
    \   The IPv4 Default-Router Address option has an alignment requirement\n   of\
    \ 4n.  Its format is as follows:\n       0                   1               \
    \    2                   3\n       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\
    \ 2 3 4 5 6 7 8 9 0 1\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      |      Type     |   Length      |         Reserved (R)          |\n   \
    \   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n      |\
    \                  IPv4 Default-Router Address                  |\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \               Figure 5: IPv4 Default-Router Address Option\n      Type\n   \
    \      38\n      Length\n         An 8-bit unsigned integer indicating the length\
    \ of the option\n         in octets, excluding the Type and Length fields.  This\
    \ field\n         MUST be set to (6).\n      Reserved (R)\n         This 16-bit\
    \ field is unused for now.  The value MUST be\n         initialized to (0) by\
    \ the sender and MUST be ignored by the\n         receiver.\n      IPv4 Default-Router\
    \ Address\n         A 4-byte field containing the mobile node's default router\n\
    \         address.\n"
- title: 3.3.4.  IPv4 DHCP Support Mode Option
  contents:
  - "3.3.4.  IPv4 DHCP Support Mode Option\n   A new option, the IPv4 DHCP Support\
    \ Mode option, is defined for use\n   in the Proxy Binding Acknowledgement message\
    \ sent by the local\n   mobility anchor to the mobile access gateway.  This option\
    \ can be\n   used to notify the mobile access gateway as to whether it should\n\
    \   function as a DHCP Server or a DHCP Relay for the attached mobile\n   node.\n\
    \   The IPv4 DHCP Support Mode option has no alignment requirement.  Its\n   format\
    \ is as follows:\n       0                   1                   2           \
    \        3\n       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9\
    \ 0 1\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      |      Type     |   Length      |    Reserved (R)             |S|\n   \
    \   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n      \
    \            Figure 6: IPv4 DHCP Support Mode Option\n      Type\n         39\n\
    \      Length\n         An 8-bit unsigned integer indicating the length of the\
    \ option\n         in octets, excluding the Type and Length fields.  This field\n\
    \         MUST be set to 2.\n      Reserved (R)\n         This 15-bit field is\
    \ unused for now.  The value MUST be\n         initialized to (0) by the sender\
    \ and MUST be ignored by the\n         receiver.\n      DHCP Support Mode (S)\n\
    \         A 1-bit field that specifies the DHCP support mode.  This flag\n   \
    \      indicates whether the mobile access gateway should function as\n      \
    \   a DHCP Server or a DHCP Relay for the attached mobile node.\n         The\
    \ flag value of (0) indicates the mobile access gateway\n         should act as\
    \ a DHCP Relay, and the flag value of (1) indicates\n         it should act as\
    \ a DHCP Server.\n"
- title: 3.3.5.  Status Codes
  contents:
  - "3.3.5.  Status Codes\n   This document defines the following new Status values\
    \ for use in the\n   Proxy Binding Acknowledgement message.  These values are\
    \ to be\n   allocated from the same numbering space, as defined in Section 6.1.8\n\
    \   of [RFC3775].\n   NOT_AUTHORIZED_FOR_IPV4_MOBILITY_SERVICE: 170\n      Mobile\
    \ node not authorized for IPv4 mobility service.\n   NOT_AUTHORIZED_FOR_IPV4_HOME_ADDRESS:\
    \ 171\n      Mobile node not authorized for the requesting IPv4 home address.\n\
    \   NOT_AUTHORIZED_FOR_IPV6_MOBILITY_SERVICE: 172\n      Mobile node not authorized\
    \ for IPv6 mobility service.\n   MULTIPLE_IPV4_HOME_ADDRESS_ASSIGNMENT_NOT_SUPPORTED:\
    \ 173\n      Multiple IPv4 home address assignments not supported.\n"
- title: 3.4.  Supporting DHCP-Based Address Configuration
  contents:
  - "3.4.  Supporting DHCP-Based Address Configuration\n   This section explains how\
    \ DHCP-based address configuration support\n   can be enabled for a mobile node\
    \ in a Proxy Mobile IPv6 domain.  It\n   explains the protocol operation, supported\
    \ DHCP server deployment\n   configurations, and the protocol interactions between\
    \ DHCP agents and\n   mobility entities in each of the supported configurations.\n\
    \   This specification supports the following two DHCP deployment\n   configurations.\n\
    \   o  DHCP relay agent co-located with the mobile access gateway.\n   o  DHCP\
    \ server co-located in the mobile access gateway.\n   The following are the configuration\
    \ requirements:\n   o  The DHCP server or the DHCP relay agent configured on the\
    \ mobile\n      access gateway is required to have an IPv4 address for exchanging\n\
    \      the DHCP messages with the mobile node.  This address is the\n      mobile\
    \ node's default router address provided by the local\n      mobility anchor.\
    \  Optionally, all the DHCP servers co-located with\n      the mobile access gateways\
    \ in the Proxy Mobile IPv6 domain can be\n      configured with a fixed IPv4 address.\
    \  This fixed address can be\n      an IPv4 private address [RFC1918] that can\
    \ be used for the DHCP\n      protocol communication on any of the access links.\
    \  This address\n      will be used as the server identifier in the DHCP messages.\n\
    \   o  A DHCP server identifies a DHCP interface from the contents of the\n  \
    \    DHCP \"Client-identifier\" option [RFC2132], if present, or from the\n  \
    \    client hardware address (chaddr), as specified in [RFC2131].  Note\n    \
    \  that the name \"Client-identifier\" is a misnomer as it actually\n      identifies\
    \ an interface and not the client.  The DHCP server uses\n      this identity\
    \ to identify the interface for which the address is\n      assigned.  A mobile\
    \ node in a Proxy Mobile IPv6 domain, can attach\n      to the network through\
    \ multiple interfaces and can obtain address\n      configuration for each of\
    \ its interfaces.  Additionally, it may\n      perform handoffs between its interfaces.\
    \  The following are the\n      related considerations with respect to the identification\n\
    \      presented to the DHCP server.\n      *  If the mobile node attaches to\
    \ the Proxy Mobile IPv6 domain\n         through multiple physical interfaces,\
    \ the DHCP server will\n         uniquely identify each of those interfaces and\
    \ will perform\n         address assignment.  The DHCP server will identify the\n\
    \         interface as specified in RFC 2131.  The mobile node SHOULD\n      \
    \   generate and use the \"Client-identifier\" for each physical\n         interface\
    \ according to [RFC4361].  Any time the mobile node\n         performs a handoff\
    \ of a physical interface to a different\n         mobile access gateway, using\
    \ the same interface, the DHCP\n         server will always be able to identify\
    \ the binding using the\n         presented identifier.  The presented identifier\
    \ (either the\n         \"Client-identifier\" or the hardware address) will remain\
    \ as the\n         primary key for each binding, just as how they are unique in\
    \ a\n         Binding Cache entry.\n      *  If the mobile node is capable of\
    \ performing a handoff between\n         interfaces, as per [RFC5213], a \"Client-identifier\"\
    \ value MUST\n         be used for the attachment point that is not tied to any\
    \ of the\n         physical interfaces.  The identifier MUST be generated\n  \
    \       according to [RFC4361], which guarantees that the identifier is\n    \
    \     stable and unique across all \"Client-identifier\" values in use\n     \
    \    in the Proxy Mobile IPv6 domain.\n   o  All the DHCP servers co-located with\
    \ the mobile access gateways in\n      a Proxy Mobile IPv6 domain can be configured\
    \ with the same set of\n      DHCP option values (e.g., DNS Server, SIP Server,\
    \ etc.) to ensure\n      the mobile node receives the same configuration values\
    \ on any of\n      the access links in that Proxy Mobile IPv6 domain.\n"
- title: 3.4.1.  DHCP Server Co-Located with the Mobile Access Gateway
  contents:
  - "3.4.1.  DHCP Server Co-Located with the Mobile Access Gateway\n   This section\
    \ explains the operational sequence of home address\n   assignment operation when\
    \ the DHCP server is co-located with the\n   mobile access gateway.\n     MN \
    \  MAG(DHCP-S)  LMA\n      |------>|        |    1. DHCPDISCOVER\n      |    \
    \   |------->|    2. Proxy Binding Update\n      |       |<-------|    3. Proxy\
    \ Binding Acknowledgement (IPv4 HoA)\n      |       |========|    4. Tunnel/Route\
    \ Setup\n      |<------|        |    5. DHCPOFFER  (IPv4 HoA)\n      |------>|\
    \        |    6. DHCPREQUEST (IPv4 HoA)\n      |<------|        |    7. DHCPACK\n\
    \      |       |        |\n    Figure 7: Overview of DHCP Server Located at Mobile\
    \ Access Gateway\n   o  It is possible that the mobile access gateway may have\
    \ already\n      completed the Proxy Mobile IPv6 signaling with the local mobility\n\
    \      anchor to request both IPv6 home network prefix(es) and IPv4 home\n   \
    \   address assignment prior to Step 1.  In such an event, the Proxy\n      Mobile\
    \ IPv6 signaling steps (Steps 2 to 4) above are not relevant.\n   o  It is possible\
    \ the mobile access gateway may have initially\n      completed the Proxy Mobile\
    \ IPv6 signaling prior to Step 1, but\n      only for requesting IPv6 home network\
    \ prefix(es), and it may later\n      request IPv4 home address assignment after\
    \ detecting the DHCP\n      triggers from the mobile node as shown above.\n  \
    \ o  The mobile access gateway may choose to ignore the DHCPDISCOVER\n      messages\
    \ until the Proxy Mobile IPv6 signaling is successfully\n      completed, or it\
    \ may choose to send a delayed response for\n      reducing the additional delay\
    \ waiting for a new DHCPDISCOVER\n      message from the mobile node.\n   Initial\
    \ IPv4 Home Address Assignment:\n   o  To acquire the mobile node's IPv4 home\
    \ address from the local\n      mobility anchor, the mobile access gateway will\
    \ initiate Proxy\n      Mobile IPv6 signaling with the local mobility anchor.\n\
    \   o  After the successful completion of the Proxy Mobile IPv6 signaling\n  \
    \    and upon acquiring the mobile node's IPv4 home address from the\n      local\
    \ mobility anchor, the DHCP server on the mobile access\n      gateway will send\
    \ a DHCPOFFER message [RFC2131] to the mobile\n      node.  The offered address\
    \ will be the mobile node's IPv4 home\n      address, assigned by the local mobility\
    \ anchor.  The DHCPOFFER\n      message will also have the Subnet Mask option\
    \ [RFC2132] and Router\n      option [RFC2132], with the values in those options\
    \ set to the\n      mobile node's IPv4 home subnet mask and default router address,\n\
    \      respectively.  Additionally, the Server Identifier option will be\n   \
    \   included and with the value in the option set to the default\n      router\
    \ address.\n   o  If the mobile node sends the DHCPREQUEST message, the DHCP server\n\
    \      will send DHCPACK message, as per [RFC2131].\n   IPv4 Home Address Renewal\
    \ with the DHCP Server (No Handoff):\n   o  Any time the mobile node goes into\
    \ the DHCP RENEWING state\n      [RFC2131], it simply unicasts the DHCPREQUEST\
    \ message including\n      the assigned IPv4 home address in the 'Requested IP\
    \ Address'\n      option.  The DHCPREQUEST is sent to the address specified in\
    \ the\n      Server Identifier option of the previously received DHCPOFFER and\n\
    \      DHCPACK messages.\n   o  The DHCP server will send a DHCPACK to the mobile\
    \ node to\n      acknowledge the assignment of the committed IPv4 address.\n \
    \  IPv4 Home Address Renewal with the DHCP Server (after Handoff):\n   When the\
    \ mobile node goes into the DHCP RENEWING state [RFC2131], it\n   directly unicasts\
    \ the DHCPREQUEST message to the DHCP server that\n   currently provided the DHCP\
    \ lease.  However, if the mobile node\n   changed its point of attachment and\
    \ is attached to a new mobile\n   access gateway, it is required that the mobile\
    \ node update the DHCP\n   server address and use the address of the DHCP server\
    \ that is co-\n   located with the new mobile access gateway.  The following approach\n\
    \   can be adopted to ensure the mobile node uses the DHCP server on the\n   attached\
    \ link.\n     MN   oMAG(DHCP-S) nMAG(DHCP-S)\n      |       :        |\n    RENEW------------->|\
    \    1. DHCPREQUEST (IPv4 HoA)\n    BOUND<-------------|    2. DHCPACK (IPv4 HoA)\
    \ or DHCPNACK\n      |       :        |\n    *  The use of a fixed DHCP server\
    \ address on all DHCP servers\n              Figure 8: Address Renewal with the\
    \ DHCP Server\n   o  The use of a stable address, either the IPv4 default router\n\
    \      address of the mobile node or a fixed IPv4 address common in that\n   \
    \   Proxy Mobile IPv6 domain, as the DHCP Server Identifier will\n      ensure\
    \ the DHCPREQUEST message sent by the mobile node to renew\n      the address\
    \ will be received by the new mobile access gateway on\n      the attached link.\n\
    \   o  The mobile access gateway after completing the Proxy Mobile IPv6\n    \
    \  signaling and upon acquiring the IPv4 home address of the mobile\n      node\
    \ will return the address in the DHCPACK message.  However, if\n      the mobile\
    \ access gateway is unable to complete the Proxy Mobile\n      IPv6 signaling\
    \ or is unable to acquire the same IPv4 address as\n      requested by the mobile\
    \ node, it will send a DHCPNACK message\n      [RFC2131] to the mobile node, as\
    \ shown in Figure 8.\n"
- title: 3.4.2.  DHCP Relay Agent Co-Located with the Mobile Access Gateway
  contents:
  - "3.4.2.  DHCP Relay Agent Co-Located with the Mobile Access Gateway\n   A DHCP\
    \ relay agent is co-located with each mobile access gateway.  A\n   DHCP server\
    \ is located somewhere in the Proxy Mobile IPv6 domain\n   (e.g., is co-located\
    \ with the local mobility anchor).  Figure 9 shows\n   the sequence of IPv4 home\
    \ address assignment using DHCP Relay.\n  MN   MAG(DHCP-R) LMA   DHCP-S\n   |\
    \       |------->|      | 1. Proxy Binding Update *\n   |       |<-------|   \
    \   | 2. Proxy Binding Acknowledgement (IPv4 HoA)\n   |       |========|     \
    \ | 3. Tunnel/Route Setup*\n   |------>|-------------->| 4. DHCPDISCOVER (IPv4\
    \ HoA) via DHCP-R\n   |<------|<--------------| 5. DHCPOFFER (IPv4 HoA) via DHCP-R\n\
    \   |------>|-------------->| 6. DHCPREQUEST (IPv4 HoA) via DHCP-R\n   |<------|<--------------|\
    \ 7. DHCPACK (IPv4 HoA) via DHCP-R\n   |       |               |\n   Figure 9:\
    \ Overview of the DHCP Relay Located at Mobile Access Gateway\n   o  The Proxy\
    \ Mobile IPv6 signaling (starting at Step 1) and the DHCP\n      address configuration\
    \ (starting at Step 4) may start in any order.\n      However, the DHCPOFFER (Step\
    \ 5) and the immediate steps following\n      it will occur in the specified order\
    \ and only after the Tunnel/\n      Route Setup (Step 3).\n   o  It is possible\
    \ the mobile access gateway may have initially\n      completed the Proxy Mobile\
    \ IPv6 signaling with the local mobility\n      anchor only to request IPv6 home\
    \ network prefix(es) and may later\n      request IPv4 home address assignment\
    \ after detecting the DHCP\n      triggers from the mobile node (after Step 4).\n\
    \   o  The mobile access gateway may choose to ignore the DHCPDISCOVER\n     \
    \ messages until the Proxy Mobile IPv6 signaling is successfully\n      completed,\
    \ or it may choose to send a delayed response for\n      reducing the additional\
    \ delay waiting for a new DHCPDISCOVER\n      message from the mobile node.\n\
    \   Initial IPv4 Home Address Assignment:\n   o  To acquire the mobile node's\
    \ IPv4 home address from the local\n      mobility anchor, the mobile access gateway\
    \ will initiate Proxy\n      Mobile IPv6 signaling with the local mobility anchor.\n\
    \   o  After the successful completion of the Proxy Mobile IPv6 signaling\n  \
    \    and upon acquiring the mobile node's IPv4 home address from the\n      local\
    \ mobility anchor, the mobile access gateway will enable\n      forwarding for\
    \ all the DHCP messages between the mobile node and\n      the DHCP server.\n\
    \   o  The DHCP relay agent on the mobile access gateway will add the\n      DHCP\
    \ Relay Agent Information option [RFC3046] to the DHCPDISCOVER\n      message.\
    \  The assigned IPv4 home address will be included in the\n      Agent Remote\
    \ ID Sub-option of the DHCP Relay Agent Information\n      option.  This sub-option\
    \ is used as a hint for requesting the DHCP\n      server to allocate that specific\
    \ IPv4 address.\n   o  On receiving a DHCPOFFER message from the DHCP server,\
    \ the mobile\n      access gateway will ensure the assigned address is currently\n\
    \      assigned by the local mobility anchor to that mobile node.  If\n      this\
    \ address is different from what is assigned to the mobile\n      node, then the\
    \ mobile access gateway will drop the DHCPOFFER\n      message and an administrative\
    \ error message will be logged.\n   o  When the DHCP messages are sent over administrative\
    \ boundaries,\n      the operators need to ensure these messages are secured.\
    \  All the\n      DHCP messages relayed by the mobile access gateway can be tunneled\n\
    \      to the local mobility anchor if needed.  Alternatively, if the\n      network\
    \ in the Proxy Mobile IPv6 domain is secure enough, the\n      mobile access gateway\
    \ can just relay the DHCP messages to the\n      server.  To achieve this, all\
    \ the mobile access gateways need to\n      have a route towards the DHCP server.\n\
    \   IPv4 Home Address Renewal to the same DHCP Server: (No Handoff)\n   o  When\
    \ the DHCP client goes into the DHCP RENEW STATE [RFC2131], it\n      directly\
    \ unicasts DHCPREQUEST messages to the DHCP server.  The\n      DHCP relay agent\
    \ may not detect any changes in the DHCP state.\n      For example, if the mobile\
    \ node releases the IPv4 address, the\n      relay agent would not be aware of\
    \ it.  The following describes\n      additional mechanisms for the mobile access\
    \ gateway to detect any\n      changes in the DHCP state.\n      *  The DHCP relay\
    \ agent can intercept all IPv4 DHCP packets\n         destined to the set of addresses\
    \ used within the Proxy Mobile\n         IPv6 domain as DHCP addresses.  Since\
    \ the link between a mobile\n         node and a mobile access gateway is the\
    \ point-to-point link,\n         the mobile access gateway will be in path for\
    \ all the messages.\n      *  The DHCP relay agent can use the DHCP Server Identifier\n\
    \         Override Sub-option [RFC5107] to be in path for all the DHCP\n     \
    \    message flows.  The DHCP client uses the DHCP server address\n         that\
    \ is overridden by the DHCP relay agent address as a\n         destination address\
    \ of DHCPREQUEST.  The DHCP Server Identifier\n         Override Sub-option is\
    \ recommended only when the fixed DHCP\n         relay address is configured on\
    \ all the mobile access gateways.\n         Otherwise, the DHCP relay agent address\
    \ is changed when the\n         mobile node changes the attached mobile access\
    \ gateway.\n   o  However, if the DHCP server is co-located with the local mobility\n\
    \      anchor, then the DHCP relay agent is not required to intercept the\n  \
    \    unicast DHCP messages between the mobile node and the DHCP server.\n    \
    \  This is because the local mobility anchor will ensure that the\n      DHCP\
    \ state is consistent with the Proxy Mobile IPv6 binding that\n      exists for\
    \ the IPv4 address.\n   o  Once the mobile access gateway intercepts the DHCP\
    \ message from\n      the mobile node to the DHCP server, it can verify if the\
    \ mobile\n      node is negotiating the same IPv4 address that the local mobility\n\
    \      anchor allocated for that mobile node.  If the address in the\n      DHCPREQUEST\
    \ message does not match with the IPv4 address allocated\n      for the mobile\
    \ node, then the mobile access gateway SHOULD drop\n      the DHCP message and\
    \ an administrative error message can be\n      logged.\n   o  Any time the mobile\
    \ access gateway detects that the mobile node\n      has released its IPv4 address,\
    \ it can send a Proxy Binding Update\n      to the local mobility anchor and de-register\
    \ the IPv4 mobility\n      session.\n"
- title: 3.4.3.  Common DHCP Considerations
  contents:
  - "3.4.3.  Common DHCP Considerations\n   The following DHCP-related considerations\
    \ are common to both the\n   supported configuration modes, specified in Sections\
    \ 3.4.1 and 3.4.2.\n   o  When a mobile node sends a DHCPDISCOVER message [RFC2131],\
    \ the\n      DHCP server or the relay agent co-located with the mobile access\n\
    \      gateway will trigger the mobile access gateway to complete the\n      Proxy\
    \ Mobile IPv6 signaling.  This is the required interaction\n      between these\
    \ two protocols.  The mobile access gateway, on\n      receiving this trigger,\
    \ will check if there is already an assigned\n      IPv4 home address for the\
    \ mobile node, from the local mobility\n      anchor.  If there is no assigned\
    \ IPv4 home address assigned for\n      that mobile node, the mobile access gateway\
    \ will complete the\n      Proxy Mobile IPv6 signaling with the local mobility\
    \ anchor by\n      sending a Proxy Binding Update message.\n   o  The mobile node\
    \ needs to be identified by the MN-Identifier, as\n      specified in Section\
    \ 6.6 of [RFC5213].  This identity should be\n      associated to the DHCP messages\
    \ sent by the mobile node.\n   o  The mobile access gateway will drop all the\
    \ DHCPDISCOVER messages\n      until it completes the Proxy Mobile IPv6 signaling.\
    \  If the mobile\n      access gateway is unable to complete the Proxy Mobile\
    \ IPv6\n      signaling, or, if the local mobility anchor does not assign an\n\
    \      IPv4 address for the mobile node, the mobile access gateway MUST\n    \
    \  NOT enable IPv4 home address mobility support for the mobile node\n      on\
    \ that access link.\n   o  The trigger for initiating Proxy Mobile IPv6 signaling\
    \ can also be\n      delivered to the mobile access gateway as part of a context\n\
    \      transfer from the previous mobile access gateway, or delivered\n      from\
    \ the other network elements in the radio network, the details\n      of which\
    \ are outside the scope of this document.\n   o  The DHCPOFFER message [RFC2131]\
    \ sent to the mobile node MUST\n      include the Subnet Mask option [RFC2132]\
    \ and the Router option\n      [RFC2132].  The values in the Subnet Mask option\
    \ and Router option\n      MUST be set to the mobile node's IPv4 home subnet mask\
    \ and its\n      default router address, respectively.\n   o  The DHCPOFFER message\
    \ [RFC2131] sent to the mobile node MUST\n      include the Interface MTU option\
    \ [RFC2132].  The DHCP servers in\n      the Proxy Mobile IPv6 domain MUST be\
    \ configured to include the\n      Interface MTU option.  The MTU value SHOULD\
    \ reflect the tunnel MTU\n      for the bidirectional tunnel between the mobile\
    \ access gateway and\n      the local mobility anchor.\n   o  The DHCP lease length\
    \ allocated to the mobile node's IPv4 home\n      address may be different from\
    \ the binding lifetime at the local\n      mobility anchor for that mobile node's\
    \ session.  It is not\n      possible to keep these lifetimes synchronized, and\
    \ so its not\n      required that the configured lifetimes should be kept same\
    \ in both\n      DHCP and Proxy Mobile IPv6.\n   o  When the mobile node performs\
    \ a handoff from one mobile access\n      gateway to another, the mobile access\
    \ gateway on the new link will\n      initiate the Proxy Mobile IPv6 signaling\
    \ with the local mobility\n      anchor.  On completing the Proxy Mobile IPv6\
    \ signaling, the mobile\n      access gateway has the proper IPv4 address state\
    \ that the local\n      mobility anchor has allocated for the mobile node and\
    \ that can be\n      used for supporting DHCP based address configuration on that\
    \ link.\n   o  Any time the mobile node detects a link change event due to\n \
    \     handoff, or due to other reasons such as re-establishment of the\n     \
    \ link-layer, the following are the mobile node's considerations\n      with respect\
    \ to the DHCP protocol.\n      *  If the mobile node is DNAv4-capable (Detecting\
    \ Network\n         Attachment version 4) [RFC4436] and if it performs DNAv4\n\
    \         procedures after receiving a link change event, it would always\n  \
    \       detect the same default router on any of the access links in\n       \
    \  that Proxy Mobile IPv6 domain, as the mobile access gateway\n         configures\
    \ a fixed link-layer address on all the access links,\n         as per the base\
    \ Proxy Mobile IPv6 specification [RFC5213].  The\n         mobile node will not\
    \ perform any DHCP operation specifically\n         due to this event.\n     \
    \ *  If the mobile node is not DNAv4-capable [RFC4436], after\n         receiving\
    \ the link change event it will enter INIT-REBOOT state\n         [RFC2131] and\
    \ will send a DHCPREQUEST message as specified in\n         Section 3.7 of [RFC2131].\
    \  The mobile node will obtain the same\n         address configuration as before,\
    \ as the link change does not\n         result in any change at the network layer.\n\
    \   o  The mobile node may release its IPv4 home address at any time by\n    \
    \  sending the DHCPRELEASE message [RFC2131].  When the mobile access\n      gateway\
    \ detects the DHCPRELEASE message sent by the mobile node,\n      it should consider\
    \ this as a trigger for de-registering the mobile\n      node's IPv4 home address.\
    \  It will apply the considerations\n      specified in Section 3.2.3.3 for performing\
    \ the de-registration\n      procedure.  However, this operation MUST NOT release\
    \ any IPv6 home\n      network prefix(es) assigned to the mobile node.\n"
- title: 4.  IPv4 Transport Support
  contents:
  - "4.  IPv4 Transport Support\n   The Proxy Mobile IPv6 specification [RFC5213]\
    \ requires the signaling\n   messages exchanged between the local mobility anchor\
    \ and the mobile\n   access gateway to be over an IPv6 transport.  However, in\
    \ some cases,\n   the local mobility anchor and the mobile access gateway are\
    \ separated\n   by an IPv4 network.\n   The normal Proxy Mobile IPv6 specification\
    \ [RFC5213] can be run over\n   an IPv4 transport without any modifications by\
    \ using a transition\n   technology that allows IPv6 hosts to communicate over\
    \ IPv4 networks.\n   For example, the mobile access gateway and the local mobility\
    \ anchor\n   could have a simple configured IPv6-over-IPv4 tunnel.  Instead of\n\
    \   configured tunnels, various mechanisms for automatic tunneling could\n   be\
    \ used, too.  To these tunnels, Proxy Mobile IPv6 would look just\n   like any\
    \ other application traffic running over IPv6.\n   However, treating Proxy Mobile\
    \ IPv6 just like any other IPv6 traffic\n   would mean an extra layer of encapsulation\
    \ for the mobile node's\n   tunneled data traffic, adding 40 octets of overhead\
    \ for each packet.\n   The extensions defined in this section allow the mobile\
    \ access\n   gateway and the local mobility anchor to communicate over an IPv4\n\
    \   network without this overhead.\n            IPv4-Proxy-CoA               \
    \       IPv4-LMAA\n                   |         + - - - - - - +        |\n   +--+\
    \          +---+      /               \\     +---+          +--+\n   |MN|----------|MAG|=====\
    \   IPv4  Network  =====|LMA|----------|CN|\n   +--+          +---+      \\  \
    \             /     +---+          +--+\n                             + - - -\
    \ - - - +\n                     Figure 10: IPv4 Transport Network\n   When the\
    \ local mobility anchor and the mobile access gateway are\n   configured and reachable\
    \ using only IPv4 addresses, the mobile access\n   gateway serving a mobile node\
    \ can potentially send the signaling\n   messages over IPv4 transport and register\
    \ its IPv4 address as the\n   care-of address in the mobile node's Binding Cache\
    \ entry.  An IPv4\n   tunnel (with any of the supported encapsulation modes) can\
    \ be used\n   for tunneling the mobile node's data traffic.  The following are\
    \ the\n   key aspects of this feature.\n   o  The local mobility anchor and the\
    \ mobile access gateway are both\n      configured and reachable using an IPv4\
    \ address of the same scope.\n   o  The IPv4 addresses used can be private IPv4\
    \ addresses, but it is\n      assumed that there is no NAT between the local mobility\
    \ anchor and\n      the mobile access gateway.  However, it is possible to use\
    \ UDP\n      encapsulation if other types of middleboxes are present.\n   o  The\
    \ Mobility Header [RFC3775] is carried inside an IPv4 packet\n      with UDP header\
    \ (IPv4-UDP-MH), using a UDP port number for Proxy\n      Mobile IPv6 signaling\
    \ over IPv4.\n   o  The mobile node can be an IPv6, IPv4, or a dual IPv4/IPv6\
    \ node and\n      the IPv4 transport support specified in this section is agnostic\n\
    \      to the type of address mobility enabled for that mobile node.\n   o  The\
    \ mobile node's data traffic will be tunneled between the local\n      mobility\
    \ anchor and the mobile access gateway.  There are several\n      encapsulation\
    \ modes available:\n      *  IPv4 (IPv4 or IPv6 payload packet carried in an IPv4\
    \ packet).\n         If payload protection using IPsec is enabled for the tunneled\n\
    \         traffic, the Encapsulating Security Payload (ESP) header\n         follows\
    \ the outer tunnel header.\n      *  IPv4-UDP (payload packet carried in an IPv4\
    \ packet with UDP\n         header, using a UDP port number for Proxy Mobile IPv6\
    \ data;\n         this is different port than is used for signaling).  If payload\n\
    \         protection using IPsec is enabled, the ESP header follows the\n    \
    \     outer IPv4 header, as explained in Section 4.3.\n      *  IPv4-UDP-TLV (payload\
    \ packet carried in an IPv4 packet with UDP\n         and TLV header) and IPv4-GRE\
    \ (Payload packet carried in an IPv4\n         packet with GRE header).  Refer\
    \ to [GREKEY].  If payload\n         protection using IPsec is enabled, the ESP\
    \ header follows the\n         outer IPv4 header, as explained in Section 4.3.\n"
- title: 4.1.  Local Mobility Anchor Considerations
  contents:
  - '4.1.  Local Mobility Anchor Considerations

    '
- title: 4.1.1.  Extensions to Binding Cache Entry
  contents:
  - "4.1.1.  Extensions to Binding Cache Entry\n   To support this feature, the conceptual\
    \ Binding Cache entry data\n   structure maintained by the local mobility anchor\
    \ [RFC5213] MUST be\n   extended with the following additional parameters.  It\
    \ is to be noted\n   that all of these parameters are specified in [RFC5555] and\
    \ also\n   required here in the present usage context, and are presented here\n\
    \   only for completeness.\n   o  The IPv4 Proxy Care-of Address configured on\
    \ the mobile access\n      gateway that sent the Proxy Binding Update message.\
    \  The address\n      MUST be the same as the source address of the received IPv4\
    \ packet\n      that contains the Proxy Binding Update message.  However, if the\n\
    \      received Proxy Binding Update message is not sent as an IPv4\n      packet,\
    \ i.e., when using IPv6 transport, this field in the Binding\n      Cache entry\
    \ MUST be set to the ALL_ZERO value.\n"
- title: 4.1.2.  Extensions to Mobile Node's Policy Profile
  contents:
  - "4.1.2.  Extensions to Mobile Node's Policy Profile\n   To support the IPv4 Transport\
    \ Support feature, the mobile node's\n   policy profile, specified in Section\
    \ 6.2 of [RFC5213], MUST be\n   extended with the following additional fields.\
    \  These are mandatory\n   fields of the policy profile required for supporting\
    \ this feature.\n   o  The IPv4 address of the local mobility anchor (IPv4-LMAA).\n"
- title: 4.1.3.  Signaling Considerations
  contents:
  - "4.1.3.  Signaling Considerations\n   This section provides the rules for processing\
    \ the Proxy Mobile IPv6\n   signaling messages received over IPv4 transport.\n"
- title: 4.1.3.1.  Processing Proxy Binding Updates
  contents:
  - "4.1.3.1.  Processing Proxy Binding Updates\n   o  If the Proxy Binding Update\
    \ message is protected with IPsec ESP,\n      IPsec processing happens before\
    \ the packet is passed to Proxy\n      Mobile IPv6.\n   o  All the considerations\
    \ from Section 5.3.1 of [RFC5213] except Step\n      1 (about IPsec) MUST be applied\
    \ on the encapsulated Proxy Binding\n      Update message.  Note that the Checksum\
    \ field in Mobility Header\n      MUST be ignored.\n   o  Upon accepting the request,\
    \ the local mobility anchor MUST set up\n      an IPv4 bidirectional tunnel to\
    \ the mobile access gateway.  The\n      tunnel endpoint addresses are IPv4-LMAA\
    \ and the IPv4-Proxy-CoA.\n      The encapsulation mode MUST be determined by\
    \ applying the\n      following considerations:\n      *  If the (F) flag in the\
    \ received Proxy Binding Update message is\n         set to the value of (1),\
    \ but if the configuration flag,\n         AcceptForcedIPv4UDPEncapsulationRequest,\
    \ is set to a value of\n         (0), then the local mobility anchor MUST reject\
    \ the request\n         with the Status field value set to 129 (Administratively\n\
    \         prohibited).\n      *  If the (T) flag is set to (1), or GRE Key option\
    \ is included,\n         see [GREKEY].\n      *  If the (F) flag in the received\
    \ Proxy Binding Update message is\n         set to the value of (1), then the\
    \ encapsulation mode MUST be\n         set to IPv4-UDP.  Otherwise, the encapsulation\
    \ mode MUST be set\n         to IPv4.\n   o  The local mobility anchor MUST send\
    \ the Proxy Binding\n      Acknowledgement message with the Status field value\
    \ set to (0)\n      (Proxy Binding Update accepted).  The message MUST be constructed\n\
    \      as specified in Section 4.1.3.2.\n"
- title: 4.1.3.2.  Constructing the Proxy Binding Acknowledgement Message
  contents:
  - "4.1.3.2.  Constructing the Proxy Binding Acknowledgement Message\n   The local\
    \ mobility anchor when sending the Proxy Binding\n   Acknowledgement message to\
    \ the mobile access gateway MUST construct\n   the message as specified in Section\
    \ 5.3.6 of [RFC5213].  However, if\n   the Proxy Binding Update message was received\
    \ over IPv4, the\n   following additional considerations MUST be applied.\n  \
    \ o  The IPv6 Header is removed, and the Mobility Header containing the\n    \
    \  Proxy Binding Acknowledgement is encapsulated in UDP (with source\n      port\
    \ set to 5436 and destination port set to the source port of\n      the received\
    \ Proxy Binding Update message).  The Mobility Header\n      Checksum field MUST\
    \ be set to zero (and the UDP checksum MUST be\n      used instead).\n   o  The\
    \ source address in the IPv4 header of the message MUST be set\n      to the destination\
    \ IPv4 address of the received request.\n   o  If IPsec ESP is used to protect\
    \ signaling, the packet is processed\n      using transport mode ESP as described\
    \ in Section 4.3.\n   o  Figure 11 shows the format of the Proxy Binding Acknowledgement\n\
    \      message sent over IPv4 and protected using ESP.\n     IPv4 header (src=IPv4-LMAA,\
    \ dst=pbu_src_address)\n       ESP header (in transport mode)\n         UDP header\
    \ (sport=5436, dport=5436)\n           Mobility Header (PBA)\n       Figure 11:\
    \ Proxy Binding Acknowledgement (PBA) Message Sent over\n                    \
    \                 IPv4\n"
- title: 4.1.4.  Routing Considerations
  contents:
  - '4.1.4.  Routing Considerations

    '
- title: 4.1.4.1.  Forwarding Considerations
  contents:
  - "4.1.4.1.  Forwarding Considerations\n   Forwarding Packets to the Mobile Node:\n\
    \   o  On receiving an IPv4 or an IPv6 packet from a correspondent node\n    \
    \  with the destination address matching any of the mobile node's\n      IPv4\
    \ or IPv6 home addresses, the local mobility anchor MUST\n      forward the packet\
    \ through the bidirectional tunnel set up for\n      that mobile node.\n   o \
    \ The format of the tunneled packet is shown below.  The IPv4-UDP-\n      TLV\
    \ and IPv4-GRE encapsulation modes are described in [GREKEY].\n  IPv4 Header (src=IPv4-LMAA,\
    \ dst=IPv4-Proxy-CoA)] /* Tunnel Header */\n    [UDP Header (src port=5437, dst\
    \ port=5437]   /* If UDP encap nego */\n      /* IPv6 or IPv4 Payload Packet */\n\
    \      IPv6 header (src=CN, dst=MN-HOA)\n        OR\n      IPv4 header (src=CN,\
    \ dst=IPv4-MN-HoA)\n      Figure 12: Tunneled IPv4 Packet from LMA to MAG (IPv4\
    \ or IPv4-UDP\n                             Encapsulation Mode)\n   o  Forwarding\
    \ Packets Sent by the Mobile Node:\n      *  All the reverse tunneled packets\
    \ (IPv4 and IPv6) that the local\n         mobility anchor receives from the mobile\
    \ access gateway, after\n         removing the tunnel header (i.e., the outer\
    \ IPv4 header along\n         with the UDP and TLV header, if negotiated) MUST\
    \ be routed to\n         the destination specified in the inner packet header.\
    \  These\n         routed packets will have the source address field set to the\n\
    \         mobile node's home address.\n"
- title: 4.1.4.2.  ECN and Payload Fragmentation Considerations
  contents:
  - "4.1.4.2.  ECN and Payload Fragmentation Considerations\n   The ECN considerations\
    \ specified in Section 5.6.3 of [RFC5213] apply\n   for the IPv4 transport tunnels\
    \ as well.  The mobility agents at the\n   tunnel entry and exit points MUST handle\
    \ ECN information as specified\n   in that document.\n   The mobility agents at\
    \ the tunnel entry and exit points MUST apply\n   the IP packet fragmentation\
    \ considerations as specified in [RFC4213].\n   Additionally, they MUST also apply\
    \ the considerations related to\n   tunnel error processing and reporting as specified\
    \ in the same\n   specification.\n"
- title: 4.1.4.3.  Bidirectional Tunnel Management
  contents:
  - "4.1.4.3.  Bidirectional Tunnel Management\n   The Tunnel Management considerations\
    \ specified in Section 5.6.1 of\n   [RFC5213] apply for the IPv4 transport tunnels\
    \ as well, with just one\n   difference that the encapsulation mode is different.\n"
- title: 4.2.  Mobile Access Gateway Considerations
  contents:
  - '4.2.  Mobile Access Gateway Considerations

    '
- title: 4.2.1.  Extensions to Binding Update List Entry
  contents:
  - "4.2.1.  Extensions to Binding Update List Entry\n   To support the IPv4 Transport\
    \ Support feature, the conceptual Binding\n   Update List entry data structure\
    \ maintained by the mobile access\n   gateway [RFC5213] MUST be extended with\
    \ the following additional\n   parameters.\n   o  The IPv4 address of the local\
    \ mobility anchor.  This address can\n      be obtained from the mobile node's\
    \ policy profile.\n"
- title: 4.2.2.  Signaling Considerations
  contents:
  - "4.2.2.  Signaling Considerations\n   The mobile access gateway, when sending\
    \ a Proxy Binding Update\n   message to the local mobility anchor, MUST construct\
    \ the message as\n   specified in Section 6.9.1.5 of [RFC5213].  However, if the\
    \ mobile\n   access gateway is in an IPv4-only access network, the following\n\
    \   additional considerations MUST be applied.\n   o  The Proxy Binding Update\
    \ message MUST be sent over IPv4 as\n      described in Section 4.2.2.1.\n   o\
    \  Just as specified in [RFC5213], when sending a Proxy Binding\n      Update\
    \ message for extending the lifetime of a currently existing\n      mobility session\
    \ or to de-register the mobility session, the Proxy\n      Binding Update message\
    \ MUST be constructed just as the initial\n      request.\n   Receiving Proxy\
    \ Binding Acknowledgement:\n   o  If the received Proxy Binding Acknowledgement\
    \ message is protected\n      with IPsec ESP, IPsec processing happens before\
    \ the packet is\n      passed to Proxy Mobile IPv6.  Considerations from Section\
    \ 4 of\n      [RFC5213] MUST be applied to authenticate and authorize the\n  \
    \    message.\n   o  All the considerations from Section 6.9.1.2 of [RFC5213]\
    \ MUST be\n      applied on the encapsulated Proxy Binding Acknowledgement message.\n\
    \      Note that the Checksum field in Mobility Header MUST be ignored.\n   o\
    \  If the Status field indicates Success, the mobile access gateway\n      MUST\
    \ set up a bidirectional tunnel to the local mobility anchor.\n   o  Upon accepting\
    \ the request, the mobile access gateway MUST set up\n      an IPv4 bidirectional\
    \ tunnel to the local mobility anchor.  The\n      tunnel endpoint addresses are\
    \ the IPv4-Proxy-CoA and the IPv4-\n      LMAA.  The encapsulation mode MUST be\
    \ determined from the below\n      considerations:\n      *  If the (T) flag is\
    \ set to (1), or the GRE Key option is\n         included, see [GREKEY].\n   \
    \   *  If there is a NAT Detection option [RFC5555] in the received\n        \
    \ Proxy Binding Acknowledgement message, and the (F) flag is set\n         to\
    \ value of (1), the encapsulation mode for the tunnel MUST be\n         set to\
    \ IPv4-UDP.  Otherwise, the encapsulation mode MUST be set\n         to IPv4.\n"
- title: 4.2.2.1.  Constructing the Proxy Binding Update Message
  contents:
  - "4.2.2.1.  Constructing the Proxy Binding Update Message\n   o  The IPv6 Header\
    \ is removed, and the Mobility Header containing the\n      Proxy Binding Update\
    \ message is encapsulated in UDP (with the\n      destination port set to 5436).\
    \  The Mobility Header Checksum field\n      MUST be set to zero (and UDP checksum\
    \ MUST be used instead).\n   o  The source address in the IPv4 header MUST be\
    \ set to IPv4-Proxy-\n      CoA of the mobile access gateway and the destination\
    \ address MUST\n      be set to the local mobility anchor's IPv4-LMAA.\n   o \
    \ If the configuration variable ForceIPv4UDPEncapsulationSupport is\n      set\
    \ to value of (1), then the (F) flag in the Proxy Binding Update\n      message\
    \ MUST be set to value of (1).\n   o  If IPsec ESP is used to protect signaling,\
    \ the packet is processed\n      using transport mode ESP as described in Section\
    \ 4.3.\n   o  Figure 13 shows the format of the Proxy Binding Update message\n\
    \      sent over IPv4 and protected using ESP.\n     IPv4 header (src=IPv4-Proxy-CoA,\
    \ dst=IPv4-LMAA)\n       ESP header (in transport mode)\n         UDP header (sport=5436,\
    \ dport=5436)\n           Mobility Header (PBU)\n         Figure 13: Proxy Binding\
    \ Update (PBU) Message Sent over IPv4\n"
- title: 4.2.2.2.  Forwarding Considerations
  contents:
  - "4.2.2.2.  Forwarding Considerations\n   Forwarding Packets Sent by the Mobile\
    \ Node:\n   o  On receiving an IPv4 or an IPv6 packet from the mobile node to\
    \ any\n      destination, the mobile access gateway MUST tunnel the packet to\n\
    \      the local mobility anchor.  The format of the tunneled packet is\n    \
    \  shown below.  The IPv4-UDP-TLV and IPv4-GRE encapsulation modes\n      are\
    \ described in [GREKEY].  However, considerations from Section\n      6.10.3 of\
    \ [RFC5213] MUST be applied with respect the local routing\n      and on the use\
    \ of EnableMAGLocalRouting flag.\n IPv4 Header (src=IPv4-Proxy-CoA, dst=IPv4-LMAA)]\
    \ /* Tunnel Header */\n    [UDP Header (src port=5437, dst port=5437]   /* If\
    \ UDP encap nego */\n      /* IPv6 or IPv4 Payload Packet */\n      IPv6 header\
    \ (src=MN-HOA, dst=CN)\n        OR\n      IPv4 header (src=IPv4-MN-HOA, dst=CN)\n\
    \      Figure 14: Tunneled IPv4 Packet from MAG to LMA (IPv4 or IPv4-UDP\n   \
    \                          Encapsulation Mode)\n   Forwarding Packets Received\
    \ from the Bidirectional Tunnel:\n   o  On receiving a packet from the bidirectional\
    \ tunnel established\n      with the mobile node's local mobility anchor, the\
    \ mobile access\n      gateway MUST remove the outer header before forwarding\
    \ the packet\n      to the mobile node.\n"
- title: 4.3.  IPsec Considerations
  contents:
  - '4.3.  IPsec Considerations

    '
- title: 4.3.1.  PBU and PBA
  contents:
  - "4.3.1.  PBU and PBA\n   The following section describes how IPsec is used to\
    \ protect the\n   signaling messages and data packets between the local mobility\
    \ anchor\n   and mobile access gateway when using IPv4 transport.\n   The following\
    \ are the Security Policy Database (SPD) example entries\n   to protect PBU and\
    \ PBA on the local mobility anchor and mobile access\n   gateway.\n          \
    \ MAG SPD-S:\n             - IF local_address = IPv4-Proxy-CoA_1 &\n         \
    \         remote_address = IPv4-LMAA_1 & proto = UDP &\n                  remote_port\
    \ = 5436\n               Then use SA ESP transport mode\n           LMA SPD-S:\n\
    \             - IF local_address = IPv4-LMAA_1 &\n                  remote_address\
    \ = IPv4-Proxy-CoA_1 & proto = UDP &\n                  local_port = 5436\n  \
    \             Then use SA ESP transport mode\n"
- title: 4.3.2.  Payload Packet
  contents:
  - "4.3.2.  Payload Packet\n   The following are the SPD example entries to protect\
    \ payload packets\n   on the local mobility anchor and mobile access gateway.\
    \  Note that\n   the example SPDs protect all payload packets sent to and from\
    \ mobile\n   nodes.  If an operator needs to apply a different security mechanism\n\
    \   per mobile node, they need to create a SPD and a SA entry per mobile\n   node.\n\
    \           MAG SPD-S:\n             - IF interface = tunnel to LMAA_1 &\n   \
    \               local_address != Proxy-CoA_1 &\n                  remote_address\
    \ != LMAA_1 & proto=any\n               Then use SA ESP tunnel mode\n        \
    \   LMA SPD-S:\n             - IF interface = tunnel to Proxy-CoA_1 &\n      \
    \            local_address != LMAA_1 &\n                  remote_address != Proxy-CoA_1\
    \ & proto=any\n               Then use SA ESP tunnel mode\n   When payload packets\
    \ are protected by IPsec, payload packets matching\n   the SPDs are passed to\
    \ the IPsec module and encapsulated using the\n   tunnel mode ESP.  The tunnel\
    \ mode ESP encapsulated payload packets\n   are then directly sent to the peer\
    \ mobile access gateway or local\n   mobility anchor.  If IPsec is not applied\
    \ to payload packets, then\n   they are encapsulated as shown in Figures 12 and\
    \ 14.\n"
- title: 5.  Protocol Configuration Variables
  contents:
  - '5.  Protocol Configuration Variables

    '
- title: 5.1.  Local Mobility Anchor - Configuration Variables
  contents:
  - "5.1.  Local Mobility Anchor - Configuration Variables\n   The local mobility\
    \ anchor MUST allow the following variables to be\n   configured by the system\
    \ management.  The configured values for these\n   protocol variables MUST survive\
    \ server reboots and service restarts.\n   AcceptForcedIPv4UDPEncapsulationRequest\n\
    \      This flag indicates whether or not the local mobility anchor\n      should\
    \ accept IPv4 UDP encapsulation request for the mobile node's\n      data traffic.\
    \  The default value for this flag is set to (0),\n      indicating that plain\
    \ IPv4 encapsulation (without UDP) is used for\n      data traffic.\n"
- title: 5.2.  Mobile Access Gateway - Configuration Variables
  contents:
  - "5.2.  Mobile Access Gateway - Configuration Variables\n   The mobile access gateway\
    \ MUST allow the following variables to be\n   configured by the system management.\
    \  The configured values for these\n   protocol variables MUST survive server\
    \ reboots and service restarts.\n   ForceIPv4UDPEncapsulationSupport\n      This\
    \ flag indicates whether or not the mobile access gateway\n      should request\
    \ the mobile node's local mobility anchor to use\n      IPv4-UDP encapsulation\
    \ mode for the mobile node's data traffic.\n      The default value for this flag\
    \ is set to (0), indicating that\n      plain IPv4 encapsulation (without UDP)\
    \ is used for data traffic.\n"
- title: 6.  IANA Considerations
  contents:
  - "6.  IANA Considerations\n   This document defines four new Mobility Header options:\
    \ the IPv4 Home\n   Address Request option, IPv4 Home Address Reply option, IPv4\
    \ Default\n   Router Address option, and IPv4 DHCP Support Mode option.  These\n\
    \   options are described in Sections 3.3.1, 3.3.2, 3.3.3, and 3.3.4,\n   respectively.\
    \  The Type value for these options has been assigned\n   from the same number\
    \ space as allocated for the other mobility\n   options, as defined in [RFC3775].\n\
    \   The IPv4 Home Address Reply option, described in Section 3.3.2 of\n   this\
    \ document, introduces a new number space, IPv4 Home Address Reply\n   status\
    \ codes.  This document currently reserves the following values.\n   Approval\
    \ of any new status code values are to be made through IANA\n   Expert Review.\n\
    \   o  0 Success\n   o  128 Failure, Reason Unspecified\n   o  129 Administratively\
    \ prohibited\n   o  130 Incorrect IPv4 home address\n   o  131 Invalid IPv4 address\n\
    \   o  132 Dynamic IPv4 home address assignment not available\n   The IPv4 DHCP\
    \ Support Mode option, described in Section 3.3.4 of this\n   document, introduces\
    \ a new number space, IPv4 DHCP Support Mode\n   Flags.  This document reserves\
    \ the value 0x1 for the (S) flag.\n   Approval of flag values are to be made through\
    \ IANA Expert Review.\n   At this point in time, there are no thoughts on what\
    \ the new flag\n   allocations can be, and hence this document leaves this to\
    \ the\n   discretion of the Expert Review.\n   This document also defines new\
    \ Status values, used in Proxy Binding\n   Acknowledgement message, as described\
    \ in Section 3.3.5.  These values\n   have been assigned from the same number\
    \ space as allocated for other\n   status codes [RFC3775].  Each of these allocated\
    \ values is greater\n   than 128.\n      NOT_AUTHORIZED_FOR_IPV4_MOBILITY_SERVICE:\
    \ 170\n         Mobile node not authorized for IPv4 mobility service.\n      NOT_AUTHORIZED_FOR_IPV4_HOME_ADDRESS:\
    \ 171\n         Mobile node not authorized for the requesting IPv4 home\n    \
    \     address.\n      NOT_AUTHORIZED_FOR_IPV6_MOBILITY_SERVICE: 172\n        \
    \ Mobile node not authorized for IPv6 mobility service.\n      MULTIPLE_IPV4_HOME_ADDRESS_ASSIGNMENT_NOT_SUPPORTED:\
    \ 173\n         Multiple IPv4 home address assignment not supported.\n   IANA\
    \ has assigned two UDP port numbers, 5436 and 5437, for \"pmip6-\n   cntl\" and\
    \ \"pmip6-data\", respectively.\n"
- title: 7.  Security Considerations
  contents:
  - "7.  Security Considerations\n   All the security considerations from the base\
    \ Proxy Mobile IPv6\n   [RFC5213], Mobile IPv6 [RFC3775], and Dual-Stack Mobile\
    \ IPv6\n   [RFC5555] specifications apply when using the extensions defined in\n\
    \   this document.  Additionally, the following security considerations\n   need\
    \ to be applied.\n   This document defines new mobility options for supporting\
    \ the IPv4\n   Home Address assignment and IPv4 Transport Support features.  These\n\
    \   options are to be carried in Proxy Binding Update and Proxy Binding\n   Acknowledgement\
    \ messages.  The required security mechanisms specified\n   in the base Proxy\
    \ Mobile IPv6 protocol for protecting these signaling\n   messages are sufficient\
    \ when carrying these mobility options.\n   This specification describes the use\
    \ of IPv4 transport for exchanging\n   signaling messages between the local mobility\
    \ anchor and the mobile\n   access gateway.  These can be protected using IPsec\
    \ as described in\n   Section 4.3.\n"
- title: 8.  Contributors
  contents:
  - "8.  Contributors\n   This document reflects discussions and contributions from\
    \ several\n   people (in alphabetical order):\n   Kuntal Chowdhury\n      kchowdhury@starentnetworks.com\n\
    \   Vijay Devarapalli\n      vijay.devarapalli@azairenet.com\n   Pasi Eronen\n\
    \      Pasi.Eronen@nokia.com\n   Sangjin Jeong\n      sjjeong@etri.re.kr\n   Basavaraj\
    \ Patil\n      basavaraj.patil@nokia.com\n   Myungki Shin\n      myungki.shin@gmail.com\n"
- title: 9.  Acknowledgements
  contents:
  - "9.  Acknowledgements\n   The IPv4 support for Proxy Mobile IPv6 was initially\
    \ covered in\n   \"Proxy Mobile IPv6\" (March 2007).  We would like to thank all\
    \ the\n   authors of the document and acknowledge that initial work.\n   Thanks\
    \ to Alper Yegin, Behcet Sarikaya, Bernard Aboba, Charles\n   Perkins, Damic Damjan,\
    \ Jari Arkko, Joel Hortelius, Jonne Soinnen,\n   Julien Laganier, Mohana Jeyatharan,\
    \ Niklas Nuemann, Pasi Eronen,\n   Premec Domagoj, Ralph Droms, Sammy Touati,\
    \ Vidya Narayanan, Yingzhe\n   Wu, and Zu Qiang for their helpful review of this\
    \ document.\n   Also, we would like to thank Spencer Dawkins, Tim Polk, Menachem\n\
    \   Dodge, Adrian Farrel, and Pekka Savola for their reviews of this\n   document\
    \ as part of the IESG review process.  Finally, special thanks\n   to Jouni Korohonen\
    \ for his support in addressing the IPsec issues.\n"
- title: 10.  References
  contents:
  - '10.  References

    '
- title: 10.1.  Normative References
  contents:
  - "10.1.  Normative References\n   [RFC2119]  Bradner, S., \"Key words for use in\
    \ RFCs to Indicate\n              Requirement Levels\", BCP 14, RFC 2119, March\
    \ 1997.\n   [RFC2131]  Droms, R., \"Dynamic Host Configuration Protocol\",\n \
    \             RFC 2131, March 1997.\n   [RFC2132]  Alexander, S. and R. Droms,\
    \ \"DHCP Options and BOOTP Vendor\n              Extensions\", RFC 2132, March\
    \ 1997.\n   [RFC2473]  Conta, A. and S. Deering, \"Generic Packet Tunneling in\n\
    \              IPv6 Specification\", RFC 2473, December 1998.\n   [RFC3046]  Patrick,\
    \ M., \"DHCP Relay Agent Information Option\",\n              RFC 3046, January\
    \ 2001.\n   [RFC3775]  Johnson, D., Perkins, C., and J. Arkko, \"Mobility Support\n\
    \              in IPv6\", RFC 3775, June 2004.\n   [RFC4213]  Nordmark, E. and\
    \ R. Gilligan, \"Basic Transition Mechanisms\n              for IPv6 Hosts and\
    \ Routers\", RFC 4213, October 2005.\n   [RFC4361]  Lemon, T. and B. Sommerfeld,\
    \ \"Node-specific Client\n              Identifiers for Dynamic Host Configuration\
    \ Protocol\n              Version Four (DHCPv4)\", RFC 4361, February 2006.\n\
    \   [RFC5107]  Johnson, R., Kumarasamy, J., Kinnear, K., and M. Stapp,\n     \
    \         \"DHCP Server Identifier Override Suboption\", RFC 5107,\n         \
    \     February 2008.\n   [RFC5213]  Gundavelli, S., Leung, K., Devarapalli, V.,\
    \ Chowdhury, K.,\n              and B. Patil, \"Proxy Mobile IPv6\", RFC 5213,\
    \ August 2008.\n   [RFC5555]  Soliman, H., \"Mobile IPv6 Support for Dual Stack\
    \ Hosts and\n              Routers\", RFC 5555, June 2009.\n"
- title: 10.2.  Informative References
  contents:
  - "10.2.  Informative References\n   [RFC0925]  Postel, J., \"Multi-LAN address\
    \ resolution\", RFC 925,\n              October 1984.\n   [RFC1332]  McGregor,\
    \ G., \"The PPP Internet Protocol Control Protocol\n              (IPCP)\", RFC\
    \ 1332, May 1992.\n   [RFC1918]  Rekhter, Y., Moskowitz, R., Karrenberg, D., Groot,\
    \ G., and\n              E. Lear, \"Address Allocation for Private Internets\"\
    ,\n              BCP 5, RFC 1918, February 1996.\n   [RFC3022]  Srisuresh, P.\
    \ and K. Egevang, \"Traditional IP Network\n              Address Translator (Traditional\
    \ NAT)\", RFC 3022,\n              January 2001.\n   [RFC4306]  Kaufman, C., \"\
    Internet Key Exchange (IKEv2) Protocol\",\n              RFC 4306, December 2005.\n\
    \   [RFC4436]  Aboba, B., Carlson, J., and S. Cheshire, \"Detecting\n        \
    \      Network Attachment in IPv4 (DNAv4)\", RFC 4436, March 2006.\n   [RFC4977]\
    \  Tsirtsis, G. and H. Soliman, \"Problem Statement: Dual\n              Stack\
    \ Mobility\", RFC 4977, August 2007.\n   [GREKEY]   Muhanna, A., Khalil, M., Gundavelli,\
    \ S., and K. Leung,\n              \"GRE Key Option for Proxy Mobile IPv6\", Work\
    \ in Progress,\n              May 2009.\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Ryuji Wakikawa\n   TOYOTA InfoTechnology Center, U.S.A.,\
    \ Inc.\n   465 Bernardo Avenue\n   Mountain View, CA  94043\n   USA\n   EMail:\
    \ ryuji@us.toyota-itc.com\n   Sri Gundavelli\n   Cisco\n   170 West Tasman Drive\n\
    \   San Jose, CA  95134\n   USA\n   EMail: sgundave@cisco.com\n"
