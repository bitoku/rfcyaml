- title: __initial_text__
  contents:
  - ''
- title: Independent Submission                                         Y. Nachum
  contents:
  - "Independent Submission                                         Y. Nachum\n  \
    \          The Scalable Address Resolution Protocol (SARP)\n                 \
    \        for Large Data Centers\n"
- title: Abstract
  contents:
  - "Abstract\n   This document introduces the Scalable Address Resolution Protocol\n\
    \   (SARP), an architecture that uses proxy gateways to scale large data\n   center\
    \ networks.  SARP is based on fast proxies that significantly\n   reduce switches'\
    \ Filtering Database (FDB) table sizes and reduce\n   impact of ARP and Neighbor\
    \ Discovery (ND) on network elements in an\n   environment where hosts within\
    \ one subnet (or VLAN) can spread over\n   various locations.  SARP is targeted\
    \ for massive data centers with a\n   significant number of Virtual Machines (VMs)\
    \ that can move across\n   various physical locations.\n"
- title: Independent Submissions Editor Note
  contents:
  - "Independent Submissions Editor Note\n   This is an Experimental document; that\
    \ experiment will end two years\n   after the RFC is published.  At that point,\
    \ the RFC authors will\n   attempt to determine how widely SARP has been implemented\
    \ and used.\n"
- title: IESG Note
  contents:
  - "IESG Note\n   The IESG notes that the problems described in RFC 6820 can already\
    \ be\n   addressed through the simple combination of existing standardized or\n\
    \   other published techniques including Layer 2 VPN (RFC 4664), proxy\n   ARP\
    \ (RFC 925), proxy Neighbor Discovery (RFC 4389), IGMP and MLD\n   snooping (RFC\
    \ 4541), and ARP mediation for IP interworking of Layer 2\n   VPNs (RFC 6575).\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This document is not an Internet Standards Track specification;\
    \ it is\n   published for examination, experimental implementation, and\n   evaluation.\n\
    \   This document defines an Experimental Protocol for the Internet\n   community.\
    \  This is a contribution to the RFC Series, independently\n   of any other RFC\
    \ stream.  The RFC Editor has chosen to publish this\n   document at its discretion\
    \ and makes no statement about its value for\n   implementation or deployment.\
    \  Documents approved for publication by\n   the RFC Editor are not a candidate\
    \ for any level of Internet\n   Standard; see Section 2 of RFC 5741.\n   Information\
    \ about the current status of this document, any errata,\n   and how to provide\
    \ feedback on it may be obtained at\n   http://www.rfc-editor.org/info/rfc7586.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2015 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (http://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1. Introduction ....................................................3\n\
    \      1.1. SARP Motivation ............................................4\n  \
    \    1.2. SARP Overview ..............................................7\n    \
    \  1.3. SARP Deployment Options ....................................8\n      1.4.\
    \ Comparison with Existing Solutions .........................9\n   2. Terms and\
    \ Abbreviations Used in This Document ..................10\n   3. SARP: Theory\
    \ of Operation ......................................11\n      3.1. Control Plane:\
    \ ARP/ND .....................................11\n           3.1.1. ARP/NS Request\
    \ for a Local VM ......................11\n           3.1.2. ARP/NS Request for\
    \ a Remote VM .....................12\n           3.1.3. Gratuitous ARP and Unsolicited\
    \ Neighbor\n                  Advertisement (UNA) ................................13\n\
    \      3.2. Data Plane: Packet Transmission ...........................13\n  \
    \         3.2.1. Local Packet Transmission ..........................13\n    \
    \       3.2.2. Packet Transmission between Sites ..................13\n      3.3.\
    \ VM Migration ..............................................14\n           3.3.1.\
    \ VM Local Migration .................................14\n           3.3.2. VM\
    \ Migration from One Site to Another ..............14\n                  3.3.2.1.\
    \ Impact on IP-to-MAC Mapping Cache\n                           Table of Migrated\
    \ VMs .....................16\n      3.4. Multicast and Broadcast ...................................17\n\
    \      3.5. Non-IP Packet .............................................17\n  \
    \    3.6. High Availability and Load Balancing ......................17\n    \
    \  3.7. SARP Interaction with Overlay Networks ....................18\n   4. Security\
    \ Considerations ........................................18\n   5. References\
    \ .....................................................19\n      5.1. Normative\
    \ References ......................................19\n      5.2. Informative\
    \ References ....................................20\n   Acknowledgments ...................................................21\n\
    \   Authors' Addresses ................................................21\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   This document describes a proxy gateway technique, called\
    \ the\n   Scalable Address Resolution Protocol (SARP), which reduces switches'\n\
    \   Filtering Database (FDB) size and ARP/Neighbor Discovery impact on\n   network\
    \ elements in an environment where hosts within one subnet (or\n   VLAN) can spread\
    \ over various access domains in data centers.\n   The main idea of SARP is to\
    \ represent all VMs (or hosts) under each\n   access domain by the MAC address\
    \ of their corresponding access node\n   (or aggregation node).  For example (Figure\
    \ 1), when host A in the\n   west site needs to communicate with host B, which\
    \ is on the same VLAN\n   but connected to a different access domain (east site),\
    \ SARP requires\n   host A to use the MAC address of SARP proxy 2, rather than\
    \ the\n   address of host B.  By doing so, switches in each domain do not need\n\
    \   to maintain a list of MAC addresses for all the VMs (hosts) in\n   different\
    \ access domains; every switch only needs to be familiar with\n   MAC addresses\
    \ that reside in the current domain, and addresses of\n   remote SARP proxy gateways.\
    \  Therefore, the switches' FDB size is\n   limited regardless of the number of\
    \ access domains.\n     +-------+     +-------+    _   __       +-------+    \
    \ +-------+\n     |       |     | SARP  |   / \\_/  \\_     | SARP  |     |  \
    \     |\n     |host A |<===>| proxy |<=>\\_       \\<==>| proxy |<===>|host B\
    \ |\n     |       |     |   1   |   /       _/    |   2   |     |       |\n  \
    \   +-------+     +-------+   \\__   _/      +-------+     +-------+\n       \
    \                           \\_/\n     <------West Site------>               \
    \  <------East Site------>\n                     Figure 1: A Brief Overview of\
    \ SARP\n"
- title: 1.1.  SARP Motivation
  contents:
  - "1.1.  SARP Motivation\n   [RFC6820] discusses the impacts and scaling issues\
    \ that arise in data\n   center networks when subnets span across multiple Layer\
    \ 2 / Layer 3\n   (L2/L3) boundary routers.\n   Unfortunately, when the combined\
    \ number of VMs (or hosts) in all\n   those subnets is large, it can lead to an\
    \ explosion of the size of\n   the switches' MAC address table and a heavy impact\
    \ on network\n   elements.\n   There are four major issues associated with subnets\
    \ spanning across\n   multiple L2/L3 boundary router ports:\n   1) Explosion of\
    \ the size of the intermediate switches' MAC address\n      table (FDB).\n   \
    \   When hosts in a VLAN (or subnet) span across multiple access\n      domains\
    \ and each access domain has hosts belonging to different\n      VLANs, each access\
    \ switch has to enable multiple VLANs.  Thus,\n      those access switches are\
    \ exposed to all MAC addresses across all\n      VLANs.\n      For example, for\
    \ an access switch with 40 attached physical\n      servers, where each server\
    \ has 100 VMs, the access switch has\n      4,000 attached MAC addresses.  If\
    \ hosts/VMs can indeed be moved\n      anywhere, the worst case for the Access\
    \ Switch is when all those\n      4,000 VMs belong to different VLANs, i.e., the\
    \ access switch has\n      4000 VLANs enabled.  If each VLAN has 200 hosts, this\
    \ access\n      switch's MAC address table potentially has 200 * 4,000 = 800,000\n\
    \      entries.\n      It is important to note that the example above is relevant\n\
    \      regardless of whether IPv4 or IPv6 is used.\n      The example illustrates\
    \ a scenario that is worse than what today's\n      L2/L3 gateway has to face.\
    \  In today's environment, where each\n      subnet is limited to a few access\
    \ switches, the number of MAC\n      addresses the gateway has to learn is of\
    \ a significantly smaller\n      scale.\n   2) ARP/ND processing load impact on\
    \ the L2/L3 boundary routers.\n      All VMs periodically send NDs to their corresponding\
    \ gateway nodes\n      to get gateway nodes' MAC addresses.  When the combined\
    \ number of\n      VMs across all the VLANs is large, processing the responses\
    \ to the\n      ND requests from those VMs can easily exhaust the gateway's CPU\n\
    \      utilization.\n      An L2/L3 boundary router could be hit with ARP/ND twice\
    \ when the\n      originating and destination stations are in different subnets\n\
    \      attached to the same router and when those hosts do not\n      communicate\
    \ with external peers very frequently.  The first hit is\n      when the originating\
    \ station in subnet 1 initiates an ARP/ND\n      request to the L2/L3 boundary\
    \ router.  The second hit is when the\n      L2/L3 boundary router initiates an\
    \ ARP/ND request to the target in\n      subnet 2 if the target is not in the\
    \ router's ARP/ND cache.\n   3) In IPv4, every end station in a subnet receives\
    \ ARP broadcast\n      messages from all other end stations in the subnet.  IPv6\
    \ ND has\n      eliminated this issue by using multicast.\n      However, most\
    \ devices support a limited number of multicast\n      addresses, due to the scaling\
    \ of multicast filtering.  Once the\n      number of multicast addresses exceeds\
    \ the multicast filter limit,\n      the multicast addresses have to be processed\
    \ by the devices' CPUs\n      (i.e., the slow path).\n      It is less of an issue\
    \ in data centers without VM mobility, since\n      each port is only dedicated\
    \ to one (or a small number of) VLANs.\n      Thus, the number of multicast addresses\
    \ hitting each port is\n      significantly lower.\n   4) The ARP/ND messages\
    \ are flooded to many physical link segments\n      that can reduce the bandwidth\
    \ utilization for user traffic.\n      ARP/ND flooding is, in most cases, an insignificant\
    \ issue in\n      today's data center networks, as the majority of data center\n\
    \      servers are shifting towards 1G or 10G Ethernet ports.  The\n      bandwidth\
    \ used by ARP/ND, even when flooded to all physical links,\n      becomes negligible\
    \ compared to the link bandwidth.  Furthermore,\n      IGMP and Multicast Listener\
    \ Discovery (MLD) snooping [RFC4541] can\n      further reduce the ND multicast\
    \ traffic to some physical link\n      segments.\n   Statistics gathered by Merit\
    \ Network [ARMDStats] have shown that the\n   major impact of a large number of\
    \ VMs in data centers is on the L2/L3\n   boundary routers, i.e., issue 2 above.\
    \  An L2/L3 boundary router\n   could be hit with ARP/ND twice when 1) the originating\
    \ and\n   destination stations are in different subnets attached to the same\n\
    \   router, and 2) those hosts do not communicate with external peers\n   often\
    \ enough.\n   Overlay approaches, e.g., [RFC7364], can hide addresses of hosts\n\
    \   (VMs) in the core, but they do not prevent the MAC address table\n   explosion\
    \ problem (issue 1) unless the Network Virtualization Edge\n   (NVE) is on a server.\n\
    \   The scaling practices documented in [RFC7342] can only reduce some\n   ARP\
    \ impact on L2/L3 boundary routers in some scenarios, but not all.\n   In order\
    \ to protect router CPUs from being overburdened by target\n   resolution requests,\
    \ some routers rate-limit the target MAC\n   resolution requests to the router's\
    \ CPU.  When the rate limit is\n   exceeded, the incoming data frames are dropped.\
    \  In traditional data\n   centers, this issue is less significant, since the\
    \ number of hosts\n   attached to one L2/L3 boundary router is limited by the\
    \ number of\n   physical ports of the switches/routers.  When servers are virtualized\n\
    \   to support 30+ VMs, the number of hosts under one router can grow by\n   a\
    \ factor of 30+.  Furthermore, in traditional data center networks,\n   each subnet\
    \ is neatly bound to a limited number of server racks,\n   i.e., switches only\
    \ need to be familiar with MAC addresses of hosts\n   that reside in this small\
    \ number of subnets.  In contemporary data\n   center networks, as subnets are\
    \ spread across many server racks,\n   switches are exposed to VLAN/MAC addresses\
    \ of many subnets, greatly\n   increasing the size of switches' FDB tables.\n\
    \   The solution proposed in this document can eliminate or reduce the\n   likelihood\
    \ of inter-subnet data frames being dropped and reduce the\n   number of host\
    \ MAC addresses that intermediate switches are exposed\n   to, thus reducing switches'\
    \ FDB table sizes.\n"
- title: 1.2.  SARP Overview
  contents:
  - "1.2.  SARP Overview\n   The SARP approach uses proxy gateways to address the\
    \ problems\n   discussed above.\n   Note: The guidelines to proxy developers [RFC4389]\
    \ have been\n   carefully considered for SARP.  Section 3.3 discusses how SARP\
    \ works\n   when VMs are moved from one segment to another.\n   In order to enable\
    \ VMs to be moved across servers while ensuring\n   their MAC/IP addresses remain\
    \ unchanged, the Layer 2 network (e.g.,\n   VLAN) that interconnects those VMs\
    \ may spread across different server\n   racks, different rows of server racks,\
    \ or even different data center\n   sites.\n   A multisite data center network\
    \ is comprised of two main building\n   blocks: an interconnecting segment and\
    \ an access segment.  While the\n   access network is, in most cases, a Layer\
    \ 2 network, the\n   interconnecting segment is not necessarily a Layer 2 network.\n\
    \   The SARP proxies are located at the boundaries where the access\n   segment\
    \ connects to its interconnecting segment.  The boundary node\n   can be a hypervisor\
    \ virtual switch, a top-of-rack switch, an\n   aggregation switch (or end-of-row\
    \ switch), or a data center core\n   switch.  Figure 2 depicts an example of two\
    \ remote data centers that\n   are managed as a single, flat Layer 2 domain. \
    \ SARP proxies are\n   implemented at the edge devices connecting the data center\
    \ to the\n   transport network.  SARP significantly reduces the ARP/ND\n   transmissions\
    \ over the interconnecting network.\n                            *-------------------*\n\
    \                            |                   |\n                    +-------|\
    \ Interconnecting   |-------+\n                    |       |     network     \
    \  |       |\n                    |       *-------------------*       |\n    \
    \                |                                   |\n           *-----------------*\
    \                  *----------------*\n           |  SARP Proxies   |        \
    \          |  SARP Proxies  |\n           *-----------------*                \
    \  *----------------*\n              |           |                        |  \
    \         |\n          *-------*   *-------*                *-------*   *-------*\n\
    \          |Access |   |Access |                |Access |   |Access |\n      \
    \    *-------*   *-------*                *-------*   *-------*\n            \
    \  |\n         *----------*\n         |Hypervisor|\n         *----------*\n  \
    \            |\n          *--------*\n          |Virtual |\n          |Machine\
    \ |\n          *--------*\n             (West Site)                          (East\
    \ Site)\n               Figure 2: SARP: Network Architecture Example\n"
- title: 1.3.  SARP Deployment Options
  contents:
  - "1.3.  SARP Deployment Options\n   SARP deployment is tightly coupled with the\
    \ data center architecture.\n   SARP proxies are located at the point where the\
    \ Layer 2\n   infrastructure connects to its Layer 2 cloud using overlay networks.\n\
    \   SARP proxies can be located at the data center edge (as Figure 2\n   depicts),\
    \ data center core, or data center aggregation (denoted by\n   \"Agg\" in the\
    \ figure).  SARP can also be implemented by the hypervisor\n   (as Figure 3 depicts).\n\
    \   To simplify the description, we will focus on data centers that are\n   managed\
    \ as a single, flat Layer 2 network, where SARP proxies are\n   located at the\
    \ boundary where the data center connects to the\n   transport network (as Figure\
    \ 2 depicts).\n                            *-------------------*\n           \
    \                 |                   |\n                    +-------|     TRANSPORT\
    \     |-------+\n                    |       |                   |       |\n \
    \                   |       *-------------------*       |\n                  \
    \  |                                   |\n           *-----------------*     \
    \             *----------------*\n           |   Edge Device   |             \
    \     |  Edge Device   |\n           *-----------------*                  *----------------*\n\
    \                    |                                   |\n           *-----------------*\
    \                  *----------------*\n           |       Core      |        \
    \          |      Core      |\n           *-----------------*                \
    \  *----------------*\n              |           |                        |  \
    \         |\n          *-------*   *-------*                *-------*   *-------*\n\
    \          |  Agg  |   |  Agg  |                |  Agg  |   |  Agg  |\n      \
    \    *-------*   *-------*                *-------*   *-------*\n            \
    \  |\n         *----------*\n         |Hypervisor|\n         *----------*\n  \
    \           (West Site)                          (East Site)\n               \
    \      Figure 3: SARP Deployment Options\n"
- title: 1.4.  Comparison with Existing Solutions
  contents:
  - "1.4.  Comparison with Existing Solutions\n   The IETF has developed several mechanisms\
    \ to address issues\n   associated with Layer 2 networks over multiple geographic\
    \ locations,\n   for example, Layer 2 VPN [RFC4664], proxy ARP [RFC925] [ProxyARP],\n\
    \   proxy Neighbor Discovery [RFC4389], IGMP and MLD snooping [RFC4541],\n   and\
    \ ARP mediation for IP interworking of Layer 2 VPNs [RFC6575].\n   However, all\
    \ those solutions work well when hosts within one subnet\n   are placed together\
    \ under one access domain, so that the intermediate\n   switches in each access\
    \ domain are only exposed to host addresses\n   from a limited number of subnets.\
    \  SARP is to provide a solution when\n   hosts within one subnet are spread across\
    \ multiple access domains,\n   and each access domain has hosts from many subnets.\
    \  Under this\n   environment, the intermediate switches in each access domain\
    \ are\n   exposed to combined hosts of all the subnets that are enabled by the\n\
    \   access domain.\n"
- title: 2.  Terms and Abbreviations Used in This Document
  contents:
  - "2.  Terms and Abbreviations Used in This Document\n   ARP:   Address Resolution\
    \ Protocol [ARP]\n   FDB:   Filtering Database, which is used for Layer 2 switches\n\
    \          [802.1Q].  Layer 2 switches flood data frames when the\n          Destination\
    \ Address (DA) is not in the FDB, whereas routers\n          drop data frames\
    \ when the DA is not in the Forwarding\n          Information Base (FIB).  That\
    \ is why the FDB is used for Layer\n          2 switches.\n   FIB:   Forwarding\
    \ Information Base\n   Hypervisor: a software layer that creates and runs virtual\
    \ machines\n          on a server\n   IP-D:  IP address of the destination virtual\
    \ machine\n   IP-S:  IP address of the source virtual machine\n   MAC-D: MAC address\
    \ of the destination virtual machine\n   MAC-E: MAC address of the East Proxy\
    \ SARP Device\n   MAC-S: MAC address of the source virtual machine\n   NA:   \
    \ IPv6 ND's Neighbor Advertisement\n   ND:    IPv6 Neighbor Discovery Protocol\
    \ [ND].  In this document, ND\n          also refers to Neighbor Solicitation,\
    \ Neighbor Advertisement,\n          and Unsolicited Neighbor Advertisement messages\
    \ defined by RFC\n          4861.\n   NS:    IPv6 ND's Neighbor Solicitation\n\
    \   SARP Proxy: The components that participate in SARP\n   UNA:   IPv6 ND's Unsolicited\
    \ Neighbor Advertisement [ND]\n   VM:    Virtual Machine\n"
- title: '3.  SARP: Theory of Operation'
  contents:
  - '3.  SARP: Theory of Operation

    '
- title: '3.1.  Control Plane: ARP/ND'
  contents:
  - "3.1.  Control Plane: ARP/ND\n   This section describes the ARP/ND procedure scenarios.\
    \  The first\n   scenario addresses a case where both the source and destination\
    \ VMs\n   reside in the same access segment.  In the second scenario, the\n  \
    \ source VM is in the local access segment and the destination VM is\n   located\
    \ at the remote access segment.\n   In all scenarios, the VMs (source and destination)\
    \ share the same L2\n   broadcast domain.\n"
- title: 3.1.1.  ARP/NS Request for a Local VM
  contents:
  - "3.1.1.  ARP/NS Request for a Local VM\n   When source and destination VMs are\
    \ located at the same access\n   segment (Figure 4), the address resolution process\
    \ is as described in\n   [ARP] and [ND]; host A sends an ARP request or an IPv6\
    \ Neighbor\n   Solicitation (NS) to learn the IP-to-MAC mapping of host B, and\
    \ it\n   receives a reply from host B with the IP-D to MAC-D mapping.\n     +-------+\
    \      _   __       +-------+      _   __\n     |host A |     / \\_/  \\_    \
    \ | SARP  |     / \\_/  \\_\n     | IP-S  |<--->\\_access \\<==>| proxy |<===>\\\
    _interc.\\\n     | MAC-S |     /network_/    |   1   |     /network_/\n     +-------+\
    \  +->\\__   _/      +-------+     \\__   _/\n                |     \\_/     \
    \                    \\_/\n     +-------+  |\n     |host B |<-+\n     | IP-D \
    \ |\n     | MAC-D |\n     +-------+\n     <--------------West Site------------>\n\
    \           Figure 4: SARP: Two Hosts in the Same Access Segment\n"
- title: 3.1.2.  ARP/NS Request for a Remote VM
  contents:
  - "3.1.2.  ARP/NS Request for a Remote VM\n   When the source and destination VMs\
    \ are located at different access\n   segments, the address resolution process\
    \ is as follows.\n     +-------+     +-------+    _   __       +-------+     +-------+\n\
    \     |host A |     | SARP  |   / \\_/  \\_     | SARP  |     |host B |\n    \
    \ | IP-S  |<===>|proxy 1|<=>\\_       \\<==>|proxy 2|<===>| IP-D  |\n     | MAC-S\
    \ |     | MAC-W |   /       _/    | MAC-E |     | MAC-D |\n     +-------+    \
    \ +-------+   \\__   _/      +-------+     +-------+\n                       \
    \           \\_/\n     <------West Site------>                 <------East Site------>\n\
    \        Figure 5: SARP: Two Hosts That Reside in Different Segments\n   In the\
    \ example illustrated in Figure 5, the source VM is located at\n   the west access\
    \ segment and the destination VM is located at the east\n   access segment.\n\
    \   When host A sends an ARP/NS request to find out the IP-to-MAC mapping\n  \
    \ of host B:\n   1. If SARP proxy 1 does not have IP-D in its ARP cache, the ARP/NS\n\
    \      request is propagated to all access segments that might have VMs\n    \
    \  in the same virtual network as the originating VM, including the\n      east\
    \ access segment.\n   2. As SARP proxy 1 forwards the ARP/NS message, it replaces\
    \ the\n      source MAC address, MAC-S, with its own MAC address, MAC-W.  Thus,\n\
    \      all switches that reside in the interconnecting segment are not\n     \
    \ exposed to MAC-S.\n   3. The ARP/NS request reaches SARP proxy 2.\n   4. If\
    \ SARP proxy 2 does not have IP-D in its ARP cache, the ARP/NS\n      request\
    \ is forwarded to the east access network.  Host B responds\n      with an ARP\
    \ reply (IPv4) or a Neighbor Advertisement (IPv6) to the\n      request with MAC-D.\n\
    \   5. When the response message reaches SARP proxy 2, it replaces MAC-D\n   \
    \   with MAC-E; thus, the response reaches SARP proxy 1 with MAC-E.\n   6. As\
    \ SARP proxy 1 forwards the response to host A, it replaces the\n      destination\
    \ address from MAC-W to MAC-S.\n   SARP Proxy ARP/ND Cache\n   SARP proxies maintain\
    \ a cache of the IP-to-MAC mapping.  This cache\n   is based on ARP/ND messages\
    \ that are sent by hosts and traverse the\n   SARP proxies.\n   In steps 1 and\
    \ 4 above, if the SARP proxy has IP-D in its ARP cache,\n   it responds with MAC-E,\
    \ without forwarding the ARP/NS request.\n   This caching approach significantly\
    \ reduces the volume of the ARP/ND\n   transmission over the network and reduces\
    \ the round-trip time of\n   ARP/ND requests.\n   When the west SARP proxy caches\
    \ the IP-to-MAC mapping entries for\n   remote VMs, the expiration timers should\
    \ be set to relatively low\n   values to prevent stale entries due to remote VMs\
    \ being moved or\n   deleted.  In environments where VMs move more frequently,\
    \ it is not\n   recommended for SARP proxies to cache the IP-to-MAC mapping entries\n\
    \   of remote VMs.\n"
- title: 3.1.3.  Gratuitous ARP and Unsolicited Neighbor Advertisement (UNA)
  contents:
  - "3.1.3.  Gratuitous ARP and Unsolicited Neighbor Advertisement (UNA)\n   Hosts\
    \ (or VMs) send out Gratuitous ARP (IPv4) [TcpIp] and Unsolicited\n   Neighbor\
    \ Advertisement (UNA) (IPv6) messages to allow other nodes to\n   refresh IP-to-MAC\
    \ entries in their caches.\n   The local SARP proxy processes the Gratuitous ARP\
    \ or UNA message in\n   the same way as the ARP reply or IPv6 NA, i.e., replaces\
    \ the MAC\n   addresses in the same manner.\n"
- title: '3.2.  Data Plane: Packet Transmission'
  contents:
  - '3.2.  Data Plane: Packet Transmission

    '
- title: 3.2.1.  Local Packet Transmission
  contents:
  - "3.2.1.  Local Packet Transmission\n   When a VM transmits packets to a destination\
    \ VM that is located at\n   the same site (Figure 4), the data plane is unaffected\
    \ by SARP;\n   packets are sent from (IP-S, MAC-S) to (IP-D, MAC-D).\n"
- title: 3.2.2.  Packet Transmission between Sites
  contents:
  - "3.2.2.  Packet Transmission between Sites\n   Packets that are sent between sites\
    \ (Figure 5) traverse the SARP\n   proxy of both sites.\n   A packet sent from\
    \ host A to host B undergoes the following\n   procedure:\n   1. Host A sends\
    \ a packet to IP-D, and based on its ARP table, it uses\n      the MAC addresses\
    \ {MAC-E, MAC-S}.\n   2. SARP proxy 1 receives the packet and replaces the source\
    \ MAC\n      address, such that the packet includes {MAC-E, MAC-W}.\n   3. SARP\
    \ proxy 2 receives the packet and replaces the destination MAC\n      address,\
    \ and the packet is sent to host B with {MAC-D, MAC-W}.\n   SARP proxy 1 replaces\
    \ the source MAC address with its own, since\n   switches in the interconnecting\
    \ segment are only familiar with SARP\n   proxy MAC addresses and are not familiar\
    \ with host addresses.\n   Note: it is a common security practice in data center\
    \ networks to use\n   access lists, allowing each VM to communicate only with\
    \ a list of\n   authorized peer VMs.  In most cases, such access control lists\
    \ are\n   based on IP addresses and, hence, are not affected by the MAC address\n\
    \   replacement in SARP.\n"
- title: 3.3.  VM Migration
  contents:
  - '3.3.  VM Migration

    '
- title: 3.3.1.  VM Local Migration
  contents:
  - "3.3.1.  VM Local Migration\n   When a VM migrates locally within its access segment,\
    \ SARP does not\n   require any special behavior.  VM migration is resolved entirely\
    \ by\n   the Layer 2 mechanisms.\n"
- title: 3.3.2.  VM Migration from One Site to Another
  contents:
  - "3.3.2.  VM Migration from One Site to Another\n   This section focuses on a scenario\
    \ where a VM migrates from the west\n   site to the east site while maintaining\
    \ its MAC and IP addresses.\n   VM migration might affect networking elements\
    \ based on their\n   respective locations:\n   -  origin site (west site)\n  \
    \ -  destination site (east site)\n   -  other sites\n     +-------+     +-------+\
    \    _   __       +-------+     +-------+\n     |host A |     | SARP  |   / \\\
    _/  \\_     | SARP  |     |host A |\n     | IP-D  |<===>|proxy 1|<=>\\_      \
    \ \\<==>|proxy 2|<===>| IP-D  |\n     | MAC-D |     | MAC-W |   /       _/   \
    \ | MAC-E |     | MAC-D |\n     +-------+     +-------+   \\__   _/      +-------+\
    \     +-------+\n                                  \\_/\n     <------West Site------>\
    \                 <------East Site------>\n           Origin Site            \
    \              Destination Site\n        Figure 6: SARP: Host A Migrates from\
    \ West Site to East Site\n   Origin Site\n      The origin site is the site where\
    \ the VM resides before the\n      migration (west site).\n      Before the VM\
    \ (IP=IP-D, MAC=MAC-D) is moved, all VMs at the west\n      site that have an\
    \ ARP entry of IP-D in their ARP table have the\n      IP-D -> MAC-D mapping.\
    \  VMs on other access segments have an ARP\n      entry of IP-D -> MAC-W mapping\
    \ where MAC-W is the MAC address of\n      the SARP proxy on the west access segment.\n\
    \      After the VM (IP-D) in the west site moves to the east site, if a\n   \
    \   Gratuitous ARP (IPv4) or an Unsolicited Neighbor Advertisement\n      (IPv6)\
    \ message is sent out by the destination hypervisor on behalf\n      of the VM\
    \ (IP-D), then the IP-to-MAC mapping cache of the VMs in\n      all access segments\
    \ is updated by IP-D -> MAC-E, where MAC-E is\n      the MAC address of the SARP\
    \ proxy on the east site.  If no\n      Gratuitous ARP or UNA message is sent\
    \ out by the destination\n      hypervisor, the IP-to-MAC cache on the VMs in\
    \ the west site (and\n      other sites) is eventually aged out.\n      Until\
    \ the IP-to-MAC mapping cache tables are updated, the source\n      VMs from the\
    \ west site continue sending packets locally to MAC-D,\n      and switches at\
    \ the west site are still configured with the old\n      location of MAC-D.  This\
    \ transient condition can be resolved by\n      having the VM manager send out\
    \ a fake Gratuitous ARP or UNA\n      message on behalf of the destination Hypervisor.\
    \  Another\n      alternative is to have a shorter aging timer configured for\
    \ the\n      IP-to-MAC cache table.\n   Destination Site\n      The destination\
    \ site is the site to which the VM migrated, i.e.,\n      the east site in Figure\
    \ 6.\n      Before any Gratuitous ARP or UNA messages are sent out by the\n  \
    \    destination hypervisor, all VMs at the east site (and all other\n      sites)\
    \ might have an IP-D -> MAC-W mapping in their IP-to-MAC\n      mapping cache.\
    \  The IP-to-MAC mapping cache is updated by aging or\n      by a Gratuitous ARP\
    \ or UNA message sent by the destination\n      hypervisor.  Until the IP-to-MAC\
    \ mapping caches are updated, VMs\n      from the east site continue to send packets\
    \ to MAC-W.  This can be\n      resolved by having the VM manager send out a fake\
    \ Gratuitous ARP\n      or UNA message immediately after the VM migration or by\n\
    \      redirecting the packets from the SARP proxy of the east site back\n   \
    \   to the migrated VM by updating the destination MAC of the packets\n      to\
    \ MAC-D.\n   Other Sites\n      All VMs at the other sites that have an ARP entry\
    \ of IP-D in their\n      ARP table have the IP-D -> MAC-W mapping.  The ARP mapping\
    \ is\n      updated by aging or by a Gratuitous ARP message sent by the\n    \
    \  destination hypervisor of the migrated VM and modified by the SARP\n      proxy\
    \ of the east site to an IP-D -> MAC-E mapping.  Until ARP\n      tables are updated,\
    \ VMs from other sites continue sending packets\n      to MAC-W.\n"
- title: 3.3.2.1.  Impact on IP-to-MAC Mapping Cache Table of Migrated VMs
  contents:
  - "3.3.2.1.  Impact on IP-to-MAC Mapping Cache Table of Migrated VMs\n   When a\
    \ VM (IP-D) is moved from one site to another, its IP-to-MAC\n   mapping entries\
    \ for VMs located at other sites (i.e., neither the\n   east site nor the west\
    \ site) are still valid, even though most guest\n   OSs (or VMs) will refresh\
    \ their IP-to-MAC cache after migration.\n   The migrated VM's IP-to-MAC mapping\
    \ entries for VMs located at the\n   east site, if not refreshed after migration,\
    \ can be kept with no\n   change until the ARP aging time, as these entries are\
    \ mapped to MAC-\n   E.  All traffic originated from the migrated VM in its new\
    \ location\n   to VMs located at the east site traverses the SARP proxy of the\
    \ east\n   site.  That SARP proxy can redirect the traffic back to the\n   corresponding\
    \ destinations on the east site.  Furthermore, an ARP/UNA\n   message sent by\
    \ the SARP proxy of the east site or by the VMs on the\n   east site can refresh\
    \ the corresponding entries in the migrated VM's\n   IP-to-MAC cache.\n   The\
    \ migrated VM's ARP entries for VMs located at the west site remain\n   unchanged\
    \ until either the ARP entries age out or new data frames are\n   received from\
    \ the remote sites.  Since all MAC addresses of the VMs\n   located at the west\
    \ site are unknown at the east site, all unknown\n   traffic from the VM is intercepted\
    \ by the SARP proxy of the east site\n   and forwarded to the SARP proxy of the\
    \ west site (during the\n   transient period before the ARP entries age out).\
    \  This transient\n   behavior is avoided if the SARP proxy has the destination\
    \ IP address\n   in its ARP cache, and, upon receiving a packet with an unknown\n\
    \   destination MAC address, it could send a Gratuitous ARP or UNA\n   message\
    \ to the migrated VM.\n   Note that overlay networks providing Layer 2 network\
    \ virtualization\n   services configure their edge-device MAC aging timers to\
    \ be greater\n   than the ARP request interval.\n"
- title: 3.4.  Multicast and Broadcast
  contents:
  - "3.4.  Multicast and Broadcast\n   Multicast and broadcast traffic is forwarded\
    \ by SARP proxies as\n   follows:\n   o  SARP proxies modify the source MAC address\
    \ of multicast and\n      broadcast packets as described in Section 3.2.\n   o\
    \  SARP proxies do not modify the destination MAC address of\n      multicast\
    \ and broadcast packets.\n"
- title: 3.5.  Non-IP Packet
  contents:
  - "3.5.  Non-IP Packet\n   The L2/L3 boundary routers in the current document are\
    \ capable of\n   forwarding non-IP IEEE 802.1 Ethernet frames (Layer 2) without\n\
    \   changing the MAC headers.  When subnets span across multiple ports of\n  \
    \ those routers, they are still under the category of a single link, or\n   a\
    \ multi-access link model recommended by [RFC4903].  They differ from\n   the\
    \ \"multi-link\" subnets described in [MultLinkSub] and [RFC4903],\n   which refer\
    \ to a different physical media with the same prefix\n   connected to a router,\
    \ where the Layer 2 frames cannot be natively\n   forwarded without changing the\
    \ headers.\n"
- title: 3.6.  High Availability and Load Balancing
  contents:
  - "3.6.  High Availability and Load Balancing\n   The SARP proxy is located at the\
    \ boundary where the local Layer 2\n   infrastructure connects to the interconnecting\
    \ network.  All traffic\n   from the local site to the remote sites traverses\
    \ the SARP proxy.\n   The SARP proxy is subject to high-availability and bandwidth\n\
    \   requirements.\n   The SARP architecture supports multiple SARP proxies connecting\
    \ a\n   single site to the transport network.  In the SARP architecture, all\n\
    \   proxies can be active and can back up one another.  The SARP\n   architecture\
    \ is robust and allows network administrators to allocate\n   proxies according\
    \ to bandwidth and high-availability requirements.\n   Traffic is segregated between\
    \ SARP proxies by using VLANs.  An SARP\n   proxy is the Master SARP proxy of\
    \ a set of VLANs and the Backup SARP\n   proxy of another set of VLANs.\n   For\
    \ example, assume the SARP proxies of the west site are SARP proxy\n   1 and SARP\
    \ proxy 2.  The west site supports VLAN 1 and VLAN 2, while\n   SARP proxy 1 is\
    \ the Master SARP proxy of VLAN 1 and the Backup SARP\n   proxy of VLAN 2, and\
    \ SARP proxy 2 is the Master SARP proxy of VLAN 2\n   and the Backup SARP proxy\
    \ of VLAN 1.  Both proxies are members of\n   VLAN 1 and VLAN 2.\n   The Master\
    \ SARP proxy updates its Backup SARP proxy with all the ARP\n   reply messages.\
    \  The Backup SARP proxy maintains a backup database to\n   all the VLANs that\
    \ it is the Backup SARP proxy of.\n   The Master and the Backup SARP proxies maintain\
    \ a keepalive\n   mechanism.  In case of a failure, the Backup SARP proxy becomes\
    \ the\n   Master SARP proxy.  The failure decision is per VLAN.  When the\n  \
    \ Master and the Backup SARP proxies switch over, the Backup SARP proxy\n   can\
    \ use the MAC address of the Master SARP proxy.  The Backup SARP\n   proxy sends\
    \ locally a Gratuitous ARP message with the MAC address of\n   the Master SARP\
    \ proxy to update the forwarding tables on the local\n   switches.  The Backup\
    \ SARP proxy also updates the remote SARP proxies\n   on the change.\n"
- title: 3.7.  SARP Interaction with Overlay Networks
  contents:
  - "3.7.  SARP Interaction with Overlay Networks\n   SARP can be used over overlay\
    \ networks, providing L2 network\n   virtualization (such as IP, Virtual Private\
    \ LAN Service (VPLS),\n   Transparent Interconnection of Lots of Links (TRILL),\
    \ Overlay\n   Transport Virtualization (OTV), Network Virtualization using GRE\n\
    \   (NVGRE), and Virtual eXtensible Local Area Network (VXLAN)).  The\n   mapping\
    \ of SARP to overlay networks is straightforward; the VM does\n   the mapping\
    \ of the destination IP to the SARP proxy MAC address.  The\n   mapping of the\
    \ proxy MAC to its correct tunnel is done by the overlay\n   networks.\n   SARP\
    \ significantly scales down the complexity of the overlay networks\n   and transport\
    \ networks by reducing the mapping tables to the number\n   of SARP proxies.\n"
- title: 4.  Security Considerations
  contents:
  - "4.  Security Considerations\n   SARP proxies are located at the boundaries of\
    \ access networks, where\n   the local Layer 2 infrastructure connects to its\
    \ Layer 2 cloud.  SARP\n   proxies interoperate with overlay network protocols\
    \ that extend the\n   Layer 2 subnet across data centers or between different\
    \ systems\n   within a data center.\n   SARP does not expose the network to security\
    \ threats beyond those\n   that exist whether or not SARP is present.\n   SARP\
    \ proxies may be exposed to denial-of-service (DoS) attacks by\n   means of ARP/ND\
    \ message flooding.  Thus, SARP proxies must have\n   sufficient resources to\
    \ support the SARP control plane without making\n   the network more vulnerable\
    \ to DoS than it was without SARP proxies.\n   SARP adds security to the data\
    \ plane in terms of network\n   reconnaissance, by hiding all the local Layer\
    \ 2 MAC addresses from\n   potential attackers located at the interconnecting\
    \ network and\n   significantly limiting the number of addresses exposed to an\
    \ attacker\n   at a remote site.\n"
- title: 5.  References
  contents:
  - '5.  References

    '
- title: 5.1.  Normative References
  contents:
  - "5.1.  Normative References\n   [ARP]       Plummer, D., \"Ethernet Address Resolution\
    \ Protocol: Or\n               Converting Network Protocol Addresses to 48.bit\
    \ Ethernet\n               Address for Transmission on Ethernet Hardware\", STD\
    \ 37,\n               RFC 826, DOI 10.17487/RFC0826, November 1982,\n        \
    \       <http://www.rfc-editor.org/info/rfc826>.\n   [ND]        Narten, T., Nordmark,\
    \ E., Simpson, W., and H. Soliman,\n               \"Neighbor Discovery for IP\
    \ version 6 (IPv6)\", RFC 4861,\n               DOI 10.17487/RFC4861, September\
    \ 2007,\n               <http://www.rfc-editor.org/info/rfc4861>.\n   [ProxyARP]\
    \  Carl-Mitchell, S. and J. Quarterman, \"Using ARP to\n               implement\
    \ transparent subnet gateways\", RFC 1027,\n               DOI 10.17487/RFC1027,\
    \ October 1987,\n               <http://www.rfc-editor.org/info/rfc1027>.\n  \
    \ [RFC925]    Postel, J., \"Multi-LAN address resolution\", RFC 925,\n       \
    \        DOI 10.17487/RFC0925, October 1984,\n               <http://www.rfc-editor.org/info/rfc925>.\n\
    \   [RFC4389]   Thaler, D., Talwar, M., and C. Patel, \"Neighbor Discovery\n \
    \              Proxies (ND Proxy)\", RFC 4389, DOI 10.17487/RFC4389,\n       \
    \        April 2006, <http://www.rfc-editor.org/info/rfc4389>.\n   [RFC4541] \
    \  Christensen, M., Kimball, K., and F. Solensky,\n               \"Considerations\
    \ for Internet Group Management Protocol\n               (IGMP) and Multicast\
    \ Listener Discovery (MLD) Snooping\n               Switches\", RFC 4541, DOI\
    \ 10.17487/RFC4541, May 2006,\n               <http://www.rfc-editor.org/info/rfc4541>.\n\
    \   [RFC4664]   Andersson, L., Ed., and E. Rosen, Ed., \"Framework for\n     \
    \          Layer 2 Virtual Private Networks (L2VPNs)\", RFC 4664,\n          \
    \     DOI 10.17487/RFC4664, September 2006,\n               <http://www.rfc-editor.org/info/rfc4664>.\n\
    \   [RFC6575]   Shah, H., Ed., Rosen, E., Ed., Heron, G., Ed., and V.\n      \
    \         Kompella, Ed., \"Address Resolution Protocol (ARP)\n               Mediation\
    \ for IP Interworking of Layer 2 VPNs\", RFC 6575,\n               DOI 10.17487/RFC6575,\
    \ June 2012,\n               <http://www.rfc-editor.org/info/rfc6575>.\n"
- title: 5.2.  Informative References
  contents:
  - "5.2.  Informative References\n   [802.1Q]    IEEE, \"IEEE Standard for Local\
    \ and metropolitan area\n               networks -- Bridges and Bridged Networks\"\
    , IEEE Std\n               802.1Q.\n   [ARMDStats] Karir, M., and J. Rees, \"\
    Address Resolution Statistics\",\n               Work in Progress, draft-karir-armd-statistics-01,\
    \ July\n               2011.\n   [MultLinkSub]\n               Thaler, D., and\
    \ C. Huitema, \"Multi-link Subnet Support in\n               IPv6\", Work in Progress,\n\
    \               draft-ietf-ipv6-multi-link-subnets-00, June 2002.\n   [RFC4903]\
    \   Thaler, D., \"Multi-Link Subnet Issues\", RFC 4903,\n               DOI 10.17487/RFC4903,\
    \ June 2007,\n               <http://www.rfc-editor.org/info/rfc4903>.\n   [RFC6820]\
    \   Narten, T., Karir, M., and I. Foo, \"Address Resolution\n               Problems\
    \ in Large Data Center Networks\", RFC 6820,\n               DOI 10.17487/RFC6820,\
    \ January 2013,\n               <http://www.rfc-editor.org/info/rfc6820>.\n  \
    \ [RFC7342]   Dunbar, L., Kumari, W., and I. Gashinsky, \"Practices for\n    \
    \           Scaling ARP and Neighbor Discovery (ND) in Large Data\n          \
    \     Centers\", RFC 7342, DOI 10.17487/RFC7342, August 2014,\n              \
    \ <http://www.rfc-editor.org/info/rfc7342>.\n   [RFC7364]   Narten, T., Ed., Gray,\
    \ E., Ed., Black, D., Fang, L.,\n               Kreeger, L., and M. Napierala,\
    \ \"Problem Statement:\n               Overlays for Network Virtualization\",\
    \ RFC 7364,\n               DOI 10.17487/RFC7364, October 2014,\n            \
    \   <http://www.rfc-editor.org/info/rfc7364>.\n   [TcpIp]     Stevens, W., \"\
    TCP/IP Illustrated, Volume 1: The\n               Protocols\", Addison-Wesley,\
    \ 1994.\n"
- title: Acknowledgments
  contents:
  - "Acknowledgments\n   The authors thank Ted Lemon, Eric Gray, and Adrian Farrel\
    \ for\n   providing valuable comments and suggestions for the document.\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Youval Nachum\n   EMail: youval.nachum@gmail.com\n   Linda\
    \ Dunbar\n   Huawei Technologies\n   5430 Legacy Drive, Suite #175\n   Plano,\
    \ TX  75024\n   United States\n   Phone: (469) 277 5840\n   EMail: ldunbar@huawei.com\n\
    \   Ilan Yerushalmi\n   Marvell\n   6 Hamada St.\n   Yokneam, 20692\n   Israel\n\
    \   EMail: yilan@marvell.com\n   Tal Mizrahi\n   Marvell\n   6 Hamada St.\n  \
    \ Yokneam, 20692\n   Israel\n   EMail: talmi@marvell.com\n"
