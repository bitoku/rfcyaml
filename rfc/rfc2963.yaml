- title: __initial_text__
  contents:
  - '           A Rate Adaptive Shaper for Differentiated Services

    '
- title: Status of this Memo
  contents:
  - "Status of this Memo\n   This memo provides information for the Internet community.\
    \  It does\n   not specify an Internet standard of any kind.  Distribution of\
    \ this\n   memo is unlimited.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (C) The Internet Society (2000).  All Rights Reserved.\n"
- title: Abstract
  contents:
  - "Abstract\n   This memo describes several Rate Adaptive Shapers (RAS) that can\
    \ be\n   used in combination with the single rate Three Color Markers (srTCM)\n\
    \   and the two rate Three Color Marker (trTCM) described in RFC2697 and\n   RFC2698,\
    \ respectively.  These RAS improve the performance of TCP when\n   a TCM is used\
    \ at the ingress of a diffserv network by reducing the\n   burstiness of the traffic.\
    \  With TCP traffic, this reduction of the\n   burstiness is accompanied by a\
    \ reduction of the number of marked\n   packets and by an improved TCP goodput.\
    \  The proposed RAS can be used\n   at the ingress of Diffserv networks providing\
    \ the Assured Forwarding\n   Per Hop Behavior (AF PHB).  They are especially useful\
    \ when a TCM is\n   used to mark traffic composed of a small number of TCP connections.\n"
- title: 1. Introduction
  contents:
  - "1. Introduction\n   In DiffServ networks [RFC2475], the incoming data traffic,\
    \ with the\n   AF PHB in particular, could be subject to marking where the purpose\n\
    \   of this marking is to provide a low drop probability to a minimum\n   part\
    \ of the traffic whereas the excess will have a larger drop\n   probability. \
    \ Such markers are mainly token bucket based such as the\n   single rate Three\
    \ Color Marker (srTCM) and two rate Three Color\n   Marker (trTCM) described in\
    \ [RFC2697] and [RFC2698], respectively.\n   Similar markers were proposed for\
    \ ATM networks and simulations have\n   shown that their performance with TCP\
    \ traffic was not always\n   satisfactory and several researchers have shown that\
    \ these\n   performance problems could be solved in two ways:\n   1. increasing\
    \ the burst size, i.e. increasing the Committed Burst\n      Size (CBS) and the\
    \ Peak Burst Size (PBS) in case of the trTCM, or\n   2. shaping the traffic such\
    \ that a part of the burstiness is removed.\n   The first solution has as major\
    \ disadvantage that the traffic sent to\n   the network can be very bursty and\
    \ thus engineering the network to\n   provide a low packet loss ratio can become\
    \ difficult.  To efficiently\n   support bursty traffic, additional resources\
    \ such as buffer space are\n   needed.  Conversely, the major disadvantage of\
    \ shaping is that the\n   traffic encounters additional delay in the shaper's\
    \ buffer.\n   In this document, we propose two shapers that can reduce the\n \
    \  burstiness of the traffic upstream of a TCM.  By reducing the\n   burstiness\
    \ of the traffic, the adaptive shapers increase the\n   percentage of packets\
    \ marked as green by the TCM and thus the overall\n   goodput of the users attached\
    \ to such a shaper.\n   Such rate adaptive shapers will probably be useful at\
    \ the edge of the\n   network (i.e. inside access routers or even network adapters).\
    \  The\n   simulation results in [Cnodder] show that these shapers are\n   particularly\
    \ useful when a small number of TCP connections are\n   processed by a TCM.\n\
    \   The structure of this document follows the structure proposed in\n   [Nichols].\
    \  We first describe two types of rate adaptive shapers in\n   section two.  These\
    \ shapers correspond to respectively the srTCM and\n   the trTCM.  In section\
    \ 3, we describe an extension to the simple\n   shapers that can provide a better\
    \ performance. We briefly discuss\n   simulation results in the appendix.\n"
- title: 2. Description of the rate adaptive shapers
  contents:
  - '2. Description of the rate adaptive shapers

    '
- title: 2.1. Rate adaptive shaper
  contents:
  - "2.1. Rate adaptive shaper\n   The rate adaptive shaper is based on a similar\
    \ shaper proposed in\n   [Bonaventure] to improve the performance of TCP with\
    \ the Guaranteed\n   Frame Rate [TM41] service category in ATM networks.  Another\
    \ type of\n   rate adaptive shaper suitable for differentiated services was briefly\n\
    \   discussed in [Azeem].  A RAS will typically be used as shown in\n   figure\
    \ 1 where the meter and the marker are the TCMs proposed in\n   [RFC2697] and\
    \ [RFC2698].\n                                     Result\n                  \
    \                +----------+\n                                  |          |\n\
    \                                  |          V\n                 +--------+ \
    \  +-------+   +--------+\n      Incoming   |        |   |       |   |       \
    \ |   Outgoing\n      Packet  ==>|  RAS   |==>| Meter |==>| Marker |==>Packet\n\
    \      Stream     |        |   |       |   |        |   Stream\n             \
    \    +--------+   +-------+   +--------+\n                        Figure 1. Rate\
    \ adaptive shaper\n   The presentation of the rate adaptive shapers in Figure\
    \ 1 is somewhat\n   different as described in [RFC2475] where the shaper is placed\
    \ after\n   the meter.  The main objective of the shaper is to produce at its\n\
    \   output a traffic that is less bursty than the input traffic, but the\n   shaper\
    \ avoids to discard packets in contrast with classical token\n   bucket based\
    \ shapers.  The shaper itself consists of a tail-drop FIFO\n   queue which is\
    \ emptied at a variable rate.  The shaping rate, i.e.\n   the rate at which the\
    \ queue is emptied, is a function of the\n   occupancy of the FIFO queue.  If\
    \ the queue occupancy increases, the\n   shaping rate will also increase in order\
    \ to prevent loss and too\n   large delays through the shaper.  The shaping rate\
    \ is also a function\n   of the average rate of the incoming traffic.  The shaper\
    \ was designed\n   to be used in conjunction with meters such as the TCMs proposed\
    \ in\n   [RFC2697] and [RFC2698].\n   There are two types of rate adaptive shapers.\
    \  The single rate rate\n   adaptive shaper (srRAS) will typically be used upstream\
    \ of a srTCM\n   while the two rates rate adaptive shaper (trRAS) will usually\
    \ be used\n   upstream of a trTCM.\n"
- title: 2.2. Configuration of the srRAS
  contents:
  - "2.2. Configuration of the srRAS\n   The srRAS is configured by specifying four\
    \ parameters: the Committed\n   Information Rate (CIR), the Maximum Information\
    \ Rate (MIR) and two\n   buffer thresholds: CIR_th (Committed Information Rate\
    \ threshold) and\n   MIR_th (Maximum Information Rate threshold).  The CIR shall\
    \ be\n   specified in bytes per second and MUST be configurable.  The MIR\n  \
    \ shall be specified in the same unit as the CIR and SHOULD be\n   configurable.\
    \  To achieve a good performance, the CIR of a srRAS will\n   usually be set to\
    \ the same value as the CIR of the downstream srTCM.\n   A typical value for the\
    \ MIR would be the line rate of the output link\n   of the shaper.  When the CIR\
    \ and optionally the MIR are configured,\n   the srRAS MUST ensure that the following\
    \ relation is verified:\n               CIR <= MIR <= line rate\n   The two buffer\
    \ thresholds, CIR_th and MIR_th shall be specified in\n   bytes and SHOULD be\
    \ configurable.  If these thresholds are\n   configured, then the srRAS MUST ensure\
    \ that the following relation\n   holds:\n               CIR_th <= MIR_th <= buffer\
    \ size of the shaper\n   The chosen values for CIR_th and MIR_th will usually\
    \ depend on the\n   values chosen for CBS and PBS in the downstream srTCM.  However,\
    \ this\n   dependency does not need to be standardized.\n"
- title: 2.3. Behavior of the srRAS
  contents:
  - "2.3. Behavior of the srRAS\n   The output rate of the shaper is based on two\
    \ factors.  The first one\n   is the (long term) average rate of the incoming\
    \ traffic.  This\n   average rate can be computed by several means.  For example,\
    \ the\n   function proposed in [Stoica] can be used (i.e. EARnew = [(1-exp(-\n\
    \   T/K))*L/T] + exp(-T/K)*EARold where EARold is the previous value of\n   the\
    \ Estimated Average Rate, EARnew is the updated value, K a\n   constant, L the\
    \ size of the arriving packet and T the amount of time\n   since the arrival of\
    \ the previous packet).  Other averaging functions\n   can be used as well.\n\
    \   The second factor is the instantaneous occupancy of the FIFO buffer\n   of\
    \ the shaper.  When the buffer occupancy is below CIR_th, the output\n   rate\
    \ of the shaper is set to the maximum of the estimated average\n   rate (EAR(t))\
    \ and the CIR.  This ensures that the shaper buffer will\n   be emptied at least\
    \ at a rate equal to CIR.  When the buffer\n   occupancy increases above CIR_th,\
    \ the output rate of the shaper is\n   computed as the maximum of the EAR(t) and\
    \ a linear function F of the\n   buffer occupancy for which F(CIR_th)=CIR and\
    \ F(MIR_th)=MIR.  When the\n   buffer occupancy reaches the MIR_th threshold,\
    \ the output rate of the\n   shaper is set to the maximum information rate.  The\
    \ computation of\n   the shaping rate is illustrated in figure 2.  We expect that\
    \ real\n   implementations will only use an approximate function to compute the\n\
    \   shaping rate.\n                   ^\n     Shaping rate  |\n              \
    \     |\n                   |\n              MIR  |                      =========\n\
    \                   |                    //\n                   |            \
    \      //\n           EAR(t)  |----------------//\n                   |      \
    \        //\n                   |            //\n             CIR   |============\n\
    \                   |\n                   |\n                   |\n          \
    \         |------------+---------+----------------------->\n                 \
    \            CIR_th      MIR_th Buffer occupancy\n              Figure 2. Computation\
    \ of shaping rate for srRAS\n"
- title: 2.4. Configuration of the trRAS
  contents:
  - "2.4. Configuration of the trRAS\n   The trRAS is configured by specifying six\
    \ parameters: the Committed\n   Information Rate (CIR), the Peak Information Rate\
    \ (PIR), the Maximum\n   Information Rate (MIR) and three buffer thresholds: CIR_th,\
    \ PIR_th\n   and MIR_th.  The CIR shall be specified in bytes per second and MUST\n\
    \   be configurable.  To achieve a good performance, the CIR of a trRAS\n   will\
    \ usually be set at the same value as the CIR of the downstream\n   trTCM.  The\
    \ PIR shall be specified in the same unit as the CIR and\n   MUST be configurable.\
    \  To achieve a good performance, the PIR of a\n   trRAS will usually be set at\
    \ the same value as the PIR of the\n   downstream trRAS.  The MIR SHOULD be configurable\
    \ and shall be\n   specified in the same unit as the CIR.  A typical value for\
    \ the MIR\n   will be the line rate of the output link of the shaper.  When the\n\
    \   values for CIR, PIR and optionally MIR are configured, the trRAS MUST\n  \
    \ ensure that the following relation is verified:\n               CIR <= PIR <=\
    \ MIR <= line rate\n   The three buffer thresholds, CIR_th, PIR_th and MIR_th\
    \ shall be\n   specified in bytes and SHOULD be configurable.  If these thresholds\n\
    \   are configured, then the trRAS MUST ensure that the following\n   relation\
    \ is verified:\n               CIR_th <= PIR_th <= MIR_th <= buffer size of the\
    \ shaper\n   The CIR_th, PIR_th and MIR_th will usually depend on the values\n\
    \   chosen for the CBS and the PBS in the downstream trTCM.  However,\n   this\
    \ dependency does not need to be standardized.\n"
- title: 2.5. Behavior of the trRAS
  contents:
  - "2.5. Behavior of the trRAS\n   The output rate of the trRAS is based on two factors.\
    \  The first is\n   the (long term) average rate of the incoming traffic.  This\
    \ average\n   rate can be computed as for the srRAS.\n   The second factor is\
    \ the instantaneous occupancy of the FIFO buffer\n   of the shaper.  When the\
    \ buffer occupancy is below CIR_th, the output\n   rate of the shaper is set to\
    \ the maximum of the estimated average\n   rate (EAR(t)) and the CIR.  This ensures\
    \ that the shaper will always\n   send traffic at least at the CIR.  When the\
    \ buffer occupancy\n   increases above CIR_th, the output rate of the shaper is\
    \ computed as\n   the maximum of the EAR(t) and a piecewise linear function F\
    \ of the\n   buffer occupancy.  This piecewise function can be defined as follows.\n\
    \   The first piece is between zero and CIR_th where F is equal to CIR.\n   This\
    \ means that when the buffer occupancy is below a certain\n   threshold CIR_th,\
    \ the shaping rate is at least CIR.  The second piece\n   is between CIR_th and\
    \ PIR_th where F increases linearly from CIR to\n   PIR.  The third part is from\
    \ PIR_th to MIR_th where F increases\n   linearly from PIR to the MIR and finally\
    \ when the buffer occupancy is\n   above MIR_th, the shaping rate remains constant\
    \ at the MIR.  The\n   computation of the shaping rate is illustrated in figure\
    \ 3.  We\n   expect that real implementations will use an approximation of the\n\
    \   function shown in this figure to compute the shaping rate.\n             \
    \    ^\n   Shaping rate  |\n                 |\n           MIR   |           \
    \                    ======\n                 |                            ///\n\
    \                 |                         ///\n           PIR   |          \
    \            ///\n                 |                    //\n                 |\
    \                  //\n         EAR(t)  |----------------//\n                \
    \ |              //\n                 |            //\n           CIR   |============\n\
    \                 |\n                 |\n                 |\n                \
    \ |------------+---------+--------+-------------------->\n                   \
    \      CIR_th      PIR_th    MIR_th  Buffer occupancy\n            Figure 3. Computation\
    \ of shaping rate for trRAS\n"
- title: 3. Description of the green RAS.
  contents:
  - '3. Description of the green RAS.

    '
- title: 3.1. The green rate adaptive shapers
  contents:
  - "3.1. The green rate adaptive shapers\n   The srRAS and the trRAS described in\
    \ the previous section are not\n   aware of the status of the meter.  This entails\
    \ that a RAS could\n   unnecessarily delay a packet although there are sufficient\
    \ tokens\n   available to color the packet green.  This delay could mean that\
    \ TCP\n   takes more time to increase its congestion window and this may lower\n\
    \   the performance with TCP traffic.  The green RAS shown in figure 4\n   solves\
    \ this problem by coupling the shaper with the meter.\n                      \
    \   Status       Result\n                      +----------+ +----------+\n   \
    \                   |          | |          |\n                      V       \
    \   | |          V\n                 +--------+   +-------+   +--------+\n   \
    \   Incoming   | green  |   |       |   |        |   Outgoing\n      Packet  ==>|\
    \  RAS   |==>| Meter |==>| Marker |==>Packet\n      Stream     |        |   |\
    \       |   |        |   Stream\n                 +--------+   +-------+   +--------+\n\
    \                            Figure 4. green RAS\n   The two rate adaptive shapers\
    \ described in section 2 calculate a\n   shaping rate, which is defined as the\
    \ maximum of the estimated\n   average incoming data rate and some function of\
    \ the buffer occupancy.\n   Using this shaping rate, the RAS computes the time\
    \ schedule at which\n   the packet at the head of the queue of the shaper is to\
    \ be released.\n   The main idea of the green RAS is to couple the shaper with\
    \ the\n   downstream meter so that the green RAS knows at what time the packet\n\
    \   at the head of its queue would be accepted as green by the meter.  If\n  \
    \ this time instant is earlier than the release time computed from the\n   current\
    \ shaping rate, then the packet can be released at this time\n   instant.  Otherwise,\
    \ the packet at the head of the queue of the green\n   RAS will be released at\
    \ the time instant calculated from the current\n   shaping rate.\n"
- title: 3.2. Configuration of the Green single rate Rate Adaptive Shaper
  contents:
  - "3.2. Configuration of the Green single rate Rate Adaptive Shaper\n     (GsrRAS)\n\
    \   The G-srRAS must be configured in the same way as the srRAS (see\n   section\
    \ 2.2).\n"
- title: 3.3. Behavior of the G-srRAS
  contents:
  - "3.3. Behavior of the G-srRAS\n   First of all, the shaping rate of the G-srRAS\
    \ is calculated in the\n   same way as for the srRAS.  With the srRAS, this shaping\
    \ rate\n   determines a time schedule, T1, at which the packet at the head of\n\
    \   the queue is to be released from the shaper.\n   A second time schedule, T2,\
    \ is calculated as the earliest time\n   instant at which the packet at the head\
    \ of the shaper's queue would\n   be colored as green by the downstream srTCM.\
    \  Suppose that a packet\n   of size B bytes is at the head of the shaper and\
    \ that CIR is the\n   Committed Information Rate of the srTCM in bytes per second.\
    \  If we\n   denote the current time by t and by Tc(t) the amount of green tokens\n\
    \   in the token bucket of the srTCM at time t, then T2 is equal to\n   max(t,\
    \ t+(B-Tc(t))/CIR).  If B is larger than CBS, the Committed\n   Burst Size of\
    \ the srTCM, then T2 is set to infinity.\n   When a packet arrives at the head\
    \ of the queue of the shaper, it will\n   leave this queue not sooner than min(T1,\
    \ T2) from the shaper.\n"
- title: 3.4 Configuration of the Green two rates Rate Adaptive Shaper (G-trRAS)
  contents:
  - "3.4 Configuration of the Green two rates Rate Adaptive Shaper (G-trRAS)\n   The\
    \ G-trRAS must be configured in the same way as the trRAS (see\n   section 2.4).\n"
- title: 3.5. Behavior of the G-trRAS
  contents:
  - "3.5. Behavior of the G-trRAS\n   First of all, the shaping rate of the G-trRAS\
    \ is calculated in the\n   same way as for the trRAS.  With the trRAS, this shaping\
    \ rate\n   determines a time schedule, T1, at which the packet at the head of\n\
    \   the queue is to be released from the shaper.\n   A second time schedule, T2,\
    \ is calculated as the earliest time\n   instant at which the packet at the head\
    \ of the shaper's queue would\n   be colored as green by the downstream trTCM.\
    \  Suppose that a packet\n   of size B bytes is at the head of the shaper and\
    \ that CIR is the\n   Committed Information Rate of the srTCM in bytes per second.\
    \  If we\n   denote the current time by t and by Tc(t) (resp. Tp(t)) the amount\
    \ of\n   green (resp. yellow) tokens in the token bucket of the trTCM at time\n\
    \   t, then T2 is equal to max(t, t+(B-Tc(t))/CIR,t+(B-Tp(t))/PIR).  If B\n  \
    \ is larger than CBS, the committed burst size, or PBS, the peak burst\n   size,\
    \ of the srTCM, then T2 is set to infinity.\n   When a packet arrives at the head\
    \ of the queue of the shaper, it will\n   leave this queue not sooner than min(T1,\
    \ T2) from the shaper.\n"
- title: 4. Assumption
  contents:
  - "4. Assumption\n   The shapers discussed in this document assume that the Internet\n\
    \   traffic is dominated by protocols such as TCP that react\n   appropriately\
    \ to congestion by decreasing their transmission rate.\n   The proposed shapers\
    \ do not provide a performance gain if the traffic\n   is composed of protocols\
    \ that do not react to congestion by\n   decreasing their transmission rate.\n"
- title: 5. Example services
  contents:
  - "5. Example services\n   The shapers discussed in this document can be used where\
    \ the TCMs\n   proposed in [RFC2697] and [RFC2698] are used.  In fact, simulations\n\
    \   briefly discussed in Appendix A show that the performance of TCP can\n   be\
    \ improved when a rate adaptive shaper is used upstream of a TCM.\n   We expect\
    \ such rate adaptive shapers to be particularly useful at the\n   edge of the\
    \ network, for example inside (small) access routers or\n   even network adapters.\n"
- title: 6. The rate adaptive shaper combined with other markers
  contents:
  - "6. The rate adaptive shaper combined with other markers\n   This document explains\
    \ how the idea of a rate adaptive shaper can be\n   combined with the srTCM and\
    \ the trTCM.  This resulted in the srRAS\n   and the G-srRAS for the srTCM and\
    \ in the trRAS and the G-trRAS for\n   the trTCM.  Similar adaptive shapers could\
    \ be developed to support\n   other traffic markers such as the Time Sliding Window\
    \ Three Color\n   Marker (TSWTCM) [Fang].  However, the exact definition of such\
    \ new\n   adaptive shapers and their performance is outside the scope of this\n\
    \   document.\n"
- title: 7. Security Considerations
  contents:
  - "7. Security Considerations\n   The shapers described in this document have no\
    \ known security\n   concerns.\n"
- title: 8. Intellectual Property Rights
  contents:
  - "8. Intellectual Property Rights\n   The IETF has been notified of intellectual\
    \ property rights claimed in\n   regard to some or all of the specification contained\
    \ in this\n   document.  For more information consult the online list of claimed\n\
    \   rights.\n"
- title: 9. Acknowledgement
  contents:
  - "9. Acknowledgement\n   We would like to thank Emmanuel Desmet for his comments.\n"
- title: 10. References
  contents:
  - "10. References\n   [Azeem]       Azeem, F., Rao, A., Lu, X. and S. Kalyanaraman,\
    \ \"TCP-\n                 Friendly Traffic Conditioners for Differentiated\n\
    \                 Services\", Work in Progress.\n   [RFC2475]     Blake S., Black,\
    \ D., Carlson, M., Davies, E., Wang, Z.\n                 and W. Weiss, \"An Architecture\
    \ for Differentiated\n                 Services\", RFC 2475, December 1998.\n\
    \   [Bonaventure] Bonaventure O., \"Integration of ATM under TCP/IP to\n     \
    \            provide services with a minimum guaranteed bandwidth\",\n       \
    \          Ph. D. thesis, University of Liege, Belgium, September\n          \
    \       1998.\n   [Clark]       Clark D. and Fang, W., \"Explicit Allocation of\
    \ Best-\n                 Effort Packet Delivery Service\", IEEE/ACM Trans. on\n\
    \                 Networking, Vol. 6, No. 4, August 1998.\n   [Cnodder]     De\
    \ Cnodder S., \"Rate Adaptive Shapers for Data Traffic\n                 in DiffServ\
    \ Networks\", NetWorld+Interop 2000 Engineers\n                 Conference, Las\
    \ Vegas, Nevada, USA, May 10-11, 2000.\n   [Fang]        Fang W., Seddigh N. and\
    \ B. Nandy, \"A Time Sliding\n                 Window Three Colour Marker (TSWTCM)\"\
    , RFC 2859, June\n                 2000.\n   [Floyd]       Floyd S. and V. Jacobson,\
    \ \"Random Early Detection\n                 Gateways for Congestion Avoidance\"\
    , IEEE/ACM\n                 Transactions on Networking, August 1993.\n   [RFC2697]\
    \     Heinanen J. and R. Guerin, \"A Single Rate Three Color\n               \
    \  Marker\", RFC 2697, September 1999.\n   [RFC2698]     Heinanen J. and R. Guerin,\
    \ \"A Two Rate Three Color\n                 Marker\", RFC 2698, September 1999.\n\
    \   [RFC2597]     Heinanen J., Baker F., Weiss W. and J. Wroclawski,\n       \
    \          \"Assured Forwarding PHB Group\", RFC 2597, June 1999.\n   [Nichols]\
    \     Nichols K. and B. Carpenter, \"Format for Diffserv\n                 Working\
    \ Group Traffic Conditioner Drafts\", Work in\n                 Progress.\n  \
    \ [Stoica]      Stoica I., Shenker S. and H. Zhang, \"Core-stateless\n       \
    \          fair queueuing: achieving approximately fair bandwidth\n          \
    \       allocations in high speed networks\", ACM SIGCOMM98, pp.\n           \
    \      118-130, Sept. 1998\n   [TM41]        ATM Forum, Traffic Management Specification,\
    \ verion\n                 4.1, 1999\n"
- title: Appendix
  contents:
  - 'Appendix

    '
- title: A. Simulation results
  contents:
  - "A. Simulation results\n   We briefly discuss simulations showing the benefits\
    \ of the proposed\n   shapers in simple network environments. Additional simulation\
    \ results\n   may be found in [Cnodder].\n"
- title: A.1 description of the model
  contents:
  - "A.1 description of the model\n   To evaluate the rate adaptive shaper through\
    \ simulations, we use the\n   simple network model depicted in Figure A.1.  In\
    \ this network, we\n   consider that a backbone network is used to provide a LAN\n\
    \   Interconnection service to ten pairs of LANs.  Each LAN corresponds\n   to\
    \ an uncongested switched 10 Mbps LAN with ten workstations attached\n   to a\
    \ customer router (C1-C10 in figure A.1).  The delay on the LAN\n   links is set\
    \ to 1 msec. The MSS size of the workstations is set to\n   1460 bytes.  The workstations\
    \ on the left hand side of the figure\n   send traffic to companion workstations\
    \ located on the right hand side\n   of the figure.  All traffic from the LAN\
    \ attached to customer router\n   C1 is sent to the LAN attached to customer router\
    \ C1'.  There are ten\n   workstations on each LAN and each workstation implements\
    \ SACK-TCP\n   with a maximum window size of 64 KBytes.\n           2.5 msec,\
    \ 34 Mbps                      2.5 msec, 34 Mbps\n          <--------------> \
    \                     <-------------->\n     \\+---+                         \
    \                            +---+/\n     -| C1|--------------+              \
    \         +--------------|C1'|-\n     /+---+              |                  \
    \     |              +---+\\\n     \\+---+              |                    \
    \   |              +---+/\n     -| C2|------------+ |                       |\
    \ +------------|C2'|-\n     /+---+            | |                       | |  \
    \          +---+\\\n     \\+---+            | |                       | |    \
    \        +---+/\n     -| C3|----------+ | |                       | | +----------|C3'|-\n\
    \     /+---+          | | |                       | | |          +---+\\\n   \
    \  \\+---+          | | |                       | | |          +---+/\n     -|\
    \ C4|--------+ +-+----------+     +----------+-+ +--------|C4'|-\n     /+---+\
    \        |   |          |     |          |   |        +---+\\\n     \\+---+  \
    \      +---|          |     |          |---+        +---+/\n     -| C5|------------|\
    \   ER1    |-----|   ER2    |------------|C5'|-\n     /+---+        +---|    \
    \      |     |          |---+        +---+\\\n     \\+---+        |   |      \
    \    |     |          |   |        +---+/\n     -| C6|--------+   +----------+\
    \     +----------+   +--------|C6'|-\n     /+---+            ||||            \
    \         ||||            +---+\\\n     \\+---+            ||||      <------->\
    \      ||||            +---+/\n     -| C7|------------+|||       70 Mbps     \
    \  |||+------------|C7'|-\n     /+---+             |||       10 msec       |||\
    \             +---+\\\n     \\+---+             |||                     |||  \
    \           +---+/\n     -| C8|-------------+||                     ||+-------------|C8'|-\n\
    \     /+---+              ||                     ||              +---+\\\n   \
    \  \\+---+              ||                     ||              +---+/\n     -|\
    \ C9|--------------+|                     |+--------------|C9'|-\n     /+---+\
    \               |                     |               +---+\\\n     \\+---+  \
    \             |                     |               +----+/\n     -|C10|---------------+\
    \                     +---------------|C10'|-\n     /+---+                   \
    \                                  +----+\\\n                     Figure A.1.\
    \ the simulation model.\n   The customer routers are connected with 34 Mbps links\
    \ to the backbone\n   network which is, in our case, composed of a single bottleneck\
    \ 70\n   Mbps link between the edge routers ER1 and ER2.  The delay on all the\n\
    \   customer-edge 34 Mbps links has been set to 2.5 msec to model a MAN\n   or\
    \ small WAN environment.  These links and the customer routers are\n   not a bottleneck\
    \ in our environment and no losses occurs inside the\n   edge routers.  The customer\
    \ routers are equipped with a trTCM\n   [Heinanen2] and mark the incoming traffic.\
    \  The parameters of the\n   trTCM are shown in table A.1.\n        Table A.1:\
    \ configurations of the trTCMs\n        Router          CIR               PIR\
    \             Line Rate\n        C1              2 Mbps            4 Mbps    \
    \      34 Mbps\n        C2              4 Mbps            8 Mbps          34 Mbps\n\
    \        C3              6 Mbps           12 Mbps          34 Mbps\n        C4\
    \              8 Mbps           16 Mbps          34 Mbps\n        C5         \
    \    10 Mbps           20 Mbps          34 Mbps\n        C6              2 Mbps\
    \            4 Mbps          34 Mbps\n        C7              4 Mbps         \
    \   8 Mbps          34 Mbps\n        C8              6 Mbps           12 Mbps\
    \          34 Mbps\n        C9              8 Mbps           16 Mbps         \
    \ 34 Mbps\n        C10            10 Mbps           20 Mbps          34 Mbps\n\
    \   All customer routers are equipped with a trTCM where the CIR are 2\n   Mbps\
    \ for router C1 and C6, 4 Mbps for C2 and C7, 6 Mbps for C3 and\n   C8, 8 Mbps\
    \ for C4 and C9 and 10 Mbps for C5 and C10.  Routers C6-C10\n   also contain a\
    \ trRAS in addition to the trTCM while routers C1-C5\n   only contain a trTCM.\
    \  In all simulations, the PIR is always twice as\n   large as the CIR.  Also\
    \ the PBS is the double of the CBS.  The CBS\n   will be varied in the different\
    \ simulation runs.\n   The edge routers, ER1 and ER2, are connected with a 70\
    \ Mbps link\n   which is the bottleneck link in our environment.  These two routers\n\
    \   implement the RIO algorithm [Clark] that we have extended to support\n   three\
    \ drop priorities instead of two.  The thresholds of the\n   parameters are 100\
    \ and 200 packets (minimum and maximum threshold,\n   respectively) for the red\
    \ packets, 200 and 400 packets for the yellow\n   packets and 400 and 800 for\
    \ the green packets.  These thresholds are\n   reasonable since there are 100\
    \ TCP connections crossing each edge\n   router.  The parameter maxp of RIO for\
    \ green, yellow and red are\n   respectively set to 0.02, 0.05, and 0.1.  The\
    \ weight to calculate the\n   average queue length which is used by RED or RIO\
    \ is set to 0.002\n   [Floyd].\n   The simulated time is set to 102 seconds where\
    \ the first two seconds\n   are not used to gather TCP statistics (the so-called\
    \ warm-up time)\n   such as goodput.\n"
- title: A.2 Simulation results for the trRAS
  contents:
  - "A.2 Simulation results for the trRAS\n   For our first simulations, we consider\
    \ that routers C1-C5 only\n   utilize a trTCM while routers C6-C10 utilize a rate\
    \ adaptive shaper\n   in conjunction with a trTCM. All routers use a CBS of 3\
    \ KBytes.  In\n   table A.2, we show the total throughput achieved by the workstations\n\
    \   attached to each LAN as well as the total throughput for the green\n   and\
    \ the yellow packets as a function of the CIR of the trTCM used on\n   the customer\
    \ router attached to this LAN.  The throughput of the red\n   packets is equal\
    \ to the difference between the total traffic and the\n   green and the yellow\
    \ traffic.  In table A.3, we show the total\n   throughput achieved by the workstations\
    \ attached to customer routers\n   with a rate adaptive shaper.\n        Table\
    \ A.2: throughput in Mbps for the unshaped traffic.\n                      green\
    \           yellow          total\n        2Mbps [C1]    1.10            0.93\
    \            2.25\n        4Mbps [C2]    2.57            1.80            4.55\n\
    \        6Mbps [C3]    4.10            2.12            6.39\n        8Mbps [C4]\
    \    5.88            2.32            8.33\n        10Mbps [C5]   7.57        \
    \    2.37            10.0\n        Table A.3: throughput in Mbps for the adaptively\
    \ shaped\n        traffic.\n                            green           yellow\
    \          total\n        2Mbps [C6]    2.00            1.69            3.71\n\
    \        4Mbps [C7]    3.97            2.34            6.33\n        6Mbps [C8]\
    \    5.93            2.23            8.17\n        8Mbps [C9]    7.84        \
    \    2.28            10.1\n        10Mbps [C10]  9.77            2.14        \
    \    11.9\n   This first simulation shows clearly that the workstations attached\
    \ to\n   an edge router with a rate adaptive shaper have a clear advantage,\n\
    \   from a performance point of view, with respect to workstations\n   attached\
    \ to an edge router with only a trTCM.  The performance\n   improvement is the\
    \ result of the higher proportion of packets marked\n   as green by the edge routers\
    \ when the rate adaptive shaper is used.\n   To evaluate the impact of the CBS\
    \ on the TCP goodput, we did\n   additional simulations were we varied the CBS\
    \ of all customer\n   routers.\n   Table A.4 shows the total goodput for workstations\
    \ attached to,\n   respectively, routers C1 (trTCM with 2 Mbps CIR, no adaptive\n\
    \   shaping), C6 (trRAS with 2 Mbps CIR and adaptive shaping), C3 (trTCM\n   with\
    \ 6 Mbps CIR, no adaptive shaping), and C8 (trRAS with 6 Mbps CIR\n   and adaptive\
    \ shaping) for various values of the CBS.  From this\n   table, it is clear that\
    \ the rate adaptive shapers provide a\n   performance benefit when the CBS is\
    \ small.  With a very large CBS,\n   the performance decreases when the shaper\
    \ is in use.  However, a CBS\n   of a few hundred KBytes is probably too large\
    \ in many environments.\n      Table A.4: goodput in Mbps (link rate is 70 Mbps)\
    \ versus CBS\n      in KBytes.\n      CBS  2_Mbps_unsh     2_Mbps_sh      6_Mbps_unsh\
    \    6_Mbps_sh\n      3       1.88            3.49          5.91           7.77\n\
    \      10      2.97            2.91          6.76           7.08\n      25   \
    \   3.14            2.78          7.07           6.73\n      50      3.12    \
    \        2.67          7.20           6.64\n      75      3.18            2.56\
    \          7.08           6.58\n      100     3.20            2.64          7.00\
    \           6.62\n      150     3.21            2.54          7.11           6.52\n\
    \      200     3.26            2.57          7.07           6.53\n      300  \
    \   3.19            2.53          7.13           6.49\n      400     3.13    \
    \        2.48          7.18           6.43\n"
- title: A.3 Simulation results for the Green trRAS
  contents:
  - "A.3 Simulation results for the Green trRAS\n   We use the same scenario as in\
    \ A.2 but now we use the Green trRAS\n   (G-trRAS).\n   Table A.5 and Table A.6\
    \ show the results of the same scenario as for\n   Table A.2 and Table A.3 but\
    \ the shaper is now the G-trRAS.  We see\n   that the shaped traffic performs\
    \ again much better, also compared to\n   the previous case (i.e. where the trRAS\
    \ was used).  This is because\n   the amount of yellow traffic increases with\
    \ the expense of a slight\n   decrease in the amount of green traffic.  This can\
    \ be explained by\n   the fact that the G-trRAS introduces some burstiness.\n\
    \      Table A.5: throughput in Mbps for the unshaped traffic.\n             \
    \       green           yellow          total\n      2Mbps [C1]    1.10      \
    \      0.95            2.26\n      4Mbps [C2]    2.41            1.66        \
    \    4.24\n      6Mbps [C3]    3.94            1.97            6.07\n      8Mbps\
    \ [C4]    5.72            2.13            7.96\n      10Mbps [C5]   7.25     \
    \       2.29            9.64\n      Table A.6: throughput in Mbps for the adaptively\
    \ shaped\n      traffic.\n                    green           yellow         \
    \ total\n      2Mbps [C6]    1.92            1.75            3.77\n      4Mbps\
    \ [C7]    3.79            3.24            7.05\n      6Mbps [C8]    5.35     \
    \       3.62            8.97\n      8Mbps [C9]    6.96            3.48       \
    \     10.4\n      10Mbps [C10]  8.69            3.06            11.7\n   The impact\
    \ of the CBS is shown in Table A.7 which is the same\n   scenario as Table A.4\
    \ with the only difference that the shaper is now\n   the G-trRAS.  We see that\
    \ the shaped traffic performs much better\n   than the unshaped traffic when the\
    \ CBS is small.  When the CBS is\n   large, the shaped and unshaped traffic performs\
    \ more or less the\n   same.  This is in contrast with the trRAS, where the performance\
    \ of\n   the shaped traffic was slightly worse in case of a large CBS.\n   Table\
    \ A.7: goodput in Mbps (link rate is 70 Mbps) versus CBS\n   in KBytes.\n    \
    \  CBS  2_Mbps_unsh     2_Mbps_sh      6_Mbps_unsh    6_Mbps_sh\n      3     \
    \  1.90            3.44          5.62           8.44\n      10      2.95     \
    \       3.30          6.70           7.20\n      25      2.98            3.01\
    \          7.03           6.93\n      50      3.06            2.85          6.81\
    \           6.84\n      75      3.08            2.80          6.87           6.96\n\
    \      100     2.99            2.78          6.85           6.88\n      150  \
    \   2.98            2.70          6.80           6.81\n      200     2.96    \
    \        2.70          6.82           6.97\n      300     2.94            2.70\
    \          6.83           6.86\n      400     2.86            2.62          6.83\
    \           6.84\n"
- title: A.4 Conclusion simulations
  contents:
  - "A.4 Conclusion simulations\n   From these simulations, we see that the shaped\
    \ traffic has much\n   higher throughput compared to the unshaped traffic when\
    \ the CBS was\n   small.  When the CBS is large, the shaped traffic performs slightly\n\
    \   less than the unshaped traffic due to the delay in the shaper.  The\n   G-trRAS\
    \ solves this problem.  Additional simulation results may be\n   found in [Cnodder]\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Olivier Bonaventure\n   Infonet research group\n   Institut\
    \ d'Informatique (CS Dept)\n   Facultes Universitaires Notre-Dame de la Paix\n\
    \   Rue Grandgagnage 21, B-5000 Namur, Belgium.\n   EMail: Olivier.Bonaventure@info.fundp.ac.be\n\
    \   URL:   http://www.infonet.fundp.ac.be\n   Stefaan De Cnodder\n   Alcatel Network\
    \ Strategy Group\n   Fr. Wellesplein 1, B-2018 Antwerpen, Belgium.\n   Phone:\
    \  32-3-240-8515\n   Fax:    32-3-240-9932\n   EMail:  stefaan.de_cnodder@alcatel.be\n"
- title: Full Copyright Statement
  contents:
  - "Full Copyright Statement\n   Copyright (C) The Internet Society (2000).  All\
    \ Rights Reserved.\n   This document and translations of it may be copied and\
    \ furnished to\n   others, and derivative works that comment on or otherwise explain\
    \ it\n   or assist in its implementation may be prepared, copied, published\n\
    \   and distributed, in whole or in part, without restriction of any\n   kind,\
    \ provided that the above copyright notice and this paragraph are\n   included\
    \ on all such copies and derivative works.  However, this\n   document itself\
    \ may not be modified in any way, such as by removing\n   the copyright notice\
    \ or references to the Internet Society or other\n   Internet organizations, except\
    \ as needed for the purpose of\n   developing Internet standards in which case\
    \ the procedures for\n   copyrights defined in the Internet Standards process\
    \ must be\n   followed, or as required to translate it into languages other than\n\
    \   English.\n   The limited permissions granted above are perpetual and will\
    \ not be\n   revoked by the Internet Society or its successors or assigns.\n \
    \  This document and the information contained herein is provided on an\n   \"\
    AS IS\" basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING\n   TASK FORCE\
    \ DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING\n   BUT NOT LIMITED\
    \ TO ANY WARRANTY THAT THE USE OF THE INFORMATION\n   HEREIN WILL NOT INFRINGE\
    \ ANY RIGHTS OR ANY IMPLIED WARRANTIES OF\n   MERCHANTABILITY OR FITNESS FOR A\
    \ PARTICULAR PURPOSE.\n"
- title: Acknowledgement
  contents:
  - "Acknowledgement\n   Funding for the RFC Editor function is currently provided\
    \ by the\n   Internet Society.\n"
