- title: __initial_text__
  contents:
  - ''
- title: Flow-Aware Transport of Pseudowires over an MPLS Packet Switched Network
  contents:
  - 'Flow-Aware Transport of Pseudowires over an MPLS Packet Switched Network

    '
- title: Abstract
  contents:
  - "Abstract\n   Where the payload of a pseudowire comprises a number of distinct\n\
    \   flows, it can be desirable to carry those flows over the Equal Cost\n   Multiple\
    \ Paths (ECMPs) that exist in the packet switched network.\n   Most forwarding\
    \ engines are able to generate a hash of the MPLS label\n   stack and use this\
    \ mechanism to balance MPLS flows over ECMPs.\n   This document describes a method\
    \ of identifying the flows, or flow\n   groups, within pseudowires such that Label\
    \ Switching Routers can\n   balance flows at a finer granularity than individual\
    \ pseudowires.\n   The mechanism uses an additional label in the MPLS label stack.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This\
    \ document is a product of the Internet Engineering Task Force\n   (IETF).  It\
    \ represents the consensus of the IETF community.  It has\n   received public\
    \ review and has been approved for publication by the\n   Internet Engineering\
    \ Steering Group (IESG).  Further information on\n   Internet Standards is available\
    \ in Section 2 of RFC 5741.\n   Information about the current status of this document,\
    \ any errata,\n   and how to provide feedback on it may be obtained at\n   http://www.rfc-editor.org/info/rfc6391.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2011 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (http://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.  Code Components\
    \ extracted from this document must\n   include Simplified BSD License text as\
    \ described in Section 4.e of\n   the Trust Legal Provisions and are provided\
    \ without warranty as\n   described in the Simplified BSD License.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1. Introduction ....................................................3\n\
    \      1.1. Requirements Language ......................................4\n  \
    \    1.2. ECMP in Label Switching Routers ............................4\n    \
    \  1.3. Flow Label .................................................4\n   2. Native\
    \ Service Processing Function ..............................5\n   3. Pseudowire\
    \ Forwarder ............................................6\n      3.1. Encapsulation\
    \ ..............................................7\n   4. Signalling the Presence\
    \ of the Flow Label .......................8\n      4.1. Structure of Flow Label\
    \ Sub-TLV ............................9\n   5. Static Pseudowires ..............................................9\n\
    \   6. Multi-Segment Pseudowires .......................................9\n  \
    \ 7. Operations, Administration, and Maintenance (OAM) ..............10\n   8.\
    \ Applicability of PWs Using Flow Labels .........................11\n      8.1.\
    \ Equal Cost Multiple Paths .................................12\n      8.2. Link\
    \ Aggregation Groups ...................................13\n      8.3. Multiple\
    \ RSVP-TE Paths ....................................13\n      8.4. The Single\
    \ Large Flow Case ................................14\n      8.5. Applicability\
    \ to MPLS-TP ..................................15\n      8.6. Asymmetric Operation\
    \ ......................................15\n   9. Applicability to MPLS LSPs .....................................15\n\
    \   10. Security Considerations .......................................16\n  \
    \ 11. IANA Considerations ...........................................16\n   12.\
    \ Congestion Considerations .....................................16\n   13. Acknowledgements\
    \ ..............................................17\n   14. References ....................................................17\n\
    \      14.1. Normative References .....................................17\n  \
    \    14.2. Informative References ...................................18\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   A pseudowire (PW) [RFC3985] is normally transported over\
    \ one single\n   network path, even if multiple Equal Cost Multiple Paths (ECMPs)\n\
    \   exist between the ingress and egress PW provider edge (PE) equipment\n   [RFC4385]\
    \ [RFC4928].  This is required to preserve the\n   characteristics of the emulated\
    \ service (e.g., to avoid misordering\n   Structure-Agnostic Time Division Multiplexing\
    \ over Packet (SAToP) PW\n   packets [RFC4553] or subjecting the packets to unusable\
    \ inter-arrival\n   times).  The use of a single path to preserve order remains\
    \ the\n   default mode of operation of a PW.  The new capability proposed in\n\
    \   this document is an OPTIONAL mode that may be used when the use of\n   ECMPs\
    \ is known to be beneficial (and not harmful) to the operation of\n   the PW.\n\
    \   Some PWs are used to transport large volumes of IP traffic between\n   routers.\
    \  One example of this is the use of an Ethernet PW to create\n   a virtual direct\
    \ link between a pair of routers.  Such PWs may carry\n   from hundreds of Mbps\
    \ to Gbps of traffic.  These PWs only require\n   packet ordering to be preserved\
    \ within the context of each individual\n   transported IP flow.  They do not\
    \ require packet ordering to be\n   preserved between all packets of all IP flows\
    \ within the pseudowire.\n   The ability to explicitly configure such a PW to\
    \ leverage the\n   availability of multiple ECMPs allows for better capacity planning,\n\
    \   as the statistical multiplexing of a larger number of smaller flows\n   is\
    \ more efficient than with a smaller set of larger flows.\n   Typically, forwarding\
    \ hardware can deduce that an IP payload is being\n   directly carried by an MPLS\
    \ label stack, and it is capable of looking\n   at some fields in packets to construct\
    \ hash buckets for conversations\n   or flows.  However, when the MPLS payload\
    \ is a PW, an intermediate\n   node has no information on the type of PW being\
    \ carried in the\n   packet.  This limits the forwarder at the intermediate node\
    \ to only\n   being able to make an ECMP choice based on a hash of the MPLS label\n\
    \   stack.  In the case of a PW emulating a high-bandwidth trunk, the\n   granularity\
    \ obtained by hashing the label stack is inadequate for\n   satisfactory load\
    \ balancing.  The ingress node, however, is in the\n   special position of being\
    \ able to understand the unencapsulated\n   packet header to assist with spreading\
    \ flows among any available\n   ECMPs, or even any Loop-Free Alternates [RFC5286].\
    \  This document\n   defines a method to introduce granularity on the hashing\
    \ of traffic\n   running over PWs by introducing an additional label, chosen by\
    \ the\n   ingress node, and placed at the bottom of the label stack.\n   In addition\
    \ to providing an indication of the flow structure for use\n   in ECMP forwarding\
    \ decisions, the mechanism described in the document\n   may also be used to select\
    \ flows for distribution over an IEEE\n   802.1AX-2008 (originally specified as\
    \ IEEE 802.3ad-2000) Link\n   Aggregation Group (LAG) that has been used in an\
    \ MPLS network.\n   NOTE: Although Ethernet is frequently referenced as a use\
    \ case in\n   this RFC, the mechanisms described in this document are general\n\
    \   mechanisms that may be applied to any PW type in which there are\n   identifiable\
    \ flows, and in which there is no requirement to preserve\n   the order between\
    \ those flows.\n"
- title: 1.1.  Requirements Language
  contents:
  - "1.1.  Requirements Language\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\"\
    , \"SHALL\", \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"\
    MAY\", and \"OPTIONAL\" in this\n   document are to be interpreted as described\
    \ in RFC 2119 [RFC2119].\n"
- title: 1.2.  ECMP in Label Switching Routers
  contents:
  - "1.2.  ECMP in Label Switching Routers\n   Label Switching Routers (LSRs) commonly\
    \ generate a hash of the label\n   stack or some elements of the label stack as\
    \ a method of\n   discriminating between flows and use this to distribute those\
    \ flows\n   over the available ECMPs that exist in the network.  Since the label\n\
    \   at the bottom of the stack is usually the label most closely\n   associated\
    \ with the flow, this normally provides the greatest\n   entropy, and hence is\
    \ usually included in the hash.  This document\n   describes a method of adding\
    \ an additional Label Stack Entry (LSE) at\n   the bottom of the stack in order\
    \ to facilitate the load balancing of\n   the flows within a PW over the available\
    \ ECMPs.  A similar design for\n   general MPLS use has also been proposed [MPLS-ENTROPY];\
    \ see Section 9\n   of this document.\n   An alternative method of load balancing\
    \ by creating a number of PWs\n   and distributing the flows amongst them was\
    \ considered, but was\n   rejected because:\n   o  It did not introduce as much\
    \ entropy as can be introduced by\n      adding an additional LSE.\n   o  It required\
    \ additional PWs to be set up and maintained.\n"
- title: 1.3.  Flow Label
  contents:
  - "1.3.  Flow Label\n   An additional LSE [RFC3032] is interposed between the PW\
    \ LSE and the\n   control word, or if the control word is not present, between\
    \ the PW\n   LSE and the PW payload.  This additional LSE is called the flow LSE,\n\
    \   and the label carried by the flow LSE is called the flow label.\n   Indivisible\
    \ flows within the PW MUST be mapped to the same flow label\n   by the ingress\
    \ PE.  The flow label stimulates the correct ECMP load-\n   balancing behaviour\
    \ in the packet switched network (PSN).  On receipt\n   of the PW packet at the\
    \ egress PE (which knows a flow LSE is\n   present), the flow LSE is discarded\
    \ without processing.\n   Note that the flow label MUST NOT be an MPLS reserved\
    \ label (values\n   in the range 0..15) [RFC3032], but is otherwise unconstrained\
    \ by the\n   protocol.\n   It is useful to give consideration to the choice of\
    \ Time to Live\n   (TTL) value in the flow LSE [RFC3032].  The flow LSE is at\
    \ the bottom\n   of the label stack; therefore, even when penultimate hop popping\
    \ is\n   employed, it will always be preceded by the PW label on arrival at\n\
    \   the PE.  If, due to an error condition, the flow LSE becomes the top\n   of\
    \ the stack, it might be examined as if it were a normal LSE, and\n   the packet\
    \ might then be forwarded.  This can be prevented by setting\n   the flow LSE\
    \ TTL to 1, thereby forcing the packet to be discarded by\n   the forwarder. \
    \ Note that setting the TTL to 1 regardless of the\n   payload may be considered\
    \ a departure from the TTL procedures defined\n   in [RFC3032] that apply to the\
    \ general MPLS case.\n   This document does not define a use for the Traffic Class\
    \ (TC) field\n   [RFC5462] (formerly known as the Experimental Use (EXP) bits\n\
    \   [RFC3032]) in the flow label.  Future documents may define a use for\n   these\
    \ bits; therefore, implementations conforming to this\n   specification MUST set\
    \ the TC field to zero at the ingress and MUST\n   ignore them at the egress.\n"
- title: 2.  Native Service Processing Function
  contents:
  - "2.  Native Service Processing Function\n   The Native Service Processing (NSP)\
    \ function [RFC3985] is a component\n   of a PE that has knowledge of the structure\
    \ of the emulated service\n   and is able to take action on the service outside\
    \ the scope of the\n   PW.  In this case, it is REQUIRED that the NSP in the ingress\
    \ PE\n   identify flows, or groups of flows within the service, and indicate\n\
    \   the flow (group) identity of each packet as it is passed to the\n   pseudowire\
    \ forwarder.  As an example, where the PW type is an\n   Ethernet, the NSP might\
    \ parse the ingress Ethernet traffic and\n   consider all of the IP traffic. \
    \ This traffic could then be\n   categorised into flows by considering all traffic\
    \ with the same\n   source and destination address pair to be a single indivisible\
    \ flow.\n   Since this is an NSP function, by definition, the method used to\n\
    \   identify a flow is outside the scope of the PW design.  Similarly,\n   since\
    \ the NSP is internal to the PE, the method of flow indication to\n   the PW forwarder\
    \ is outside the scope of this document.\n"
- title: 3.  Pseudowire Forwarder
  contents:
  - "3.  Pseudowire Forwarder\n   The PW forwarder must be provided with a method\
    \ of mapping flows to\n   load-balanced paths.\n   The forwarder must generate\
    \ a label for the flow or group of flows.\n   How the flow label values are determined\
    \ is outside the scope of this\n   document; however, the flow label allocated\
    \ to a flow MUST NOT be an\n   MPLS reserved label and SHOULD remain constant\
    \ for the life of the\n   flow.  It is RECOMMENDED that the method chosen to generate\
    \ the load-\n   balancing labels introduce a high degree of entropy in their values,\n\
    \   to maximise the entropy presented to the ECMP selection mechanism in\n   the\
    \ LSRs in the PSN, and hence distribute the flows as evenly as\n   possible over\
    \ the available PSN ECMP.  The forwarder at the ingress\n   PE prepends the PW\
    \ control word (if applicable), and then pushes the\n   flow label, followed by\
    \ the PW label.\n   NOTE: Although this document does not attempt to specify any\
    \ hash\n   algorithms, it is suggested that any such algorithm should be based\n\
    \   on the assumption that there will be a high degree of entropy in the\n   values\
    \ assigned to the flow labels.\n   The forwarder at the egress PE uses the pseudowire\
    \ label to identify\n   the pseudowire.  From the context associated with the\
    \ pseudowire\n   label, the egress PE can determine whether a flow LSE is present.\
    \  If\n   a flow LSE is present, it MUST be checked to determine whether it\n\
    \   carries a reserved label.  If it is a reserved label, the packet is\n   processed\
    \ according to the rules associated with that reserved label;\n   otherwise, the\
    \ LSE is discarded.\n   All other PW forwarding operations are unmodified by the\
    \ inclusion of\n   the flow LSE.\n"
- title: 3.1.  Encapsulation
  contents:
  - "3.1.  Encapsulation\n   The PWE3 Protocol Stack Reference Model modified to include\
    \ flow LSE\n   is shown in Figure 1.\n      +-------------+                  \
    \              +-------------+\n      |  Emulated   |                        \
    \        |  Emulated   |\n      |  Ethernet   |                              \
    \  |  Ethernet   |\n      | (including  |         Emulated Service       | (including\
    \  |\n      |  VLAN)      |<==============================>|  VLAN)      |\n \
    \     |  Services   |                                |  Services   |\n      +-------------+\
    \                                +-------------+\n      |    Flow     |      \
    \                          |    Flow     |\n      +-------------+            Pseudowire\
    \          +-------------+\n      |Demultiplexer|<==============================>|Demultiplexer|\n\
    \      +-------------+                                +-------------+\n      |\
    \    PSN      |            PSN Tunnel          |    PSN      |\n      |   MPLS\
    \      |<==============================>|   MPLS      |\n      +-------------+\
    \                                +-------------+\n      |  Physical   |      \
    \                          |  Physical   |\n      +-----+-------+            \
    \                    +-----+-------+\n               Figure 1: PWE3 Protocol Stack\
    \ Reference Model\n   The encapsulation of a PW with a flow LSE is shown in Figure\
    \ 2.\n       +---------------------------+\n       |                         \
    \  |\n       |  Payload                  |\n       |                         \
    \  |  n octets\n       |                           |\n       +---------------------------+\n\
    \       |  Optional Control Word    |  4 octets\n       +---------------------------+\n\
    \       |  Flow LSE                 |  4 octets\n       +---------------------------+\n\
    \       |  PW LSE                   |  4 octets\n       +---------------------------+\n\
    \       |  MPLS Tunnel LSE (s)      |  n*4 octets (four octets per LSE)\n    \
    \   +---------------------------+\n    Figure 2: Encapsulation of a Pseudowire\
    \ with a Pseudowire Flow LSE\n"
- title: 4.  Signalling the Presence of the Flow Label
  contents:
  - "4.  Signalling the Presence of the Flow Label\n   When using the signalling procedures\
    \ in [RFC4447], a new Pseudowire\n   Interface Parameter Sub-TLV, the Flow Label\
    \ Sub-TLV (FL Sub-TLV), is\n   used to synchronise the flow label states between\
    \ the ingress and\n   egress PEs.\n   The absence of an FL Sub-TLV indicates that\
    \ the PE is unable to\n   process flow labels.  An ingress PE that is using PW\
    \ signalling and\n   that does not send an FL Sub-TLV MUST NOT include a flow\
    \ label in the\n   PW packet.  An ingress PE that is using PW signalling and that\
    \ does\n   not receive an FL Sub-TLV from its egress peer MUST NOT include a\n\
    \   flow label in the PW packet.  This preserves backwards compatibility\n   with\
    \ existing PW specifications.\n   A PE that wishes to send a flow label in a PW\
    \ packet MUST include in\n   its label mapping message an FL Sub-TLV with T =\
    \ 1 (see Section 4.1).\n   A PE that is willing to receive a flow label MUST include\
    \ in its\n   label mapping message an FL Sub-TLV with R = 1 (see Section 4.1).\n\
    \   A PE that receives a label mapping message containing an FL Sub-TLV\n   with\
    \ R = 0 MUST NOT include a flow label in the PW packet.\n   Thus, a PE sending\
    \ an FL Sub-TLV with T = 1 and receiving an FL\n   Sub-TLV with R = 1 MUST include\
    \ a flow label in the PW packet.  Under\n   all other combinations of FL Sub-TLV\
    \ signalling, a PE MUST NOT\n   include a flow label in the PW packet.\n   The\
    \ signalling procedures in [RFC4447] state that \"Processing of the\n   interface\
    \ parameters should continue when unknown interface\n   parameters are encountered,\
    \ and they MUST be silently ignored\".  The\n   signalling procedure described\
    \ here is therefore backwards compatible\n   with existing implementations.\n\
    \   Note that what is signalled is the desire to include the flow LSE in\n   the\
    \ label stack.  The value of the flow label is a local matter for\n   the ingress\
    \ PE, and the label value itself is not signalled.\n"
- title: 4.1.  Structure of Flow Label Sub-TLV
  contents:
  - "4.1.  Structure of Flow Label Sub-TLV\n   The structure of the Flow Label Sub-TLV\
    \ is shown in Figure 3.\n    0                   1                   2       \
    \            3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8\
    \ 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   | FL=0x17       |    Length     |T|R|      Reserved             |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \                       Figure 3: Flow Label Sub-TLV\n   Where:\n   o  FL (value\
    \ 0x17) is the Flow Label Sub-TLV identifier assigned by\n      IANA (see Section\
    \ 11).\n   o  Length is the length of the Sub-TLV in octets and is 4.\n   o  When\
    \ T = 1, the PE is requesting the ability to send a PW packet\n      that includes\
    \ a flow label.  When T = 0, the PE is indicating that\n      it will not send\
    \ a PW packet containing a flow label.\n   o  When R = 1, the PE is able to receive\
    \ a PW packet with a flow\n      label present.  When R = 0, the PE is unable\
    \ to receive a PW\n      packet with the flow label present.\n   o  Reserved bits\
    \ MUST be zero on transmit and MUST be ignored on\n      receive.\n"
- title: 5.  Static Pseudowires
  contents:
  - "5.  Static Pseudowires\n   If PWE3 signalling [RFC4447] is not in use for a PW,\
    \ then whether the\n   flow label is used MUST be identically provisioned in both\
    \ PEs at the\n   PW endpoints.  If there is no provisioning support for this option,\n\
    \   the default behaviour is not to include the flow label.\n"
- title: 6.  Multi-Segment Pseudowires
  contents:
  - "6.  Multi-Segment Pseudowires\n   The flow label mechanism described in this\
    \ document works on\n   multi-segment PWs without requiring modification to the\
    \ Switching PEs\n   (S-PEs).  This is because the flow LSE is transparent to the\
    \ label\n   swap operation, and because interface parameter Sub-TLV signalling\
    \ is\n   transitive.\n"
- title: 7.  Operations, Administration, and Maintenance (OAM)
  contents:
  - "7.  Operations, Administration, and Maintenance (OAM)\n   The following OAM considerations\
    \ apply to this method of load\n   balancing.\n   Where the OAM is only to be\
    \ used to perform a basic test to verify\n   that the PWs have been configured\
    \ at the PEs, Virtual Circuit\n   Connectivity Verification (VCCV) [RFC5085] messages\
    \ may be sent using\n   any load balance PW path, i.e., using any value for the\
    \ flow label.\n   Where it is required to verify that a pseudowire is fully functional\n\
    \   for all flows, a VCCV [RFC5085] connectivity verification message\n   MUST\
    \ be sent over each ECMP path to the pseudowire egress PE.  This\n   solution\
    \ may be difficult to achieve and scales poorly.  Under these\n   circumstances,\
    \ it may be sufficient to send VCCV messages using any\n   load balance pseudowire\
    \ path, because if a failure occurs within the\n   PSN, the failure will normally\
    \ be detected and repaired by the PSN.\n   That is, the PSN's Interior Gateway\
    \ Protocol (IGP) link/node failure\n   detection mechanism (loss of light, bidirectional\
    \ forwarding\n   detection [RFC5880], or IGP hello detection) and the IGP convergence\n\
    \   will naturally modify the ECMP set of network paths between the\n   ingress\
    \ and egress PEs.  Hence, the PW is only impacted during the\n   normal IGP convergence\
    \ time.  Note that this period may be reduced if\n   a fast re-route or fast convergence\
    \ technology is deployed in the\n   network [RFC4090] [RFC5286].\n   If the failure\
    \ is related to the individual corruption of a Label\n   Forwarding Information\
    \ Base (LFIB) entry in a router, then only the\n   network path using that specific\
    \ entry is impacted.  If the PW is\n   load-balanced over multiple network paths,\
    \ then this failure can only\n   be detected if, by chance, the transported OAM\
    \ flow is mapped onto\n   the impacted network path, or if all paths are tested.\
    \  Since testing\n   all paths may present problems as noted above, other mechanisms\
    \ to\n   detect this type of error may need to be developed, such as a Label\n\
    \   Switched Path (LSP) self-test technology.\n   To troubleshoot the MPLS PSN,\
    \ including multiple paths, the\n   techniques described in [RFC4378] and [RFC4379]\
    \ can be used.\n   Where the PW OAM is carried out of band (VCCV Type 2) [RFC5085],\
    \ it\n   is necessary to insert an \"MPLS Router Alert Label\" in the label\n\
    \   stack.  The resultant label stack is as follows:\n   +-------------------------------+\n\
    \   |                               |\n   |      VCCV Message             |  n\
    \ octets\n   |                               |\n   +-------------------------------+\n\
    \   |   Optional Control Word       |  4 octets\n   +-------------------------------+\n\
    \   |      Flow LSE                 |  4 octets\n   +-------------------------------+\n\
    \   |      PW LSE                   |  4 octets\n   +-------------------------------+\n\
    \   |      Router Alert LSE         |  4 octets\n   +-------------------------------+\n\
    \   |      MPLS Tunnel LSE(s)       |  n*4 octets (four octets per label)\n  \
    \ +-------------------------------+\n                    Figure 4: Use of Router\
    \ Alert Label\n   Note that, depending on the number of labels hashed by the LSR,\
    \ the\n   inclusion of the Router Alert label may cause the OAM packet to be\n\
    \   load-balanced to a different path from that taken by the data packets\n  \
    \ with identical flow and PW labels.\n"
- title: 8.  Applicability of PWs Using Flow Labels
  contents:
  - "8.  Applicability of PWs Using Flow Labels\n   A node within the PSN is not able\
    \ to perform deep packet inspection\n   (DPI) of the PW, as the PW technology\
    \ is not self-describing: the\n   structure of the PW payload is only known to\
    \ the ingress and egress\n   PE devices.  The method proposed in this document\
    \ provides a\n   statistical mitigation of the problem of load balance in those\
    \ cases\n   where a PE is able to discern flows embedded in the traffic received\n\
    \   on the attachment circuit.\n   The methods described in this document are\
    \ transparent to the PSN and\n   as such do not require any new capability from\
    \ the PSN.\n   The requirement to load-balance over multiple PSN paths occurs\
    \ when\n   the ratio between the PW access speed and the PSN's core link\n   bandwidth\
    \ is large (e.g., >= 10%).  ATM and Frame Relay are unlikely\n   to meet this\
    \ property.  Ethernet may have this property, and for that\n   reason this document\
    \ focuses on Ethernet.  Applications for other\n   high-access-bandwidth PWs may\
    \ be defined in the future.\n   This design applies to MPLS PWs where it is meaningful\
    \ to\n   de-construct the packets presented to the ingress PE into flows.  The\n\
    \   mechanism described in this document promotes the distribution of\n   flows\
    \ within the PW over different network paths.  In turn, this\n   means that whilst\
    \ packets within a flow are delivered in order\n   (subject to normal IP delivery\
    \ perturbations due to topology\n   variation), order is no longer maintained\
    \ for all packets sent over\n   the PW.  It is not proposed to associate a different\
    \ sequence number\n   with each flow.  If sequence number support is required,\
    \ the flow\n   label mechanism MUST NOT be used.\n   Where it is known that the\
    \ traffic carried by the Ethernet PW is IP,\n   the flows can be identified and\
    \ mapped to an ECMP.  Such methods\n   typically include hashing on the source\
    \ and destination addresses,\n   the protocol ID and higher-layer flow-dependent\
    \ fields such as\n   TCP/UDP ports, Layer 2 Tunneling Protocol version 3 (L2TPv3)\
    \ Session\n   IDs, etc.\n   Where it is known that the traffic carried by the\
    \ Ethernet PW is\n   non-IP, techniques used for link bundling between Ethernet\
    \ switches\n   may be reused.  In this case, however, the latency distribution\
    \ would\n   be larger than is found in the link bundle case.  The acceptability\n\
    \   of the increased latency is for further study.  Of particular\n   importance,\
    \ the Ethernet control frames SHOULD always be mapped to\n   the same PSN path\
    \ to ensure in-order delivery.\n"
- title: 8.1.  Equal Cost Multiple Paths
  contents:
  - "8.1.  Equal Cost Multiple Paths\n   ECMP in packet switched networks is statistical\
    \ in nature.  The\n   mapping of flows to a particular path does not take into\
    \ account the\n   bandwidth of the flow being mapped or the current bandwidth\
    \ usage of\n   the members of the ECMP set.  This simplification works well when\
    \ the\n   distribution of flows is evenly spread over the ECMP set and there\n\
    \   are a large number of flows that have low bandwidth relative to the\n   paths.\
    \  The random allocation of a flow to a path provides a good\n   approximation\
    \ to an even spread of flows, provided that polarisation\n   effects are avoided.\
    \  The method defined in this document has the\n   same statistical properties\
    \ as an IP PSN.\n   ECMP is a load-sharing mechanism that is based on sharing\
    \ the load\n   over a number of layer 3 paths through the PSN.  Often, however,\n\
    \   multiple links exist between a pair of LSRs that are considered by\n   the\
    \ IGP to be a single link.  These are known as link bundles.  The\n   mechanism\
    \ described in this document can also be used to distribute\n   the flows within\
    \ a PW over the members of the link bundle by using\n   the flow label value to\
    \ identify candidate flows.  How that mapping\n   takes place is outside the scope\
    \ of this specification.  Similar\n   considerations apply to Link Aggregation\
    \ Groups.\n   There is no mechanism currently defined to indicate the bandwidths\
    \ in\n   use by specific flows using the fields of the MPLS shim header.\n   Furthermore,\
    \ since the semantics of the MPLS shim header are fully\n   defined in [RFC3032]\
    \ and [RFC5462], those fields cannot be assigned\n   semantics to carry this information.\
    \  This document does not define\n   any semantic for use in the TTL or TC fields\
    \ of the label entry that\n   carries the flow label, but requires that the flow\
    \ label itself be\n   selected with a high degree of entropy suggesting that the\
    \ label\n   value should not be overloaded with additional meaning in any\n  \
    \ subsequent specification.\n   A different type of load balancing is the desire\
    \ to carry a PW over a\n   set of PSN links in which the bandwidth of members\
    \ of the link set is\n   less than the bandwidth of the PW.  Proposals to address\
    \ this problem\n   have been made in the past [PWBONDING].  Such a mechanism can\
    \ be\n   considered complementary to this mechanism.\n"
- title: 8.2.  Link Aggregation Groups
  contents:
  - "8.2.  Link Aggregation Groups\n   A Link Aggregation Group (LAG) is used to bond\
    \ together several\n   physical circuits between two adjacent nodes so they appear\
    \ to\n   higher-layer protocols as a single, higher-bandwidth \"virtual\" pipe.\n\
    \   These may coexist in various parts of a given network.  An advantage\n   of\
    \ LAGs is that they reduce the number of routing and signalling\n   protocol adjacencies\
    \ between devices, reducing control plane\n   processing overhead.  As with ECMP,\
    \ the key problem related to LAGs\n   is that due to inefficiencies in LAG load-distribution\
    \ algorithms, a\n   particular component of a LAG may experience congestion. \
    \ The\n   mechanism proposed here may be able to assist in producing a more\n\
    \   uniform flow distribution.\n   The same considerations requiring a flow to\
    \ go over a single member\n   of an ECMP set apply to a member of a LAG.\n"
- title: 8.3.  Multiple RSVP-TE Paths
  contents:
  - "8.3.  Multiple RSVP-TE Paths\n   In some networks, it is desirable for a Label\
    \ Edge Router (LER) to be\n   able to load-balance a PW across multiple Resource\
    \ Reservation\n   Protocol - Traffic Engineering (RSVP-TE) tunnels.  The flow\
    \ label\n   mechanism described in this document may be used to provide the LER\n\
    \   with the required flow information and necessary entropy to provide\n   this\
    \ type of load balancing.  An example of such a case is the use of\n   the flow\
    \ label mechanism in networks using a link bundle with the all\n   ones component\
    \ [RFC4201].\n   Methods by which the LER is configured to apply this type of\
    \ ECMP are\n   outside the scope of this document.\n"
- title: 8.4.  The Single Large Flow Case
  contents:
  - "8.4.  The Single Large Flow Case\n   Clearly, the operator should make sure that\
    \ the service offered using\n   PW technology and the method described in this\
    \ document do not exceed\n   the maximum planned link capacity, unless it can\
    \ be guaranteed that\n   they conform to the Internet traffic profile of a very\
    \ large number\n   of small flows.\n   If the NSP cannot access sufficient information\
    \ to distinguish flows,\n   perhaps because the protocol stack required parsing\
    \ further into the\n   packet than it is able, then the functionality described\
    \ in this\n   document does not give any benefits.  The most common case where\
    \ a\n   single flow dominates the traffic on a PW is when it is used to\n   transport\
    \ enterprise traffic.  Enterprise traffic may well consist of\n   a single, large\
    \ TCP flow, or encrypted flows that cannot be handled\n   by the methods described\
    \ in this document.\n   An operator has four options under these circumstances:\n\
    \   1.  The operator can choose to do nothing, and the system will work\n    \
    \   as it does without the flow label.\n   2.  The operator can make the customer\
    \ aware that the service\n       offering has a restriction on flow bandwidth\
    \ and police flows to\n       that restriction.  This would allow customers offering\
    \ multiple\n       flows to use a larger fraction of their access bandwidth, whilst\n\
    \       preventing a single flow from consuming a fraction of internal\n     \
    \  link bandwidth that the operator considered excessive.\n   3.  The operator\
    \ could configure the ingress PE to assign a constant\n       flow label to all\
    \ high-bandwidth flows so that only one path was\n       affected by these flows.\n\
    \   4.  The operator could configure the ingress PE to assign a random\n     \
    \  flow label to all high-bandwidth flows so as to minimise the\n       disruption\
    \ to the network at the cost of out-of-order traffic to\n       the user.\n  \
    \ The issues described above are mitigated by the following two\n   factors:\n\
    \   o  Firstly, the customer of a high-bandwidth PW service has an\n      incentive\
    \ to get the best transport service, because an\n      inefficient use of the\
    \ PSN leads to jitter and eventually to loss\n      to the PW's payload.\n   o\
    \  Secondly, the customer is usually able to tailor their\n      applications\
    \ to generate many flows in the PSN.  A well-known\n      example is massive data\
    \ transport between servers that use many\n      parallel TCP sessions.  This\
    \ same technique can be used by any\n      transport protocol: multiple UDP ports,\
    \ multiple L2TPv3 Session\n      IDs, or multiple Generic Routing Encapsulation\
    \ (GRE) keys may be\n      used to decompose a large flow into smaller components.\
    \  This\n      approach may be applied to IPsec [RFC4301] where multiple Security\n\
    \      Parameter Indexes (SPIs) may be allocated to the same security\n      association.\n"
- title: 8.5.  Applicability to MPLS-TP
  contents:
  - "8.5.  Applicability to MPLS-TP\n   The MPLS Transport Profile (MPLS-TP) [RFC5654]\
    \ Requirement 44 states\n   that \"MPLS-TP MUST support mechanisms that ensure\
    \ the integrity of\n   the transported customer's service traffic as required\
    \ by its\n   associated Service Level Agreement (SLA).  Loss of integrity may\
    \ be\n   defined as packet corruption, reordering, or loss during normal\n   network\
    \ conditions\".  In addition, MPLS-TP makes extensive use of the\n   fate sharing\
    \ between OAM and data packets, which is defeated by the\n   flow LSE.  The flow-aware\
    \ transport of a PW reorders packets and\n   therefore MUST NOT be deployed in\
    \ a network conforming to MPLS-TP,\n   unless these integrity requirements specified\
    \ in the SLA can be\n   satisfied.\n"
- title: 8.6.  Asymmetric Operation
  contents:
  - "8.6.  Asymmetric Operation\n   The protocol defined in this document supports\
    \ the asymmetric\n   inclusion of the flow LSE.  Asymmetric operation can be expected\
    \ when\n   there is asymmetry in the bandwidth requirements making it\n   unprofitable\
    \ for one PE to perform the flow classification, or when\n   that PE is otherwise\
    \ unable to perform the classification but is able\n   to receive flow labeled\
    \ packets from its peer.  Asymmetric operation\n   of the PW may also be required\
    \ when one PE has a high transmission\n   bandwidth requirement, but has a need\
    \ to receive the entire PW on a\n   single interface in order to perform a processing\
    \ operation that\n   requires the context of the complete PW (for example, policing\
    \ of the\n   egress traffic).\n"
- title: 9.  Applicability to MPLS LSPs
  contents:
  - "9.  Applicability to MPLS LSPs\n   An extension of this technique is to create\
    \ a basis for hash\n   diversity without having to peek below the label stack\
    \ for IP traffic\n   carried over Label Distribution Protocol (LDP) LSPs.  The\n\
    \   generalisation of this extension to MPLS has been described in\n   [MPLS-ENTROPY].\
    \  This generalisation can be regarded as a\n   complementary, but distinct, approach\
    \ from the technique described in\n   this document.  While similar consideration\
    \ may apply to the\n   identification of flows and the allocation of flow label\
    \ values, the\n   flow labels are imposed by different network components, and\
    \ the\n   associated signalling mechanisms are different.\n"
- title: 10.  Security Considerations
  contents:
  - "10.  Security Considerations\n   The PW generic security considerations described\
    \ in [RFC3985] and the\n   security considerations applicable to a specific PW\
    \ type (for\n   example, in the case of an Ethernet PW [RFC4448]) apply.  The\n\
    \   security considerations in [RFC5920] also apply.\n   Section 1.3 describes\
    \ considerations that apply to the TTL value used\n   in the flow LSE.  The use\
    \ of a TTL value of one prevents the\n   accidental forwarding of a packet based\
    \ on the label value in the\n   flow LSE.\n"
- title: 11.  IANA Considerations
  contents:
  - "11.  IANA Considerations\n   IANA maintains the registry \"Pseudowire Name Spaces\
    \ (PWE3)\" with\n   sub-registry \"Pseudowire Interface Parameters Sub-TLV type\
    \ Registry\".\n   IANA has registered the Flow Label Sub-TLV type in this registry.\n\
    \      Parameter     ID Length     Description      Reference\n      ------------------------------------------------------\n\
    \      0x17             4           Flow Label       RFC 6391\n"
- title: 12.  Congestion Considerations
  contents:
  - "12.  Congestion Considerations\n   The congestion considerations applicable to\
    \ PWs as described in\n   [RFC3985] apply to this design.\n   The ability to explicitly\
    \ configure a PW to leverage the availability\n   of multiple ECMPs is beneficial\
    \ to capacity planning as, all other\n   parameters being constant, the statistical\
    \ multiplexing of a larger\n   number of smaller flows is more efficient than\
    \ with a smaller number\n   of larger flows.\n   Note that if the classification\
    \ into flows is only performed on IP\n   packets, the behaviour of those flows\
    \ in the face of congestion will\n   be as already defined by the IETF for packets\
    \ of that type, and no\n   additional congestion processing is required.\n   Where\
    \ flows that are not IP are classified, PW congestion avoidance\n   must be applied\
    \ to each non-IP load balance group.\n"
- title: 13.  Acknowledgements
  contents:
  - "13.  Acknowledgements\n   The authors wish to thank Mary Barnes, Eric Grey, Kireeti\
    \ Kompella,\n   Joerg Kuechemann, Wilfried Maas, Luca Martini, Mark Townsley,\
    \ Rolf\n   Winter, and Lucy Yong for valuable comments on this document.\n"
- title: 14.  References
  contents:
  - '14.  References

    '
- title: 14.1.  Normative References
  contents:
  - "14.1.  Normative References\n   [RFC2119]   Bradner, S., \"Key words for use\
    \ in RFCs to Indicate\n               Requirement Levels\", BCP 14, RFC 2119,\
    \ March 1997.\n   [RFC3032]   Rosen, E., Tappan, D., Fedorkow, G., Rekhter, Y.,\n\
    \               Farinacci, D., Li, T., and A. Conta, \"MPLS Label Stack\n    \
    \           Encoding\", RFC 3032, January 2001.\n   [RFC4379]   Kompella, K. and\
    \ G. Swallow, \"Detecting Multi-Protocol\n               Label Switched (MPLS)\
    \ Data Plane Failures\", RFC 4379,\n               February 2006.\n   [RFC4385]\
    \   Bryant, S., Swallow, G., Martini, L., and D. McPherson,\n               \"\
    Pseudowire Emulation Edge-to-Edge (PWE3) Control Word\n               for Use\
    \ over an MPLS PSN\", RFC 4385, February 2006.\n   [RFC4447]   Martini, L., Ed.,\
    \ Rosen, E., El-Aawar, N., Smith, T., and\n               G. Heron, \"Pseudowire\
    \ Setup and Maintenance Using the\n               Label Distribution Protocol\
    \ (LDP)\", RFC 4447, April 2006.\n   [RFC4448]   Martini, L., Ed., Rosen, E.,\
    \ El-Aawar, N., and G. Heron,\n               \"Encapsulation Methods for Transport\
    \ of Ethernet over\n               MPLS Networks\", RFC 4448, April 2006.\n  \
    \ [RFC4553]   Vainshtein, A., Ed., and YJ. Stein, Ed., \"Structure-\n        \
    \       Agnostic Time Division Multiplexing (TDM) over Packet\n              \
    \ (SAToP)\", RFC 4553, June 2006.\n   [RFC4928]   Swallow, G., Bryant, S., and\
    \ L. Andersson, \"Avoiding\n               Equal Cost Multipath Treatment in MPLS\
    \ Networks\",\n               BCP 128, RFC 4928, June 2007.\n   [RFC5085]   Nadeau,\
    \ T., Ed., and C. Pignataro, Ed., \"Pseudowire\n               Virtual Circuit\
    \ Connectivity Verification (VCCV): A\n               Control Channel for Pseudowires\"\
    , RFC 5085,\n               December 2007.\n"
- title: 14.2.  Informative References
  contents:
  - "14.2.  Informative References\n   [MPLS-ENTROPY]\n               Kompella, K.,\
    \ Drake, J., Amante, S., Henderickx, W., and\n               L. Yong, \"The Use\
    \ of Entropy Labels in MPLS Forwarding\",\n               Work in Progress, October\
    \ 2011.\n   [PWBONDING] Stein, Y(J)., Mendelsohn, I., and R. Insler, \"PW\n  \
    \             Bonding\", Work in Progress, November 2008.\n   [RFC3985]   Bryant,\
    \ S., Ed., and P. Pate, Ed., \"Pseudo Wire Emulation\n               Edge-to-Edge\
    \ (PWE3) Architecture\", RFC 3985, March 2005.\n   [RFC4090]   Pan, P., Ed., Swallow,\
    \ G., Ed., and A. Atlas, Ed., \"Fast\n               Reroute Extensions to RSVP-TE\
    \ for LSP Tunnels\", RFC 4090,\n               May 2005.\n   [RFC4201]   Kompella,\
    \ K., Rekhter, Y., and L. Berger, \"Link Bundling\n               in MPLS Traffic\
    \ Engineering (TE)\", RFC 4201,\n               October 2005.\n   [RFC4301]  \
    \ Kent, S. and K. Seo, \"Security Architecture for the\n               Internet\
    \ Protocol\", RFC 4301, December 2005.\n   [RFC4378]   Allan, D., Ed., and T.\
    \ Nadeau, Ed., \"A Framework for\n               Multi-Protocol Label Switching\
    \ (MPLS) Operations and\n               Management (OAM)\", RFC 4378, February\
    \ 2006.\n   [RFC5286]   Atlas, A., Ed., and A. Zinin, Ed., \"Basic Specification\n\
    \               for IP Fast Reroute: Loop-Free Alternates\", RFC 5286,\n     \
    \          September 2008.\n   [RFC5462]   Andersson, L. and R. Asati, \"Multiprotocol\
    \ Label\n               Switching (MPLS) Label Stack Entry: \"EXP\" Field Renamed\n\
    \               to \"Traffic Class\" Field\", RFC 5462, February 2009.\n   [RFC5654]\
    \   Niven-Jenkins, B., Ed., Brungard, D., Ed., Betts, M.,\n               Ed.,\
    \ Sprecher, N., and S. Ueno, \"Requirements of an MPLS\n               Transport\
    \ Profile\", RFC 5654, September 2009.\n   [RFC5880]   Katz, D. and D. Ward, \"\
    Bidirectional Forwarding Detection\n               (BFD)\", RFC 5880, June 2010.\n\
    \   [RFC5920]   Fang, L., Ed., \"Security Framework for MPLS and GMPLS\n     \
    \          Networks\", RFC 5920, July 2010.\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Stewart Bryant (editor)\n   Cisco Systems\n   250 Longwater\
    \ Ave.\n   Reading  RG2 6GB\n   United Kingdom\n   Phone: +44-208-824-8828\n \
    \  EMail: stbryant@cisco.com\n   Clarence Filsfils\n   Cisco Systems\n   Brussels\n\
    \   Belgium\n   EMail: cfilsfil@cisco.com\n   Ulrich Drafz\n   Deutsche Telekom\n\
    \   Muenster\n   Germany\n   EMail: Ulrich.Drafz@telekom.de\n   Vach Kompella\n\
    \   Alcatel-Lucent\n   EMail: vach.kompella@alcatel-lucent.com\n   Joe Regan\n\
    \   Alcatel-Lucent\n   EMail: joe.regan@alcatel-lucent.com\n   Shane Amante\n\
    \   Level 3 Communications, LLC\n   1025 Eldorado Blvd.\n   Broomfield, CO  80021\n\
    \   USA\n   EMail: shane@level3.net\n"
