- title: __initial_text__
  contents:
  - "         IPv6 Rapid Deployment on IPv4 Infrastructures (6rd) --\n           \
    \              Protocol Specification\n"
- title: Abstract
  contents:
  - "Abstract\n   This document specifies an automatic tunneling mechanism tailored\
    \ to\n   advance deployment of IPv6 to end users via a service provider's IPv4\n\
    \   network infrastructure.  Key aspects include automatic IPv6 prefix\n   delegation\
    \ to sites, stateless operation, simple provisioning, and\n   service, which is\
    \ equivalent to native IPv6 at the sites that are\n   served by the mechanism.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This\
    \ document is a product of the Internet Engineering Task Force\n   (IETF).  It\
    \ represents the consensus of the IETF community.  It has\n   received public\
    \ review and has been approved for publication by the\n   Internet Engineering\
    \ Steering Group (IESG).  Further information on\n   Internet Standards is available\
    \ in Section 2 of RFC 5741.\n   Information about the current status of this document,\
    \ any errata,\n   and how to provide feedback on it may be obtained at\n   http://www.rfc-editor.org/info/rfc5969.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2010 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (http://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.  Code Components\
    \ extracted from this document must\n   include Simplified BSD License text as\
    \ described in Section 4.e of\n   the Trust Legal Provisions and are provided\
    \ without warranty as\n   described in the Simplified BSD License.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1.  Introduction . . . . . . . . . . . . . . . . . . .\
    \ . . . . . .  2\n   2.  Requirements Language  . . . . . . . . . . . . . . .\
    \ . . . . .  4\n   3.  Terminology  . . . . . . . . . . . . . . . . . . . . .\
    \ . . . .  4\n   4.  6rd Prefix Delegation  . . . . . . . . . . . . . . . . .\
    \ . . .  5\n   5.  Troubleshooting and Traceability . . . . . . . . . . . . .\
    \ . .  7\n   6.  Address Selection  . . . . . . . . . . . . . . . . . . . . .\
    \ .  7\n   7.  6rd Configuration  . . . . . . . . . . . . . . . . . . . . . .\
    \  7\n     7.1.  Customer Edge Configuration  . . . . . . . . . . . . . . .  8\n\
    \       7.1.1.  6rd DHCPv4 Option  . . . . . . . . . . . . . . . . . .  9\n  \
    \   7.2.  Border Relay Configuration . . . . . . . . . . . . . . . . 10\n   8.\
    \  Neighbor Unreachability Detection  . . . . . . . . . . . . . . 11\n   9.  IPv6\
    \ in IPv4 Encapsulation . . . . . . . . . . . . . . . . . . 12\n     9.1.  Maximum\
    \ Transmission Unit  . . . . . . . . . . . . . . . . 13\n     9.2.  Receiving\
    \ Rules  . . . . . . . . . . . . . . . . . . . . . 13\n   10. Transition Considerations\
    \  . . . . . . . . . . . . . . . . . . 14\n   11. IPv6 Address Space Usage . .\
    \ . . . . . . . . . . . . . . . . . 14\n   12. Security Considerations  . . .\
    \ . . . . . . . . . . . . . . . . 15\n   13. IANA Considerations  . . . . . .\
    \ . . . . . . . . . . . . . . . 16\n   14. Acknowledgements . . . . . . . . .\
    \ . . . . . . . . . . . . . . 16\n   15. References . . . . . . . . . . . . .\
    \ . . . . . . . . . . . . . 16\n     15.1. Normative References . . . . . . .\
    \ . . . . . . . . . . . . 16\n     15.2. Informative References . . . . . . .\
    \ . . . . . . . . . . . 17\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   The original idea and the name of the mechanism (6rd) described\
    \ in\n   [RFC5569] details a successful commercial \"rapid deployment\" of the\n\
    \   6rd mechanism by a residential service provider and is recommended\n   reading.\
    \  This document describes the 6rd mechanism, which has been\n   extended for\
    \ use in more general environments.  Throughout this\n   document, the term 6to4\
    \ is used to refer to the mechanism described\n   in [RFC3056] and 6rd is the\
    \ mechanism defined herein.\n   6rd specifies a protocol mechanism to deploy IPv6\
    \ to sites via a\n   service provider's (SP's) IPv4 network.  It builds on 6to4\
    \ [RFC3056],\n   with the key differentiator that it utilizes an SP's own IPv6\
    \ address\n   prefix rather than a well-known prefix (2002::/16).  By using the\n\
    \   SP's IPv6 prefix, the operational domain of 6rd is limited to the SP\n   network\
    \ and is under its direct control.  From the perspective of\n   customer sites\
    \ and the IPv6 Internet at large, the IPv6 service\n   provided is equivalent\
    \ to native IPv6.\n   The 6rd mechanism relies upon an algorithmic mapping between\
    \ the IPv6\n   and IPv4 addresses that are assigned for use within the SP network.\n\
    \   This mapping allows for automatic determination of IPv4 tunnel\n   endpoints\
    \ from IPv6 prefixes, allowing stateless operation of 6rd.\n   6rd views the IPv4\
    \ network as a link layer for IPv6 and supports an\n   automatic tunneling abstraction\
    \ similar to the Non-Broadcast Multiple\n   Access (NBMA) [RFC2491] model.\n \
    \  A 6rd domain consists of 6rd Customer Edge (CE) routers and one or\n   more\
    \ 6rd Border Relays (BRs).  IPv6 packets encapsulated by 6rd\n   follow the IPv4\
    \ routing topology within the SP network among CEs and\n   BRs. 6rd BRs are traversed\
    \ only for IPv6 packets that are destined to\n   or are arriving from outside\
    \ the SP's 6rd domain.  As 6rd is\n   stateless, BRs may be reached using anycast\
    \ for failover and\n   resiliency (in a similar fashion to [RFC3068]).\n   On\
    \ the \"customer-facing\" (i.e., \"LAN\") side of a CE, IPv6 is\n   implemented\
    \ as it would be for any native IP service delivered by the\n   SP, and further\
    \ considerations for IPv6 operation on the LAN side of\n   the CE is out of scope\
    \ for this document.  On the \"SP-facing\" (i.e.,\n   \"WAN\") side of the 6rd\
    \ CE, the WAN interface itself, encapsulation\n   over Ethernet, ATM or PPP, as\
    \ well as control protocols such as\n   PPPoE, IPCP, DHCP, etc. all remain unchanged\
    \ from current IPv4\n   operation.  Although 6rd was designed primarily to support\
    \ IPv6\n   deployment to a customer site (such as a residential home network)\
    \ by\n   an SP, it can equally be applied to an individual IPv6 host acting as\n\
    \   a CE.\n   6rd relies on IPv4 and is designed to deliver production-quality\
    \ IPv6\n   alongside IPv4 with as little change to IPv4 networking and\n   operations\
    \ as possible.  Native IPv6 deployment within the SP network\n   itself may continue\
    \ for the SP's own purposes while delivering IPv6\n   service to sites supported\
    \ by 6rd.  Once the SP network and\n   operations can support fully native IPv6\
    \ access and transport, 6rd\n   may be discontinued.\n   6rd utilizes the same\
    \ encapsulation and base mechanism as 6to4 and\n   could be viewed as a superset\
    \ of 6to4 (6to4 could be achieved by\n   setting the 6rd prefix to 2002::/16).\
    \  Unlike 6to4, 6rd is for use\n   only in an environment where a service provider\
    \ closely manages the\n   delivery of IPv6 service. 6to4 routes with the 2002::/16\
    \ prefix may\n   exist alongside 6rd in the 6rd CE router, and doing so may offer\
    \ some\n   efficiencies when communicating directly with 6to4 routers.\n   The\
    \ 6rd link model can be extended to support IPv6 multicast.  IPv6\n   multicast\
    \ support is left for future consideration.\n   How this mechanism should be used\
    \ and other deployment and\n   operational considerations are considered out of\
    \ scope for this\n   document.\n"
- title: 2.  Requirements Language
  contents:
  - "2.  Requirements Language\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\"\
    , \"SHALL\", \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"\
    MAY\", and \"OPTIONAL\" in this\n   document are to be interpreted as described\
    \ in RFC 2119 [RFC2119].\n"
- title: 3.  Terminology
  contents:
  - "3.  Terminology\n   6rd prefix            An IPv6 prefix selected by the service\
    \ provider\n                         for use by a 6rd domain.  There is exactly\
    \ one\n                         6rd prefix for a given 6rd domain.  An SP may\n\
    \                         deploy 6rd with a single 6rd domain or multiple\n  \
    \                       6rd domains.\n   6rd Customer Edge (6rd CE)  A device\
    \ functioning as a Customer Edge\n                               router in a 6rd\
    \ deployment.  In a\n                               residential broadband deployment,\
    \ this\n                               type of device is sometimes referred to\n\
    \                               as a \"Residential Gateway\" (RG) or\n       \
    \                        \"Customer Premises Equipment\" (CPE).  A\n         \
    \                      typical 6rd CE serving a residential site\n           \
    \                    has one WAN side interface, one or more\n               \
    \                LAN side interfaces, and a 6rd virtual\n                    \
    \           interface.  A 6rd CE may also be referred\n                      \
    \         to simply as a \"CE\" within the context of\n                      \
    \         6rd.\n   6rd delegated prefix  The IPv6 prefix calculated by the CE\
    \ for use\n                         within the customer site by combining the\
    \ 6rd\n                         prefix and the CE IPv4 address obtained via\n\
    \                         IPv4 configuration methods.  This prefix can be\n  \
    \                       considered logically equivalent to a DHCPv6\n        \
    \                 IPv6 delegated prefix [RFC3633].\n   6rd domain            A\
    \ set of 6rd CEs and BRs connected to the same\n                         virtual\
    \ 6rd link.  A service provider may\n                         deploy 6rd with\
    \ a single 6rd domain, or may\n                         utilize multiple 6rd domains.\
    \  Each domain\n                         requires a separate 6rd prefix.\n   CE\
    \ LAN side           The functionality of a 6rd CE that serves the\n         \
    \                \"Local Area Network (LAN)\" or \"customer-facing\"\n       \
    \                  side of the CE.  The CE LAN side interface is\n           \
    \              fully IPv6 enabled.\n   CE WAN side           The functionality\
    \ of a 6rd CE that serves the\n                         \"Wide Area Network (WAN)\"\
    \ or \"Service Provider-\n                         facing\" side of the CE.  The\
    \ CE WAN side is\n                         IPv4-only.\n   6rd Border Relay (BR)\
    \ A 6rd-enabled router managed by the service\n                         provider\
    \ at the edge of a 6rd domain.  A Border\n                         Relay router\
    \ has at least one of each of the\n                         following: an IPv4-enabled\
    \ interface, a 6rd\n                         virtual interface acting as an endpoint\
    \ for the\n                         6rd IPv6 in IPv4 tunnel, and an IPv6 interface\n\
    \                         connected to the native IPv6 network.  A 6rd BR\n  \
    \                       may also be referred to simply as a \"BR\" within\n  \
    \                       the context of 6rd.\n   BR IPv4 address       The IPv4\
    \ address of the 6rd Border Relay for a\n                         given 6rd domain.\
    \  This IPv4 address is used by\n                         the CE to send packets\
    \ to a BR in order to\n                         reach IPv6 destinations outside\
    \ of the 6rd\n                         domain.\n   6rd virtual interface Internal\
    \ multi-point tunnel interface where 6rd\n                         encapsulation\
    \ and decapsulation of IPv6 packets\n                         inside IPv4 occurs.\
    \  A typical CE or BR\n                         implementation requires only one\
    \ 6rd virtual\n                         interface.  A BR operating in multiple\
    \ 6rd\n                         domains may require more than one 6rd virtual\n\
    \                         interface, but no more than one per 6rd domain.\n  \
    \ CE IPv4 address       The IPv4 address given to the CE as part of\n        \
    \                 normal IPv4 Internet access (i.e., configured\n            \
    \             via DHCP, PPP, or otherwise).  This address may\n              \
    \           be global or private [RFC1918] within the 6rd\n                  \
    \       domain.  This address is used by a 6rd CE to\n                       \
    \  create the 6rd delegated prefix as well as to\n                         send\
    \ and receive IPv4-encapsulated IPv6\n                         packets.\n"
- title: 4.  6rd Prefix Delegation
  contents:
  - "4.  6rd Prefix Delegation\n   The 6rd delegated prefix for use at a customer\
    \ site is created by\n   combining the 6rd prefix and all or part of the CE IPv4\
    \ address.\n   From these elements, the 6rd delegated prefix is automatically\n\
    \   created by the CE for the customer site when IPv4 service is\n   obtained.\
    \  This 6rd delegated prefix is used in the same manner as a\n   prefix obtained\
    \ via DHCPv6 prefix delegation [RFC3633].\n   In 6to4, a similar operation is\
    \ performed by incorporating an entire\n   IPv4 address at a fixed location following\
    \ a well-known /16 IPv6\n   prefix.  In 6rd, the IPv6 prefix as well as the position\
    \ and number\n   of bits of the IPv4 address incorporated varies from one 6rd\
    \ domain\n   to the next. 6rd allows the SP to adjust the size of the 6rd prefix,\n\
    \   how many bits are used by the 6rd mechanism, and how many bits are\n   left\
    \ to be delegated to customer sites.  To allow for stateless\n   address auto-configuration\
    \ on the CE LAN side, a 6rd delegated prefix\n   SHOULD be /64 or shorter.\n \
    \  The 6rd delegated prefix is created by concatenating the 6rd prefix\n   and\
    \ a consecutive set of bits from the CE IPv4 address in order.  The\n   length\
    \ of the 6rd delegated prefix is equal to length of the 6rd\n   prefix (n) plus\
    \ the number of bits from the CE IPv4 address (o).\n   The figure shows the format\
    \ of an IPv6 address (Section 2.5.4 of\n   [RFC4291]) with a 6rd prefix and an\
    \ embedded CE IPv4 address:\n   |     n bits    |    o bits    |   m bits  | \
    \   128-n-o-m bits      |\n   +---------------+--------------+-----------+------------------------+\n\
    \   |  6rd prefix   | IPv4 address | subnet ID |     interface ID       |\n  \
    \ +---------------+--------------+-----------+------------------------+\n   |<---\
    \ 6rd delegated prefix --->|\n                                 Figure 1\n   For\
    \ example, if the 6rd prefix is /32 and 24 bits of the CE IPv4\n   address is\
    \ used (e.g., all CE IPv4 addresses can be aggregated by a\n   10.0.0.0/8), then\
    \ the size of the 6rd delegated prefix for each CE is\n   automatically calculated\
    \ to be /56 (32 + 24 = 56).\n   Embedding less than the full 32 bits of a CE IPv4\
    \ address is possible\n   only when an aggregated block of IPv4 addresses is available\
    \ for a\n   given 6rd domain.  This may not be practical with global IPv4\n  \
    \ addresses, but is quite likely in a deployment where private\n   addresses are\
    \ being assigned to CEs.  If private addresses overlap\n   within a given 6rd\
    \ deployment, the deployment may be divided into\n   separate 6rd domains, likely\
    \ along the same topology lines the NAT-\n   based IPv4 deployment itself would\
    \ require.  In this case, each\n   domain is addressed with a different 6rd prefix.\n\
    \   Each 6rd domain may use a different encoding of the embedded IPv4\n   address,\
    \ even within the same service provider.  For example, if\n   multiple IPv4 address\
    \ blocks with different levels of aggregation are\n   used at the same service\
    \ provider, the number of IPv4 bits needed to\n   encode the 6rd delegated prefix\
    \ may vary between each block.  In this\n   case, different 6rd prefixes, and\
    \ hence separate 6rd domains, may be\n   used to support the different encodings.\n\
    \   Since 6rd delegated prefixes are selected algorithmically from an\n   IPv4\
    \ address, changing the IPv4 address will cause a change in the\n   IPv6 delegated\
    \ prefix which would ripple through the site's network\n   and could be disruptive.\
    \  As such, it is recommended that the service\n   provider assign CE IPv4 addresses\
    \ with relatively long lifetimes.\n   6rd IPv6 address assignment, and hence the\
    \ IPv6 service itself, is\n   tied to the IPv4 address lease; thus, the 6rd service\
    \ is also tied to\n   this in terms of authorization, accounting, etc.  For example,\
    \ the\n   6rd delegated prefix has the same lifetime as its associated IPv4\n\
    \   address.  The prefix lifetimes advertised in Router Advertisements or\n  \
    \ used by DHCP on the CE LAN side MUST be equal to or shorter than the\n   IPv4\
    \ address lease time.  If the IPv4 lease time is not known, the\n   lifetime of\
    \ the 6rd delegated prefix SHOULD follow the defaults\n   specified in [RFC4861].\n"
- title: 5.  Troubleshooting and Traceability
  contents:
  - "5.  Troubleshooting and Traceability\n   A 6rd IPv6 address and associated IPv4\
    \ address for a given customer\n   can always be determined algorithmically by\
    \ the service provider that\n   operates the given 6rd domain.  This may be useful\
    \ for referencing\n   logs and other data at a service provider that may have\
    \ more robust\n   operational tools for IPv4 than IPv6.  This also allows IPv4\
    \ data\n   path, node, and endpoint monitoring to be applicable to IPv6.\n   The\
    \ 6rd CE and BR SHOULD support the IPv6 Subnet-Router anycast\n   address [RFC4291]\
    \ for its own 6rd delegated prefix.  This allows, for\n   example, IPv6 ICMP echo\
    \ messages to be sent to the 6rd virtual\n   interface itself for additional troubleshooting\
    \ of the internal\n   operation of 6rd at a given CE or BR.  In the case of the\
    \ BR, the\n   IPv4 address used to calculate the 6rd delegated prefix is the\n\
    \   configured BR IPv4 address.\n"
- title: 6.  Address Selection
  contents:
  - "6.  Address Selection\n   All addresses assigned from 6rd delegated prefixes\
    \ should be treated\n   as native IPv6.  No changes to the source address selection\
    \ or\n   destination address selection policy table [RFC3484] are necessary.\n"
- title: 7.  6rd Configuration
  contents:
  - "7.  6rd Configuration\n   For a given 6rd domain, the BR and CE MUST be configured\
    \ with the\n   following four 6rd elements.  The configured values for these four\n\
    \   6rd elements are identical for all CEs and BRs within a given 6rd\n   domain.\n\
    \   IPv4MaskLen         The number of high-order bits that are identical\n   \
    \                    across all CE IPv4 addresses within a given 6rd\n       \
    \                domain.  For example, if there are no identical\n           \
    \            bits, IPv4MaskLen is 0 and the entire CE IPv4\n                 \
    \      address is used to create the 6rd delegated\n                       prefix.\
    \  If there are 8 identical bits (e.g., the\n                       Private IPv4\
    \ address range 10.0.0.0/8 is being\n                       used), IPv4MaskLen\
    \ is equal to 8 and IPv4MaskLen\n                       high-order bits are stripped\
    \ from the IPv4\n                       address before constructing the corresponding\
    \ 6rd\n                       delegated prefix.\n   6rdPrefix           The 6rd\
    \ IPv6 prefix for the given 6rd domain.\n   6rdPrefixLen        The length of\
    \ the 6rd IPv6 prefix for the given\n                       6rd domain.\n   6rdBRIPv4Address\
    \    The IPv4 address of the 6rd Border Relay for a\n                       given\
    \ 6rd domain.\n"
- title: 7.1.  Customer Edge Configuration
  contents:
  - "7.1.  Customer Edge Configuration\n   The four 6rd elements are set to values\
    \ that are the same across all\n   CEs within a 6rd domain.  The values may be\
    \ configured in a variety\n   of manners, including provisioning methods such\
    \ as the Broadband\n   Forum's \"TR-69\" [TR069] Residential Gateway management\
    \ interface, an\n   XML-based object retrieved after IPv4 connectivity is established,\
    \ a\n   DNS record, an SMIv2 MIB [RFC2578], PPP IPCP, or manual configuration\n\
    \   by an administrator.  This document describes how to configure the\n   necessary\
    \ parameters via a single DHCP option.  A CE that allows IPv4\n   configuration\
    \ by DHCP SHOULD implement this option.  Other\n   configuration and management\
    \ methods may use the format described by\n   this option for consistency and\
    \ convenience of implementation on CEs\n   that support multiple configuration\
    \ methods.\n   The only remaining provisioning information the CE requires in\
    \ order\n   to calculate the 6rd delegated prefix and enable IPv6 connectivity\
    \ is\n   an IPv4 address for the CE.  This CE IPv4 address is configured as\n\
    \   part of obtaining IPv4 Internet access (i.e., configured via DHCP,\n   PPP,\
    \ or otherwise).  This address may be global or private [RFC1918]\n   within the\
    \ 6rd domain.\n   A single 6rd CE MAY be connected to more than one 6rd domain,\
    \ just as\n   any router may have more than one IPv6-enabled service provider\n\
    \   facing interface and more than one set of associated delegated\n   prefixes\
    \ assigned by DHCPv6 prefix delegation or other means.  Each\n   domain a given\
    \ CE operates within would require its own set of 6rd\n   configuration elements\
    \ and would generate its own 6rd delegated\n   prefix.\n"
- title: 7.1.1.  6rd DHCPv4 Option
  contents:
  - "7.1.1.  6rd DHCPv4 Option\n   0                   1                   2     \
    \              3\n   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8\
    \ 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |  OPTION_6RD   | option-length |  IPv4MaskLen  |  6rdPrefixLen |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                                                               |\n   |  \
    \                         6rdPrefix                           |\n   |        \
    \                  (16 octets)                          |\n   |              \
    \                                                 |\n   |                    \
    \                                           |\n   |                          \
    \                                     |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                     6rdBRIPv4Address(es)                      |\n   .  \
    \                                                             .\n   .        \
    \                                                       .\n   .              \
    \                                                 .\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \                                 Figure 2\n   option-code         OPTION_6RD\
    \ (212)\n   option-length       The length of the DHCP option in octets (22\n\
    \                       octets with one BR IPv4 address).\n   IPv4MaskLen    \
    \     The number of high-order bits that are identical\n                     \
    \  across all CE IPv4 addresses within a given 6rd\n                       domain.\
    \  This may be any value between 0 and 32.\n                       Any value greater\
    \ than 32 is invalid.\n   6rdPrefixLen        The IPv6 prefix length of the SP's\
    \ 6rd IPv6\n                       prefix in number of bits.  For the purpose\
    \ of\n                       bounds checking by DHCP option processing, the\n\
    \                       sum of (32 - IPv4MaskLen) + 6rdPrefixLen MUST be\n   \
    \                    less than or equal to 128.\n   6rdBRIPv4Address    One or\
    \ more IPv4 addresses of the 6rd Border\n                       Relay(s) for a\
    \ given 6rd domain.\n   6rdPrefix           The service provider's 6rd IPv6 prefix\n\
    \                       represented as a 16-octet IPv6 address.  The bits\n  \
    \                     in the prefix after the 6rdPrefixlen number of\n       \
    \                bits are reserved and MUST be initialized to zero\n         \
    \              by the sender and ignored by the receiver.\n   The CE MUST include\
    \ a Parameter Request List Option [RFC2132] for the\n   OPTION_6RD.  Because the\
    \ OPTION_6RD contains one IPv4MaskLen/\n   6rdPrefixLen/6rdPrefix block, and because\
    \ DHCP cannot convey more\n   than one instance of an option, OPTION_6RD is limited\
    \ to provision at\n   most a single 6rd domain.  Provisioning of a CE router connected\
    \ to\n   multiple 6rd domains is outside the scope of this protocol\n   specification.\n\
    \   The presence of the OPTION_6RD DHCP option is an indication of the\n   availability\
    \ of the 6rd service.  By default, receipt of a valid 6rd\n   DHCP option by a\
    \ 6rd-capable CE results in configuration of the 6rd\n   virtual interface and\
    \ associated delegated prefix for use on the CE's\n   LAN side.  The CE MUST be\
    \ able to configure the 6rd mechanism to be\n   disabled, in which case the 6rd\
    \ DHCP option, if received, is silently\n   ignored.\n   A detailed description\
    \ of CE behavior using multiple BR IPv4\n   addresses is left for future consideration.\
    \  In such a case, a CE\n   MUST support at least one BR IPv4 address and MAY\
    \ support more than\n   one.\n   When 6rd is enabled, a typical CE router will\
    \ install a default route\n   to the BR, a black hole route for the 6rd delegated\
    \ prefix, and\n   routes for any LAN side assigned and advertised prefixes.  For\n\
    \   example, using a CE IPv4 address of 10.100.100.1, a BR IPv4 address\n   of\
    \ 10.0.0.1, an IPv4MaskLen of 8, 2001:db8::/32 as the 6rdPrefix, and\n   one /64\
    \ prefix assigned to a LAN side interface, a typical CE routing\n   table will\
    \ look like:\n     ::/0 -> 6rd-virtual-int0 via 2001:db8:0:100:: (default route)\n\
    \     2001:db8::/32 -> 6rd-virtual-int0 (direct connect to 6rd)\n     2001:db8:6464:100::/56\
    \ -> Null0 (delegated prefix null route)\n     2001:db8:6464:100::/64 -> Ethernet0\
    \ (LAN interface)\n"
- title: 7.2.  Border Relay Configuration
  contents:
  - "7.2.  Border Relay Configuration\n   The 6rd BR MUST be configured with the same\
    \ 6rd elements as the 6rd\n   CEs operating within the same domain.\n   For increased\
    \ reliability and load balancing, the BR IPv4 address may\n   be an anycast address\
    \ shared across a given 6rd domain.  As 6rd is\n   stateless, any BR may be used\
    \ at any time.  If the BR IPv4 address is\n   anycast the relay MUST use this\
    \ anycast IPv4 address as the source\n   address in packets relayed to CEs.\n\
    \   Since 6rd uses provider address space, no specific routes need to be\n   advertised\
    \ externally for 6rd to operate, neither in IPv6 nor IPv4\n   BGP.  However, if\
    \ anycast is used for the 6rd IPv4 relays, the\n   anycast addresses must be advertised\
    \ in the service provider's IGP.\n"
- title: 8.  Neighbor Unreachability Detection
  contents:
  - "8.  Neighbor Unreachability Detection\n   Neighbor Unreachability Detection (NUD)\
    \ for tunnels is described in\n   Section 3.8 of [RFC4213].  In 6rd, all CEs and\
    \ BRs can be considered\n   as connected to the same virtual link and therefore\
    \ neighbors to each\n   other.  This section describes how to utilize neighbor\
    \ unreachability\n   detection without negatively impacting the scalability of\
    \ a 6rd\n   deployment.\n   A typical 6rd deployment may consist of a very large\
    \ number of CEs\n   within the same domain.  Reachability between CEs is based\
    \ on IPv4\n   routing, and sending NUD or any periodic packets between 6rd CE\n\
    \   devices beyond isolated troubleshooting of the 6rd mechanism is NOT\n   RECOMMENDED.\n\
    \   While reachability detection between a given 6rd CE and BR is not\n   necessary\
    \ for the proper operation of 6rd, in cases where a CE has\n   alternate paths\
    \ for BR reachability to choose from, it could be\n   useful.  Sending NUD messages\
    \ to a BR, in particular periodic\n   messages from a very large number of CEs,\
    \ could result in overloading\n   of the BR control message processing path, negatively\
    \ affecting\n   scalability of the 6rd deployment.  Instead, a CE that needs to\n\
    \   determine BR reachability MUST utilize a method that allows\n   reachability\
    \ detection packets to follow a typical data forwarding\n   path without special\
    \ processing by the BR.  One such method is\n   described below.\n   1.  The CE\
    \ constructs a payload of any size and content to be sent to\n       the BR (e.g.,\
    \ a zero-length null payload, a padded payload\n       designed to test a certain\
    \ MTU, a NUD message, etc.).  The exact\n       format of the message payload\
    \ is not important as the BR will not\n       be processing it directly.\n   2.\
    \  The desired payload is encapsulated with the inner IPv6 and outer\n       IPv4\
    \ headers as follows:\n       *  The IPv6 destination address is set to an address\
    \ from the\n          CE's 6rd delegated prefix that is assigned to a virtual\n\
    \          interface on the CE.\n       *  The IPv6 source address is set to an\
    \ address from the CE's 6rd\n          delegated prefix as well, including the\
    \ same as used for the\n          IPv6 destination address.\n       *  The IPv4\
    \ header is then added as it normally would be for any\n          packet destined\
    \ for the BR.  That is, the IPv4 destination\n          address is that of the\
    \ BR, and the source address is the CE\n          IPv4 address.\n   3.  The CE\
    \ sends the constructed packet out the interface on which BR\n       reachability\
    \ is being monitored.  On successful receipt at the\n       BR, the BR MUST decapsulate\
    \ and forward the packet normally.\n       That is, the IPv4 header is decapsulated\
    \ normally, revealing the\n       IPv6 destination as the CE, which in turn results\
    \ in the packet\n       being forwarded to that CE via the 6rd mechanism (i.e.,\
    \ the IPv4\n       destination is that of the CE that originated the packet, and\
    \ the\n       IPv4 source is that of the BR).\n   4.  Arrival of the constructed\
    \ IPv6 packet at the CE's IPv6 address\n       completes one round trip to and\
    \ from the BR, without causing the\n       BR to process the message outside of\
    \ its normal data forwarding\n       path.  The CE then processes the IPv6 packet\
    \ accordingly\n       (updating keepalive timers, metrics, etc.).\n   The payload\
    \ may be empty or could contain values that are meaningful\n   to the CE.  Sending\
    \ a proper NUD message could be convenient for some\n   implementations (note\
    \ that the BR will decrement the IPv6 hop limit).\n   Since the BR forwards the\
    \ packet as any other data packet without any\n   processing of the payload itself,\
    \ the format of the payload is left\n   as a choice to the implementer.\n"
- title: 9.  IPv6 in IPv4 Encapsulation
  contents:
  - "9.  IPv6 in IPv4 Encapsulation\n   IPv6 in IPv4 encapsulation and forwarding\
    \ manipulations (e.g.,\n   handling packet markings, checksumming, etc.) is performed\
    \ as\n   specified in Section 3.5 of \"Basic Transition Mechanisms for IPv6\n\
    \   Hosts and Routers\" [RFC4213], which is the same mechanism used by\n   6to4\
    \ [RFC3056].  ICMPv4 errors are handled as specified in Section\n   3.4 of [RFC4213].\
    \  By default, the IPv6 Traffic Class field MUST be\n   copied to the IPv4 ToS\
    \ (Type of Service) field.  This default\n   behavior MAY be overridden by configuration.\
    \  See [RFC2983] and\n   [RFC3168] for further information related to IP Differentiated\n\
    \   Services and tunneling.\n   IPv6 packets from a CE are encapsulated in IPv4\
    \ packets when they\n   leave the site via its CE WAN side interface.  The CE\
    \ IPv4 address\n   MUST be configured to send and receive packets on this interface.\n\
    \   The 6rd link is modeled as an NBMA link similar to other automatic\n   IPv6\
    \ in IPv4 tunneling mechanisms like [RFC5214], with all 6rd CEs\n   and BRs defined\
    \ as off-link neighbors from one other.  The link-local\n   address of a 6rd virtual\
    \ interface performing the 6rd encapsulation\n   would, if needed, be formed as\
    \ described in Section 3.7 of [RFC4213].\n   However, no communication using link-local\
    \ addresses will occur.\n"
- title: 9.1.  Maximum Transmission Unit
  contents:
  - "9.1.  Maximum Transmission Unit\n   Maximum transmission unit (MTU) and fragmentation\
    \ issues for IPv6 in\n   IPv4 tunneling are discussed in detail in Section 3.2\
    \ of RFC 4213\n   [RFC4213]. 6rd's scope is limited to a service provider network.\n\
    \   IPv4 Path MTU discovery MAY be used to adjust the MTU of the tunnel\n   as\
    \ described in Section 3.2.2 of RFC 4213 [RFC4213], or the 6rd\n   Tunnel MTU\
    \ might be explicitly configured.\n   The use of an anycast source address could\
    \ lead to any ICMP error\n   message generated on the path being sent to a different\
    \ BR.\n   Therefore, using dynamic tunnel MTU Section 3.2.2 of [RFC4213] is\n\
    \   subject to IPv4 Path MTU blackholes.\n   Multiple BRs using the same anycast\
    \ source address could send\n   fragmented packets to the same IPv6 CE at the\
    \ same time.  If the\n   fragmented packets from different BRs happen to use the\
    \ same fragment\n   ID, incorrect reassembly might occur.  For this reason, a\
    \ BR using an\n   anycast source address MUST set the IPv4 Don't Fragment flag.\n\
    \   If the MTU is well-managed such that the IPv4 MTU on the CE WAN side\n   interface\
    \ is set so that no fragmentation occurs within the boundary\n   of the SP, then\
    \ the 6rd Tunnel MTU should be set to the known IPv4\n   MTU minus the size of\
    \ the encapsulating IPv4 header (20 bytes).  For\n   example, if the IPv4 MTU\
    \ is known to be 1500 bytes, the 6rd Tunnel\n   MTU might be set to 1480 bytes.\
    \  Absent more specific information,\n   the 6rd Tunnel MTU SHOULD default to\
    \ 1280 bytes.\n"
- title: 9.2.  Receiving Rules
  contents:
  - "9.2.  Receiving Rules\n   In order to prevent spoofing of IPv6 addresses, the\
    \ 6rd BR and CE\n   MUST validate the embedded IPv4 source address of the encapsulated\n\
    \   IPv6 packet with the IPv4 source address it is encapsulated by\n   according\
    \ to the configured parameters of the 6rd domain.  If the two\n   source addresses\
    \ do not match, the packet MUST be dropped and a\n   counter incremented to indicate\
    \ that a potential spoofing attack may\n   be underway.  Additionally, a CE MUST\
    \ allow forwarding of packets\n   sourced by the configured BR IPv4 address.\n\
    \   By default, the CE router MUST drop packets received on the 6rd\n   virtual\
    \ interface (i.e., after decapsulation of IPv4) for IPv6\n   destinations not\
    \ within its own 6rd delegated prefix.\n"
- title: 10.  Transition Considerations
  contents:
  - "10.  Transition Considerations\n   An SP network can migrate to IPv6 at its own\
    \ pace with little or no\n   effect on customers being provided IPv6 via 6rd.\
    \  When native IPv6\n   connectivity is available, an administrator can choose\
    \ to disable\n   6rd.\n   The SP can choose to provision a separate IPv6 address\
    \ block for\n   native service, or reuse the 6rd prefix block itself.  If the\
    \ SP uses\n   a separate address block, moving from 6rd to native IPv6 is seen\
    \ as a\n   normal IPv6 renumbering event for the customer.  Renumbering may also\n\
    \   be avoided by injecting the 6rd delegated prefix into the SP's IPv6\n   routing\
    \ domain.  Further considerations with regards to transitioning\n   from 6rd to\
    \ native IPv6 are not covered in this protocol\n   specification.\n"
- title: 11.  IPv6 Address Space Usage
  contents:
  - "11.  IPv6 Address Space Usage\n   As 6rd uses service-provider address space,\
    \ 6rd uses the normal\n   address delegation a service provider gets from its\
    \ Regional Internet\n   Registry (RIR) and no global allocation of a single 6rd\
    \ IANA-assigned\n   address block like the 6to4 2002::/16 is needed.\n   The service\
    \ provider's prefix must be short enough to encode the\n   unique bits of all\
    \ IPv4 addresses within a given 6rd domain and still\n   provide enough IPv6 address\
    \ space to the residential site.  Assuming\n   a worst case scenario using the\
    \ full 32 bits for the IPv4 address,\n   assigning a /56 for customer sites would\
    \ mean that each service\n   provider using 6rd would require a /24 for 6rd in\
    \ addition to other\n   IPv6 addressing needs.  Assuming that 6rd would be stunningly\n\
    \   successful and taken up by almost all Autonomous System (AS) number\n   holders\
    \ (32K today), then the total address usage of 6rd would be\n   equivalent to\
    \ a /9.  If the SP instead delegated /60s to sites, the\n   service provider would\
    \ require a /28, and the total global address\n   consumption by 6rd would be\
    \ equivalent to a /13.  Again, this assumes\n   that 6rd is used by all AS number\
    \ holders in the IPv4 Internet today\n   at the same time, that none have used\
    \ any of 6rd's address\n   compression techniques, and that none have moved to\
    \ native IPv6 and\n   reclaimed the 6rd space that was being used for other purposes.\n\
    \   To alleviate concerns about address usage, 6rd allows for leaving out\n  \
    \ redundant IPv4 prefix bits in the encoding of the IPv4 address inside\n   the\
    \ 6rd IPv6 address.  This is most useful where the IPv4 address\n   space is very\
    \ well aggregated.  For example, to provide each customer\n   with a /60, if a\
    \ service provider has all its IPv4 customers under a\n   /12 then only 20 bits\
    \ needs to be used to encode the IPv4 address and\n   the service provider would\
    \ only need a /40 IPv6 allocation for 6rd.\n   If private address space is used,\
    \ then a 10/8 would require a /36.\n   If multiple 10/8 domains are used, then\
    \ up to 16 could be supported\n   within a /32.\n   If a service provider has\
    \ a non-aggregatable IPv4 space and requiring\n   the use of the full 32-bit IPv4\
    \ address in the encoding of the 6rd\n   IPv6 address, the 6rd prefix MUST be\
    \ no longer than /32 in order to\n   offer a 6rd delegated prefix of at least\
    \ /64.\n   The 6rd address block can be reclaimed when all users of it have\n\
    \   transitioned to native IPv6 service.  This may require renumbering of\n  \
    \ customer sites and use of additional address space during the\n   transition\
    \ period.\n"
- title: 12.  Security Considerations
  contents:
  - "12.  Security Considerations\n   A 6to4 relay router as specified in [RFC3056]\
    \ can be used as an open\n   relay.  It can be used to relay IPv6 traffic and\
    \ as a traffic\n   anonymizer.  By restricting the 6rd domain to within a provider\n\
    \   network, a CE only needs to accept packets from a single or small set\n  \
    \ of known 6rd BR IPv4 addresses.  As such, many of the threats against\n   6to4\
    \ as described in [RFC3964] do not apply.\n   When applying the receiving rules\
    \ in Section 9.2, IPv6 packets are as\n   well protected against spoofing as IPv4\
    \ packets are within an SP\n   network.\n   A malicious user that is aware of\
    \ a 6rd domain and the BR IPv4\n   address could use this information to construct\
    \ a packet that would\n   cause a Border Relay to reflect tunneled packets outside\
    \ of the\n   domain that it is serving.  If the attacker constructs the packet\n\
    \   accordingly and can inject a packet with an IPv6 source address that\n   looks\
    \ as if it originates from within another 6rd domain, forwarding\n   loops between\
    \ 6rd domains may be created, allowing the malicious user\n   to launch a packet\
    \ amplification attack between 6rd domains\n   [RoutingLoop].\n   One possible\
    \ mitigation for this is to simply not allow the BR IPv4\n   address to be reachable\
    \ from outside the SP's 6rd domain.  In this\n   case, carefully constructed IPv6\
    \ packets still could be reflected off\n   a single BR, but the looping condition\
    \ will not occur.  Tunneled\n   packets with the BR IPv4 address as the source\
    \ address might also be\n   filtered to prohibit 6rd tunnels from exiting the\
    \ 6rd domain.\n   To avoid forwarding loops via other internal relays, the BR\
    \ should\n   employ outgoing and incoming IPv4 packets filters, filtering out\
    \ all\n   known relay addresses for internal 6rd BRs, ISATAP routers, or 6to4\n\
    \   relays, including the well-known anycast address space for 6to4.\n   Another\
    \ possible mitigation to the routing loop issue is described in\n   [V6OPS-LOOPS].\n\
    \   The BR MUST install a null route [RFC4632] for its 6rd delegated\n   prefix\
    \ created based on its BR IPv4 address, with the exception of\n   the IPv6 Subnet-Router\
    \ anycast address.\n"
- title: 13.  IANA Considerations
  contents:
  - "13.  IANA Considerations\n   IANA assigned a new DHCP Option code point for OPTION_6RD\
    \ (212) with\n   a data length of 18 + N (OPTION_6RD with N/4 6rd BR addresses).\n"
- title: 14.  Acknowledgements
  contents:
  - "14.  Acknowledgements\n   This RFC is based on Remi Despres' original idea described\
    \ in\n   [RFC5569] and the work done by Rani Assaf, Alexandre Cassen, and\n  \
    \ Maxime Bizon at Free Telecom.  Brian Carpenter and Keith Moore\n   documented\
    \ 6to4, which all of this work is based upon.  We thank Fred\n   Templin for his\
    \ review and contributions, and for sharing his\n   experience with ISATAP.  Review\
    \ and encouragement have been provided\n   by many others and in particular Chris\
    \ Chase, Thomas Clausen, Wouter\n   Cloetens, Wojciech Dec, Bruno Decraene, Remi\
    \ Despres, Alain Durand,\n   Washam Fan, Martin Gysi, David Harrington, Jerry\
    \ Huang, Peter McCann,\n   Alexey Melnikov, Dave Thaler, Eric Voit, and David\
    \ Ward.\n"
- title: 15.  References
  contents:
  - '15.  References

    '
- title: 15.1.  Normative References
  contents:
  - "15.1.  Normative References\n   [RFC1918]      Rekhter, Y., Moskowitz, R., Karrenberg,\
    \ D., Groot, G.,\n                  and E. Lear, \"Address Allocation for Private\n\
    \                  Internets\", BCP 5, RFC 1918, February 1996.\n   [RFC2119]\
    \      Bradner, S., \"Key words for use in RFCs to Indicate\n                \
    \  Requirement Levels\", BCP 14, RFC 2119, March 1997.\n   [RFC2132]      Alexander,\
    \ S. and R. Droms, \"DHCP Options and BOOTP\n                  Vendor Extensions\"\
    , RFC 2132, March 1997.\n   [RFC2491]      Armitage, G., Schulter, P., Jork, M.,\
    \ and G. Harter,\n                  \"IPv6 over Non-Broadcast Multiple Access\
    \ (NBMA)\n                  networks\", RFC 2491, January 1999.\n   [RFC3056]\
    \      Carpenter, B. and K. Moore, \"Connection of IPv6\n                  Domains\
    \ via IPv4 Clouds\", RFC 3056, February 2001.\n   [RFC3168]      Ramakrishnan,\
    \ K., Floyd, S., and D. Black, \"The\n                  Addition of Explicit Congestion\
    \ Notification (ECN) to\n                  IP\", RFC 3168, September 2001.\n \
    \  [RFC4213]      Nordmark, E. and R. Gilligan, \"Basic Transition\n         \
    \         Mechanisms for IPv6 Hosts and Routers\", RFC 4213,\n               \
    \   October 2005.\n   [RFC4291]      Hinden, R. and S. Deering, \"IP Version 6\
    \ Addressing\n                  Architecture\", RFC 4291, February 2006.\n   [RFC4861]\
    \      Narten, T., Nordmark, E., Simpson, W., and H. Soliman,\n              \
    \    \"Neighbor Discovery for IP version 6 (IPv6)\",\n                  RFC 4861,\
    \ September 2007.\n"
- title: 15.2.  Informative References
  contents:
  - "15.2.  Informative References\n   [RFC2578]      McCloghrie, K., Ed., Perkins,\
    \ D., Ed., and J.\n                  Schoenwaelder, Ed., \"Structure of Management\n\
    \                  Information Version 2 (SMIv2)\", STD 58, RFC 2578,\n      \
    \            April 1999.\n   [RFC2983]      Black, D., \"Differentiated Services\
    \ and Tunnels\",\n                  RFC 2983, October 2000.\n   [RFC3068]    \
    \  Huitema, C., \"An Anycast Prefix for 6to4 Relay\n                  Routers\"\
    , RFC 3068, June 2001.\n   [RFC3484]      Draves, R., \"Default Address Selection\
    \ for Internet\n                  Protocol version 6 (IPv6)\", RFC 3484, February\
    \ 2003.\n   [RFC3633]      Troan, O. and R. Droms, \"IPv6 Prefix Options for\n\
    \                  Dynamic Host Configuration Protocol (DHCP) version 6\",\n \
    \                 RFC 3633, December 2003.\n   [RFC3964]      Savola, P. and C.\
    \ Patel, \"Security Considerations for\n                  6to4\", RFC 3964, December\
    \ 2004.\n   [RFC4632]      Fuller, V. and T. Li, \"Classless Inter-domain Routing\n\
    \                  (CIDR): The Internet Address Assignment and\n             \
    \     Aggregation Plan\", BCP 122, RFC 4632, August 2006.\n   [RFC5214]      Templin,\
    \ F., Gleeson, T., and D. Thaler, \"Intra-Site\n                  Automatic Tunnel\
    \ Addressing Protocol (ISATAP)\",\n                  RFC 5214, March 2008.\n \
    \  [RFC5569]      Despres, R., \"IPv6 Rapid Deployment on IPv4\n             \
    \     Infrastructures (6rd)\", RFC 5569, January 2010.\n   [RoutingLoop]  Nakibly\
    \ and Arov, \"Routing Loop Attacks using IPv6\n                  Tunnels\", August\
    \ 2009, <http://www.usenix.org/event/\n                  woot09/tech/full_papers/nakibly.pdf>.\n\
    \   [TR069]        \"TR-069, CPE WAN Management Protocol v1.1, Version:\n    \
    \              Issue 1 Amendment 2\", December 2007.\n   [V6OPS-LOOPS]  Nakibly,\
    \ G. and F. Templin, \"Routing Loop Attack using\n                  IPv6 Automatic\
    \ Tunnels: Problem Statement and Proposed\n                  Mitigations\", Work\
    \ in Progress, May 2010.\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Mark Townsley\n   Cisco\n   Paris,\n   France\n   EMail:\
    \ mark@townsley.net\n   Ole Troan\n   Cisco\n   Bergen,\n   Norway\n   EMail:\
    \ ot@cisco.com\n"
