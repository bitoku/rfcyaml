- title: __initial_text__
  contents:
  - "            OSPF as the Provider/Customer Edge Protocol for\n              BGP/MPLS\
    \ IP Virtual Private Networks (VPNs)\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This document specifies an Internet standards track protocol\
    \ for the\n   Internet community, and requests discussion and suggestions for\n\
    \   improvements.  Please refer to the current edition of the \"Internet\n   Official\
    \ Protocol Standards\" (STD 1) for the standardization state\n   and status of\
    \ this protocol.  Distribution of this memo is unlimited.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (C) The Internet Society (2006).\n"
- title: Abstract
  contents:
  - "Abstract\n   Many Service Providers offer Virtual Private Network (VPN) services\n\
    \   to their customers, using a technique in which customer edge routers\n   (CE\
    \ routers) are routing peers of provider edge routers (PE routers).\n   The Border\
    \ Gateway Protocol (BGP) is used to distribute the\n   customer's routes across\
    \ the provider's IP backbone network, and\n   Multiprotocol Label Switching (MPLS)\
    \ is used to tunnel customer\n   packets across the provider's backbone.  This\
    \ is known as a \"BGP/MPLS\n   IP VPN\".  The base specification for BGP/MPLS\
    \ IP VPNs presumes that\n   the routing protocol on the interface between a PE\
    \ router and a CE\n   router is BGP.  This document extends that specification\
    \ by allowing\n   the routing protocol on the PE/CE interface to be the Open Shortest\n\
    \   Path First (OSPF) protocol.\n   This document updates RFC 4364.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1. Introduction ....................................................2\n\
    \   2. Specification of Requirements ...................................3\n  \
    \ 3. Requirements ....................................................4\n   4.\
    \ BGP/OSPF Interaction Procedures for PE Routers ..................6\n      4.1.\
    \ Overview ...................................................6\n           4.1.1.\
    \ VRFs and OSPF Instances .............................6\n           4.1.2. VRFs\
    \ and Routes .....................................6\n           4.1.3. Inter-Area,\
    \ Intra-Area, and External Routes .........7\n           4.1.4. PEs and OSPF Area\
    \ 0 .................................8\n           4.1.5. Prevention of Loops\
    \ .................................9\n      4.2. Details ....................................................9\n\
    \           4.2.1. Independent OSPF Instances in PEs ...................9\n  \
    \         4.2.2. Router ID ..........................................10\n    \
    \       4.2.3. OSPF Areas .........................................10\n      \
    \     4.2.4. OSPF Domain Identifiers ............................10\n        \
    \   4.2.5. Loop Prevention ....................................12\n          \
    \        4.2.5.1. The DN Bit ................................12\n            \
    \      4.2.5.2. Use of OSPF Route Tags ....................12\n              \
    \    4.2.5.3. Other Possible Loops ......................13\n           4.2.6.\
    \ Handling LSAs from the CE ..........................14\n           4.2.7. Sham\
    \ Links .........................................16\n                  4.2.7.1.\
    \ Intra-Area Routes .........................16\n                  4.2.7.2. Creating\
    \ Sham Links .......................17\n                  4.2.7.3. OSPF Protocol\
    \ on Sham Links ...............18\n                  4.2.7.4. Routing and Forwarding\
    \ on Sham Links ......19\n           4.2.8. VPN-IPv4 Routes Received via BGP ...................19\n\
    \                  4.2.8.1. External Routes ...........................20\n  \
    \                4.2.8.2. Summary Routes ............................22\n    \
    \              4.2.8.3. NSSA Routes ...............................22\n   5. IANA\
    \ Considerations ............................................22\n   6. Security\
    \ Considerations ........................................23\n   7. Acknowledgements\
    \ ...............................................23\n   8. Normative References\
    \ ...........................................23\n   9. Informative References\
    \ .........................................24\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   [VPN] describes a method by which a Service Provider (SP)\
    \ can use its\n   IP backbone to provide a VPN (Virtual Private Network) service\
    \ to\n   customers.  In that method, a customer's edge devices (CE devices)\n\
    \   are connected to the provider's edge routers (PE routers).  If the CE\n  \
    \ device is a router, then the PE router may become a routing peer of\n   the\
    \ CE router (in some routing protocol) and may, as a result, learn\n   the routes\
    \ that lead to the CE's site and that need to be distributed\n   to other PE routers\
    \ that attach to the same VPN.\n   The PE routers that attach to a common VPN\
    \ use BGP (Border Gateway\n   Protocol) to distribute the VPN's routes to each\
    \ other.  A CE router\n   can then learn the routes to other sites in the VPN\
    \ by peering with\n   its attached PE router in a routing protocol.  CE routers\
    \ at\n   different sites do not, however, peer with each other.\n   It can be\
    \ expected that many VPNs will use OSPF (Open Shortest Path\n   First) as their\
    \ IGP (Interior Gateway Protocol), i.e., the routing\n   protocol used by a network\
    \ for the distribution of internal routes\n   within that network.  This does\
    \ not necessarily mean that the PE\n   routers need to use OSPF to peer with the\
    \ CE routers.  Each site in a\n   VPN can use OSPF as its intra-site routing protocol,\
    \ while using, for\n   example, BGP [BGP] or RIP (Routing Information Protocol)\
    \ [RIP] to\n   distribute routes to a PE router.  However, it is certainly\n \
    \  convenient, when OSPF is being used intra-site, to use it on the\n   PE-CE\
    \ link as well, and [VPN] explicitly allows this.\n   Like anything else, the\
    \ use of OSPF on the PE-CE link has advantages\n   and disadvantages.  The disadvantage\
    \ to using OSPF on the PE-CE link\n   is that it gets the SP's PE router involved,\
    \ however peripherally, in\n   a VPN site's IGP.  The advantages though are:\n\
    \      -  The administrators of the CE router need not have any expertise\n  \
    \       in any routing protocol other than OSPF.\n      -  The CE routers do not\
    \ need to have support for any routing\n         protocols other than OSPF.\n\
    \      -  If a customer is transitioning his network from a traditional\n    \
    \     OSPF backbone to the VPN service described in [VPN], the use of\n      \
    \   OSPF on the PE-CE link eases the transitional issues.\n   It seems likely\
    \ that some SPs and their customers will resolve these\n   trade-offs in favor\
    \ of the use of OSPF on the PE-CE link.  Thus, we\n   need to specify the procedures\
    \ that must be implemented by a PE\n   router in order to make this possible.\
    \  (No special procedures are\n   needed in the CE router though; CE routers just\
    \ run whatever OSPF\n   implementations they may have.)\n"
- title: 2.  Specification of Requirements
  contents:
  - "2.  Specification of Requirements\n   The key words \"MUST\", \"MUST NOT\", \"\
    REQUIRED\", \"SHALL\", \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\"\
    , \"MAY\", and \"OPTIONAL\" in this\n   document are to be interpreted as described\
    \ in [RFC2119].\n"
- title: 3.  Requirements
  contents:
  - "3.  Requirements\n   Consider a set of VPN sites that are thought of as being\
    \ in the same\n   \"OSPF domain\".  Two sites are considered to be in the same\
    \ OSPF\n   domain if it is intended that routes from one site to the other be\n\
    \   considered intra-network routes.  A set of OSPF sites in the same\n   domain\
    \ will almost certainly be a set of sites that together\n   constitute an \"intranet\"\
    , each of which runs OSPF as its intra-site\n   routing protocol.\n   Per [VPN],\
    \ the VPN routes are distributed among the PE routers by\n   BGP.  If the PE uses\
    \ OSPF to distribute routes to the CE router, the\n   standard procedures governing\
    \ BGP/OSPF interactions [OSPFv2] would\n   cause routes from one site to be delivered\
    \ to another in type 5 LSAs\n   (Link State Advertisements), as \"AS-external\"\
    \ routes.  This is\n   undesirable; it would be much better to deliver such routes\
    \ in type 3\n   LSAs (as inter-area routes), so that they can be distinguished\
    \ from\n   any \"real\" AS-external routes that may be circulating in the VPN\n\
    \   (that is, so that they can be distinguished by OSPF from routes that\n   really\
    \ do not come from within the VPN).  Hence, it is necessary for\n   the PE routers\
    \ to implement a modified version of the BGP/OSPF\n   interaction procedures.\n\
    \   In fact, we would like to have a very general set of procedures that\n   allows\
    \ a customer to replace a legacy private OSPF backbone easily\n   with the VPN\
    \ service.  We would like this procedure to meet the\n   following set of requirements:\n\
    \      -  The procedures should not make assumptions about the OSPF\n        \
    \ topology.  In particular, it should not be assumed that\n         customer sites\
    \ are OSPF stub sites or NSSA (Not So Stubby Area)\n         sites.  Nor should\
    \ it be assumed that a customer site contains\n         only one OSPF area, or\
    \ that it has no area 0 routers.\n      -  If VPN sites A and B are in the same\
    \ OSPF domain, then routes\n         from one should be presented to the other\
    \ as OSPF intra-network\n         routes.  In general, this can be done by presenting\
    \ such routes\n         as inter-area routes in type 3 LSAs.\n         Note that\
    \ this allows two VPN sites to be connected via an\n         \"OSPF backdoor link\"\
    .  That is, one can have an OSPF link\n         between the two sites that is\
    \ used only when the VPN backbone\n         is unavailable.  (This would not be\
    \ possible with the ordinary\n         BGP/OSPF interaction procedures.  The ordinary\
    \ procedures would\n         present routes via the VPN backbone as AS-external\
    \ routes, and\n         these could never be preferred to intra-network routes.)\
    \  This\n         may be very useful during a period of transition from a legacy\n\
    \         OSPF backbone to a VPN backbone.\n      -  It should be possible to\
    \ make use of an \"OSPF backdoor link\"\n         between two sites, even if the\
    \ two sites are in the same OSPF\n         area and neither of the routers attached\
    \ to the inter-site\n         backdoor link is an area 0 router.  This can also\
    \ be very\n         useful during a transition period, and it eliminates any need\n\
    \         to reconfigure the sites' routers to be ABRs (Area Border\n        \
    \ Routers).\n         Assuming that it is desired to have the route via the VPN\n\
    \         backbone be preferred to the backdoor route, the VPN backbone\n    \
    \     itself must be presented to the CE routers at each site as a\n         link\
    \ between the two PE routers to which the CE routers are\n         respectively\
    \ attached.\n      -  CE routers, connected to PE routers of the VPN service,\
    \ may\n         themselves function as OSPF backbone (area 0) routers.  An OSPF\n\
    \         backbone may even consist of several \"segments\" that are\n       \
    \  interconnected themselves only via the VPN service.  In such a\n         scenario,\
    \ full intercommunication between sites connected to\n         different segments\
    \ of the OSPF backbone should still be\n         possible.\n      -  The transition\
    \ from the legacy private OSPF backbone to the VPN\n         service must be simple\
    \ and straightforward.  The transition is\n         likely to be phased, such\
    \ that customer sites are migrated one\n         by one from the legacy private\
    \ OSPF backbone to the VPN\n         service.  During the transition, any given\
    \ site might be\n         connected to the VPN service, to the legacy OSPF backbone,\
    \ or\n         to both.  Complete connectivity among all such sites must be\n\
    \         maintained.\n         Since the VPN service is to replace the legacy\
    \ backbone, it\n         must be possible, by suitable adjustment of the OSPF\
    \ metrics,\n         to make OSPF prefer routes that traverse the SP's VPN backbone\n\
    \         to alternative routes that do not.\n      -  The OSPF metric assigned\
    \ to a given route should be carried\n         transparently over the VPN backbone.\n\
    \   Routes from sites that are not in the same OSPF domain will appear as\n  \
    \ AS-external routes.\n   We presuppose familiarity with the contents of [OSPFv2],\
    \ including\n   the OSPF LSA types, and will refer without further exegesis to\
    \ type\n   1, 2, 3, etc. LSAs.  Familiarity with [VPN] is also presupposed.\n"
- title: 4.  BGP/OSPF Interaction Procedures for PE Routers
  contents:
  - '4.  BGP/OSPF Interaction Procedures for PE Routers

    '
- title: 4.1.  Overview
  contents:
  - '4.1.  Overview

    '
- title: 4.1.1.  VRFs and OSPF Instances
  contents:
  - "4.1.1.  VRFs and OSPF Instances\n   A PE router that attaches to more than one\
    \ OSPF domain MUST run an\n   independent instance of OSPF for each domain.  If\
    \ the PE is running\n   OSPF as its IGP (Interior Gateway Protocol), the instance\
    \ of OSPF\n   running as the IGP must be separate and independent from any other\n\
    \   instance of OSPF that the PE is running.  (Whether these instances\n   are\
    \ realized as separate processes or merely as separate contexts of\n   a common\
    \ process is an implementation matter.)  Each interface that\n   attaches to a\
    \ VPN site belongs to no more than one OSPF instance.\n   [VPN] defines the notion\
    \ of a Per-Site Routing and Forwarding Table,\n   or VRF.  Each VRF is associated\
    \ with a set of interfaces.  If a VRF\n   is associated with a particular interface,\
    \ and that interface belongs\n   to a particular OSPF instance, then that OSPF\
    \ instance is said to be\n   associated with the VRF.  If two interfaces belong\
    \ to the same OSPF\n   instance, then both interfaces must be associated with\
    \ the same VRF.\n   If an interface attaches a PE to a CE, and that interface\
    \ is\n   associated with a VRF, we will speak of the CE as being associated\n\
    \   with the VRF.\n"
- title: 4.1.2.  VRFs and Routes
  contents:
  - "4.1.2.  VRFs and Routes\n   OSPF is used to distribute routes from a CE to a\
    \ PE.  The standard\n   OSPF decision process is used to install the best OSPF-distributed\n\
    \   routes in the VRF.\n   Per [VPN], BGP is used to distribute VPN-IPv4 routes\
    \ among PE\n   routers.  An OSPF route installed in a VRF may be \"exported\"\
    \ by being\n   redistributed into BGP as a VPN-IPv4 route.  It may then be\n \
    \  distributed by BGP to other PEs.  At the other PEs, a VPN-IPv4 route\n   may\
    \ be \"imported\" by a VRF and may then be redistributed into one or\n   more\
    \ of the OSPF instances associated with that VRF.\n   Import from and export to\
    \ particular VRFs is controlled by the use of\n   the Route Target Extended Communities\
    \ attribute (or, more simply,\n   Route Target or RT), as specified in [VPN].\n\
    \   A VPN-IPv4 route is \"eligible for import\" into a particular VRF if\n   its\
    \ Route Target is identical to one of the VRF's import Route\n   Targets.  The\
    \ standard BGP decision process is used to select, from\n   among the routes eligible\
    \ for import, the set of VPN-IPv4 routes to\n   be \"installed\" in the VRF.\n\
    \   If a VRF contains both an OSPF-distributed route and a VPN-IPv4 route\n  \
    \ for the same IPv4 prefix, then the OSPF-distributed route is\n   preferred.\
    \  In general, this means that forwarding is done according\n   to the OSPF route.\
    \  The one exception to this rule has to do with the\n   \"sham link\".  If the\
    \ next hop interface for an installed (OSPF-\n   distributed) route is the sham\
    \ link, forwarding is done according to\n   a corresponding BGP route.  This is\
    \ detailed in Section 4.2.7.4.\n   To meet the requirements of Section 3, a PE\
    \ that installs a\n   particular route into a particular VRF needs to know whether\
    \ that\n   route was originally an OSPF route and, if so, whether the OSPF\n \
    \  instance from which it was redistributed into BGP is in the same\n   domain\
    \ as the OSPF instances into which the route may be\n   redistributed.  Therefore,\
    \ a domain identifier is encoded as a BGP\n   Extended Communities attribute [EXTCOMM]\
    \ and distributed by BGP along\n   with the VPN-IPv4 route.  The route's OSPF\
    \ metric and OSPF route type\n   are also carried as BGP attributes of the route.\n"
- title: 4.1.3.  Inter-Area, Intra-Area, and External Routes
  contents:
  - "4.1.3.  Inter-Area, Intra-Area, and External Routes\n   If a PE installs a particular\
    \ VPN-IPv4 route (learned via BGP) in a\n   VRF, and if this is the preferred\
    \ BGP route for the corresponding\n   IPv4 prefix, the corresponding IPv4 route\
    \ is then \"eligible for\n   redistribution\" into each OSPF instance that is\
    \ associated with the\n   VRF.  As a result, it may be advertised to each CE in\
    \ an LSA.\n   Whether a route that is eligible for redistribution into OSPF is\n\
    \   actually redistributed into a particular OSPF instance may depend\n   upon\
    \ the configuration.  For instance, the PE may be configured to\n   distribute\
    \ only the default route into a given OSPF instance.  In\n   this case, the routes\
    \ that are eligible for redistribution would not\n   actually be redistributed.\n\
    \   In the following, we discuss the procedures for redistributing a\n   BGP-distributed\
    \ VPN-IPv4 route into OSPF; these are the procedures to\n   be followed whenever\
    \ such a route is eligible to be redistributed\n   into OSPF and the configuration\
    \ does not prevent such redistribution.\n   If the route is from an OSPF domain\
    \ different from that of the OSPF\n   instance into which it is being redistributed,\
    \ or if the route is not\n   from an OSPF domain at all, then the route is considered\
    \ an external\n   route.\n   If the route is from the same OSPF domain as the\
    \ OSPF instance into\n   which it is being redistributed, and if it was originally\
    \ advertised\n   to a PE as an OSPF external route or an OSPF NSSA route, it will\
    \ be\n   treated as an external route.  Following the normal OSPF procedures,\n\
    \   external routes may be advertised to the CE in type 5 LSAs, or in\n   type\
    \ 7 LSAs, or not at all, depending on the type of area to which\n   the PE/CE\
    \ link belongs.\n   If the route is from the same OSPF domain as the OSPF instance\
    \ into\n   which it is being redistributed, and if it was originally advertised\n\
    \   to a PE as an inter-area or intra-area route, the route will\n   generally\
    \ be advertised to the CE as an inter-area route (in a type 3\n   LSA).\n   As\
    \ a special case, suppose that PE1 attaches to CE1, and that PE2\n   attaches\
    \ to CE2, where:\n      -  the OSPF instance containing the PE1-CE1 link and the\
    \ OSPF\n         instance containing the PE2-CE2 link are in the same OSPF\n \
    \        domain, and\n      -  the PE1-CE1 and PE2-CE2 links are in the same OSPF\
    \ area A (as\n         determined by the configured OSPF area number),\n   then,\
    \ PE1 may flood to CE1 a type 1 LSA advertising a link to PE2,\n   and PE2 may\
    \ flood to CE2 a type 1 LSA advertising a link to PE1.  The\n   link advertised\
    \ in these LSAs is known as a \"sham link\", and it is\n   advertised as a link\
    \ in area A.  This makes it look to routers within\n   area A as if the path from\
    \ CE1 to PE1 across the service provider's\n   network to PE2 to CE2 is an intra-area\
    \ path.  Sham links are an\n   OPTIONAL feature of this specification and are\
    \ used only when it is\n   necessary to have the service provider's network treated\
    \ as an\n   intra-area link.  See Section 4.2.7 for further details about the\n\
    \   sham link.\n   The precise details by which a PE determines the type of LSA\
    \ used to\n   advertise a particular route to a CE are specified in Section 4.2.8.\n\
    \   Note that if the VRF is associated with multiple OSPF instances, the\n   type\
    \ of LSA used to advertise the route might be different in\n   different instances.\n\
    \   Note that if a VRF is associated with several OSPF instances, a given\n  \
    \ route may be redistributed into some or all of those OSPF instances,\n   depending\
    \ on the characteristics of each instance.  If redistributed\n   into two or more\
    \ OSPF instances, it may be advertised within each\n   instance using a different\
    \ type of LSA, again depending on the\n   characteristics of each instance.\n"
- title: 4.1.4.  PEs and OSPF Area 0
  contents:
  - "4.1.4.  PEs and OSPF Area 0\n   Within a given OSPF domain, a PE may attach to\
    \ multiple CEs.  Each\n   PE/CE link is assigned (by configuration) to an OSPF\
    \ area.  Any link\n   can be assigned to any area, including area 0.\n   If a\
    \ PE attaches to a CE via a link that is in a non-zero area, then\n   the PE serves\
    \ as an ABR for that area.\n   PEs can thus be considered OSPF \"area 0 routers\"\
    , i.e., they can be\n   considered part of the \"OSPF backbone\".  Thus, they\
    \ are allowed to\n   distribute inter-area routes to the CE via Type 3 LSAs.\n\
    \   If the OSPF domain has any area 0 routers other than the PE routers,\n   then\
    \ at least one of those MUST be a CE router and MUST have an area\n   0 link to\
    \ at least one PE router.  This adjacency MAY be via an OSPF\n   virtual link.\
    \  (The ability to use an OSPF virtual link in this way\n   is an OPTIONAL feature.)\
    \  This is necessary to ensure that inter-area\n   routes and AS-external routes\
    \ can be leaked between the PE routers\n   and the non-PE OSPF backbone.\n   Two\
    \ sites that are not in the same OSPF area will see the VPN\n   backbone as being\
    \ an integral part of the OSPF backbone.  However, if\n   there are area 0 routers\
    \ that are NOT PE routers, then the VPN\n   backbone actually functions as a sort\
    \ of higher-level backbone,\n   providing a third level of hierarchy above area\
    \ 0.  This allows a\n   legacy OSPF backbone to become disconnected during a transition\n\
    \   period, as long as the various segments all attach to the VPN\n   backbone.\n"
- title: 4.1.5.  Prevention of Loops
  contents:
  - "4.1.5.  Prevention of Loops\n   If a route sent from a PE router to a CE router\
    \ could then be\n   received by another PE router from one of its own CE routers,\
    \ it\n   would be possible for routing loops to occur.  To prevent this, a PE\n\
    \   sets the DN bit [OSPF-DN] in any LSA that it sends to a CE, and a PE\n   ignores\
    \ any LSA received from a CE that already has the DN bit sent.\n   Older implementations\
    \ may use an OSPF Route Tag instead of the DN\n   bit, in some cases.  See Sections\
    \ 4.2.5.1 and 4.2.5.2.\n"
- title: 4.2.  Details
  contents:
  - '4.2.  Details

    '
- title: 4.2.1.  Independent OSPF Instances in PEs
  contents:
  - "4.2.1.  Independent OSPF Instances in PEs\n   The PE MUST support one OSPF instance\
    \ for each OSPF domain to which\n   it attaches.  These OSPF instances function\
    \ independently and do not\n   leak routes to each other.  Each instance of OSPF\
    \ MUST be associated\n   with a single VRF.  If n CEs associated with that VRF\
    \ are running\n   OSPF on their respective PE/CE links, then those n CEs are OSPF\n\
    \   adjacencies of the PE in the corresponding instance of OSPF.\n   Generally,\
    \ though not necessarily, if the PE attaches to several CEs\n   in the same OSPF\
    \ domain, it will associate the interfaces to those\n   PEs with a single VRF.\n"
- title: 4.2.2.  Router ID
  contents:
  - "4.2.2.  Router ID\n   If a PE and a CE are communicating via OSPF, the PE will\
    \ have an OSPF\n   Router ID that is valid (i.e., unique) within the OSPF domain.\
    \  More\n   precisely, each OSPF instance has a Router ID.  Different OSPF\n \
    \  instances may have different Router IDs.\n"
- title: 4.2.3.  OSPF Areas
  contents:
  - "4.2.3.  OSPF Areas\n   A PE-CE link may be in any area, including area 0; this\
    \ is a matter\n   of the OSPF configuration.\n   If a PE has a link that belongs\
    \ to a non-zero area, the PE functions\n   as an Area Border Router (ABR) for\
    \ that area.\n   PEs do not pass along the link state topology from one site to\n\
    \   another (except in the case where a sham link is used; see Section\n   4.2.7).\n\
    \   Per [OSPFv2, Section 3.1], \"the OSPF backbone always contains all\n   area\
    \ border routers\".  The PE routers are therefore considered area 0\n   routers.\
    \  Section 3.1 of [OSPFv2] also requires that area 0 be\n   contiguous.  It follows\
    \ that if the OSPF domain has any area 0\n   routers other than the PE routers,\
    \ at least one of those MUST be a CE\n   router, and it MUST have an area 0 link\
    \ (possibly a virtual link) to\n   at least one PE router.\n"
- title: 4.2.4.  OSPF Domain Identifiers
  contents:
  - "4.2.4.  OSPF Domain Identifiers\n   Each OSPF instance MUST be associated with\
    \ one or more Domain\n   Identifiers.  This MUST be configurable, and the default\
    \ value (if\n   none is configured) SHOULD be NULL.\n   If an OSPF instance has\
    \ multiple Domain Identifiers, one of these is\n   considered its \"primary\"\
    \ Domain Identifier; this MUST be determinable\n   by configuration.  If an OSPF\
    \ instance has exactly one Domain\n   Identifier, this is of course its primary\
    \ Domain Identifier.  If an\n   OSPF instance has more than one Domain Identifier,\
    \ the NULL Domain\n   Identifier MUST NOT be one of them.\n   If a route is installed\
    \ in a VRF by a particular OSPF instance, the\n   primary Domain Identifier of\
    \ that OSPF instance is considered the\n   route's Domain Identifier.\n   Consider\
    \ a route, R, that is installed in a VRF by OSPF instance I1,\n   then redistributed\
    \ into BGP as a VPN-IPv4 route, and then installed\n   by BGP in another VRF.\
    \  If R needs to be redistributed into OSPF\n   instance I2, associated with the\
    \ latter VRF, the way in which R is\n   advertised in I2 will depend upon whether\
    \ R's Domain Identifier is\n   one of I2's Domain Identifiers.  If R's Domain\
    \ Identifier is not one\n   of I2's Domain Identifiers, then, if R is redistributed\
    \ into I2, R\n   will be advertised as an AS-external route, no matter what its\
    \ OSPF\n   route type is.  If, on the other hand, R's Domain Identifier is one\n\
    \   of I2's Domain Identifiers, how R is advertised will depend upon R's\n   OSPF\
    \ route type.\n   If two OSPF instances are in the same OSPF domain, then either:\n\
    \      1. They both have the NULL Domain Identifier, OR\n      2. Each OSPF instance\
    \ has the primary Domain Identifier of the\n         other as one of its own Domain\
    \ Identifiers.\n   If two OSPF instances are in different OSPF domains, then either:\n\
    \      3. They both have the NULL Domain Identifier, OR\n      4. Neither OSPF\
    \ instance has the Primary Domain Identifier of the\n         other as one of\
    \ its own Domain Identifiers.\n   (Note that if two OSPF instances each have the\
    \ NULL Domain\n   Identifier, we cannot tell from the Domain Identifier whether\
    \ they\n   are in the same OSPF Domain.  If they are in different domains, and\n\
    \   if routes from one are distributed into the other, the routes will\n   appear\
    \ as intra-network routes, which may not be what is intended.)\n   A Domain Identifier\
    \ is an eight-byte quantity that is a valid BGP\n   Extended Communities attribute,\
    \ as specified in Section 4.2.4.  If a\n   particular OSPF instance has a non-NULL\
    \ Domain Identifier, when\n   routes from that OSPF instance are distributed by\
    \ BGP as VPN-IPv4\n   routes, the routes MUST carry the Domain Identifier Extended\n\
    \   Communities attribute that corresponds to the OSPF instance's Primary\n  \
    \ Domain Identifier.  If the OSPF instance's Domain Identifier is NULL,\n   the\
    \ Domain Identifier Extended Communities attribute MAY be omitted\n   when routes\
    \ from that OSPF instance are distributed by BGP;\n   alternatively, a value of\
    \ the Domain Identifier Extended Communities\n   attribute that represents NULL\
    \ (see Section 4.2.4) MAY be carried\n   with the route.\n   If the OSPF instances\
    \ of an OSPF domain are given one or more non-\n   NULL Domain Identifiers, this\
    \ procedure allows us to determine\n   whether a particular OSPF-originated VPN-IPv4\
    \ route belongs to the\n   same domain as a given OSPF instance.  We can then\
    \ determine whether\n   the route should be redistributed to that OSPF instance\
    \ as an inter-\n   area route or as an OSPF AS-external route.  Details can be\
    \ found in\n   Sections 4.2.4 and 4.2.8.1.\n"
- title: 4.2.5.  Loop Prevention
  contents:
  - '4.2.5.  Loop Prevention

    '
- title: 4.2.5.1.  The DN Bit
  contents:
  - "4.2.5.1.  The DN Bit\n   When a type 3 LSA is sent from a PE router to a CE router,\
    \ the DN bit\n   [OSPF-DN] in the LSA Options field MUST be set.  This is used\
    \ to\n   ensure that if any CE router sends this type 3 LSA to a PE router,\n\
    \   the PE router will not redistribute it further.\n   When a PE router needs\
    \ to distribute to a CE router a route that\n   comes from a site outside the\
    \ latter's OSPF domain, the PE router\n   presents itself as an ASBR (Autonomous\
    \ System Border Router), and\n   distributes the route in a type 5 LSA.  The DN\
    \ bit [OSPF-DN] MUST be\n   set in these LSAs to ensure that they will be ignored\
    \ by any other PE\n   routers that receive them.\n   There are deployed implementations\
    \ that do not set the DN bit, but\n   instead use OSPF route tagging to ensure\
    \ that a type 5 LSA generated\n   by a PE router will be ignored by any other\
    \ PE router that may\n   receive it.  A special OSPF route tag, which we will\
    \ call the VPN\n   Route Tag (see Section 4.2.5.2), is used for this purpose.\
    \  To ensure\n   backward compatibility, all implementations adhering to this\n\
    \   specification MUST by default support the VPN Route Tag procedures\n   specified\
    \ in Sections 4.2.5.2, 4.2.8.1, and 4.2.8.2.  When it is no\n   longer necessary\
    \ to use the VPN Route Tag in a particular deployment,\n   its use (both sending\
    \ and receiving) may be disabled by\n   configuration.\n"
- title: 4.2.5.2.  Use of OSPF Route Tags
  contents:
  - "4.2.5.2.  Use of OSPF Route Tags\n   If a particular VRF in a PE is associated\
    \ with an instance of OSPF,\n   then by default it MUST be configured with a special\
    \ OSPF route tag\n   value, which we call the VPN Route Tag.  By default, this\
    \ route tag\n   MUST be included in the Type 5 LSAs that the PE originates (as\
    \ the\n   result of receiving a BGP-distributed VPN-IPv4 route, see Section\n\
    \   4.2.8) and sends to any of the attached CEs.\n   The configuration and inclusion\
    \ of the VPN Route Tag is required for\n   backward compatibility with deployed\
    \ implementations that do not set\n   the DN bit in type 5 LSAs.  The inclusion\
    \ of the VPN Route Tag may be\n   disabled by configuration if it has been determined\
    \ that it is no\n   longer needed for backward compatibility.\n   The value of\
    \ the VPN Route Tag is arbitrary but must be distinct from\n   any OSPF Route\
    \ Tag being used within the OSPF domain.  Its value MUST\n   therefore be configurable.\
    \  If the Autonomous System number of the\n   VPN backbone is two bytes long,\
    \ the default value SHOULD be an\n   automatically computed tag based on that\
    \ Autonomous System number:\n   Tag = <Automatic = 1, Complete = 1, PathLength\
    \ = 01>\n       0 0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 3\
    \ 3\n       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n\
    \      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n   \
    \   |1|1|0|1|     ArbitraryTag      |       AutonomousSystem        |\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \       1 1 0 1 0 0 0 0 0 0 0 0 0 0 0 0 _AS number of the VPN Backbone_\n   If\
    \ the Autonomous System number is four bytes long, then a Route Tag\n   value\
    \ MUST be configured, and it MUST be distinct from any Route Tag\n   used within\
    \ the VPN itself.\n   If a PE router needs to use OSPF to distribute to a CE router\
    \ a route\n   that comes from a site outside the CE router's OSPF domain, the\
    \ PE\n   router SHOULD present itself to the CE router as an Autonomous System\n\
    \   Border Router (ASBR) and SHOULD report such routes as AS-external\n   routes.\
    \  That is, these PE routers originate Type 5 LSAs reporting\n   the extra-domain\
    \ routes as AS-external routes.  Each such Type 5 LSA\n   MUST contain an OSPF\
    \ route tag whose value is that of the VPN Route\n   Tag.  This tag identifies\
    \ the route as having come from a PE router.\n   The VPN Route Tag MUST be used\
    \ to ensure that a Type 5 LSA originated\n   by a PE router is not redistributed\
    \ through the OSPF area to another\n   PE router.\n"
- title: 4.2.5.3.  Other Possible Loops
  contents:
  - "4.2.5.3.  Other Possible Loops\n   The procedures specified in this document\
    \ ensure that if routing\n   information derived from a BGP-distributed VPN-IPv4\
    \ route is\n   distributed into OSPF, it cannot be redistributed back into BGP\
    \ as a\n   VPN-IPv4 route, as long as the DN bit and/or VPN route tag is\n   maintained\
    \ within the OSPF domain.  This does not eliminate all\n   possible sources of\
    \ loops.  For example, if a BGP VPN-IPv4 route is\n   distributed into OSPF, then\
    \ distributed into RIP (where all the\n   information needed to prevent looping\
    \ is lost), and then distributed\n   back into OSPF, then it is possible that\
    \ it could be distributed back\n   into BGP as a VPN-IPv4 route, thereby causing\
    \ a loop.\n   Therefore, extreme care must be taken if there is any mutual\n \
    \  redistribution of routes between the OSPF domain and any third\n   routing\
    \ domain (i.e., not the VPN backbone).  If the third routing\n   domain is a BGP\
    \ domain (e.g., the public Internet), the ordinary BGP\n   loop prevention measures\
    \ will prevent the route from reentering the\n   OSPF domain.\n"
- title: 4.2.6.  Handling LSAs from the CE
  contents:
  - "4.2.6.  Handling LSAs from the CE\n   This section specifies the way in which\
    \ a PE router handles the OSPF\n   LSAs it receives from a CE router.\n   When\
    \ a PE router receives, from a CE router, any LSA with the DN bit\n   [OSPF-DN]\
    \ set, the information from that LSA MUST NOT be used by the\n   route calculation.\
    \  If a Type 5 LSA is received from the CE, and if\n   it has an OSPF route tag\
    \ value equal to the VPN Route Tag (see\n   Section 4.2.5.2), then the information\
    \ from that LSA MUST NOT be used\n   by the route calculation.\n   Otherwise,\
    \ the PE must examine the corresponding VRF.  For every\n   address prefix that\
    \ was installed in the VRF by one of its associated\n   OSPF instances, the PE\
    \ must create a VPN-IPv4 route in BGP.  Each\n   such route will have some of\
    \ the following Extended Communities\n   attributes:\n      -  The OSPF Domain\
    \ Identifier Extended Communities attribute.  If\n         the OSPF instance that\
    \ installed the route has a non-NULL\n         primary Domain Identifier, this\
    \ MUST be present; if that OSPF\n         instance has only a NULL Domain Identifier,\
    \ it MAY be omitted.\n         This attribute is encoded with a two-byte type\
    \ field, and its\n         type is 0005, 0105, or 0205.  For backward compatibility,\
    \ the\n         type 8005 MAY be used as well and is treated as if it were\n \
    \        0005.  If the OSPF instance has a NULL Domain Identifier, and\n     \
    \    the OSPF Domain Identifier Extended Communities attribute is\n         present,\
    \ then the attribute's value field must be all zeroes,\n         and its type\
    \ field may be any of 0005, 0105, 0205, or 8005.\n      -  OSPF Route Type Extended\
    \ Communities Attribute.  This attribute\n         MUST be present.  It is encoded\
    \ with a two-byte type field, and\n         its type is 0306.  To ensure backward\
    \ compatibility, the type\n         8000 SHOULD be accepted as well and treated\
    \ as if it were type\n         0306.  The remaining six bytes of the Attribute\
    \ are encoded as\n         follows:\n            +-------+-------+-------+-------+-------+-------+\n\
    \            |        Area Number            | Route |Options|\n            |\
    \                               | Type  |       |\n            +-------+-------+-------+-------+-------+-------+\n\
    \         *  Area Number: 4 bytes, encoding a 32-bit area number.  For\n     \
    \       AS-external routes, the value is 0.  A non-zero value\n            identifies\
    \ the route as being internal to the OSPF domain,\n            and as being within\
    \ the identified area.  Area numbers are\n            relative to a particular\
    \ OSPF domain.\n         *  OSPF Route Type: 1 byte, encoded as follows:\n   \
    \         ** 1 or 2 for intra-area routes (depending on whether the\n        \
    \       route came from a type 1 or a type 2 LSA).\n            ** 3 for inter-area\
    \ routes.\n            ** 5 for external routes (area number must be 0).\n   \
    \         ** 7 for NSSA routes.\n         Note that the procedures of Section\
    \ 4.2.8 do not make any\n         distinction between routes types 1, 2, and 3.\
    \  If BGP installs\n         a route of one of these types in the VRF, and if\
    \ that route is\n         selected for redistribution into OSPF, it will be advertised\
    \ by\n         OSPF in either a type 3 or a type 5 LSA, depending on the\n   \
    \      domain identifier.\n         *  Options: 1 byte.  Currently, this is only\
    \ used if the route\n            type is 5 or 7.  Setting the least significant\
    \ bit in the\n            field indicates that the route carries a type 2 metric.\n\
    \      -  OSPF Router ID Extended Communities Attribute.  This OPTIONAL\n    \
    \     attribute specifies the OSPF Router ID of the system that is\n         identified\
    \ in the BGP Next Hop attribute.  More precisely, it\n         specifies the OSPF\
    \ Router Id of the PE in the OSPF instance\n         that installed the route\
    \ into the VRF from which this route was\n         exported.  This attribute is\
    \ encoded with a two-byte type\n         field, and its type is 0107, with the\
    \ Router ID itself carried\n         in the first 4 bytes of the value field.\
    \  The type 8001 SHOULD\n         be accepted as well, to ensure backward compatibility,\
    \ and\n         should be treated as if it were 0107.\n      -  MED (Multi_EXIT_DISC\
    \ attribute).  By default, this SHOULD be\n         set to the value of the OSPF\
    \ distance associated with the\n         route, plus 1.\n   The intention of all\
    \ this is the following.  OSPF Routes from one\n   site are converted to BGP,\
    \ distributed across the VPN backbone, and\n   possibly converted back to OSPF\
    \ routes before being distributed into\n   another site.  With these attributes,\
    \ BGP carries enough information\n   about the route to enable the route to be\
    \ converted back into OSPF\n   \"transparently\", just as if BGP had not been\
    \ involved.\n   Routes that a PE receives in type 4 LSAs MUST NOT be redistributed\
    \ to\n   BGP.\n   The attributes specified above are in addition to any other\n\
    \   attributes that routes must carry in accordance with [VPN].\n   The Site of\
    \ Origin attribute, which is usually required by [VPN], is\n   OPTIONAL for routes\
    \ that a PE learns from a CE via OSPF.\n   Use of the Site of Origin attribute\
    \ would, in the case of a multiply\n   homed site (i.e., a site attached to several\
    \ PE routers), prevent an\n   intra-site route from being reinjected into a site\
    \ from the VPN\n   backbone.  Such a reinjection would not harm the routing, because\
    \ the\n   route via the VPN backbone would be advertised in a type 3 LSA, and\n\
    \   hence would appear to be an inter-area route; the real intra-area\n   route\
    \ would be preferred.  But unnecessary overhead would be\n   introduced.  On the\
    \ other hand, if the Site of Origin attribute is\n   not used, a partitioned site\
    \ will find itself automatically repaired,\n   since traffic from one partition\
    \ to the other will automatically\n   travel via the VPN backbone.  Therefore,\
    \ the use of a Site of Origin\n   attribute is optional, so that a trade-off can\
    \ be made between the\n   cost of the increased overhead and the value of automatic\
    \ partition\n   repair.\n"
- title: 4.2.7.  Sham Links
  contents:
  - "4.2.7.  Sham Links\n   This section describes the protocol and procedures necessary\
    \ for the\n   support of \"Sham Links,\" as defined herein.  Support for sham\
    \ links\n   is an OPTIONAL feature of this specification.\n"
- title: 4.2.7.1.  Intra-Area Routes
  contents:
  - "4.2.7.1.  Intra-Area Routes\n   Suppose that there are two sites in the same\
    \ OSPF area.  Each site is\n   attached to a different PE router, and there is\
    \ also an intra-area\n   OSPF link connecting the two sites.\n   It is possible\
    \ to treat these two sites as a single VPN site that\n   just happens to be multihomed\
    \ to the backbone.  This is in fact the\n   simplest thing to do and is perfectly\
    \ adequate, provided that the\n   preferred route between the two sites is via\
    \ the intra-area OSPF link\n   (a \"backdoor link\"), rather than via the VPN\
    \ backbone.  There will be\n   routes between sites that go through the PE routers,\
    \ but these routes\n   will appear to be inter-area routes, and OSPF will consider\
    \ them less\n   preferable than the intra-area routes through the backdoor link.\n\
    \   If it is desired to have OSPF prefer the routes through the backbone\n   over\
    \ the routes through the backdoor link, then the routes through\n   the backbone\
    \ must be appear to be intra-area routes.  To make a route\n   through the backbone\
    \ appear to be an intra-area route, it is\n   necessary to make it appear as if\
    \ there is an intra-area link\n   connecting the two PE routers.  This is what\
    \ we refer to as a \"sham\n   link\".  (If the two sites attach to the same PE\
    \ router, this is of\n   course not necessary.)\n   A sham link can be thought\
    \ of as a relation between two VRFs.  If two\n   VRFs are to be connected by a\
    \ sham link, each VRF must be associated\n   with a \"Sham Link Endpoint Address\"\
    , a 32-bit IPv4 address that is\n   treated as an address of the PE router containing\
    \ that VRF.  The Sham\n   Link Endpoint Address is an address in the VPN's address\
    \ space, not\n   the SP's address space.  The Sham Link Endpoint Address associated\n\
    \   with a VRF MUST be configurable.  If the VRF is associated with only\n   a\
    \ single OSPF instance, and if the PE's router id in that OSPF\n   instance is\
    \ an IP address, then the Sham Link Endpoint Address MAY\n   default to that Router\
    \ ID.  If a VRF is associated with several OSPF\n   instances, each sham link\
    \ belongs to a single OSPF instance.\n   For a given OSPF instance, a VRF needs\
    \ only a single Sham Link\n   Endpoint Address, no matter how many sham links\
    \ it has.  The Sham\n   Link Endpoint Address MUST be distributed by BGP as a\
    \ VPN-IPv4\n   address whose IPv4 address prefix part is 32 bits long.  The Sham\n\
    \   Link Endpoint Address MUST NOT be advertised by OSPF; if there is no\n   BGP\
    \ route to the Sham Link Endpoint Address, that address is to\n   appear unreachable,\
    \ so that the sham link appears to be down.\n"
- title: 4.2.7.2.  Creating Sham Links
  contents:
  - "4.2.7.2.  Creating Sham Links\n   Sham links are manually configured.\n   For\
    \ a sham link to exist between two VRFs, each VRF has to be\n   configured to\
    \ create a sham link to the other, where the \"other\" is\n   identified by its\
    \ sham link endpoint address.  No more than one sham\n   link with the same pair\
    \ of sham link endpoint addresses will ever be\n   created.  This specification\
    \ does not include procedures for single-\n   ended manual configuration of the\
    \ sham link.\n   Note that sham links may be created for any area, including area\
    \ 0.\n   A sham link connecting two VRFs is considered up if and only if a\n \
    \  route to the 32-bit remote endpoint address of the sham link has been\n   installed\
    \ in VRF.\n   The sham link endpoint address MUST NOT be used as the endpoint\n\
    \   address of an OSPF Virtual Link.\n"
- title: 4.2.7.3.  OSPF Protocol on Sham Links
  contents:
  - "4.2.7.3.  OSPF Protocol on Sham Links\n   An OSPF protocol packet sent on a Sham\
    \ Link from one PE to another\n   must have as its IP source address the Sham\
    \ Link Endpoint Address of\n   the sender, and as its IP destination address the\
    \ Sham Link Endpoint\n   Address of the receiver.  The packet will travel from\
    \ one PE router\n   to the other over the VPN backbone, which means that it can\
    \ be\n   expected to traverse multiple hops.  As such, its TTL (Time to Live)\n\
    \   field must be set appropriately.\n   An OSPF protocol packet is regarded as\
    \ having been received on a\n   particular sham link if and only if the following\
    \ three conditions\n   hold:\n      -  The packet arrives as an MPLS packet, and\
    \ its MPLS label stack\n         causes it to be \"delivered\" to the local sham\
    \ link endpoint\n         address.\n      -  The packet's IP destination address\
    \ is the local sham link\n         endpoint address.\n      -  The packet's IP\
    \ source address is the remote sham link endpoint\n         address.\n   Sham\
    \ links SHOULD be treated by OSPF as OSPF Demand Circuits.  This\n   means that\
    \ LSAs will be flooded over them, but periodic refresh\n   traffic is avoided.\
    \  Note that, as long as the backdoor link is up,\n   flooding the LSAs over the\
    \ sham link serves no purpose.  However, if\n   the backdoor link goes down, OSPF\
    \ does not have mechanisms enabling\n   the routers in one site to rapidly flush\
    \ the LSAs from the other\n   site.  Therefore, it is still necessary to maintain\
    \ synchronization\n   among the LSA databases at the two sites, hence the flooding\
    \ over the\n   sham link.\n   The sham link is an unnumbered point-to-point intra-area\
    \ link and is\n   advertised as a type 1 link in a type 1 LSA.\n   The OSPF metric\
    \ associated with a sham link MUST be configurable (and\n   there MUST be a configurable\
    \ default).  Whether traffic between the\n   sites flows via a backdoor link or\
    \ via the VPN backbone (i.e., via\n   the sham link) depends on the settings of\
    \ the OSPF link metrics.  The\n   metrics can be set so that the backdoor link\
    \ is not used unless\n   connectivity via the VPN backbone fails, for example.\n\
    \   The default Hello Interval for sham links is 10 seconds, and the\n   default\
    \ Router Dead Interval for sham links is 40 seconds.\n"
- title: 4.2.7.4.  Routing and Forwarding on Sham Links
  contents:
  - "4.2.7.4.  Routing and Forwarding on Sham Links\n   If a PE determines that the\
    \ next hop interface for a particular route\n   is a sham link, then the PE SHOULD\
    \ NOT redistribute that route into\n   BGP as a VPN-IPv4 route.\n   Any other\
    \ route advertised in an LSA that is transmitted over a sham\n   link MUST also\
    \ be redistributed (by the PE flooding the LSA over the\n   sham link) into BGP.\
    \  This means that if the preferred (OSPF) route\n   for a given address prefix\
    \ has the sham link as its next hop\n   interface, then there will also be a \"\
    corresponding BGP route\", for\n   that same address prefix, installed in the\
    \ VRF.  Per Section 4.1.2,\n   the OSPF route is preferred.  However, when forwarding\
    \ a packet, if\n   the preferred route for that packet has the sham link as its\
    \ next hop\n   interface, then the packet MUST be forwarded according to the\n\
    \   corresponding BGP route.  That is, it will be forwarded as if the\n   corresponding\
    \ BGP route had been the preferred route.  The\n   \"corresponding BGP route\"\
    \ is always a VPN-IPv4 route; the procedure\n   for forwarding a packet over a\
    \ VPN-IPv4 route is described in [VPN].\n   This same rule applies to any packet\
    \ whose IP destination address is\n   the remote endpoint address of a sham link.\
    \  Such packets MUST be\n   forwarded according to the corresponding BGP route.\n"
- title: 4.2.8.  VPN-IPv4 Routes Received via BGP
  contents:
  - "4.2.8.  VPN-IPv4 Routes Received via BGP\n   This section describes how the PE\
    \ router handles VPN-IPv4 routes\n   received via BGP.\n   If a received BGP VPN-IPv4\
    \ route is not installed in the VRF, nothing\n   is reported to the CE.  A received\
    \ route will not be installed into\n   the VRF if the BGP decision process regards\
    \ some other route as\n   preferable.  When installed in the VRF, the route appears\
    \ to be an\n   IPv4 route.\n   A BGP route installed in the VRF is not necessarily\
    \ used for\n   forwarding.  If an OSPF route for the same IPv4 address prefix\
    \ has\n   been installed in the VRF, the OSPF route will be used for\n   forwarding,\
    \ except in the case where the OSPF route's next-hop\n   interface is a sham link.\n\
    \   If a BGP route installed in the VRF is used for forwarding, then the\n   BGP\
    \ route is redistributed into OSPF and possibly reported to the CEs\n   in an\
    \ OSPF LSA.  The sort of LSA, if any, to be generated depends on\n   various characteristics\
    \ of the BGP route, as detailed in subsequent\n   sections of this document.\n\
    \   The procedure for forwarding a packet over a VPN-IPv4 route is\n   described\
    \ in [VPN].\n   In the following, we specify what is reported, in OSPF LSAs, by\
    \ the\n   PE to the CE, assuming that the PE is not configured to do any\n   further\
    \ summarization or filtering of the routing information before\n   reporting it\
    \ to the CE.\n   When sending an LSA to the CE, it may be necessary to set the\
    \ DN bit.\n   See Section 4.2.5.1 for the rules regarding the DN bit.\n   When\
    \ sending an LSA to the CE, it may be necessary to set the OSPF\n   Route Tag.\
    \  See Section 4.2.5.2 for the rules about setting the OSPF\n   Route Tag.\n \
    \  When type 5 LSAs are sent, the Forwarding Address is set to 0.\n"
- title: 4.2.8.1.  External Routes
  contents:
  - "4.2.8.1.  External Routes\n   With respect to a particular OSPF instance associated\
    \ with a VRF, a\n   VPN-IPv4 route that is installed in the VRF and then selected\
    \ as the\n   preferred route is treated as an External Route if one of the\n \
    \  following conditions holds:\n      -  The route type field of the OSPF Route\
    \ Type Extended Community\n         has an OSPF route type of \"external\".\n\
    \      -  The route is from a different domain from the domain of the\n      \
    \   OSPF instance.\n   The rules for determining whether a route is from a domain\
    \ different\n   from that of a particular OSPF instance are the following.  The\
    \ OSPF\n   Domain Identifier Extended Communities attribute carried by the route\n\
    \   is compared with the OSPF Domain Identifier Extended Communities\n   attribute(s)\
    \ with which the OSPF instance has been configured (if\n   any).  In general,\
    \ when two such attributes are compared, all eight\n   bytes must be compared.\
    \  Thus, two OSPF Domain Identifier Extended\n   Communities attributes are regarded\
    \ as equal if and only if one of\n   the following three conditions holds:\n \
    \     1. They are identical in all eight bytes.\n      2. They are identical in\
    \ their lower-order six bytes (value\n         field), but one attribute has two\
    \ high-order bytes (type field)\n         of 0005 and the other has two high-order\
    \ bytes (type field) of\n         8005.  (This condition is for backward compatibility.)\n\
    \      3. The lower-order six bytes (value field) of both attributes\n       \
    \  consist entirely of zeroes.  In this case, the two attributes\n         are\
    \ considered identical irrespective of their type fields, and\n         they are\
    \ regarded as representing the NULL Domain Identifier.\n   If a VPN-IPv4 route\
    \ has an OSPF Domain Identifier Extended\n   Communities attribute, we say that\
    \ that route is in the identified\n   domain.  If the value field of the Extended\
    \ Communities attribute\n   consists of all zeroes, then the identified domain\
    \ is the NULL\n   domain, and the route is said to belong to the NULL domain.\
    \  If the\n   route does not have an OSPF Domain Identified Extended Communities\n\
    \   attribute, then the route belongs to the NULL domain.\n   Every OSPF instance\
    \ is associated with one or more Domain\n   Identifiers, though possibly only\
    \ with the NULL domain identifier.\n   If an OSPF instance is associated with\
    \ a particular Domain\n   Identifier, we will say that it belongs to the identified\
    \ domain.\n   If a VPN-IPv4 route is to be redistributed to a particular instance,\n\
    \   it must be determined whether that route and that OSPF instance\n   belong\
    \ to the same domain.  A route and an OSPF instance belong to\n   the same domain\
    \ if and only if one of the following conditions holds:\n      1. The route and\
    \ the OSPF instance each belong to the NULL domain.\n      2. The domain to which\
    \ the route belongs is the domain to which\n         the OSPF instance belongs.\
    \  (That is, the route's Domain\n         Identifier is equal to the OSPF instance's\
    \ domain identifier,\n         as determined by the definitions given earlier\
    \ in this\n         section.)\n   If the route and the VRF do not belong to the\
    \ same domain, the route\n   is treated as an external route.\n   If an external\
    \ route is redistributed into an OSPF instance, the\n   route may or may not be\
    \ advertised to a particular CE, depending on\n   the configuration and on the\
    \ type of area to which the PE/CE link\n   belongs.  If the route is advertised,\
    \ and the PE/CE link belongs to a\n   NSSA area, it is advertised in a type 7\
    \ LSA.  Otherwise, if the route\n   is advertised, it is advertised in a type\
    \ 5 LSA.  The LSA will be\n   originated by the PE.\n   The DN bit (Section 4.2.5.1)\
    \ MUST be set in the LSA.  The VPN Route\n   Tag (see Section 4.2.5.2) MUST be\
    \ placed in the LSA, unless the use\n   of the VPN Route Tag has been turned off\
    \ by configuration.\n   By default, a type 2 metric value is included in the LSA,\
    \ unless the\n   options field of the OSPF Route Type Extended Communities attribute\n\
    \   of the VPN-IPv4 route specifies that the metric should be type 1.\n   By default,\
    \ the value of the metric is taken from the MED attribute\n   of the VPN-IPv4\
    \ route.  If the MED is not present, a default metric\n   value is used.  (The\
    \ default type 1 metric and the default type 2\n   metric MAY be different.)\n\
    \   Note that this way of handling external routes makes every PE appear\n   to\
    \ be an ASBR attached to all the external routes.  In a multihomed\n   site, this\
    \ can result in a number of type 5 LSAs containing the same\n   information.\n"
- title: 4.2.8.2.  Summary Routes
  contents:
  - "4.2.8.2.  Summary Routes\n   If a route and the VRF into which it is imported\
    \ belong to the same\n   domain, then the route should be treated as if it had\
    \ been received\n   in an OSPF type 3 LSA.  This means that the PE will report\
    \ the route\n   in a type 3 LSA to the CE.  (Note that this case is possible even\
    \ if\n   the VPN-IPv4 route carries an area number identical to that of the CE\n\
    \   router.  This means that if an area is \"partitioned\" such that the\n   two\
    \ pieces are connected only via the VPN backbone, it appears to be\n   two areas,\
    \ with inter-area routes between them.)\n"
- title: 4.2.8.3.  NSSA Routes
  contents:
  - "4.2.8.3.  NSSA Routes\n   NSSA routes are treated the same as external routes,\
    \ as described in\n   Section 4.2.8.1.\n"
- title: 5.  IANA Considerations
  contents:
  - "5.  IANA Considerations\n   Section 11 of [EXTCOMM] calls upon IANA to create\
    \ a registry for BGP\n   Extended Communities Type Field and Extended Type Field\
    \ values.\n   Section 4.2.6 of this document assigns new values for the BGP\n\
    \   Extended Communities Extended Type Field.  These values all fall\n   within\
    \ the range of values that [EXTCOMM] states \"are to be assigned\n   by IANA,\
    \ using the 'First Come, First Served' policy defined in RFC\n   2434\".\n   The\
    \ BGP Extended Communities Extended Type Field values assigned in\n   Section\
    \ 4.2.6 of this document are as follows:\n      -  OSPF Domain Identifier: Extended\
    \ Types 0005, 0105, and 0205.\n      -  OSPF Route Type: Extended Type 0306\n\
    \      -  OSPF Router ID: Extended Type 0107\n"
- title: 6.  Security Considerations
  contents:
  - "6.  Security Considerations\n   Security considerations that are relevant in\
    \ general to BGP/MPLS IP\n   VPNS are discussed in [VPN] and [VPN-AS].  We discuss\
    \ here only those\n   security considerations that are specific to the use of\
    \ OSPF as the\n   PE/CE protocol.\n   A single PE may be running OSPF as the IGP\
    \ of the SP backbone\n   network, as well as running OSPF as the IGP of one or\
    \ more VPNs.\n   This requires the use of multiple, independent OSPF instances,\
    \ so\n   that routes are not inadvertently leaked between the backbone and any\n\
    \   VPN.  The OSPF instances for different VPNs must also be independent\n   OSPF\
    \ instances, to prevent inadvertent leaking of routes between\n   VPNs.\n   OSPF\
    \ provides a number of procedures that allow the OSPF control\n   messages between\
    \ a PE and a CE to be authenticated.  OSPF\n   \"cryptographic authentication\"\
    \ SHOULD be used between a PE and a CE.\n   It MUST be implemented on each PE.\n\
    \   In the absence of such authentication, it is possible that the CE\n   might\
    \ not really belong to the VPN to which the PE assigns it.  It\n   may also be\
    \ possible for an attacker to insert spoofed messages on\n   the PE/CE link, in\
    \ either direction.  Spoofed messages sent to the CE\n   could compromise the\
    \ routing at the CE's site.  Spoofed messages sent\n   to the PE could result\
    \ in improper VPN routing, or in a denial-of-\n   service attack on the VPN.\n"
- title: 7.  Acknowledgements
  contents:
  - "7.  Acknowledgements\n   Major contributions to this work have been made by Derek\
    \ Yeung and\n   Yakov Rekhter.\n   Thanks to Ross Callon, Ajay Singhal, Russ Housley,\
    \ and Alex Zinin for\n   their review and comments.\n"
- title: 8.  Normative References
  contents:
  - "8.  Normative References\n   [EXTCOMM] Sangli, S., Tappan, D., and Y. Rekhter,\
    \ \"BGP Extended\n             Communities Attribute\", RFC 4360, February 2006.\n\
    \   [OSPFv2]  Moy, J., \"OSPF Version 2\", STD 54, RFC 2328, April 1998.\n   [OSPF-DN]\
    \ Rosen, E., Psenak, P., and P. Pillay-Esnault, \"Using a Link\n             State\
    \ Advertisement (LSA) Options Bit to Prevent Looping in\n             BGP/MPLS\
    \ IP Virtual Private Networks (VPNs)\", RFC 4576,\n             June 2006.\n \
    \  [RFC2119] Bradner, S., \"Key words for use in RFCs to Indicate\n          \
    \   Requirement Levels\", BCP 14, RFC 2119, March 1997.\n   [VPN]     Rosen, E.\
    \ and Y. Rekhter, \"BGP/MPLS IP Virtual Private\n             Networks (VPNs)\"\
    , RFC 4364, February 2006.\n"
- title: 9.  Informative References
  contents:
  - "9.  Informative References\n   [BGP]     Rekhter, Y., Li, T., and S. Hares, \"\
    A Border Gateway\n             Protocol 4 (BGP-4)\", RFC 4271, January 2006.\n\
    \   [RIP]     Malkin, G., \"RIP Version 2\", STD 56, RFC 2453, November\n    \
    \         1998.\n   [VPN-AS]  Rosen, E., \"Applicability Statement for BGP/MPLS\
    \ IP Virtual\n             Private Networks (VPNs)\", RFC 4365, February 2006.\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Eric C. Rosen\n   Cisco Systems, Inc.\n   1414 Massachusetts\
    \ Avenue\n   Boxborough, MA 01719\n   EMail: erosen@cisco.com\n   Peter Psenak\n\
    \   Cisco Systems\n   BA Business Center, 9th Floor\n   Plynarenska 1\n   Bratislava\
    \ 82109\n   Slovakia\n   EMail: ppsenak@cisco.com\n   Padma Pillay-Esnault\n \
    \  Cisco Systems\n   3750 Cisco Way\n   San Jose, CA 95134\n   EMail: ppe@cisco.com\n"
- title: Full Copyright Statement
  contents:
  - "Full Copyright Statement\n   Copyright (C) The Internet Society (2006).\n   This\
    \ document is subject to the rights, licenses and restrictions\n   contained in\
    \ BCP 78, and except as set forth therein, the authors\n   retain all their rights.\n\
    \   This document and the information contained herein are provided on an\n  \
    \ \"AS IS\" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS\n  \
    \ OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY AND THE INTERNET\n   ENGINEERING\
    \ TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS OR IMPLIED,\n   INCLUDING BUT NOT\
    \ LIMITED TO ANY WARRANTY THAT THE USE OF THE\n   INFORMATION HEREIN WILL NOT\
    \ INFRINGE ANY RIGHTS OR ANY IMPLIED\n   WARRANTIES OF MERCHANTABILITY OR FITNESS\
    \ FOR A PARTICULAR PURPOSE.\n"
- title: Intellectual Property
  contents:
  - "Intellectual Property\n   The IETF takes no position regarding the validity or\
    \ scope of any\n   Intellectual Property Rights or other rights that might be\
    \ claimed to\n   pertain to the implementation or use of the technology described\
    \ in\n   this document or the extent to which any license under such rights\n\
    \   might or might not be available; nor does it represent that it has\n   made\
    \ any independent effort to identify any such rights.  Information\n   on the\
    \ procedures with respect to rights in RFC documents can be\n   found in BCP 78\
    \ and BCP 79.\n   Copies of IPR disclosures made to the IETF Secretariat and any\n\
    \   assurances of licenses to be made available, or the result of an\n   attempt\
    \ made to obtain a general license or permission for the use of\n   such proprietary\
    \ rights by implementers or users of this\n   specification can be obtained from\
    \ the IETF on-line IPR repository at\n   http://www.ietf.org/ipr.\n   The IETF\
    \ invites any interested party to bring to its attention any\n   copyrights, patents\
    \ or patent applications, or other proprietary\n   rights that may cover technology\
    \ that may be required to implement\n   this standard.  Please address the information\
    \ to the IETF at\n   ietf-ipr@ietf.org.\n"
- title: Acknowledgement
  contents:
  - "Acknowledgement\n   Funding for the RFC Editor function is provided by the IETF\n\
    \   Administrative Support Activity (IASA).\n"
