- contents:
  - '          Return Path Specified Label Switched Path (LSP) Ping

    '
  title: __initial_text__
- contents:
  - "Abstract\n   This document defines extensions to the data-plane failure-detection\n
    \  protocol for Multiprotocol Label Switching (MPLS) Label Switched\n   Paths
    (LSPs) known as \"LSP ping\".  These extensions allow a selection\n   of the LSP
    to be used for the echo reply return path.  Enforcing a\n   specific return path
    can be used to verify bidirectional connectivity\n   and also increase LSP ping
    robustness.\n"
  title: Abstract
- contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This
    document is a product of the Internet Engineering Task Force\n   (IETF).  It represents
    the consensus of the IETF community.  It has\n   received public review and has
    been approved for publication by the\n   Internet Engineering Steering Group (IESG).
    \ Further information on\n   Internet Standards is available in Section 2 of RFC
    5741.\n   Information about the current status of this document, any errata,\n
    \  and how to provide feedback on it may be obtained at\n   http://www.rfc-editor.org/info/rfc7110.\n"
  title: Status of This Memo
- contents:
  - "Copyright Notice\n   Copyright (c) 2014 IETF Trust and the persons identified
    as the\n   document authors.  All rights reserved.\n   This document is subject
    to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n
    \  (http://trustee.ietf.org/license-info) in effect on the date of\n   publication
    of this document.  Please review these documents\n   carefully, as they describe
    your rights and restrictions with respect\n   to this document.  Code Components
    extracted from this document must\n   include Simplified BSD License text as described
    in Section 4.e of\n   the Trust Legal Provisions and are provided without warranty
    as\n   described in the Simplified BSD License.\n"
  title: Copyright Notice
- contents:
  - "Table of Contents\n   1. Introduction ....................................................3\n
    \  2. Requirements Language ...........................................3\n   3.
    Problem Statements and Solution Overview ........................3\n      3.1.
    Limitations of Existing Mechanisms for Bidirectional LSPs ..4\n      3.2. Limitations
    of Existing Mechanisms for Handling\n           Unreliable Return Paths ....................................4\n
    \  4. Extensions ......................................................5\n      4.1.
    Reply via Specified Path Mode ..............................6\n      4.2. Reply
    Path (RP) TLV ........................................6\n      4.3. Tunnel Sub-TLVs
    ............................................8\n           4.3.1. IPv4 RSVP Tunnel
    Sub-TLV ...........................10\n           4.3.2. IPv6 RSVP Tunnel Sub-TLV
    ...........................11\n           4.3.3. Static Tunnel Sub-TLV ..............................12\n
    \     4.4. Reply TC TLV ..............................................12\n   5.
    Theory of Operation ............................................13\n      5.1.
    Sending an Echo Request ...................................14\n      5.2. Receiving
    an Echo Request .................................14\n      5.3. Sending an Echo
    Reply .....................................15\n      5.4. Receiving an Echo Reply
    ...................................16\n      5.5. Non-IP Encapsulation for MPLS-TP
    LSPs .....................16\n   6. Security Considerations ........................................16\n
    \  7. IANA Considerations ............................................17\n      7.1.
    TLVs ......................................................17\n      7.2. New
    Target FEC Stack Sub-TLVs .............................17\n      7.3. New Reply
    Mode ............................................17\n      7.4. Reply Path Return
    Code ....................................18\n   8. Contributors ...................................................19\n
    \  9. Acknowledgements ...............................................19\n   10.
    References ....................................................19\n      10.1.
    Normative References .....................................19\n      10.2. Informative
    References ...................................20\n"
  title: Table of Contents
- contents:
  - "1.  Introduction\n   This document defines extensions to the data-plane failure-detection\n
    \  protocol for Multiprotocol Label Switching (MPLS) Label Switched\n   Paths
    (LSPs) known as \"LSP ping\" [RFC4379] that can be used to\n   specify the return
    paths for the echo reply message, increasing the\n   robustness of LSP ping, reducing
    the opportunity for error, and\n   improving the reliability of the echo reply
    message.  A new Reply\n   Mode, which is referred to as \"Reply via Specified
    Path\", is added\n   and a new Type-Length-Value (TLV), which is referred to as
    \"Reply\n   Path (RP) TLV\", is defined in this memo.  The procedures defined
    in\n   this document currently only apply to \"ping\" mode.  The \"traceroute\"\n
    \  mode is out of scope for this document.\n   In this document, the term bidirectional
    LSP includes the co-routed\n   bidirectional LSP defined in [RFC3945] and the
    associated\n   bidirectional LSP that is constructed from a pair of unidirectional\n
    \  LSPs (one for each direction) that are associated with one another at\n   the
    LSP's ingress/egress points [RFC5654].  The mechanisms defined in\n   this document
    can apply to both IP/MPLS and MPLS Transport Profile\n   (MPLS-TP) scenarios.\n"
  title: 1.  Introduction
- contents:
  - "2.  Requirements Language\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\",
    \"SHALL\", \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"MAY\",
    and \"OPTIONAL\" in this\n   document are to be interpreted as described in [RFC2119].\n"
  title: 2.  Requirements Language
- contents:
  - "3.  Problem Statements and Solution Overview\n   MPLS LSP ping is defined in
    [RFC4379].  It can be used to detect\n   data-path failures in all MPLS LSPs.\n
    \  LSPs are increasingly being deployed to provide bidirectional\n   services.
    \ The co-routed bidirectional LSP is defined in [RFC3945],\n   and the associated
    bidirectional LSP is defined in [RFC5654].  With\n   the deployment of such services,
    operators have a desire to test both\n   directions of a bidirectional LSP in
    a single operation.\n   Additionally, when testing a single direction of an LSP
    (either a\n   unidirectional LSP or a single direction of a bidirectional LSP)\n
    \  using LSP ping, the validity of the result may be affected by the\n   success
    of delivering the echo reply message.  Failure to exchange\n   these messages
    between the egress Label Switching Router (LSR) and\n   the ingress LSR can lead
    to false negatives where the LSP under test\n   is reported as \"down\" even though
    it is functioning correctly.\n"
  - contents:
    - "3.1.  Limitations of Existing Mechanisms for Bidirectional LSPs\n   With the
      existing LSP ping mechanisms, as defined in [RFC4379],\n   operators have to
      enable LSP detection on each of the two ends of a\n   bidirectional LSP independently.
      \ This not only doubles the workload\n   for the operators but may also bring
      additional difficulties when\n   checking the backward direction of the LSP
      under the following\n   condition:\n      The LSR that the operator logged on
      to perform the checking\n      operations might not have out-of-band connectivity
      to the LSR at\n      the far end of the LSP.  That can mean it is not possible
      to check\n      the return direction of a bidirectional LSP in a single operation\n
      \     -- the operator must log on to the LSR at the other end of the LSP\n      to
      test the return direction.\n   Associated bidirectional LSPs have the same issues
      as those listed\n   for co-routed bidirectional LSPs.\n   This document defines
      a mechanism to allow the operator to request\n   that both directions of a bidirectional
      LSP be tested by a single LSP\n   ping message exchange.\n"
    title: 3.1.  Limitations of Existing Mechanisms for Bidirectional LSPs
  - contents:
    - "3.2.  Limitations of Existing Mechanisms for Handling Unreliable Return\n      Paths\n
      \  [RFC4379] defines four Reply Modes:\n   1. Do not reply\n   2. Reply via
      an IPv4/IPv6 UDP packet\n   3. Reply via an IPv4/IPv6 UDP packet with Router
      Alert\n   4. Reply via application level control channel\n   Obviously, the
      issue of the reliability of the return path for an\n   echo reply message does
      not apply in the first of these cases.\n   [RFC4379] states that the third mode
      may be used when the IP return\n   path is deemed unreliable.  This mode of
      operation requires that all\n   intermediate nodes support the Router Alert
      option and understand how\n   to forward MPLS echo replies.  This is a rigorous
      requirement in\n   deployed IP/MPLS networks, especially since the return path
      may be\n   through legacy IP-only routers.\n   In any case, the use of Reply
      Modes 2 or 3 cannot guarantee the\n   delivery of echo responses through an
      IP network that is\n   fundamentally unreliable.  The failure to deliver echo
      response\n   messages can lead to false negatives, making it appear that the
      LSP\n   has failed.\n   Allowing the ingress LSR to control the path used for
      echo reply\n   messages enables an operator to apply an extra level of deterministic\n
      \  process to the LSP ping test.  For example, when testing an LSP,\n   Reply
      Mode 2 is used at the beginning but no echo reply is received.\n   When failure
      of the return path is suspected, the operator can\n   initiate another LSP ping
      with the Reply Mode defined in this\n   document and specify a different return
      path that is deemed workable\n   to complete the test.\n   This document defines
      extensions to LSP ping that can be used to\n   specify the return paths of the
      echo reply message in an echo request\n   message.\n"
    title: 3.2.  Limitations of Existing Mechanisms for Handling Unreliable Return
  title: 3.  Problem Statements and Solution Overview
- contents:
  - "4.  Extensions\n   LSP ping, defined in [RFC4379], is carried out by sending
    an echo\n   request message.  It carries the Forwarding Equivalence Class (FEC)\n
    \  information of the LSP being tested.  The FEC information indicates\n   which
    MPLS path is being verified along the same data path as other\n   normal data
    packets belonging to the FEC.\n   LSP ping [RFC4379] defines four Reply Modes
    that are used to direct\n   the egress LSR in how to send back an echo reply.
    \ This document\n   defines a new Reply Mode, the \"Reply via Specified Path\"
    mode.  This\n   new mode is used to direct the egress LSR of the tested LSP to
    send\n   the echo reply message back along the path specified in the echo\n   request
    message.\n   In addition, two new TLVs, the \"Reply Path (RP) TLV\" and \"Reply\n
    \  Traffic Class (TC) TLV\" [RFC5462], are defined in this document.  The\n   Reply
    Path TLV contains one or more nested sub-TLVs that can be used\n   to carry the
    specified return path information to be used by the echo\n   reply message.\n"
  - contents:
    - "4.1.  Reply via Specified Path Mode\n   A new Reply Mode is defined to be carried
      in the Reply Mode field of\n   the echo request message.\n   The value of the
      Reply via Specified Path mode is 5 (This has been\n   allocated by IANA using
      early allocation and is to be confirmed by\n   IANA).\n       Value    Meaning\n
      \      -----    -------\n           5     Reply via Specified Path\n   The Reply
      via Specified Path mode is used to request that the remote\n   LSR receiving
      the echo request message sends back the echo reply\n   message along the specified
      paths carried in the Reply Path TLV.\n"
    title: 4.1.  Reply via Specified Path Mode
  - contents:
    - "4.2.  Reply Path (RP) TLV\n   The Reply Path (RP) TLV is an optional TLV within
      the LSP ping\n   protocol.  However, if the Reply via Specified Path mode requested,\n
      \  as described in Section 4.1, the Reply Path (RP) TLV MUST be included\n   in
      an echo request message, and its absence is treated as a malformed\n   echo
      request, as described in [RFC4379].  Furthermore, if a Reply\n   Path (RP) TLV
      is included in an echo request message, a Reply Path\n   (RP) TLV MUST be included
      in the corresponding echo reply message\n   sent by an implementation that is
      conformant to this specification.\n   The Reply Path (RP) TLV carries the specified
      return path that the\n   echo reply message is required to follow.  The format
      of Reply Path\n   TLV is as follows:\n        0                   1                   2
      \                  3\n        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2
      3 4 5 6 7 8 9 0 1\n       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \      |     Reply Path TLV Type       |          Length               |\n       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \      |    Reply Path return code     |           Flags               |\n       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \      |                          Reply Path                           |\n       ~
      \                                                              ~\n       |                                                               |\n
      \      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n                           Figure
      1: Reply Path TLV\n   Reply Path TLV Type:  It is 2 octets in length, and the
      type value is\n      21.\n   Length:  It is 2 octets in length.  It defines
      the length in octets\n      of the Reply Path return code, Flags, and Reply
      Path fields.\n   Reply Path return code:  The Reply Path return code field is
      2 octets\n      in length.  It is defined for the egress LSR of the forward
      LSP to\n      report the results of Reply Path TLV processing and return path\n
      \     selection.  This field MUST be set to zero in a Reply Path TLV\n      carried
      on an echo request message and MUST be ignored on receipt.\n      This document
      defines the following Reply Path return codes for\n      inclusion in a Reply
      Path TLV carried on an echo reply:\n   Value         Meaning\n   ------        ----------------------\n
      \  0x0000        Reserved, MUST NOT be used\n   0x0001        Malformed Reply
      Path TLV was received\n   0x0002        One or more of the sub-TLVs in the Reply
      Path TLV\n                 were not understood\n   0x0003        The echo reply
      was sent successfully using the\n                 specified Reply Path\n   0x0004
      \       The specified Reply Path was not found, the echo\n                 reply
      was sent via another LSP\n   0x0005        The specified Reply Path was not
      found, the echo\n                 reply was sent via pure IP forwarding (non-MPLS)\n
      \                path\n   0x0006-0xfffb Unassigned\n   0xfffc-0xffff Experimental
      Use\n   Flags:  It is also 2 octets in length, it is used to notify the\n      egress
      how to process the Reply Paths field when performing return\n      path selection.
      \ The Flags field is a bit vector and has following\n      format:\n           +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \          |      MUST be zero         |A|B|\n           +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \                   Figure 2:  Flags\n         A (Alternative path): the egress
      LSR MUST select a non-default\n         path as the return path.  This is very
      useful when reverse\n         default path problems are suspected that can be
      confirmed when\n         the echo reply is forced to follow a non-default return
      path.\n         Here, the default path refers to the path that the egress LSR\n
      \        will use to send the echo reply when Reply Mode 2 or 3 is used.\n         If
      A bit is set, there is no need to carry any specific reply\n         path sub-TLVs,
      and when received, the sub-TLVs SHOULD be\n         ignored.\n         B (Bidirectional):
      the return path is required to follow the\n         reverse direction of the
      tested bidirectional LSP.  If B bit is\n         set, there is no need to carry
      any specific reply path sub-\n         TLVs, and when received, the sub-TLVs
      SHOULD be ignored.\n         The A flag and B flag MUST NOT both be set, otherwise,
      an echo\n         reply with the RP return code set to \"Malformed Reply Path
      TLV\n         was received\" MUST be returned.\n   Reply Path:  It is used to
      describe the return path that an echo\n      reply will be send along.  It is
      variable in length and can\n      contain zero, one or more Target FEC sub-TLVs
      [RFC4379].  In an\n      echo request, it carries sub-TLVs that describe the
      specified path\n      that the echo reply message is required to follow.  In
      an echo\n      reply, the sub-TLVs describe the FEC Stack information of the\n
      \     return path (when the return path is an MPLS path) that the echo\n      reply
      will be sent along.\n"
    title: 4.2.  Reply Path (RP) TLV
  - contents:
    - "4.3.  Tunnel Sub-TLVs\n   [RFC4379] has already defined several Target FEC
      sub-TLVs, the Target\n   FEC sub-TLVs provide a good way to identify a specific
      return path.\n   The Reply Path TLV can carry any (existing and future defined)
      sub-\n   TLV defined for use in the Target FEC Stack TLV to specify the return\n
      \  path.\n   This document defines three new Target FEC sub-TLVs: IPv4 RSVP
      Tunnel\n   sub-TLV, IPv6 RSVP Tunnel sub-TLV, and Static Tunnel sub-TLV.  One\n
      \  usage of these generic RSVP Tunnel sub-TLVs is when LSP ping is used\n   to
      periodically verify the control plane against the data plane\n   [RFC5884],
      using a Tunnel other than a particular LSP can avoid the\n   impact of an LSP
      identifier changing when Make-Before-Break (MBB) is\n   deployed.  These sub-TLVs
      also can be used in the Reply Path TLV to\n   allow the operator to specify
      a more generic tunnel FEC other than a\n   particular LSP as the return path.\n
      \  No assignments of sub-TLVs are made directly for TLV Type 21, the\n   sub-TLV
      space and assignments for TLV Type 21 will be the same as\n   that for TLV Type
      1.  Sub-types for TLV Type 1 and TLV Type 21 MUST\n   be kept the same.  Any
      new sub-type added to TLV Type 1 MUST apply to\n   the TLV Type 21 as well.\n
      \  With the Return Path TLV flags and the sub-TLVs defined for the\n   Target
      FEC Stack TLV and in this document, it could provide the\n   following options
      for return paths specifying:\n   1.  a particular LSP as return path\n          -
      use those sub-TLVs defined for the Target FEC Stack TLV\n   2.  a more generic
      tunnel FEC as return path\n          - use the IPv4/IPv6 RSVP and Static Tunnel
      sub-TLVs defined in\n            Sections Section 4.3.1, Section 4.3.2, and
      Section 4.3.3 of\n            this document\n   3.  the reverse path of the
      bidirectional LSP as return path\n          - use B bit defined in Section 4.2
      of this document.\n   4.  Force return path to non-default path\n          -
      use A bit defined in Section 4.2 of this document.\n"
    - contents:
      - "4.3.1.  IPv4 RSVP Tunnel Sub-TLV\n   The format of the IPv4 RSVP Tunnel sub-TLV
        is as follows:\n    0                   1                   2                   3\n
        \   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
        \  | IPv4 RSVP Tunnel sub-TLV Type |        Length                 |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
        \  |                 IPv4 tunnel end point address                 |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
        \  |              Flags            |     Tunnel ID                 |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
        \  |                       Extended Tunnel ID                      |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
        \  |                   IPv4 tunnel sender address                  |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
        \                   Figure 3: IPv4 RSVP Tunnel Sub-TLV\n   The IPv4 RSVP Tunnel
        sub-TLV is derived from the RSVP IPv4 FEC TLV\n   that is defined in Section
        3.2.3 of [RFC4379].  All fields have the\n   same semantics as defined in
        [RFC4379] except that the LSP-ID field\n   is omitted and a new Flags field
        is defined.\n   The IPv4 RSVP Tunnel sub-TLV Type field is 2 octets in length,
        and\n   the recommended type value is 26.\n   The Flags field is 2 octets
        in length, it is used to notify the\n   egress LSR how to choose the return
        path.  The Flags field is a bit\n   vector and has following format:\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
        \  |         MUST be zero      |S|P|\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
        \     Figure 4: Tunnel Flags\n   P (Primary): the return path MUST be chosen
        from the LSPs that belong\n   to the specified Tunnel and the LSP MUST be
        the primary LSP.\n   S (Secondary): the return path MUST be chosen from the
        LSPs that\n   belong to the specified Tunnel and the LSP MUST be the secondary
        LSP.\n   Primary and secondary LSPs are defined in [RFC4872].\n   P bit and
        S bit MUST NOT both be set, otherwise, an echo reply with\n   the RP return
        code set to \"Malformed Reply Path TLV was received\"\n   SHOULD be returned.
        \ If P bit and S bit are both not set, the return\n   path could be any one
        of the LSPs from the same Tunnel.\n"
      title: 4.3.1.  IPv4 RSVP Tunnel Sub-TLV
    - contents:
      - "4.3.2.  IPv6 RSVP Tunnel Sub-TLV\n   The format of the IPv6 RSVP Tunnel sub-TLV
        is as follows:\n    0                   1                   2                   3\n
        \   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
        \  | IPv6 RSVP Tunnel sub-TLV Type |        Length                 |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
        \  |                 IPv6 tunnel end point address                 |\n   |
        \                                                              |\n   |                                                               |\n
        \  |                                                               |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
        \  |              Flags            |     Tunnel ID                 |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
        \  |                       Extended Tunnel ID                      |\n   |
        \                                                              |\n   |                                                               |\n
        \  |                                                               |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
        \  |                   IPv6 tunnel sender address                  |\n   |
        \                                                              |\n   |                                                               |\n
        \  |                                                               |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
        \                   Figure 5: IPv6 RSVP Tunnel Sub-TLV\n   The IPv6 RSVP Tunnel
        sub-TLV is derived from the RSVP IPv6 FEC TLV\n   that is defined in Section
        3.2.4 of [RFC4379].  All fields have the\n   same semantics as defined in
        [RFC4379] except that the LSP-ID field\n   is omitted and a new Flags field
        is defined.\n   The IPv6 RSVP Tunnel sub-TLV Type field is 2 octets in length,
        and\n   the type value is 27.\n   The Flags field is 2 octets in length and
        is identical to that\n   described in Section 4.3.1.\n"
      title: 4.3.2.  IPv6 RSVP Tunnel Sub-TLV
    - contents:
      - "4.3.3.  Static Tunnel Sub-TLV\n   The format of the Static RSVP Tunnel sub-TLV
        is as follows.  The\n   value fields are taken from the definitions in [RFC6370].\n
        \   0                   1                   2                   3\n    0 1
        2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
        \  |    Static Tunnel sub-TLV Type |        Length                 |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
        \  |                        Source Global ID                       |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
        \  |                        Source Node ID                         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
        \  |                        Destination Global ID                  |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
        \  |                        Destination Node ID                    |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
        \  |       Source Tunnel Num       |     Destination Tunnel Num    |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
        \  |              Flags            |     Must Be Zero              |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
        \                    Figure 6: Static Tunnel Sub-TLV\n   The Flags field is
        2 octets in length and is identical to that\n   described in Section 4.3.1.\n
        \  The sub-TLV type value is 28.\n"
      title: 4.3.3.  Static Tunnel Sub-TLV
    title: 4.3.  Tunnel Sub-TLVs
  - contents:
    - "4.4.  Reply TC TLV\n   Reply TOS Byte TLV [RFC4379] is used by the originator
      of the echo\n   request to request that an echo reply be sent with the IP header
      TOS\n   byte set to the value specified in the TLV.  Similarly, in this\n   document,
      a new TLV, Reply TC TLV, is defined and MAY be used by the\n   originator of
      the echo request to request that an echo reply be sent\n   with the TC bits
      of the return path LSP set to the value specified in\n   this TLV.  The Reply
      TC TLV is not limited to the Reply Mode\n   specified in this document (Reply
      via Specified Path) but may be used\n   in all the other Reply Modes as well.
      \ The format of Reply TC TLV is\n   as follows:\n    0                   1                   2
      \                  3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4
      5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  |      Reply TC TLV type        |          Length               |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \  | TC  |                    MUST be zero                         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \                     Figure 7: Reply TC TLV\n   The Reply TC TLV Type field
      is 2 octets in length, and the type value\n   is 22.\n   The Length field is
      2 octets in length, the value of length field is\n   fixed 4 octets.\n"
    title: 4.4.  Reply TC TLV
  title: 4.  Extensions
- contents:
  - "5.  Theory of Operation\n   The procedures defined in this document currently
    only apply to\n   \"ping\" mode.  The \"traceroute\" mode is out of scope for
    this\n   document.\n   In [RFC4379], the echo reply is used to report the LSP
    checking\n   result to the LSP ping initiator.  This document defines a new Reply\n
    \  Mode and a new TLV (Reply Path TLV) that enable the LSP ping\n   initiator
    to specify or constrain the return path of the echo reply.\n   Similarly, the
    behavior of echo reply is extended to detect the\n   requested return path by
    looking at a specified path FEC TLV.  This\n   enables LSP ping to detect failures
    in both directions of a path with\n   a single operation; of course, this cuts
    in half the operational\n   steps required to verify the end-to-end bidirectional
    connectivity\n   and integrity of an LSP.\n   When the return path is an MPLS
    path, the echo reply MUST carry the\n   FEC Stack information in a Reply Path
    TLV to test the return MPLS LSP\n   path.  The destination IP address of the echo
    reply message MUST\n   never be used in a forwarding decision.  To avoid this
    possibility\n   the destination IP address of the echo reply message that is\n
    \  transmitted along the specified return path MUST be set to numbers\n   from
    the range 127/8 for IPv4 or 0:0:0:0:0:FFFF:127.0.0.0/104 for\n   IPv6, and the
    IP Time to Live (TTL) MUST be set 1, and the TTL in the\n   outermost label MUST
    be set to 255.\n   When the return path is a pure IP forwarding path, the procedures\n
    \  defined in [RFC4379] (the destination IP address is copied from the\n   source
    IP address) apply unchanged.\n"
  - contents:
    - "5.1.  Sending an Echo Request\n   When sending an echo request, in addition
      to the rules and procedures\n   defined in Section 4.3 of [RFC4379], the Reply
      Mode of the echo\n   request MUST be set to \"Reply via Specified Path\", and
      a Reply Path\n   TLV MUST be carried in the echo request message correspondingly.
      \ The\n   Reply Path TLV includes one or several reply path sub-TLV(s) to\n
      \  identify the return path(s) the egress LSR should use for its reply.\n   For
      a bidirectional LSP, since the ingress LSR and egress LSR of a\n   bidirectional
      LSP are aware of the relationship between the forward\n   and backward direction
      LSPs, only the B bit SHOULD be set in the\n   Reply Path TLV.  If the operator
      wants the echo reply to be sent\n   along a path other than the reverse direction
      of the bidirectional\n   LSP, the A bit SHOULD be set or another FEC sub-TLV
      SHOULD be carried\n   in the Reply Path TLV instead, and the B bit MUST be clear.\n
      \  In some cases, operators may want to treat two unidirectional LSPs\n   (one
      for each direction) as a pair.  There may not be any binding\n   relationship
      between the two LSPs.  Using the mechanism defined in\n   this document, operators
      can run LSP ping one time from one end to\n   complete the failure detection
      on both unidirectional LSPs.  To\n   accomplish this, the echo request message
      MUST carry (in the Reply\n   Path TLV) a FEC sub-TLV that belongs to the backward
      LSP.\n"
    title: 5.1.  Sending an Echo Request
  - contents:
    - "5.2.  Receiving an Echo Request\n   \"Ping\" mode processing, as defined in
      Section 4.4 of [RFC4379],\n   applies in this document.  In addition, when an
      echo request is\n   received, if the egress LSR does not know the Reply Mode
      defined in\n   this document, an echo reply with the return code set to \"Malformed\n
      \  echo request received\" and the Subcode set to zero will be send back\n   to
      the ingress LSR according to the rules of [RFC4379].  If the\n   egress LSR
      knows the Reply Mode, according to the Reply Path TLV, it\n   SHOULD find and
      select the desired return path.  If there is a\n   matched path, an echo reply
      with a Reply Path TLV that identifies the\n   return path SHOULD be sent back
      to the ingress LSR, the Reply Path\n   return code SHOULD be set to \"The echo
      reply was sent successfully\n   using the specified Reply Path\".  If there
      is no such path, an echo\n   reply with the Reply Path TLV SHOULD be sent back
      to the ingress LSR,\n   the Reply Path return code SHOULD be set to the relevant
      code\n   (defined in Section 4.2) for the real situation to reflect the result\n
      \  of Reply Path TLV processing and return path selection.  For example,\n   if
      the specified LSP is not found, the egress then chooses another\n   LSP as the
      return path to send the echo reply, the Reply Path return\n   code SHOULD be
      set to \"The specified reply path was not found, the\n   echo reply was sent
      via another LSP\", and if the egress chooses an IP\n   path to send the echo
      reply, the Reply Path return code SHOULD be set\n   to \"The specified Reply
      Path was not found, the echo reply was sent\n   via pure IP forwarding (non-MPLS)
      path\".  If there is an unknown sub-\n   TLV in the received Reply Path TLV,
      the Reply Path return code SHOULD\n   be set to \"One or more of the sub-TLVs
      in the Reply Path TLV were not\n   understood\".\n   If the A bit of the Reply
      Path TLV in a received echo request message\n   is set, the egress LSR SHOULD
      send the echo reply along a non-default\n   return path.\n   If the B bit of
      the Reply Path TLV in a received echo request message\n   is set, the egress
      LSR SHOULD send the echo reply along the reverse\n   direction of the bidirectional
      LSP.\n   In addition, the FEC validate results of the forward path LSP SHOULD\n
      \  NOT affect the egress LSR continue to test return path LSP.\n"
    title: 5.2.  Receiving an Echo Request
  - contents:
    - "5.3.  Sending an Echo Reply\n   As described in [RFC4379], the echo reply message
      is a UDP packet,\n   and it MUST be sent only in response to an MPLS echo request.
      \ The\n   source IP address is a valid IP address of the replier, the source\n
      \  UDP port is the well-know UDP port for LSP ping.\n   When the return path
      is an MPLS LSP, the destination IP address of\n   the echo reply message is
      copied from the destination IP address of\n   the echo request, and the destination
      UDP port is copied from the\n   source UDP port of the echo request.  The IP
      TTL MUST be set to 1,\n   the TTL in the outermost label MUST be set to 255.\n
      \  When the return path is a pure IP forwarding path, the same as\n   defined
      in [RFC4379], the destination IP address and UDP port are\n   copied from the
      source IP address and source UDP port of the echo\n   request.\n   When sending
      the echo reply, a Reply Path TLV that identifies the\n   return path MUST be
      carried, the Reply Path return code SHOULD be set\n   to relevant code that
      reflects results about how the egress processes\n   the Reply Path TLV in a
      previous received echo request message and\n   return path selection.  By carrying
      the Reply Path TLV in an echo\n   reply, it gives the ingress LSR enough information
      about the reverse\n   direction of the tested path to verify the consistency
      of the data\n   plane against control plane.  Thus, a single LSP ping could
      achieve\n   both directions of a path test.  If the return path is pure IP path,\n
      \  no sub-TLVs are carried in the Reply Path TLV.\n"
    title: 5.3.  Sending an Echo Reply
  - contents:
    - "5.4.  Receiving an Echo Reply\n   The rules and process defined in Section
      4.6 of [RFC4379] apply here.\n   When an echo reply is received, if the Reply
      Mode is \"Reply via\n   Specified Path\" and the Reply Path return code is \"The
      echo reply was\n   sent successfully using the specified Reply Path\", and if
      the return\n   path is an MPLS LSP.  The ingress LSR MUST perform FEC validation\n
      \  (based on the FEC Stack information of the return path carried in the\n   Reply
      Path TLV) as an egress LSR does when receiving an echo request,\n   the FEC
      validation process (relevant to \"ping\" mode) defined in\n   Section 4.4.1
      of [RFC4379] applies here.\n   When an echo reply is received with return code
      set to \"Malformed\n   echo request received\" and the Subcode set to zero.
      \ It is possible\n   that the egress LSR may not know the \"Reply via Specified
      Path\" Reply\n   Mode, the operator may choose to re-perform another LSP ping
      by using\n   one of the four Reply Modes defined [RFC4379].\n   On receipt of
      an echo reply with Reply Path return code in the Reply\n   Path TLV set to \"The
      specified reply path was not found, ...\", it\n   means that the egress LSR
      could not find a matched return path as\n   specified.  Operators may choose
      to specify another LSP as the return\n   path or use other methods to detect
      the path further.\n"
    title: 5.4.  Receiving an Echo Reply
  - contents:
    - "5.5.  Non-IP Encapsulation for MPLS-TP LSPs\n   In some MPLS-TP deployment
      scenarios, IP addressing might not be\n   available or the use of some form
      of non-IP encapsulation might be\n   preferred.  In such scenarios, the Non-IP
      encapsulation defined in\n   [RFC6426] applies here.  The LSP Ping Reply Mode
      in the echo request\n   and echo reply is set to 5.  The return path of the
      echo reply is as\n   specified in the Reply Path TLV.\n"
    title: 5.5.  Non-IP Encapsulation for MPLS-TP LSPs
  title: 5.  Theory of Operation
- contents:
  - "6.  Security Considerations\n   Security considerations discussed in [RFC4379]
    apply to this\n   document.\n   In addition, the extensions defined in this document
    may be used for\n   potential \"proxying\" attacks.  For example, an echo request
    initiator\n   may specify a return path that has a destination different from
    that\n   of the initiator.  But normally, such attacks will not happen in an\n
    \  MPLS domain where the initiators and receivers belong to the same\n   domain.
    \ Even this, in order to prevent using the extension defined\n   in this document
    for proxying any possible attacks, the return path\n   LSP should have destination
    to the same node where the forward path\n   is from.  The receiver may drop the
    echo request when it cannot\n   determine whether the return path LSP has the
    destination to the\n   initiator.  That means, when sending echo request, the
    initiator\n   should choose a proper source address according the specified return\n
    \  path LSP to help the receiver to make the decision.\n"
  title: 6.  Security Considerations
- contents:
  - '7.  IANA Considerations

    '
  - contents:
    - "7.1.  TLVs\n   IANA has assigned the value 21 for the Reply Path TLV and assigned\n
      \  the value 22 for Reply TC TLV from the \"Multiprotocol Label Switching\n
      \  Architecture (MPLS) Label Switched Paths (LSPs) Ping Parameters\"\n   registry,
      \"TLVs\" subregistry.\n   Value   Meaning                           Reference\n
      \  -----   -------                           ---------\n   21      Reply Path
      TLV                    this document (Section 4.2)\n   22      Reply TC TLV
      \                     this document (Section 4.4)\n   The sub-TLV space and
      assignments for the Reply Path TLV will be the\n   same as that for the Target
      FEC Stack TLV.  Sub-types for the Target\n   FEC Stack TLV and the Reply Path
      TLV MUST be kept the same.  Any new\n   sub-type added to the Target FEC Stack
      TLV MUST apply to the Reply\n   Path TLV as well.\n"
    title: 7.1.  TLVs
  - contents:
    - "7.2.  New Target FEC Stack Sub-TLVs\n   IANA has assigned three new sub-TLV
      types from the \"Multiprotocol\n   Label Switching Architecture (MPLS) Label
      Switched Paths (LSPs) Ping\n   Parameters - TLVs\" registry, \"Sub-TLVs for
      TLV Types 1, 16, and 21\"\n   subregistry.\n   Sub-Type      Sub-TLV Name             Reference\n
      \  -------       -----------             ---------\n   26          IPv4 RSVP
      Tunnel        this document (Section 4.3.1)\n   27          IPv6 RSVP Tunnel
      \       this document (Section 4.3.2)\n   28          Static Tunnel           this
      document (Section 4.3.3)\n"
    title: 7.2.  New Target FEC Stack Sub-TLVs
  - contents:
    - "7.3.  New Reply Mode\n   IANA has allocated (5 - Reply via Specified Path)
      from the \"Multi-\n   Protocol Label Switching (MPLS) Label Switched Paths (LSPs)
      Ping\n   Parameters\" registry, the \"Reply Modes\" subregistry.\n   Value    Meaning
      \                     Reference\n   -----    -------                      ----------\n
      \  5        Reply via Specified Path     this document (Section 4.1)\n"
    title: 7.3.  New Reply Mode
  - contents:
    - "7.4.  Reply Path Return Code\n   IANA has created a new subregistry for the
      \"Multi-Protocol Label\n   Switching (MPLS) Label Switched Paths (LSPs) Ping
      Parameters\" for\n   Reply Path return codes.\n   This document (Section 4.2)
      defines the following return codes:\n   Value         Meaning\n   ------        ----------------------\n
      \  0x0000        No return code\n   0x0001        Malformed Reply Path TLV was
      received\n   0x0002        One or more of the sub-TLVs in the Reply Path TLV\n
      \                were not understood\n   0x0003        The echo reply was sent
      successfully using the\n                 specified Reply Path\n   0x0004        The
      specified Reply Path was not found, the echo\n                 reply was sent
      via another LSP\n   0x0005        The specified Reply Path was not found, the
      echo\n                 reply was sent via pure IP forwarding (non-MPLS)\n                 path\n
      \  0x0006-0xfffb Unassigned\n   0xfffc-0xffff Reserved for Experimental Use\n
      \  The range of 0x0006-0xfffb is not allocated and reserved for future\n   extensions
      and is allocated via Standard Action; the range of 0xfffc-\n   0xffff is for
      Experimental Use.\n"
    title: 7.4.  Reply Path Return Code
  title: 7.  IANA Considerations
- contents:
  - "8.  Contributors\n   The following individuals also contributed to this document:\n
    \  Ehud Doron\n   Orckit-Corrigent\n   EMail: ehudd@orckit.com\n   Ronen Solomon\n
    \  Orckit-Corrigent\n   EMail: RonenS@orckit.com\n   Ville Hallivuori\n   Tellabs\n
    \  Sinimaentie 6 C\n   FI-02630 Espoo, Finland\n   EMail: ville.hallivuori@tellabs.com\n
    \  Xinchun Guo\n   EMail: guoxinchun@huawei.com\n"
  title: 8.  Contributors
- contents:
  - "9.  Acknowledgements\n   The authors would like to thank Adrian Farrel, Peter
    Ashwood-Smith,\n   Sriganesh Kini, Gregory Mirsky, Eric Gray, Loa Andersson, Carlos\n
    \  Pignataro, and Tom Petch for their reviews, suggestions, and\n   comments.\n"
  title: 9.  Acknowledgements
- contents:
  - '10.  References

    '
  - contents:
    - "10.1.  Normative References\n   [RFC2119]  Bradner, S., \"Key words for use
      in RFCs to Indicate\n              Requirement Levels\", BCP 14, RFC 2119, March
      1997.\n   [RFC4379]  Kompella, K. and G. Swallow, \"Detecting Multi-Protocol\n
      \             Label Switched (MPLS) Data Plane Failures\", RFC 4379,\n              February
      2006.\n   [RFC6370]  Bocci, M., Swallow, G., and E. Gray, \"MPLS Transport\n
      \             Profile (MPLS-TP) Identifiers\", RFC 6370, September 2011.\n"
    title: 10.1.  Normative References
  - contents:
    - "10.2.  Informative References\n   [RFC3945]  Mannie, E., \"Generalized Multi-Protocol
      Label Switching\n              (GMPLS) Architecture\", RFC 3945, October 2004.\n
      \  [RFC4872]  Lang, J., Rekhter, Y., and D. Papadimitriou, \"RSVP-TE\n              Extensions
      in Support of End-to-End Generalized Multi-\n              Protocol Label Switching
      (GMPLS) Recovery\", RFC 4872, May\n              2007.\n   [RFC5462]  Andersson,
      L. and R. Asati, \"Multiprotocol Label Switching\n              (MPLS) Label
      Stack Entry: \"EXP\" Field Renamed to \"Traffic\n              Class\" Field\",
      RFC 5462, February 2009.\n   [RFC5654]  Niven-Jenkins, B., Brungard, D., Betts,
      M., Sprecher, N.,\n              and S. Ueno, \"Requirements of an MPLS Transport
      Profile\",\n              RFC 5654, September 2009.\n   [RFC5884]  Aggarwal,
      R., Kompella, K., Nadeau, T., and G. Swallow,\n              \"Bidirectional
      Forwarding Detection (BFD) for MPLS Label\n              Switched Paths (LSPs)\",
      RFC 5884, June 2010.\n   [RFC6426]  Gray, E., Bahadur, N., Boutros, S., and
      R. Aggarwal, \"MPLS\n              On-Demand Connectivity Verification and Route
      Tracing\",\n              RFC 6426, November 2011.\n"
    title: 10.2.  Informative References
  title: 10.  References
- contents:
  - "Authors' Addresses\n   Mach(Guoyi) Chen\n   Huawei Technologies Co., Ltd\n   Q14
    Huawei Campus, No. 156 Beiqing Road, Hai-dian District\n   Beijing  100095\n   China\n
    \  EMail: mach.chen@huawei.com\n   Wei Cao\n   Huawei Technologies Co., Ltd\n
    \  Q14 Huawei Campus, No. 156 Beiqing Road, Hai-dian District\n   Beijing  100095\n
    \  China\n   EMail: wayne.caowei@huawei.com\n   So Ning\n   Tata Communications\n
    \  EMail: ning.so@tatacommunications.com\n   Frederic Jounay\n   Orange CH\n   4
    rue caudray 1020 Renens\n   Switzerland\n   EMail: frederic.jounay@orange.ch\n
    \  Simon Delord\n   EMail: Simon.delord@team.telstra.com\n"
  title: Authors' Addresses
