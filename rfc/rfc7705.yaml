- title: __initial_text__
  contents:
  - "                 Autonomous System Migration Mechanisms\n             and Their\
    \ Effects on the BGP AS_PATH Attribute\n"
- title: Abstract
  contents:
  - "Abstract\n   This document discusses some existing commonly used BGP mechanisms\n\
    \   for Autonomous System Number (ASN) migration that are not formally\n   part\
    \ of the BGP4 protocol specification.  It is necessary to document\n   these de\
    \ facto standards to ensure that they are properly supported\n   in future BGP\
    \ protocol work.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This\
    \ document is a product of the Internet Engineering Task Force\n   (IETF).  It\
    \ represents the consensus of the IETF community.  It has\n   received public\
    \ review and has been approved for publication by the\n   Internet Engineering\
    \ Steering Group (IESG).  Further information on\n   Internet Standards is available\
    \ in Section 2 of RFC 5741.\n   Information about the current status of this document,\
    \ any errata,\n   and how to provide feedback on it may be obtained at\n   http://www.rfc-editor.org/info/rfc7705.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2015 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (http://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.  Code Components\
    \ extracted from this document must\n   include Simplified BSD License text as\
    \ described in Section 4.e of\n   the Trust Legal Provisions and are provided\
    \ without warranty as\n   described in the Simplified BSD License.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1.  Introduction  . . . . . . . . . . . . . . . . . . .\
    \ . . . . .   2\n     1.1.  Requirements Language . . . . . . . . . . . . . .\
    \ . . . .   3\n     1.2.  Documentation Note  . . . . . . . . . . . . . . . .\
    \ . . .   3\n   2.  ASN Migration Scenario Overview . . . . . . . . . . . . .\
    \ . .   3\n   3.  External BGP Autonomous System Migration Mechanisms . . . .\
    \ .   5\n     3.1.  Modify Inbound BGP AS_PATH Attribute  . . . . . . . . . .\
    \   5\n     3.2.  Modify Outbound BGP AS_PATH Attribute . . . . . . . . . .  \
    \ 7\n     3.3.  Implementation  . . . . . . . . . . . . . . . . . . . . .   8\n\
    \   4.  Internal BGP Autonomous System Migration Mechanisms . . . . .   9\n  \
    \   4.1.  Internal BGP AS Migration . . . . . . . . . . . . . . . .  10\n    \
    \ 4.2.  Implementation  . . . . . . . . . . . . . . . . . . . . .  12\n   5. \
    \ Additional Operational Considerations . . . . . . . . . . . .  13\n   6.  Security\
    \ Considerations . . . . . . . . . . . . . . . . . . .  14\n   7.  References\
    \  . . . . . . . . . . . . . . . . . . . . . . . . .  14\n     7.1.  Normative\
    \ References  . . . . . . . . . . . . . . . . . .  14\n     7.2.  Informative\
    \ References  . . . . . . . . . . . . . . . . .  14\n   Appendix A.  Implementation\
    \ Report  . . . . . . . . . . . . . . .  16\n   Acknowledgements  . . . . . .\
    \ . . . . . . . . . . . . . . . . . .  16\n   Authors' Addresses  . . . . . .\
    \ . . . . . . . . . . . . . . . . .  16\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   This document discusses some existing commonly used BGP\
    \ mechanisms\n   for Autonomous System Number (ASN) migration that are not formally\n\
    \   part of the BGP4 [RFC4271] protocol specification.  These mechanisms\n   are\
    \ local to a given BGP speaker and do not require negotiation with\n   or cooperation\
    \ of BGP neighbors.  The deployment of these mechanisms\n   do not need to interwork\
    \ with one another to accomplish the desired\n   results, so slight variations\
    \ between existing vendor implementations\n   exist and will not necessarily be\
    \ harmonized due to this document.\n   However, it is necessary to document these\
    \ de facto standards to\n   ensure that new implementations can be successful,\
    \ and any future\n   protocol enhancements to BGP that propose to read, copy,\
    \ manipulate,\n   or compare the AS_PATH attribute can do so without inhibiting\
    \ the use\n   of these very widely used ASN migration mechanisms.\n   The migration\
    \ mechanisms discussed here are useful to ISPs and\n   organizations of all sizes,\
    \ but it is important to understand the\n   business need for these mechanisms\
    \ and illustrate why they are so\n   critical for ISPs' operations.  During a\
    \ merger, acquisition, or\n   divestiture involving two organizations it is necessary\
    \ to seamlessly\n   migrate both internal and external BGP speakers from one ASN\
    \ to a\n   second ASN.  The overall goal in doing so is to simplify operations\n\
    \   through consistent configurations across all BGP speakers in the\n   combined\
    \ network.  In addition, given that the BGP Path Selection\n   algorithm selects\
    \ routes with the shortest AS_PATH attribute, it is\n   critical that the ISP\
    \ does not increase AS_PATH length during or\n   after ASN migration, because\
    \ an increased AS_PATH length would likely\n   result in sudden, undesirable changes\
    \ in traffic-patterns in the\n   network.\n   By default, the BGP protocol requires\
    \ an operator to configure a\n   router to use a single remote ASN for the BGP\
    \ neighbor, and the ASN\n   must match on both ends of the peering in order to\
    \ successfully\n   negotiate and establish a BGP session.  Prior to the existence\
    \ of\n   these migration mechanisms, it would have required an ISP to\n   coordinate\
    \ an ASN change with, in some cases, tens of thousands of\n   customers.  In particular,\
    \ as each router is migrated to the new ASN,\n   to avoid an outage due to ASN\
    \ mismatch, the ISP would have to force\n   all customers on that router to change\
    \ their router configurations to\n   use the new ASN immediately after the ASN\
    \ change.  Thus, it was\n   critical to define a more asymmetric migration method\
    \ so that the ISP\n   could seamlessly change the ASN within its network(s) but\
    \ allow the\n   customers to gradually migrate to the ISP's new ASN when convenient.\n\
    \   These customer migrations could occur either by coordinating\n   individual\
    \ session reconfigurations or, to allow for truly asymmetric\n   migration, by\
    \ accepting sessions using either the old or new ASN.\n"
- title: 1.1.  Requirements Language
  contents:
  - "1.1.  Requirements Language\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\"\
    , \"SHALL\", \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"\
    MAY\", and \"OPTIONAL\" in this\n   document are to be interpreted as described\
    \ in RFC 2119 [RFC2119].\n"
- title: 1.2.  Documentation Note
  contents:
  - "1.2.  Documentation Note\n   This document uses Autonomous System Numbers (ASNs)\
    \ from the range\n   reserved for documentation as described in RFC 5398 [RFC5398].\
    \  In\n   the examples used here, they are intended to represent Globally\n  \
    \ Unique ASNs, not private use ASNs as documented in Section 5 of RFC\n   6996\
    \ [RFC6996].\n"
- title: 2.  ASN Migration Scenario Overview
  contents:
  - "2.  ASN Migration Scenario Overview\n   The use case being discussed here is\
    \ an ISP merging two or more ASNs,\n   where eventually one ASN subsumes the other(s).\
    \  In this use case, we\n   will assume the most common case where there are two\
    \ ISPs, A and B,\n   that prior to the ASN migration use AS 64500 and 64510, respectively.\n\
    \   AS 64500 will be the permanently retained ASN used across the\n   consolidated\
    \ set of both ISPs network equipment, and AS 64510 will be\n   retired.  Thus,\
    \ at the conclusion of the ASN migration, there will be\n   a single ISP A' with\
    \ all internal BGP speakers configured to use AS\n   64500.  To all external BGP\
    \ speakers, the AS_PATH length will not be\n   increased.\n   In this same scenario,\
    \ AS 64496 and AS 64499 represent two separate\n   customer networks: C and D,\
    \ respectively.  Originally, customer C (AS\n   64496) is attached to ISP B, which\
    \ will undergo ASN migration from AS\n   64510 to AS 64500.  Furthermore, customer\
    \ D (AS 64499) is attached to\n   ISP A, which does not undergo ASN migration\
    \ since the ASN for ISP A\n   will remain constant, (AS 64500).  Although this\
    \ example refers to AS\n   64496 and 64499 as customer networks, either or both\
    \ may be\n   settlement-free or other types of peers.  In this use case, they\
    \ are\n   referred to as \"customers\" merely for convenience.\n         ------\
    \                  ------\n       / ISP  A \\              / ISP  B \\\n     \
    \ | AS 64500 |            | AS 64510 |\n       \\        /              \\   \
    \     /\n        -------                 -------\n           |               \
    \        |\n           |                       |\n     ------------          \
    \   -------------\n     |  Cust D  |             |  Cust C   |\n     | AS 64499\
    \ |             | AS 64496  |\n     ------------             -------------\n \
    \                       Figure 1: Before Migration\n                ---------------\n\
    \              /                \\\n             |     ISP A'       |\n      \
    \       |     AS 64500     |\n              \\                /\n            \
    \    ---------------\n             /                  \\\n           /       \
    \               \\\n          |                         |\n     ------------ \
    \            -------------\n     |  Cust D  |             |  Cust C   |\n    \
    \ | AS 64499 |             | AS 64496  |\n     ------------             -------------\n\
    \                         Figure 2: After Migration\n   The general order of operations,\
    \ typically carried out in a single\n   maintenance window by the network undergoing\
    \ ASN migration (ISP B),\n   is as follows.  First, ISP B will change the global\
    \ BGP ASN used by a\n   Provider Edge (PE) router, from ASN 64510 to 64500.  At\
    \ this point,\n   the router will no longer be able to establish External BGP\
    \ (eBGP)\n   sessions toward the existing Customer Edge (CE) devices that are\n\
    \   attached to it and still using AS 64510.  Second, since ISP B needs\n   to\
    \ do this without coordinating the simultaneous change of its ASN\n   with all\
    \ of its eBGP peers, ISP B will configure two separate, but\n   related ASN migration\
    \ mechanisms discussed in this document on all\n   eBGP sessions toward all CE\
    \ devices.  These mechanisms enable the\n   router to establish BGP neighbors\
    \ using the legacy ASN, modify the\n   AS_PATH attribute received from a CE device\
    \ when advertising it\n   further, and modify AS_PATH when transmitted toward\
    \ CE devices to\n   achieve the desired effect of not increasing the length of\
    \ the\n   AS_PATH.\n   At the conclusion of the ASN migration, the CE devices\
    \ at the edge of\n   the network are not aware of the fact that their upstream\
    \ router is\n   now in a new ASN and do not observe any change in the length of\
    \ the\n   AS_PATH attribute.  However, after the changes discussed in this\n \
    \  document are put in place by ISP A', there is a change to the\n   contents\
    \ of the AS_PATH attribute to ensure the AS_PATH is not\n   artificially lengthened\
    \ while these AS migration parameters are used.\n   In this use case, neither\
    \ ISP is using BGP Confederations [RFC5065]\n   internally.\n"
- title: 3.  External BGP Autonomous System Migration Mechanisms
  contents:
  - "3.  External BGP Autonomous System Migration Mechanisms\n   The following section\
    \ addresses optional capabilities that are\n   specific to modifying the AS_PATH\
    \ attribute at the Autonomous System\n   Border Routers (ASBRs) of an organization\
    \ (typically a single Service\n   Provider).  This ensures that external BGP customers/peers\
    \ are not\n   forced to make any configuration changes on their CE routers before\n\
    \   or during the exact time the Service Provider wishes to migrate to a\n   new,\
    \ permanently retained ASN.  Furthermore, these mechanisms\n   eliminate the artificial\
    \ lengthening of the AS_PATH both transmitted\n   from and received by the Service\
    \ Provider that is undergoing AS\n   Migration, which would have negative implications\
    \ on path selection\n   by external networks.\n"
- title: 3.1.  Modify Inbound BGP AS_PATH Attribute
  contents:
  - "3.1.  Modify Inbound BGP AS_PATH Attribute\n   The first instrument used in the\
    \ process described above is called\n   \"Local AS\".  This allows the router\
    \ to supersede the globally\n   configured ASN in the \"My Autonomous System\"\
    \ field of the BGP OPEN\n   [RFC4271] with a locally defined AS value for a specific\
    \ BGP neighbor\n   or group of neighbors.  This mechanism allows the PE router\
    \ that was\n   formerly in ISP B to establish an eBGP session toward the existing\
    \ CE\n   devices using the legacy AS -- AS 64510.  Ultimately, the CE devices\n\
    \   (i.e., customer C) are completely unaware that ISP B has reconfigured\n  \
    \ its router to participate as a member of a new AS.  Within the\n   context of\
    \ the former ISP B PE router, the second effect this\n   specific mechanism has\
    \ on AS_PATH is that, by default, it prepends\n   all received BGP UPDATEs with\
    \ the legacy AS of ISP B -- AS 64510 --\n   while advertising it (Adj-RIB-Out)\
    \ to other BGP speakers (A').\n   Within the Loc-RIB on ISP B prior to the migration,\
    \ the AS_PATH of\n   route announcements received from customer C would appear\
    \ as 64496,\n   whereas the same RIB on ISP A' (ISP B routers post-migration)\
    \ would\n   contain AS_PATH 64510 64496.\n   The second instrument, referred to\
    \ as \"No Prepend Inbound\", is\n   enabled on PE routers migrating from ISP B.\
    \  The \"No Prepend Inbound\"\n   capability causes ISP B's routers to not prepend\
    \ the legacy AS (AS\n   64510), when advertising UPDATES received from customer\
    \ C.  This\n   restores the AS_PATH within ISP A' for route announcements received\n\
    \   from customer C so that it is just one ASN in length: 64496.\n   In the direction\
    \ of CE -> PE (inbound):\n   1.  \"Local AS\": Allows the local BGP router to\
    \ generate a BGP OPEN to\n       an eBGP neighbor with the old, legacy ASN value\
    \ in the \"My\n       Autonomous System\" field.  When this capability is activated,\
    \ it\n       also causes the local router to prepend the <old_ASN> value to\n\
    \       the AS_PATH when installing or advertising routes received from a\n  \
    \     CE to Internal BGP (iBGP) neighbors inside the Autonomous System.\n   2.\
    \  \"No Prepend Inbound (of Local AS)\": The local BGP router does not\n     \
    \  prepend the <old_ASN> value to the AS_PATH when installing or\n       advertising\
    \ routes received from the CE to iBGP neighbors inside\n       the Autonomous\
    \ System\n   PE-B is a PE that was originally in ISP B, and has a customer eBGP\n\
    \   session to CE-B.  PE-B has had its global configuration ASN changed\n   from\
    \ AS 64510 to AS 64500 to make it part of the permanently retained\n   ASN.  This\
    \ now makes PE-B a member of ISP A'.  PE-A is a PE that was\n   originally in\
    \ ISP A, and has a customer peer CE-A.  Although its\n   global configuration\
    \ ASN remains AS 64500, throughout this exercise\n   we also consider PE-A a member\
    \ of ISP A'.\n                    ISP A'                    ISP A'\n         \
    \     CE-A <--- PE-A <------------------- PE-B <--- CE-B\n              64499\
    \     New_ASN: 64500   Old_ASN: 64510     64496\n                            \
    \             New_ASN: 64500\n             Note: Direction of BGP UPDATE as per\
    \ the arrows.\n           Figure 3: Local AS and No Prepend BGP UPDATE Diagram\n\
    \   As a result, using both the \"Local AS\" and \"No Prepend Inbound\"\n   capabilities\
    \ on PE-B, CE-A will see an AS_PATH of 64500 64496.  CE-A\n   will not receive\
    \ a BGP UPDATE containing AS 64510 in the AS_PATH.\n   (If only the \"Local AS\"\
    \ mechanism was configured without \"No Prepend\n   Inbound\" on PE-B, then CE-A\
    \ would have seen an AS_PATH of 64500 64510\n   64496, which results in an unacceptable\
    \ lengthening of the AS_PATH).\n   Note: If there are still routers in the old\
    \ ASN (64510), it is\n   possible for them to accept these manipulated routes\
    \ (i.e., those\n   with 64510 removed from the AS_PATH by this command) as if\
    \ they have\n   not already passed through their ASN, potentially causing a loop,\n\
    \   since BGP's normal loop-prevention behavior of rejecting routes that\n   include\
    \ its ASN in the path will not catch these.  Careful filtering\n   between routers\
    \ remaining in the old ASN and routers migrated to the\n   new ASN is necessary\
    \ to minimize the risk of routing loops.\n"
- title: 3.2.  Modify Outbound BGP AS_PATH Attribute
  contents:
  - "3.2.  Modify Outbound BGP AS_PATH Attribute\n   The two aforementioned mechanisms,\
    \ \"Local AS\" and \"No Prepend\n   Inbound\", only modify the AS_PATH attribute\
    \ received by the ISP's PEs\n   in the course of processing BGP UPDATEs from CE\
    \ devices when CE\n   devices still have an eBGP session established with the\
    \ ISPs legacy\n   AS (AS64510).\n   In some existing implementations, \"Local\
    \ AS\" and \"No Prepend Inbound\"\n   do not concurrently modify the AS_PATH attribute\
    \ for BGP UPDATEs that\n   are transmitted by the ISP's PEs to CE devices.  In\
    \ these\n   implementations, with \"Local AS\" and \"No Prepend Inbound\" used\
    \ on\n   PE-B, there is an automatic lengthening of the AS_PATH in outbound\n\
    \   BGP UPDATEs from ISP A' toward directly attached eBGP speakers\n   (customer\
    \ C in AS 64496).  The externally observed result is that\n   customer C in AS\
    \ 64496 will receive the following AS_PATH: 64510\n   64500 64499.  Therefore,\
    \ if ISP A' takes no further action, there\n   will be an unacceptable increase\
    \ in the AS_PATH length within the\n   customer's networks directly attached to\
    \ ISP A'.\n   A tertiary mechanism, referred to as \"Replace Old AS\", is used\
    \ to\n   resolve this problem.  This capability allows ISP A' to prevent\n   routers\
    \ from appending the globally configured ASN in outbound BGP\n   UPDATEs toward\
    \ directly attached eBGP neighbors that are using the\n   \"Local AS\" mechanism.\
    \  Instead, only the old (or previously used) AS\n   will be prepended in the\
    \ outbound BGP UPDATE toward the customer's\n   network, restoring the AS_PATH\
    \ length to what it what was before AS\n   Migration occurred.\n   To reuse the\
    \ above diagram, but in the opposite direction, we have:\n                   \
    \      ISP A'                    ISP A'\n              CE-A ---> PE-A ------------------->\
    \ PE-B ---> CE-B\n              64499     New_ASN: 64500   Old_ASN: 64510    \
    \ 64496\n                                         New_ASN: 64500\n           \
    \  Note: Direction of BGP UPDATE as per the arrows.\n                  Figure\
    \ 4: Replace AS BGP UPDATE Diagram\n   By default, without the use of \"Replace\
    \ Old AS\", CE-B would see an\n   AS_PATH of 64510 64500 64499.  After ISP A'\
    \ changes PE-B to use\n   \"Replace Old AS\", CE-B would receive an AS_PATH of\
    \ 64510 64499, which\n   is the same AS_PATH length pre-AS migration.\n"
- title: 3.3.  Implementation
  contents:
  - "3.3.  Implementation\n   The mechanisms introduced in this section MUST be configurable\
    \ on a\n   per-neighbor or per-neighbor-group basis to allow for maximum\n   flexibility.\
    \  (Here, \"neighbor group\" refers to a group of similar\n   BGP neighbor statements\
    \ that reuse some common configuration to\n   simplify provisioning.)  When the\
    \ \"Local AS\" capability is used, a\n   local ASN will be provided in the configuration\
    \ that is different\n   from the globally configured ASN of the BGP router.  To\
    \ implement\n   this mechanism, a BGP speaker SHOULD send BGP OPEN [RFC4271] (see\n\
    \   Section 4.2) messages to the configured eBGP peer(s) using the local\n   ASN\
    \ configured for this session as the value sent in \"My Autonomous\n   System\"\
    .  The BGP router SHOULD NOT use the ASN configured globally\n   within the BGP\
    \ process as the value sent in \"My Autonomous System\" in\n   the OPEN message.\
    \  This prevents causing the eBGP neighbor to\n   unnecessarily generate a BGP\
    \ OPEN Error message \"Bad Peer AS\".  This\n   method is typically used to re-establish\
    \ eBGP sessions with peers\n   expecting the legacy ASN after a router has been\
    \ moved to a new ASN.\n   Implementations MAY support a more flexible model where\
    \ the eBGP\n   speaker attempts to open the BGP session using either the ASN\n\
    \   configured as \"Local AS\" or the globally configured AS as discussed\n  \
    \ in BGP Alias (Section 4.2).  If the session is successfully\n   established\
    \ to the globally configured ASN, then the modifications to\n   AS_PATH described\
    \ in this document SHOULD NOT be performed, as they\n   are unnecessary.  The\
    \ benefit to this more flexible model is that it\n   allows the remote neighbor\
    \ to reconfigure to the new ASN without\n   direct coordination between the ISP\
    \ and the customer.\n   Note that this procedure will vary slightly if the locally\
    \ or\n   globally configured ASN is a 4-octet ASN.  See Section 3 of\n   [RFC6793].\n\
    \   When the BGP router receives UPDATEs from its eBGP neighbor\n   configured\
    \ with the \"Local AS\" mechanism, it processes the UPDATE as\n   described in\
    \ RFC4271 Section 5.1.2 [RFC4271].  However, the presence\n   of a second ASN\
    \ due to \"Local AS\" adds the following behavior to\n   processing UPDATEs received\
    \ from an eBGP neighbor configured with\n   this mechanism:\n   1.  Internal:\
    \ The router SHOULD append the configured \"Local AS\" ASN\n       in the AS_PATH\
    \ attribute before installing the route or\n       advertising the UPDATE to an\
    \ iBGP neighbor.  The decision of when\n       to append the ASN is an implementation\
    \ detail outside the scope\n       of this document.  Some considerations factoring\
    \ into this\n       decision include consistency in the AS_PATH throughout the\
    \ AS,\n       and implementation of the loop detection mechanism.\n   2.  External:\
    \ The BGP router SHOULD first append the globally\n       configured ASN to the\
    \ AS_PATH immediately followed by the \"Local\n       AS\" value before advertising\
    \ the UPDATE to an eBGP neighbor.\n   Two options exist to manipulate the behavior\
    \ of the basic \"Local AS\"\n   mechanism.  They modify the behavior as described\
    \ below:\n   1.  \"No Prepend Inbound\": When the BGP router receives inbound\
    \ BGP\n       UPDATEs from its eBGP neighbor configured with this option, it\n\
    \       MUST NOT append the \"Local AS\" ASN value in the AS_PATH attribute\n\
    \       when installing the route or advertising that UPDATE to iBGP\n       neighbors,\
    \ but it MUST still append the globally configured ASN\n       as normal when\
    \ advertising the UPDATE to other local eBGP\n       neighbors (i.e., those natively\
    \ peering with the globally\n       configured ASN).\n   2.  \"Replace Old AS\"\
    \ (outbound): When the BGP router generates\n       outbound BGP UPDATEs toward\
    \ an eBGP neighbor configured with this\n       option, the BGP speaker MUST NOT\
    \ append the globally configured\n       ASN from the AS_PATH attribute.  The\
    \ BGP router MUST append only\n       the configured \"Local AS\" ASN value to\
    \ the AS_PATH attribute\n       before sending the BGP UPDATEs outbound to the\
    \ eBGP neighbor.\n"
- title: 4.  Internal BGP Autonomous System Migration Mechanisms
  contents:
  - "4.  Internal BGP Autonomous System Migration Mechanisms\n   The following section\
    \ describes mechanisms that assist with a gradual\n   and least service-impacting\
    \ migration of Internal BGP sessions from a\n   legacy ASN to the permanently\
    \ retained ASN.  The following mechanism\n   is very valuable to networks undergoing\
    \ AS migration, but its use\n   does not cause changes to the AS_PATH attribute.\n"
- title: 4.1.  Internal BGP AS Migration
  contents:
  - "4.1.  Internal BGP AS Migration\n   In this case, all of the routers to be consolidated\
    \ into a single,\n   permanently retained ASN are under the administrative control\
    \ of a\n   single entity.  Unfortunately, the traditional method of migrating\n\
    \   all Internal BGP speakers, particularly within larger networks, is\n   both\
    \ time-consuming and widely service impacting.\n   The traditional method to migrate\
    \ Internal BGP sessions was strictly\n   limited to reconfiguration of the global\
    \ configuration ASN and,\n   concurrently, changing all iBGP neighbors' remote\
    \ ASN from the legacy\n   ASN to the new, permanently retained ASN on each router\
    \ within the\n   legacy AS.  These changes can be challenging to swiftly execute\
    \ in\n   networks with more than a few dozen internal BGP routers.  There are\n\
    \   also the concomitant service interruptions as these changes are made\n   to\
    \ routers within the network, resulting in a reset of iBGP sessions\n   and subsequent\
    \ route reconvergence to reestablish optimal routing\n   paths.  Operators often\
    \ cannot make such sweeping changes given the\n   associated risks of a highly\
    \ visible service interruption; rather,\n   they require a more gradual method\
    \ to migrate Internal BGP sessions,\n   from one ASN to a second, permanently\
    \ retained ASN, that is not\n   visibly service impacting to its customers.\n\
    \   With the \"Internal BGP AS Migration\" mechanism described herein, it\n  \
    \ allows an Internal BGP speaker to form a single iBGP session using\n   either\
    \ the old, legacy ASN or the new, permanently retained ASN.  The\n   benefits\
    \ of using this mechanism are several fold.  First, it allows\n   for a more gradual\
    \ and less service-impacting migration away from the\n   legacy ASN to the permanently\
    \ retained ASN.  Second, it (temporarily)\n   permits the coexistence of the legacy\
    \ and permanently retained ASN\n   within a single network, allowing for uniform\
    \ BGP path selection\n   among all routers within the consolidated network.\n\
    \   The iBGP router with the \"Internal BGP AS Migration\" capability\n   enabled\
    \ allows the receipt of a BGP OPEN message with either the\n   legacy ASN value\
    \ or the new, globally configured ASN value in the \"My\n   Autonomous System\"\
    \ field of the BGP OPEN message from iBGP neighbors.\n   It is important to recognize\
    \ that enablement of the \"Internal BGP AS\n   Migration\" mechanism preserves\
    \ the semantics of a regular iBGP\n   session (i.e., using identical ASNs).  Thus,\
    \ the BGP attributes\n   transmitted by and the acceptable methods of operation\
    \ on BGP\n   attributes received from iBGP sessions configured with \"Internal\
    \ BGP\n   AS Migration\" capability are no different than those exchanged across\n\
    \   an iBGP session without \"Internal BGP AS Migration\" configured, as\n   defined\
    \ by [RFC4271] and [RFC4456].\n   Typically, in medium to large networks, BGP\
    \ Route Reflectors (RRs)\n   [RFC4456] are used to aid in reduction of configuration\
    \ of iBGP\n   sessions and scalability with respect to overall TCP (and BGP)\n\
    \   session maintenance between adjacent iBGP routers.  Furthermore, BGP\n   Route\
    \ Reflectors are typically deployed in pairs within a single\n   Route Reflection\
    \ cluster to ensure high reliability of the BGP\n   Control Plane.  As such, the\
    \ following example will use Route\n   Reflectors to aid in understanding the\
    \ use of the \"Internal BGP AS\n   Migration\" mechanism.  Note that Route Reflectors\
    \ are not a\n   prerequisite to enable \"Internal BGP AS Migration\" and this\
    \ mechanism\n   can be enabled independent of the use of Route Reflectors.\n \
    \  The general order of operations is as follows:\n   1.  Within the legacy network,\
    \ (the routers comprising the set of\n       devices that still have a globally\
    \ configured legacy ASN), one\n       member of a redundant pair of RRs has its\
    \ global configuration\n       ASN changed to the permanently retained ASN.  Concurrently,\
    \ the\n       \"Internal BGP AS Migration\" capability is enabled on all iBGP\n\
    \       sessions on that device.  This will comprise Non-Client iBGP\n       sessions\
    \ to other RRs as well as Client iBGP sessions, typically\n       to PE devices,\
    \ both still utilizing the legacy ASN.  Note that\n       during this step there\
    \ will be a reset and reconvergence event on\n       all iBGP sessions on the\
    \ RRs whose configuration was modified;\n       however, this should not be service\
    \ impacting due to the use of\n       redundant RRs in each RR Cluster.\n   2.\
    \  The above step is repeated for the other side of the redundant\n       pair\
    \ of RRs.  The one alteration to the above procedure is that\n       the \"Internal\
    \ BGP AS Migration\" mechanism is now removed from the\n       Non-Client iBGP\
    \ sessions toward the other (previously\n       reconfigured) RRs, since it is\
    \ no longer needed.  The \"Internal\n       BGP AS Migration\" mechanism is still\
    \ required on all RRs for all\n       RR Client iBGP sessions.  Also during this\
    \ step, there will be a\n       reset and reconvergence event on all iBGP sessions\
    \ whose\n       configuration was modified, but this should not be service\n \
    \      impacting.  At the conclusion of this step, all RRs will have\n       their\
    \ globally configured ASN set to the permanently retained ASN\n       and \"Internal\
    \ BGP AS Migration\" enabled and in use toward RR\n       Clients.\n   3.  At\
    \ this point, the network administrators would then be able to\n       establish\
    \ iBGP sessions between all Route Reflectors in both the\n       legacy and permanently\
    \ retained networks.  This would allow the\n       network to appear to function,\
    \ both internally and externally, as\n       a single, consolidated network using\
    \ the permanently retained\n       network.\n   4.  To complete the AS migration,\
    \ each RR Client (PE) in the legacy\n       network still utilizing the legacy\
    \ ASN is now modified.\n       Specifically, each legacy PE would have its globally\
    \ configured\n       ASN changed to use the permanently retained ASN.  The ASN\n\
    \       configured within the PE for the iBGP sessions toward each RR\n      \
    \ would be changed to use the permanently retained ASN.  It is\n       unnecessary\
    \ to enable the \"Internal BGP AS Migration\" mechanism\n       on these migrated\
    \ iBGP sessions.  During the same maintenance\n       window, External BGP sessions\
    \ would be modified to include the\n       above \"Local AS\", \"No Prepend\"\
    , and \"Replace Old AS\" mechanisms\n       described in Section 3 above, since\
    \ all of the changes are\n       service interrupting to the eBGP sessions of\
    \ the PE.  At this\n       point, all PEs will have been migrated to the permanently\n\
    \       retained ASN.\n   5.  The final step is to excise the \"Internal BGP AS\
    \ Migration\"\n       configuration from the Router Reflectors in an orderly fashion.\n\
    \       After this is complete, all routers in the network will be using\n   \
    \    the new, permanently retained ASN for all iBGP sessions with no\n       vestiges\
    \ of the legacy ASN on any iBGP sessions.\n   The benefit of using the aforementioned\
    \ \"Internal BGP AS Migration\"\n   capability is that it is a more gradual and\
    \ less externally service\n   impacting change to accomplish an AS migration.\
    \  Previously, without\n   \"Internal BGP AS Migration\", such an AS migration\
    \ change would carry\n   a high risk and need to be successfully accomplished\
    \ in a very short\n   time frame (e.g., at most several hours).  In addition,\
    \ it would\n   likely cause substantial routing churn and rapid fluctuations in\n\
    \   traffic carried -- potentially causing periods of congestion and\n   resultant\
    \ packet loss -- during the period when the configuration\n   changes are underway\
    \ to complete the AS Migration.  On the other\n   hand, with \"Internal BGP AS\
    \ Migration\", the migration from the legacy\n   ASN to the permanently retained\
    \ ASN can occur over a period of days\n   or weeks with reduced customer disruption.\
    \  (The only observable\n   service disruption should be when each PE undergoes\
    \ the changes\n   discussed in step 4 above.)\n"
- title: 4.2.  Implementation
  contents:
  - "4.2.  Implementation\n   The mechanism introduced in this section MUST be configurable\
    \ on a\n   per-neighbor or per-neighbor-group basis to allow for maximum\n   flexibility.\
    \  When configured with this mechanism, a BGP speaker MUST\n   accept BGP OPEN\
    \ and establish an iBGP session from configured iBGP\n   peers if the ASN value\
    \ in \"My Autonomous System\" is either the\n   globally configured ASN or a locally\
    \ configured ASN provided when\n   this capability is utilized.  Additionally,\
    \ a BGP router configured\n   with this mechanism MUST send its own BGP OPEN [RFC4271]\
    \ (see\n   Section 4.2) using either the globally configured or the locally\n\
    \   configured ASN in \"My Autonomous System\" as follows.  To avoid\n   potential\
    \ deadlocks when two BGP speakers are attempting to establish\n   a BGP peering\
    \ session and are both configured with this mechanism,\n   the speaker SHOULD\
    \ send BGP OPEN using the globally configured ASN\n   first, and only send a BGP\
    \ OPEN using the locally configured ASN as a\n   fallback if the remote neighbor\
    \ responds with the BGP error \"Bad Peer\n   AS\".  In each case, the BGP speaker\
    \ MUST treat UPDATEs sent and\n   received to this peer as if this was a natively\
    \ configured iBGP\n   session, as defined by [RFC4271] and [RFC4456].\n   Note\
    \ that this procedure will vary slightly if the locally or\n   globally configured\
    \ ASN is a 4-octet ASN.  See Section 3 of\n   [RFC6793].\n"
- title: 5.  Additional Operational Considerations
  contents:
  - "5.  Additional Operational Considerations\n   This document describes several\
    \ mechanisms to support ISPs and other\n   organizations that need to perform\
    \ ASN migrations.  Other variations\n   of these mechanisms may exist, for example,\
    \ in legacy router software\n   that has not been upgraded or reached End of Life,\
    \ but continues to\n   operate in the network.  Such variations are beyond the\
    \ scope of this\n   document.\n   Companies routinely go through periods of mergers,\
    \ acquisitions, and\n   divestitures, which in the case of the former cause them\
    \ to\n   accumulate several legacy ASNs over time.  ISPs often do not have\n \
    \  control over the configuration of customers' devices (i.e., the ISPs\n   are\
    \ often not providing a managed CE router service, particularly to\n   medium\
    \ and large customers that require eBGP).  Furthermore, ISPs are\n   using methods\
    \ to perform ASN migration that do not require\n   coordination with customers.\
    \  Ultimately, this means there is not a\n   finite period of time after which\
    \ legacy ASNs will be completely\n   expunged from the ISP's network.  In fact,\
    \ it is common that legacy\n   ASNs and the associated External BGP AS Migration\
    \ mechanisms\n   discussed in this document can and do persist for several years,\
    \ if\n   not longer.  Thus, it is prudent to plan that legacy ASNs and\n   associated\
    \ External BGP AS Migration mechanisms will persist in an\n   operational network\
    \ indefinitely.\n   With respect to the Internal BGP AS Migration mechanism, all\
    \ of the\n   routers to be consolidated into a single, permanently retained ASN\n\
    \   are under the administrative control of a single entity.  Thus,\n   completing\
    \ the migration from iBGP sessions using the legacy ASN to\n   the permanently\
    \ retained ASN is more straightforward and could be\n   accomplished in a matter\
    \ of days to months.  Finally, good\n   operational hygiene would dictate that\
    \ it is good practice to avoid\n   using \"Internal BGP AS Migration\" capability\
    \ over a long period of\n   time for reasons of not only operational simplicity\
    \ of the network,\n   but also reduced reliance on that mechanism during the ongoing\
    \ life\n   cycle management of software, features, and configurations that are\n\
    \   maintained on the network.\n"
- title: 6.  Security Considerations
  contents:
  - "6.  Security Considerations\n   This document discusses a process by which one\
    \ ASN is migrated into\n   and subsumed by another.  This involves manipulating\
    \ the AS_PATH\n   attribute with the intent of not increasing the AS_PATH length,\
    \ which\n   would typically cause the BGP route to no longer be selected by BGP's\n\
    \   Path Selection Algorithm in others' networks.  This could result in\n   sudden\
    \ and unexpected shifts in traffic patterns in the network,\n   potentially resulting\
    \ in congestion.\n   Given that these mechanisms can only be enabled through configuration\n\
    \   of routers within a single network, standard security measures should\n  \
    \ be taken to restrict access to the management interface(s) of routers\n   that\
    \ implement these mechanisms.  Additionally, BGP sessions SHOULD\n   be protected\
    \ using TCP Authentication Option [RFC5925] and the\n   Generalized TTL Security\
    \ Mechanism [RFC5082]\n"
- title: 7.  References
  contents:
  - '7.  References

    '
- title: 7.1.  Normative References
  contents:
  - "7.1.  Normative References\n   [RFC2119]  Bradner, S., \"Key words for use in\
    \ RFCs to Indicate\n              Requirement Levels\", BCP 14, RFC 2119,\n  \
    \            DOI 10.17487/RFC2119, March 1997,\n              <http://www.rfc-editor.org/info/rfc2119>.\n\
    \   [RFC4271]  Rekhter, Y., Ed., Li, T., Ed., and S. Hares, Ed., \"A\n       \
    \       Border Gateway Protocol 4 (BGP-4)\", RFC 4271,\n              DOI 10.17487/RFC4271,\
    \ January 2006,\n              <http://www.rfc-editor.org/info/rfc4271>.\n   [RFC4456]\
    \  Bates, T., Chen, E., and R. Chandra, \"BGP Route\n              Reflection:\
    \ An Alternative to Full Mesh Internal BGP\n              (IBGP)\", RFC 4456,\
    \ DOI 10.17487/RFC4456, April 2006,\n              <http://www.rfc-editor.org/info/rfc4456>.\n"
- title: 7.2.  Informative References
  contents:
  - "7.2.  Informative References\n   [ALU]      Alcatel-Lucent, \"BGP Local AS attribute\"\
    , 2006-2012,\n              <https://infoproducts.alcatel-lucent.com/html/0_add-h-f/\n\
    \              93-0074-10-01/7750_SR_OS_Routing_Protocols_Guide/\n           \
    \   BGP-CLI.html#709567>.\n   [CISCO]    Cisco Systems, Inc., \"BGP Support for\
    \ Dual AS\n              Configuration for Network AS Migrations\", 2013,\n  \
    \            <http://www.cisco.com/c/en/us/td/docs/ios-xml/\n              ios/iproute_bgp/configuration/xe-3s/asr1000/\n\
    \              irg-xe-3s-asr1000-book/irg-dual-as.html>.\n   [JUNIPER]  Juniper\
    \ Networks, Inc., \"Understanding the BGP Local AS\n              Attribute\"\
    , December 2013,\n              <http://www.juniper.net/techpubs/en_US/junos13.3/topics/\n\
    \              concept/bgp-local-as-introduction.html>.\n   [RFC5065]  Traina,\
    \ P., McPherson, D., and J. Scudder, \"Autonomous\n              System Confederations\
    \ for BGP\", RFC 5065,\n              DOI 10.17487/RFC5065, August 2007,\n   \
    \           <http://www.rfc-editor.org/info/rfc5065>.\n   [RFC5082]  Gill, V.,\
    \ Heasley, J., Meyer, D., Savola, P., Ed., and C.\n              Pignataro, \"\
    The Generalized TTL Security Mechanism\n              (GTSM)\", RFC 5082, DOI\
    \ 10.17487/RFC5082, October 2007,\n              <http://www.rfc-editor.org/info/rfc5082>.\n\
    \   [RFC5398]  Huston, G., \"Autonomous System (AS) Number Reservation for\n \
    \             Documentation Use\", RFC 5398, DOI 10.17487/RFC5398,\n         \
    \     December 2008, <http://www.rfc-editor.org/info/rfc5398>.\n   [RFC5925] \
    \ Touch, J., Mankin, A., and R. Bonica, \"The TCP\n              Authentication\
    \ Option\", RFC 5925, DOI 10.17487/RFC5925,\n              June 2010, <http://www.rfc-editor.org/info/rfc5925>.\n\
    \   [RFC6793]  Vohra, Q. and E. Chen, \"BGP Support for Four-Octet\n         \
    \     Autonomous System (AS) Number Space\", RFC 6793,\n              DOI 10.17487/RFC6793,\
    \ December 2012,\n              <http://www.rfc-editor.org/info/rfc6793>.\n  \
    \ [RFC6996]  Mitchell, J., \"Autonomous System (AS) Reservation for\n        \
    \      Private Use\", BCP 6, RFC 6996, DOI 10.17487/RFC6996, July\n          \
    \    2013, <http://www.rfc-editor.org/info/rfc6996>.\n"
- title: Appendix A.  Implementation Report
  contents:
  - "Appendix A.  Implementation Report\n   As noted elsewhere in this document, this\
    \ set of migration mechanisms\n   has multiple existing implementations in wide\
    \ use.\n   o  Cisco [CISCO]\n   o  Juniper [JUNIPER]\n   o  Alcatel-Lucent [ALU]\n\
    \   This is not intended to be an exhaustive list, as equivalent features\n  \
    \ do exist in other implementations; however, the authors were unable\n   to find\
    \ publicly available documentation of the vendor-specific\n   implementation to\
    \ reference.\n"
- title: Acknowledgements
  contents:
  - "Acknowledgements\n   Thanks to Kotikalapudi Sriram, Stephane Litkowski, Terry\
    \ Manderson,\n   David Farmer, Jaroslaw Adam Gralak, Gunter Van de Velde, Juan\n\
    \   Alcaide, Jon Mitchell, Thomas Morin, Alia Atlas, Alvaro Retana, and\n   John\
    \ Scudder for their comments.\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Wesley George\n   Time Warner Cable\n   13820 Sunrise\
    \ Valley Drive\n   Herndon, VA  20171\n   United States\n   Phone: +1 703-561-2540\n\
    \   Email: wesley.george@twcable.com\n   Shane Amante\n   Apple, Inc.\n   1 Infinite\
    \ Loop\n   Cupertino, CA  95014\n   United States\n   Email: amante@apple.com\n"
