- contents:
  - "               Multicast Virtual Private Network (MVPN):\n                     Using
    Bidirectional P-Tunnels\n"
  title: __initial_text__
- contents:
  - "Abstract\n   A set of prior RFCs specify procedures for supporting multicast
    in\n   BGP/MPLS IP VPNs.  These procedures allow customer multicast data to\n
    \  travel across a service provider's backbone network through a set of\n   multicast
    tunnels.  The tunnels are advertised in certain BGP\n   multicast auto-discovery
    routes, by means of a BGP attribute known\n   as the \"Provider Multicast Service
    Interface (PMSI) Tunnel\"\n   attribute.  Encodings have been defined that allow
    the PMSI Tunnel\n   attribute to identify bidirectional (multipoint-to-multipoint)\n
    \  multicast distribution trees.  However, the prior RFCs do not provide\n   all
    the necessary procedures for using bidirectional tunnels to\n   support multicast
    VPNs.  This document updates RFCs 6513, 6514, and\n   6625 by specifying those
    procedures.  In particular, it specifies the\n   procedures for assigning customer
    multicast flows (unidirectional or\n   bidirectional) to specific bidirectional
    tunnels in the provider\n   backbone, for advertising such assignments, and for
    determining which\n   flows have been assigned to which tunnels.\n"
  title: Abstract
- contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This
    document is a product of the Internet Engineering Task Force\n   (IETF).  It represents
    the consensus of the IETF community.  It has\n   received public review and has
    been approved for publication by\n   the Internet Engineering Steering Group (IESG).
    \ Further\n   information on Internet Standards is available in Section 2 of\n
    \  RFC 5741.\n   Information about the current status of this document, any\n
    \  errata, and how to provide feedback on it may be obtained at\n   http://www.rfc-editor.org/info/rfc7582.\n"
  title: Status of This Memo
- contents:
  - "Copyright Notice\n   Copyright (c) 2015 IETF Trust and the persons identified
    as the\n   document authors.  All rights reserved.\n   This document is subject
    to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n
    \  (http://trustee.ietf.org/license-info) in effect on the date of\n   publication
    of this document.  Please review these documents\n   carefully, as they describe
    your rights and restrictions with respect\n   to this document.  Code Components
    extracted from this document must\n   include Simplified BSD License text as described
    in Section 4.e of\n   the Trust Legal Provisions and are provided without warranty
    as\n   described in the Simplified BSD License.\n"
  title: Copyright Notice
- contents:
  - "Table of Contents\n   1. Introduction ....................................................4\n
    \     1.1. Terminology ................................................4\n      1.2.
    Overview ...................................................9\n           1.2.1.
    Bidirectional P-Tunnel Technologies ................10\n           1.2.2. Reasons
    for Using Bidirectional P-Tunnels ..........11\n           1.2.3. Knowledge of
    Group-to-RP and/or\n                  Group-to-RPA Mappings ..............................12\n
    \          1.2.4. PMSI Instantiation Methods .........................12\n   2.
    The All BIDIR-PIM Wildcard .....................................15\n   3. Using
    Bidirectional P-Tunnels ..................................15\n      3.1. Procedures
    Specific to the Tunneling Technology ...........15\n           3.1.1. BIDIR-PIM
    P-Tunnels ................................16\n           3.1.2. MP2MP LSPs .........................................17\n
    \     3.2. Procedures Specific to the PMSI Instantiation Method ......17\n           3.2.1.
    Flat Partitioning ..................................17\n                  3.2.1.1.
    When an S-PMSI Is a 'Match for\n                           Transmission' .............................19\n
    \                 3.2.1.2. When an I-PMSI Is a 'Match for\n                           Transmission'
    .............................20\n                  3.2.1.3. When an S-PMSI Is
    a 'Match for Reception' .21\n                  3.2.1.4. When an I-PMSI Is a 'Match
    for Reception' .22\n           3.2.2. Hierarchical Partitioning ..........................23\n
    \                 3.2.2.1. Advertisement of PE Distinguisher Labels ..24\n                  3.2.2.2.
    When an S-PMSI Is a 'Match for\n                           Transmission' .............................25\n
    \                 3.2.2.3. When an I-PMSI Is a 'Match for\n                           Transmission'
    .............................26\n                  3.2.2.4. When an S-PMSI Is
    a 'Match for Reception' .27\n                  3.2.2.5. When an I-PMSI Is a 'Match
    for Reception' .27\n           3.2.3. Unpartitioned ......................................28\n
    \                 3.2.3.1. When an S-PMSI Is a 'Match for\n                           Transmission'
    .............................30\n                  3.2.3.2. When an S-PMSI Is
    a 'Match for Reception' .30\n           3.2.4. Minimal Feature Set for Compliance
    .................31\n   4. Security Considerations ........................................32\n
    \  5. References .....................................................32\n      5.1.
    Normative References ......................................32\n      5.2. Informative
    References ....................................33\n   Acknowledgments ...................................................34\n
    \  Authors' Addresses ................................................34\n"
  title: Table of Contents
- contents:
  - "1.  Introduction\n   The RFCs that specify multicast support for BGP/MPLS IP
    VPNs\n   ([RFC6513], [RFC6514], and [RFC6625]) allow customer multicast data\n
    \  to be transported across a service provider's network though a set of\n   multicast
    tunnels.  These tunnels are advertised in BGP multicast\n   auto-discovery (A-D)
    routes, by means of a BGP attribute known as the\n   \"Provider Multicast Service
    Interface (PMSI) Tunnel\" attribute.  The\n   base specifications allow the use
    of bidirectional (multipoint-to-\n   multipoint) multicast distribution trees
    and describe how to encode\n   the identifiers for bidirectional trees into the
    PMSI Tunnel\n   attribute.  However, those specifications do not provide all the\n
    \  necessary detailed procedures for using bidirectional tunnels; the\n   full
    specification of these procedures was considered to be outside\n   the scope of
    those documents.  The purpose of this document is to\n   provide all the necessary
    procedures for using bidirectional trees in\n   a service provider's network to
    carry the multicast data of VPN\n   customers.\n"
  - contents:
    - "1.1.  Terminology\n   This document uses terminology from [RFC6513] and, in
      particular,\n   uses the prefixes \"C-\" and \"P-\", as specified in Section
      3.1 of\n   [RFC6513], to distinguish addresses in the \"customer address space\"\n
      \  from addresses in the \"provider address space\".  The following\n   terminology
      and acronyms are particularly important in this document:\n   o  MVPN\n      Multicast
      Virtual Private Network -- a VPN [RFC4364] in which\n      multicast service
      is offered.\n   o  VRF\n      VPN Routing and Forwarding table [RFC4364].\n
      \  o  PE\n      A Provider Edge router, as defined in [RFC4364].\n   o  SP\n
      \     Service Provider.\n   o  LSP\n      An MPLS Label Switched Path.\n   o
      \ P2MP\n      Point-to-Multipoint.\n   o  MP2MP\n      Multipoint-to-multipoint.\n
      \  o  Unidirectional\n      Adjective for a multicast distribution tree in which
      all traffic\n      travels downstream from the root of the tree.  Traffic can
      enter a\n      unidirectional tree only at the root.  A P2MP LSP is one type
      of\n      unidirectional tree.  Multicast distribution trees set up by\n      Protocol
      Independent Multicast - Sparse Mode (PIM-SM) [RFC4601]\n      are also unidirectional
      trees.  Data traffic traveling along a\n      unidirectional multicast distribution
      tree is sometimes referred\n      to in this document as \"unidirectional traffic\".\n
      \  o  Bidirectional\n      Adjective for a multicast distribution tree in which
      traffic may\n      travel both upstream (towards the root) and downstream (away
      from\n      the root).  Traffic may enter a bidirectional tree at any node.\n
      \     An MP2MP LSP is one type of bidirectional tree.  Multicast\n      distribution
      trees created by Bidirectional Protocol Independent\n      Multicast (BIDIR-PIM)
      [RFC5015] are also bidirectional trees.\n      Data traffic traveling along
      a bidirectional multicast\n      distribution tree is sometimes referred to
      in this document as\n      \"bidirectional traffic\".\n   o  P-tunnel\n      A
      tunnel through the network of one or more SPs.  In this\n      document, the
      P-tunnels we speak of are instantiated as\n      bidirectional multicast distribution
      trees.\n   o  SSM\n      Source-Specific Multicast.   When SSM is being used,
      a multicast\n      distribution tree carries traffic from only a single source.\n
      \  o  ASM\n      Any Source Multicast.  When ASM is being used, some multicast\n
      \     distribution trees (\"share trees\") carry traffic from multiple\n      sources.\n
      \  o  C-S\n      Multicast Source.  A multicast source address, in the address\n
      \     space of a customer network.\n   o  C-G\n      Multicast Group.  A multicast
      group address (destination address)\n      in the address space of a customer
      network.  When used without\n      qualification, \"C-G\" may refer to either
      a unidirectional group\n      address or a bidirectional group address.\n   o
      \ C-G-BIDIR\n      A bidirectional multicast group address (i.e., a group address\n
      \     whose IP multicast distribution tree is built by BIDIR-PIM).\n   o  C-multicast
      flow or C-flow\n      A customer multicast flow.  A C-flow travels through VPN
      customer\n      sites on a multicast distribution tree set up by the customer.\n
      \     These trees may be unidirectional or bidirectional, depending upon\n      the
      multicast routing protocol used by the customer.  A C-flow\n      travels between
      VPN customer sites by traveling through P-tunnels.\n      A C-flow from a particular
      customer source is identified by the\n      ordered pair (source address, group
      address), where each address\n      is in the customer's address space.  The
      identifier of such a\n      C-flow is usually written as (C-S,C-G).\n      If
      a customer uses the ASM model, then some or all of the\n      customer's C-flows
      may be traveling along the same \"shared tree\".\n      In this case, we will
      speak of a \"(C-*,C-G)\" flow to refer to a\n      set of C-flows that travel
      along the same shared tree in the\n      customer sites.\n   o  C-BIDIR flow
      or bidirectional C-flow\n      A C-flow that, in the VPN customer sites, travels
      along a\n      bidirectional multicast distribution tree.  The term \"C-BIDIR\n
      \     flow\" indicates that the customer's bidirectional tree has been\n      set
      up by BIDIR-PIM.\n   o  RP\n      A Rendezvous Point, as defined in [RFC4601].\n
      \  o  C-RP\n      A Rendezvous Point whose address is in the customer's address\n
      \     space.\n   o  RPA\n      A Rendezvous Point Address, as defined in [RFC5015].\n
      \  o  C-RPA\n      An RPA in the customer's address space.\n   o  P-RPA\n      An
      RPA in the SP's address space.\n   o  Selective P-tunnel\n      A P-tunnel that
      is joined only by PE routers that need to receive\n      one or more of the
      C-flows that are traveling through that\n      P-tunnel.\n   o  Inclusive P-tunnel\n
      \     A P-tunnel that is joined by all PE routers that attach to sites\n      of
      a given MVPN.\n   o  PMSI\n      Provider Multicast Service Interface.  A PMSI
      is a conceptual\n      overlay on a Service Provider backbone, allowing a PE
      in a given\n      MVPN to multicast to other PEs in the MVPN.  PMSIs are\n      instantiated
      by P-tunnels.\n   o  I-PMSI\n      Inclusive PMSI.  Traffic multicast by a PE
      on an I-PMSI is\n      received by all other PEs in the MVPN.  I-PMSIs are instantiated\n
      \     by Inclusive P-tunnels.\n   o  S-PMSI\n      Selective PMSI.  Traffic
      multicast by a PE on an S-PMSI is\n      received by some (but not necessarily
      all) of the other PEs in the\n      MVPN.  S-PMSIs are instantiated by Selective
      P-tunnels.\n   o  Intra-AS I-PMSI A-D route\n      Intra-AS (Autonomous System)
      Inclusive Provider Multicast Service\n      Interface Auto-Discovery route.
      \ Carried in BGP Update messages,\n      these routes can be used to advertise
      the use of Inclusive\n      P-tunnels.  See [RFC6514], Section 4.1.\n   o  S-PMSI
      A-D route\n      Selective Provider Multicast Service Interface Auto-Discovery\n
      \     route.  Carried in BGP Update messages, these routes are used to\n      advertise
      the fact that a particular C-flow or a particular set of\n      C-flows is bound
      to (i.e., is traveling through) a particular\n      P-tunnel.  See [RFC6514],
      Section 4.3.\n   o  (C-S,C-G) S-PMSI A-D route\n      An S-PMSI A-D route whose
      NLRI (Network Layer Reachability\n      Information) contains C-S in its \"Multicast
      Source\" field and C-G\n      in its \"Multicast Group\" field.\n   o  (C-*,C-G)
      S-PMSI A-D route\n      An S-PMSI A-D route whose NLRI contains the wildcard
      (C-*) in its\n      \"Multicast Source\" field and C-G in its \"Multicast Group\"
      field.\n      See [RFC6625].\n   o  (C-*,C-G-BIDIR) S-PMSI A-D route\n      An
      S-PMSI A-D route whose NLRI contains the wildcard (C-*) in its\n      \"Multicast
      Source\" field and C-G-BIDIR in its \"Multicast Group\"\n      field.  See [RFC6625].\n
      \  o  (C-*,C-*) S-PMSI A-D route\n      An S-PMSI A-D route whose NLRI contains
      the wildcard C-* in its\n      \"Multicast Source\" field and the wildcard C-*
      in its \"Multicast\n      Group\" field.  See [RFC6625].\n   o  (C-*,C-*-BIDIR)
      S-PMSI A-D route\n      An S-PMSI A-D route whose NLRI contains the wildcard
      C-* in its\n      \"Multicast Source\" field and the wildcard \"C-*-BIDIR\"
      in its\n      \"Multicast Group\" field.  See Section 2 of this document.\n
      \  o  (C-S,C-*) S-PMSI A-D route\n      An S-PMSI A-D route whose NLRI contains
      C-S in its \"Multicast\n      Source\" field and the wildcard C-* in its \"Multicast
      Group\" field.\n      See [RFC6625].\n   o  Wildcard S-PMSI A-D route\n      A
      (C-*,C-G) S-PMSI A-D route, a (C-*,C-*) S-PMSI A-D route, a\n      (C-S,C-*)
      S-PMSI A-D route, or a (C-*,C-*-BIDIR) S-PMSI A-D route.\n   o  PTA\n      PMSI
      Tunnel attribute, a BGP attribute that identifies a P-tunnel.\n      See [RFC6514],
      Section 8.\n   The terminology used for categorizing S-PMSI A-D routes will
      also be\n   used for categorizing the S-PMSIs advertised by those routes.  For\n
      \  example, the S-PMSI advertised by a (C-*,C-G) S-PMSI A-D route will\n   be
      known as a \"(C-*,C-G) S-PMSI\".\n   Familiarity with multicast concepts and
      terminology [RFC4601] is also\n   presupposed.\n   This specification uses the
      terms \"match for transmission\" and \"match\n   for reception\" as they are
      defined in [RFC6625].  When it is clear\n   from the context whether we are
      talking of transmission or reception,\n   we will sometimes talk simply of a
      C-flow \"matching\" an I-PMSI or\n   S-PMSI A-D route.\n   The key words \"MUST\",
      \"MUST NOT\", \"REQUIRED\", \"SHALL\", \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD
      NOT\", \"RECOMMENDED\", \"MAY\", and \"OPTIONAL\" in this\n   document, when
      and only when appearing in all caps, are to be\n   interpreted as described
      in [RFC2119].\n"
    title: 1.1.  Terminology
  - contents:
    - "1.2.  Overview\n   The base documents for MVPN ([RFC6513] and [RFC6514]) define
      a \"PMSI\n   Tunnel attribute\" (PTA).  This is a BGP Path attribute that may
      be\n   attached to the BGP \"I-PMSI A-D routes\" and \"S-PMSI A-D routes\" that\n
      \  are defined in those documents.  The base documents define the way in\n   which
      the identifier of a bidirectional P-tunnel is to be encoded in\n   the PTA.
      \ However, those documents do not contain the full set of\n   specifications
      governing the use of bidirectional P-tunnels; rather,\n   those documents declare
      the full set of specifications for using\n   bidirectional P-tunnels to be outside
      their scope.  Similarly, the\n   use of bidirectional P-tunnels advertised in
      wildcard S-PMSI A-D\n   routes is declared by [RFC6625] to be \"outside the
      scope\" of that\n   document.\n   This document provides the specifications
      governing the use of\n   bidirectional P-tunnels to provide MVPN support.  This
      includes the\n   procedures for assigning C-flows to specific bidirectional
      P-tunnels,\n   for advertising the fact that a particular C-flow has been assigned\n
      \  to a particular bidirectional P-tunnel, and for determining the\n   bidirectional
      P-tunnel on which a given C-flow may be expected.\n   The C-flows carried on
      bidirectional P-tunnels may, themselves, be\n   either unidirectional or bidirectional.
      \ Procedures are provided for\n   both cases.\n   This document does not specify
      any new data encapsulations for\n   bidirectional P-tunnels.  Section 12 (\"Encapsulations\")
      of [RFC6513]\n   applies unchanged.\n   With regard to the procedures for using
      bidirectional P-tunnels to\n   instantiate PMSIs, if there is any conflict between
      the procedures\n   specified in this document and the procedures of [RFC6513],\n
      \  [RFC6514], or [RFC6625], the procedures of this document take\n   precedence.\n
      \  The use of bidirectional P-tunnels to support extranets [MVPN-XNET]\n   is
      outside the scope of this document.  The use of bidirectional\n   P-tunnels
      as \"segmented P-tunnels\" (see Section 8 of [RFC6513] and\n   various sections
      of [RFC6514]) is also outside the scope of this\n   document.\n"
    - contents:
      - "1.2.1.  Bidirectional P-Tunnel Technologies\n   This document supports two
        different technologies for creating and\n   maintaining bidirectional P-tunnels:\n
        \  o  Multipoint-to-multipoint Label Switched Paths (MP2MP LSPs) that\n      are
        created through the use of the Label Distribution Protocol\n      (LDP) Multipoint-to-Multipoint
        extensions [RFC6388].\n   o  Multicast distribution trees that are created
        through the use of\n      BIDIR-PIM [RFC5015].\n   Other bidirectional tunnel
        technologies are outside the scope of this\n   document.\n"
      title: 1.2.1.  Bidirectional P-Tunnel Technologies
    - contents:
      - "1.2.2.  Reasons for Using Bidirectional P-Tunnels\n   Bidirectional P-tunnels
        can be used to instantiate I-PMSIs and/or\n   S-PMSIs.\n   An SP may decide
        to use bidirectional P-tunnels to instantiate\n   certain I-PMSIs and/or S-PMSIs
        in order to provide its customers with\n   C-BIDIR support, using the \"Partitioned
        Set of PEs\" technique\n   discussed in Section 11.2 of [RFC6513] and Section
        3.6 of [RFC6517].\n   This technique can be used whether the C-BIDIR flows
        are being\n   carried on an I-PMSI or an S-PMSI.\n   Even if an SP does not
        need to provide C-BIDIR support, it may still\n   decide to use bidirectional
        P-tunnels, in order to save state in the\n   network's transit nodes.  For
        example, if an MVPN has n PEs attached\n   to sites with multicast sources,
        and there is an I-PMSI for that\n   MVPN, instantiating the I-PMSI with unidirectional
        P-tunnels (i.e.,\n   with P2MP multicast distribution trees) requires n multicast\n
        \  distribution trees, each one rooted at a different PE.  If the I-PMSI\n
        \  is instantiated by a bidirectional P-tunnel, a single multicast\n   distribution
        tree can be used, assuming appropriate support by the\n   provisioning system.\n
        \  An SP may decide to use bidirectional P-tunnels for either or both of\n
        \  these reasons.  Note that even if the reason for using bidirectional\n
        \  P-tunnels is to provide C-BIDIR support, the same P-tunnels can also\n
        \  be used to carry unidirectional C-flows, if that is the choice of the\n
        \  SP.\n   These two reasons for using bidirectional P-tunnels may appear
        to be\n   somewhat in conflict with each other, since (as will be seen in\n
        \  subsequent sections) the use of bidirectional P-tunnels for C-BIDIR\n   support
        may require multiple bidirectional P-tunnels per VPN.  Each\n   such P-tunnel
        is associated with a particular \"distinguished PE\", and\n   can only carry
        those C-BIDIR flows whose C-RPAs are reachable through\n   its distinguished
        PE.  However, on platforms that support MPLS\n   upstream-assigned labels
        ([RFC5331]), PE Distinguisher Labels\n   (Section 4 of [RFC6513] and Section
        8 of [RFC6514]) can be used to\n   aggregate multiple bidirectional P-tunnels
        onto a single outer\n   bidirectional P-tunnel, thereby allowing one to provide
        C-BIDIR\n   support with minimal state at the transit nodes.\n   Since there
        are two fundamentally different reasons for using\n   bidirectional P-tunnels,
        and since many deployed router platforms do\n   not support upstream-assigned
        labels at the current time, this\n   document specifies several different
        methods of using bidirectional\n   P-tunnels to instantiate PMSIs.  We refer
        to these as \"PMSI\n   Instantiation Methods\".  The method or methods deployed
        by any\n   particular SP will depend upon that SP's goals and engineering
        trade-\n   offs and upon the set of platforms deployed by that SP.\n   The
        rules for using bidirectional P-tunnels in I-PMSI or S-PMSI A-D\n   routes
        are not exactly the same as the rules for using unidirectional\n   P-tunnels,
        and the rules are also different for the different PMSI\n   instantiation
        methods.  Subsequent sections of this document specify\n   the rules in detail.\n"
      title: 1.2.2.  Reasons for Using Bidirectional P-Tunnels
    - contents:
      - "1.2.3.  Knowledge of Group-to-RP and/or Group-to-RPA Mappings\n   If a VPN
        customer is making use of a particular ASM group address,\n   the PEs of that
        VPN generally need to know the group-to-RP mappings\n   that are used within
        the VPN.  If a VPN customer is making use of\n   BIDIR-PIM group addresses,
        the PEs need to know the group-to-RPA\n   mappings that are used within the
        VPN.  Commonly, the PEs obtain this\n   knowledge either through provisioning
        or by participating in a\n   dynamic \"group-to-RP(A) mapping discovery protocol\"
        that runs within\n   the VPN.  However, the way in which this knowledge is
        obtained is\n   outside the scope of this document.\n   The PEs also need
        to be able to forward traffic towards the C-RPs\n   and/or C-RPAs and to determine
        whether the next-hop interface of the\n   route to a particular C-RP(A) is
        a VRF interface or a PMSI.  This is\n   done by applying the procedures of
        [RFC6513], Section 5.1.\n"
      title: 1.2.3.  Knowledge of Group-to-RP and/or Group-to-RPA Mappings
    - contents:
      - "1.2.4.  PMSI Instantiation Methods\n   This document specifies three methods
        for using bidirectional\n   P-tunnels to instantiate PMSIs: two partitioned
        methods (the Flat\n   Partitioned Method and the Hierarchical Partitioned
        Method) and the\n   Unpartitioned Method.\n   o  Partitioned Methods\n      In
        the Partitioned Methods, a particular PMSI is instantiated by a\n      set
        of bidirectional P-tunnels.  These P-tunnels may be aggregated\n      (as
        inner P-tunnels) into a single outer bidirectional P-tunnel\n      (\"Hierarchical
        Partitioning\"), or they may be unaggregated (\"Flat\n      Partitioning\").
        \ Any PE that joins one of these P-tunnels can\n      transmit a packet on
        it, and the packet will be received by all\n      the other PEs that have
        joined the P-tunnel.  For each such\n      P-tunnel (each inner P-tunnel,
        in the case of Hierarchical\n      Partitioning) there is one PE that is its
        distinguished PE.  When\n      a PE receives a packet from a given P-tunnel,
        the PE can determine\n      from the packet's encapsulation the P-tunnel it
        has arrived on,\n      and it can thus infer the identity of the distinguished
        PE\n      associated with the packet.  This association plays an important\n
        \     role in the treatment of the packet, as specified later on in this\n
        \     document.\n      The number of P-tunnels needed (the number of inner
        P-tunnels\n      needed, if Hierarchical Partitioning is used) depends upon
        a\n      number of factors that are described later in this document.\n      The
        Hierarchical Partitioned Method requires the use of upstream-\n      assigned
        MPLS labels (PE Distinguisher Labels) and requires the\n      use of the PE
        Distinguisher Labels attribute in BGP.  The Flat\n      Partitioned Method
        requires neither of these.\n      The Partitioned Method (either Flat or Hierarchical)
        is a\n      prerequisite for implementing the \"Partitioned Sets of PEs\"\n
        \     technique of supporting C-BIDIR, as discussed in [RFC6513],\n      Section
        11.2.  The Partitioned Method (either Flat or\n      Hierarchical) is also
        a prerequisite for applying the \"Discarding\n      Packets from Wrong PE\"
        technique, discussed in [RFC6513], Section\n      9.1.1, to a PMSI that is
        instantiated by a bidirectional P-tunnel.\n      The Flat Partitioned Method
        is a prerequisite for implementing the\n      \"Partial Mesh of MP2MP P-Tunnels\"
        technique for carrying customer\n      bidirectional (C-BIDIR) traffic, as
        discussed in [RFC6513],\n      Section 11.2.3.\n      The Hierarchical Partitioned
        Method is a prerequisite for\n      implementing the \"Using PE Distinguisher
        Labels\" technique of\n      carrying customer bidirectional (C-BIDIR) traffic,
        as discussed in\n      [RFC6513], Section 11.2.2.\n      Note that a particular
        deployment may choose to use the\n      Partitioned Methods for carrying the
        C-BIDIR traffic on\n      bidirectional P-tunnels, while carrying other traffic
        either on\n      unidirectional P-tunnels or on bidirectional P-tunnels using
        the\n      Unpartitioned Method.  Routers in a given deployment must be\n
        \     provisioned to know which PMSI instantiation method to use for\n      which
        PMSIs.\n      There may be ways of implementing the Partitioned Methods with\n
        \     PMSIs that are instantiated by unidirectional P-tunnels.  (See,\n      e.g.,
        [MVPN-BIDIR-IR].)  However, that is outside the scope of the\n      current
        document.\n   o  Unpartitioned Method\n      In the Unpartitioned Method,
        a particular PMSI can be instantiated\n      by a single bidirectional P-tunnel.
        \ Any PE that joins the tunnel\n      can transmit a packet on it, and the
        packet will be received by\n      all the other PEs that have joined the tunnel.
        \ The receiving PEs\n      can determine the tunnel on which the packet was
        transmitted, but\n      they cannot determine which PE transmitted the packet,
        nor can\n      they associate the packet with any particular distinguished
        PE.\n      When the Unpartitioned Method is used, this document does not\n
        \     mandate that only one bidirectional P-tunnel be used to\n      instantiate
        each PMSI.  It allows for the case where more than one\n      P-tunnel is
        used.  In this case, the transmitting PEs will have a\n      choice of which
        such P-tunnel to use when transmitting, and the\n      receiving PEs must
        be prepared to receive from any of those\n      P-tunnels.  The use of multiple
        P-tunnels in this case provides\n      additional robustness, but it does
        not provide additional\n      functionality.\n   If bidirectional P-tunnels
        are being used to instantiate the PMSIs of\n   a given MVPN, one of these
        methods must be chosen for that MVPN.  All\n   the PEs of that MVPN must be
        provisioned to know the method that is\n   being used for that MVPN.\n   I-PMSIs
        may be instantiated by bidirectional P-tunnels using either\n   the Partitioned
        (either Flat or Hierarchical) Methods or the\n   Unpartitioned Method.  The
        method used for a given MVPN is determined\n   by provisioning.  It SHOULD
        be possible to provision this on a per-\n   MVPN basis, but all the VRFs of
        a single MVPN MUST be provisioned to\n   use the same method for the given
        MVPN's I-PMSI.\n   If a bidirectional P-tunnel is used to instantiate an S-PMSI\n
        \  (including the case of a (C-*,C-*) S-PMSI), either the Partitioned\n   Methods
        (either Flat or Hierarchical) or the Unpartitioned Method may\n   be used.
        \ The method used by a given VRF is determined by\n   provisioning.  It is
        desirable to be able to provision this on a per-\n   MVPN basis.  All the
        VRFs of a single MVPN MUST be provisioned to use\n   the same method for those
        of their S-PMSIs that are instantiated by\n   bidirectional P-tunnels.\n   If
        one of the Partitioned Methods is used, all the VRFs of a single\n   MVPN
        MUST be provisioned to use the same variant of the Partitioned\n   Methods,
        i.e., either they must all use the Flat Partitioned Method\n   or they must
        all use the Hierarchical Partitioned Method.\n   It is valid to use the Unpartitioned
        Method to instantiate the\n   I-PMSIs, while using one of the Partitioned
        Methods to instantiate\n   the S-PMSIs.\n   It is valid to instantiate some
        S-PMSIs by unidirectional P-tunnels\n   and others by bidirectional P-tunnels.\n
        \  The procedures for the use of bidirectional P-tunnels, specified in\n   subsequent
        sections of this document, depend on both the tunnel\n   technology and the
        PMSI instantiation method.  Note that this\n   document does not specify procedures
        for every possible combination\n   of tunnel technology and PMSI instantiation
        method.\n"
      title: 1.2.4.  PMSI Instantiation Methods
    title: 1.2.  Overview
  title: 1.  Introduction
- contents:
  - "2.  The All BIDIR-PIM Wildcard\n   [RFC6514] specifies the method of encoding
    C-multicast source and\n   group addresses into the NLRI of certain BGP routes.
    \ [RFC6625]\n   extends that specification by allowing the source and/or group\n
    \  address to be replaced by a wildcard.  When an MVPN customer is using\n   BIDIR-PIM,
    it is useful to be able to advertise an S-PMSI A-D route\n   whose semantics are
    \"by default, all BIDIR-PIM C-multicast traffic\n   (within a given VPN) that
    has not been bound to any other P-tunnel is\n   bound to the bidirectional P-tunnel
    identified by the PTA of this\n   route\".  This can be especially useful if one
    is using a\n   bidirectional P-tunnel to carry the C-BIDIR flows while using\n
    \  unidirectional P-tunnels to carry other C-flows.  To do this, it is\n   necessary
    to have a way to encode a (C-*,C-*) wildcard that is\n   restricted to BIDIR-PIM
    C-groups.\n   Therefore, we define a special value of the group wildcard, whose\n
    \  meaning is \"all BIDIR-PIM groups\".  The \"BIDIR-PIM groups wildcard\"\n   is
    encoded as a group field whose length is 8 bits and whose value is\n   zero.  That
    is, the \"multicast group length\" field contains the value\n   0x08, and the
    \"multicast group\" field is a single octet containing\n   the value 0x00.  (This
    encoding is distinct from the group wildcard\n   encoding defined in [RFC6625]).
    \ We will use the notation\n   (C-*,C-*-BIDIR) to refer to the \"all BIDIR-PIM
    groups\" wildcard.\n"
  title: 2.  The All BIDIR-PIM Wildcard
- contents:
  - "3.  Using Bidirectional P-Tunnels\n   A bidirectional P-tunnel may be advertised
    in the PTA of an Intra-AS\n   I-PMSI A-D route or in the PTA of an S-PMSI A-D
    route.  The\n   advertisement of a bidirectional P-tunnel in the PTA of an Inter-AS\n
    \  I-PMSI A-D route is outside the scope of this document.\n"
  - contents:
    - "3.1.  Procedures Specific to the Tunneling Technology\n   This section discusses
      the procedures that are specific to a given\n   tunneling technology (BIDIR-PIM
      or the MP2MP procedures of mLDP\n   (Multipoint LDP)) but that are independent
      of the method\n   (Unpartitioned, Flat Partitioned, or Hierarchical Partitioned)
      used\n   to instantiate a PMSI.\n"
    - contents:
      - "3.1.1.  BIDIR-PIM P-Tunnels\n   Each BIDIR-PIM P-tunnel is identified by
        a unique P-group address\n   ([RFC6513], Section 3.1).  (The P-group address
        is called a\n   \"P-Multicast Group\" in [RFC6514]).  Section 5 of [RFC6514]
        specifies\n   the way to identify a particular BIDIR-PIM P-tunnel in the PTA
        of an\n   I-PMSI or S-PMSI A-D route.\n   Ordinary BIDIR-PIM procedures are
        used to set up the BIDIR-PIM\n   P-tunnels.  A BIDIR-PIM P-group address is
        always associated with a\n   unique Rendezvous Point Address (RPA) in the
        SP's address space.  We\n   will refer to this as the \"P-RPA\".  Every PE
        needing to join a\n   particular BIDIR-PIM P-tunnel must be able to determine
        the P-RPA\n   that corresponds to the P-tunnel's P-group address.  To construct
        the\n   P-tunnel, PIM Join/Prune messages are sent along the path from the
        PE\n   to the P-RPA.  Any P routers along that path must also be able to\n
        \  determine the P-RPA, so that they too can send PIM Join/Prune\n   messages
        towards it.  The method of mapping a P-group address to an\n   RPA may be
        static configuration, or some automated means of RPA\n   discovery that is
        outside the scope of this specification.\n   If a BIDIR-PIM P-tunnel is used
        to instantiate an I-PMSI or an\n   S-PMSI, it is RECOMMENDED that the path
        from each PE in the tunnel to\n   the RPA consist entirely of point-to-point
        links.  On a point-to-\n   point link, there is no ambiguity in determining
        which router is\n   upstream towards a particular RPA, so the BIDIR-PIM \"Designated\n
        \  Forwarder Election\" is very quick and simple.  Use of a BIDIR-PIM\n   P-tunnel
        containing multiaccess links is possible, but considerably\n   more complex.\n
        \  The use of BIDIR-PIM P-tunnels to support the Hierarchical\n   Partitioned
        Method is outside the scope of this document.\n   When the PTA of an Intra-AS
        I-PMSI A-D route or an S-PMSI A-D route\n   identifies a BIDIR-PIM tunnel,
        the originator of the route SHOULD NOT\n   include a PE Distinguisher Labels
        attribute.  If it does, that\n   attribute MUST be ignored.  When we say the
        attribute is \"ignored\",\n   we do not mean that its normal BGP processing
        is not done, but that\n   the attribute has no effect on the data plane.  However,
        it MUST be\n   treated by BGP as if it were an unsupported optional transitive\n
        \  attribute.  (PE Distinguisher Labels are used for the Hierarchical\n   Partitioning
        Method, but this document does not provide support for\n   the Hierarchical
        Partitioning Method with BIDIR-PIM P-tunnels.)\n"
      title: 3.1.1.  BIDIR-PIM P-Tunnels
    - contents:
      - "3.1.2.  MP2MP LSPs\n   Each MP2MP LSP is identified by a unique \"MP2MP FEC
        (Forwarding\n   Equivalence Class) element\" [RFC6388].  The FEC element contains
        the\n   IP address of the root node, followed by an opaque value that\n   identifies
        the MP2MP LSP uniquely in the context of the root node's\n   IP address.  This
        opaque value may be configured or autogenerated;\n   there is no need for
        different root nodes to use the same opaque\n   value for a given MVPN.\n
        \  The mLDP specification supports the use of several different ways of\n
        \  constructing the tunnel identifiers.  The current specification does\n
        \  not place any restriction on the type or types of tunnel identifier\n   that
        is used in a given deployment.  A given implementation is not\n   expected
        to be able to advertise (in the PTAs of I-PMSI or S-PMSI A-D\n   routes) tunnel
        identifiers of every possible type.  However, an\n   implementation SHOULD
        be able to accept and properly process a PTA\n   that uses any legal type
        of tunnel identifier.\n   Section 5 of [RFC6514] specifies the way to identify
        a particular\n   MP2MP P-tunnel in the PTA of an I-PMSI or S-PMSI A-D route.\n
        \  Ordinary mLDP procedures for MP2MP LSPs are used to set up the MP2MP\n
        \  LSP.\n"
      title: 3.1.2.  MP2MP LSPs
    title: 3.1.  Procedures Specific to the Tunneling Technology
  - contents:
    - "3.2.  Procedures Specific to the PMSI Instantiation Method\n   When either
      the Flat Partitioned Method or the Hierarchical\n   Partitioned Method is used
      to implement the \"Partitioned Sets of PEs\"\n   method of supporting C-BIDIR,
      as discussed in Section 11.2 of\n   [RFC6513] and Section 3.6 of [RFC6517],
      a C-BIDIR flow MUST be\n   carried only on an I-PMSI or on a (C-*,C-G-BIDIR),
      (C-*,C-*-BIDIR),\n   or (C-*,C-*) S-PMSI.  A PE MUST NOT originate any (C-S,C-G-BIDIR)\n
      \  S-PMSI A-D routes.  (Though it may, of course, originate (C-S,C-G)\n   S-PMSI
      A-D routes for C-G's that are not C-BIDIR groups.)  Packets of\n   a C-BIDIR
      flow MUST NOT be carried on a (C-S,C-*) S-PMSI.\n   Sections 3.2.1 and 3.2.2
      specify additional details of the two\n   Partitioned Methods.\n"
    - contents:
      - "3.2.1.  Flat Partitioning\n   The procedures of this section and its subsections
        apply when (and\n   only when) the Flat Partitioned Method is used.  This
        method is\n   introduced in [RFC6513], Section 11.2.3, where it is called
        \"Partial\n   Mesh of MP2MP P-Tunnels\".  This method can be used with MP2MP
        LSPs or\n   with BIDIR-PIM P-tunnels.\n   When a PE originates an I-PMSI or
        S-PMSI A-D route whose PTA\n   specifies a bidirectional P-tunnel, the PE
        MUST be the root node of\n   the specified P-tunnel.\n   If BIDIR-PIM P-tunnels
        are used, each advertised P-tunnel MUST have a\n   distinct P-group address.
        \ The PE advertising the tunnel will be\n   considered to be the root node
        of the tunnel.  Note that this creates\n   a unique mapping from P-group address
        to root node.  The assignment\n   of P-group addresses to MVPNs is by provisioning.\n
        \  If MP2MP LSPs are used, each P-tunnel MUST have a distinct MP2MP FEC\n
        \  (i.e., a distinct combination of root node and opaque value).  The PE\n
        \  advertising the tunnel MUST be the same PE identified in the root\n   node
        field of the MP2MP FEC that is encoded in the PTA.\n   It follows that two
        different PEs may not advertise the same\n   bidirectional P-tunnel.  Any
        PE that receives a packet from the\n   P-tunnel can infer the identity of
        the P-tunnel from the packet's\n   encapsulation.  Once the identity of the
        P-tunnel is known, the root\n   node of the P-tunnel is also known.  The root
        node of the P-tunnel on\n   which the packet arrived is treated as the distinguished
        PE for that\n   packet.\n   The Flat Partitioned Method does not use upstream-assigned
        labels in\n   the data plane, and hence does not use the BGP PE Distinguisher\n
        \  Labels attribute.  When this method is used, I-PMSI and/or S-PMSI A-D\n
        \  routes SHOULD NOT contain a PE Distinguisher Labels attribute; if\n   such
        an attribute is present in a received I-PMSI or S-PMSI A-D\n   route, it MUST
        be ignored.  (When we say the attribute is \"ignored\",\n   we do not mean
        that its normal BGP processing is not done, but that\n   the attribute has
        no effect on the data plane.  It MUST, however, be\n   treated by BGP as if
        it were an unsupported optional transitive\n   attribute.)\n   When the Flat
        Partitioned Method is used to instantiate the I-PMSIs\n   of a given MVPN,
        every PE in that MVPN that originates an Intra-AS\n   I-PMSI A-D route MUST
        include a PTA that specifies a bidirectional\n   P-tunnel.  If the intention
        is to carry C-BIDIR traffic on the\n   I-PMSI, a PE MUST originate an Intra-AS
        I-PMSI A-D route if one of\n   its VRF interfaces is the next-hop interface
        on its best path to the\n   C-RPA of any bidirectional C-group of the MVPN.\n
        \  When the Flat Partitioned Method is used to instantiate a (C-*,C-*)\n   S-PMSI,
        a (C-*,C-*-BIDIR) S-PMSI, or a (C-*,C-G-BIDIR) S-PMSI, a PE\n   that originates
        the corresponding S-PMSI A-D route MUST include in\n   that route a PTA specifying
        a bidirectional P-tunnel.  Per the\n   procedures of [RFC6513] and [RFC6514],
        a PE will originate such an\n   S-PMSI A-D route only if one of the PE's VRF
        interfaces is the next-\n   hop interface of the PE's best path to the C-RPA
        of a C-BIDIR group\n   that is to be carried on the specified S-PMSI.\n   PMSIs
        that are instantiated via the Flat Partitioned Method may carry\n   customer
        bidirectional traffic AND customer unidirectional traffic.\n   The rules of
        Sections 3.2.1.1 and 3.2.1.2 determine when a given\n   customer multicast
        packet is a match for transmission to a given\n   PMSI.  However, if the \"Partitioned
        Set of PEs\" method of supporting\n   C-BIDIR traffic is being used for a
        given MVPN, the PEs must be\n   provisioned in such a way that packets from
        a C-BIDIR flow of that\n   MVPN never match any PMSI that is not instantiated
        by a bidirectional\n   P-tunnel.  (For example, if the given MVPN's (C-*,C-*)
        S-PMSI were\n   not instantiated by a bidirectional P-tunnel, one could meet
        this\n   requirement by carrying all C-BIDIR traffic of that MVPN on a\n   (C-*,C-*-BIDIR)
        S-PMSI.)\n   When a PE receives a customer multicast data packet from a\n
        \  bidirectional P-tunnel, it associates that packet with a\n   distinguished
        PE.  The distinguished PE for a given packet is the\n   root node of the tunnel
        from which the packet is received.  The rules\n   of Sections 3.2.1.1 and
        3.2.1.2 ensure that:\n   o  If the received packet is part of a unidirectional
        C-flow, its\n      distinguished PE is the PE that transmitted the packet
        onto the\n      P-tunnel.\n   o  If the received packet is part of a bidirectional
        C-flow, its\n      distinguished PE is not necessarily the PE that transmitted
        it,\n      but rather the transmitter's upstream PE [RFC6513] for the C-RPA\n
        \     of the bidirectional C-group.\n   The rules of Sections 3.2.1.3 and
        3.2.1.4 allow the receiving PEs to\n   determine the expected distinguished
        PE for each C-flow, and ensure\n   that a packet will be discarded if its
        distinguished PE is not the\n   expected distinguished PE for the C-flow to
        which the packet belongs.\n   This prevents duplication of data for both bidirectional
        and\n   unidirectional C-flows.\n"
      - contents:
        - "3.2.1.1.  When an S-PMSI Is a 'Match for Transmission'\n   Suppose a given
          PE, say PE1, needs to transmit multicast data packets\n   of a particular
          C-flow.  Section 3.1 of [RFC6625] gives a four-step\n   algorithm for determining
          the S-PMSI A-D route, if any, that matches\n   that C-flow for transmission.\n
          \  If the C-flow is not a BIDIR-PIM C-flow, those rules apply unchanged;\n
          \  the remainder of this section applies only to C-BIDIR flows.  If a\n
          \  C-BIDIR flow has group address C-G-BIDIR, the rules applied by PE1\n
          \  are given below:\n   o  If the C-RPA for C-G-BIDIR is a C-address of
          PE1, or if PE1's\n      route to the C-RPA is via a VRF interface, then:\n
          \     *  If there is a (C-*,C-G-BIDIR) S-PMSI A-D route currently\n         originated
          by PE1, then the C-flow matches that route.\n      *  Otherwise, if there
          is a (C-*,C-*-BIDIR) S-PMSI A-D route\n         currently originated by
          PE1, then the C-flow matches that\n         route.\n      *  Otherwise,
          if there is a (C-*,C-*) S-PMSI A-D route currently\n         originated
          by PE1, then the C-flow matches that route.\n   o  If PE1 determines the
          upstream PE for C-G-BIDIR's C-RPA to be some\n      other PE, say PE2, then:\n
          \     *  If there is an installed (C-*,C-G-BIDIR) S-PMSI A-D route\n         originated
          by PE2, then the C-flow matches that route.\n      *  Otherwise, if there
          is an installed (C-*,C-*-BIDIR) S-PMSI A-D\n         route originated by
          PE2, then the C-flow matches that route.\n      *  Otherwise, if there is
          an installed (C-*,C-*) S-PMSI A-D route\n         originated by PE2, then
          the C-flow matches that route.\n   If there is an S-PMSI A-D route that
          matches a given C-flow, and if\n   PE1 needs to transmit packets of that
          C-flow or other PEs, then it\n   MUST transmit those packets on the bidirectional
          P-tunnel identified\n   in the PTA of the matching S-PMSI A-D route.\n"
        title: 3.2.1.1.  When an S-PMSI Is a 'Match for Transmission'
      - contents:
        - "3.2.1.2.  When an I-PMSI Is a 'Match for Transmission'\n   Suppose a given
          PE, say PE1, needs to transmit packets of a given\n   C-flow (of a given
          MVPN) to other PEs, but according to the\n   conditions of Section 3.2.1.1
          and/or Section 3.1 of [RFC6625], that\n   C-flow does not match any S-PMSI
          A-D route.  Then, the packets of the\n   C-flow need to be transmitted on
          the MVPN's I-PMSI.\n   If the C-flow is not a BIDIR-PIM C-flow, the P-tunnel
          on which the\n   C-flow MUST be transmitted is the one identified in the
          PTA of the\n   Intra-AS I-PMSI A-D route originated by PE1 for the given
          MVPN.\n   If the C-flow is a BIDIR-PIM C-flow with group address C-G-BIDIR,
          the\n   rules applied by PE1 are:\n   o  Suppose that the C-RPA for C-G-BIDIR
          is a C-address of PE1, or\n      that PE1's route to the C-RPA is via a
          VRF interface.   Then, if\n      there is an I-PMSI A-D route currently
          originated by PE1, the\n      C-flow MUST be transmitted on the P-tunnel
          identified in the PTA\n      of that I-PMSI A-D route.\n   o  If PE1 determines
          the upstream PE for C-G-BIDIR's C-RPA to be some\n      other PE, say PE2,
          then if there is an installed I-PMSI A-D route\n      originated by PE2,
          the C-flow MUST be transmitted on the P-tunnel\n      identified in the
          PTA of that route.\n   If there is no I-PMSI A-D route meeting the above
          conditions, the\n   C-flow MUST NOT be transmitted.\n"
        title: 3.2.1.2.  When an I-PMSI Is a 'Match for Transmission'
      - contents:
        - "3.2.1.3.  When an S-PMSI Is a 'Match for Reception'\n   Suppose a given
          PE, say PE1, needs to receive multicast data packets\n   of a particular
          C-flow.  Section 3.2 of [RFC6625] specifies\n   procedures for determining
          the S-PMSI A-D route, if any, that matches\n   that C-flow for reception.
          \ Those rules apply unchanged for C-flows\n   that are not BIDIR-PIM C-flows.
          \ The remainder of this section\n   applies only to C-BIDIR flows.\n   The
          rules of [RFC6625], Section 3.2.1, are not applicable to C-BIDIR\n   flows.
          \ The rules of [RFC6625], Section 3.2.2, are replaced by the\n   following
          rules.\n   Suppose PE1 needs to receive (C-*,C-G-BIDIR) traffic.  Suppose
          also\n   that PE1 has determined that PE2 is the upstream PE [RFC6513] for
          the\n   C-RPA of C-G-BIDIR.  Then:\n   o  If PE1 is not the same as PE2,
          and PE1 has an installed (C-*,C-G-\n      BIDIR) S-PMSI A-D route originated
          by PE2, then (C-*,C-G-BIDIR)\n      matches this route.\n   o  Otherwise,
          if PE1 is the same as PE2, and PE1 has currently\n      originated a (C-*,C-G-BIDIR)
          S-PMSI A-D route, then\n      (C-*,C-G-BIDIR) matches this route.\n   o
          \ Otherwise, if PE1 is not the same as PE2, and PE1 has an installed\n      (C-*,C-*-BIDIR)
          S-PMSI A-D route originated by PE2, then\n      (C-*,C-G-BIDIR) matches
          this route.\n   o  Otherwise, if PE1 is the same as PE2, and PE1 has currently\n
          \     originated a (C-*,C-*-BIDIR) S-PMSI A-D route, then\n      (C-*,C-G-BIDIR)
          matches this route.\n   o  Otherwise, if PE1 is not the same as PE2, and
          PE1 has an installed\n      (C-*,C-*) S-PMSI A-D route originated by PE2,
          then (C-*,C-G-BIDIR)\n      matches this route.\n   o  Otherwise, if PE1
          is the same as PE2, and PE1 has currently\n      originated a (C-*,C-*)
          S-PMSI A-D route, then (C-*,C-G-BIDIR)\n      matches this route.\n   If
          there is an S-PMSI A-D route matching (C-*,C-G-BIDIR), according\n   to
          these rules, the root node of that P-tunnel is considered to be\n   the
          distinguished PE for that (C-*,C-G-BIDIR) flow.  If a\n   (C-*,C-G-BIDIR)
          packet is received on a P-tunnel whose root node is\n   not the distinguished
          PE for the C-flow, the packet MUST be\n   discarded.\n"
        title: 3.2.1.3.  When an S-PMSI Is a 'Match for Reception'
      - contents:
        - "3.2.1.4.  When an I-PMSI Is a 'Match for Reception'\n   Suppose a given
          PE, say PE1, needs to receive packets of a given\n   C-flow (of a given
          MVPN) from another PE, but according to the\n   conditions of Section 3.2.1.3
          and/or Section 3.2 of [RFC6625], that\n   C-flow does not match any S-PMSI
          A-D route.  Then, the packets of the\n   C-flow need to be received on the
          MVPN's I-PMSI.\n   If the C-flow is not a BIDIR-PIM C-flow, the rules for
          determining\n   the P-tunnel on which packets of the C-flow are expected
          are given in\n   [RFC6513].  The remainder of this section applies only
          to C-BIDIR\n   flows.\n   Suppose that PE1 needs to receive (C-*,C-G-BIDIR)
          traffic from other\n   PEs.  Suppose also that PE1 has determined that PE2
          is the upstream\n   PE [RFC6513] for the C-RPA of C-G-BIDIR.  Then, PE1
          considers PE2 to\n   be the distinguished PE for (C-*,C-G-BIDIR).  If PE1
          has an installed\n   Intra-AS I-PMSI A-D route originated by PE2, PE1 will
          expect to\n   receive packets of the C-flow from the tunnel specified in
          that\n   route's PTA.  (If all VRFs of the MVPN have been properly provisioned\n
          \  to use the Flat Partitioned Method for the I-PMSI, the PTA will\n   specify
          a bidirectional P-tunnel.)  Note that if PE1 is the same as\n   PE2, then
          the relevant Intra-AS I-PMSI A-D route is the one currently\n   originated
          by PE1.\n   If a (C-*,C-G-BIDIR) packet is received on a P-tunnel other
          than the\n   expected one, the packet MUST be discarded.\n"
        title: 3.2.1.4.  When an I-PMSI Is a 'Match for Reception'
      title: 3.2.1.  Flat Partitioning
    - contents:
      - "3.2.2.  Hierarchical Partitioning\n   The procedures of this section and
        its subsections apply when (and\n   only when) the Hierarchical Partitioned
        Method is used.  This method\n   is introduced in [RFC6513], Section 11.2.2.
        \ This document only\n   provides procedures for using this method when using
        MP2MP LSPs as\n   the P-tunnels.\n   The Hierarchical Partitioned Method provides
        the same functionality\n   as the Flat Partitioned Method, but it requires
        a smaller amount of\n   state to be maintained in the core of the network.
        \ However, it\n   requires the use of upstream-assigned MPLS labels (\"PE
        Distinguisher\n   Labels\"), which are not necessarily supported by all hardware\n
        \  platforms.  The upstream-assigned labels are used to provide an LSP\n   hierarchy,
        in which an outer MP2MP LSP carries multiple inner MP2MP\n   LSPs.  Transit
        routers along the path between PE routers then only\n   need to maintain state
        for the outer MP2MP LSP.\n   When this method is used to instantiate a particular
        PMSI, the\n   bidirectional P-tunnel advertised in the PTA of the corresponding\n
        \  I-PMSI or S-PMSI A-D route is the outer P-tunnel.  When a packet is\n   received
        from a P-tunnel, the PE that receives it can infer the\n   identity of the
        outer P-tunnel from the MPLS label that has risen to\n   the top of the packet's
        label stack.  However, the packet's\n   distinguished PE is not necessarily
        the root node of the outer\n   P-tunnel.  Rather, the identity of the packet's
        distinguished PE is\n   inferred from the PE Distinguisher Label further down
        in the label\n   stack.  (See [RFC6513], Section 12.3.)  The PE Distinguisher
        Label\n   may be thought of as identifying an inner MP2MP LSP whose root is
        the\n   PE corresponding to that label.\n   In the context of a given MVPN,
        if it is desired to use the\n   Hierarchical Partitioned Method to instantiate
        an I-PMSI, a (C-*,C-*)\n   S-PMSI, or a (C-*,C-*-BIDIR) S-PMSI, the corresponding
        A-D routes\n   MUST be originated by some of the PEs that attach to that MVPN.
        \ The\n   PEs that are REQUIRED to originate these routes are those that\n
        \  satisfy one of the following conditions:\n   o  There is a C-BIDIR group
        for which the best path from the PE to\n      the C-RPA of that C-group is
        via a VRF interface.\n   o  The PE might have to transmit unidirectional customer
        multicast\n      traffic on the PMSI identified in the route (of course this\n
        \     condition does not apply to (C-*,C-*-BIDIR) or to (C-*,C-G-BIDIR)\n
        \     S-PMSIs).\n   o  The PE is the root node of the MP2MP LSP that is used
        to\n      instantiate the PMSI.\n   When the Hierarchical Partitioned method
        is used to instantiate a\n   (C-*,C-G-BIDIR) S-PMSI, the corresponding (C-*,C-G-BIDIR)
        S-PMSI\n   route MUST NOT be originated by a given PE unless either (a) that\n
        \  PE's best path to the C-RPA for C-G-BIDIR is via a VRF interface, or\n
        \  (b) the C-RPA is a C-address of the PE.  Further, that PE MUST be the\n
        \  root node of the MP2MP LSP identified in the PTA of the S-PMSI A-D\n   route.\n
        \  If any VRF of a given MVPN uses this method to instantiate an S-PMSI\n
        \  with a bidirectional P-tunnel, all VRFs of that MVPN must use this\n   method.\n
        \  Suppose that for a given MVPN, the Hierarchical Partitioned Method is\n
        \  used to instantiate the I-PMSI.  In general, more than one of the PEs\n
        \  in the MVPN will originate an Intra-AS I-PMSI A-D route for that\n   MVPN.
        \ This document allows the PTAs of those routes to all specify\n   the same
        MP2MP LSP as the \"outer tunnel\".  However, it does not\n   require that
        those PTAs all specify the same MP2MP LSP as the outer\n   tunnel.  By having
        all the PEs specify the same outer tunnel for the\n   I-PMSI, one can minimize
        the amount of state in the transit nodes.\n   By allowing them to specify
        different outer tunnels, one uses more\n   state, but may increase the robustness
        of the system.\n   The considerations of the previous paragraph apply as well
        when the\n   Hierarchical Partitioned Method is used to instantiate an S-PMSI.\n"
      - contents:
        - "3.2.2.1.  Advertisement of PE Distinguisher Labels\n   A PE Distinguisher
          Label is an upstream-assigned MPLS label [RFC5331]\n   that can be used,
          in the context of an MP2MP LSP, to denote a\n   particular PE that either
          has joined or may in the future join that\n   LSP.\n   In order to use upstream-assigned
          MPLS labels in the context of an\n   outer MP2MP LSP, there must be a convention
          that identifies a\n   particular router as the router that is responsible
          for allocating\n   the labels and for advertising the labels to the PEs
          that may join\n   the MP2MP LSP.  This document REQUIRES that the PE Distinguisher\n
          \  Labels used in the context of a given MP2MP LSP be allocated and\n   advertised
          by the router that is the root node of the LSP.\n   This convention accords
          with the rules of Section 7 of [RFC5331].\n   Note that according to Section
          7 of [RFC5331], upstream-assigned\n   labels are unique in the context of
          the IP address of the root node;\n   if two MP2MP LSPs have the same root
          node IP address, the upstream-\n   assigned labels used within the two LSPs
          come from the same label\n   space.\n   This document assumes that the root
          node address of an MP2MP LSP is\n   an IP address that is uniquely assigned
          to the node.  The use of an\n   \"anycast address\" as the root node address
          is outside the scope of\n   this document.\n   A PE Distinguisher Labels
          attribute SHOULD NOT be attached to an\n   I-PMSI or S-PMSI A-D route unless
          that route also contains a PTA that\n   specifies an MP2MP LSP.  (While
          PE Distinguisher Labels could in\n   theory also be used if the PTA specifies
          a BIDIR-PIM P-tunnel, such\n   use is outside the scope of this document.)\n
          \  The PE Distinguisher Labels attribute specifies a set of <MPLS label,\n
          \  IP address> bindings.  Within a given PE Distinguisher Labels\n   attribute,
          each such IP address MUST appear at most once, and each\n   MPLS label MUST
          appear only once.  Otherwise, the attribute is\n   considered to be malformed,
          and the \"treat-as-withdraw\" error-\n   handling approach described in
          Section 2 of [BGP-ERROR] MUST be used.\n   When a PE Distinguisher Labels
          attribute is included in a given\n   I-PMSI or S-PMSI A-D route, it MUST
          assign a label to the IP address\n   of each of the following PEs:\n   o
          \ The root node of the MP2MP LSP identified in the PTA of the route.\n   o
          \ Any PE that is possibly the ingress PE for a C-RPA of any C-BIDIR\n      group.\n
          \  o  Any PE that may need to transmit non-C-BIDIR traffic on the MP2MP\n
          \     LSP identified in the PTA of the route.\n   One simple way to meet
          these requirements is to assign a PE\n   Distinguisher label to every PE
          that has originated an Intra-AS\n   I-PMSI A-D route.\n"
        title: 3.2.2.1.  Advertisement of PE Distinguisher Labels
      - contents:
        - "3.2.2.2.  When an S-PMSI Is a 'Match for Transmission'\n   Suppose a given
          PE, say PE1, needs to transmit multicast data packets\n   of a particular
          C-flow.  Section 3.1 of [RFC6625] gives a four-step\n   algorithm for determining
          the S-PMSI A-D route, if any, that matches\n   that C-flow for transmission.\n
          \  If the C-flow is not a BIDIR-PIM C-flow, those rules apply unchanged.\n
          \  If there is a matching S-PMSI A-D route, the P-tunnel on which the\n
          \  C-flow MUST be transmitted is the one identified in the PTA of the\n
          \  matching route.  Each packet of the C-flow MUST carry the PE\n   Distinguisher
          Label assigned by the root node of that P-tunnel to the\n   IP address of
          PE1.  See Section 12.3 of [RFC6513] for encapsulation\n   details.\n   The
          remainder of this section applies only to C-BIDIR flows.  If a\n   C-BIDIR
          flow has group address C-G-BIDIR, the rules applied by PE1\n   are the same
          as the rules given in Section 3.2.1.1.\n   If there is a matching S-PMSI
          A-D route, PE1 MUST transmit the C-flow\n   on the P-tunnel identified in
          its PTA.  Suppose PE1 has determined\n   that PE2 is the upstream PE for
          the C-RPA of the given C-flow.  In\n   constructing the packet's MPLS label
          stack, PE1 must use the PE\n   Distinguisher Label that was assigned by
          the P-tunnel's root node to\n   the IP address of \"PE2\", not the label
          assigned to the IP address of\n   \"PE1\" (unless, of course, PE1 is the
          same as PE2).  See Section 12.3\n   of [RFC6513] for encapsulation details.
          \ Note that the root of the\n   P-tunnel might be a PE other than PE1 or
          PE2.\n"
        title: 3.2.2.2.  When an S-PMSI Is a 'Match for Transmission'
      - contents:
        - "3.2.2.3.  When an I-PMSI Is a 'Match for Transmission'\n   Suppose a given
          PE, say PE1, needs to transmit packets of a given\n   C-flow (of a given
          MVPN) to other PEs, but according to the\n   conditions of Section 3.2.2.2
          and/or Section 3.1 of [RFC6625], that\n   C-flow does not match any S-PMSI
          A-D route.  Then the packets of the\n   C-flow need to be transmitted on
          the MVPN's I-PMSI.\n   If the C-flow is not a BIDIR-PIM C-flow, the P-tunnel
          on which the\n   C-flow MUST be transmitted is the one identified in the
          PTA of the\n   Intra-AS I-PMSI A-D route originated by PE1 for the given
          MVPN.  Each\n   packet of the C-flow MUST carry the PE Distinguisher Label
          assigned\n   by the root node of that P-tunnel to the IP address of PE1.\n
          \  If the C-flow is a BIDIR-PIM C-flow with group address C-G-BIDIR, the\n
          \  rules as applied by PE1 are the same as those given in Section\n   3.2.1.2.\n
          \  If there is a matching I-PMSI A-D route, PE1 MUST transmit the C-flow\n
          \  on the P-tunnel identified in its PTA.  In constructing the packet's\n
          \  MPLS label stack, it must use the PE Distinguisher Label that was\n   assigned
          by the P-tunnel's root node to the IP address of \"PE2\", not\n   the label
          assigned to the IP address of \"PE1\" (unless, of course, PE1\n   is the
          same as PE2).  (Section 3.2.1.2 specifies the difference\n   between PE1
          and PE2.)  See Section 12.3 of [RFC6513] for\n   encapsulation details.
          \ Note that the root of the P-tunnel might be a\n   PE other than PE1 or
          PE2.\n   If, for a packet of a particular C-flow, there is no S-PMSI A-D
          route\n   or I-PMSI A-D route that is a match for transmission, the packet
          MUST\n   NOT be transmitted.\n"
        title: 3.2.2.3.  When an I-PMSI Is a 'Match for Transmission'
      - contents:
        - "3.2.2.4.  When an S-PMSI Is a 'Match for Reception'\n   Suppose a given
          PE, say PE1, needs to receive multicast data packets\n   of a particular
          C-flow.  Section 3.2 of [RFC6625] specifies\n   procedures for determining
          the S-PMSI A-D route, if any, that matches\n   that C-flow for reception.
          \ Those rules require that the matching\n   S-PMSI A-D route has been originated
          by the upstream PE for the\n   C-flow.  The rules are modified in this section,
          as follows:\n   Consider a particular C-flow.  Suppose either:\n   o  the
          C-flow is unidirectional, and PE1 determines that its upstream\n      PE
          is PE2, or\n   o  the C-flow is bidirectional, and PE1 determines that the
          upstream\n      PE for its C-RPA is PE2\n   Then, the C-flow may match an
          installed S-PMSI A-D route that was not\n   originated by PE2, as long as:\n
          \  1. the PTA of that A-D route identifies an MP2MP LSP,\n   2. there is
          an installed S-PMSI A-D route originated by the root node\n      of that
          LSP, or PE1 itself is the root node of the LSP and there\n      is a currently
          originated S-PMSI A-D route from PE1 whose PTA\n      identifies that LSP,
          and\n   3. the latter S-PMSI A-D route (the one identified in 2 just above)\n
          \     contains a PE Distinguisher Labels attribute that assigned an MPLS\n
          \     label to the IP address of PE2.\n   However, a bidirectional C-flow
          never matches an S-PMSI A-D route\n   whose NLRI contains (C-S,C-G).\n   If
          a multicast data packet is received over a matching P-tunnel, but\n   does
          not carry the value of the PE Distinguisher Label that has been\n   assigned
          to the upstream PE for its C-flow, then the packet MUST be\n   discarded.\n"
        title: 3.2.2.4.  When an S-PMSI Is a 'Match for Reception'
      - contents:
        - "3.2.2.5.  When an I-PMSI Is a 'Match for Reception'\n   If a PE needs to
          receive packets of a given C-flow (of a given MVPN)\n   from another PE,
          and if, according to the conditions of Section\n   3.2.2.4, that C-flow
          does not match any S-PMSI A-D route, then the\n   packets of the C-flow
          need to be received on the MVPN's I-PMSI.  The\n   P-tunnel on which the
          packets are expected to arrive is determined by\n   the Intra-AS I-PMSI
          A-D route originated by the distinguished PE for\n   the given C-flow.  The
          PTA of that route specifies the \"outer\n   P-tunnel\" and thus determines
          the top label that packets of that\n   C-flow will be carrying when received.
          \ A PE that needs to receive\n   packets of a given C-flow must determine
          the expected value of the\n   second label for packets of that C-flow.  This
          will be the value of a\n   PE Distinguisher Label, taken from the PE Distinguisher
          Labels\n   attribute of the Intra-AS I-PMSI A-D route of the root node of
          that\n   outer tunnel.  The expected value of the second label on received\n
          \  packets (corresponding to the \"inner tunnel\") of a given C-flow is\n
          \  determined according to the following rules.\n   First, the distinguished
          PE for the C-flow is determined:\n   o  If the C-flow is not a BIDIR-PIM
          C-flow, the distinguished PE for\n      the C-flow is its upstream PE, as
          determined by the rules of\n      [RFC6513].\n   o  If the C-flow is a BIDIR-PIM
          C-flow, the distinguished PE for the\n      C-flow is its upstream PE of
          the C-flow's C-RPA, as determined by\n      the rules of [RFC6513].\n   The
          expected value of the second label is the value that the root PE\n   of
          the outer tunnel has assigned, in the PE Distinguisher Labels\n   attribute
          of its Intra-AS I-PMSI A-D route, to the IP address of the\n   distinguished
          PE.\n   Packets addressed to C-G that arrive on other than the expected
          inner\n   and outer P-tunnels (i.e., that arrive with unexpected values
          of the\n   top two labels) MUST be discarded.\n"
        title: 3.2.2.5.  When an I-PMSI Is a 'Match for Reception'
      title: 3.2.2.  Hierarchical Partitioning
    - contents:
      - "3.2.3.  Unpartitioned\n   When a particular MVPN uses the Unpartitioned Method
        of instantiating\n   an I-PMSI with a bidirectional P-tunnel, it MUST be the
        case that at\n   least one VRF of that MVPN originates an Intra-AS I-PMSI
        A-D route\n   that includes a PTA specifying a bidirectional P-tunnel.  The\n
        \  conditions under which an Intra-AS I-PMSI A-D route must be\n   originated
        from a given VRF are as specified in [RFC6514].  This\n   document allows
        all but one of such routes to omit the PTA.  However,\n   each such route
        MAY contain a PTA.  If the PTA is present, it MUST\n   specify a bidirectional
        P-tunnel.  As specified in [RFC6513] and\n   [RFC6514], every PE that imports
        such an Intra-AS I-PMSI A-D route\n   into one of its VRFs MUST, if the route
        has a PTA, join the P-tunnel\n   specified in the route's PTA.\n   Packets
        received on any of these P-tunnels are treated as having been\n   received
        over the I-PMSI.  The disposition of a received packet MUST\n   NOT depend
        upon the particular P-tunnel over which it has been\n   received.\n   When
        a PE needs to transmit a packet on such an I-PMSI, then if that\n   PE advertised
        a P-tunnel in the PTA of an Intra-AS I-PMSI A-D route\n   that it originated,
        the PE SHOULD transmit the on that P-tunnel.\n   However, any PE that transmits
        a packet on the I-PMSI MAY transmit it\n   on any of the P-tunnels advertised
        in any of the currently installed\n   Intra-AS I-PMSI A-D routes for its VPN.\n
        \  This allows a single bidirectional P-tunnel to be used to instantiate\n
        \  the I-PMSI, but also allows the use of multiple bidirectional\n   P-tunnels.
        \ There may be a robustness advantage in having multiple\n   P-tunnels available
        for use, but the number of P-tunnels used does\n   not impact the functionality
        in any way.  If there are, e.g., two\n   P-tunnels available, these procedures
        allow each P-tunnel to be\n   advertised by a single PE, but they also allow
        each P-tunnel to be\n   advertised by multiple PEs.  Note that the PE advertising
        a given\n   P-tunnel does not have to be the root node of the tunnel.  The
        root\n   node might not even be a PE router, and it might not originate any\n
        \  BGP routes at all.\n   In the Unpartitioned Method, packets received on
        the I-PMSI cannot be\n   associated with a distinguished PE, so duplicate
        detection using the\n   techniques of Section 9.1.1 of [RFC6513] is not possible;
        the\n   techniques of Sections 9.1.2 or 9.1.3 of [RFC6513] would have to be\n
        \  used instead.  Support for C-BIDIR using the \"Partitioned set of PEs\"\n
        \  technique (Section 11.2 of [RFC6513] and Section 3.6 of [RFC6517]) is\n
        \  not possible when the Unpartitioned Method is used.  If it is desired\n
        \  to use that technique to support C-BIDIR, but also to use the\n   Unpartitioned
        Method to instantiate the I-PMSI, then all the C-BIDIR\n   traffic would have
        to be carried on an S-PMSI, where the S-PMSI is\n   instantiated using one
        of the Partitioned Methods.\n   When a PE, say PE1, needs to transmit multicast
        data packets of a\n   particular C-flow to other PEs, and PE1 does not have
        an S-PMSI that\n   is a match for transmission for that C-flow (see Section
        3.2.3.1),\n   PE1 transmits the packets on one of the P-tunnel(s) that instantiates\n
        \  the I-PMSI.  When a PE, say PE1, needs to receive multicast data\n   packets
        of a particular C-flow from another PE, and PE1 does not have\n   an S-PMSI
        that is a match for reception for that C-flow (see Section\n   3.2.3.2), PE1
        expects to receive the packets on any of the P-tunnels\n   that instantiate
        the I-PMSI.\n   When a particular MVPN uses the Unpartitioned Method to instantiate
        a\n   (C-*,C-*) S-PMSI or a (C-*,C-*-BIDIR) S-PMSI using a bidirectional\n
        \  P-tunnel, the same conditions apply as when an I-PMSI is instantiated\n
        \  via the Unpartitioned Method.  The only difference is that a PE need\n
        \  not join a P-tunnel that instantiates the S-PMSI unless that PE needs\n
        \  to receive multicast packets on the S-PMSI.\n   When a particular MVPN
        uses bidirectional P-tunnels to instantiate\n   other S-PMSIs, different S-PMSI
        A-D routes that do not contain\n   (C-*,C-*) or (C-*,C-*-BIDIR), originated
        by the same or by different\n   PEs, MAY have PTAs that identify the same
        bidirectional tunnel, and\n   they MAY have PTAs that do not identify the
        same bidirectional\n   tunnel.\n   While the Unpartitioned Method MAY be used
        to instantiate an S-PMSI\n   to which one or more C-BIDIR flows are bound,
        it must be noted that\n   the \"Partitioned Set of PEs\" method discussed
        in Section 11.2 of\n   [RFC6513] and Section 3.6 of [RFC6517] cannot be supported
        using the\n   Unpartitioned Method.  C-BIDIR support would have to be provided
        by\n   the procedures of [RFC6513], Section 11.1.\n"
      - contents:
        - "3.2.3.1.  When an S-PMSI Is a 'Match for Transmission'\n   Suppose a PE
          needs to transmit multicast data packets of a particular\n   customer C-flow.
          \ [RFC6625], Section 3.1, gives a four-step algorithm\n   for determining
          the S-PMSI A-D route, if any, that matches that\n   C-flow for transmission.
          \ When referring to that section, please\n   recall that BIDIR-PIM groups
          are also ASM groups.\n   When bidirectional P-tunnels are used in the Unpartitioned
          Method,\n   the same algorithm applies, with one modification, when the
          PTA of an\n   S-PMSI A-D route identifies a bidirectional P-tunnel.  One
          additional\n   step is added to the algorithm.  This new step occurs before
          the\n   fourth step of the algorithm, and is as follows:\n   o  Otherwise,
          if there is a (C-*,C-*-BIDIR) S-PMSI A-D route\n      currently originated
          by PE1, and if C-G is a BIDIR group, the\n      C-flow matches that route.\n
          \  When the Unpartitioned Method is used, the PE SHOULD transmit the\n   C-flow
          on the P-tunnel advertised in the in the matching S-PMSI A-D\n   route,
          but it MAY transmit the C-flow on any P-tunnel that is\n   advertised in
          the PTA of any installed S-PMSI A-D route that contains\n   the same (C-S,C-G)
          as the matching S-PMSI A-D route.\n"
        title: 3.2.3.1.  When an S-PMSI Is a 'Match for Transmission'
      - contents:
        - "3.2.3.2.  When an S-PMSI Is a 'Match for Reception'\n   Suppose a PE needs
          to receive multicast data packets of a particular\n   customer C-flow.  Section
          3.2 of [RFC6625] specifies the procedures\n   for determining the S-PMSI
          A-D route, if any, that advertised the\n   P-tunnel on which the PE should
          expect to receive that C-flow.\n   When bidirectional P-tunnels are used
          in the Unpartitioned Method,\n   the same procedures apply, with one modification.\n
          \  The last paragraph of Section 3.2.2 of [RFC6625] begins:\n      If (C-*,C-G)
          does not match a (C-*,C-G) S-PMSI A-D route from PE2,\n      but PE1 has
          an installed (C-*,C-*) S-PMSI A-D route from PE2, then\n      (C-*,C-G)
          matches the (C-*,C-*) route if one of the following\n      conditions holds:\n
          \  This is changed to:\n      If (C-*,C-G) does not match a (C-*,C-G) S-PMSI
          A-D route from PE2,\n      but C-G is a BIDIR group and PE1 has an installed
          (C-*,C-*-BIDIR)\n      S-PMSI A-D route, then (C-*,C-G) matches that route.
          \ Otherwise,\n      if PE1 has an installed (C-*,C-*) S-PMSI A-D route from
          PE2, then\n      (C-*,C-G) matches the (C-*,C-*) route if one of the following\n
          \     conditions holds:\n   When the Unpartitioned Method is used, the PE
          MUST join the P-tunnel\n   that is advertised in the matching S-PMSI A-D
          route, and it MUST also\n   join the P-tunnels that are advertised in other
          installed S-PMSI A-D\n   routes that contain the same (C-S,C-G) as the matching
          S-PMSI A-D\n   route.\n"
        title: 3.2.3.2.  When an S-PMSI Is a 'Match for Reception'
      title: 3.2.3.  Unpartitioned
    - contents:
      - "3.2.4.  Minimal Feature Set for Compliance\n   Implementation of bidirectional
        P-tunnels is OPTIONAL.  If\n   bidirectional P-tunnels are not implemented,
        the issue of compliance\n   to this specification does not arise.  However,
        for the case where\n   bidirectional P-tunnels ARE implemented, this section
        specifies the\n   minimal set of features that MUST be implemented in order
        to claim\n   compliance to this specification.\n   In order to be compliant
        with this specification, an implementation\n   that provides bidirectional
        P-tunnels MUST support at least one of\n   the two P-tunnel technologies mentioned
        in Section 1.2.1.\n   A PE that does not provide C-BIDIR support using the
        \"partitioned set\n   of PEs\" method is deemed compliant to this specification
        if it\n   supports the Unpartitioned Method, using either MP2MP LSPs or BIDIR-\n
        \  PIM multicast distribution trees as P-tunnels.\n   A PE that does provide
        C-BIDIR support using the \"partitioned set of\n   PEs\" method MUST, at a
        minimum, be able to provide C-BIDIR support\n   using the \"Partial Mesh of
        MP2MP P-tunnels\" variant of this method\n   (see Section 11.2 of [RFC6513]).
        \ An implementation will be deemed\n   compliant to this minimum requirement
        if it can carry all of a VPN's\n   C-BIDIR traffic on a (C-*,C-*-BIDIR) S-PMSI
        that is instantiated by a\n   bidirectional P-tunnel, using the Flat Partitioned
        Method.\n"
      title: 3.2.4.  Minimal Feature Set for Compliance
    title: 3.2.  Procedures Specific to the PMSI Instantiation Method
  title: 3.  Using Bidirectional P-Tunnels
- contents:
  - "4.  Security Considerations\n   There are no additional security considerations
    beyond those of\n   [RFC6513] and [RFC6514], or any that may apply to the particular\n
    \  protocol used to set up the bidirectional tunnels ([RFC5015],\n   [RFC6388]).\n"
  title: 4.  Security Considerations
- contents:
  - '5.  References

    '
  - contents:
    - "5.1.  Normative References\n   [RFC2119]   Bradner, S., \"Key words for use
      in RFCs to Indicate\n               Requirement Levels\", BCP 14, RFC 2119,\n
      \              DOI 10.17487/RFC2119, March 1997,\n               <http://www.rfc-editor.org/info/rfc2119>.\n
      \  [RFC4364]   Rosen, E. and Y. Rekhter, \"BGP/MPLS IP Virtual Private\n               Networks
      (VPNs)\", RFC 4364, DOI 10.17487/RFC4364,\n               February 2006, <http://www.rfc-editor.org/info/rfc4364>.\n
      \  [RFC4601]   Fenner, B., Handley, M., Holbrook, H., and I. Kouvelas,\n               \"Protocol
      Independent Multicast - Sparse Mode (PIM-SM):\n               Protocol Specification
      (Revised)\", RFC 4601,\n               DOI 10.17487/RFC4601, August 2006,\n
      \              <http://www.rfc-editor.org/info/rfc4601>.\n   [RFC5015]   Handley,
      M., Kouvelas, I., Speakman, T., and L. Vicisano,\n               \"Bidirectional
      Protocol Independent Multicast (BIDIR-\n               PIM)\", RFC 5015, DOI
      10.17487/RFC5015, October 2007,\n               <http://www.rfc-editor.org/info/rfc5015>.\n
      \  [RFC6388]   Wijnands, IJ., Ed., Minei, I., Ed., Kompella, K., and B.\n               Thomas,
      \"Label Distribution Protocol Extensions for\n               Point-to-Multipoint
      and Multipoint-to-Multipoint Label\n               Switched Paths\", RFC 6388,
      DOI 10.17487/RFC6388, November\n               2011, <http://www.rfc-editor.org/info/rfc6388>.\n
      \  [RFC6513]   Rosen, E., Ed., and R. Aggarwal, Ed., \"Multicast in\n               MPLS/BGP
      IP VPNs\", RFC 6513, DOI 10.17487/RFC6513,\n               February 2012, <http://www.rfc-editor.org/info/rfc6513>.\n
      \  [RFC6514]   Aggarwal, R., Rosen, E., Morin, T., and Y. Rekhter, \"BGP\n               Encodings
      and Procedures for Multicast in MPLS/BGP IP\n               VPNs\", RFC 6514,
      DOI 10.17487/RFC6514, February 2012,\n               <http://www.rfc-editor.org/info/rfc6514>.\n
      \  [RFC6625]   Rosen, E., Ed., Rekhter, Y., Ed., Hendrickx, W., and R.\n               Qiu,
      \"Wildcards in Multicast VPN Auto-Discovery Routes\",\n               RFC 6625,
      DOI 10.17487/RFC6625, May 2012,\n               <http://www.rfc-editor.org/info/rfc6625>.\n"
    title: 5.1.  Normative References
  - contents:
    - "5.2.  Informative References\n   [BGP-ERROR] Chen, E., Ed., Scudder, J., Ed.,
      Mohapatra, P., and K.\n               Patel, \"Revised Error Handling for BGP
      UPDATE Messages\",\n               Work in Progress, draft-ietf-idr-error-handling-19,
      April\n               2015.\n   [MVPN-BIDIR-IR]\n               Zhang, Z., Rekhter,
      Y., and A. Dolganow, \"Simulating\n               'Partial Mesh of MP2MP P-Tunnels'
      with Ingress\n               Replication\", Work in Progress,\n               draft-ietf-bess-mvpn-bidir-ingress-replication-00,\n
      \              January 2015.\n   [MVPN-XNET] Rekhter, Y., Ed., Rosen, E., Ed.,
      Aggarwal, R., Cai, Y.,\n               and T. Morin, \"Extranet Multicast in
      BGP/IP MPLS VPNs\",\n               Work in Progress, draft-ietf-bess-mvpn-extranet-02,
      May\n               2015.\n   [RFC5331]   Aggarwal, R., Rekhter, Y., and E.
      Rosen, \"MPLS Upstream\n               Label Assignment and Context-Specific
      Label Space\", RFC\n               5331, DOI 10.17487/RFC5331, August 2008,\n
      \              <http://www.rfc-editor.org/info/rfc5331>.\n   [RFC6517]   Morin,
      T., Ed., Niven-Jenkins, B., Ed., Kamite, Y.,\n               Zhang, R., Leymann,
      N., and N. Bitar, \"Mandatory Features\n               in a Layer 3 Multicast
      BGP/MPLS VPN Solution\", RFC 6517,\n               DOI 10.17487/RFC6517, February
      2012,\n               <http://www.rfc-editor.org/info/rfc6517>.\n"
    title: 5.2.  Informative References
  title: 5.  References
- contents:
  - "Acknowledgments\n   The authors wish to thank Karthik Subramanian, Rajesh Sharma,
    and\n   Apoorva Karan for their input.  We also thank Yakov Rekhter for his\n
    \  valuable critique.\n   Special thanks go to Jeffrey (Zhaohui) Zhang for his
    careful review,\n   probing questions, and useful suggestions.\n"
  title: Acknowledgments
- contents:
  - "Authors' Addresses\n   Eric C. Rosen\n   Juniper Networks, Inc.\n   10 Technology
    Park Drive\n   Westford, MA  01886\n   United States\n   Email: erosen@juniper.net\n
    \  IJsbrand Wijnands\n   Cisco Systems, Inc.\n   De kleetlaan 6a\n   Diegem  1831\n
    \  Belgium\n   Email: ice@cisco.com\n   Yiqun Cai\n   Microsoft\n   1065 La Avenida\n
    \  Mountain View, CA  94043\n   United States\n   Email: yiqunc@microsoft.com\n
    \  Arjen Boers\n   Email: arjen@boers.com\n"
  title: Authors' Addresses
