- contents:
  - "          LDP Extensions for Optimized MAC Address Withdrawal\n         in a
    Hierarchical Virtual Private LAN Service (H-VPLS)\n"
  title: __initial_text__
- contents:
  - "Abstract\n   RFC 4762 describes a mechanism to remove or unlearn Media Access\n
    \  Control (MAC) addresses that have been dynamically learned in a\n   Virtual
    Private LAN Service (VPLS) instance for faster convergence on\n   topology changes.
    \ The procedure also removes MAC addresses in the\n   VPLS that do not require
    relearning due to such topology changes.\n   This document defines an enhancement
    to the MAC address withdraw\n   procedure with an empty MAC list (RFC 4762); this
    enhancement enables\n   a Provider Edge (PE) device to remove only the MAC addresses
    that\n   need to be relearned.  Additional extensions to RFC 4762 MAC withdraw\n
    \  procedures are specified to provide an optimized MAC flushing for the\n   Provider
    Backbone Bridging (PBB) VPLS specified in RFC 7041.\n"
  title: Abstract
- contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This
    document is a product of the Internet Engineering Task Force\n   (IETF).  It represents
    the consensus of the IETF community.  It has\n   received public review and has
    been approved for publication by the\n   Internet Engineering Steering Group (IESG).
    \ Further information on\n   Internet Standards is available in Section 2 of RFC
    5741.\n   Information about the current status of this document, any errata,\n
    \  and how to provide feedback on it may be obtained at\n   http://www.rfc-editor.org/info/rfc7361.\n"
  title: Status of This Memo
- contents:
  - "Copyright Notice\n   Copyright (c) 2014 IETF Trust and the persons identified
    as the\n   document authors.  All rights reserved.\n   This document is subject
    to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n
    \  (http://trustee.ietf.org/license-info) in effect on the date of\n   publication
    of this document.  Please review these documents\n   carefully, as they describe
    your rights and restrictions with respect\n   to this document.  Code Components
    extracted from this document must\n   include Simplified BSD License text as described
    in Section 4.e of\n   the Trust Legal Provisions and are provided without warranty
    as\n   described in the Simplified BSD License.\n"
  title: Copyright Notice
- contents:
  - "Table of Contents\n   1. Introduction ....................................................4\n
    \  2. Terminology .....................................................6\n      2.1.
    Requirements Language ......................................6\n   3. Overview
    ........................................................6\n      3.1. MAC Flushing
    on Activation of Backup Spoke PW ..............8\n           3.1.1. MAC Flushing
    Initiated by PE-rs .....................8\n           3.1.2. MAC Flushing Initiated
    by MTU-s .....................8\n      3.2. MAC Flushing on Failure ....................................9\n
    \     3.3. MAC Flushing in PBB-VPLS ..................................10\n   4.
    Problem Description ............................................10\n      4.1.
    MAC Flushing Optimization in VPLS Resiliency ..............10\n           4.1.1.
    MAC Flushing Optimization for Regular H-VPLS .......11\n           4.1.2. MAC
    Flushing Optimization for Native Ethernet\n                  Access .............................................13\n
    \     4.2. Black-Holing Issue in PBB-VPLS ............................13\n   5.
    Solution Description ...........................................14\n      5.1.
    MAC Flushing Optimization for VPLS Resiliency .............14\n           5.1.1.
    MAC Flush Parameters TLV ...........................15\n           5.1.2. Application
    of the MAC Flush TLV in\n                  Optimized MAC Flushing .............................16\n
    \          5.1.3. MAC Flush TLV Processing Rules for Regular VPLS ....17\n           5.1.4.
    Optimized MAC Flush Procedures .....................18\n      5.2. LDP MAC Flush
    Extensions for PBB-VPLS .....................19\n           5.2.1. MAC Flush TLV
    Processing Rules for PBB-VPLS ........20\n           5.2.2. Applicability of the
    MAC Flush Parameters TLV ......22\n   6. Operational Considerations .....................................23\n
    \  7. IANA Considerations ............................................24\n      7.1.
    New LDP TLV ...............................................24\n      7.2. New
    Registry for MAC Flush Flags ..........................24\n   8. Security Considerations
    ........................................24\n   9. Contributing Author ............................................25\n
    \  10. Acknowledgements ..............................................25\n   11.
    References ....................................................25\n      11.1.
    Normative References .....................................25\n      11.2. Informative
    References ...................................25\n"
  title: Table of Contents
- contents:
  - "1.  Introduction\n   A method of Virtual Private LAN Service (VPLS), also known
    as\n   Transparent LAN Services (TLS), is described in [RFC4762].  A VPLS is\n
    \  created using a collection of one or more point-to-point pseudowires\n   (PWs)
    [RFC4664] configured in a flat, full-mesh topology.  The mesh\n   topology provides
    a LAN segment or broadcast domain that is fully\n   capable of learning and forwarding
    on Ethernet Media Access Control\n   (MAC) addresses at the Provider Edge (PE)
    devices.\n   This VPLS full-mesh core configuration can be augmented with\n   additional
    non-meshed spoke nodes to provide a Hierarchical VPLS\n   (H-VPLS) service [RFC4762].
    \ Throughout this document, this\n   configuration is referred to as \"regular\"
    H-VPLS.\n   [RFC7041] describes how Provider Backbone Bridging (PBB) can be\n
    \  integrated with VPLS to allow for useful PBB capabilities while\n   continuing
    to avoid the use of the Multiple Spanning Tree Protocol\n   (MSTP) in the backbone.
    \ The combined solution, referred to as\n   \"PBB-VPLS\", results in better scalability
    in terms of number of\n   service instances, PWs, and C-MAC (Customer MAC) addresses
    that need\n   to be handled in the VPLS PEs, depending on the location of the\n
    \  I-component in the PBB-VPLS topology.\n   A MAC address withdrawal mechanism
    for VPLS is described in [RFC4762]\n   to remove or unlearn MAC addresses for
    faster convergence on topology\n   changes in resilient H-VPLS topologies.  Note
    that the H-VPLS\n   topology discussed in [RFC4762] describes the two-tier hierarchy
    in\n   VPLS as the basic building block of H-VPLS, but it is possible to\n   have
    a multi-tier hierarchy in an H-VPLS.\n   Figure 1 is reproduced from [RFC4762]
    and illustrates dual-homing\n   in H-VPLS.\n                                                            PE2-rs\n
    \                                                         +--------+\n                                                          |
    \       |\n                                                          |   --   |\n
    \                                                         |  /  \\  |\n      CE-1
    \                                               |  \\S /  |\n        \\                                                 |
    \  --   |\n         \\                                                +--------+\n
    \         \\  MTU-s                          PE1-rs        /   |\n          +--------+
    \                     +--------+     /    |\n          |        |                      |
    \       |    /     |\n          |   --   |   Primary PW         |   --   |---/
    \     |\n          |  /  \\  |- - - - - - - - - - - |  /  \\  |          |\n          |
    \ \\S /  |                      |  \\S /  |          |\n          |   --   |                      |
    \  --   |---\\      |\n          +--------+                      +--------+    \\
    \    |\n            /      \\                                     \\    |\n           /
    \       \\                                     +--------+\n          /          \\
    \                                   |        |\n         CE-2         \\                                   |
    \ --    |\n                       \\     Secondary PW                 | /  \\
    \  |\n                        - - - - - - - - - - - - - - - - - | \\S /   |\n
    \                                                         |  --    |\n                                                          +--------+\n
    \                                                           PE3-rs\n                Figure
    1: An Example of a Dual-Homed MTU-s\n   An example usage of the MAC flushing mechanism
    is the dual-homed\n   H-VPLS where an edge device called the Multi-Tenant Unit
    switch\n   (MTU-s) [RFC4762] is connected to two PE devices via a primary spoke\n
    \  PW and backup spoke PW, respectively.  Such redundancy is designed to\n   protect
    against the failure of the primary spoke PW or primary PE\n   device.  There could
    be multiple methods of dual-homing in H-VPLS\n   that are not described in [RFC4762].
    \ For example, note the following\n   statement from Section 10.2.1 of [RFC4762].\n
    \     How a spoke is designated primary or secondary is outside the\n      scope
    of this document.  For example, a spanning tree instance\n      running between
    only the MTU-s and the two PE-rs nodes is one\n      possible method.  Another
    method could be configuration.\n   This document intends to clarify several H-VPLS
    dual-homing models\n   that are deployed in practice and various use cases of
    LDP-based MAC\n   flushing in these models.\n"
  title: 1.  Introduction
- contents:
  - "2.  Terminology\n   This document uses the terminology defined in [RFC7041],
    [RFC5036],\n   [RFC4447], and [RFC4762].\n   Throughout this document, \"Virtual
    Private LAN Service\" (VPLS) refers\n   to the emulated bridged LAN service offered
    to a customer.  \"H-VPLS\"\n   refers to the hierarchical connectivity or layout
    of the MTU-s and\n   the Provider Edge routing- and switching-capable (PE-rs)
    devices\n   offering the VPLS [RFC4762].\n   The terms \"spoke node\" and \"MTU-s\"
    in H-VPLS are used\n   interchangeably.\n   \"Spoke PW\" refers to the Pseudowire
    (PW) that provides connectivity\n   between MTU-s and PE-rs nodes.\n   \"Mesh
    PW\" refers to the PW that provides connectivity between PE-rs\n   nodes in a
    VPLS full-mesh core.\n   \"MAC flush message\" refers to a Label Distribution
    Protocol (LDP)\n   address withdraw message without a MAC List TLV.\n   A MAC
    flush message \"in the context of a PW\" refers to the message\n   that has been
    received over the LDP session that is used to set up\n   the PW used to provide
    connectivity in VPLS.  The MAC flush message\n   carries the context of the PW
    in terms of the Forwarding Equivalence\n   Class (FEC) TLV associated with the
    PW [RFC4762] [RFC4447].\n   In general, \"MAC flushing\" refers to the method
    of initiating and\n   processing MAC flush messages across a VPLS instance.\n"
  - contents:
    - "2.1.  Requirements Language\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\",
      \"SHALL\", \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"MAY\",
      and \"OPTIONAL\" in this\n   document are to be interpreted as described in
      [RFC2119].\n"
    title: 2.1.  Requirements Language
  title: 2.  Terminology
- contents:
  - "3.  Overview\n   When the MTU-s switches over to the backup PW, the requirement
    is to\n   flush the MAC addresses learned in the corresponding Virtual Switch\n
    \  Instance (VSI) in peer PE devices participating in the full mesh, to\n   avoid
    the black-holing of frames to those addresses.  This is\n   accomplished by sending
    an LDP address withdraw message -- a new\n   message defined in this document
    -- from the PE that is no longer\n   connected to the MTU-s with the primary PW.
    \ The new message contains\n   a list of MAC addresses to be removed and is sent
    to all other PEs\n   over the corresponding LDP sessions.\n   In order to minimize
    the impact on LDP convergence time and\n   scalability when a MAC List TLV contains
    a large number of MAC\n   addresses, many implementations use an LDP address withdraw
    message\n   with an empty MAC list.  When a PE-rs switch in the full mesh of\n
    \  H-VPLS receives this message, it also flushes MAC addresses that are\n   not
    affected due to the topology change, thus leading to unnecessary\n   flooding
    and relearning.  Throughout this document, the term \"MAC\n   flush message\"
    is used to specify an LDP address withdraw message\n   with an empty MAC list
    as described in [RFC4762].  The solutions\n   described in this document are applicable
    only to LDP address\n   withdraw messages with empty MAC lists.\n   In a VPLS
    topology, the core PWs remain active and learning happens\n   on the PE-rs nodes.
    \ However, when the VPLS topology changes, the\n   PE-rs must relearn using MAC
    address withdrawal or flushing.  As per\n   the MAC address withdrawal processing
    rules in [RFC4762], a PE\n   device, on receiving a MAC flush message, removes
    all MAC addresses\n   associated with the specified VPLS instance (as indicated
    in the FEC\n   TLV) except the MAC addresses learned over the PW associated with\n
    \  this signaling session over which the message was received.\n   Throughout
    this document, we use the terminology \"positive\" MAC\n   flushing or \"flush-all-but-mine\"
    for this type of MAC flush message\n   and its actions.\n   This document introduces
    an optimized \"negative\" MAC flush message,\n   described in Section 3.2, that
    can be configured to improve the\n   response to topology changes in a number
    of Ethernet topologies where\n   the Service Level Agreement (SLA) is dependent
    on minimal disruption\n   and fast restoration of affected traffic.  This new
    message is used\n   in the case of Provider Backbone Bridging (PBB) topologies
    to\n   restrict the flushing to a set of service instances (I-SIDs).  It is\n
    \  also important to note that the MAC flush message described in\n   [RFC4762],
    which is called \"a positive MAC flush message\" in this\n   document, MUST always
    be handled for Backbone MACs (B-MACs) in cases\n   where the core nodes change
    or fail.  In dual-homed or multi-homed\n   edge topologies, the procedures in
    this document augment [RFC4762]\n   messages and provide less disruption for those
    cases.\n"
  - contents:
    - "3.1.  MAC Flushing on Activation of Backup Spoke PW\n   This section describes
      scenarios where MAC flush withdrawal is\n   initiated on activation of a backup
      PW in H-VPLS.\n"
    - contents:
      - "3.1.1.  MAC Flushing Initiated by PE-rs\n   [RFC4762] specifies that on failure
        of the primary PW it is PE3-rs\n   (Figure 1) that initiates MAC flushing
        towards the core.  However,\n   note that PE3-rs can initiate MAC flushing
        only when PE3-rs is\n   dual-homing \"aware\" -- that is, there is some redundancy
        management\n   protocol running between the MTU-s and its host PE-rs devices.
        \ The\n   scope of this document is applicable to several dual-homing or\n
        \  multi-homing protocols.  This document illustrates that multi-homing\n
        \  can be improved with negative MAC flushing.  One example is BGP-based\n
        \  multi-homing in LDP-based VPLS, which uses the procedures defined in\n
        \  [VPLS-MH].  In this method of dual-homing, PE3-rs would neither\n   forward
        any traffic to the MTU-s nor receive any traffic from the\n   MTU-s while
        PE1-rs is acting as a primary (or designated forwarder).\n"
      title: 3.1.1.  MAC Flushing Initiated by PE-rs
    - contents:
      - "3.1.2.  MAC Flushing Initiated by MTU-s\n   When dual-homing is achieved
        by manual configuration in the MTU-s,\n   the hosting PE-rs devices are dual-homing
        \"agnostic\", and PE3-rs\n   cannot initiate MAC flush messages.  PE3-rs can
        send or receive\n   traffic over the backup PW, since the dual-homing control
        is with the\n   MTU-s only.  When the backup PW is made active by the MTU-s,
        the\n   MTU-s triggers a MAC flush message.  The message is sent over the
        LDP\n   session associated with the newly activated PW.  On receiving the
        MAC\n   flush message from the MTU-s, PE3-rs (the PE-rs device with a\n   now-active
        PW) would flush all the MAC addresses it has learned,\n   except the ones
        learned over the newly activated spoke PW.  PE3-rs\n   further initiates a
        MAC flush message to all other PE devices in the\n   core.  Note that a forced
        switchover to the backup PW can also be\n   invoked by the MTU-s due to maintenance
        or administrative activities\n   on the former primary spoke PW.\n   The method
        of MAC flushing initiated by the MTU-s is modeled after\n   Topology Change
        Notification (TCN) in the Rapid Spanning Tree\n   Protocol (RSTP) [IEEE.802.1Q-2011].
        \ When a bridge switches from a\n   failed link to the backup link, the bridge
        sends out a TCN message\n   over the newly activated link.  Upon receiving
        this message, the\n   upstream bridge flushes its entire list of MAC addresses,
        except the\n   ones received over this link.  The upstream bridge then sends
        the TCN\n   message out of its other ports in that spanning tree instance.
        \ The\n   message is further relayed along the spanning tree by the other\n
        \  bridges.\n   The MAC flushing information is propagated in the control
        plane.  The\n   control-plane message propagation is associated with the data
        path\n   and hence follows propagation rules similar to those used for\n   forwarding
        in the LDP data plane.  For example, PE-rs nodes follow\n   the data-plane
        \"split-horizon\" forwarding rules in H-VPLS (refer to\n   Section 4.4 of
        [RFC4762]).  Therefore, a MAC flush message is\n   propagated in the context
        of mesh PW(s) when it is received in the\n   context of a spoke PW.  When
        a PE-rs node receives a MAC flush\n   message in the context of a mesh PW,
        then it is not propagated to\n   other mesh PWs.\n"
      title: 3.1.2.  MAC Flushing Initiated by MTU-s
    title: 3.1.  MAC Flushing on Activation of Backup Spoke PW
  - contents:
    - "3.2.  MAC Flushing on Failure\n   MAC flushing on failure, or \"negative\"
      MAC flushing, is introduced in\n   this document.  Negative MAC flushing is
      an improvement on the\n   current practice of sending a MAC flush message with
      an empty MAC\n   list as described in Section 3.1.1.  We use the term \"negative\"
      MAC\n   flushing or \"flush-all-from-me\" for this kind of flushing action as\n
      \  opposed to the \"positive\" MAC flush action in [RFC4762].  In negative\n
      \  MAC flushing, the MAC flushing is initiated by PE1-rs (Figure 1) on\n   detection
      of failure of the primary spoke PW.  The MAC flush message\n   is sent to all
      participating PE-rs devices in the VPLS full mesh.\n   PE1-rs should initiate
      MAC flushing only if PE1-rs is dual-homing\n   aware.  (If PE1-rs is dual-homing
      agnostic, the policy is to not\n   initiate MAC flushing on failure, since that
      could cause unnecessary\n   flushing in the case of a single-homed MTU-s.)  The
      specific dual-\n   homing protocols for this scenario are outside the scope
      of this\n   document, but the operator can choose to use the optimized MAC\n
      \  flushing described in this document or the [RFC4762] procedures.\n   The
      procedure for negative MAC flushing is beneficial and results in\n   less disruption
      than the [RFC4762] procedures, including when the\n   MTU-s is dual-homed with
      a variety of Ethernet technologies, not just\n   LDP.  The negative MAC flush
      message is a more targeted MAC flush,\n   and the other PE-rs nodes will flush
      only the specified MACs.  This\n   targeted MAC flush cannot be achieved with
      the MAC address withdraw\n   message defined in [RFC4762].  Negative MAC flushing
      typically\n   results in a smaller set of MACs to be flushed and results in
      less\n   disruption for these topologies.\n   Note that in the case of negative
      MAC flushing the list SHOULD be\n   only the MACs for the affected MTU-s.  If
      the list is empty, then the\n   negative MAC flush procedures will result in
      flushing and relearning\n   all attached MTU-s devices for the originating PE-rs.\n"
    title: 3.2.  MAC Flushing on Failure
  - contents:
    - "3.3.  MAC Flushing in PBB-VPLS\n   [RFC7041] describes how PBB can be integrated
      with VPLS to allow for\n   useful PBB capabilities while continuing to avoid
      the use of MSTP in\n   the backbone.  The combined solution, referred to as
      \"PBB-VPLS\",\n   results in better scalability in terms of the number of service\n
      \  instances, PWs, and C-MACs that need to be handled in the VPLS PE-rs\n   devices.
      \ This document describes extensions to LDP MAC flushing\n   procedures described
      in [RFC4762] that are required to build\n   desirable capabilities for the PBB-VPLS
      solution.\n   The solution proposed in this document is generic and is applicable\n
      \  when Multi-Segment Pseudowires (MS-PWs) [RFC6073] are used in\n   interconnecting
      PE devices in H-VPLS.  There could be other H-VPLS\n   models not defined in
      this document where the solution may be\n   applicable.\n"
    title: 3.3.  MAC Flushing in PBB-VPLS
  title: 3.  Overview
- contents:
  - "4.  Problem Description\n   This section describes the problems in detail with
    respect to various\n   MAC flushing actions described in Section 3.\n"
  - contents:
    - "4.1.  MAC Flushing Optimization in VPLS Resiliency\n   This section describes
      the optimizations required in MAC flushing\n   procedures when H-VPLS resiliency
      is provided by primary and backup\n   spoke PWs.\n"
    - contents:
      - "4.1.1.  MAC Flushing Optimization for Regular H-VPLS\n   Figure 2 shows a
        dual-homed H-VPLS scenario for a VPLS instance,\n   where the problem with
        the existing MAC flushing method is as\n   explained in Section 3.\n                                 PE1-rs
        \                      PE3-rs\n                               +--------+                  +--------+\n
        \                              |        |                  |        |\n                               |
        \  --   |                  |   --   |\n   Customer Site 1             |  /
        \ \\  |------------------|  /  \\  |->Z\n   X->CE-1               /-----|
        \ \\s /  |                  |  \\s /  |\n       \\     primary spoke PW  |
        \  --   |           /------|   --   |\n        \\             /        +--------+
        \         /       +--------+\n         \\    (MTU-s)/              |    \\
        \       /             |\n          +--------+/               |     \\      /
        \             |\n          |        |                |      \\    /               |\n
        \         |   --   |                |       \\  /                |\n          |
        \ /  \\  |                |      H-VPLS Full-Mesh Core|\n          |  \\s
        /  |                |       / \\                 |\n          |   --   |                |
        \     /   \\                |\n         /+--------+\\               |     /
        \    \\               |\n        /     backup spoke PW       |    /       \\
        \             |\n       /              \\        +--------+         \\--------+--------+\n
        \  Y->CE-2             \\       |        |                  |        |\n   Customer
        Site 2      \\------|  --    |                  |  --    |\n                               |
        /  \\   |------------------| /  \\   |->\n                               |
        \\s /   |                  | \\s /   |\n                               |  --
        \   |                  |  --    |\n                               +--------+
        \                 +--------+\n                                 PE2-rs                      PE4-rs\n
        \         Figure 2: Dual-Homed MTU-s in Two-Tier Hierarchy H-VPLS\n   In Figure
        2, the MTU-s is dual-homed to PE1-rs and PE2-rs.  Only the\n   primary spoke
        PW is active at the MTU-s; thus, PE1-rs is acting as\n   the active device
        (designated forwarder) to reach the full mesh in\n   the VPLS instance.  The
        MAC addresses of nodes located at access\n   sites (behind CE-1 and CE-2)
        are learned at PE1-rs over the primary\n   spoke PW.  Let's say X represents
        a set of such MAC addresses located\n   behind CE-1.  MAC Z represents one
        of a possible set of other\n   destination MACs.  As packets flow from X to
        other MACs in the VPLS\n   network, PE2-rs, PE3-rs, and PE4-rs learn about
        X on their respective\n   mesh PWs terminating at PE1-rs.  When the MTU-s
        switches to the\n   backup spoke PW and activates it, PE2-rs becomes the active
        device\n   (designated forwarder) to reach the full-mesh core for the MTU-s.\n
        \  Traffic entering the H-VPLS from CE-1 and CE-2 is diverted by the\n   MTU-s
        to the spoke PW to PE2-rs.  Traffic destined from PE2-rs,\n   PE3-rs, and
        PE4-rs to X will be black-holed until the MAC address\n   aging timer expires
        (the default is 5 minutes) or a packet flows from\n   X to other addresses
        through PE2-rs.\n   For example, if a packet flows from MAC Z to MAC X after
        the backup\n   spoke PW is active, packets from MAC Z travel from PE3-rs to
        PE1-rs\n   and are dropped.  However, if a packet with MAC X as source and
        MAC Z\n   as destination arrives at PE2-rs, PE2-rs will now learn that MAC
        X is\n   on the backup spoke PW and will forward to MAC Z.  At this point,\n
        \  traffic from PE3-rs to MAC X will go to PE2-rs, since PE3-rs has also\n
        \  learned about MAC X.  Therefore, a mechanism is required to make this\n
        \  learning more timely in cases where traffic is not bidirectional.\n   To
        avoid traffic black-holing, the MAC addresses that have been\n   learned in
        the upstream VPLS full mesh through PE1-rs must be\n   relearned or removed
        from the MAC Forwarding Information Bases (FIBs)\n   in the VSIs at PE2-rs,
        PE3-rs, and PE4-rs.  If PE1-rs and PE2-rs are\n   dual-homing agnostic, then
        on activation of the standby PW from the\n   MTU-s, a MAC flush message will
        be sent by the MTU-s to PE2-rs that\n   will flush all the MAC addresses learned
        in the VPLS instance at\n   PE2-rs from all other PWs except the PW connected
        to the MTU-s.\n   PE2-rs further relays the MAC flush messages to all other
        PE-rs\n   devices in the full mesh.  The same processing rule applies for
        all\n   those PE-rs devices: all the MAC addresses are flushed except the\n
        \  ones learned on the PW connected to PE2-rs.  For example, at PE3-rs\n   all
        of the MAC addresses learned from the PWs connected to PE1-rs and\n   PE4-rs
        are flushed and relearned subsequently.  Before the relearning\n   happens,
        flooding of unknown destination MAC addresses takes place\n   throughout the
        network.  As the number of PE-rs devices in the full\n   mesh increases, the
        number of unaffected MAC addresses flushed in a\n   VPLS instance also increases,
        thus leading to unnecessary flooding\n   and relearning.  With a large number
        of VPLS instances provisioned in\n   the H-VPLS network topology, the amount
        of unnecessary flooding and\n   relearning increases.  An optimization, described
        below, is required\n   that will flush only the MAC addresses learned from
        the respective\n   PWs between PE1-rs and other PE devices in the full mesh,
        to minimize\n   the relearning and flooding in the network.  In the example
        above,\n   only the MAC addresses in sets X and Y (shown in Figure 2) need
        to be\n   flushed across the core.\n   The same case is applicable when PE1-rs
        and PE2-rs are dual-homing\n   aware and participate in a designated forwarder
        election.  When\n   PE2-rs becomes the active device for the MTU-s, then PE2-rs
        MAY\n   initiate MAC flushing towards the core.  The receiving action of the\n
        \  MAC flush message in other PE-rs devices is the same as in MAC\n   flushing
        initiated by the MTU-s.  This is the behavior specified in\n   [RFC4762].\n"
      title: 4.1.1.  MAC Flushing Optimization for Regular H-VPLS
    - contents:
      - "4.1.2.  MAC Flushing Optimization for Native Ethernet Access\n   The analysis
        in Section 4.1.1 applies also to the native Ethernet\n   access into a VPLS.
        \ In such a scenario, one active endpoint and one\n   or more standby endpoints
        terminate into two or more VPLS or H-VPLS\n   PE-rs devices.  Examples of
        this dual-homed access are ITU-T\n   [ITU.G8032] access rings or any proprietary
        multi-chassis Link\n   Aggregation Group (LAG) emulations.  Upon failure of
        the active\n   native Ethernet endpoint on PE1-rs, an optimized MAC flush
        message is\n   required to be initiated by PE1-rs to ensure that on PE2-rs,
        PE3-rs,\n   and PE4-rs only the MAC addresses learned from the respective
        PWs\n   connected to PE1-rs are being flushed.\n"
      title: 4.1.2.  MAC Flushing Optimization for Native Ethernet Access
    title: 4.1.  MAC Flushing Optimization in VPLS Resiliency
  - contents:
    - "4.2.  Black-Holing Issue in PBB-VPLS\n   In a PBB-VPLS deployment, a B-component
      VPLS (B-VPLS) may be used as\n   infrastructure to support one or more I-component
      instances.  The\n   B-VPLS control plane (LDP Signaling) and learning of Backbone
      MACs\n   (B-MACs) replace the I-component control plane and learning of\n   Customer
      MACs (C-MACs) throughout the MPLS core.  This raises an\n   additional challenge
      related to black-hole avoidance in the\n   I-component domain as described in
      this section.  Figure 3 describes\n   the case of a Customer Edge (CE) device
      (node A) dual-homed to two\n   I-component instances located on two PBB-VPLS
      PEs (PE1-rs and\n   PE2-rs).\n                              IP/MPLS Core\n                            +--------------+\n
      \                           |PE2-rs        |\n                           +----+
      \         |\n                           |PBB |          |\n                           |VPLS|
      \  +-+    |\n                           |(B2)|---|P|    |\n                      Stby/+----+
      \ /+-+\\   |PE3-rs\n                         / +----+ /     \\+----+\n                   +---+/
      \ |PBB |/  +-+  |PBB |   +---+\n          C-MAC X--|CE |---|VPLS|---|P|--|VPLS|---|CE
      |--C-MAC Y\n                   |   |Act|(B1)|   +-+  |    |   |   |\n                   +---+
      \  +----+        +----+   +---+\n                     A      |PE1-rs        |
      \       B\n                            |              |\n                            +--------------+\n
      \       Figure 3: PBB Black-Holing Issue - CE Dual-Homing Use Case\n   The link
      between PE1-rs and CE-A is active (marked with A), while the\n   link between
      CE-A and PE2-rs is in standby/blocked status.  In the\n   network diagram, C-MAC
      X is one of the MAC addresses located behind\n   CE-A in the customer domain,
      C-MAC Y is behind CE-B, and the B-VPLS\n   instances on PE1-rs are associated
      with B-MAC B1 and PE2-rs with\n   B-MAC B2.\n   As the packets flow from C-MAC
      X to C-MAC Y through PE1-rs with\n   B-MAC B1, the remote PE-rs devices participating
      in the B-VPLS with\n   the same I-SID (for example, PE3-rs) will learn the C-MAC
      X\n   associated with B-MAC B1 on PE1-rs.  Under a failure condition of the\n
      \  link between CE-A and PE1-rs and on activation of the link to PE2-rs,\n   the
      remote PE-rs devices (for example, PE3-rs) will forward the\n   traffic destined
      for C-MAC X to B-MAC B1, resulting in PE1-rs black-\n   holing that traffic
      until the aging timer expires or a packet flows\n   from X to Y through PE2-rs
      (B-MAC B2).  This may take a long time\n   (the default aging timer is 5 minutes)
      and may affect a large number\n   of flows across multiple I-components.\n   A
      possible solution to this issue is to use the existing LDP MAC\n   flushing
      method as specified in [RFC4762] to flush the B-MAC\n   associated with the
      PE-rs in the B-VPLS domain where the failure\n   occurred.  This will automatically
      flush the C-MAC-to-B-MAC\n   association in the remote PE-rs devices.  This
      solution has the\n   disadvantage of producing a lot of unnecessary MAC flushing
      in the\n   B-VPLS domain as there was no failure or topology change affecting\n
      \  the Backbone domain.\n   A better solution -- one that would propagate the
      I-component events\n   through the backbone infrastructure (B-VPLS) -- is required
      in order\n   to flush only the C-MAC-to-B-MAC associations in the remote PBB-VPLS-\n
      \  capable PE-rs devices.  Since there are no I-component control-plane\n   exchanges
      across the PBB backbone, extensions to the B-VPLS control\n   plane are required
      to propagate the I-component MAC flushing events\n   across the B-VPLS.\n"
    title: 4.2.  Black-Holing Issue in PBB-VPLS
  title: 4.  Problem Description
- contents:
  - "5.  Solution Description\n   This section describes the solution for the problem
    space described\n   in Section 4.\n"
  - contents:
    - "5.1.  MAC Flushing Optimization for VPLS Resiliency\n   The basic principle
      of the optimized MAC flush mechanism is explained\n   with reference to Figure
      2.  The optimization is achieved by\n   initiating MAC flushing on failure as
      described in Section 3.2.\n   PE1-rs would initiate MAC flushing towards the
      core on detection of\n   failure of the primary spoke PW between the MTU-s and
      PE1-rs (or\n   status change from active to standby [RFC6718]).  This method
      is\n   referred to as \"MAC flushing on failure\" throughout this document.\n
      \  The MAC flush message would indicate to receiving PE-rs devices to\n   flush
      all MACs learned over the PW in the context of the VPLS for\n   which the MAC
      flush message is received.  Each PE-rs device in the\n   full mesh that receives
      the message identifies the VPLS instance and\n   its respective PW that terminates
      in PE1-rs from the FEC TLV received\n   in the message and/or LDP session.  Thus,
      the PE-rs device flushes\n   only the MAC addresses learned from that PW connected
      to PE1-rs,\n   minimizing the required relearning and the flooding throughout
      the\n   VPLS domain.\n   This section defines a generic MAC Flush Parameters
      TLV for LDP\n   [RFC5036].  Throughout this document, the MAC Flush Parameters
      TLV is\n   also referred to as the \"MAC Flush TLV\".  A MAC Flush TLV carries\n
      \  information on the desired action at the PE-rs device receiving the\n   message
      and is used for optimized MAC flushing in VPLS.  The MAC\n   Flush TLV can also
      be used for the [RFC4762] style of MAC flushing as\n   explained in Section
      3.\n"
    - contents:
      - "5.1.1.  MAC Flush Parameters TLV\n   The MAC Flush Parameters TLV is described
        below:\n     0                   1                   2                   3\n
        \    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
        \   |1|1|  MAC Flush TLV (0x0406)   |           Length              |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
        \   |     Flags     | Sub-TLV Type  |         Sub-TLV Length        |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
        \   |                Sub-TLV Variable-Length Value                  |\n    |
        \                            \"                                 |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
        \  The U-bit and F-bit [RFC5036] are set to forward if unknown so that\n   potential
        intermediate VPLS PE-rs devices unaware of the new TLV can\n   just propagate
        it transparently.  In the case of a B-VPLS network\n   that has PBB-VPLS in
        the core with no I-components attached, this\n   message can still be useful
        to edge B-VPLS devices that do have the\n   I-components with the I-SIDs and
        understand the message.  The MAC\n   Flush Parameters TLV type is 0x0406,
        as assigned by IANA.  The\n   encoding of the TLV follows the standard LDP
        TLV encoding described\n   in [RFC5036].\n   The TLV value field contains
        a 1-byte Flag field used as described\n   below.  Further, the TLV value MAY
        carry one or more sub-TLVs.  Any\n   sub-TLV definition for the above TLV
        MUST address the actions in\n   combination with other existing sub-TLVs.\n
        \  The detailed format for the Flags bit vector is described below:\n       0
        1 2 3 4 5 6 7\n      +-+-+-+-+-+-+-+-+\n      |C|N|    MBZ    | (MBZ = MUST
        Be Zero)\n      +-+-+-+-+-+-+-+-+\n      The 1-byte Flag field is mandatory.
        \ The following flags are\n      defined:\n      C-flag: Used to indicate
        the context of the PBB-VPLS component in\n         which MAC flushing is required.
        \ For PBB-VPLS, there are two\n         contexts of MAC flushing -- the Backbone
        VPLS (B-component\n         VPLS) and the Customer VPLS (I-component VPLS).
        \ The C-flag\n         MUST be ZERO (C = 0) when a MAC flush action for the
        B-VPLS is\n         required and MUST be set (C = 1) when the MAC flush action
        for\n         the I-component is required.  In the regular H-VPLS case, the\n
        \        C-flag MUST be ZERO (C = 0) to indicate that the flush applies\n
        \        to the current VPLS context.\n      N-flag: Used to indicate whether
        a positive (N = 0,\n         flush-all-but-mine) or negative (N = 1, flush-all-from-me)
        MAC\n         flush action is required.  The source (mine/me) is defined as\n
        \        the PW associated with either the LDP session on which the LDP\n
        \        MAC withdraw was received or the B-MAC(s) listed in the B-MAC\n         Sub-TLV.
        \ For the optimized MAC flush procedure described in\n         this section,
        the flag MUST be set (N = 1).\n      Detailed usage in the context of PBB-VPLS
        is explained in\n      Section 5.2.\n      MBZ flags: The rest of the flags
        SHOULD be set to zero on\n         transmission and ignored on reception.\n
        \     The MAC Flush TLV SHOULD be placed after the existing TLVs in the\n
        \     [RFC4762] MAC flush message.\n"
      title: 5.1.1.  MAC Flush Parameters TLV
    - contents:
      - "5.1.2.  Application of the MAC Flush TLV in Optimized MAC Flushing\n   When
        optimized MAC flushing is supported, the MAC Flush TLV MUST be\n   sent in
        an existing LDP address withdraw message with an empty MAC\n   list but from
        the core PE-rs on detection of failure of its\n   local/primary spoke PW.
        \ The N-bit in the TLV MUST be set to 1 to\n   indicate flush-all-from-me.
        \ If the optimized MAC flush procedure is\n   used in a Backbone VPLS or regular
        VPLS/H-VPLS context, the C-bit\n   MUST be ZERO (C = 0).  If it is used in
        an I-component context, the\n   C-bit MUST be set (C = 1).  See Section 5.2
        for details of its usage\n   in the context of PBB-VPLS.\n   Note that the
        assumption is that the MAC Flush TLV is understood by\n   all devices before
        it is turned on in any network.  See Section 6\n   (\"Operational Considerations\").\n
        \  When optimized MAC flushing is not supported, the MAC withdraw\n   procedures
        defined in [RFC4762], where either the MTU-s or PE2-rs\n   sends the MAC withdraw
        message, SHOULD be used.  This includes the\n   case where the network is
        being changed to support optimized MAC\n   flushing but not all devices are
        capable of understanding optimized\n   MAC flush messages.\n   In the case
        of B-VPLS devices, the optimized MAC flush message SHOULD\n   be supported.\n"
      title: 5.1.2.  Application of the MAC Flush TLV in Optimized MAC Flushing
    - contents:
      - "5.1.3.  MAC Flush TLV Processing Rules for Regular VPLS\n   This section
        describes the processing rules of the MAC Flush TLV that\n   MUST be followed
        in the context of optimized MAC flush procedures\n   in VPLS.\n   When optimized
        MAC flushing is supported, a multi-homing PE-rs\n   initiates a MAC flush
        message towards the other related VPLS PE-rs\n   devices when it detects a
        transition (failure or a change to standby)\n   in its active spoke PW.  In
        such a case the MAC Flush TLV MUST be\n   sent with N = 1.  A PE-rs device
        receiving the MAC Flush TLV SHOULD\n   follow the same processing rules as
        those described in this section.\n   Note that if a Multi-Segment Pseudowire
        (MS-PW) is used in VPLS, then\n   a MAC flush message is processed only at
        the PW Terminating Provider\n   Edge (T-PE) nodes, since PW Switching Provider
        Edge S-PE(s) traversed\n   by the MS-PW propagates the MAC flush messages
        without any action.\n   In this section, a PE-rs device signifies only a T-PE
        in the MS-PW\n   case.\n   When a PE-rs device receives a MAC Flush TLV with
        N = 1, it SHOULD\n   flush all the MAC addresses learned from the PW in the
        VPLS in the\n   context on which the MAC flush message is received.  It is
        assumed\n   that when these procedures are used all nodes support the MAC
        flush\n   message.  See Section 6 (\"Operational Considerations\") for details.\n
        \  When optimized MAC flushing is not supported, a MAC Flush TLV is\n   received
        with N = 0 in the MAC flush message; in such a case, the\n   receiving PE-rs
        SHOULD flush the MAC addresses learned from all PWs\n   in the VPLS instance,
        except the ones learned over the PW on which\n   the message is received.\n
        \  Regardless of whether optimized MAC flushing is supported, if a PE-rs\n
        \  device receives a MAC flush message with a MAC Flush TLV option\n   (N
        = 0 or N = 1) and a valid MAC address list, it SHOULD ignore the\n   option
        and deal with MAC addresses explicitly as per [RFC4762].\n"
      title: 5.1.3.  MAC Flush TLV Processing Rules for Regular VPLS
    - contents:
      - "5.1.4.  Optimized MAC Flush Procedures\n   This section expands on the optimized
        MAC flush procedure in the\n   scenario shown in Figure 2.\n   When optimized
        MAC flushing is being used, a PE-rs that is dual-\n   homing aware SHOULD
        send MAC address messages with a MAC Flush TLV\n   and N = 1, provided the
        other PEs understand the new messages.  Upon\n   receipt of the MAC flush
        message, PE2-rs identifies the VPLS instance\n   that requires MAC flushing
        from the FEC element in the FEC TLV.  On\n   receiving N = 1, PE2-rs removes
        all MAC addresses learned from that\n   PW over which the message is received.
        \ The same action is performed\n   by PE3-rs and PE4-rs.\n   Figure 4 shows
        another redundant H-VPLS topology to protect against\n   failure of the MTU-s
        device.  In this case, since there is more than\n   a single MTU-S, a protocol
        such as provider RSTP [IEEE.802.1Q-2011]\n   may be used as the selection
        algorithm for active and backup PWs in\n   order to maintain the connectivity
        between MTU-s devices and PE-rs\n   devices at the edge.  It is assumed that
        PE-rs devices can detect\n   failure on PWs in either direction through OAM
        mechanisms (for\n   instance, Virtual Circuit Connectivity Verification (VCCV)\n
        \  procedures).\n              MTU-1================PE1-rs==============PE3-rs\n
        \               ||                  || \\             /||\n                ||
        \ Redundancy      ||  \\           / ||\n                ||  Provider RSTP
        \  ||   Full Mesh .  ||\n                ||                  ||  /           \\
        ||\n                ||                  || /             \\||\n              MTU-2----------------PE2-rs==============PE4-rs\n
        \                    Backup PW\n                  Figure 4: Redundancy with
        Provider RSTP\n   MTU-1, MTU-2, PE1-rs, and PE2-rs participate in provider
        RSTP.\n   Configuration using RSTP ensures that the PW between MTU-1 and PE1-rs\n
        \  is active and the PW between MTU-2 and PE2-rs is blocked (made\n   backup)
        at the MTU-2 end.  When the active PW failure is detected by\n   RSTP, it
        activates the PW between MTU-2 and PE2-rs.  When PE1-rs\n   detects the failing
        PW to MTU-1, it MAY trigger MAC flushing into the\n   full mesh with a MAC
        Flush TLV that carries N = 1.  Other PE-rs\n   devices in the full mesh that
        receive the MAC flush message identify\n   their respective PWs terminating
        on PE1-rs and flush all the MAC\n   addresses learned from it.\n   [RFC4762]
        describes a multi-domain VPLS service where fully meshed\n   VPLS networks
        (domains) are connected together by a single spoke PW\n   per VPLS service
        between the VPLS \"border\" PE-rs devices.  To provide\n   redundancy against
        failure of the inter-domain spoke, full mesh of\n   inter-domain spokes can
        be set up between border PE-rs devices, and\n   provider RSTP may be used
        for selection of the active inter-domain\n   spoke.  In the case of inter-domain
        spoke PW failure, MAC withdrawal\n   initiated by PE-rs MAY be used for optimized
        MAC flush procedures\n   within individual domains.\n   Further, the procedures
        are applicable to any native Ethernet access\n   topologies multi-homed to
        two or more VPLS PE-rs devices.  The text\n   in this section applies for
        the native Ethernet case where\n   active/standby PWs are replaced with the
        active/standby Ethernet\n   endpoints.  An optimized MAC flush message can
        be generated by the\n   VPLS PE-rs that detects the failure in the primary
        Ethernet access.\n"
      title: 5.1.4.  Optimized MAC Flush Procedures
    title: 5.1.  MAC Flushing Optimization for VPLS Resiliency
  - contents:
    - "5.2.  LDP MAC Flush Extensions for PBB-VPLS\n   The use of an address withdraw
      message with a MAC List TLV is\n   proposed in [RFC4762] as a way to expedite
      removal of MAC addresses\n   as the result of a topology change (e.g., failure
      of a primary link\n   of a VPLS PE-rs device and, implicitly, the activation
      of an\n   alternate link in a dual-homing use case).  These existing procedures\n
      \  apply individually to B-VPLS and I-component domains.\n   When it comes to
      reflecting topology changes in access networks\n   connected to I-components
      across the B-VPLS domain, certain additions\n   should be considered, as described
      below.\n   MAC switching in PBB is based on the mapping of Customer MACs\n   (C-MACs)
      to one or more Backbone MACs (B-MACs).  A topology change in\n   the access
      (I-component domain) should just invoke the flushing of\n   C-MAC entries in
      the PBB PEs' FIB(s) associated with the\n   I-component(s) impacted by the failure.
      \ There is a need to indicate\n   the PBB PE (B-MAC source) that originated
      the MAC flush message to\n   selectively flush only the MACs that are affected.\n
      \  These goals can be achieved by including the MAC Flush Parameters TLV\n   in
      the LDP address withdraw message to indicate the particular\n   domain(s) requiring
      MAC flushing.  On the other end, the receiving\n   PEs SHOULD use the information
      from the new TLV to flush only the\n   related FIB entry/entries in the I-component
      instance(s).\n   At least one of the following sub-TLVs MUST be included in
      the MAC\n   Flush Parameters TLV if the C-flag is set to 1:\n   o  PBB B-MAC
      List Sub-TLV:\n      Type: 0x0407\n      Length: Value length in octets.  At
      least one B-MAC address MUST\n      be present in the list.\n      Value: One
      or a list of 48-bit B-MAC addresses.  These are the\n      source B-MAC addresses
      associated with the B-VPLS instance that\n      originated the MAC withdraw
      message.  It will be used to identify\n      the C-MAC(s) mapped to the B-MAC(s)
      listed in the sub-TLV.\n   o  PBB I-SID List Sub-TLV:\n      Type: 0x0408\n
      \     Length: Value length in octets.  Zero indicates an empty I-SID\n      list.
      \ An empty I-SID list means that the flushing applies to all\n      the I-SIDs
      mapped to the B-VPLS indicated by the FEC TLV.\n      Value: One or a list of
      24-bit I-SIDs that represent the\n      I-component FIB(s) where the MAC flushing
      needs to take place.\n"
    - contents:
      - "5.2.1.  MAC Flush TLV Processing Rules for PBB-VPLS\n   The following steps
        describe the details of the processing rules for\n   the MAC Flush TLV in
        the context of PBB-VPLS.  In general, these\n   procedures are similar to
        the VPLS case but are tailored to PBB,\n   which may have a large number of
        MAC addresses.  In PBB, there are\n   two sets of MAC addresses: Backbone
        (outer) MACs (B-MACs) and\n   Customer (inner) MACs (C-MACs).  C-MACs are
        associated to remote\n   B-MACs by learning.  There are also I-SIDs in PBB;
        I-SIDs are similar\n   to VLANs for the purposes of the discussion in this
        section.  In\n   order to achieve behavior that is similar to the Regular
        VPLS case,\n   there are some differences in the interpretation of the optimized
        MAC\n   flush message.\n   1. Positive flush of C-MACs.  This is equivalent
        to [RFC4762] MAC\n      flushing in a PBB context.  In this case, the N-bit
        is set to 0;\n      the C-bit is set to 1, and C-MACs are to be flushed.  However,\n
        \     since C-MACs are related to B-MACs in an I-SID context, further\n      refinement
        of the flushing scope is possible.\n      - If an I-SID needs to be flushed
        (all C-MACs within that I-SID),\n        then I-SIDs are listed in the appropriate
        TLV.  If all I-SIDs\n        are to have the C-MACs flushed, then the I-SID
        TLV can be empty.\n        It is typical to flush a single I-SID only, since
        each I-SID is\n        associated with one or more interfaces (typically one,
        in the\n        case of dual-homing).  In the PBB case, flushing the I-SID
        is\n        equivalent to the empty MAC list discussed in [RFC4762].\n      -
        If only a set of B-MAC-to-C-MAC associations needs to be\n        flushed,
        then a B-MAC list can be included to further refine the\n        list.  This
        can be the case if an I-SID component has more than\n        one interface
        and a B-MAC is used to refine the granularity.\n        Since this is a positive
        MAC flush message, the intended\n        behavior is to flush all C-MACs except
        those that are associated\n        with B-MACs in the list.\n        Positive
        flush of B-MACs is also useful for propagating flush\n        from other protocols
        such as RSTP.\n   2. Negative flush of C-MACs.  This is equivalent to optimized
        MAC\n      flushing.  In this case, the N-bit is set to 1; the C-bit is set\n
        \     to 1, and a list of B-MACs is provided so that the respective\n      C-MACs
        can be flushed.\n      - The I-SID list SHOULD be specified.  If it is absent,
        then all\n        I-SIDs require that the C-MACs be flushed.\n      - A set
        of B-MACs SHOULD be listed, since B-MAC-to-C-MAC\n        associations need
        to be flushed and listing B-MACs scopes the\n        flush to just those B-MACs.
        \ Again, this is typical usage,\n        because a PBB VPLS I-component interface
        will have one\n        associated I-SID and typically one (but possibly more
        than one)\n        B-MAC, each with multiple remotely learned C-MACs.  The
        B-MAC\n        list is included to further refine the list for the remote\n
        \       receiver.  Since this is a negative MAC flush message, the\n        intended
        behavior is to flush all remote C-MACs that are\n        associated with any
        B-MACs in the list (in other words, from the\n        affected interface).\n
        \  The processing rules on reception of the MAC flush message are:\n   - On
        Backbone Core Bridges (BCBs), if the C-bit is set to 1, then the\n     PBB-VPLS
        SHOULD NOT flush their B-MAC FIBs.  The B-VPLS control\n     plane SHOULD
        propagate the MAC flush message following the data-\n     plane split-horizon
        rules to the established B-VPLS topology.\n   - On Backbone Edge Bridges (BEBs),
        the following actions apply:\n      - The PBB I-SID list is used to determine
        the particular I-SID\n        FIBs (I-component) that need to be considered
        for flushing\n        action.  If the PBB I-SID List Sub-TLV is not included
        in a\n        received message, then all the I-SID FIBs associated with the\n
        \       receiving B-VPLS SHOULD be considered for flushing action.\n      -
        The PBB B-MAC list is used to identify from the I-SID FIBs in\n        the
        previous step to selectively flush B-MAC-to-C-MAC\n        associations, depending
        on the N-flag specified below.  If the\n        PBB B-MAC List Sub-TLV is
        not included in a received message,\n        then all B-MAC-to-C-MAC associations
        in all I-SID FIBs\n        (I-component) as specified by the I-SID List are
        considered for\n        required flushing action, again depending on the N-flag\n
        \       specified below.\n      - Next, depending on the N-flag value, the
        following actions\n        apply:\n        - N = 0: all the C-MACs in the
        selected I-SID FIBs SHOULD be\n          flushed, with the exception of the
        resultant C-MAC list from\n          the B-MAC list mentioned in the message
        (\"flush all but the\n          C-MACs associated with the B-MAC(s) in the
        B-MAC List Sub-TLV\n          from the FIBs associated with the I-SID list\").\n
        \       - N = 1: all the resultant C-MACs SHOULD be flushed (\"flush all\n
        \         the C-MACs associated with the B-MAC(s) in the B-MAC List\n          Sub-TLV
        from the FIBs associated with the I-SID list\").\n"
      title: 5.2.1.  MAC Flush TLV Processing Rules for PBB-VPLS
    - contents:
      - "5.2.2.  Applicability of the MAC Flush Parameters TLV\n   If the MAC Flush
        Parameters TLV is received by a Backbone Edge Bridge\n   (BEB) in a PBB-VPLS
        that does not understand the TLV, then an\n   undesirable MAC flushing action
        may result.  It is RECOMMENDED that\n   all PE-rs devices participating in
        PBB-VPLS support the MAC Flush\n   Parameters TLV.  If this is not possible,
        the MAC Flush Parameters\n   TLV SHOULD be disabled, as mentioned in Section
        6 (\"Operational\n   Considerations\").\n   \"Mac Flush TLV\" and its formal
        name -- \"MAC Flush Parameters TLV\" --\n   are synonymous.  The MAC Flush
        TLV is applicable to the regular VPLS\n   context as well, as explained in
        Section 3.1.1.  To achieve negative\n   MAC flushing (flush-all-from-me) in
        a regular VPLS context, the MAC\n   Flush Parameters TLV SHOULD be encoded
        with C = 0 and N = 1 without\n   inclusion of any Sub-TLVs.  A negative MAC
        flush message is highly\n   desirable in scenarios where VPLS access redundancy
        is provided by\n   Ethernet ring protection as specified in the ITU-T G.8032
        [ITU.G8032]\n   specification.\n"
      title: 5.2.2.  Applicability of the MAC Flush Parameters TLV
    title: 5.2.  LDP MAC Flush Extensions for PBB-VPLS
  title: 5.  Solution Description
- contents:
  - "6.  Operational Considerations\n   As mentioned earlier, if the MAC Flush Parameters
    TLV is not\n   understood by a receiver, then an undesirable MAC flushing action\n
    \  would result.  To avoid this, one possible solution is to develop an\n   LDP-based
    capability negotiation mechanism to negotiate support of\n   various MAC flushing
    capabilities between PE-rs devices in a VPLS\n   instance.  A negotiation mechanism
    was discussed previously and was\n   considered outside the scope of this document.
    \ Negotiation is not\n   required to deploy this optimized MAC flushing as described
    in this\n   document.\n   VPLS may be used with or without the optimization.  If
    an operator\n   wants the optimization for VPLS, it is the operator's responsibility\n
    \  to make sure that the VPLS devices that are capable of supporting the\n   optimization
    are properly configured.  From an operational\n   standpoint, it is RECOMMENDED
    that implementations of the solution\n   provide administrative control to select
    the desired MAC flushing\n   action towards a PE-rs device in the VPLS.  Thus,
    in the topology\n   described in Figure 2, an implementation could support PE1-rs,\n
    \  sending optimized MAC flush messages towards the PE-rs devices that\n   support
    the solution and the PE2-rs device initiating the [RFC4762]\n   style of MAC flush
    messages towards the PE-rs devices that do not\n   support the optimized solution
    during upgrades.  The PE-rs that\n   supports the MAC Flush Parameters TLV MUST
    support the RFC 4762 MAC\n   flushing procedures, since this document only augments
    them.\n   In the case of PBB-VPLS, this operation is the only method supported\n
    \  for specifying I-SIDs, and the optimization is assumed to be\n   supported
    or should be turned off, reverting to flushing using\n   [RFC4762] at the Backbone
    MAC level.\n"
  title: 6.  Operational Considerations
- contents:
  - '7.  IANA Considerations

    '
  - contents:
    - "7.1.  New LDP TLV\n   IANA maintains a registry called \"Label Distribution
      Protocol (LDP)\n   Parameters\" with a sub-registry called \"TLV Type Name Space\".\n
      \  IANA has allocated three new code points as follows:\n       Value | Description
      \              | Reference  | Notes\n      -------+---------------------------+------------+-----------\n
      \     0x0406 | MAC Flush Parameters TLV  | [RFC7361]  |\n      0x0407 | PBB
      B-MAC List Sub-TLV    | [RFC7361]  |\n      0x0408 | PBB I-SID List Sub-TLV
      \   | [RFC7361]  |\n"
    title: 7.1.  New LDP TLV
  - contents:
    - "7.2.  New Registry for MAC Flush Flags\n   IANA has created a new sub-registry
      under \"Label Distribution\n   Protocol (LDP) Parameters\" called \"MAC Flush
      Flags\".\n   IANA has populated the registry as follows:\n   Bit Number | Hex
      \ | Abbreviation | Description           | Reference\n   -----------+------+--------------+-----------------------+-----------\n
      \    0        | 0x80 | C            | Context               | [RFC7361]\n     1
      \       | 0x40 | N            | Negative MAC flushing | [RFC7361]\n     2-7
      \     |      |              | Unassigned            |\n   Other new bits are
      to be assigned by Standards Action [RFC5226].\n"
    title: 7.2.  New Registry for MAC Flush Flags
  title: 7.  IANA Considerations
- contents:
  - "8.  Security Considerations\n   Control-plane aspects:\n      LDP security (authentication)
    methods as described in [RFC5036]\n      are applicable here.  Further, this document
    implements security\n      considerations as discussed in [RFC4447] and [RFC4762].
    \ The\n      extensions defined here optimize the MAC flushing action, and so\n
    \     the risk of security attacks is reduced.  However, in the event\n      that
    the configuration of support for the new TLV can be spoofed,\n      sub-optimal
    behavior will be seen.\n   Data-plane aspects:\n      This specification does
    not have any impact on the VPLS forwarding\n      plane but can improve MAC flushing
    behavior.\n"
  title: 8.  Security Considerations
- contents:
  - "9.  Contributing Author\n   The authors would like to thank Marc Lasserre, who
    made a major\n   contribution to the development of this document.\n      Marc
    Lasserre\n      Alcatel-Lucent\n      EMail: marc.lasserre@alcatel-lucent.com\n"
  title: 9.  Contributing Author
- contents:
  - "10.  Acknowledgements\n   The authors would like to thank the following people
    who have\n   provided valuable comments, feedback, and review on the topics\n
    \  discussed in this document: Dimitri Papadimitriou, Jorge Rabadan,\n   Prashanth
    Ishwar, Vipin Jain, John Rigby, Ali Sajassi, Wim\n   Henderickx, Paul Kwok, Maarten
    Vissers, Daniel Cohn, Nabil Bitar,\n   Giles Heron, Adrian Farrel, Ben Niven-Jenkins,
    Robert Sparks, Susan\n   Hares, and Stephen Farrell.\n"
  title: 10.  Acknowledgements
- contents:
  - '11.  References

    '
  - contents:
    - "11.1.  Normative References\n   [RFC2119]   Bradner, S., \"Key words for use
      in RFCs to Indicate\n               Requirement Levels\", BCP 14, RFC 2119,
      March 1997.\n   [RFC4447]   Martini, L., Ed., Rosen, E., El-Aawar, N., Smith,
      T., and\n               G. Heron, \"Pseudowire Setup and Maintenance Using the\n
      \              Label Distribution Protocol (LDP)\", RFC 4447, April 2006.\n
      \  [RFC4762]   Lasserre, M., Ed., and V. Kompella, Ed., \"Virtual Private\n
      \              LAN Service (VPLS) Using Label Distribution Protocol\n               (LDP)
      Signaling\", RFC 4762, January 2007.\n   [RFC5036]   Andersson, L., Ed., Minei,
      I., Ed., and B. Thomas, Ed.,\n               \"LDP Specification\", RFC 5036,
      October 2007.\n"
    title: 11.1.  Normative References
  - contents:
    - "11.2.  Informative References\n   [IEEE.802.1Q-2011]\n               IEEE,
      \"IEEE Standard for Local and metropolitan area\n               networks --
      Media Access Control (MAC) Bridges and\n               Virtual Bridged Local
      Area Networks\", IEEE Std 802.1Q,\n               2011.\n   [ITU.G8032] International
      Telecommunication Union, \"Ethernet ring\n               protection switching\",
      ITU-T Recommendation G.8032,\n               February 2012.\n   [RFC4664]   Andersson,
      L., Ed., and E. Rosen, Ed., \"Framework for\n               Layer 2 Virtual
      Private Networks (L2VPNs)\", RFC 4664,\n               September 2006.\n   [RFC5226]
      \  Narten, T. and H. Alvestrand, \"Guidelines for Writing an\n               IANA
      Considerations Section in RFCs\", BCP 26, RFC 5226,\n               May 2008.\n
      \  [RFC6073]   Martini, L., Metz, C., Nadeau, T., Bocci, M., and M.\n               Aissaoui,
      \"Segmented Pseudowire\", RFC 6073, January 2011.\n   [RFC6718]   Muley, P.,
      Aissaoui, M., and M. Bocci, \"Pseudowire\n               Redundancy\", RFC 6718,
      August 2012.\n   [RFC7041]   Balus, F., Ed., Sajassi, A., Ed., and N. Bitar,
      Ed.,\n               \"Extensions to the Virtual Private LAN Service (VPLS)\n
      \              Provider Edge (PE) Model for Provider Backbone Bridging\",\n
      \              RFC 7041, November 2013.\n   [VPLS-MH]   Kothari, B., Kompella,
      K., Henderickx, W., Balus, F.,\n               Uttaro, J., Palislamovic, S.,
      and W. Lin, \"BGP based\n               Multi-homing in Virtual Private LAN
      Service\", Work in\n               Progress, July 2014.\n"
    title: 11.2.  Informative References
  title: 11.  References
- contents:
  - "Authors' Addresses\n   Pranjal Kumar Dutta\n   Alcatel-Lucent\n   701 E Middlefield
    Road\n   Mountain View, CA  94043\n   USA\n   EMail: pranjal.dutta@alcatel-lucent.com\n
    \  Florin Balus\n   Alcatel-Lucent\n   701 E Middlefield Road\n   Mountain View,
    CA  94043\n   USA\n   EMail: florin.balus@alcatel-lucent.com\n   Olen Stokes\n
    \  Extreme Networks\n   2121 RDU Center Drive\n   Suite 300\n   Morrisville, NC
    \ 27650\n   USA\n   EMail: ostokes@extremenetworks.com\n   Geraldine Calvignac\n
    \  Orange\n   2, avenue Pierre-Marzin\n   Lannion Cedex,  22307\n   France\n   EMail:
    geraldine.calvignac@orange.com\n   Don Fedyk\n   Hewlett-Packard Company\n   USA\n
    \  EMail: don.fedyk@hp.com\n"
  title: Authors' Addresses
