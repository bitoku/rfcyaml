Abstract Since 1997, the Italian laws have recognized electronic delivery systems as legally usable.
In 2005, after two years of technical tests, the characteristics of an official electronic delivery service, named certified electronic mail (in Italian "Posta Elettronica Certificata") were defined, giving the system legal standing.
The design of the entire system was carried out by the National Center for Informatics in the Public Administration of Italy (DigitPA), followed by efforts for the implementation and testing of the service.
The DigitPA has given the Italian National Research Council (CNR), and in particular the Institute of Information Science and Technologies at the CNR (ISTI), the task of running tests on providers of the service to guarantee the correct implementation and interoperability.
This document describes the certified email system adopted in Italy.
It represents the system as it is at the moment of writing, following the technical regulations that were written based upon the Italian Law DPR.
Since 1997, the Italian laws have recognized electronic delivery systems as legally usable.
In 2005, after two years of technical tests, the characteristics of an official electronic delivery service, named certified electronic mail (in Italian Posta Elettronica Certificata, from now on "PEC") were defined, giving the system legal standing.
This document represents the English version of the Italian specifications (http://www.digitpa.gov.it/sites/default/files/normativa/ Pec regole tecniche DM 2 nov 2005.pdf); the Italian version is the normative PEC reference.
IETF review did not result in community consensus.
Since this specification describes existing deployment and implementation, the issues identified by the IETF community have not been addressed in this document.
However, these issues would need to be addressed before a successor to this document could be published.
At a minimum, the successor document would need to include:
A clear statement of the requirements/goals that need to be satisfied by the protocol;   A comprehensive diagram and description of the overall message flow and delivery sequence required to achieve the requirements;   Alignment with traditional terminology for IETF email and security
A review of prior art; and   A replacement of the unregistered LDAP DN name space used in this specification, which may lead to conflict with other registered or unregistered names, with a registered name space.
To ensure secure transactions over the Internet, cryptography can be associated with electronic messages in order to provide some guarantee on sender identity, message integrity, confidentiality, and non repudiation of origin.
Many end to end techniques exist to accomplish such goals, and some offer a high level of security.
The downside of end to end cryptography is the need for an extensive penetration of technology in society, because it is essential for every user to have asymmetric keys and certificates signed by a Certification Authority.
Along with that, users would need to have an adequate amount of knowledge regarding the use of such technology.
PEC, on the other hand, uses applications running on servers to digitally sign messages, thus avoiding the complexity end to end systems bring about.
By doing so, the user need only have an ordinary mail client with which to interact.
The downside is that the level of security drops, since the protection does not cover the entire transaction.
Nonetheless, application is simpler and does not require specific user skills, making it easily more widespread among users.
This document describes PEC's technical aspects and features.
It presents the details of the protocol and the messages that are sent between service providers, introducing the system adopted by the Italian government for the exchange of certified emails.
The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in [REQ].
Italian National Agency for Digital Administration
Fully Qualified Domain Name ISTI:
The Institute of Information Science and Technologies at the CNR (Istituto di Scienza e Tecnologie dell'Informazione "
Lightweight Directory Access Protocol LDIF:
LDAP Data Interchange Format MIME:
Terminology and Definitions Certification data:
A set of data certified by the sender's PEC provider that describes the original message.
It includes the date and time of dispatch, sender email address,
recipient(s) email address(es), subject, and message identifier.
A service based on electronic mail, as defined by the [EMAIL] and [SMTP] standards and extensions, which permits the transmission of documents produced with informatics tools.
The person or organization to whom a PEC mailbox is assigned.
Message sent: A PEC message is considered sent when the sender's PEC provider, after several checks, accepts the email and returns a server user acceptance PEC notification to the sender.
Message received: A PEC message is considered received when it is stored in the receiver's mailbox, after which the receiver PEC provider returns a delivery PEC notification to the sender.
: Is the message identifier generated by the email client, as defined in [EMAIL], before the message is submitted to the PEC system.
Is the user generated message before its arrival to the sender Access Point.
The original message is delivered to the recipient inside a PEC transport envelope.
PEC domain: Corresponds to a DNS domain dedicated to the holders' mailboxes.
An electronic mailbox for which delivery PEC notifications are issued upon reception of PEC messages.
Such a mailbox can be defined exclusively within a PEC domain.
Is a unique identifier generated by the PEC system, which will substitute the msgid.
The entity that handles one or more PEC domains with their relative points of Access, Reception, and Delivery.
It is the holder of the key that is used for signing PEC notifications and envelopes, and it interacts with other PEC providers for interoperability with other holders.
: Is a key released by DigitPA to every PEC provider.
It is used to sign PEC notifications and envelopes and to authorize access to the PEC providers directory.
: Is an LDAP server positioned in an area reachable by all PEC service providers.
It constitutes the technical structure related to the public list of PEC service providers and contains the list of PEC domains and service providers with relevant certificates.
A mailbox for the sole use of the provider, dedicated for the reception of server server acceptance and virus detection PEC notifications.
Digital evidence with which a temporal reference, that can't be repudiated, is attributed to one or more documents.
The PEC system generates messages in MIME format composed of a descriptive textual part and other [MIME1] parts, the number and content of which varies according to the type of message generated.
A system generated message falls into one of the following categories:  Notifications;  Envelopes.
The message is inserted in an S/MIME v3 structure in CMS format and signed with the PEC provider's private key.
The X.509v3 certificate associated with the key MUST be included in the aforementioned structure.
The S/MIME format used to sign system generated messages is the "multipart/signed" format (.p7s), as described in section 3.4.3 of [SMIMEV3].
To guarantee the verifiability of signatures on as many mail clients as possible, X.509v3 certificates used by certified email systems MUST abide by the profile found in section 6.5.
In order for the receiving mail client to verify the signature, the sender address MUST coincide with the one indicated within the X.509v3 certificate.
For this mechanism, PEC transport envelopes MUST indicate in the "From:" field a single author's address which is different from the one contained in the original message.
To allow for better message usability by the receiving user, the author's mail address in the original message is inserted as a "display name".
For example, a "From:" field such as: From: "John Smith" <john.smith@domain.example.com> would result in the following "From:" value in the respective PEC transport envelope: From: "On behalf of: john.smith@domain.example.com" <certified mail@provider.example.com
"From:" and "Sender:" fields MUST contain the same value.
In order for replies to be correctly sent back to the proper destination, the "Reply To:" field in the PEC transport envelope MUST contain the same unaltered value of the original message's "Reply To:" field.
When it is not explicitly specified in the original message, the system that generates the PEC transport envelope creates it by extracting the information from the "From:" field in the original message.
When PEC notifications are sent, the system MUST use the original message sender's address as the destination address, as is specified in the reverse path data of the SMTP protocol.
PEC notifications MUST be sent to the sender's PEC mailbox without taking into account the "Reply To:" field, which might be present in the original message's header.
All system generated PEC messages are identifiable for having a specific header defined in PEC according to the type of message generated.
To determine the certification data, the elements used for the actual routing of the message are employed.
In SMTP dialog phases, the reverse path and forward path data ("MAIL FROM" and "RCPT TO" commands) are thus considered certification data of both the sender and the recipients, respectively.
Addressing data present in the message body ("To:" and "Cc:" fields) are used solely in order to discriminate between primary and carbon copy recipients when necessary; addressing data present in the "Bcc:" field MUST be considered invalid by the system.
All system generated messages inherit their header fields and values from the original message, with extra fields added according to the type of message generated.
They have the purpose of informing the sending user and interacting providers of the progress the message is making within the PEC network.
These notifications indicate an acknowledgment on the provider's side for the reception or handling of a PEC message.
More specifically, it can indicate one of three situations: server user acceptance, server server acceptance, or delivery.
Added header fields are:  X Ricevuta:
The field "X Ricevuta:" indicates the type of PEC notification contained in the message, whereas "X Riferimento Message ID:" contains the message identifier generated by the mail client (msgid).
Body contents differ according to notification type.
This is described more thoroughly in section 3.
A server user acceptance PEC notification informs the user that his provider has accepted the message and will be taking care of passing it on to the provider(s) of the addressee(s).
A server server acceptance PEC notification is an inter provider communication only, it MUST NOT be sent to the users.
With this notification, the receiving provider simply informs the sending one that it has received a PEC message, and will take the responsibility of forwarding it to the addressee(s).
From then on, the sender provider is no longer held responsible as to the whereabouts of the message, but is limited to notifying its user of the success or failure of delivery.
Delivery PEC notifications take place as the final communication of a transaction, indicating overall success in handing the message over to the addressee(s).
Delay PEC Notifications Delay PEC notifications are sent out 12 hours after a message has been dispatched from the sending provider, and no server server acceptance or delivery PEC notification has been received.
These have the sole purpose of notifying the user of the delay.
If another 12 hours go by without any sign of a server server acceptance or delivery PEC notification (amounting to a 24 hour delay), another delay PEC notification is dispatched to the user informing him of the possible delivery failure.
The provider will not keep track of the delay any further.
They are sent when there is some error in transmission or reception.
More specifically, a failure PEC notification can indicate either a formal exception error or a virus detection.
Added header fields are:  X Ricevuta:
X Ricevuta:" and "X Riferimento Message ID:" have the same role as indicated in section 2.1.1.1.1
X VerificaSicurezza:" (security verification) is an optional header field, used for virus related PEC notifications.
Body contents differ according to notification type.
This is described more thoroughly in section 3.
PEC Envelopes Messages entering the PEC network are inserted within specific PEC messages, called envelopes, before they are allowed to circulate further within the network.
These envelopes MUST inherit the following header fields, along with their unmodified values, from the message itself:
Depending on the type of message requesting admission into the PEC network, it will be inserted in either a PEC transport envelope or a PEC anomaly envelope.
Distinction will be possible through the addition of the "X Trasporto:" header field.
This is what the user client at the sender side interacts with, giving the user access to PEC services set up by the provider.
Such access MUST be preceded by user authentication on the system (see section 5.2).
The Access Point receives the original messages its user wishes to send, runs some formal checks, and acts according to the outcome:  if the message passes all checks, the Access Point generates a server user acceptance PEC notification and inserts the original message inside a PEC transport envelope;  if a formal exception is detected, the Access Point refuses the message and emits the relevant non acceptance PEC notification (see section 3.1.1);  if a virus is detected, the Access Point generates a non  acceptance PEC notification and inserts the original message as is in the provider's special store.
Generation of the server user acceptance notification indicates to the user that the message was accepted by the system, certifying also the date and time of the event.
The notification MUST contain user  readable text, and an XML part containing the certification data.
The notification MAY also contain other attachments for extra features offered by the provider.
Using the data available in the PEC providers directory (see section 4.5), the Access Point runs checks on every recipient in the "To:" and "Cc:" fields present in the original message to verify whether they belong to the PEC infrastructure or to non PEC domains.
Such checks are done by verifying the existence, through a case  insensitive search, of the recipients' domains in the "managedDomains" attribute found within the PEC providers directory.
Therefore, the server user acceptance PEC notification (and relevant certification data) relates to, for each address, the typology of its domain; PEC or non PEC.
The message identifier (PEC msgid) of accepted original messages within the PEC infrastructure MUST be unambiguous in order to consent correct tracking of messages and relative PEC notifications.
The format of such an identifier is: [alphanumeric string]@[provider mail domain] or: [alphanumeric string]@[FQDN mail server]
Therefore, both the original message and the corresponding PEC transport envelope MUST contain the following header field:
When an email client that is interacting with the Access Point has already inserted a message identifier (msgid) in the original message, that msgid SHALL be substituted by a PEC msgid.
In order to allow the sender to link the message sent with the relative PEC notifications, the msgid MUST be inserted in the original message as well as the relative PEC notifications and transport envelope.
If present, the msgid is REQUIRED in the original message's header by adding the following header field:
X Riferimento Message ID: <
which will also be inserted in the PEC transport envelope and notifications, and related in the certification data (see section 4.4).
This point permits the exchange of PEC messages and notifications between PEC providers.
It is also the point through which ordinary mail messages can be inserted within the system of certified mail.
The exchange of messages between providers takes place through SMTP  based transactions, as defined in [SMTP].
If SMTP communication errors occur, they MAY be handled using the standard error notification mechanisms, as provided by SMTP in [SMTP] and [SMTP DSN].
The same mechanism is also adopted for handling transitory errors, that result in long idling periods, during an SMTP transmission phase.
In order to guarantee that an error is returned to the user, as defined in section 3.3.3, the system that handles PEC traffic MUST adopt a time limit for message idleness equal to 24 hours.
Once a message arrives, the Incoming Point runs the following list of checks and operations:  verifies correctness and type of the incoming message;  if the incoming message is a correct and undamaged PEC transport envelope: emits a server server acceptance PEC notification towards the sender provider (section 3.2.1); forwards the PEC transport envelope to the Delivery Point (section 3.3).
if the incoming message is a correct and undamaged PEC notification, forwards the notification to the Delivery Point.
if the incoming message does not conform to the prerequisites of a correct and undamaged PEC transport envelope or notification, but comes from a PEC provider, i.e., passes the verifications regarding existence, origin, and validity of the signature, then the message MUST be propagated towards the recipient.
Therefore, the Incoming Point:  inserts the incoming message in a PEC anomaly envelope (section 3.2.2);  forwards the PEC anomaly envelope to the Delivery Point.
if the incoming message does not originate from a PEC system, i.e., fails verifications regarding existence, origin, and validity of the signature, then the message will be treated as ordinary email, and, if propagated to the recipient: is inserted in a PEC anomaly envelope (section 3.2.2); the PEC anomaly envelope is forwarded to the Delivery Point.
The server server acceptance PEC notification is generated by the receiving provider and sent to the sending provider.
Its purpose is to keep track of the message in its transition from one provider to another, and is therefore strictly intra provider communication; the end user knows nothing about it.
To check the correctness and integrity of a PEC transport envelope or notification, the Incoming Point runs the following tests:  Signature existence the system verifies the presence of an S/MIME signature structure within the incoming message;  Signature origin the system verifies whether or not the signature belongs to a PEC provider by extracting the certificate used for signing and verifying its presence in the PEC providers directory.
To ease the check, it is possible to calculate the certificate's [SHA1] hash value and perform a case insensitive search of its hexadecimal representation within the "providerCertificateHash" attribute found in the PEC providers directory.
This operation allows one to easily identify the sender provider for subsequent and necessary matching checks between the extracted certificate and the one present in the provider's record;  Signature validity S/MIME signature correctness is verified by recalculating the signature value, checking the entire certification path, and verifying the [CRL] and temporal validity of the certificate.
In case some caching mechanism is used for CRL contents, an update interval MUST be adopted so that the most up to date data is guaranteed, thus minimizing the possible delay between a publication revocation by the Certification Authority and the variation acknowledgment by the provider;  Formal correctness the provider performs sufficient and necessary checks to guarantee that the incoming message is compliant with the formats specified in this document (PEC transport envelope and notifications).
If a virus infected PEC transport envelope passes the checks just mentioned, it is still considered correct and undamaged.
The presence of the virus will be detected in a second phase, during which the contents of the PEC transport envelope are verified.
Thus, the Incoming Point will refrain from forwarding the message to the recipient, instead sending the appropriate PEC notification of non delivery and storing the virus infected message in the provider's special storage.
In case ordinary mail messages are received, the PEC provider SHALL perform virus checks in order to prevent the infiltration of potentially dangerous mail messages within the PEC system.
If a virus is detected in an ordinary mail message, the latter can be discarded at the Incoming Point before it enters the PEC system.
In other words, no special treatment is reserved for the error; it is handled in a manner that is conformant to the procedures usually followed for messages going through the Internet.
When the receiving provider detects a virus inside a PEC transport envelope during the reception phase, it emits a virus detection PEC notification to the sending provider, which then realizes its checks failed to detect that virus.
When this happens, the sending provider MUST:  check what virus typologies were not detected by its own antivirus to verify the possibility of interventions  send a virus induced non delivery PEC notification to the sender's mailbox.
This point is the point that receives messages from the Incoming Point and forwards them to the final recipient.
It MUST run a series of tests on received messages before forwarding them to the user (see section 3.3.1).
It first verifies the typology of the message and decides whether or not a PEC notification should be issued to the sender.
The delivery PEC notification (section 3.3.2) is emitted after the message was delivered to the recipient's PEC mailbox and only at reception of a valid PEC transport envelope (sections 2.2.2 and 3.1.5).
In all other cases, such as PEC anomaly envelopes and PEC notifications, the delivery PEC notification is not emitted.
Regardless, the message received from the Delivery Point MUST be delivered unmodified to the recipient's mailbox.
The delivery PEC notification indicates to the sender that the message sent was in fact conveyed to the specified recipient's mailbox and certifies the date and time of delivery through use of user readable text and an XML part containing certification data, along with other possible attachments added for extra features offered by the provider.
If a PEC transport envelope received at the Delivery Point can't be delivered to the destination mailbox, the Delivery Point emits a non  delivery PEC notification (section 3.3.3).
If, on the other hand, the delivery error concerns a message that arrives from Internet (i.e., a non PEC message), no such notification is emitted.
Each provider MUST dedicate a special storage for the deposition of any virus infected messages encountered.
Whether the virus be detected by the sender's Access Point or the receiver's Incoming Point, the provider that detects it MUST store the mail message in its own storage, and keep it for 30 months.
For exclusive use of the provider, dedicated to the reception of PEC notifications in two cases only:  server server acceptance notification; and  virus detection notification.
Each provider MUST register a special purpose email address for use when sending PEC transport envelopes and notifications, as delineated in section 3.
This address MAY coincide with that of the service mailbox described in section 2.2.5.
The server administrator MUST keep track of any and all operations carried out in a specific message log file.
The information kept in the log for each operation is the following:  message identifier (msgid)  date and time of event  sender of original message  recipient(s) of original message  subject of original message  event type (reception, delivery, PEC notification emission, etc.)
message identifiers of related generated messages  sending provider
The service provider MUST store this data and preserve it unmodified.
Italian laws have specified that the service provider retain the data for 30 months.
The Access Point acts as a submission service as defined in [SUBMISSION].
When the Access Point receives a message the user wishes to send, it MUST guarantee said message's formal conformity as defined in [EMAIL], and verify that the:  [EMAIL] header section contains a "From:" header field holding an [EMAIL] compliant email address;  [EMAIL] header section contains a "To:" header field holding one or more [EMAIL] compliant email addresses;  sender's address, specified in the SMTP reverse path, coincides with the one in the message's "From:" header field;  recipients' addresses specified in the SMTP forward path coincide with the ones present in the "To:" or "Cc:" header fields of the message;  "Bcc:" header field does not contain any value;  total message size falls within the limits accepted by the provider.
Such limits apply depending on the number of recipients as well; by multiplying it to the message size, the outcome MUST fall within the limits accepted by the provider.
Italian laws have specified this limit as being 30 MB.
If the message does not pass the tests, the Access Point MUST NOT accept the message within the PEC system, thus emitting the relative PEC notification of non acceptance.
When the Access Point cannot forward the message received due to failure in passing formal checks, the sender is notified of such an outcome.
If the error is caused by the message failing size checks, a non acceptance PEC notification is sent as long as the size remains bound by a certain limit.
If the size exceeds said limit, error handling is left to SMTP.
The notification header will contain the following fields:
AVVISO DI NON ACCETTAZIONE: [original subject]
The notification body will contain a text part that constitutes the actual notification in readable format according to a model that relates the following information: Error in message acceptance On [date] at [time] ([time zone]), in the message "[subject]"
originating from "[original sender]" and addressed to: [recipient 1]
[recipient 2] [recipient n] a problem was detected that prevents its acceptance due to [error description].
The message was not accepted.
[PEC msgid of corresponding PEC transport envelope]
The same certification information is inserted in an XML file to be added to the notification body, thus allowing automatic checks on the message (section 4.4).
Parsing MUST be done on the XML part only.
Additional parts MAY be included by the provider for provider  specific services.
Regardless, the original message MUST NOT be included.
The message MUST follow the format described in section 4.3.
The Access Point MUST run some tests on the content of messages it receives from its users and reject them if a virus is detected.
In which case, a virus detection induced non acceptance
PEC notification MUST be emitted to clearly inform the user of the reason the message was refused.
The notification header contains the following fields:
errore Date: [notification emission date] Subject:
AVVISO DI NON ACCETTAZIONE PER VIRUS: [original subject]
The body contains a readable text part according to the following model: Error in message acceptance due to virus presence
([time zone]), in the message "[subject]" originating from "[original sender]" and addressed to: [recipient 1] [recipient 2]
a security problem was detected [ID of detected content type].
The message was not accepted.
[PEC msgid of corresponding PEC transport envelope]
The same certification data is inserted in an XML file added to the notification to allow for automatic checks (section 4.4).
Parsing MUST be done on the XML part only.
Additional parts MAY be included by the provider for provider specific services.
Regardless, the original message MUST NOT be included.
The message MUST follow the format described in section 4.3.
Server User Acceptance PEC Notification
The server user acceptance PEC notification is a message sent to the sender by his server, containing date and time of message acceptance into the system, sender and recipient data, and subject.
The header contains the following fields:
accettazione Date: [actual date of server user acceptance]
The message body contains a text part that constitutes the notification in readable format, according to a model that relates the following information: Server User Acceptance PEC notification
On [date] at [time] ([time zone])
[PEC msgid of corresponding PEC transport envelope]
The same certification data is inserted in an XML file added to the notification message, allowing automatic checks on it (section 4.4).
Parsing MUST be done on the XML part only.
Additional parts MAY be included by the provider for provider specific services.
The message MUST follow the format described in section 4.3.
PEC Transport Envelope A PEC transport envelope is a message generated by the Access Point that contains the original message as well as certification data.
As mentioned in section 2.1.1.2, the PEC transport envelope inherits from the original message the values of the following header fields, which MUST be related unmodified:  Received:
On the other hand, the following fields MUST be modified, or inserted if necessary:
posta certificata Date: [actual date of server user acceptance]
POSTA CERTIFICATA: [original subject] From: "On behalf of: [original sender]" <certified mail@[mail domain]> Reply
(inserted only if not present)
[PEC msgid generated as in section 2.2.1]
field indicates the type of delivery PEC notification the sender wishes to receive   complete, brief, or concise.
The body of the PEC transport envelope contains a text part that constitutes the readable format of the message according to a model that relates the following certification data: Certified mail message
On [date] at [time] ([time zone]), the message "[subject]" was sent by "[original sender]" and addressed to: [recipient 1] [recipient 2]
The original message is included in attachment.
[PEC msgid of corresponding PEC transport envelope]
Within the PEC transport envelope, the entire, non modified original message is inserted in a format compliant with [EMAIL] (except for what has been said regarding the message identifier), as well as an XML part, which contains the certification data that was already related in text format, and information on the type of message and PEC notification requested (section 4.4).
Parsing MUST be done on the XML part only.
Additional parts MAY be included by the provider for provider specific services.
The message MUST follow the format described in section 4.3.
Note that the routing data of the PEC transport envelope (forward and reverse paths) remain unaltered.
Timeout Delivery Error PEC Notification
If the sending provider doesn't receive a server server acceptance or delivery PEC notification from the receiving provider within 12 hours of the message dispatch, it informs the user that the recipient's provider might not be able to deliver the message.
In case the sending provider doesn't receive a delivery PEC notification within 24 hours after message dispatch, it emits another non delivery PEC notification to the user by the 24 hour timeout, but not before 22 hours have passed.
Such a communication takes place through a PEC notification of non  delivery due to timeout, the header of which contains the following fields:
X Ricevuta: preavviso errore consegna Date:
AVVISO DI MANCATA CONSEGNA PER SUP.
The body of the first non delivery PEC notification (12 hour timeout) contains a text part that represents the readable format of the notification which will relate the following data:
([time zone]), the message "[subject]" originating from "[original sender]" and addressed to "[recipient]" has not been delivered within the first 12 hours following its dispatch.
Not excluding that the message might eventually be delivered, it is deemed useful to consider that dispatch might not have a positive outcome.
The system will see to sending another non delivery PEC notification if in the following twelve hours no confirmation is received from the recipient.
[PEC msgid of corresponding PEC transport envelope]
On the other hand, 24 hour timeout induced PEC notifications, which have the same header as described above, will have the following text in their body:
([time zone]), the message "[subject]" originating from "[original sender]" and addressed to "[recipient]" has not been delivered within 24 hours of its dispatch.
The transaction is deemed to be considered terminated with a negative outcome.
[PEC msgid of corresponding PEC transport envelope]
The same certification data is inserted in an XML file added to both PEC notification types to allow automatic checks (section 4.4).
Parsing MUST be done on the XML part only.
Additional parts MAY be added for services supplied by the PEC provider.
Regardless, the original message MUST NOT be included.
The message MUST follow the format described in section 4.3.
A timeout PEC notification is generated if one of the following scenarios occurs:  the sending provider receives a server server acceptance PEC notification during the first 12 hours following message dispatch, but does not receive a delivery PEC notification at all.
In this case, it would be a 24 hour timeout PEC notification.
the sending provider does not receive a server server acceptance PEC notification, but receives a delivery PEC notification after 12 hours and before the 24 hour timeout.
In this case it would be a 12 hour timeout PEC notification.
the sending provider doesn't receive either a server server acceptance or a delivery PEC notification.
In this case, two timeout PEC notifications are generated; a 12 hour and a 24 hour timeout PEC notification.
Server Server Acceptance PEC Notification
When correct PEC transport envelopes (as defined in section 2.2.2.) are exchanged between PEC providers, the receiver MUST send a server  server acceptance PEC notification to the sender.
The single dispatched notification concerns all recipients who belong to the same provider, and to whom the incoming message was addressed, as stated in the routing data (forward and reverse paths) of the SMTP transaction.
Within the certification data of a single server server acceptance PEC notification, all recipients of the message to which it refers are listed.
In general, when receiving a PEC transport envelope, each provider MUST emit one or more server server acceptance PEC notifications to cover, in absence of SMTP transport errors, all the recipients in its jurisdiction.
The header of a server server acceptance PEC notification contains the following fields:
X Ricevuta: presa in carico Date:
[date of server server acceptance] Subject: PRESA IN CARICO: [original subject] From: posta certificata@[mail domain]
To: [sender provider service mailbox]
The provider's service email address is obtained from the PEC providers directory during the necessary queries made in the signature verification stage.
The body contains a text part that follows the underlying model: Server server acceptance PEC notification
([time zone]), the message "[subject]" originating from "[original sender]" and addressed to: [recipient 1] [recipient 2] [recipient n] was accepted by the system.
[PEC msgid of corresponding PEC transport envelope]
The same certification data is inserted in an XML file which is added to the notification message to allow for automatic checks (section 4.4).
Parsing MUST be done on the XML part only.
Additional parts MAY be added by the provider for provider specific services.
The message MUST follow the format described in section 4.3.
If the tests on an incoming message detect an error, or the message is identified as being ordinary mail and the provider is set to forward it to the recipient, the system MUST insert such a message in a PEC anomaly envelope.
Before delivery, the entire message received at the Incoming Point is inserted in a format compliant with [EMAIL] as a [MIME1] part inside a new message that MUST inherit the unmodified values for the following header fields from the received message:
Whereas, the following header fields MUST be modified or inserted:
X Trasplorto: errore Date: [mlessage arrival date
From: "On behalf of: [original sender]" <posta certificata@[mail domain]
To: [original sender (inserted only if not already present)]
The body contains a user readable text part according to a model that relates the following data:
Message anomaly On [date] at [time] ([time zone]), the message "[subject]" originating from "[original sender]" and addressed to: [recipient 1]
[recipient 2] [recipient n] was received.
The data has not been certified due to the following error: [concise description of error]
The original message is attached.
Due to uncertainty regarding origin and/or conformity of the message received, the PEC anomaly envelope MUST NOT contain [MIME1] parts other than the entire message that arrived at the Incoming Point.
Note that the routing data of such an envelope (forward and reverse paths) remain unaltered.
Doing so guarantees both message forwarding to the recipients, and reception of SMTP error notifications, if any occur, by the sender (as specified in [SMTP] and [SMTP DSN]).
If the Incoming Point receives virus infected PEC messages, it MUST NOT forward them.
Rather it MUST inform the sending provider, which will in turn inform the sending user, of the failed transmission.
A separate PEC notification of virus detection MUST be sent on behalf of every recipient within the provider's domain.
In case a virus is detected during the reception phase of a message whose origin was asserted through sender signature verification, the system generates a virus detected PEC notification indicating the error found, and sends it to the sending provider's service mailbox.
The header of this PEC notification contains the following fields:
rilevazione virus X Mittente: [original sender] Date: [date of notification emission] Subject:
The body contains a readable text part according to a model that relates the following data: Virus detection PEC notification
([time zone]), in the message "[subject]" originating from "[original sender]" and addressed to "[recipient]"
a security problem was detected [ID of content type detected].
[PEC msgid of corresponding PEC transport envelope]
The same certification data is inserted in an XML file and added to the notification to allow for automatic checks (section 4.4).
Parsing MUST be done on the XML part only.
Additional parts MAY be included by the provider for provider specific services.
Regardless, the original message MUST NOT be included.
The message MUST follow the format described in section 4.3.
The message body MUST contain the reason for which the transmission could not be completed.
Virus Induced Delivery Error PEC notification
At the reception of a virus detection PEC notification from the receiving provider, the sender provider emits a non delivery PEC notification to the sending user.
The header for this notification contains the following fields:
errore Date: [date of notification emission]
AVVISO DI MANCATA CONSEGNA PER VIRUS: [original subject]
The body contains a readable text part according to a model that relates the following data: Delivery error PEC notification due to virus
([time zone]), in the message "[subject]" addressed to "[recipient]" a security problem was detected [ID of content type detected by the anti virus].
The message was not delivered.
[PEC msgid of corresponding PEC transport envelope]
All the information necessary for the construction of such a PEC notification can be obtained from the correlated virus detected PEC notification.
The same certification data is inserted in an XML file and added to the notification message to allow for automatic checks (section 4.4).
Parsing MUST be done on the XML part only.
Additional parts MAY be included by the provider for provider specific services.
The reason the transaction was not completed MUST be specified in the message, which MUST follow the format described in section 4.3.
Checks on Incoming Messages When a message arrives at the Delivery Point, the system verifies:  message type  whether or not a PEC notification has to be returned.
A delivery PEC notification is issued only after a correct PEC transport envelope (sections 2.2.2 and 3.1.5) has been delivered to the recipient's mailbox.
In all other cases (e.g., PEC anomaly envelopes, PEC notifications), the delivery PEC notification is not issued.
Regardless, the message received at the Delivery Point MUST be delivered to the recipient's mailbox unchanged.
This notification tells the user that his/her message has been successfully delivered to the specified recipient.
It includes readable text that certifies the date and time of delivery, sender and receiver data, and the subject.
It also contains an XML certification data file and other optional parts for functionalities offered by the provider.
The following fields are inserted in the header:
avvenuta consegna Date: [delivery date] Subject: CONSEGNA: [original subject]
The value of the "X TipoRicevuta:" header field in the PEC transport envelope is derived from the original message, thus allowing the sender to determine the type of delivery PEC notification requested from the primary recipients of the original message.
The notification MUST follow the format described in section 4.3.
This is the default value for delivery PEC notifications.
When no value for "X TipoRicevuta:" is specified, or when it contains the value "completa" (complete), the system will require a complete delivery PEC notification from addressees in the "To:" field, while a concise PEC notification (section 3.3.2.3) will be required from those in the "Cc:" field.
The distinction between primary recipients and those in carbon copy is done through an analysis of the "To:" and "Cc:" fields.
For PEC notifications sent on behalf of primary recipients, a complete copy of the original message along with any attachments is inserted in the notification.
In case the system in charge of delivery is not able to determine the recipient type due to ambiguity problems in the "To:" and "Cc:" fields, delivery MUST be considered as if addressed to a primary recipient and include the complete copy of the original message.
The notification body contains a readable text part that relates certification data according to the following model:
Delivery PEC notification On [date] at [time] ([time zone]), the message "[subject]" originating from "[original sender]" and addressed to "[recipient]" was placed in the destination's mailbox.
[PEC msgid of corresponding PEC transport envelope]
The same certification data is inserted in an XML file and added to the notification (section 4.4), along with any other parts that MAY be inserted by the provider for provider specific services.
Parsing MUST be done on the XML part only.
The delivery PEC notification MUST be issued on behalf of every recipient of the message, and MUST follow the format described in section 4.3.
In order to decrease the amount of data flowing, it is possible for the sender to ask for a delivery PEC notification in "brief" format.
The brief delivery PEC notification contains the original message and a ciphered hash value for each of its parts.
The hash value SHOULD be calculated on base64 encoded parts.
As specified in section 5.3, PEC messages MUST transit only on machines that belong to the PEC network and that MUST NOT alter the encoding of the message during its transition/processing.
Even though PEC uses these relaxed specifications, PEC interoperability tests between over 20 service providers have never revealed any problems.
This is probably due to mail servers leaning more towards leaving the messages they receive intact without applying any changes.
But issues might arise if a server decides to modify encoded parts; for example, change the base64 line length, whose hash value calculated at the receiver's end would then differ from that at the sender's side.
To be able to verify the transmitted contents it is necessary for the sender to keep the unaltered original copy of the part(s) to which the hash values refer.
If the PEC transport envelope contains the header:
X TipoRicevuta: breve the Delivery Point emits a brief delivery PEC notification on behalf of the primary recipients, and a concise one (section 3.3.2.3) on behalf of carbon copy recipients.
The value of the header field in the PEC transport envelope is derived from the original message.
The notification body contains a readable text part according to a model that relates the following certification data: Brief delivery PEC notification
([time zone]), the message "[subject]" originating from "[original sender]" and addressed to "[recipient]" was placed in the destination's mailbox.
[PEC msgid of corresponding PEC transport envelope]
The same certification data is inserted in an XML file and added to the notification (section 4.4), along with other parts that MAY be included for specific provider supplied services.
Parsing MUST be done on the XML part only.
The delivery PEC notification is issued on behalf of every recipient of the message, and MUST follow the format described in section 4.3.
The MIME structure of the original message is unaltered as it is added to the notification, but each MIME part with a "name" parameter in the header field "Content Type:" or a "filename" parameter in the header field "Content Disposition:" MUST be substituted by a text file containing that MIME part's hash value.
When the original message has an S/MIME format, it is necessary not to alter the integrity of the message structure.
Verification of the S/MIME part in the original message takes place when the MIME type of the top level entity (which coincides with the message itself) is checked.
An S/MIME message MAY have the following MIME types (as per [SMIMEV3]):
an original message signed by the sender using the structure described in [MIME SECURE].
The message is made up of two MIME parts: the first is the message itself before the application of the sender's signature, whereas the second contains signature data.
The second part (generally of type "application/pkcs7 signature" or "application/x pkcs signature") contains data added during the signing phase and MUST be left unchanged to avoid compromising the overall message structure;  "application/pkcs7 mime" or "application/x pkcs7 mime"
The message is composed of a sole CMS object within the MIME part.
Given that attachments cannot be separated from the CMS object, the MIME part is left intact (i.e., it is not replaced by the hash value); therefore, the brief PEC notification is the same as the complete PEC notification.
If the original message contains parts whose "Content Type:" is "message/rfc822", i.e., contains an email message as attachment, the entire attached message is substituted with its corresponding hash value.
Therefore, when emitting a brief delivery PEC notification, the provider MUST:
1. identify and extract all the parts from the first MIME part of the multipart/signed S/MIME message; 2.
calculate the hash values of all the files attached by the sender to the original message; 3.
substitute originals with their hash values.
In general, in the case of original messages in S/MIME format, the copy of the message inserted within the brief delivery PEC notification will have the following characteristics:  if the original message is signed, the S/MIME structure and signature relative data will remain unchanged.
The message will generate an error in a future signature integrity verification phase following the substitution of attachments with the corresponding hash values.
if the original message contains the "application/pkcs7 mime" or "application/x pkcs7 mime" MIME type, attachments present in the message will not be substituted by their hash values, due to impossibility of identification within a CMS structure.
The content of the brief delivery PEC notification will coincide with that of a normal delivery PEC notification.
The algorithm used for hash calculation is the [SHA1], calculated on the entire content of the part.
To allow distinction between hash files and the files to which they refer, the suffix ".hash" is added to the original filename.
The hash value is written in the file using a hexadecimal representation as a single sequence of 40 characters.
The MIME type of these attachments is set to "text/plain" to highlight their textual nature.
If the PEC transport envelope contains the header:
X TipoRicevuta: sintetica the Delivery Point emits, both to primary and carbon copy recipients, a concise delivery PEC notification that does not contain the original message.
The message body of the notification contains a readable text part according to a model that relates the following certification data:
([time zone]), the message "[subject]" originating from "[original sender]" and addressed to "[recipient]" was placed in the destination's mailbox.
[PEC msgid of corresponding PEC transport envelope]
The same certification data is inserted within an XML file and added to the notification (section 4.4), along with additional parts that MAY be included for provider specific services.
Parsing MUST be done on the XML part only.
The notification is sent to each one of the recipients to whom the message is delivered, and MUST follow the format described in section 4.3.
The concise delivery PEC notification follows the same emission rules as the delivery PEC notification; added to it is only the XML file containing the certification data, not the original message.
If an error occurs during the delivery of a correct PEC transport message, the system returns to the sender a non delivery PEC notification that indicates the error condition.
The header will contain the following fields:
errore consegna Date: [date of notification emission]
The notification body contains a readable text part according to a model that relates the following data:
([time zone]), in the message "[subject]" originating from "[original sender]" and addressed to "[recipient]"
an error was detected [brief error description].
The message was refused by the system.
[PEC msgid of corresponding PEC transport envelope]
The same certification data is inserted within an XML file and added to the notification in order to allow for automatic checks (section 4.4).
Parsing MUST be done on the XML part only.
Additional parts MAY be included by the PEC provider for provider specific services.
The notification MUST follow the format described in section 4.3.
Sender and Receiver Belonging to the Same Domain PEC messages MUST be processed even if both sender and receiver(s) belong to the same PEC domain.
Example: Complete Transaction between Two PEC Domains
A correct transaction between two PEC domains goes through the following steps:
The sending user sends an email to his provider's Access Point;  The Access Point runs all checks and emits a server user acceptance PEC notification to the user;
The Access Point creates a PEC transport envelope and forwards it to the Incoming Point of the receiving provider;  The receiver's Incoming Point verifies the PEC transport envelope and creates a server server acceptance PEC notification to be sent to the sending provider;  The sender's Incoming Point verifies the validity of the server  server acceptance PEC notification and forwards it to the Delivery Point;  The sender's Delivery Point saves the server server acceptance PEC notification in the provider's service mailbox;
The receiver's Incoming Point forwards the PEC transport envelope to the receiver's Delivery Point;  The receiver's Delivery Point verifies the contents of the PEC transport envelope and saves it in the recipient's mailbox;
The receiver's Delivery Point creates a delivery PEC notification and sends it to the sender's Incoming Point;  The sender's Incoming Point verifies the validity of the delivery PEC notification and forwards it to the sender's Delivery Point;  The sender's Delivery Point saves the delivery PEC notification in the sending user's mailbox;
The receiving user has the message at his disposition.
Some of these steps might occur in parallel, thus the interaction might complete in a different order.
Temporal indications supplied by the service in readable format (text in PEC notifications, transport envelopes, etc.) are provided with reference to the legal time at the moment of the operation.
Following is the specification using the syntax description notation defined in [ABNF].
01 28, 01 29, 01 30, 01 31 based on ; month/year time hour
2DIGIT  ; 00 58, 00 59, 00
based on leap second ;
partial time time offset NOTE:
For number of days in a month, leap year, and leap second restrictions see section 5.7 of [TIMESTAMP].
Format of a PEC Message Body
This section describes the characteristics of the various components of PEC messages and notifications generated by a PEC system.
If one of the message parts contains characters with values outside of the range 0
127 (7 bit ASCII), that part will have to be adequately encoded so that 7 bit transportation compatibility is guaranteed (e.g., quoted printable, base64 as per [MIME1]).
Before applying the signature, the message body has Content Type: multipart/mixed.
Each part is described in the sections below.
The first part is the user readable text generated by the PEC system, while the second and third parts are interchangeable in order and contain the original message and the XML file for the certification data.
User Readable Text Character set: ISO 8859 1
The multipart/alternative MIME type MAY be used to add an HTML version of the body of system generated messages.
In this case, two sub parts MUST be present: one of type text/plain, the other text/html.
For the HTML part:  it MUST contain the same information as related in the text part;  it MUST NOT contain references to elements (e.g., images, sounds, font, style sheets), neither internal to the message (added MIME parts) nor external (e.g., hosted on the provider's server);
it MUST NOT have active content (e.g., JavaScript, VBscript,
Original Message MIME type: message/rfc822 Attachment name: postacert.eml 4.3.3.
Certification Data Character set: UTF 8 MIME type: application/xml Attachment name: certdata.xml 4.4.
Certification Data Scheme Following is the DTD relative to the [XML] file that contains certification data attached to PEC notifications.
tipo" indicates the typology of the PEC message  <!
non accettazione   presa in carico   avvenuta consegna   posta certificata
errore consegna   preavviso errore consegna   rilevazione virus)
#REQUIRED errore (nessuno   no dest
Header of the original message
ELEMENT intestazione (mittente, destinatari , risposte, oggetto?)
Sender ("From:" field) of the original message  <!
Value of the "Reply To:" field of the original message  <!
Value of the "Subject:" field of the original message  <!
ELEMENT dati (gestore emittente, data, identificativo, msgid?
, ricezione , errore esteso?)
ATTLIST data zona CDATA #REQUIRED> <!
Day in "dd/mm/yyyy" format  <!
msgid of the original message before modifications  <!
virus detection, and timeout PEC notifications  <!
Recipient address to which delivery has been carried
For server server acceptance PEC notifications  <!
recipients for whom it is the relative PEC notification  <!
In case of error  <!
brief description of the error  <!
ELEMENT errore esteso (#PCDATA)> 4.5.
The PEC providers directory is created through a centralized LDAP server that contains the providers' data and their corresponding PEC mail domains.
The following are the directory scheme's attributes: providerCertificateHash: hash of provider's certificate providerCertificate:
provider reception email address managedDomains: managed domains LDIFLocationURL:
provider LDIF record URL providerUnit: secondary operating environment name
The directory's base root is "o postacert" and
the "DistinguishedName" of single records is of the type "<providerName
Search within the directory is carried out mainly in case sensitive mode using the "providerCertificateHash" attribute (during envelope signature verification phase) or the "managedDomains" attribute (during message acceptance phase).
It is possible for the record of a single provider to contain multiple "providerCertificate" attributes with the related "providerCertificateHash" attributes in order to allow the handling of the renewal of expiring certificates.
The provider MUST make sure to update its record with sufficient advance before the certificate expiration date, by adding a new certificate whose validity overlaps that of the previous one.
The data of all PEC providers is encompassed in a [LDIF] file, which is available as an [HTTPS] object and can be found at the URL to which the 'LDIFLocationURL' attribute in the "dn: o postacert" record points (see section 4.5.6).
To guarantee authenticity, that file MUST be signed by the provider for the operations regarding its PEC services using the method described for single providers.
The file, the signature, and the X.509v3 certificate MUST be inserted in a PKCS#7 structure in binary ASN.1 DER format as a file with ".p7m" extension.
The centralized [LDAP] system downloads that file on a daily basis and, after suitable verifications of the signature, applies it to the provider's record.
Through the [LDIF] file, single providers MUST keep a copy of the directory locally, updated on a daily basis, in order to improve system performance by avoiding continuous request dispatches to the central system for every message elaboration phase.
If secondary environments are present, the [LDIF] file indicated in the main environment's record MUST relate the contents of all the provider relevant records.
This specification uses an unregistered LDAP DN name space that may lead to conflict with other registered or unregistered names.
The 'providerCertificateHash' attribute is a hexadecimal representation of the hash in SHA1 format of the X.509v3 certificate used by the provider for PEC notifications and envelope signatures.
( 1.3.6.1.4.1.16572.2.2.1  NAME 'providerCertificateHash' DESC 'Hash SHA1 of X.509 certificate in hexadecimal format' EQUALITY
The IA5String ( 1.3.6.1.4.1.1466.115.121.1.26 ) syntax is defined in [LDAP SYNTAXES].
The 'providerCertificate' attribute holds a set of certificate(s) used by the provider to sign PEC notifications and transport envelopes.
( 1.3.6.1.4.1.16572.2.2.2  NAME 'providerCertificate' DESC 'X.509 certificate in ASN.1 DER binary format' SYNTAX 1.3.6.1.4.1.1466.115.121.1.8 )
The Certificate syntax ( 1.3.6.1.4.1.1466.115.121.1.8 ) is defined in [RFC4523].
As required by this attribute type's syntax, values of this attribute are requested and transferred using the attribute description "providerCertificate;binary" [RFC4522].
The 'providerName' attribute contains the name of the PEC provider.
All records MUST contain their provider's name in this attribute.
' DESC 'PEC provider name' EQUALITY caseIgnoreMatch SUBSTR caseIgnoreSubstringsMatch SYNTAX 1.3.6.1.4.1.1466.115.121.1.15 SINGLE VALUE )
The Directory String ( 1.3.6.1.4.1.1466.115.121.1.15 ) syntax is defined in [LDAP SYNTAXES].
The 'mailReceipt' attribute contains the provider's email address within the provider to which server server acceptance and virus detection PEC notifications are sent.
( 1.3.6.1.4.1.16572.2.2.4 NAME 'mailReceipt' DESC 'E mail address of the service mailbox'
The IA5String ( 1.3.6.1.4.1.1466.115.121.1.26 ) syntax is defined in [LDAP SYNTAXES].
The 'managedDomains' attribute holds a set of domains [SMTP] that are handled by a PEC provider.
Domains are limited to dot atom form ([RFC1034], [EMAIL]).
( 1.3.6.1.4.1.16572.2.2.5 NAME 'managedDomains' DESC 'Domains handled by the PEC provider' EQUALITY
The IA5String ( 1.3.6.1.4.1.1466.115.121.26 ) syntax is defined in [LDAP SYNTAXES].
The 'managedDomains' attribute holds a set of domains [SMTP] that are handled by a PEC provider.
Domains are limited to dot atom form ([RFC1034], [EMAIL]).
The 'LDIFLocationURL' attribute contains an [HTTPS] URL that points to the location of the [LDIF] file defining the provider's record.
When the attribute is present in the record "dn: o postacert", then it contains the definition of the entire directory in [LDIF] format.
The LDIF file will have a MIME type of application/pkcs7 mime, with the parameter smime type/signed data.
The LDIF file is encoded using the UTF 8 character set.
Secondary environment records MUST NOT contain the 'LDIFLocationURL' attribute which is obtained from the main environment's attributes for all records connected to the provider.
( 1.3.6.1.4.1.16572.2.2.6 NAME 'LDIFLocationURL' DESC 'URL of the LDIF file that defines the entry' EQUALITY caseExactMatch SYNTAX 1.3.6.1.4.1.1466.115.121.1.15
The Directory String ( 1.3.6.1.4.1.1466.115.121.1.15 ) syntax is defined in [LDAP SYNTAXES].
The 'providerUnit' attribute contains the name of secondary operating environments   an attribute not present for the main environment.
It is possible for the provider to define several distinct records, each indicating a single, different, secondary operating environment, for which it is possible to declare specific attributes that are, if need be, distinct from those relative to the main and other environments.
The "DistinguishedName" of the records relative to the secondary operating environments are of the type "<providerUnits <environment>,providerName <name>,o postacert>".
Every provider MUST have a record associated to its own main environment, distinguishable for the absence of the "providerUnit" attribute within the record and the DistinguishedName.
( 1.3.6.1.4.1.16572.2.2.7 NAME 'providerUnit' DESC 'Name of the secondary operative environment' EQUALITY caseIgnoreMatch SUBSTR caseIgnoreSubstringsMatch SYNTAX 1.3.6.1.4.1.1466.115.121.1.15 SINGLE VALUE )
The Directory String ( 1.3.6.1.4.1.1466.115.121.1.15 ) syntax is defined in [LDAP SYNTAXES].
The schema definition of the 'LDIFLocationURLObject' object class: ( 1.3.6.1.4.1.16572.2.1.1 NAME 'LDIFLocationURLObject' SUP top AUXILIARY MAY ( LDIFLocationURL ) )
The schema definition of the 'provider' object class: ( 1.3.6.1.4.1.16572.2.1.2 NAME 'provider' SUP top STRUCTURAL MUST ( providerCertificateHash providerCertificate providerName mailReceipt managedDomains )
MAY ( description LDIFLocationURL providerUnit ) 4.5.10.
The following LDIF file represents an example of a providers' directory, containing a base root and two fictitious providers.
The inserted certificates are two self signed certificates used for example purposes only: dn: o postacert objectclass: top objectclass:
Base root for the PEC providers directory dn: providerName Anonymous Certified Mail
S.p.A.,o postacert objectclass: top objectclass:
provider providerName: Anonymous Certified Mail
Certified mail services for companies
xpIFMuci5sLjEPMA0GA1UECxMGRC5DLkMuMS0wKwYJKoZIhvcNAQkBFh5w b3N0YS1jZXJ0aWZpY2F0YUBzZXJwb3N0YWwuaXSCAQAwDAYDVR0TBAUwAw EB/zANBgkqhkiG9w0BAQQFAAOBgQApqeXvmOyEjwhMrXezPAXELMZwv4qq r5ri4XuxTq6sS9jRsEbZrS NmbcJ7S7eFwNQMNxYFVJqdWoLh8qExsTLXn
Certified mail services for the public
The following LDIF file represents an example of a PEC providers' directory, containing a base root and two fictitious providers, the first of which handles a secondary environment as well.
The certificates inserted are two self signed certificates used for example purposes only: dn: o postacert objectclass: top objectclass:
Base root for the PEC providers directory dn: providerName Anonymous Certified Mail
S.p.A.,o postacert objectclass: top objectclass:
provider providerName: Anonymous Certified Mail
cert.company.example.com managedDomains: costmec.example.com description: Certified mail services for companies
: providerUnit Secondary Environment, providerName Anonymous Certified Mail
S.p.A.,o postacert objectclass: top objectclass:
,o postacert objectclass: top objectclass:
r5ri4XuxTq6sS9jRsEbZrS NmbcJ7S7eFwNQMNxYFVJqdWoLh8qExsTLXn sKycPSnHbCfuphrKvXjQvR2da75U4zGSkroiyvJ2s9TtiCcT3lQtIjmvrF baSBiyzj za7foFUCQmxCLtDaA
receivedmail.example.com description: Certified mail services for the public 5.
It is recommended that a dedicated hardware module be used to handle private key and signature operations, the specifications of which are outside the scope of this document.
It's up to the PEC providers to conform to security requisites expected for the service.
Authentication User access to PEC services through the Access Point MUST be allowed only upon successful user authentication on the system.
For example, authentication might use user ID and password, or, if available and considered necessary for the type of service provided, an electronic ID card or the national services card.
Choice of authentication method is left to the better judgment of the service provider.
Authentication is necessary to guarantee as much as possible that the message is sent by a PEC user whose identification data is congruent with the specified sender, so as to avoid falsification of the latter.
To guarantee that the original message remains unaltered during transaction, envelopment and signature are applied on outgoing messages at the Access Point, and subsequent verification of incoming messages is done at the Incoming Point.
All communications within the PEC network MUST use secure channels.
Integrity and confidentiality of connections between PEC provider and user MUST be guaranteed through the use of secure protocols, such as those based on [TLS] and those that create a secure transport channel on which non secure protocols can transmit (e.g., IPsec).
The interaction between providers MUST take place using SMTP on [TLS], as per [SMTP TLS].
The Incoming Point MUST provide and announce its support for the STARTTLS extension, as well as accept both unencrypted connections (for ordinary mail) and protected ones.
To guarantee complete traceability in the flow of PEC messages, these MUST NOT transit on systems external to the PEC network.
When exchanging messages between different providers, all transactions MUST take place between machines that belong to the PEC network or are directly managed by the provider.
An "MX" type record MAY be associated to each PEC domain defined within the system for name resolution, in which case secondary reception systems specified in that record
MUST be under direct control of the provider.
All in conformance with [SMTP].
Another important security aspect that concerns the PEC system, is related to the technical and functional architecture that MUST block the presence of viruses from endangering the security of all handled messages.
It is therefore REQUIRED to have installations and continuous updates of anti virus systems
that hinder infections as much as possible without intervening on the content of the certified mail, in compliance with what has been discussed thus far.
In this document the S/MIME certificate profile is defined for use in the certification of PEC messages done by the providers.
The proposed profile of the S/MIME certificate is based on the IETF standards [SMIMECERT] and [CRL], which in turn are based on the standard ISO/IEC 9594 8:2001.
The information related to the PEC provider holder of the certificate MUST be inserted in the Subject field (Subject DN).
More precisely, the Subject DN MUST contain the PEC provider's name as it is in the "providerName" attribute published in the PEC providers directory (section 4.5), but the Subject DN does not have to match the Provider entry DN in the LDIF.
The providerName MUST be present in the CommonName or OrganizationName attributes of the "Subject:" field in the certificate.
Certificates MUST contain an Internet mail address, which MUST have a value in the subjectAltName extension, and SHOULD NOT be present in the Subject Distinguished Name.
Valid subjectDN are: C IT, O AcmePEC
, CN Posta Certificata C IT, O ServiziPEC
, CN Posta Certificata Valorization of other attributes in the Subject DN, if present, MUST be done in compliance with [CRL].
Certificate Extensions Extensions that MUST be present in the S/MIME certificate are:  Key Usage  Authority Key Identifier  Subject Key Identifier  Subject Alternative Name
The Basic Constraints extension (Object ID:2.5.29.19) MUST NOT be present.
The valorization of the above listed extensions for the described profile follows.
The Key Usage extension (Object ID: 2.5.29.15) MUST have the digitalSignature bit (bit 0) activated and MUST be marked as critical.
The extension MAY contain other active bits corresponding to different Key Usage, as long as that doesn't contrast with the indications in [CRL].
(Object ID: 2.5.29.35) MUST contain at least the keyIdentifier field and MUST NOT be marked as critical.
The Subject Key Identifier extension
(Object ID: 2.5.29.14) MUST contain at least the keyIdentifier field and MUST NOT be marked as critical.
(Object ID: 2.5.29.17) MUST contain at least the rfc822Name field and MUST NOT be marked as critical.
Adding other extensions that have not been described in this document is to be considered OPTIONAL, as long as it remains compliant with [CRL]; such added extensions MUST NOT be marked as critical.
Example Following is an example of an S/MIME certificate compliant with the minimal requisites described in this profile.
Values used are of fictitious providers generated for example purposes only.
General Use Certificate in Annotated Version
An asterisk near the label of an extension means that such an extension has been marked as critical.
id sha1 with rsa encryption PARAMETER: 0 ISSUER:
Certifier 1 Organizational Unit Name:
Certification Service Provider Common Name:
Not Before: Oct 5, 04 09:04:23 GMT
Not After: Oct 5, 05 09:04:23
Certified Mail PUBLIC KEY: (key size is 1024 bits)
posta certificata@acmepec.it Key Usage :
Digital Signature Authority Key Identifier: 0x12345678 aaaaaaaa bbbbbbbb cccccccc dddddddd Subject Key Identifier:
id sha1 with rsa encryption PARAMETER: 0 VALUE: 0x874b4d25
70a46180 c9770a85 fe7923ce b22d2955 2f3af207 142b2aba
General Use Certificate in Dump
OBJECT IDENTIFIER commonName (2 5 4 3) 110 13  23:
countryName (2 5 4 6)
organizationName (2 5 4 10)
commonName (2 5 4 3) 216 13
1 2 840 113549 1 1 1
} 253 03  141:  BIT STRING 0 unused bits :
63 19 8A AA 9B :
AC 3F 1B 29 B5 BE 7F
69 19 45 89 D0 15
CD 10 74 1D 76 4E
71 14 E7 69 42 BE 1C
4D 74 76 DD 0B B5 78 4F 1E 84 DD B4 86 7F 96 DF :
5E 7B AF 0E CE EA
OBJECT IDENTIFIER subjectAltName (2 5 29 17)
74 61 2D 63 65 72 74 69 66 :
69 63 61 74 61 40 61 63 6D 65
70 65 63 2E 69 74
SEQUENCE { 460 06  3:  OBJECT IDENTIFIER authorityKeyIdentifier (2 5 29 35)
30 16 11 11 11 11 AA AA AA AA AA
subjectKeyIdentifier (2 5 29 14)
04 14 3A FA E0 80 64 53 52 7A 3E 57 09 D8 49 A9 :
522 30  13: SEQUENCE { 524 06  9
4D 25 70 A4 61 80 C9 77
C6 71 7F 3A 1C 80 7F 15 B3 D6 1E
The contents of the PEC providers directory MUST be queried via [HTTP] on a Secure Socket Layer (SSL), as described in [TLS], exclusively by licensed providers that have the necessary user certificates; this access modality guarantees authenticity, integrity, and confidentiality of data.
Each provider downloads the LDIF file through an [HTTPS] session, which is authenticated by checking the X.509 certificate issued by a certification authority.
PEC System Client Technical and Functional Prerequisites
This section lists the prerequisites that must be respected by a client in order to guarantee the minimal operative functionalities to the user of a general PEC system:  handling of Access and Delivery Points through secure channels;  handling of user authentication in message dispatch and reception which make use of standard protocols, such as [IMAP], [POP3], and [HTTP];  support for MIME format according to [MIME1] and [MIME5];  support for "ISO 8859 1 (Latin 1)" character set;  support for S/MIME v3 standard, as in [SMIMEV3], for verification of signatures applied to PEC envelopes and notifications.
All security considerations from [CMS] and [SMIMEV3] apply to applications that use procedures described in this document.
The centralized LDAP server is a critical point for the security of the whole PEC system.
An attack could compromise the whole PEC system.
PEC providers that periodically download the LDIF file SHOULD use the best security technology to protect it from local attacks.
A PEC provider could be compromised if an attacker changed a certificate or modified the list of domains associated to it in the LDIF file that was copied to the PEC provider system.
When verifying the validity of the signature of a message, the recipient system SHOULD verify that the certificate included in the [CMS] message is present in the LDIF file (section 4.5) and that the domain extracted by the [EMAIL] "From:" header is listed in the managedDomains attribute associated to said certificate.
Registration of PEC Message Header Fields
This document defines new header fields used in the messages that transit in the PEC network.
As specified and required by [HEADERS IANA], this document registers new header fields as Provisional Message Header Fields as follows.
Applicable protocol: mail [EMAIL] Status: provisional Author/Change controller:
Claudio Petrucci DigitPA Viale Carlo Marx 31/49 00137
PETRUCCI@digitpa.gov.it Specification document: this document, section 2.2.1, Appendix A. 8.1.2.
Applicable protocol: mail [EMAIL] Status: provisional Author/Change controller:
Claudio Petrucci DigitPA Viale Carlo Marx 31/49 00137
PETRUCCI@digitpa.gov.it Specification document: this document, sections 2.1.1.1.1, 3.1.2, 3.1.3, 3.1.4, 3.1.6, 3.2.1, 3.2.3, 3.2.4, 3.3.2, 3.3.3, Appendix A. 8.1.3.
Applicable protocol: mail [EMAIL] Status: provisional Author/Change controller:
Claudio Petrucci DigitPA Viale Carlo Marx 31/49 00137
PETRUCCI@digitpa.gov.it Specification document: this document, sections 2.1.1.1.3, 3.1.3, 3.2.4, Appendix A. 8.1.4.
Applicable protocol: mail [EMAIL] Status: provisional Author/Change controller:
Claudio Petrucci DigitPA Viale Carlo Marx 31/49 00137
PETRUCCI@digitpa.gov.it Specification document: this document, sections 3.1.5, 3.2.2, Appendix A. 8.1.5.
Applicable protocol: mail [EMAIL] Status: provisional Author/Change controller:
Claudio Petrucci DigitPA Viale Carlo Marx 31/49 00137
PETRUCCI@digitpa.gov.it Specification document: this document, sections 3.1.5, 3.3.2, 3.3.2.1, 3.3.2.2, 3.3.2.3, Appendix A. 8.1.6.
X Mittente: Applicable protocol: mail [EMAIL] Status: provisional Author/Change controller:
Claudio Petrucci DigitPA Viale Carlo Marx 31/49 00137
PETRUCCI@digitpa.gov.it Specification document: this document, sections 3.2.3, Appendix A. 8.2.
Registration of LDAP Object Identifier Descriptors
This document defines new LDAP attributes and object classes for object identifier descriptors.
As specified and required by [LDAP IANA], this document registers new descriptors as follows per the Expert Review.
Registration of Object Classes and
Request for LDAP Descriptor Registration Descriptor (short name):
See comments Person & email address to contact for further information: See "Author/Change Controller" Usage: See comments Specification: (I D)
Claudio Petrucci DigitPA Viale Carlo Marx 31/49 00137
The following object identifiers and associated object classes/ attribute types are requested to be registered.
Attribute Type Appendix A.  Italian Fields and Values in English NOTE:
The right column represents a translation of the Italian fields for readability's sake only.
Header fields that MUST be used are the ones in the left column.
VIRUS DETECTION INDUCED NON per virus
TO VIRUS PEC per virus
TO TIMEOUT PEC per sup.
