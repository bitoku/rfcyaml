- title: __initial_text__
  contents:
  - '              Ingress Replication Tunnels in Multicast VPN

    '
- title: Abstract
  contents:
  - "Abstract\n   RFCs 6513, 6514, and other RFCs describe procedures by which a\n\
    \   Service Provider may offer Multicast VPN (MVPN) service to its\n   customers.\
    \  These procedures create point-to-multipoint (P2MP) or\n   multipoint-to-multipoint\
    \ (MP2MP) trees across the Service Provider's\n   backbone.  One type of P2MP\
    \ tree that may be used is known as an\n   \"Ingress Replication (IR) tunnel\"\
    .  In an IR tunnel, a parent node\n   need not be directly connected to its child\
    \ nodes.  When a parent\n   node has to send a multicast data packet to its n\
    \ child nodes, it\n   does not use Layer 2 multicast, IP multicast, or MPLS multicast\
    \ to do\n   so.  Rather, it makes n individual copies, and then unicasts each\n\
    \   copy, through an IP or MPLS unicast tunnel, to exactly one child\n   node.\
    \  While the prior MVPN specifications allow the use of IR\n   tunnels, those\
    \ specifications are not always very clear or explicit\n   about how the MVPN\
    \ protocol elements and procedures are applied to IR\n   tunnels.  This document\
    \ updates RFCs 6513 and 6514 by adding\n   additional details that are specific\
    \ to the use of IR tunnels.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This\
    \ document is a product of the Internet Engineering Task Force\n   (IETF).  It\
    \ represents the consensus of the IETF community.  It has\n   received public\
    \ review and has been approved for publication by the\n   Internet Engineering\
    \ Steering Group (IESG).  Further information on\n   Internet Standards is available\
    \ in Section 2 of RFC 7841.\n   Information about the current status of this document,\
    \ any errata,\n   and how to provide feedback on it may be obtained at\n   http://www.rfc-editor.org/info/rfc7988.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2016 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (http://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.  Code Components\
    \ extracted from this document must\n   include Simplified BSD License text as\
    \ described in Section 4.e of\n   the Trust Legal Provisions and are provided\
    \ without warranty as\n   described in the Simplified BSD License.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1.  Introduction  . . . . . . . . . . . . . . . . . . .\
    \ . . . . .   3\n   2.  What is an IR P-tunnel? . . . . . . . . . . . . . . .\
    \ . . . .   5\n   3.  How are IR P-tunnels identified?  . . . . . . . . . . .\
    \ . . .   7\n   4.  How to Join an IR P-Tunnel  . . . . . . . . . . . . . . .\
    \ . .   9\n     4.1.  Advertised IR P-Tunnels . . . . . . . . . . . . . . . .\
    \ .   9\n       4.1.1.  If the Leaf Information Required Bit Is Set . . . . .\
    \  10\n       4.1.2.  If the Leaf Information Required Bit Is Not Set . . .  10\n\
    \     4.2.  Unadvertised IR P-Tunnels . . . . . . . . . . . . . . . .  11\n  \
    \ 5.  The PTA's Tunnel Identifier Field . . . . . . . . . . . . . .  11\n   6.\
    \  A Note on IR P-Tunnels and Discarding Packets from the Wrong\n       PE  .\
    \ . . . . . . . . . . . . . . . . . . . . . . . . . . . .  12\n   7.  The PTA's\
    \ MPLS Label Field  . . . . . . . . . . . . . . . . .  14\n     7.1.  Leaf A-D\
    \ Route Originated by an Egress PE . . . . . . . .  14\n     7.2.  Leaf A-D Route\
    \ Originated by an Intermediate Node . . . .  16\n     7.3.  Intra-AS I-PMSI A-D\
    \ Route . . . . . . . . . . . . . . . .  17\n   8.  How A Child Node Prunes Itself\
    \ from an IR P-Tunnel  . . . . .  17\n   9.  Parent Node Actions upon Receiving\
    \ Leaf A-D Route . . . . . .  18\n   10. Use of Timers When Switching UMH  . .\
    \ . . . . . . . . . . . .  19\n   11. Security Considerations . . . . . . . .\
    \ . . . . . . . . . . .  20\n   12. References  . . . . . . . . . . . . . . .\
    \ . . . . . . . . . .  21\n      12.1. Normative References . . . . . . . . .\
    \ . . . . . . . . .  21\n      12.2. Informative References . . . . . . . . .\
    \ . . . . . . . .  21\n   Acknowledgments . . . . . . . . . . . . . . . . . .\
    \ . . . . . . .  23\n   Authors' Addresses  . . . . . . . . . . . . . . . . .\
    \ . . . . . .  23\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   RFCs 6513, 6514, and other RFCs describe procedures by which\
    \ a\n   Service Provider (SP) may offer Multicast VPN (MVPN) service to its\n\
    \   customers.  These procedures create point-to-multipoint (P2MP) or\n   multipoint-to-multipoint\
    \ (MP2MP) tunnels, called \"P-tunnels\"\n   (provider tunnels), across the SP's\
    \ backbone network.  Customer\n   multicast traffic is carried through the P-tunnels.\n\
    \   A number of different P-tunnel technologies are supported.  One of\n   the\
    \ supported P-tunnel technologies is known as \"ingress replication\"\n   or \"\
    unicast replication\".  We will use the acronym \"IR\" to refer to\n   this P-tunnel\
    \ technology.\n   An IR P-tunnel is a P2MP tree, but a given node on the tree\
    \ is not\n   necessarily directly attached to its parent node or to its child\n\
    \   nodes.  To send a multicast data packet from a parent node to one of\n   its\
    \ child nodes, the parent node encapsulates the packet and then\n   unicasts it\
    \ through a tunnel to the child node.  The tunnel may be a\n   P2P or MP2P MPLS\
    \ LSP (Label Switched Path) or a unicast IP tunnel.\n   If a node on an IR tree\
    \ has n child nodes, and has a multicast data\n   packet that must be sent along\
    \ the tree, the parent node makes n\n   individual copies of the data packet,\
    \ and then sends each copy,\n   through a unicast tunnel, to exactly one child\
    \ node.  No lower-layer\n   multicast technology is used when sending traffic\
    \ from a parent node\n   to a child node; therefore, multiple copies of the packet\
    \ may be sent\n   out a single interface.\n   With the single exception of IR,\
    \ the P-tunnel technologies supported\n   by the MVPN specifications are preexisting\
    \ IP multicast or MPLS\n   multicast technologies.  Each such technology has its\
    \ own set of\n   specifications, its own setup and maintenance protocols, its\
    \ own\n   syntax for identifying specific multicast trees, and its own\n   procedures\
    \ for enabling a router to be added to or removed from a\n   particular multicast\
    \ tree.  For IR P-tunnels, on the other hand,\n   there is no prior specification\
    \ for setting up and maintaining the\n   P2MP trees; the procedures and protocol\
    \ elements used for setting up\n   and maintaining the P2MP trees are specified\
    \ in the MVPN\n   specifications themselves, and all the signaling/setup is done\
    \ by\n   using the BGP Auto-Discovery (A-D) routes that are defined in\n   [RFC6514].\
    \  (The unicast tunnels used to transmit multicast data from\n   one node to another\
    \ in an IR P-tunnel may of course have their own\n   setup and maintenance protocols,\
    \ e.g., [RFC5036], [RFC3209].)\n   Since the transmission of a multicast data\
    \ packet along an IR\n   P-tunnel is done by transmitting the packet through a\
    \ unicast tunnel,\n   previous RFCs sometimes describe an IR P-tunnel as \"consisting\
    \ of\" a\n   set of unicast tunnels.  However, that description is not quite\n\
    \   accurate.  For one thing, it obscures the fact that an IR P-tunnel is\n  \
    \ really a P2MP tree, whose nodes must maintain multicast state in both\n   the\
    \ control and data planes.  For another, it obscures the fact the\n   unicast\
    \ tunnels used by a particular IR P-tunnel need not be specific\n   to that P-tunnel;\
    \ a single unicast tunnel can carry the multicast\n   traffic of many different\
    \ IR P-tunnels (and can also carry unicast\n   traffic as well).\n   In this document,\
    \ we provide a clearer and more explicit conceptual\n   model for IR P-tunnels,\
    \ clarifying the relationship between an IR\n   P-tunnel and the unicast tunnels\
    \ that are used for data transmission\n   along the IR P-tunnel.\n   Section 5\
    \ of [RFC6514] defines a BGP Path Attribute known as the\n   \"PMSI (Provider\
    \ Multicast Service Interface) Tunnel attribute\" (PTA).\n   This attribute contains\
    \ a field known as the \"Tunnel Identifier\"\n   field.  For most P-tunnel technologies,\
    \ the PTA's \"Tunnel Identifier\"\n   field is used to identify a P-tunnel (i.e.,\
    \ to identify a P2MP or\n   MP2MP tree).  However, when IR P-tunnels are used,\
    \ the PTA \"Tunnel\n   Identifier\" field does not actually identify an IR P-tunnel.\
    \  In some\n   cases, it identifies one of the P-tunnel's constituent unicast\n\
    \   tunnels; in other cases, it is not used to identify a tunnel at all.\n   In\
    \ this document, we provide an explicit specification for how IR\n   P-tunnels\
    \ are actually identified.\n   Some of the MVPN specifications specify procedures\
    \ that require a PE\n   router to join the P-tunnel that has been identified in\
    \ a particular\n   MVPN route.  However, up to now, there has not been an explicit\n\
    \   specification of how to identify an IR P-tunnel, of how a router\n   joins\
    \ such a P-tunnel, or of how a router prunes itself from such a\n   P-tunnel.\
    \  In this document, we make these procedures more explicit.\n   [RFC6514] does\
    \ provide a method for binding an MPLS label to a\n   P-tunnel, but does not discuss\
    \ the label allocation policies that are\n   needed for correct operation when\
    \ the P-tunnel is an IR P-tunnel.\n   Those policies are discussed in this document.\n\
    \   This document does not provide any new protocol elements or any\n   fundamentally\
    \ new procedures; its purpose is to make explicit just\n   how a router is to\
    \ use the protocol elements and procedures of\n   [RFC6513] and [RFC6514] to identify\
    \ an IR P-tunnel, to join an IR\n   P-tunnel, and to prune itself from an IR P-tunnel.\n\
    \   This document also discusses the MPLS label allocation policies that\n   need\
    \ to be supported when binding MPLS labels to IR P-tunnels, and\n   the timer\
    \ policies that need to be supported when switching a\n   customer multicast flow\
    \ from one IR P-tunnel to another.  These are\n   procedures that are not clearly\
    \ specified in [RFC6513] or [RFC6514].\n   As the material in this document must\
    \ be understood in order to\n   properly implement IR P-tunnels, this document\
    \ updates [RFC6513] and\n   [RFC6514].\n   This document also discusses the application\
    \ of \"seamless multicast\"\n   [RFC7524] and \"extranet\" [RFC7900] procedures\
    \ to IR P-tunnels.\n   This document does not discuss the use of IR P-tunnels\
    \ to support a\n   VPN customer's use of Bidirectional Protocol Independent Multicast\n\
    \   (BIDIR-PIM).  [RFC7740] explains how to adapt the procedures of\n   [RFC6513],\
    \ [RFC6514], and [RFC7582] so that a customer's use of\n   BIDIR-PIM can be supported\
    \ by IR P-tunnels.\n   In the event of any conflict between this document and\
    \ either\n   [RFC6513] or [RFC6514], this document takes precedence.\n   The key\
    \ words \"MUST\", \"MUST NOT\", \"REQUIRED\", \"SHALL\", \"SHALL NOT\",\n   \"\
    SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"NOT RECOMMENDED\", \"MAY\", and\n\
    \   \"OPTIONAL\", when and only when appearing in all capital letters, are\n \
    \  to be interpreted as described in [RFC2119].\n"
- title: 2.  What is an IR P-tunnel?
  contents:
  - "2.  What is an IR P-tunnel?\n   An IR P-tunnel is a P2MP tree.  Its nodes are\
    \ BGP speakers that\n   support the MVPN procedures of [RFC6514] and related RFCs.\
    \  In\n   general, the nodes of an IR P-tunnel are either Provider Edge (PE)\n\
    \   routers, Autonomous System Border Routers (ASBRs), or (if [RFC7524]\n   is\
    \ supported) Area Border Routers (ABRs).  (MVPN procedures are\n   sometimes used\
    \ to support non-MVPN, or \"global table\" multicast; one\n   way of doing this\
    \ is defined in [RFC7524].  Another way is defined in\n   [RFC7716].  In such\
    \ cases, IR P-tunnels can be used outside the\n   context of MVPN.)\n   MVPN P-tunnels\
    \ may be either \"segmented\" or \"non-segmented\" (as these\n   terms are defined\
    \ in [RFC6513] and [RFC6514]).\n   A \"non-segmented\" IR P-tunnel is a two-level\
    \ P2MP tree, consisting\n   only of a root node and a set of nodes that are children\
    \ of the root\n   node.  When used in an MVPN context, the root is an ingress\
    \ PE, and\n   the child nodes of the root are the egress PEs.\n   In a segmented\
    \ P-tunnel, IR may be used for some or all of the\n   segments.  If a particular\
    \ segment of a segmented P-tunnel uses IR,\n   then the root of that segment may\
    \ have child nodes that are ABRs or\n   ASBRs, rather than egress PEs.\n   As\
    \ with any type of P2MP tree, each node of an IR P-tunnel holds\n   \"multicast\
    \ state\" for the P-tunnel.  That is, each node knows the\n   identity of its\
    \ parent node on the tree, and each node knows the\n   identities of its child\
    \ nodes on the tree.  In the MVPN specs, the\n   \"parent\" node is also known\
    \ as the \"Upstream Multicast Hop\" or \"UMH\".\n   Note that the UMH may be a\
    \ PE, an ASBR, or (if procedures from\n   [RFC7524] are being used) an ABR.  (In\
    \ [RFC7524], the term \"upstream\n   node\" is used instead of \"UMH\".)\n   What\
    \ distinguishes an IR P-tunnel from any other kind of P2MP tree is\n   the method\
    \ by which a data packet is transmitted from a parent node\n   to a child node.\
    \  To transmit a multicast data packet from a parent\n   node to a child node\
    \ along a particular IR P-tunnel, the parent node\n   does the following:\n  \
    \ o  It labels the packet with a label (call it a \"P-tunnel label\")\n      that\
    \ the child node has assigned to that P-tunnel.\n   o  It then places the packet\
    \ in a unicast encapsulation and unicasts\n      the packet to the child node.\
    \  That is, the parent node sends the\n      packet through a unicast tunnel to\
    \ a particular child node.  This\n      unicast tunnel need not be specially created\
    \ to be part of the IR\n      P-tunnel; it can be any P2P or MP2P unicast tunnel\
    \ that will get\n      the packets from the parent node to the child node.  A\
    \ single such\n      unicast tunnel may be carrying multicast data packets of\
    \ several\n      different P2MP trees and may also be carrying unicast data\n\
    \      packets.\n   The parent node repeats this process for each child node,\
    \ creating\n   one copy for each child node, and sending each copy through a unicast\n\
    \   tunnel to corresponding child node.  It does not use Layer 2\n   multicast,\
    \ IP multicast, or MPLS multicast to transmit packets to its\n   child nodes.\
    \  As a result, multiple copies of each packet may be sent\n   out a single interface;\
    \ this may happen, e.g., if that interface is\n   the next-hop interface, according\
    \ to unicast routing, from the parent\n   node to several of the child nodes.\n\
    \   Since data traveling along an IR P-tunnel is always unicast from\n   parent\
    \ node to child node, it can be convenient to think of an IR\n   P-tunnel as a\
    \ P2MP tree whose arcs are unicast tunnels.  However, it\n   is important to understand\
    \ that the unicast tunnels need not be\n   specific to any particular IR P-tunnel.\
    \  If R1 is the parent node of\n   R2 on two different IR P-tunnels, a single\
    \ unicast tunnel from R1 to\n   R2 may be used to carry data along both IR P-tunnels.\
    \  All that is\n   required is that when the data packets arrive at R2, R2 will\
    \ see the\n   \"P-tunnel label\" at the top of the packets' label stack; R2's\
    \ further\n   processing of the packets will depend upon that label.  Note that\
    \ the\n   same unicast tunnel between R1 and R2 may also be carrying unicast\n\
    \   data packets.\n   Typically, the unicast tunnels are the LSPs that already\
    \ exist to\n   carry unicast traffic; either MP2P LSPs created by the Label\n\
    \   Distribution Protocol (LDP) [RFC5036] or P2P LSPs created by Resource\n  \
    \ Reservation Protocol - Traffic Engineering (RSVP-TE) [RFC3209].\n   However,\
    \ any other kind of unicast tunnel may be used.  A unicast\n   tunnel may have\
    \ an arbitrary number of intermediate routers; those\n   routers do not maintain\
    \ any multicast state for the IR P-tunnel and,\n   in general, are not even aware\
    \ of its existence.\n   As with all other P-tunnel types, an IR P-tunnel may be\
    \ used to\n   instantiate either an Inclusive PMSI (I-PMSI) or a Selective PMSI\n\
    \   (S-PMSI).  See Section 3.2 of [RFC6513] for an explanation of those\n   concepts.\n"
- title: 3.  How are IR P-tunnels identified?
  contents:
  - "3.  How are IR P-tunnels identified?\n   There are four MVPN BGP route types\
    \ in which P-tunnels can be\n   identified: Intra-AS I-PMSI A-D routes, Inter-AS\
    \ I-PMSI A-D routes,\n   S-PMSI A-D routes, and Leaf A-D routes.  (These route\
    \ types are all\n   defined in [RFC6514]).\n   Whenever it is necessary to identify\
    \ a P-tunnel in a route of one of\n   these types, a \"PMSI Tunnel Attribute\"\
    \ (PTA) is added to the route.\n   As defined in Section 5 of [RFC6514], the PTA\
    \ contains four fields:\n   Tunnel Type, MPLS Label, Tunnel Identifier, and Flags.\
    \  [RFC6514]\n   defines only one bit in the Flags field, the Leaf Information\n\
    \   Required bit.\n   If a route identifies an IR P-tunnel, the Tunnel Type field\
    \ of its\n   PTA is set to the value 6, meaning \"Ingress Replication\".\n   Most\
    \ types of P-tunnel are associated with specific protocols that\n   are used to\
    \ set up and maintain tunnels of that type.  For example,\n   if the Tunnel Type\
    \ field is set to 2, meaning \"mLDP P2MP LSP\", the\n   associated setup protocol\
    \ is Multipoint LDP (mLDP) [RFC6388].  The\n   associated setup protocol always\
    \ has a method of identifying the\n   tunnels that it sets up.  For example, mLDP\
    \ uses an FEC element\n   (Forwarding Equivalence Class element) to identify a\
    \ tree.  If the\n   Tunnel Type field is set to 3, meaning \"PIM-SSM Tree\", where\
    \ \"SSM\"\n   stands for Source-Specific Multicast, the associated setup protocol\n\
    \   is PIM, and \"(S,G)\" is used to identify the tree.  In these cases,\n   the\
    \ Tunnel Identifier field of the PTA carries a tree identifier as\n   defined\
    \ by the setup protocol used for the particular tunnel type.\n   IR P-tunnels,\
    \ on the other hand, are entirely setup and maintained by\n   the use of BGP A-D\
    \ routes and are not associated with any other setup\n   protocol.  (The unicast\
    \ tunnels used to transmit multicast data along\n   an IR P-tunnel may have their\
    \ own setup and maintenance protocols, of\n   course.)  The means of identifying\
    \ a P-tunnel is very different for\n   IR P-tunnels than for other types of P-tunnel:\n\
    \      When an IR P-tunnel is identified in an S-PMSI A-D route, an\n      Intra-AS\
    \ I-PMSI A-D route, or an Inter-AS I-PMSI A-D route (we\n      will refer to these\
    \ three route types as \"advertising A-D\n      routes\"), its identifier is hereby\
    \ defined to be the NLRI (Network\n      Layer Reachability Information) of that\
    \ route.  See Sections 4.1,\n      4.2, and 4.3 of [RFC6514] for the specification\
    \ of these NLRIs.\n      Note that the IR P-tunnel identifier includes the Route\
    \ Type and\n      Length fields (see Section 4 of [RFC6514]) of the NLRI.\n  \
    \ To reiterate:\n      The identifier of the IR P-tunnel does not appear in the\
    \ PTA at\n      all; the Tunnel Identifier field of the PTA does not contain the\n\
    \      identifier of the IR P-tunnel.\n      Rather, the identifier of the IR\
    \ P-tunnel appears in the Network\n      Layer Reachability Information (NLRI)\
    \ field of the A-D routes that\n      are used to advertise and to setup the IR\
    \ P-tunnel.\n   Note that an advertising A-D route is considered to identify an\
    \ IR\n   P-tunnel only if it carries a PTA whose Tunnel Type field is set to\n\
    \   \"IR\".\n   When an IR P-tunnel is identified in an S-PMSI A-D route or in\
    \ an\n   Inter-AS I-PMSI A-D route, the Leaf Information Required bit of the\n\
    \   Flags field of the PTA MUST be set.\n   In an advertising A-D route:\n   o\
    \  If the Leaf Information Required bit of the Flags field of the PTA\n      is\
    \ set, then the Tunnel Identifier field of the PTA has no\n      significance\
    \ whatsoever and MUST be ignored upon reception.\n      Note that, per RFC 6514,\
    \ the length of the Tunnel Identifier field\n      of the PTA is variable and\
    \ is inferred from the length of the PTA.\n      Even when this field is of no\
    \ significance, its length MUST be the\n      length of an IP address in the address\
    \ space of the SP's backbone,\n      as specified in Section 4.2 of [RFC6515].\
    \  In this case, it is\n      RECOMMENDED that it be set to a routable address\
    \ of the router\n      that constructed the PTA.  (While it might make more sense\
    \ to\n      allow or even require the field to be omitted entirely, that might\n\
    \      raise issues of backwards compatibility with implementations that\n   \
    \   were designed prior to the publication of this document.)\n   o  If the Leaf\
    \ Information Required bit is not set, the Tunnel\n      Identifier field of the\
    \ PTA does have significance, but it does\n      not identify the IR P-tunnel.\
    \  The use of the PTA's Tunnel\n      Identifier field in this case is discussed\
    \ in Section 5 of this\n      document.\n   Note that according to the above definition,\
    \ there is no way for two\n   different advertising A-D routes (i.e., two advertising\
    \ A-D routes\n   with different NLRIs) to advertise the same IR P-tunnel.  In\
    \ the\n   terminology of [RFC6513], an IR P-tunnel can instantiate only a\n  \
    \ single PMSI.  If an ingress PE, for example, wants to bind two\n   customer\
    \ multicast flows to a single IR P-tunnel, it must advertise\n   that IR P-tunnel\
    \ either in an I-PMSI A-D route or in an S-PMSI A-D\n   route whose NLRI contains\
    \ wildcards [RFC6625].\n   When an IR P-tunnel is identified in a Leaf A-D route,\
    \ its identifier\n   is the Route Key field of the route's NLRI.  See Section\
    \ 4.4 of\n   [RFC6514].\n   A Leaf A-D route is considered to identify an IR P-tunnel\
    \ only if it\n   carries a PTA whose Tunnel Type field is set to \"IR\".  In this\
    \ type\n   of route, the Tunnel Identifier field of the PTA does have\n   significance,\
    \ but it does not identify the IR P-tunnel.  The use of\n   the PTA's Tunnel Identifier\
    \ field in this case is discussed in\n   Section 5.\n"
- title: 4.  How to Join an IR P-Tunnel
  contents:
  - "4.  How to Join an IR P-Tunnel\n   The procedures for joining an IR P-tunnel\
    \ depend upon whether the\n   P-tunnel has been previously advertised, and, if\
    \ so, upon how the\n   P-tunnel was advertised.  Note that joining an unadvertised\
    \ IR\n   P-tunnel is only possible when using the \"global table multicast\"\n\
    \   procedures of [RFC7524].\n"
- title: 4.1.  Advertised IR P-tunnels
  contents:
  - "4.1.  Advertised IR P-tunnels\n   The procedures in this section apply when the\
    \ IR P-tunnel to be\n   joined has been advertised in an S-PMSI A-D route, an\
    \ Inter-AS I-PMSI\n   A-D route, or an Intra-AS I-PMSI A-D route.\n   The procedures\
    \ for joining an advertised IR P-tunnel depend upon\n   whether the A-D route\
    \ that advertises the IR P-tunnel has the Leaf\n   Information Required bit set\
    \ in its PTA.\n"
- title: 4.1.1.  If the Leaf Information Required Bit Is Set
  contents:
  - "4.1.1.  If the Leaf Information Required Bit Is Set\n   The procedures in this\
    \ section apply when the P-tunnel to be joined\n   has been advertised in a route\
    \ whose PTA has the Leaf Information\n   Required bit set.\n   The router joining\
    \ a particular IR P-tunnel must determine its UMH\n   for that P-tunnel.  If the\
    \ route that advertised the IR P-tunnel\n   contains a P2MP Segmented Next Hop\
    \ Extended Community, the UMH is\n   determined from the value of this community\
    \ (see [RFC7524]).\n   Otherwise, the UMH is determined from the route's next\
    \ hop (see\n   [RFC6514]).\n   Once the UMH is determined, the router joining\
    \ the IR P-tunnel\n   originates a Leaf A-D route.  The NLRI of the Leaf A-D route\
    \ is\n   formed following the procedures of [RFC6514].  As a result, the NLRI\n\
    \   of the Leaf A-D route will contain the IR P-tunnel identifier defined\n  \
    \ in Section 3 above as its \"route key\".  The UMH MUST be identified by\n  \
    \ attaching an \"IP-address-specific Route Target\" (or an \"IPv6-address-\n \
    \  specific Route Target\") to the Leaf A-D route.  The IP address of the\n  \
    \ UMH appears in the Global Administrator field of the Route Target\n   (RT).\
    \  Details can be found in [RFC6514] and [RFC7524].\n   The Leaf A-D route MUST\
    \ also contain a PTA whose fields are set as\n   follows:\n   o  The Tunnel Type\
    \ field is set to \"IR\".\n   o  The Tunnel Identifier field is set as described\
    \ in Section 5 of\n      this document.  (Note that this field does not contain\
    \ the IR\n      P-tunnel Identifier that is defined in Section 3.)\n   o  The\
    \ MPLS Label field is set to a non-zero value.  This is the\n      \"P-tunnel\
    \ label\".  The value must be chosen so as to satisfy\n      various constraints,\
    \ as discussed in Section 7 this document.\n"
- title: 4.1.2.  If the Leaf Information Required Bit Is Not Set
  contents:
  - "4.1.2.  If the Leaf Information Required Bit Is Not Set\n   The procedures in\
    \ this section apply when the IR P-tunnel to be\n   joined has been advertised\
    \ in a route whose PTA does not have the\n   Leaf Information Required bit set.\
    \  This can only be the case if the\n   IR P-tunnel was advertised in an Intra-AS\
    \ I-PMSI A-D route.\n   If an IR P-tunnel is advertised in the Intra-AS I-PMSI\
    \ A-D routes\n   originated by the PE routers of a given MVPN, the Intra-AS I-PMSI\
    \ can\n   be thought of as being instantiated by a set of IR P-tunnels.  Each\n\
    \   PE is the root of one such IR P-tunnel, and the other PEs are\n   children\
    \ of the root.  A PE simultaneously joins all these P-tunnels\n   by originating\
    \ (if it hasn't already done so) an Intra-AS I-PMSI A-D\n   route with a PTA whose\
    \ fields are set as follows:\n   o  The Tunnel Type field is set to \"IR\".\n\
    \   o  The Tunnel Identifier field is set as described in Section 5 of\n     \
    \ this document.  (Note that this field does not contain the IR\n      P-tunnel\
    \ identifier that is defined in Section 3.)\n   o  The MPLS Label field MUST be\
    \ set to a non-zero value.  This label\n      value will be used by the child\
    \ node to associate a received\n      packet with the I-PMSI of a particular MVPN.\
    \  The MPLS label\n      allocation policy must be such as to ensure that the\
    \ binding from\n      label to I-PMSI is one to one.\n   The NLRI and the RTs\
    \ of the originated I-PMSI A-D route are set as\n   specified in [RFC6514].\n"
- title: 4.2.  Unadvertised IR P-Tunnels
  contents:
  - "4.2.  Unadvertised IR P-Tunnels\n   In [RFC7524], a procedure is defined for\
    \ \"global table multicast\", in\n   which a P-tunnel can be joined even if the\
    \ P-tunnel has not been\n   previously advertised.  See Sections 6.2.2 and 6.2.3\
    \ of [RFC7524]:\n   \"Leaf A-D Route for Global Table Multicast\" and \"Constructing\
    \ the\n   Rest of the Leaf A-D Route\".  The route key of the Leaf A-D route has\n\
    \   the form of the \"S-PMSI Route-Type Specific NLRI\" (see Section 4.3 of\n\
    \   [RFC6514]) in this case, and that should be considered to be the IR\n   P-tunnel\
    \ identifier.  Note that the procedure for finding the UMH is\n   different in\
    \ this case; the UMH is the next hop of the best UMH-\n   eligible route towards\
    \ the \"ingress PE\".  See Section 6.1 of\n   [RFC7524], entitled \"Determining\
    \ the Upstream ABR/PE/ASBR (Upstream\n   Node)\".\n"
- title: 5.  The PTA's Tunnel Identifier Field
  contents:
  - "5.  The PTA's Tunnel Identifier Field\n   As discussed in Section 1, when the\
    \ Tunnel Type field of a PTA is set\n   to \"IR\", the Tunnel Identifier field\
    \ of that PTA does not contain the\n   IR P-tunnel identifier.  This section specifies\
    \ the procedures for\n   setting the Tunnel Identifier field of the PTA when the\
    \ Tunnel Type\n   field of the PTA is set to \"IR\".\n   If the Tunnel Type field\
    \ of a PTA is set to \"IR\", its Tunnel\n   Identifier field is significant only\
    \ when one of the following two\n   conditions holds:\n   o  The PTA is carried\
    \ by a Leaf A-D route, or\n   o  The Leaf Information Required bit of the Flags\
    \ field of the PTA is\n      not set.\n   If one of these conditions holds, then\
    \ the Tunnel Identifier field\n   must contain a routable IP address of the originator\
    \ of the route.\n   (See Sections 9.2.3.2.1 and 9.2.3.4.1 of [RFC6514] for the\
    \ detailed\n   specification of the contents of this field.)  This address is\
    \ used\n   by the UMH to determine the unicast tunnel that it will use in order\n\
    \   to send data, along the IR P-tunnel identified by the route key, to\n   the\
    \ originator of the Leaf A-D route.\n   The means by which the unicast tunnel\
    \ is determined from this IP\n   address is outside the scope of this document.\
    \  The means by which\n   the unicast tunnel is set up and maintained is also\
    \ outside the scope\n   of this document.\n   Section 4 of [RFC6515] MUST be applied\
    \ when a PTA is carried in a\n   Leaf A-D route.  It describes how to determine\
    \ whether the Tunnel\n   Identifier field carries an IPv4 or an IPv6 address.\n\
    \   If neither of the above conditions hold, then the Tunnel Identifier\n   field\
    \ is of no significance and MUST be ignored upon reception.\n"
- title: 6.  A Note on IR P-Tunnels and Discarding Packets from the Wrong PE
  contents:
  - "6.  A Note on IR P-Tunnels and Discarding Packets from the Wrong PE\n   Section\
    \ 9.1.1 of [RFC6513] specifies a procedure known as \"Discarding\n   Packets from\
    \ the Wrong PE\".  When an egress PE receives a multicast\n   data packet, this\
    \ procedure requires it to determine the packet's\n   ingress PE.\n   In this\
    \ document, we assume that when a packet has reached an egress\n   PE via an IR\
    \ P-tunnel, the egress PE will infer the identity of the\n   packet's ingress\
    \ PE by examining the packet's P-tunnel label.\n   Section 7 specifies certain\
    \ constraints on the way in which the\n   P-tunnel label is allocated for a given\
    \ P-tunnel.  In general, if\n   these constraints are followed, an egress PE will\
    \ be able to infer\n   the identity of a packet's ingress PE from the P-tunnel\
    \ label, and\n   hence will be able to apply the procedures of Section 9.1.1 of\n\
    \   [RFC6513].  This method of identifying a packet's ingress PE works\n   exactly\
    \ the same when the unicast tunnels are IP tunnels as it does\n   when the unicast\
    \ tunnels are MPLS LSPs.\n   However, if the egress PE joined a particular IR\
    \ P-tunnel using the\n   procedures of Section 4.1.2, then when the egress PE\
    \ receives a\n   packet through that P-tunnel, it will not be able to infer the\n\
    \   identity of the packet's ingress PE from the P-tunnel label, and thus\n  \
    \ will not be able to apply the procedures of Section 9.1.1 of\n   [RFC6513].\n\
    \   One might think that if a particular IR P-tunnel uses IP unicast\n   tunnels\
    \ rather than MPLS LSPs, an egress PE could identify the\n   ingress PE by inspecting\
    \ the IP source address field of the\n   encapsulating IP header.  However, there\
    \ are several reasons why this\n   procedure is not desirable:\n   o  When segmented\
    \ P-tunnels are being used, the IP source address\n      field of the encapsulating\
    \ IP header might not contain the address\n      of the ingress PE.\n   o  Even\
    \ if the IP source address field of the encapsulating IP header\n      does identify\
    \ the ingress PE, there is no guarantee that the IP\n      source address in that\
    \ header is the same as the IP address used\n      by the ingress PE for the MVPN\
    \ signaling procedures.\n   o  To apply the procedures of Section 9.1.1 of [RFC6513]\
    \ when\n      extranet functionality [RFC7900] is supported, it is necessary to\n\
    \      infer a packet's ingress VRF (Virtual Routing and Forwarding\n      table),\
    \ not merely its ingress PE.  This can be inferred from the\n      P-tunnel label\
    \ (assuming that the label is allocated following the\n      procedures of Section\
    \ 7), but it cannot be inferred from the IP\n      source address of the encapsulating\
    \ IP header.\n   We therefore assume in this document that if the procedures of\n\
    \   Section 9.1.1 of [RFC6513] are to be applied to packets traveling\n   through\
    \ IR P-tunnels, those procedures will be based on the P-tunnel\n   label, even\
    \ if the IR P-tunnel is using IP unicast tunnels.\n   This means that if an egress\
    \ PE joined a particular IR P-tunnel using\n   the procedures of Section 4.1.2,\
    \ duplicate prevention on that IR\n   P-tunnel requires the use of either Single\
    \ Forwarder Selection\n   (Section 9.1.2 of [RFC6513]) or native PIM procedures\
    \ (Section 9.1.3\n   of [RFC6513]).\n"
- title: 7.  The PTA's MPLS Label Field
  contents:
  - "7.  The PTA's MPLS Label Field\n   When the Tunnel Type field of a PTA is set\
    \ to \"IR\", the MPLS Label\n   field is not always significant.  It is significant\
    \ only under the\n   following conditions:\n   1.  Either the PTA is being carried\
    \ in a Leaf A-D route, or\n   2.  the Leaf Information Required flag of the PTA\
    \ is NOT set.\n   Note that the Leaf Information Required flag of the PTA is always\
    \ set\n   when a PTA specifying an IR P-tunnel is carried in an S-PMSI A-D\n \
    \  route or in an Inter-AS I-PMSI A-D route; thus, the MPLS Label field\n   of\
    \ the PTA is never significant when the PTA is carried by one of\n   these route\
    \ types.  The MPLS Label field is significant only when the\n   PTA appears either\
    \ in a Leaf A-D route or in an Intra-AS I-PMSI A-D\n   route that does not have\
    \ the Leaf Information Required bit set.  In\n   these cases, the MPLS label is\
    \ the label that the originator of the\n   route is assigning to the IR P-tunnel(s)\
    \ identified by the route's\n   NLRI.  (That is, the MPLS label assigned in the\
    \ PTA is what we have\n   called the \"P-tunnel label\".)\n   In those cases where\
    \ the MPLS Label field is not significant, it\n   SHOULD be set to zero upon transmission\
    \ and MUST be ignored upon\n   reception.\n"
- title: 7.1.  Leaf A-D Route Originated by an Egress PE
  contents:
  - "7.1.  Leaf A-D Route Originated by an Egress PE\n   As previously stated, when\
    \ a Leaf A-D route is used to join an IR\n   P-tunnel, the \"route key\" of the\
    \ Leaf A-D route is the P-tunnel\n   identifier.\n   We now define the notion\
    \ of the \"root of an IR P-tunnel\".\n   o  If the identifier of an IR P-tunnel\
    \ is of the form of an S-PMSI\n      NLRI, the \"root\" of the IR P-tunnel is\
    \ the router identified in\n      the Originating Router's IP Address field of\
    \ that NLRI.\n   o  If the identifier of an IR P-tunnel is of the form specified\
    \ in\n      Section 6.2.2 of [RFC7524] (\"Leaf A-D Route for Global Table\n  \
    \    Multicast\"), the \"root\" of the IR P-tunnel is the router\n      identified\
    \ in the Ingress PE's IP Address field of that NLRI.\n   o  If the identifier\
    \ of an IR P-tunnel is of the form of an Intra-AS\n      I-PMSI NLRI, the \"root\"\
    \ of the IR P-tunnel is the router\n      identified in the Originating Router's\
    \ IP Address field of that\n      NLRI.\n   o  If the identifier of an IR P-tunnel\
    \ is of the form of an Inter-AS\n      I-PMSI NLRI, the \"root\" of the IR P-tunnel\
    \ is same as the\n      identifier of the IR P-tunnel, i.e., the combination of\
    \ a Route\n      Distinguisher (RD) and an AS.\n   Note that if an IR P-tunnel\
    \ is segmented, the root of the IR\n   P-tunnel, by this definition, is actually\
    \ the root of the entire\n   P-tunnel, not the root of the local segment.  In\
    \ this case, there may\n   be segments upstream that are not IR P-tunnels themselves.\
    \  However,\n   the egress PE is aware only of the final segment of the P-tunnel,\
    \ and\n   hence considers the P-tunnel to be an IR P-tunnel.\n   In order to apply\
    \ the procedures of Section 9.1.1 of RFC 6513\n   (\"Discarding Packets from Wrong\
    \ PE\"), the following condition MUST be\n   met by the MPLS label allocation\
    \ policy:\n      Suppose an egress PE originates two Leaf A-D routes, each with\
    \ a\n      different route key in its NLRI, and each with a PTA specifying a\n\
    \      Tunnel Type field of \"IR\".  Thus, each of the Leaf A-D routes\n     \
    \ identifies a different IR P-tunnel.  Suppose further that each of\n      those\
    \ IR P-tunnels has a different root.  Then, the egress PE MUST\n      NOT specify\
    \ the same MPLS label in both PMSI Tunnel attributes.\n   That is, to apply the\
    \ duplicate prevention procedures (in \"Discarding\n   Packets from Wrong PE\"\
    , Section 9.1.1 of [RFC6513]), the same MPLS\n   label MUST NOT be assigned to\
    \ two IR P-tunnels that have different\n   roots.\n   If segmented P-tunnels are\
    \ in use, the above rule is necessary but\n   not sufficient to prevent a PE from\
    \ forwarding duplicate data to the\n   CEs.  For various reasons, a given egress\
    \ PE or egress ABR or egress\n   ASBR may decide to change its parent node, on\
    \ a given segmented\n   P-tunnel, from one router to another.  It does this by\
    \ changing the\n   RT of the Leaf A-D route that it originated in order to join\
    \ that\n   P-tunnel.  Once the RT is changed, there may be a period of time\n\
    \   during which the old parent node and the new parent node are both\n   sending\
    \ data of the same multicast flow.  To ensure that the egress\n   node not forward\
    \ duplicate data, whenever the egress node changes the\n   RT that it attaches\
    \ to a Leaf A-D route, it MUST also change the\n   \"MPLS Label\" specified in\
    \ the Leaf A-D route's PTA.  This allows the\n   egress router to distinguish\
    \ between packets arriving on a given\n   P-tunnel from the old parent and packets\
    \ arriving on that same\n   P-tunnel from the new parent.  At any given time,\
    \ a router MUST\n   consider itself to have only a single parent node on a given\
    \ P-tunnel\n   and MUST discard traffic that arrives on that P-tunnel from a\n\
    \   different parent node.\n   If extranet functionality [RFC7900] is not implemented\
    \ in a\n   particular egress PE, or if an egress PE is provisioned with the\n\
    \   knowledge that extranet functionality is not needed, the PE may adopt\n  \
    \ the policy of assigning a label that is unique for the ordered triple\n   <root,\
    \ parent node, egress VRF>.  This will enable the egress PE to\n   apply the duplicate\
    \ prevention procedures discussed above and to\n   determine the VRF to which\
    \ an arriving packet must be directed.\n   However, this policy is not sufficient\
    \ to support the \"Do Not Deliver\n   Packets from the Wrong P-tunnel\" procedures\
    \ that are specified in\n   Section 2.3.1 of [RFC7900].  To support those procedures,\
    \ the labels\n   specified in the PTA of Leaf A-D routes originated by a given\
    \ egress\n   PE MUST be unique for the ordered triple <root, root RD, parent\n\
    \   node>, where the \"root RD\" is taken from the RD field of the IR\n   P-tunnel\
    \ identifier.  (All forms of IR P-tunnel identifier contain an\n   embedded RD\
    \ field.)  This policy is also sufficient for supporting\n   non-extranet cases,\
    \ but, in some cases, may result in the use of more\n   labels than the policy\
    \ of the preceding paragraph.\n"
- title: 7.2.  Leaf A-D Route Originated by an Intermediate Node
  contents:
  - "7.2.  Leaf A-D Route Originated by an Intermediate Node\n   When a P-tunnel is\
    \ segmented, there will be \"intermediate nodes\",\n   i.e., nodes that have a\
    \ parent and also have children on the\n   P-tunnel.  Each intermediate node is\
    \ a leaf node of an \"upstream\n   segment\" and a root node of one or more \"\
    downstream segments\".  The\n   intermediate node needs to set up its forwarding\
    \ state so that data\n   it receives on the upstream segment gets transmitted\
    \ on the proper\n   downstream segments.\n   If the upstream segment is instantiated\
    \ by IR, the intermediate node\n   will need to originate a Leaf A-D route to\
    \ join that segment, and\n   will need to allocate a downstream-assigned MPLS\
    \ label to advertise\n   in the MPLS Label field of the Leaf A-D route's PTA.\
    \  Section 7.1\n   specifies constraints on the label allocation policy for egress\
    \ PEs;\n   this section specifies constraints on the label allocation policy for\n\
    \   intermediate nodes.\n   Suppose intermediate node N originates two Leaf A-D\
    \ routes, one whose\n   route key is K1, and one whose route key is K2, where\
    \ K1 != K2.  The\n   respective PTAs of these Leaf A-D routes MUST specify distinct\
    \ non-\n   zero MPLS labels, UNLESS the following conditions all hold:\n   1.\
    \  N's parent node for P-tunnel K1 is the same as N's parent node\n       for\
    \ P-tunnel K2.\n   2.  N's forwarding state is such that any packet it receives\
    \ from\n       P-tunnel K1 is forwarded to the exact same set of downstream\n\
    \       neighbors as any packet it receives from P-tunnel K2.\n   3.  For each\
    \ downstream neighbor D to which N sends the packets it\n       receives from\
    \ P-tunnels K1 and K2, N's forwarding state is such\n       that it applies the\
    \ exact same encapsulation to packets it\n       forwards from either tunnel to\
    \ D.  (For example, if N uses MPLS\n       to forward the packets to D, it pushes\
    \ the exact same set of\n       labels on packets from P-tunnel K1 as it pushes\
    \ on packets from\n       P-tunnel K2.)\n   Of course, N MAY always specify distinct\
    \ non-zero labels in each of\n   the Leaf A-D routes that it originates.\n   Note\
    \ that the rules of this section apply whenever the upstream\n   P-tunnel segment\
    \ is an IR P-tunnel.  These rules hold whether or not\n   some or all of the downstream\
    \ segments are other types of P-tunnels.\n   If the P-tunnels from N to a particular\
    \ downstream neighbor D are IR\n   P-tunnels, then condition 3 above will hold\
    \ with respect to D only if\n   the following conditions all hold as well:\n \
    \  o  N has received and installed a Leaf A-D route from D, whose route\n    \
    \  key is K1, and which carries an IP-address-specific RT identifying\n      N,\n\
    \   o  N has received and installed a Leaf A-D route from D, whose route\n   \
    \   key is K2, and which carries an IP-address-specific RT identifying\n     \
    \ N,\n   o  Those two Leaf A-D routes specify the same MPLS label in their\n \
    \     respective PTAs.\n"
- title: 7.3.  Intra-AS I-PMSI A-D Route
  contents:
  - "7.3.  Intra-AS I-PMSI A-D Route\n   When a router joins a set of IR P-tunnels\
    \ using the procedures of\n   Section 4.1.2 of this document, the procedures of\
    \ Section 9.1.1 of\n   [RFC6513] cannot be applied, no matter what the label allocation\n\
    \   policy is.  In this case, the ingress PE is the same as the UMH, but\n   it\
    \ is not possible to assign a label uniquely to a particular ingress\n   PE or\
    \ UMH.  However, the label in the MPLS Label field of the PTA\n   MUST NOT appear\
    \ in the MPLS Label field of the PTA carried by any\n   other route originated\
    \ by the same router.\n"
- title: 8.  How a Child Node Prunes Itself from an IR P-Tunnel
  contents:
  - "8.  How a Child Node Prunes Itself from an IR P-Tunnel\n   If a particular IR\
    \ P-tunnel was joined via the procedures of\n   Section 4.1.2, a router can prune\
    \ itself from the P-tunnel by\n   withdrawing the Intra-AS I-PMSI A-D route it\
    \ used to join the\n   P-tunnel.  This is not usually done unless the router is\
    \ removing\n   itself entirely from a particular MVPN.\n   The procedures in the\
    \ remainder of this section apply when a router\n   joined a particular IR P-tunnel\
    \ by originating a Leaf A-D route (as\n   described in Sections 4.1.1 or 4.2).\n\
    \   If a router no longer has a need to receive any multicast data from a\n  \
    \ given IR P-tunnel, it may prune itself from the P-tunnel by\n   withdrawing\
    \ the Leaf A-D route it used to join the tunnel.  This is\n   done, e.g., if the\
    \ router no longer needs any of the flows traveling\n   over the P-tunnel, or\
    \ if all the flows the router does need are being\n   received over other P-tunnels.\n\
    \   A router that is attached to a particular IR P-tunnel via a\n   particular\
    \ parent node may determine that it needs to stay joined to\n   that IR P-tunnel\
    \ but via a different parent node.  This can happen,\n   for example, if there\
    \ is a change in the Next Hop or the P2MP\n   Segmented Next-Hop Extended Community\
    \ of the S-PMSI A-D route in\n   which that P-tunnel was advertised.  In this\
    \ case, the router changes\n   the Route Target of the Leaf A-D route it used\
    \ to join the IR\n   P-tunnel, so that the Route Target now identifies the new\
    \ parent\n   node.\n   A parent node must notice when a child node has been pruned\
    \ from a\n   particular tree, as this will affect the parent node's multicast\
    \ data\n   state.  Note that the pruning of a child node may appear to the\n \
    \  parent node as the explicit withdrawal of a Leaf A-D route, or it may\n   appear\
    \ as a change in the Route Target of a Leaf A-D route.  If the\n   Route Target\
    \ of a particular Leaf A-D route previously identified a\n   particular parent\
    \ node, but changes so that it no longer does so, the\n   effect on the multicast\
    \ state of the parent node is the same as if\n   the Leaf A-D route had been explicitly\
    \ withdrawn.\n"
- title: 9.  Parent Node Actions upon Receiving Leaf A-D Route
  contents:
  - "9.  Parent Node Actions upon Receiving Leaf A-D Route\n   These actions are detailed\
    \ in [RFC6514] and [RFC7524].  Two points of\n   clarification are made:\n   o\
    \  If a router R1 receives and installs a Leaf A-D route originated\n      by\
    \ router R2, R1's multicast state is affected only if the Leaf\n      A-D route\
    \ carries an \"IP-address-specific RT\" (or \"IPv6-address-\n      specific RT\"\
    ) whose Global Administrator field identifies R1.\n      (This is as specified\
    \ in [RFC6514] and [RFC7524].)  If a Leaf A-D\n      route's RT does not identify\
    \ R1, but then changes so that it does\n      identify R1, R1 must take the same\
    \ actions it would take if the\n      Leaf A-D route were newly received.\n  \
    \ o  It is possible that router R1 will receive and install a Leaf A-D\n     \
    \ route originated by router R2, where:\n      *  the route's RT identifies R1,\n\
    \      *  the route's NLRI contains a route key whose first octet\n         indicates\
    \ that it is identifying a P-tunnel advertised in an\n         S-PMSI A-D route,\n\
    \      *  R1 has neither originated nor installed any such S-PMSI A-D\n      \
    \   route.\n   If at some later time, R1 installs the corresponding S-PMSI A-D\n\
    \   route, and the Leaf A-D route is still installed, and the Leaf A-D\n   route's\
    \ RT still identifies R1, then R1 MUST follow the same\n   procedures it would\
    \ have followed if the S-PMSI A-D route had been\n   installed before the Leaf\
    \ A-D route was installed.  Implementers must\n   not assume that events occur\
    \ in the \"usual\" or \"expected\" order.\n"
- title: 10.  Use of Timers When Switching UMH
  contents:
  - "10.  Use of Timers When Switching UMH\n   Consider a child node that has joined\
    \ a particular IR P-tunnel via a\n   particular UMH.  To do so, it will have originated\
    \ a Leaf A-D route\n   with an RT that identifies the UMH.  Suppose the child\
    \ node now\n   determines (for whatever reason) that it needs to change its UMH\
    \ for\n   that P-tunnel.  It does this by:\n   o  modifying the RT of the Leaf\
    \ A-D route, so that the RT now\n      identifies the new parent rather than the\
    \ old one, and by\n   o  modifying the PTA of the Leaf A-D route, changing the\
    \ MPLS Label\n      field as discussed in Section 7.\n   Note that, in accordance\
    \ with the procedures of [RFC6514] and of\n   Section 4 of this document, the\
    \ NLRI of the Leaf A-D route is not\n   modified; only the RT and the PTA are\
    \ changed.\n   It is desirable for such a \"switch of UMH\" to be done using a\
    \ \"make\n   before break\" technique, so that the old UMH does not stop\n   transmitting\
    \ packets of the given P-tunnel to the child until the new\n   UMH has a chance\
    \ to start transmitting packets of the given P-tunnel\n   to the child.  However,\
    \ the control-plane operation (i.e., modifying\n   the RT and PTA of the Leaf\
    \ A-D route) does not permit the child node\n   to first join the IR P-tunnel\
    \ via the new UMH, and then later prune\n   itself from the old UMH.  Rather,\
    \ a single control-plane operation\n   has both effects.\n   Therefore, the old\
    \ UMH MUST continue transmitting to the child node\n   for a period of time after\
    \ it sees the child's Leaf A-D route being\n   withdrawn (or its RT changing to\
    \ identify a different UMH).  This\n   timer (the \"parent-continues\" timer)\
    \ SHOULD have a default value of\n   60 seconds and SHOULD be configurable.\n\
    \   By the procedures of Section 7, the child node will have advertised a\n  \
    \ different label for the IR P-tunnel to the new UMH than it had\n   advertised\
    \ to the old UMH.  This allows it to distinguish the packets\n   of that IR P-tunnel\
    \ transmitted by the new UMH from packets of that\n   IR P-tunnel transmitted\
    \ by the old UMH.  At any given time, the child\n   node will accept packets of\
    \ that IR P-tunnel from only one parent\n   node and will discard packets of that\
    \ IR P-tunnel that are received\n   from the other.  To achieve \"make before\
    \ break\" functionality, the\n   child node needs to continue to accept packets\
    \ from the old UMH for a\n   period of time.  After this period, it will discard\
    \ any packets from\n   the given IR P-tunnel that it receives from the old UMH\
    \ and will only\n   accept such packets from the new UMH.\n   Once the child node\
    \ modifies the RT of its Leaf A-D route, it MUST\n   run a timer (the \"switch-parents-delay\"\
    \ timer).  This timer SHOULD\n   default to 30 seconds and SHOULD be configurable.\
    \  The child node\n   MUST continue to accept packets of the given IR P-tunnel\
    \ from the old\n   UMH until the timer expires.  However, once the child node\
    \ receives a\n   packet of the given IR P-tunnel from the new UMH, it MAY consider\
    \ the\n   \"switch-parents-delay\" timer to have expired.\n   The \"parent-continues\"\
    \ timer MUST be longer than the \"switch-parents-\n   delay\" timer.  Note that\
    \ both timers are specific to a given IR\n   P-tunnel.\n"
- title: 11.  Security Considerations
  contents:
  - "11.  Security Considerations\n   No security considerations are raised by this\
    \ document beyond those\n   already discussed in [RFC6513] and [RFC6514].\n"
- title: 12.  References
  contents:
  - '12.  References

    '
- title: 12.1.  Normative References
  contents:
  - "12.1.  Normative References\n   [RFC2119]  Bradner, S., \"Key words for use in\
    \ RFCs to Indicate\n              Requirement Levels\", BCP 14, RFC 2119,\n  \
    \            DOI 10.17487/RFC2119, March 1997,\n              <http://www.rfc-editor.org/info/rfc2119>.\n\
    \   [RFC6513]  Rosen, E., Ed., and R. Aggarwal, Ed., \"Multicast in\n        \
    \      MPLS/BGP IP VPNs\", RFC 6513, DOI 10.17487/RFC6513,\n              February\
    \ 2012, <http://www.rfc-editor.org/info/rfc6513>.\n   [RFC6514]  Aggarwal, R.,\
    \ Rosen, E., Morin, T., and Y. Rekhter, \"BGP\n              Encodings and Procedures\
    \ for Multicast in MPLS/BGP IP\n              VPNs\", RFC 6514, DOI 10.17487/RFC6514,\
    \ February 2012,\n              <http://www.rfc-editor.org/info/rfc6514>.\n  \
    \ [RFC6515]  Aggarwal, R. and E. Rosen, \"IPv4 and IPv6 Infrastructure\n     \
    \         Addresses in BGP Updates for Multicast VPN\", RFC 6515,\n          \
    \    DOI 10.17487/RFC6515, February 2012,\n              <http://www.rfc-editor.org/info/rfc6515>.\n"
- title: 12.2.  Informative References
  contents:
  - "12.2.  Informative References\n   [RFC3209]  Awduche, D., Berger, L., Gan, D.,\
    \ Li, T., Srinivasan, V.,\n              and G. Swallow, \"RSVP-TE: Extensions\
    \ to RSVP for LSP\n              Tunnels\", RFC 3209, DOI 10.17487/RFC3209, December\
    \ 2001,\n              <http://www.rfc-editor.org/info/rfc3209>.\n   [RFC5036]\
    \  Andersson, L., Ed., Minei, I., Ed., and B. Thomas, Ed.,\n              \"LDP\
    \ Specification\", RFC 5036, DOI 10.17487/RFC5036,\n              October 2007,\
    \ <http://www.rfc-editor.org/info/rfc5036>.\n   [RFC6388]  Wijnands, IJ., Ed.,\
    \ Minei, I., Ed., Kompella, K., and B.\n              Thomas, \"Label Distribution\
    \ Protocol Extensions for Point-\n              to-Multipoint and Multipoint-to-Multipoint\
    \ Label Switched\n              Paths\", RFC 6388, DOI 10.17487/RFC6388, November\
    \ 2011,\n              <http://www.rfc-editor.org/info/rfc6388>.\n   [RFC6625]\
    \  Rosen, E., Ed., Rekhter, Y., Ed., Hendrickx, W., and R.\n              Qiu,\
    \ \"Wildcards in Multicast VPN Auto-Discovery Routes\",\n              RFC 6625,\
    \ DOI 10.17487/RFC6625, May 2012,\n              <http://www.rfc-editor.org/info/rfc6625>.\n\
    \   [RFC7524]  Rekhter, Y., Rosen, E., Aggarwal, R., Morin, T.,\n            \
    \  Grosclaude, I., Leymann, N., and S. Saad, \"Inter-Area\n              Point-to-Multipoint\
    \ (P2MP) Segmented Label Switched Paths\n              (LSPs)\", RFC 7524, DOI\
    \ 10.17487/RFC7524, May 2015,\n              <http://www.rfc-editor.org/info/rfc7524>.\n\
    \   [RFC7582]  Rosen, E., Wijnands, IJ., Cai, Y., and A. Boers,\n            \
    \  \"Multicast Virtual Private Network (MVPN): Using\n              Bidirectional\
    \ P-Tunnels\", RFC 7582, DOI 10.17487/RFC7582,\n              July 2015, <http://www.rfc-editor.org/info/rfc7582>.\n\
    \   [RFC7716]  Zhang, J., Giuliano, L., Rosen, E., Ed., Subramanian, K.,\n   \
    \           and D. Pacella, \"Global Table Multicast with BGP Multicast\n    \
    \          VPN (BGP-MVPN) Procedures\", RFC 7716,\n              DOI 10.17487/RFC7716,\
    \ December 2015,\n              <http://www.rfc-editor.org/info/rfc7716>.\n  \
    \ [RFC7740]  Zhang, Z., Rekhter, Y., and A. Dolganow, \"Simulating\n         \
    \     Partial Mesh of Multipoint-to-Multipoint (MP2MP) Provider\n            \
    \  Tunnels with Ingress Replication\", RFC 7740,\n              DOI 10.17487/RFC7740,\
    \ January 2016,\n              <http://www.rfc-editor.org/info/rfc7740>.\n   [RFC7900]\
    \  Rekhter, Y., Ed., Rosen, E., Ed., Aggarwal, R., Cai, Y.,\n              and\
    \ T. Morin, \"Extranet Multicast in BGP/IP MPLS VPNs\",\n              RFC 7900,\
    \ DOI 10.17487/RFC7900, June 2016,\n              <http://www.rfc-editor.org/info/rfc7900>.\n"
- title: Acknowledgments
  contents:
  - "Acknowledgments\n   The authors wish to thank Yakov Rekhter for his contributions\
    \ to this\n   work.  We also wish to thank Huajin Jeng and Samir Saad for their\n\
    \   contributions, and to thank Thomas Morin for pointing out (both\n   before\
    \ and after the document was written) some of the issues that\n   needed further\
    \ elaboration.  We also thank Lucy Yong for her review\n   and comments.\n   Section\
    \ 7.1 discusses the importance of having an MPLS label\n   allocation policy that,\
    \ when ingress replication is used, allows an\n   egress PE to infer the identity\
    \ of a received packet's ingress PE.\n   This issue was first raised in earlier\
    \ work by Xu Xiaohu.\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Eric C. Rosen (editor)\n   Juniper Networks, Inc.\n  \
    \ 10 Technology Park Drive\n   Westford, Massachusetts  01886\n   United States\
    \ of America\n   Email: erosen@juniper.net\n   Karthik Subramanian\n   Sproute\
    \ Networks\n   Email: karthik@sproute.com\n   Zhaohui Zhang\n   Juniper Networks,\
    \ Inc.\n   10 Technology Park Drive\n   Westford, Massachusetts  01886\n   United\
    \ States of America\n   Email: zzhang@juniper.net\n"
