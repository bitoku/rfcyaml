- title: __initial_text__
  contents:
  - '                Aggregation of Diffserv Service Classes

    '
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This memo provides information for the Internet community.\
    \  It does\n   not specify an Internet standard of any kind.  Distribution of\
    \ this\n   memo is unlimited.\n"
- title: Abstract
  contents:
  - "Abstract\n   In the core of a high-capacity network, service differentiation\
    \ may\n   still be needed to support applications' utilization of the network.\n\
    \   Applications with similar traffic characteristics and performance\n   requirements\
    \ are mapped into Diffserv service classes based on end-\n   to-end behavior requirements\
    \ of the applications.  However, some\n   network segments may be configured in\
    \ such a way that a single\n   forwarding treatment may satisfy the traffic characteristics\
    \ and\n   performance requirements of two or more service classes.  In these\n\
    \   cases, it may be desirable to aggregate two or more Diffserv service\n   classes\
    \ into a single forwarding treatment.  This document provides\n   guidelines for\
    \ the aggregation of Diffserv service classes into\n   forwarding treatments.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1.  Introduction . . . . . . . . . . . . . . . . . . .\
    \ . . . . . .  3\n     1.1.  Requirements Notation  . . . . . . . . . . . . .\
    \ . . . . .  4\n   2.  Terminology  . . . . . . . . . . . . . . . . . . . . .\
    \ . . . .  4\n   3.  Overview of Service Class Aggregation  . . . . . . . . .\
    \ . . .  5\n   4.  Service Classes to Treatment Aggregate Mapping . . . . . .\
    \ . .  6\n     4.1.  Mapping Service Classes into Four Treatment Aggregates .\
    \ .  7\n       4.1.1.  Network Control Treatment Aggregate  . . . . . . . . .\
    \  9\n       4.1.2.  Real-Time Treatment Aggregate  . . . . . . . . . . . . 10\n\
    \       4.1.3.  Assured Elastic Treatment Aggregate  . . . . . . . . . 10\n  \
    \     4.1.4.  Elastic Treatment Aggregate  . . . . . . . . . . . . . 12\n   5.\
    \  Treatment Aggregates and Inter-Provider Relationships  . . . . 12\n   6.  Security\
    \ Considerations  . . . . . . . . . . . . . . . . . . . 13\n   7.  Acknowledgements\
    \ . . . . . . . . . . . . . . . . . . . . . . . 13\n   8.  References . . . .\
    \ . . . . . . . . . . . . . . . . . . . . . . 13\n     8.1.  Normative References\
    \ . . . . . . . . . . . . . . . . . . . 13\n     8.2.  Informative References\
    \ . . . . . . . . . . . . . . . . . . 14\n   Appendix A.   Using MPLS for Treatment\
    \ Aggregates  . . . . . . . . 15\n     A.1.  Network Control Treatment Aggregate\
    \ with E-LSP . . . . . . 17\n     A.2.  Real-Time Treatment Aggregate with E-LSP\
    \ . . . . . . . . . 17\n     A.3.  Assured Elastic Treatment Aggregate with E-LSP\
    \ . . . . . . 17\n     A.4.  Elastic Treatment Aggregate with E-LSP . . . . .\
    \ . . . . . 17\n     A.5.  Treatment Aggregates and L-LSP . . . . . . . . . .\
    \ . . . . 18\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   In the core of a high capacity network, it is common for\
    \ the network\n   to be engineered in such a way that a major link, switch, or\
    \ router\n   can fail, and the result will be a routed network that still meets\n\
    \   ambient Service Level Agreements (SLAs).  The implications are that\n   there\
    \ is sufficient capacity on any given link such that all SLAs\n   sold can be\
    \ simultaneously supported at their respective maximum\n   rates, and that this\
    \ remains true after re-routing (either IP re-\n   routing or Multiprotocol Label\
    \ Switching (MPLS) protection-mode\n   switching) has occurred.\n   Over-provisioning\
    \ is generally considered to meet the requirements of\n   all traffic without\
    \ further quality of service (QoS) treatment, and\n   in the general case, that\
    \ is true in high-capacity backbones.\n   However, as the process of network convergence\
    \ continues, and with\n   the increasing speed of the access networks, certain\
    \ services may\n   still have issues.  Delay, jitter, and occasional loss are\
    \ perfectly\n   acceptable for elastic applications.  However, sub-second surges\
    \ that\n   occur in the best-designed of networks [12] affect real-time\n   applications.\
    \  Moreover, denial of service (DoS) loads, worms, and\n   network disruptions\
    \ such as that of 11 September 2001 affect routing\n   [13].  Our objective is\
    \ to prevent disruption to routing (which in\n   turn affects all services) and\
    \ to protect real-time jitter-sensitive\n   services, while minimizing loss and\
    \ delay of sensitive elastic\n   traffic.\n   RFC 4594 [3] defines a set of basic\
    \ Diffserv classes from the points\n   of view of the application requiring specific\
    \ end-to-end behaviors\n   from the network.  The service classes are differentiated\
    \ based on\n   the application payload's tolerance to packet loss, delay, and\
    \ delay\n   variation (jitter).  Different degrees of these criteria form the\n\
    \   foundation for supporting the needs of real-time and elastic traffic.\n  \
    \ RFC 4594 [3] also provides recommendations for the treatment method\n   of these\
    \ service classes.  But, at some network segments of the end-\n   to-end path,\
    \ the number of levels of network treatment\n   differentiation may be less than\
    \ the number of service classes that\n   the network segment needs to support.\
    \  In such a situation, that\n   network segment may use the same treatment to\
    \ support more than one\n   service class.  In this document, we provide guidelines\
    \ on how\n   multiple service classes may be aggregated into a forwarding\n  \
    \ treatment aggregate.  This entails having the IP traffic belonging to\n   service\
    \ classes, expressed using the DSCP (Differentiated Services\n   Code Point),\
    \ as described by RFC 4594 [3].  Note that in a given\n   domain, we may recommend\
    \ that the supported service classes be\n   aggregated into forwarding treatment\
    \ aggregates; however, this does\n   not mean all service classes need to be supported,\
    \ and hence not all\n   forwarding treatment aggregates need to be supported.\
    \  A domain may\n   support a fewer or greater number of forwarding treatment\
    \ aggregates\n   than recommended by this document.  Which service classes and\
    \ which\n   forwarding treatment aggregates are supported by a domain is up to\n\
    \   the domain administration and may be influenced by business reasons\n   or\
    \ other reasons (e.g., operational considerations).\n   In this document, we've\
    \ provided:\n   o  definitions for terminology we use in this document,\n   o\
    \  requirements for performing this aggregation,\n   o  an example of performing\
    \ the aggregation when four treatment\n      aggregates are used, and\n   o  an\
    \ example (in the appendix) of performing this aggregation over\n      MPLS using\
    \ E-LSP, EXP Inferred PHB Scheduling Class (PSC) Label\n      Switched Path (LSP).\n\
    \   The treatment aggregate recommendations are designed to aggregate the\n  \
    \ service classes [3] in such a manner as to protect real-time traffic\n   and\
    \ routing, on the assumption that real-time sessions are protected\n   from each\
    \ other by admission at the edge.  The recommendation given\n   is one possible\
    \ way of performing the aggregation; there may be other\n   ways of aggregation,\
    \ for example, into fewer treatment aggregates or\n   more treatment aggregates.\n\
    \   In the appendix, an example of aggregation over MPLS networks using\n   E-LSP\
    \ to realize the treatment aggregates is provided.  Note that the\n   MPLS E-LSP\
    \ is just an example; this document does not exclude the use\n   of other methods.\
    \  This example only considers aggregation of IP\n   traffic into E-LSP.  The\
    \ use of E-LSP by non-IP traffic is not\n   discussed.\n"
- title: 1.1.  Requirements Notation
  contents:
  - "1.1.  Requirements Notation\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\"\
    , \"SHALL\", \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"\
    MAY\", and \"OPTIONAL\" in this\n   document are to be interpreted as described\
    \ in RFC 2119 [1].\n"
- title: 2.  Terminology
  contents:
  - "2.  Terminology\n   This document assumes the reader is familiar with the terms\
    \ used in\n   differentiated services.  This document provides the definitions\
    \ for\n   new terms introduced by this document and references information\n \
    \  defined in RFCs for existing terms not commonly used in\n   differentiated\
    \ services.\n   For new terms introduced by this document, we provide the definition\n\
    \   here:\n   o  Treatment Aggregate.  This term is defined as the aggregate of\n\
    \      Diffserv service classes [3].  A treatment aggregate is concerned\n   \
    \   only with the forwarding treatment of the aggregated traffic,\n      which\
    \ may be marked with multiple DSCPs.  A treatment aggregate\n      differs from\
    \ Behavior Aggregate [2] and Traffic Aggregate [14],\n      each of which indicate\
    \ the aggregated traffic having a single\n      Diffserv codepoint and utilizing\
    \ a single Per Hop Behavior (PHB).\n   For terms from existing RFCs, we provide\
    \ the reference to the\n   appropriate section of the relevant RFC that contain\
    \ the definition:\n   o  Real-Time and Elastic Applications and their traffic.\
    \  Section 3.1\n      of RFC 1633 [4].\n   o  Diffserv Service Class.  Section\
    \ 1.3 of RFC 4594 [3].\n   o  MPLS E-LSP, EXP Inferred PHB Scheduling Class (PSC)\
    \ Label Switched\n      Path (LSP).  Section 1.2 of RFC 3270 [6].\n   o  MPLS\
    \ L-LSP, Label Only Inferred PHB Scheduling Class (PSC) Label\n      Switched\
    \ Path (LSP).  Section 1.3 of RFC 3270 [6].\n"
- title: 3.  Overview of Service Class Aggregation
  contents:
  - "3.  Overview of Service Class Aggregation\n   In Diffserv domains where less\
    \ fine-grained traffic treatment\n   differentiation is provided, aggregation\
    \ of the different service\n   classes [3] may be required.\n   These aggregations\
    \ have the following requirements:\n   1.  The end-to-end network performance\
    \ characteristic required by the\n       application MUST be supported.  This\
    \ performance characteristic\n       is represented by the use of Diffserv service\
    \ classes [3].\n   2.  The treatment aggregate MUST meet the strictest requirements\
    \ of\n       its member service classes.\n   3.  The treatment aggregate SHOULD\
    \ only contain member service\n       classes with similar traffic characteristic\
    \ and performance\n       requirements.\n   4.  The notion of the individual end-to-end\
    \ service classes MUST NOT\n       be destroyed when aggregation is performed.\
    \  Each domain along\n       the end-to-end path may perform aggregation differently,\
    \ based on\n       the original end-to-end service classes.  We recommend an easy\n\
    \       way to accomplish this by not altering the DSCP used to indicate\n   \
    \    the end-to-end service class.  But some administrative domains\n       may\
    \ require the use of their own marking; when this is needed,\n       the original\
    \ end-to-end service class indication must be restored\n       upon exiting such\
    \ administrative domains.  One possible way of\n       achieving this is with\
    \ the use of tunnels to encapsulate the end-\n       to-end traffic.\n   5.  Each\
    \ treatment aggregate has limited resources; hence, traffic\n       conditioning\
    \ and/or admission control SHOULD be performed for\n       each service class\
    \ aggregated into the treatment aggregate.\n       Additional admission control\
    \ and policing may be used on the sum\n       of all traffic aggregated into the\
    \ treatment aggregate.\n   In addition to the above requirements, we have the\
    \ following\n   suggestions:\n   1.  The treatment aggregate and assigned resources\
    \ may consider\n       historical traffic patterns and the variability of these\n\
    \       patterns.  For example, a point-point service (e.g., pseudowire)\n   \
    \    may have a very predictable pattern, while a multipoint service\n       (e.g.,\
    \ VPLS, Virtual Private LAN Service) may have a much less\n       predictable\
    \ pattern.\n   2.  In addition to Diffserv, other controls are available to\n\
    \       influence the traffic level offered to a particular traffic\n       aggregate.\
    \  These include adjustment of routing metrics, and\n       usage of MPLS-based\
    \ traffic engineering techniques.\n   This document only describes the aggregation\
    \ of IP traffic based on\n   the use of Diffserv service classes [3].\n"
- title: 4.  Service Classes to Treatment Aggregate Mapping
  contents:
  - "4.  Service Classes to Treatment Aggregate Mapping\n   The service class and\
    \ DSCP selection in RFC 4594 [3] has been defined\n   to allow, in many instances,\
    \ mapping of two or possibly more service\n   classes into a single forwarding\
    \ treatment aggregate.  Notice that\n   there is a relationship/trade-off between\
    \ link speed, queue depth,\n   delay, and jitter.  The degree of aggregation and\
    \ hence the number of\n   treatment aggregates will depend on the aggregation's\
    \ impacts on\n   loss, delay, and jitter.  This depends on whether the speed of\
    \ the\n   links and scheduler behavior, being used to implement the\n   aggregation,\
    \ can minimize the effects of mixing traffic with\n   different packet sizes and\
    \ transmit rates on queue depth.  A general\n   rule-of-thumb is that higher link\
    \ speeds allow for more aggregation/\n   smaller number of treatment aggregates,\
    \ assuming link utilization is\n   within the engineered level.\n"
- title: 4.1.  Mapping Service Classes into Four Treatment Aggregates
  contents:
  - "4.1.  Mapping Service Classes into Four Treatment Aggregates\n   This section\
    \ provides an example of mapping all the service classes\n   defined in RFC 4594\
    \ [3] into four treatment aggregates.  The use of\n   four treatment aggregates\
    \ assumes that the resources allocated to\n   each treatment aggregate are sufficient\
    \ to honor the required\n   behavior of each service class [3].  We use the performance\n\
    \   requirement (tolerance to loss, delay, and jitter) from the\n   application/end-user\
    \ as a guide on how to map the service classes\n   into treatment aggregates.\
    \  We have also used section 3.1 of RFC 1633\n   [4] to provide us with guidance\
    \ on the definition of Real-Time and\n   Elastic applications.  An overview of\
    \ the mapping between service\n   classes and the four treatment aggregates is\
    \ provided by Figure 1,\n   with the mapping being based on performance requirements.\
    \  In Figure\n   1, the right side columns of \"Service Class\" and \"Tolerance\
    \ to Loss/\n   Delay/Jitter\" are from Figure 2 of RFC 4594 [3].\n   It is recommended\
    \ that certain service classes be mapped into\n   specific treatment aggregates.\
    \  But this does not mean that all the\n   service classes recommended for that\
    \ treatment aggregate need to be\n   supported.  Hence, for a given domain, a\
    \ treatment aggregate may\n   contain only a subset of the service classes recommended\
    \ in this\n   document, i.e., the service classes supported by that domain.  A\n\
    \   domain's treatment of non-supported service classes should be based\n   on\
    \ the domain's local policy.  This local policy may be influenced by\n   its agreement\
    \ with its customers.  Such treatment may use the Elastic\n   Treatment Aggregate,\
    \ dropping the packets, or some other\n   arrangements.\n   Our example of four\
    \ treatment aggregates is based on the basic\n   differences in performance requirement\
    \ from the application/end-user\n   perspective.  A domain may choose to support\
    \ more or fewer treatment\n   aggregates than the four recommended.  For example,\
    \ a domain may\n   support only three treatment aggregates and map any network\
    \ control\n   traffic into the Assured Elastic treatment aggregate.  This is a\n\
    \   choice the administrative domain has.  Hence, this example of four\n   treatment\
    \ aggregates does not represent a minimum required set of\n   treatment aggregates\
    \ one must implement; nor does it represent the\n   maximum set of treatment aggregates\
    \ one can implement.\n  ---------------------------------------------------------------------\n\
    \ |Treatment |    Tolerance to    ||Service Class  |    Tolerance to    |\n |Aggregate\
    \ | Loss |Delay |Jitter||               | Loss |Delay |Jitter|\n |==========+======+======+======++===============+======+======+======|\n\
    \ | Network  | Low  | Low  | Yes  || Network       |  Low |  Low | Yes  |\n |\
    \ Control  |      |      |      || Control       |      |      |      |\n |==========+======+======+======++===============+======+======+======|\n\
    \ | Real-    | Very | Very | Very ||  Telephony    | VLow | VLow | VLow |\n |\
    \ Time     | Low  | Low  | Low  ||---------------+------+------+------|\n |  \
    \        |      |      |      ||   Signaling   | Low  | Low  | Yes  |\n |    \
    \      |      |      |      ||---------------+------+------+------|\n |      \
    \    |      |      |      ||  Multimedia   |Low - | Very | Low  |\n |        \
    \  |      |      |      || Conferencing  |Medium| Low  |      |\n |          |\
    \      |      |      ||---------------+------+------+------|\n |          |  \
    \    |      |      ||   Real-time   | Low  | Very | Low  |\n |          |    \
    \  |      |      ||  Interactive  |      | Low  |      |\n |          |      |\
    \      |      ||---------------+------+------+------|\n |          |      |  \
    \    |      ||   Broadcast   | Very |Medium| Low  |\n |          |      |    \
    \  |      ||     Video     | Low  |      |      |\n |==========+======+======+======++===============+======+======+======|\n\
    \ | Assured  | Low  |Low - | Yes  ||  Multimedia   |Low - |Medium| Yes  |\n |\
    \ Elastic  |      |Medium|      ||   Streaming   |Medium|      |      |\n |  \
    \        |      |      |      ||---------------+------+------+------|\n |    \
    \      |      |      |      ||  Low-Latency  | Low  |Low - | Yes  |\n |      \
    \    |      |      |      ||      Data     |      |Medium|      |\n |        \
    \  |      |      |      ||---------------+------+------+------|\n |          |\
    \      |      |      ||      OAM      | Low  |Medium| Yes  |\n |          |  \
    \    |      |      ||---------------+------+------+------|\n |          |    \
    \  |      |      ||High-Throughput| Low  |Medium| Yes  |\n |          |      |\
    \      |      ||      Data     |      |- High|      |\n |==========+======+======+======++===============+======+======+======|\n\
    \ | Elastic  |  Not Specified     ||   Standard    |  Not Specified     |\n |\
    \          |      |      |      ||---------------+------+------+------|\n |  \
    \        |      |      |      || Low-Priority  | High | High | Yes  |\n |    \
    \      |      |      |      ||      Data     |      |      |      |\n  ---------------------------------------------------------------------\n\
    \        Figure 1: Treatment Aggregate and Service Class Performance\n       \
    \                        Requirements\n   As we are recommending to preserve the\
    \ notion of the individual end-\n   to-end service classes, we also recommend\
    \ that the original DSCP\n   field marking not be changed when treatment aggregates\
    \ are used.\n   Instead, classifiers that select packets based on the contents\
    \ of the\n   DSCP field should be used to direct packets from the member Diffserv\n\
    \   service classes into the queue that handles each of the treatment\n   aggregates,\
    \ without remarking the DSCP field of the packets.  This is\n   summarized in\
    \ Figure 2, which shows the behavior each treatment\n   aggregate should have,\
    \ and the DSCP field marking of the packets that\n   should be classified into\
    \ each of the treatment aggregates.\n    ------------------------------------------------------------\n\
    \   |Treatment |Treatment || DSCP                                |\n   |Aggregate\
    \ |Aggregate ||                                     |\n   |          |Behavior\
    \  ||                                     |\n   |==========+==========++=====================================|\n\
    \   | Network  | CS       || CS6                                 |\n   | Control\
    \  |(RFC 2474)||                                     |\n   |==========+==========++=====================================|\n\
    \   | Real-    | EF       || EF, CS5, AF41, AF42, AF43, CS4, CS3 |\n   | Time\
    \     |(RFC 3246)||                                     |\n   |==========+==========++=====================================|\n\
    \   | Assured  | AF       || CS2, AF31, AF21, AF11               |\n   | Elastic\
    \  |(RFC 2597)||-------------------------------------|\n   |          |      \
    \    || AF32, AF22, AF12                    |\n   |          |          ||-------------------------------------|\n\
    \   |          |          || AF33, AF23, AF13                    |\n   |==========+==========++=====================================|\n\
    \   | Elastic  | Default  || Default, (CS0)                      |\n   |     \
    \     |(RFC 2474)||-------------------------------------|\n   |          |   \
    \       || CS1                                 |\n    ------------------------------------------------------------\n\
    \                  Figure 2: Treatment Aggregate Behavior\n   Notes for Figure\
    \ 2: For Assured Elastic and Elastic Treatment\n   Aggregates, please see sections\
    \ 4.1.3 and 4.1.4, respectively, for\n   details on additional priority within\
    \ the treatment aggregate.\n"
- title: 4.1.1.  Network Control Treatment Aggregate
  contents:
  - "4.1.1.  Network Control Treatment Aggregate\n   The Network Control Treatment\
    \ Aggregate aggregates all service\n   classes that are functionally necessary\
    \ for the survival of a network\n   during a DoS attack or other high-traffic\
    \ load interval.  The theory\n   is that whatever else is true, the network must\
    \ protect itself.  This\n   includes the traffic that RFC 4594 [3] characterizes\
    \ as being\n   included in the Network Control service class.\n   Traffic in the\
    \ Network Control Treatment Aggregate should be carried\n   in a common queue\
    \ or class with a PHB as described in RFC 2474 [2],\n   section 4.2.2.2 for Class\
    \ Selector (CS).  This treatment aggregate\n   should have a lower probability\
    \ of packet loss and bear a relatively\n   deep target mean queue depth (min-threshold\
    \ if RED (Random Early\n   Detection) is being used).\n   Please notice this Network\
    \ Control Treatment Aggregate is meant to be\n   used for the customer's network\
    \ control traffic.  The provider may\n   choose to treat its own network control\
    \ traffic differently, perhaps\n   in its own service class that is not aggregated\
    \ with the customer's\n   network control traffic.\n"
- title: 4.1.2.  Real-Time Treatment Aggregate
  contents:
  - "4.1.2.  Real-Time Treatment Aggregate\n   The Real-Time Treatment Aggregate aggregates\
    \ all real-time\n   (inelastic) service classes.  The theory is that real-time\
    \ traffic is\n   admitted under some model and controlled by an SLA managed at\
    \ the\n   edge of the network prior to aggregation.  As such, there is a\n   predictable\
    \ and enforceable upper bound on the traffic that can enter\n   such a queue,\
    \ and to provide predictable variation in delay it must\n   be protected from\
    \ bursts of elastic traffic.  The predictability of\n   traffic level may be based\
    \ upon admission control for a well-known\n   community of interest (e.g., a point-point\
    \ service) and/or based upon\n   historical measurements.\n   This treatment aggregate\
    \ may include the following service classes\n   from the Diffserv service classes\
    \ [3], in addition to other locally\n   defined classes: Telephony, Signaling,\
    \ Multimedia Conferencing, Real-\n   time Interactive, and Broadcast Video.\n\
    \   Traffic in each service class that is going to be aggregated into the\n  \
    \ treatment aggregate should be conditioned prior to aggregation.  It\n   is recommended\
    \ that per-service-class admission control procedures be\n   used, followed by\
    \ per-service-class policing so that any individual\n   service class does not\
    \ generate more than what it is allowed.\n   Furthermore, additional admission\
    \ control and policing may be used on\n   the sum of all traffic aggregated into\
    \ this treatment aggregate.\n   Traffic in the Real-Time Treatment Aggregate should\
    \ be carried in a\n   common queue or class with a PHB (Per Hop Behavior) as described\
    \ in\n   RFC 3246 [9] and RFC 3247 [10].\n"
- title: 4.1.3.  Assured Elastic Treatment Aggregate
  contents:
  - "4.1.3.  Assured Elastic Treatment Aggregate\n   The Assured Elastic Treatment\
    \ Aggregate aggregates all elastic\n   traffic that uses the Assured Forwarding\
    \ model as described in RFC\n   2597 [8].  The premise of such a service is that\
    \ an SLA that is\n   negotiated includes a \"committed rate\" and the ability\
    \ to exceed that\n   rate (and perhaps a second \"excess rate\") in exchange for\
    \ a higher\n   probability of loss using Active Queue Management (AQM) [7] or\n\
    \   Explicit Congestion Notification (ECN) marking [11] for the portion\n   of\
    \ traffic deemed to be in excess.\n   This treatment aggregate may include the\
    \ following service classes\n   from the Diffserv service classes [3], in addition\
    \ to other locally\n   defined classes: Multimedia Streaming, Low Latency Data,\
    \ OAM, and\n   High-Throughput Data.\n   The DSCP values belonging to the Assured\
    \ Forwarding (AF) PHB group\n   and class selector of the original service classes\
    \ remain an\n   important consideration and should be preserved during aggregation.\n\
    \   This treatment aggregate should maintain the AF PHB group marking of\n   the\
    \ original packet.  For example, AF3x marked packets should remain\n   AF3x marked\
    \ within this treatment aggregate.  In addition, the class\n   selector DSCP value\
    \ should not be changed.  Traffic bearing these\n   DSCPs is carried in a common\
    \ queue or class with a PHB as described\n   in RFC 2597 [8].  In effect, appropriate\
    \ target rate thresholds have\n   been applied at the edge, dividing traffic into\
    \ AFn1 (committed, for\n   any value of n), AFn2, and AFn3 (excess).  The service\
    \ should be\n   engineered so that AFn1 and CS2 marked packet flows have sufficient\n\
    \   bandwidth in the network to provide high assurance of delivery.\n   Since\
    \ the traffic is elastic and responds dynamically to packet loss,\n   Active Queue\
    \ Management [7] should be used primarily to reduce the\n   forwarding rate to\
    \ the minimum assured rate at congestion points.\n   The probability of loss of\
    \ AFn1 and CS2 traffic must not exceed the\n   probability of loss of AFn2 traffic,\
    \ which in turn must not exceed\n   the probability of loss of AFn3 traffic.\n\
    \   If RED [7] is used as an AQM algorithm, the min-threshold specifies a\n  \
    \ target queue depth for each of AFn1+CS2, AFn2, and AFn3, and the max-\n   threshold\
    \ specifies the queue depth above which all traffic with such\n   a DSCP is dropped\
    \ or ECN marked.  Thus, in this treatment aggregate,\n   the following inequalities\
    \ SHOULD hold in queue configurations:\n   o  min-threshold AFn3 < max-threshold\
    \ AFn3\n   o  max-threshold AFn3 <= min-threshold AFn2\n   o  min-threshold AFn2\
    \ < max-threshold AFn2\n   o  max-threshold AFn2 <= min-threshold AFn1+CS2\n \
    \  o  min-threshold AFn1+CS2 < max-threshold AFn1+CS2\n   o  max-threshold AFn1+CS2\
    \ <= memory assigned to the queue\n   Note: This configuration tends to drop AFn3\
    \ traffic before AFn2, and\n   AFn2 before AFn1 and CS2.  Many other AQM algorithms\
    \ exist and are\n   used; they should be configured to achieve a similar result.\n"
- title: 4.1.4.  Elastic Treatment Aggregate
  contents:
  - "4.1.4.  Elastic Treatment Aggregate\n   The Elastic Treatment Aggregate aggregates\
    \ all remaining elastic\n   traffic.  The premise of such a service is that there\
    \ is no intrinsic\n   SLA differentiation of traffic, but that AQM [7] or ECN\
    \ flagging [11]\n   is appropriate for such traffic.\n   This treatment aggregate\
    \ may include the following service classes\n   from the Diffserv service classes\
    \ [3], in addition to other locally\n   defined classes: Standard and Low-Priority\
    \ Data.\n   Treatment aggregates should be well specified, each indicating the\n\
    \   service classes it will handle.  But in cases where unspecified or\n   unknown\
    \ service classes are encountered, they may be dropped or be\n   treated using\
    \ the Elastic Treatment Aggregate.  The choice of how to\n   treat unspecified\
    \ service classes should be well defined, based on\n   some agreements.\n   Traffic\
    \ in the Elastic Treatment Aggregate should be carried in a\n   common queue or\
    \ class with a PHB as described in RFC 2474 [2],\n   section 4.1, \"A Default\
    \ PHB\".  The AQM thresholds for Elastic traffic\n   MAY be separately set, so\
    \ that Low Priority Data traffic is dropped\n   before Standard traffic, but this\
    \ is not a requirement.\n"
- title: 5.  Treatment Aggregates and Inter-Provider Relationships
  contents:
  - "5.  Treatment Aggregates and Inter-Provider Relationships\n   When treatment\
    \ aggregates are used at provider boundaries, we\n   recommend that the inter-provider\
    \ relationship be based on Diffserv\n   service classes [3].  This allows the\
    \ admission control into each\n   treatment aggregate of a provider domain to\
    \ be based on the admission\n   control of traffic into the supported service\
    \ classes, as indicated\n   by the discussion in section 4 of this document.\n\
    \   If the inter-provider relationship needs to be based on treatment\n   aggregates\
    \ specified by this document, then the exact treatment\n   aggregate content and\
    \ representation must be agreed to by the peering\n   providers.\n   Some additional\
    \ work on inter-provider relationships is provided by\n   inter-provider QoS [15],\
    \ where details on supporting real-time\n   services between service providers\
    \ are discussed.  Some related work\n   in ITU-T provided by Appendix VI of Y.1541\
    \ [16] may also help with\n   inter-provider relationships, especially with international\n\
    \   providers.\n"
- title: 6.  Security Considerations
  contents:
  - "6.  Security Considerations\n   This document discusses the policy of using Differentiated\
    \ Services\n   and its service classes.  If implemented as described, it should\n\
    \   require that the network do nothing that the network has not already\n   allowed.\
    \  If that is the case, no new security issues should arise\n   from the use of\
    \ such a policy.\n   As this document is based on RFC 4594 [3], the Security Consideration\n\
    \   discussion of no new security issues indicated by RFC 4594 [3] also\n   applies\
    \ to treatment aggregates of this document.\n"
- title: 7.  Acknowledgements
  contents:
  - "7.  Acknowledgements\n   This document has benefited from discussions with numerous\
    \ people,\n   especially Shane Amante, Brian Carpenter, and Dave McDysan.  It\
    \ has\n   also benefited from detailed reviews by David Black, Marvin Krym,\n\
    \   Bruce Davie, Fil Dickinson, and Julie Ann Connary.\n"
- title: 8.  References
  contents:
  - '8.  References

    '
- title: 8.1.  Normative References
  contents:
  - "8.1.  Normative References\n   [1]   Bradner, S., \"Key words for use in RFCs\
    \ to Indicate Requirement\n         Levels\", BCP 14, RFC 2119, March 1997.\n\
    \   [2]   Nichols, K., Blake, S., Baker, F., and D. Black, \"Definition of\n \
    \        the Differentiated Services Field (DS Field) in the IPv4 and\n      \
    \   IPv6 Headers\", RFC 2474, December 1998.\n   [3]   Babiarz, J., Chan, K.,\
    \ and F. Baker, \"Configuration Guidelines\n         for DiffServ Service Classes\"\
    , RFC 4594, August 2006.\n   [4]   Braden, B., Clark, D., and S. Shenker, \"Integrated\
    \ Services in\n         the Internet Architecture: an Overview\", RFC 1633, June\
    \ 1994.\n   [5]   Black, D., \"Differentiated Services and Tunnels\", RFC 2983,\n\
    \         October 2000.\n   [6]   Le Faucheur, F., Wu, L., Davie, B., Davari,\
    \ S., Vaananen, P.,\n         Krishnan, R., Cheval, P., and J. Heinanen, \"Multi-Protocol\n\
    \         Label Switching (MPLS) Support of Differentiated Services\",\n     \
    \    RFC 3270, May 2002.\n   [7]   Braden, B., Clark, D., Crowcroft, J., Davie,\
    \ B., Deering, S.,\n         Estrin, D., Floyd, S., Jacobson, V., Minshall, G.,\
    \ Partridge,\n         C., Peterson, L., Ramakrishnan, K., Shenker, S., Wroclawski,\n\
    \         J., and L. Zhang, \"Recommendations on Queue Management and\n      \
    \   Congestion Avoidance in the Internet\", RFC 2309, April 1998.\n   [8]   Heinanen,\
    \ J., Baker, F., Weiss, W., and J. Wroclawski, \"Assured\n         Forwarding\
    \ PHB Group\", RFC 2597, June 1999.\n   [9]   Davie, B., Charny, A., Bennet, J.,\
    \ Benson, K., Le Boudec, J.,\n         Courtney, W., Davari, S., Firoiu, V., and\
    \ D. Stiliadis, \"An\n         Expedited Forwarding PHB (Per-Hop Behavior)\",\
    \ RFC 3246,\n         March 2002.\n   [10]  Charny, A., Bennet, J., Benson, K.,\
    \ Boudec, J., Chiu, A.,\n         Courtney, W., Davari, S., Firoiu, V., Kalmanek,\
    \ C., and K.\n         Ramakrishnan, \"Supplemental Information for the New Definition\n\
    \         of the EF PHB (Expedited Forwarding Per-Hop Behavior)\",\n         RFC\
    \ 3247, March 2002.\n   [11]  Ramakrishnan, K., Floyd, S., and D. Black, \"The\
    \ Addition of\n         Explicit Congestion Notification (ECN) to IP\", RFC 3168,\n\
    \         September 2001.\n"
- title: 8.2.  Informative References
  contents:
  - "8.2.  Informative References\n   [12]  Choi, B., Moon, S., Zhang, Z., Papagiannaki,\
    \ K., and C. Diot,\n         \"Analysis of Point-To-Point Packet Delay in an Operational\n\
    \         Network\", INFOCOMM 2004, March 2004,\n         <http://www.ieee-infocom.org/2004/Papers/37_4.PDF>.\n\
    \   [13]  Ogielski, A. and J. Cowie, \"Internet Routing Behavior on 9/11\",\n\
    \         March 2002, <http://www.renesys.com/tech/presentations/pdf/\n      \
    \   renesys-030502-NRC-911.pdf>.\n   [14]  Nichols, K. and B. Carpenter, \"Definition\
    \ of Differentiated\n         Services Per Domain Behaviors and Rules for their\n\
    \         Specification\", RFC 3086, April 2001.\n   [15]  MIT Communications\
    \ Futures Program, \"Inter-provider Quality of\n         Service\", November 2006,\
    \ <\n         http://cfp.mit.edu/resources/papers/Interprovider QoS\n        \
    \ MIT_CFP_WP_9_14_06.pdf>.\n   [16]  International Telecommunications Union, \"\
    Network Performance\n         Objectives for IP-Based Services\", Recommendation\
    \ Y.1541,\n         February 2006.\n"
- title: Appendix A.  Using MPLS for Treatment Aggregates
  contents:
  - "Appendix A.  Using MPLS for Treatment Aggregates\n   RFC 2983 on Diffserv and\
    \ Tunnels [5] and RFC 3270 on MPLS Support of\n   Diffserv [6] provide a very\
    \ good background on this topic.  This\n   document provides an example of using\
    \ the E-LSP, EXP Inferred PHB\n   Scheduled Class (PSC) Label Switched Path (LSP),\
    \ defined by MPLS\n   Support of Diffserv [6] for realizing the Treatment Aggregates.\n\
    \   When treatment aggregates are represented in MPLS using EXP Inferred\n   PSC\
    \ LSP, we recommend the following usage of the MPLS EXP field for\n   treatment\
    \ aggregates.\n    -------------------------------------------\n   |Treatment\
    \ || MPLS ||  DSCP   |   DSCP      |\n   |Aggregate || EXP  ||  name   |   value\
    \     |\n   |==========++======++=========|=============|\n   | Network  || 110\
    \  ||  CS6    |   110000    |\n   | Control  ||      ||         |            \
    \ |\n   |==========++======++=========|=============|\n   | Real-    || 100  ||\
    \  EF     |   101110    |\n   | Time     ||      ||---------|-------------|\n\
    \   |          ||      ||  CS5    |   101000    |\n   |          ||      ||---------|-------------|\n\
    \   |          ||      ||AF41,AF42|100010,100100|\n   |          ||      ||  AF43\
    \   |   100110    |\n   |          ||      ||---------|-------------|\n   |  \
    \        ||      ||  CS4    |   100000    |\n   |          ||      ||---------|-------------|\n\
    \   |          ||      ||  CS3    |   011000    |\n   |==========++======++=========|=============|\n\
    \   | Assured  || 010* ||  CS2    |   010000    |\n   | Elastic  ||      ||  AF31\
    \   |   011010    |\n   |          ||      ||  AF21   |   010010    |\n   |  \
    \        ||      ||  AF11   |   001010    |\n   |          ||------||---------|-------------|\n\
    \   |          || 011* ||  AF32   |   011100    |\n   |          ||      ||  AF22\
    \   |   010100    |\n   |          ||      ||  AF12   |   001100    |\n   |  \
    \        ||      ||  AF33   |   011110    |\n   |          ||      ||  AF23  \
    \ |   010110    |\n   |          ||      ||  AF13   |   001110    |\n   |==========++======++=========|=============|\n\
    \   | Elastic  || 000* || Default |   000000    |\n   |          ||      || (CS0)\
    \   |             |\n   |          ||------||---------|-------------|\n   |  \
    \        || 001* ||  CS1    |   001000    |\n    -------------------------------------------\n\
    \          Figure 3: Treatment Aggregate and MPLS EXP Field Usage\n      * Note:\
    \ For Assured Elastic (and Elastic) Treatment Aggregate, the\n      usage of 010\
    \ or 011 (000 or 001) as EXP field value depends on the\n      drop probability.\
    \  Packets in the LSP with EXP field of 011 (001)\n      have a higher probability\
    \ of being dropped than packets with an\n      EXP field of 010 (000).\n   The\
    \ above table indicates the recommended usage of EXP fields for\n   treatment\
    \ aggregates.  Because many deployments of MPLS are on a per-\n   domain basis,\
    \ each domain has total control of its EXP usage and each\n   domain may use a\
    \ different EXP field allocation for the domain's\n   supported treatment aggregates.\n"
- title: A.1.  Network Control Treatment Aggregate with E-LSP
  contents:
  - "A.1.  Network Control Treatment Aggregate with E-LSP\n   The usage of E-LSP for\
    \ Network Control Treatment Aggregate needs to\n   adhere to the recommendations\
    \ indicated in section 4.1.1 of this\n   document and section 3.2 of RFC 4594\
    \ [3].  Reinforcing these\n   recommendations, there should be no drop precedence\
    \ associated with\n   the MPLS PSC used for Network Control Treatment Aggregate\
    \ because\n   dropping of Network Control Treatment Aggregate traffic should be\n\
    \   prevented.\n"
- title: A.2.  Real-Time Treatment Aggregate with E-LSP
  contents:
  - "A.2.  Real-Time Treatment Aggregate with E-LSP\n   In addition to the recommendations\
    \ provided in section 4.1.2 of this\n   document and in member service classes'\
    \ sections of RFC 4594 [3], we\n   want to indicate that Real-Time Treatment Aggregate\
    \ traffic should\n   not be dropped, as some of the applications whose traffic\
    \ is carried\n   in the Real-Time Treatment Aggregate do not react well to dropped\n\
    \   packets.  As indicated in section 4.1.2 of this document, admission\n   control\
    \ should be performed on each service class contributing to the\n   Real-Time\
    \ Treatment Aggregate to prevent packet loss due to\n   insufficient resources\
    \ allocated to Real-Time Treatment Aggregate.\n   Further, admission control and\
    \ policing may also be applied on the\n   sum of all traffic aggregated into this\
    \ treatment aggregate.\n"
- title: A.3.  Assured Elastic Treatment Aggregate with E-LSP
  contents:
  - "A.3.  Assured Elastic Treatment Aggregate with E-LSP\n   EXP field markings of\
    \ 010 and 011 are used for the Assured Elastic\n   Treatment Aggregate.  The two\
    \ encodings are used to provide two\n   levels of drop precedence indications,\
    \ with 010 encoded traffic\n   having a lower probability of being dropped than\
    \ 011 encoded traffic.\n   This provides for the mapping of CS2, AF31, AF21, and\
    \ AF11 into EXP\n   010; and AF32, AF22, AF12 and AF33, AF23, AF13 into EXP 011.\
    \  If the\n   domain chooses to support only one drop precedence for this treatment\n\
    \   aggregate, we recommend the use of 010 for EXP field marking.\n"
- title: A.4.  Elastic Treatment Aggregate with E-LSP
  contents:
  - "A.4.  Elastic Treatment Aggregate with E-LSP\n   EXP field markings of 000 and\
    \ 001 are used for the Elastic Treatment\n   Aggregate.  The two encodings are\
    \ used to provide two levels of drop\n   precedence indications, with 000 encoded\
    \ traffic having a lower\n   probability of being dropped than 001 encoded traffic.\
    \  This provides\n   for the mapping of Default/CS0 into 000; and CS1 into 001.\
    \  Notice\n   that with this mapping, during congestion, CS1-marked traffic may\
    \ be\n   starved.  If the domain chooses to support only one drop precedence\n\
    \   for this treatment aggregate, we recommend the use of 000 for EXP\n   field\
    \ marking.\n"
- title: A.5.  Treatment Aggregates and L-LSP
  contents:
  - "A.5.  Treatment Aggregates and L-LSP\n   Because L-LSP (Label Only Inferred PSC\
    \ LSP) supports a single PSC per\n   LSP, the support of each treatment aggregate\
    \ is on a per-LSP basis.\n   This document does not further specify any additional\
    \ recommendation\n   (beyond what has been indicated in section 4 of this document)\
    \ for\n   treatment aggregate to L-LSP mapping, leaving this to each individual\n\
    \   MPLS domain administration.\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Kwok Ho Chan\n   Nortel\n   600 Technology Park Drive\n\
    \   Billerica, MA  01821\n   US\n   Phone: +1-978-288-8175\n   Fax:   +1-978-288-8700\n\
    \   EMail: khchan@nortel.com\n   Jozef Z. Babiarz\n   Nortel\n   3500 Carling\
    \ Avenue\n   Ottawa, Ont.  K2H 8E9\n   Canada\n   Phone: +1-613-763-6098\n   Fax:\
    \   +1-613-768-2231\n   EMail: babiarz@nortel.com\n   Fred Baker\n   Cisco Systems\n\
    \   1121 Via Del Rey\n   Santa Barbara, CA  93117\n   US\n   Phone: +1-408-526-4257\n\
    \   Fax:   +1-413-473-2403\n   EMail: fred@cisco.com\n"
- title: Full Copyright Statement
  contents:
  - "Full Copyright Statement\n   Copyright (C) The IETF Trust (2008).\n   This document\
    \ is subject to the rights, licenses and restrictions\n   contained in BCP 78,\
    \ and except as set forth therein, the authors\n   retain all their rights.\n\
    \   This document and the information contained herein are provided on an\n  \
    \ \"AS IS\" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS\n  \
    \ OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST AND\n   THE\
    \ INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS\n   OR IMPLIED,\
    \ INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF\n   THE INFORMATION\
    \ HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED\n   WARRANTIES OF MERCHANTABILITY\
    \ OR FITNESS FOR A PARTICULAR PURPOSE.\n"
- title: Intellectual Property
  contents:
  - "Intellectual Property\n   The IETF takes no position regarding the validity or\
    \ scope of any\n   Intellectual Property Rights or other rights that might be\
    \ claimed to\n   pertain to the implementation or use of the technology described\
    \ in\n   this document or the extent to which any license under such rights\n\
    \   might or might not be available; nor does it represent that it has\n   made\
    \ any independent effort to identify any such rights.  Information\n   on the\
    \ procedures with respect to rights in RFC documents can be\n   found in BCP 78\
    \ and BCP 79.\n   Copies of IPR disclosures made to the IETF Secretariat and any\n\
    \   assurances of licenses to be made available, or the result of an\n   attempt\
    \ made to obtain a general license or permission for the use of\n   such proprietary\
    \ rights by implementers or users of this\n   specification can be obtained from\
    \ the IETF on-line IPR repository at\n   http://www.ietf.org/ipr.\n   The IETF\
    \ invites any interested party to bring to its attention any\n   copyrights, patents\
    \ or patent applications, or other proprietary\n   rights that may cover technology\
    \ that may be required to implement\n   this standard.  Please address the information\
    \ to the IETF at\n   ietf-ipr@ietf.org.\n"
