- contents:
  - '                 Virtual Hub-and-Spoke in BGP/MPLS VPNs

    '
  title: __initial_text__
- contents:
  - "Abstract\n   With BGP/MPLS Virtual Private Networks (VPNs), providing any-to-any\n
    \  connectivity among sites of a given VPN would require each Provider\n   Edge
    (PE) router connected to one or more of these sites to hold all\n   the routes
    of that VPN.  The approach described in this document\n   allows the VPN service
    provider to reduce the number of PE routers\n   that have to maintain all these
    routes by requiring only a subset of\n   these routers to maintain all these routes.\n
    \  Furthermore, when PE routers use ingress replication to carry the\n   multicast
    traffic of VPN customers, the approach described in this\n   document may, under
    certain circumstances, reduce bandwidth\n   inefficiency associated with ingress
    replication and redistribute the\n   replication load among PE routers.\n"
  title: Abstract
- contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This
    document is a product of the Internet Engineering Task Force\n   (IETF).  It represents
    the consensus of the IETF community.  It has\n   received public review and has
    been approved for publication by the\n   Internet Engineering Steering Group (IESG).
    \ Further information on\n   Internet Standards is available in Section 2 of RFC
    5741.\n   Information about the current status of this document, any errata,\n
    \  and how to provide feedback on it may be obtained at\n   http://www.rfc-editor.org/info/rfc7024.\n"
  title: Status of This Memo
- contents:
  - "Copyright Notice\n   Copyright (c) 2013 IETF Trust and the persons identified
    as the\n   document authors.  All rights reserved.\n   This document is subject
    to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n
    \  (http://trustee.ietf.org/license-info) in effect on the date of\n   publication
    of this document.  Please review these documents\n   carefully, as they describe
    your rights and restrictions with respect\n   to this document.  Code Components
    extracted from this document must\n   include Simplified BSD License text as described
    in Section 4.e of\n   the Trust Legal Provisions and are provided without warranty
    as\n   described in the Simplified BSD License.\n"
  title: Copyright Notice
- contents:
  - "Table of Contents\n   1. Overview ........................................................3\n
    \  2. Specification of Requirements ...................................4\n   3.
    Routing Information Exchange ....................................5\n   4. Forwarding
    Considerations .......................................7\n   5. Internet Connectivity
    ...........................................9\n   6. Deployment Considerations
    ......................................12\n   7. Multicast Considerations .......................................13\n
    \     7.1. Terminology ...............................................14\n      7.2.
    Eligible Upstream Multicast Hop (UMH) Routes ..............14\n      7.3. Originating
    VPN-IP Default Route by a V-Hub ...............14\n      7.4. Handling C-Multicast
    Routes ...............................15\n      7.5. Originating I-PMSI/S-PMSI/SA
    A-D Routes by V-Spoke ........15\n      7.6. Originating I-PMSI/S-PMSI/SA A-D
    Routes by V-Hub ..........16\n      7.7. Receiving I-PMSI/S-PMSI/SA A-D Routes
    by V-Spoke ..........17\n      7.8. Receiving I-PMSI/S-PMSI/SA A-D Routes by V-Hub
    ............17\n           7.8.1. Case 1 .............................................17\n
    \          7.8.2. Case 2 .............................................18\n      7.9.
    Use of Ingress Replication with I-PMSI A-D Routes .........20\n   8. An Example
    of RT Provisioning ..................................21\n      8.1. Unicast Routing
    ...........................................21\n      8.2. Multicast Routing .........................................22\n
    \  9. Further Refinements ............................................23\n   10.
    Security Considerations .......................................23\n   11. Acknowledgements
    ..............................................23\n   12. References ....................................................24\n
    \     12.1. Normative References .....................................24\n      12.2.
    Informative References ...................................24\n"
  title: Table of Contents
- contents:
  - "1.  Overview\n   With BGP/MPLS VPNs [RFC4364], providing any-to-any connectivity
    among\n   sites of a given VPN is usually accomplished by requiring each\n   Provider
    Edge (PE) router connected to one or more of these sites to\n   hold all that
    VPN's routes.  The approach described in this document\n   allows the VPN service
    provider (SP) to reduce the number of PEs that\n   have to maintain all these
    routes by requiring only a subset of these\n   routers to maintain all these routes.\n
    \  Consider a set of PEs that maintain VPN Routing and Forwarding tables\n   (VRFs)
    of a given VPN.  In the context of this VPN, we designate a\n   subset of these
    PEs as \"Virtual Spoke\" PEs (or just Virtual Spokes),\n   while some other (non-overlapping)
    subset of these PEs will be\n   \"Virtual Hub\" PEs (or just Virtual Hubs).  The
    rest of the PEs in the\n   set will be \"vanilla\" PEs (PEs that implement the
    procedures\n   described in [RFC4364] but that do not implement the procedures\n
    \  specified in this document).\n   For the sake of brevity, we will use the term
    \"V-hub\" to denote a\n   Virtual Hub and \"V-spoke\" to denote a Virtual Spoke.\n
    \  For a given VPN, its set of V-hubs may include not only the PEs that\n   have
    sites of that VPN connected to them but also PEs that have no\n   sites of that
    VPN connected to them.  On such PEs, the VRF associated\n   with that VPN may
    import routes from other VRFs of that VPN, even if\n   the VRF has no sites of
    that VPN connected to it.\n   Note that while in the context of one VPN a given
    PE may act as a\n   V-hub, in the context of another VPN, the same PE may act
    as a\n   V-spoke, and vice versa.  Thus, a given PE may act as a V-hub only\n
    \  for some, but not all, VPNs present on that PE.  Likewise, a given PE\n   may
    act as a V-spoke only for some, but not all, VPNs present on\n   that PE.\n   For
    a given VPN, each V-spoke of that VPN is \"associated\" with one or\n   more V-hubs
    of that VPN (one may use two V-hubs for redundancy to\n   avoid a single point
    of failure).  Note that a given V-hub may have\n   no V-spokes associated with
    it.  For more on how a V-spoke and a\n   V-hub become \"associated\" with each
    other, see Section 3.\n   Consider a set of V-spokes that are associated with
    a given V-hub,\n   V-hub-1.  If one of these V-spokes is also associated with
    some other\n   V-hub, V-hub-2, then other V-spokes in the set need not be associated\n
    \  with the same V-hub, V-hub-2, but may be associated with some other\n   V-hubs
    (e.g., V-hub-3, V-hub-4, etc.).\n   This document defines a VPN-IP default route
    as a VPN-IP route whose\n   VPN-IP prefix contains only a Route Distinguisher
    (RD) (for the\n   definition of \"VPN-IP route\", see [RFC4364]).\n   A PE that
    acts as a V-hub of a given VPN maintains all routes of that\n   VPN (such a PE
    imports routes from all other V-hubs and V-spokes, as\n   well as from \"vanilla\"
    PEs of that VPN).  A PE that acts as a V-spoke\n   of a given VPN needs to maintain
    only the routes of that VPN that are\n   originated by the sites of that VPN connected
    to that PE, plus one or\n   more VPN-IP default routes originated by the V-hub(s)
    associated with\n   that V-spoke (such a PE needs to import only VPN-IP default
    routes\n   from certain V-hubs).  This way, only a subset of PEs that maintain\n
    \  VRFs of a given VPN -- namely, only the PEs acting as V-hubs of that\n   VPN
    -- has to maintain all routes of that VPN.  PEs acting as\n   V-spokes of that
    VPN need to maintain only a (small) subset of the\n   routes of that VPN.\n   This
    document assumes that a given V-hub and its associated\n   V-spoke(s) are in the
    same Autonomous System (AS).  However, if PEs\n   that maintain a given VPN's
    VRFs span multiple ASes, this document\n   does not restrict all V-hubs of that
    VPN to be in the same AS -- the\n   V-hubs may be spread among these ASes.\n   One
    could model the approach defined in this document as a two-level\n   hierarchy,
    where the top level consists of V-hubs and the bottom\n   level consists of V-spokes.
    \ Generalization of this approach to more\n   than two levels of hierarchy is
    outside the scope of this document.\n   When PEs use ingress replication to carry
    the multicast traffic of\n   VPN customers, the approach described in this document
    may, under\n   certain circumstances, reduce bandwidth inefficiency associated
    with\n   ingress replication and redistribute the replication load among the\n
    \  PEs.  This is because a PE that acts as a V-spoke of a given VPN\n   would
    need to replicate multicast traffic only to other V-hubs (while\n   other V-hubs
    would replicate this traffic to the V-spokes associated\n   with these V-hubs),
    rather than to all PEs of that VPN.  Likewise, a\n   PE that acts as a V-hub of
    a given VPN would need to replicate\n   multicast traffic to other V-hubs and
    the V-spokes, but only the\n   V-spokes associated with that V-hub, rather than
    replicating the\n   traffic to all PEs of that VPN.  Limiting replication could
    be\n   especially beneficial if the V-spoke PEs have limited replication\n   capabilities
    and/or have links with limited bandwidth.\n"
  title: 1.  Overview
- contents:
  - "2.  Specification of Requirements\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\",
    \"SHALL\", \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"MAY\",
    and \"OPTIONAL\" in this\n   document are to be interpreted as described in [RFC2119].\n"
  title: 2.  Specification of Requirements
- contents:
  - "3.  Routing Information Exchange\n   Routing information exchange among all PEs
    of a given VPN is subject\n   to the following rules.\n   A PE that has sites
    of a given VPN connected to it has to retain\n   routing information received
    from these sites, irrespective of\n   whether this PE acts as a V-hub or a V-spoke
    of that VPN and follows\n   the rules specified in [RFC4364].\n   A PE that has
    sites of a given VPN connected to it follows the rules\n   specified in [RFC4364]
    when exporting (as VPN-IP routes) the routes\n   received from these sites, irrespective
    of whether this PE acts as a\n   V-hub or a V-spoke of that VPN.\n   In addition,
    a V-hub of a given VPN MUST export a VPN-IP default\n   route for that VPN.  This
    route MUST be exported to only the V-spokes\n   of that VPN that are associated
    with that V-hub.\n   To enable a given VPN's V-spoke to share its outbound traffic
    load\n   among the V-hubs associated with that V-spoke, each of the VPN's\n   V-hubs
    MUST use a distinct RD (per V-hub, per VPN) when originating a\n   VPN-IP default
    route.  The use of Type 1 RDs may be an attractive\n   option for such RDs.\n
    \  If a V-spoke imports several VPN-IP default routes, each originated\n   by
    its own V-hub, and these routes have the same preference, then\n   traffic from
    the V-spoke to other sites of that VPN would be load\n   shared among the V-hubs.\n
    \  Following the rules specified in [RFC4364], a V-hub of a given VPN\n   imports
    all the non-default VPN-IP routes originated by all other PEs\n   that have sites
    of that VPN connected to them (irrespective of\n   whether these other PEs act
    as V-hubs or V-spokes or just \"vanilla\"\n   PEs for that VPN, and irrespective
    of whether or not these V-spokes\n   are associated with the V-hub).\n   A V-hub
    of a given VPN MUST NOT import a VPN-IP default route unless\n   the imported
    route is the Internet VPN-IP default route (for the\n   definition of \"Internet
    VPN-IP default route\" and information on how\n   to distinguish between a VPN-IP
    default route and the Internet VPN-IP\n   default route, see Section 5).\n   Within
    a given VPN, a V-spoke MUST import all VPN-IP default routes\n   that have been
    originated by the V-hubs associated with that V-spoke.\n   In addition, a V-spoke
    of a given VPN MAY import VPN-IP routes for\n   that VPN that have been originated
    by some other V-spokes of that\n   VPN, but only by the V-spokes that are associated
    with the same\n   V-hub(s) as the V-spoke itself.\n   The above rules are realized
    by using Route Target (RT) extended\n   communities [RFC4360] and VRF export/import
    policies based on these\n   RTs.  This document defines the following procedures
    for implementing\n   the above rules.\n   Consider a \"vanilla\" any-to-any VPN.
    \ This document assumes that all\n   the PEs of that VPN (or to be more precise,
    all VRFs of that VPN) are\n   provisioned with the same export and import RT --
    we will refer to\n   this RT as \"RT-VPN\" (of course, for a given VPN service
    provider,\n   each VPN would use its own RT-VPN, distinct from RT-VPNs used by\n
    \  other VPNs).\n   To evolve this VPN into V-hubs and V-spokes, all PEs (or to
    be more\n   precise, all VRFs) that are designated as either V-hubs or V-spokes\n
    \  of that VPN keep the same export RT-VPN.  This RT-VPN is attached to\n   all
    VPN-IP routes originated by these PEs.  Also, all the V-hubs keep\n   the same
    import RT-VPN.\n   In addition, each of a given VPN's V-hubs is provisioned with
    its own\n   export RT, called RT-VH.  This RT-VH MUST be different from the\n
    \  export RT (RT-VPN) provisioned on that V-hub.  Furthermore, for a\n   given
    VPN service provider, no two VPNs can use the same RT-VH.\n   A given V-spoke
    becomes associated with a given V-hub by virtue of\n   provisioning the V-spoke
    to import only the VPN-IP route(s) that\n   carry RT-VH provisioned on the V-hub
    (thus, associating a new V-spoke\n   with a given V-hub requires provisioning
    only on that V-spoke -- no\n   provisioning changes are required on the V-hub).\n
    \  To avoid the situation where within a given VPN all the V-spokes\n   would
    be associated with every V-hub (in other words, to partition\n   V-spokes among
    V-hubs), different V-hubs within that VPN MAY use\n   different RT-VHs.  At one
    extreme, every V-hub may use a distinct\n   RT-VH.  The use of IP-address-specific
    RTs may be an attractive\n   option for this scenario.  However, it is also possible
    for several\n   V-hubs to use the same RT-VH, in which case all of these V-hubs
    would\n   be associated with the same set of V-spokes.\n   When a V-hub originates
    a (non-Internet) VPN-IP default route, the\n   V-hub MUST attach RT-VH to that
    route (the case where a V-hub\n   originates the Internet VPN-IP default route
    is covered in\n   Section 5).  Thus, this route is imported by all V-spokes associated\n
    \  with the V-hub.\n   A V-spoke MAY be provisioned to export VPN-IP routes not
    just to the\n   V-hubs but also to the V-spokes that import the same VPN-IP default\n
    \  route(s) as the V-spoke itself.  The V-spoke accomplishes this by\n   adding
    its import RT-VH(s) to the VPN-IP routes exported by the\n   V-spoke.\n"
  title: 3.  Routing Information Exchange
- contents:
  - "4.  Forwarding Considerations\n   This section describes changes/modifications
    to the forwarding\n   procedures specified in [RFC4364].\n   For a given VPN,
    the MPLS label that a V-hub of that VPN advertises\n   with a VPN-IP default route
    MUST be the label that is mapped to a\n   Next Hop Label Forwarding Entry (NHLFE)
    that identifies the VRF of\n   the V-hub.  As a result, when the V-hub receives
    a packet that\n   carries such a label, the V-hub pops the label and determines
    further\n   disposition of the packet based on the lookup in the VRF.\n   Note
    that this document does not require the advertisement of labels\n   mapped to
    an NHLFE that identifies a VRF for routes other than the\n   VPN-IP default route.\n
    \  When a V-hub of a given VPN originates a VPN-IP default route for\n   that
    VPN, the V-hub MUST NOT install in its VRF of that VPN a default\n   route, unless
    that route has been originated as a result of\n   a) the V-hub receiving an IP
    default route from one of the VPN\n      Customer Edge (CE) routers connected
    to it, or\n   b) the V-hub receiving (and importing) the Internet VPN-IP default\n
    \     route (Section 5) from some other PE, or\n   c) the VRF being provisioned
    with a default route pointing to the\n      routing table that maintains the Internet
    routes.\n   When a multihomed site is connected to a V-hub and a V-spoke, then\n
    \  the V-hub uses the following OPTIONAL procedures to support Internal\n   BGP
    (IBGP) / External BGP (EBGP) load balancing for the site's\n   inbound traffic
    that has been originated by some other V-spoke\n   associated with the V-hub.
    \ When the V-hub receives from some other\n   PE a packet that carries an MPLS
    label that the V-hub advertised in\n   the VPN-IP default route, then the V-hub
    uses the label to identify\n   the VRF that should be used for further disposition
    of the packet.\n   If (using the information present in the VRF) the V-hub determines\n
    \  that the packet has to be forwarded using a non-default route present\n   in
    the VRF, and this route indicates that the packet's destination is\n   reachable
    either over one of the VRF attachment circuits (for the\n   definition of \"VRF
    attachment circuits\", see [RFC4364]) or via some\n   other (V-spoke) PE, the
    V-hub forwards the packet either over this\n   attachment circuit or via that
    other PE.  The choice between the two\n   is a local matter to the V-hub.\n   To
    illustrate this, consider the following example:\n                  <- RD:0/0
    \          RD:0/0->\n                                   <- RD:192.0.2        <-192.0.2/24\n
    \   CE1----PE-S-------------PE-H----------------PE-S1-------------CE2\n                           /\n
    \                          |    |\n                           |    |  192.0.2/24\n
    \                          |    |\n                          CE4   CE3\n   A multihomed
    site (not shown in the above figure) is connected via\n   CE2 and CE3.  Thus,
    both CE2 and CE3 advertise a route to 192.0.2/24.\n   CE2 advertises this route
    (route to 192.0.2/24) to PE-S1, which in\n   turn originates a VPN-IP route RD:192.0.2.
    \ CE3 advertises this route\n   to PE-H.\n   PE-H is a V-hub, while PE-S and PE-S1
    are V-spokes associated with\n   that V-hub.  Thus, PE-H originates a VPN-IP default
    route (RD:0/0),\n   and both PE-S and PE-S1 import that route.\n   PE-H receives
    from PE-S1 a VPN-IP route to RD:192.0.2 and from CE3 a\n   plain IP route to 192.0.2.
    \ Thus, the VRF entry on PE-H has two\n   possible next hops for 192.0.2: CE3
    and PE-S1 (the latter is a next\n   hop that is not directly connected to PE-H).\n
    \  Now consider what happens when CE1 originates a packet destined to\n   192.0.2.1.
    \ When PE-S receives this packet, PE-S (following the\n   VPN-IP default route)
    forwards the packet to PE-H.  The MPLS label in\n   the packet is the label that
    PE-H advertised to PE-S in the VPN-IP\n   default route.  Thus, following the
    rule specified above, PE-H may\n   forward the packet either via CE3 or via PE-S1
    (with PE-S1\n   subsequently forwarding the packet to CE2), resulting in IBGP/EBGP\n
    \  load balancing.\n   Likewise, if CE4 originates a packet destined to 192.0.2.1,
    PE-H may\n   forward the packet either via CE3 or via PE-S1 (with PE-S1\n   subsequently
    forwarding the traffic to CE2), resulting in IBGP/EBGP\n   load balancing.\n   Note,
    however, that if there is some other CE, CE5, connected to\n   PE-S1, and CE5
    sends a packet to 192.0.2.1, then (due to the IP\n   longest match rule) PE-S1
    will always forward this packet to CE2.\n   Thus, for a multihomed site connected
    to a V-hub and a V-spoke,\n   IBGP/EBGP load balancing will be available for some
    but not all the\n   traffic destined to that site.  Specifically, IBGP/EBGP load\n
    \  balancing will not be available for the traffic destined to that site\n   if
    this traffic has been originated within some other site that is\n   connected
    to the same V-spoke.\n   Moreover, if CE3 advertises 192.0.2.0/25 and 192.0.2/24,
    while CE2\n   advertises 192.0.2.128/25 and 192.0.2/24 (which is yet another form\n
    \  of load balancing for a multihomed site), when CE5 sends a packet to\n   192.0.2.1,
    then (due to the IP longest match rule) PE-S1 will always\n   forward this packet
    to CE2, even though the VPN customer would expect\n   this traffic to flow via
    CE3.\n   This document proposes two options to address the issues raised in\n
    \  the previous two paragraphs.  The first option is to disallow a given\n   VPN
    to provision PEs that have multihomed sites of that VPN connected\n   to them
    as V-spokes (such PEs could be provisioned as either V-hubs\n   or plain \"vanilla\"
    PEs).  The second option is for the V-spoke, when\n   it receives an IP route
    from a CE, to not install this route in its\n   forwarding table but just re-advertise
    this route as a VPN-IP route,\n   together with an MPLS label.  The NHLFE [RFC3031]
    associated with\n   that label MUST specify the CE that advertises the IP route
    as the\n   next hop.  As a result, when the PE receives data that carries that\n
    \  label, the PE just forwards the data to the CE without performing an\n   IP
    lookup on the data.  Note that doing this would result in forcing\n   the traffic
    between a pair of sites connected to the same V-spoke to\n   go through the V-hub
    of that V-spoke.\n   An implementation that supports IBGP/EBGP load balancing,
    as\n   specified above, SHOULD support the second option.  If the\n   implementation
    does not support the second option, then deploying\n   this implementation to
    support IBGP/EBGP load balancing, as specified\n   above, would either (a) restrict
    the set of PEs that could be\n   provisioned as V-spokes (any PE that has a multihomed
    site connected\n   to it cannot be provisioned as a V-spoke) or (b) result in
    IBGP/EBGP\n   load balancing not being available for certain scenarios (the\n
    \  scenarios that the second option is intended to cover).\n"
  title: 4.  Forwarding Considerations
- contents:
  - "5.  Internet Connectivity\n   This document specifies two possible alternatives
    for providing\n   Internet connectivity for a given VPN.\n   The first alternative
    is when a PE that maintains Internet routes\n   also maintains a VRF of a given
    VPN.  In this case, the Internet\n   connectivity for that VPN MAY be provided
    by provisioning a default\n   route in the VPN's VRF on that PE pointing to the
    routing table on\n   that PE that maintains the Internet routes.  This PE MUST
    NOT be\n   provisioned as a V-spoke for that VPN (this PE may be provisioned as\n
    \  either a V-hub or a \"vanilla\" PE).  If this PE is provisioned as a\n   V-hub,
    then this PE MUST originate a VPN-IP default route.  The route\n   MUST carry
    both RT-VPN and RT-VH of the V-hub (see Section 3 for the\n   definitions of \"RT-VPN\"
    and \"RT-VH\").  Thus, this route will be\n   imported by all the V-spokes associated
    with the V-hub, as well as by\n   other V-hubs and \"vanilla\" PEs.  An implementation
    MUST support the\n   first alternative.\n   The second alternative is when a site
    of a given VPN has connection\n   to the Internet, and a CE of that site advertises
    an IP default route\n   to the PE connected to that CE.  This alternative has
    two subcases:\n   (a) the PE is provisioned as a V-hub, and (b) the PE is provisioned\n
    \  as a V-spoke.  An implementation MUST support subcase (a).  An\n   implementation
    MAY support subcase (b).\n   If a PE is provisioned as a V-hub, then the PE re-advertises
    this IP\n   default route as a VPN-IP default route and installs in its VRF an
    IP\n   default route with the next hop specifying the CE(s) that advertise\n   the
    IP default route to the PE.  Note that when re-advertising the\n   VPN-IP default
    route, the route MUST carry both RT-VPN and RT-VH of\n   the V-hub (see Section
    3 for the definitions of \"RT-VPN\" and\n   \"RT-VH\").  Thus, this route will
    be imported by all the V-spokes\n   associated with the V-hub, as well as by other
    V-hubs and\n   \"vanilla\" PEs.\n   If a PE is provisioned as a V-spoke, then
    receiving a default route\n   from a CE MUST NOT cause the V-spoke to install
    an IP default route\n   in its VRF.  The V-spoke MUST originate a VPN-IP default
    route with a\n   (non-null) MPLS label.  The route MUST carry only RT-VPN (as
    a\n   result, this route is not imported by any of the V-spokes but is\n   imported
    by V-hubs).  The packet's next hop of the NHLFE [RFC3031]\n   associated with
    that label MUST specify the CE that advertises the IP\n   default route.  As a
    result, when the V-spoke receives data that\n   carries that label, it just forwards
    the data to the CE without\n   performing an IP lookup on the data.  Note that
    in this case, the VRF\n   on the V-spoke will have an IP default route, but this
    route would be\n   created as a result of receiving a VPN-IP default route from
    one of\n   the V-hubs associated with that V-spoke (and not as a result of\n   receiving
    the IP default route from the CE).  Note also that if this\n   V-spoke has other
    sites of that VPN connected to it, then traffic\n   from these sites to the Internet
    would go to that V-spoke, then to\n   the V-hub selected by the V-spoke, then
    from that V-hub back to the\n   V-spoke, and then to the CE that advertises an
    IP default route to\n   the V-spoke.\n   If a PE is provisioned as a V-spoke of
    a given VPN, and if a CE of\n   that VPN advertises an IP default route to the
    PE (as the CE belongs\n   to the site that provides the Internet connectivity
    for the VPN),\n   then the PE MUST NOT advertise an IP default route back to that
    CE.\n   Yet, the CE has to specify that PE as the next hop for all the\n   traffic
    to other sites of that VPN.  A way to accomplish this is to\n   require the V-spoke
    to implement procedures specified in Section 9.\n   In all the scenarios described
    above in this section, we refer to the\n   originated VPN-IP default route as
    the \"Internet VPN-IP default\n   route\".  Specifically, the Internet VPN-IP
    default route is a VPN-IP\n   default route originated by a PE (this PE could
    be either a V-hub or\n   a V-spoke) as a result of (a) receiving an IP default
    route from a CE\n   or (b) the PE maintaining Internet routes and also provisioning
    in\n   the VRF of its VPN a default route pointing to its (the PE's) routing\n
    \  table that contains Internet routes.\n   The difference between the Internet
    VPN-IP default route and a\n   non-Internet VPN-IP default route originated by
    a V-hub is in the RTs\n   carried by the route -- for a given VPN and a given
    V-hub of that\n   VPN, the Internet VPN-IP default route carries both RT-VPN and
    RT-VH\n   of that V-hub, while the non-Internet VPN-IP default route carries\n
    \  just RT-VH of that V-hub.\n   When a V-hub originates the Internet VPN-IP default
    route, the V-hub\n   MUST withdraw the non-Internet VPN-IP default route that
    has been\n   originated by the V-hub.  When a V-hub withdraws the Internet VPN-IP\n
    \  default route that has been originated by the V-hub, the V-hub MUST\n   originate
    a non-Internet VPN-IP default route.  That is, at any given\n   point in time,
    a given V-hub originates either the Internet VPN-IP\n   default route or a non-Internet
    VPN-IP default route.\n   As a result of the rules specified above, if a V-hub
    originates the\n   Internet VPN-IP default route, then all the V-spokes associated
    with\n   that V-hub MUST import that route.  In addition (and in contrast with\n
    \  a non-Internet VPN-IP default route), other V-hubs MAY import that\n   route.
    \ A V-hub MAY also import the Internet VPN-IP default routes\n   originated by
    V-spoke(s).  A V-spoke MUST NOT import the Internet\n   VPN-IP default route originated
    by any other V-spoke.  Such a route\n   MAY be imported only by V-hubs.\n   If
    the Internet VPN-IP default route originated by a V-hub has the\n   same preference
    as the (non-Internet) VPN-IP default route originated\n   by some other V-hub,
    then a V-spoke that imports VPN-IP default\n   routes originated by both of these
    V-hubs would load share the\n   outgoing Internet traffic between these two V-hubs
    (and thus some of\n   the outgoing Internet traffic from that V-spoke will first
    be routed\n   to the V-hub that does not originate the Internet VPN-IP default\n
    \  route, then from that V-hub to the V-hub that does originate the\n   Internet
    VPN-IP default route).\n   If taking an extra-hub hop for the Internet traffic
    is viewed as\n   undesirable, then it is RECOMMENDED that the Internet VPN-IP
    default\n   route be of higher preference than a (non-Internet) VPN-IP default\n
    \  route originated by some other V-hub.  However, in this case the\n   traffic
    from the V-spokes to other sites of that VPN will not be load\n   shared between
    these two V-hubs.\n"
  title: 5.  Internet Connectivity
- contents:
  - "6.  Deployment Considerations\n   For a given VPN, a V-hub and a set of V-spokes
    associated with that\n   V-hub should be chosen in a way that minimizes the additional
    network\n   distance/latency penalty, given that VPN geographic footprint.\n   For
    a given VPN, some or all of its V-spokes could be grouped into\n   geographically
    based clusters (e.g., V-spokes within a given cluster\n   could be in close geographical
    proximity to each other) with\n   any-to-any connectivity within each cluster.
    \ Note that the V-spokes\n   within a given cluster need not be associated with
    the same V-hub(s).\n   Likewise, not all V-spokes associated with a given V-hub
    need to be\n   in the same cluster.  A use case for this would be a VPN for a
    large\n   retail chain in which data traffic is hub/spoke between each store\n
    \  and centralized datacenters, but there is a need for direct Voice\n   over
    IP (VoIP) traffic between stores within the same geographical\n   area.\n   The
    use of constrained route distribution for BGP/MPLS IP VPNs\n   (\"RT constrains\")
    [RFC4684] may further facilitate/optimize routing\n   exchange in support of V-hubs
    and V-spokes.\n   Introducing a V-spoke PE in a VPN may introduce the following
    changes\n   for the customer of that VPN:\n   +  Traceroute from a CE connected
    to a V-spoke may report an\n      additional hop: the V-hub PE.\n   +  Latency
    for traffic sent from a CE connected to a V-spoke may\n      increase, depending
    on the location of the V-hub in the layer 3\n      and layer 1 network topology
    of the SP.\n"
  title: 6.  Deployment Considerations
- contents:
  - "7.  Multicast Considerations\n   This section describes procedures for supporting
    Multicast VPN (MVPN)\n   in the presence of Virtual Hub-and-Spoke.  The procedures
    rely on\n   MVPN specifications as defined in [RFC6513], [RFC6514], and\n   [RFC6625].\n
    \  The procedures assume that for the purpose of ensuring\n   non-duplication,
    both V-hubs and V-spokes can discard packets from a\n   \"wrong\" PE, as specified
    in Section 9.1.1 of [RFC6513].  The existing\n   procedures for Selective Provider
    Multicast Service Interface\n   (S-PMSI) auto-discovery (A-D) routes [RFC6513]
    [RFC6514] [RFC6625]\n   are sufficient to discard packets coming from a \"wrong\"
    PE for all\n   types of provider tunnels (P-tunnels) specified in [RFC6514]\n
    \  (including Ingress Replication).  The existing procedures for\n   Inclusive
    Provider Multicast Service Interface (I-PMSI) A-D routes\n   [RFC6513] [RFC6514]
    are sufficient to discard packets coming from a\n   \"wrong\" PE for all types
    of P-tunnels specified in [RFC6514], except\n   for Ingress Replication.  Section
    7.9 of this document specifies\n   changes to the procedures in [RFC6514], to
    enable the discarding of\n   packets from a \"wrong\" PE when Ingress Replication
    is used for I-PMSI\n   P-tunnels.\n   The V-hub/V-spoke architecture, as specified
    in this document,\n   affects certain multicast scenarios.  In particular, it
    affects\n   multicast scenarios where the source of a multicast flow is at a site\n
    \  attached to a V-hub and a receiver of that flow is at a site attached\n   to
    a V-spoke that is not associated with that same V-hub.  It also\n   affects multicast
    scenarios where the source of a multicast flow is\n   at a site attached to a
    V-spoke, a receiver of that flow is at a site\n   attached to a different V-spoke,
    and the set intersection between the\n   V-hub(s) associated with the first V-spoke
    and the V-hub(s)\n   associated with the second V-spoke is empty.  It may also
    affect\n   multicast scenarios where the source of a multicast flow is at a site\n
    \  connected to a V-spoke, a receiver of that flow is at a site attached\n   to
    a different V-spoke, and the set intersection between the V-hub(s)\n   associated
    with the first V-spoke and the V-hub(s) associated with\n   the second V-spoke
    is non-empty (the multicast scenarios are affected\n   if the I-PMSI/S-PMSI A-D
    routes originated by the first V-spoke are\n   not imported by the second V-spoke).\n
    \  The use of Virtual Hub-and-Spoke in conjunction with seamless MPLS\n   multicast
    [MPLS-MCAST] is outside the scope of this document.\n"
  - contents:
    - "7.1.  Terminology\n   We will speak of a P-tunnel being \"bound\" to a particular\n
      \  I-PMSI/S-PMSI A-D route if the P-tunnel is specified in that route's\n   PMSI
      Tunnel attribute.\n   When Ingress Replication is used, the P-tunnel bound to
      a particular\n   I-PMSI/S-PMSI A-D route is actually a set of unicast tunnels\n
      \  (procedures differ from [RFC6514] for the case of I-PMSI and are\n   specified
      in Section 7.9 of this document).  The PE originating the\n   I-PMSI/S-PMSI
      A-D route uses these unicast tunnels to carry traffic\n   to the PEs that import
      the route.  The PEs that import the route\n   advertise labels for the unicast
      tunnels in Leaf A-D routes\n   originated in response to the I-PMSI/S-PMSI A-D
      route.  When we say\n   that traffic has been received by a PE on a P-tunnel
      \"bound\" to a\n   particular I-PMSI/S-PMSI A-D route imported by that PE, we
      refer to\n   the unicast tunnel for which the label was advertised in a Leaf
      A-D\n   route by the PE that imported the I-PMSI/S-PMSI route; the PE that\n
      \  originated that route uses this tunnel to send traffic to the PE that\n   imported
      the I-PMSI/S-PMSI route.\n"
    title: 7.1.  Terminology
  - contents:
    - "7.2.  Eligible Upstream Multicast Hop (UMH) Routes\n   On a V-spoke, the set
      of Eligible UMH routes consists of all the\n   unicast VPN-IP routes received
      by the V-spoke, including the default\n   VPN-IP routes received from its V-hub(s).
      \ Note that such routes MAY\n   include routes received from other V-spokes.
      \ The routes received\n   from other V-spokes could be either \"vanilla\" VPN-IP
      routes (routes\n   using the IPv4 or IPv6 Address Family Identifier (AFI) and
      Subsequent\n   Address Family Identifier (SAFI) set to 128 \"MPLS-labeled VPN\n
      \  address\" [IANA-SAFI]) or routes using the IPv4 or IPv6 AFI (as\n   appropriate)
      but with the SAFI set to SAFI 129 \"Multicast for\n   BGP/MPLS IP Virtual Private
      Networks (VPNs)\" [IANA-SAFI].\n   The default VPN-IP routes received from the
      V-hub(s) may be either\n   Internet default VPN-IP routes or non-Internet default
      VPN-IP routes.\n"
    title: 7.2.  Eligible Upstream Multicast Hop (UMH) Routes
  - contents:
    - "7.3.  Originating VPN-IP Default Route by a V-Hub\n   When originating a VPN-IP
      default route, a V-hub, in addition to\n   following the procedures specified
      in Section 3, also follows the\n   procedures specified in Sections 6 and 7
      of [RFC6514] (see also\n   Section 5.1 of [RFC6513]).  Specifically, the V-hub
      MUST add the VRF\n   Route Import Extended Community that embeds the V-hub's
      IP address.\n   The route also MUST include the Source AS extended community.\n"
    title: 7.3.  Originating VPN-IP Default Route by a V-Hub
  - contents:
    - "7.4.  Handling C-Multicast Routes\n   In the following, the term \"C-multicast
      routes\" refers to BGP routes\n   that carry customer multicast routing information
      [RFC6514].\n   Origination of C-multicast routes follows the procedures specified
      in\n   [RFC6514] (irrespective of whether these routes are originated by a\n
      \  V-hub or a V-spoke).\n   When a V-spoke receives a C-multicast route, the
      V-spoke follows the\n   procedures described in [RFC6514].\n   When a V-hub
      receives a C-multicast route, the V-hub determines\n   whether the customer
      Rendezvous Point (C-RP) or the customer source\n   (C-S) of the route is reachable
      via one of its VRF interfaces; if\n   yes, then the V-hub follows the procedures
      described in [RFC6514].\n   Otherwise, the C-RP/C-S of the route is reachable
      via some other PE\n   (this is the case where the received route was originated
      by a\n   V-spoke that sees the V-hub as the \"upstream PE\" for a given source,\n
      \  but the V-hub sees some other PE -- either V-hub or V-spoke -- as the\n   \"upstream
      PE\" for that source).  In this case, the V-hub uses the\n   type (Source Tree
      Join vs Shared Tree Join), the Multicast Source,\n   and Multicast Group from
      the received C-multicast route to construct\n   a new route of the same type,
      with the same Multicast Source and\n   Multicast Group.  The hub constructs
      the rest of the new route\n   following procedures specified in Section 11.1.3
      of [RFC6514].  The\n   hub also creates the appropriate (C-*, C-G) or (C-S,
      C-G) state in\n   its MVPN Tree Information Base (MVPN-TIB).\n"
    title: 7.4.  Handling C-Multicast Routes
  - contents:
    - "7.5.  Originating I-PMSI/S-PMSI/SA A-D Routes by V-Spoke\n   When a V-spoke
      originates an I-PMSI, an S-PMSI, or Source Active (SA)\n   A-D route, the V-spoke
      follows the procedures specified in [RFC6514]\n   (or in the case of a wildcard
      S-PMSI A-D route, the procedures\n   specified in [RFC6625]), including the
      procedures for constructing\n   RT(s) carried by the route.  Note that as a
      result, such a route will\n   be imported by the V-hubs.  In the case of an
      I-PMSI/S-PMSI A-D\n   route, the P-tunnel bound to this route is used to carry
      to these\n   V-hubs traffic originated by the sites connected to the V-spoke.\n
      \  If the V-spoke exports its (unicast) VPN-IP routes not just to the\n   V-hubs
      but also to some other V-spokes (as described in Section 3),\n   then (as a
      result of following the procedures specified in [RFC6514]\n   or, in the case
      of a wildcard S-PMSI A-D route, the procedures\n   specified in [RFC6625]) the
      I-PMSI/S-PMSI/SA A-D route originated by\n   the V-spoke will be imported not
      just by the V-hubs but also by the\n   other V-spokes.  This is because in this
      scenario, the route will\n   carry more than one RT; one of these RTs, RT-VPN,
      will result in\n   importing the route by the V-hubs, while other RT(s) will
      result in\n   importing the route by the V-spokes (the other RT(s) are the RT(s)\n
      \  that the V-spoke uses for importing the VPN-IP default route).  In\n   this
      case, the P-tunnel bound to this I-PMSI/S-PMSI A-D route is also\n   used to
      carry traffic originated by the sites connected to the\n   V-spoke that originates
      the route to these other V-spokes.\n"
    title: 7.5.  Originating I-PMSI/S-PMSI/SA A-D Routes by V-Spoke
  - contents:
    - "7.6.  Originating I-PMSI/S-PMSI/SA A-D Routes by V-Hub\n   When a V-hub originates
      an I-PMSI/S-PMSI/SA A-D route, the V-hub\n   follows the procedures specified
      in [RFC6514] (or in the case of a\n   wildcard S-PMSI A-D route, the procedures
      specified in [RFC6625]),\n   except that in addition to the RT(s) constructed
      following these\n   procedures, the route MUST also carry the RT of the VPN-IP
      default\n   route advertised by the V-hub (RT-VH).  Note that as a result, such
      a\n   route will be imported by other V-hubs and also by the V-spokes, but\n
      \  only by the V-spokes that are associated with the V-hub (the V-spokes\n   that
      import the VPN-IP default route originated by the V-hub).  In\n   the case of
      an I-PMSI/S-PMSI A-D route, the P-tunnel bound to this\n   route is used to
      carry to these other V-hubs and V-spokes the traffic\n   originated by the sites
      connected to the V-hub that originates the\n   route.\n   In addition, if a
      V-hub originates an I-PMSI A-D route following\n   the procedures specified
      in [RFC6514], the V-hub MUST originate\n   another I-PMSI A-D route -- we'll
      refer to this route as an\n   \"Associated-V-spoke-only I-PMSI A-D route\".
      \ The RT carried by this\n   route MUST be the RT that is carried in the VPN-IP
      default route\n   advertised by the V-hub (RT-VH).  Therefore, this route will
      be\n   imported only by the V-spokes associated with the V-hub (the V-spokes\n
      \  that import the VPN-IP default route advertised by this V-hub).  The\n   P-tunnel
      bound to this route is used to carry to these V-spokes\n   traffic originated
      by the sites connected to either (a) other V-hubs,\n   (b) other V-spokes, including
      the V-spokes that import the VPN-IP\n   default route from the V-hub, or (c)
      \"vanilla\" PEs.\n   More details on the use of this P-tunnel are described
      in\n   Section 7.8.\n   As a result, a V-hub originates not one, but two I-PMSI
      A-D routes --\n   one is a \"vanilla\" I-PMSI A-D route and another is an\n
      \  Associated-V-spoke-only I-PMSI A-D route.  Each of these routes MUST\n   have
      a distinct RD.\n   When a V-hub receives traffic from one of the sites connected
      to the\n   V-hub, and the V-hub determines (using some local policies) that
      this\n   traffic should be transmitted using an I-PMSI, the V-hub forwards\n
      \  this traffic on the P-tunnel bound to the \"vanilla\" I-PMSI A-D route\n
      \  but MUST NOT forward it on the P-tunnel bound to the\n   Associated-V-spoke-only
      I-PMSI A-D route.\n"
    title: 7.6.  Originating I-PMSI/S-PMSI/SA A-D Routes by V-Hub
  - contents:
    - "7.7.  Receiving I-PMSI/S-PMSI/SA A-D Routes by V-Spoke\n   When a V-spoke receives
      an I-PMSI/S-PMSI/SA A-D route, the V-spoke\n   follows the procedures specified
      in [RFC6514] (or in the case of a\n   wildcard S-PMSI A-D route, the procedures
      specified in [RFC6625]).\n   As a result, a V-spoke that is associated with
      a given V-hub (the\n   V-spoke that imports the VPN-IP default route originated
      by that\n   V-hub) will also import I-PMSI/S-PMSI/SA A-D routes originated by\n
      \  that V-hub.  Specifically, the V-spoke will import both the \"vanilla\"\n
      \  I-PMSI A-D route and the Associated-V-spoke-only I-PMSI A-D route\n   originated
      by the V-hub.\n   In addition, if a V-spoke imports the (unicast) VPN-IP routes\n
      \  originated by some other V-spokes (as described in Section 3), then\n   the
      V-spoke will also import I-PMSI/S-PMSI/SA A-D routes originated\n   by these
      other V-spokes.\n"
    title: 7.7.  Receiving I-PMSI/S-PMSI/SA A-D Routes by V-Spoke
  - contents:
    - "7.8.  Receiving I-PMSI/S-PMSI/SA A-D Routes by V-Hub\n   The following describes
      procedures that a V-hub MUST follow when it\n   receives an I-PMSI/S-PMSI/SA
      A-D route.\n"
    - contents:
      - "7.8.1.  Case 1\n   This is the case where a V-hub receives an I-PMSI/S-PMSI/SA
        A-D\n   route, and one of the RT(s) carried in the route is the RT that the\n
        \  V-hub uses for advertising its VPN-IP default route (RT-VH).\n   In this
        case, the receiving route was originated either\n   +  by a V-spoke associated
        with the V-hub (the V-spoke that imports\n      the VPN-IP default route originated
        by the V-hub), or\n   +  by some other V-hub that uses the same RT as the
        receiving V-hub\n      for advertising the VPN-IP default route.\n   In this
        case, the received I-PMSI/S-PMSI/SA A-D route carries more\n   than one RT.
        \ One of these RTs results in importing this route by the\n   V-hubs.  Another
        of these RTs is the RT that the V-hub uses when\n   advertising its VPN-IP
        default route (RT-VH).  This RT results in\n   importing the received I-PMSI/S-PMSI/SA
        A-D route by all the V-spokes\n   associated with the V-hub (the V-spokes
        that import the VPN-IP\n   default route originated by the V-hub).\n   In
        handling such an I-PMSI/S-PMSI/SA A-D route, the V-hub simply\n   follows
        the procedures specified in [RFC6514] (or in the case of a\n   wildcard S-PMSI
        A-D route, the procedures specified in [RFC6625]).\n   Specifically, the V-hub
        MUST NOT reoriginate this route as done in\n   Case 2 below.\n   The following
        specifies the rules that the V-hub MUST follow when\n   handling traffic that
        the V-hub receives on a P-tunnel bound to this\n   I-PMSI/S-PMSI A-D route.
        \ The V-hub may forward this traffic to only\n   the sites connected to that
        V-hub (forwarding this traffic to these\n   sites follows the procedures specified
        in [RFC6514] or, in the case\n   of a wildcard S-PMSI A-D route, the procedures
        specified in\n   [RFC6625]).  The V-hub MUST NOT forward the traffic received
        on this\n   P-tunnel to any other V-hubs or V-spokes, including the V-spokes
        that\n   import the VPN-IP default route originated by the V-hub (V-spokes\n
        \  associated with the V-hub).  Specifically, the V-hub MUST NOT forward\n
        \  the traffic received on the P-tunnel advertised in the received\n   I-PMSI
        A-D route over the P-tunnel that the V-hub binds to its\n   Associated-V-spoke-only
        I-PMSI A-D route.\n"
      title: 7.8.1.  Case 1
    - contents:
      - "7.8.2.  Case 2\n   This is the case where a V-hub receives an I-PMSI/S-PMSI/SA
        A-D\n   route, and the route does not carry the RT that the receiving V-hub\n
        \  uses when advertising its VPN-IP default route (RT-VH).\n   In this case,
        the receiving I-PMSI/S-PMSI/SA A-D route was originated\n   by either some
        other V-hub or a V-spoke.  The I-PMSI/S-PMSI/SA A-D\n   route is imported
        by the V-hub (as well as by other V-hubs) but not\n   by any of the V-spokes
        associated with the V-hub (V-spokes that\n   import the VPN-IP default route
        originated by the V-hub).\n   In this case, the V-hubs follow the procedures
        specified in [RFC6514]\n   (or in the case of a wildcard S-PMSI A-D route,
        the procedures\n   specified in [RFC6625]), with the following additions.\n
        \  Once a V-hub accepts an I-PMSI A-D route, when the V-hub receives\n   data
        on the P-tunnel bound to that I-PMSI A-D route, the V-hub\n   follows the
        procedures specified in [RFC6513] and [RFC6514] to\n   determine whether to
        accept the data.  If the data is accepted, then\n   the V-hub further forwards
        the data over the P-tunnel bound to the\n   Associated-V-spoke-only I-PMSI
        A-D route originated by the V-hub.\n   Note that in deciding whether to forward
        the data over the P-tunnel\n   bound to the Associated-V-spoke-only I-PMSI
        A-D route originated by\n   the V-hub, the V-hub SHOULD take into account
        the (multicast) state\n   present in its MVPN-TIB that has been created as
        a result of\n   receiving C-multicast routes from the V-spokes associated
        with the\n   V-hub.  If (using the information present in the MVPN-TIB) the
        V-hub\n   determines that none of these V-spokes have receivers for the data,\n
        \  the V-hub SHOULD NOT forward the data over the P-tunnel bound to the\n
        \  Associated-V-spoke-only I-PMSI A-D route originated by the V-hub.\n   Whenever
        a V-hub imports an S-PMSI A-D route (respectively, SA A-D\n   route) in a
        VRF, the V-hub, in contrast to Case 1 above, MUST\n   originate an S-PMSI
        A-D route (respectively, SA A-D route) targeted\n   to its V-spokes.  To accomplish
        this, the V-hub replaces the RT(s)\n   carried in the route with the RT that
        the V-hub uses when originating\n   its VPN-IP default route (RT-VH), changes
        the RD of the route to the\n   RD that the V-hub uses when originating its
        Associated-V-spoke-only\n   I-PMSI A-D route, and sets Next Hop to the IP
        address that the V-hub\n   places in the Global Administrator field of the
        VRF Route Import\n   Extended Community of the VPN-IP routes advertised by
        the V-hub.  For\n   S-PMSI A-D routes, the V-hub also changes the Originating
        Router's IP\n   address in the MCAST-VPN NLRI (Network Layer Reachability\n
        \  Information) of the route to the same address as the one in the Next\n
        \  Hop.  Moreover, before advertising the new S-PMSI A-D route, the\n   V-hub
        modifies its PMSI Tunnel attribute as appropriate (e.g., by\n   replacing
        the P-tunnel rooted at the originator of this route with a\n   P-tunnel rooted
        at the V-hub).\n   Note that a V-hub of a given MVPN may receive and accept
        multiple\n   (C-*, C-*) wildcard S-PMSI A-D routes [RFC6625], each originated
        by\n   its own PE.  Yet, even if the V-hub receives and accepts such\n   multiple
        (C-*, C-*) S-PMSI A-D routes, the V-hub re-advertises just\n   one (C-*, C-*)
        S-PMSI A-D route, thus aggregating the received (C-*,\n   C-*) S-PMSI A-D
        routes.  The same applies for (C-*, C-G) S-PMSI A-D\n   routes.\n   Whenever
        a V-hub receives data on the P-tunnel bound to a received\n   S-PMSI A-D route,
        the V-hub follows the procedures specified in\n   [RFC6513] and [RFC6514]
        (or in the case of a wildcard S-PMSI A-D\n   route, the procedures specified
        in [RFC6625]) to determine whether to\n   accept the data.  If the data is
        accepted, then the V-hub further\n   forwards it over the P-tunnel bound to
        the S-PMSI A-D route that has\n   been re-advertised by the V-hub.\n   If
        multiple S-PMSIs received by a V-hub have been aggregated into the\n   same
        P-tunnel, then the V-hub, prior to forwarding to the V-spokes\n   associated
        with that V-hub the data received on this P-tunnel, MAY\n   de-aggregate and
        then reaggregate (in a different way) this data\n   using the state present
        in its MVPN-TIB that has been created as a\n   result of receiving C-multicast
        routes from the V-spokes.  Even if\n   S-PMSIs received by the V-hub each
        have their own P-tunnel, the\n   V-hub, prior to forwarding to the V-spokes
        the data received on these\n   P-tunnels, MAY aggregate these S-PMSIs using
        the state present in its\n   MVPN-TIB that has been created as a result of
        receiving C-multicast\n   routes from the V-spokes.\n"
      title: 7.8.2.  Case 2
    title: 7.8.  Receiving I-PMSI/S-PMSI/SA A-D Routes by V-Hub
  - contents:
    - "7.9.  Use of Ingress Replication with I-PMSI A-D Routes\n   The following modifications
      to the procedures specified in [RFC6514]\n   for originating/receiving I-PMSI
      A-D routes enable the discarding of\n   packets coming from a \"wrong\" PE when
      Ingress Replication is used for\n   I-PMSI P-tunnels (for other types of P-tunnels,
      the procedures\n   specified in [RFC6513] and [RFC6514] are sufficient).\n   The
      modifications to the procedures are required to be implemented\n   (by all the
      PEs of a given MVPN) only under the following conditions:\n   +  At least one
      of those PEs is a V-hub or V-spoke PE for the given\n      MVPN.\n   +  The
      given MVPN is configured to use the optional procedure of\n      using Ingress
      Replication to instantiate an I-PMSI.\n   If Ingress Replication is used with
      I-PMSI A-D routes, when a PE\n   advertises such routes, the Tunnel Type in
      the PMSI Tunnel attribute\n   MUST be set to Ingress Replication; the Leaf Information
      Required\n   flag MUST be set to 1; the attribute MUST carry no MPLS labels.\n
      \  A PE that receives such an I-PMSI A-D route MUST respond with a Leaf\n   A-D
      route.  The PMSI Tunnel attribute of that Leaf A-D route is\n   constructed
      as follows:\n   o  The Tunnel Type is set to Ingress Replication.\n   o  The
      Tunnel Identifier MUST carry a routable address of the PE that\n      originates
      the Leaf A-D route.\n   o  The PMSI Tunnel attribute MUST carry a downstream-assigned
      MPLS\n      label that is used to demultiplex the traffic received over a\n
      \     unicast tunnel by the PE.\n   o  The receiving PE MUST assign the label
      in such a way as to enable\n      the receiving PE to identify (a) the VRF on
      that PE that should be\n      used to process the traffic received with this
      label and (b) the\n      PE that sends the traffic with this label.\n   This
      document assumes that for a given MVPN, all the PEs that have\n   sites of that
      MVPN connected to them implement the procedures\n   specified in this section.\n"
    title: 7.9.  Use of Ingress Replication with I-PMSI A-D Routes
  title: 7.  Multicast Considerations
- contents:
  - "8.  An Example of RT Provisioning\n   Consider a VPN A that consists of 9 sites
    -- site-1 through site-9.\n   Each site is connected to its own PE -- PE-1 through
    PE-9.\n   We designate PE-3, PE-6, and PE-9 as V-hubs.\n   To simplify the presentation,
    the following example assumes that each\n   V-spoke is associated with just one
    V-hub.  However, as mentioned\n   earlier, in practice each V-spoke should be
    associated with two or\n   more V-hubs.\n   PE-1 and PE-2 are V-spokes associated
    with PE-3.  PE-4 and PE-5 are\n   V-spokes associated with PE-6.  PE-7 and PE-8
    are V-spokes associated\n   with PE-9.\n"
  - contents:
    - "8.1.  Unicast Routing\n   All the PEs (both V-hubs and V-spokes) are provisioned
      to export\n   routes using RT-A (just as with \"vanilla\" any-to-any VPN).\n
      \  All the V-hubs (PE-3, PE-6, and PE-9) are provisioned to import\n   routes
      with RT-A (just as with \"vanilla\" any-to-any VPN).\n   In addition, PE-3 is
      provisioned to originate a VPN-IP default route\n   with RT-A-VH-1 (but not
      with RT-A), while PE-1 and PE-2 are\n   provisioned to import routes with RT-A-VH-1.\n
      \  Likewise, PE-6 is provisioned to originate a VPN-IP default route\n   with
      RT-A-VH-2 (but not with RT-A), while PE-4 and PE-5 are\n   provisioned to import
      routes with RT-A-VH-2.\n   Finally, PE-9 is provisioned to originate a VPN-IP
      default route with\n   RT-A-VH-3 (but not with RT-A), while PE-7 and PE-8 are
      provisioned to\n   import routes with RT-A-VH-3.\n   Now let's modify the example
      above a bit by assuming that site-3 has\n   Internet connectivity.  Thus, site-3
      advertises an IP default route\n   to PE-3.  PE-3 in turn originates a VPN-IP
      default route.  In this\n   case, the VPN-IP default route carries RT-A and
      RT-A-VH-1 (rather\n   than just RT-A-VH-1, as before), which results in importing
      this\n   route to PE-6 and PE-9, as well as to PE-1 and PE-2.\n   If PE-7 and
      PE-8, in addition to importing a VPN-IP default route\n   from PE-9, also want
      to import each other's VPN-IP routes, then PE-7\n   and PE-8 export their VPN-IP
      routes with two RTs: RT-A and RT-A-VH-3.\n"
    title: 8.1.  Unicast Routing
  - contents:
    - "8.2.  Multicast Routing\n   All the PEs designated as V-spokes (PE-1, PE-2,
      PE-4, PE-5, PE-7, and\n   PE-8) are provisioned to export their I-PMSI/S-PMSI/SA
      A-D routes\n   using RT-A (just as with \"vanilla\" any-to-any MVPN).  Thus,
      these\n   routes could be imported by all the V-hubs (PE-3, PE-6, and PE-9).\n
      \  The V-hub on PE-3 is provisioned to export its I-PMSI/S-PMSI/SA A-D\n   routes
      with two RTs: RT-A and RT-A-VH-1.  Thus, these routes could be\n   imported
      by all the other V-hubs (PE-6 and PE-9) and also by the\n   V-spokes, but only
      by the V-spokes associated with the V-hub on PE-3\n   (PE-1 and PE-2).  In addition,
      the V-hub on PE-3 originates the\n   Associated-V-spoke-only I-PMSI A-D route
      with RT-A-VH-1.  This route\n   could be imported only by the V-spokes associated
      with the V-hub on\n   PE-3 (PE-1 and PE-2).\n   The V-hub on PE-6 is provisioned
      to export its I-PMSI/S-PMSI/SA A-D\n   routes with two RTs: RT-A and RT-A-VH-2.
      \ Thus, these routes could be\n   imported by all the other V-hubs (PE-3 and
      PE-9) and also by the\n   V-spokes, but only by the V-spokes associated with
      the V-hub on PE-6\n   (PE-4 and PE-5).  In addition, the V-hub on PE-6 originates
      the\n   Associated-V-spoke-only I-PMSI A-D route with RT-A-VH-2.  This route\n
      \  could be imported only by the V-spokes associated with the V-hub on\n   PE-6
      (PE-4 and PE-5).\n   The V-hub on PE-9 is provisioned to export its I-PMSI/S-PMSI/SA
      A-D\n   routes with two RTs: RT-A and RT-A-VH-3.  Thus, these routes could be\n
      \  imported by all the other V-hubs (PE-3 and PE-6) and also by the\n   V-spokes,
      but only by the V-spokes associated with the V-hub on PE-9\n   (PE-7 and PE-8).
      \ In addition, the V-hub on PE-9 originates the\n   Associated-V-spoke-only
      I-PMSI A-D route with RT-A-VH-3.  This route\n   could be imported only by the
      V-spokes associated with the V-hub on\n   PE-9 (PE-7 and PE-8).\n   If PE-7
      and PE-8, in addition to importing a VPN-IP default route\n   from PE-9, also
      want to import each other's VPN-IP routes, then PE-7\n   and PE-8 export their
      I-PMSI/S-PMSI/SA A-D routes with two RTs: RT-A\n   and RT-A-VH-3.\n   If the
      V-hub on PE-9 imports an S-PMSI A-D route or SA A-D route\n   originated by
      either some other V-hub (PE-3 or PE-6) or a V-spoke\n   that is not associated
      with this V-hub (PE-1, or PE-2, or PE-4, or\n   PE-5), the V-hub originates
      an S-PMSI A-D route (respectively, SA A-D\n   route).  The V-hub constructs
      this route from the imported route\n   following the procedures specified in
      Section 7.8.2.  Specifically,\n   the V-hub replaces the RT(s) carried in the
      imported route with just\n   one RT -- RT-A-VH-3.  Thus, the originated route
      could be imported\n   only by the V-spokes associated with the V-hub on PE-9
      (PE-7\n   and PE-8).\n"
    title: 8.2.  Multicast Routing
  title: 8.  An Example of RT Provisioning
- contents:
  - "9.  Further Refinements\n   In some cases, a VPN customer may not want to rely
    solely on an (IP)\n   default route being advertised from a V-spoke to a CE, but
    may want\n   CEs to receive all the VPN routes (e.g., for the purpose of faster\n
    \  detection of VPN connectivity failures and activating some backup\n   connectivity).\n
    \  In this case, an OPTIONAL approach would be to install in the\n   V-spoke's
    data plane only the VPN-IP default route advertised by the\n   V-hub associated
    with the V-spoke, even if the V-spoke receives an IP\n   default route from the
    CE, and to keep all the VPN-IP routes in the\n   V-spoke's control plane (thus
    being able to advertise these routes as\n   IP routes from the V-spoke to the
    CEs).  Granted, this would not\n   change control-plane resource consumption but
    would reduce forwarding\n   state on the data plane.\n"
  title: 9.  Further Refinements
- contents:
  - "10.  Security Considerations\n   This document introduces no new security considerations
    above and\n   beyond those already specified in [RFC4364].\n"
  title: 10.  Security Considerations
- contents:
  - "11.  Acknowledgements\n   We would like to acknowledge Han Nguyen (AT&T) for
    his contributions\n   to this document.  We would like to thank Eric Rosen (Cisco)
    for his\n   review and comments.  We would also like to thank Samir Saad (AT&T),\n
    \  Jeffrey (Zhaohui) Zhang (Juniper), and Thomas Morin (Orange) for\n   their
    review and comments.\n"
  title: 11.  Acknowledgements
- contents:
  - '12.  References

    '
  - contents:
    - "12.1.  Normative References\n   [IANA-SAFI]  IANA Subsequent Address Family
      Identifiers (SAFI)\n                Parameters,\n                <http://www.iana.org/assignments/safi-namespace/>.\n
      \  [RFC2119]    Bradner, S., \"Key words for use in RFCs to Indicate\n                Requirement
      Levels\", BCP 14, RFC 2119, March 1997.\n   [RFC3031]    Rosen, E., Viswanathan,
      A., and R. Callon,\n                \"Multiprotocol Label Switching Architecture\",
      RFC 3031,\n                January 2001.\n   [RFC4360]    Sangli, S., Tappan,
      D., and Y. Rekhter, \"BGP Extended\n                Communities Attribute\",
      RFC 4360, February 2006.\n   [RFC4364]    Rosen, E. and Y. Rekhter, \"BGP/MPLS
      IP Virtual Private\n                Networks (VPNs)\", RFC 4364, February 2006.\n
      \  [RFC4684]    Marques, P., Bonica, R., Fang, L., Martini, L., Raszuk,\n                R.,
      Patel, K., and J. Guichard, \"Constrained Route\n                Distribution
      for Border Gateway Protocol/MultiProtocol\n                Label Switching (BGP/MPLS)
      Internet Protocol (IP)\n                Virtual Private Networks (VPNs)\", RFC
      4684, November\n                2006.\n   [RFC6513]    Rosen, E., Ed., and R.
      Aggarwal, Ed., \"Multicast in\n                MPLS/BGP IP VPNs\", RFC 6513,
      February 2012.\n   [RFC6514]    Aggarwal, R., Rosen, E., Morin, T., and Y. Rekhter,
      \"BGP\n                Encodings and Procedures for Multicast in MPLS/BGP IP\n
      \               VPNs\", RFC 6514, February 2012.\n   [RFC6625]    Rosen, E.,
      Ed., Rekhter, Y., Ed., Hendrickx, W., and R.\n                Qiu, \"Wildcards
      in Multicast VPN Auto-Discovery Routes\",\n                RFC 6625, May 2012.\n"
    title: 12.1.  Normative References
  - contents:
    - "12.2.  Informative References\n   [MPLS-MCAST] Rekhter, Y., Aggarwal, R., Morin,
      T., Grosclaude, I.,\n                Leymann, N., and S. Saad, \"Inter-Area
      P2MP Segmented\n                LSPs\", Work in Progress, May 2013.\n"
    title: 12.2.  Informative References
  title: 12.  References
- contents:
  - "Authors' Addresses\n   Huajin Jeng\n   AT&T\n   EMail: hj2387@att.com\n   James
    Uttaro\n   AT&T\n   EMail: ju1738@att.com\n   Luay Jalil\n   Verizon\n   EMail:
    luay.jalil@verizon.com\n   Bruno Decraene\n   Orange\n   EMail: bruno.decraene@orange.com\n
    \  Yakov Rekhter\n   Juniper Networks, Inc.\n   EMail: yakov@juniper.net\n   Rahul
    Aggarwal\n   Arktan\n   EMail: raggarwa_1@yahoo.com\n"
  title: Authors' Addresses
