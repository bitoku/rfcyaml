- title: __initial_text__
  contents:
  - '         Mapping of Address and Port using Translation (MAP-T)

    '
- title: Abstract
  contents:
  - "Abstract\n   This document specifies the solution architecture based on \"Mapping\n\
    \   of Address and Port\" stateless IPv6-IPv4 Network Address Translation\n  \
    \ (NAT64) for providing shared or non-shared IPv4 address connectivity\n   to\
    \ and across an IPv6 network.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This\
    \ document is a product of the Internet Engineering Task Force\n   (IETF).  It\
    \ represents the consensus of the IETF community.  It has\n   received public\
    \ review and has been approved for publication by the\n   Internet Engineering\
    \ Steering Group (IESG).  Further information on\n   Internet Standards is available\
    \ in Section 2 of RFC 5741.\n   Information about the current status of this document,\
    \ any errata,\n   and how to provide feedback on it may be obtained at\n   http://www.rfc-editor.org/info/rfc7599.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2015 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (http://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.  Code Components\
    \ extracted from this document must\n   include Simplified BSD License text as\
    \ described in Section 4.e of\n   the Trust Legal Provisions and are provided\
    \ without warranty as\n   described in the Simplified BSD License.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1. Introduction ....................................................4\n\
    \   2. Conventions .....................................................4\n  \
    \ 3. Terminology .....................................................5\n   4.\
    \ Architecture ....................................................6\n   5. Mapping\
    \ Rules ...................................................8\n      5.1. Destinations\
    \ outside the MAP Domain ........................8\n   6. The IPv6 Interface Identifier\
    \ ...................................9\n   7. MAP-T Configuration ............................................10\n\
    \      7.1. MAP CE ....................................................10\n  \
    \    7.2. MAP BR ....................................................11\n   8.\
    \ MAP-T Packet Forwarding ........................................11\n      8.1.\
    \ IPv4 to IPv6 at the CE ....................................11\n      8.2. IPv6\
    \ to IPv4 at the CE ....................................12\n      8.3. IPv6 to\
    \ IPv4 at the BR ....................................12\n      8.4. IPv4 to IPv6\
    \ at the BR ....................................13\n   9. ICMP Handling ..................................................13\n\
    \   10. Fragmentation and Path MTU Discovery ..........................14\n  \
    \    10.1. Fragmentation in the MAP Domain ..........................14\n    \
    \  10.2. Receiving IPv4 Fragments on the MAP Domain Borders .......14\n      10.3.\
    \ Sending IPv4 Fragments to the Outside ....................14\n   11. NAT44 Considerations\
    \ ..........................................15\n   12. Usage Considerations ..........................................15\n\
    \      12.1. EA-Bit Length 0 ..........................................15\n  \
    \    12.2. Mesh and Hub-and-Spoke Modes .............................15\n    \
    \  12.3. Communication with IPv6 Servers in the MAP-T Domain ......15\n      12.4.\
    \ Compatibility with Other NAT64 Solutions .................16\n   13. Security\
    \ Considerations .......................................16\n   14. References\
    \ ....................................................17\n      14.1. Normative\
    \ References .....................................17\n      14.2. Informative\
    \ References ...................................18\n   Appendix A. Examples of\
    \ MAP-T Translation .........................21\n   Appendix B. Port-Mapping Algorithm\
    \ ................................24\n   Acknowledgements ..................................................25\n\
    \   Contributors ......................................................25\n  \
    \ Authors' Addresses ................................................26\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   Experiences from initial service provider IPv6 network deployments,\n\
    \   such as [RFC6219], indicate that successful transition to IPv6 can\n   happen\
    \ while supporting legacy IPv4 users without a full end-to-end\n   dual-IP-stack\
    \ deployment.  However, due to public IPv4 address\n   exhaustion, this requires\
    \ an IPv6 technology that supports IPv4 users\n   utilizing shared IPv4 addressing,\
    \ while also allowing the network\n   operator to optimize their operations around\
    \ IPv6 network practices.\n   The use of double NAT64 translation-based solutions\
    \ is an optimal way\n   to address these requirements, especially in combination\
    \ with\n   stateless translation techniques that minimize operational challenges\n\
    \   outlined in [Solutions-4v6].\n   The Mapping of Address and Port using Translation\
    \ (MAP-T)\n   architecture specified in this document is such a double stateless\n\
    \   NAT64-based solution.  It builds on existing stateless NAT64\n   techniques\
    \ specified in [RFC6145], along with the stateless\n   algorithmic address and\
    \ transport-layer port-mapping scheme defined\n   in the Mapping of Address and\
    \ Port with Encapsulation (MAP-E)\n   specification [RFC7597].  The MAP-T solution\
    \ differs from MAP-E in\n   that MAP-T uses IPv4-IPv6 translation, rather than\
    \ encapsulation, as\n   the form of IPv6 domain transport.  The translation mode\
    \ is\n   considered advantageous in scenarios where the encapsulation\n   overhead,\
    \ or IPv6 operational practices (e.g., the use of IPv6-only\n   servers, or reliance\
    \ on IPv6 + protocol headers for traffic\n   classification) rule out encapsulation.\
    \  These scenarios are\n   presented in [MAP-T-Use-Cases].\n"
- title: 2.  Conventions
  contents:
  - "2.  Conventions\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\", \"SHALL\"\
    , \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"MAY\", and\
    \ \"OPTIONAL\" in this\n   document are to be interpreted as described in RFC\
    \ 2119 [RFC2119].\n"
- title: 3.  Terminology
  contents:
  - "3.  Terminology\n   MAP-T:                  Mapping of Address and Port using\n\
    \                           Translation.\n   MAP Customer Edge (CE): A device\
    \ functioning as a Customer Edge\n                           router in a MAP deployment.\
    \  A typical MAP CE\n                           adopting MAP Rules will serve\
    \ a residential\n                           site with one WAN-side IPv6-addressed\n\
    \                           interface and one or more LAN-side interfaces\n  \
    \                         addressed using private IPv4 addressing.\n   MAP Border\
    \ Relay (BR):  A MAP-enabled router managed by the service\n                 \
    \          provider at the edge of a MAP domain.  A BR\n                     \
    \      has at least an IPv6-enabled interface and an\n                       \
    \    IPv4 interface connected to the native IPv4\n                           network.\
    \  A MAP BR may also be referred to as\n                           simply a \"\
    BR\" within the context of MAP.\n   MAP domain:             One or more MAP CEs\
    \ and BRs connected by\n                           means of an IPv6 network and\
    \ sharing a common\n                           set of MAP Rules.  A service provider\
    \ may\n                           deploy a single MAP domain or may utilize\n\
    \                           multiple MAP domains.\n   MAP Rule:              \
    \ A set of parameters describing the mapping\n                           between\
    \ an IPv4 prefix, IPv4 address, or\n                           shared IPv4 address\
    \ and an IPv6 prefix or\n                           address.  Each MAP domain\
    \ uses a different\n                           mapping rule set.\n   MAP rule\
    \ set:           A rule set is composed of all the MAP Rules\n               \
    \            communicated to a device that are intended to\n                 \
    \          determine the device's IP+port mapping and\n                      \
    \     forwarding operations.  The MAP rule set is\n                          \
    \ interchangeably referred to in this document\n                           as\
    \ a MAP rule table or as simply a \"rule\n                           table\".\
    \  Two specific types of rules -- the\n                           Basic Mapping\
    \ Rule (BMR) and the Forwarding\n                           Mapping Rule (FMR)\
    \ -- are defined in\n                           Section 5 of [RFC7597].  The Default\
    \ Mapping\n                           Rule (DMR) is defined in this document.\n\
    \   MAP rule table:         See MAP rule set.\n   MAP node:               A device\
    \ that implements MAP.\n   Port set:               Each node has a separate part\
    \ of the\n                           transport-layer port space; this is denoted\n\
    \                           as a port set.\n   Port Set ID (PSID):     Algorithmically\
    \ identifies a set of ports\n                           exclusively assigned to\
    \ a CE.\n   Shared IPv4 address:    An IPv4 address that is shared among multiple\n\
    \                           CEs.  Only ports that belong to the assigned\n   \
    \                        port set can be used for communication.  Also\n     \
    \                      known as a port-restricted IPv4 address.\n   End-user IPv6\
    \ prefix:   The IPv6 prefix assigned to an End-user CE by\n                  \
    \         means other than MAP itself, e.g.,\n                           provisioned\
    \ using DHCPv6 Prefix Delegation\n                           (PD) [RFC3633], assigned\
    \ via Stateless\n                           Address Autoconfiguration (SLAAC)\
    \ [RFC4862],\n                           or configured manually.  It is unique\
    \ for\n                           each CE.\n   MAP IPv6 address:       The IPv6\
    \ address used to reach the MAP\n                           function of a CE from\
    \ other CEs and from BRs.\n   Rule IPv6 prefix:       An IPv6 prefix assigned\
    \ by a service provider\n                           for a MAP Rule.\n   Rule IPv4\
    \ prefix:       An IPv4 prefix assigned by a service provider\n              \
    \             for a MAP Rule.\n   Embedded Address (EA) bits:\n              \
    \             The IPv4 EA-bits in the IPv6 address identify\n                \
    \           an IPv4 prefix/address (or part thereof) or a\n                  \
    \         shared IPv4 address (or part thereof) and a\n                      \
    \     Port Set Identifier.\n"
- title: 4.  Architecture
  contents:
  - "4.  Architecture\n   Figure 1 depicts the overall MAP-T architecture, which sees\
    \ any\n   number of privately addressed IPv4 users (N and M) connected by means\n\
    \   of MAP-T CEs to an IPv6 network that is equipped with one or more\n   MAP-T\
    \ BRs.  CEs and BRs that share MAP configuration parameters,\n   referred to as\
    \ \"MAP Rules\", form a MAP-T domain.\n   Functionally, the MAP-T CE and BR utilize\
    \ and extend some\n   well-established technology building blocks to allow the\
    \ IPv4 users\n   to correspond with nodes on the public IPv4 network or on the\
    \ IPv6\n   network as follows:\n   o  A (NAT44) Network Address and Port Translation\
    \ (NAPT) [RFC2663]\n      function on a MAP CE is extended with support for restricting\
    \ the\n      allowable TCP/UDP ports for a given IPv4 address.  The IPv4\n   \
    \   address and port range used are determined by the MAP provisioning\n     \
    \ process and identical to MAP-E [RFC7597].\n   o  A stateless NAT64 function\
    \ [RFC6145] is extended to allow\n      stateless mapping of IPv4 and transport-layer\
    \ port ranges to the\n      IPv6 address space.\n         User N\n       Private\
    \ IPv4\n      |  Network\n      |\n   O--+---------------O\n   |  | MAP-T CE \
    \     |\n   | +-----+--------+ |\n   | NAPT44|  MAP-T | |\n   | +-----+      \
    \  | +-._   ,-------.                     .------.\n   |       +--------+ |  \
    \ ,-'         `-.                ,-'       `-.\n   O------------------O  /   \
    \           \\   O---------O /   Public   \\\n                         /   IPv6-only\
    \   \\  |  MAP-T  |/     IPv4     \\\n                        (    Network   \
    \   --+  Border +-   Network     )\n                         \\              \
    \ /  |  Relay  |\\              /\n   O------------------O  \\              /\
    \   O---------O \\             /\n   |    MAP-T CE      |   ;\".         ,-' \
    \               `-.       ,-'\n   | +-----+--------+ | ,\"   `----+--'       \
    \               ------'\n   | NAPT44|  MAP-T | |,          |\n   | +-----+   \
    \     | +        IPv6 node(s)\n   |   |   +--------+ |  (with IPv4-embedded IPv6\
    \ address)\n   O---+--------------O\n       |\n         User M\n       Private\
    \ IPv4\n         Network\n                       Figure 1: MAP-T Architecture\n\
    \   Each MAP-T CE is assigned with a regular IPv6 prefix from the\n   operator's\
    \ IPv6 network.  This, in conjunction with MAP domain\n   configuration settings\
    \ and the use of the MAP procedures, allows the\n   computation of a MAP IPv6\
    \ address and a corresponding IPv4 address.\n   To allow for IPv4 address sharing,\
    \ the CE may also have to be\n   configured with a TCP/UDP port range that is\
    \ identified by means of a\n   MAP Port Set Identifier (PSID) value.  Each CE\
    \ is responsible for\n   forwarding traffic between a given user's private IPv4\
    \ address space\n   and the MAP domain's IPv6 address space.  The IPv4-IPv6 adaptation\n\
    \   uses stateless NAT64, in conjunction with the MAP algorithm for\n   address\
    \ computation.\n   The MAP-T BR connects one or more MAP-T domains to external\
    \ IPv4\n   networks using stateless NAT64 as extended by the MAP-T behavior\n\
    \   described in this document.\n   In contrast to MAP-E, NAT64 technology is\
    \ used in the architecture\n   for two purposes.  First, it is intended to diminish\
    \ encapsulation\n   overhead and allow IPv4 and IPv6 traffic to be treated as\
    \ similarly\n   as possible.  Second, it is intended to allow IPv4-only nodes\
    \ to\n   correspond directly with IPv6 nodes in the MAP-T domain that have\n \
    \  IPv4-embedded IPv6 addresses as per [RFC6052].\n   The MAP-T architecture is\
    \ based on the following key properties:\n   1.  Algorithmic IPv4-IPv6 address\
    \ mapping codified as MAP Rules, as\n       described in Section 5\n   2.  A MAP\
    \ IPv6 address identifier, as described in Section 6\n   3.  MAP-T IPv4-IPv6 forwarding\
    \ behavior, as described in Section 8\n"
- title: 5.  Mapping Rules
  contents:
  - "5.  Mapping Rules\n   The MAP-T algorithmic mapping rules are identical to those\
    \ in\n   Section 5 of the MAP-E specification [RFC7597], with the following\n\
    \   exception: the forwarding of traffic to and from IPv4 destinations\n   outside\
    \ a MAP-T domain is to be performed as described in this\n   document, instead\
    \ of Section 5.4 of the MAP-E specification.\n"
- title: 5.1.  Destinations outside the MAP Domain
  contents:
  - "5.1.  Destinations outside the MAP Domain\n   IPv4 traffic sent by MAP nodes\
    \ that are all within one MAP domain is\n   translated to IPv6, with the sender's\
    \ MAP IPv6 address, derived via\n   the Basic Mapping Rule (BMR), as the IPv6\
    \ source address and the\n   recipient's MAP IPv6 address, derived via the Forwarding\
    \ Mapping Rule\n   (FMR), as the IPv6 destination address.\n   IPv4-addressed\
    \ destinations outside of the MAP domain are represented\n   by means of IPv4-embedded\
    \ IPv6 addresses as per [RFC6052], using the\n   BR's IPv6 prefix.  For a CE sending\
    \ traffic to any such destination,\n   the source address of the IPv6 packet will\
    \ be that of the CE's MAP\n   IPv6 address, and the destination IPv6 address will\
    \ be the\n   destination IPv4-embedded IPv6 address.  This address mapping is\
    \ said\n   to be following the MAP-T Default Mapping Rule (DMR) and is defined\n\
    \   in terms of the IPv6 prefix advertised by one or more BRs, which\n   provide\
    \ external connectivity.  A typical MAP-T CE will install an\n   IPv4 default\
    \ route using this rule.  A BR will use this rule when\n   translating all outside\
    \ IPv4 source addresses to the IPv6 MAP domain.\n   The DMR IPv6 prefix length\
    \ SHOULD be 64 bits long by default and in\n   any case MUST NOT exceed 96 bits.\
    \  The mapping of the IPv4\n   destination behind the IPv6 prefix will by default\
    \ follow the /64\n   rule as per [RFC6052].  Any trailing bits after the IPv4\
    \ address are\n   set to 0x0.\n"
- title: 6.  The IPv6 Interface Identifier
  contents:
  - "6.  The IPv6 Interface Identifier\n   The interface identifier format of a MAP-T\
    \ node is the same as the\n   format described in Section 6 of [RFC7597].  The\
    \ format diagram is\n   provided here for convenience:\n                   | \
    \         128-n-o-s bits          |\n                   | 16 bits|    32 bits\
    \     | 16 bits|\n                   +--------+----------------+--------+\n  \
    \                 |   0    |  IPv4 address  |  PSID  |\n                   +--------+----------------+--------+\n\
    \                    Figure 2: IPv6 Interface Identifier\n   In the case of an\
    \ IPv4 prefix, the IPv4 address field is right-padded\n   with zeros up to 32\
    \ bits.  The PSID is left-padded with zeros to\n   create a 16-bit field.  For\
    \ an IPv4 prefix or a complete IPv4\n   address, the PSID field is zero.\n   If\
    \ the End-user IPv6 prefix length is larger than 64, the most\n   significant\
    \ parts of the interface identifier are overwritten by the\n   prefix.\n"
- title: 7.  MAP-T Configuration
  contents:
  - "7.  MAP-T Configuration\n   For a given MAP domain, the BR and CE MUST be configured\
    \ with the\n   following MAP parameters.  The values for these parameters are\n\
    \   identical for all CEs and BRs within a given MAP-T domain.\n   o  The Basic\
    \ Mapping Rule and, optionally, the Forwarding Mapping\n      Rules, including\
    \ the Rule IPv6 prefix, Rule IPv4 prefix, and\n      Length of embedded address\
    \ bits\n   o  Use of hub-and-spoke mode or Mesh mode (if all traffic should be\n\
    \      sent to the BR, or if direct CE-to-CE correspondence should be\n      supported)\n\
    \   o  Use of IPv4-IPv6 translation (MAP-T)\n   o  The BR's IPv6 prefix used in\
    \ the DMR\n"
- title: 7.1.  MAP CE
  contents:
  - "7.1.  MAP CE\n   For a given MAP domain, the MAP configuration parameters are\
    \ the same\n   across all CEs within that domain.  These values may be conveyed\
    \ and\n   configured on the CEs using a variety of methods, including DHCPv6,\n\
    \   the Broadband Forum's \"TR-69\" Residential Gateway management\n   interface\
    \ [TR069], the Network Configuration Protocol (NETCONF), or\n   manual configuration.\
    \  This document does not prescribe any of these\n   methods but recommends that\
    \ a MAP CE SHOULD implement DHCPv6 options\n   as per [RFC7598].  Other configuration\
    \ and management methods may use\n   the data model described by this option for\
    \ consistency and\n   convenience of implementation on CEs that support multiple\n\
    \   configuration methods.\n   Besides the MAP configuration parameters, a CE\
    \ requires an IPv6\n   prefix to be assigned to the CE.  This End-user IPv6 prefix\
    \ is\n   configured as part of obtaining IPv6 Internet access and is acquired\n\
    \   using standard IPv6 means applicable in the network where the CE is\n   located.\n\
    \   The MAP provisioning parameters, and hence the IPv4 service itself,\n   are\
    \ tied to the End-user IPv6 prefix; thus, the MAP service is also\n   tied to\
    \ this in terms of authorization, accounting, etc.\n   A single MAP CE MAY be\
    \ connected to more than one MAP domain, just as\n   any router may have more\
    \ than one IPv4-enabled service-provider-\n   facing interface and more than one\
    \ set of associated addresses\n   assigned by DHCPv6.  Each domain within which\
    \ a given CE operates\n   would require its own set of MAP configuration elements\
    \ and would\n   generate its own IPv4 address.  Each MAP domain requires a distinct\n\
    \   End-user IPv6 prefix.\n"
- title: 7.2.  MAP BR
  contents:
  - "7.2.  MAP BR\n   The MAP BR MUST be configured with the same MAP elements as\
    \ the MAP\n   CEs operating within the same domain.\n   For increased reliability\
    \ and load balancing, the BR IPv6 prefix MAY\n   be shared across a given MAP\
    \ domain.  As MAP is stateless, any BR may\n   be used for forwarding to/from\
    \ the domain at any time.\n   Since MAP uses provider address space, no specific\
    \ IPv6 or IPv4\n   routes need to be advertised externally outside the service\n\
    \   provider's network for MAP to operate.  However, the BR prefix needs\n   to\
    \ be advertised in the service provider's IGP.\n"
- title: 8.  MAP-T Packet Forwarding
  contents:
  - "8.  MAP-T Packet Forwarding\n   The end-to-end packet flow in MAP-T involves\
    \ an IPv4 or IPv6 packet\n   being forwarded by a CE or BR in one of two directions\
    \ for each such\n   case.  This section presents a conceptual view of the operations\n\
    \   involved in such forwarding.\n"
- title: 8.1.  IPv4 to IPv6 at the CE
  contents:
  - "8.1.  IPv4 to IPv6 at the CE\n   A MAP-T CE receiving IPv4 packets SHOULD perform\
    \ NAPT44 processing\n   and create any necessary NAPT44 bindings.  The source\
    \ address and\n   source port range of packets resulting from the NAPT44 processing\n\
    \   MUST correspond to the source IPv4 address and source transport port\n   range\
    \ assigned to the CE by means of the MAP Basic Mapping Rule\n   (BMR).\n   The\
    \ IPv4 packet is subject to a longest IPv4 destination address +\n   port match\
    \ MAP Rule selection, which then determines the parameters\n   for the subsequent\
    \ NAT64 operation.  By default, all traffic is\n   matched to the DMR and is subject\
    \ to the stateless NAT64 operation\n   using the DMR parameters for NAT64 (Section\
    \ 5.1).  Packets that are\n   matched to (optional) Forwarding Mapping Rules (FMRs)\
    \ are subject to\n   the stateless NAT64 operation using the FMR parameters (Section\
    \ 5)\n   for the MAP algorithm.  In all cases, the CE's MAP IPv6 address\n   (Section\
    \ 6) is used as a source address.\n   A MAP-T CE MUST support a Default Mapping\
    \ Rule and SHOULD support one\n   or more Forwarding Mapping Rules.\n"
- title: 8.2.  IPv6 to IPv4 at the CE
  contents:
  - "8.2.  IPv6 to IPv4 at the CE\n   A MAP-T CE receiving an IPv6 packet performs\
    \ its regular IPv6\n   operations (filtering, pre-routing, etc.).  Only packets\
    \ that are\n   addressed to the CE's MAP-T IPv6 addresses, and with source addresses\n\
    \   matching the IPv6 MAP Rule prefixes of a DMR or FMR, are processed by\n  \
    \ the MAP-T CE, with the DMR or FMR being selected based on a longest\n   match.\
    \  The CE MUST check that each MAP-T received packet's\n   transport-layer destination\
    \ port number is in the range allowed for\n   by the CE's MAP BMR configuration.\
    \  The CE MUST silently drop any\n   nonconforming packet and increment an appropriate\
    \ counter.  When\n   receiving a packet whose source IP address longest matches\
    \ an FMR\n   prefix, the CE MUST perform a check of consistency of the source\n\
    \   address against the allowed values as per the derived allocated\n   source\
    \ port range.  If the source port number of a packet is found to\n   be outside\
    \ the allocated range, the CE MUST drop the packet and\n   SHOULD respond with\
    \ an ICMPv6 \"Destination Unreachable, source\n   address failed ingress/egress\
    \ policy\" (Type 1, Code 5).\n   For each MAP-T processed packet, the CE's NAT64\
    \ function MUST compute\n   an IPv4 source and destination address.  The IPv4\
    \ destination address\n   is computed by extracting relevant information from\
    \ the IPv6\n   destination and the information stored in the BMR as per Section\
    \ 5.\n   The IPv4 source address is formed by classifying a packet's source as\n\
    \   longest matching a DMR or FMR rule prefix, and then using the\n   respective\
    \ rule parameters for the NAT64 operation.\n   The resulting IPv4 packet is then\
    \ forwarded to the CE's NAPT44\n   function, where the destination IPv4 address\
    \ and port number MUST be\n   mapped to their original value before being forwarded\
    \ according to\n   the CE's regular IPv4 rules.  When the NAPT44 function is not\n\
    \   enabled, by virtue of MAP configuration, the traffic from the\n   stateless\
    \ NAT64 function is directly forwarded according to the CE's\n   IPv4 rules.\n"
- title: 8.3.  IPv6 to IPv4 at the BR
  contents:
  - "8.3.  IPv6 to IPv4 at the BR\n   A MAP-T BR receiving an IPv6 packet MUST select\
    \ a matching MAP Rule\n   based on a longest address match of the packet's source\
    \ address\n   against the MAP Rules present on the BR.  In combination with the\n\
    \   Port Set ID derived from the packet's source IPv6 address, the\n   selected\
    \ MAP Rule allows the BR to verify that the CE is using its\n   allowed address\
    \ and port range.  Thus, the BR MUST perform a\n   validation of the consistency\
    \ of the source against the allowed\n   values from the identified port range.\
    \  If the packet's source port\n   number is found to be outside the range allowed,\
    \ the BR MUST drop the\n   packet and increment a counter to indicate the event.\
    \  The BR SHOULD\n   also respond with an ICMPv6 \"Destination Unreachable, source\
    \ address\n   failed ingress/egress policy\" (Type 1, Code 5).\n   When constructing\
    \ the IPv4 packet, the BR MUST derive the source and\n   destination IPv4 addresses\
    \ as per Section 5 of this document and\n   translate the IPv6-to-IPv4 headers\
    \ as per [RFC6145].  The resulting\n   IPv4 packet is then passed to regular IPv4\
    \ forwarding.\n"
- title: 8.4.  IPv4 to IPv6 at the BR
  contents:
  - "8.4.  IPv4 to IPv6 at the BR\n   A MAP-T BR receiving IPv4 packets uses a longest\
    \ match IPv4 +\n   transport-layer port lookup to identify the target MAP-T domain\
    \ and\n   select the FMR and DMR rules.  The MAP-T BR MUST then compute and\n\
    \   apply the IPv6 destination addresses from the IPv4 destination\n   address\
    \ and port as per the selected FMR.  The MAP-T BR MUST also\n   compute and apply\
    \ the IPv6 source addresses from the IPv4 source\n   address as per Section 5.1\
    \ (i.e., using the IPv4 source and the BR's\n   IPv6 prefix, it forms an IPv6-embedded\
    \ IPv4 address).  The generic\n   IPv4-to-IPv6 header translation procedures outlined\
    \ in [RFC6145]\n   apply throughout.  The resulting IPv6 packets are then passed\
    \ to\n   regular IPv6 forwarding.\n   Note that the operation of a BR, when forwarding\
    \ to/from MAP-T\n   domains that are defined without IPv4 address sharing, is\
    \ the same as\n   that of stateless NAT64 IPv4/IPv6 translation.\n"
- title: 9.  ICMP Handling
  contents:
  - "9.  ICMP Handling\n   MAP-T CEs and BRs MUST follow ICMP/ICMPv6 translation as\
    \ per\n   [RFC6145]; however, additional behavior is also required due to the\n\
    \   presence of NAPT44.  Unlike TCP and UDP, which provide two transport-\n  \
    \ protocol port fields to represent both source and destination, the\n   ICMP/ICMPv6\
    \ [RFC792] [RFC4443] Query message header has only one ID\n   field, which needs\
    \ to be used to identify a sending IPv4 host.  When\n   receiving IPv4 ICMP messages,\
    \ the MAP-T CE MUST rewrite the ID field\n   to a port value derived from the\
    \ CE's Port Set ID.\n   A MAP-T BR receiving an IPv4 ICMP packet that contains\
    \ an ID field\n   that is bound for a shared address in the MAP-T domain SHOULD\
    \ use the\n   ID value as a substitute for the destination port in determining\
    \ the\n   IPv6 destination address.  In all other cases, the MAP-T BR MUST\n \
    \  derive the destination IPv6 address by simply mapping the destination\n   IPv4\
    \ address without additional port information.\n"
- title: 10.  Fragmentation and Path MTU Discovery
  contents:
  - "10.  Fragmentation and Path MTU Discovery\n   Due to the different sizes of the\
    \ IPv4 and IPv6 headers, handling the\n   maximum packet size is relevant for\
    \ the operation of any system\n   connecting the two address families.  There\
    \ are three mechanisms to\n   handle this issue: Path MTU Discovery (PMTUD), fragmentation,\
    \ and\n   transport-layer negotiation such as the TCP Maximum Segment Size\n \
    \  (MSS) option [RFC879].  MAP can use all three mechanisms to deal with\n   different\
    \ cases.\n   Note: The NAT64 [RFC6145] mechanism is not lossless.  When\n   IPv4-originated\
    \ communication traverses a double NAT64 function\n   (a.k.a. NAT464), any IPv4-originated\
    \ ICMP-independent Path MTU\n   Discovery, as specified in [RFC4821], ceases to\
    \ be entirely reliable.\n   This is because the DF=1/MF=1 combination as defined\
    \ in [RFC4821]\n   results in DF=0/MF=1 after a double NAT64 translation.\n"
- title: 10.1.  Fragmentation in the MAP Domain
  contents:
  - "10.1.  Fragmentation in the MAP Domain\n   Translating an IPv4 packet to carry\
    \ it across the MAP domain will\n   increase its size (typically by 20 bytes).\
    \  The MTU in the MAP domain\n   should be well managed, and the IPv6 MTU on the\
    \ CE WAN-side interface\n   SHOULD be configured so that no fragmentation occurs\
    \ within the\n   boundary of the MAP domain.\n   Fragmentation in MAP-T domains\
    \ SHOULD be handled as described in\n   Sections 4 and 5 of [RFC6145].\n"
- title: 10.2.  Receiving IPv4 Fragments on the MAP Domain Borders
  contents:
  - "10.2.  Receiving IPv4 Fragments on the MAP Domain Borders\n   The forwarding\
    \ of an IPv4 packet received from outside of the MAP\n   domain requires the IPv4\
    \ destination address and the transport-\n   protocol destination port.  The transport-protocol\
    \ information is\n   only available in the first fragment received.  As described\
    \ in\n   Section 5.3.3 of [RFC6346], a MAP node receiving an IPv4 fragmented\n\
    \   packet from outside SHOULD reassemble the packet before sending the\n   packet\
    \ onto the MAP domain.  If the first packet received contains\n   the transport-protocol\
    \ information, it is possible to optimize this\n   behavior by using a cache and\
    \ forwarding the fragments unchanged.  A\n   description of such a caching algorithm\
    \ is outside the scope of this\n   document.\n"
- title: 10.3.  Sending IPv4 Fragments to the Outside
  contents:
  - "10.3.  Sending IPv4 Fragments to the Outside\n   Two IPv4 hosts behind two different\
    \ MAP CEs with the same IPv4\n   address sending fragments to an IPv4 destination\
    \ host outside the\n   domain may happen to use the same IPv4 fragmentation identifier,\n\
    \   resulting in incorrect reassembly of the fragments at the destination\n  \
    \ host.  Given that the IPv4 fragmentation identifier is a 16-bit\n   field, it\
    \ can be used similarly to port ranges.  Thus, a MAP CE\n   SHOULD rewrite the\
    \ IPv4 fragmentation identifier to a value\n   equivalent to a port of its allocated\
    \ port set.\n"
- title: 11.  NAT44 Considerations
  contents:
  - "11.  NAT44 Considerations\n   The NAT44 implemented in the MAP CE SHOULD conform\
    \ to the behavior\n   and best current practices documented in [RFC4787], [RFC5508],\
    \ and\n   [RFC5382].  In MAP address-sharing mode (determined by the MAP\n   domain\
    \ / rule configuration parameters), the operation of the NAT44\n   MUST be restricted\
    \ to the available port numbers derived via the\n   Basic Mapping Rule.\n"
- title: 12.  Usage Considerations
  contents:
  - '12.  Usage Considerations

    '
- title: 12.1.  EA-Bit Length 0
  contents:
  - "12.1.  EA-Bit Length 0\n   The MAP solution supports the use and configuration\
    \ of domains where\n   a BMR expresses an EA-bit length of 0.  This results in\
    \ independence\n   between the IPv6 prefix assigned to the CE and the IPv4 address\n\
    \   and/or port range used by MAP.  The k-bits of PSID information may in\n  \
    \ this case be derived from the BMR.\n   The constraint imposed is that each such\
    \ MAP domain be composed of\n   just one MAP CE that has a predetermined IPv6\
    \ end-user prefix.  The\n   BR would be configured with an FMR for each such Customer\
    \ Premises\n   Equipment (CPE), where the rule would uniquely associate the IPv4\n\
    \   address + optional PSID and the IPv6 prefix of that given CE.\n"
- title: 12.2.  Mesh and Hub-and-Spoke Modes
  contents:
  - "12.2.  Mesh and Hub-and-Spoke Modes\n   The hub-and-spoke mode of communication,\
    \ whereby all traffic sent by\n   a MAP-T CE is forwarded via a BR, and the Mesh\
    \ mode, whereby a CE is\n   directly able to forward traffic to another CE, are\
    \ governed by the\n   activation of Forwarding Mapping Rules that cover the IPv4-prefix\n\
    \   destination and port-index range.  By default, a MAP CE configured\n   only\
    \ with a BMR, as per this specification, will use it to configure\n   its IPv4\
    \ parameters and IPv6 MAP address without enabling Mesh mode.\n"
- title: 12.3.  Communication with IPv6 Servers in the MAP-T Domain
  contents:
  - "12.3.  Communication with IPv6 Servers in the MAP-T Domain\n   By default, MAP-T\
    \ allows communication between both IPv4-only and any\n   IPv6-enabled devices,\
    \ as well as with native IPv6-only servers,\n   provided that the servers are\
    \ configured with an IPv4-mapped IPv6\n   address.  This address could be part\
    \ of the IPv6 prefix used by the\n   DMR in the MAP-T domain.  Such IPv6 servers\
    \ (e.g., an HTTP server or\n   a web content cache device) are thus able to serve\
    \ IPv6 users and\n   IPv4-only users alike, utilizing IPv6.  Any such IPv6-only\
    \ servers\n   SHOULD have both A and AAAA records in DNS.  DNS64 [RFC6147] will\
    \ be\n   required only when IPv6 servers in the MAP-T domain are themselves\n\
    \   expected to initiate communication to external IPv4-only hosts.\n"
- title: 12.4.  Compatibility with Other NAT64 Solutions
  contents:
  - "12.4.  Compatibility with Other NAT64 Solutions\n   The MAP-T CE's NAT64 function\
    \ is by default compatible for use with\n   [RFC6146] stateful NAT64 devices that\
    \ are placed in the operator's\n   network.  In such a case, the MAP-T CE's DMR\
    \ prefix is configured to\n   correspond to the NAT64 device prefix.  This in\
    \ effect allows the use\n   of MAP-T CEs in environments that need to perform\
    \ statistical\n   multiplexing of IPv4 addresses, while utilizing stateful NAT64\n\
    \   devices, and can take the role of a customer-side translator (CLAT)\n   as\
    \ defined in [RFC6877].\n"
- title: 13.  Security Considerations
  contents:
  - "13.  Security Considerations\n   Spoofing attacks:  With consistency checks between\
    \ IPv4 and IPv6\n      sources that are performed on IPv4/IPv6 packets received\
    \ by MAP\n      nodes, MAP does not introduce any new opportunity for spoofing\n\
    \      attacks that would not already exist in IPv6.\n   Denial-of-service attacks:\
    \  In MAP domains where IPv4 addresses are\n      shared, the fact that IPv4 datagram\
    \ reassembly may be necessary\n      introduces an opportunity for DoS attacks.\
    \  This is inherent in\n      address sharing and is common with other address-sharing\n\
    \      approaches such as Dual-Stack Lite (DS-Lite) and NAT64/DNS64.  The\n  \
    \    best protection against such attacks is to accelerate IPv6 support\n    \
    \  in both clients and servers.\n   Routing loop attacks:  Routing loop attacks\
    \ may exist in some\n      \"automatic tunneling\" scenarios and are documented\
    \ in [RFC6324].\n      They cannot exist with MAP because each BR checks that\
    \ the IPv6\n      source address of a received IPv6 packet is a CE address based\
    \ on\n      the Forwarding Mapping Rule.\n   Attacks facilitated by restricted\
    \ port set:  From hosts that are not\n      subject to ingress filtering [RFC2827],\
    \ an attacker can inject\n      spoofed packets during ongoing transport connections\
    \ [RFC4953]\n      [RFC5961] [RFC6056].  The attacks depend on guessing which\
    \ ports\n      are currently used by target hosts.  Using an unrestricted port\n\
    \      set is preferable, i.e., using native IPv6 connections that are\n     \
    \ not subject to MAP port-range restrictions.  To minimize these\n      types\
    \ of attacks when using a restricted port set, the MAP CE's\n      NAT44 filtering\
    \ behavior SHOULD be \"Address-Dependent Filtering\"\n      as described in Section\
    \ 5 of [RFC4787].  Furthermore, the MAP CEs\n      SHOULD use a DNS transport\
    \ proxy function to handle DNS traffic\n      and source such traffic from IPv6\
    \ interfaces not assigned to\n      MAP-T.  Practicalities of these methods are\
    \ discussed in\n      Section 5.9 of [Stateless-4Via6].\n   ICMP Flooding:  Given\
    \ the necessity to process and translate ICMP and\n      ICMPv6 messages by the\
    \ BR and CE nodes, a foreseeable attack\n      vector is that of a flood of such\
    \ messages leading to a saturation\n      of the node's ICMP computing resources.\
    \  This attack vector is not\n      specific to MAP, and its mitigation lies in\
    \ a combination of\n      policing the rate of ICMP messages, policing the rate\
    \ at which\n      such messages can get processed by the MAP nodes, and of course\n\
    \      identifying and blocking off the source(s) of such traffic.\n   [RFC6269]\
    \ outlines general issues with IPv4 address sharing.\n"
- title: 14.  References
  contents:
  - '14.  References

    '
- title: 14.1.  Normative References
  contents:
  - "14.1.  Normative References\n   [RFC2119]  Bradner, S., \"Key words for use in\
    \ RFCs to Indicate\n              Requirement Levels\", BCP 14, RFC 2119,\n  \
    \            DOI 10.17487/RFC2119, March 1997,\n              <http://www.rfc-editor.org/info/rfc2119>.\n\
    \   [RFC6052]  Bao, C., Huitema, C., Bagnulo, M., Boucadair, M., and X.\n    \
    \          Li, \"IPv6 Addressing of IPv4/IPv6 Translators\", RFC 6052,\n     \
    \         DOI 10.17487/RFC6052, October 2010,\n              <http://www.rfc-editor.org/info/rfc6052>.\n\
    \   [RFC6145]  Li, X., Bao, C., and F. Baker, \"IP/ICMP Translation\n        \
    \      Algorithm\", RFC 6145, DOI 10.17487/RFC6145, April 2011,\n            \
    \  <http://www.rfc-editor.org/info/rfc6145>.\n   [RFC6346]  Bush, R., Ed., \"\
    The Address plus Port (A+P) Approach to\n              the IPv4 Address Shortage\"\
    , RFC 6346,\n              DOI 10.17487/RFC6346, August 2011,\n              <http://www.rfc-editor.org/info/rfc6346>.\n\
    \   [RFC7597]  Troan, O., Ed., Dec, W., Li, X., Bao, C., Matsushima, S.,\n   \
    \           Murakami, T., and T. Taylor, Ed., \"Mapping of Address and\n     \
    \         Port with Encapsulation (MAP-E)\", RFC 7597,\n              DOI 10.17487/RFC7597,\
    \ July 2015,\n              <http://www.rfc-editor.org/info/rfc7597>.\n"
- title: 14.2.  Informative References
  contents:
  - "14.2.  Informative References\n   [MAP-T-Use-Cases]\n              Maglione,\
    \ R., Ed., Dec, W., Leung, I., and E. Mallette,\n              \"Use cases for\
    \ MAP-T\", Work in Progress,\n              draft-maglione-softwire-map-t-scenarios-05,\
    \ October 2014.\n   [RFC792]   Postel, J., \"Internet Control Message Protocol\"\
    , STD 5,\n              RFC 792, DOI 10.17487/RFC0792, September 1981,\n     \
    \         <http://www.rfc-editor.org/info/rfc792>.\n   [RFC879]   Postel, J.,\
    \ \"The TCP Maximum Segment Size and Related\n              Topics\", RFC 879,\
    \ DOI 10.17487/RFC0879, November 1983,\n              <http://www.rfc-editor.org/info/rfc879>.\n\
    \   [RFC2663]  Srisuresh, P. and M. Holdrege, \"IP Network Address\n         \
    \     Translator (NAT) Terminology and Considerations\",\n              RFC 2663,\
    \ DOI 10.17487/RFC2663, August 1999,\n              <http://www.rfc-editor.org/info/rfc2663>.\n\
    \   [RFC2827]  Ferguson, P. and D. Senie, \"Network Ingress Filtering:\n     \
    \         Defeating Denial of Service Attacks which employ IP Source\n       \
    \       Address Spoofing\", BCP 38, RFC 2827, DOI 10.17487/RFC2827,\n        \
    \      May 2000, <http://www.rfc-editor.org/info/rfc2827>.\n   [RFC3633]  Troan,\
    \ O. and R. Droms, \"IPv6 Prefix Options for Dynamic\n              Host Configuration\
    \ Protocol (DHCP) version 6\", RFC 3633,\n              DOI 10.17487/RFC3633,\
    \ December 2003,\n              <http://www.rfc-editor.org/info/rfc3633>.\n  \
    \ [RFC4443]  Conta, A., Deering, S., and M. Gupta, Ed., \"Internet\n         \
    \     Control Message Protocol (ICMPv6) for the Internet\n              Protocol\
    \ Version 6 (IPv6) Specification\", RFC 4443,\n              DOI 10.17487/RFC4443,\
    \ March 2006,\n              <http://www.rfc-editor.org/info/rfc4443>.\n   [RFC4787]\
    \  Audet, F., Ed., and C. Jennings, \"Network Address\n              Translation\
    \ (NAT) Behavioral Requirements for Unicast\n              UDP\", BCP 127, RFC\
    \ 4787, DOI 10.17487/RFC4787,\n              January 2007, <http://www.rfc-editor.org/info/rfc4787>.\n\
    \   [RFC4821]  Mathis, M. and J. Heffner, \"Packetization Layer Path MTU\n   \
    \           Discovery\", RFC 4821, DOI 10.17487/RFC4821, March 2007,\n       \
    \       <http://www.rfc-editor.org/info/rfc4821>.\n   [RFC4862]  Thomson, S.,\
    \ Narten, T., and T. Jinmei, \"IPv6 Stateless\n              Address Autoconfiguration\"\
    , RFC 4862,\n              DOI 10.17487/RFC4862, September 2007,\n           \
    \   <http://www.rfc-editor.org/info/rfc4862>.\n   [RFC4953]  Touch, J., \"Defending\
    \ TCP Against Spoofing Attacks\",\n              RFC 4953, DOI 10.17487/RFC4953,\
    \ July 2007,\n              <http://www.rfc-editor.org/info/rfc4953>.\n   [RFC5382]\
    \  Guha, S., Ed., Biswas, K., Ford, B., Sivakumar, S., and P.\n              Srisuresh,\
    \ \"NAT Behavioral Requirements for TCP\", BCP 142,\n              RFC 5382, DOI\
    \ 10.17487/RFC5382, October 2008,\n              <http://www.rfc-editor.org/info/rfc5382>.\n\
    \   [RFC5508]  Srisuresh, P., Ford, B., Sivakumar, S., and S. Guha, \"NAT\n  \
    \            Behavioral Requirements for ICMP\", BCP 148, RFC 5508,\n        \
    \      DOI 10.17487/RFC5508, April 2009,\n              <http://www.rfc-editor.org/info/rfc5508>.\n\
    \   [RFC5961]  Ramaiah, A., Stewart, R., and M. Dalal, \"Improving TCP's\n   \
    \           Robustness to Blind In-Window Attacks\", RFC 5961,\n             \
    \ DOI 10.17487/RFC5961, August 2010,\n              <http://www.rfc-editor.org/info/rfc5961>.\n\
    \   [RFC6056]  Larsen, M. and F. Gont, \"Recommendations for Transport-\n    \
    \          Protocol Port Randomization\", BCP 156, RFC 6056,\n              DOI\
    \ 10.17487/RFC6056, January 2011,\n              <http://www.rfc-editor.org/info/rfc6056>.\n\
    \   [RFC6146]  Bagnulo, M., Matthews, P., and I. van Beijnum, \"Stateful\n   \
    \           NAT64: Network Address and Protocol Translation from IPv6\n      \
    \        Clients to IPv4 Servers\", RFC 6146, DOI 10.17487/RFC6146,\n        \
    \      April 2011, <http://www.rfc-editor.org/info/rfc6146>.\n   [RFC6147]  Bagnulo,\
    \ M., Sullivan, A., Matthews, P., and I. van\n              Beijnum, \"DNS64:\
    \ DNS Extensions for Network Address\n              Translation from IPv6 Clients\
    \ to IPv4 Servers\", RFC 6147,\n              DOI 10.17487/RFC6147, April 2011,\n\
    \              <http://www.rfc-editor.org/info/rfc6147>.\n   [RFC6219]  Li, X.,\
    \ Bao, C., Chen, M., Zhang, H., and J. Wu, \"The\n              China Education\
    \ and Research Network (CERNET) IVI\n              Translation Design and Deployment\
    \ for the IPv4/IPv6\n              Coexistence and Transition\", RFC 6219,\n \
    \             DOI 10.17487/RFC6219, May 2011,\n              <http://www.rfc-editor.org/info/rfc6219>.\n\
    \   [RFC6269]  Ford, M., Ed., Boucadair, M., Durand, A., Levis, P., and\n    \
    \          P. Roberts, \"Issues with IP Address Sharing\", RFC 6269,\n       \
    \       DOI 10.17487/RFC6269, June 2011,\n              <http://www.rfc-editor.org/info/rfc6269>.\n\
    \   [RFC6324]  Nakibly, G. and F. Templin, \"Routing Loop Attack Using\n     \
    \         IPv6 Automatic Tunnels: Problem Statement and Proposed\n           \
    \   Mitigations\", RFC 6324, DOI 10.17487/RFC6324, August 2011,\n            \
    \  <http://www.rfc-editor.org/info/rfc6324>.\n   [RFC6877]  Mawatari, M., Kawashima,\
    \ M., and C. Byrne, \"464XLAT:\n              Combination of Stateful and Stateless\
    \ Translation\",\n              RFC 6877, DOI 10.17487/RFC6877, April 2013,\n\
    \              <http://www.rfc-editor.org/info/rfc6877>.\n   [RFC7598]  Mrugalski,\
    \ T., Troan, O., Farrer, I., Perreault, S., Dec,\n              W., Bao, C., Yeh,\
    \ L., and X. Deng, \"DHCPv6 Options for\n              Configuration of Softwire\
    \ Address and Port-Mapped\n              Clients\", RFC 7598, DOI 10.17487/RFC7598,\
    \ July 2015,\n              <http://www.rfc-editor.org/info/rfc7598>.\n   [Solutions-4v6]\n\
    \              Boucadair, M., Ed., Matsushima, S., Lee, Y., Bonness, O.,\n   \
    \           Borges, I., and G. Chen, \"Motivations for Carrier-side\n        \
    \      Stateless IPv4 over IPv6 Migration Solutions\", Work in\n             \
    \ Progress, draft-ietf-softwire-stateless-4v6-motivation-05,\n              November\
    \ 2012.\n   [Stateless-4Via6]\n              Dec, W., Asati, R., Bao, C., Deng,\
    \ H., and M. Boucadair,\n              \"Stateless 4Via6 Address Sharing\", Work\
    \ in Progress,\n              draft-dec-stateless-4v6-04, October 2011.\n   [TR069]\
    \    Broadband Forum TR-069, \"CPE WAN Management Protocol\",\n              Amendment\
    \ 5, CWMP Version: 1.4, November 2013,\n              <https://www.broadband-forum.org>.\n"
- title: Appendix A.  Examples of MAP-T Translation
  contents:
  - "Appendix A.  Examples of MAP-T Translation\n   Example 1 - Basic Mapping Rule:\n\
    \   Given the following MAP domain information and IPv6 end-user prefix\n   assigned\
    \ to a MAP CE:\n   End-user IPv6 prefix:  2001:db8:0012:3400::/56\n   Basic Mapping\
    \ Rule:    {2001:db8:0000::/40 (Rule IPv6 prefix),\n                         \
    \  192.0.2.0/24 (Rule IPv4 prefix),\n                           16 (Rule EA-bit\
    \ length)}\n   PSID length:           (16 - (32 - 24) = 8 (sharing ratio of 256)\n\
    \   PSID offset:           6 (default)\n   A MAP node (CE or BR) can, via the\
    \ BMR or equivalent FMR, determine\n   the IPv4 address and port set as shown\
    \ below:\n   EA bits offset:        40\n   IPv4 suffix bits (p):  Length of IPv4\
    \ address (32) -\n                          IPv4 prefix length (24) = 8\n   IPv4\
    \ address:          192.0.2.18 (0xc0000212)\n   PSID start:            40 + p\
    \ = 40 + 8 = 48\n   PSID length (q):       o - p = (End-user prefix len -\n  \
    \                        Rule IPv6 prefix len) - p\n                         \
    \ = (56 - 40) - 8 = 8\n   PSID:                  0x34\n   Available ports (63\
    \ ranges): 1232-1235, 2256-2259, ...... ,\n                                63696-63699,\
    \ 64720-64723\n   The BMR information allows a MAP CE to determine (complete)\
    \ its\n   IPv6 address within the indicated End-user IPv6 prefix.\n   IPv6 address\
    \ of MAP CE:  2001:db8:0012:3400:0000:c000:0212:0034\n   Example 2 - BR:\n   Another\
    \ example is a MAP-T BR configured with the following FMR\n   when receiving a\
    \ packet with the following characteristics:\n   IPv4 source address:       10.2.3.4\
    \ (0x0a020304)\n   TCP source port:           80\n   IPv4 destination address:\
    \  192.0.2.18 (0xc0000212)\n   TCP destination port:      1232\n   Forwarding\
    \ Mapping Rule:   {2001:db8::/40 (Rule IPv6 prefix),\n                       \
    \        192.0.2.0/24 (Rule IPv4 prefix),\n                               16 (Rule\
    \ EA-bit length)}\n   MAP-T BR Prefix (DMR):     2001:db8:ffff::/64\n   The above\
    \ information allows the BR to derive the mapped destination\n   IPv6 address\
    \ for the corresponding MAP-T CE, and also the source\n   IPv6 address for the\
    \ mapped IPv4 source address, as follows:\n   IPv4 suffix bits (p):     32 - 24\
    \ = 8 (18 (0x12))\n   PSID length:              8\n   PSID:  0               \
    \   x34 (1232)\n   The resulting IPv6 packet will have the following header fields:\n\
    \   IPv6 source address:      2001:db8:ffff:0:000a:0203:0400::\n   IPv6 destination\
    \ address: 2001:db8:0012:3400:0000:c000:0212:0034\n   TCP source port:       \
    \   80\n   TCP destination port:     1232\n   Example 3 - FMR:\n   An IPv4 host\
    \ behind a MAP-T CE (configured as per the previous\n   examples) corresponding\
    \ with IPv4 host 10.2.3.4 will have its\n   packets converted into IPv6 using\
    \ the DMR configured on the MAP-T\n   CE as follows:\n   Default Mapping Rule:\
    \         {2001:db8:ffff::/64 (Rule IPv6 prefix),\n                          \
    \        0.0.0.0/0 (Rule IPv4 prefix)}\n   IPv4 source address:          192.0.2.18\n\
    \   IPv4 destination address:     10.2.3.4\n   IPv4 source port:             1232\n\
    \   IPv4 destination port:        80\n   MAP-T CE IPv6 source address: 2001:db8:0012:3400:0000:c000:0212:0034\n\
    \   IPv6 destination address:     2001:db8:ffff:0:000a:0203:0400::\n   Example\
    \ 4 - Rule with no embedded address bits and no address\n   sharing:\n   End-user\
    \ IPv6 prefix:    2001:db8:0012:3400::/56\n   Basic Mapping Rule:      {2001:db8:0012:3400::/56\
    \ (Rule IPv6 prefix),\n                             192.0.2.1/32 (Rule IPv4 prefix),\n\
    \                             0 (Rule EA-bit length)}\n   PSID length:       \
    \      0 (sharing ratio is 1)\n   PSID offset:             n/a\n   A MAP node\
    \ can, via the BMR or equivalent FMR, determine the\n   IPv4 address and port\
    \ set as shown below:\n   EA bits offset:          0\n   IPv4 suffix bits (p):\
    \    Length of IPv4 address -\n                            IPv4 prefix length\
    \ = 32 - 32 = 0\n   IPv4 address:            192.0.2.18 (0xc0000212)\n   PSID\
    \ start:              0\n   PSID length:             0\n   PSID:             \
    \       null\n   The BMR information allows a MAP CE to also determine (complete)\
    \ its\n   full IPv6 address by combining the IPv6 prefix with the MAP interface\n\
    \   identifier (that embeds the IPv4 address).\n   IPv6 address of MAP CE:  2001:db8:0012:3400:0000:c000:0201:0000\n\
    \   Example 5 - Rule with no embedded address bits and address sharing\n   (sharing\
    \ ratio of 256):\n   End-user IPv6 prefix:    2001:db8:0012:3400::/56\n   Basic\
    \ Mapping Rule:      {2001:db8:0012:3400::/56 (Rule IPv6 prefix),\n          \
    \                   192.0.2.18/32 (Rule IPv4 prefix),\n                      \
    \       0 (Rule EA-bit length)}\n   PSID length:             (16 - (32 - 24))\
    \ = 8 (sharing ratio of 256;\n                            provisioned with DHCPv6)\n\
    \   PSID offset:             6 (default)\n   PSID:                    0x20 (provisioned\
    \ with DHCPv6)\n   A MAP node can, via the BMR, determine the IPv4 address and\
    \ port set\n   as shown below:\n   EA bits offset:          0\n   IPv4 suffix\
    \ bits (p):    Length of IPv4 address -\n                            IPv4 prefix\
    \ length = 32 - 32 = 0\n   IPv4 address             192.0.2.18 (0xc0000212)\n\
    \   PSID start:              0\n   PSID length:             8\n   PSID:      \
    \              0x34\n   Available ports (63 ranges): 1232-1235, 2256-2259, ......\
    \ ,\n                                63696-63699, 64720-64723\n   The BMR information\
    \ allows a MAP CE to also determine (complete) its\n   full IPv6 address by combining\
    \ the IPv6 prefix with the MAP interface\n   identifier (that embeds the IPv4\
    \ address and PSID).\n   IPv6 address of MAP CE:  2001:db8:0012:3400:0000:c000:0212:0034\n\
    \   Note that the IPv4 address and PSID are not derived from the IPv6\n   prefix\
    \ assigned to the CE but are provisioned separately, using, for\n   example, MAP\
    \ options in DHCPv6.\n"
- title: Appendix B.  Port-Mapping Algorithm
  contents:
  - "Appendix B.  Port-Mapping Algorithm\n   The driving principles and the mathematical\
    \ expression of the mapping\n   algorithm used by MAP can be found in Appendix\
    \ B of [RFC7597].\n"
- title: Acknowledgements
  contents:
  - "Acknowledgements\n   This document is based on the ideas of many, particularly\
    \ Remi\n   Despres, who has tirelessly worked on generalized mechanisms for\n\
    \   stateless address mapping.\n   The authors would also like to thank Mohamed\
    \ Boucadair, Guillaume\n   Gottard, Dan Wing, Jan Zorz, Nejc Skoberne, Tina Tsou,\
    \ Gang Chen,\n   Maoke Chen, Xiaohong Deng, Jouni Korhonen, Tomek Mrugalski, Jacni\n\
    \   Qin, Chunfa Sun, Qiong Sun, Leaf Yeh, Andrew Yourtchenko, Roberta\n   Maglione,\
    \ and Hongyu Chen for their review and comments.\n"
- title: Contributors
  contents:
  - "Contributors\n   The following individuals authored major contributions to this\n\
    \   document and made the document possible:\n   Chongfeng Xie\n   China Telecom\n\
    \   Room 708, No. 118, Xizhimennei Street\n   Beijing  100035\n   China\n   Phone:\
    \ +86-10-58552116\n   Email: xiechf@ctbri.com.cn\n   Qiong Sun\n   China Telecom\n\
    \   Room 708, No. 118, Xizhimennei Street\n   Beijing  100035\n   China\n   Phone:\
    \ +86-10-58552936\n   Email: sunqiong@ctbri.com.cn\n   Rajiv Asati\n   Cisco Systems\n\
    \   7025-6 Kit Creek Road\n   Research Triangle Park, NC  27709\n   United States\n\
    \   Email: rajiva@cisco.com\n   Gang Chen\n   China Mobile\n   29, Jinrong Avenue\n\
    \   Xicheng District, Beijing  100033\n   China\n   Email: phdgang@gmail.com,\
    \ chengang@chinamobile.com\n   Wentao Shang\n   CERNET Center/Tsinghua University\n\
    \   Room 225, Main Building, Tsinghua University\n   Beijing  100084\n   China\n\
    \   Email: wentaoshang@gmail.com\n   Guoliang Han\n   CERNET Center/Tsinghua University\n\
    \   Room 225, Main Building, Tsinghua University\n   Beijing  100084\n   China\n\
    \   Email: bupthgl@gmail.com\n   Yu Zhai\n   CERNET Center/Tsinghua University\n\
    \   Room 225, Main Building, Tsinghua University\n   Beijing  100084\n   China\n\
    \   Email: jacky.zhai@gmail.com\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Xing Li\n   CERNET Center/Tsinghua University\n   Room\
    \ 225, Main Building, Tsinghua University\n   Beijing  100084\n   China\n   Email:\
    \ xing@cernet.edu.cn\n   Congxiao Bao\n   CERNET Center/Tsinghua University\n\
    \   Room 225, Main Building, Tsinghua University\n   Beijing  100084\n   China\n\
    \   Email: congxiao@cernet.edu.cn\n   Wojciech Dec (editor)\n   Cisco Systems\n\
    \   Haarlerbergpark Haarlerbergweg 13-19\n   Amsterdam, NOORD-HOLLAND  1101 CH\n\
    \   The Netherlands\n   Email: wdec@cisco.com\n   Ole Troan\n   Cisco Systems\n\
    \   Philip Pedersens vei 1\n   Lysaker  1366\n   Norway\n   Email: ot@cisco.com\n\
    \   Satoru Matsushima\n   SoftBank Telecom\n   1-9-1 Higashi-Shinbashi, Munato-ku\n\
    \   Tokyo\n   Japan\n   Email: satoru.matsushima@g.softbank.co.jp\n   Tetsuya\
    \ Murakami\n   IP Infusion\n   1188 East Arques Avenue\n   Sunnyvale, CA  94085\n\
    \   United States\n   Email: tetsuya@ipinfusion.com\n"
