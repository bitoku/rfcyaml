- title: __initial_text__
  contents:
  - '                 IP Mobility Support for IPv4, Revised

    '
- title: Abstract
  contents:
  - "Abstract\n   This document specifies protocol enhancements that allow transparent\n\
    \   routing of IP datagrams to mobile nodes in the Internet.  Each mobile\n  \
    \ node is always identified by its home address, regardless of its\n   current\
    \ point of attachment to the Internet.  While situated away\n   from its home,\
    \ a mobile node is also associated with a care-of\n   address, which provides\
    \ information about its current point of\n   attachment to the Internet.  The\
    \ protocol provides for registering\n   the care-of address with a home agent.\
    \  The home agent sends\n   datagrams destined for the mobile node through a tunnel\
    \ to the care-\n   of address.  After arriving at the end of the tunnel, each\
    \ datagram\n   is then delivered to the mobile node.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This\
    \ document is a product of the Internet Engineering Task Force\n   (IETF).  It\
    \ represents the consensus of the IETF community.  It has\n   received public\
    \ review and has been approved for publication by the\n   Internet Engineering\
    \ Steering Group (IESG).  Further information on\n   Internet Standards is available\
    \ in Section 2 of RFC 5741.\n   Information about the current status of this document,\
    \ any errata,\n   and how to provide feedback on it may be obtained at\n   http://www.rfc-editor.org/info/rfc5944.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2010 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (http://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.  Code Components\
    \ extracted from this document must\n   include Simplified BSD License text as\
    \ described in Section 4.e of\n   the Trust Legal Provisions and are provided\
    \ without warranty as\n   described in the Simplified BSD License.\n   This document\
    \ may contain material from IETF Documents or IETF\n   Contributions published\
    \ or made publicly available before November\n   10, 2008.  The person(s) controlling\
    \ the copyright in some of this\n   material may not have granted the IETF Trust\
    \ the right to allow\n   modifications of such material outside the IETF Standards\
    \ Process.\n   Without obtaining an adequate license from the person(s) controlling\n\
    \   the copyright in such materials, this document may not be modified\n   outside\
    \ the IETF Standards Process, and derivative works of it may\n   not be created\
    \ outside the IETF Standards Process, except to format\n   it for publication\
    \ as an RFC or to translate it into languages other\n   than English.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1. Introduction ....................................................5\n\
    \      1.1. Protocol Requirements ......................................5\n  \
    \    1.2. Goals ......................................................6\n    \
    \  1.3. Assumptions ................................................6\n      1.4.\
    \ Applicability ..............................................6\n      1.5. New\
    \ Architectural Entities .................................7\n      1.6. Terminology\
    \ ................................................7\n      1.7. Protocol Overview\
    \ .........................................11\n      1.8. Message Format and Protocol\
    \ Extensibility .................14\n      1.9. Type-Length-Value Extension Format\
    \ for Mobile IP\n           Extensions ................................................16\n\
    \      1.10. Long Extension Format ....................................17\n  \
    \    1.11. Short Extension Format ...................................18\n   2.\
    \ Agent Discovery ................................................18\n      2.1.\
    \ Agent Advertisement .......................................19\n           2.1.1.\
    \ Mobility Agent Advertisement Extension .............21\n           2.1.2. Prefix-Lengths\
    \ Extension ...........................23\n           2.1.3. One-Byte Padding\
    \ Extension .........................24\n      2.2. Agent Solicitation ........................................24\n\
    \      2.3. Foreign Agent and Home Agent Considerations ...............24\n  \
    \         2.3.1. Advertised Router Addresses ........................26\n    \
    \       2.3.2. Sequence Numbers and Rollover Handling .............26\n      2.4.\
    \ Mobile Node Considerations ................................26\n           2.4.1.\
    \ Registration Required ..............................28\n           2.4.2. Move\
    \ Detection .....................................28\n           2.4.3. Returning\
    \ Home .....................................29\n           2.4.4. Sequence Numbers\
    \ and Rollover Handling .............29\n   3. Registration ...................................................29\n\
    \      3.1. Registration Overview .....................................30\n  \
    \    3.2. Authentication ............................................31\n    \
    \  3.3. Registration Request ......................................32\n      3.4.\
    \ Registration Reply ........................................34\n      3.5. Registration\
    \ Extensions ...................................38\n           3.5.1. Computing\
    \ Authentication Extension Values ..........38\n           3.5.2. Mobile-Home\
    \ Authentication Extension ...............39\n           3.5.3. Mobile-Foreign\
    \ Authentication Extension ............40\n           3.5.4. Foreign-Home Authentication\
    \ Extension ..............40\n      3.6. Mobile Node Considerations ................................41\n\
    \           3.6.1. Sending Registration Requests ......................43\n  \
    \         3.6.2. Receiving Registration Replies .....................47\n    \
    \       3.6.3. Registration Retransmission ........................50\n      3.7.\
    \ Foreign Agent Considerations ..............................50\n           3.7.1.\
    \ Configuration and Registration Tables ..............51\n           3.7.2. Receiving\
    \ Registration Requests ....................52\n           3.7.3. Receiving Registration\
    \ Replies .....................56\n      3.8. Home Agent Considerations .................................58\n\
    \           3.8.1. Configuration and Registration Tables ..............58\n  \
    \         3.8.2. Receiving Registration Requests ....................59\n    \
    \       3.8.3. Sending Registration Replies .......................64\n   4. Routing\
    \ Considerations .........................................66\n      4.1. Encapsulation\
    \ Types .......................................67\n      4.2. Unicast Datagram\
    \ Routing ..................................67\n           4.2.1. Mobile Node\
    \ Considerations .........................67\n           4.2.2. Foreign Agent\
    \ Considerations .......................68\n           4.2.3. Home Agent Considerations\
    \ ..........................69\n      4.3. Broadcast Datagrams .......................................70\n\
    \      4.4. Multicast Datagram Routing ................................71\n  \
    \    4.5. Mobile Routers ............................................72\n    \
    \  4.6. ARP, Proxy ARP, and Gratuitous ARP ........................74\n   5. Security\
    \ Considerations ........................................77\n      5.1. Message\
    \ Authentication Codes ..............................77\n      5.2. Areas of Security\
    \ Concern in This Protocol ................78\n      5.3. Key Management ............................................78\n\
    \      5.4. Picking Good Random Numbers ...............................78\n  \
    \    5.5. Privacy ...................................................79\n    \
    \  5.6. Ingress Filtering .........................................79\n      5.7.\
    \ Replay Protection for Registration Requests ...............79\n           5.7.1.\
    \ Replay Protection Using Timestamps .................80\n           5.7.2. Replay\
    \ Protection Using Nonces .....................81\n   6. IANA Considerations ............................................82\n\
    \      6.1. Mobile IP Message Types ...................................82\n  \
    \    6.2. Extensions to RFC 1256 Router Advertisement Messages ......83\n    \
    \  6.3. Extensions to Mobile IP Registration Messages .............83\n      6.4.\
    \ Code Values for Mobile IP Registration Reply Messages .....84\n   7. Acknowledgments\
    \ ................................................84\n   8. References .....................................................86\n\
    \      8.1. Normative References ......................................86\n  \
    \    8.2. Informative References ....................................87\n   Appendix\
    \ A. Link-Layer Considerations .............................90\n   Appendix B.\
    \ TCP Considerations ....................................90\n      B.1. TCP Timers\
    \ ................................................90\n      B.2. TCP Congestion\
    \ Management .................................91\n   Appendix C.  Example Scenarios\
    \ ....................................92\n      C.1. Registering with a Foreign\
    \ Agent Care-of Address ..........92\n      C.2. Registering with a Co-Located\
    \ Care-of Address .............93\n      C.3. Deregistration ............................................94\n\
    \   Appendix D. Applicability of Prefix-Lengths Extension .............94\n  \
    \ Appendix E. Interoperability Considerations .......................95\n   Appendix\
    \ F. Changes since RFC 3344 ................................96\n   Appendix G.\
    \ Example Messages ......................................98\n      G.1. Example\
    \ ICMP Agent Advertisement Message Format ...........98\n      G.2. Example Registration\
    \ Request Message Format ...............99\n      G.3. Example Registration Reply\
    \ Message Format ................100\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   IP version 4 assumes that a node's IP address uniquely identifies\
    \ the\n   node's point of attachment to the Internet.  Therefore, a node must\n\
    \   be located on the network indicated by its IP address in order to\n   receive\
    \ datagrams destined to it; otherwise, datagrams destined to\n   the node would\
    \ be undeliverable.  For a node to change its point of\n   attachment without\
    \ losing its ability to communicate, currently one\n   of the two following mechanisms\
    \ must typically be employed:\n   o  the node must change its IP address whenever\
    \ it changes its point\n      of attachment, or\n   o  host-specific routes must\
    \ be propagated throughout much of the\n      Internet routing fabric.\n   Both\
    \ of these alternatives are often unacceptable.  The first makes\n   it impossible\
    \ for a node to maintain transport and higher-layer\n   connections when the node\
    \ changes location.  The second has obvious\n   and severe scaling problems, especially\
    \ relevant considering the\n   explosive growth in sales of notebook (mobile)\
    \ computers.\n   A new, scalable mechanism is required for accommodating node\
    \ mobility\n   within the Internet.  This document defines such a mechanism, which\n\
    \   enables nodes to change their point of attachment to the Internet\n   without\
    \ changing their IP address.\n   Changes between this revised specification for\
    \ Mobile IP and the\n   original specifications (see [44], [14], [15], [20], [4],\
    \ and [50])\n   are detailed in Appendix F.\n"
- title: 1.1.  Protocol Requirements
  contents:
  - "1.1.  Protocol Requirements\n   A mobile node must be able to communicate with\
    \ other nodes after\n   changing its link-layer point of attachment to the Internet,\
    \ yet\n   without changing its IP address.\n   A mobile node must be able to communicate\
    \ with other nodes that do\n   not implement these mobility functions.  No protocol\
    \ enhancements are\n   required in hosts or routers that are not acting as any\
    \ of the new\n   architectural entities introduced in Section 1.5.\n   All messages\
    \ used to update another node as to the location of a\n   mobile node must be\
    \ authenticated in order to protect against remote\n   redirection attacks.\n"
- title: 1.2.  Goals
  contents:
  - "1.2.  Goals\n   The link by which a mobile node is directly attached to the Internet\n\
    \   may often be a wireless link.  This link may thus have a\n   substantially\
    \ lower bandwidth and higher error rate than traditional\n   wired networks. \
    \ Moreover, mobile nodes are likely to be battery\n   powered, and minimizing\
    \ power consumption is important.  Therefore,\n   the number of administrative\
    \ messages sent over the link by which a\n   mobile node is directly attached\
    \ to the Internet should be minimized,\n   and the size of these messages should\
    \ be kept as small as is\n   reasonably possible.\n"
- title: 1.3.  Assumptions
  contents:
  - "1.3.  Assumptions\n   The protocols defined in this document place no additional\n\
    \   constraints on the assignment of IP addresses.  That is, a mobile\n   node\
    \ can be assigned an IP address by the organization that owns the\n   machine.\n\
    \   This protocol assumes that mobile nodes will generally not change\n   their\
    \ point of attachment to the Internet more frequently than once\n   per second.\n\
    \   This protocol assumes that IP unicast datagrams are routed based on\n   the\
    \ Destination Address in the datagram header (and not, for example,\n   by source\
    \ address).\n"
- title: 1.4.  Applicability
  contents:
  - "1.4.  Applicability\n   Mobile IP is intended to enable nodes to move from one\
    \ IP subnet to\n   another.  It is just as suitable for mobility across homogeneous\n\
    \   media as it is for mobility across heterogeneous media.  That is,\n   Mobile\
    \ IP facilitates node movement from one Ethernet segment to\n   another, as well\
    \ as from an Ethernet segment to a wireless LAN, as\n   long as the mobile node's\
    \ IP address remains the same after such a\n   movement.\n   One can think of\
    \ Mobile IP as solving the \"macro\" mobility management\n   problem.  It is less\
    \ well suited for more \"micro\" mobility management\n   applications -- for example,\
    \ handoff amongst wireless transceivers,\n   each of which covers only a very\
    \ small geographic area.  As long as\n   node movement does not occur between\
    \ points of attachment on\n   different IP subnets, link-layer mechanisms for\
    \ mobility (i.e., link-\n   layer handoff) may offer faster convergence and far\
    \ less overhead\n   than Mobile IP.\n"
- title: 1.5.  New Architectural Entities
  contents:
  - "1.5.  New Architectural Entities\n   Mobile IP introduces the following new functional\
    \ entities:\n   Mobile Node\n      A host or router that changes its point of\
    \ attachment from one\n      network or subnetwork to another.  A mobile node\
    \ may change its\n      location without changing its IP address; it may continue\
    \ to\n      communicate with other Internet nodes at any location using its\n\
    \      (constant) IP address, assuming link-layer connectivity to a point\n  \
    \    of attachment is available.\n   Home Agent\n      A router on a mobile node's\
    \ home network that tunnels datagrams\n      for delivery to the mobile node when\
    \ it is away from home, and\n      maintains current location information for\
    \ the mobile node.\n   Foreign Agent\n      A router on a mobile node's visited\
    \ network that provides routing\n      services to the mobile node while registered.\
    \  The foreign agent\n      detunnels and delivers to the mobile node datagrams\
    \ that were\n      tunneled by the mobile node's home agent.  For datagrams sent\
    \ by a\n      mobile node, the foreign agent may serve as a default router for\n\
    \      registered mobile nodes.\n   A mobile node is given a long-term IP address\
    \ on a home network.\n   This home address is administered in the same way that\
    \ a \"permanent\"\n   IP address is provided to a stationary host.  When away\
    \ from its home\n   network, a \"care-of address\" is associated with the mobile\
    \ node and\n   reflects the mobile node's current point of attachment.  The mobile\n\
    \   node uses its home address as the source address of all IP datagrams\n   that\
    \ it sends, except where otherwise described in this document for\n   datagrams\
    \ sent for certain mobility management functions (e.g., as in\n   Section 3.6.1.1).\n"
- title: 1.6.  Terminology
  contents:
  - "1.6.  Terminology\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\", \"\
    SHALL\", \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"MAY\"\
    , and \"OPTIONAL\" in this\n   document are to be interpreted as described in\
    \ RFC 2119 [1].\n   In addition, this document frequently uses the following terms:\n\
    \   Authorization-Enabling Extension\n      An authentication that makes a (registration)\
    \ message acceptable\n      to the ultimate recipient of the registration message.\
    \  An\n      authorization-enabling extension MUST contain a Security Parameter\n\
    \      Index (SPI).\n      In this document, all uses of authorization-enabling\
    \ extension\n      refer to authentication extensions that enable the Registration\n\
    \      Request message to be acceptable to the home agent.  Using\n      additional\
    \ protocol structures specified outside of this document,\n      it may be possible\
    \ for the mobile node to provide authentication\n      of its registration to\
    \ the home agent, by way of another\n      authenticating entity within the network\
    \ that is acceptable to the\n      home agent (for example, see RFC 2794 [2]).\n\
    \   Agent Advertisement\n      An advertisement message constructed by attaching\
    \ a special\n      Extension to a Router Advertisement [5] message.\n   Authentication\n\
    \      The process of verifying (using cryptographic techniques, for all\n   \
    \   applications in this specification) the identity of the originator\n     \
    \ of a message.\n   Care-of Address\n      The termination point of a tunnel toward\
    \ a mobile node, for\n      datagrams forwarded to the mobile node while it is\
    \ away from home.\n      The protocol can use two different types of care-of address:\
    \ a\n      \"foreign agent care-of address\" is an address of a foreign agent\n\
    \      with which the mobile node is registered, and a \"co-located care-\n  \
    \    of address\" is an externally obtained local address that the\n      mobile\
    \ node has associated with one of its own network interfaces.\n   Correspondent\
    \ Node\n      A peer with which a mobile node is communicating.  A correspondent\n\
    \      node may be either mobile or stationary.\n   Foreign Network\n      Any\
    \ network other than the mobile node's home network.\n   Gratuitous ARP\n    \
    \  An Address Resolution Protocol (ARP) packet sent by a node in\n      order\
    \ to spontaneously cause other nodes to update an entry in\n      their ARP cache\
    \ [45].  See Section 4.6.\n   Home Address\n      An IP address that is assigned\
    \ for an extended period of time to a\n      mobile node.  It remains unchanged\
    \ regardless of where the node is\n      attached to the Internet.\n   Home Network\n\
    \      A network, possibly virtual, having a network prefix matching that\n  \
    \    of a mobile node's home address.  Note that standard IP routing\n      mechanisms\
    \ will deliver datagrams destined to a mobile node's home\n      address to the\
    \ mobile node's home network.\n   Link\n      A facility or medium over which\
    \ nodes can communicate at the link\n      layer.  A link underlies the network\
    \ layer.\n   Link-Layer Address\n      The address used to identify an endpoint\
    \ of some communication\n      over a physical link.  Typically, the link-layer\
    \ address is an\n      interface's Media Access Control (MAC) address.\n   Mobility\
    \ Agent\n      Either a home agent or a foreign agent.\n   Mobility Binding\n\
    \      The association of a home address with a care-of address, along\n     \
    \ with the remaining Lifetime of that association.\n   Mobility Security Association\n\
    \      A collection of security contexts, between a pair of nodes, which\n   \
    \   may be applied to Mobile IP protocol messages exchanged between\n      them.\
    \  Each context indicates an authentication algorithm and mode\n      (Section\
    \ 5.1), a secret (a shared key, or appropriate public/\n      private key pair),\
    \ and a style of replay protection in use\n      (Section 5.7).\n   Node\n   \
    \   A host or a router.\n   Nonce\n      A randomly chosen value, different from\
    \ previous choices, inserted\n      in a message to protect against replays.\n\
    \   Security Parameter Index (SPI)\n      An index identifying a security context\
    \ between a pair of nodes,\n      among the contexts available in the Mobility\
    \ Security Association.\n      SPI values 0 through 255 are reserved and MUST\
    \ NOT be used in any\n      Mobility Security Association.\n   Tunnel\n      The\
    \ path followed by a datagram while it is encapsulated.  The\n      model is that,\
    \ while it is encapsulated, a datagram is routed to a\n      knowledgeable decapsulating\
    \ agent, which decapsulates the datagram\n      and then correctly delivers it\
    \ to its ultimate destination.\n   Virtual Network\n      A network with no physical\
    \ instantiation beyond a router (with a\n      physical network interface on another\
    \ network).  The router (e.g.,\n      a home agent) generally advertises reachability\
    \ to the virtual\n      network using conventional routing protocols.\n   Visited\
    \ Network\n      A network other than a mobile node's home network, to which the\n\
    \      mobile node is currently connected.\n   Visitor List\n      The list of\
    \ mobile nodes visiting a foreign agent.\n"
- title: 1.7.  Protocol Overview
  contents:
  - "1.7.  Protocol Overview\n   The following support services are defined for Mobile\
    \ IP:\n   Agent Discovery\n      Home agents and foreign agents may advertise\
    \ their availability on\n      each link for which they provide service.  A newly\
    \ arrived mobile\n      node can send a solicitation on the link to learn if any\n\
    \      prospective agents are present.\n   Registration\n      When the mobile\
    \ node is away from home, it registers its care-of\n      address with its home\
    \ agent.  Depending on its method of\n      attachment, the mobile node will register\
    \ either directly with its\n      home agent, or through a foreign agent that\
    \ forwards the\n      registration to the home agent.\n   Silently Discard\n \
    \     The implementation discards the datagram without further\n      processing,\
    \ and without indicating an error to the sender.  The\n      implementation SHOULD\
    \ provide the capability of logging the error,\n      including the contents of\
    \ the discarded datagram, and SHOULD\n      record the event in a statistics counter.\n\
    \   The following steps provide a rough outline of operation of the\n   Mobile\
    \ IP protocol:\n   o  Mobility agents (i.e., foreign agents and home agents) advertise\n\
    \      their presence via Agent Advertisement messages (Section 2).  A\n     \
    \ mobile node may optionally solicit an Agent Advertisement message\n      from\
    \ any locally attached mobility agents through an Agent\n      Solicitation message.\n\
    \   o  A mobile node receives these Agent Advertisements and determines\n    \
    \  whether it is on its home network or a foreign network.\n   o  When the mobile\
    \ node detects that it is located on its home\n      network, it operates without\
    \ mobility services.  If returning to\n      its home network from being registered\
    \ elsewhere, the mobile node\n      deregisters with its home agent, through exchange\
    \ of a\n      Registration Request and Registration Reply message with it.\n \
    \  o  When a mobile node detects that it has moved to a foreign network,\n   \
    \   it obtains a care-of address on the foreign network.  The care-of\n      address\
    \ can either be determined from a foreign agent's\n      advertisements (a foreign\
    \ agent care-of address), or by some\n      external assignment mechanism such\
    \ as DHCP [34] (a co-located\n      care-of address).\n   o  The mobile node operating\
    \ away from home then registers its new\n      care-of address with its home agent\
    \ through exchange of a\n      Registration Request and Registration Reply message\
    \ with the home\n      agent, possibly via a foreign agent (Section 3).\n   o\
    \  Datagrams sent to the mobile node's home address are intercepted\n      by\
    \ its home agent, tunneled by the home agent to the mobile node's\n      care-of\
    \ address, received at the tunnel endpoint (either at a\n      foreign agent or\
    \ at the mobile node itself), and finally delivered\n      to the mobile node\
    \ (Section 4.2.3).\n   o  In the reverse direction, datagrams sent by the mobile\
    \ node are\n      generally delivered to their destination using standard IP routing\n\
    \      mechanisms, not necessarily passing through the home agent.\n   When away\
    \ from home, Mobile IP uses protocol tunneling to hide a\n   mobile node's home\
    \ address from intervening routers between its home\n   network and its current\
    \ location.  The tunnel terminates at the\n   mobile node's care-of address. \
    \ The care-of address must be an\n   address to which datagrams can be delivered\
    \ via conventional IP\n   routing.  At the care-of address, the original datagram\
    \ is removed\n   from the tunnel and delivered to the mobile node.\n   Mobile\
    \ IP provides two alternative modes for the acquisition of a\n   care-of address:\n\
    \   a.  A \"foreign agent care-of address\" is a care-of address provided\n  \
    \     by a foreign agent through its Agent Advertisement messages.  In\n     \
    \  this case, the care-of address is an IP address of the foreign\n       agent.\
    \  In this mode, the foreign agent is the endpoint of the\n       tunnel and,\
    \ upon receiving tunneled datagrams, decapsulates them\n       and delivers the\
    \ inner datagram to the mobile node.  This mode of\n       acquisition is preferred\
    \ because it allows many mobile nodes to\n       share the same care-of address\
    \ and therefore does not place\n       unnecessary demands on the already limited\
    \ IPv4 address space.\n   b.  A \"co-located care-of address\" is a care-of address\
    \ acquired by\n       the mobile node as a local IP address through some external\n\
    \       means, which the mobile node then associates with one of its own\n   \
    \    network interfaces.  The address may be dynamically acquired as a\n     \
    \  temporary address by the mobile node, such as through DHCP [34],\n       or\
    \ may be owned by the mobile node as a long-term address for its\n       use only\
    \ while visiting some foreign network.  Specific external\n       methods of acquiring\
    \ a local IP address for use as a co-located\n       care-of address are beyond\
    \ the scope of this document.  When\n       using a co-located care-of address,\
    \ the mobile node serves as the\n       endpoint of the tunnel and itself performs\
    \ decapsulation of the\n       datagrams tunneled to it.\n   The mode of using\
    \ a co-located care-of address has the advantage that\n   it allows a mobile node\
    \ to function without a foreign agent, for\n   example, in networks that have\
    \ not yet deployed a foreign agent.  It\n   does, however, place additional burden\
    \ on the IPv4 address space\n   because it requires a pool of addresses within\
    \ the foreign network to\n   be made available to visiting mobile nodes.  It is\
    \ difficult to\n   efficiently maintain pools of addresses for each subnet that\
    \ may\n   permit mobile nodes to visit.\n   It is important to understand the\
    \ distinction between the care-of\n   address and the foreign agent functions.\
    \  The care-of address is\n   simply the endpoint of the tunnel.  It might indeed\
    \ be an address of\n   a foreign agent (a foreign agent care-of address), but\
    \ it might\n   instead be an address temporarily acquired by the mobile node (a\n\
    \   co-located care-of address).  A foreign agent, on the other hand, is\n   a\
    \ mobility agent that provides services to mobile nodes.  See\n   Sections 3.7\
    \ and 4.2.2 for additional details.\n   A home agent MUST be able to attract and\
    \ intercept datagrams that are\n   destined to the home address of any of its\
    \ registered mobile nodes.\n   Using the proxy and gratuitous ARP mechanisms described\
    \ in Section\n   4.6, this requirement can be satisfied if the home agent has\
    \ a\n   network interface on the link indicated by the mobile node's home\n  \
    \ address.  Other placements of the home agent relative to the mobile\n   node's\
    \ home location MAY also be possible using other mechanisms for\n   intercepting\
    \ datagrams destined to the mobile node's home address.\n   Such placements are\
    \ beyond the scope of this document.\n   Similarly, a mobile node and a prospective\
    \ or current foreign agent\n   MUST be able to exchange datagrams without relying\
    \ on standard IP\n   routing mechanisms; that is, those mechanisms that make forwarding\n\
    \   decisions based upon the network-prefix of the Destination Address in\n  \
    \ the IP header.  This requirement can be satisfied if the foreign\n   agent and\
    \ the visiting mobile node have an interface on the same\n   link.  In this case,\
    \ the mobile node and foreign agent simply bypass\n   their normal IP routing\
    \ mechanism when sending datagrams to each\n   other, addressing the underlying\
    \ link-layer packets to their\n   respective link-layer addresses.  Other placements\
    \ of the foreign\n   agent relative to the mobile node MAY also be possible using\
    \ other\n   mechanisms to exchange datagrams between these nodes, but such\n \
    \  placements are beyond the scope of this document.\n               2) Datagram\
    \ is intercepted   3) Datagram is\n                  by home agent and       \
    \     detunneled and\n                  is tunneled to the           delivered\
    \ to the\n                  care-of address.             mobile node.\n      \
    \               +-----+          +-------+         +------+\n                \
    \     |home | =======> |foreign| ------> |mobile|\n                     |agent|\
    \          | agent | <------ | node |\n                     +-----+          +-------+\
    \         +------+\n    1) Datagram to    /|\\         /\n       mobile node \
    \    |        /   4) For datagrams sent by the\n       arrives on      |     \
    \ /        mobile node, standard IP\n       home network    |    /          routing\
    \ delivers each to its\n       via standard    |  |_           destination.  In\
    \ this figure,\n       IP routing.   +----+            the foreign agent is the\n\
    \                     |host|            mobile node's default router.\n      \
    \               +----+\n                    Figure 1:  Operation of Mobile IPv4\n\
    \   If a mobile node is using a co-located care-of address (as described\n   in\
    \ item (b) above), the mobile node MUST be located on the link\n   identified\
    \ by the network prefix of this care-of address.  Otherwise,\n   datagrams destined\
    \ to the care-of address would be undeliverable.\n   For example, Figure 1 illustrates\
    \ the routing of datagrams to and\n   from a mobile node away from home, once\
    \ the mobile node has\n   registered with its home agent.  In Figure 1, the mobile\
    \ node is\n   using a foreign agent care-of address, not a co-located care-of\n\
    \   address.\n"
- title: 1.8.  Message Format and Protocol Extensibility
  contents:
  - "1.8.  Message Format and Protocol Extensibility\n   Mobile IP defines a set of\
    \ new control messages, sent with UDP [17]\n   using well-known port number 434.\
    \  The following two message types\n   are defined in this document:\n      1\
    \ Registration Request\n      3 Registration Reply\n   Up-to-date values for the\
    \ message types for Mobile IP control\n   messages are specified in the IANA online\
    \ database [48].\n   In addition, for Agent Discovery, Mobile IP makes use of\
    \ the existing\n   Router Advertisement and Router Solicitation messages defined\
    \ for\n   ICMP Router Discovery [5].\n   Mobile IP defines a general Extension\
    \ mechanism to allow optional\n   information to be carried by Mobile IP control\
    \ messages or by ICMP\n   Router Discovery messages.  Some extensions have been\
    \ specified to be\n   encoded in the simple Type-Length-Value format described\
    \ in Section\n   1.9.\n   Extensions allow variable amounts of information to\
    \ be carried within\n   each datagram.  The end of the list of extensions is indicated\
    \ by the\n   total length of the IP datagram.\n   Two separately maintained sets\
    \ of numbering spaces, from which\n   Extension Type values are allocated, are\
    \ used in Mobile IP:\n   o  The first set consists of those Extensions that may\
    \ appear in\n      Mobile IP control messages (those sent to and from UDP port\
    \ number\n      434).  In this document, the following types are defined for\n\
    \      Extensions appearing in Mobile IP control messages:\n        0  One-byte\
    \ Padding (encoded with neither Length nor Data field)\n        32 Mobile-Home\
    \ Authentication\n        33 Mobile-Foreign Authentication\n        34 Foreign-Home\
    \ Authentication\n   o  The second set consists of those Extensions that may appear\
    \ in\n      ICMP Router Discovery messages [5].  In this document, the\n     \
    \ following types are defined for Extensions appearing in ICMP\n      Router Discovery\
    \ messages:\n        0  One-byte Padding (encoded with neither Length nor Data\
    \ field)\n        16 Mobility Agent Advertisement\n        19 Prefix-Lengths\n\
    \   Each individual Extension is described in detail in a separate\n   section\
    \ later in this document.  Up-to-date values for these\n   Extension Type numbers\
    \ are specified in the IANA online database\n   [48].\n   Due to the separation\
    \ (orthogonality) of these sets, it is\n   conceivable that two Extensions that\
    \ are defined at a later date\n   could have identical Type values, so long as\
    \ one of the Extensions\n   may be used only in Mobile IP control messages and\
    \ the other may be\n   used only in ICMP Router Discovery messages.\n   The Type\
    \ field in the Mobile IP extension structure can support up to\n   255 (skippable\
    \ and non-skippable) uniquely identifiable extensions.\n   When an Extension numbered\
    \ in either of these sets within the range 0\n   through 127 is encountered but\
    \ not recognized, the message containing\n   that Extension MUST be silently discarded.\
    \  When an Extension\n   numbered in the range 128 through 255 is encountered\
    \ that is not\n   recognized, that particular Extension is ignored, but the rest\
    \ of the\n   Extensions and message data MUST still be processed.  The Length\n\
    \   field of the Extension is used to skip the Data field in searching\n   for\
    \ the next Extension.\n   Unless additional structure is utilized for the extension\
    \ types, new\n   developments or additions to Mobile IP might require so many\
    \ new\n   extensions that the available space for extension types might run\n\
    \   out.  Two new extension structures are proposed to solve this\n   problem.\
    \  Certain types of extensions can be aggregated, using\n   subtypes to identify\
    \ the precise extension, for example as has been\n   done with the Generic Authentication\
    \ Keys extensions [46].  In many\n   cases, this may reduce the rate of allocation\
    \ for new values of the\n   Type field.\n   Since the new extension structures\
    \ will cause an efficient usage of\n   the extension type space, it is recommended\
    \ that new Mobile IP\n   extensions follow one of the two new extension formats\
    \ whenever there\n   may be the possibility of grouping related extensions together.\n\
    \   The following subsections provide details about three distinct\n   structures\
    \ for Mobile IP extensions:\n   o  The simple extension format\n   o  The long\
    \ extension format\n   o  The short extension format\n"
- title: 1.9.  Type-Length-Value Extension Format for Mobile IP Extensions
  contents:
  - "1.9.  Type-Length-Value Extension Format for Mobile IP Extensions\n   The Type-Length-Value\
    \ format illustrated in Figure 2 is used for\n   extensions that are specified\
    \ in this document.  Since this simple\n   extension structure does not encourage\
    \ the most efficient usage of\n   the extension type space, it is recommended\
    \ that new Mobile IP\n   extensions follow one of the two new extension formats\
    \ specified in\n   Section 1.10 or Section 1.11 whenever there may be the possibility\
    \ of\n   grouping related extensions together.\n               0             \
    \      1                   2\n               0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6\
    \ 7 8 9 0 1 2\n              +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-\n\
    \              |     Type      |    Length     |    Data ...\n              +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-\n\
    \       Figure 2:  Type-Length-Value Extension Format for Mobile IPv4\n   Type\
    \     Indicates the particular type of Extension.\n   Length   Indicates the length\
    \ (in bytes) of the Data field within\n            this Extension.  The length\
    \ does NOT include the Type and\n            Length bytes.\n   Data     The particular\
    \ data associated with this Extension.  This\n            field may be zero or\
    \ more bytes in length.  The format and\n            length of the Data field\
    \ is determined by the Type and\n            Length fields.\n"
- title: 1.10.  Long Extension Format
  contents:
  - "1.10.  Long Extension Format\n   This format is applicable for non-skippable\
    \ extensions that carry\n   information of more than 256 bytes.  Skippable extensions\
    \ can never\n   use the long format, because the receiver is not required to include\n\
    \   parsing code and is likely to treat the 8 bits immediately following\n   the\
    \ Type as the Length field.\n     0                   1                   2  \
    \                 3\n     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5\
    \ 6 7 8 9 0 1\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |     Type      |  Sub-Type     |           Length              |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |                           Data      .....\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   The Long Extension format requires that the following fields be\n   specified\
    \ as the first fields of the extension.\n   Type     is the type, which describes\
    \ a collection of extensions\n            having a common data type.\n   Sub-Type\
    \ is a unique number given to each member in the aggregated\n            type.\n\
    \   Length   indicates the length (in bytes) of the Data field within\n      \
    \      this Extension.  It does NOT include the Type, Length, and\n          \
    \  Sub-Type bytes.\n   Data     is the data associated with the subtype of this\
    \ extension.\n            This specification does not place any additional structure\n\
    \            on the subtype data.\n   Since the Length field is 16 bits wide,\
    \ the extension data can exceed\n   256 bytes in length.\n"
- title: 1.11.  Short Extension Format
  contents:
  - "1.11.  Short Extension Format\n   This format is compatible with the skippable\
    \ extensions defined in\n   Section 1.9.  It is not applicable for extensions\
    \ that require more\n   than 256 bytes of data; for such extensions, use the format\
    \ described\n   in Section 1.10.\n     0                   1                 \
    \  2                   3\n     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3\
    \ 4 5 6 7 8 9 0 1\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |     Type      |   Length      |    Sub-Type   |    Data ....\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   The Short Extension format requires that the following fields be\n   specified\
    \ as the first fields of the extension:\n   Type     is the type, which describes\
    \ a collection of extensions\n            having a common data type.\n   Sub-Type\
    \ is a unique number given to each member in the aggregated\n            type.\n\
    \   Length   8-bit unsigned integer.  Length of the extension, in bytes,\n   \
    \         excluding the extension Type and the extension Length\n            fields.\
    \  This field MUST be set to 1 plus the total length\n            of the Data\
    \ field.\n   Data     is the data associated with this extension.  This\n    \
    \        specification does not place any additional structure on the\n      \
    \      subtype data.\n"
- title: 2.  Agent Discovery
  contents:
  - "2.  Agent Discovery\n   Agent Discovery is the method by which a mobile node\
    \ determines\n   whether it is currently connected to its home network or to a\
    \ foreign\n   network, and by which a mobile node can detect when it has moved\
    \ from\n   one network to another.  When connected to a foreign network, the\n\
    \   methods specified in this section also allow the mobile node to\n   determine\
    \ the foreign agent care-of address being offered by each\n   foreign agent on\
    \ that network.\n   Mobile IP extends ICMP Router Discovery [5] as its primary\
    \ mechanism\n   for Agent Discovery.  An Agent Advertisement is formed by including\
    \ a\n   Mobility Agent Advertisement Extension in an ICMP Router\n   Advertisement\
    \ message (Section 2.1).  An Agent Solicitation message\n   is identical to an\
    \ ICMP Router Solicitation, except that its IP Time\n   to Live (TTL) MUST be\
    \ set to 1 (Section 2.2).  This section describes\n   the message formats and\
    \ procedures by which mobile nodes, foreign\n   agents, and home agents cooperate\
    \ to realize Agent Discovery.\n   Agent Advertisement and Agent Solicitation may\
    \ not be necessary for\n   link layers that already provide this functionality.\
    \  The method by\n   which mobile nodes establish link-layer connections with\
    \ prospective\n   agents is outside the scope of this document (but see Appendix\
    \ A).\n   The procedures described below assume that such link-layer\n   connectivity\
    \ has already been established.\n   No authentication is required for Agent Advertisement\
    \ and Agent\n   Solicitation messages.  They MAY be authenticated using the IP\n\
    \   Authentication Header [9], which is unrelated to the messages\n   described\
    \ in this document.  Further specification of the way in\n   which Advertisement\
    \ and Solicitation messages may be authenticated is\n   outside of the scope of\
    \ this document.\n"
- title: 2.1.  Agent Advertisement
  contents:
  - "2.1.  Agent Advertisement\n   Agent Advertisements are transmitted by a mobility\
    \ agent to advertise\n   its services on a link.  Mobile nodes use these advertisements\
    \ to\n   determine their current point of attachment to the Internet.  An\n  \
    \ Agent Advertisement is an ICMP Router Advertisement that has been\n   extended\
    \ to also carry a Mobility Agent Advertisement Extension\n   (Section 2.1.1) and,\
    \ optionally, a Prefix-Lengths Extension (Section\n   2.1.2), One-byte Padding\
    \ Extension (Section 2.1.3), or other\n   Extensions that might be defined in\
    \ the future.\n   Within an Agent Advertisement message, ICMP Router Advertisement\n\
    \   fields of the message are required to conform to the following\n   additional\
    \ specifications:\n      -  Link-Layer Fields\n         Destination Address\n\
    \                  The link-layer Destination Address of a unicast Agent\n   \
    \               Advertisement MUST be the same as the source link-\n         \
    \         layer address of the Agent Solicitation that prompted\n            \
    \      the Advertisement.\n      -  IP Fields\n         TTL      The TTL for all\
    \ Agent Advertisements MUST be set to 1.\n         Destination Address\n     \
    \             As specified for ICMP Router Discovery [5], the IP\n           \
    \       Destination Address of a multicast Agent Advertisement\n             \
    \     MUST be either the \"all systems on this link\"\n                  multicast\
    \ address (224.0.0.1) [6] or the \"limited\n                  broadcast\" address\
    \ (255.255.255.255).  The subnet-\n                  directed broadcast address\
    \ of the form <prefix>.<-1>\n                  cannot be used since mobile nodes\
    \ will not generally\n                  know the prefix of the foreign network.\
    \  When the\n                  Agent Advertisement is unicast to a mobile node,\
    \ the\n                  IP home address of the mobile node SHOULD be used as\n\
    \                  the Destination Address.\n      -  ICMP Fields\n         Code\
    \     The Code field of the Agent Advertisement is\n                  interpreted\
    \ as follows:\n                  0  The mobility agent handles common traffic\
    \ -- that\n                     is, it acts as a router for IP datagrams not\n\
    \                     necessarily related to mobile nodes.\n                 \
    \ 16 The mobility agent does not route common traffic.\n                     However,\
    \ all foreign agents MUST (minimally)\n                     forward to a default\
    \ router any datagrams received\n                     from a registered mobile\
    \ node (Section 4.2.2).\n         Lifetime\n               The maximum length\
    \ of time that the Advertisement is\n               considered valid in the absence\
    \ of further\n               Advertisements.\n         Router Address(es)\n  \
    \             See Section 2.3.1 for a discussion of the addresses that\n     \
    \          may appear in this portion of the Agent Advertisement.\n         Num\
    \ Addrs\n               The number of router addresses advertised in this\n  \
    \             message.  Note that in an Agent Advertisement message,\n       \
    \        the number of router addresses specified in the ICMP\n              \
    \ Router Advertisement portion of the message MAY be set to\n               0.\
    \  See Section 2.3.1 for details.\n   If sent periodically, the nominal interval\
    \ at which Agent\n   Advertisements are sent SHOULD be no longer than 1/3 of the\n\
    \   advertisement Lifetime given in the ICMP header.  This interval MAY\n   be\
    \ shorter than 1/3 the advertised Lifetime.  This allows a mobile\n   node to\
    \ miss three successive advertisements before deleting the\n   agent from its\
    \ list of valid agents.  The actual transmission time\n   for each advertisement\
    \ SHOULD be slightly randomized [5] in order to\n   avoid synchronization and\
    \ subsequent collisions with other Agent\n   Advertisements that may be sent by\
    \ other agents (or with other Router\n   Advertisements sent by other routers).\
    \  Note that this field has no\n   relation to the \"Registration Lifetime\" field\
    \ within the Mobility\n   Agent Advertisement Extension defined below.\n"
- title: 2.1.1.  Mobility Agent Advertisement Extension
  contents:
  - "2.1.1.  Mobility Agent Advertisement Extension\n   The Mobility Agent Advertisement\
    \ Extension follows the ICMP Router\n   Advertisement fields.  It is used to indicate\
    \ that an ICMP Router\n   Advertisement message is also an Agent Advertisement\
    \ being sent by a\n   mobility agent.  The Mobility Agent Advertisement Extension\
    \ is\n   defined as follows:\n     0                   1                   2 \
    \                  3\n     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5\
    \ 6 7 8 9 0 1\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |     Type      |    Length     |        Sequence Number        |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |    Registration Lifetime      |R|B|H|F|M|G|r|T|U|X|I|reserved |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |                  zero or more Care-of Addresses               |\n    |\
    \                              ...                              |\n      Type\
    \     16\n      Length   (6 + 4*N), where 6 accounts for the number of bytes in\n\
    \               the Sequence Number, Registration Lifetime, flags, and\n     \
    \          reserved fields, and N is the number of care-of addresses\n       \
    \        advertised.\n      Sequence Number\n               The count of Agent\
    \ Advertisement messages sent since the\n               agent was initialized\
    \ (Section 2.3.2).\n      Registration Lifetime\n               The longest lifetime\
    \ (measured in seconds) that this\n               agent is willing to accept in\
    \ any Registration Request.\n               A value of 0xffff indicates infinity.\
    \  This field has no\n               relation to the \"Lifetime\" field within\
    \ the ICMP Router\n               Advertisement portion of the Agent Advertisement.\n\
    \      R        Registration required.  Registration with this foreign\n     \
    \          agent (or another foreign agent on this link) is required\n       \
    \        even when using a co-located care-of address.\n      B        Busy. \
    \ The foreign agent will not accept registrations\n               from additional\
    \ mobile nodes.\n      H        Home agent.  This agent offers service as a home\
    \ agent on\n               the link on which this Agent Advertisement message\
    \ is\n               sent.\n      F        Foreign agent.  This agent offers service\
    \ as a foreign\n               agent on the link on which this Agent Advertisement\n\
    \               message is sent.\n      M        Minimal encapsulation.  This\
    \ agent implements receiving\n               tunneled datagrams that use minimal\
    \ encapsulation [15].\n      G        Generic Routing Encapsulation (GRE) encapsulation.\
    \  This\n               agent implements receiving tunneled datagrams that use\n\
    \               GRE encapsulation [13].\n      r        Sent as zero; ignored\
    \ on reception.  SHOULD NOT be\n               allocated for any other uses.\n\
    \      T        Foreign agent supports reverse tunneling as specified in\n   \
    \            [12].\n      U        Mobility agent supports UDP Tunneling as specified\
    \ in\n               [27].\n      X        Mobility agent supports Registration\
    \ Revocation as\n               specified in [28].\n      I        Foreign agent\
    \ supports Regional Registration as specified\n               in [29].\n     \
    \ reserved\n               Sent as zero; ignored on reception.\n      Care-of\
    \ Address(es)\n               The advertised foreign agent care-of address(es)\
    \ provided\n               by this foreign agent.  An Agent Advertisement MUST\n\
    \               include at least one care-of address if the 'F' bit is\n     \
    \          set.  The number of care-of addresses present is\n               determined\
    \ by the Length field in the Extension.\n   A home agent MUST always be prepared\
    \ to serve the mobile nodes for\n   which it is the home agent.  A foreign agent\
    \ may at times be too busy\n   to serve additional mobile nodes; even so, it must\
    \ continue to send\n   Agent Advertisements, so that any mobile nodes already\
    \ registered\n   with it will know that they have not moved out of range of the\n\
    \   foreign agent and that the foreign agent has not failed.  A foreign\n   agent\
    \ may indicate that it is \"too busy\" to allow new mobile nodes to\n   register\
    \ with it, by setting the 'B' bit in its Agent Advertisements.\n   An Agent Advertisement\
    \ message MUST NOT have the 'B' bit set if the\n   'F' bit is not also set.  Furthermore,\
    \ at least one of the 'F' bit\n   and the 'H' bit MUST be set in any Agent Advertisement\
    \ message sent.\n   When a foreign agent wishes to require registration even from\
    \ those\n   mobile nodes that have acquired a co-located care-of address, it sets\n\
    \   the 'R' bit to one.  Because this bit applies only to foreign agents,\n  \
    \ an agent MUST NOT set the 'R' bit to one unless the 'F' bit is also\n   set\
    \ to one.\n"
- title: 2.1.2.  Prefix-Lengths Extension
  contents:
  - "2.1.2.  Prefix-Lengths Extension\n   The Prefix-Lengths Extension MAY follow\
    \ the Mobility Agent\n   Advertisement Extension.  It is used to indicate the\
    \ number of bits\n   of network prefix that applies to each router address listed\
    \ in the\n   ICMP Router Advertisement portion of the Agent Advertisement.  Note\n\
    \   that the prefix lengths given DO NOT apply to care-of address(es)\n   listed\
    \ in the Mobility Agent Advertisement Extension.  The Prefix-\n   Lengths Extension\
    \ is defined as follows:\n    0                   1                   2      \
    \             3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8\
    \ 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |     Type      |    Length     | Prefix Length |      ....\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      Type     19 (Prefix-Lengths Extension)\n      Length   N, where N is the\
    \ value (possibly zero) of the Num Addrs\n               field in the ICMP Router\
    \ Advertisement portion of the\n               Agent Advertisement.\n      Prefix\
    \ Length(s)\n               The number of leading bits that define the network\
    \ number\n               of the corresponding router address listed in the ICMP\n\
    \               Router Advertisement portion of the message.  The prefix\n   \
    \            length for each router address is encoded as a separate\n       \
    \        byte, in the order that the router addresses are listed\n           \
    \    in the ICMP Router Advertisement portion of the message.\n   See Section\
    \ 2.4.2 for information about how the Prefix-Lengths\n   Extension MAY be used\
    \ by a mobile node when determining whether it\n   has moved.  See Appendix D\
    \ for implementation details about the use\n   of this Extension.\n"
- title: 2.1.3.  One-Byte Padding Extension
  contents:
  - "2.1.3.  One-Byte Padding Extension\n   Some IP protocol implementations insist\
    \ upon padding ICMP messages to\n   an even number of bytes.  If the ICMP length\
    \ of an Agent\n   Advertisement is odd, this Extension MAY be included in order\
    \ to make\n   the ICMP length even.  Note that this Extension is NOT intended\
    \ to be\n   a general-purpose Extension to be included in order to word- or long-\n\
    \   align the various fields of the Agent Advertisement.  An Agent\n   Advertisement\
    \ SHOULD NOT include more than one One-byte Padding\n   Extension and if present,\
    \ this Extension SHOULD be the last Extension\n   in the Agent Advertisement.\n\
    \   Note that, unlike other Extensions used in Mobile IP, the One-byte\n   Padding\
    \ Extension is encoded as a single byte, with no Length nor\n   Data field present.\
    \  The One-byte Padding Extension is defined as\n   follows:\n        0 1 2 3\
    \ 4 5 6 7\n       +-+-+-+-+-+-+-+-+\n       |     Type      |\n       +-+-+-+-+-+-+-+-+\n\
    \   Type 0 (One-byte Padding Extension)\n"
- title: 2.2.  Agent Solicitation
  contents:
  - "2.2.  Agent Solicitation\n   An Agent Solicitation is identical to an ICMP Router\
    \ Solicitation\n   with the further restriction that the IP TTL Field MUST be\
    \ set to 1.\n"
- title: 2.3.  Foreign Agent and Home Agent Considerations
  contents:
  - "2.3.  Foreign Agent and Home Agent Considerations\n   Any mobility agent that\
    \ cannot be discovered by a link-layer protocol\n   MUST send Agent Advertisements.\
    \  An agent that can be discovered by a\n   link-layer protocol SHOULD also implement\
    \ Agent Advertisements.\n   However, the Advertisements need not be sent, except\
    \ when the site\n   policy requires registration with the agent (i.e., when the\
    \ 'R' bit\n   is set), or as a response to a specific Agent Solicitation.  All\n\
    \   mobility agents MUST process packets that they receive addressed to\n   the\
    \ Mobile-Agents multicast group, at address 224.0.0.11.  A mobile\n   node MAY\
    \ send an Agent Solicitation to 224.0.0.11.  All mobility\n   agents SHOULD respond\
    \ to Agent Solicitations.\n   The same procedures, defaults, and constants are\
    \ used in Agent\n   Advertisement messages and Agent Solicitation messages as\
    \ specified\n   for ICMP Router Discovery [5], except that:\n   o  a mobility\
    \ agent MUST limit the rate at which it sends broadcast\n      or multicast Agent\
    \ Advertisements; the maximum rate SHOULD be\n      chosen so that the Advertisements\
    \ do not consume a significant\n      amount of network bandwidth, AND\n   o \
    \ a mobility agent that receives a Router Solicitation MUST NOT\n      require\
    \ that the IP Source Address is the address of a neighbor\n      (i.e., an address\
    \ that matches one of the router's own addresses\n      on the arrival interface,\
    \ under the subnet mask associated with\n      that address of the router).\n\
    \   o  a mobility agent MAY be configured to send Agent Advertisements\n     \
    \ only in response to an Agent Solicitation message.\n   If the home network is\
    \ not a virtual network, then the home agent for\n   any mobile node SHOULD be\
    \ located on the link identified by the\n   mobile node's home address, and Agent\
    \ Advertisement messages sent by\n   the home agent on this link MUST have the\
    \ 'H' bit set.  In this way,\n   mobile nodes on their own home network will be\
    \ able to determine that\n   they are indeed at home.  Any Agent Advertisement\
    \ messages sent by\n   the home agent on another link to which it may be attached\
    \ (if it is\n   a mobility agent serving more than one link), MUST NOT have the\
    \ 'H'\n   bit set unless the home agent also serves as a home agent (to other\n\
    \   mobile nodes) on that other link.  A mobility agent MAY use different\n  \
    \ settings for each of the 'R', 'H', and 'F' bits on different network\n   interfaces.\n\
    \   If the home network is a virtual network, the home network has no\n   physical\
    \ realization external to the home agent itself.  In this\n   case, there is no\
    \ physical network link on which to send Agent\n   Advertisement messages advertising\
    \ the home agent.  Mobile nodes for\n   which this is the home network are always\
    \ treated as being away from\n   home.\n   On a particular subnet, either all\
    \ mobility agents MUST include the\n   Prefix-Lengths Extension or all of them\
    \ MUST NOT include this\n   Extension.  Equivalently, it is prohibited for some\
    \ agents on a given\n   subnet to include the Extension but for others not to\
    \ include it.\n   Otherwise, one of the move detection algorithms designed for\
    \ mobile\n   nodes will not function properly (Section 2.4.2).\n"
- title: 2.3.1.  Advertised Router Addresses
  contents:
  - "2.3.1.  Advertised Router Addresses\n   The ICMP Router Advertisement portion\
    \ of the Agent Advertisement MAY\n   contain one or more router addresses.  An\
    \ agent SHOULD only put its\n   own addresses, if any, in the advertisement. \
    \ Whether or not its own\n   address appears in the router addresses, a foreign\
    \ agent MUST route\n   datagrams it receives from registered mobile nodes (Section\
    \ 3.7).\n"
- title: 2.3.2.  Sequence Numbers and Rollover Handling
  contents:
  - "2.3.2.  Sequence Numbers and Rollover Handling\n   The sequence number in Agent\
    \ Advertisements ranges from 0 to 0xffff.\n   After booting, an agent MUST use\
    \ the number 0 for its first\n   advertisement.  Each subsequent advertisement\
    \ MUST use the sequence\n   number one greater, with the exception that the sequence\
    \ number\n   0xffff MUST be followed by sequence number 256.  In this way, mobile\n\
    \   nodes can distinguish a reduction in the sequence number that occurs\n   after\
    \ a reboot from a reduction that results in rollover of the\n   sequence number\
    \ after it attains the value 0xffff.\n"
- title: 2.4.  Mobile Node Considerations
  contents:
  - "2.4.  Mobile Node Considerations\n   Every mobile node MUST implement Agent Solicitation.\
    \  Solicitations\n   SHOULD only be sent in the absence of Agent Advertisements\
    \ and when a\n   care-of address has not been determined through a link-layer\
    \ protocol\n   or other means.  The mobile node uses the same procedures, defaults,\n\
    \   and constants for Agent Solicitation as specified for ICMP Router\n   Solicitation\
    \ messages [5], except that the mobile node MAY solicit\n   more often than once\
    \ every three seconds, and that a mobile node that\n   is currently not connected\
    \ to any foreign agent MAY solicit more\n   times than MAX_SOLICITATIONS.\n  \
    \ The rate at which a mobile node sends solicitations MUST be limited\n   by the\
    \ mobile node.  The mobile node MAY send three initial\n   solicitations at a\
    \ maximum rate of one per second while searching for\n   an agent.  After this,\
    \ the rate at which solicitations are sent MUST\n   be reduced so as to limit\
    \ the overhead on the local link.  Subsequent\n   solicitations MUST be sent using\
    \ a binary exponential backoff\n   mechanism, doubling the interval between consecutive\
    \ solicitations,\n   up to a maximum interval.  The maximum interval SHOULD be\
    \ chosen\n   appropriately based upon the characteristics of the media over which\n\
    \   the mobile node is soliciting.  This maximum interval SHOULD be at\n   least\
    \ one minute between solicitations.\n   While still searching for an agent, the\
    \ mobile node MUST NOT increase\n   the rate at which it sends solicitations unless\
    \ it has received a\n   positive indication that it has moved to a new link. \
    \ After\n   successfully registering with an agent, the mobile node SHOULD also\n\
    \   increase the rate at which it will send solicitations when it next\n   begins\
    \ searching for a new agent with which to register.  The\n   increased solicitation\
    \ rate MAY revert to the maximum rate, but then\n   MUST be limited in the manner\
    \ described above.  In all cases, the\n   recommended solicitation intervals are\
    \ nominal values.  Mobile nodes\n   MUST randomize their solicitation times around\
    \ these nominal values\n   as specified for ICMP Router Discovery [5].\n   Mobile\
    \ nodes MUST process received Agent Advertisements.  A mobile\n   node can distinguish\
    \ an Agent Advertisement message from other uses\n   of the ICMP Router Advertisement\
    \ message by examining the number of\n   advertised addresses and the IP Total\
    \ Length field.  When the IP\n   total length indicates that the ICMP message\
    \ is longer than needed\n   for the number of advertised addresses, the remaining\
    \ data is\n   interpreted as one or more Extensions.  The presence of a Mobility\n\
    \   Agent Advertisement Extension identifies the advertisement as an\n   Agent\
    \ Advertisement.\n   If there is more than one advertised address, the mobile\
    \ node SHOULD\n   pick the first address for its initial registration attempt.\
    \  If the\n   registration attempt fails with a status code indicating rejection\
    \ by\n   the foreign agent, the mobile node MAY retry the attempt with each\n\
    \   subsequent advertised address in turn.\n   When multiple methods of agent\
    \ discovery are in use, the mobile node\n   SHOULD first attempt registration\
    \ with agents including Mobility\n   Agent Advertisement Extensions in their advertisements,\
    \ in preference\n   to those discovered by other means.  This preference maximizes\
    \ the\n   likelihood that the registration will be recognized, thereby\n   minimizing\
    \ the number of registration attempts.\n   A mobile node MUST ignore reserved\
    \ bits in Agent Advertisements, as\n   opposed to discarding such advertisements.\
    \  In this way, new bits can\n   be defined later, without affecting the ability\
    \ for mobile nodes to\n   use the advertisements even when the newly defined bits\
    \ are not\n   understood.\n"
- title: 2.4.1.  Registration Required
  contents:
  - "2.4.1.  Registration Required\n   When the mobile node receives an Agent Advertisement\
    \ with the 'R' bit\n   set, the mobile node SHOULD register through the foreign\
    \ agent, even\n   when the mobile node might be able to acquire its own co-located\n\
    \   care-of address.  This feature is intended to allow sites to enforce\n   visiting\
    \ policies (such as accounting) that require exchanges of\n   authorization.\n\
    \   If formerly reserved bits require some kind of monitoring/enforcement\n  \
    \ at the foreign link, foreign agents implementing the new\n   specification for\
    \ the formerly reserved bits can set the 'R' bit.\n   This has the effect of forcing\
    \ the mobile node to register through\n   the foreign agent, so the foreign agent\
    \ could then monitor/enforce\n   the policy.\n"
- title: 2.4.2.  Move Detection
  contents:
  - "2.4.2.  Move Detection\n   Two primary mechanisms are provided for mobile nodes\
    \ to detect when\n   they have moved from one subnet to another.  Other mechanisms\
    \ MAY\n   also be used.  When the mobile node detects that it has moved, it\n\
    \   SHOULD register (Section 3) with a suitable care-of address on the\n   new\
    \ foreign network.  However, the mobile node MUST NOT register more\n   frequently\
    \ than once per second on average, as specified in Section\n   3.6.3.\n"
- title: 2.4.2.1.  Algorithm 1
  contents:
  - "2.4.2.1.  Algorithm 1\n   The first method of move detection is based upon the\
    \ Lifetime field\n   within the main body of the ICMP Router Advertisement portion\
    \ of the\n   Agent Advertisement.  A mobile node SHOULD record the Lifetime\n\
    \   received in any Agent Advertisements, until that Lifetime expires.\n   If\
    \ the mobile node fails to receive another advertisement from the\n   same agent\
    \ within the specified Lifetime, it SHOULD assume that it\n   has lost contact\
    \ with that agent.  If the mobile node has previously\n   received an Agent Advertisement\
    \ from another agent for which the\n   Lifetime field has not yet expired, the\
    \ mobile node MAY immediately\n   attempt registration with that other agent.\
    \  Otherwise, the mobile\n   node SHOULD attempt to discover a new agent with\
    \ which to register.\n"
- title: 2.4.2.2.  Algorithm 2
  contents:
  - "2.4.2.2.  Algorithm 2\n   The second method uses network prefixes.  The Prefix-Lengths\n\
    \   Extension MAY be used in some cases by a mobile node to determine\n   whether\
    \ or not a newly received Agent Advertisement was received on\n   the same subnet\
    \ as the mobile node's current care-of address.  If the\n   prefixes differ, the\
    \ mobile node MAY assume that it has moved.  If a\n   mobile node is currently\
    \ using a foreign agent care-of address, the\n   mobile node SHOULD NOT use this\
    \ method of move detection unless both\n   the current agent and the new agent\
    \ include the Prefix-Lengths\n   Extension in their respective Agent Advertisements;\
    \ if this Extension\n   is missing from one or both of the advertisements, this\
    \ method of\n   move detection SHOULD NOT be used.  Similarly, if a mobile node\
    \ is\n   using a co-located care-of address, it SHOULD NOT use this method of\n\
    \   move detection unless the new agent includes the Prefix-Lengths\n   Extension\
    \ in its Advertisement and the mobile node knows the network\n   prefix of its\
    \ current co-located care-of address.  On the expiration\n   of its current registration,\
    \ if this method indicates that the mobile\n   node has moved, rather than re-registering\
    \ with its current care-of\n   address, a mobile node MAY choose instead to register\
    \ with the\n   foreign agent sending the new Advertisement with the different\n\
    \   network prefix.  The Agent Advertisement on which the new\n   registration\
    \ is based MUST NOT have expired according to its Lifetime\n   field.\n"
- title: 2.4.3.  Returning Home
  contents:
  - "2.4.3.  Returning Home\n   A mobile node can detect that it has returned to its\
    \ home network\n   when it receives an Agent Advertisement from its own home agent.\
    \  If\n   so, it SHOULD deregister with its home agent (Section 3).  Before\n\
    \   attempting to deregister, the mobile node SHOULD configure its\n   routing\
    \ table appropriately for its home network (Section 4.2.1).  In\n   addition,\
    \ if the home network is using ARP [16], the mobile node MUST\n   follow the procedures\
    \ described in Section 4.6 with regard to ARP,\n   proxy ARP, and gratuitous ARP.\n"
- title: 2.4.4.  Sequence Numbers and Rollover Handling
  contents:
  - "2.4.4.  Sequence Numbers and Rollover Handling\n   If a mobile node detects two\
    \ successive values of the sequence number\n   in the Agent Advertisements from\
    \ the foreign agent with which it is\n   registered, the second of which is less\
    \ than the first and inside the\n   range 0 to 255, the mobile node SHOULD register\
    \ again.  If the second\n   value is less than the first but is greater than or\
    \ equal to 256, the\n   mobile node SHOULD assume that the sequence number has\
    \ rolled over\n   past its maximum value (0xffff), and that re-registration is\
    \ not\n   necessary (Section 2.3).\n"
- title: 3.  Registration
  contents:
  - "3.  Registration\n   Mobile IP registration provides a flexible mechanism for\
    \ mobile nodes\n   to communicate their current reachability information to their\
    \ home\n   agent.  It is the method by which mobile nodes:\n   o  request forwarding\
    \ services when visiting a foreign network,\n   o  inform their home agent of\
    \ their current care-of address,\n   o  renew a registration that is due to expire,\
    \ and/or\n   o  deregister when they return home.\n   Registration messages exchange\
    \ information between a mobile node,\n   (optionally) a foreign agent, and the\
    \ home agent.  Registration\n   creates or modifies a mobility binding at the\
    \ home agent, associating\n   the mobile node's home address with its care-of\
    \ address for the\n   specified Lifetime.\n   Several other (optional) capabilities\
    \ are available through the\n   registration procedure, which enable a mobile\
    \ node to:\n   o  discover its home address, if the mobile node is not configured\n\
    \      with this information,\n   o  maintain multiple simultaneous registrations,\
    \ so that a copy of\n      each datagram will be tunneled to each active care-of\
    \ address,\n   o  deregister specific care-of addresses while retaining other\n\
    \      mobility bindings, and\n   o  discover the address of a home agent if the\
    \ mobile node is not\n      configured with this information.\n"
- title: 3.1.  Registration Overview
  contents:
  - "3.1.  Registration Overview\n   Mobile IP defines two different registration\
    \ procedures, one via a\n   foreign agent that relays the registration to the\
    \ mobile node's home\n   agent, and one directly with the mobile node's home agent.\
    \  The\n   following rules determine which of these two registration procedures\n\
    \   to use in any particular circumstance:\n   o  If a mobile node is registering\
    \ a foreign agent care-of address,\n      the mobile node MUST register via that\
    \ foreign agent.\n   o  If a mobile node is using a co-located care-of address,\
    \ and\n      receives an Agent Advertisement from a foreign agent on the link\n\
    \      on which it is using this care-of address, the mobile node SHOULD\n   \
    \   register via that foreign agent (or via another foreign agent on\n      this\
    \ link) if the 'R' bit is set in the received Agent\n      Advertisement message.\n\
    \   o  If a mobile node is otherwise using a co-located care-of address,\n   \
    \   the mobile node MUST register directly with its home agent.\n   o  If a mobile\
    \ node has returned to its home network and is\n      (de)registering with its\
    \ home agent, the mobile node MUST register\n      directly with its home agent.\n\
    \   Both registration procedures involve the exchange of Registration\n   Request\
    \ and Registration Reply messages (Section 3.3 and Section\n   3.4).  When registering\
    \ via a foreign agent, the registration\n   procedure requires the following four\
    \ messages:\n   a.  The mobile node sends a Registration Request to the prospective\n\
    \       foreign agent to begin the registration process.\n   b.  The foreign agent\
    \ processes the Registration Request and then\n       relays it to the home agent.\n\
    \   c.  The home agent sends a Registration Reply to the foreign agent to\n  \
    \     grant or deny the Request.\n   d.  The foreign agent processes the Registration\
    \ Reply and then\n       relays it to the mobile node to inform it of the disposition\
    \ of\n       its Request.\n   When the mobile node instead registers directly\
    \ with its home agent,\n   the registration procedure requires only the following\
    \ two messages:\n   a.  The mobile node sends a Registration Request to the home\
    \ agent.\n   b.  The home agent sends a Registration Reply to the mobile node,\n\
    \       granting or denying the Request.\n   The registration messages defined\
    \ in Sections 3.3 and 3.4 use the\n   User Datagram Protocol (UDP) [17].  A nonzero\
    \ UDP checksum SHOULD be\n   included in the header, and MUST be checked by the\
    \ recipient.  A zero\n   UDP checksum SHOULD be accepted by the recipient.  The\
    \ behavior of\n   the mobile node and the home agent with respect to their mutual\n\
    \   acceptance of packets with zero UDP checksums SHOULD be defined as\n   part\
    \ of the Mobility Security Association that exists between them.\n"
- title: 3.2.  Authentication
  contents:
  - "3.2.  Authentication\n   Each mobile node, foreign agent, and home agent MUST\
    \ be able to\n   support a Mobility Security Association for mobile entities,\
    \ indexed\n   by their SPI and IP address.  In the case of the mobile node, this\n\
    \   must be its home address.  See Section 5.1 for requirements for\n   support\
    \ of authentication algorithms.  Registration messages between\n   a mobile node\
    \ and its home agent MUST be authenticated with an\n   authorization-enabling\
    \ extension, e.g., the Mobile-Home\n   Authentication Extension (Section 3.5.2).\
    \  This extension MUST be the\n   first authentication extension; other foreign-agent-specific\n\
    \   extensions MAY be added to the message after the mobile node computes\n  \
    \ the authentication.\n"
- title: 3.3.  Registration Request
  contents:
  - "3.3.  Registration Request\n   A mobile node registers with its home agent using\
    \ a Registration\n   Request message so that its home agent can create or modify\
    \ a\n   mobility binding for that mobile node (e.g., with a new Lifetime).\n \
    \  The Request may be relayed to the home agent by the foreign agent\n   through\
    \ which the mobile node is registering, or it may be sent\n   directly to the\
    \ home agent in the case in which the mobile node is\n   registering a co-located\
    \ care-of address.\n   IP fields:\n      Source Address\n                    \
    \ Typically the interface address from which the\n                     message\
    \ is sent.\n      Destination Address\n                     Typically that of\
    \ the foreign agent or the home\n                     agent.\n      See Sections\
    \ 3.6.1.1 and 3.7.2.2 for details.\n   UDP fields:\n      Source Port       variable\n\
    \      Destination Port  434\n   The UDP header is followed by the Mobile IP fields\
    \ shown below:\n     0                   1                   2               \
    \    3\n     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n\
    \    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n    |\
    \     Type      |S|B|D|M|G|r|T|x|          Lifetime             |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |                          Home Address                         |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |                           Home Agent                          |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |                        Care-of Address                        |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |                                                               |\n    +\
    \                         Identification                        +\n    |     \
    \                                                          |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    | Extensions ...\n    +-+-+-+-+-+-+-+-\n      Type     1 (Registration Request)\n\
    \      S        Simultaneous bindings.  If the 'S' bit is set, the mobile\n  \
    \             node is requesting that the home agent retain its prior\n      \
    \         mobility bindings, as described in Section 3.6.1.2.\n      B       \
    \ Broadcast datagrams.  If the 'B' bit is set, the mobile\n               node\
    \ requests that the home agent tunnel to it any\n               broadcast datagrams\
    \ that it receives on the home network,\n               as described in Section\
    \ 4.3.\n      D        Decapsulation by mobile node.  If the 'D' bit is set, the\n\
    \               mobile node will itself decapsulate datagrams that are\n     \
    \          sent to the care-of address.  That is, the mobile node is\n       \
    \        using a co-located care-of address.\n      M        Minimal encapsulation.\
    \  If the 'M' bit is set, the mobile\n               node requests that its home\
    \ agent use minimal\n               encapsulation [16] for datagrams tunneled\
    \ to the mobile\n               node.\n      G        GRE encapsulation.  If the\
    \ 'G' bit is set, the mobile\n               node requests that its home agent\
    \ use GRE encapsulation\n               [13] for datagrams tunneled to the mobile\
    \ node.\n      r        Sent as zero; ignored on reception.  SHOULD NOT be\n \
    \              allocated for any other uses.\n      T        Reverse Tunneling\
    \ requested; see [12].\n      x        Sent as zero; ignored on reception.\n \
    \     Lifetime\n               The number of seconds remaining before the registration\n\
    \               is considered expired.  A value of zero indicates a\n        \
    \       request for deregistration.  A value of 0xffff indicates\n           \
    \    infinity.\n      Home Address\n               The IP address of the mobile\
    \ node.\n      Home Agent\n               The IP address of the mobile node's\
    \ home agent.\n      Care-of Address\n               The IP address for the end\
    \ of the tunnel.\n      Identification\n               A 64-bit number, constructed\
    \ by the mobile node, used for\n               matching Registration Requests\
    \ with Registration Replies,\n               and for protecting against replay\
    \ attacks of registration\n               messages.  See Sections 5.4 and 5.7.\n\
    \      Extensions\n               The fixed portion of the Registration Request\
    \ is followed\n               by one or more of the Extensions listed in Section\
    \ 3.5.\n               An authorization-enabling extension MUST be included in\n\
    \               all Registration Requests.  See Sections 3.6.1.3 and\n       \
    \        3.7.2.2 for information on the relative order in which\n            \
    \   different extensions, when present, MUST be placed in a\n               Registration\
    \ Request message.\n"
- title: 3.4.  Registration Reply
  contents:
  - "3.4.  Registration Reply\n   A mobility agent typically returns a Registration\
    \ Reply message to a\n   mobile node that has sent a Registration Request message.\
    \  If the\n   mobile node is requesting service from a foreign agent, that foreign\n\
    \   agent will typically receive the Reply from the home agent and\n   subsequently\
    \ relay it to the mobile node.  Reply messages contain the\n   necessary codes\
    \ to inform the mobile node about the status of its\n   Request, along with the\
    \ lifetime granted by the home agent, which MAY\n   be smaller than the original\
    \ Request.\n   The foreign agent MUST NOT increase the Lifetime selected by the\n\
    \   mobile node in the Registration Request, since the Lifetime is\n   covered\
    \ by an authentication extension that enables authorization by\n   the home agent.\
    \  Such an extension contains authentication data that\n   cannot be correctly\
    \ (re)computed by the foreign agent.  The home\n   agent MUST NOT increase the\
    \ Lifetime selected by the mobile node in\n   the Registration Request, since\
    \ doing so could increase it beyond the\n   maximum Registration Lifetime allowed\
    \ by the foreign agent.  If the\n   Lifetime received in the Registration Reply\
    \ is greater than that in\n   the Registration Request, the Lifetime in the Request\
    \ MUST be used.\n   When the Lifetime received in the Registration Reply is less\
    \ than\n   that in the Registration Request, the Lifetime in the Reply MUST be\n\
    \   used.\n   IP fields:\n      Source Address\n                     Typically\
    \ copied from the Destination Address of\n                     the Registration\
    \ Request to which the agent is\n                     replying.  See Sections\
    \ 3.7.2.3 and 3.8.3.2 for\n                     complete details.\n      Destination\
    \ Address\n                     Copied from the source address of the Registration\n\
    \                     Request to which the agent is replying.\n   UDP fields:\n\
    \      Source Port\n                     Copied from the UDP Destination Port\
    \ of the\n                     corresponding Registration Request.\n      Destination\
    \ Port\n                     Copied from the source port of the corresponding\n\
    \                     Registration Request (Section 3.7.1).\n   The UDP header\
    \ is followed by the Mobile IP fields shown below:\n     0                   1\
    \                   2                   3\n     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4\
    \ 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |     Type      |     Code      |           Lifetime            |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |                          Home Address                         |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |                           Home Agent                          |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |                                                               |\n    +\
    \                         Identification                        +\n    |     \
    \                                                          |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    | Extensions ...\n    +-+-+-+-+-+-+-+-\n      Type     3 (Registration Reply)\n\
    \      Code\n               A value indicating the result of the Registration\n\
    \               Request.  See below for a list of currently defined code\n   \
    \            values.\n      Lifetime\n               If the Code field indicates\
    \ that the registration was\n               accepted, the Lifetime field is set\
    \ to the number of\n               seconds remaining before the registration is\
    \ considered\n               expired.  A value of zero indicates that the mobile\
    \ node\n               has been deregistered.  A value of 0xffff indicates\n \
    \              infinity.  If the Code field indicates that the\n             \
    \  registration was denied, the contents of the Lifetime\n               field\
    \ are unspecified and MUST be ignored on reception.\n      Home Address\n    \
    \           The IP address of the mobile node.\n      Home Agent\n           \
    \    The IP address of the mobile node's home agent.\n      Identification\n \
    \              A 64-bit number used for matching Registration Requests\n     \
    \          with Registration Replies, and for protecting against\n           \
    \    replay attacks of registration messages.  The value is\n               based\
    \ on the Identification field from the Registration\n               Request message\
    \ from the mobile node, and on the style of\n               replay protection\
    \ used in the security context between\n               the mobile node and its\
    \ home agent (defined by the\n               Mobility Security Association between\
    \ them, and SPI value\n               in the authorization-enabling extension).\
    \  See Sections\n               5.4 and 5.7.\n      Extensions\n             \
    \  The fixed portion of the Registration Reply is followed\n               by\
    \ one or more of the Extensions listed in Section 3.5.\n               An authorization-enabling\
    \ extension MUST be included in\n               all Registration Replies returned\
    \ by the home agent.  See\n               Sections 3.7.2.2 and 3.8.3.3 for rules\
    \ on placement of\n               extensions to Reply messages.\n      The following\
    \ values are defined for use within the Code field.\n      Registration successful:\n\
    \         0 registration accepted\n         1 registration accepted, but simultaneous\
    \ mobility bindings\n         unsupported\n      Registration denied by the foreign\
    \ agent:\n         64  reason unspecified\n         65  administratively prohibited\n\
    \         66  insufficient resources\n         67  mobile node failed authentication\n\
    \         68  home agent failed authentication\n         69  requested Lifetime\
    \ too long\n         70  poorly formed Request\n         71  poorly formed Reply\n\
    \         72  requested encapsulation unavailable\n         73  reserved and unavailable\n\
    \         77  invalid care-of address\n         78  registration timeout\n   \
    \      80  home network unreachable (ICMP error received)\n         81  home agent\
    \ host unreachable (ICMP error received)\n         82  home agent port unreachable\
    \ (ICMP error received)\n         88  home agent unreachable (other ICMP error\
    \ received)\n         194 Invalid Home Agent Address\n      Registration denied\
    \ by the home agent:\n         128 reason unspecified\n         129 administratively\
    \ prohibited\n         130 insufficient resources\n         131 mobile node failed\
    \ authentication\n         132 foreign agent failed authentication\n         133\
    \ registration Identification mismatch\n         134 poorly formed Request\n \
    \        135 too many simultaneous mobility bindings\n         136 unknown home\
    \ agent address\n      Up-to-date values of the Code field are specified in the\
    \ IANA\n      online database [48].\n"
- title: 3.5.  Registration Extensions
  contents:
  - '3.5.  Registration Extensions

    '
- title: 3.5.1.  Computing Authentication Extension Values
  contents:
  - "3.5.1.  Computing Authentication Extension Values\n   The Authenticator value\
    \ computed for each authentication Extension\n   MUST protect the following fields\
    \ from the registration message:\n   o  the UDP payload (that is, the Registration\
    \ Request or Registration\n      Reply data),\n   o  all prior Extensions in their\
    \ entirety, and\n   o  the Type, Length, and SPI of this Extension.\n   The default\
    \ authentication algorithm uses HMAC-MD5 [10] to compute a\n   128-bit \"message\
    \ digest\" of the registration message.  The data over\n   which the HMAC is computed\
    \ is defined as:\n   o  the UDP payload (that is, the Registration Request or\
    \ Registration\n      Reply data),\n   o  all prior Extensions in their entirety,\
    \ and\n   o  the Type, Length, and SPI of this Extension.\n   Note that the Authenticator\
    \ field itself and the UDP header are NOT\n   included in the computation of the\
    \ default Authenticator value.  See\n   Section 5.1 for information about support\
    \ requirements for message\n   authentication codes, which are to be used with\
    \ the various\n   authentication Extensions.\n   The Security Parameter Index\
    \ (SPI) within any of the authentication\n   Extensions defines the security context\
    \ that is used to compute the\n   Authenticator value and that MUST be used by\
    \ the receiver to check\n   that value.  In particular, the SPI selects the authentication\n\
    \   algorithm and mode (Section 5.1) and secret (a shared key, or\n   appropriate\
    \ public/private key pair) used in computing the\n   Authenticator.  In order\
    \ to ensure interoperability between different\n   implementations of the Mobile\
    \ IP protocol, an implementation MUST be\n   able to associate any SPI value with\
    \ any authentication algorithm and\n   mode that it implements.  In addition,\
    \ all implementations of Mobile\n   IP MUST implement the default authentication\
    \ algorithm (HMAC-MD5)\n   specified above.\n"
- title: 3.5.2.  Mobile-Home Authentication Extension
  contents:
  - "3.5.2.  Mobile-Home Authentication Extension\n   At least one authorization-enabling\
    \ extension MUST be present in all\n   Registration Requests, and also in all\
    \ Registration Replies generated\n   by the home agent.  The Mobile-Home Authentication\
    \ Extension is\n   always an authorization-enabling extension for registration\
    \ messages\n   specified in this document.  This requirement is intended to\n\
    \   eliminate problems [30] that result from the uncontrolled propagation\n  \
    \ of remote redirects in the Internet.  The location of the\n   authorization-enabling\
    \ extension marks the end of the data to be\n   authenticated by the authorizing\
    \ agent interpreting that\n   authorization-enabling extension.\n     0      \
    \             1                   2                   3\n     0 1 2 3 4 5 6 7\
    \ 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |     Type      |     Length    |         SPI  ....\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \           ... SPI (cont.)          |       Authenticator ...\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      Type     32\n      Length   4 plus the number of bytes in the Authenticator.\n\
    \      SPI      Security Parameter Index (4 bytes).  An opaque identifier\n  \
    \             (see Section 1.6).\n      Authenticator\n               (variable\
    \ length) (See Section 3.5.1.)\n"
- title: 3.5.3.  Mobile-Foreign Authentication Extension
  contents:
  - "3.5.3.  Mobile-Foreign Authentication Extension\n   This Extension MAY be included\
    \ in Registration Requests and Replies\n   in cases in which a Mobility Security\
    \ Association exists between the\n   mobile node and the foreign agent.  See Section\
    \ 5.1 for information\n   about support requirements for message authentication\
    \ codes.\n     0                   1                   2                   3\n\
    \     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |     Type      |     Length    |         SPI  ....\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \           ... SPI (cont.)          |       Authenticator ...\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      Type     33\n      Length   4 plus the number of bytes in the Authenticator.\n\
    \      SPI      Security Parameter Index (4 bytes).  An opaque identifier\n  \
    \             (see Section 1.6).\n      Authenticator\n               (variable\
    \ length) (See Section 3.5.1.)\n"
- title: 3.5.4.  Foreign-Home Authentication Extension
  contents:
  - "3.5.4.  Foreign-Home Authentication Extension\n   This Extension MAY be included\
    \ in Registration Requests and Replies\n   in cases in which a Mobility Security\
    \ Association exists between the\n   foreign agent and the home agent, as long\
    \ as the Registration Request\n   is not a deregistration (i.e., the mobile node\
    \ requested a nonzero\n   Lifetime and the home address is different than the\
    \ care-of address).\n   The Foreign-Home Authentication extension MUST NOT be\
    \ applied to\n   deregistration messages.  See Section 5.1 for information about\n\
    \   support requirements for message authentication codes.\n     0           \
    \        1                   2                   3\n     0 1 2 3 4 5 6 7 8 9 0\
    \ 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |     Type      |     Length    |         SPI  ....\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \           ... SPI (cont.)          |       Authenticator ...\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      Type     34\n      Length   4 plus the number of bytes in the Authenticator.\n\
    \      SPI      Security Parameter Index (4 bytes).  An opaque identifier\n  \
    \             (see Section 1.6).\n      Authenticator\n               (variable\
    \ length) (See Section 3.5.1).\n   In order to perform the authentication, the\
    \ home agent and the\n   foreign agent are configured with a Mobility Security\
    \ Association\n   that is indexed by the SPI (in the appended Foreign-Home\n \
    \  Authentication Extension) and the IP Source Address of the\n   Registration\
    \ Request.  When the extension is used with a Registration\n   Reply message,\
    \ the foreign agent address MUST be used as the\n   Destination IP Address in\
    \ the IP header.\n   When this extension is applied to a Registration Request\
    \ message, the\n   Mobility Security Association for verifying the correctness\
    \ of the\n   authentication data is selected by the home agent based on the value\n\
    \   of the Source IP Address field of the Registration Request and the\n   SPI\
    \ of the Authentication extension.  The Source IP Address will be\n   the same\
    \ as the Care-of Address field of the Registration Request\n   (see Section 3.7.2.2).\n\
    \   When this extension is applied to a Registration Reply message, the\n   Mobility\
    \ Security Association for verifying the correctness of the\n   authentication\
    \ data is selected by the foreign agent based on the\n   value of the home agent\
    \ Address field of the Registration Reply.\n   If the Care-of Address in the Registration\
    \ Request is not in the\n   Agent Advertisement, then the foreign agent MUST NOT\
    \ append the\n   Foreign-Home Authentication Extension when relaying the message\
    \ to\n   the home agent.  Moreover, for a deregistration message (i.e.,\n   Lifetime\
    \ = 0), the foreign agent MUST NOT append the Foreign-Home\n   Authentication\
    \ Extension when relaying the message to the home agent.\n   Consequently, when\
    \ the home agent (HA) receives a deregistration\n   request that does not contain\
    \ a Foreign-Home Authentication\n   Extension, it MUST NOT for this reason discard\
    \ the request as part of\n   security association processing.\n"
- title: 3.6.  Mobile Node Considerations
  contents:
  - "3.6.  Mobile Node Considerations\n   A mobile node MUST be configured (statically\
    \ or dynamically) with a\n   netmask and a Mobility Security Association for each\
    \ of its home\n   agents.  In addition, a mobile node MAY be configured with its\
    \ home\n   address, and the IP address of one or more of its home agents;\n  \
    \ otherwise, the mobile node MAY discover a home agent using the\n   procedures\
    \ described in Section 3.6.1.2.\n   If the mobile node is not configured with\
    \ a home address, it MAY use\n   the Mobile Node Network Access Identifier (NAI)\
    \ extension [2] to\n   identify itself, and set the Home Address field of the\
    \ Registration\n   Request to 0.0.0.0.  In this case, the mobile node MUST be\
    \ able to\n   assign its home address after extracting this information from the\n\
    \   Registration Reply from the home agent.\n   For each pending registration,\
    \ the mobile node maintains the\n   following information:\n   o  the link-layer\
    \ address of the foreign agent to which the\n      Registration Request was sent,\
    \ if applicable,\n   o  the IP Destination Address of the Registration Request,\n\
    \   o  the care-of address used in the registration,\n   o  the Identification\
    \ value sent in the registration,\n   o  the originally requested Lifetime, and\n\
    \   o  the remaining Lifetime of the pending registration.\n   A mobile node SHOULD\
    \ initiate a registration whenever it detects a\n   change in its network connectivity.\
    \  See Section 2.4.2 for methods by\n   which mobile nodes MAY make such a determination.\
    \  When it is away\n   from home, the mobile node's Registration Request allows\
    \ its home\n   agent to create or modify a mobility binding for it.  When it is\
    \ at\n   home, the mobile node's (de)Registration Request allows its home\n  \
    \ agent to delete any previous mobility binding(s) for it.  A mobile\n   node\
    \ operates without the support of mobility functions when it is at\n   home.\n\
    \   There are other conditions under which the mobile node SHOULD\n   (re)register\
    \ with its foreign agent, such as when the mobile node\n   detects that the foreign\
    \ agent has rebooted (as specified in Section\n   2.4.4) and when the current\
    \ registration's Lifetime is near\n   expiration.\n   In the absence of link-layer\
    \ indications of changes in point of\n   attachment, Agent Advertisements from\
    \ new agents SHOULD NOT cause a\n   mobile node to attempt a new registration,\
    \ if its current\n   registration has not expired and it is still also receiving\
    \ Agent\n   Advertisements from the foreign agent with which it is currently\n\
    \   registered.  In the absence of link-layer indications, a mobile node\n   MUST\
    \ NOT attempt to register more often than once per second.\n   A mobile node MAY\
    \ register with a different agent when transport-\n   layer protocols indicate\
    \ excessive retransmissions.  A mobile node\n   MUST NOT consider reception of\
    \ an ICMP Redirect from a foreign agent\n   that is currently providing service\
    \ to it as reason to register with\n   a new foreign agent.  Within these constraints,\
    \ the mobile node MAY\n   register again at any time.\n   Appendix C shows some\
    \ examples of how the fields in registration\n   messages would be set up in some\
    \ typical registration scenarios.\n"
- title: 3.6.1.  Sending Registration Requests
  contents:
  - "3.6.1.  Sending Registration Requests\n   The following sections specify details\
    \ for the values that the mobile\n   node MUST supply in the fields of Registration\
    \ Request messages.\n"
- title: 3.6.1.1.  IP Fields
  contents:
  - "3.6.1.1.  IP Fields\n   This section provides the specific rules by which mobile\
    \ nodes pick\n   values for the IP header fields of a Registration Request.\n\
    \   IP Source Address:\n   o  When registering on a foreign network with a co-located\
    \ care-of\n      address, the IP source address MUST be the care-of address.\n\
    \   o  Otherwise, if the mobile node does not have a home address, the IP\n  \
    \    source address MUST be 0.0.0.0.\n   o  In all other circumstances, the IP\
    \ source address MUST be the\n      mobile node's home address.\n   IP Destination\
    \ Address:\n   o  When the mobile node has discovered the agent with which it\
    \ is\n      registering, through some means (e.g., link-layer) that does not\n\
    \      provide the IP address of the agent (the IP address of the agent\n    \
    \  is unknown to the mobile node), then the \"All Mobility Agents\"\n      multicast\
    \ address (224.0.0.11) MUST be used.  In this case, the\n      mobile node MUST\
    \ use the agent's link-layer unicast address in\n      order to deliver the datagram\
    \ to the correct agent.\n   o  When registering with a foreign agent, the address\
    \ of the agent as\n      learned from the IP source address of the corresponding\
    \ Agent\n      Advertisement MUST be used.  This MAY be an address that does not\n\
    \      appear as an advertised care-of address in the Agent\n      Advertisement.\
    \  In addition, when transmitting this Registration\n      Request message, the\
    \ mobile node MUST use a link-layer Destination\n      Address copied from the\
    \ link-layer source address of the Agent\n      Advertisement message in which\
    \ it learned this foreign agent's IP\n      address.\n   o  When the mobile node\
    \ is registering directly with its home agent\n      and knows the (unicast) IP\
    \ address of its home agent, the\n      Destination Address MUST be set to this\
    \ address.\n   o  If the mobile node is registering directly with its home agent,\n\
    \      but does not know the IP address of its home agent, the mobile\n      node\
    \ may use dynamic home agent address resolution to\n      automatically determine\
    \ the IP address of its home agent (Section\n      3.6.1.2).  In this case, the\
    \ IP Destination Address is set to the\n      subnet-directed broadcast address\
    \ of the mobile node's home\n      network.  This address MUST NOT be used as\
    \ the Destination IP\n      Address if the mobile node is registering via a foreign\
    \ agent,\n      although it MAY be used as the home agent address in the body\
    \ of\n      the Registration Request when registering via a foreign agent.\n \
    \  IP Time to Live:\n   o  The IP TTL field MUST be set to 1 if the IP Destination\
    \ Address is\n      set to the \"All Mobility Agents\" multicast address as described\n\
    \      above.  Otherwise, a suitable value should be chosen in accordance\n  \
    \    with standard IP practice [18].\n"
- title: 3.6.1.2.  Registration Request Fields
  contents:
  - "3.6.1.2.  Registration Request Fields\n   This section provides specific rules\
    \ by which mobile nodes pick\n   values for the fields within the fixed portion\
    \ of a Registration\n   Request.\n   A mobile node MAY set the 'S' bit in order\
    \ to request that the home\n   agent maintain prior mobility binding(s).  Otherwise,\
    \ the home agent\n   deletes any previous binding(s) and replaces them with the\
    \ new\n   binding specified in the Registration Request.  Multiple simultaneous\n\
    \   mobility bindings are likely to be useful when a mobile node using at\n  \
    \ least one wireless network interface moves within wireless\n   transmission\
    \ range of more than one foreign agent.  IP explicitly\n   allows duplication\
    \ of datagrams.  When the home agent allows\n   simultaneous bindings, it will\
    \ tunnel a separate copy of each\n   arriving datagram to each care-of address,\
    \ and the mobile node will\n   receive multiple copies of datagrams destined to\
    \ it.\n   The mobile node SHOULD set the 'D' bit if it is registering with a\n\
    \   co-located care-of address.  Otherwise, the 'D' bit MUST NOT be set.\n   A\
    \ mobile node MAY set the 'B' bit to request its home agent to\n   forward to\
    \ it a copy of broadcast datagrams received by its home\n   agent from the home\
    \ network.  The method used by the home agent to\n   forward broadcast datagrams\
    \ depends on the type of care-of address\n   registered by the mobile node, as\
    \ determined by the 'D' bit in the\n   mobile node's Registration Request:\n \
    \  o  If the 'D' bit is set, then the mobile node has indicated that it\n    \
    \  will decapsulate any datagrams tunneled to this care-of address\n      itself\
    \ (the mobile node is using a co-located care-of address).\n      In this case,\
    \ to forward such a received broadcast datagram to the\n      mobile node, the\
    \ home agent MUST tunnel it to this care-of\n      address.  The mobile node detunnels\
    \ the received datagram in the\n      same way as any other datagram tunneled\
    \ directly to it.\n   o  If the 'D' bit is NOT set, then the mobile node has indicated\
    \ that\n      it is using a foreign agent care-of address, and that the foreign\n\
    \      agent will thus decapsulate arriving datagrams before forwarding\n    \
    \  them to the mobile node.  In this case, to forward such a received\n      broadcast\
    \ datagram to the mobile node, the home agent MUST first\n      encapsulate the\
    \ broadcast datagram in a unicast datagram addressed\n      to the mobile node's\
    \ home address, and then MUST tunnel this\n      resulting datagram to the mobile\
    \ node's care-of address.\n      When decapsulated by the foreign agent, the inner\
    \ datagram will\n      thus be a unicast IP datagram addressed to the mobile node,\n\
    \      identifying to the foreign agent the intended destination of the\n    \
    \  encapsulated broadcast datagram, and will be delivered to the\n      mobile\
    \ node in the same way as any tunneled datagram arriving for\n      the mobile\
    \ node.  The foreign agent MUST NOT decapsulate the\n      encapsulated broadcast\
    \ datagram and MUST NOT use a local network\n      broadcast to transmit it to\
    \ the mobile node.  The mobile node thus\n      MUST decapsulate the encapsulated\
    \ broadcast datagram itself, and\n      thus MUST NOT set the 'B' bit in its Registration\
    \ Request in this\n      case unless it is capable of decapsulating datagrams.\n\
    \   The mobile node MAY request alternative forms of encapsulation by\n   setting\
    \ the 'M' bit and/or the 'G' bit, but only if the mobile node\n   is decapsulating\
    \ its own datagrams (the mobile node is using a\n   co-located care-of address)\
    \ or if its foreign agent has indicated\n   support for these forms of encapsulation\
    \ by setting the corresponding\n   bits in the Mobility Agent Advertisement Extension\
    \ of an Agent\n   Advertisement received by the mobile node.  Otherwise, the mobile\n\
    \   node MUST NOT set these bits.\n   The Lifetime field is chosen as follows:\n\
    \   o  If the mobile node is registering with a foreign agent, the\n      Lifetime\
    \ SHOULD NOT exceed the value in the Registration Lifetime\n      field of the\
    \ Agent Advertisement message received from the foreign\n      agent.  When the\
    \ method by which the care-of address is learned\n      does not include a Lifetime,\
    \ the default ICMP Router Advertisement\n      Lifetime (1800 seconds) MAY be\
    \ used.\n   o  The mobile node MAY ask a home agent to delete a particular\n \
    \     mobility binding, by sending a Registration Request with the care-\n   \
    \   of address for this binding, with the Lifetime field set to zero\n      (Section\
    \ 3.8.2).\n   o  Similarly, a Lifetime of zero is used when the mobile node\n\
    \      deregisters all care-of addresses, such as upon returning home.\n   The\
    \ Home Address field MUST be set to the mobile node's home address,\n   if this\
    \ information is known.  Otherwise, the Home Address field MUST\n   be set to\
    \ zeroes.\n   The Home Agent field MUST be set to the address of the mobile node's\n\
    \   home agent, if the mobile node knows this address.  Otherwise, the\n   mobile\
    \ node MAY use dynamic home agent address resolution to learn\n   the address\
    \ of its home agent.  In this case, the mobile node MUST\n   set the Home Agent\
    \ field to the subnet-directed broadcast address of\n   the mobile node's home\
    \ network.  Each home agent receiving such a\n   Registration Request with a broadcast\
    \ Destination Address MUST reject\n   the mobile node's registration and SHOULD\
    \ return a rejection\n   Registration Reply indicating its unicast IP address\
    \ for use by the\n   mobile node in a future registration attempt.\n   The Care-of\
    \ Address field MUST be set to the value of the particular\n   care-of address\
    \ that the mobile node wishes to (de)register.  In the\n   special case in which\
    \ a mobile node wishes to deregister all care-of\n   addresses, it MUST set this\
    \ field to its home address.\n   The mobile node chooses the Identification field\
    \ in accordance with\n   the style of replay protection it uses with its home\
    \ agent.  This is\n   part of the Mobility Security Association the mobile node\
    \ shares with\n   its home agent.  See Section 5.7 for the method by which the\
    \ mobile\n   node computes the Identification field.\n"
- title: 3.6.1.3.  Extensions
  contents:
  - "3.6.1.3.  Extensions\n   This section describes the ordering of any mandatory\
    \ and any optional\n   Extensions that a mobile node appends to a Registration\
    \ Request.\n   This ordering is REQUIRED:\n   a.  The IP header, followed by the\
    \ UDP header, followed by the fixed-\n       length portion of the Registration\
    \ Request, followed by\n   b.  If present, any non-authentication Extensions expected\
    \ to be used\n       by the home agent or other authorizing agent (which may or\
    \ may\n       not also be useful to the foreign agent), followed by\n   c.  All\
    \ authorization-enabling extensions (see Section 1.6), followed\n       by\n \
    \  d.  If present, any non-authentication Extensions used only by the\n      \
    \ foreign agent, followed by\n   e.  The Mobile-Foreign Authentication Extension,\
    \ if present.\n   Note that items (a) and (c) MUST appear in every Registration\
    \ Request\n   sent by the mobile node.  Items (b), (d), and (e) are optional.\n\
    \   However, item (e) MUST be included when the mobile node and the\n   foreign\
    \ agent share a Mobility Security Association.\n"
- title: 3.6.2.  Receiving Registration Replies
  contents:
  - "3.6.2.  Receiving Registration Replies\n   Registration Replies will be received\
    \ by the mobile node in response\n   to its Registration Requests.  Registration\
    \ Replies generally fall\n   into three categories:\n   o  the registration was\
    \ accepted,\n   o  the registration was denied by the foreign agent, or\n   o\
    \  the registration was denied by the home agent.\n   The remainder of this section\
    \ describes the Registration Reply\n   handling by a mobile node in each of these\
    \ three categories.\n"
- title: 3.6.2.1.  Validity Checks
  contents:
  - "3.6.2.1.  Validity Checks\n   Registration Replies with an invalid, non-zero\
    \ UDP checksum MUST be\n   silently discarded.\n   In addition, the low-order\
    \ 32 bits of the Identification field in the\n   Registration Reply MUST be compared\
    \ to the low-order 32 bits of the\n   Identification field in the most recent\
    \ Registration Request sent to\n   the replying agent.  If they do not match,\
    \ the Reply MUST be silently\n   discarded.\n   Also, the Registration Reply MUST\
    \ be checked for presence of an\n   authorization-enabling extension.  For all\
    \ Registration Reply\n   messages containing a status code indicating status from\
    \ the home\n   agent, the mobile node MUST check for the presence of an\n   authorization-enabling\
    \ extension, acting in accordance with the Code\n   field in the Reply.  The rules\
    \ are as follows:\n   a.  If the mobile node and the foreign agent share a Mobility\n\
    \       Security Association, exactly one Mobile-Foreign Authentication\n    \
    \   Extension MUST be present in the Registration Reply, and the\n       mobile\
    \ node MUST check the Authenticator value in the Extension.\n       If no Mobile-Foreign\
    \ Authentication Extension is found, or if\n       more than one Mobile-Foreign\
    \ Authentication Extension is found,\n       or if the Authenticator is invalid,\
    \ the mobile node MUST silently\n       discard the Reply and SHOULD log the event\
    \ as a security\n       exception.\n   b.  If the Code field indicates that service\
    \ is denied by the home\n       agent, or if the Code field indicates that the\
    \ registration was\n       accepted by the home agent, exactly one Mobile-Home\n\
    \       Authentication Extension MUST be present in the Registration\n       Reply,\
    \ and the mobile node MUST check the Authenticator value in\n       the Extension.\
    \  If the Registration Reply was generated by the\n       home agent but no Mobile-Home\
    \ Authentication Extension is found,\n       or if more than one Mobile-Home Authentication\
    \ Extension is\n       found, or if the Authenticator is invalid, the mobile node\
    \ MUST\n       silently discard the Reply and SHOULD log the event as a security\n\
    \       exception.\n   If the Code field indicates an authentication failure,\
    \ either at the\n   foreign agent or the home agent, then it is quite possible\
    \ that any\n   authenticators in the Registration Reply will also be in error.\
    \  This\n   could happen, for example, if the shared secret between the mobile\n\
    \   node and home agent was erroneously configured.  The mobile node\n   SHOULD\
    \ log such errors as security exceptions.\n"
- title: 3.6.2.2.  Registration Request Accepted
  contents:
  - "3.6.2.2.  Registration Request Accepted\n   If the Code field indicates that\
    \ the request has been accepted, the\n   mobile node SHOULD configure its routing\
    \ table appropriately for its\n   current point of attachment (Section 4.2.1).\n\
    \   If the mobile node is returning to its home network and that network\n   is\
    \ one that implements ARP, the mobile node MUST follow the\n   procedures described\
    \ in Section 4.6 with regard to ARP, proxy ARP,\n   and gratuitous ARP.\n   If\
    \ the mobile node has registered on a foreign network, it SHOULD\n   re-register\
    \ before the expiration of the Lifetime of its\n   registration.  As described\
    \ in Section 3.6, for each pending\n   Registration Request, the mobile node MUST\
    \ maintain the remaining\n   lifetime of this pending registration, as well as\
    \ the original\n   Lifetime from the Registration Request.  When the mobile node\n\
    \   receives a valid Registration Reply, the mobile node MUST decrease\n   its\
    \ view of the remaining lifetime of the registration by the amount\n   by which\
    \ the home agent decreased the originally requested Lifetime.\n   This procedure\
    \ is equivalent to the mobile node starting a timer for\n   the granted Lifetime\
    \ at the time it sent the Registration Request,\n   even though the granted Lifetime\
    \ is not known to the mobile node\n   until the Registration Reply is received.\
    \  Since the Registration\n   Request is certainly sent before the home agent\
    \ begins timing the\n   registration Lifetime (also based on the granted Lifetime),\
    \ this\n   procedure ensures that the mobile node will re-register before the\n\
    \   home agent expires and deletes the registration, in spite of possibly\n  \
    \ non-negligible transmission delays for the original Registration\n   Request\
    \ and Reply that started the timing of the Lifetime at the\n   mobile node and\
    \ its home agent.\n"
- title: 3.6.2.3.  Registration Request Denied
  contents:
  - "3.6.2.3.  Registration Request Denied\n   If the Code field indicates that service\
    \ is being denied, the mobile\n   node SHOULD log the error.  In certain cases,\
    \ the mobile node may be\n   able to \"repair\" the error.  These include:\n \
    \  Code 69: (Denied by foreign agent, requested Lifetime too long)\n      In this\
    \ case, the Lifetime field in the Registration Reply will\n      contain the maximum\
    \ Lifetime value that the foreign agent is\n      willing to accept in any Registration\
    \ Request.  The mobile node\n      MAY attempt to register with this same agent,\
    \ using a Lifetime in\n      the Registration Request that MUST be less than or\
    \ equal to the\n      value specified in the Reply.\n   Code 133: (Denied by home\
    \ agent, registration Identification\n      mismatch)\n      In this case, the\
    \ Identification field in the Registration Reply\n      will contain a value that\
    \ allows the mobile node to synchronize\n      with the home agent, based upon\
    \ the style of replay protection in\n      effect (Section 5.7).  The mobile node\
    \ MUST adjust the parameters\n      it uses to compute the Identification field\
    \ based upon the\n      information in the Registration Reply, before issuing\
    \ any future\n      Registration Requests.\n   Code 136: (Denied by home agent,\
    \ unknown home agent address)\n      This code is returned by a home agent when\
    \ the mobile node is\n      performing dynamic home agent address resolution as\
    \ described in\n      Sections 3.6.1.1 and 3.6.1.2.  In this case, the Home Agent\
    \ field\n      within the Reply will contain the unicast IP address of the home\n\
    \      agent returning the Reply.  The mobile node MAY then attempt to\n     \
    \ register with this home agent in future Registration Requests.  In\n      addition,\
    \ the mobile node SHOULD adjust the parameters it uses to\n      compute the Identification\
    \ field based upon the corresponding\n      field in the Registration Reply, before\
    \ issuing any future\n      Registration Requests.\n"
- title: 3.6.3.  Registration Retransmission
  contents:
  - "3.6.3.  Registration Retransmission\n   When no Registration Reply has been received\
    \ within a reasonable\n   time, another Registration Request MAY be transmitted.\
    \  When\n   timestamps are used, a new registration Identification is chosen for\n\
    \   each retransmission; thus, it counts as a new registration.  When\n   nonces\
    \ are used, the unanswered Request is retransmitted unchanged;\n   thus, the retransmission\
    \ does not count as a new registration\n   (Section 5.7).  In this way, a retransmission\
    \ will not require the\n   home agent to resynchronize with the mobile node by\
    \ issuing another\n   nonce in the case in which the original Registration Request\
    \ (rather\n   than its Registration Reply) was lost by the network.\n   The maximum\
    \ time until a new Registration Request is sent SHOULD be\n   no greater than\
    \ the requested Lifetime of the Registration Request.\n   The minimum value SHOULD\
    \ be large enough to account for the size of\n   the messages, twice the round-trip\
    \ time for transmission to the home\n   agent, and at least an additional 100\
    \ milliseconds to allow for\n   processing the messages before responding.  The\
    \ round-trip time for\n   transmission to the home agent will be at least as large\
    \ as the time\n   required to transmit the messages at the link speed of the mobile\n\
    \   node's current point of attachment.  Some circuits add another 200\n   milliseconds\
    \ of satellite delay in the total round-trip time to the\n   home agent.  The\
    \ minimum time between Registration Requests MUST NOT\n   be less than 1 second.\
    \  Each successive retransmission timeout period\n   SHOULD be at least twice\
    \ the previous period, as long as that is less\n   than the maximum as specified\
    \ above.\n"
- title: 3.7.  Foreign Agent Considerations
  contents:
  - "3.7.  Foreign Agent Considerations\n   The foreign agent plays a mostly passive\
    \ role in Mobile IP\n   registration.  It relays Registration Requests between\
    \ mobile nodes\n   and home agents, and, when it provides the care-of address,\n\
    \   decapsulates datagrams for delivery to the mobile node.  It SHOULD\n   also\
    \ send periodic Agent Advertisement messages to advertise its\n   presence as\
    \ described in Section 2.3, if not detectable by link-layer\n   means.\n   A foreign\
    \ agent MUST NOT transmit a Registration Request, unless the\n   request is being\
    \ relayed from a mobile node to that mobile node's\n   home agent.  A foreign\
    \ agent MUST NOT transmit a Registration Reply\n   except when relaying a Registration\
    \ Reply received from a mobile\n   node's home agent, or when replying to a Registration\
    \ Request\n   received from a mobile node in the case in which the foreign agent\
    \ is\n   denying service to the mobile node.  In particular, a foreign agent\n\
    \   MUST NOT generate a Registration Request or Reply because a mobile\n   node's\
    \ registration Lifetime has expired.  A foreign agent also MUST\n   NOT originate\
    \ a Registration Request message that asks for\n   deregistration of a mobile\
    \ node; however, it MUST relay well-formed\n   (de)Registration Requests originated\
    \ by a mobile node.\n"
- title: 3.7.1.  Configuration and Registration Tables
  contents:
  - "3.7.1.  Configuration and Registration Tables\n   Each foreign agent MUST be\
    \ configured with a care-of address.  In\n   addition, for each pending or current\
    \ registration the foreign agent\n   MUST maintain a visitor list entry containing\
    \ the following\n   information obtained from the mobile node's Registration Request:\n\
    \   o  the link-layer source address of the mobile node\n   o  the IP Source Address\
    \ (the mobile node's home address) or its co-\n      located care-of address (see\
    \ description of the 'R' bit in Section\n      2.1.1)\n   o  the IP Destination\
    \ Address (as specified in Section 3.6.1.1)\n   o  the UDP Source Port\n   o \
    \ the home agent address\n   o  the Identification field\n   o  the requested\
    \ registration Lifetime, and\n   o  the remaining Lifetime of the pending or current\
    \ registration\n   If there is an NAI extension in the Registration Request message\n\
    \   (often, for example, when the mobile node's Home Address is zero),\n   then\
    \ the foreign agent MUST follow the procedures specified in RFC\n   2794 [2].\
    \  In particular, if the foreign agent cannot manage pending\n   Registration\
    \ Request records with such a zero Home Address for the\n   mobile node, the foreign\
    \ agent MUST return a Registration Reply with\n   a code indicating NONZERO_HOMEADDR_REQD\
    \ (see [2]).\n   The foreign agent MAY configure a maximum number of pending\n\
    \   registrations that it is willing to maintain (typically 5).\n   Additional\
    \ registrations SHOULD then be rejected by the foreign agent\n   with Code 66.\
    \  The foreign agent MAY delete any pending Registration\n   Request after the\
    \ request has been pending for more than 7 seconds;\n   in this case, the foreign\
    \ agent SHOULD reject the Request with Code\n   78 (registration timeout).\n \
    \  As with any node on the Internet, a foreign agent MAY also share\n   Mobility\
    \ Security Associations with any other nodes.  When relaying a\n   Registration\
    \ Request from a mobile node to its home agent, if the\n   foreign agent shares\
    \ a Mobility Security Association with the home\n   agent, it MUST add a Foreign-Home\
    \ Authentication Extension to the\n   Request.  In this case, when the Registration\
    \ Reply has nonzero\n   Lifetime, the foreign agent MUST check the required Foreign-Home\n\
    \   Authentication Extension in the Registration Reply from the home\n   agent\
    \ (Sections 3.3 and 3.4).  Similarly, when receiving a\n   Registration Request\
    \ from a mobile node, if the foreign agent shares\n   a Mobility Security Association\
    \ with the mobile node, it MUST check\n   the required Mobile-Foreign Authentication\
    \ Extension in the Request\n   and MUST add a Mobile-Foreign Authentication Extension\
    \ to the\n   Registration Reply to the mobile node.\n"
- title: 3.7.2.  Receiving Registration Requests
  contents:
  - "3.7.2.  Receiving Registration Requests\n   If the foreign agent accepts a Registration\
    \ Request from a mobile\n   node, it checks to make sure that the indicated home\
    \ agent address\n   does not belong to any network interface of the foreign agent.\
    \  If\n   not, the foreign agent then MUST relay the Request to the indicated\n\
    \   home agent.  Otherwise, if the foreign agent denies the Request, it\n   MUST\
    \ send a Registration Reply to the mobile node with an appropriate\n   denial\
    \ code, except in cases where the foreign agent would be\n   required to send\
    \ out more than one such denial per second to the same\n   mobile node.  The following\
    \ sections describe this behavior in more\n   detail.\n   If the foreign agent\
    \ has configured one of its network interfaces\n   with the IP address specified\
    \ by the mobile node as its home agent\n   address, the foreign agent MUST NOT\
    \ forward the Request again.  If\n   the foreign agent serves the mobile node\
    \ as a home agent, the foreign\n   agent follows the procedures specified in Section\
    \ 3.8.2.  Otherwise,\n   if the foreign agent does not serve the mobile node as\
    \ a home agent,\n   the foreign agent rejects the Registration Request with Code\
    \ 194\n   (Invalid Home Agent Address).\n   If a foreign agent receives a Registration\
    \ Request from a mobile node\n   in its visitor list, the existing visitor list\
    \ entry for the mobile\n   node SHOULD NOT be deleted or modified until the foreign\
    \ agent\n   receives a valid Registration Reply from the home agent with a code\n\
    \   indicating success.  The foreign agent MUST record the new pending\n   Request\
    \ as a separate part of the existing visitor list entry for the\n   mobile node.\
    \  If the Registration Request asks for deregistration,\n   the existing visitor\
    \ list entry for the mobile node SHOULD NOT be\n   deleted until the foreign agent\
    \ has received a successful\n   Registration Reply.  If the Registration Reply\
    \ indicates that the\n   Request (for registration or deregistration) was denied\
    \ by the home\n   agent, the existing visitor list entry for the mobile node MUST\
    \ NOT\n   be modified as a result of receiving the Registration Reply.\n"
- title: 3.7.2.1.  Validity Checks
  contents:
  - "3.7.2.1.  Validity Checks\n   Registration Requests with an invalid, non-zero\
    \ UDP checksum MUST be\n   silently discarded.  Requests with non-zero bits in\
    \ reserved fields\n   MUST be rejected with Code 70 (poorly formed Request). \
    \ Requests with\n   the 'D' bit set to 0, nonzero Lifetime, and specifying a care-of\n\
    \   address not offered by the foreign agent, MUST be rejected with Code\n   77\
    \ (invalid care-of address).\n   Also, the authentication in the Registration\
    \ Request MUST be checked.\n   If the foreign agent and the mobile node share\
    \ a Mobility Security\n   Association, exactly one Mobile-Foreign Authentication\
    \ Extension MUST\n   be present in the Registration Request, and the foreign agent\
    \ MUST\n   check the Authenticator value in the Extension.  If no Mobile-Foreign\n\
    \   Authentication Extension is found, or if more than one Mobile-Foreign\n  \
    \ Authentication Extension is found, or if the Authenticator is\n   invalid, the\
    \ foreign agent MUST silently discard the Request and\n   SHOULD log the event\
    \ as a security exception.  The foreign agent also\n   SHOULD send a Registration\
    \ Reply to the mobile node with Code 67.\n"
- title: 3.7.2.2.  Forwarding a Valid Request to the Home Agent
  contents:
  - "3.7.2.2.  Forwarding a Valid Request to the Home Agent\n   If the foreign agent\
    \ accepts the mobile node's Registration Request,\n   it MUST relay the Request\
    \ to the mobile node's home agent as\n   specified in the Home Agent field of\
    \ the Registration Request.  The\n   foreign agent MUST NOT modify any of the\
    \ fields beginning with the\n   fixed portion of the Registration Request up through\
    \ and including\n   the Mobile-Home Authentication Extension or other authentication\n\
    \   extension supplied by the mobile node as an authorization-enabling\n   extension\
    \ for the home agent.  Otherwise, an authentication failure\n   is very likely\
    \ to occur at the home agent.  In addition, the foreign\n   agent proceeds as\
    \ follows:\n   o  It MUST process and remove any extensions that do not precede\
    \ any\n      authorization-enabling extension,\n   o  It MAY append any of its\
    \ own non-authentication Extensions of\n      relevance to the home agent, if\
    \ applicable, and\n   o  If the foreign agent shares a Mobility Security Association\
    \ with\n      the home agent, and the Request has Lifetime != 0, then it MUST\n\
    \      append the Foreign-Home Authentication Extension.\n   Specific fields within\
    \ the IP header and the UDP header of the\n   relayed Registration Request MUST\
    \ be set as follows:\n      IP Source Address\n         The care-of address offered\
    \ by the foreign agent for the mobile\n         node sending the Registration\
    \ Request.\n      IP Destination Address\n         Copied from the Home Agent\
    \ field within the Registration\n         Request.\n      UDP Source Port\n  \
    \       variable\n      UDP Destination Port\n         434\n   After forwarding\
    \ a valid Registration Request to the home agent, the\n   foreign agent MUST begin\
    \ timing the remaining lifetime of the pending\n   registration based on the Lifetime\
    \ in the Registration Request.  If\n   this lifetime expires before receiving\
    \ a valid Registration Reply,\n   the foreign agent MUST delete its visitor list\
    \ entry for this pending\n   registration.\n"
- title: 3.7.2.3.  Denying Invalid Requests
  contents:
  - "3.7.2.3.  Denying Invalid Requests\n   If the foreign agent denies the mobile\
    \ node's Registration Request\n   for any reason, it SHOULD send the mobile node\
    \ a Registration Reply\n   with a suitable denial code.  In such a case, the Home\
    \ Address, Home\n   Agent, and Identification fields within the Registration Reply\
    \ are\n   copied from the corresponding fields of the Registration Request.\n\
    \   If the Reserved field is nonzero, the foreign agent MUST deny the\n   Request\
    \ and SHOULD return a Registration Reply with Status Code 70 to\n   the mobile\
    \ node.  If the Request is being denied because the\n   requested Lifetime is\
    \ too long, the foreign agent sets the Lifetime\n   in the Reply to the maximum\
    \ Lifetime value it is willing to accept in\n   any Registration Request, and\
    \ sets the Code field to 69.  Otherwise,\n   the Lifetime SHOULD be copied from\
    \ the Lifetime field in the Request.\n   Specific fields within the IP header\
    \ and the UDP header of the\n   Registration Reply MUST be set as follows:\n \
    \     IP Source Address\n         Copied from the IP Destination Address of the\
    \ Registration\n         Request, unless the \"All Agents Multicast\" address\
    \ was used.\n         In this case, the foreign agent's address (on the interface\n\
    \         from which the message will be sent) MUST be used.\n      IP Destination\
    \ Address\n         If the Registration Reply is generated by the foreign agent\
    \ in\n         order to reject a mobile node's Registration Request, and the\n\
    \         Registration Request contains a Home Address that is not\n         0.0.0.0,\
    \ then the IP Destination Address is copied from the\n         Home Address field\
    \ of the Registration Request.  Otherwise, if\n         the Registration Reply\
    \ is received from the home agent, and\n         contains a Home Address that\
    \ is not 0.0.0.0, then the IP\n         Destination Address is copied from the\
    \ Home Address field of\n         the Registration Reply.  Otherwise, the IP Destination\
    \ Address\n         of the Registration Reply is set to be 255.255.255.255.\n\
    \      UDP Source Port\n         434\n      UDP Destination Port\n         Copied\
    \ from the UDP Source Port of the Registration Request.\n"
- title: 3.7.3.  Receiving Registration Replies
  contents:
  - "3.7.3.  Receiving Registration Replies\n   The foreign agent updates its visitor\
    \ list when it receives a valid\n   Registration Reply from a home agent.  It\
    \ then relays the\n   Registration Reply to the mobile node.  The following sections\n\
    \   describe this behavior in more detail.\n   If upon relaying a Registration\
    \ Request to a home agent, the foreign\n   agent receives an ICMP error message\
    \ instead of a Registration Reply,\n   then the foreign agent SHOULD send to the\
    \ mobile node a Registration\n   Reply with an appropriate \"home agent unreachable\"\
    \ failure code\n   (within the range 80-95, inclusive).  See Section 3.7.2.3 for\
    \ details\n   on building the Registration Reply.\n"
- title: 3.7.3.1.  Validity Checks
  contents:
  - "3.7.3.1.  Validity Checks\n   Registration Replies with an invalid, non-zero\
    \ UDP checksum MUST be\n   silently discarded.\n   When a foreign agent receives\
    \ a Registration Reply message, it MUST\n   search its visitor list for a pending\
    \ Registration Request with the\n   same mobile node home address as indicated\
    \ in the Reply.  If there\n   are multiple entries with the same home address,\
    \ and if the\n   Registration Reply has the Mobile Node NAI extension [2], the\
    \ foreign\n   agent MUST use the NAI to disambiguate the pending Registration\n\
    \   Requests with the same home address.  If no matching pending Request\n   is\
    \ found, and if the Registration Reply does not correspond with any\n   pending\
    \ Registration Request with a zero mobile node home address\n   (see Section 3.7.1),\
    \ the foreign agent MUST silently discard the\n   Reply.  The foreign agent MUST\
    \ also silently discard the Reply if the\n   low-order 32 bits of the Identification\
    \ field in the Reply do not\n   match those in the Request.\n   Also, the authentication\
    \ in the Registration Reply MUST be checked.\n   If the foreign agent and the\
    \ home agent share a Mobility Security\n   Association, exactly one Foreign-Home\
    \ Authentication Extension MUST\n   be present in the Registration Reply, and\
    \ the foreign agent MUST\n   check the Authenticator value in the Extension. \
    \ If no Foreign-Home\n   Authentication Extension is found, or if more than one\
    \ Foreign-Home\n   Authentication Extension is found, or if the Authenticator\
    \ is\n   invalid, the foreign agent MUST silently discard the Reply and SHOULD\n\
    \   log the event as a security exception.  The foreign agent also MUST\n   reject\
    \ the mobile node's registration and SHOULD send a Registration\n   Reply to the\
    \ mobile node with Code 68.\n"
- title: 3.7.3.2.  Forwarding Replies to the Mobile Node
  contents:
  - "3.7.3.2.  Forwarding Replies to the Mobile Node\n   A Registration Reply that\
    \ satisfies the validity checks of Section\n   3.8.2.1 is relayed to the mobile\
    \ node.  The foreign agent MUST also\n   update its visitor list entry for the\
    \ mobile node to reflect the\n   results of the Registration Request, as indicated\
    \ by the Code field\n   in the Reply.  If the code indicates that the home agent\
    \ has accepted\n   the registration and the Lifetime field is nonzero, the foreign\
    \ agent\n   SHOULD set the Lifetime in the visitor list entry to the minimum of\n\
    \   the following two values:\n   o  the value specified in the Lifetime field\
    \ of the Registration\n      Reply, and\n   o  the foreign agent's own maximum\
    \ value for allowable registration\n      Lifetime.\n   If, instead, the code\
    \ indicates that the Lifetime field is zero, the\n   foreign agent MUST delete\
    \ its visitor list entry for the mobile node.\n   Finally, if the code indicates\
    \ that the registration was denied by\n   the home agent, the foreign agent MUST\
    \ delete its pending\n   registration list entry, but not its visitor list entry,\
    \ for the\n   mobile node.\n   The foreign agent MUST NOT modify any of the fields\
    \ beginning with\n   the fixed portion of the Registration Reply up through and\
    \ including\n   the Mobile-Home Authentication Extension.  Otherwise, an\n   authentication\
    \ failure is very likely to occur at the mobile node.\n   In addition, the foreign\
    \ agent SHOULD perform the following\n   additional procedures:\n   o  It MUST\
    \ process and remove any Extensions that are not covered by\n      any authorization-enabling\
    \ extension,\n   o  It MAY append its own non-authentication Extensions that supply\n\
    \      information to the mobile node, if applicable, and\n   o  It MUST append\
    \ the Mobile-Foreign Authentication Extension, if the\n      foreign agent shares\
    \ a Mobility Security Association with the\n      mobile node.\n   Specific fields\
    \ within the IP header and the UDP header of the\n   relayed Registration Reply\
    \ are set according to the same rules\n   specified in Section 3.7.2.3.\n   After\
    \ forwarding a valid Registration Reply to the mobile node, the\n   foreign agent\
    \ MUST update its visitor list entry for this\n   registration as follows.  If\
    \ the Registration Reply indicates that\n   the registration was accepted by the\
    \ home agent, the foreign agent\n   resets its timer of the lifetime of the registration\
    \ to the Lifetime\n   granted in the Registration Reply; unlike the mobile node's\
    \ timing of\n   the registration lifetime as described in Section 3.6.2.2, the\n\
    \   foreign agent considers this lifetime to begin when it forwards the\n   Registration\
    \ Reply message, ensuring that the foreign agent will not\n   expire the registration\
    \ before the mobile node does.  On the other\n   hand, if the Registration Reply\
    \ indicates that the registration was\n   rejected by the home agent, the foreign\
    \ agent deletes its visitor\n   list entry for this attempted registration.\n"
- title: 3.8.  Home Agent Considerations
  contents:
  - "3.8.  Home Agent Considerations\n   Home agents play a reactive role in the registration\
    \ process.  The\n   home agent receives Registration Requests from the mobile\
    \ node\n   (perhaps relayed by a foreign agent), updates its record of the\n \
    \  mobility bindings for this mobile node, and issues a suitable\n   Registration\
    \ Reply in response to each.\n   A home agent MUST NOT transmit a Registration\
    \ Reply except when\n   replying to a Registration Request received from a mobile\
    \ node.  In\n   particular, the home agent MUST NOT generate a Registration Reply\
    \ to\n   indicate that the Lifetime has expired.\n"
- title: 3.8.1.  Configuration and Registration Tables
  contents:
  - "3.8.1.  Configuration and Registration Tables\n   Each home agent MUST be configured\
    \ with an IP address and with the\n   prefix size for the home network.  The home\
    \ agent MUST be configured\n   with the Mobility Security Association of each\
    \ authorized mobile node\n   that it is serving as a home agent.\n   When the\
    \ home agent accepts a valid Registration Request from a\n   mobile node that\
    \ it serves as a home agent, the home agent MUST\n   create or modify the entry\
    \ for this mobile node in its mobility\n   binding list containing:\n   o  the\
    \ mobile node's home address\n   o  the mobile node's care-of address\n   o  the\
    \ Identification field from the Registration Reply\n   o  the remaining Lifetime\
    \ of the registration\n   The home agent MAY optionally offer the capability to\
    \ dynamically\n   associate a home address to a mobile node upon receiving a\n\
    \   Registration Request from that mobile node.  The method by which a\n   home\
    \ address is allocated to the mobile node is beyond the scope of\n   this document,\
    \ but see [2].  After the home agent makes the\n   association of the home address\
    \ to the mobile node, the home agent\n   MUST put that home address into the Home\
    \ Address field of the\n   Registration Reply.\n   The home agent MAY also maintain\
    \ Mobility Security Associations with\n   various foreign agents.  When receiving\
    \ a Registration Request from a\n   foreign agent, if the home agent shares a\
    \ Mobility Security\n   Association with the foreign agent, the home agent MUST\
    \ check the\n   Authenticator in the required Foreign-Home Authentication Extension\n\
    \   in the message, based on this Mobility Security Association, unless\n   the\
    \ Lifetime field equals 0.  When processing a Registration Request\n   with Lifetime\
    \ = 0, the HA MAY skip checking for the presence and\n   validity of a Foreign-Home\
    \ Authentication Extension.  Similarly, when\n   sending a Registration Reply\
    \ to a foreign agent, if the home agent\n   shares a Mobility Security Association\
    \ with the foreign agent, the\n   home agent MUST include a Foreign-Home Authentication\
    \ Extension in\n   the message, based on this Mobility Security Association.\n"
- title: 3.8.2.  Receiving Registration Requests
  contents:
  - "3.8.2.  Receiving Registration Requests\n   If the home agent accepts an incoming\
    \ Registration Request, it MUST\n   update its record of the mobile node's mobility\
    \ binding(s) and SHOULD\n   send a Registration Reply with a suitable code.  Otherwise\
    \ (the home\n   agent has denied the Request), it SHOULD in most cases send a\n\
    \   Registration Reply with an appropriate code specifying the reason the\n  \
    \ Request was denied.  The following sections describe this behavior in\n   more\
    \ detail.  If the home agent does not support broadcasts (see\n   Section 4.3),\
    \ it MUST ignore the 'B' bit (as opposed to rejecting the\n   Registration Request).\n"
- title: 3.8.2.1.  Validity Checks
  contents:
  - "3.8.2.1.  Validity Checks\n   Registration Requests with an invalid, non-zero\
    \ UDP checksum MUST be\n   silently discarded by the home agent.\n   The authentication\
    \ in the Registration Request MUST be checked.  This\n   involves the following\
    \ operations:\n   a.  The home agent MUST check for the presence of at least one\n\
    \       authorization-enabling extension, and ensure that all indicated\n    \
    \   authentications are carried out.  At least one authorization-\n       enabling\
    \ extension MUST be present in the Registration Request,\n       and the home\
    \ agent MUST either check the Authenticator value in\n       the extension or\
    \ verify that the Authenticator Value has been\n       checked by another agent\
    \ with which it has a security\n       association.\n       If the home agent\
    \ receives a Registration Request from a mobile\n       node with which it does\
    \ not have any security association, the\n       home agent MUST silently discard\
    \ the Registration Request.\n       If the home agent receives a Registration\
    \ Request without any\n       authorization-enabling extension, the home agent\
    \ MUST silently\n       discard the Registration Request.\n       If the Authenticator\
    \ is invalid, the home agent MUST reject the\n       mobile node's registration.\
    \  Further action to be taken in this\n       case depends upon whether the Request\
    \ has a valid Foreign-Home\n       authentication extension (as follows):\n  \
    \     *  If there is a valid Foreign-Home authentication extension, the\n    \
    \      home agent MUST send a Registration Reply with Code 131.\n       *  Otherwise,\
    \ if there is no Foreign-Home Security Association,\n          the home agent\
    \ MAY send a Registration Reply with Code 131.\n          If the home agent sends\
    \ a Registration Reply, it MUST contain\n          a valid Mobile-Home Authentication\
    \ Extension.  In constructing\n          the Reply, the home agent SHOULD choose\
    \ a security association\n          that is likely to exist in the mobile node;\
    \ for example, this\n          may be an older security association or one with\
    \ a longer\n          lifetime than the one that the mobile node attempted to\
    \ use in\n          its Request.  Deployments should take care when updating\n\
    \          security associations to ensure that there is at least one\n      \
    \    common security association shared between the mobile node and\n        \
    \  home agent.  In any case of a failed Authenticator, the home\n          agent\
    \ MUST then discard the Request without further processing\n          and SHOULD\
    \ log the error as a security exception.\n   b.  The home agent MUST check that\
    \ the registration Identification\n       field is correct using the context selected\
    \ by the SPI within the\n       authorization-enabling extension that the home\
    \ agent used to\n       authenticate the mobile node's Registration Request. \
    \ See Section\n       5.7 for a description of how this is performed.  If incorrect,\n\
    \       the home agent MUST reject the Request and SHOULD send a\n       Registration\
    \ Reply to the mobile node with Code 133, including an\n       Identification\
    \ field computed in accordance with the rules\n       specified in Section 5.7.\
    \  The home agent MUST do no further\n       processing with such a Request, though\
    \ it SHOULD log the error as\n       a security exception.\n   c.  If the home\
    \ agent shares a Mobility Security Association with the\n       foreign agent,\
    \ and this is a Registration Request (has non-zero\n       Lifetime), the home\
    \ agent MUST check for the presence of a valid\n       Foreign-Home Authentication\
    \ Extension.  Exactly one Foreign-Home\n       Authentication Extension MUST be\
    \ present in the Registration\n       Request in this case, and the home agent\
    \ MUST check the\n       Authenticator Value in the Extension.  If no Foreign-Home\n\
    \       Authentication Extension is found, or if more than one Foreign-\n    \
    \   Home Authentication Extension is found, or if the Authenticator\n       is\
    \ invalid, the home agent MUST reject the mobile node's\n       registration and\
    \ SHOULD send a Registration Reply to the mobile\n       node with Code 132. \
    \ The home agent MUST then discard the Request\n       and SHOULD log the error\
    \ as a security exception.\n   d.  If the home agent and the foreign agent do\
    \ not share a Mobility\n       Security Association, and the Registration contains\
    \ a Foreign-\n       Home Authentication Extension, the home agent MUST discard\
    \ the\n       Request and SHOULD log the error as a security exception.\n   In\
    \ addition to checking the authentication in the Registration\n   Request, home\
    \ agents MUST deny Registration Requests that are sent to\n   the subnet-directed\
    \ broadcast address of the home network (as opposed\n   to being unicast to the\
    \ home agent).  The home agent MUST discard the\n   Request and SHOULD return\
    \ a Registration Reply with a Code of 136.\n   In this case, the Registration\
    \ Reply will contain the home agent's\n   unicast address, so that the mobile\
    \ node can re-issue the\n   Registration Request with the correct home agent address.\n\
    \   Note that some routers change the IP Destination Address of a\n   datagram\
    \ from a subnet-directed broadcast address to 255.255.255.255\n   before injecting\
    \ it into the destination subnet.  In this case, home\n   agents that attempt\
    \ to pick up dynamic home agent discovery requests\n   by binding a socket explicitly\
    \ to the subnet-directed broadcast\n   address will not see such packets.  Home\
    \ agent implementors should be\n   prepared for both the subnet-directed broadcast\
    \ address and\n   255.255.255.255 if they wish to support dynamic home agent discovery.\n"
- title: 3.8.2.2.  Accepting a Valid Request
  contents:
  - "3.8.2.2.  Accepting a Valid Request\n   If the Registration Request satisfies\
    \ the validity checks in Section\n   3.8.2.1, and the home agent is able to accommodate\
    \ the Request, the\n   home agent MUST update its mobility binding list for the\
    \ requesting\n   mobile node and MUST return a Registration Reply to the mobile\
    \ node.\n   In this case, the code in the Registration Reply will be either 0\
    \ if\n   the home agent supports simultaneous mobility bindings, or 1 if it\n\
    \   does not.  See Section 3.8.3 for details on building the Registration\n  \
    \ Reply message.\n   The home agent updates its record of the mobile node's mobility\n\
    \   bindings as follows, based on the fields in the Registration Request:\n  \
    \ o  If the Lifetime is zero and the Care-of Address equals the mobile\n     \
    \ node's home address, the home agent deletes all of the entries in\n      the\
    \ mobility binding list for the requesting mobile node.  This is\n      how a\
    \ mobile node requests that its home agent cease providing\n      mobility services.\n\
    \   o  If the Lifetime is zero and the Care-of Address does not equal the\n  \
    \    mobile node's home address, the home agent deletes only the entry\n     \
    \ containing the specified Care-of Address from the mobility binding\n      list\
    \ for the requesting mobile node.  Any other active entries\n      containing\
    \ other care-of addresses will remain active.\n   o  If the Lifetime is nonzero,\
    \ the home agent adds an entry\n      containing the requested Care-of Address\
    \ to the mobility binding\n      list for the mobile node.  If the 'S' bit is\
    \ set and the home\n      agent supports simultaneous mobility bindings, the previous\n\
    \      mobility binding entries are retained.  Otherwise, the home agent\n   \
    \   removes all previous entries in the mobility binding list for the\n      mobile\
    \ node.\n   In all cases, the home agent MUST send a Registration Reply to the\n\
    \   source of the Registration Request, which might indeed be a different\n  \
    \ foreign agent than that whose care-of address is being\n   (de)registered. \
    \ If the home agent shares a Mobility Security\n   Association with the foreign\
    \ agent whose care-of address is being\n   deregistered, and that foreign agent\
    \ is different from the one that\n   relayed the Registration Request, the home\
    \ agent MAY additionally\n   send a Registration Reply to the foreign agent whose\
    \ care-of address\n   is being deregistered.  The home agent MUST NOT send such\
    \ a Reply if\n   it does not share a Mobility Security Association with the foreign\n\
    \   agent.  If no Reply is sent, the foreign agent's visitor list will\n   expire\
    \ naturally when the original Lifetime expires.\n   When a foreign agent relays\
    \ a deregistration message containing a\n   care-of address that it does not own,\
    \ it MUST NOT add a Foreign-Home\n   Authentication Extension to that deregistration.\
    \  See Section 3.5.4\n   for more details.\n   The home agent MUST NOT increase\
    \ the Lifetime above that specified by\n   the mobile node in the Registration\
    \ Request.  However, it is not an\n   error for the mobile node to request a Lifetime\
    \ longer than the home\n   agent is willing to accept.  In this case, the home\
    \ agent simply\n   reduces the Lifetime to a permissible value and returns this\
    \ value in\n   the Registration Reply.  The Lifetime value in the Registration\
    \ Reply\n   informs the mobile node of the granted Lifetime of the registration,\n\
    \   indicating when it SHOULD re-register in order to maintain continued\n   service.\
    \  After the expiration of this registration Lifetime, the\n   home agent MUST\
    \ delete its entry for this registration in its\n   mobility binding list.\n \
    \  If the Registration Request duplicates an accepted current\n   Registration\
    \ Request, the new Lifetime MUST NOT extend beyond the\n   Lifetime originally\
    \ granted.  A Registration Request is a duplicate\n   if the home address, care-of\
    \ address, and Identification fields all\n   equal those of an accepted current\
    \ registration.\n   In addition, if the home network implements ARP [16], and\
    \ the\n   Registration Request asks the home agent to create a mobility binding\n\
    \   for a mobile node that previously had no binding (the mobile node was\n  \
    \ previously assumed to be at home), then the home agent MUST follow\n   the procedures\
    \ described in Section 4.6 with regard to ARP, proxy\n   ARP, and gratuitous ARP.\
    \  If the mobile node already had a previous\n   mobility binding, the home agent\
    \ MUST continue to follow the rules\n   for proxy ARP described in Section 4.6.\n"
- title: 3.8.2.3.  Denying an Invalid Request
  contents:
  - "3.8.2.3.  Denying an Invalid Request\n   If the Registration Request does not\
    \ satisfy all of the validity\n   checks in Section 3.8.2.1, or the home agent\
    \ is unable to accommodate\n   the Request, the home agent SHOULD return a Registration\
    \ Reply to the\n   mobile node with a Code that indicates the reason for the error.\
    \  If\n   a foreign agent was involved in relaying the Request, this allows the\n\
    \   foreign agent to delete its pending visitor list entry.  Also, this\n   informs\
    \ the mobile node of the reason for the error such that it may\n   attempt to\
    \ fix the error and issue another Request.\n   This section lists a number of\
    \ reasons the home agent might reject a\n   Request, and provides the code value\
    \ it should use in each instance.\n   See Section 3.8.3 for additional details\
    \ on building the Registration\n   Reply message.\n   Many reasons for rejecting\
    \ a registration are administrative in\n   nature.  For example, a home agent\
    \ can limit the number of\n   simultaneous registrations for a mobile node, by\
    \ rejecting any\n   registrations that would cause its limit to be exceeded, and\n\
    \   returning a Registration Reply with a Code of 135.  Similarly, a home\n  \
    \ agent may refuse to grant service to mobile nodes that have entered\n   unauthorized\
    \ service areas by returning a Registration Reply with a\n   Code of 129.\n  \
    \ Requests with non-zero bits in reserved fields MUST be rejected with\n   Code\
    \ 134 (poorly formed Request).\n"
- title: 3.8.3.  Sending Registration Replies
  contents:
  - "3.8.3.  Sending Registration Replies\n   If the home agent accepts a Registration\
    \ Request, it then MUST update\n   its record of the mobile node's mobility binding(s)\
    \ and SHOULD send a\n   Registration Reply with a suitable Code.  Otherwise (the\
    \ home agent\n   has denied the Request), it SHOULD in most cases send a Registration\n\
    \   Reply with an appropriate Code specifying the reason the Request was\n   denied.\
    \  The following sections provide additional detail for the\n   values the home\
    \ agent MUST supply in the fields of Registration Reply\n   messages.\n"
- title: 3.8.3.1.  IP/UDP Fields
  contents:
  - "3.8.3.1.  IP/UDP Fields\n   This section provides the specific rules by which\
    \ home agents pick\n   values for the IP and UDP header fields of a Registration\
    \ Reply.\n      IP Source Address\n         Copied from the IP Destination Address\
    \ of the Registration\n         Request, unless a multicast or broadcast address\
    \ was used.  If\n         the IP Destination Address of the Registration Request\
    \ was a\n         broadcast or multicast address, the IP Source Address of the\n\
    \         Registration Reply MUST be set to the home agent's (unicast) IP\n  \
    \       address.\n      IP Destination Address\n         Copied from the IP Source\
    \ Address of the Registration Request.\n      UDP Source Port\n         Copied\
    \ from the UDP Destination Port of the Registration\n         Request.\n     \
    \ UDP Destination Port\n         Copied from the UDP Source Port of the Registration\
    \ Request.\n   When sending a Registration Reply in response to a Registration\n\
    \   Request that requested deregistration of the mobile node (the\n   Lifetime\
    \ is zero and the Care-of Address equals the mobile node's\n   home address) and\
    \ in which the IP Source Address was also set to the\n   mobile node's home address\
    \ (this is the normal method used by a\n   mobile node to deregister when it returns\
    \ to its home network), the\n   IP Destination Address in the Registration Reply\
    \ will be set to the\n   mobile node's home address, as copied from the IP Source\
    \ Address of\n   the Request.\n   In this case, when transmitting the Registration\
    \ Reply, the home\n   agent MUST transmit the Reply directly onto the home network\
    \ as if\n   the mobile node were at home, bypassing any mobility binding list\n\
    \   entry that may still exist at the home agent for the destination\n   mobile\
    \ node.  In particular, for a mobile node returning home after\n   being registered\
    \ with a care-of address, if the mobile node's new\n   Registration Request is\
    \ not accepted by the home agent, the mobility\n   binding list entry for the\
    \ mobile node will still indicate that\n   datagrams addressed to the mobile node\
    \ should be tunneled to the\n   mobile node's registered care-of address; when\
    \ sending the\n   Registration Reply indicating the rejection of this Request,\
    \ this\n   existing binding list entry MUST be ignored, and the home agent MUST\n\
    \   transmit this Reply as if the mobile node were at home.\n"
- title: 3.8.3.2.  Registration Reply Fields
  contents:
  - "3.8.3.2.  Registration Reply Fields\n   This section provides the specific rules\
    \ by which home agents pick\n   values for the fields within the fixed portion\
    \ of a Registration\n   Reply.\n   The Code field of the Registration Reply is\
    \ chosen in accordance with\n   the rules specified in the previous sections.\
    \  When replying to an\n   accepted registration, a home agent SHOULD respond\
    \ with Code 1 if it\n   does not support simultaneous registrations.\n   The Lifetime\
    \ field MUST be copied from the corresponding field in the\n   Registration Request,\
    \ unless the requested value is greater than the\n   maximum length of time the\
    \ home agent is willing to provide the\n   requested service.  In such a case,\
    \ the Lifetime MUST be set to the\n   length of time that service will actually\
    \ be provided by the home\n   agent.  This reduced Lifetime SHOULD be the maximum\
    \ Lifetime allowed\n   by the home agent (for this mobile node and care-of address).\n\
    \   If the Home Address field of the Registration Request is non-zero, it\n  \
    \ MUST be copied into the Home Address field of the Registration Reply\n   message.\
    \  If the home agent cannot support the specified nonzero\n   unicast address\
    \ in the Home Address field of the Registration\n   Request, then the home agent\
    \ MUST reject the Registration Request\n   with a Code of 129.\n   Otherwise,\
    \ if the Home Address field of the Registration Request is\n   zero as specified\
    \ in Section 3.6, the home agent SHOULD arrange for\n   the selection of a home\
    \ address for the mobile node, and insert the\n   selected address into the Home\
    \ Address field of the Registration\n   Reply message.  See [2] for further relevant\
    \ details in the case\n   where mobile nodes identify themselves using an NAI\
    \ instead of their\n   IP home address.\n   If the Home Agent field in the Registration\
    \ Request contains a\n   unicast address of this home agent, then that field MUST\
    \ be copied\n   into the Home Agent field of the Registration Reply.  Otherwise,\
    \ the\n   home agent MUST set the Home Agent field in the Registration Reply to\n\
    \   its unicast address.  In this latter case, the home agent MUST reject\n  \
    \ the registration with a suitable code (e.g., Code 136) to prevent the\n   mobile\
    \ node from possibly being simultaneously registered with two or\n   more home\
    \ agents.\n"
- title: 3.8.3.3.  Extensions
  contents:
  - "3.8.3.3.  Extensions\n   This section describes the ordering of any required\
    \ and any optional\n   Mobile IP Extensions that a home agent appends to a Registration\n\
    \   Reply.  The following ordering MUST be followed:\n   a.  The IP header, followed\
    \ by the UDP header, followed by the fixed-\n       length portion of the Registration\
    \ Reply,\n   b.  If present, any non-authentication Extensions used by the mobile\n\
    \       node (which may or may not also be used by the foreign agent),\n   c.\
    \  The Mobile-Home Authentication Extension,\n   d.  If present, any non-authentication\
    \ Extensions used only by the\n       foreign agent, and\n   e.  The Foreign-Home\
    \ Authentication Extension, if present.\n   Note that items (a) and (c) MUST appear\
    \ in every Registration Reply\n   sent by the home agent.  Items (b), (d), and\
    \ (e) are optional.\n   However, item (e) MUST be included when the home agent\
    \ and the\n   foreign agent share a Mobility Security Association.\n"
- title: 4.  Routing Considerations
  contents:
  - "4.  Routing Considerations\n   This section describes how mobile nodes, home\
    \ agents, and (possibly)\n   foreign agents cooperate to route datagrams to/from\
    \ mobile nodes that\n   are connected to a foreign network.  The mobile node informs\
    \ its home\n   agent of its current location using the registration procedure\n\
    \   described in Section 3.  See the protocol overview in Section 1.7 for\n  \
    \ the relative locations of the mobile node's home address with respect\n   to\
    \ its home agent, and the mobile node itself with respect to any\n   foreign agent\
    \ with which it might attempt to register.\n"
- title: 4.1.  Encapsulation Types
  contents:
  - "4.1.  Encapsulation Types\n   Home agents and foreign agents MUST support tunneling\
    \ datagrams using\n   IP in IP encapsulation [14].  Any mobile node that uses\
    \ a co-located\n   care-of address MUST support receiving datagrams tunneled using\
    \ IP in\n   IP encapsulation.  Minimal encapsulation [15] and GRE encapsulation\n\
    \   [13] are alternate encapsulation methods that MAY optionally be\n   supported\
    \ by mobility agents and mobile nodes.  The use of these\n   alternative forms\
    \ of encapsulation, when requested by the mobile\n   node, is otherwise at the\
    \ discretion of the home agent.\n"
- title: 4.2.  Unicast Datagram Routing
  contents:
  - '4.2.  Unicast Datagram Routing

    '
- title: 4.2.1.  Mobile Node Considerations
  contents:
  - "4.2.1.  Mobile Node Considerations\n   When connected to its home network, a\
    \ mobile node operates without\n   the support of mobility services.  That is,\
    \ it operates in the same\n   way as any other (fixed) host or router.  The method\
    \ by which a\n   mobile node selects a default router when connected to its home\n\
    \   network, or when away from home and using a co-located care-of\n   address,\
    \ is outside the scope of this document.  ICMP Router\n   Advertisement [5] is\
    \ one such method.\n   When registered on a foreign network, the mobile node chooses\
    \ a\n   default router by the following rules:\n   o  If the mobile node is registered\
    \ using a foreign agent care-of\n      address, it MAY use its foreign agent as\
    \ a first-hop router.  The\n      foreign agent's MAC address can be learned from\
    \ the foreign\n      agent's Agent Advertisement message.  Otherwise, the mobile\
    \ node\n      MUST choose its default router from among the router addresses\n\
    \      advertised in the ICMP Router Advertisement portion of that Agent\n   \
    \   Advertisement message.\n   o  If the mobile node is registered directly with\
    \ its home agent\n      using a co-located care-of address, then the mobile node\
    \ SHOULD\n      choose its default router from among those advertised in any ICMP\n\
    \      Router Advertisement message that it receives for which its\n      externally\
    \ obtained care-of address and the router address match\n      under the network\
    \ prefix.  If the mobile node's externally\n      obtained care-of address matches\
    \ the IP source address of the\n      Agent Advertisement under the network prefix,\
    \ the mobile node MAY\n      also consider that IP source address as another possible\
    \ choice\n      for the IP address of a default router.  The network prefix MAY\
    \ be\n      obtained from the Prefix-Lengths Extension in the Router\n      Advertisement,\
    \ if present.  The prefix MAY also be obtained\n      through other mechanisms\
    \ beyond the scope of this document.\n   While they are away from the home network,\
    \ mobile nodes MUST NOT\n   broadcast ARP packets to find the MAC address of another\
    \ Internet\n   node.  Thus, the (possibly empty) list of router addresses from\
    \ the\n   ICMP Router Advertisement portion of the message is not useful for\n\
    \   selecting a default router, unless the mobile node has some means not\n  \
    \ involving broadcast ARP and not specified within this document for\n   obtaining\
    \ the MAC address of one of the routers in the list.\n   Similarly, in the absence\
    \ of unspecified mechanisms for obtaining MAC\n   addresses on foreign networks,\
    \ the mobile node MUST ignore redirects\n   to other routers on foreign networks.\n"
- title: 4.2.2.  Foreign Agent Considerations
  contents:
  - "4.2.2.  Foreign Agent Considerations\n   Upon receipt of an encapsulated datagram\
    \ sent to its advertised care-\n   of address, a foreign agent MUST compare the\
    \ inner Destination\n   Address to those entries in its visitor list.  When the\
    \ Destination\n   does not match the address of any mobile node currently in the\n\
    \   visitor list, the foreign agent MUST NOT forward the datagram without\n  \
    \ modifications to the original IP header, because otherwise a routing\n   loop\
    \ is likely to result.  The datagram SHOULD be silently discarded.\n   ICMP Destination\
    \ Unreachable MUST NOT be sent when a foreign agent is\n   unable to forward an\
    \ incoming tunneled datagram.  Otherwise, the\n   foreign agent forwards the decapsulated\
    \ datagram to the mobile node.\n   The foreign agent MUST NOT advertise to other\
    \ routers in its routing\n   domain, nor to any other mobile node, the presence\
    \ of a mobile router\n   (Section 4.5) or mobile node in its visitor list.\n \
    \  The foreign agent MUST route datagrams it receives from registered\n   mobile\
    \ nodes.  At a minimum, this means that the foreign agent must\n   verify the\
    \ IP Header Checksum, decrement the IP Time To Live,\n   recompute the IP Header\
    \ Checksum, and forward such datagrams to a\n   default router.\n   A foreign\
    \ agent MUST NOT use broadcast ARP for a mobile node's MAC\n   address on a foreign\
    \ network.  It may obtain the MAC address by\n   copying the information from\
    \ an Agent Solicitation or a Registration\n   Request transmitted from a mobile\
    \ node.  A foreign agent's ARP cache\n   for the mobile node's IP address MUST\
    \ NOT be allowed to expire before\n   the mobile node's visitor list entry expires,\
    \ unless the foreign\n   agent has some way other than broadcast ARP to refresh\
    \ its MAC\n   address associated with the mobile node's IP address.\n   Each foreign\
    \ agent SHOULD support the mandatory features for reverse\n   tunneling [12].\n"
- title: 4.2.3.  Home Agent Considerations
  contents:
  - "4.2.3.  Home Agent Considerations\n   The home agent MUST be able to intercept\
    \ any datagrams on the home\n   network addressed to the mobile node while the\
    \ mobile node is\n   registered away from home.  Proxy and gratuitous ARP MAY\
    \ be used in\n   enabling this interception, as specified in Section 4.6.\n  \
    \ The home agent must examine the IP Destination Address of all\n   arriving datagrams\
    \ to see if it is equal to the home address of any\n   of its mobile nodes registered\
    \ away from home.  If so, the home agent\n   tunnels the datagram to the mobile\
    \ node's currently registered care-\n   of address or addresses.  If the home\
    \ agent supports the optional\n   capability of multiple simultaneous mobility\
    \ bindings, it tunnels a\n   copy to each care-of address in the mobile node's\
    \ mobility binding\n   list.  If the mobile node has no current mobility bindings,\
    \ the home\n   agent MUST NOT attempt to intercept datagrams destined for the\
    \ mobile\n   node, and thus will not in general receive such datagrams.  However,\n\
    \   if the home agent is also a router handling common IP traffic, it is\n   possible\
    \ that it will receive such datagrams for forwarding onto the\n   home network.\
    \  In this case, the home agent MUST assume the mobile\n   node is at home and\
    \ simply forward the datagram directly onto the\n   home network.\n   For multihomed\
    \ home agents, the source address in the outer IP header\n   of the encapsulated\
    \ datagram MUST be the address sent to the mobile\n   node in the Home Agent field\
    \ of the Registration Reply.  That is, the\n   home agent cannot use the address\
    \ of some other network interface as\n   the source address.\n   See Section 4.1\
    \ regarding methods of encapsulation that may be used\n   for tunneling.  Nodes\
    \ implementing tunneling SHOULD also implement\n   the \"tunnel soft state\" mechanism\
    \ [14], which allows ICMP error\n   messages returned from the tunnel to correctly\
    \ be reflected back to\n   the original senders of the tunneled datagrams.\n \
    \  Home agents MUST decapsulate packets addressed to themselves, sent by\n   a\
    \ mobile node for the purpose of maintaining location privacy, as\n   described\
    \ in Section 5.5.  This feature is also required for support\n   of reverse tunneling\
    \ [12].\n   If the Lifetime for a given mobility binding expires before the home\n\
    \   agent has received another valid Registration Request for that mobile\n  \
    \ node, then that binding is deleted from the mobility binding list.\n   The home\
    \ agent MUST NOT send any Registration Reply message simply\n   because the mobile\
    \ node's binding has expired.  The entry in the\n   visitor list of the mobile\
    \ node's current foreign agent will expire\n   naturally, probably at the same\
    \ time as the binding expired at the\n   home agent.  When a mobility binding's\
    \ lifetime expires, the home\n   agent MUST delete the binding, but it MUST retain\
    \ any other (non-\n   expired) simultaneous mobility bindings that it holds for\
    \ the mobile\n   node.\n   When a home agent receives a datagram, intercepted\
    \ for one of its\n   mobile nodes registered away from home, the home agent MUST\
    \ examine\n   the datagram to check if it is already encapsulated.  If so, special\n\
    \   rules apply in the forwarding of that datagram to the mobile node:\n   o \
    \ If the inner (encapsulated) Destination Address is the same as the\n      outer\
    \ Destination Address (the mobile node), then the home agent\n      MUST also\
    \ examine the outer Source Address of the encapsulated\n      datagram (the source\
    \ address of the tunnel).  If this outer Source\n      Address is the same as\
    \ the mobile node's current care-of address,\n      the home agent MUST silently\
    \ discard that datagram in order to\n      prevent a likely routing loop.  If,\
    \ instead, the outer Source\n      Address is NOT the same as the mobile node's\
    \ current care-of\n      address, then the home agent SHOULD forward the datagram\
    \ to the\n      mobile node.  In order to forward the datagram in this case, the\n\
    \      home agent MAY simply alter the outer Destination Address to the\n    \
    \  care-of address, rather than re-encapsulating the datagram.\n   o  Otherwise\
    \ (the inner Destination Address is NOT the same as the\n      outer Destination\
    \ Address), the home agent SHOULD encapsulate the\n      datagram again (nested\
    \ encapsulation), with the new outer\n      Destination Address set equal to the\
    \ mobile node's care-of\n      address.  That is, the home agent forwards the\
    \ entire datagram to\n      the mobile node in the same way as any other datagram\n\
    \      (encapsulated already or not).\n"
- title: 4.3.  Broadcast Datagrams
  contents:
  - "4.3.  Broadcast Datagrams\n   When a home agent receives a broadcast datagram,\
    \ it MUST NOT forward\n   the datagram to any mobile nodes in its mobility binding\
    \ list other\n   than those that have requested forwarding of broadcast datagrams.\
    \  A\n   mobile node MAY request forwarding of broadcast datagrams by setting\n\
    \   the 'B' bit in its Registration Request message (Section 3.3).  For\n   each\
    \ such registered mobile node, the home agent SHOULD forward\n   received broadcast\
    \ datagrams to the mobile node, although it is a\n   matter of configuration at\
    \ the home agent as to which specific\n   categories of broadcast datagrams will\
    \ be forwarded to such mobile\n   nodes.\n   If the 'D' bit was set in the mobile\
    \ node's Registration Request\n   message, indicating that the mobile node is\
    \ using a co-located care-\n   of address, the home agent simply tunnels appropriate\
    \ broadcast IP\n   datagrams to the mobile node's care-of address.  Otherwise\
    \ (the 'D'\n   bit was NOT set), the home agent first encapsulates the broadcast\n\
    \   datagram in a unicast datagram addressed to the mobile node's home\n   address,\
    \ and then tunnels this encapsulated datagram to the foreign\n   agent.  This\
    \ extra level of encapsulation is required so that the\n   foreign agent can determine\
    \ which mobile node should receive the\n   datagram after it is decapsulated.\
    \  When received by the foreign\n   agent, the unicast encapsulated datagram is\
    \ detunneled and delivered\n   to the mobile node in the same way as any other\
    \ datagram.  In either\n   case, the mobile node must decapsulate the datagram\
    \ it receives in\n   order to recover the original broadcast datagram.\n"
- title: 4.4.  Multicast Datagram Routing
  contents:
  - "4.4.  Multicast Datagram Routing\n   As mentioned previously, a mobile node that\
    \ is connected to its home\n   network functions in the same way as any other\
    \ (fixed) host or\n   router.  Thus, when it is at home, a mobile node functions\n\
    \   identically to other multicast senders and receivers.  This section\n   therefore\
    \ describes the behavior of a mobile node that is visiting a\n   foreign network.\n\
    \   In order to receive multicasts, a mobile node MUST join the multicast\n  \
    \ group in one of two ways.  First, a mobile node MAY join the group\n   via a\
    \ (local) multicast router on the visited subnet.  This option\n   assumes that\
    \ there is a multicast router present on the visited\n   subnet.  If the mobile\
    \ node is using a co-located care-of address, it\n   SHOULD use this address as\
    \ the source IP address of its IGMP [6]\n   messages.  Otherwise, it MAY use its\
    \ home address.\n   Alternatively, a mobile node that wishes to receive multicasts\
    \ MAY\n   join groups via a bidirectional tunnel to its home agent, assuming\n\
    \   that its home agent is a multicast router.  The mobile node tunnels\n   IGMP\
    \ messages to its home agent, and the home agent forwards\n   multicast datagrams\
    \ down the tunnel to the mobile node.  For packets\n   tunneled to the home agent,\
    \ the source address in the IP header\n   SHOULD be the mobile node's home address.\n\
    \   The rules for multicast datagram delivery to mobile nodes in this\n   case\
    \ are identical to those for broadcast datagrams (Section 4.3).\n   Namely, if\
    \ the mobile node is using a co-located care-of address (the\n   'D' bit was set\
    \ in the mobile node's Registration Request), then the\n   home agent SHOULD tunnel\
    \ the datagram to this care-of address;\n   otherwise, the home agent MUST first\
    \ encapsulate the datagram in a\n   unicast datagram addressed to the mobile node's\
    \ home address and then\n   MUST tunnel the resulting datagram (nested tunneling)\
    \ to the mobile\n   node's care-of address.  For this reason, the mobile node\
    \ MUST be\n   capable of decapsulating packets sent to its home address in order\
    \ to\n   receive multicast datagrams using this method.\n   A mobile node that\
    \ wishes to send datagrams to a multicast group also\n   has two options: (1)\
    \ send directly on the visited network; or (2)\n   send via a tunnel to its home\
    \ agent.  Because multicast routing in\n   general depends upon the IP source\
    \ address, a mobile node that sends\n   multicast datagrams directly on the visited\
    \ network MUST use a\n   co-located care-of address as the IP source address.\
    \  Similarly, a\n   mobile node that tunnels a multicast datagram to its home\
    \ agent MUST\n   use its home address as the IP source address of both the (inner)\n\
    \   multicast datagram and the (outer) encapsulating datagram.  This\n   second\
    \ option assumes that the home agent is a multicast router.\n"
- title: 4.5.  Mobile Routers
  contents:
  - "4.5.  Mobile Routers\n   A mobile node can be a router that is responsible for\
    \ the mobility of\n   one or more entire networks moving together, perhaps on\
    \ an airplane,\n   a ship, a train, an automobile, a bicycle, or a kayak.  The\
    \ nodes\n   connected to a network served by the mobile router may themselves\
    \ be\n   fixed nodes or mobile nodes or routers.  In this document, such\n   networks\
    \ are called \"mobile networks\".\n   A mobile router MAY act as a foreign agent\
    \ and provide a foreign\n   agent care-of address to mobile nodes connected to\
    \ the mobile\n   network.  Typical routing to a mobile node via a mobile router\
    \ in\n   this case is illustrated by the following example:\n   a.  A laptop computer\
    \ is disconnected from its home network and later\n       attached to a network\
    \ port in the seat back of an aircraft.  The\n       laptop computer uses Mobile\
    \ IP to register on this foreign\n       network, using a foreign agent care-of\
    \ address discovered through\n       an Agent Advertisement from the aircraft's\
    \ foreign agent.\n   b.  The aircraft network is itself mobile.  Suppose the node\
    \ serving\n       as the foreign agent on the aircraft also serves as the default\n\
    \       router that connects the aircraft network to the rest of the\n       Internet.\
    \  When the aircraft is at home, this router is attached\n       to some fixed\
    \ network at the airline's headquarters, which is the\n       router's home network.\
    \  While the aircraft is in flight, this\n       router registers from time to\
    \ time over its radio link with a\n       series of foreign agents below it on\
    \ the ground.  This router's\n       home agent is a node on the fixed network\
    \ at the airline's\n       headquarters.\n   c.  Some correspondent node sends\
    \ a datagram to the laptop computer,\n       addressing the datagram to the laptop's\
    \ home address.  This\n       datagram is initially routed to the laptop's home\
    \ network.\n   d.  The laptop's home agent intercepts the datagram on the home\n\
    \       network and tunnels it to the laptop's care-of address, which in\n   \
    \    this example is an address of the node serving as the router and\n      \
    \ foreign agent on the aircraft.  Normal IP routing will route the\n       datagram\
    \ to the fixed network at the airline's headquarters.\n   e.  The aircraft router\
    \ and foreign agent's home agent there\n       intercept the datagram and tunnel\
    \ it to its current care-of\n       address, which in this example is some foreign\
    \ agent on the\n       ground below the aircraft.  The original datagram from\
    \ the\n       correspondent node has now been encapsulated twice: once by the\n\
    \       laptop's home agent and again by the aircraft's home agent.\n   f.  The\
    \ foreign agent on the ground decapsulates the datagram,\n       yielding a datagram\
    \ still encapsulated by the laptop's home\n       agent, with a Destination Address\
    \ of the laptop's care-of\n       address.  The ground foreign agent sends the\
    \ resulting datagram\n       over its radio link to the aircraft.\n   g.  The\
    \ foreign agent on the aircraft decapsulates the datagram,\n       yielding the\
    \ original datagram from the correspondent node, with\n       a Destination Address\
    \ of the laptop's home address.  The aircraft\n       foreign agent delivers the\
    \ datagram over the aircraft network to\n       the laptop's link-layer address.\n\
    \   This example illustrates the case in which a mobile node is attached\n   to\
    \ a mobile network.  That is, the mobile node is mobile with respect\n   to the\
    \ network, which itself is also mobile (here with respect to the\n   ground).\
    \  If, instead, the node is fixed with respect to the mobile\n   network (the\
    \ mobile network is the fixed node's home network), then\n   either of two methods\
    \ may be used to cause datagrams from\n   correspondent nodes to be routed to\
    \ the fixed node.\n   For the fixed node, a home agent MAY be configured to have\
    \ a\n   permanent registration that indicates the mobile router's address as\n\
    \   the fixed host's care-of address.  The mobile router's home agent\n   will\
    \ normally be used for this purpose.  The home agent is then\n   responsible for\
    \ advertising connectivity using normal routing\n   protocols to the fixed node.\
    \  Any datagrams sent to the fixed node\n   will thus use nested tunneling as\
    \ described above.\n   Alternatively, the mobile router MAY advertise connectivity\
    \ to the\n   entire mobile network using normal IP routing protocols through a\n\
    \   bidirectional tunnel to its own home agent.  This method avoids the\n   need\
    \ for nested tunneling of datagrams.\n"
- title: 4.6.  ARP, Proxy ARP, and Gratuitous ARP
  contents:
  - "4.6.  ARP, Proxy ARP, and Gratuitous ARP\n   The use of ARP [16] requires special\
    \ rules for correct operation when\n   wireless or mobile nodes are involved.\
    \  The requirements specified in\n   this section apply to all home networks in\
    \ which ARP is used for\n   address resolution.\n   In addition to the normal\
    \ use of ARP for resolving a target node's\n   link-layer address from its IP\
    \ address, this document distinguishes\n   two special uses of ARP:\n   o  A Proxy\
    \ ARP [49] is an ARP Reply sent by one node on behalf of\n      another node that\
    \ is either unable or unwilling to answer its own\n      ARP Requests.  The sender\
    \ of a Proxy ARP reverses the Sender and\n      Target Protocol Address fields\
    \ as described in [16], but supplies\n      some configured link-layer address\
    \ (generally, its own) in the\n      Sender Hardware Address field.  The node\
    \ receiving the Reply will\n      then associate this link-layer address with\
    \ the IP address of the\n      original target node, causing it to transmit future\
    \ datagrams for\n      this target node to the node with that link-layer address.\n\
    \   o  A Gratuitous ARP [45] is an ARP packet sent by a node in order to\n   \
    \   spontaneously cause other nodes to update an entry in their ARP\n      cache.\
    \  A gratuitous ARP MAY use either an ARP Request or an ARP\n      Reply packet.\
    \  In either case, the ARP Sender Protocol Address and\n      ARP Target Protocol\
    \ Address are both set to the IP address of the\n      cache entry to be updated,\
    \ and the ARP Sender Hardware Address is\n      set to the link-layer address\
    \ to which this cache entry should be\n      updated.  When using an ARP Reply\
    \ packet, the Target Hardware\n      Address is also set to the link-layer address\
    \ to which this cache\n      entry should be updated (this field is not used in\
    \ an ARP Request\n      packet).\n      In either case, for a gratuitous ARP,\
    \ the ARP packet MUST be\n      transmitted as a local broadcast packet on the\
    \ local link.  As\n      specified in [16], any node receiving any ARP packet\
    \ (Request or\n      Reply) MUST update its local ARP cache with the Sender Protocol\n\
    \      and Hardware Addresses in the ARP packet, if the receiving node\n     \
    \ has an entry for that IP address already in its ARP cache.  This\n      requirement\
    \ in the ARP protocol applies even for ARP Request\n      packets, and for ARP\
    \ Reply packets that do not match any ARP\n      Request transmitted by the receiving\
    \ node [16].\n   While a mobile node is registered on a foreign network, its home\n\
    \   agent uses proxy ARP [49] to reply to ARP Requests it receives that\n   seek\
    \ the mobile node's link-layer address.  When receiving an ARP\n   Request, the\
    \ home agent MUST examine the target IP address of the\n   Request, and if this\
    \ IP address matches the home address of any\n   mobile node for which it has\
    \ a registered mobility binding, the home\n   agent MUST transmit an ARP Reply\
    \ on behalf of the mobile node.  After\n   exchanging the sender and target addresses\
    \ in the packet [49], the\n   home agent MUST set the sender link-layer address\
    \ in the packet to\n   the link-layer address of its own interface over which\
    \ the Reply will\n   be sent.\n   When a mobile node leaves its home network and\
    \ registers a binding on\n   a foreign network, its home agent uses gratuitous\
    \ ARP to update the\n   ARP caches of nodes on the home network.  This causes\
    \ such nodes to\n   associate the link-layer address of the home agent with the\
    \ mobile\n   node's home (IP) address.  When registering a binding for a mobile\n\
    \   node for which the home agent previously had no binding (the mobile\n   node\
    \ was assumed to be at home), the home agent MUST transmit a\n   gratuitous ARP\
    \ on behalf of the mobile node.  This gratuitous ARP\n   packet MUST be transmitted\
    \ as a broadcast packet on the link on which\n   the mobile node's home address\
    \ is located.  Since broadcasts on the\n   local link (such as Ethernet) are typically\
    \ not guaranteed to be\n   reliable, the gratuitous ARP packet SHOULD be retransmitted\
    \ a small\n   number of times to increase its reliability.\n   When a mobile node\
    \ returns to its home network, the mobile node and\n   its home agent use gratuitous\
    \ ARP to cause all nodes on the mobile\n   node's home network to update their\
    \ ARP caches to once again\n   associate the mobile node's own link-layer address\
    \ with the mobile\n   node's home (IP) address.  Before transmitting the (de)Registration\n\
    \   Request message to its home agent, the mobile node MUST transmit this\n  \
    \ gratuitous ARP on its home network as a local broadcast on this link.\n   The\
    \ gratuitous ARP packet SHOULD be retransmitted a small number of\n   times to\
    \ increase its reliability, but these retransmissions SHOULD\n   proceed in parallel\
    \ with the transmission and processing of the\n   mobile node's (de)Registration\
    \ Request.\n   When the mobile node's home agent receives and accepts this\n \
    \  (de)Registration Request, the home agent MUST also transmit a\n   gratuitous\
    \ ARP on the mobile node's home network.  This gratuitous\n   ARP also is used\
    \ to associate the mobile node's home address with the\n   mobile node's own link-layer\
    \ address.  A gratuitous ARP is\n   transmitted by both the mobile node and its\
    \ home agent, since in the\n   case of wireless network interfaces, the area within\
    \ transmission\n   range of the mobile node will likely differ from that within\
    \ range of\n   its home agent.  The ARP packet from the home agent MUST be\n \
    \  transmitted as a local broadcast on the mobile node's home link, and\n   SHOULD\
    \ be retransmitted a small number of times to increase its\n   reliability; these\
    \ retransmissions, however, SHOULD proceed in\n   parallel with the transmission\
    \ and processing of the mobile node's\n   (de)Registration Reply.\n   While the\
    \ mobile node is away from home, it MUST NOT transmit any\n   broadcast ARP Request\
    \ or ARP Reply messages.  Finally, while the\n   mobile node is away from home,\
    \ it MUST NOT reply to ARP Requests in\n   which the target IP address is its\
    \ own home address unless the ARP\n   Request is unicast by a foreign agent with\
    \ which the mobile node is\n   attempting to register or a foreign agent with\
    \ which the mobile node\n   has an unexpired registration.  In the latter case,\
    \ the mobile node\n   MUST use a unicast ARP Reply to respond to the foreign agent.\
    \  Note\n   that if the mobile node is using a co-located care-of address and\n\
    \   receives an ARP Request in which the target IP address is this care-\n   of\
    \ address, then the mobile node SHOULD reply to this ARP Request.\n   Note also\
    \ that, when transmitting a Registration Request on a foreign\n   network, a mobile\
    \ node may discover the link-layer address of a\n   foreign agent by storing the\
    \ address as it is received from the Agent\n   Advertisement from that foreign\
    \ agent, but not by transmitting a\n   broadcast ARP Request message.\n   The\
    \ specific order in which each of the above requirements for the\n   use of ARP,\
    \ proxy ARP, and gratuitous ARP are applied, relative to\n   the transmission\
    \ and processing of the mobile node's Registration\n   Request and Registration\
    \ Reply messages when leaving home or\n   returning home, are important to the\
    \ correct operation of the\n   protocol.\n   To summarize the above requirements,\
    \ when a mobile node leaves its\n   home network, the following steps, in this\
    \ order, MUST be performed:\n   o  The mobile node decides to register away from\
    \ home, perhaps\n      because it has received an Agent Advertisement from a foreign\n\
    \      agent and has not recently received one from its home agent.\n   o  Before\
    \ transmitting the Registration Request, the mobile node\n      disables its own\
    \ future processing of any ARP Requests it may\n      subsequently receive requesting\
    \ the link-layer address\n      corresponding to its home address, except insofar\
    \ as necessary to\n      communicate with foreign agents on visited networks.\n\
    \   o  The mobile node transmits its Registration Request.\n   o  When the mobile\
    \ node's home agent receives and accepts the\n      Registration Request, it performs\
    \ a gratuitous ARP on behalf of\n      the mobile node, and begins using proxy\
    \ ARP to reply to ARP\n      Requests that it receives requesting the mobile node's\
    \ link-layer\n      address.  In the gratuitous ARP, the ARP Sender Hardware Address\n\
    \      is set to the link-layer address of the home agent.  If, instead,\n   \
    \   the home agent rejects the Registration Request, no ARP processing\n     \
    \ (neither gratuitous nor proxy) is performed by the home agent.\n   When a mobile\
    \ node later returns to its home network, the following\n   steps, in this order,\
    \ MUST be performed:\n   o  The mobile node decides to register at home, perhaps\
    \ because it\n      has received an Agent Advertisement from its home agent.\n\
    \   o  Before transmitting the Registration Request, the mobile node\n      re-enables\
    \ its own future processing of any ARP Requests it may\n      subsequently receive\
    \ requesting its link-layer address.\n   o  The mobile node performs a gratuitous\
    \ ARP for itself.  In this\n      gratuitous ARP, the ARP Sender Hardware Address\
    \ is set to the\n      link-layer address of the mobile node.\n   o  The mobile\
    \ node transmits its Registration Request.\n   o  When the mobile node's home\
    \ agent receives and accepts the\n      Registration Request, it stops using proxy\
    \ ARP to reply to ARP\n      Requests that it receives requesting the mobile node's\
    \ link-layer\n      address, and then performs a gratuitous ARP on behalf of the\n\
    \      mobile node.  In this gratuitous ARP, the ARP Sender Hardware\n      Address\
    \ is set to the link-layer address of the mobile node.  If,\n      instead, the\
    \ home agent rejects the Registration Request, the home\n      agent MUST NOT\
    \ make any change to the way it performs ARP\n      processing (neither gratuitous\
    \ nor proxy) for the mobile node.  In\n      this latter case, the home agent\
    \ should operate as if the mobile\n      node has not returned home, and continue\
    \ to perform proxy ARP on\n      behalf of the mobile node.\n"
- title: 5.  Security Considerations
  contents:
  - "5.  Security Considerations\n   The mobile computing environment is potentially\
    \ very different from\n   the ordinary computing environment.  In many cases,\
    \ mobile computers\n   will be connected to the network via wireless links.  Such\
    \ links are\n   particularly vulnerable to passive eavesdropping, active replay\n\
    \   attacks, and other active attacks.\n"
- title: 5.1.  Message Authentication Codes
  contents:
  - "5.1.  Message Authentication Codes\n   Home agents and mobile nodes MUST be able\
    \ to perform authentication.\n   The default algorithm is HMAC-MD5 [10], with\
    \ a key size of 128 bits.\n   The foreign agent MUST also support authentication\
    \ using HMAC-MD5 and\n   key sizes of 128 bits or greater, with manual key distribution.\
    \  Keys\n   with arbitrary binary values MUST be supported.\n   The \"prefix+suffix\"\
    \ use of MD5 to protect data and a shared secret is\n   considered vulnerable\
    \ to attack by the cryptographic community.\n   Where backward compatibility with\
    \ existing Mobile IP implementations\n   that use this mode is needed, new implementations\
    \ SHOULD include\n   keyed MD5 [19] as one of the additional authentication algorithms\
    \ for\n   use when producing and verifying the authentication data that is\n \
    \  supplied with Mobile IP registration messages, for instance, in the\n   extensions\
    \ specified in Sections 3.5.2, 3.5.3, and 3.5.4.\n   More authentication algorithms,\
    \ algorithm modes, key distribution\n   methods, and key sizes MAY also be supported\
    \ for all of these\n   extensions.\n"
- title: 5.2.  Areas of Security Concern in This Protocol
  contents:
  - "5.2.  Areas of Security Concern in This Protocol\n   The registration protocol\
    \ described in this document will result in a\n   mobile node's traffic being\
    \ tunneled to its care-of address.  This\n   tunneling feature could be a significant\
    \ vulnerability if the\n   registration were not authenticated.  Such remote redirection,\
    \ for\n   instance, as performed by the mobile registration protocol, is widely\n\
    \   understood to be a security problem in the current Internet if not\n   authenticated\
    \ [30].  Moreover, the Address Resolution Protocol (ARP)\n   is not authenticated,\
    \ and can potentially be used to steal another\n   host's traffic.  The use of\
    \ gratuitous ARP (Section 4.6) brings with\n   it all of the risks associated\
    \ with the use of ARP.\n"
- title: 5.3.  Key Management
  contents:
  - "5.3.  Key Management\n   This specification requires a strong authentication\
    \ mechanism (keyed\n   MD5) that precludes many potential attacks based on the\
    \ Mobile IP\n   registration protocol.  However, because key distribution is\n\
    \   difficult in the absence of a network key management protocol,\n   messages\
    \ with the foreign agent are not all required to be\n   authenticated.  In a commercial\
    \ environment it might be important to\n   authenticate all messages between the\
    \ foreign agent and the home\n   agent, so that billing is possible and service\
    \ providers do not\n   provide service to users that are not legitimate customers\
    \ of that\n   service provider.\n"
- title: 5.4.  Picking Good Random Numbers
  contents:
  - "5.4.  Picking Good Random Numbers\n   The strength of any authentication mechanism\
    \ depends on several\n   factors, including the innate strength of the authentication\n\
    \   algorithm, the secrecy of the key used, the strength of the key used,\n  \
    \ and the quality of the particular implementation.  This specification\n   requires\
    \ implementation of keyed MD5 for authentication, but does not\n   preclude the\
    \ use of other authentication algorithms and modes.  For\n   keyed MD5 authentication\
    \ to be useful, the 128-bit key must be both\n   secret (that is, known only to\
    \ authorized parties) and pseudo-random.\n   If nonces are used in connection\
    \ with replay protection, they must\n   also be selected carefully.  RFC 4086\
    \ [8] written by Eastlake, et al.\n   provides more information on generating\
    \ pseudo-random numbers.\n"
- title: 5.5.  Privacy
  contents:
  - "5.5.  Privacy\n   Users who have sensitive data that they do not wish others\
    \ to see\n   should use mechanisms outside the scope of this document (such as\n\
    \   encryption) to provide appropriate protection.  Users concerned about\n  \
    \ traffic analysis should consider appropriate use of link encryption.\n   If\
    \ absolute location privacy is desired, the mobile node can create a\n   tunnel\
    \ to its home agent.  Then, datagrams destined for correspondent\n   nodes will\
    \ appear to emanate from the home network, and it may be\n   more difficult to\
    \ pinpoint the location of the mobile node.  Such\n   mechanisms are all beyond\
    \ the scope of this document.\n"
- title: 5.6.  Ingress Filtering
  contents:
  - "5.6.  Ingress Filtering\n   Many routers implement security policies such as\
    \ \"ingress filtering\"\n   [35] that do not allow forwarding of packets that\
    \ have a Source\n   Address that appears topologically incorrect.  In environments\
    \ where\n   this is a problem, mobile nodes may use reverse tunneling [12] with\n\
    \   the foreign agent supplied care-of address as the Source Address.\n   Reverse-tunneled\
    \ packets will be able to pass normally through such\n   routers, while ingress\
    \ filtering rules will still be able to locate\n   the true topological source\
    \ of the packet in the same way as packets\n   from non-mobile nodes.\n"
- title: 5.7.  Replay Protection for Registration Requests
  contents:
  - "5.7.  Replay Protection for Registration Requests\n   The Identification field\
    \ is used to let the home agent verify that a\n   registration message has been\
    \ freshly generated by the mobile node,\n   not replayed by an attacker from some\
    \ previous registration.  Two\n   methods are described in this section: timestamps\
    \ (mandatory) and\n   \"nonces\" (optional).  All mobile nodes and home agents\
    \ MUST implement\n   timestamp-based replay protection.  These nodes MAY also\
    \ implement\n   nonce-based replay protection.\n   The style of replay protection\
    \ in effect between a mobile node and\n   its home agent is part of the Mobility\
    \ Security Association.  A\n   mobile node and its home agent MUST agree on which\
    \ method of replay\n   protection will be used.  The interpretation of the Identification\n\
    \   field depends on the method of replay protection as described in the\n   subsequent\
    \ subsections.\n   Whatever method is used, the low-order 32 bits of the Identification\n\
    \   field MUST be copied unchanged from the Registration Request to the\n   Reply.\
    \  The foreign agent uses those bits (and the mobile node's home\n   address)\
    \ to match Registration Requests with corresponding replies.\n   The mobile node\
    \ MUST verify that the low-order 32 bits of any\n   Registration Reply are identical\
    \ to the bits it sent in the\n   Registration Request.\n   The Identification\
    \ field in a new Registration Request MUST NOT be\n   the same as in an immediately\
    \ preceding Request, and SHOULD NOT\n   repeat while the same security context\
    \ is being used between the\n   mobile node and the home agent.  Retransmission\
    \ as in Section 3.6.3\n   is allowed.\n"
- title: 5.7.1.  Replay Protection Using Timestamps
  contents:
  - "5.7.1.  Replay Protection Using Timestamps\n   The basic principle of timestamp\
    \ replay protection is that the node\n   generating a message inserts the current\
    \ time of day, and the node\n   receiving the message checks that this timestamp\
    \ is sufficiently\n   close to its own time of day.  Unless specified differently\
    \ in the\n   security association between the nodes, a default value of 7 seconds\n\
    \   MAY be used to limit the time difference.  This value SHOULD be\n   greater\
    \ than 3 seconds.  Obviously the two nodes must have adequately\n   synchronized\
    \ time-of-day clocks.  As with any messages, time\n   synchronization messages\
    \ may be protected against tampering by an\n   authentication mechanism determined\
    \ by the security context between\n   the two nodes.\n   If timestamps are used,\
    \ the mobile node MUST set the Identification\n   field to a 64-bit value formatted\
    \ as specified by the Network Time\n   Protocol [11].  The low-order 32 bits of\
    \ the NTP format represent\n   fractional seconds, and those bits that are not\
    \ available from a time\n   source SHOULD be generated from a good source of randomness.\
    \  Note,\n   however, that when using timestamps, the 64-bit Identification used\n\
    \   in a Registration Request from the mobile node MUST be greater than\n   that\
    \ used in any previous Registration Request, as the home agent\n   uses this value\
    \ as a sequence number.  Without such a sequence\n   number, it would be possible\
    \ for a delayed duplicate of an earlier\n   Registration Request to arrive at\
    \ the home agent (within the clock\n   synchronization required by the home agent),\
    \ and thus be applied out\n   of order, mistakenly altering the mobile node's\
    \ current registered\n   care-of address.\n   Upon receipt of a Registration Request\
    \ with an authorization-enabling\n   extension, the home agent MUST check the\
    \ Identification field for\n   validity.  In order to be valid, the timestamp\
    \ contained in the\n   Identification field MUST be close enough to the home agent's\
    \ time-\n   of-day clock, and the timestamp MUST be greater than all previously\n\
    \   accepted timestamps for the requesting mobile node.  Time tolerances\n   and\
    \ resynchronization details are specific to a particular Mobility\n   Security\
    \ Association.\n   If the timestamp is valid, the home agent copies the entire\n\
    \   Identification field into the Registration Reply it returns to the\n   mobile\
    \ node.  If the timestamp is not valid, the home agent copies\n   only the low-order\
    \ 32 bits into the Registration Reply, and supplies\n   the high-order 32 bits\
    \ from its own time of day.  In this latter\n   case, the home agent MUST reject\
    \ the registration by returning Code\n   133 (registration Identification mismatch)\
    \ in the Registration Reply.\n   As described in Section 3.6.2.1, the mobile node\
    \ MUST verify that the\n   low-order 32 bits of the Identification field in the\
    \ Registration\n   Reply are identical to those in the rejected registration attempt,\n\
    \   before using the high-order bits for clock resynchronization.\n"
- title: 5.7.2.  Replay Protection Using Nonces
  contents:
  - "5.7.2.  Replay Protection Using Nonces\n   The basic principle of nonce replay\
    \ protection is that node A\n   includes a new random number in every message\
    \ to node B, and checks\n   that node B returns that same number in its next message\
    \ to node A.\n   Both messages use an authentication code to protect against\n\
    \   alteration by an attacker.  At the same time, node B can send its own\n  \
    \ nonces in all messages to node A (to be echoed by node A), so that it\n   too\
    \ can verify that it is receiving fresh messages.\n   The home agent may be expected\
    \ to have resources for computing\n   pseudo-random numbers useful as nonces [8].\
    \  It inserts a new nonce\n   as the high-order 32 bits of the Identification\
    \ field of every\n   Registration Reply.  The home agent copies the low-order\
    \ 32 bits of\n   the Identification field from the Registration Request message\
    \ into\n   the low-order 32 bits of the Identification field in the Registration\n\
    \   Reply.  When the mobile node receives an authenticated Registration\n   Reply\
    \ from the home agent, it saves the high-order 32 bits of the\n   Identification\
    \ field for use as the high-order 32 bits of its next\n   Registration Request.\n\
    \   The mobile node is responsible for generating the low-order 32 bits\n   of\
    \ the Identification field in each Registration Request.  Ideally,\n   it should\
    \ generate its own random nonces.  However, it may use any\n   expedient method,\
    \ including duplication of the random value sent by\n   the home agent.  The method\
    \ chosen is of concern only to the mobile\n   node, because it is the node that\
    \ checks for valid values in the\n   Registration Reply.  The high-order and low-order\
    \ 32 bit values of\n   the identification chosen SHOULD both differ from their\
    \ previous\n   values.  The home agent uses a new high-order value, and the mobile\n\
    \   node uses a new low-order value for each registration message.  The\n   foreign\
    \ agent uses the low-order value (and the mobile host's home\n   address) to correctly\
    \ match registration replies with pending\n   Requests (Section 3.7.1).\n   If\
    \ a registration message is rejected because of an invalid nonce,\n   the Reply\
    \ always provides the mobile node with a new nonce to be used\n   in the next\
    \ registration.  Thus, the nonce protocol is self-\n   synchronizing.\n"
- title: 6.  IANA Considerations
  contents:
  - "6.  IANA Considerations\n   Mobile IP specifies several new number spaces for\
    \ values to be used\n   in various message fields.  These number spaces include\
    \ the\n   following:\n   o  Mobile IP message types sent to UDP port 434, as defined\
    \ in\n      Section 1.8.\n   o  types of extensions to Registration Request and\
    \ Registration Reply\n      messages (see Sections 3.3 and 3.4, and also consult\
    \ [12], [43],\n      [2], [3], and [7]).\n   o  values for the code in the Registration\
    \ Reply message (see Section\n      3.4, and also consult [12], [43], [2], [3],\
    \ and [7]).\n   o  Mobile IP defines so-called Agent Solicitation and Agent\n\
    \      Advertisement messages.  These messages are in fact Router\n      Discovery\
    \ messages [5] augmented with Mobile-IP-specific\n      extensions.  Thus, they\
    \ do not define a new name space, but do\n      define additional Router Discovery\
    \ extensions as described below\n      in Section 6.2.  Also see Section 2.1,\
    \ and consult [3] and [7].\n   There are additional Mobile IP numbering spaces\
    \ specified in [3].\n   Information about assignment of Mobile IP numbers derived\
    \ from\n   specifications external to this document is given by IANA at\n   http://www.iana.org/protocols.\
    \  From that URL, see the \"Mobile\n   Internet Protocol (IP) Numbers\" section.\n\
    \   In this revised specification, a new code value (for the field in the\n  \
    \ Registration Reply message) is needed within the range typically used\n   for\
    \ foreign agent messages.  This error code is needed to indicate\n   the status\
    \ \"Invalid Home Agent Address\".  See Section 3.7.2 for\n   details.\n"
- title: 6.1.  Mobile IP Message Types
  contents:
  - "6.1.  Mobile IP Message Types\n   Mobile IP messages are defined to be those\
    \ that are sent to a message\n   recipient at port 434 (UDP or TCP).  The number\
    \ space for Mobile IP\n   messages is specified in Section 1.8.  Approval of new\
    \ extension\n   numbers is subject to Expert Review, and a specification is required\n\
    \   [22].  The currently standardized message types have the following\n   numbers,\
    \ and are specified in the indicated sections.\n     Type  Name              \
    \                               Section\n     ----  --------------------------------------------\
    \     ---------\n     1     Registration Request                             3.3\n\
    \     3     Registration Reply                               3.4\n"
- title: 6.2.  Extensions to RFC 1256 Router Advertisement
  contents:
  - "6.2.  Extensions to RFC 1256 Router Advertisement\n   RFC 1256 defines two ICMP\
    \ message types, Router Advertisement and\n   Router Solicitation.  Mobile IP\
    \ defines a number space for extensions\n   to Router Advertisement, which could\
    \ be used by protocols other than\n   Mobile IP.  The extension types currently\
    \ standardized for use with\n   Mobile IP have the following numbers.\n     Type\
    \  Name                                             Section\n     ----  --------------------------------------------\
    \     ---------\n     0     One-byte Padding                                 2.1.3\n\
    \     16    Mobility Agent Advertisement                     2.1.1\n     19  \
    \  Prefix-Lengths                                   2.1.2\n   Approval of new\
    \ extension numbers for use with Mobile IP is subject\n   to Expert Review, and\
    \ a specification is required [22].\n"
- title: 6.3.  Extensions to Mobile IP Registration Messages
  contents:
  - "6.3.  Extensions to Mobile IP Registration Messages\n   The Mobile IP messages\
    \ specified within this document and listed in\n   Sections 1.8 and 6.1 may have\
    \ extensions.  Mobile IP message\n   extensions all share the same number space,\
    \ even if they are to be\n   applied to different Mobile IP messages.  The number\
    \ space for Mobile\n   IP message extensions is specified within this document.\
    \  Approval of\n   new extension numbers is subject to Expert Review, and a\n\
    \   specification is required [22].\n     Type  Name                         \
    \                    Section\n     ----  --------------------------------------------\
    \     ---------\n     0     One-byte Padding\n     32    Mobile-Home Authentication\
    \                       3.5.2\n     33    Mobile-Foreign Authentication      \
    \              3.5.3\n     34    Foreign-Home Authentication                 \
    \     3.5.4\n"
- title: 6.4.  Code Values for Mobile IP Registration Reply Messages
  contents:
  - "6.4.  Code Values for Mobile IP Registration Reply Messages\n   The Mobile IP\
    \ Registration Reply message, specified in Section 3.4,\n   has a Code field.\
    \  The number space for the Code field values is also\n   specified in Section\
    \ 3.4.  The Code number space is structured\n   according to whether the registration\
    \ was successful, the foreign\n   agent denied the Registration Request, or the\
    \ home agent denied the\n   Registration Request, as follows:\n   +---------+------------------------------------------------------+\n\
    \   | Code #s |                       Guideline                      |\n   +---------+------------------------------------------------------+\n\
    \   |   0-8   |                     Success Codes                    |\n   | \
    \        |                                                      |\n   |   9-63\
    \  | Allocation guidelines not specified in this document |\n   |         |  \
    \                                                    |\n   |  64-127 |       \
    \   Error Codes from the Foreign Agent          |\n   |         |            \
    \                                          |\n   | 128-192 |            Error\
    \ Codes from the Home Agent           |\n   |         |                      \
    \                                |\n   | 193-200 |    Error Codes from the Gateway\
    \ Foreign Agent [29]   |\n   |         |                                     \
    \                 |\n   | 201-255 | Allocation guidelines not specified in this\
    \ document |\n   +---------+------------------------------------------------------+\n\
    \         Approval of new code values requires Expert Review [22].\n         \
    \   Table 1:  Guidelines for Allocation of Code Values\n"
- title: 7.  Acknowledgments
  contents:
  - "7.  Acknowledgments\n   Special thanks to Steve Deering (Xerox PARC), along with\
    \ Dan Duchamp\n   and John Ioannidis (JI) (Columbia University), for forming the\n\
    \   working group, chairing it, and putting so much effort into its early\n  \
    \ development.  Columbia's early Mobile IP work can be found in [37],\n   [38],\
    \ [39].\n   Thanks also to Kannan Alaggapan, Greg Minshall, Tony Li, Jim Solomon,\n\
    \   Erik Nordmark, Basavaraj Patil, and Phil Roberts for their\n   contributions\
    \ to the group while performing the duties of\n   chairperson, as well as for\
    \ their many useful comments.\n   Thanks to the active members of the Mobile IP\
    \ Working Group,\n   particularly those who contributed text, including (in alphabetical\n\
    \   order)\n      Ran Atkinson (Naval Research Lab)\n      Samita Chakrabarti\
    \ (Sun Microsystems)\n      Ken Imboden (Candlestick Networks, Inc.)\n      Dave\
    \ Johnson (Carnegie Mellon University)\n      Frank Kastenholz (FTP Software)\n\
    \      Anders Klemets (KTH)\n      Chip Maguire (KTH)\n      Alison Mankin (ISI)\n\
    \      Andrew Myles (Macquarie University)\n      Thomas Narten (IBM)\n      Al\
    \ Quirt (Bell Northern Research)\n      Yakov Rekhter (IBM)\n      Fumio Teraoka\
    \ (Sony)\n      Alper Yegin (NTT DoCoMo)\n   Thanks to Charlie Kunzinger and to\
    \ Bill Simpson, the editors who\n   produced the first drafts of this document,\
    \ reflecting the\n   discussions of the working group.  Much of the new text in\
    \ the later\n   revisions preceding RFC 2002 is due to Jim Solomon and Dave Johnson.\n\
    \   Thanks to Greg Minshall (Novell), Phil Karn (Qualcomm), Frank\n   Kastenholz\
    \ (FTP Software), and Pat Calhoun (Sun Microsystems) for\n   their generous support\
    \ in hosting interim working group meetings.\n   Sections 1.10 and 1.11, which\
    \ specify new extension formats to be\n   used with aggregatable extension types,\
    \ were included from a\n   specification document (entitled \"Mobile IP Extensions\n\
    \   Rationalization (MIER)\", which was written by\n      Mohamed Khalil (Nortel\
    \ Networks)\n      Raja Narayanan (nVisible Networks)\n      Haseeb Akhtar (Nortel\
    \ Networks)\n      Emad Qaddoura (Nortel Networks)\n   Thanks to these authors,\
    \ and also for the additional work on MIER,\n   which was contributed by Basavaraj\
    \ Patil, Pat Calhoun, Neil\n   Justusson, N. Asokan, and Jouni Malinen.\n   Thanks\
    \ to Vijay Devarapalli, who put in many hours to convert the\n   source for this\
    \ text document into XML format.\n"
- title: 8.  References
  contents:
  - '8.  References

    '
- title: 8.1.  Normative References
  contents:
  - "8.1.  Normative References\n   [1]   Bradner, S., \"Key words for use in RFCs\
    \ to Indicate Requirement\n         Levels\", BCP 14, RFC 2119, March 1997.\n\
    \   [2]   Calhoun, P. and C. Perkins, \"Mobile IP Network Access\n         Identifier\
    \ Extension for IPv4\", RFC 2794, March 2000.\n   [3]   Perkins, C., Calhoun,\
    \ P., and J. Bharatia, \"Mobile IPv4\n         Challenge/Response Extensions (Revised)\"\
    , RFC 4721, January\n         2007.\n   [4]   Cong, D., Hamlen, M., and C. Perkins,\
    \ \"The Definitions of\n         Managed Objects for IP Mobility Support using\
    \ SMIv2\", RFC 2006,\n         October 1996.\n   [5]   Deering, S., Ed., \"ICMP\
    \ Router Discovery Messages\", RFC 1256,\n         September 1991.\n   [6]   Deering,\
    \ S., \"Host extensions for IP multicasting\", STD 5, RFC\n         1112, August\
    \ 1989.\n   [7]   Dommety, G. and K. Leung, \"Mobile IP Vendor/Organization-\n\
    \         Specific Extensions\", RFC 3115, April 2001.\n   [8]   Eastlake 3rd,\
    \ D., Schiller, J., and S. Crocker, \"Randomness\n         Requirements for Security\"\
    , BCP 106, RFC 4086, June 2005.\n   [9]   Kent, S., \"IP Authentication Header\"\
    , RFC 4302, December 2005.\n   [10]  Krawczyk, H., Bellare, M., and R. Canetti,\
    \ \"HMAC: Keyed-Hashing\n         for Message Authentication\", RFC 2104, February\
    \ 1997.\n   [11]  Mills, D., Martin, J., Ed., Burbank, J., and W. Kasch, \"Network\n\
    \         Time Protocol Version 4: Protocol and Algorithms\n         Specification\"\
    , RFC 5905, June 2010.\n   [12]  Montenegro, G., Ed., \"Reverse Tunneling for\
    \ Mobile IP,\n         revised\", RFC 3024, January 2001.\n   [13]  Farinacci,\
    \ D., Li, T., Hanks, S., Meyer, D., and P. Traina,\n         \"Generic Routing\
    \ Encapsulation (GRE)\", RFC 2784, March 2000.\n   [14]  Perkins, C., \"IP Encapsulation\
    \ within IP\", RFC 2003, October\n         1996.\n   [15]  Perkins, C., \"Minimal\
    \ Encapsulation within IP\", RFC 2004,\n         October 1996.\n   [16]  Plummer,\
    \ D., \"Ethernet Address Resolution Protocol: Or\n         Converting Network\
    \ Protocol Addresses to 48.bit Ethernet\n         Address for Transmission on\
    \ Ethernet Hardware\", STD 37, RFC\n         826, November 1982.\n   [17]  Postel,\
    \ J., \"User Datagram Protocol\", STD 6, RFC 768, August\n         1980.\n   [18]\
    \  Postel, J., \"Internet Protocol\", STD 5, RFC 791, September\n         1981.\n\
    \   [19]  Rivest, R., \"The MD5 Message-Digest Algorithm\", RFC 1321, April\n\
    \         1992.\n   [20]  Solomon, J., \"Applicability Statement for IP Mobility\
    \ Support\",\n         RFC 2005, October 1996.\n   [21]  Perkins, C., Ed., \"\
    IP Mobility Support for IPv4\", RFC 3344,\n         August 2002.\n   [22]  Narten,\
    \ T. and H. Alvestrand, \"Guidelines for Writing an IANA\n         Considerations\
    \ Section in RFCs\", BCP 26, RFC 5226, May 2008.\n"
- title: 8.2.  Informative References
  contents:
  - "8.2.  Informative References\n   [23]  Solomon, J. and S. Glass, \"Mobile-IPv4\
    \ Configuration Option for\n         PPP IPCP\", RFC 2290, February 1998.\n  \
    \ [24]  Montenegro, G., Dawkins, S., Kojo, M., Magret, V., and N.\n         Vaidya,\
    \ \"Long Thin Networks\", RFC 2757, January 2000.\n   [25]  Allman, M., Glover,\
    \ D., and L. Sanchez, \"Enhancing TCP Over\n         Satellite Channels using\
    \ Standard Mechanisms\", BCP 28, RFC\n         2488, January 1999.\n   [26]  Paxson,\
    \ V. and M. Allman, \"Computing TCP's Retransmission\n         Timer\", RFC 2988,\
    \ November 2000.\n   [27]  Levkowetz, H. and S. Vaarala, \"Mobile IP Traversal\
    \ of Network\n         Address Translation (NAT) Devices\", RFC 3519, April 2003.\n\
    \   [28]  Glass, S. and M. Chandra, \"Registration Revocation in Mobile\n    \
    \     IPv4\", RFC 3543, August 2003.\n   [29]  Fogelstroem, E., Jonsson, A., and\
    \ C. Perkins, \"Mobile IPv4\n         Regional Registration\", RFC 4857, June\
    \ 2007.\n   [30]  Bellovin, S., \"Security Problems in the TCP/IP Protocol Suite\"\
    ,\n         ACM Computer Communications Review, 19(2), March 1989.\n   [31]  Border,\
    \ J., Kojo, M., Griner, J., Montenegro, G., and Z.\n         Shelby, \"Performance\
    \ Enhancing Proxies Intended to Mitigate\n         Link-Related Degradations\"\
    , RFC 3135, June 2001.\n   [32]  Caceres, R. and L. Iftode, \"Improving the Performance\
    \ of\n         Reliable Transport Protocols in Mobile Computing Environments\"\
    ,\n         IEEE Journal on Selected Areas in Communication, 13(5):850-857,\n\
    \         June 1995.\n   [33]  Dawkins, S., Montenegro, G., Kojo, M., Magret,\
    \ V., and N.\n         Vaidya, \"End-to-end Performance Implications of Links\
    \ with\n         Errors\", BCP 50, RFC 3155, August 2001.\n   [34]  Droms, R.,\
    \ \"Dynamic Host Configuration Protocol\", RFC 2131,\n         March 1997.\n \
    \  [35]  Ferguson, P. and D. Senie, \"Network Ingress Filtering:\n         Defeating\
    \ Denial of Service Attacks which employ IP Source\n         Address Spoofing\"\
    , BCP 38, RFC 2827, May 2000.\n   [36]  Jacobson, V., \"Compressing TCP/IP Headers\
    \ for Low-Speed Serial\n         Links\", RFC 1144, February 1990.\n   [37]  Ioannidis,\
    \ J., Duchamp, D., and G. Maguire, \"IP-Based Protocols\n         for Mobile Internetworking\"\
    , In Proceedings of the SIGCOMM '01\n         Conference: Communications Architectures\
    \ and Protocols, pages\n         235-245, September 1991.\n   [38]  Ioannidis,\
    \ J. and G. Maguire, \"The Design and Implementation of\n         a Mobile Internetworking\
    \ Architecture\", In Proceedings of the\n         Winter USENIX Technical Conference,\
    \ pages 489-500, January\n         1993.\n   [39]  Ioannidis, J., \"Protocols\
    \ for Mobile Internetworking\", PhD\n         Dissertation - Columbia University\
    \ in the City of New York,\n         July 1993.\n   [40]  Jacobson, V., \"Congestion\
    \ Avoidance and Control\", In\n         Proceedings of the SIGCOMM '88 Workshop,\
    \ ACM SIGCOMM, ACM\n         Press, pages 314-329, August 1998.\n   [41]  McCloghrie,\
    \ K. and F. Kastenholz, \"The Interfaces Group MIB\",\n         RFC 2863, June\
    \ 2000.\n   [42]  McGregor, G., \"The PPP Internet Protocol Control Protocol\n\
    \         (IPCP)\", RFC 1332, May 1992.\n   [43]  Montenegro, G. and V. Gupta,\
    \ \"Sun's SKIP Firewall Traversal for\n         Mobile IP\", RFC 2356, June 1998.\n\
    \   [44]  Perkins, C., Ed., \"IP Mobility Support\", RFC 2002, October\n     \
    \    1996.\n   [45]  Stevens, R., \"TCP/IP Illustrated, Volume 1: The Protocols\"\
    ,\n         Addison-Wesley, Reading, Massachusetts, 1994.\n   [46]  Perkins, C.\
    \ and P. Calhoun, \"Authentication, Authorization, and\n         Accounting (AAA)\
    \ Registration Keys for Mobile IPv4\", RFC 3957,\n         March 2005.\n   [47]\
    \  Simpson, W., Ed., \"The Point-to-Point Protocol (PPP)\", STD 51,\n        \
    \ RFC 1661, July 1994.\n   [48]  IANA, \"Mobile IPv4 Numbers\", http://www.iana.org.\n\
    \   [49]  Postel, J., \"Multi-LAN address resolution\", RFC 925, October\n   \
    \      1984.\n   [50]  Perkins, C., Ed., \"IP Mobility Support for IPv4\", RFC\
    \ 3220,\n         January 2002.\n"
- title: Appendix A.  Link-Layer Considerations
  contents:
  - "Appendix A.  Link-Layer Considerations\n   The mobile node MAY use link-layer\
    \ mechanisms to decide that its\n   point of attachment has changed.  Such indications\
    \ include the Down/\n   Testing/Up interface status [41], and changes in cell\
    \ or\n   administration.  The mechanisms will be specific to the particular\n\
    \   link-layer technology, and are outside the scope of this document.\n   The\
    \ Point-to-Point-Protocol (PPP) [47] and its Internet Protocol\n   Control Protocol\
    \ (IPCP) [42] negotiate the use of IP addresses.\n   The mobile node SHOULD first\
    \ attempt to specify its home address, so\n   that if the mobile node is attaching\
    \ to its home network, the\n   unrouted link will function correctly.  When the\
    \ home address is not\n   accepted by the peer, but a transient IP address is\
    \ dynamically\n   assigned to the mobile node, and the mobile node is capable\
    \ of\n   supporting a co-located care-of address, the mobile node MAY register\n\
    \   that address as a co-located care-of address.  When the peer\n   specifies\
    \ its own IP address, that address MUST NOT be assumed to be\n   a foreign agent\
    \ care-of address or the IP address of a home agent.\n   PPP extensions for Mobile\
    \ IP have been specified in RFC 2290 [23].\n   Please consult that document for\
    \ additional details for how to handle\n   care-of address assignment from PPP\
    \ in a more efficient manner.\n"
- title: Appendix B.  TCP Considerations
  contents:
  - 'Appendix B.  TCP Considerations

    '
- title: B.1.  TCP Timers
  contents:
  - "B.1.  TCP Timers\n   When high-delay (e.g., SATCOM) or low-bandwidth (e.g., High-Frequency\n\
    \   Radio) links are in use, some TCP stacks may have insufficiently\n   adaptive\
    \ (non-standard) retransmission timeouts.  There may be\n   spurious retransmission\
    \ timeouts, even when the link and network are\n   actually operating properly,\
    \ but just with a high delay because of\n   the medium in use.  This can cause\
    \ an inability to create or maintain\n   TCP connections over such links, and\
    \ can also cause unneeded\n   retransmissions that consume already scarce bandwidth.\
    \  Vendors are\n   encouraged to follow the algorithms in RFC 2988 [26] when\n\
    \   implementing TCP retransmission timers.  Vendors of systems designed\n   for\
    \ low-bandwidth, high-delay links should consult RFCs 2757 and 2488\n   [24],\
    \ [25].  Designers of applications targeted to operate on mobile\n   nodes should\
    \ be sensitive to the possibility of timer-related\n   difficulties.\n"
- title: B.2.  TCP Congestion Management
  contents:
  - "B.2.  TCP Congestion Management\n   Mobile nodes often use media that are more\
    \ likely to introduce\n   errors, effectively causing more packets to be dropped.\
    \  This\n   introduces a conflict with the mechanisms for congestion management\n\
    \   found in modern versions of TCP [40].  Now, when a packet is dropped,\n  \
    \ the correspondent node's TCP implementation is likely to react as if\n   there\
    \ were a source of network congestion, and initiate the slow-\n   start mechanisms\
    \ [40] designed for controlling that problem.\n   However, those mechanisms are\
    \ inappropriate for overcoming errors\n   introduced by the links themselves,\
    \ and have the effect of magnifying\n   the discontinuity introduced by the dropped\
    \ packet.  This problem has\n   been analyzed by Caceres, et al. [32].  TCP approaches\
    \ to the problem\n   of handling errors that might interfere with congestion management\n\
    \   are discussed in documents from the PILC working group [31] [33].\n   While\
    \ such approaches are beyond the scope of this document, they\n   illustrate that\
    \ providing performance transparency to mobile nodes\n   involves understanding\
    \ mechanisms outside the network layer.\n   Problems introduced by higher media\
    \ error rates also indicate the\n   need to avoid designs that systematically\
    \ drop packets; such designs\n   might otherwise be considered favorably when\
    \ making engineering\n   tradeoffs.\n"
- title: Appendix C.  Example Scenarios
  contents:
  - "Appendix C.  Example Scenarios\n   This section shows example Registration Requests\
    \ for several common\n   scenarios.\n"
- title: C.1.  Registering with a Foreign Agent Care-of Address
  contents:
  - "C.1.  Registering with a Foreign Agent Care-of Address\n   The mobile node receives\
    \ an Agent Advertisement from a foreign agent\n   and wishes to register with\
    \ that agent using the advertised foreign\n   agent care-of address.  The mobile\
    \ node wishes only IP-in-IP\n   encapsulation, does not want broadcasts, and does\
    \ not want\n   simultaneous mobility bindings:\n        IP fields:\n         \
    \ Source Address = mobile node's home address\n          Destination Address =\
    \ copied from the IP source address of the\n            Agent Advertisement\n\
    \          Time to Live = 1\n        UDP fields:\n          Source Port = <any>\n\
    \          Destination Port = 434\n        Registration Request fields:\n    \
    \      Type = 1\n          S=0,B=0,D=0,M=0,G=0\n          Lifetime = the Registration\
    \ Lifetime copied from the\n            Mobility Agent Advertisement Extension\
    \ of the\n            Router Advertisement message\n          Home Address = the\
    \ mobile node's home address\n          Home Agent = IP address of mobile node's\
    \ home agent\n          Care-of Address = the Care-of Address copied from the\n\
    \            Mobility Agent Advertisement Extension of the\n            Router\
    \ Advertisement message\n          Identification = Network Time Protocol timestamp\
    \ or Nonce\n        Extensions:\n          An authorization-enabling extension\
    \ (e.g., the Mobile-Home\n            Authentication Extension)\n"
- title: C.2.  Registering with a Co-Located Care-of Address
  contents:
  - "C.2.  Registering with a Co-Located Care-of Address\n   The mobile node enters\
    \ a foreign network that contains no foreign\n   agents.  The mobile node obtains\
    \ an address from a DHCP server [34]\n   for use as a co-located care-of address.\
    \  The mobile node supports\n   all forms of encapsulation (IP-in-IP, minimal\
    \ encapsulation, and\n   GRE), desires a copy of broadcast datagrams on the home\
    \ network, and\n   does not want simultaneous mobility bindings:\n        IP fields:\n\
    \          Source Address = care-of address obtained from DHCP server\n      \
    \    Destination Address = IP address of home agent\n          Time to Live =\
    \ 64\n        UDP fields:\n          Source Port = <any>\n          Destination\
    \ Port = 434\n        Registration Request fields:\n          Type = 1\n     \
    \     S=0,B=1,D=1,M=1,G=1\n          Lifetime = 1800 (seconds)\n          Home\
    \ Address = the mobile node's home address\n          Home Agent = IP address\
    \ of mobile node's home agent\n          Care-of Address = care-of address obtained\
    \ from DHCP server\n          Identification = Network Time Protocol timestamp\
    \ or Nonce\n        Extensions:\n          The Mobile-Home Authentication Extension\n"
- title: C.3.  Deregistration
  contents:
  - "C.3.  Deregistration\n   The mobile node returns home and wishes to deregister\
    \ all care-of\n   addresses with its home agent:\n        IP fields:\n       \
    \   Source Address = mobile node's home address\n          Destination Address\
    \ = IP address of home agent\n          Time to Live = 1\n        UDP fields:\n\
    \          Source Port = <any>\n          Destination Port = 434\n        Registration\
    \ Request fields:\n          Type = 1\n          S=0,B=0,D=0,M=0,G=0\n       \
    \   Lifetime = 0\n          Home Address = the mobile node's home address\n  \
    \        Home Agent = IP address of mobile node's home agent\n          Care-of\
    \ Address = the mobile node's home address\n          Identification = Network\
    \ Time Protocol timestamp or Nonce\n        Extensions:\n          An authorization-enabling\
    \ extension (e.g., the Mobile-Home\n            Authentication Extension)\n"
- title: Appendix D.  Applicability of Prefix-Lengths Extension
  contents:
  - "Appendix D.  Applicability of Prefix-Lengths Extension\n   Caution is indicated\
    \ with the use of the Prefix-Lengths Extension\n   over wireless links, due to\
    \ the irregular coverage areas provided by\n   wireless transmitters.  As a result,\
    \ it is possible that two foreign\n   agents advertising the same prefix might\
    \ indeed provide different\n   connectivity to prospective mobile nodes.  The\
    \ Prefix-Lengths\n   Extension SHOULD NOT be included in the advertisements sent\
    \ by agents\n   in such a configuration.\n   Foreign agents using different wireless\
    \ interfaces would have to\n   cooperate using special protocols to provide identical\
    \ coverage in\n   space, and thus be able to claim to have wireless interfaces\
    \ situated\n   on the same subnetwork.  In the case of wired interfaces, a mobile\n\
    \   node disconnecting and subsequently connecting to a new point of\n   attachment\
    \ may well send in a new Registration Request no matter\n   whether the new advertisement\
    \ is on the same medium as the last\n   recorded advertisement.  And, finally,\
    \ in areas with dense\n   populations of foreign agents it would seem unwise to\
    \ require the\n   propagation via routing protocols of the subnet prefixes associated\n\
    \   with each individual wireless foreign agent; such a strategy could\n   lead\
    \ to quick depletion of available space for routing tables,\n   unwarranted increases\
    \ in the time required for processing routing\n   updates, and longer decision\
    \ times for route selection if routes\n   (which are almost always unnecessary)\
    \ are stored for wireless\n   \"subnets\".\n"
- title: Appendix E.  Interoperability Considerations
  contents:
  - "Appendix E.  Interoperability Considerations\n   This document specifies revisions\
    \ to RFC 2002 that are intended to\n   improve interoperability by resolving ambiguities\
    \ contained in the\n   earlier text.  Implementations that perform authentication\
    \ according\n   to the new more precisely specified algorithm would be interoperable\n\
    \   with earlier implementations that did what was originally expected\n   for\
    \ producing authentication data.  That was a major source of non-\n   interoperability\
    \ before.\n   However, this specification does have new features that, if used,\n\
    \   would cause interoperability problems with older implementations.\n   All\
    \ features specified in RFC 2002 will work with the new\n   implementations, except\
    \ for V-J compression [36].  The following list\n   details some of the possible\
    \ areas of compatibility problems that may\n   be experienced by nodes conforming\
    \ to this revised specification,\n   when attempting to interoperate with nodes\
    \ obeying RFC 2002.\n   o  A client that expects some of the newly mandatory features\
    \ (like\n      reverse tunneling) from a foreign agent (FA) would still be\n \
    \     interoperable as long as it pays attention to the 'T' bit.\n   o  Mobile\
    \ nodes (MNs) that use the NAI extension to identify\n      themselves would not\
    \ work with old mobility agents.\n   o  Mobile nodes that use a zero home address\
    \ and expect to receive\n      their home address in the Registration Reply would\
    \ not work with\n      old mobility agents.\n   o  Mobile nodes that attempt to\
    \ authenticate themselves without using\n      the Mobile-Home authentication\
    \ extension will be unable to\n      successfully register with their home agent.\n\
    \   In all of these cases, a robust and well-configured mobile node is\n   very\
    \ likely to be able to recover if it takes reasonable actions upon\n   receipt\
    \ of a Registration Reply with an error code indicating the\n   cause for rejection.\
    \  For instance, if a mobile node sends a\n   Registration Request that is rejected\
    \ because it contains the wrong\n   kind of authentication extension, then the\
    \ mobile node could retry\n   the registration with a mobile-home authentication\
    \ extension, since\n   the foreign agent and/or home agent in this case will not\
    \ be\n   configured to demand the alternative authentication data.\n"
- title: Appendix F.  Changes since RFC 3344
  contents:
  - "Appendix F.  Changes since RFC 3344\n   The following revisions to details of\
    \ the specification in this\n   document were made after RFC 3344 was published.\
    \  A list of changes\n   from RFC 2002 made during the development of RFC 3344\
    \ [21] may be\n   found in the latter document.  For items marked with issue numbers,\n\
    \   more information is available by consulting the MIP4 mailing list\n   archives.\n\
    \   o  Showed more bit definitions in the Agent Advertisement message\n      structure\
    \ (see Section 2.1.1).  New advertisement bits have been\n      defined by other\
    \ specification documents, but not reflected in\n      previous publications of\
    \ this specification; this has led to\n      confusion.  Citations for the other\
    \ specification documents have\n      also been included.\n   o  (Issue 6) The\
    \ behavior of the home agent was changed to avoid\n      mandating error replies\
    \ to Registration Requests that were\n      invalidated because the foreign agent\
    \ failed authentication.  The\n      intention is to make the home agent more\
    \ robust against Denial of\n      Service attacks in which the malicious device\
    \ has no intention of\n      providing a valid Registration Request but only wants\
    \ to congest\n      traffic on the home network.  See Section 3.8.2.1.\n   o \
    \ Due to non-unique assignment of IPv4 addresses in many domains, it\n      is\
    \ possible for different mobile nodes to have the same home\n      address.  If\
    \ they use the NAI, the foreign agent can still\n      distinguish them.  Language\
    \ was added to Section 3.7.1 and Section\n      3.7.3.1 to specify that the foreign\
    \ agent MUST use the NAI to\n      distinguish mobile nodes with the same home\
    \ address.\n   o  (Issue 45) Specified that a foreign agent MUST NOT apply a\n\
    \      Foreign-Home Authentication extension to a mobile node's\n      deregistration\
    \ request.  Also, the foreign agent MUST NOT apply a\n      Foreign-Home Authentication\
    \ extension unless the Care-of Address\n      in the Registration Request matches\
    \ an address advertised by the\n      foreign agent.\n   o  Specified that the\
    \ Mobility Security Association to be used by the\n      foreign agent and home\
    \ agent depends upon values contained in the\n      message data, not the IP headers.\n\
    \   o  (Issues 9, 18) Created a new error code for use by the foreign\n      agent,\
    \ for the case when the foreign agent does not serve the\n      mobile node as\
    \ a home agent.  Formerly, the foreign agent could\n      use an error Code of\
    \ 136 for this case.\n   o  (Issue 17) Specified that, if the home agent cannot\
    \ support the\n      requested nonzero unicast address in the Home Address field\
    \ of the\n      Registration Request, then it MUST reject the registration with\
    \ an\n      error Code of 129.  See Section 3.8.3.2.\n   o  (Issue 19) Specified\
    \ that multiple authorization-enabling\n      extensions may be present in the\
    \ Registration Request message, but\n      that the home agent has to (somehow)\
    \ ensure that all have been\n      checked (see Section 3.8.3.1).\n   o  (Issue\
    \ 20) Specified that the foreign agent SHOULD NOT modify any\n      of the fields\
    \ of the Registration Reply message that are covered\n      by the Mobile-Home\
    \ Authentication Extension, when it relays the\n      packet to the mobile node.\n\
    \   o  (Issue 21) Clarified that the foreign agent removes extensions\n      that\
    \ do not precede any authorization-enabling extension, not just\n      the Mobile-Home\
    \ Authentication extension (Section 3.7.3.2).\n   o  (Issue 44) Specified that\
    \ the address advertised by the foreign\n      agent in Agent Advertisements is\
    \ the care-of address offered on\n      that network interface, not necessarily\
    \ the address of the network\n      interface (Section 3.7.2.2).\n   o  (Issue\
    \ 45) Clarification in Section 3.7.2.1 that Code 77 can only\n      apply to a\
    \ Registration Request with nonzero Lifetime.\n   o  Created a new error code\
    \ for use when a foreign agent can detect\n      that the Home Agent address field\
    \ is incorrect.\n   o  Prohibited the use of the Foreign-Home Authorization Extension\
    \ on\n      deregistration messages.\n   o  Cleaned up some more wording having\
    \ to do with authorization-\n      enabling extensions.\n   o  For consistency,\
    \ changed some wording about copying UDP ports.\n   o  Added wording to clearly\
    \ not disallow dynamically configuring\n      netmask and security information\
    \ at the mobile node.\n   o  Revamped Changes section.\n   o  Updated citations.\n"
- title: Appendix G.  Example Messages
  contents:
  - 'Appendix G.  Example Messages

    '
- title: G.1.  Example ICMP Agent Advertisement Message Format
  contents:
  - "G.1.  Example ICMP Agent Advertisement Message Format\n     0               \
    \    1                   2                   3\n     0 1 2 3 4 5 6 7 8 9 0 1 2\
    \ 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |     Type      |     Code      |           Checksum            |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |   Num Addrs   |Addr Entry Size|           Lifetime            |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |                       Router Address[1]                       |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |                      Preference Level[1]                      |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |                       Router Address[2]                       |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |                      Preference Level[2]                      |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |                        ....                                   |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |   Type = 16   |     Length    |      Sequence Number          |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |    Registration Lifetime      |R|B|H|F|M|G|r|T|U|X|I|reserved |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |                     Care-of Address[1]                        |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |                     Care-of Address[2]                        |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |                         ....                                  |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    :                     Optional  Extensions                      :\n    :\
    \   ....                ......                      ......      :\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n"
- title: G.2.  Example Registration Request Message Format
  contents:
  - "G.2.  Example Registration Request Message Format\n   The UDP header is followed\
    \ by the Mobile IP fields shown below:\n     0                   1           \
    \        2                   3\n     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0\
    \ 1 2 3 4 5 6 7 8 9 0 1\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |     Type = 1  |S|B|D|M|G|r|T|x|          Lifetime             |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |                          Home Address                         |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |                           Home Agent                          |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |                        Care-of Address                        |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |                                                               |\n    +\
    \                         Identification                        +\n    |     \
    \                                                          |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |                Optional Non-Auth Extensions for HA ...        |\n    |\
    \                     ( variable length )                       |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |   Type = 32   |      Length   |           SPI                 |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |          SPI (cont.)          |                               |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\
    \                               |\n    :         MN-HA Authenticator ( variable\
    \ length )               :\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    :           Optional  Non-Auth Extensions for FA .........\n    :       \
    \    Optional  MN-FA  Authentication Extension...\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n"
- title: G.3.  Example Registration Reply Message Format
  contents:
  - "G.3.  Example Registration Reply Message Format\n   The UDP header is followed\
    \ by the Mobile IP fields shown below:\n     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6\
    \ 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |   Type = 3    |     Code      |           Lifetime            |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |                          Home Address                         |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |                           Home Agent                          |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |                                                               |\n    +\
    \                         Identification                        +\n    |     \
    \                                                          |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |                 Optional  HA  Non-Auth Extensions ...         |\n    |\
    \                     ( variable length )                       |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |   Type = 32   |      Length   |           SPI                 |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    |          SPI (cont.)          |                               |\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\
    \                               |\n    :         MN-HA Authenticator ( variable\
    \ length )               :\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \    :           Optional  Extensions used by FA.........\n    :           Optional\
    \  MN-FA Authentication Extension...\n    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n"
- title: Author's Address
  contents:
  - "Author's Address\n   Charles E. Perkins (editor)\n   WiChorus Inc.\n   3590 N.\
    \ 1st Street, Suite 300\n   San Jose, CA  95134\n   USA\n   EMail: charliep@computer.org\n"
