- title: __initial_text__
  contents:
  - '                      Router Renumbering for IPv6

    '
- title: Status of this Memo
  contents:
  - "Status of this Memo\n   This document specifies an Internet standards track protocol\
    \ for the\n   Internet community, and requests discussion and suggestions for\n\
    \   improvements.  Please refer to the current edition of the \"Internet\n   Official\
    \ Protocol Standards\" (STD 1) for the standardization state\n   and status of\
    \ this protocol.  Distribution of this memo is unlimited.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (C) The Internet Society (2000).  All Rights Reserved.\n\
    \   This document defines mechanisms for informing a set of routers of\n   renumbering\
    \ operations they are to perform, including a mode of\n   operation in environments\
    \ in which the exact number of routers is\n   unknown. Reliably informing all\
    \ routers when the actual number of\n   routers is unknown is a difficult problem.\
    \ Implementation and\n   operational experience will be needed to fully understand\
    \ the\n   applicabilty and scalability aspects of the mechanisms defined in\n\
    \   this document when the number of routers is unknown.\n"
- title: Abstract
  contents:
  - "Abstract\n   IPv6 Neighbor Discovery and Address Autoconfiguration conveniently\n\
    \   make initial assignments of address prefixes to hosts.  Aside from\n   the\
    \ problem of connection survival across a renumbering event, these\n   two mechanisms\
    \ also simplify the reconfiguration of hosts when the\n   set of valid prefixes\
    \ changes.\n   This document defines a mechanism called Router Renumbering (\"\
    RR\")\n   which allows address prefixes on routers to be configured and\n   reconfigured\
    \ almost as easily as the combination of Neighbor\n   Discovery and Address Autoconfiguration\
    \ works for hosts.  It provides\n   a means for a network manager to make updates\
    \ to the prefixes used by\n   and advertised by IPv6 routers throughout a site.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1.  Functional Overview .......................................\
    \    2\n   2.  Definitions ...............................................   \
    \ 4\n       2.1.  Terminology .........................................    4\n\
    \       2.2.  Requirements ........................................    5\n   3.\
    \  Message Format ............................................    5\n       3.1.\
    \  Router Renumbering Header ...........................    7\n       3.2.  Message\
    \ Body -- Command Message .....................    9\n           3.2.1.  Prefix\
    \ Control Operation ......................    9\n               3.2.1.1.  Match-Prefix\
    \ Part .......................    9\n               3.2.1.2.  Use-Prefix Part\
    \ .........................   11\n       3.3.  Message Body -- Result Message\
    \ ......................   12\n   4.  Message Processing ........................................\
    \   14\n       4.1.  Header Check ........................................   14\n\
    \       4.2.  Bounds Check ........................................   15\n   \
    \    4.3.  Execution ...........................................   16\n      \
    \ 4.4.  Summary of Effects ..................................   17\n   5.  Sequence\
    \ Number Reset .....................................   18\n   6.  IANA Considerations\
    \ .......................................   19\n   7.  Security Considerations\
    \ ...................................   19\n       7.1.  Security Policy and Association\
    \ Database Entries ....   19\n   8.  Implementation and Usage Advice for Reliability\
    \ ...........   20\n       8.1.  Outline and Definitions .............................\
    \   21\n       8.2.  Computations ........................................   23\n\
    \       8.3.  Additional Assurance Methods ........................   24\n   9.\
    \  Usage Examples ............................................   25\n       9.1.\
    \  Maintaining Global-Scope Prefixes ...................   25\n       9.2.  Renumbering\
    \ a Subnet ................................   26\n   10.  Acknowledgments ..........................................\
    \   27\n   11.  References ...............................................   28\n\
    \   12.  Author's Address .........................................   29\n   Appendix\
    \ -- Derivation of Reliability Estimates ...............   30\n   Full Copyright\
    \ Statement ......................................   32\n"
- title: 1.  Functional Overview
  contents:
  - "1.  Functional Overview\n   Router Renumbering Command packets contain a sequence\
    \ of Prefix\n   Control Operations (PCOs).  Each PCO specifies an operation, a\n\
    \   Match-Prefix, and zero or more Use-Prefixes.  A router processes each\n  \
    \ PCO in sequence, checking each of its interfaces for an address or\n   prefix\
    \ which matches the Match-Prefix.  For every interface on which\n   a match is\
    \ found, the operation is applied.  The operation is one of\n   ADD, CHANGE, or\
    \ SET-GLOBAL to instruct the router to respectively add\n   the Use-Prefixes to\
    \ the set of configured prefixes, remove the prefix\n   which matched the Match-Prefix\
    \ and replace it with the Use-Prefixes,\n   or replace all global-scope prefixes\
    \ with the Use-Prefixes.  If the\n   set of Use-Prefixes in the PCO is empty,\
    \ the ADD operation does\n   nothing and the other two reduce to deletions.\n\
    \   Additional information for each Use-Prefix is included in the Prefix\n   Control\
    \ Operation: the valid and preferred lifetimes to be included\n   in Router Advertisement\
    \ Prefix Information Options [ND], and either\n   the L and A flags for the same\
    \ option, or an indication that they are\n   to be copied from the prefix that\
    \ matched the Match-Prefix.\n   It is possible to instruct routers to create new\
    \ prefixes by\n   combining the Use-Prefixes in a PCO with some portion of the\
    \ existing\n   prefix which matched the Match-Prefix.  This simplifies certain\n\
    \   operations which are expected to be among the most common.  For every\n  \
    \ Use-Prefix, the PCO specifies a number of bits which should be copied\n   from\
    \ the existing address or prefix which matched the Match-Prefix\n   and appended\
    \ to the use-prefix prior to configuring the new prefix on\n   the interface.\
    \  The copied bits are zero or more bits from the\n   positions immediately after\
    \ the length of the Use- Prefix.  If\n   subnetting information is in the same\
    \ portion of the old and new\n   prefixes, this synthesis allows a single Prefix\
    \ Control Operation to\n   define a new global prefix on every router in a site,\
    \ while\n   preserving the subnetting structure.\n   Because of the power of the\
    \ Router Renumbering mechanism, each RR\n   message includes a sequence number\
    \ to guard against replays, and is\n   required to be authenticated and integrity-checked.\
    \  Each single\n   Prefix Control Operation is idempotent and so could be retransmitted\n\
    \   for improved reliability, as long as the sequence number is current,\n   without\
    \ concern about multiple processing.  However, non-idempotent\n   combinations\
    \ of PCOs can easily be constructed and messages\n   containing such combinations\
    \ could not be safely reprocessed.\n   Therefore, all routers are required to\
    \ guard against processing an RR\n   message more than once.  To allow reliable\
    \ verification that Commands\n   have been received and processed by routers,\
    \ a mechanism for\n   duplicate-command notification to the management station\
    \ is included.\n   Possibly a network manager will want to perform more renumbering,\
    \ or\n   exercise more detailed control, than can be expressed in a single\n \
    \  Router Renumbering packet on the available media.  The RR mechanism\n   is\
    \ most powerful when RR packets are multicast, so IP fragmentation\n   is undesirable.\
    \  For these reasons, each RR packet contains a\n   \"Segment Number\".  All RR\
    \ packets which have a Sequence Number\n   greater than or equal to the highest\
    \ value seen are valid and must be\n   processed.  However, a router must keep\
    \ track of the Segment Numbers\n   of RR messages already processed and avoid\
    \ reprocessing a message\n   whose Sequence Number and Segment Number match a\
    \ previously processed\n   message.  (This list of processed segment numbers is\
    \ reset when a new\n   highest Sequence Number is seen.)\n   The Segment Number\
    \ does not impose an ordering on packet processing.\n   If a specific sequence\
    \ of operations is desired, it may be achieved\n   by ordering the PCOs in a single\
    \ RR Command message or through the\n   Sequence Number field.\n   There is a\
    \ \"Test\" flag which indicates that all routers should\n   simulate processing\
    \ of the RR message and not perform any actual\n   reconfiguration.  A separate\
    \ \"Report\" flag instructs routers to send\n   a Router Renumbering Result message\
    \ back to the source of the RR\n   Command message indicating the actual or simulated\
    \ result of the\n   operations in the RR Command message.\n   The effect or simulated\
    \ effect of an RR Command message may also be\n   reported to network management\
    \ by means outside the scope of this\n   document, regardless of the value of\
    \ the \"Report\" flag.\n"
- title: 2.  Definitions
  contents:
  - '2.  Definitions

    '
- title: 2.1.  Terminology
  contents:
  - "2.1.  Terminology\n   Address\n      This term always refers to a 128-bit IPv6\
    \ address [AARCH].  When\n      referring to bits within an address, they are\
    \ numbered from 0 to\n      127, with bit 0 being the first bit of the Format\
    \ Prefix.\n   Prefix\n      A prefix can be understood as an address plus a length,\
    \ the latter\n      being an integer in the range 0 to 128 indicating how many\
    \ leading\n      bits are significant.  When referring to bits within a prefix,\n\
    \      they are numbered in the same way as the bits of an address.  For\n   \
    \   example, the significant bits of a prefix whose length is L are\n      the\
    \ bits numbered 0 through L-1, inclusive.\n   Match\n      An address A \"matches\"\
    \ a prefix P whose length is L if the first L\n      bits of A are identical with\
    \ the first L bits of P.  (Every\n      address matches a prefix of length 0.)\
    \  A prefix P1 with length L1\n      matches a prefix P2 of length L2 if L1 >=\
    \ L2 and the first L2 bits\n      of P1 and P2 are identical.\n   Prefix Control\
    \ Operation\n      This is the smallest individual unit of Router Renumbering\n\
    \      operation.  A Router Renumbering Command packet includes zero or\n    \
    \  more of these, each comprising one matching condition, called a\n      Match-Prefix\
    \ Part, and zero or more substitution specifications,\n      called Use-Prefix\
    \ Parts.\n   Match-Prefix\n      This is a Prefix against which a router compares\
    \ the addresses and\n      prefixes configured on its interfaces.\n   Use-Prefix\n\
    \      The prefix and associated information which is to be configured on\n  \
    \    a router interface when certain conditions are met.\n   Matched Prefix\n\
    \      The existing prefix or address which matched a Match-Prefix.\n   New Prefix\n\
    \      A prefix constructed from a Use-Prefix, possibly including some of\n  \
    \    the Matched Prefix.\n   Recorded Sequence Number\n      The highest sequence\
    \ number found in a valid message MUST be\n      recorded in non-volatile storage.\n\
    \      Note that \"matches\" is a transitive relation but not symmetric.\n   \
    \   If two prefixes match each other, they are identical.\n"
- title: 2.2.  Requirements
  contents:
  - "2.2.  Requirements\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\", \"\
    SHALL\", \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"MAY\"\
    , and \"OPTIONAL\" in this\n   document are to be interpreted as described in\
    \ [KWORD].\n"
- title: 3.  Message Format
  contents:
  - "3.  Message Format\n   There are two types of Router Renumbering messages: Commands,\
    \ which\n   are sent to routers, and Results, which are sent by routers.  A third\n\
    \   message type is used to synchronize a reset of the Recorded Sequence\n   Number\
    \ with the cancellation of cryptographic keys.  The three types\n   of messages\
    \ are distinguished the ICMPv6 \"Code\" field and differ in\n   the contents of\
    \ the \"Message Body\" field.\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                                                               |\n   /  \
    \              IPv6 header, extension headers                 /\n   |        \
    \                                                       |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                                                               |\n   /  \
    \               ICMPv6 & RR Header (16 octets)                /\n   |        \
    \                                                       |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                                                               |\n   /  \
    \                     RR Message Body                         /\n   |        \
    \                                                       |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \                 Router Renumbering Message Format\n   Router Renumbering messages\
    \ are carried in ICMPv6 packets with Type =\n   138.  The RR message comprises\
    \ an RR Header, containing the ICMPv6\n   header, the sequence and segment numbers\
    \ and other information, and\n   the RR Message Body, of variable length.\n  \
    \ All fields marked \"reserved\" or \"res\" MUST be set to zero on\n   generation\
    \ of an RR message, and ignored on receipt.\n   All implementations which generate\
    \ Router Renumbering Command\n   messages MUST support sending them to the All\
    \ Routers multicast\n   address with link and site scopes, and to unicast addresses\
    \ of link-\n   local and site-local formats.  All routers MUST be capable of\n\
    \   receiving RR Commands sent to those multicast addresses and to any of\n  \
    \ their link local and site local unicast addresses.  Implementations\n   SHOULD\
    \ support sending and receiving RR messages addressed to other\n   unicast addresses.\
    \  An implementation which is both a sender and\n   receiver of RR commands SHOULD\
    \ support use of the All Routers\n   multicast address with node scope.\n   Data\
    \ authentication and message integrity MUST be provided for all\n   Router Renumbering\
    \ Command messages by appropriate IP Security\n   [IPSEC] means.  The integrity\
    \ assurance must include the IPv6\n   destination address and the RR Header and\
    \ Message Body.  See section\n   7, \"Security Considerations\".\n   The use of\
    \ authentication for Router Renumbering Result messages is\n   RECOMMENDED.\n"
- title: 3.1.  Router Renumbering Header
  contents:
  - "3.1.  Router Renumbering Header\n    0                   1                  \
    \ 2                   3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4\
    \ 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |     Type      |     Code      |            Checksum           |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                        SequenceNumber                         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   | SegmentNumber |     Flags     |            MaxDelay           |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                           reserved                            |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   Fields:\n   Type        138 (decimal), the ICMPv6 type value assigned to Router\n\
    \               Renumbering\n   Code          0 for a Router Renumbering Command\n\
    \                 1 for a Router Renumbering Result\n               255 for a\
    \ Sequence Number Reset.\n               The Sequence Number Reset is described\
    \ in section 5.\n   Checksum    The ICMPv6 checksum, as specified in [ICMPV6].\
    \  The\n               checksum covers the IPv6 pseudo-header and all fields of\n\
    \               the RR message from the Type field onward.\n   SequenceNumber\n\
    \               An unsigned 32-bit sequence number.  The sequence number\n   \
    \            MUST be non-decreasing between Sequence Number Resets.\n   SegmentNumber\n\
    \               An unsigned 8-bit field which enumerates different valid\n   \
    \            RR messages having the same SequenceNumber.  No ordering\n      \
    \         among RR messages is imposed by the SegmentNumber.\n   Flags       A\
    \ combination of one-bit flags.  Five are defined and\n               three bits\
    \ are reserved.\n                                  +-+-+-+-+-+-+-+-+\n       \
    \                           |T|R|A|S|P| res |\n                              \
    \    +-+-+-+-+-+-+-+-+\n              The flags T, R, A and S have defined meanings\
    \ in an RR\n              Command message.  In a Result message they MUST be\n\
    \              copied from the corresponding Command.  The P flag is\n       \
    \       meaningful only in a Result message and MUST be zero in\n            \
    \  a transmitted Command and ignored in a received Command.\n              T \
    \  Test command --\n                  0 indicates that the router configuration\
    \ is to be\n                    modified;\n                  1 indicates a \"\
    Test\" message: processing is to be\n                    simulated and no configuration\
    \ changes are to be\n                    made.\n              R   Result requested\
    \ --\n                  0 indicates that a Result message MUST NOT be sent\n \
    \                   (but other forms of logging are not precluded);\n        \
    \          1 indicates that the router MUST send a Result\n                  \
    \  message upon completion of processing the Command\n                    message;\n\
    \              A   All interfaces --\n                  0 indicates that the Command\
    \ MUST NOT be applied to\n                    interfaces which are administratively\
    \ shut down;\n                  1 indicates that the Command MUST be applied to\
    \ all\n                    interfaces regardless of administrative shutdown\n\
    \                    status.\n              S   Site-specific -- This flag MUST\
    \ be ignored unless\n                  the router treats interfaces as belonging\
    \ to\n                  different \"sites\".\n                  0 indicates that\
    \ the Command MUST be applied to\n                    interfaces regardless of\
    \ which site they belong\n                    to;\n                  1 indicates\
    \ that the Command MUST be applied only to\n                    interfaces which\
    \ belong to the same site as the\n                    interface to which the Command\
    \ is addressed.  If\n                    the destination address is appropriate\
    \ for\n                    interfaces belonging to more than one site, then\n\
    \                    the Command MUST be applied only to interfaces\n        \
    \            belonging to the same site as the interface on\n                \
    \    which the Command was received.\n              P   Processed previously --\n\
    \                  0 indicates that the Result message contains the\n        \
    \            complete report of processing the Command;\n                  1 indicates\
    \ that the Command message was previously\n                    processed (and\
    \ is not a Test) and the responding\n                    router is not processing\
    \ it again.  This Result\n                    message MAY have an empty body.\n\
    \   MaxDelay   An unsigned 16-bit field specifying the maximum time, in\n    \
    \          milliseconds, by which a router MUST delay sending any\n          \
    \    reply to this Command.  Implementations MAY generate the\n              random\
    \ delay between 0 and MaxDelay milliseconds with a\n              finer granularity\
    \ than 1ms.\n"
- title: 3.2.  Message Body -- Command Message
  contents:
  - "3.2.  Message Body -- Command Message\n   The body of an RR Command message is\
    \ a sequence of zero or more\n   Prefix Control Operations, each of variable length.\
    \  The end of the\n   sequence MAY be inferred from the IPv6 length and the lengths\
    \ of\n   extension headers which precede the ICMPv6 header.\n"
- title: 3.2.1.  Prefix Control Operation
  contents:
  - "3.2.1.  Prefix Control Operation\n   A Prefix Control Operation has one Match-Prefix\
    \ Part of 24 octets,\n   followed by zero or more Use-Prefix Parts of 32 octets\
    \ each.\n"
- title: 3.2.1.1.  Match-Prefix Part
  contents:
  - "3.2.1.1.  Match-Prefix Part\n    0                   1                   2  \
    \                 3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6\
    \ 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |    OpCode     |   OpLength    |    Ordinal    |   MatchLen    |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |    MinLen     |    MaxLen     |           reserved            |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                                                               |\n   +- \
    \                                                            -+\n   |        \
    \                                                       |\n   +-             \
    \            MatchPrefix                         -+\n   |                    \
    \                                           |\n   +-                         \
    \                                    -+\n   |                                \
    \                               |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   Fields:\n   OpCode      An unsigned 8-bit field specifying the operation to\
    \ be\n               performed when the associated MatchPrefix matches an\n  \
    \             interface's prefix or address.  Values are:\n               1  \
    \  the ADD operation\n               2    the CHANGE operation\n             \
    \  3    the SET-GLOBAL operation\n   OpLength    The total length of this Prefix\
    \ Control Operation, in\n               units of 8 octets.  A valid OpLength will\
    \ always be of\n               the form 4N+3, with N equal to the number of UsePrefix\n\
    \               parts (possibly zero).\n   Ordinal     An 8-bit field which MUST\
    \ have a different value in each\n               Prefix Control Operation contained\
    \ in a given RR Command\n               message.  The value is otherwise unconstrained.\n\
    \   MatchLen    An 8-bit unsigned integer between 0 and 128 inclusive\n      \
    \         specifying the number of initial bits of MatchPrefix\n             \
    \  which are significant in matching.\n   MinLen      An 8-bit unsigned integer\
    \ specifying the minimum length\n               which any configured prefix must\
    \ have in order to be\n               eligible for testing against the MatchPrefix.\n\
    \   MaxLen      An 8-bit unsigned integer specifying the maximum length\n    \
    \           which any configured prefix may have in order to be\n            \
    \   eligible for testing against the MatchPrefix.\n   MatchPrefix The 128-bit\
    \ prefix to be compared with each interface's\n               prefix or address.\n"
- title: 3.2.1.2.  Use-Prefix Part
  contents:
  - "3.2.1.2.  Use-Prefix Part\n    0                   1                   2    \
    \               3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7\
    \ 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |    UseLen     |    KeepLen    |   FlagMask    |    RAFlags    |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                        Valid Lifetime                         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                      Preferred Lifetime                       |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |V|P|                         reserved                          |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                                                               |\n   +- \
    \                                                            -+\n   |        \
    \                                                       |\n   +-             \
    \             UsePrefix                          -+\n   |                    \
    \                                           |\n   +-                         \
    \                                    -+\n   |                                \
    \                               |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   Fields:\n   UseLen      An 8-bit unsigned integer less than or equal to 128\n\
    \               specifying the number of initial bits of UsePrefix to\n      \
    \         use in creating a new prefix for an interface.\n   KeepLen     An 8-bit\
    \ unsigned integer less than or equal to (128-\n               UseLen) specifying\
    \ the number of bits of the prefix or\n               address which matched the\
    \ associated Match-Prefix which\n               should be retained in the new\
    \ prefix.  The retained bits\n               are those at positions UseLen through\
    \ (UseLen+KeepLen-1)\n               in the matched address or prefix, and they\
    \ are copied to\n               the same positions in the New Prefix.\n   FlagMask\
    \    An 8-bit mask.  A 1 bit in any position means that the\n               corresponding\
    \ flag bit in a Router Advertisement (RA)\n               Prefix Information Option\
    \ for the New Prefix should be\n               set from the RAFlags field in this\
    \ Use-Prefix Part.  A 0\n               bit in the FlagMask means that the RA\
    \ flag bit for the\n               New Prefix should be copied from the corresponding\
    \ RA\n               flag bit of the Matched Prefix.\n   RAFlags     An 8 bit\
    \ field which, under control of the FlagMask\n               field, may be used\
    \ to initialize the flags in Router\n               Advertisement Prefix Information\
    \ Options [ND] which\n               advertise the New Prefix.  Note that only\
    \ two flags have\n               defined meanings to date: the L (on-link) and\
    \ A\n               (autonomous configuration) flags.  These flags occupy\n  \
    \             the two leftmost bit positions in the RAFlags field,\n         \
    \      corresponding to their position in the Prefix\n               Information\
    \ Option.\n   Valid Lifetime\n               A 32-bit unsigned integer which is\
    \ the number of seconds\n               for which the New Prefix will be valid\
    \ [ND, SAA].\n   Preferred Lifetime\n               A 32-bit unsigned integer\
    \ which is the number of seconds\n               for which the New Prefix will\
    \ be preferred [ND, SAA].\n   V           A 1-bit flag indicating that the valid\
    \ lifetime of the\n               New Prefix MUST be effectively decremented in\
    \ real time.\n   P           A 1-bit flag indicating that the preferred lifetime\
    \ of\n               the New Prefix MUST be effectively decremented in real\n\
    \               time.\n   UsePrefix   The 128-bit Use-prefix which either becomes\
    \ or is used\n               in forming (if KeepLen is nonzero) the New Prefix.\
    \  It\n               MUST NOT have the form of a multicast or link-local\n  \
    \             address [AARCH].\n"
- title: 3.3.  Message Body -- Result Message
  contents:
  - "3.3.  Message Body -- Result Message\n   The body of an RR Result message is\
    \ a sequence of zero or more Match\n   Reports of 24 octets.  An RR Command message\
    \ with the \"R\" flag set\n   will elicit an RR Result message containing one\
    \ Match Report for each\n   Prefix Control Operation, for each different prefix\
    \ it matches on\n   each interface.  The Match Report has the following format.\n\
    \    0                   1                   2                   3\n    0 1 2\
    \ 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |         reserved          |B|F|    Ordinal    |  MatchedLen   |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                         InterfaceIndex                        |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                                                               |\n   +- \
    \                                                            -+\n   |        \
    \                                                       |\n   +-             \
    \           MatchedPrefix                        -+\n   |                    \
    \                                           |\n   +-                         \
    \                                    -+\n   |                                \
    \                               |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   Fields:\n   B           A one-bit flag which, when set, indicates that one\
    \ or\n               more fields in the associated PCO were out of bounds.\n \
    \              The bounds check is described in section 4.2.\n   F           A\
    \ one-bit flag which, when set, indicates that one or\n               more Use-Prefix\
    \ parts from the associated PCO were not\n               honored by the router\
    \ because of attempted formation of\n               a forbidden prefix format,\
    \ such as a multicast or\n               loopback address.\n   Ordinal     Copied\
    \ from the Prefix Control Operation whose\n               MatchPrefix matched\
    \ the MatchedPrefix on the interface\n               indicated by InterfaceIndex.\n\
    \   MatchedLen  The length of the Matched Prefix.\n   InterfaceIndex\n       \
    \        The router's numeric designation of the interface on\n              \
    \ which the MatchedPrefix was configured.  This MUST be\n               the same\
    \ as the value of ipv6IfIndex which designates\n               that index in the\
    \ SNMP IPv6 MIB General Group [IPV6MIB].\n   It is possible for a Result message\
    \ to be larger than the Command\n   message which elicited it.  Such a Result\
    \ message may have to be\n   fragmented for transmission.  If so, it SHOULD be\
    \ fragmented to the\n   IPv6 minimum required MTU [IPV6].\n"
- title: 4.  Message Processing
  contents:
  - "4.  Message Processing\n   Processing of received Router Renumbering Result messages\
    \ is entirely\n   implementation-defined.  Implementation of Command message processing\n\
    \   may vary in detail from the procedure set forth below, so long as the\n  \
    \ result is not affected.\n   Processing of received Router Renumbering Command\
    \ messages consists\n   of three conceptual parts: header check, bounds check,\
    \ and execution.\n"
- title: 4.1.  Header Check
  contents:
  - "4.1.  Header Check\n   The ICMPv6 checksum and type are presumed to have been\
    \ checked before\n   a Router Renumbering module receives a Command to process.\
    \  In an\n   implementation environment where this may not be the case, those\n\
    \   checks MUST be made at this point in the processing.\n   If the ICMPv6 length\
    \ derived from the IPv6 length is less than 16\n   octets, the message MUST be\
    \ discarded and SHOULD be logged to network\n   management.\n   If the ICMPv6\
    \ Code field indicates a Result message, a router which\n   is not a source of\
    \ RR Command messages MUST discard the message and\n   SHOULD NOT log it to network\
    \ management.\n   If the IPv6 destination address is neither an All Routers multicast\n\
    \   address [AARCH] nor one of the receiving router's unicast addresses,\n   the\
    \ message MUST be discarded and SHOULD be logged to network\n   management.\n\
    \   Next, the SequenceNumber is compared to the Recorded Sequence Number.\n  \
    \ (If no RR messages have been received and accepted since system\n   initialization,\
    \ the Recorded Sequence Number is zero.)  This\n   comparison is done with the\
    \ two numbers considered as unsigned\n   integers, not as DNS-style serial numbers.\
    \  If the SequenceNumber is\n   less than the Recorded Sequence Number, the message\
    \ MUST be discarded\n   and SHOULD be logged to network management.\n   Finally,\
    \ if the SequenceNumber in the message is greater than the\n   Recorded Sequence\
    \ Number or the T flag is set, skip to the bounds\n   check.  Otherwise the SegmentNumber\
    \ MUST now be checked.  If a\n   correctly authenticated message with the same\
    \ SequenceNumber and\n   SegmentNumber has not already been processed, skip to\
    \ the bounds\n   check.  Otherwise, this Command is a duplicate and not a Test\n\
    \   Command.  If the R flag is not set, the duplicate message MUST be\n   discarded\
    \ and SHOULD NOT be logged to network management.  If R is\n   set, an RR Result\
    \ message with the P flag set MUST be scheduled for\n   transmission to the source\
    \ address of the Command after a random time\n   uniformly distributed between\
    \ 0 and MaxDelay milliseconds.  The body\n   of that Result message MUST either\
    \ be empty or be a saved copy of the\n   Result message body generated by processing\
    \ of the previous message\n   with the same SequenceNumber and SegmentNumber.\
    \  After scheduling the\n   Result message, the Command MUST be discarded without\
    \ further\n   processing.\n"
- title: 4.2.  Bounds Check
  contents:
  - "4.2.  Bounds Check\n   If the SequenceNumber is greater than the Recorded Sequence\
    \ Number,\n   then the list of processed SegmentNumbers and the set of saved Result\n\
    \   messages, if any, MUST be cleared and the Recorded Sequence Number\n   MUST\
    \ be updated to the value used in the current message, regardless\n   of subsequent\
    \ processing errors.\n   Next, if the ICMPv6 Code field indicates a Sequence Number\
    \ Reset,\n   skip to section 5.\n   At this point, if T is set in the RR header\
    \ and R is not set, the\n   message MAY be discarded without further processing.\n\
    \   If the R flag is set, begin constructing an RR Result message.  The\n   RR\
    \ header of the Result message is completely determined at this time\n   except\
    \ for the Checksum.\n   The values of the following fields of a PCO MUST be checked\
    \ to ensure\n   that they are within the appropriate bounds.\n   OpCode      must\
    \ be a defined value.\n   OpLength    must be of the form 4N+3 and consistent\
    \ the the length\n               of the Command packet and the PCO's offset within\
    \ the\n               packet.\n   MatchLen    must be between 0 and 128 inclusive\n\
    \   UseLen, KeepLen\n               in each Use-Prefix Part must be between 0\
    \ and 128\n               inclusive, as must the sum of the two.\n   If any of\
    \ these fields are out of range in a PCO, the entire PCO MUST\n   NOT be performed\
    \ on any interface.  If the R flag is set in the RR\n   header then add to the\
    \ RR Result message a Match Report with the B\n   flag set, the F flag clear,\
    \ the Ordinal copied from the PCO, and all\n   other fields zero.  This Match\
    \ Report MUST be included only once, not\n   once per interface.\n   Note that\
    \ MinLen and MaxLen need not be explicitly bounds checked,\n   even though certain\
    \ combinations of values will make any matches\n   impossible.\n"
- title: 4.3.  Execution
  contents:
  - "4.3.  Execution\n   For each applicable router interface, as determined by the\
    \ A and S\n   flags, the Prefix Control Operations in an RR Command message must\
    \ be\n   carried out in order of appearance.  The relative order of PCO\n   processing\
    \ among different interfaces is not specified.\n   If the T flag is set, create\
    \ a copy of each interface's configuration\n   on which to operate, because the\
    \ results of processing a PCO may\n   affect the processing of subsequent PCOs.\
    \  Note that if all\n   operations are performed on one interface before proceeding\
    \ to\n   another interface, only one interface-configuration copy will be\n  \
    \ required at a time.\n   For each interface and for each Prefix Control Operation,\
    \ each prefix\n   configured on that interface with a length between the MinLen\
    \ and\n   MaxLen values in the PCO is tested to determine whether it matches\n\
    \   (as defined in section 2.1) the MatchPrefix of the PCO.  The\n   configured\
    \ prefixes are tested in an arbitrary order.  Any new prefix\n   configured on\
    \ an interface by the effect of a given PCO MUST NOT be\n   tested against that\
    \ PCO, but MUST be tested against all subsequent\n   PCOs in the same RR Command\
    \ message.\n   Under a certain condition the addresses on an interface are also\n\
    \   tested to see whether any of them matches the MatchPrefix.  If and\n   only\
    \ if a configured prefix \"P\" does have a length between MinLen and\n   MaxLen\
    \ inclusive, does not match the MatchPrefix \"M\", but M does\n   match P (this\
    \ can happen only if M is longer than P), then those\n   addresses on that interface\
    \ which match P MUST be tested to determine\n   whether any of them matches M.\
    \  If any such address does match M,\n   process the PCO as if P matched M, but\
    \ when forming New Prefixes, if\n   KeepLen is non-zero, bits are copied from\
    \ the address.  This special\n   case allows a PCO to be easily targeted to a\
    \ single specific\n   interface in a network.\n   If P does not match M, processing\
    \ is finished for this combination of\n   PCO, interface and prefix.  Continue\
    \ with another prefix on the same\n   interface if there are any more prefixes\
    \ which have not been tested\n   against this PCO and were not created by the\
    \ action of this PCO.  If\n   no such prefixes remain on the current interface,\
    \ continue processing\n   with the next PCO on the same interface, or with another\
    \ interface.\n   If P does match M, either directly or because a configured address\n\
    \   which matches P also matches M, then P is the Matched Prefix.\n   Perform\
    \ the following steps.\n      If the Command has the R flag set, add a Match Report\
    \ to the\n      Result message being constructed.\n      If the OpCode is CHANGE,\
    \ mark P for deletion from the current\n      interface.\n      If the OpCode\
    \ is SET-GLOBAL, mark all global-scope prefixes on the\n      current interface\
    \ for deletion.\n      If there are any Use-Prefix parts in the current PCO, form\
    \ the New\n      Prefixes.  Discard any New Prefix which has a forbidden format,\n\
    \      and if the R flag is set in the command, set the F flag in the\n      Match\
    \ Report for this PCO and interface.  Forbidden prefix formats\n      include,\
    \ at a minimum, multicast, unspecified and loopback\n      addresses.  [AARCH]\
    \  Any implementation MAY forbid, or allow the\n      network manager to forbid\
    \ other formats as well.\n      For each New Prefix which is already configured\
    \ on the current\n      interface, unmark that prefix for deletion and update\
    \ the\n      lifetimes and RA flags.  For each New Prefix which is not already\n\
    \      configured, add the prefix and, if appropriate, configure an\n      address\
    \ with that prefix.\n      Delete any prefixes which are still marked for deletion,\
    \ together\n      with any addresses which match those prefixes but do not match\
    \ any\n      prefix which is not marked for deletion.\n      After processing\
    \ all the Prefix Control Operations on all the\n      interfaces, an implementation\
    \ MUST record the SegmentNumber of the\n      packet in a list associated with\
    \ the SequenceNumber.\n      If the Command has the R flag set, compute the Checksum\
    \ and\n      schedule the Result message for transmission after a random time\n\
    \      interval uniformly distributed between 0 and MaxDelay\n      milliseconds.\
    \  This interval SHOULD begin at the conclusion of\n      processing, not the\
    \ beginning.  A copy of the Result message MAY\n      be saved to be retransmitted\
    \ in response to a duplicate Command.\n"
- title: 4.4.  Summary of Effects
  contents:
  - "4.4.  Summary of Effects\n   The only Neighbor Discovery [ND] parameters which\
    \ can be affected by\n   Router Renumbering are the following.\n      A router's\
    \ addresses and advertised prefixes, including the prefix\n      lengths.\n  \
    \    The flag bits (L and A, and any which may be defined in the\n      future)\
    \ and the valid and preferred lifetimes which appear in a\n      Router Advertisement\
    \ Prefix Information Option.\n      That unnamed property of the lifetimes which\
    \ specifies whether\n      they are fixed values or decrementing in real time.\n\
    \   Other internal router information, such as the time until the next\n   unsolicited\
    \ Router Advertisement or MIB variables MAY be affected as\n   needed.\n   All\
    \ configuration changes resulting from Router Renumbering SHOULD be\n   saved\
    \ to non-volatile storage where this facility exists.  The\n   problem of properly\
    \ restoring prefix lifetimes from non-volatile\n   storage exists independently\
    \ of Router Renumbering and deserves\n   careful attention, but is outside the\
    \ scope of this document.\n"
- title: 5.  Sequence Number Reset
  contents:
  - "5.  Sequence Number Reset\n   It may prove necessary in practice to reset a router's\
    \ Recorded\n   Sequence Number.  This is a safe operation only when all\n   cryptographic\
    \ keys previously used to authenticate RR Commands have\n   expired or been revoked.\
    \  For this reason, the Sequence Number Reset\n   message is defined to accomplish\
    \ both functions.\n   When a Sequence Number Reset (SNR) has been authenticated\
    \ and has\n   passed the header check, the router MUST invalidate all keys which\n\
    \   have been used to authenticate previous RR Commands, including the\n   key\
    \ which authenticated the SNR itself.  Then it MUST discard any\n   saved RR Result\
    \ messages, clear the list of recorded SegmentNumbers\n   and reset the Recorded\
    \ Sequence Number to zero.\n   If the router has no other, unused authentication\
    \ keys already\n   available for Router Renumbering use it SHOULD establish one\
    \ or more\n   new valid keys.  The details of this process will depend on whether\n\
    \   manual keying or a key management protocol is used.  In either case,\n   if\
    \ no keys are available, no new Commands can be processed.\n   A SNR message SHOULD\
    \ contain no PCOs, since they will be ignored.  If\n   and only if the R flag\
    \ is set in the SNR message, a router MUST\n   respond with a Result Message containing\
    \ no Match Reports.  The\n   header and transmission of the Result are as described\
    \ in section 3.\n   The invalidation of authentication keys caused by a valid\
    \ SNR message\n   will cause retransmitted copies of that message to be ignored.\n"
- title: 6.  IANA Considerations
  contents:
  - "6.  IANA Considerations\n   Following the policies outlined in [IANACON], new\
    \ values of the Code\n   field in the Router Renumbering Header (section 3.1)\
    \ and the OpCode\n   field of the Match-Prefix Part (section 3.2.1.1) are to be\
    \ allocated\n   by IETF consensus only.\n"
- title: 7.  Security Considerations
  contents:
  - "7.  Security Considerations\n   The Router Renumbering mechanism proposed here\
    \ is very powerful and\n   prevention of spoofing it is important.  Replay of\
    \ old messages must,\n   in general, be prevented (even though a narrow class\
    \ of messages\n   exists for which replay would be harmless).  What constitutes\
    \ a\n   sufficiently strong authentication algorithm may change from time to\n\
    \   time, but algorithms should be chosen which are strong against\n   current\
    \ key-recovery and forgery attacks.\n   Authentication keys must be as well protected\
    \ as any other access\n   method that allows reconfiguration of a site's routers.\
    \  Distribution\n   of keys must not expose them or permit alteration, and key\
    \ validity\n   must be limited in terms of time and number of messages\n   authenticated.\n\
    \   Note that although a reset of the Recorded Sequence Number requires\n   the\
    \ cancellation of previously-used authentication keys, introduction\n   of new\
    \ keys and expiration of old keys does not require resetting the\n   Recorded\
    \ Sequence Number.\n"
- title: 7.1.  Security Policy and Association Database Entries
  contents:
  - "7.1.  Security Policy and Association Database Entries\n   The Security Policy\
    \ Database (SPD) [IPSEC] of a router implementing\n   this specification MUST\
    \ cause incoming Router Renumbering Command\n   packets to either be discarded\
    \ or have IPsec applied.  (The\n   determination of \"discard\" or \"apply\" MAY\
    \ be based on the source\n   address.)  The resulting Security Association Database\
    \ (SAD) entries\n   MUST ensure authentication and integrity of the destination\
    \ address\n   and the RR Header and Message Body, and the body length implied\
    \ by\n   the IPv6 length and intervening extension headers.  These\n   requirements\
    \ are met by the use of the Authentication Header [AH] in\n   transport or tunnel\
    \ mode, or the Encapsulating Security Payload [ESP]\n   in tunnel mode with non-NULL\
    \ authentication.  The mandatory-to-\n   implement IPsec authentication algorithms\
    \ (other than NULL) seem\n   strong enough for Router Renumbering at the time\
    \ of this writing.\n   Note that for the SPD to distinguish Router Renumbering\
    \ from other\n   ICMP packets requires the use of the ICMP Type field as a selector.\n\
    \   This is consistent with, although not mentioned by, the Security\n   Architecture\
    \ specification [IPSEC].\n   At the time of this writing, there exists no multicast\
    \ key management\n   protocol for IPsec and none is on the horizon.  Manually\
    \ configured\n   Security Associations will therefore be common.  The occurrence\
    \ of\n   \"from traffic\" in the table below would therefore more realistically\n\
    \   be a wildcard or a fixed range.  Use of a small set of shared keys\n   per\
    \ management station suffices, so long as key distribution and\n   storage are\
    \ sufficiently safeguarded.\n   A sufficient set of SPD entries for incoming traffic\
    \ could select\n      Field         SPD Entry           SAD Entry\n      -------\
    \       ---------           ---------\n      Source        wildcard          \
    \  from traffic\n      Destination   wildcard            from SPD\n      Transport\
    \     ICMPv6              from SPD\n      ICMP Type     Rtr. Renum.         from\
    \ SPD\n      Action        Apply IPsec\n      SA Spec       AH/Transport Mode\n\
    \   or there might be an entry for each management station and/or for\n   each\
    \ of the router's unicast addresses and for each of the defined\n   All-Routers\
    \ multicast addresses, and a final wildcard entry to\n   discard all other incoming\
    \ RR messages.\n   The SPD and SAD are conceptually per-interface databases. \
    \ This fact\n   may be exploited to permit shared management of a border router,\
    \ for\n   example, or to discard all Router Renumbering traffic arriving over\n\
    \   tunnels.\n"
- title: 8.  Implementation and Usage Advice for Reliability
  contents:
  - "8.  Implementation and Usage Advice for Reliability\n   Users of Router Renumbering\
    \ will want to be sure that every non-\n   trivial message reaches every intended\
    \ router.  Well-considered\n   exploitation of Router Renumbering's retransmission\
    \ and response-\n   directing features should make that goal achievable with high\n\
    \   confidence even in a minimally reliable network.\n   In one set of cases,\
    \ probably the majority, the network management\n   station will know the complete\
    \ set of routers under its control.\n   Commands can be retransmitted, with the\
    \ \"R\" (Reply-requested) flag\n   set in the RR header, until Results have been\
    \ collected from all\n   routers.  If unicast Security Associations (or the means\
    \ for creating\n   them) are available, the management station may switch from\
    \ multicast\n   to unicast transmission when the number of routers still unheard-from\n\
    \   is suitably small.\n   To maintain a list of managed routers, the management\
    \ station can\n   employ any of several automatic methods which may be more convenient\n\
    \   than manual entry in a large network.  Multicast RR \"Test\" commands\n  \
    \ can be sent periodically and the results archived, or the management\n   station\
    \ can use SNMP to \"peek\" into a link-state routing protocol\n   such as OSPF\
    \ [OSPFMIB].  (In the case of OSPF, roughly one router per\n   area would need\
    \ to be examined to build a complete list of routers.)\n   In a large dynamic\
    \ network where the set of managed routers is not\n   known but reliable execution\
    \ is desired, a scalable method for\n   achieving confidence in delivery is described\
    \ here.  Nothing in this\n   section affects the format or content of Router Renumbering\
    \ messages,\n   nor their processing by routers.\n   A management station implementing\
    \ these reliability mechanisms MUST\n   alert an operator who attempts to commence\
    \ a set of Router\n   Renumbering Commands when retransmission of a previous set\
    \ is not yet\n   completed, but SHOULD allow the operator to override the warning.\n"
- title: 8.1.  Outline and Definitions
  contents:
  - "8.1.  Outline and Definitions\n   The set of routers being managed with Router\
    \ Renumbering is\n   considered as a set of populations, each population having\
    \ a\n   characteristic probability of successful round-trip delivery of a\n  \
    \ Command/Result pair.  The goal is to estimate a lower bound, P, on\n   the round-trip\
    \ probability for the whole set.  With this estimate and\n   other data about\
    \ the responses to retransmissions of the Command, a\n   confidence level can\
    \ be computed for hypothesis that all routers have\n   been heard from.\n   If\
    \ the true probability of successful round-trip communication with a\n   managed\
    \ router were a constant, p, for all managed routers then an\n   estimate P of\
    \ p could be derived from either of these statistics:\n      The expected ratio\
    \ of the number of routers first heard from after\n      transmission (N + 1)\
    \ to the number first heard from after N is\n      (1 - p).\n      When N different\
    \ routers have been heard from after M\n      transmissions of a Command, the\
    \ expected total number of Result\n      messages received is pNM.  If R is the\
    \ number of Results actually\n      received, then P = R/MN.\n   The two methods\
    \ are not equivalent.  The first suffers numerical\n   problems when the number\
    \ of routers still to be heard from gets\n   small, so the P = R/MN estimate should\
    \ be used.\n   Since the round-trip probability is not expected to be uniform\
    \ in the\n   real world, and the less-reliable units are more important to a\n\
    \   lower-bound estimate but more likely to be missed in sampling, the\n   sample\
    \ from which P is computed is biased toward the less-reliable\n   routers.  After\
    \ the Nth transmission interval, N > 2, neglect all\n   routers heard from in\
    \ intervals 1 through F from the reliability\n   estimate, where F is the greatest\
    \ integer less than one-half of N.\n   For example, after five intervals, only\
    \ routers first heard from in\n   the third through fifth intervals will be counted.\n\
    \   A management station implementing the methods of this section should\n   allow\
    \ the user to specify the following parameters, and default them\n   to the indicated\
    \ values.\n   Ct      The target delivery confidence, default 0.999.\n   Pp  \
    \    A presumptive, pessimistic initial estimate of the lower\n           bound\
    \ of the round-trip probability, P, to prevent early\n           termination.\
    \  (See below.)  Default 0.75.\n   Ti      The initial time between Command retransmissions.\
    \  Default 4\n           seconds.  MaxDelay milliseconds (see section 3.1) must\
    \ be\n           added to the retransmission timer.  Knowledge of the\n      \
    \     routers' processing time for RR Commands may influence the\n           setting\
    \ of Ti.  Ti+MaxDelay is also the minimum time the\n           management station\
    \ must wait for Results after each\n           transmission before computing a\
    \ new confidence level.  The\n           phrase \"end of the Nth interval\" means\
    \ a time Ti+MaxDelay\n           after the Nth transmission of a Command.\n  \
    \ Tu      The upper bound on the period between Command\n           retransmissions.\
    \  Default 512 seconds.\n   The following variables, some a function of the retransmission\n\
    \   counter N, are used in the next section.\n   T(N)    The time between Command\
    \ transmissions N and N+1 is V*T(N) +\n           MaxDelay, where V is random\
    \ and roughly uniform in the range\n           [0.75, 1.0].  T(1) = Ti and for\
    \ N > 1, T(N) = min(2*T(N-1),\n           Tu).\n   M(N)    The cumulative number\
    \ of distinct routers from which replies\n           have been received to any\
    \ of the first N transmissions of\n           the Command.\n   F=F(N)  FLOOR((N-1)/2).\
    \  All routers from which responses were\n           received in the first F intervals\
    \ will be effectively\n           omitted from the estimate of the round-trip\
    \ probability\n           computed at the Nth interval.\n   R(N,F)  The total\
    \ number of RR Result messages, including\n           duplicates, received by\
    \ the end of the Nth interval from\n           those routers which were NOT heard\
    \ from in any of the first\n           F intervals.\n   p(N)    The estimate of\
    \ the worst-case round-trip delivery\n           probability.\n   c(N)    The\
    \ computed confidence level.\n   An asterisk (*) is used to denote multiplication\
    \ and a caret (^)\n   denotes exponentiation.\n   If the difference in reliability\
    \ between the \"good\" and \"bad\" parts\n   of a managed network is very great,\
    \ early c(N) values will be too\n   high.  Retransmissions should continue for\
    \ at least Nmin = log(1-\n   Ct)/log(1-Pp) intervals, regardless of the current\
    \ confidence\n   estimate.  (In fact, there's no need to compute p(N) and c(N)\
    \ until\n   after Nmin intervals.)\n"
- title: 8.2.  Computations
  contents:
  - "8.2.  Computations\n   Letting A = N*(M(N)-M(F))/R(N,F) for brevity, the estimate\
    \ of the\n   round-trip delivery probability is p(N) = 1-Q, where Q is that root\n\
    \   of the equation\n        Q^N - A*Q + (A-1) = 0\n   which lies between 0 and\
    \ 1.  (Q = 1 is always a root.  If N is odd\n   there is also a negative root.)\
    \  This may be solved numerically, for\n   example with Newton's method (see any\
    \ standard text, for example\n   [ANM]).  The first-order approximation\n    \
    \    Q1 = 1 - 1/A\n   may be used as a starting point for iteration.  But Q1 should\
    \ NOT be\n   used as an approximate solution as it always underestimates Q, and\n\
    \   hence overestimates p(N), which would cause an overestimate of the\n   confidence\
    \ level.\n   If necessary, the spurious root Q = 1 can be divided out, leaving\n\
    \        Q^(N-1) + Q^(N-2) + ... + Q - (A-1) = 0\n   as the equation to solve.\
    \  Depending on the numerical method used,\n   this could be desirable as it's\
    \ just possible (but very unlikely)\n   that A=N and so Q=1 was a double root\
    \ of the earlier equation.\n   After N > 2 (or N >= Nmin) intervals have been\
    \ completed, Compute the\n   lower-bound reliability estimate\n        p(N) =\
    \ R(N,F)/((N-F)*(M(N) - M(F))).\n   Compute the confidence estimate\n        c(N)\
    \ = (1 - (1-p(N))^N)^(M(N) - M(F) + 1).\n   which is the Bayesian probability\
    \ that M(N) is the number of routers\n   present given the number of responses\
    \ which were collected, as\n   opposed to M(N)+1 or any greater number.  It is\
    \ assumed that the a\n   priori probability of there being K routers was no greater\
    \ than that\n   of K-1 routers, for all K > M(N).\n   When c(N) >= Ct and N >=\
    \ Nmin, retransmissions of the Command may\n   cease.  Otherwise another transmission\
    \ should be scheduled at a time\n   V*T(N) + MaxDelay after the previous (Nth)\
    \ transmission, or V*T(N)\n   after the conclusion of processing responses to\
    \ the Nth transmission,\n   whichever is later.\n   One corner case needs consideration.\
    \  Divide-by-zero may occur when\n   computing p.  This can happen only when no\
    \ new routers have been\n   heard from in the last N-F intervals.  Generally,\
    \ the confidence\n   estimate c(N) will be close to unity by then, but in a pathological\n\
    \   case such as a large number of routers with reliable communication\n   and\
    \ a much smaller number with very poor communication, the\n   confidence estimate\
    \ may still be less than Ct when p's denominator\n   vanishes.  The implementation\
    \ may continue, and should continue if\n   the minimum number of transmissions\
    \ given in the previous paragraph\n   have not yet been made.  If new routers\
    \ are heard from, p(N) will\n   again be non-singular.\n   Of course no limited\
    \ retransmission scheme can fully address the\n   possibility of long-term problems,\
    \ such as a partitioned network.\n   The network manager is expected to be aware\
    \ of such conditions when\n   they exist.\n"
- title: 8.3.  Additional Assurance Methods
  contents:
  - "8.3.  Additional Assurance Methods\n   As a final means to detect routers which\
    \ become reachable after\n   missing renumbering commands during an extended network\
    \ split, a\n   management station MAY adopt the following strategy.  When performing\n\
    \   each new operation, increment the SequenceNumber by more than one.\n   After\
    \ the operation is believed complete, periodically send some\n   \"no-op\" RR\
    \ Command with the R (Result Requested) flag set and a\n   SequenceNumber one\
    \ less than the highest used.  Any responses to such\n   a command can only come\
    \ from router that missed the last operation.\n   An example of a suitable \"\
    no-op\" command would be an ADD operation\n   with MatchLen = 0, MinLen = 0, MaxLen\
    \ = 128, and no Use-Prefix Parts.\n   If old authentication keys are saved by\
    \ the management station, even\n   the reappearance of routers which missed a\
    \ Sequence Number Reset can\n   be detected by the transmission of no-op commands\
    \ with the invalid\n   key and a SequenceNumber higher than any used before the\
    \ key was\n   invalidated.  Since there is no other way for a management station\
    \ to\n   distinguish a router's failure to receive an entire sequence of\n   repeated\
    \ SNR messages from the loss of that router's single SNR\n   Result Message, this\
    \ is the RECOMMENDED way to test for universal\n   reception of a SNR Command.\n"
- title: 9.  Usage Examples
  contents:
  - "9.  Usage Examples\n   This section sketches some sample applications of Router\
    \ Renumbering.\n   Extension headers, including required IPsec headers, between\
    \ the IPv6\n   header and the ICMPv6 header are not shown in the examples.\n"
- title: 9.1.  Maintaining Global-Scope Prefixes
  contents:
  - "9.1.  Maintaining Global-Scope Prefixes\n   A simple use of the Router Renumbering\
    \ mechanism, and one which is\n   expected to to be common, is the maintenance\
    \ of a set of global\n   prefixes with a subnet structure that matches that of\
    \ the site's\n   site-local address assignments.  In the steady state this would\
    \ serve\n   to keep the Preferred and Valid lifetimes set to their desired\n \
    \  values.  During a renumbering transition, similar Command messages\n   can\
    \ add new prefixes and/or delete old ones.  An outline of a\n   suitable Command\
    \ message follows.  Fields not listed are presumed set\n   to suitable values.\
    \  This Command assumes all router interfaces to be\n   maintained already have\
    \ site-local [AARCH] addresses.\n   IPv6 Header\n      Next Header = 58 (ICMPv6)\n\
    \      Source Address = (Management Station)\n      Destination Address = FF05::2\
    \ (All Routers, site-local scope)\n   ICMPv6/RR Header\n      Type = 138 (Router\
    \ Renumbering), Code = 0 (Command)\n      Flags = 60 hex (R, A)\n   First (and\
    \ only) PCO:\n      Match-Prefix Part\n          OpCode = 3 (SET-GLOBAL)\n   \
    \       OpLength = 4 N + 3 (assuming N global prefixes)\n          Ordinal = 0\
    \ (arbitrary)\n          MatchLen = 10\n          MatchPrefix = FEC0::0\n    \
    \  First Use-Prefix Part\n          UseLen = 48 (Length of TLA ID + RES + NLA\
    \ ID [AARCH])\n          KeepLen = 16 (Length of SLA (subnet) ID [AARCH])\n  \
    \        FlagMask, RAFlags, Lifetimes, V & P flags -- as desired\n          UsePrefix\
    \ = First global /48 prefix\n      . . .\n      Nth Use-Prefix Part\n        \
    \  UseLen = 48\n          KeepLen = 16\n          FlagMask, RAFlags, Lifetimes,\
    \ V & P flags -- as desired\n          UsePrefix = Last global /48 prefix\n  \
    \ This will cause N global prefixes to be set (or updated) on each\n   applicable\
    \ interface.  On each interface, the SLA ID (subnet) field\n   of each global\
    \ prefix will be copied from the existing site-local\n   prefix.\n"
- title: 9.2.  Renumbering a Subnet
  contents:
  - "9.2.  Renumbering a Subnet\n   A subnet can be gracefully renumbered by setting\
    \ the valid and\n   preferred timers on the old prefix to a short value and having\
    \ them\n   run down, while concurrently adding adding the new prefix.  Later,\n\
    \   the expired prefix is deleted.  The first step is described by the\n   following\
    \ RR Command.\n   IPv6 Header\n      Next Header = 58 (ICMPv6)\n      Source Address\
    \ = (Management Station)\n      Destination Address = FF05::2 (All Routers, site-local\
    \ scope)\n   ICMPv6/RR Header\n      Type = 138 (Router Renumbering), Code = 0\
    \ (Command)\n      Flags = 60 hex (R, A)\n   First (and only) PCO:\n      Match-Prefix\
    \ Part\n          OpCode = 2 (CHANGE)\n          OpLength = 11 (reflects 2 Use-Prefix\
    \ Parts)\n          Ordinal = 0 (arbitrary)\n          MatchLen = 64\n       \
    \   MatchPrefix = Old /64 prefix\n      First Use-Prefix Part\n          UseLen\
    \ = 0\n          KeepLen = 64 (this retains the old prefix value intact)\n   \
    \       FlagMask = 0, RAFlags = 0\n          Valid Lifetime = 28800 seconds (8\
    \ hours)\n          Preferred Lifetime = 7200 seconds (2 hours)\n          V flag\
    \ = 1, P flag = 1\n          UsePrefix = 0::0\n      Second Use-Prefix Part\n\
    \          UseLen = 64\n          KeepLen = 0\n          FlagMask = 0, RAFlags\
    \ = 0\n          Lifetimes, V & P flags -- as desired\n          UsePrefix = New\
    \ /64 prefix\n   The second step, deletion of the old prefix, can be done by an\
    \ RR\n   Command with the same Match-Prefix Part (except for an OpLength\n   reduced\
    \ from 11 to 3) and no Use-Prefix Parts.  Any temptation to set\n   KeepLen =\
    \ 64 in the second Use-Prefix Part above should be resisted,\n   as it would instruct\
    \ the router to sidestep address configuration.\n"
- title: 10.  Acknowledgments
  contents:
  - "10.  Acknowledgments\n   This protocol was designed by Matt Crawford based on\
    \ an idea of\n   Robert Hinden and Geert Jan de Groot.  Many members of the IPNG\n\
    \   Working Group contributed useful comments, in particular members of\n   the\
    \ DIGITAL UNIX IPv6 team.  Bill Sommerfeld provided helpful IPsec\n   expertise.\
    \  Relentless browbeating by various IESG members may have\n   improved the final\
    \ quality of this specification.\n"
- title: 11.  References
  contents:
  - "11.  References\n   [AARCH]   Hinden, R. and S. Deering, \"IP Version 6 Addressing\n\
    \             Architecture\", RFC 2373, July 1998.\n   [AH]      Kent, S. and\
    \ R. Atkinson, \"IP Authentication Header\", RFC\n             2402, November\
    \ 1998.\n   [ANM]     Isaacson, E. and H. B. Keller, \"Analysis of Numerical\n\
    \             Methods\", John Wiley & Sons, New York, 1966.\n   [ESP]     Kent,\
    \ S. and R. Atkinson, \"IP Encapsulating Security\n             Payload (ESP)\"\
    , RFC 2406, November 1998.\n   [IANACON] Narten, T. and H. Alvestrand, \"Guidelines\
    \ for Writing an\n             IANA Considerations Section in RFCs\", BCP 26,\
    \ RFC 2434,\n             October 1998.\n   [ICMPV6]  Conta, A. and S. Deering,\
    \ \"Internet Control Message\n             Protocol (ICMPv6) for the Internet\
    \ Protocol Version 6\n             (IPv6)\", RFC 2463, December 1998.\n   [IPSEC]\
    \   Kent, S. and R. Atkinson, \"Security Architecture for the\n             Internet\
    \ Protocol\", RFC 2401, November 1998.\n   [IPV6]    Deering, S. and R. Hinden,\
    \ \"Internet Protocol, Version 6\n             (IPv6) Specification\", RFC 2460,\
    \ December 1998.\n   [IPV6MIB] Haskin, D. and S. Onishi, \"Management Information\
    \ Base for\n             IP Version 6: Textual Conventions and General Group\"\
    , RFC\n             2466, December 1998.\n   [KWORD]   Bradner, S., \"Key words\
    \ for use in RFCs to Indicate\n             Requirement Levels\", BCP 14, RFC\
    \ 2119, March 1997.\n   [ND]      Narten, T., Nordmark, E. and W. Simpson, \"\
    Neighbor\n             Discovery for IP Version 6 (IPv6)\", RFC 2461, December\n\
    \             1998.\n   [OSPFMIB] Baker, F. and R. Coltun, \"OSPF Version 2 Management\n\
    \             Information Base\", RFC 1850, November 1995.\n"
- title: 12.  Author's Address
  contents:
  - "12.  Author's Address\n   Matt Crawford\n   Fermilab MS 368\n   PO Box 500\n\
    \   Batavia, IL 60510\n   USA\n   Phone: +1 630 840 3461\n   EMail: crawdad@fnal.gov\n"
- title: Appendix -- Derivation of Reliability Estimates
  contents:
  - "Appendix -- Derivation of Reliability Estimates\n   If a population S of size\
    \ k is repeatedly sampled with an efficiency\n   p, the expected number of members\
    \ of S first discovered on the nth\n   sampling is\n        m = [1 - (1-p)^n]\
    \ * k\n   The expected total number of members of S found in samples, including\n\
    \   duplicates, is\n        r = n * p * k\n   Taking the ratio of m to r cancels\
    \ the unknown factor k and yields an\n   equation\n        [1 - (1-p)^n] / p =\
    \ nm/r\n   which may be solved for p, which is then an estimator of the sampling\n\
    \   efficiency.  (The statistical properties of the estimator will not be\n  \
    \ examined here.)  Under the substitution p = 1-q, this becomes the\n   first\
    \ equation of Section 8.2.\n   With the estimator p in hand, and a count m of\
    \ members of S\n   discovered after n samplings, we can compute the a posteriori\n\
    \   probability that the true size of S is m+j, for j >= 0.  Let Hj\n   denote\
    \ the hypothesis that the true size of S is m+j, and let R\n   denote the result\
    \ that m members have been found in n samplings.\n   Then\n        P{R | Hj} =\
    \ [(m+j)!/m!j!] * [1-(1-p)^n]^m * [(1-p)^n]^j\n   We are interested in P{H0 |\
    \ R}, but to find it we need to assign a\n   priori values to P{Hj}.  Let the\
    \ size of S be exponentially\n   distributed\n        P{Hj} / P{H0} = h^(-j)\n\
    \   for arbitrary h in (0, 1).  The value of h will be eliminated from\n   the\
    \ result.\n   The Bayesian method yields\n        P{Hj | R} / P{H0 | R} = [(m+j)!/m!j!]\
    \ * [h*(1-p)^n]^j\n   The reciprocal of the sum over j >= 0 of these ratios is\n\
    \        P{H0 | R} = [1-h*(1-p)^n] ^ (m+1)\n   and the confidence estimate of\
    \ Section 8.2 is the h -> 1 limit of\n   this expression.\n"
- title: Full Copyright Statement
  contents:
  - "Full Copyright Statement\n   Copyright (C) The Internet Society (2000).  All\
    \ Rights Reserved.\n   This document and translations of it may be copied and\
    \ furnished to\n   others, and derivative works that comment on or otherwise explain\
    \ it\n   or assist in its implementation may be prepared, copied, published\n\
    \   and distributed, in whole or in part, without restriction of any\n   kind,\
    \ provided that the above copyright notice and this paragraph are\n   included\
    \ on all such copies and derivative works.  However, this\n   document itself\
    \ may not be modified in any way, such as by removing\n   the copyright notice\
    \ or references to the Internet Society or other\n   Internet organizations, except\
    \ as needed for the purpose of\n   developing Internet standards in which case\
    \ the procedures for\n   copyrights defined in the Internet Standards process\
    \ must be\n   followed, or as required to translate it into languages other than\n\
    \   English.\n   The limited permissions granted above are perpetual and will\
    \ not be\n   revoked by the Internet Society or its successors or assigns.\n \
    \  This document and the information contained herein is provided on an\n   \"\
    AS IS\" basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING\n   TASK FORCE\
    \ DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING\n   BUT NOT LIMITED\
    \ TO ANY WARRANTY THAT THE USE OF THE INFORMATION\n   HEREIN WILL NOT INFRINGE\
    \ ANY RIGHTS OR ANY IMPLIED WARRANTIES OF\n   MERCHANTABILITY OR FITNESS FOR A\
    \ PARTICULAR PURPOSE.\n"
- title: Acknowledgement
  contents:
  - "Acknowledgement\n   Funding for the RFC Editor function is currently provided\
    \ by the\n   Internet Society.\n"
