- title: __initial_text__
  contents:
  - '  Generic Routing Encapsulation (GRE) Key Option for Proxy Mobile IPv6

    '
- title: Abstract
  contents:
  - "Abstract\n   This specification defines a new mobility option for allowing the\n\
    \   mobile access gateway and the local mobility anchor to negotiate\n   Generic\
    \ Routing Encapsulation (GRE) encapsulation mode and exchange\n   the downlink\
    \ and uplink GRE keys that are used for marking the\n   downlink and uplink traffic\
    \ that belong to a specific mobility\n   session.  In addition, the same mobility\
    \ option can be used to\n   negotiate the GRE encapsulation mode without exchanging\
    \ the GRE keys.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This\
    \ document is a product of the Internet Engineering Task Force\n   (IETF).  It\
    \ represents the consensus of the IETF community.  It has\n   received public\
    \ review and has been approved for publication by the\n   Internet Engineering\
    \ Steering Group (IESG).  Further information on\n   Internet Standards is available\
    \ in Section 2 of RFC 5741.\n   Information about the current status of this document,\
    \ any errata,\n   and how to provide feedback on it may be obtained at\n   http://www.rfc-editor.org/info/rfc5845.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2010 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (http://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.  Code Components\
    \ extracted from this document must\n   include Simplified BSD License text as\
    \ described in Section 4.e of\n   the Trust Legal Provisions and are provided\
    \ without warranty as\n   described in the Simplified BSD License.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1.  Introduction . . . . . . . . . . . . . . . . . . .\
    \ . . . . . .  3\n   2.  Conventions and Terminology  . . . . . . . . . . . .\
    \ . . . . .  3\n     2.1.  Conventions  . . . . . . . . . . . . . . . . . . .\
    \ . . . .  3\n     2.2.  Terminology  . . . . . . . . . . . . . . . . . . . .\
    \ . . .  3\n   3.  GRE Encapsulation and Key Exchange . . . . . . . . . . . .\
    \ . .  4\n     3.1.  GRE Encapsulation Overview . . . . . . . . . . . . . . .\
    \ .  4\n     3.2.  GRE Encapsulation Mode Only  . . . . . . . . . . . . . . .\
    \  6\n     3.3.  GRE Encapsulation and Key Exchange . . . . . . . . . . . .  6\n\
    \       3.3.1.  Initial GRE Key Exchange . . . . . . . . . . . . . . .  6\n  \
    \     3.3.2.  GRE Key Exchange during Binding Re-Registration  . . .  7\n   4.\
    \  Mobile Access Gateway Considerations . . . . . . . . . . . . .  8\n     4.1.\
    \  Extensions to the Conceptual Data Structure  . . . . . . .  8\n     4.2.  Operational\
    \ Summary  . . . . . . . . . . . . . . . . . . .  9\n   5.  Local Mobility Anchor\
    \ Considerations . . . . . . . . . . . . . 10\n     5.1.  Extensions to the Binding\
    \ Cache Entry  . . . . . . . . . . 10\n     5.2.  Operational Summary  . . . .\
    \ . . . . . . . . . . . . . . . 11\n   6.  Message Formats  . . . . . . . . .\
    \ . . . . . . . . . . . . . . 12\n     6.1.  GRE Key Option . . . . . . . . .\
    \ . . . . . . . . . . . . . 12\n     6.2.  Proxy Binding Update Message Extension\
    \ . . . . . . . . . . 13\n     6.3.  Proxy Binding Acknowledgement Message Extension\
    \  . . . . . 14\n     6.4.  Status Codes . . . . . . . . . . . . . . . . . . .\
    \ . . . . 14\n   7.  Data Packets Processing Considerations . . . . . . . . .\
    \ . . . 15\n     7.1.  Tunneling Format . . . . . . . . . . . . . . . . . . .\
    \ . . 15\n     7.2.  TLV-Header Tunneling Negotiation . . . . . . . . . . . .\
    \ . 16\n     7.3.  Mobile Access Gateway Operation  . . . . . . . . . . . . .\
    \ 18\n       7.3.1.  Sending and Receiving Data Packets . . . . . . . . . . 18\n\
    \     7.4.  Local Mobility Anchor Operation  . . . . . . . . . . . . . 19\n  \
    \     7.4.1.  Sending and Receiving Data Packets . . . . . . . . . . 20\n   8.\
    \  IANA Considerations  . . . . . . . . . . . . . . . . . . . . . 21\n   9.  Security\
    \ Considerations  . . . . . . . . . . . . . . . . . . . 21\n   10. Acknowledgements\
    \ . . . . . . . . . . . . . . . . . . . . . . . 21\n   11. References . . . .\
    \ . . . . . . . . . . . . . . . . . . . . . . 22\n     11.1. Normative References\
    \ . . . . . . . . . . . . . . . . . . . 22\n     11.2. Informative References\
    \ . . . . . . . . . . . . . . . . . . 22\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   The Proxy Mobile IPv6 specification [RFC5213] and IPv4 Support\
    \ for\n   Proxy Mobile IPv6 [RFC5844] allow the use of IPv6 and IPv4\n   encapsulation\
    \ modes as specified in [RFC2473] and [RFC2003] for the\n   tunneled traffic between\
    \ the local mobility anchor (LMA) and the\n   mobile access gateway (MAG).  There\
    \ are scenarios where these\n   encapsulation modes are not sufficient to uniquely\
    \ identify the\n   destination of packets of a specific mobility session.  Thus,\
    \ there\n   is a need for an encapsulation mode with richer semantics.  The\n\
    \   Generic Routing Encapsulation (GRE) [RFC2784], and the Key extension\n   as\
    \ defined in [RFC2890], has the required semantics to allow such a\n   distinction\
    \ for use in Proxy Mobile IPv6.\n   This specification defines the GRE Key option\
    \ to be used for the\n   negotiation of GRE encapsulation mode and exchange of\
    \ the uplink and\n   downlink GRE keys.  The negotiated downlink and uplink GRE\
    \ keys can\n   be used for marking the downlink and uplink traffic for a specific\n\
    \   mobility session.  In addition, this specification enables the mobile\n  \
    \ access gateway and the local mobility anchor to negotiate the use of\n   GRE\
    \ encapsulation mode without exchanging the GRE keys.\n   This specification has\
    \ no impact on IPv4 or IPv6 mobile nodes.\n"
- title: 2.  Conventions and Terminology
  contents:
  - '2.  Conventions and Terminology

    '
- title: 2.1.  Conventions
  contents:
  - "2.1.  Conventions\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\", \"\
    SHALL\", \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"MAY\"\
    , and \"OPTIONAL\" in this\n   specification are to be interpreted as described\
    \ in RFC 2119\n   [RFC2119].\n"
- title: 2.2.  Terminology
  contents:
  - "2.2.  Terminology\n   All the general mobility-related terminology and abbreviations\
    \ are to\n   be interpreted as defined in the Mobile IPv6 [RFC3775], Proxy Mobile\n\
    \   IPv6 [RFC5213], and IPv4 Support for Proxy Mobile IPv6 [RFC5844]\n   specifications.\
    \  The following terms are used in this specification.\n   Downlink Traffic\n\
    \      The traffic in the tunnel between the local mobility anchor and\n     \
    \ the mobile access gateway, heading towards the mobile access\n      gateway\
    \ and tunneled at the local mobility anchor.  This traffic\n      is also called\
    \ forward direction traffic.\n   Uplink Traffic\n      The traffic in the tunnel\
    \ between the mobile access gateway and\n      the local mobility anchor, heading\
    \ towards the local mobility\n      anchor and tunneled at the mobile access gateway.\
    \  This traffic is\n      also called reverse direction traffic.\n   Downlink\
    \ GRE Key\n      The GRE key is assigned by the mobile access gateway and used\
    \ by\n      the local mobility anchor to mark the downlink traffic that\n    \
    \  belongs to a specific mobility session as described in this\n      specification.\n\
    \   Uplink GRE Key\n      The GRE key is assigned by the local mobility anchor\
    \ and used by\n      the mobile access gateway to mark the uplink traffic that\
    \ belongs\n      to a specific mobility session as described in this specification.\n\
    \   A Policy Check\n      When a local mobility anchor receives an initial, handoff-\n\
    \      triggered Binding Lifetime Extension, or Binding Lifetime\n      Extension\
    \ Proxy Binding Update for a mobility session, the local\n      mobility anchor\
    \ determines if the GRE encapsulation mode only or\n      GRE encapsulation and\
    \ GRE keys are required based on a policy\n      check.  This policy could be\
    \ a per-MAG-LMA pair, a per-LMA local\n      policy, a per-MN policy, or the combination\
    \ of any of them.\n"
- title: 3.  GRE Encapsulation and Key Exchange
  contents:
  - "3.  GRE Encapsulation and Key Exchange\n   This section describes how GRE encapsulation\
    \ mode is negotiated and\n   the GRE keys are dynamically exchanged using Proxy\
    \ Mobile IPv6\n   protocol [RFC5213] signaling.\n"
- title: 3.1.  GRE Encapsulation Overview
  contents:
  - "3.1.  GRE Encapsulation Overview\n   Using the GRE Key option defined in this\
    \ specification, the mobile\n   access gateway and the local mobility anchor can\
    \ negotiate GRE\n   encapsulation mode only or GRE encapsulation mode and exchange\
    \ the\n   GRE keys for marking the downlink and uplink traffic.  In the case\n\
    \   when GRE encapsulation mode only is negotiated between the mobile\n   access\
    \ gateway and the local mobility anchor, then no GRE keys are\n   used.\n   However,\
    \ once the GRE keys have been exchanged between the mobile\n   access gateway\
    \ and the local mobility anchor as per this\n   specification, the mobile access\
    \ gateway will use the uplink GRE key\n   that is assigned by the local mobility\
    \ anchor in the GRE header of\n   the uplink payload packet.  Similarly, the local\
    \ mobility anchor will\n   use the downlink GRE key as negotiated with the mobile\
    \ access gateway\n   in the GRE header of the downlink payload packet.\n   The\
    \ following illustration explains the use of GRE encapsulation mode\n   and the\
    \ GRE keys for supporting the usecase where overlapping IPv4\n   private address\
    \ [RFC1918] allocation is in use.\n                                          \
    \                +------------+\n                                            \
    \              | Operator-A |\n                                              \
    \            |            |\n                                                \
    \          | 10.x.0.0/16|\n                                                  \
    \        +------------+\n                                                    \
    \               /\n        +------+                                      +------+\
    \    /\n        |      |      ==========================      |      |   /\n MN-1---|\
    \      |    /                            \\    |      |  / Key-1\n        |  M\
    \   |   / ---Flows with GRE Key-1 ---- \\   |  L   | / Traffic\n MN-2---|  A \
    \  |--|                                |--|  M   |-\n        |  G   |   \\ ---Flows\
    \ with GRE Key-2 ---- /   |  A   | \\ Key-2\n MN-3---|      |    \\          \
    \                  /    |      |  \\Traffic\n        |      |      ==========================\
    \      |      |   \\\n MN-4---|      |       Proxy Mobile IPv6 Tunnel       |\
    \      |    \\\n        +------+                                      +------+\
    \     \\\n                                                                   \
    \ \\\n                   Operator-C: Access Network             +------------+\n\
    \                                                          | Operator-B |\n  \
    \                                                        |            |\n    \
    \                                                      | 10.x.0.0/16|\n      \
    \                                                    +------------+\n    Figure\
    \ 1: GRE Tunneling for IPv4 Private Address Space Overlapping\n   Figure 1 illustrates\
    \ a local mobility anchor providing mobility\n   service to mobile nodes that\
    \ are from different operators and are\n   assigned IPv4 addresses from overlapping\
    \ private address space.  In\n   this scenario, the mobile access gateway and\
    \ the local mobility\n   anchor must be able to distinguish flows belonging to\
    \ different\n   operators.\n   The mobile nodes MN-1 and MN-2 are visiting from\
    \ Operator-A, and the\n   mobile nodes MN-3 and MN-4 are visiting from Operator-B.\
    \  The mobile\n   access gateway and the local mobility anchor exchange a specific\
    \ pair\n   of downlink and uplink GRE keys and save them as part of the mobile\n\
    \   node's binding to be used for identifying the flows belonging to each\n  \
    \ mobile node.\n   The LMA and the MAG will be able to distinguish each mobile\
    \ node\n   flow(s) based on the GRE key present in the GRE header of the\n   tunneled\
    \ payload packet, and route them accordingly.  However, the\n   GRE keys, as in\
    \ this specification, apply to the individual mobility\n   binding updated by\
    \ the Proxy Binding Update but not to all bindings\n   that the mobile may have\
    \ registered following procedures described in\n   [RFC5648].\n"
- title: 3.2.  GRE Encapsulation Mode Only
  contents:
  - "3.2.  GRE Encapsulation Mode Only\n   In order for the mobile access gateway\
    \ to request GRE encapsulation\n   mode only without exchanging the GRE keys,\
    \ the mobile access gateway\n   MUST include the GRE Key option but omit the GRE\
    \ Key Identifier field\n   in the Proxy Binding Update.\n   If the local mobility\
    \ anchor supports GRE encapsulation and the\n   received Proxy Binding Update\
    \ contains the GRE Key option but the GRE\n   Key Identifier field is omitted,\
    \ the mobile access gateway is\n   requesting GRE encapsulation without exchanging\
    \ the GRE keys\n   dynamically.  If the Proxy Binding Update processing is successful,\n\
    \   the local mobility anchor sends a successful Proxy Binding\n   Acknowledgement\
    \ message with the GRE Key option but the GRE Key\n   Identifier field is omitted.\n\
    \   When the mobile access gateway and the local mobility anchor\n   successfully\
    \ negotiate the GRE encapsulation mode only, then no GRE\n   keys are used.\n"
- title: 3.3.  GRE Encapsulation and Key Exchange
  contents:
  - "3.3.  GRE Encapsulation and Key Exchange\n   The following subsections describe\
    \ how the mobile access gateway and\n   the local mobility anchor negotiate GRE\
    \ encapsulation and exchange\n   downlink and uplink GRE keys using the Proxy\
    \ Mobile IPv6 registration\n   procedure.\n"
- title: 3.3.1.  Initial GRE Key Exchange
  contents:
  - "3.3.1.  Initial GRE Key Exchange\n   When the mobile access gateway determines,\
    \ based on, e.g., private\n   IPv4 address support [RFC1918], the mobile access\
    \ gateway local\n   policy, or the MAG-LMA peer agreement, that GRE encapsulation\
    \ is\n   needed and GRE keys are required, the mobile access gateway MUST\n  \
    \ include the GRE Key option in the initial Proxy Binding Update\n   message sent\
    \ to the local mobility anchor.  The mobile access gateway\n   MUST include the\
    \ downlink GRE key in the GRE Key Identifier field of\n   the GRE Key option.\n\
    \   After the local mobility anchor successfully processes the initial\n   Proxy\
    \ Binding Update and accepts the GRE encapsulation request and\n   the downlink\
    \ GRE key based on a policy check, the local mobility\n   anchor MUST include\
    \ the GRE Key option with the uplink GRE key in the\n   GRE Key Identifier field\
    \ in a successful Proxy Binding\n   Acknowledgement and send it to the mobile\
    \ access gateway.\n"
- title: 3.3.2.  GRE Key Exchange during Binding Re-Registration
  contents:
  - "3.3.2.  GRE Key Exchange during Binding Re-Registration\n   If the local mobility\
    \ anchor has successfully negotiated and\n   exchanged the initial GRE keys with\
    \ the mobile access gateway for a\n   specific mobile node's mobility session,\
    \ the local mobility anchor\n   MUST maintain the same negotiated uplink GRE key\
    \ for the lifetime of\n   that mobility session.  However, for administrative\
    \ reasons, e.g.,\n   local mobility anchor reboot, the local mobility anchor MAY\
    \ change\n   the uplink GRE key for the mobility session.  In that case, some\n\
    \   packet loss may be experienced.\n   If the mobile access gateway has successfully\
    \ negotiated and\n   exchanged the initial GRE keys with the local mobility anchor\
    \ for a\n   specific mobile node's mobility session, the mobile access gateway\n\
    \   MUST include the GRE Key option with the downlink GRE key in the\n   Proxy\
    \ Binding Update that is used to request a Binding Lifetime\n   Extension.  In\
    \ this case, if the local mobility anchor successfully\n   processes the Proxy\
    \ Binding Update message, the local mobility anchor\n   MUST return the same uplink\
    \ GRE key that was exchanged with the\n   mobile access gateway in the last successful\
    \ Proxy Binding Update for\n   the same mobility session in the GRE Key option\
    \ in a successful Proxy\n   Binding Acknowledgement message.\n   However, during\
    \ inter-MAG handoff and if the new mobile access\n   gateway determines, based\
    \ on, e.g., private IPv4 address support, the\n   mobile access gateway local\
    \ policy, the MAG-LMA peer agreement, or an\n   indication during the handoff\
    \ process, that GRE encapsulation and GRE\n   keys exchange are required, the\
    \ new mobile access gateway MUST\n   include the GRE Key option with the downlink\
    \ GRE key in the Proxy\n   Binding Update that is used to request an after-handoff\
    \ Binding\n   Lifetime Extension.  In this case, the new mobile access gateway\
    \ may\n   either pick a new downlink GRE key or use the downlink GRE key that\n\
    \   was used by the previous mobile access gateway for the same binding.\n   For\
    \ the new mobile access gateway to know the downlink GRE key used\n   by the previous\
    \ mobile access gateway, it may require transfer of\n   context from the previous\
    \ mobile access gateway to the new mobile\n   access gateway during a handoff.\
    \  Such mechanisms are out of scope\n   for this specification.\n   If the local\
    \ mobility anchor successfully processes a handoff-\n   triggered Binding Lifetime\
    \ Extension Proxy Binding Update message\n   that contains a GRE Key option with\
    \ a downlink GRE key included, the\n   local mobility anchor MUST return the same\
    \ uplink GRE key that was\n   exchanged with the previous mobile access gateway\
    \ for the same\n   mobility session in the GRE Key option in a successful Proxy\
    \ Binding\n   Acknowledgement.\n   If the local mobility anchor receives a handoff-triggered\
    \ Binding\n   Lifetime Extension Proxy Binding Update message without the GRE\
    \ Key\n   option for a Binding Cache entry (BCE) that is using GRE keys and GRE\n\
    \   encapsulation, the local mobility anchor makes a policy check\n   regarding\
    \ GRE encapsulation and GRE key exchange.  If, according to\n   the policy check,\
    \ GRE encapsulation and GRE key exchange are\n   required, the local mobility\
    \ anchor MUST reject the Proxy Binding\n   Update by sending a Proxy Binding Acknowledgement\
    \ message with the\n   Status field set to GRE_KEY_OPTION_REQUIRED as defined\
    \ in\n   Section 6.4.  Otherwise, the local mobility anchor SHOULD accept the\n\
    \   Proxy Binding Update, and if it is processed successfully, the local\n   mobility\
    \ anchor MUST return a successful Proxy Binding\n   Acknowledgement without including\
    \ the GRE Key option.\n"
- title: 4.  Mobile Access Gateway Considerations
  contents:
  - '4.  Mobile Access Gateway Considerations

    '
- title: 4.1.  Extensions to the Conceptual Data Structure
  contents:
  - "4.1.  Extensions to the Conceptual Data Structure\n   Every mobile access gateway\
    \ maintains a Binding Update List (BUL)\n   entry for each currently attached\
    \ mobile node, as explained in\n   Section 6.1 of the Proxy Mobile IPv6 specification\
    \ [RFC5213].  To\n   support this specification, the conceptual Binding Update\
    \ List entry\n   data structure must be extended with the following four new\n\
    \   additional fields.\n   o  A flag (GRE-encapsulation-enabled) is used for indicating\
    \ whether\n      GRE encapsulation is enabled for the mobile node's traffic.\n\
    \   o  The downlink GRE key used in the GRE encapsulation header of the\n    \
    \  tunneled payload packet from the local mobility anchor to the\n      mobile\
    \ access gateway that is destined to the mobile node.  This\n      GRE key is\
    \ generated by the mobile access gateway and communicated\n      to the local\
    \ mobility anchor in the GRE Key option in the Proxy\n      Binding Update message.\n\
    \   o  The uplink GRE key used in the GRE encapsulation header of the\n      tunneled\
    \ payload packet from the mobile access gateway to the\n      local mobility anchor\
    \ that is originating from the mobile node.\n      This GRE key is obtained from\
    \ the GRE Key Identifier field of the\n      GRE Key option present in the received\
    \ Proxy Binding\n      Acknowledgement message sent by the local mobility anchor\
    \ as\n      specified in this document.\n   o  A flag indicating whether UDP-based\
    \ TLV-header format\n      (Section 7.2) is enabled for the mobile node's traffic.\
    \  This flag\n      is TRUE only when UDP tunneling as in [RFC5844] and GRE\n\
    \      encapsulation as in this specification are both enabled for this\n    \
    \  mobility session.\n"
- title: 4.2.  Operational Summary
  contents:
  - "4.2.  Operational Summary\n   o  If the mobile access gateway determines that\
    \ GRE encapsulation\n      mode only is required, the mobile access gateway MUST\
    \ include the\n      GRE Key option but omit the GRE Key Identifier field in the\
    \ Proxy\n      Binding Update message that is sent to the local mobility anchor.\n\
    \   o  If the mobile access gateway determines that GRE encapsulation and\n  \
    \    GRE keys are required, the mobile access gateway MUST include the\n     \
    \ GRE Key option with the downlink GRE key in the GRE Key Identifier\n      field\
    \ in the Proxy Binding Update message that is sent to the\n      local mobility\
    \ anchor.\n   o  After receiving a successful Proxy Binding Acknowledgement message\n\
    \      with the GRE Key option with the GRE Key Identifier field omitted,\n  \
    \    the mobile access gateway MUST update the mobile node's Binding\n      Update\
    \ List entry described in Section 4.1 by only setting the\n      GRE-encapsulation-enabled\
    \ flag.\n   o  After receiving a successful Proxy Binding Acknowledgement message\n\
    \      with the GRE Key option and the uplink GRE key included in the GRE\n  \
    \    Key Identifier field, the mobile access gateway MUST update the\n      related\
    \ fields in the mobile node's Binding Update List entry\n      described in Section\
    \ 4.1.  Additionally, the mobile access gateway\n      MUST use the assigned uplink\
    \ GRE Key for tunneling all the traffic\n      that belongs to this mobile node\
    \ BUL entry and that originated\n      from the mobile node before forwarding\
    \ the tunneled traffic to the\n      local mobility anchor.\n   o  If the mobile\
    \ access gateway includes the GRE Key option in the\n      Proxy Binding Update\
    \ for a specific mobile node and the local\n      mobility anchor accepts the\
    \ Proxy Binding Update by sending a\n      Proxy Binding Acknowledgement with\
    \ a success status code (less\n      than 128) other than GRE_KEY_OPTION_NOT_REQUIRED,\
    \ but without the\n      GRE Key option, then the mobile access gateway MUST consider\
    \ that\n      the local mobility anchor does not support the GRE Key option as\n\
    \      per this specification.  The mobile access gateway SHOULD NOT\n      include\
    \ the GRE Key option in any subsequent Proxy Binding Update\n      message that\
    \ is sent to that local mobility anchor.\n   o  If the mobile access gateway sent\
    \ a Proxy Binding Update message\n      without the GRE Key option, but the received\
    \ Proxy Binding\n      Acknowledgement has the status code GRE_KEY_OPTION_REQUIRED,\n\
    \      indicating that GRE encapsulation and GRE keys are required, the\n    \
    \  mobile access gateway SHOULD resend the Proxy Binding Update\n      message\
    \ with the GRE Key option.  If the mobile access gateway\n      does not support\
    \ the GRE Key option, it MAY log the event and\n      possibly raise an alarm\
    \ to indicate a possible misconfiguration.\n   o  If the mobile access gateway\
    \ sent a Proxy Binding Update message\n      with the GRE Key option and the downlink\
    \ GRE key included and\n      received a successful Proxy Binding Acknowledgement\
    \ message with\n      the status code GRE_KEY_OPTION_NOT_REQUIRED, the mobile\
    \ access\n      gateway MUST consider that GRE encapsulation and GRE keys are\
    \ not\n      required for this specific mobility session.  The mobile access\n\
    \      gateway follows procedures in the Proxy Mobile IPv6 specification\n   \
    \   [RFC5213] for the handling of uplink and downlink traffic and MUST\n     \
    \ NOT include the GRE Key option in any subsequent Proxy Binding\n      Update\
    \ message that is sent to the local mobility anchor for this\n      mobility session.\n\
    \   o  If the mobile access gateway has successfully negotiated GRE\n      encapsulation\
    \ and exchanged the GRE keys with the local mobility\n      anchor for a specific\
    \ mobility session, the mobile access gateway\n      SHOULD NOT include the GRE\
    \ Key option in the de-registration Proxy\n      Binding Update.\n   o  On receiving\
    \ a packet from the tunnel with the GRE header, the\n      mobile access gateway\
    \ MUST use the GRE key present in the GRE\n      extension header as an additional\
    \ identifier to determine to which\n      mobility session this packet belongs.\
    \  The GRE header is removed\n      before further processing takes place.\n"
- title: 5.  Local Mobility Anchor Considerations
  contents:
  - '5.  Local Mobility Anchor Considerations

    '
- title: 5.1.  Extensions to the Binding Cache Entry
  contents:
  - "5.1.  Extensions to the Binding Cache Entry\n   When the local mobility anchor\
    \ and the mobile access gateway\n   successfully negotiate GRE encapsulation and\
    \ exchange downlink and\n   uplink GRE keys, the local mobility anchor MUST maintain\
    \ the downlink\n   and uplink GRE keys as part of the mobile node's BCE.  This\
    \ requires\n   the BCE described in Section 5.1 of the Proxy Mobile IPv6\n   specification\
    \ [RFC5213] to be extended.  To support this\n   specification, the BCE must be\
    \ extended with the following four\n   additional fields.\n   o  A flag indicating\
    \ whether GRE encapsulation is enabled for the\n      mobile node's traffic flows.\n\
    \   o  The downlink GRE key, assigned by the mobile access gateway and\n     \
    \ used in the GRE encapsulation header of the tunneled payload\n      packet from\
    \ the local mobility anchor to the mobile access\n      gateway.\n   o  The uplink\
    \ GRE key, assigned by the local mobility anchor and used\n      in the GRE encapsulation\
    \ header of the tunneled payload packet\n      from the mobile access gateway\
    \ to the local mobility anchor.\n   o  A flag indicating whether UDP-based TLV-header\
    \ format\n      (Section 7.2) is enabled for the mobile node's traffic.  This\
    \ flag\n      is TRUE only when UDP tunneling as in [RFC5844] and GRE\n      encapsulation\
    \ as in this specification are both enabled for this\n      mobility session.\n"
- title: 5.2.  Operational Summary
  contents:
  - "5.2.  Operational Summary\n   o  If the local mobility anchor successfully processes\
    \ a Proxy\n      Binding Update message with the GRE Key option, but the GRE Key\n\
    \      Identifier field is omitted for initial GRE key exchange, the\n      local\
    \ mobility anchor MUST include the GRE Key option but omit the\n      GRE Key\
    \ Identifier field when responding with a successful Proxy\n      Binding Acknowledgement\
    \ message.\n   o  If the local mobility anchor successfully processes a Proxy\n\
    \      Binding Update message with the GRE Key option and the downlink\n     \
    \ GRE key included in the GRE Key Identifier field for initial GRE\n      key\
    \ exchange as in Section 3.3.1, the local mobility anchor MUST\n      include\
    \ the GRE Key option with the uplink GRE key included in the\n      GRE Key Identifier\
    \ field when responding with a successful Proxy\n      Binding Acknowledgement\
    \ message.\n   o  If the GRE tunneling is negotiated and the downlink and uplink\
    \ GRE\n      keys have been exchanged between the mobile access gateway and the\n\
    \      local mobility anchor for a specific mobility session, the local\n    \
    \  mobility anchor MUST use the negotiated downlink GRE key in the\n      GRE\
    \ header of every packet that is destined to the mobile node of\n      this specific\
    \ mobility session over the GRE tunnel to the mobile\n      access gateway.\n\
    \   o  If the received Proxy Binding Update message does not contain the\n   \
    \   GRE Key option, and if the local mobility anchor based on a policy\n     \
    \ check determines that GRE encapsulation and GRE keys are required,\n      e.g.,\
    \ overlapping IPv4 private addressing is in use, a local\n      mobility anchor\
    \ local policy, or LMA-MAG peer agreement, the local\n      mobility anchor MUST\
    \ reject the request and send a Proxy Binding\n      Acknowledgement message to\
    \ the mobile access gateway with the\n      status code GRE_KEY_OPTION_REQUIRED\
    \ as defined in Section 6.4.\n      This indicates that GRE encapsulation and\
    \ GRE keys are required.\n   o  If, after receiving and successfully processing\
    \ a Proxy Binding\n      Update message with the GRE Key option, the local mobility\
    \ anchor\n      determines, based on a policy check, that GRE encapsulation and\n\
    \      GRE keys are not required for this specific binding, e.g., private\n  \
    \    IPv4 addressing is not in use, the local mobility anchor SHOULD\n      send\
    \ a successful Proxy Binding Acknowledgement message to the\n      mobile access\
    \ gateway with the status code\n      GRE_KEY_OPTION_NOT_REQUIRED.  In this case,\
    \ the local mobility\n      anchor MUST NOT include the GRE Key option in the\
    \ Proxy Binding\n      Acknowledgement.\n   o  If the local mobility anchor successfully\
    \ processes a de-\n      registration Proxy Binding Update message, the local\
    \ mobility\n      anchor follows the same de-registration process as described\
    \ in\n      the Proxy Mobile IPv6 specification [RFC5213] to clean the Binding\n\
    \      Cache entry and all associated resources including the downlink\n     \
    \ and uplink GRE keys.\n   o  On receiving a packet from the tunnel with the GRE\
    \ header, the\n      local mobility anchor MUST use the GRE key in the GRE extension\n\
    \      header as an additional identifier to determine to which mobility\n   \
    \   session this packet belongs.  The GRE header is removed before\n      further\
    \ processing takes place.\n"
- title: 6.  Message Formats
  contents:
  - "6.  Message Formats\n   This section defines an extension to the Mobile IPv6\
    \ protocol\n   [RFC3775] messages.  The use of the GRE Key option for supporting\
    \ GRE\n   tunneling and GRE key exchange for Proxy Mobile IPv6 is defined in\n\
    \   this specification.\n"
- title: 6.1.  GRE Key Option
  contents:
  - "6.1.  GRE Key Option\n   A new mobility option, the GRE Key option, is defined\
    \ for use in the\n   Proxy Binding Update and Proxy Binding Acknowledgement messages\n\
    \   exchanged between the mobile access gateway and the local mobility\n   anchor.\
    \  This option can be used for negotiating GRE encapsulation\n   mode only or\
    \ GRE encapsulation and exchanging the downlink and uplink\n   GRE keys.  These\
    \ GRE keys can be used by the peers in all GRE\n   encapsulated payload packets\
    \ for marking that specific mobile node's\n   data traffic.\n   The alignment\
    \ requirement for this option is 4n.\n       0                   1           \
    \        2                   3\n       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9\
    \ 0 1 2 3 4 5 6 7 8 9 0 1\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      |      Type     |   Length      |           Reserved            |\n   \
    \   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n      |\
    \                      GRE Key Identifier                       |\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \                         Figure 2: GRE Key Option\n   Type\n      33\n   Length\n\
    \      An 8-bit unsigned integer indicating the length in octets of the\n    \
    \  option, excluding the Type and Length fields.  If the Length field\n      is\
    \ set to 2, it indicates that the GRE Key Identifier field is not\n      being\
    \ carried in the option.  If the Length field is set to a\n      value of 6, it\
    \ means that either the downlink or the uplink GRE\n      key is carried.\n  \
    \ Reserved\n      These fields are unused.  They MUST be initialized to zero by\
    \ the\n      sender and MUST be ignored by the receiver.\n   GRE Key Identifier\n\
    \      A 32-bit field containing the downlink or the uplink GRE key.\n      This\
    \ field is present in the GRE Key option only if the GRE keys\n      are being\
    \ exchanged using the Proxy Binding Update and Proxy\n      Binding Acknowledgement\
    \ messages.\n"
- title: 6.2.  Proxy Binding Update Message Extension
  contents:
  - "6.2.  Proxy Binding Update Message Extension\n   This specification extends the\
    \ Proxy Binding Update message as\n   defined in [RFC5213] with the new TLV-header\
    \ format (T) flag.  The\n   new (T) flag is described below and shown as part\
    \ of the Proxy\n   Binding Update message as in Figure 3.\n       0          \
    \         1                   2                   3\n       0 1 2 3 4 5 6 7 8\
    \ 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n                            \
    \          +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n                               \
    \       |          Sequence #           |\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      |A|H|L|K|M|R|P|F|T|  Reserved   |           Lifetime            |\n   \
    \   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n      \
    \            Figure 3: Proxy Binding Update Message\n   TLV-header format (T)\n\
    \      When set, this flag indicates that the mobile access gateway\n      requests\
    \ the use of the TLV header for encapsulating IPv6 or IPv4\n      packets in IPv4.\
    \  The TLV-header format is described in\n      Section 7.2.  None of the other\
    \ fields or flags in the Proxy\n      Binding Update are modified by this specification.\n"
- title: 6.3.  Proxy Binding Acknowledgement Message Extension
  contents:
  - "6.3.  Proxy Binding Acknowledgement Message Extension\n   This specification\
    \ extends the Proxy Binding Acknowledgement message\n   as defined in [RFC5213]\
    \ with the new TLV-header format (T) flag.  The\n   new (T) flag is described\
    \ below and shown as part of the Proxy\n   Binding Acknowledgement message as\
    \ in Figure 4.\n       0                   1                   2             \
    \      3\n       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0\
    \ 1\n                                      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \                                      |    Status     |K|R|P|T|   Res |\n   \
    \   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n      |\
    \           Sequence #          |           Lifetime            |\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \              Figure 4: Proxy Binding Acknowledgement Message\n   TLV-header\
    \ format (T)\n      When set, this flag indicates that the sender of the Proxy\
    \ Binding\n      Acknowledgement, the LMA, supports tunneling IPv6-or-IPv4 in\
    \ IPv4\n      using TLV-header format.  None of the other fields or flags in the\n\
    \      Proxy Binding Acknowledgement are modified by this specification.\n"
- title: 6.4.  Status Codes
  contents:
  - "6.4.  Status Codes\n   The following status code values are defined for use in\
    \ the Binding\n   Acknowledgement message when using Proxy Mobile IPv6.\n   GRE_KEY_OPTION_NOT_REQUIRED\
    \ (2)\n      When the local mobility anchor receives a Proxy Binding Update\n\
    \      with the GRE Key option, and based on a policy check it determines\n  \
    \    that GRE encapsulation is not required for this specific mobility\n     \
    \ session, it uses this code to indicate to the mobile access\n      gateway that\
    \ the Proxy Binding Update has been processed\n      successfully but GRE encapsulation\
    \ and GRE keys are not required.\n   GRE_TUNNELING_BUT_TLV_HEADER_NOT_SUPPORTED\
    \ (3)\n      If the local mobility anchor receives a Proxy Binding Update with\n\
    \      the GRE Key option and TLV-header format (T) flag set, the local\n    \
    \  mobility anchor uses this code to indicate to the mobile access\n      gateway\
    \ that GRE encapsulation has been successfully negotiated\n      but TLV-header\
    \ format is NOT supported.\n   GRE_KEY_OPTION_REQUIRED (163)\n      When the local\
    \ mobility anchor receives a Proxy Binding Update\n      without the GRE Key option\
    \ while based on a policy check, the\n      local mobility anchor determines that\
    \ GRE encapsulation is\n      required for this specific mobility session and\
    \ uses this code to\n      reject the Proxy Binding Update and indicate to the\
    \ mobile access\n      gateway that GRE encapsulation and GRE keys are required.\n"
- title: 7.  Data Packets Processing Considerations
  contents:
  - "7.  Data Packets Processing Considerations\n   This section describes how the\
    \ local mobility anchor and mobile\n   access gateway encapsulate and decapsulate\
    \ data packets when GRE\n   encapsulation and GRE keys are used for tunneling\
    \ the mobile node's\n   data traffic between these two mobile nodes.\n"
- title: 7.1.  Tunneling Format
  contents:
  - "7.1.  Tunneling Format\n   When GRE encapsulation is used, the mobile access\
    \ gateway is allowed\n   to use various tunneling formats depending on the mobile\
    \ access\n   gateway location and the network capabilities between the mobile\n\
    \   access gateway and the local mobility anchor.  Using GRE\n   encapsulation,\
    \ as described in [RFC2784] and [RFC2890], the mobile\n   access gateway can tunnel\
    \ the IPv6-or-IPv4 payload packet in IPv6 or\n   in IPv4 following the rules in\
    \ [RFC5213] and [RFC5844].\n   If UDP-based tunneling is used in conjunction with\
    \ GRE encapsulation\n   between the mobile access gateway and the local mobility\
    \ anchor, the\n   TLV-header UDP tunneling format as shown in Figure 5 MUST be\
    \ used.\n         [IPv4 Header]\n         [UDP Header]\n         [TLV Header]\n\
    \         [GRE Header]\n         [Payload - IPv6 or IPv4 Header]\n         Upper\
    \ Layer protocols\n         Figure 5: TLV-Header UDP-Based Encapsulation Header\
    \ Order\n   When a UDP-based tunneling format is used between the mobile access\n\
    \   gateway and the local mobility anchor, the use of the TLV header is\n   negotiated\
    \ during the Proxy Binding Update/Acknowledgement exchange\n   as described in\
    \ Sections 7.3 and 7.4.  If the TLV-header format is\n   agreed upon between the\
    \ mobile access gateway and local mobility\n   anchor, the local mobility anchor\
    \ expects the TLV header to follow\n   the UDP header as shown in Figure 5.  The\
    \ TLV header contains the\n   Type field, the following payload packet header\
    \ type, and its length.\n   The Type field in the TLV header is always set to\
    \ a value of 0 to\n   enhance the processing of the received packet by ensuring\
    \ that the\n   receiver can differentiate whether what came after the UDP header\
    \ is\n   a TLV-header Type field or an IP version field of an IP header.\n   Hence,\
    \ the TLV header can carry traffic other than IP as indicated in\n   the Next\
    \ Header field.  The distinction between IP and TLV\n   encapsulation is needed,\
    \ because the Proxy Binding Update (IP packet)\n   and the data packets (GRE packets)\
    \ can be sent over the same UDP\n   tunnel.\n   When processing a UDP packet with\
    \ the TLV-header format, if the\n   receiving node found that the payload packet\
    \ length as calculated\n   from the UDP header length field is different than\
    \ its length as\n   calculated from the TLV-header length field, the receiving\
    \ node MUST\n   discard the received IP packet.\n"
- title: 7.2.  TLV-Header Tunneling Negotiation
  contents:
  - "7.2.  TLV-Header Tunneling Negotiation\n   The mobile access gateway negotiates\
    \ the format for tunneling payload\n   traffic during the Proxy Mobile IPv6 registration\
    \ procedure.  If the\n   mobile access gateway is required to use the TLV-header\
    \ UDP\n   encapsulation format, the mobile access gateway MUST set the TLV-\n\
    \   header format (T) flag in the Proxy Binding Update message sent to\n   the\
    \ local mobility anchor.  If the local mobility anchor supports the\n   TLV-header\
    \ UDP tunneling format, the local mobility anchor SHOULD set\n   the TLV-header\
    \ format (T) flag in the Proxy Binding Acknowledgement.\n   Otherwise, the TLV-header\
    \ format (T) flag is cleared.  The setting of\n   the TLV-header Format (T) flag\
    \ in the Proxy Binding Acknowledgement\n   indicates to the mobile access gateway\
    \ that it MUST use the TLV-\n   header UDP encapsulation format for all packets\
    \ tunneled to the local\n   mobility anchor for the entire duration the mobile\
    \ node is attached\n   to the mobile access gateway.  The TLV-header UDP tunneling\
    \ format\n   SHOULD NOT change during a Binding Lifetime Extension Proxy Binding\n\
    \   Update (re-registration) from the same mobile access gateway.\n   Any Proxy\
    \ Binding Update message triggered by a handoff (Section\n   5.3.4 of [RFC5213])\
    \ may renegotiate the tunneling format.  Therefore,\n   in order to avoid interoperability\
    \ issues, the local mobility anchor\n   MUST NOT set the TLV-header format (T)\
    \ flag unless it was set in the\n   Proxy Binding Update received from the mobile\
    \ access gateway.\n   The TLV-header format is as shown below in Figure 6.\n \
    \      0                   1                   2                   3\n       0\
    \ 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      | Type  |  Res. |  Next Header  |            Length             |\n   \
    \   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n      \
    \                  Figure 6: TLV-Header Format\n   Type\n      This field is always\
    \ 0 (zero) and distinguishes the TLV header\n      from the IPv4 and IPv6 headers.\n\
    \   Res.\n      These fields are Reserved and unused.  They MUST be initialized\
    \ to\n      zero by the sender and MUST be ignored by the receiver.\n   Next Header\n\
    \      An 8-bit unsigned integer that indicates the protocol number of\n     \
    \ the payload header following this TLV header.  It is set to the\n      protocol\
    \ number as assigned by IANA in the \"Assigned Internet\n      Protocol Numbers\"\
    \ registry.  For example, if an IPv6 header\n      follows, it should be '41';\
    \ if a GRE header follows, it should be\n      '47'.\n   Length\n      A 16-bit\
    \ unsigned integer indicating the length in octets of the\n      payload following\
    \ this header, excluding the TLV header itself.\n"
- title: 7.3.  Mobile Access Gateway Operation
  contents:
  - "7.3.  Mobile Access Gateway Operation\n   When sending a Proxy Binding Update\
    \ message over an IPv4 transport\n   network, the mobile access gateway follows\
    \ the procedures specified\n   in [RFC5844] for using IPv4-UDP encapsulation mode.\
    \  However, when\n   using GRE header in conjunction with IPv4-UDP encapsulation\
    \ mode is\n   required, the mobile access gateway MUST set the TLV-header format\n\
    \   (T) flag in the Proxy Binding Update and follow this specification\n   for\
    \ GRE encapsulation negotiation.  If the received Proxy Binding\n   Acknowledgement\
    \ is successful and the TLV-header format (T) flag is\n   set and the GRE Key\
    \ option included, the mobile access gateway MUST\n   update the mobile node's\
    \ Binding Update List entry described in\n   Section 4.1 by setting the UDP-based\
    \ TLV-header format (T) flag.  In\n   this case, the mobile access gateway MUST\
    \ use the TLV-header UDP-\n   based encapsulation format as shown in Figure 5.\n\
    \   If the mobile access gateway receives a Proxy Binding Acknowledgement\n  \
    \ with the status GRE_TUNNELING_BUT_TLV_HEADER_NOT_SUPPORTED in\n   response to\
    \ a Proxy Binding Update with the GRE Key option and the\n   (T) flag set, the\
    \ mobile access gateway MUST use GRE encapsulation\n   without UDP encapsulation.\
    \  If the mobile access gateway is allowed\n   to use GRE encapsulation without\
    \ UDP tunneling, the mobile access\n   gateway MUST update the mobile node's Binding\
    \ Update List entry\n   described in Section 4.1 by setting the GRE-encapsulation-enabled\n\
    \   flag and the uplink and downlink GRE key fields.  In this case, the\n   mobile\
    \ access gateway MUST set the UDP-based TLV-header format (T)\n   flag to FALSE.\
    \  A Proxy Binding Acknowledgement message with the\n   status code GRE_TUNNELING_BUT_TLV_HEADER_NOT_SUPPORTED\
    \ has the (T)\n   flag cleared.  Alternatively, the mobile access gateway may\
    \ resend\n   the Proxy Binding Update to negotiate different tunneling options,\n\
    \   e.g., using UDP-based tunneling without GRE encapsulation if possible\n  \
    \ or de-register the mobile node mobility session.\n"
- title: 7.3.1.  Sending and Receiving Data Packets
  contents:
  - "7.3.1.  Sending and Receiving Data Packets\n   When the mobile access gateway\
    \ is located in an IPv6-enabled or IPv4-\n   enabled network, it may be required\
    \ to use GRE encapsulation for\n   tunneling IPv6 or IPv4 data packets to the\
    \ local mobility anchor.  In\n   this case, and if the mobile access gateway has\
    \ successfully\n   negotiated GRE encapsulation mode only or GRE encapsulation\
    \ and GRE\n   keys as described in this specification, the mobile access gateway\n\
    \   encapsulates or decapsulates IPv6-or-IPv4 payload packets following\n   the\
    \ rules described in [RFC5213] and [RFC5844] while ensuring that\n   the GRE header\
    \ is present as shown in Figure 7.\n         [IPv6 or IPv4 Header]\n         [GRE\
    \ Header]\n         [Payload - IPv6 or IPv4 Header]\n         Upper Layer protocols\n\
    \         Figure 7: IPv6-or-IPv4 over IPv4 Using GRE Encapsulation\n   On the\
    \ other hand, if the mobile access gateway is located in an\n   IPv4-only network\
    \ where NAT has been detected on the path between the\n   mobile access gateway\
    \ and the local mobility anchor and successfully\n   negotiated GRE encapsulation\
    \ and the TLV-header format, the mobile\n   access gateway MUST use UDP TLV-header\
    \ tunneling format when sending\n   an IPv6-or-IPv4 payload packet to the local\
    \ mobility anchor according\n   to the format described in Figure 5.  The source\
    \ and the destination\n   of the IPv4 outer header are mobile node IPv4 Proxy\
    \ Care-of Address,\n   IPv4-Proxy-CoA, and the IPv4 local mobility anchor address,\
    \ IPv4-\n   LMAA, respectively.  In addition, the source and the destination IP\n\
    \   addresses of the IPv6-or-IPv4 payload data packet are the mobile\n   node's\
    \ IPv6-or-IPv4 home address, IPv6/IPv4-MN-HoA, and the IPv6-or-\n   IPv4 corresponding\
    \ node's address, IPv6/IPv4-CN-Addr, respectively.\n"
- title: 7.4.  Local Mobility Anchor Operation
  contents:
  - "7.4.  Local Mobility Anchor Operation\n   When the local mobility anchor receives\
    \ a Proxy Binding Update\n   encapsulated in UDP and containing the IPv4 Home\
    \ Address Request\n   option ([RFC5844]), it needs to follow all the steps in\
    \ [RFC5213] and\n   [RFC5844].  In addition, if the TLV-header format (T) flag\
    \ is set in\n   the Proxy Binding Update, the local mobility anchor needs to\n\
    \   determine whether it can accept the TLV-header UDP-based\n   encapsulation\
    \ format.  If it does, it SHOULD set the TLV-header\n   format (T) flag in the\
    \ Proxy Binding Acknowledgement.  Otherwise, the\n   local mobility anchor MUST\
    \ NOT set the TLV-header format (T) flag in\n   the Proxy Binding Acknowledgement.\n\
    \   If the local mobility anchor (LMA) receives a Proxy Binding Update\n   with\
    \ the GRE Key option and TLV-header format (T) flag set and, based\n   on a policy\
    \ check, the LMA determines that GRE encapsulation is\n   required and the LMA\
    \ supports TLV-header tunneling and the LMA sent a\n   successful Proxy Binding\
    \ Acknowledgement with the TLV-header format\n   (T) flag set, the LMA MUST update\
    \ the mobile node's Binding Cache\n   entry described in Section 5.1 by setting\
    \ the GRE-encapsulation-\n   enabled flag and update the uplink and downlink GRE\
    \ key fields.  In\n   addition, the LMA MUST set the UDP-based TLV-header format\
    \ flag.\n   If the LMA receives a Proxy Binding Update with the GRE Key option\n\
    \   and TLV-header format (T) flag set and, based on a policy check, the\n   LMA\
    \ determines that GRE encapsulation is required BUT the LMA does\n   NOT support\
    \ TLV-header tunneling and if the Proxy Binding Update has\n   been successfully\
    \ processed, the LMA MUST send a successful Proxy\n   Binding Acknowledgement\
    \ with the status code\n   GRE_TUNNELING_BUT_TLV_HEADER_NOT_SUPPORTED.  This way,\
    \ the LMA\n   indicates to the mobile access gateway that GRE encapsulation has\n\
    \   been successfully negotiated BUT TLV-header UDP-based tunneling\n   format\
    \ is not supported.  In this case, the LMA MUST update the\n   mobile node's BCE\
    \ described in Section 5.1 by setting the GRE\n   encapsulation enabled flag and\
    \ update the uplink and downlink GRE key\n   fields.  In this case, the LMA MUST\
    \ set the UDP-based TLV-header\n   format flag to FALSE.\n   If the local mobility\
    \ anchor and the mobile access gateway have\n   successfully negotiated the TLV-header\
    \ UDP-based tunneling format and\n   GRE encapsulation for a specific mobility\
    \ session, the local mobility\n   anchor processes data packets as described in\
    \ the following\n   subsection.\n"
- title: 7.4.1.  Sending and Receiving Data Packets
  contents:
  - "7.4.1.  Sending and Receiving Data Packets\n   The local mobility anchor may\
    \ use GRE encapsulation for tunneling an\n   IPv6 or IPv4 data packet to the mobile\
    \ access gateway.  If the local\n   mobility anchor has successfully negotiated\
    \ GRE encapsulation with\n   the mobile access gateway for a specific mobility\
    \ session, the local\n   mobility anchor encapsulates and decapsulates IPv6-or-IPv4\
    \ payload\n   data packets following the rules described in [RFC5213] and [RFC5844]\n\
    \   while ensuring that the GRE header is present as shown in Figure 7.\n   In\
    \ the case when TLV-tunneling format and GRE encapsulation for a\n   specific\
    \ mobility session have been successfully negotiated between\n   the local mobility\
    \ anchor and the mobile access gateway, the local\n   mobility anchor follows\
    \ the TLV-header UDP-based tunneling format and\n   header order as shown in Figure\
    \ 5 to encapsulate IPv4 or IPv6 payload\n   packets in IPv4 before sending the\
    \ IPv4 packet to the mobile access\n   gateway.  In this case, the source and\
    \ the destination of the IPv4\n   outer header are IPv4-LMAA and IPv4-Proxy-CoA,\
    \ respectively.  In\n   addition, the source and the destination IP addresses\
    \ of the IPv6-or-\n   IPv4 payload data packet are IPv6/IPv4-CN-Addr and IPv6/IPv4-MN-HoA,\n\
    \   respectively.  On the other hand, the local mobility anchor ensures\n   the\
    \ same TLV-header UDP-based tunneling format and header order when\n   it decapsulates\
    \ received IPv4 packets from the mobile access gateway\n   for the same mobility\
    \ session.\n"
- title: 8.  IANA Considerations
  contents:
  - "8.  IANA Considerations\n   This specification defines a new mobility option,\
    \ the GRE Key option,\n   described in Section 6.1.  This option is carried in\
    \ the Mobility\n   Header.  The type value for this option has been assigned from\
    \ the\n   same numbering space as allocated for the other mobility options\n \
    \  defined in the Mobile IPv6 specification [RFC3775].\n   This specification\
    \ also defines three new Binding Acknowledgement\n   status codes as described\
    \ in Section 6.4 and IANA has allocated the\n   numeric values as specified in\
    \ Section 6.4 from the \"Status Codes\"\n   registry of the Mobility IPv6 Parameters.\n"
- title: 9.  Security Considerations
  contents:
  - "9.  Security Considerations\n   The GRE Key option, defined in this specification,\
    \ when carried in\n   Proxy Binding Update and Proxy Binding Acknowledgement messages,\n\
    \   reveals the group affiliation of a mobile node identified by its\n   Network\
    \ Access Identifier (NAI) or an IP address.  It may help an\n   attacker in targeting\
    \ flows belonging to a specific group.  This\n   vulnerability can be prevented,\
    \ by enabling confidentiality\n   protection on the Proxy Binding Update and Proxy\
    \ Binding\n   Acknowledgement messages where the presence of the NAI and GRE Key\n\
    \   options establish a mobile node's relation to a specific group.  This\n  \
    \ vulnerability can also be avoided by enabling confidentiality\n   protection\
    \ on all the tunneled data packets between the mobile access\n   gateway and the\
    \ local mobility anchor, for hiding all the markings.\n   In Proxy Mobile IPv6\
    \ [RFC5213], the use of IPsec [RFC4301] for\n   protecting a mobile node's data\
    \ traffic is optional.  Additionally,\n   Proxy Mobile IPv6 recommends the use\
    \ of Encapsulating Security\n   Payload (ESP) [RFC4303] in tunnel mode when using\
    \ ESP for protecting\n   the mobile node's data traffic.  However, when GRE encapsulation\
    \ is\n   used, both IPsec tunnel mode and transport mode can be used to\n   protect\
    \ the GRE header.  The IPsec traffic selectors will contain the\n   protocol number\
    \ for GRE, and there is currently no mechanism to use\n   the GRE key as a traffic\
    \ selector.\n"
- title: 10.  Acknowledgements
  contents:
  - "10.  Acknowledgements\n   The authors would like to thank Alessio Casati, Barney\
    \ Barnowski,\n   Mark Grayson, and Parviz Yegani for their input on the need for\
    \ this\n   option.  The authors would like to thank Charlie Perkins, Curtis\n\
    \   Provost, Irfan Ali, Jouni Korhonen, Julien Laganier, Kuntal\n   Chowdhury,\
    \ Suresh Krishnan, and Vijay Devarapalli for their review\n   and comments.\n"
- title: 11.  References
  contents:
  - '11.  References

    '
- title: 11.1.  Normative References
  contents:
  - "11.1.  Normative References\n   [RFC1918]  Rekhter, Y., Moskowitz, R., Karrenberg,\
    \ D., Groot, G., and\n              E. Lear, \"Address Allocation for Private\
    \ Internets\",\n              BCP 5, RFC 1918, February 1996.\n   [RFC2003]  Perkins,\
    \ C., \"IP Encapsulation within IP\", RFC 2003,\n              October 1996.\n\
    \   [RFC2119]  Bradner, S., \"Key words for use in RFCs to Indicate\n        \
    \      Requirement Levels\", BCP 14, RFC 2119, March 1997.\n   [RFC2473]  Conta,\
    \ A. and S. Deering, \"Generic Packet Tunneling in\n              IPv6 Specification\"\
    , RFC 2473, December 1998.\n   [RFC2784]  Farinacci, D., Li, T., Hanks, S., Meyer,\
    \ D., and P.\n              Traina, \"Generic Routing Encapsulation (GRE)\", RFC\
    \ 2784,\n              March 2000.\n   [RFC2890]  Dommety, G., \"Key and Sequence\
    \ Number Extensions to GRE\",\n              RFC 2890, September 2000.\n   [RFC3775]\
    \  Johnson, D., Perkins, C., and J. Arkko, \"Mobility Support\n              in\
    \ IPv6\", RFC 3775, June 2004.\n   [RFC5213]  Gundavelli, S., Leung, K., Devarapalli,\
    \ V., Chowdhury, K.,\n              and B. Patil, \"Proxy Mobile IPv6\", RFC 5213,\
    \ August 2008.\n   [RFC5844]  Wakikawa, R. and S. Gundavelli, \"IPv4 Support for\
    \ Proxy\n              Mobile IPv6\", RFC 5844, May 2010.\n"
- title: 11.2.  Informative References
  contents:
  - "11.2.  Informative References\n   [RFC4301]  Kent, S. and K. Seo, \"Security\
    \ Architecture for the\n              Internet Protocol\", RFC 4301, December\
    \ 2005.\n   [RFC4303]  Kent, S., \"IP Encapsulating Security Payload (ESP)\",\n\
    \              RFC 4303, December 2005.\n   [RFC5648]  Wakikawa, R., Devarapalli,\
    \ V., Tsirtsis, G., Ernst, T.,\n              and K. Nagami, \"Multiple Care-of\
    \ Addresses Registration\",\n              RFC 5648, October 2009.\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Ahmad Muhanna\n   Ericsson, Inc.\n   2201 Lakeside Blvd.\n\
    \   Richardson, TX  75082\n   USA\n   EMail: ahmad.muhanna@ericsson.com\n   Mohamed\
    \ Khalil\n   Ericsson, Inc.\n   6300 Legacy Dr.\n   Plano, TX  75024\n   USA\n\
    \   EMail: Mohamed.khalil@ericsson.com\n   Sri Gundavelli\n   Cisco\n   170 West\
    \ Tasman Drive\n   San Jose, CA  95134\n   USA\n   EMail: sgundave@cisco.com\n\
    \   Kent Leung\n   Cisco\n   170 West Tasman Drive\n   San Jose, CA  95134\n \
    \  USA\n   EMail: kleung@cisco.com\n"
