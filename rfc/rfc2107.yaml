- title: __initial_text__
  contents:
  - '                Ascend Tunnel Management Protocol - ATMP

    '
- title: Status of this Memo
  contents:
  - "Status of this Memo\n   This memo provides information for the Internet community.\
    \  This memo\n   does not specify an Internet standard of any kind.  Distribution\
    \ of\n   this memo is unlimited.\n   This note documents a private protocol for\
    \ tunnel management.  This\n   protocol is NOT the product of an IETF working\
    \ group nor is it a\n   standards track document. There is ongoing effort in an\
    \ IETF working\n   group which could result in a standards track document which\n\
    \   specifies a protocol which provides similar functionality.\n"
- title: Abstract
  contents:
  - "Abstract\n   This document specifies a generic tunnel management protocol that\n\
    \   allows remote dial-in users to access their home network as if they\n   were\
    \ directly attached to the home network.  The user's client\n   software uses\
    \ an address contained in the home network address space\n   for the remote access.\
    \  Packets to and from the home network are\n   tunneled by the Network Access\
    \ Server (NAS) to which the user\n   connects and a Home Agent (HA) on the user's\
    \ home network.  This\n   allows for the support of access to Virtual Private\
    \ Networks and also\n   allows for the use of protocols other than IP to be carried\
    \ over the\n   tunnel.  An example of how the RADIUS (Remote Authentication Dial\
    \ In\n   User Service) can be used to provide the necessary configuration\n  \
    \ information to support this service is also provided.\n"
- title: 1. Introduction
  contents:
  - "1. Introduction\n   The Ascend Tunnel Management Protocol (ATMP) is a protocol\
    \ currently\n   being used in Ascend Communication products to allow dial-in client\n\
    \   software to obtain virtual presence on a user's home network from\n   remote\
    \ locations.  A user calls into a remote NAS but, instead of\n   using an address\
    \ belonging to a network directly supported by the\n   NAS, the client software\
    \ uses an address belonging to the user's\n   \"Home Network\".  This address\
    \ can be either provided by the client\n   software or assigned from a pool of\
    \ addresses from the Home Network\n   address space.  In either case, this address\
    \ belongs to the Home\n   Network and therefore special routing considerations\
    \ are required in\n   order to route packets to and from these clients.  A tunnel\
    \ between\n   the NAS and a special \"Home Agent\" (HA) located on the Home Network\n\
    \   is used to carry data to and from the client.\n   ATMP currently allows for\
    \ both IP and IPX protocols to be tunneled\n   between the NAS and the HA.  The\
    \ protocol to be used, the HA to use,\n   and other user specific information\
    \ is provided by some configuration\n   mechanism that is beyond the scope of\
    \ this document.  Appendix A\n   illustrates how RADIUS [5] is used to convey\
    \ this information to the\n   NAS.\n   The determination of the Home Network address\
    \ to be used can be\n   accomplished in different ways.  It could, for example,\
    \ be configured\n   in the client and negotiated by IPCP (or IPXCP).  Alternatively,\
    \ it\n   could be defined to be an address specific to the given user ID, or\n\
    \   it could be assigned from a pool of addresses provided by the Home\n   Network\
    \ for the purpose of remote dial-in access.  Again, how this\n   address is assigned\
    \ and how the NAS decides to invoke ATMP for a\n   specific call is beyond the\
    \ scope of this document.\n"
- title: 1.1 Protocol Goals and Assumptions
  contents:
  - "1.1 Protocol Goals and Assumptions\n   The ATMP protocol is implemented only\
    \ by the NAS and HA.  No other\n   systems need to be aware of ATMP.  All other\
    \ systems communicate in\n   the normal manner and are unaware that they may be\
    \ communicating with\n   remote clients.  The clients themselves are unaware of\
    \ ATMP.  It is\n   assumed that standard PPP [8] (or SLIP) clients are being used.\n\
    \   Unlike the mobile-IP protocol [3], ATMP assumes that a single NAS\n   will\
    \ provide the physical connection to a remote client for the\n   duration of the\
    \ session.  The client will not switch between NASes\n   expecting to keep the\
    \ same IP address and all associated sessions\n   active during these transitions.\
    \  A particular client can be\n   registered with a given HA only once at any\
    \ given time.\n   Deregistration with a HA implies loss of all higher layer sessions\n\
    \   for that client.\n   IP multicasting is currently not provided by ATMP.\n"
- title: 1.2 Terminology
  contents:
  - "1.2 Terminology\n   The terminology used in this document is similar to that\
    \ used in\n   mobile-IP.  As pointed out in the previous section, however, ATMP\n\
    \   provides a subset of the functionality provided by mobile-IP and the\n   meanings\
    \ of the various terms used herein have been modified\n   accordingly.\n     \
    \ Connection Profile\n         A table used to route packets other than by destination\n\
    \         address.  The Connection Profile is a named entity that\n         contains\
    \ information indicating how packets addressed to it are\n         to be routed.\
    \  It may be used to route packets to unregistered\n         IP addresses and\
    \ for routing protocols other than IP (e.g.,\n         IPX).\n      Foreign Agent\
    \ (FA)\n         A routing entity that resides in a NAS on a remote network that\n\
    \         allows a mobile node to utilize a home network address.  It\n      \
    \   tunnels datagrams to, and detunnels datagrams from, the home\n         agent\
    \ for the given home network.\n      Home Address\n         An address that is\
    \ assigned for an extended period of time to a\n         mobile node.  It may\
    \ remain unchanged regardless of where the\n         MN is attached to the Internet.\
    \  Alternatively, it could be\n         assigned from a pool of addresses.  The\
    \ management of this pool\n         is beyond the scope of this document.\n  \
    \    Home Agent (HA)\n         A router on a mobile node's home network which\
    \ tunnels\n         datagrams for delivery to, and detunnels datagrams from, a\n\
    \         mobile node when it is away from home.\n      Home Network\n       \
    \  The address space of the network to which a user logically\n         belongs.\
    \  When a workstation is physically connected to a LAN,\n         the LAN address\
    \ space is the user's home network.  ATMP\n         provides for a remote virtual\
    \ connection to a LAN.\n      Mobile Node (MN)\n         A host that wishes to\
    \ use a Home Network address while\n         physically connected by a point-to-point\
    \ link (phone line,\n         ISDN, etc.) to a NAS that does not reside on the\
    \ Home Network.\n         Also referred to as the client.\n      Mobility Binding\n\
    \         The association of a Home Address with a Foreign Agent IP\n        \
    \ address and a Tunnel ID.\n      Network Access Server (NAS)\n         A device\
    \ providing temporary, on-demand, network access to\n         users.  This access\
    \ is point-to-point using phone or ISDN\n         lines.\n      Tunnel\n     \
    \    The path followed by a datagram when it is encapsulated.  The\n         model\
    \ is that, while it is encapsulated, a datagram is routed\n         to a knowledgeable\
    \ decapsulation agent, which decapsulates the\n         datagram and then correctly\
    \ delivers it to its ultimate\n         destination.  Each mobile node connecting\
    \ to a home agent does\n         so over a unique tunnel, identified by a tunnel\
    \ identifier\n         which is unique to a given FA-HA pair.  A tunnel can carry\
    \ both\n         IP and IPX datagrams simultaneously.\n"
- title: 1.3 Protocol Overview
  contents:
  - "1.3 Protocol Overview\n   A mobile node that wishes to use a home address while\
    \ connected to a\n   remote NAS must register with the appropriate home agent.\
    \  The\n   foreign agent entity of the remote NAS performs this registration on\n\
    \   behalf of the MN.  Once registered, a tunnel is established between\n   the\
    \ FA and HA to carry datagrams to and from the MN.  While a MN is\n   registered\
    \ with an HA, the HA must intercept any packets destined for\n   the MN's home\
    \ address and forward them via the tunnel to the FA. When\n   the FA detects that\
    \ the MN has disconnected from the NAS, it issues a\n   deregister request to\
    \ the HA.\n   Because ATMP allows protocols other than IP to be carried on its\n\
    \   tunnels and also allows unregistered IP address to be used to provide\n  \
    \ for access to enterprise networks, the HA doesn't necessarily route\n   datagrams\
    \ received from the MN in the conventional manner.  The\n   registration request\
    \ allows for a named \"Connection Profile\" to be\n   specified in the registration\
    \ request.  This Connection Profile\n   contains configuration information that\
    \ tells the HA where to send\n   packets that it receives from the MN.\n"
- title: 1.4 Specification Language
  contents:
  - "1.4 Specification Language\n   In this document, several words are used to signify\
    \ the requirements\n   of the specification.  These words are often capitalized.\n\
    \      MUST               This word, or the adjective \"required\", means\n  \
    \                       that the definition is an absolute requirement\n     \
    \                    of the specification.\n      MUST NOT           This phrase\
    \ means that the definition is an\n                         absolute prohibition\
    \ of the specification.\n      SHOULD             This word, or the adjective\
    \ \"recommended\",\n                         means that, in some circumstances,\
    \ valid\n                         reasons may exist to ignore this item, but\n\
    \                         the full implications must be understood and\n     \
    \                    carefully weighed before choosing a different\n         \
    \                course.  Unexpected results may result\n                    \
    \     otherwise.\n      MAY                This word, or the adjective \"optional\"\
    , means\n                         that this item is one of an allowed set of\n\
    \                         alternatives.  An implementation which does\n      \
    \                   not include this option MUST be prepared to\n            \
    \             interoperate with another implementation which\n               \
    \          does include the option.\n      silently discard   The implementation\
    \ discards the datagram\n                         without further processing,\
    \ and without\n                         indicating an error to the sender.  The\n\
    \                         implementation SHOULD provide the capability of\n  \
    \                       logging the error, including the contents of\n       \
    \                  the discarded datagram, and SHOULD record the\n           \
    \              event in a statistics counter.\n"
- title: 2.0 Protocol Specification
  contents:
  - "2.0 Protocol Specification\n   ATMP defines a set of request and reply messages\
    \ sent with UDP [4].\n   The HA listens on UDP port 5150 [6]) for requests from\
    \ FA's.  The UDP\n   checksum field MUST be computed and verified.  There are\
    \ 7 different\n   ATMP message types represented by the following Type values:\n\
    \      Message Type            Type code\n      Registration Request         \
    \ 1\n      Challenge Request             2\n      Challenge Reply            \
    \   3\n      Registration Reply            4\n      Deregister Request       \
    \     5\n      Deregister Reply              6\n      Error Notification     \
    \       7\n"
- title: 2.1 Registration Request
  contents:
  - "2.1 Registration Request\n   The FA issues a Registration Request to request\
    \ the HA to establish a\n   mobility binding for the specified MN home address.\
    \  The request is\n   issued to the HA by the FA upon detecting a MN that wishes\
    \ to use a\n   home address supported by the HA receiving the request.\n   IP\
    \ fields\n      Source Address           The IP address of the foreign agent\n\
    \                               interface from which the request is\n        \
    \                       issued.\n      Destination Address      The IP address\
    \ of the home agent.\n   UDP fields:\n      Source Port              variable\n\
    \      Destination Port         5150  (or port number configured in FA\n     \
    \                          for given HA)\n   The UDP header is followed by the\
    \ ATMP fields shown below:\n       0                   1                   2 \
    \                  3\n       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4\
    \ 5 6 7 8 9 0 1\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      |    Version    |      Type     |         Identifier            |\n   \
    \   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n      |\
    \                         Foreign Agent                         |\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      |                          Mobile Node                          |\n   \
    \   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n      |\
    \                        Mobile Node Mask                       |\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      |                      Mobile Node IPX Net                      |\n   \
    \   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n      |Mobile\
    \ Node IPX Station  . . .\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \                                      |           reserved            |\n   \
    \   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n      |\
    \                        Home Network Name    . . .\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      Version                  The ATMP protocol version.  MUST be 1.\n     \
    \ Type                     1 for Registration Request.\n      Identifier     \
    \          A 16 bit number used to match replies\n                           \
    \    with requests.  A new value should be\n                               provided\
    \ in each new request.\n                               Retransmissions of the\
    \ same request\n                               should use the same identifier.\n\
    \      Foreign Agent            The IP address of the foreign agent\n        \
    \                       issuing the request (typically the same\n            \
    \                   as the UDP source address).\n      Mobile Node           \
    \   The IP address to be used by the mobile\n                               node.\
    \  This is the mobile node's home\n                               address.  This\
    \ field can be all 0's if\n                               IPX is to be tunneled\
    \ to the mobile node.\n      Mobile Node Mask         The network bit mask for\
    \ the mobile node.\n                               Currently this value should\
    \ be set to all\n                               1's.\n      Mobile Node IPX Net\
    \      The Network portion of the mobile node's\n                            \
    \   IPX address.  This value should be set to\n                              \
    \ all 0's if only IP is to be tunneled.\n      Mobile Node IPX Station  The 6\
    \ octet value used to represent the\n                               station portion\
    \ of the mobile node's IPX\n                               address.  This value\
    \ should be set to all\n                               0's if only IP is to be\
    \ tunneled instead\n                               of IPX.\n      Reserved   \
    \              This field is for future extensibility\n                      \
    \         and MUST be set to all 0's.\n      HN Name                  This is\
    \ the name of the \"Connection\n                               Profile\" to be\
    \ used by the home agent to\n                               forward all packets\
    \ received from the\n                               mobile node.  This character\
    \ string is\n                               terminated by a NUL character and\
    \ can be\n                               up to 32 characters long, including the\n\
    \                               NUL terminator.\n"
- title: 2.2 Challenge Request
  contents:
  - "2.2 Challenge Request\n   The Home Agent issues a Challenge Request in response\
    \ to the receipt\n   of a Registration Request from a Foreign Agent.  It is used\
    \ by the\n   Home Agent, in conjunction with the Challenge Reply, to authenticate\n\
    \   the Foreign Agent.\n   IP fields\n      Source Address           The IP address\
    \ of the Home Agent\n                               interface from which the request\
    \ is\n                               issued.\n      Destination Address      Copied\
    \ form the Source Address of the\n                               Registration\
    \ Request.\n   UDP fields:\n      Source Port              variable\n      Destination\
    \ Port         Copied from the Source Port of the\n                          \
    \     Registration Request.\n"
- title: 'The UDP header is followed by the ATMP fields shown below:'
  contents:
  - "The UDP header is followed by the ATMP fields shown below:\n    0           \
    \        1                   2                   3\n    0 1 2 3 4 5 6 7 8 9 0\
    \ 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |    Version    |    Type       |         Identifier            |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                                                               |\n   |  \
    \                       Authenticator                         |\n   |        \
    \                                                       |\n   |              \
    \                                                 |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |         Result Code           |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      Version                  The ATMP protocol version.  MUST be 1.\n     \
    \ Type                     2 for Challenge Request\n      Identifier         \
    \      A 16 bit number used to match replies\n                               with\
    \ requests.  A new value should be\n                               provided in\
    \ each new request.\n                               Retransmissions of the same\
    \ request\n                               should use the same identifier.\n  \
    \    Authenticator            A series of 16 octet values randomly\n         \
    \                      generated by the Home Agent.  The\n                   \
    \            receiving Foreign Agent is to perform an\n                      \
    \         MD5 [7] hash of these values along with a\n                        \
    \       shared secret.  The resultant digest is\n                            \
    \   returned in the Challenge Reply.  See\n                               Sec.\
    \ 2.3 Retransmissions of the Challenge\n                               Request\
    \ should use the same Authenticator\n                               value.\n \
    \                              A value of all 0's in this field\n            \
    \                   indicates an error occurred with the\n                   \
    \            Registration Request.  The error code\n                         \
    \      will be in the following field.\n      Result Code              If non-zero,\
    \ this value indicates the\n                               error condition that\
    \ occurred.  See Sec.\n                               2.8 for a list of Result\
    \ Code values and\n                               their meanings.\n          \
    \                     A non-zero value in this field implies\n               \
    \                that the Authenticator field will be\n                      \
    \         zero.\n"
- title: 2.3 Challenge Reply
  contents:
  - "2.3 Challenge Reply\n   The Foreign Agent issues a Challenge Reply upon receipt\
    \ of a valid\n   Challenge Request (one with a Result Code of 0) from the Home\
    \ Agent.\n   The Foreign Agent uses the randomly generated Authenticator value\n\
    \   from the Challenge Request along with a shared secret to produce an\n   MD5\
    \ digest value which is returned to the Home Agent in the Challenge\n   Reply.\n\
    \   IP fields\n      Source Address           The IP address of the Foreign Agent\n\
    \                               interface from which the reply is issued.\n  \
    \    Destination Address      Copied from the Source Address of the\n        \
    \                       Challenge Request.\n   UDP fields:\n      Source Port\
    \              variable\n      Destination Port         Copied from the Source\
    \ Port of the\n                               Challenge Request.\n   The UDP header\
    \ is followed by the ATMP fields shown below:\n       0                   1  \
    \                 2                   3\n       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4\
    \ 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      |    Version    |    Type       |         Identifier            |\n   \
    \   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n      |\
    \          Reply Length         |       Reply  . . .\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      Version                  The ATMP protocol version.  MUST be 1.\n     \
    \ Type                     3 for Challenge Reply\n      Identifier           \
    \    Copied from the corresponding\n                               Deregistration\
    \ Request.\n      Reply Length             This field specifies the length of\
    \ the\n                               challenge reply computation based on the\n\
    \                               received Authenticator and the shared\n      \
    \                         secret.  For MD5 this length will always\n         \
    \                      be 16.  This field is provided for future\n           \
    \                    extensibility.\n      Reply                    This is the\
    \ computed challenge reply.  It\n                               is computed by\
    \ performing an MD5 message\n                               digest computation\
    \ over the Authenticator\n                               value received in the\
    \ Challenge Request\n                               appended with the secret shared\
    \ between\n                               the Foreign Agent and the Home Agent.\n\
    \                               The digests produced by MD5 are always 16\n  \
    \                             octets long.\n"
- title: 2.4 Registration Reply
  contents:
  - "2.4 Registration Reply\n   A Registration Reply is issued by a Home Agent in\
    \ reply to a\n   Challenge Reply received from a Foreign Agent.  The Registration\n\
    \   Reply indicates to the Foreign Agent whether the registration was\n   accepted\
    \ by the Home Agent or not.  It also provides a \"tunnel ID\" to\n   uniquely\
    \ identify the tunnel to be associated with this session.\n   The Home Agent calculates\
    \ the same MD5 hash on the Challenge Request\n   Authenticator field and the shared\
    \ secret.  The resulting digest is\n   compared with the Reply value in the Challenge\
    \ Reply and if it is\n   equal, authentication is successful.  Otherwise the registration\
    \ is\n   not accepted and the Foreign Agent is informed by the Result Code of\n\
    \   the Registration Reply that registration failed due to an\n   authentication\
    \ failure.\n   IP fields\n      Source Address           The IP address of the\
    \ Home Agent\n                               interface from which the reply is\
    \ issued.\n      Destination Address      Copied from the Source Address of the\n\
    \                               Challenge Reply.\n   UDP fields:\n      Source\
    \ Port              variable\n      Destination Port         Copied from the Source\
    \ Port of the\n                               Challenge Reply.\n   The UDP header\
    \ is followed by the ATMP fields shown below:\n       0                   1  \
    \                 2                   3\n       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4\
    \ 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      |    Version    |    Type       |         Identifier            |\n   \
    \   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n      |\
    \          Result Code          |         Tunnel ID             |\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      Version                  The ATMP protocol version.  MUST be 1.\n     \
    \ Type                     4 for Registration Reply\n      Identifier        \
    \       Copied from the corresponding\n                               Registration\
    \ Request.\n      Result Code              Specifies the result of the registration\n\
    \                               and authentication attempt by the Foreign\n  \
    \                             Agent.  Sec. 2.8 for a list of Result\n        \
    \                       Code values and their meanings.\n      Tunnel ID     \
    \           This is the identifier used to indicate a\n                      \
    \         given mobility binding between a given\n                           \
    \    Mobile Node and Home Agent.  This\n                               identifier\
    \ is used to distinguish\n                               multiple tunnels between\
    \ a given Foreign\n                               Agent-Home Agent pair.  It is\
    \ carried in\n                               the \"key\" field of the GRE [1]\
    \ tunnel\n                               packets that ATMP uses as the tunnel\n\
    \                               protocol.  It is also used in\n              \
    \                 Deregistration Requests and Error\n                        \
    \       Notification messages to indicate the\n                              \
    \ particular mobility binding to which they\n                               relate.\n"
- title: 2.5 Deregistration Request
  contents:
  - "2.5 Deregistration Request\n   The Deregistration Request is issued by the Foreign\
    \ Agent to the Home\n   Agent to indicate that the specified mobility binding\
    \ is to be ended.\n   This request may result from the Foreign Agent detecting\
    \ that its\n   connection to the Mobile Node has terminated.  It can also be issued\n\
    \   in response to a detected error condition by the Foreign Agent or\n   receipt\
    \ of an Error Notification message from the Home Agent.\n   IP fields\n      Source\
    \ Address           The IP address of the Foreign Agent\n                    \
    \           interface from which the request is\n                            \
    \   issued.\n      Destination Address      5150  (or port number configured in\
    \ FA\n                               for given HA)\n   UDP fields:\n      Source\
    \ Port              variable\n      Destination Port         Copied from the Source\
    \ Port of the\n                               Challenge Reply.\n   The UDP header\
    \ is followed by the ATMP fields shown below:\n       0                   1  \
    \                 2                   3\n       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4\
    \ 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      |    Version    |    Type       |         Identifier            |\n   \
    \   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n      |\
    \         Tunnel ID             |\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n \
    \     Version                  The ATMP protocol version.  MUST be 1.\n      Type\
    \                     5 for Deregistration Request\n      Identifier         \
    \      A 16 bit number used to match replies\n                               with\
    \ requests.  A new value should be\n                               provided in\
    \ each new request.\n                               Retransmissions of the same\
    \ request\n                               should use the same identifier.\n  \
    \    Tunnel ID                Tunnel identifier of the mobility binding\n    \
    \                           to be terminated.\n"
- title: 2.6 Deregistration Reply
  contents:
  - "2.6 Deregistration Reply\n   The Deregistration Reply is issued by the Home Agent\
    \ in response to a\n   Deregistration Request received from a Foreign Agent. \
    \ If the\n   Deregistration Request was valid, the Home Agent removes the\n  \
    \ specified mobility binding from its tables and issues an affirmative\n   reply.\
    \  Otherwise the Home Agent issues a Deregistration Reply with a\n   Result Code\
    \ indicating the reason for failure of the Deregistration\n   Request.\n   IP\
    \ fields\n      Source Address           The IP address of the Home Agent\n  \
    \                             interface from which the reply is issued.\n    \
    \  Destination Address      Copied from the Source Address of the\n          \
    \                     received Deregistration Request.\n   UDP fields:\n     \
    \ Source Port              variable\n      Destination Port         Copied from\
    \ the Source Port of the\n                               received Deregistration\
    \ Request.\n   The UDP header is followed by the ATMP fields shown below:\n  \
    \  0                   1                   2                   3\n    0 1 2 3\
    \ 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |    Version    |    Type       |         Identifier            |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |          Result Code          |         Tunnel ID             |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      Version                  The ATMP protocol version.  MUST be 1.\n     \
    \ Type                     6 for Deregistration Reply\n      Identifier      \
    \         Copied from the corresponding\n                               Deregistration\
    \ Request.\n      Result Code              Specifies the result of the registration\n\
    \                               and authentication attempt by the Foreign\n  \
    \                             Agent.  Sec. 2.8 for a list of Result\n        \
    \                       Code values and their meanings.\n      Tunnel ID     \
    \           Tunnel identifier of the mobility binding\n                      \
    \         specified in the Deregistration Request.\n"
- title: 2.7 Error Notification
  contents:
  - "2.7 Error Notification\n   This message is sent by either agent to inform the\
    \ other agent that\n   an error condition has occurred.  It provides a last-ditch\
    \ error\n   recovery mechanism that is used for conditions that cannot be\n  \
    \ reported back to the sender by the normal request-reply mechanism,\n   such\
    \ as the receipt of a spontaneously generated reply.\n   IP fields\n      Source\
    \ Address           The IP address of the issuing agent\n                    \
    \           interface from which this message is\n                           \
    \    issued.\n      Destination Address      The IP address of the Home Agent\
    \ or\n                               Foreign Agent to which this message is to\n\
    \                               be issued.\n   UDP fields:\n      Source Port\
    \              variable\n      Destination Port         If issued to a Home Agent,\
    \ 5150 (or the\n                               port number configured for the\
    \ given HA).\n                               If issued to a Foreign Agent, the\
    \ source\n                               port number saved from the original\n\
    \                               Registration Request.\n   The UDP header is followed\
    \ by the ATMP fields shown below:\n       0                   1              \
    \     2                   3\n       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0\
    \ 1 2 3 4 5 6 7 8 9 0 1\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      |    Version    |    Type       |         Identifier            |\n   \
    \   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n      |\
    \          Result Code          |         Tunnel ID             |\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      Version                  The ATMP protocol version.  MUST be 1.\n     \
    \ Type                     7 for Error Notification\n      Identifier        \
    \       If issued in response to a received reply\n                          \
    \     type message, this value should be copied\n                            \
    \   from the identifier field of the reply.\n                               Otherwise\
    \ the identifier should be the\n                               value that would\
    \ be used for the next\n                               generated request.\n  \
    \    Result Code              This indicates the type of error\n             \
    \                  detected.  The possible result codes are\n                \
    \               defined in Sec. 2.8.\n      Tunnel ID                Tunnel identifier\
    \ of the mobility binding\n                               to which this message\
    \ pertains.  If the\n                               Error Notification is being\
    \ sent in\n                               response to an unsolicited reply, the\n\
    \                               Tunnel ID is copied from the reply.\n"
- title: 2.8 Result Codes
  contents:
  - "2.8 Result Codes\n   Error Code          Description\n   0 NO_ERROR         \
    \ Successful operation\n   1 AUTH_FAILED       Authentication of the Foreign Agent\
    \ failed.\n                       Registration denied.\n   2 NOT_ENABLED     \
    \  The Home Agent is not configured to run ATMP.\n   3 TOO_MANY          Too many\
    \ Mobile Node sessions.  Home Agent is out\n                       of resources.\n\
    \   4 PARAMETER_ERROR   An invalid value was detected in an ATMP message.\n  \
    \ 5 INVALID_TUNNEL_ID The Tunnel ID contained in a GRE packet is\n           \
    \            invalid or the corresponding mobility binding\n                 \
    \      does not exist.  This usually occurs when either\n                    \
    \   the MN or HA has reset.\n   6 TIMEOUT           A response to an ATMP request\
    \ was not received in\n                       time.\n   7 NET_UNREACHABLE   The\
    \ Home Network for this mobility binding is not\n                       operational\
    \ (the \"Connection Profile\" is \"down\"\n                       or is not defined).\n\
    \   8 GENERAL_ERROR     General Error indication.\n"
- title: 2.9 Protocol Operation
  contents:
  - "2.9 Protocol Operation\n   Upon detection of a Mobile Node requiring ATMP service,\
    \ the NAS\n   invokes its ATMP Foreign Agent entity.The FA retrieves configuration\n\
    \   information for the user involved.This information is obtained in a\n   method\
    \ particular to the NAS and is not specified by this document.\n   The information\
    \ obtained MUST include the Home Agent address and the\n   shared secret for this\
    \ HA.It also MAY include the Home Network Name,\n   if a Connection Profile is\
    \ to be used for this session.\n   The FA then sends a Registration Request to\
    \ the HA informing it that\n   an MN wishes to register with it.  The FA then\
    \ waits for the HA to\n   respond with a Challenge Request.  The FA retransmits\
    \ the\n   Registration Request every 2 seconds until it receives the Challenge\n\
    \   Request.  If, after 10 retransmissions, no Challenge Request is\n   received,\
    \ the FA will terminate the Registration Request, logs the\n   registration failure,\
    \ and disconnects the MN.\n   Upon receipt of the Challenge Request, the FA examines\
    \ the Result\n   code.  If it indicates an error condition, the condition is logged\n\
    \   and the MN is disconnected.  If the result is zero, the FA generates\n   a\
    \ Challenge Reply.  The Challenge Reply is generated by appending the\n   Authenticator\
    \ obtained from the Challenge Request with the shared\n   secret (obtained from\
    \ the configuration data) and then computing the\n   MD5 hash of this concatenated\
    \ string (authenticator + secret).  The\n   16 octet hash is then returned in\
    \ the Challenge Reply for validation\n   by the HA.\n   Upon receipt of the Challenge\
    \ Reply from the FA, the HA does the same\n   computation of the MD5 hash based\
    \ on the Challenge Request\n   Authenticator and the shared-secret (which it too\
    \ must be configured\n   with).  If this digest matches that provided in the Challenge\
    \ Reply\n   by the FA then the authentication is successful and the registration\n\
    \   is accepted.  If the authentication fails, or resource limitations\n   prohibit\
    \ the registration attempt, the HA returns a Registration\n   Reply with a non-zero\
    \ result code to the FA.\n   If the HA accepts the Challenge Reply from the FA,\
    \ it assigns a\n   Tunnel ID to this session and returns this Tunnel ID in a\n\
    \   Registration Reply with a zero result code.  This Tunnel ID needs to\n   be\
    \ unique for the FA-HA pair.  The Tunnel ID is used to multiplex and\n   demultiplex\
    \ the packets sent between a given FA-HA pair.\n   At the time the HA decides\
    \ to accept a registration, it creates a\n   control block that associates the\
    \ Tunnel ID with the appropriate\n   routing information.  If the Registration\
    \ Request included a Home\n   Network Name, this name is saved in the table and\
    \ used as the name of\n   the Connection Profile for this session.\n   Upon receipt\
    \ of the Registration Reply, the FA examines the result\n   code. If it is non-zero,\
    \ the FA logs the registration failure and\n   disconnects the MN.  If it is zero,\
    \ the FA saves the Tunnel ID in a\n   control block associated with the MN session.\
    \  The FA and HA are now\n   ready to exchange data packets for this MN session.\n\
    \   On the FA side, all data received from the MN will be encapsulated\n   using\
    \ GRE and sent to the HA with the assigned Tunnel ID included in\n   the GRE Key\
    \ field.  When the HA receives a GRE packet it decapsulates\n   it and routes\
    \ it using the routing information contained in the HA's\n   control block associated\
    \ with this Tunnel ID.\n   When the HA receives a packet destined for the MN's\
    \ Home Address, it\n   MUST encapsulate it in a GRE packet and forward it to the\
    \ appropriate\n   FA.  The Tunnel ID is included in the GRE Key field to allow\
    \ the FA\n   to demultiplex the packet.\n   When the FA receives a GRE packet,\
    \ it will examine the Tunnel ID in\n   the GRE Key field to see if it matches\
    \ the Tunnel ID assigned to any\n   of the MN's currently connected to the FA.\
    \  If so, the packet is\n   decapsulated and forwarded to the MN.  If the Tunnel\
    \ ID doesn't match\n   any active MN's, an Error Notification message is issued\
    \ to the HA\n   and the GRE packet is silently discarded.\n   When the FA wishes\
    \ to disconnect the MN from the HA, it issues a\n   Deregistration Request.  This\
    \ request is issued every 2 seconds.  If\n   after 10 attempts a Deregistration\
    \ Reply is not received from the HA,\n   an error condition is logged and the\
    \ MN is disconnected.  Upon\n   receipt of a Deregistration Reply from the HA,\
    \ the FA deallocates the\n   Tunnel ID and disconnects the MN.\n"
- title: 3.0 Security Considerations
  contents:
  - "3.0 Security Considerations\n   The Registration function of ATMP is protected\
    \ by a\n   Challenge/Response mechanism similar to CHAP [2]. The Home Agent\n\
    \   challenges each registration attempt by a Foreign Agent for\n   authentication.This\
    \ authentication requires the configuration of a\n   shared secret for each HA/client\
    \ pair.\n"
- title: 4.0 Author's Address
  contents:
  - "4.0 Author's Address\n   Kory Hamzeh\n   Ascend Communications\n   1275 Harbor\
    \ Bay Parkway\n   Alameda, CA 94502\n   EMail: kory@ascend.com\n"
- title: 5.0 References
  contents:
  - "5.0 References\n   [1]  Hanks, S. Li, T., Farinacci, D., and Traina, P., \"Generic\n\
    \        Routing Encapsulation (GRE)\", RFC 1701, October 1994.\n   [2]  Lloyd,\
    \ B., and W. Simpson, \"PPP Authentication Protocols\",\n        RFC 1334, October\
    \ 1992.\n   [3]  Perkins, C., \"IP Mobility Support\", RFC 2002, October 1996.\n\
    \   [4]  Postel, J., \"User Data Protocol\",  STD 6, RFC 768, August 1990.\n \
    \  [5]  Rigney, C., Rubens, A., Simpson, W., and S. Willens, \"Remote\n      \
    \  Authentication Dial In User Service (RADIUS)\", RFC 2058,\n        January\
    \ 1997.\n   [6]  Reynolds, J., and J. Postel, \"Assigned Numbers\", STD 2,\n \
    \       RFC 1700, October, 1994.\n   [7]  Rivest, R., \"The MD5 Message-Digest\
    \ Algorithm\", RFC 1321, April\n        1992.\n   [8]  Simpson, W., Editor, \"\
    The Point-to-Point Protocol (PPP)\", STD\n        51, RFC 1661, July 1994.\n"
- title: Appendix A
  contents:
  - "Appendix A\n   Additional RADIUS Attributes for ATMP\n   This appendix indicates\
    \ the RADIUS attributes that have been added by\n   Ascend to support ATMP for\
    \ IP.  Currently these are defined as non-\n   vendor-specific attributes but\
    \ have been included in [5].\n       Attribute: \"Ascend-Home-Agent-IP-Addr\"\n\
    \       Type:      IP-Address\n       Value:     The IP address of the Home Agent\n\
    \       Attribute: \"Ascend-Home-Agent-Password\"\n       Type:      String\n\
    \       Value:     Secret shared for this user with HA\n       Attribute: \"Ascend-Home-Network-Name\"\
    \n       Type:      String\n       Value:     Name of Connection Profile for this\
    \ session\n       Attribute: \"Ascend-Home-Agent-UDP-Port\"\n       Type:    \
    \  Integer\n       Value:     The destination UDP port number for the specified\
    \ HA\n"
- title: Appendix B
  contents:
  - "Appendix B\n      IPX Operation\n      ATMP specifies a mechanism which allows\
    \ IPX clients to receive\n      mobility services from a HA. Section 2 details\
    \ the protocol used\n      to register, deregister, and authenticate a tunnel\
    \ used for IPX.\n      Note that ATMP is based on IP datagrams for the management\
    \ of\n      tunnels and, thus, IPX tunneling with ATMP always requires an\n  \
    \    underlying IP network.\n      Each IPX mobile client requires an IPX network\
    \ number and node\n      address pair.  Since IPX does not support a similar facility\
    \ to\n      IP's \"host route,\" an enterprise-unique network number needs to\
    \ be\n      chosen for each home agent. This network number MUST be distinct\n\
    \      from the IPX network number assigned to any of the home agent's\n     \
    \ LAN interfaces. Each mobile client tunneled to the home agent MUST\n      use\
    \ the same IPX network number.\n      For example, consider a home agent which\
    \ supports two mobile\n      clients.  The home agent is on a LAN network with\
    \ an IPX address\n      of AA000001. The home agent's client network may be assigned\n\
    \      AA000002. The two mobile clients may have addresses\n      AA000002:0040F1000001\
    \ and AA000002:0040F1000002 respectively.\n      IPX node numbers need to be unique\
    \ on a given network. A mechanism\n      must exist to guarantee that for each\
    \ home agent's network, a\n      given mobile client's node address is unique.\
    \ Several techniques\n      may be employed to assure unique node addresses. The\
    \ current\n      implementation of ATMP described in this document relies on RADIUS\n\
    \      to assign a node address at the foreign agent. The following\n      RADIUS\
    \ attributes are included for IPX operation in addition to\n      the attributes\
    \ described in Appendix A for IP operation:\n       Attribute: \"Framed-IPX-Network\"\
    \ (See [5] for details).\n       Attribute: \"Ascend-IPX-Node-Addr\"\n       Type:\
    \      String\n       String:    The node address for the mobile client in 12\
    \ octet\n                  ASCII representing the hexadecimal string. Both\n \
    \                 lower and upper case characters are permissible.\n"
