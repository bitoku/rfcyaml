- contents:
  - '               Segment Routing MPLS Interworking with LDP

    '
  title: __initial_text__
- contents:
  - "Abstract\n   A Segment Routing (SR) node steers a packet through a controlled
    set\n   of instructions, called segments, by prepending the packet with an SR\n
    \  header.  A segment can represent any instruction, topological or\n   service
    based.  SR allows enforcing a flow through any topological\n   path while maintaining
    per-flow state only at the ingress node to the\n   SR domain.\n   The Segment
    Routing architecture can be directly applied to the MPLS\n   data plane with no
    change in the forwarding plane.  This document\n   describes how Segment Routing
    MPLS operates in a network where LDP is\n   deployed and in the case where SR-capable
    and non-SR-capable nodes\n   coexist.\n"
  title: Abstract
- contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This
    document is a product of the Internet Engineering Task Force\n   (IETF).  It represents
    the consensus of the IETF community.  It has\n   received public review and has
    been approved for publication by the\n   Internet Engineering Steering Group (IESG).
    \ Further information on\n   Internet Standards is available in Section 2 of RFC
    7841.\n   Information about the current status of this document, any errata,\n
    \  and how to provide feedback on it may be obtained at\n   https://www.rfc-editor.org/info/rfc8661.\n"
  title: Status of This Memo
- contents:
  - "Copyright Notice\n   Copyright (c) 2019 IETF Trust and the persons identified
    as the\n   document authors.  All rights reserved.\n   This document is subject
    to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n
    \  (https://trustee.ietf.org/license-info) in effect on the date of\n   publication
    of this document.  Please review these documents\n   carefully, as they describe
    your rights and restrictions with respect\n   to this document.  Code Components
    extracted from this document must\n   include Simplified BSD License text as described
    in Section 4.e of\n   the Trust Legal Provisions and are provided without warranty
    as\n   described in the Simplified BSD License.\n"
  title: Copyright Notice
- contents:
  - "Table of Contents\n   1.  Introduction\n     1.1.  Requirements Language\n   2.
    \ SR-LDP Ships-in-the-Night Coexistence\n     2.1.  MPLS2MPLS, MPLS2IP, and IP2MPLS
    Coexistence\n   3.  SR and LDP Interworking\n     3.1.  LDP to SR\n       3.1.1.
    \ LDP to SR Behavior\n     3.2.  SR to LDP\n       3.2.1.  Segment Routing Mapping
    Server (SRMS)\n       3.2.2.  SR to LDP Behavior\n       3.2.3.  Interoperability
    of Multiple SRMSes and Prefix-SID\n               Advertisements\n   4.  SR-LDP
    Interworking Use Cases\n     4.1.  SR Protection of LDP-Based Traffic\n     4.2.
    \ Eliminating Targeted LDP Sessions\n     4.3.  Guaranteed FRR Coverage\n     4.4.
    \ Inter-AS Option C, Carrier's Carrier\n   5.  IANA Considerations\n   6.  Manageability
    Considerations\n     6.1.  SR and LDP Coexistence\n     6.2.  Data-Plane Verification\n
    \  7.  Security Considerations\n   8.  References\n     8.1.  Normative References\n
    \    8.2.  Informative References\n   Appendix A.  Migration from LDP to SR\n
    \  Acknowledgements\n   Contributors\n   Authors' Addresses\n"
  title: Table of Contents
- contents:
  - "1.  Introduction\n   Segment Routing, as described in [RFC8402], can be used
    on top of the\n   MPLS data plane without any modification as described in [RFC8660].\n
    \  Segment Routing control plane can coexist with current label\n   distribution
    protocols such as LDP [RFC5036].\n   This document outlines the mechanisms through
    which SR interworks\n   with LDP in cases where a mix of SR-capable and non-SR-capable\n
    \  routers coexist within the same network and more precisely in the\n   same
    routing domain.\n   Section 2 describes the coexistence of SR with other MPLS
    control-\n   plane protocols.  Section 3 documents the interworking between SR
    and\n   LDP in the case of nonhomogeneous deployment.  Section 4 describes\n   how
    a partial SR deployment can be used to provide SR benefits to\n   LDP-based traffic
    including a possible application of SR in the\n   context of interdomain MPLS
    use cases.  Appendix A documents a method\n   to migrate from LDP to SR-based
    MPLS tunneling.\n   Typically, an implementation will allow an operator to select\n
    \  (through configuration) which of the described modes of SR and LDP\n   coexistence
    to use.\n"
  - contents:
    - "1.1.  Requirements Language\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\",
      \"SHALL\", \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"NOT
      RECOMMENDED\", \"MAY\", and\n   \"OPTIONAL\" in this document are to be interpreted
      as described in\n   BCP 14 [RFC2119] [RFC8174] when, and only when, they appear
      in all\n   capitals, as shown here.\n"
    title: 1.1.  Requirements Language
  title: 1.  Introduction
- contents:
  - "2.  SR-LDP Ships-in-the-Night Coexistence\n   \"MPLS Control-Plane Client (MCC)\"
    refers to any control-plane\n   protocol installing forwarding entries in the
    MPLS data plane.  SR,\n   LDP [RFC5036], RSVP-TE [RFC3209], BGP [RFC8277], etc.,
    are examples\n   of MCCs.\n   An MCC, operating at Node N, must ensure that the
    incoming label it\n   installs in the MPLS data plane of Node N has been uniquely
    allocated\n   to itself.\n   Segment Routing makes use of the Segment Routing
    Global Block (SRGB,\n   as defined in [RFC8402]) for the label allocation.  The
    use of the\n   SRGB allows SR to coexist with any other MCC.\n   This is clearly
    the case for the adjacency segment: it is a local\n   label allocated by the label
    manager, as is the case for any MCC.\n   This is clearly the case for the prefix
    segment: the label manager\n   allocates the SRGB set of labels to the SR MCC
    client, and the\n   operator ensures the unique allocation of each global prefix
    segment\n   or label within the allocated SRGB set.\n   Note that this static
    label-allocation capability of the label\n   manager has existed for many years
    across several vendors and is\n   therefore not new.  Furthermore, note that the
    label manager's\n   ability to statically allocate a range of labels to a specific\n
    \  application is not new either.  This is required for MPLS-TP\n   operation.
    \ In this case, the range is reserved by the label manager,\n   and it is the
    MPLS-TP [RFC5960] Network Management System (acting as\n   an MCC) that ensures
    the unique allocation of any label within the\n   allocated range and the creation
    of the related MPLS forwarding\n   entry.\n   Let us illustrate an example of
    ship-in-the-night (SIN) coexistence.\n                              PE2          PE4\n
    \                         PE1----A----B---C---PE3\n                         Figure
    1: SIN Coexistence\n   The EVEN VPN service is supported by PE2 and PE4 while
    the ODD VPN\n   service is supported by PE1 and PE3.  The operator wants to tunnel\n
    \  the ODD service via LDP and the EVEN service via SR.\n   This can be achieved
    in the following manner:\n   *  The operator configures PE1, PE2, PE3, and PE4
    with respective\n      loopbacks 192.0.2.201/32, 192.0.2.202/32, 192.0.2.203/32,
    and\n      192.0.2.204/32.  These PEs advertised their VPN routes with next\n
    \     hop set on their respective loopback address.\n   *  The operator configures
    A, B, C with respective loopbacks\n      192.0.2.1/32, 192.0.2.2/32, 192.0.2.3/32.\n
    \  *  The operator configures PE2, A, B, C, and PE4 with SRGB [100,\n      300].\n
    \  *  The operator attaches the respective Node Segment Identifiers\n      (Node
    SIDs, as defined in [RFC8402]), 202, 101, 102, 103, and 204,\n      to the loopbacks
    of nodes PE2, A, B, C, and PE4.  The Node SIDs\n      are configured to request
    Penultimate Hop Popping.\n   *  PE1, A, B, C, and PE3 are LDP capable.\n   *  PE1
    and PE3 are not SR capable.\n   PE3 sends an ODD VPN route to PE1 with next-hop
    192.0.2.203 and VPN\n   label 10001.\n   From an LDP viewpoint, PE1 received an
    LDP label binding (1037) for a\n   Forwarding Equivalence Class (FEC) 192.0.2.203/32
    from its next-hop\n   A; A received an LDP label binding (2048) for that FEC from
    its next-\n   hop B; B received an LDP label binding (3059) for that FEC from
    its\n   next-hop C; and C received implicit NULL LDP binding from its next-\n
    \  hop PE3.\n   As a result, PE1 sends its traffic to the ODD service route\n
    \  advertised by PE3 to next-hop A with two labels: the top label is\n   1037
    and the bottom label is 10001.  Node A swaps 1037 with 2048 and\n   forwards to
    B; B swaps 2048 with 3059 and forwards to C; C pops 3059\n   and forwards to PE3.\n
    \  PE4 sends an EVEN VPN route to PE2 with next-hop 192.0.2.204 and VPN\n   label
    10002.\n   From an SR viewpoint, PE2 maps the IGP route 192.0.2.204/32 onto Node\n
    \  SID 204; Node A swaps 204 with 204 and forwards to B; B swaps 204\n   with
    204 and forwards to C; and C pops 204 and forwards to PE4.\n   As a result, PE2
    sends its traffic to the VPN service route\n   advertised by PE4 to next-hop A
    with two labels: the top label is 204\n   and the bottom label is 10002.  Node
    A swaps 204 with 204 and\n   forwards to B.  B swaps 204 with 204 and forwards
    to C.  C pops 204\n   and forwards to PE4.\n   The two modes of MPLS tunneling
    coexist.\n   *  The ODD service is tunneled from PE1 to PE3 through a continuous\n
    \     LDP LSP traversing A, B, and C.\n   *  The EVEN service is tunneled from
    PE2 to PE4 through a continuous\n      SR node segment traversing A, B, and C.\n"
  - contents:
    - "2.1.  MPLS2MPLS, MPLS2IP, and IP2MPLS Coexistence\n   MPLS2MPLS refers to the
      forwarding behavior where a router receives a\n   labeled packet and switches
      it out as a labeled packet.  Several\n   MPLS2MPLS entries may be installed
      in the data plane for the same\n   prefix.\n   Let us examine A's MPLS forwarding
      table as an example:\n      Incoming label: 1037\n      -  Outgoing label: 2048\n
      \     -  Outgoing next hop: B\n      Note: This entry is programmed by LDP for
      192.0.2.203/32.\n      Incoming label: 203\n      -  Outgoing label: 203\n      -
      \ Outgoing next hop: B\n      Note: This entry is programmed by SR for 192.0.2.203/32.\n
      \  These two entries can coexist because their incoming label is unique.\n   The
      uniqueness is guaranteed by the label manager allocation rules.\n   The same
      applies for the MPLS2IP forwarding entries.  MPLS2IP is the\n   forwarding behavior
      where a router receives a labeled IPv4/IPv6\n   packet with one label only,
      pops the label, and switches the packet\n   out as IPv4/IPv6.  For IP2MPLS coexistence,
      refer to Section 6.1.\n"
    title: 2.1.  MPLS2MPLS, MPLS2IP, and IP2MPLS Coexistence
  title: 2.  SR-LDP Ships-in-the-Night Coexistence
- contents:
  - "3.  SR and LDP Interworking\n   This section analyzes the case where SR is available
    in one part of\n   the network and LDP is available in another part.  It describes
    how a\n   continuous MPLS tunnel can be built throughout the network.\n                             PE2
    \           PE4\n                        PE1----P5--P6--P7--P8---PE3\n                        <-----SR---->\n
    \                    Figure 2: SR and LDP Interworking\n   Let us analyze the
    following example:\n   *  P6, P7, P8, PE4, and PE3 are LDP capable.\n   *  PE1,
    PE2, P5, and P6 are SR capable.  PE1, PE2, P5, and P6 are\n      configured with
    SRGB (100, 200) and with node segments 101, 102,\n      105, and 106, respectively.\n
    \  *  A service flow must be tunneled from PE1 to PE3 over a continuous\n      MPLS
    tunnel encapsulation; therefore, SR and LDP need to\n      interwork.\n"
  - contents:
    - "3.1.  LDP to SR\n   In this section, a right-to-left traffic flow is analyzed.\n
      \  PE3 has learned a service route whose next hop is PE1.  PE3 has an\n   LDP
      label binding from the next-hop P8 for the FEC \"PE1\".  Therefore,\n   PE3
      sends its service packet to P8 as per classic LDP behavior.\n   P8 has an LDP
      label binding from its next-hop P7 for the FEC \"PE1\"\n   and therefore, P8
      forwards to P7 as per classic LDP behavior.\n   P7 has an LDP label binding
      from its next-hop P6 for the FEC \"PE1\"\n   and therefore, P7 forwards to P6
      as per classic LDP behavior.\n   P6 does not have an LDP binding from its next-hop
      P5 for the FEC\n   \"PE1\".  However, P6 has an SR node segment to the IGP route
      \"PE1\".\n   Hence, P6 forwards the packet to P5 and swaps its local LDP label
      for\n   FEC \"PE1\" by the equivalent node segment (i.e., 101).\n   P5 pops
      101 (assuming PE1 advertised its node segment 101 with the\n   penultimate-pop
      flag set) and forwards to PE1.\n   PE1 receives the tunneled packet and processes
      the service label.\n   The end-to-end MPLS tunnel is built by stitching an LDP
      LSP from PE3\n   to P6 and the related node segment from P6 to PE1.\n"
    - contents:
      - "3.1.1.  LDP to SR Behavior\n   It has to be noted that no additional signaling
        or state is required\n   in order to provide interworking in the direction
        LDP to SR.\n   An SR node having LDP neighbors MUST create LDP bindings for
        each\n   Prefix-SID learned in the SR domain by treating SR-learned labels
        as\n   if they were learned through an LDP neighbor.  In addition, for each\n
        \  FEC, the SR node stitches the incoming LDP label to the outgoing SR\n   label.
        \ This has to be done in both LDP-independent and ordered label\n   distribution
        control modes as defined in [RFC5036].\n"
      title: 3.1.1.  LDP to SR Behavior
    title: 3.1.  LDP to SR
  - contents:
    - "3.2.  SR to LDP\n   In this section, the left-to-right traffic flow is analyzed.\n
      \  This section defines the Segment Routing Mapping Server (SRMS).  The\n   SRMS
      is an IGP node advertising mapping between Segment Identifiers\n   (SID) and
      prefixes advertised by other IGP nodes.  The SRMS uses a\n   dedicated IGP extension
      (IS-IS, OSPFv2, and OSPFv3), which is\n   protocol specific and defined in [RFC8665],
      [RFC8666], and [RFC8667].\n   The SRMS function of an SR-capable router allows
      distribution of\n   mappings for prefixes not locally attached to the advertising
      router\n   and therefore allows advertisement of mappings on behalf of non-SR-\n
      \  capable routers.\n   The SRMS is a control-plane-only function that may be
      located\n   anywhere in the IGP flooding scope.  At least one SRMS server MUST\n
      \  exist in a routing domain to advertise Prefix-SIDs on behalf of\n   non-SR
      nodes, thereby allowing non-LDP routers to send and receive\n   labeled traffic
      from LDP-only routers.  Multiple SRMSes may be\n   present in the same network
      (for redundancy).  This implies that\n   there are multiple ways a prefix-to-SID
      mapping can be advertised.\n   Conflicts resulting from inconsistent advertisements
      are addressed by\n   [RFC8660].\n   The example depicted in Figure 2 assumes
      that the operator configures\n   P5 to act as a Segment Routing Mapping Server
      and advertises the\n   following mappings: (P7, 107), (P8, 108), (PE3, 103),
      and (PE4, 104).\n   The mappings advertised by one or more SRMSes result from
      local\n   policy information configured by the operator.\n   If PE3 had been
      SR capable, the operator would have configured PE3\n   with node segment 103.
      \ Instead, as PE3 is not SR capable, the\n   operator configures that policy
      at the SRMS and it is the latter that\n   advertises the mapping.\n   The Mapping
      Server Advertisements are only understood by SR-capable\n   routers.  The SR-capable
      routers install the related node segments in\n   the MPLS data plane exactly
      like the node segments had been\n   advertised by the nodes themselves.\n   For
      example, PE1 installs the node segment 103 with next-hop P5\n   exactly as if
      PE3 had advertised node segment 103.\n   PE1 has a service route whose next
      hop is PE3.  PE1 has a node\n   segment for that IGP route: 103 with next-hop
      P5.  Hence, PE1 sends\n   its service packet to P5 with two labels: the bottom
      label is the\n   service label and the top label is 103.\n   P5 swaps 103 for
      103 and forwards to P6.\n   P6's next hop for the IGP route \"PE3\" is not SR
      capable (P7 does not\n   advertise the SR capability).  However, P6 has an LDP
      label binding\n   from that next hop for the same FEC (e.g., LDP label 1037).
      \ Hence,\n   P6 swaps 103 for 1037 and forwards to P7.\n   P7 swaps this label
      with the LDP label received from P8 and forwards\n   to P8.\n   P8 pops the
      LDP label and forwards to PE3.\n   PE3 receives the tunneled packet and processes
      the service label.\n   The end-to-end MPLS tunnel is built by stitching an SR
      node segment\n   from PE1 to P6 and an LDP LSP from P6 to PE3.\n   SR-mapping
      advertisement for a given prefix provides no information\n   about Penultimate
      Hop Popping.  Other mechanisms, such as IGP-\n   specific mechanisms ([RFC8665],
      [RFC8666], and [RFC8667]), MAY be\n   used to determine the Penultimate Hop
      Popping in such case.\n      |  Note: In the previous example, Penultimate Hop
      Popping is not\n      |  performed at the SR-LDP border for segment 103 (PE3),
      because\n      |  none of the routers in the SR domain are Penultimate Hop for\n
      \     |  segment 103.  In this case, P6 requires the presence of the\n      |
      \ segment 103 such as to map it to the LDP label 1037.\n"
    - contents:
      - "3.2.1.  Segment Routing Mapping Server (SRMS)\n   This section specifies
        the concept and externally visible\n   functionality of a Segment Routing
        Mapping Server (SRMS).\n   The purpose of SRMS functionality is to support
        the advertisement of\n   Prefix-SIDs to a prefix without the need to explicitly
        advertise such\n   assignment within a prefix reachability advertisement.
        \ Examples of\n   explicit Prefix-SID Advertisement are the Prefix-SID sub-TLVs
        defined\n   in [RFC8665], [RFC8666], and [RFC8667].\n   The SRMS functionality
        allows assigning of Prefix-SIDs to prefixes\n   owned by non-SR-capable routers
        as well as to prefixes owned by SR-\n   capable nodes.  It is the former capability
        that is essential to the\n   SR-LDP interworking described later in this section.\n
        \  The SRMS functionality consists of two functional blocks: the Mapping\n
        \  Server (MS) and Mapping Client (MC).\n   An MS is a node that advertises
        an SR mappings.  Advertisements sent\n   by an MS define the assignment of
        a Prefix-SID to a prefix\n   independent of the advertisement of reachability
        to the prefix\n   itself.  An MS MAY advertise SR mappings for any prefix
        whether or\n   not it advertises reachability for the prefix and irrespective
        of\n   whether that prefix is advertised by or even reachable through any\n
        \  router in the network.\n   An MC is a node that receives and uses the MS
        mapping advertisements.\n   Note that a node may be both an MS and an MC.
        \ An MC interprets the\n   SR-mapping advertisement as an assignment of a
        Prefix-SID to a\n   prefix.  For a given prefix, if an MC receives an SR-mapping\n
        \  advertisement from a Mapping Server and also has received a Prefix-\n   SID
        Advertisement for that same prefix in a prefix reachability\n   advertisement,
        then the MC MUST prefer the SID advertised in the\n   prefix reachability
        advertisement over the Mapping Server\n   Advertisement, i.e., the Mapping
        Server Advertisement MUST be ignored\n   for that prefix.  Hence, assigning
        a Prefix-SID to a prefix using the\n   SRMS functionality does not preclude
        assigning the same or different\n   Prefix-SID(s) to the same prefix using
        explicit Prefix-SID\n   Advertisement such as the aforementioned Prefix-SID
        sub-TLVs.\n   For example, consider an IPv4 prefix advertisement received
        by an\n   IS-IS router in the Extended IP reachability TLV (TLV 135).  Suppose\n
        \  TLV 135 contained the Prefix-SID sub-TLV.  If the router that\n   receives
        TLV 135 with the Prefix-SID sub-TLV also received an SR-\n   mapping advertisement
        for the same prefix through the SID/Label\n   Binding TLV, then the receiving
        router must prefer the Prefix-SID\n   sub-TLV over the SID/Label Binding TLV
        for that prefix.  Refer to\n   [RFC8667] for details about the Prefix-SID
        sub-TLV and SID/Label\n   Binding TLV.\n"
      title: 3.2.1.  Segment Routing Mapping Server (SRMS)
    - contents:
      - "3.2.2.  SR to LDP Behavior\n   SR to LDP interworking requires an SRMS as
        defined above.\n   Each SR-capable router installs in the MPLS data-plane
        Node SIDs\n   learned from the SRMS exactly as if these SIDs had been advertised
        by\n   the nodes themselves.\n   An SR node having LDP-only neighbors MUST
        stitch the incoming SR\n   label (whose SID is advertised by the SRMS) to
        the outgoing LDP\n   label.\n   It has to be noted that the SR to LDP behavior
        does not propagate the\n   status of the LDP FEC that was signaled by LDP
        when configured in\n   ordered mode.\n   It has to be noted that in the case
        of SR to LDP, the label binding\n   is equivalent to the independent LDP Label
        Distribution Control Mode\n   [RFC5036] where a label is bound to a FEC independently
        from the\n   received binding for the same FEC.\n"
      title: 3.2.2.  SR to LDP Behavior
    - contents:
      - "3.2.3.  Interoperability of Multiple SRMSes and Prefix-SID\n        Advertisements\n
        \  In the case of SR-LDP interoperability through the use of an SRMS,\n   mappings
        are advertised by one or more SRMSes.\n   SRMS functionality is implemented
        in the link-state protocol (such as\n   IS-IS and OSPF).  Link-state protocols
        allow propagation of updates\n   across area boundaries and, therefore, SRMS
        advertisements are\n   propagated through the usual inter-area advertisement
        procedures in\n   link-state protocols.\n   Multiple SRMSes can be provisioned
        in a network for redundancy.\n   Moreover, a preference mechanism may also
        be used among SRMSes to\n   deploy a primary/secondary SRMS scheme allowing
        controlled\n   modification or migration of SIDs.\n   The content of SRMS
        advertisement (i.e., mappings) are a matter of\n   local policy determined
        by the operator.  When multiple SRMSes are\n   active, it is necessary that
        the information (mappings) advertised by\n   the different SRMSes is aligned
        and consistent.  The following\n   mechanism is applied to determine the preference
        of SRMS\n   advertisements:\n   If a node acts as an SRMS, it MAY advertise
        a preference to be\n   associated with all SRMS SID Advertisements sent by
        that node.  The\n   means of advertising the preference is defined in the
        protocol-\n   specific documents, e.g., [RFC8665], [RFC8666], and [RFC8667].
        \ The\n   preference value is an unsigned 8-bit integer with the following\n
        \  properties:\n           |   0   | Reserved value indicating advertisements
        |\n           |       | from that node MUST NOT be used          |\n           |
        1-255 | Preference value (255 is most preferred) |\n   Advertisement of a
        preference value is optional.  Nodes that do not\n   advertise a preference
        value are assigned a preference value of 128.\n   An MCC on a node receiving
        one or more SRMS mapping advertisements\n   applies them as follows:\n   *
        \ For any prefix for which it did not receive a Prefix-SID\n      Advertisement,
        the MCC applies the SRMS mapping advertisements\n      with the highest preference.
        \ The mechanism by which a Prefix-SID\n      is advertised for a given prefix
        is defined in the protocol\n      specifications [RFC8665], [RFC8666], and
        [RFC8667].\n   *  If there is an incoming label collision as specified in
        [RFC8660],\n      apply the steps specified in [RFC8660] to resolve the collision.\n
        \  When the SRMS advertises mappings, an implementation should provide a\n
        \  mechanism through which the operator determines which of the IP2MPLS\n
        \  mappings are preferred among the one advertised by the SRMS and the\n   ones
        advertised by LDP.\n"
      title: 3.2.3.  Interoperability of Multiple SRMSes and Prefix-SID
    title: 3.2.  SR to LDP
  title: 3.  SR and LDP Interworking
- contents:
  - "4.  SR-LDP Interworking Use Cases\n   SR can be deployed, for example, to enhance
    LDP transport.  The SR\n   deployment can be limited to the network region where
    the SR benefits\n   are most desired.\n"
  - contents:
    - "4.1.  SR Protection of LDP-Based Traffic\n   In Figure 3, let us assume:\n
      \  *  All link costs are 10 except FG, which is 30.\n   *  All routers are LDP
      capable.\n   *  X, Y, and Z are PEs participating in an important service S.\n
      \  *  The operator requires 50 msec link-based Fast Reroute (FRR) for\n      service
      S.\n   *  A, B, C, D, E, F, and G are SR capable.\n   *  X, Y, and Z are not
      SR capable, e.g., as part of a staged\n      migration from LDP to SR, the operator
      deploys SR first in a\n      subpart of the network and then everywhere.\n                              Y--A---B---E--Z\n
      \                  Figure 3: SR-LDP Interworking Example\n   The operator would
      like to resolve the following issues:\n   *  To protect the link BA along the
      shortest-path of the important\n      flow XY, B requires a Remote Loop-Free
      Alternate (RLFA; see\n      [RFC7490]) repair tunnel to D and, therefore, a
      targeted LDP\n      session from B to D.  Typically, network operators prefer
      avoiding\n      these dynamically established multi-hop LDP sessions in order
      to\n      reduce the number of protocols running in the network and,\n      therefore,
      simplify network operations.\n   *  There is no LFA/RLFA solution to protect
      the link BE along the\n      shortest path of the important flow XZ.  The operator
      wants a\n      guaranteed link-based FRR solution.\n   The operator can meet
      these objectives by deploying SR only on A, B,\n   C, D, E, F, and G:\n   *
      \ The operator configures A, B, C, D, E, F, and G with SRGB [100,\n      200]
      and with node segments 101, 102, 103, 104, 105, 106, and 107,\n      respectively.\n
      \  *  The operator configures D as an SR Mapping Server with the\n      following
      policy mapping: (X, 201), (Y, 202), and (Z, 203).\n   *  Each SR node automatically
      advertises a local adjacency segment\n      for its IGP adjacencies.  Specifically,
      F advertises adjacency\n      segment 9001 for its adjacency FG.\n   A, B, C,
      D, E, F, and G keep their LDP capability.  Therefore, the\n   flows XY and XZ
      are transported over end-to-end LDP LSPs.\n   For example, LDP at B installs
      the following MPLS data-plane entries:\n      Incoming label: local LDP label
      bound by B for FEC Y\n      -  Outgoing label: LDP label bound by A for FEC
      Y\n      -  Outgoing next hop: A\n      Incoming label: local LDP label bound
      by B for FEC Z\n      -  Outgoing label: LDP label bound by E for FEC Z\n      -
      \ Outgoing next hop: E\n   The novelty comes from how the backup chains are
      computed for these\n   LDP-based entries.  While LDP labels are used for the
      primary next-\n   hop and outgoing labels, SR information is used for the FRR\n
      \  construction.  In steady state, the traffic is transported over LDP\n   LSP.
      \ In transient FRR state, the traffic is backup thanks to the SR-\n   enhanced
      capabilities.\n   The RLFA paths are dynamically precomputed as defined in [RFC7490].\n
      \  Typically, implementations allow to enable an RLFA mechanism through\n   a
      simple configuration command that triggers both the precomputation\n   and installation
      of the repair path.  The details on how RLFA\n   mechanisms are implemented
      and configured is outside the scope of\n   this document and not relevant to
      the aspects of SR-LDP interwork\n   explained in this document.\n   This helps
      meet the requirements of the operator:\n   *  Eliminate targeted LDP sessions.\n
      \  *  Provide guaranteed FRR coverage.\n   *  Keep the traffic over LDP LSP
      in steady state.\n   *  Partially deploy SR only where needed.\n"
    title: 4.1.  SR Protection of LDP-Based Traffic
  - contents:
    - "4.2.  Eliminating Targeted LDP Sessions\n   B's MPLS entry to Y becomes:\n
      \     Incoming label: local LDP label bound by B for FEC Y\n      -  Outgoing
      label: LDP label bound by A for FEC Y\n      -  Backup outgoing label: SR node
      segment for Y {202}\n      -  Outgoing next hop: A\n      -  Backup next hop:
      repair tunnel: node segment to D {104} with\n         outgoing next hop: C\n
      \  It has to be noted that D is selected as a Remote Loop-Free Alternate\n   (RLFA)
      as defined in [RFC7490].\n   In steady state, X sends its Y-destined traffic
      to B with a top\n   label, which is the LDP label bound by B for FEC Y.  B swaps
      that top\n   label for the LDP label bound by A for FEC Y and forwards to A.
      \ A\n   pops the LDP label and forwards to Y.\n   Upon failure of the link BA,
      B swaps the incoming top label with the\n   node segment for Y (202) and sends
      the packet onto a repair tunnel to\n   D (node segment 104).  Thus, B sends
      the packet to C with the label\n   stack {104, 202}.  C pops the node segment
      104 and forwards to D.  D\n   swaps 202 for 202 and forwards to A.  A's next
      hop to Y is not SR\n   capable, and therefore, Node A swaps the incoming node
      segment 202 to\n   the LDP label announced by its next hop (in this case, implicit\n
      \  NULL).\n   After IGP convergence, B's MPLS entry to Y will become:\n      Incoming
      label: local LDP label bound by B for FEC Y\n      -  Outgoing label: LDP label
      bound by C for FEC Y\n      -  Outgoing next hop: C\n   And the traffic XY travels
      again over the LDP LSP.\n   Conclusion: the operator has eliminated the need
      for targeted LDP\n   sessions (no longer required) and the steady-state traffic
      is still\n   transported over LDP.  The SR deployment is confined to the area\n
      \  where these benefits are required.\n   Despite that, in general, an implementation
      would not require a\n   manual configuration of targeted LDP sessions.  However,
      it is always\n   a gain if the operator is able to reduce the set of protocol
      sessions\n   running on the network infrastructure.\n"
    title: 4.2.  Eliminating Targeted LDP Sessions
  - contents:
    - "4.3.  Guaranteed FRR Coverage\n   As mentioned in Section 4.1, in the example
      topology described in\n   Figure 3, there is no RLFA-based solution for protecting
      the traffic\n   flow YZ against the failure of link BE because there is no\n
      \  intersection between the extended P-space and Q-space (see [RFC7490]\n   for
      details).  However:\n   *  G belongs to the Q space of Z.\n   *  G can be reached
      from B via a \"repair SR path\" {106, 9001} that is\n      not affected by failure
      of link BE.  (The method by which G and\n      the repair tunnel to it from
      B are identified are outside the\n      scope of this document.)\n   B's MPLS
      entry to Z becomes:\n      Incoming label: local LDP label bound by B for FEC
      Z\n      -  Outgoing label: LDP label bound by E for FEC Z\n      -  Backup
      outgoing label: SR node segment for Z {203}\n      -  Outgoing next hop: E\n
      \     -  Backup next hop: repair tunnel to G: {106, 9001}\n      G is reachable
      from B via the combination of a node segment to F\n      {106} and an adjacency
      segment FG {9001}.\n      Note that {106, 107} would have equally worked.  Indeed,
      in many\n      cases, P's shortest path to Q is over the link PQ.  The adjacency\n
      \     segment from P to Q is required only in very rare topologies where\n      the
      shortest-path from P to Q is not via the link PQ.\n   In steady state, X sends
      its Z-destined traffic to B with a top\n   label, which is the LDP label bound
      by B for FEC Z.  B swaps that top\n   label for the LDP label bound by E for
      FEC Z and forwards to E.  E\n   pops the LDP label and forwards to Z.\n   Upon
      failure of the link BE, B swaps the incoming top label with the\n   node segment
      for Z (203) and sends the packet onto a repair tunnel to\n   G (node segment
      106 followed by adjacency segment 9001).  Thus, B\n   sends the packet to C
      with the label stack {106, 9001, 203}.  C pops\n   the node segment 106 and
      forwards to F.  F pops the adjacency segment\n   9001 and forwards to G.  G
      swaps 203 for 203 and forwards to E.  E's\n   next hop to Z is not SR capable,
      and thus, E swaps the incoming node\n   segment 203 for the LDP label announced
      by its next hop (in this\n   case, implicit NULL).\n   After IGP convergence,
      B's MPLS entry to Z will become:\n      Incoming label: local LDP label bound
      by B for FEC Z\n      -  Outgoing label: LDP label bound by C for FEC Z\n      -
      \ Outgoing next hop: C\n   And the traffic XZ travels again over the LDP LSP.\n
      \  Conclusions:\n   *  the operator has eliminated its second problem: guaranteed
      FRR\n      coverage is provided.  The steady-state traffic is still\n      transported
      over LDP.  The SR deployment is confined to the area\n      where these benefits
      are required.\n   *  FRR coverage has been achieved without any signaling for
      setting\n      up the repair LSP and without setting up a targeted LDP session\n
      \     between B and G.\n"
    title: 4.3.  Guaranteed FRR Coverage
  - contents:
    - "4.4.  Inter-AS Option C, Carrier's Carrier\n   In inter-AS Option C [RFC4364],
      two interconnected ASes sets up\n   inter-AS MPLS connectivity.  SR may be independently
      deployed in each\n   AS.\n                       PE1---R1---B1---B2---R2---PE2\n
      \                           AS1            AS2\n                        Figure
      4: Inter-AS Option C\n   In Inter-AS Option C, B2 advertises to B1 a labeled
      BGP route\n   [RFC8277] for PE2, and B1 reflects it to its internal peers, e.g.,\n
      \  PE1.  PE1 learns from a service route reflector a service route whose\n   next
      hop is PE2.  PE1 resolves that service route on the labeled BGP\n   route to
      PE2.  That labeled BGP route to PE2 is itself resolved on\n   the AS1 IGP route
      to B1.\n   If AS1 operates SR, then the tunnel from PE1 to B1 is provided by
      the\n   node segment from PE1 to B1.\n   PE1 sends a service packet with three
      labels: the top one is the node\n   segment to B1, the next one is the label
      in the labeled BGP route\n   provided by B1 for the route \"PE2\", and the bottom
      one is the service\n   label allocated by PE2.\n"
    title: 4.4.  Inter-AS Option C, Carrier's Carrier
  title: 4.  SR-LDP Interworking Use Cases
- contents:
  - "5.  IANA Considerations\n   This document has no IANA actions.\n"
  title: 5.  IANA Considerations
- contents:
  - '6.  Manageability Considerations

    '
  - contents:
    - "6.1.  SR and LDP Coexistence\n   When both SR and LDP coexist, the following
      applies:\n   *  If both SR and LDP propose an IP2MPLS entry for the same IP\n
      \     prefix, then by default the LDP route SHOULD be selected.  This is\n      because
      it is expected that SR is introduced into networks that\n      contain routers
      that do not support SR.  Hence, by having a\n      behavior that prefers LDP
      over SR, traffic flow is unlikely to be\n      disrupted.\n   *  A local policy
      on a router MUST allow to prefer the SR-provided\n      IP2MPLS entry.\n   *
      \ Note that this policy MAY be locally defined.  There is no\n      requirement
      that all routers use the same policy.\n"
    title: 6.1.  SR and LDP Coexistence
  - contents:
    - "6.2.  Data-Plane Verification\n   When Label switch paths (LSPs) are defined
      by stitching LDP LSPs with\n   SR LSPs, it is necessary to have mechanisms allowing
      the verification\n   of the LSP connectivity as well as validation of the path.
      \ These\n   mechanisms are described in [RFC8287].\n"
    title: 6.2.  Data-Plane Verification
  title: 6.  Manageability Considerations
- contents:
  - "7.  Security Considerations\n   This document does not introduce any change to
    the MPLS data plane\n   [RFC3031] and therefore no additional security of the
    MPLS data plane\n   is required.\n   This document introduces another form of
    label binding\n   advertisements.  The security associated with these advertisements
    is\n   part of the security applied to routing protocols such as IS-IS\n   [RFC5304]
    and OSPF [RFC5709], which both optionally make use of\n   cryptographic authentication
    mechanisms.  This form of advertisement\n   is more centralized, on behalf of
    the node advertising the IP\n   reachability, which presents a different risk
    profile.  This document\n   also specifies a mechanism by which the ill effects
    of advertising\n   conflicting label bindings can be mitigated.  In particular,\n
    \  advertisements from the node advertising the IP reachability is more\n   preferred
    than the centralized one.  This document recognizes that\n   errors in configuration
    and/or programming may result in false or\n   conflicting label binding advertisements
    compromising traffic\n   forwarding.  Therefore, this document recommends the
    operator\n   implement strict configuration/programmability control, the\n   monitoring
    of the advertised SIDs, the preference of an IP\n   reachability SID Advertisement
    over a centralized SID Advertisement,\n   and the logging of any error message
    in order to avoid, or at least\n   significantly minimize, the possibility of
    such risk.\n"
  title: 7.  Security Considerations
- contents:
  - '8.  References

    '
  - contents:
    - "8.1.  Normative References\n   [RFC2119]  Bradner, S., \"Key words for use
      in RFCs to Indicate\n              Requirement Levels\", BCP 14, RFC 2119,\n
      \             DOI 10.17487/RFC2119, March 1997,\n              <https://www.rfc-editor.org/info/rfc2119>.\n
      \  [RFC5036]  Andersson, L., Ed., Minei, I., Ed., and B. Thomas, Ed.,\n              \"LDP
      Specification\", RFC 5036, DOI 10.17487/RFC5036,\n              October 2007,
      <https://www.rfc-editor.org/info/rfc5036>.\n   [RFC8174]  Leiba, B., \"Ambiguity
      of Uppercase vs Lowercase in RFC\n              2119 Key Words\", BCP 14, RFC
      8174, DOI 10.17487/RFC8174,\n              May 2017, <https://www.rfc-editor.org/info/rfc8174>.\n
      \  [RFC8402]  Filsfils, C., Ed., Previdi, S., Ed., Ginsberg, L.,\n              Decraene,
      B., Litkowski, S., and R. Shakir, \"Segment\n              Routing Architecture\",
      RFC 8402, DOI 10.17487/RFC8402,\n              July 2018, <https://www.rfc-editor.org/info/rfc8402>.\n
      \  [RFC8660]  Bashandy, A., Ed., Filsfils, C., Ed., Previdi, S.,\n              Decraene,
      B., Litkowski, S., and R. Shakir, \"Segment\n              Routing with MPLS
      Data Plane\", RFC 8660,\n              DOI 10.17487/RFC8660, December 2019,\n
      \             <https://www.rfc-editor.org/info/rfc8660>.\n"
    title: 8.1.  Normative References
  - contents:
    - "8.2.  Informative References\n   [RFC3031]  Rosen, E., Viswanathan, A., and
      R. Callon, \"Multiprotocol\n              Label Switching Architecture\", RFC
      3031,\n              DOI 10.17487/RFC3031, January 2001,\n              <https://www.rfc-editor.org/info/rfc3031>.\n
      \  [RFC3209]  Awduche, D., Berger, L., Gan, D., Li, T., Srinivasan, V.,\n              and
      G. Swallow, \"RSVP-TE: Extensions to RSVP for LSP\n              Tunnels\",
      RFC 3209, DOI 10.17487/RFC3209, December 2001,\n              <https://www.rfc-editor.org/info/rfc3209>.\n
      \  [RFC4364]  Rosen, E. and Y. Rekhter, \"BGP/MPLS IP Virtual Private\n              Networks
      (VPNs)\", RFC 4364, DOI 10.17487/RFC4364, February\n              2006, <https://www.rfc-editor.org/info/rfc4364>.\n
      \  [RFC5304]  Li, T. and R. Atkinson, \"IS-IS Cryptographic\n              Authentication\",
      RFC 5304, DOI 10.17487/RFC5304, October\n              2008, <https://www.rfc-editor.org/info/rfc5304>.\n
      \  [RFC5709]  Bhatia, M., Manral, V., Fanto, M., White, R., Barnes, M.,\n              Li,
      T., and R. Atkinson, \"OSPFv2 HMAC-SHA Cryptographic\n              Authentication\",
      RFC 5709, DOI 10.17487/RFC5709, October\n              2009, <https://www.rfc-editor.org/info/rfc5709>.\n
      \  [RFC5960]  Frost, D., Ed., Bryant, S., Ed., and M. Bocci, Ed., \"MPLS\n              Transport
      Profile Data Plane Architecture\", RFC 5960,\n              DOI 10.17487/RFC5960,
      August 2010,\n              <https://www.rfc-editor.org/info/rfc5960>.\n   [RFC7490]
      \ Bryant, S., Filsfils, C., Previdi, S., Shand, M., and N.\n              So,
      \"Remote Loop-Free Alternate (LFA) Fast Reroute (FRR)\",\n              RFC
      7490, DOI 10.17487/RFC7490, April 2015,\n              <https://www.rfc-editor.org/info/rfc7490>.\n
      \  [RFC8277]  Rosen, E., \"Using BGP to Bind MPLS Labels to Address\n              Prefixes\",
      RFC 8277, DOI 10.17487/RFC8277, October 2017,\n              <https://www.rfc-editor.org/info/rfc8277>.\n
      \  [RFC8287]  Kumar, N., Ed., Pignataro, C., Ed., Swallow, G., Akiya,\n              N.,
      Kini, S., and M. Chen, \"Label Switched Path (LSP)\n              Ping/Traceroute
      for Segment Routing (SR) IGP-Prefix and\n              IGP-Adjacency Segment
      Identifiers (SIDs) with MPLS Data\n              Planes\", RFC 8287, DOI 10.17487/RFC8287,
      December 2017,\n              <https://www.rfc-editor.org/info/rfc8287>.\n   [RFC8355]
      \ Filsfils, C., Ed., Previdi, S., Ed., Decraene, B., and R.\n              Shakir,
      \"Resiliency Use Cases in Source Packet Routing in\n              Networking
      (SPRING) Networks\", RFC 8355,\n              DOI 10.17487/RFC8355, March 2018,\n
      \             <https://www.rfc-editor.org/info/rfc8355>.\n   [RFC8665]  Psenak,
      P., Ed., Previdi, S., Ed., Filsfils, C., Gredler,\n              H., Shakir,
      R., Henderickx, W., and J. Tantsura, \"OSPF\n              Extensions for Segment
      Routing\", RFC 8665,\n              DOI 10.17487/RFC8665, December 2019,\n              <https://doi.org/10.17487/RFC8665>.\n
      \  [RFC8666]  Psenak, P., Ed. and S. Previdi, \"OSPFv3 Extensions for\n              Segment
      Routing\", RFC 8666, DOI 10.17487/RFC8666, December\n              2019, <https://doi.org/10.17487/RFC8666>.\n
      \  [RFC8667]  Previdi, S., Ginsberg, L., Filsfils, C., Bashandy, A.,\n              Gredler,
      H., and B. Decraene, \"IS-IS Extensions for\n              Segment Routing\",
      RFC 8667, DOI 10.17487/RFC8667, December\n              2019, <https://doi.org/10.17487/RFC8667>.\n"
    title: 8.2.  Informative References
  title: 8.  References
- contents:
  - "Appendix A.  Migration from LDP to SR\n                               PE2        PE4\n
    \                         PE1----P5--P6--P7---PE3\n                            Figure
    5: Migration\n   Several migration techniques are possible.  The technique described\n
    \  here is inspired by the commonly used method to migrate from one IGP\n   to
    another.\n   At time T0, all the routers run LDP.  Any service is tunneled from
    an\n   ingress PE to an egress PE over a continuous LDP LSP.\n   At time T1, all
    the routers are upgraded to SR.  They are configured\n   with the SRGB range [100,
    300].  PE1, PE2, PE3, PE4, P5, P6, and P7\n   are respectively configured with
    the node segments 101, 102, 103,\n   104, 105, 106, and 107 (attached to their
    service-recursing\n   loopback).\n      |  Note: At this time, the service traffic
    is still tunneled over\n      |  LDP LSPs.  For example, PE1 has an SR node segment
    to PE3 and\n      |  an LDP LSP to PE3.  As seen earlier, however, the LDP IP2MPLS\n
    \     |  encapsulation is preferred by default.  However, it has to be\n      |
    \ noted that the SR infrastructure is usable, e.g., for Fast\n      |  Reroute
    (FRR) or IGP Loop-Free Convergence to protect existing\n      |  IP and LDP traffic.
    \ FRR mechanisms are described in [RFC8355].\n   At time T2, the operator enables
    the local policy at PE1 to prefer SR\n   IP2MPLS encapsulation over LDP IP2MPLS.\n
    \     The service from PE1 to any other PE is now riding over SR.  All\n      other
    service traffic is still transported over LDP LSPs.\n   At time T3, gradually,
    the operator enables the preference for SR\n   IP2MPLS encapsulation across all
    the edge routers.\n      All the service traffic is now transported over SR.  LDP
    is still\n      operational and services could be reverted to LDP.\n   At time
    T4, LDP is unconfigured from all routers.\n"
  title: Appendix A.  Migration from LDP to SR
- contents:
  - "Acknowledgements\n   The authors would like to thank Pierre Francois, Ruediger
    Geib, and\n   Alexander Vainshtein for their contributions to the content of this\n
    \  document.\n"
  title: Acknowledgements
- contents:
  - "Contributors\n   Edward Crabbe\n   Individual\n   Email: edward.crabbe@gmail.com\n
    \  Igor Milojevic\n   Email: milojevicigor@gmail.com\n   Saku Ytti\n   TDC\n   Email:
    saku@ytti.fi\n   Rob Shakir\n   Google\n   Email: robjs@google.com\n   Martin
    Horneffer\n   Deutsche Telekom\n   Email: Martin.Horneffer@telekom.de\n   Wim
    Henderickx\n   Nokia\n   Email: wim.henderickx@nokia.com\n   Jeff Tantsura\n   Apstra,
    Inc.\n   Email: jefftant.ietf@gmail.com\n   Les Ginsberg\n   Cisco Systems\n   Email:
    ginsberg@cisco.com\n"
  title: Contributors
- contents:
  - "Authors' Addresses\n   Ahmed Bashandy (editor)\n   Individual\n   United States
    of America\n   Email: abashandy.ietf@gmail.com\n   Clarence Filsfils (editor)\n
    \  Cisco Systems, Inc.\n   Brussels\n   Belgium\n   Email: cfilsfil@cisco.com\n
    \  Stefano Previdi\n   Huawei Technologies\n   Italy\n   Email: stefano@previdi.net\n
    \  Bruno Decraene\n   Orange\n   France\n   Email: bruno.decraene@orange.com\n
    \  Stephane Litkowski\n   Orange\n"
  title: Authors' Addresses
