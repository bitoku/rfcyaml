- title: __initial_text__
  contents:
  - "             Locator/Identifier Separation Protocol (LISP)\n               Network\
    \ Element Deployment Considerations\n"
- title: Abstract
  contents:
  - "Abstract\n   This document is a snapshot of different Locator/Identifier\n  \
    \ Separation Protocol (LISP) deployment scenarios.  It discusses the\n   placement\
    \ of new network elements introduced by the protocol,\n   representing the thinking\
    \ of the LISP working group as of Summer\n   2013.  LISP deployment scenarios\
    \ may have evolved since then.  This\n   memo represents one stable point in that\
    \ evolution of understanding.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This document is not an Internet Standards Track specification;\
    \ it is\n   published for examination, experimental implementation, and\n   evaluation.\n\
    \   This document defines an Experimental Protocol for the Internet\n   community.\
    \  This document is a product of the Internet Engineering\n   Task Force (IETF).\
    \  It represents the consensus of the IETF\n   community.  It has received public\
    \ review and has been approved for\n   publication by the Internet Engineering\
    \ Steering Group (IESG).  Not\n   all documents approved by the IESG are a candidate\
    \ for any level of\n   Internet Standard; see Section 2 of RFC 5741.\n   Information\
    \ about the current status of this document, any errata,\n   and how to provide\
    \ feedback on it may be obtained at\n   http://www.rfc-editor.org/info/rfc7215.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2014 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (http://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.  Code Components\
    \ extracted from this document must\n   include Simplified BSD License text as\
    \ described in Section 4.e of\n   the Trust Legal Provisions and are provided\
    \ without warranty as\n   described in the Simplified BSD License.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1. Introduction ....................................................3\n\
    \   2. Tunnel Routers ..................................................5\n  \
    \    2.1. Deployment Scenarios .......................................5\n    \
    \       2.1.1. Customer Edge (CE) ..................................5\n      \
    \     2.1.2. Provider Edge (PE) ..................................6\n        \
    \   2.1.3. Tunnel Routers behind NAT ...........................8\n          \
    \        2.1.3.1. ITR ........................................8\n            \
    \      2.1.3.2. ETR ........................................9\n              \
    \    2.1.3.3. Additional Notes ...........................9\n      2.2. Functional\
    \ Models with Tunnel Routers ......................9\n           2.2.1. Split\
    \ ITR/ETR .......................................9\n           2.2.2. Inter-Service-Provider\
    \ Traffic Engineering .........11\n      2.3. Summary and Feature Matrix ................................13\n\
    \   3. Map-Servers and Map-Resolvers ..................................14\n  \
    \    3.1. Map-Servers ...............................................14\n    \
    \  3.2. Map-Resolvers .............................................16\n   4. Proxy\
    \ Tunnel Routers ...........................................17\n      4.1. PITRs\
    \ .....................................................17\n      4.2. PETRs .....................................................18\n\
    \   5. Migration to LISP ..............................................19\n  \
    \    5.1. LISP+BGP ..................................................19\n    \
    \  5.2. Mapping Service Provider (MSP) PITR Service ...............20\n      5.3.\
    \ Proxy-ITR Route Distribution (PITR-RD) ....................20\n      5.4. Migration\
    \ Summary .........................................23\n   6. Security Considerations\
    \ ........................................24\n   7. Acknowledgements ...............................................24\n\
    \   8. References .....................................................24\n  \
    \    8.1. Normative References ......................................24\n    \
    \  8.2. Informative References ....................................24\n   Appendix\
    \ A. Step-by-Step Example BGP-to-LISP Migration Procedure ..26\n     A.1. Customer\
    \ Pre-Install and Pre-Turn-Up Checklist .............26\n     A.2. Customer Activating\
    \ LISP Service ...........................28\n     A.3. Cut-Over Provider Preparation\
    \ and Changes ..................29\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   The Locator/Identifier Separation Protocol (LISP) is designed\
    \ to\n   address the scaling issues of the global Internet routing system\n  \
    \ identified in [RFC4984] by separating the current addressing scheme\n   into\
    \ Endpoint IDentifiers (EIDs) and Routing LOCators (RLOCs).  The\n   main protocol\
    \ specification [RFC6830] describes how the separation is\n   achieved and which\
    \ new network elements are introduced, and it\n   details the packet formats for\
    \ the data and control planes.\n   LISP assumes that such separation is between\
    \ the edge and core and\n   uses mapping and encapsulation for forwarding.  While\
    \ the boundary\n   between both is not strictly defined, one widely accepted definition\n\
    \   places it at the border routers of stub autonomous systems, which may\n  \
    \ carry a partial or complete default-free zone (DFZ) routing table.\n   The initial\
    \ design of LISP took this location as a baseline for\n   protocol development.\
    \  However, the applications of LISP go beyond\n   just decreasing the size of\
    \ the DFZ routing table and include\n   improved multihoming and ingress traffic\
    \ engineering (TE) support for\n   edge networks, and even individual hosts. \
    \ Throughout this document,\n   we will use the term \"LISP site\" to refer to\
    \ these networks/hosts\n   behind a LISP Tunnel Router.  We formally define the\
    \ following\n   two terms:\n   Network element:  Facility or equipment used in\
    \ the provision of a\n      communications service over the Internet [TELCO96].\n\
    \   LISP site:  A single host or a set of network elements in an edge\n      network\
    \ under the administrative control of a single organization,\n      delimited\
    \ from other networks by LISP Tunnel Router(s).\n   Since LISP is a protocol that\
    \ can be used for different purposes, it\n   is important to identify possible\
    \ deployment scenarios and the\n   additional requirements they may impose on\
    \ the protocol specification\n   and other protocols.  Additionally, this document\
    \ is intended as a\n   guide for the operational community for LISP deployments\
    \ in their\n   networks.  It is expected to evolve as LISP deployment progresses,\n\
    \   and the described scenarios are better understood or new scenarios\n   are\
    \ discovered.\n   Each subsection considers an element type and discusses the\
    \ impact of\n   deployment scenarios on the protocol specification.  For definitions\n\
    \   of terms, please refer to the appropriate documents (as cited in the\n   respective\
    \ sections).\n   This experimental document describes deployment considerations.\n\
    \   These considerations and the LISP specifications have areas that\n   require\
    \ additional experience and measurement.  LISP is not\n   recommended for deployment\
    \ beyond experimental situations.  Results\n   of experimentation may lead to\
    \ modifications and enhancements of LISP\n   mechanisms.  Additionally, at the\
    \ time of this writing there is no\n   standardized security to implement.  Beware\
    \ that there are no\n   countermeasures for any of the threats identified in [LISP-THREATS].\n\
    \   See Section 15 of [RFC6830] for specific known issues that are in\n   need\
    \ of further work during development, implementation, and\n   experimentation,\
    \ and see [LISP-THREATS] for recommendations to\n   ameliorate the above-mentioned\
    \ security threats.\n"
- title: 2.  Tunnel Routers
  contents:
  - "2.  Tunnel Routers\n   The device that is the gateway between the edge and the\
    \ core is\n   called a Tunnel Router (xTR); it performs one or both of two separate\n\
    \   functions:\n   1.  Encapsulating packets originating from an end host to be\n\
    \       transported over intermediary (transit) networks towards the\n       other\
    \ endpoint of the communication.\n   2.  Decapsulating packets entering from intermediary\
    \ (transit)\n       networks, originated at a remote end host.\n   The first function\
    \ is performed by an Ingress Tunnel Router (ITR) and\n   the second by an Egress\
    \ Tunnel Router (ETR).\n   Section 8 of the main LISP specification [RFC6830]\
    \ has a short\n   discussion of where Tunnel Routers can be deployed and some\
    \ of the\n   associated advantages and disadvantages.  This section adds more\n\
    \   detail to the scenarios presented there and provides additional\n   scenarios\
    \ as well.  Furthermore, this section discusses functional\n   models, that is,\
    \ network functions that can be achieved by deploying\n   Tunnel Routers in specific\
    \ ways.\n"
- title: 2.1.  Deployment Scenarios
  contents:
  - '2.1.  Deployment Scenarios

    '
- title: 2.1.1.  Customer Edge (CE)
  contents:
  - "2.1.1.  Customer Edge (CE)\n   The first scenario we discuss is the customer\
    \ edge, when xTR\n   functionality is placed on the router(s) that connects the\
    \ LISP site\n   to its upstream(s) but is under its control.  As such, this is\
    \ the\n   most common expected scenario for xTRs, and this document considers\n\
    \   it the reference location, comparing the other scenarios to this one.\n  \
    \                             ISP1    ISP2\n                                |\
    \        |\n                                |        |\n                     \
    \         +----+  +----+\n                           +--|xTR1|--|xTR2|--+\n  \
    \                         |  +----+  +----+  |\n                           | \
    \                 |\n                           |     LISP site    |\n       \
    \                    +------------------+\n                    Figure 1: xTRs\
    \ at the Customer Edge\n   From the LISP site's perspective, the main advantage\
    \ of this type of\n   deployment (compared to the one described in the next section)\
    \ is\n   having direct control over its ingress traffic engineering.  This\n \
    \  makes it easy to set up and maintain active/active, active/backup, or\n   more\
    \ complex TE policies, adding ISPs and additional xTRs at will,\n   without involving\
    \ third parties.\n   Being under the same administrative control, reachability\
    \ information\n   of all ETRs is easier to synchronize, because the necessary\
    \ control\n   traffic can be allowed between the locators of the ETRs.  A correct\n\
    \   synchronous global view of the reachability status is thus available,\n  \
    \ and the Locator-Status-Bits can be set correctly in the LISP data\n   header\
    \ of outgoing packets.\n   By placing the Tunnel Router at the edge of the site,\
    \ existing\n   internal network configuration does not need to be modified.\n\
    \   Firewall rules, router configurations, and address assignments inside\n  \
    \ the LISP site remain unchanged.  This helps with incremental\n   deployment\
    \ and allows a quick upgrade path to LISP.  For larger sites\n   distributed in\
    \ geographically diverse points of presence (PoPs) and\n   having many external\
    \ connections and complex internal topology, it\n   may, however, make more sense\
    \ to both encapsulate and decapsulate as\n   soon as possible, to benefit from\
    \ the information in the IGP to\n   choose the best path.  See Section 2.2.1 for\
    \ a discussion of this\n   scenario.\n   Another thing to consider when placing\
    \ Tunnel Routers is MTU issues.\n   Encapsulation increases the amount of overhead\
    \ associated with each\n   packet.  This added overhead decreases the effective\
    \ end-to-end path\n   MTU (unless fragmentation and reassembly are used).  Some\
    \ transit\n   networks are known to provide larger MTU values than the typical\n\
    \   value of 1500 bytes for popular access technologies used at end hosts\n  \
    \ (e.g., IEEE 802.3 and 802.11).  However, placing the LISP router\n   connecting\
    \ to such a network at the customer edge could possibly\n   bring up MTU issues,\
    \ depending on the link type to the provider as\n   opposed to the following scenario.\
    \  See [RFC4459] for MTU\n   considerations of tunneling protocols and how to\
    \ mitigate potential\n   issues.  Still, even with these mitigations, path MTU\
    \ issues are\n   still possible.\n"
- title: 2.1.2.  Provider Edge (PE)
  contents:
  - "2.1.2.  Provider Edge (PE)\n   The other location at the core-edge boundary for\
    \ deploying LISP\n   routers is at the Internet service provider edge.  The main\
    \ incentive\n   for this case is that the customer does not have to upgrade the\
    \ CE\n   router(s) or change the configuration of any equipment.\n   Encapsulation/decapsulation\
    \ happens in the provider's network, which\n   may be able to serve several customers\
    \ with a single device.  For\n   large ISPs with many residential/business customers\
    \ asking for LISP,\n   this can lead to important savings, since there is no need\
    \ to upgrade\n   the software (or hardware, if that's the case) at each client's\n\
    \   location.  Instead, they can upgrade the software (or hardware) on a\n   few\
    \ PE routers serving the customers.  This scenario is depicted in\n   Figure 2.\n\
    \                 +----------+        +------------------+\n                 |\
    \   ISP1   |        |       ISP2       |\n                 |          |      \
    \  |                  |\n                 |  +----+  |        |  +----+  +----+\
    \  |\n                 +--|xTR1|--+        +--|xTR2|--|xTR3|--+\n            \
    \        +----+              +----+  +----+\n                       |        \
    \          |       |\n                       |                  |       |\n  \
    \                     +--<[LISP site]>---+-------+\n                    Figure\
    \ 2: xTRs at the Provider Edge\n   While this approach can make transition easy\
    \ for customers and may be\n   cheaper for providers, the LISP site loses one\
    \ of the main benefits\n   of LISP: ingress traffic engineering.  Since the provider\
    \ controls\n   the ETRs, additional complexity would be needed to allow customers\
    \ to\n   modify their mapping entries.\n   The problem is aggravated when the\
    \ LISP site is multihomed.  Consider\n   the scenario in Figure 2: whenever a\
    \ change to TE policies is\n   required, the customer contacts both ISP1 and ISP2\
    \ to make the\n   necessary changes on the routers (if they provide this possibility).\n\
    \   It is, however, unlikely that both ISPs will apply changes\n   simultaneously,\
    \ which may lead to inconsistent state for the mappings\n   of the LISP site.\
    \  Since the different upstream ISPs are usually\n   competing business entities,\
    \ the ETRs may even be configured to\n   compete, to either attract all the traffic\
    \ or get no traffic.  The\n   former will happen if the customer pays per volume,\
    \ the latter if the\n   connectivity has a fixed price.  A solution could be to\
    \ configure the\n   Map-Server(s) to do proxy-replying and have the Mapping Service\n\
    \   Provider (MSP) apply policies.\n   Additionally, since xTR1, xTR2, and xTR3\
    \ are in different\n   administrative domains, locator reachability information\
    \ is unlikely\n   to be exchanged among them, making it difficult to set the\n\
    \   Locator-Status-Bits (LSBs) correctly on encapsulated packets.\n   Because\
    \ of this, and due to the security concerns about LSBs as\n   described in [LISP-THREATS],\
    \ their use is discouraged (set the L-bit\n   to 0).  Map-Versioning is another\
    \ alternative [RFC6834].\n   Compared to the customer edge scenario, deploying\
    \ LISP at the\n   provider edge might have the advantage of diminishing potential\
    \ MTU\n   issues, because the Tunnel Router is closer to the core, where links\n\
    \   typically have higher MTUs than edge network links.\n"
- title: 2.1.3.  Tunnel Routers behind NAT
  contents:
  - "2.1.3.  Tunnel Routers behind NAT\n   \"NAT\" in this section refers to IPv4\
    \ network address and port\n   translation.\n"
- title: 2.1.3.1.  ITR
  contents:
  - "2.1.3.1.  ITR\n           _.--.                                           _.--.\n\
    \       ,-''     `--.              +-------+            ,-''     `--.\n      '\
    \     EID     `   (Private) |  NAT  | (Public) ,'     RLOC    `.\n     (     \
    \           )---[ITR]---|       |---------(                 )\n      .    space\
    \    ,'  (Address) |  Box  |(Address)  .    space    ,'\n       `--.     _.-'\
    \              +-------+            `--.     _.-'\n           `--''          \
    \                                 `--''\n                         Figure 3: ITR\
    \ behind NAT\n   Packets encapsulated by an ITR are just UDP packets from a NAT\n\
    \   device's point of view, and they are handled like any UDP packet;\n   there\
    \ are no additional requirements for LISP data packets.\n   Map-Requests sent\
    \ by an ITR, which create the state in the NAT table,\n   have a different 5-tuple\
    \ in the IP header than the Map-Reply\n   generated by the authoritative ETR.\
    \  Since the source address of this\n   packet is different from the destination\
    \ address of the request\n   packet, no state will be matched in the NAT table\
    \ and the packet will\n   be dropped.  To avoid this, the NAT device has to do\
    \ the following:\n   o  Send all UDP packets with source port 4342, regardless\
    \ of the\n      destination port, to the RLOC of the ITR.  The simplest way to\n\
    \      achieve this is configuring 1:1 NAT mode from the external RLOC of\n  \
    \    the NAT device to the ITR's RLOC (called \"DMZ\" mode in consumer\n     \
    \ broadband routers).\n   o  Rewrite the ITR-AFI and \"Originating ITR RLOC Address\"\
    \ fields in\n      the payload.\n   This setup supports only a single ITR behind\
    \ the NAT device.\n"
- title: 2.1.3.2.  ETR
  contents:
  - "2.1.3.2.  ETR\n   An ETR placed behind NAT is reachable from the outside by the\n\
    \   Internet-facing locator of the NAT device.  It needs to know this\n   locator\
    \ (and configure a loopback interface with it), so that it can\n   use it in Map-Reply\
    \ and Map-Register messages.  Thus, support for\n   dynamic locators for the mapping\
    \ database is needed in LISP\n   equipment.\n   Again, only one ETR behind the\
    \ NAT device is supported.\n           _.--.                                 \
    \          _.--.\n       ,-''     `--.              +-------+            ,-''\
    \     `--.\n      '     EID     `   (Private) |  NAT  | (Public) ,'     RLOC \
    \   `.\n     (                )---[ETR]---|       |---------(                \
    \ )\n      .    space    ,'  (Address) |  Box  |(Address)  .    space    ,'\n\
    \       `--.     _.-'              +-------+            `--.     _.-'\n      \
    \     `--''                                           `--''\n                \
    \        Figure 4: ETR behind NAT\n"
- title: 2.1.3.3.  Additional Notes
  contents:
  - "2.1.3.3.  Additional Notes\n   An implication of the issues described above is\
    \ that LISP sites with\n   xTRs cannot be behind carrier-based NATs, since two\
    \ different sites\n   would collide on the same forwarded UDP port.  An alternative\
    \ to\n   static hole-punching to explore is the use of the Port Control\n   Protocol\
    \ (PCP) [RFC6887].\n   We only include this scenario due to completeness, to show\
    \ that a\n   LISP site can be deployed behind NAT should it become necessary.\n\
    \   However, LISP deployments behind NAT should be avoided, if possible.\n"
- title: 2.2.  Functional Models with Tunnel Routers
  contents:
  - "2.2.  Functional Models with Tunnel Routers\n   This section describes how certain\
    \ LISP deployments can provide\n   network functions.\n"
- title: 2.2.1.  Split ITR/ETR
  contents:
  - "2.2.1.  Split ITR/ETR\n   In a simple LISP deployment, xTRs are located at the\
    \ border of the\n   LISP site (see Section 2.1.1).  In this scenario, packets\
    \ are routed\n   inside the domain according to the EID.  However, more complex\n\
    \   networks may want to route packets according to the destination RLOC.\n  \
    \ This would enable them to choose the best egress point.\n   The LISP specification\
    \ separates the ITR and ETR functionality and\n   allows both entities to be deployed\
    \ in separated network equipment.\n   ITRs can be deployed closer to the host\
    \ (i.e., access routers).  This\n   way, packets are encapsulated as soon as possible,\
    \ and egress point\n   selection is driven by operational policy.  In turn, ETRs\
    \ can be\n   deployed at the border routers of the network, and packets are\n\
    \   decapsulated as soon as possible.  Once decapsulated, packets are\n   routed\
    \ based on the destination EID according to internal routing\n   policy.\n   We\
    \ can see an example in Figure 5.  The Source (S) transmits packets\n   using\
    \ its EID, and in this particular case packets are encapsulated\n   at ITR_1.\
    \  The encapsulated packets are routed inside the domain\n   according to the\
    \ destination RLOC and can egress the network through\n   the best point (i.e.,\
    \ closer to the RLOC's Autonomous System (AS)).\n   On the other hand, inbound\
    \ packets are received by ETR_1, which\n   decapsulates them.  Then, packets are\
    \ routed towards S according to\n   the EID, again following the best path.\n\
    \      +---------------------------------------+\n      |                    \
    \                   |\n      |       +-------+                   +-------+   \
    \      +-------+\n      |       | ITR_1 |---------+         | ETR_1 |-RLOC_A--|\
    \ ISP_A |\n      |       +-------+         |         +-------+         +-------+\n\
    \      |  +-+        |           |             |\n      |  |S|        |    IGP\
    \    |             |\n      |  +-+        |           |             |\n      |\
    \       +-------+         |         +-------+         +-------+\n      |     \
    \  | ITR_2 |---------+         | ETR_2 |-RLOC_B--| ISP_B |\n      |       +-------+\
    \                   +-------+         +-------+\n      |                     \
    \                  |\n      +---------------------------------------+\n      \
    \               Figure 5: Split ITR/ETR Scenario\n   This scenario has a set of\
    \ implications:\n   o  The site must carry more-specific routes in order to choose\
    \ the\n      best egress point, and typically BGP is used for this, increasing\n\
    \      the complexity of the network.  However, this is usually already\n    \
    \  the case for LISP sites that would benefit from this scenario.\n   o  If the\
    \ site is multihomed to different ISPs and any of the\n      upstream ISPs are\
    \ doing unicast reverse path forwarding (uRPF)\n      filtering, this scenario\
    \ may become impractical.  To set the\n      correct source RLOC in the encapsulation\
    \ header, ITRs need to\n      first determine which ETR will be used by the outgoing\
    \ packet.\n      This adds complexity and reliability concerns.\n   o  In LISP,\
    \ ITRs set the reachability bits when encapsulating data\n      packets.  Hence,\
    \ ITRs need a mechanism to be aware of the liveness\n      of all ETRs serving\
    \ their site.\n   o  The MTU within the site network must be large enough to\n\
    \      accommodate encapsulated packets.\n   o  In this scenario, each ITR is\
    \ serving fewer hosts than in the case\n      when it is deployed at the border\
    \ of the network.  It has been\n      shown that the cache hit rate grows logarithmically\
    \ with the\n      amount of users [CACHE].  Taking this into account, when ITRs\
    \ are\n      deployed closer to the host the effectiveness of the mapping cache\n\
    \      may be lower (i.e., the miss rate is higher).  Another consequence\n  \
    \    of this is that the site may transmit a higher amount of\n      Map-Requests,\
    \ increasing the load on the distributed mapping\n      database.\n   o  By placing\
    \ the ITRs inside the site, they will still need global\n      RLOCs.  This may\
    \ add complexity to intra-site routing\n      configurations and more intra-site\
    \ issues when there is a change\n      of providers.\n"
- title: 2.2.2.  Inter-Service-Provider Traffic Engineering
  contents:
  - "2.2.2.  Inter-Service-Provider Traffic Engineering\n   At the time of this writing,\
    \ if two ISPs want to control their\n   ingress TE policies for transit traffic\
    \ between them, they need to\n   rely on existing BGP mechanisms.  This typically\
    \ means deaggregating\n   prefixes to choose on which upstream link packets should\
    \ enter.  This\n   either is not feasible (if fine-grained per-customer control\
    \ is\n   required, the very-specific prefixes may not be propagated) or\n   increases\
    \ DFZ table size.\n   Typically, LISP is seen as applicable only to stub networks;\
    \ however,\n   LISP can also be applied in a recursive manner, providing service\n\
    \   provider ingress/egress TE capabilities without impacting the DFZ\n   table\
    \ size.\n   In order to implement this functionality with LISP, consider the\n\
    \   scenario depicted in Figure 6.  The two ISPs willing to achieve\n   ingress/egress\
    \ TE are labeled as ISP_A and ISP_B.  They are servicing\n   Stub1 and Stub2,\
    \ respectively.  Both are required to be LISP sites\n   with their own xTRs. \
    \ In this scenario, we assume that Stub1 and\n   Stub2 are communicating with\
    \ each other; thus, ISP_A and ISP_B offer\n   transit for such communications.\
    \  ISP_A has RLOC_A1 and RLOC_A2 as\n   upstream IP addresses, while ISP_B has\
    \ RLOC_B1 and RLOC_B2.  The\n   shared goal among ISP_A and ISP_B is to control\
    \ the transit traffic\n   flow between RLOC_A1/A2 and RLOC_B1/B2.\n          \
    \                         _.--.\n    Stub1 ...   +-------+      ,-''     `--.\
    \      +-------+   ... Stub2\n             \\  |   R_A1|----,'             `.\
    \ ---|R_B1   |  /\n              --|       |   (     Transit     )   |       |--\n\
    \     ...  .../  |   R_A2|-----.             ,' ---|R_B2   |  \\... ...\n    \
    \            +-------+      `--.     _.-'      +-------+\n     ...  ...     ISP_A\
    \            `--''            ISP_B     ... ...\n               Figure 6: Inter-Service-Provider\
    \ TE Scenario\n   Both ISPs deploy xTRs on RLOC_A1/A2 and RLOC_B1/B2, respectively\
    \ and\n   reach a bilateral agreement to deploy their own private mapping\n  \
    \ system.  This mapping system contains bindings between the RLOCs of\n   Stub1\
    \ and Stub2 (owned by ISP_A and ISP_B, respectively) and RLOC_A1/\n   A2 and RLOC_B1/B2.\
    \  Such bindings are in fact the TE policies between\n   both ISPs, and the convergence\
    \ time is expected to be fast, since\n   ISPs only have to update/query a mapping\
    \ to/from the database.\n   The packet flow is as follows.  First, a packet originated\
    \ at Stub1\n   towards Stub2 is LISP encapsulated by Stub1's xTR.  The xTR of\
    \ ISP_A\n   recursively encapsulates it, and according to the TE policies stored\n\
    \   in the private mapping system the ISP_A xTR chooses RLOC_B1 or\n   RLOC_B2\
    \ as the outer encapsulation destination.  Note that the packet\n   transits between\
    \ ISP_A and ISP_B double-encapsulated.  Upon reception\n   at the xTR of ISP_B,\
    \ the packet is decapsulated and sent towards\n   Stub2, which performs the last\
    \ decapsulation.\n   This deployment scenario, which uses recursive LISP, includes\
    \ three\n   important caveats.  First, it is intended to be deployed between only\n\
    \   two ISPs.  If more than two ISPs use this approach, then either the\n   xTRs\
    \ deployed at the participating ISPs must query multiple mapping\n   systems,\
    \ or the ISPs must agree on a common shared mapping system.\n   Furthermore, keeping\
    \ this deployment scenario restricted to only two\n   ISPs maintains a scalable\
    \ solution, given that only two entities need\n   to agree on using recursive\
    \ LISP and only one private mapping system\n   is involved.\n   Second, the scenario\
    \ is only recommended for ISPs providing\n   connectivity to LISP sites, such\
    \ that source RLOCs of packets to be\n   recursively encapsulated belong to said\
    \ ISP.  Otherwise, the\n   participating ISPs must register prefixes they do not\
    \ own in the\n   above-mentioned private mapping system.  This results in either\n\
    \   requiring complex authentication mechanisms or enabling simple\n   traffic\
    \ redirection attacks.  Failure to follow these recommendations\n   may lead to\
    \ operational security issues when deploying this scenario.\n   And third, recursive\
    \ encapsulation models are typically complex to\n   troubleshoot and debug.\n\
    \   Besides these recommendations, the main disadvantages of this\n   deployment\
    \ case are:\n   o  An extra LISP header is needed.  This increases the packet\
    \ size\n      and requires that the MTU between both ISPs accommodate double-\n\
    \      encapsulated packets.\n   o  The ISP ITR must encapsulate packets and therefore\
    \ must know the\n      RLOC-to-RLOC bindings.  These bindings are stored in a\
    \ mapping\n      database and may be cached in the ITR's mapping cache.  Cache\n\
    \      misses lead to an additional lookup latency, unless a push-based\n    \
    \  mapping system is used for the private mapping system.\n   o  Maintaining the\
    \ shared mapping database involves operational\n      overhead.\n"
- title: 2.3.  Summary and Feature Matrix
  contents:
  - "2.3.  Summary and Feature Matrix\n   When looking at the deployment scenarios\
    \ and functional models above,\n   there are several things to consider when choosing\
    \ an appropriate\n   model, depending on the type of the organization doing the\n\
    \   deployment.\n   For home users and small sites that wish to multihome and\
    \ have\n   control over their ISP options, the \"CE\" scenario offers the most\n\
    \   advantages: it's simple to deploy, and in some cases it only requires\n  \
    \ a software upgrade of the Customer Premises Equipment (CPE), getting\n   mapping\
    \ service, and configuring the router.  It retains control of\n   TE and choosing\
    \ upstreams by the user.  It doesn't provide too many\n   advantages to ISPs,\
    \ due to the lessened dependence on their services\n   in cases of multihomed\
    \ clients.  It is also unlikely that ISPs\n   wishing to offer LISP to their customers\
    \ will choose the \"CE\" model,\n   as they would need to send a technician to\
    \ each customer and,\n   potentially, a new CPE device.  Even if they have remote\
    \ control over\n   the router and a software upgrade could add LISP support, the\n\
    \   operation is too risky.\n   For a network operator, a good option to deploy\
    \ is the \"PE\" scenario,\n   unless a hardware upgrade is required for its edge\
    \ routers to support\n   LISP (in which case upgrading CPEs may be simpler). \
    \ It retains\n   control of TE as well as the choice of Proxy Egress Tunnel Router\n\
    \   (PETR) and Map-Server/Map-Resolver.  It also lowers potential MTU\n   issues,\
    \ as discussed above.  Network operators should also explore\n   the \"inter-service-provider\
    \ TE\" (recursive) functional model for\n   their TE needs.\n   To optimize their\
    \ traffic flow, large organizations can benefit the\n   most from the \"split\
    \ ITR/ETR\" functional model.\n   The following table gives a quick overview of\
    \ the features supported\n   by each of the deployment scenarios discussed above\
    \ (marked with an\n   \"x\" in the appropriate column): \"CE\" for customer edge,\
    \ \"PE\" for\n   provider edge, \"Split\" for split ITR/ETR, and \"Recursive\"\
    \ for\n   inter-service-provider traffic engineering.  The discussed features\n\
    \   include:\n   Control of ingress TE:  This scenario allows the LISP site to\
    \ easily\n      control LISP ingress traffic engineering policies.\n   No modifications\
    \ to existing int. network infrastructure:  This\n      scenario doesn't require\
    \ the LISP site to modify internal network\n      configurations.\n   Locator-Status-Bits\
    \ sync:  This scenario allows easy synchronization\n      of the Locator Status\
    \ Bits.\n   MTU/PMTUD issues minimized:  The scenario minimizes potential MTU\
    \ and\n      Path MTU Discovery (PMTUD) issues.\n   Feature                  \
    \       CE    PE    Split   Recursive   NAT\n   --------------------------------------------------------------------\n\
    \   Control of ingress TE            x     -      x         x        x\n   No\
    \ modifications to existing\n      int. network infrastructure   x     x     \
    \ -         -        x\n   Locator-Status-Bits sync         x     -      x   \
    \      x        -\n   MTU/PMTUD issues minimized       -     x      -        \
    \ -        -\n"
- title: 3.  Map-Servers and Map-Resolvers
  contents:
  - "3.  Map-Servers and Map-Resolvers\n   Map-Servers and Map-Resolvers make up the\
    \ LISP mapping system and\n   provide a means to find authoritative EID-to-RLOC\
    \ mapping\n   information, conforming to [RFC6833].  They are meant to be deployed\n\
    \   in RLOC space, and their operation behind NAT is not supported.\n"
- title: 3.1.  Map-Servers
  contents:
  - "3.1.  Map-Servers\n   The Map-Server learns EID-to-RLOC mapping entries from\
    \ an\n   authoritative source and publishes them in the distributed mapping\n\
    \   database.  These entries are learned through authenticated\n   Map-Register\
    \ messages sent by authoritative ETRs.  Also, upon\n   reception of a Map-Request,\
    \ the Map-Server verifies that the\n   destination EID matches an EID-Prefix for\
    \ which it is authoritative\n   and then re-encapsulates and forwards it to a\
    \ matching ETR.\n   Map-Server functionality is described in detail in [RFC6833].\n\
    \   The Map-Server is provided by a Mapping Service Provider (MSP).  The\n   MSP\
    \ participates in the global distributed mapping database\n   infrastructure by\
    \ setting up connections to other participants\n   according to the specific mapping\
    \ system that is employed (e.g.,\n   Alternative Logical Topology (ALT) [RFC6836],\
    \ Delegated Database Tree\n   (DDT) [LISP-DDT]).  Participation in the mapping\
    \ database and the\n   storing of EID-to-RLOC mapping data are subject to the\
    \ policies of\n   the \"root\" operators, who should check ownership rights for\
    \ the\n   EID-Prefixes stored in the database by participants.  These policies\n\
    \   are out of scope for this document.\n   The LISP DDT protocol is used by LISP\
    \ MSPs to provide reachability\n   between those providers' Map-Resolvers and\
    \ Map-Servers.  The DDT root\n   is currently operated by a collection of organizations\
    \ on an open\n   basis.  See [DDT-ROOT] for more details.  Similarly to the DNS\
    \ root,\n   it has several different server instances using names of the letters\n\
    \   of the Greek alphabet (alpha, delta, etc.), operated by independent\n   organizations.\
    \  When this document was published, there were 6 such\n   instances, with one\
    \ of them being anycasted.  [DDT-ROOT] provides the\n   list of server instances\
    \ on its web site and configuration files for\n   several Map-Server implementations.\
    \  The DDT root and LISP Mapping\n   Providers both rely on and abide by existing\
    \ allocation policies as\n   defined by Regional Internet Registries (RIRs) to\
    \ determine prefix\n   ownership for use as EIDs.\n   It is expected that the\
    \ DDT root organizations will continue to\n   evolve in response to experimentation\
    \ with LISP deployments for\n   Internet edge multihoming and VPN use cases.\n\
    \   In all cases, the MSP configures its Map-Server(s) to publish the\n   prefixes\
    \ of its clients in the distributed mapping database and start\n   encapsulating\
    \ and forwarding Map-Requests to the ETRs of the AS.\n   These ETRs register their\
    \ prefix(es) with the Map-Server(s) through\n   periodic authenticated Map-Register\
    \ messages.  In this context, for\n   some LISP sites, there is a need for mechanisms\
    \ to:\n   o  Automatically distribute EID-Prefix(es) shared keys between the\n\
    \      ETRs and the EID-registrar Map-Server.\n   o  Dynamically obtain the address\
    \ of the Map-Server in the ETR of\n      the AS.\n   The Map-Server plays a key\
    \ role in the reachability of the\n   EID-Prefixes it is serving.  On one hand,\
    \ it is publishing these\n   prefixes into the distributed mapping database, and\
    \ on the other\n   hand, it is encapsulating and forwarding Map-Requests to the\n\
    \   authoritative ETRs of these prefixes.  ITRs encapsulating towards\n   EIDs\
    \ for which a failed Map-Server is responsible will be unable to\n   look up any\
    \ of their covering prefixes.  The only exceptions are the\n   ITRs that already\
    \ contain the mappings in their local caches.  In\n   this case, ITRs can reach\
    \ ETRs until the entry expires (typically\n   24 hours).  For this reason, redundant\
    \ Map-Server deployments are\n   desirable.  A set of Map-Servers providing high-availability\
    \ service\n   to the same set of prefixes is called a redundancy group.  ETRs\
    \ are\n   configured to send Map-Register messages to all Map-Servers in the\n\
    \   redundancy group.  The configuration for fail-over (or\n   load-balancing,\
    \ if desired) among the members of the group depends on\n   the technology behind\
    \ the mapping system being deployed.  Since ALT\n   is based on BGP and DDT takes\
    \ its inspiration from the Domain Name\n   System (DNS), deployments can leverage\
    \ current industry best\n   practices for redundancy in BGP and DNS.  These best\
    \ practices are\n   out of scope for this document.\n   Additionally, if a Map-Server\
    \ has no reachability for any ETR serving\n   a given EID block, it should not\
    \ originate that block into the\n   mapping system.\n"
- title: 3.2.  Map-Resolvers
  contents:
  - "3.2.  Map-Resolvers\n   A Map-Resolver is a network infrastructure component\
    \ that accepts\n   LISP-encapsulated Map-Requests, typically from an ITR, and\
    \ finds the\n   appropriate EID-to-RLOC mapping by consulting the distributed\
    \ mapping\n   database.  Map-Resolver functionality is described in detail in\n\
    \   [RFC6833].\n   Anyone with access to the distributed mapping database can\
    \ set up a\n   Map-Resolver and provide EID-to-RLOC mapping lookup service.\n\
    \   Database access setup is mapping system specific.\n   For performance reasons,\
    \ it is recommended that LISP sites use\n   Map-Resolvers that are topologically\
    \ close to their ITRs.  ISPs\n   supporting LISP will provide this service to\
    \ their customers,\n   possibly restricting access to their user base.  LISP sites\
    \ not in\n   this position can use open access Map-Resolvers, if available.\n\
    \   However, regardless of the availability of open access resolvers, the\n  \
    \ MSP providing the Map-Server(s) for a LISP site should also make\n   available\
    \ Map-Resolver(s) for the use of that site.\n   In medium- to large-size ASes,\
    \ ITRs must be configured with the RLOC\n   of a Map-Resolver; this type of operation\
    \ can be done manually.\n   However, in Small Office/Home Office (SOHO) scenarios,\
    \ a mechanism\n   for autoconfiguration should be provided.\n   One solution to\
    \ avoid manual configuration in LISP sites of any size\n   is the use of anycast\
    \ [RFC4786] RLOCs for Map-Resolvers, similar to\n   the DNS root server infrastructure.\
    \  Since LISP uses UDP\n   encapsulation, the use of anycast would not affect\
    \ reliability.  LISP\n   routers are then shipped with a preconfigured list of\
    \ well-known\n   Map-Resolver RLOCs, which can be edited by the network administrator,\n\
    \   if needed.\n   The use of anycast also helps improve mapping lookup performance.\n\
    \   Large MSPs can increase the number and geographical diversity of\n   their\
    \ Map-Resolver infrastructure, using a single anycasted RLOC.\n   Once LISP deployment\
    \ is advanced enough, very large content providers\n   may also be interested\
    \ in running this kind of setup, to ensure\n   minimal connection setup latency\
    \ for those connecting to their\n   network from LISP sites.\n   While Map-Servers\
    \ and Map-Resolvers implement different\n   functionalities within the LISP mapping\
    \ system, they can coexist on\n   the same device.  For example, MSPs offering\
    \ both services can deploy\n   a single Map-Resolver/Map-Server in each PoP where\
    \ they have a\n   presence.\n"
- title: 4.  Proxy Tunnel Routers
  contents:
  - '4.  Proxy Tunnel Routers

    '
- title: 4.1.  PITRs
  contents:
  - "4.1.  PITRs\n   Proxy Ingress Tunnel Routers (PITRs) are part of the non-LISP/LISP\n\
    \   transition mechanism, allowing non-LISP sites to reach LISP sites.\n   They\
    \ announce via BGP certain EID-Prefixes (aggregated, whenever\n   possible) to\
    \ attract traffic from non-LISP sites towards EIDs in the\n   covered range. \
    \ They do the mapping system lookup and encapsulate\n   received packets towards\
    \ the appropriate ETR.  Note that for the\n   reverse path, LISP sites can reach\
    \ non-LISP sites by simply not\n   encapsulating traffic.  See [RFC6832] for a\
    \ detailed description of\n   PITR functionality.\n   The success of new protocols\
    \ depends greatly on their ability to\n   maintain backwards compatibility and\
    \ interoperate with the\n   protocol(s) they intend to enhance or replace, and\
    \ on the incentives\n   to deploy the necessary new software or equipment.  A\
    \ LISP site needs\n   an interworking mechanism to be reachable from non-LISP\
    \ sites.  A\n   PITR can fulfill this role, enabling early adopters to see the\n\
    \   benefits of LISP, similar to tunnel brokers helping the transition\n   from\
    \ IPv4 to IPv6.  A site benefits from new LISP functionality\n   (proportionally\
    \ with existing global LISP deployment) when migrating\n   to LISP, so it has\
    \ the incentives to deploy the necessary Tunnel\n   Routers.  In order to be reachable\
    \ from non-LISP sites, it has two\n   options: keep announcing its prefix(es)\
    \ with BGP, or have a PITR\n   announce prefix(es) covering them.\n   If the goal\
    \ of reducing the DFZ routing table size is to be reached,\n   the second option\
    \ is preferred.  Moreover, the second option allows\n   LISP-based ingress traffic\
    \ engineering from all sites.  However, the\n   placement of PITRs significantly\
    \ influences performance and\n   deployment incentives.  Section 5 is dedicated\
    \ to the migration to a\n   LISP-enabled Internet and includes deployment scenarios\
    \ for PITRs.\n"
- title: 4.2.  PETRs
  contents:
  - "4.2.  PETRs\n   In contrast to PITRs, PETRs are not required for the correct\n\
    \   functioning of all LISP sites.  There are two cases where they can be\n  \
    \ of great help:\n   o  LISP sites with unicast reverse path forwarding (uRPF)\n\
    \      restrictions, and\n   o  Communication between sites using different address\
    \ family RLOCs.\n   In the first case, uRPF filtering is applied at the LISP site's\n\
    \   upstream provider's PE router.  When forwarding traffic to non-LISP\n   sites,\
    \ an ITR does not encapsulate packets, leaving the original IP\n   headers intact.\
    \  As a result, packets will have EIDs in their source\n   address.  Since we\
    \ are discussing the transition period, we can\n   assume that a prefix covering\
    \ the EIDs belonging to the LISP site is\n   advertised to the global routing\
    \ tables by a PITR, and the PE router\n   has a route towards it.  However, the\
    \ next hop will not be on the\n   interface towards the CE router, so non-encapsulated\
    \ packets will\n   fail uRPF checks.\n   To avoid this filtering, the affected\
    \ ITR encapsulates packets\n   towards the locator of the PETR for non-LISP destinations.\
    \  Now the\n   source address of the packets, as seen by the PE router, is the\
    \ ITR's\n   locator, which will not fail the uRPF check.  The PETR then\n   decapsulates\
    \ and forwards the packets.\n   The second use case is IPv4-to-IPv6 transition.\
    \  Service providers\n   using older access network hardware that only supports\
    \ IPv4 can still\n   offer IPv6 to their clients by providing a CPE device running\
    \ LISP,\n   and PETR(s) for accessing IPv6-only non-LISP sites and LISP sites,\n\
    \   with IPv6-only locators.  Packets originating from the client LISP\n   site\
    \ for these destinations would be encapsulated towards the PETR's\n   IPv4 locator.\
    \  The PETR is in a native IPv6 network, decapsulating\n   and forwarding packets.\
    \  For non-LISP destinations, the packet\n   travels natively from the PETR. \
    \ For LISP destinations with IPv6-only\n   locators, the packet will go through\
    \ a PITR in order to reach its\n   destination.\n   For more details on PETRs,\
    \ see [RFC6832].\n   PETRs can be deployed by ISPs wishing to offer value-added\
    \ services\n   to their customers.  As is the case with PITRs, PETRs too may\n\
    \   introduce path stretch (the ratio between the cost of the selected\n   path\
    \ and that of the optimal path).  Because of this, the ISP needs\n   to consider\
    \ the tradeoff of using several devices close to the\n   customers to minimize\
    \ it, or fewer devices farther away from the\n   customers to minimize cost instead.\n\
    \   Since the deployment incentives for PITRs and PETRs are different, it\n  \
    \ is likely that they will be deployed in separate devices, except for\n   the\
    \ Content Delivery Network (CDN) case, which may deploy both in a\n   single device.\n\
    \   In all cases, the existence of a PETR involves another step in the\n   configuration\
    \ of a LISP router.  CPE routers, which are typically\n   configured by DHCP,\
    \ stand to benefit most from PETRs.\n   Autoconfiguration of the PETR locator\
    \ could be achieved by a DHCP\n   option or by adding a PETR field to either Map-Notify\
    \ or Map-Reply\n   messages.\n"
- title: 5.  Migration to LISP
  contents:
  - "5.  Migration to LISP\n   This section discusses a deployment architecture to\
    \ support the\n   migration to a LISP-enabled Internet.  The loosely defined terms\n\
    \   \"early transition phase\", \"late transition phase\", and \"LISP Internet\n\
    \   phase\" refer to time periods when LISP sites are a minority, a\n   majority,\
    \ or represent all edge networks, respectively.\n"
- title: 5.1.  LISP+BGP
  contents:
  - "5.1.  LISP+BGP\n   For sites wishing to migrate to LISP with their Provider-Independent\n\
    \   (PI) prefix, the least disruptive way is to upgrade their border\n   routers\
    \ to support LISP and register the prefix into the LISP mapping\n   system, but\
    \ to keep announcing it with BGP as well.  This way, LISP\n   sites will reach\
    \ them over LISP, while legacy sites will be\n   unaffected by the change.  The\
    \ main disadvantage of this approach is\n   that no decrease in the DFZ routing\
    \ table size is achieved.  Still,\n   just increasing the number of LISP sites\
    \ is an important gain, as an\n   increasing LISP/non-LISP site ratio may decrease\
    \ the need for\n   BGP-based traffic engineering that leads to prefix deaggregation.\n\
    \   That, in turn, may lead to a decrease in the DFZ size and churn in\n   the\
    \ late transition phase.\n   This scenario is not limited to sites that already\
    \ have their\n   prefixes announced with BGP.  Newly allocated EID blocks could\
    \ follow\n   this strategy as well during the early LISP deployment phase,\n \
    \  depending on the cost/benefit analysis of the individual networks.\n   Since\
    \ this leads to an increase in the DFZ size, the following\n   architecture should\
    \ be preferred for new allocations.\n"
- title: 5.2.  Mapping Service Provider (MSP) PITR Service
  contents:
  - "5.2.  Mapping Service Provider (MSP) PITR Service\n   In addition to publishing\
    \ their clients' registered prefixes in the\n   mapping system, MSPs with enough\
    \ transit capacity can offer PITR\n   service to them as a separate service. \
    \ This service is especially\n   useful for new PI allocations to sites without\
    \ existing BGP\n   infrastructure wishing to avoid BGP altogether.  The MSP announces\n\
    \   the prefix into the DFZ, and the client benefits from ingress traffic\n  \
    \ engineering without prefix deaggregation.  The downside of this\n   scenario\
    \ is added path stretch.\n   Routing all non-LISP ingress traffic through a third\
    \ party that is\n   not one of its ISPs is only feasible for sites with modest\
    \ amounts of\n   traffic (like those using the IPv6 tunnel broker services today),\n\
    \   especially in the first stage of the transition to LISP, with a\n   significant\
    \ number of legacy sites.  This is because the handling of\n   said traffic is\
    \ likely to result in additional costs, which would be\n   passed down to the\
    \ client.  When the LISP/non-LISP site ratio becomes\n   high enough, this approach\
    \ can prove increasingly attractive.\n   Compared to LISP+BGP, this approach avoids\
    \ DFZ bloat caused by prefix\n   deaggregation for traffic engineering purposes,\
    \ resulting in slower\n   routing table increase in the case of new allocations\
    \ and potential\n   decrease for existing ones.  Moreover, MSPs serving different\
    \ clients\n   with adjacent aggregatable prefixes may lead to additional decrease,\n\
    \   but quantifying this decrease is subject to future research study.\n"
- title: 5.3.  Proxy-ITR Route Distribution (PITR-RD)
  contents:
  - "5.3.  Proxy-ITR Route Distribution (PITR-RD)\n   Instead of a LISP site or the\
    \ MSP announcing its EIDs with BGP to the\n   DFZ, this function can be outsourced\
    \ to a third party, a PITR Service\n   Provider (PSP).  This will result in a\
    \ decrease in operational\n   complexity at both the site and the MSP.\n   The\
    \ PSP manages a set of distributed PITR(s) that will advertise the\n   corresponding\
    \ EID-Prefixes through BGP to the DFZ.  These PITRs will\n   then encapsulate\
    \ the traffic they receive for those EIDs towards the\n   RLOCs of the LISP site,\
    \ ensuring their reachability from non-LISP\n   sites.\n   While it is possible\
    \ for a PSP to manually configure each client's\n   EID-Routes to be announced,\
    \ this approach offers little flexibility\n   and is not scalable.  This section\
    \ presents a scalable architecture\n   that offers automatic distribution of EID-Routes\
    \ to LISP sites and\n   service providers.\n   The architecture requires no modification\
    \ to existing LISP network\n   elements, but it introduces a new (conceptual)\
    \ network element, the\n   EID-Route Server, which is defined as a router that\
    \ either propagates\n   routes learned from other EID-Route Servers or originates\
    \ EID-Routes.\n   The EID-Routes that it originates are those for which it is\n\
    \   authoritative.  It propagates these routes to Proxy-ITRs within the\n   AS\
    \ of the EID-Route Server.  It is worth noting that a BGP-capable\n   router can\
    \ also be considered an EID-Route Server.\n   Further, an EID-Route is defined\
    \ as a prefix originated via the Route\n   Server of the MSP, which should be\
    \ aggregated if the MSP has multiple\n   customers inside a single large continuous\
    \ prefix.  This prefix is\n   propagated to other PITRs both within the MSP and\
    \ to other PITR\n   operators with which it peers.  EID-Route Servers are operated\
    \ by\n   either the LISP site, MSPs, or PSPs and may be collocated with a\n  \
    \ Map-Server or PITR, but they are functionally discrete entities.\n   They distribute\
    \ EID-Routes, using BGP, to other domains according to\n   policies set by participants.\n\
    \                              MSP (AS64500)\n                              RS\
    \ ---> PITR\n                               |        /\n                     \
    \          |  _.--./\n                              ,-''    /`--.\n          \
    \   LISP site   ---,' |     v     `.\n                           (   |   DFZ \
    \      )----- Mapping system\n         non-LISP site   ----. |    ^      ,'\n\
    \                              `--. /   _.-'\n                               |\
    \  `--''\n                               v /\n                             PITR\n\
    \                             PSP (AS64501)\n                      Figure 7: PITR-RD\
    \ Architecture\n   The architecture described above decouples EID origination\
    \ from route\n   propagation, with the following benefits:\n   o  Can accurately\
    \ represent business relationships between PITR\n      operators\n   o  Is more\
    \ mapping system agnostic\n   o  Makes minor changes to PITR implementation; no\
    \ changes to other\n      components\n   In the example in Figure 7, we have a\
    \ MSP providing services to the\n   LISP site.  The LISP site does not run BGP\
    \ and gets an EID allocation\n   directly from a RIR, or from the MSP, which may\
    \ be a Local Internet\n   Registry (LIR).  Existing PI allocations can be migrated\
    \ as well.\n   The MSP ensures the presence of the prefix in the mapping system\
    \ and\n   runs an EID-Route Server to distribute it to PSPs.  Since the LISP\n\
    \   site does not run BGP, the prefix will be originated with the AS\n   number\
    \ of the MSP.\n   In the simple case depicted in Figure 7, the EID-Route of a\
    \ LISP site\n   will be originated by the Route Server and announced to the DFZ\
    \ by\n   the PSP's PITRs with AS path 64501 64500.  From that point on, the\n\
    \   usual BGP dynamics apply.  This way, routes announced by the PITR are\n  \
    \ still originated by the authoritative Route Server.  Note that the\n   peering\
    \ relationships between MSPs/PSPs and those in the underlying\n   forwarding plane\
    \ may not be congruent, making the AS path to a PITR\n   shorter than it is in\
    \ reality.\n   The non-LISP site will select the best path towards the EID-Prefix\n\
    \   according to its local BGP policies.  Since AS-path length is usually\n  \
    \ an important metric for selecting paths, careful placement of PITRs\n   could\
    \ significantly reduce path stretch between LISP and non-LISP\n   sites.\n   The\
    \ architecture allows for flexible policies between MSPs/PSPs.\n   Consider the\
    \ EID-Route Server networks as control plane overlays,\n   facilitating the implementation\
    \ of policies necessary to reflect the\n   business relationships between participants.\
    \  The results are then\n   injected into the common underlying forwarding plane.\
    \  For example,\n   some MSPs/PSPs may agree to exchange EID-Prefixes and only\
    \ announce\n   them to each of their forwarding plane customers.  Global\n   reachability\
    \ of an EID-Prefix depends on the MSP from which the LISP\n   site buys service\
    \ and is also subject to agreement between the above-\n   mentioned parties.\n\
    \   In terms of impact on the DFZ, this architecture results in a slower\n   routing\
    \ table increase for new allocations, since traffic engineering\n   will be done\
    \ at the LISP level.  For existing allocations migrating\n   to LISP, the DFZ\
    \ may decrease, since MSPs may be able to aggregate\n   the prefixes announced.\n\
    \   Compared to LISP+BGP, this approach avoids DFZ bloat caused by prefix\n  \
    \ deaggregation for traffic engineering purposes, resulting in slower\n   routing\
    \ table increase in the case of new allocations and potential\n   decrease for\
    \ existing ones.  Moreover, MSPs serving different clients\n   with adjacent aggregatable\
    \ prefixes may lead to additional decrease,\n   but quantifying this decrease\
    \ is subject to future research study.\n   The flexibility and scalability of\
    \ this architecture do not come\n   without a cost, however: A PSP operator has\
    \ to establish either\n   transit or peering relationships to improve its connectivity.\n"
- title: 5.4.  Migration Summary
  contents:
  - "5.4.  Migration Summary\n   Registering a domain name typically entails an annual\
    \ fee that should\n   cover the operating expenses for publishing the domain in\
    \ the global\n   DNS.  This situation is similar for several other registration\n\
    \   services.  A LISP MSP client publishing an EID-Prefix in the LISP\n   mapping\
    \ system has the option of signing up for PITR services as\n   well, for an extra\
    \ fee.  These services may be offered by the MSP\n   itself, but it is expected\
    \ that specialized PSPs will do it.  Clients\n   that do not sign up will be responsible\
    \ for getting non-LISP traffic\n   to their EIDs (using the LISP+BGP scenario).\n\
    \   Additionally, Tier 1 ISPs have incentives to offer PITR services to\n   non-subscribers\
    \ in strategic places just to attract more traffic from\n   competitors and thus\
    \ more revenue.\n   The following table presents the expected effects that the\
    \ transition\n   scenarios at various phases will have on the DFZ routing table\
    \ size:\n    Phase            | LISP+BGP     | MSP PITR        | PITR-RD\n   \
    \ -----------------+--------------+-----------------+----------------\n    Early\
    \ transition | no change    | slower increase | slower increase\n    Late transition\
    \  | may decrease | slower increase | slower increase\n    LISP Internet    |\
    \             considerable decrease\n   It is expected that PITR-RD will coexist\
    \ with LISP+BGP during the\n   migration, with the latter being more popular in\
    \ the early transition\n   phase.  As the transition progresses and the MSP PITR\
    \ and PITR-RD\n   ecosystem gets more ubiquitous, LISP+BGP should become less\n\
    \   attractive, slowing down the increase of the number of routes in\n   the DFZ.\n\
    \   Note that throughout Section 5 we focused on the effects of LISP\n   deployment\
    \ on the DFZ routing table size.  Other metrics may be\n   impacted as well but\
    \ to the best of our knowledge have not been\n   measured as yet.\n"
- title: 6.  Security Considerations
  contents:
  - "6.  Security Considerations\n   All security implications of LISP deployments\
    \ are to be discussed in\n   separate documents.  [LISP-THREATS] gives an overview\
    \ of LISP threat\n   models, including ETR operators attracting traffic by overclaiming\
    \ an\n   EID-Prefix (Section 4.4.3 of [LISP-THREATS]).  Securing mapping\n   lookups\
    \ is discussed in [LISP-SEC].\n"
- title: 7.  Acknowledgements
  contents:
  - "7.  Acknowledgements\n   Many thanks to Margaret Wasserman for her contribution\
    \ to the IETF 76\n   presentation that kickstarted this work.  The authors would\
    \ also like\n   to thank Damien Saucez, Luigi Iannone, Joel Halpern, Vince Fuller,\n\
    \   Dino Farinacci, Terry Manderson, Noel Chiappa, Hannu Flinck, Paul\n   Vinciguerra,\
    \ Fred Templin, Brian Haberman, and everyone else who\n   provided input.\n"
- title: 8.  References
  contents:
  - '8.  References

    '
- title: 8.1.  Normative References
  contents:
  - "8.1.  Normative References\n   [RFC6830]  Farinacci, D., Fuller, V., Meyer, D.,\
    \ and D. Lewis, \"The\n              Locator/ID Separation Protocol (LISP)\",\
    \ RFC 6830,\n              January 2013.\n   [RFC6832]  Lewis, D., Meyer, D.,\
    \ Farinacci, D., and V. Fuller,\n              \"Interworking between Locator/ID\
    \ Separation Protocol\n              (LISP) and Non-LISP Sites\", RFC 6832, January\
    \ 2013.\n   [RFC6833]  Fuller, V. and D. Farinacci, \"Locator/ID Separation\n\
    \              Protocol (LISP) Map-Server Interface\", RFC 6833,\n           \
    \   January 2013.\n"
- title: 8.2.  Informative References
  contents:
  - "8.2.  Informative References\n   [CACHE]    Jung, J., Sit, E., Balakrishnan,\
    \ H., and R. Morris, \"DNS\n              performance and the effectiveness of\
    \ caching\", IEEE/ACM\n              Transactions on Networking (TON), Volume\
    \ 10, Issue 5,\n              pages 589-603, October 2002.\n   [DDT-ROOT] \"Introduction\
    \ to LISP DDT: DDT Root\", March 2014,\n              <http://ddt-root.org/>.\n\
    \   [LISP-DDT] Fuller, V., Lewis, D., Ermagan, V., and A. Jain, \"LISP\n     \
    \         Delegated Database Tree\", Work in Progress, March 2013.\n   [LISP-SEC]\
    \ Maino, F., Ermagan, V., Cabellos-Aparicio, A., Saucez, D.,\n              and\
    \ O. Bonaventure, \"LISP-Security (LISP-SEC)\", Work in\n              Progress,\
    \ October 2013.\n   [LISP-THREATS]\n              Saucez, D., Iannone, L., and\
    \ O. Bonaventure, \"LISP Threats\n              Analysis\", Work in Progress,\
    \ April 2014.\n   [RFC4459]  Savola, P., \"MTU and Fragmentation Issues with\n\
    \              In-the-Network Tunneling\", RFC 4459, April 2006.\n   [RFC4786]\
    \  Abley, J. and K. Lindqvist, \"Operation of Anycast\n              Services\"\
    , BCP 126, RFC 4786, December 2006.\n   [RFC4984]  Meyer, D., Zhang, L., and K.\
    \ Fall, \"Report from the IAB\n              Workshop on Routing and Addressing\"\
    , RFC 4984,\n              September 2007.\n   [RFC6834]  Iannone, L., Saucez,\
    \ D., and O. Bonaventure, \"Locator/ID\n              Separation Protocol (LISP)\
    \ Map-Versioning\", RFC 6834,\n              January 2013.\n   [RFC6835]  Farinacci,\
    \ D. and D. Meyer, \"The Locator/ID Separation\n              Protocol Internet\
    \ Groper (LIG)\", RFC 6835, January 2013.\n   [RFC6836]  Fuller, V., Farinacci,\
    \ D., Meyer, D., and D. Lewis,\n              \"Locator/ID Separation Protocol\
    \ Alternative Logical\n              Topology (LISP+ALT)\", RFC 6836, January\
    \ 2013.\n   [RFC6887]  Wing, D., Cheshire, S., Boucadair, M., Penno, R., and P.\n\
    \              Selkirk, \"Port Control Protocol (PCP)\", RFC 6887,\n         \
    \     April 2013.\n   [TELCO96]  Federal Communications Commission, \"Telecommunications\
    \ Act\n              of 1996\", 1996, <http://transition.fcc.gov/telecom.html>.\n"
- title: Appendix A.  Step-by-Step Example BGP-to-LISP Migration Procedure
  contents:
  - "Appendix A.  Step-by-Step Example BGP-to-LISP Migration Procedure\n   To help\
    \ the operational community deploy LISP, this informative\n   section offers a\
    \ step-by-step guide for migrating a BGP-based\n   Internet presence to a LISP\
    \ site.  It includes a pre-install/\n   pre-turn-up checklist, and customer and\
    \ provider activation\n   procedures.\n"
- title: A.1.  Customer Pre-Install and Pre-Turn-Up Checklist
  contents:
  - "A.1.  Customer Pre-Install and Pre-Turn-Up Checklist\n   1.  Determine how many\
    \ current physical service provider connections\n       the customer has, and\
    \ their existing bandwidth and traffic\n       engineering requirements.\n   \
    \    This information will determine the number of routing locators,\n       and\
    \ the priorities and weights that should be configured on\n       the xTRs.\n\
    \   2.  Make sure the customer router has LISP capabilities.\n       *  Check\
    \ the OS version of the CE router.  If LISP is an add-on,\n          check to\
    \ see if it is installed.\n          This information can be used to determine\
    \ if the platform is\n          appropriate to support LISP, in order to determine\
    \ if a\n          software and/or hardware upgrade is required.\n       *  Have\
    \ the customer upgrade (if necessary, software and/or\n          hardware) to\
    \ be LISP capable.\n   3.  Obtain the current running configuration of the CE\
    \ router.  A\n       suggested LISP router configuration example can be customized\
    \ to\n       the customer's existing environment.\n   4.  Verify MTU handling.\n\
    \       *  Request an increase in MTU to 1556 or more on service provider\n  \
    \        connections.  Prior to the MTU change, verify the transmission\n    \
    \      of a 1500-byte packet from the PxTR to the RLOC with the Don't\n      \
    \    Fragment (DF) bit set.\n       *  Ensure that the customer is not filtering\
    \ ICMP Unreachable or\n          Time Exceeded messages on their firewall or router.\n\
    \       LISP, like any tunneling protocol, will increase the size of\n       packets\
    \ when the LISP header is appended.  If increasing the MTU\n       of the access\
    \ links is not possible, care must be taken that ICMP\n       is not being filtered\
    \ in order to allow Path MTU Discovery to\n       take place.\n   5.  Validate\
    \ member prefix allocation.\n       This step checks to see whether the prefix\
    \ used by the customer\n       is a direct (Provider-Independent) prefix or a\
    \ prefix assigned by\n       a physical service provider (Provider Aggregatable).\
    \  If the\n       prefixes are assigned by other service providers, then a Letter\n\
    \       of Agreement is required to announce prefixes through the Proxy\n    \
    \   Service Provider.\n   6.  Verify the member RLOCs and their reachability.\n\
    \       This step ensures that the RLOCs configured on the CE router are\n   \
    \    in fact reachable and working.\n   7.  Prepare for cut-over.\n       *  If\
    \ possible, have a host outside of all security and filtering\n          policies\
    \ connected to the console port of the edge router or\n          switch.\n   \
    \    *  Make sure the customer has access to the router in order to\n        \
    \  configure it.\n"
- title: A.2.  Customer Activating LISP Service
  contents:
  - "A.2.  Customer Activating LISP Service\n   1.  The customer configures LISP on\
    \ CE router(s) according to the\n       configuration recommended by the service\
    \ provider.\n       The LISP configuration consists of the EID-Prefix, the locators,\n\
    \       and the weights and priorities of the mapping between the two\n      \
    \ values.  In addition, the xTR must be configured with\n       Map-Resolver(s),\
    \ Map-Server(s), and the shared key for\n       registering to Map-Server(s).\
    \  If required, Proxy-ETR(s) may be\n       configured as well.\n       In addition\
    \ to the LISP configuration:\n       *  Ensure that the default routes(s) to next-hop\
    \ external\n          neighbors is included and RLOCs are present in the\n   \
    \       configuration.\n       *  If two or more routers are used, ensure that\
    \ all RLOCs are\n          included in the LISP configuration on all routers.\n\
    \       *  It will be necessary to redistribute the default route via IGP\n  \
    \        between the external routers.\n   2.  When transition is ready, perform\
    \ a soft shutdown on existing\n       eBGP peer session(s).\n       *  From the\
    \ CE router, use the LISP Internet Groper (LIG)\n          [RFC6835] to ensure\
    \ that registration is successful.\n       *  To verify LISP connectivity, find\
    \ and ping LISP connected\n          sites.  If possible, find ping destinations\
    \ that are not\n          covered by a prefix in the global BGP routing system,\
    \ because\n          PITRs may deliver the packets even if LISP connectivity is\
    \ not\n          working.  Traceroutes may help determine if this is the case.\n\
    \       *  To verify connectivity to non-LISP sites, try accessing a\n       \
    \   landmark (e.g., a major Internet site) via a web browser.\n"
- title: A.3.  Cut-Over Provider Preparation and Changes
  contents:
  - "A.3.  Cut-Over Provider Preparation and Changes\n   1.  Verify site configuration,\
    \ and then verify active registration on\n       Map-Server(s).\n       *  Authentication\
    \ key.\n       *  EID-Prefix.\n   2.  Add EID space to map-cache on proxies.\n\
    \   3.  Add networks to BGP advertisement on proxies.\n       *  Modify route-maps/policies\
    \ on PxTRs.\n       *  Modify route policies on core routers (if non-connected\n\
    \          member).\n       *  Modify ingress policies on core routers.\n    \
    \   *  Ensure route announcement in looking glass servers,\n          RouteViews.\n\
    \   4.  Perform traffic verification test.\n       *  Ensure that MTU handling\
    \ is as expected (PMTUD working).\n       *  Ensure Proxy-ITR map-cache population.\n\
    \       *  Ensure access from traceroute/ping servers around Internet.\n     \
    \  *  Use a looking glass to check for external visibility of\n          registration\
    \ via several Map-Resolvers.\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Lorand Jakab\n   Cisco Systems\n   170 Tasman Drive\n\
    \   San Jose, CA  95134\n   USA\n   EMail: lojakab@cisco.com\n   Albert Cabellos-Aparicio\n\
    \   Technical University of Catalonia\n   C/Jordi Girona, s/n\n   BARCELONA  08034\n\
    \   Spain\n   EMail: acabello@ac.upc.edu\n   Florin Coras\n   Technical University\
    \ of Catalonia\n   C/Jordi Girona, s/n\n   BARCELONA  08034\n   Spain\n   EMail:\
    \ fcoras@ac.upc.edu\n   Jordi Domingo-Pascual\n   Technical University of Catalonia\n\
    \   C/Jordi Girona, s/n\n   BARCELONA  08034\n   Spain\n   EMail: jordi.domingo@ac.upc.edu\n\
    \   Darrel Lewis\n   Cisco Systems\n   170 Tasman Drive\n   San Jose, CA  95134\n\
    \   USA\n   EMail: darlewis@cisco.com\n"
