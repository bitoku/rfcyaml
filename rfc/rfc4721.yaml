- title: __initial_text__
  contents:
  - '          Mobile IPv4 Challenge/Response Extensions (Revised)

    '
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This document specifies an Internet standards track protocol\
    \ for the\n   Internet community, and requests discussion and suggestions for\n\
    \   improvements.  Please refer to the current edition of the \"Internet\n   Official\
    \ Protocol Standards\" (STD 1) for the standardization state\n   and status of\
    \ this protocol.  Distribution of this memo is unlimited.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (C) The IETF Trust (2007).\n"
- title: Abstract
  contents:
  - "Abstract\n   Mobile IP, as originally specified, defines an authentication\n\
    \   extension (the Mobile-Foreign Authentication extension) by which a\n   mobile\
    \ node can authenticate itself to a foreign agent.\n   Unfortunately, that extension\
    \ does not provide the foreign agent any\n   direct guarantee that the protocol\
    \ is protected from replays and does\n   not allow for the use of existing techniques\
    \ (such as Challenge\n   Handshake Authentication Protocol (CHAP)) for authenticating\
    \ portable\n   computer devices.\n   In this specification, we define extensions\
    \ for the Mobile IP Agent\n   Advertisements and the Registration Request that\
    \ allow a foreign\n   agent to use a challenge/response mechanism to authenticate\
    \ the\n   mobile node.\n   Furthermore, this document updates RFC 3344 by including\
    \ a new\n   authentication extension called the Mobile-Authentication,\n   Authorization,\
    \ and Accounting (AAA) Authentication extension.  This\n   new extension is provided\
    \ so that a mobile node can supply\n   credentials for authorization, using commonly\
    \ available AAA\n   infrastructure elements.  This authorization-enabling extension\
    \ MAY\n   co-exist in the same Registration Request with authentication\n   extensions\
    \ defined for Mobile IP Registration by RFC 3344.  This\n   document obsoletes\
    \ RFC 3012.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1. Introduction ....................................................2\n\
    \      1.1. Terminology ................................................3\n  \
    \ 2. Mobile IP Agent Advertisement Challenge Extension ...............4\n    \
    \  2.1. Handling of Solicited Agent Advertisements .................4\n   3. Operation\
    \ .......................................................5\n      3.1. Mobile\
    \ Node Processing of Registration Requests ............5\n      3.2. Foreign Agent\
    \ Processing of Registration Requests ..........6\n            3.2.1. Foreign\
    \ Agent Algorithm for Tracking Used\n                   Challenges .........................................8\n\
    \      3.3. Foreign Agent Processing of Registration Replies ...........9\n  \
    \    3.4. Home Agent Processing of Challenge Extensions .............10\n    \
    \  3.5. Mobile Node Processing of Registration Replies ............11\n   4. Mobile-Foreign\
    \ Challenge Extension .............................11\n   5. Generalized Mobile\
    \ IP Authentication Extension .................12\n   6. Mobile-AAA Authentication\
    \ Subtype ..............................13\n   7. Reserved SPIs for Mobile IP\
    \ ....................................14\n   8. SPIs for RADIUS AAA Servers ....................................14\n\
    \   9. Configurable Parameters ........................................15\n  \
    \ 10. Error Values ..................................................16\n   11.\
    \ IANA Considerations ...........................................16\n   12. Security\
    \ Considerations .......................................17\n   13. Acknowledgements\
    \ ..............................................18\n   14. Normative References\
    \ ..........................................18\n   Appendix A. Changes since RFC\
    \ 3012 ................................20\n   Appendix B. Verification Infrastructure\
    \ ...........................21\n   Appendix C. Message Flow for FA Challenge\
    \ Messaging with\n               Mobile-AAA Extension ..................................22\n\
    \   Appendix D. Message Flow for FA Challenge Messaging with\n               MN-FA\
    \ Authentication ..................................23\n   Appendix E. Example\
    \ Pseudo-code for Tracking Used Challenges ......24\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   Mobile IP defines the Mobile-Foreign Authentication extension\
    \ to\n   allow a mobile node to authenticate itself to a foreign agent.  Such\n\
    \   authentication mechanisms are mostly external to the principal\n   operation\
    \ of Mobile IP, since the foreign agent can easily route\n   packets to and from\
    \ a mobile node whether or not the mobile node is\n   reporting a legitimately\
    \ owned home address to the foreign agent.\n   Unfortunately, that extension does\
    \ not provide the foreign agent any\n   direct guarantee that the protocol is\
    \ protected from replays and does\n   not allow for the use of CHAP [RFC1994]\
    \ for authenticating portable\n   computer devices.  In this specification, we\
    \ define extensions for\n   the Mobile IP Agent Advertisements and the Registration\
    \ Request that\n   allow a foreign agent to use a challenge/ response mechanism\
    \ to\n   authenticate the mobile node.  Furthermore, an additional\n   authentication\
    \ extension, the Mobile-AAA authentication extension, is\n   provided so that\
    \ a mobile node can supply credentials for\n   authorization using commonly available\
    \ AAA infrastructure elements.\n   The foreign agent may be able to interact with\
    \ an AAA infrastructure\n   (using protocols outside the scope of this document)\
    \ to obtain a\n   secure indication that the mobile node is authorized to use\
    \ the local\n   network resources.\n"
- title: 1.1.  Terminology
  contents:
  - "1.1.  Terminology\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\", \"\
    SHALL\", \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"MAY\"\
    , and \"OPTIONAL\" in this\n   document are to be interpreted as described in\
    \ RFC 2119 [RFC2119].\n   This document uses the term Security Parameters Index\
    \ (SPI) as\n   defined in the base Mobile IP protocol specification [RFC3344].\
    \  All\n   SPI values defined in this document refer to values for the SPI as\n\
    \   defined in that specification.\n   The following additional terminology is\
    \ used in addition to that\n   defined in [RFC3344]:\n   previously used challenge:\n\
    \      The challenge is a previously used challenge if the mobile node\n     \
    \ sent the same challenge to the foreign agent in a previous\n      Registration\
    \ Request, and if that previous Registration Request\n      passed all validity\
    \ checks performed by the foreign agent.  The\n      foreign agent may not be\
    \ able to keep records for all previously\n      used challenges, but see Section\
    \ 3.2 for minimal requirements.\n   security association:\n      A \"mobility\
    \ security association\", as defined in [RFC3344].\n   unknown challenge:\n  \
    \    Any challenge from a particular mobile node that the foreign agent\n    \
    \  has no record of having put either into one of its recent Agent\n      Advertisements\
    \ or into a registration reply message to that mobile\n      node.\n   unused\
    \ challenge:\n      A challenge that has not already been accepted by the foreign\n\
    \      agent from the mobile node in the Registration Request, i.e., a\n     \
    \ challenge that is neither unknown nor previously used.\n"
- title: 2.  Mobile IP Agent Advertisement Challenge Extension
  contents:
  - "2.  Mobile IP Agent Advertisement Challenge Extension\n   This section defines\
    \ a new extension to the Router Discovery Protocol\n   [RFC1256] for use by foreign\
    \ agents that need to issue a challenge\n   for authenticating mobile nodes.\n\
    \      0                   1                   2                   3\n      0\
    \ 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      |     Type      |    Length     |          Challenge ...\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \                    Figure 1.  The Challenge Extension\n   Type:\n      24\n\
    \   Length:\n      The length of the Challenge value in octets; SHOULD be at least\
    \ 4.\n   Challenge:\n      A random value that SHOULD be at least 32 bits.\n \
    \  The Challenge extension, illustrated in Figure 1, is inserted in the\n   Agent\
    \ Advertisements by the foreign agent in order to communicate a\n   previously\
    \ unused challenge value that can be used by the mobile node\n   to compute an\
    \ authentication for its next registration request\n   message.  The challenge\
    \ is selected by the foreign agent to provide\n   local assurance that the mobile\
    \ node is not replaying any earlier\n   registration request.  Eastlake et al.\
    \ [RFC4086] provides more\n   information on generating pseudo-random numbers\
    \ suitable for use as\n   values for the challenge.\n   Note that the storage\
    \ of different Challenges received in Agent\n   Advertisements from multiple foreign\
    \ agents is implementation\n   specific and hence out of scope for this specification.\n"
- title: 2.1.  Handling of Solicited Agent Advertisements
  contents:
  - "2.1.  Handling of Solicited Agent Advertisements\n   When a foreign agent generates\
    \ an Agent Advertisement in response to\n   a Router Solicitation [RFC1256], some\
    \ additional considerations come\n   into play.  According to the Mobile IP base\
    \ specification [RFC3344],\n   the resulting Agent Advertisement may be either\
    \ multicast or unicast.\n   If the solicited Agent Advertisement is multicast,\
    \ the foreign agent\n   MUST NOT generate a new Challenge value and update its\
    \ window of\n   remembered advertised Challenges.  It must instead re-use the\
    \ most\n   recent of the CHALLENGE_WINDOW Advertisement Challenge values\n   (Section\
    \ 9).\n   If the agent advertisement is unicast back to the soliciting mobile\n\
    \   node, it MUST be handled as follows: If the challenge most recently\n   unicast\
    \ to the soliciting mobile node has not been previously used\n   (as defined in\
    \ Section 1.1), it SHOULD be repeated in the newly\n   issued unicast agent advertisement.\
    \  Otherwise, a new challenge MUST\n   be generated and remembered as the most\
    \ recent challenge issued to\n   the mobile node.  For further discussion of this,\
    \ see Section 12.\n"
- title: 3.  Operation
  contents:
  - "3.  Operation\n   This section describes modifications to the Mobile IP registration\n\
    \   process [RFC3344] that may occur after the foreign agent issues a\n   Mobile\
    \ IP Agent Advertisement containing the Challenge on its local\n   link.  See\
    \ Appendix C for a diagram showing the canonical message\n   flow for messages\
    \ related to the processing of the foreign agent\n   challenge values.\n"
- title: 3.1.  Mobile Node Processing of Registration Requests
  contents:
  - "3.1.  Mobile Node Processing of Registration Requests\n   Retransmission behavior\
    \ for Registration Requests is identical to\n   that specified in Mobile IP specification\
    \ [RFC3344].  A retransmitted\n   Registration Request MAY use the same Challenge\
    \ value as given in the\n   original Registration Request.\n   Whenever the Agent\
    \ Advertisement contains the Challenge extension, if\n   the mobile node does\
    \ not have a security association with the foreign\n   agent, then it MUST include\
    \ the Challenge value in a Mobile-Foreign\n   Challenge extension to the Registration\
    \ Request message.  If, on the\n   other hand, the mobile node does have a security\
    \ association with the\n   foreign agent, it SHOULD include the Challenge value\
    \ in its\n   Registration Request message.\n   If the mobile node has a security\
    \ association with the Foreign Agent,\n   it MUST include a Mobile-Foreign Authentication\
    \ extension in its\n   Registration Request message, according to the base Mobile\
    \ IP\n   specification [RFC3344].  When the Registration Request contains the\n\
    \   Mobile-Foreign Challenge extension specified in Section 4, the\n   Mobile-Foreign\
    \ Authentication MUST follow the Challenge extension in\n   the Registration Request.\
    \  The mobile node MAY also include the\n   Mobile-AAA Authentication extension.\n\
    \   If both the Mobile-Foreign Authentication and the Mobile-AAA\n   Authentication\
    \ extensions are present, the Mobile-Foreign Challenge\n   extension MUST precede\
    \ the Mobile-AAA Authentication extension, and\n   the Mobile-AAA Authentication\
    \ extension MUST precede the Mobile-\n   Foreign Authentication extension.\n \
    \  If the mobile node does not have a security association with the\n   foreign\
    \ agent, the mobile node MUST include the Mobile-AAA\n   Authentication extension\
    \ as, defined in Section 6, when it includes\n   the Mobile-Foreign Challenge\
    \ extension.  In addition, the mobile node\n   SHOULD include the NAI extension\
    \ [RFC2794] to enable the foreign\n   agent to make use of available verification\
    \ infrastructure that\n   requires this.  The SPI field of the Mobile-AAA Authentication\n\
    \   extension specifies the particular secret and algorithm (shared\n   between\
    \ the mobile node and the verification infrastructure) that\n   must be used to\
    \ perform the authentication.  If the SPI value is\n   chosen as CHAP_SPI (see\
    \ Section 9), then the mobile node specifies\n   CHAP-style authentication [RFC1994]\
    \ using MD5 [RFC1321].\n   In either case, the Mobile-Foreign Challenge extension\
    \ followed by\n   one of the above specified authentication extensions MUST follow\
    \ the\n   Mobile-Home Authentication extension, if present.\n   A mobile node\
    \ MAY include the Mobile-AAA Authentication extension in\n   the Registration\
    \ Request when the mobile node registers directly with\n   its home agent (using\
    \ a co-located care-of address).  In this case,\n   the mobile node uses an SPI\
    \ value of CHAP_SPI (Section 8) in the\n   Mobile Node-Authentication, Authorization,\
    \ and Accounting (MN-AAA)\n   Authentication extension and MUST NOT include the\
    \ Mobile-Foreign\n   Challenge extension.  Also, replay protection for the Registration\n\
    \   Request in this case is provided by the Identification field defined\n   by\
    \ [RFC3344].\n"
- title: 3.2.  Foreign Agent Processing of Registration Requests
  contents:
  - "3.2.  Foreign Agent Processing of Registration Requests\n   Upon receipt of the\
    \ Registration Request, if the foreign agent has\n   issued a Challenge as part\
    \ of its Agent Advertisements, and if it\n   does not have a security association\
    \ with the mobile node, then the\n   foreign agent SHOULD check that the Mobile-Foreign\
    \ Challenge\n   extension exists, and that it contains a challenge value previously\n\
    \   unused by the mobile node.  This ensures that the mobile node is not\n   attempting\
    \ to replay a previous advertisement and authentication.  In\n   this case, if\
    \ the Registration Request does not include a Challenge\n   extension, the foreign\
    \ agent MUST send a Registration Reply with the\n   Code field set to missing_challenge.\n\
    \   If a mobile node retransmits a Registration Request with the same\n   Challenge\
    \ extension, and if the foreign agent still has a pending\n   Registration Request\
    \ record in effect for the mobile node, then the\n   foreign agent forwards the\
    \ Registration Request to the Home Agent\n   again.  The foreign agent SHOULD\
    \ check that the mobile node is\n   actually performing a retransmission, by verifying\
    \ that the relevant\n   fields of the retransmitted request (including, if present,\
    \ the\n   mobile node NAI extension [RFC2794]) are the same as represented in\n\
    \   the visitor list entry for the pending Registration Request (Section\n   3.7.1\
    \ of [RFC3344]).  This verification MUST NOT include the\n   \"remaining Lifetime\
    \ of the pending registration\" or the\n   Identification field, since those values\
    \ are likely to change even\n   for requests that are merely retransmissions and\
    \ not new Registration\n   Requests.  In all other circumstances, if the foreign\
    \ agent receives\n   a Registration Request with a Challenge extension containing\
    \ a\n   Challenge value previously used by that mobile node, the foreign\n   agent\
    \ SHOULD send a Registration Reply to the mobile node, containing\n   the Code\
    \ value stale_challenge.\n   The foreign agent MUST NOT accept any Challenge in\
    \ the Registration\n   Request unless it was offered in the last Registration\
    \ Reply or\n   unicast Agent Advertisement sent to the mobile node or advertised\
    \ as\n   one of the last CHALLENGE_WINDOW (see Section 9) Challenge values\n \
    \  inserted into the immediately preceding Agent Advertisements.  If the\n   Challenge\
    \ is not one of the recently advertised values, the foreign\n   Agent SHOULD send\
    \ a Registration Reply with Code value\n   unknown_challenge (see Section 10).\
    \  The foreign agent MUST maintain\n   the last challenge used by each mobile\
    \ node that has registered using\n   any one of the last CHALLENGE_WINDOW challenge\
    \ values.  This last\n   challenge value can be stored as part of the mobile node's\n\
    \   registration records.  Also, see Section 3.2.1 for a possible\n   algorithm\
    \ that can be used to satisfy this requirement.\n   Furthermore, the foreign agent\
    \ MUST check that there is either a\n   Mobile-Foreign or a Mobile-AAA Authentication\
    \ extension after the\n   Challenge extension.  Any registration message containing\
    \ the\n   Challenge extension without either of these authentication extensions\n\
    \   MUST be silently discarded.  If the registration message contains a\n   Mobile-Foreign\
    \ Authentication extension with an incorrect\n   authenticator that fails verification,\
    \ the foreign agent MAY send a\n   Registration Reply to the mobile node with\
    \ Code value mobile node\n   failed authentication (see Section 10).\n   If the\
    \ Mobile-AAA Authentication extension (see Section 6) is present\n   in the message,\
    \ or if a Network Access Identifier (NAI) extension is\n   included indicating\
    \ that the mobile node belongs to a different\n   administrative domain, the foreign\
    \ agent may take actions outside the\n   scope of this protocol specification\
    \ to carry out the authentication\n   of the mobile node.  If the registration\
    \ message contains a Mobile-\n   AAA Authentication extension with an incorrect\
    \ authenticator that\n   fails verification, the foreign agent MAY send a Registration\
    \ Reply\n   to the mobile node with Code value fa_bad_aaa_auth.  If the Mobile-\n\
    \   AAA Authentication extension is present in the Registration Request,\n   the\
    \ foreign agent MUST NOT remove the Mobile-AAA Authentication\n   extension and\
    \ the Mobile-Foreign Challenge extension from the\n   Registration Request before\
    \ forwarding to the home agent.  Appendix C\n   provides an example of an action\
    \ that could be taken by a foreign\n   agent.\n   In the event that the Challenge\
    \ extension is authenticated through\n   the Mobile-Foreign Authentication extension\
    \ and the Mobile-AAA\n   Authentication extension is not present, the foreign\
    \ agent MAY remove\n   the Challenge extension from the Registration Request without\n\
    \   disturbing the authentication value used for the computation.  If the\n  \
    \ Mobile-AAA Authentication extension is present and a security\n   association\
    \ exists between the foreign agent and the home agent, the\n   Mobile-Foreign\
    \ Challenge extension and the Mobile-AAA Authentication\n   extension MUST precede\
    \ the Foreign-Home Authentication extension.\n   If the foreign agent does remove\
    \ the Challenge extension and\n   applicable authentication from the Registration\
    \ Request message, then\n   it SHOULD store the Identification field from the\
    \ Registration\n   Request message as part of its record-keeping information about\
    \ the\n   particular mobile node in order to protect against replays.\n"
- title: 3.2.1.  Foreign Agent Algorithm for Tracking Used Challenges
  contents:
  - "3.2.1.  Foreign Agent Algorithm for Tracking Used Challenges\n   If the foreign\
    \ agent maintains a large CHALLENGE_WINDOW, it becomes\n   more important for\
    \ scalability purposes to compare incoming\n   challenges efficiently against\
    \ the set of Challenge values that have\n   been advertised recently.  This can\
    \ be done by keeping the Challenge\n   values in order of advertisement, and by\
    \ making use of the mandated\n   behavior that mobile nodes MUST NOT use Challenge\
    \ values that were\n   advertised before the last advertised Challenge value that\
    \ the mobile\n   node attempted to use.  The pseudo-code in Appendix E accomplishes\n\
    \   this objective.  The maximum amount of total storage required by this\n  \
    \ algorithm is equal to Size*(CHALLENGE_WINDOW + (2*N)), where N is the\n   current\
    \ number of mobile nodes for which the foreign agent is storing\n   challenge\
    \ values.  Note that whenever the stored challenge value is\n   no longer in the\
    \ CHALLENGE_WINDOW, it can be deleted from the foreign\n   agent's records, perhaps\
    \ along with all other registration\n   information for the mobile node if it\
    \ is no longer registered.\n   It is presumed that the foreign agent keeps an\
    \ array of advertised\n   Challenges, a record of the last advertised challenge\
    \ used by a\n   mobile node, and also a record of the last challenge provided\
    \ to a\n   mobile node in a Registration Reply or unicast Agent Advertisement.\n\
    \   To meet the security obligations outlined in Section 12, the foreign\n   agent\
    \ SHOULD use one of the already stored, previously unused\n   challenges when\
    \ responding to an unauthenticated Registration Request\n   or Agent Solicitation.\
    \  If none of the already stored challenges are\n   previously unused, the foreign\
    \ agent SHOULD generate a new challenge,\n   include it in the response, and store\
    \ it in the per-Mobile data\n   structure.\n"
- title: 3.3.  Foreign Agent Processing of Registration Replies
  contents:
  - "3.3.  Foreign Agent Processing of Registration Replies\n   The foreign agent\
    \ SHOULD include a new Mobile-Foreign Challenge\n   extension in any Registration\
    \ Reply, successful or not.  If the\n   foreign agent includes this extension\
    \ in a successful Registration\n   Reply, the extension SHOULD precede a Mobile-Foreign\
    \ authentication\n   extension if present.  Suppose that the Registration Reply\
    \ includes a\n   Challenge extension from the home agent, and that the foreign\
    \ agent\n   wishes to include another Challenge extension with the Registration\n\
    \   Reply for use by the mobile node.  In that case, the foreign agent\n   MUST\
    \ delete the Challenge extension from the home agent from the\n   Registration\
    \ Reply, along with any Foreign-Home authentication\n   extension, before appending\
    \ the new Challenge extension to the\n   Registration Reply.\n   One example of\
    \ a situation where the foreign agent MAY omit the\n   inclusion of a Mobile-Foreign\
    \ Challenge extension in the Registration\n   Reply would be when a new challenge\
    \ has been multicast recently.\n   If a foreign agent has conditions in which\
    \ it omits the inclusion of\n   a Mobile-Foreign Challenge extension in the Registration\
    \ Reply, it\n   still MUST respond with an agent advertisement containing a\n\
    \   previously unused challenge in response to a subsequent agent\n   solicitation\
    \ from the same mobile node.  Otherwise (when the said\n   conditions are not\
    \ met), the foreign agent MUST include a previously\n   unused challenge in any\
    \ Registration Reply, successful or not.\n   If the foreign agent does not remove\
    \ the Challenge extension from the\n   Registration Request received from the\
    \ mobile node, then the foreign\n   agent SHOULD store the Challenge value as\
    \ part of the pending\n   registration request list [RFC3344].  Also, if the Registration\
    \ Reply\n   coming from the home agent does not include the Challenge extension,\n\
    \   the foreign agent SHOULD NOT reject the registration request.  If the\n  \
    \ Challenge extension is present in the Registration Reply, it MUST be\n   the\
    \ same Challenge value that was included in the Registration Reply\n   received\
    \ from the home agent, the foreign agent MUST insert a Foreign\n   Agent (FA)\
    \ Error extension with Status value ha_wrong_challenge in\n   the Registration\
    \ Reply sent to the mobile node (see Section 10).\n   A mobile node MUST be prepared\
    \ to use a challenge from a unicast or\n   multicast Agent Advertisement in lieu\
    \ of one returned in a\n   Registration Reply, and it MUST solicit for one if\
    \ it has not already\n   received one either in a Registration Reply or a recent\n\
    \   advertisement.\n   If the foreign agent receives a Registration Reply with\
    \ the Code\n   value ha_bad_aaa_auth, the Registration Reply with this Code value\n\
    \   MUST be relayed to the mobile node.  In this document, whenever the\n   foreign\
    \ agent is required to reject a Registration Request, it MUST\n   put the given\
    \ code in the usual Code field of the Registration Reply,\n   unless the Registration\
    \ Reply has already been received from the home\n   agent.  In this case, the\
    \ foreign agent MUST preserve the value of\n   the Code field set by the home\
    \ agent and MUST put its own rejection\n   code in the Status field of the FA\
    \ Error extension (defined in\n   [RFC4636]).\n"
- title: 3.4.  Home Agent Processing of Challenge Extensions
  contents:
  - "3.4.  Home Agent Processing of Challenge Extensions\n   If the home agent receives\
    \ a Registration Request with the Mobile-\n   Foreign Challenge extension and\
    \ recognizes the extension, the home\n   agent MUST include the Challenge extension\
    \ in the Registration Reply.\n   The Challenge extension MUST be placed after\
    \ the Mobile-Home\n   authentication extension, and the extension SHOULD be authenticated\n\
    \   by a Foreign-Home Authentication extension.\n   The home agent may receive\
    \ a Registration Request with the Mobile-AAA\n   Authentication extension.  If\
    \ the Mobile-AAA Authentication extension\n   is used by the home agent as an\
    \ authorization-enabling extension and\n   the verification fails due to an incorrect\
    \ authenticator, the home\n   agent MAY reject the Registration Reply with the\
    \ error code\n   ha_bad_aaa_auth.\n   Since the extension type for the Challenge\
    \ extension is within the\n   range 128-255, the home agent MUST process such\
    \ a Registration\n   Request even if it does not recognize the Challenge extension\n\
    \   [RFC3344].  In this case, the home agent will send a Registration\n   Reply\
    \ to the foreign agent that does not include the Challenge\n   extension.\n"
- title: 3.5.  Mobile Node Processing of Registration Replies
  contents:
  - "3.5.  Mobile Node Processing of Registration Replies\n   A mobile node might\
    \ receive the error code in the Registration Reply\n   from the foreign agent\
    \ as a response to the Registration Request.\n   The error codes are defined in\
    \ Section 10.\n   In any case, if the mobile node attempts to register again after\
    \ such\n   an error, it MUST use a new Challenge value in such a registration,\n\
    \   obtained either from an Agent Advertisement, or from a Challenge\n   extension\
    \ to the Registration Reply containing the error.\n   In the co-located care-of\
    \ address mode, the mobile node receives a\n   Registration Reply without the\
    \ Challenge extension and processes the\n   Registration Reply as specified in\
    \ [RFC3344].  In this case, when the\n   mobile node includes the MN-AAA Authentication\
    \ Extension, the\n   Challenge value 0 is recommended for the authenticator computation\n\
    \   mentioned in Section 8.\n"
- title: 4.  Mobile-Foreign Challenge Extension
  contents:
  - "4.  Mobile-Foreign Challenge Extension\n   This section specifies a new Mobile\
    \ IP Registration extension that is\n   used to satisfy a Challenge in an Agent\
    \ Advertisement.  The Challenge\n   extension to the Registration Request message\
    \ is used to indicate the\n   challenge that the mobile node is attempting to\
    \ satisfy.\n      0                   1                   2                  \
    \ 3\n      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n \
    \     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n    \
    \  |     Type      |    Length     |          Challenge ...\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \              Figure 2.  The Mobile-Foreign Challenge Extension\n   Type:\n \
    \     132 (skippable).  (See [RFC3344]).\n   Length:\n      Length of the Challenge\
    \ value.\n   Challenge:\n      The Challenge field is copied from the Challenge\
    \ field found in\n      the received Challenge extension.\n   Suppose that the\
    \ mobile node has successfully registered using one of\n   the Challenge Values\
    \ within the CHALLENGE_WINDOW values advertised by\n   the foreign agent.  In\
    \ that case, in any new Registration Request the\n   mobile node MUST NOT use\
    \ any Challenge Value that was advertised by\n   the foreign agent before the\
    \ Challenge Value in the mobile node's\n   last Registration Request.\n"
- title: 5.  Generalized Mobile IP Authentication Extension
  contents:
  - "5.  Generalized Mobile IP Authentication Extension\n   Several new authentication\
    \ extensions have been designed for various\n   control messages proposed for\
    \ extensions to Mobile IP.  A new\n   authentication extension is required for\
    \ a mobile node to present its\n   credentials to any other entity other than\
    \ the ones already defined;\n   the only entities defined in the base Mobile IP\
    \ specification\n   [RFC3344] are the home agent and the foreign agent.  The purpose\
    \ of\n   the generalized authentication extension defined here is to collect\n\
    \   together data for all such new authentication applications into a\n   single\
    \ extension type with subtypes.\n      0                   1                 \
    \  2                   3\n      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2\
    \ 3 4 5 6 7 8 9 0 1\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      |     Type      |    Subtype    |            Length             |\n   \
    \   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n      |\
    \                              SPI                              |\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      |                         Authenticator ...\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \        Figure 3.  The Generalized Mobile IP Authentication Extension\n   Type:\n\
    \      36 (not skippable).  (See [RFC3344]).\n   Subtype:\n      A number assigned\
    \ to identify the kind of endpoints or other\n      characteristics of the particular\
    \ authentication strategy.\n   Length:\n      4 plus the number of octets in the\
    \ Authenticator; MUST be at least\n      20.\n   SPI:\n      Security Parameters\
    \ Index\n   Authenticator:\n      The variable length Authenticator field\n  \
    \ In this document, only one subtype is defined:\n   1     Mobile-AAA Authentication\
    \ subtype\n          (Hashed Message Authentication Code-MD5 (HMAC-MD5))\n   \
    \       (see Section 6).\n"
- title: 6.  Mobile-AAA Authentication Subtype
  contents:
  - "6.  Mobile-AAA Authentication Subtype\n   The Generalized Authentication extension\
    \ with subtype 1 will be\n   referred to as a Mobile-AAA Authentication extension.\
    \  The mobile\n   node MAY include a Mobile-AAA Authentication extension in any\n\
    \   Registration Request.  This extension MAY co-exist in the same\n   Registration\
    \ Request with Authentication extensions defined for\n   Mobile IP Registration\
    \ ([RFC3344]).  If the mobile node does not\n   include a Mobile-Foreign Authentication\
    \ extension, then it MUST\n   include the Mobile-AAA Authentication extension\
    \ whenever the\n   Challenge extension is present.  If both are present, the Mobile-AAA\n\
    \   Authentication extension MUST precede the Mobile-Foreign\n   Authentication\
    \ extension.\n   If the Mobile-AAA Authentication extension is present, the Mobile-\n\
    \   Home Authentication extension MUST appear prior to the Mobile-AAA\n   Authentication\
    \ extension.  The corresponding response MUST include\n   the Mobile-Home Authentication\
    \ extension and MUST NOT include the\n   Mobile-AAA Authentication extension.\n\
    \   The default algorithm for computation of the authenticator is HMAC-\n   MD5\
    \ [RFC2104] computed on the following data, in the order shown:\n      Preceding\
    \ Mobile IP data || Type, Subtype, Length, SPI\n   where the Type, Length, Subtype,\
    \ and SPI are as shown in Section 5.\n   The Preceding Mobile IP data refers to\
    \ the UDP payload (the\n   Registration Request or Registration Reply data) and\
    \ all prior\n   extensions in their entirety.  The resulting function call, as\n\
    \   described in [RFC2104], would be:\n      hmac_md5(data, datalen, Key, KeyLength,\
    \ authenticator);\n   Each mobile node MUST support the ability to produce the\n\
    \   authenticator by using HMAC-MD5 as shown.  Just as with Mobile IP, it\n  \
    \ must be possible to configure the use of any arbitrary 32-bit SPI\n   outside\
    \ of the SPIs in the reserved range 0-255 for selection of this\n   default algorithm.\n"
- title: 7.  Reserved SPIs for Mobile IP
  contents:
  - "7.  Reserved SPIs for Mobile IP\n   Mobile IP defines several authentication\
    \ extensions for use in\n   Registration Requests and Replies.  Each authentication\
    \ extension\n   carries a Security Parameters Index (SPI) that should be used\
    \ to\n   index a table of security associations.  Values in the range 0-255\n\
    \   are reserved for special use.  A list of reserved SPI numbers is to\n   be\
    \ maintained by IANA at the following URL:\n      http://www.iana.org/assignments/mobileip-numbers\n"
- title: 8.  SPIs for RADIUS AAA Servers
  contents:
  - "8.  SPIs for RADIUS AAA Servers\n   Some AAA servers only admit a single security\
    \ association and thus do\n   not use the SPI numbers for Mobile IP authentication\
    \ extensions for\n   use when determining the security association that would\
    \ be necessary\n   for verifying the authentication information included with\
    \ the\n   Authentication extension.\n   SPI number CHAP_SPI (see Section 9) is\
    \ reserved for indicating the\n   following procedure for computing authentication\
    \ data (called the\n   \"authenticator\"), which is used by many RADIUS servers\
    \ [RFC2865]\n   today.\n   To compute the authenticator, apply MD5 [RFC1321] computed\
    \ on the\n   following data, in the order shown:\n      High-order octet from\
    \ Challenge || Key ||\n      MD5(Preceding Mobile IP data ||\n      Type, Subtype\
    \ (if present), Length, SPI) ||\n      Least-order 237 octets from Challenge\n\
    \   where Type, Length, SPI, and possibly Subtype are the fields of the\n   authentication\
    \ extension in use.  For instance, all four of these\n   fields would be in use\
    \ when SPI == CHAP_SPI is used with the\n   Generalized Authentication extension.\
    \  In case of co-located care-of\n   address, the Challenge value 0 is used (refer\
    \ to Section 3.5).  Since\n   the RADIUS protocol cannot carry attributes of length\
    \ greater than\n   253, the preceding Mobile IP data, type, subtype (if present),\n\
    \   length, and SPI are hashed using MD5.  Finally, the least significant\n  \
    \ 237 octets of the challenge are concatenated.  If the challenge has\n   fewer\
    \ than 238 octets, this algorithm includes the high-order octet\n   in the computation\
    \ twice but ensures that the challenge is used\n   exactly as is.  Additional\
    \ padding is never used to increase the\n   length of the challenge; the input\
    \ data is allowed to be shorter than\n   237 octets long.\n"
- title: 9.  Configurable Parameters
  contents:
  - "9.  Configurable Parameters\n   Every Mobile IP agent supporting the extensions\
    \ defined in this\n   document SHOULD be able to configure each parameter in the\
    \ following\n   table.  Each table entry contains the name of the parameter, the\n\
    \   default value, and the section of the document in which the parameter\n  \
    \ first appears.\n      +------------------+---------------+---------------------+\n\
    \      | Parameter Name   | Default Value | Section of Document |\n      +------------------+---------------+---------------------+\n\
    \      | CHALLENGE_WINDOW | 2             | 3.2                 |\n      |   \
    \               |               |                     |\n      | CHAP_SPI    \
    \     | 2             | 8                   |\n      +------------------+---------------+---------------------+\n\
    \                      Table 1.  Configurable Parameters\n   Note that CHALLENGE_WINDOW\
    \ SHOULD be at least 2.  This makes it far\n   less likely that mobile nodes will\
    \ register using a Challenge value\n   that is outside the set of values allowable\
    \ by the foreign agent.\n"
- title: 10.  Error Values
  contents:
  - "10.  Error Values\n   Each entry in the following table contains the name of\
    \ the Code\n   [RFC3344] to be returned in a Registration Reply, the value for\
    \ the\n   Code, and the section in which the error is mentioned in this\n   specification.\n\
    \      +--------------------+-------+--------------------------+\n      | Error\
    \ Name         | Value | Section of Document      |\n      +--------------------+-------+--------------------------+\n\
    \      | unknown_challenge  | 104   | 3.2                      |\n      |    \
    \                |       |                          |\n      | mobile node failed\
    \ | 67    | 3.2; also see [RFC3344]  |\n      | authentication     |       | \
    \                         |\n      |                    |       |            \
    \              |\n      | missing_challenge  | 105   | 3.1, 3.2              \
    \   |\n      |                    |       |                          |\n     \
    \ | stale_challenge    | 106   | 3.2                      |\n      |         \
    \           |       |                          |\n      | fa_bad_aaa_auth    |\
    \ 108   | 3.2                      |\n      |                    |       |   \
    \                       |\n      | ha_bad_aaa_auth    | 144   | 3.4          \
    \            |\n      |                    |       |                         \
    \ |\n      | ha_wrong_challenge | 109   | 3.2                      |\n      +--------------------+-------+--------------------------+\n\
    \                            Table 2.  Error Values\n"
- title: 11.  IANA Considerations
  contents:
  - "11.  IANA Considerations\n   The following are currently assigned by IANA for\
    \ RFC 3012 [RFC3012]\n   and are applicable to this document.  IANA has recorded\
    \ these values\n   as part of this document.\n      The Generalized Mobile IP\
    \ Authentication extension defined in\n      Section 5 is a Mobile IP registration\
    \ extension.  IANA has\n      assigned a value of 36 for this extension.\n   \
    \   A new number space is to be created for enumerating subtypes of\n      the\
    \ Generalized Authentication extension (see Section 5).  New\n      subtypes of\
    \ the Generalized Authentication extension, other than\n      the number (1) for\
    \ the MN-AAA authentication extension specified\n      in Section 6, must be specified\
    \ and approved by a designated\n      expert.\n      The Mobile Node - Foreign\
    \ Agent (MN-FA) Challenge extension,\n      defined in Section 4, is a router\
    \ advertisement extension as\n      defined in RFC 1256 [RFC1256] and extended\
    \ in RFC 3344 [RFC3344].\n      IANA has assigned a value of 132 for this purpose.\n\
    \      The Code values defined in Section 10 are error codes as defined\n    \
    \  in RFC 3344 ([RFC3344]).  They correspond to error values\n      conventionally\
    \ associated with rejection by the foreign agent\n      (i.e., values from the\
    \ range 64-127).  The Code value 67 is a\n      pre-existing value that is to\
    \ be used in some cases with the\n      extension defined in this specification.\
    \  IANA has recorded the\n      values as defined in Section 10.\n      A new\
    \ section for enumerating algorithms identified by specific\n      SPIs within\
    \ the range 0-255 has been added by IANA.  The CHAP_SPI\n      number (2) discussed\
    \ in Section 8 is assigned from this range of\n      reserved SPI numbers.  New\
    \ assignments from this reserved range\n      must be specified and approved by\
    \ the Mobile IP working group.\n      SPI number 1 should not be assigned unless\
    \ in the future the\n      Mobile IP working group decides that SKIP is not important\
    \ for\n      enumeration in the list of reserved numbers.  SPI number 0 should\n\
    \      not be assigned.\n   Additionally, the new error codes fa_bad_aaa_auth,\
    \ ha_bad_aaa_auth,\n   and ha_wrong_challenge are defined by this document.  Among\
    \ these,\n   ha_wrong_challenge may appear in the Status code of the FA Error\n\
    \   extension, defined in [RFC4636].\n"
- title: 12.  Security Considerations
  contents:
  - "12.  Security Considerations\n   In the event that a malicious mobile node attempts\
    \ to replay the\n   authenticator for an old Mobile-Foreign Challenge, the foreign\
    \ agent\n   would detect it, since the agent always checks whether it has\n  \
    \ recently advertised the Challenge (see Section 3.2).  Allowing mobile\n   nodes\
    \ with different IP addresses or NAIs to use the same Challenge\n   value does\
    \ not represent a security vulnerability, as the\n   authentication data provided\
    \ by the mobile node will be computed over\n   data that is different (at least\
    \ the mobile node's IP address will\n   vary).\n   If the foreign agent chooses\
    \ a Challenge value (see Section 2) with\n   fewer than 4 octets, the foreign\
    \ agent SHOULD include the value of\n   the Identification field in the records\
    \ it maintains for the mobile\n   node.  The foreign agent can then determine\
    \ whether the Registration\n   messages using the short Challenge value are in\
    \ fact unique and thus\n   assuredly not replayed from any earlier registration.\n\
    \   Section 8 (SPI For RADIUS AAA Servers) defines a method of computing\n   the\
    \ Generalized Mobile IP Authentication extension's authenticator\n   field, using\
    \ MD5 in a manner that is consistent with RADIUS\n   [RFC2865].  The use of MD5\
    \ in the method described in Section 8 is\n   less secure than HMAC-MD5 [RFC2104]\
    \ and MUST be avoided whenever\n   possible.\n   Note that an active attacker\
    \ may try to prevent successful\n   registrations by sending a large number of\
    \ Agent Solicitations or\n   bogus Registration Requests, each of which could\
    \ cause the foreign\n   agent to respond with a fresh challenge, invalidating\
    \ the challenge\n   that the MN is currently trying to use.  To prevent such attacks,\
    \ the\n   foreign agent MUST NOT invalidate previously unused challenges when\n\
    \   responding to unauthenticated Registration Requests or Agent\n   Solicitations.\
    \  In addition, the foreign agent MUST NOT allocate new\n   storage when responding\
    \ to such messages, as this would also create\n   the possibility of denial of\
    \ service.\n   The Challenge extension specified in this document need not be\
    \ used\n   for co-located care-of address mode.  In this case, replay protection\n\
    \   is provided by the Identification field in the Registration Request\n   message\
    \ [RFC3344].\n   The Generalized Mobile IP Authentication extension includes a\
    \ subtype\n   field that is used to identify characteristics of the particular\n\
    \   authentication strategy.  This document only defines one subtype, the\n  \
    \ Mobile-AAA Authentication subtype that uses HMAC-MD5.  If it is\n   necessary\
    \ to move to a new message authentication algorithm in the\n   future, this could\
    \ be accomplished by defining a new subtype that\n   uses a different one.\n"
- title: 13.  Acknowledgements
  contents:
  - "13.  Acknowledgements\n   The authors would like to thank Pete McCann, Ahmad\
    \ Muhanna, Henrik\n   Levkowetz, Kent Leung, Alpesh Patel, Madjid Nakhjiri, Gabriel\n\
    \   Montenegro, Jari Arkko, and other MIP4 WG participants for their\n   useful\
    \ discussions.\n"
- title: 14.  Normative References
  contents:
  - "14.  Normative References\n   [RFC1256]  Deering, S., \"ICMP Router Discovery\
    \ Messages\", RFC 1256,\n              September 1991.\n   [RFC1321]  Rivest,\
    \ R., \"The MD5 Message-Digest Algorithm\", RFC 1321,\n              April 1992.\n\
    \   [RFC1994]  Simpson, W., \"PPP Challenge Handshake Authentication\n       \
    \       Protocol (CHAP)\", RFC 1994, August 1996.\n   [RFC2104]  Krawczyk, H.,\
    \ Bellare, M., and R. Canetti, \"HMAC:  Keyed-\n              Hashing for Message\
    \ Authentication\", RFC 2104, February\n              1997.\n   [RFC2119]  Bradner,\
    \ S., \"Key words for use in RFCs to Indicate\n              Requirement Levels\"\
    , BCP 14, RFC 2119, March 1997.\n   [RFC2865]  Rigney, C., Willens, S., Rubens,\
    \ A., and W. Simpson,\n              \"Remote Authentication Dial In User Service\
    \ (RADIUS)\", RFC\n              2865, June 2000.\n   [RFC2794]  Calhoun, P. and\
    \ C. Perkins, \"Mobile IP Network Access\n              Identifier Extension for\
    \ IPv4\", RFC 2794, March 2000.\n   [RFC3012]  Perkins, C. and P. Calhoun, \"\
    Mobile IPv4\n              Challenge/Response Extensions\", RFC 3012, November\
    \ 2000.\n   [RFC3344]  Perkins, C., \"IP Mobility Support for IPv4\", RFC 3344,\n\
    \              August 2002.\n   [RFC4086]  Eastlake, D., 3rd, Schiller, J., and\
    \ S. Crocker,\n              \"Randomness Requirements for Security\", BCP 106,\
    \ RFC 4086,\n              June 2005.\n   [RFC4636]  Perkins, C., \"Foreign Agent\
    \ Error Extension for Mobile\n              IPv4\", RFC 4636, October 2006.\n"
- title: Appendix A.  Changes since RFC 3012
  contents:
  - "Appendix A.  Changes since RFC 3012\n   The following is the list of changes\
    \ from RFC 3012 ([RFC3012]):\n   o  Foreign agent recommended to include a Challenge\
    \ in every\n      Registration Reply, so that mobile node can re-register without\n\
    \      waiting for an Advertisement.\n   o  Foreign agent MUST record applicable\
    \ challenge values used by each\n      mobile node.\n   o  Mobile node forbidden\
    \ to use Challenge values which were\n      advertised previous to the last Challenge\
    \ value which it had used\n      for a registration.\n   o  Challenge definitions\
    \ are cleaned up.\n   o  Programming suggestion added as an appendix.\n   o  HMAC_CHAP_SPI\
    \ option is added for Generalized Mobile IP\n      Authentication extension. \
    \ Upon receipt of HMAC_CHAP_SPI, HMAC-MD5\n      is used instead of MD5 for computing\
    \ the authenticator.\n   o  Added fa_bad_aaa_auth and ha_bad_aaa_auth error codes\
    \ to report\n      authentication errors caused while processing Mobile-AAA\n\
    \      Authentication extension.  Also, added the error code\n      ha_wrong_challenge\
    \ to indicate that Challenge value differs in the\n      Registration Reply received\
    \ from the home agent compare to the one\n      sent to the home agent in the\
    \ Registration Request.\n   o  Processing of the Mobile-AAA Authentication extension\
    \ is clarified\n      for the foreign agent and the home agent.\n   o  Co-existence\
    \ of the Mobile-AAA Authentication extension in the\n      same Registration Request\
    \ is made explicit.\n   o  The situation in which the foreign agent sets missing_challenge\
    \ is\n      clarified further.\n   o  The use of Mobile-AAA Authentication extension\
    \ is allowed by the\n      mobile node with co-located care-of address.\n   o\
    \  Added protection against bogus Registration Reply and Agent\n      Advertisement.\
    \  Also, the processing of the Challenge is clarified\n      if it is received\
    \ in the multicast/unicast Agent Advertisement.\n   o  Added reference of FA Error\
    \ extension in the References section\n      and also updated relevant text in\
    \ section 3.2 and section 11.\n"
- title: Appendix B.  Verification Infrastructure
  contents:
  - "Appendix B.  Verification Infrastructure\n   The Challenge extensions in this\
    \ protocol specification are expected\n   to be useful to help the foreign agent\
    \ manage connectivity for\n   visiting mobile nodes, even in situations where\
    \ the foreign agent\n   does not have any security association with the mobile\
    \ node or the\n   mobile node's home agent.  In order to carry out the necessary\n\
    \   authentication, it is expected that the foreign agent will need the\n   assistance\
    \ of external administrative systems, which have come to be\n   called AAA systems.\
    \  For the purposes of this document, we call the\n   external administrative\
    \ support the \"verification infrastructure\".\n   The verification infrastructure\
    \ is described to motivate the design\n   of the protocol elements defined in\
    \ this document and is not strictly\n   needed for the protocol to work.  The\
    \ foreign agent is free to use\n   any means at its disposal to verify the credentials\
    \ of the mobile\n   node.  It could, for instance, rely on a separate protocol\
    \ between\n   the foreign agent and the Mobile IP home agent and still not require\n\
    \   any modification to the mobile node.\n   In order to verify the credentials\
    \ of the mobile node, we assume that\n   the foreign agent has access to a verification\
    \ infrastructure that\n   can return a secure notification to the foreign agent\
    \ that the\n   authentication has been performed, along with the results of that\n\
    \   authentication.  This infrastructure may be visualized as shown in\n   Figure\
    \ 4.\n      +----------------------------------------------------+\n      |  \
    \                                                  |\n      |  Verification and\
    \ Key Management Infrastructure    |\n      |                                \
    \                    |\n      +----------------------------------------------------+\n\
    \               ^ |                                  ^ |\n               | | \
    \                                 | |\n               | v                    \
    \              | v\n        +---------------+                    +---------------+\n\
    \        |               |                    |               |\n        | foreign\
    \ agent |                    |   home agent  |\n        |               |    \
    \                |               |\n        +---------------+                \
    \    +---------------+\n                  Figure 4.  The Verification Infrastructure\n\
    \   After the foreign agent gets the Challenge authentication, it MAY\n   pass\
    \ the authentication to the (here unspecified) infrastructure and\n   await a\
    \ Registration Reply.  If the Reply has a positive status\n   (indicating that\
    \ the registration was accepted), the foreign agent\n   accepts the registration.\
    \  If the Reply contains the Code value\n   BAD_AUTHENTICATION (see Section 10),\
    \ the foreign agent takes actions\n   indicated for rejected registrations.\n\
    \   Implicit in this picture is the important observation that the\n   foreign\
    \ agent and the home agent have to be equipped to make use of\n   whatever protocol\
    \ is required by the challenge verification and key\n   management infrastructure\
    \ shown in the figure.\n   The protocol messages for handling the authentication\
    \ within the\n   verification infrastructure and the identity of the agent performing\n\
    \   the verification of the foreign agent challenge are not specified in\n   this\
    \ document, as those operations do not have to be performed by any\n   Mobile\
    \ IP entity.\n"
- title: Appendix C.  Message Flow for FA Challenge Messaging with Mobile-AAA
  contents:
  - "Appendix C.  Message Flow for FA Challenge Messaging with Mobile-AAA\n      \
    \       Extension\n   MN                  FA                   Verification  \
    \   home agent\n    |<-- Adv+Challenge--|                  Infrastructure    \
    \      |\n    |    (if needed)    |                         |                |\n\
    \    |                   |                         |                |\n    |--\
    \ RReq+Challenge->|                         |                |\n    |    + Auth.Ext.\
    \    |                         |                |\n    |                   | \
    \  Auth. Request, incl.  |                |\n    |                   |--- RReq\
    \ + Challenge --->|                |\n    |                   |      + Auth.Ext\
    \         |   RReq +       |\n    |                   |                      \
    \   |-- Challenge -->|\n    |                   |                         |  \
    \              |\n    |                   |                         |        \
    \        |\n    |                   |                         |<--- RRep -----\
    \ |\n    |                   |   Authorization, incl.  |                |\n  \
    \  |                   |<-- RRep + Auth.Ext.-----|                |\n    |   \
    \                |                         |                |\n    |<-- RRep+Auth.Ext--|\
    \                         |                |\n    |  + New Challenge  |      \
    \                   |                |\n            Figure 5.  Message Flows for\
    \ FA Challenge Messaging\n   In Figure 5, the following informational message\
    \ flow is illustrated:\n   1.  The foreign agent includes a Challenge Value in\
    \ a unicast Agent\n       Advertisement, if needed.  This advertisement MAY have\
    \ been\n       produced after receiving an Agent Solicitation from the mobile\n\
    \       node (not shown in the diagram).\n   2.  The mobile node creates a Registration\
    \ Request including the\n       advertised Challenge Value in the Challenge extension,\
    \ along with\n       a Mobile-AAA authentication extension.\n   3.  The foreign\
    \ agent relays the Registration Request either to the\n       home agent specified\
    \ by the mobile node or to its locally\n       configured Verification Infrastructure\
    \ (see Appendix B),\n       according to local policy.\n   4.  The foreign agent\
    \ receives a Registration Reply with the\n       appropriate indications for authorizing\
    \ connectivity for the\n       mobile node.\n   5.  The foreign agent relays the\
    \ Registration Reply to the mobile\n       node, often along with a new Challenge\
    \ Value to be used by the\n       mobile node in its next Registration Request\
    \ message.\n"
- title: Appendix D.  Message Flow for FA Challenge Messaging with MN-FA
  contents:
  - "Appendix D.  Message Flow for FA Challenge Messaging with MN-FA\n           \
    \  Authentication\n         MN                  FA                     home agent\n\
    \          |<-- Adv+Challenge--|                         |\n          |    (if\
    \ needed)    |                         |\n          |                   |    \
    \                     |\n          |-- RReq+Challenge->|                     \
    \    |\n          |    + Auth.Ext.    |                         |\n          |\
    \                   |--- RReq + Challenge --->|\n          |                 \
    \  |   + HA-FA Auth.Ext      |\n          |                   |              \
    \           |\n          |                   |<-- RRep + Challenge ----|\n   \
    \       |                   |   + HA-FA Auth.Ext      |\n          |         \
    \          |                         |\n          |<-- RRep+Auth.Ext--|      \
    \                   |\n          |  + New Challenge  |                       \
    \  |\n      Figure 6.  Message Flows for FA Challenge Messaging with MN-FA\n \
    \                             Authentication\n   In Figure 6, the following informational\
    \ message flow is illustrated:\n   1.  The foreign agent disseminates a Challenge\
    \ Value in an Agent\n       Advertisement, if needed.  This advertisement MAY\
    \ have been\n       produced after receiving an Agent Solicitation from the mobile\n\
    \       node (not shown in the diagram).\n   2.  The mobile node creates a Registration\
    \ Request including the\n       advertised Challenge Value in the Challenge extension,\
    \ along with\n       a Mobile-Foreign Authentication extension.\n   3.  The foreign\
    \ agent relays the Registration Request to the home\n       agent specified by\
    \ the mobile node.\n   4.  The foreign agent receives a Registration Reply with\
    \ the\n       appropriate indications for authorizing connectivity for the\n \
    \      mobile node.\n   5.  The foreign agent relays the Registration Reply to\
    \ the mobile\n       node, possibly along with a new Challenge Value to be used\
    \ by the\n       mobile node in its next Registration Request message.  If the\n\
    \       Reply contains the Code value ha_bad_aaa_auth (see Section 10),\n    \
    \   the foreign agent takes actions indicated for rejected\n       registrations.\n"
- title: Appendix E.  Example Pseudo-Code for Tracking Used Challenges
  contents:
  - "Appendix E.  Example Pseudo-Code for Tracking Used Challenges\n   current_chal\
    \ := RegistrationRequest.challenge_extension_value\n   last_chal := mobile_node_record.last_used_adv_chal\n\
    \   if (current_chal == mobile_node_record.RegReply_challenge) {\n       update\
    \ (mobile_node_record, current_chal)\n       return (OK)\n   }\n   else if (current_chal\
    \ \"among\" VALID_ADV_CHALLENGES[]{\n      if (last_chal \"among\" VALID_ADV_CHALLENGES[])\
    \ {\n         if (current_chal is \"before\" last_chal) {\n             send_error(STALE_CHALLENGE)\n\
    \             return (FAILURE)\n         }\n         else {\n             update\
    \ (mobile_node_record, current_chal)\n             return (OK)\n         }\n \
    \     }\n      else {\n         update (mobile_node_record, current_chal)\n  \
    \       return (OK)\n      }\n   }\n   else {\n      send_error(UNKNOWN_CHALLENGE);\n\
    \   }\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Charles E. Perkins\n   Nokia Research Center\n   Communications\
    \ Systems Lab\n   313 Fairchild Drive\n   Mountain View, California  94043\n \
    \  Phone: +1 650 625-2986\n   EMail: charles.perkins@nokia.com\n   Pat R. Calhoun\n\
    \   Cisco Systems, Inc.\n   170 West Tasman Drive\n   San Jose, CA  95134\n  \
    \ Phone: +1 408-853-5269\n   EMail: pcalhoun@cisco.com\n   Jayshree Bharatia\n\
    \   Nortel Networks\n   2221, Lakeside Blvd\n   Richardson, TX  75082\n   Phone:\
    \ +1 972-684-5767\n   EMail: jayshree@nortel.com\n"
- title: Full Copyright Statement
  contents:
  - "Full Copyright Statement\n   Copyright (C) The IETF Trust (2007).\n   This document\
    \ is subject to the rights, licenses and restrictions\n   contained in BCP 78,\
    \ and except as set forth therein, the authors\n   retain all their rights.\n\
    \   This document and the information contained herein are provided on an\n  \
    \ \"AS IS\" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS\n  \
    \ OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST,\n   AND THE\
    \ INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,\n   EXPRESS OR IMPLIED,\
    \ INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT\n   THE USE OF THE INFORMATION\
    \ HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY\n   IMPLIED WARRANTIES OF MERCHANTABILITY\
    \ OR FITNESS FOR A PARTICULAR\n   PURPOSE.\n"
- title: Intellectual Property
  contents:
  - "Intellectual Property\n   The IETF takes no position regarding the validity or\
    \ scope of any\n   Intellectual Property Rights or other rights that might be\
    \ claimed to\n   pertain to the implementation or use of the technology described\
    \ in\n   this document or the extent to which any license under such rights\n\
    \   might or might not be available; nor does it represent that it has\n   made\
    \ any independent effort to identify any such rights.  Information\n   on the\
    \ procedures with respect to rights in RFC documents can be\n   found in BCP 78\
    \ and BCP 79.\n   Copies of IPR disclosures made to the IETF Secretariat and any\n\
    \   assurances of licenses to be made available, or the result of an\n   attempt\
    \ made to obtain a general license or permission for the use of\n   such proprietary\
    \ rights by implementers or users of this\n   specification can be obtained from\
    \ the IETF on-line IPR repository at\n   http://www.ietf.org/ipr.\n   The IETF\
    \ invites any interested party to bring to its attention any\n   copyrights, patents\
    \ or patent applications, or other proprietary\n   rights that may cover technology\
    \ that may be required to implement\n   this standard.  Please address the information\
    \ to the IETF at\n   ietf-ipr@ietf.org.\n"
- title: Acknowledgement
  contents:
  - "Acknowledgement\n   Funding for the RFC Editor function is currently provided\
    \ by the\n   Internet Society.\n"
