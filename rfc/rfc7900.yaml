- title: __initial_text__
  contents:
  - '                 Extranet Multicast in BGP/IP MPLS VPNs

    '
- title: Abstract
  contents:
  - "Abstract\n   Previous RFCs specify the procedures necessary to allow IP multicast\n\
    \   traffic to travel from one site to another within a BGP/MPLS IP VPN\n   (Virtual\
    \ Private Network).  However, it is sometimes desirable to\n   allow multicast\
    \ traffic whose source is in one VPN to be received by\n   systems that are in\
    \ another VPN.  This is known as a \"Multicast VPN\n   (MVPN) extranet\".  This\
    \ document updates RFCs 6513, 6514, and 6625 by\n   specifying the procedures\
    \ that are necessary in order to provide\n   extranet MVPN service.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This\
    \ document is a product of the Internet Engineering Task Force\n   (IETF).  It\
    \ represents the consensus of the IETF community.  It has\n   received public\
    \ review and has been approved for publication by the\n   Internet Engineering\
    \ Steering Group (IESG).  Further information on\n   Internet Standards is available\
    \ in Section 2 of RFC 7841.\n   Information about the current status of this document,\
    \ any errata,\n   and how to provide feedback on it may be obtained at\n   http://www.rfc-editor.org/info/rfc7900.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2016 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (http://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.  Code Components\
    \ extracted from this document must\n   include Simplified BSD License text as\
    \ described in Section 4.e of\n   the Trust Legal Provisions and are provided\
    \ without warranty as\n   described in the Simplified BSD License.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1. Introduction ....................................................4\n\
    \      1.1. Terminology ................................................4\n  \
    \    1.2. Scope ......................................................7\n    \
    \       1.2.1. Customer Multicast Control Protocols ................7\n      \
    \     1.2.2. Provider Multicast Control Protocols ................7\n      1.3.\
    \ Clarification on Use of Route Distinguishers ...............8\n      1.4. Overview\
    \ ...................................................9\n   2. Extranets and Overlapping\
    \ Address Spaces .......................12\n      2.1. Ambiguity: P-Tunnel with\
    \ Extranet/Non-extranet Flows ......14\n      2.2. Ambiguity: P-Tunnel with Multiple\
    \ Extranet Flows ..........16\n      2.3. Preventing Misdelivery in These Scenarios\
    \ .................18\n           2.3.1. Do Not Deliver Packets from the Wrong\
    \ P-tunnel .....18\n           2.3.2. Policies to Prevent Ambiguity on a P-Tunnel\
    \ ........20\n   3. Extranet Transmission Models ...................................21\n\
    \      3.1. Transmitting an Extranet C-Flow on a Single PMSI ..........21\n  \
    \         3.1.1. Without Extranet Separation ........................22\n    \
    \       3.1.2. With Extranet Separation ...........................22\n      3.2.\
    \ Transmitting an Extranet C-Flow over Multiple PMSIs .......23\n   4. Distribution\
    \ of Routes That Match C-S/C-RP Addresses ...........23\n      4.1. UMH-Eligible\
    \ Routes .......................................23\n           4.1.1. Extranet\
    \ Separation ................................24\n      4.2. Distribution of Unicast\
    \ Routes Matching C-RPs and DRs .....25\n      4.3. Route Targets and Ambiguous\
    \ UMH-Eligible Routes ...........26\n      4.4. Dynamically Marking Extranet Routes\
    \ .......................27\n           4.4.1. The Extranet Source Extended Community\
    \ .............27\n           4.4.2. Distribution of Extranet Source Extended\n\
    \                  Community ..........................................29\n  \
    \    4.5. The Extranet Separation Extended Community ................30\n   5.\
    \ Origination and Distribution of BGP A-D Routes .................30\n      5.1.\
    \ Route Targets of UMH-Eligible Routes and A-D Routes .......30\n      5.2. Considerations\
    \ for Particular Inclusive Tunnel Types ......33\n           5.2.1. RSVP-TE P2MP\
    \ or Ingress Replication ................33\n           5.2.2. Ingress Replication\
    \ ................................34\n   6. When PIM Is the PE-PE C-Multicast\
    \ Control Plane ................35\n      6.1. Provisioning VRFs with RTs ................................36\n\
    \           6.1.1. Incoming and Outgoing Extranet RTs .................36\n  \
    \         6.1.2. UMH-Eligible Routes and RTs ........................37\n    \
    \       6.1.3. PIM C-Instance Reverse Path Forwarding\n                  Determination\
    \ ......................................37\n      6.2. \"Single PMSI per C-Flow\"\
    \ Model ............................38\n           6.2.1. Forming the MI-PMSIs\
    \ ...............................38\n           6.2.2. S-PMSIs ............................................41\n\
    \           6.2.3. Sending PIM Control Packets ........................42\n  \
    \         6.2.4. Receiving PIM Control Packets ......................43\n    \
    \       6.2.5. Sending and Receiving Data Packets .................43\n      6.3.\
    \ \"Multiple PMSIs per C-Flow\" Model .........................43\n          \
    \ 6.3.1. Forming the MI-PMSIs ...............................44\n   7. When BGP\
    \ Is the PE-PE C-Multicast Control Plane ................46\n      7.1. Originating\
    \ C-Multicast Routes ............................46\n      7.2. Originating A-D\
    \ Routes without Extranet Separation ........47\n           7.2.1. Intra-AS I-PMSI\
    \ A-D Routes .........................47\n           7.2.2. S-PMSI A-D Routes\
    \ ..................................47\n           7.2.3. Source Active A-D Routes\
    \ ...........................48\n                  7.2.3.1. When Inter-Site Shared\
    \ Trees Are Used .....48\n                  7.2.3.2. When Inter-Site Shared Trees\
    \ Are\n                           Not Used ..................................49\n\
    \      7.3. Originating A-D Routes with Extranet Separation ...........49\n  \
    \         7.3.1. Intra-AS I-PMSI A-D Routes .........................49\n    \
    \       7.3.2. S-PMSI A-D Routes ..................................50\n      \
    \     7.3.3. Source Active A-D Routes ...........................52\n      7.4.\
    \ Determining the Expected P-Tunnel for a C-Flow ............52\n           7.4.1.\
    \ (C-S,C-G) S-PMSI A-D Routes ........................54\n           7.4.2. (C-S,C-*)\
    \ S-PMSI A-D Routes ........................54\n           7.4.3. (C-*,C-G) S-PMSI\
    \ A-D Routes ........................55\n           7.4.4. (C-*,C-*) S-PMSI A-D\
    \ Routes ........................56\n           7.4.5. I-PMSI A-D Routes ..................................56\n\
    \      7.5. Packets Arriving from the Wrong P-Tunnel ..................57\n  \
    \ 8. Multiple Extranet VRFs on the Same PE ..........................57\n   9.\
    \ IANA Considerations ............................................58\n   10. Security\
    \ Considerations .......................................59\n   11. References\
    \ ....................................................61\n      11.1. Normative\
    \ References .....................................61\n      11.2. Informative\
    \ References ...................................62\n   Acknowledgments ...................................................64\n\
    \   Contributors ......................................................64\n  \
    \ Authors' Addresses ................................................65\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   Previous RFCs [RFC6513] [RFC6514] specify the procedures\
    \ necessary to\n   allow IP multicast traffic to travel from one site to another\
    \ within\n   a BGP/MPLS IP VPN (Virtual Private Network).  However, it is\n  \
    \ sometimes desirable to allow multicast traffic whose source is in one\n   VPN\
    \ to be received by systems that are in another VPN.  This is known\n   as an\
    \ \"extranet Multicast VPN (MVPN)\".  This document specifies the\n   procedures\
    \ that are necessary in order to provide extranet MVPN\n   functionality.\n  \
    \ This document updates RFCs 6513, 6514, and 6625 by specifying the\n   procedures\
    \ that are necessary in order to provide extranet MVPN\n   service.\n"
- title: 1.1.  Terminology
  contents:
  - "1.1.  Terminology\n   This document uses terminology from [RFC6513] and in particular\
    \ uses\n   the prefixes \"C-\" and \"P-\" as specified in Section 3.1 of [RFC6513],\n\
    \   and \"A-D routes\" for \"auto-discovery routes\".\n   The term \"Upstream\
    \ Multicast Hop\" (UMH) is used as defined in\n   [RFC6513].\n   The term \"UMH-eligible\
    \ route\" is used to mean \"route eligible for UMH\n   determination\", as defined\
    \ in Section 5.1.1 of [RFC6513].  We will\n   say that a given UMH-eligible route\
    \ or unicast route \"matches\" a\n   given IP address, in the context of a given\
    \ Virtual Routing and\n   Forwarding table (VRF), if the address prefix of the\
    \ given route is\n   the longest match in that VRF for the given IP address. \
    \ We will\n   sometimes say that a route \"matches\" a particular host if the\
    \ route\n   matches an IP address of the host.\n   We follow the terminology of\
    \ Section 3.2 of [RFC6625] when talking of\n   a \"Selective Provider Multicast\
    \ Service Interface\" (S-PMSI) A-D route\n   being \"installed\".  That is, we\
    \ say that an S-PMSI A-D route is\n   \"installed\" (in a given VRF) if it has\
    \ been selected by the BGP\n   decision process as the preferred route for its\
    \ Network Layer\n   Reachability Information (NLRI).  We also follow the terminology\
    \ of\n   Section 3.2 of [RFC6625] when saying that an S-PMSI A-D route has\n \
    \  been \"originated by a given PE\"; this means that the given Provider\n   Edge's\
    \ (PE's) IP address is contained in the Originating Router's IP\n   Address field\
    \ in the NLRI of the route.\n   We use the following additional terminology and\
    \ notation:\n   o  Extranet C-source: a multicast source, in a given VPN, that\
    \ is\n      allowed by policy to send multicast traffic to receivers that are\n\
    \      in other VPNs.\n   o  Extranet C-receiver: a multicast receiver, in a given\
    \ VPN, that is\n      allowed by policy to receive multicast traffic from extranet\n\
    \      C-sources that are in other VPNs.\n   o  Extranet C-flow: a multicast flow\
    \ (with a specified C-source\n      address and C-group address) with the following\
    \ properties: its\n      source is an extranet C-source, and it is allowed by\
    \ policy to\n      have extranet C-receivers.\n   o  Extranet C-group: a multicast\
    \ group address that is in the\n      \"Any-Source Multicast\" (ASM) group address\
    \ range and that is\n      allowed by policy to have extranet C-sources and extranet\n\
    \      C-receivers that are not all in the same VPN.  Note that we will\n    \
    \  sometimes refer to \"Source-Specific Multicast (SSM) C-group\n      addresses\"\
    \ (i.e., C-group addresses in the SSM group address\n      range) but will never\
    \ call them \"extranet C-groups\".\n      N.B.: Any source of traffic for an extranet\
    \ C-group is considered\n      to be an extranet C-source, and any receiver of\
    \ traffic addressed\n      to an extranet C-group is considered to be an extranet\
    \ C-receiver.\n   o  Extranet C-RP: a multicast Rendezvous Point (RP) for an extranet\n\
    \      C-group; it is allowed by policy to receive PIM Register messages\n   \
    \   [RFC7761] from outside its VPN and to send multicast data packets\n      to\
    \ extranet C-receivers outside its VPN.\n   o  Host(C-S,A): the host (or, if C-S\
    \ is an \"anycast address\", the set\n      of hosts) denoted by the address C-S\
    \ in the context of VPN-A.  For\n      example, if a particular C-source in VPN-A\
    \ has address C-S, then\n      Host(C-S,A) refers to that C-source.\n   o  \"\
    SAFI n\" route: a BGP route whose Address Family Identifier (AFI)\n      is either\
    \ 1 (IPv4) or 2 (IPv6) and whose Subsequent Address Family\n      Identifier (SAFI)\
    \ is \"n\".\n   o  PTA: PMSI Tunnel Attribute [RFC6514].\n   Note that a given\
    \ extranet C-source is not necessarily allowed to\n   transmit to every extranet\
    \ C-receiver; policy determines which\n   extranet C-sources are allowed to transmit\
    \ to which extranet\n   C-receivers.  However, in the case of an extranet (ASM)\
    \ C-group, all\n   transmitters to the group are allowed to transmit to all the\n\
    \   receivers of the group, and all the receivers of the group are\n   allowed\
    \ to receive from all transmitters to the group.\n   We say that a given VRF \"\
    contains\" or \"has\" a multicast C-source (or\n   that the C-source is \"in\"\
    \ the VRF) if that C-source is in a site\n   connected to that VRF and the VRF\
    \ originates a UMH-eligible route\n   (see Section 4) that matches the address\
    \ of the C-source.\n   We say that a given VRF \"contains\" or \"has\" a multicast\
    \ C-receiver\n   (or that the C-receiver is \"in\" the VRF) if that C-receiver\
    \ is in a\n   site connected to that VRF.\n   We say that a given VRF \"contains\"\
    \ or \"has\" the C-RP for a given ASM\n   group (or that the C-RP is \"in\" the\
    \ VRF) if that C-RP is in a site\n   connected to that VRF and the VRF originates\
    \ a unicast route and a\n   (possibly different, possibly the same) UMH-eligible\
    \ route (see\n   Section 4) whose respective address prefixes match the C-RP address.\n\
    \   [RFC6513] allows a set of \"P-tunnels\" (defined in Section 3.2 of\n   [RFC6513])\
    \ to be aggregated together and transported via an outer\n   P-tunnel; i.e., it\
    \ allows for the use of hierarchical Label Switched\n   Paths (LSPs) as P-tunnels.\
    \  A two-level hierarchical LSP, for\n   example, can be thought of as a set of\
    \ \"inner tunnels\" aggregated\n   into an outer tunnel.  In this document, when\
    \ we speak of a P-tunnel,\n   we are always speaking of the innermost P-tunnel,\
    \ i.e., of a P-tunnel\n   at the lowest hierarchical level.  P-tunnels are identified\
    \ in the\n   PMSI Tunnel attributes (\"PTAs\" in this document) [RFC6514] of BGP\n\
    \   auto-discovery (A-D) routes.  Two PTAs that have the same Tunnel Type\n  \
    \ and Tunnel Identifier fields but different MPLS label fields are thus\n   considered\
    \ to identify two different P-tunnels.  (That is, for the\n   purposes of this\
    \ document, the MPLS label included in the PTA, if\n   any, is considered to be\
    \ part of the tunnel identifier.)\n   We say that the NLRI of a BGP S-PMSI A-D\
    \ route or Source Active A-D\n   route contains (C-S,C-G) if its Multicast Source\
    \ field contains C-S\n   and its Multicast Group field contains C-G.  If either\
    \ or both of\n   these fields are encoded as a wildcard, we will say that the\
    \ NLRI\n   contains (C-*,C-*) (both fields encoded as wildcards), (C-*,C-G)\n\
    \   (Multicast Source field encoded as a wildcard), or (C-S,C-*)\n   (Multicast\
    \ Group field encoded as a wildcard).\n   We use the term \"VPN security violation\"\
    \ to refer to any situation in\n   which a packet is delivered to a particular\
    \ VPN, even though, by\n   policy, it should not be delivered to that VPN.\n \
    \  The key words \"MUST\", \"MUST NOT\", \"REQUIRED\", \"SHALL\", \"SHALL NOT\"\
    ,\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"NOT RECOMMENDED\", \"MAY\"\
    , and\n   \"OPTIONAL\" in this document are to be interpreted as described in\n\
    \   [RFC2119].\n"
- title: 1.2.  Scope
  contents:
  - '1.2.  Scope

    '
- title: 1.2.1.  Customer Multicast Control Protocols
  contents:
  - "1.2.1.  Customer Multicast Control Protocols\n   This document presumes that\
    \ the VPN customer is using PIM - Sparse\n   Mode (PIM-SM) [RFC7761] as the multicast\
    \ control protocol at the\n   customer sites.  PIM-SM may be used in either the\
    \ ASM service model\n   or the SSM service model; this document covers both cases.\
    \  Support\n   for other customer IP multicast control protocols (e.g., [RFC5015],\n\
    \   PIM - Dense Mode) is outside the scope of this document.  Support for\n  \
    \ the use of MPLS multicast control protocols (e.g., [RFC6388]\n   [RFC4875])\
    \ by customer sites is also outside the scope of this\n   document.\n   When a\
    \ VPN customer uses ASM, the customer routers need to be able to\n   map from\
    \ a C-group address to a C-RP address.  These mappings can be\n   provisioned\
    \ in each router, or they can be discovered dynamically\n   through protocols\
    \ such as the Bootstrap Router (BSR) mechanism\n   [RFC5059].  However, it cannot\
    \ be assumed that such protocols will\n   automatically work in the context of\
    \ an extranet.  Discussion of the\n   use of such protocols in an extranet is\
    \ outside the scope of this\n   document.\n"
- title: 1.2.2.  Provider Multicast Control Protocols
  contents:
  - "1.2.2.  Provider Multicast Control Protocols\n   [RFC6513] allows either PIM\
    \ or BGP to be used as the protocol for\n   distributing customer multicast routing\
    \ information.  Except where\n   otherwise specified, such as in Sections 6 and\
    \ 7, the procedures of\n   this document cover both cases.\n"
- title: 1.3.  Clarification on Use of Route Distinguishers
  contents:
  - "1.3.  Clarification on Use of Route Distinguishers\n   [RFC4364] requires that\
    \ every VRF be associated with one or more\n   Route Distinguishers (RDs).  Each\
    \ VPN-IPv4 or VPN-IPv6 route that is\n   exported from a particular VRF contains,\
    \ in its NLRI, an RD that is\n   associated with that VRF.\n   [RFC4364] allows\
    \ a given RD to be associated with more than one VRF,\n   as long as all the VRFs\
    \ associated with that RD belong to the same\n   VPN.  However, in the most common\
    \ deployment model, each RD is\n   associated with one and only one VRF.  [RFC6513]\
    \ and [RFC6514]\n   presuppose this deployment model.  That is, [RFC6513] and\
    \ [RFC6514]\n   presuppose that every RD is associated with one and only one VRF.\
    \  We\n   will call this the \"unique VRF per RD\" condition.\n   [RFC6514] defines\
    \ the MCAST-VPN address family, which has a number of\n   route types.  Each Intra-Autonomous\
    \ System (Intra-AS) \"Inclusive\n   Provider Multicast Service Interface\" (I-PMSI)\
    \ A-D route, S-PMSI A-D\n   route, and Source Active A-D route, when exported\
    \ from a given VRF,\n   contains, in its NLRI, an RD that is associated with the\
    \ VRF.\n   [RFC6513] and [RFC6514] also discuss a class of routes known as\n \
    \  \"UMH-eligible\" routes; when a UMH-eligible route is exported from a\n   given\
    \ VRF, its NLRI contains an RD of the VRF.\n   [RFC6514] also defines MCAST-VPN\
    \ routes whose NLRIs do not contain an\n   RD of the VRF from which they are exported:\
    \ the C-multicast Join\n   routes and the Leaf A-D routes.\n   Those route types\
    \ that, when exported from a given VRF, contain (in\n   their NLRIs) an RD of\
    \ the VRF, will be known in this document as\n   \"local-RD routes\".\n   Given\
    \ the \"unique VRF per RD\" condition, if one sees that two\n   local-RD routes\
    \ have the same RD, one can infer that the two routes\n   originated from the\
    \ same VRF.  This inference can be drawn even if\n   the two routes do not have\
    \ the same SAFI, as long as the two routes\n   are both local-RD routes.\n   This\
    \ document builds upon [RFC6513] and [RFC6514]; therefore, the\n   \"unique VRF\
    \ per RD\" condition is REQUIRED.\n   [RFC6514] presupposes a further requirement\
    \ on the use of RDs in the\n   local-RD routes exported from a given VRF.  Suppose\
    \ that a given VRF\n   exports a Source Active A-D route containing (C-S,C-G).\
    \  That VRF\n   will also export a UMH-eligible route matching C-S.  [RFC6514]\n\
    \   presupposes that the UMH-eligible route and the Source Active A-D\n   route\
    \ have the same RD.\n   In most cases, not only is a given RD associated with\
    \ only a single\n   VRF, but a given VRF is associated with only a single RD.\
    \  We will\n   call this the \"unique RD per VRF\" condition.  When this condition\n\
    \   holds, all the local-RD routes exported from a given VRF will have\n   the\
    \ same RD.  This ensures that the presupposition of the previous\n   paragraph\
    \ will hold, i.e., that the RD in a Source Active A-D route\n   exported from\
    \ a given VRF will have the same RD as the corresponding\n   UMH-eligible route\
    \ exported from the same VRF.\n   Section 7.3 of this document describes a procedure\
    \ known as \"extranet\n   separation\".  When extranet separation is NOT being\
    \ used, it is\n   REQUIRED by this document that the \"unique RD per VRF\" condition\n\
    \   hold.  This ensures that all the local-RD routes exported from a\n   given\
    \ VRF will have the same RD.\n   When extranet separation is used, a VRF that\
    \ contains both extranet\n   sources and non-extranet sources MUST be configured\
    \ with two RDs.\n   One of these RDs is known as the \"default RD\", and the other\
    \ is known\n   as the \"extranet RD\".  It MUST be known by configuration which\
    \ RD is\n   the default RD and which is the extranet RD.\n   When a VRF is configured\
    \ with only one RD, we will refer to that RD\n   as the \"default RD\".\n   In\
    \ general, local-RD routes exported from a given VRF will contain\n   the default\
    \ RD.  However, when extranet separation is used, some of\n   the local-RD routes\
    \ exported from the VRF will contain the\n   extranet RD.  Details concerning\
    \ the exported routes that contain\n   the extranet RD can be found in Sections\
    \ 4.1 and 7.3.\n   Note that the \"unique VRF per RD\" condition applies to the\n\
    \   extranet RD as well as the default RD.  That is, a given extranet RD\n   is\
    \ associated with a unique VRF.\n"
- title: 1.4.  Overview
  contents:
  - "1.4.  Overview\n   Consider two VPNs, VPN-S and VPN-R, each of which supports\
    \ MVPN\n   functionality as specified in [RFC6513] and/or [RFC6514].  In the\n\
    \   simplest configuration, VPN-S is a collection of VRFs, each of which\n   is\
    \ configured with a particular Route Target (RT) value (call it\n   \"RT-S\")\
    \ as its import RT and as its export RT.  Similarly, VPN-R is a\n   collection\
    \ of VRFs, each of which is configured with a particular RT\n   value (call it\
    \ \"RT-R\") as its import RT and as its export RT.\n   In this configuration,\
    \ multicast C-receivers contained in a VPN-R VRF\n   cannot receive multicast\
    \ data traffic from multicast C-sources\n   contained in a VPN-S VRF.  If it is\
    \ desired to allow this, one needs\n   to create an MVPN \"extranet\".  Creating\
    \ an extranet requires\n   procedures in addition to those specified in [RFC6513],\
    \ [RFC6514],\n   and [RFC6625]; this document specifies these additional procedures.\n\
    \   In the example above, the additional procedures will allow a selected\n  \
    \ set of routes exported from the VPN-S VRFs (i.e., from the VRFs\n   containing\
    \ extranet C-sources) to be imported into the VPN-R VRFs\n   (i.e., into the VRFs\
    \ containing extranet C-receivers).  These routes\n   include the routes that\
    \ are to be eligible for use as UMH routes (see\n   Section 5.1 of [RFC6513])\
    \ in the extranet, as well as a selected set\n   of BGP A-D routes (Intra-AS I-PMSI\
    \ A-D routes, S-PMSI A-D routes, and\n   Source Active A-D routes).  Importing\
    \ these routes into the VPN-R\n   VRFs makes it possible to determine, in the\
    \ context of a VPN-R VRF,\n   that a particular C-multicast Join needs to be delivered\
    \ to a\n   particular VPN-S VRF.  It also makes it possible to determine, in the\n\
    \   context of a VPN-R VRF, the P-tunnel through which the aforementioned\n  \
    \ VPN-S VRF sends a particular C-flow.\n   Depending on the type of P-tunnel used,\
    \ it may also be necessary for\n   Leaf A-D routes to be exported by one or more\
    \ VPN-R VRFs and imported\n   into a VPN-S VRF.\n   There are no extranet-specific\
    \ procedures governing the use and\n   distribution of BGP C-multicast routes.\n\
    \   If PIM is used as the PE-PE protocol for distributing C-multicast\n   routing\
    \ information, additional BGP A-D routes must be exported from\n   the VPN-R VRFs\
    \ and imported into the VPN-S VRFs, so that the VPN-S\n   VRFs can join the P-tunnels\
    \ that the VPN-R VRFs use for sending PIM\n   control messages.  Details can be\
    \ found in Section 6.\n   The simple example above describes an extranet created\
    \ from two\n   MVPNs, one of which contains extranet C-sources and one of which\n\
    \   contains extranet C-receivers.  However, the procedures described in\n   this\
    \ document allow for much more complicated scenarios.\n   For instance, an extranet\
    \ may contain extranet C-sources and/or\n   extranet C-receivers from an arbitrary\
    \ number of VPNs, not just from\n   two VPNs.  An extranet C-receiver in VPN-R\
    \ may be allowed to receive\n   multicast traffic from extranet C-sources in VPN-A,\
    \ VPN-B, and VPN-C.\n   Similarly, extranet C-sources in VPN-S may be allowed\
    \ to send\n   multicast traffic to multicast C-receivers that are in VPN-A, VPN-B,\n\
    \   VPN-C, etc.\n   A given VPN customer may desire that only some of its multicast\n\
    \   C-sources be treated as extranet C-sources.  This can be accomplished\n  \
    \ by appropriate provisioning of the import and export RTs of that\n   customer's\
    \ VRFs (as well as the VRFs of other VPNs that contain\n   extranet C-receivers\
    \ for extranet C-flows of the given customer).\n   A given VPN customer may desire\
    \ that some of its extranet C-sources\n   can transmit only to a certain set of\
    \ VPNs while other of its\n   extranet C-sources can transmit only to a different\
    \ set of VPNs.\n   This can be accomplished by provisioning the VRFs to export\
    \ different\n   routes with different RTs.\n   In all these cases, the VPN customers\
    \ set the policies, and the\n   Service Provider (SP) implements the policies\
    \ by the way it\n   provisions the import and export RTs of the VRFs.  It is assumed\
    \ that\n   the customer communicates to the SP the set of extranet C-source\n\
    \   addresses and the set of VPNs to which each C-source can transmit.\n   (Recall\
    \ that every C-source that can transmit to an extranet C-group\n   is an extranet\
    \ C-source and must be able to transmit to any VPN that\n   has receivers for\
    \ that group.  This must be taken into account when\n   the provisioning is done.)\
    \  This customer/SP communication is part of\n   the service provisioning process\
    \ and is outside the scope of this\n   document.\n   It is possible that an extranet\
    \ C-source will transmit both extranet\n   C-flows and non-extranet C-flows. \
    \ However, if extranet C-receiver\n   C-R can receive extranet C-flows from extranet\
    \ C-source C-S, the\n   procedures of this document do not prevent C-R from requesting\
    \ and\n   receiving the non-extranet flows that are transmitted by C-S.\n   Therefore,\
    \ allowing an extranet C-source to transmit non-extranet\n   C-flows is NOT RECOMMENDED.\
    \  However, the SP has no control over the\n   set of C-flows transmitted by a\
    \ given C-source and can do no more\n   than communicate this recommendation to\
    \ its customers.\n   (Alternatively, the customer and SP may coordinate on setting\
    \ up\n   filters to prevent unauthorized flows from being sent to a customer\n\
    \   site; such a procedure is outside the scope of this document.)  See\n   Section\
    \ 10 (\"Security Considerations\") for additional discussion of\n   this issue.\n\
    \   Whenever a VPN is provisioned, there is a risk that errors in\n   provisioning\
    \ may result in an unintended cross-connection of VPNs.\n   This would create\
    \ a security problem for the customers.  When\n   provisioning an extranet, attention\
    \ to detail is particularly\n   important, as an extranet intentionally cross-connects\
    \ VPNs.  Care\n   must always be taken to ensure that the cross-connections are\n\
    \   according to the policy agreed upon by the SP and its customers.\n   Additionally,\
    \ if one is connecting two VPNs that have overlapping\n   address spaces, one\
    \ has to be sure that the inter-VPN traffic neither\n   originates from nor is\
    \ destined to the part of the address space that\n   is in the overlap.  Other\
    \ problems that can arise due to overlapping\n   address spaces are discussed\
    \ in Section 2.\n"
- title: 2.  Extranets and Overlapping Address Spaces
  contents:
  - "2.  Extranets and Overlapping Address Spaces\n   As specified in [RFC4364], the\
    \ address space of one VPN may overlap\n   with the address space of another.\
    \  A given address may be\n   \"ambiguous\" in that it denotes one system within\
    \ VPN-A and a\n   different system within VPN-B.  In the notation of Section 1.1,\n\
    \   if an address C-S is ambiguous between VPN-A and VPN-B, then\n   Host(C-S,A)\
    \ != Host(C-S,B).  However, any given address C-S MUST be\n   unambiguous (i.e.,\
    \ MUST denote a single system) in the context of a\n   given VPN.\n   When a set\
    \ of VRFs belonging to different VPNs are combined into an\n   extranet, it is\
    \ no longer sufficient for an address to be unambiguous\n   only within the context\
    \ of a single VPN:\n   1.  Suppose that C-S is the address of a given extranet\
    \ C-source\n       contained in VPN-A.  Now consider the set of VPNs\n       {VPN-B,\
    \ VPN-C, ...} containing extranet C-receivers that are\n       allowed by policy\
    \ to receive extranet C-flows from VPN-A's C-S.\n       The address C-S MUST be\
    \ unambiguous among this entire set of VPNs\n       {VPN-A, VPN-B, VPN-C, ...};\
    \ i.e., Host(C-S,A) == Host(C-S,B) ==\n       Host(C-S,C).\n       The implication\
    \ is that C-S in VPN-A is not necessarily an\n       extranet C-source for all\
    \ VPNs that contain extranet C-receivers;\n       policy MUST be used to ensure\
    \ that C-S is an extranet C-source\n       for a given VPN, say VPN-B, only if\
    \ C-S is unambiguous between\n       VPN-A and VPN-B.\n   2.  If a given VRF contains\
    \ extranet C-receivers for a given extranet\n       C-source, then the address\
    \ of this C-source MUST be unambiguous\n       among all the extranet C-sources\
    \ for which there are C-receivers\n       in the VRF.  This is true whether or\
    \ not C-sources are in VRFs\n       that belong to the same VPN or different VPNs.\n\
    \       The implication is that if C-S in VRF-X is ambiguous with C-S in\n   \
    \    VRF-Y, then there MUST NOT be any VRF, say VRF-Z, containing\n       C-receivers\
    \ that are allowed by policy to receive extranet\n       C-flows from both C-S\
    \ in VRF-X and C-S in VRF-Y.\n   Note: A VPN customer may be using anycast addresses.\
    \  An anycast\n   address is intentionally ambiguous, as it denotes a set of systems\n\
    \   rather than a single system.  In this document, we will consider an\n   anycast\
    \ address to be unambiguous in a given context as long as it\n   denotes the same\
    \ set of systems whenever it occurs in that context.\n   A multicast C-group address,\
    \ say C-G, may also be ambiguous in that\n   it may be used for one multicast\
    \ group in VPN-A and for an entirely\n   different multicast group in VPN-B. \
    \ If a set of MVPNs are combined\n   into an extranet and C-G is an extranet C-group,\
    \ it is necessary to\n   ensure that C-G is unambiguous among the entire set of\
    \ VPNs whose\n   VRFs contain extranet C-sources, C-RPs, and/or extranet C-receivers\n\
    \   for that C-group.  This may require, as part of the provisioning\n   process,\
    \ customer/SP communication that is outside the scope of this\n   document.\n\
    \   Subject to these restrictions, the SP has complete control over the\n   distribution\
    \ of routes in an MVPN.  This control is exerted by\n   provisioning either (1)\
    \ the export RTs on the VRFs that originate the\n   routes (i.e., the VRFs that\
    \ contain the extranet C-sources) or\n   (2) the import RTs on the VRFs that receive\
    \ the routes (i.e., the\n   VRFs that contain the extranet C-receivers), or both.\n\
    \   Some of the rules and restrictions on provisioning the RTs are\n   applicable\
    \ to all extranets; these are specified in Section 4.\n   Sections 6 and 7 list\
    \ additional rules and restrictions that are\n   applicable only to particular\
    \ extranet scenarios.\n   Even if all the RTs are provisioned according to the\
    \ above rules and\n   restrictions, it is still possible for a single P-tunnel\
    \ to contain\n   multicast data packets whose source and/or group addresses are\n\
    \   ambiguous in the context of the set of PEs that receive data from the\n  \
    \ P-tunnel.  That is, the above rules and restrictions are necessary,\n   but\
    \ not sufficient, to prevent address ambiguity from causing\n   misdelivery of\
    \ traffic.  To prevent such misdelivery, additional\n   procedures or policies\
    \ must be used.\n   Sections 2.1 and 2.2 describe scenarios in which a given P-tunnel\
    \ may\n   carry data packets with ambiguous addresses.  The additional\n   procedures\
    \ and policies needed to prevent misdelivery of data in\n   those scenarios are\
    \ outlined in Section 2.3.  (The detailed\n   procedures described in Sections\
    \ 6 and 7 incorporate the\n   considerations discussed in Section 2.3.)\n"
- title: '2.1.  Ambiguity: P-Tunnel with Extranet/Non-extranet Flows'
  contents:
  - "2.1.  Ambiguity: P-Tunnel with Extranet/Non-extranet Flows\n   In the following,\
    \ we will use the notation \"VRF A-n\" to mean \"VRF n\n   of VPN-A\".\n   If\
    \ VPN-A and VPN-B have overlapping address spaces and are part of\n   the same\
    \ extranet, then the following problem may exist, as\n   illustrated in Figure\
    \ 1.\n   C-S2(A)  C-S1                                      Join(C-S2(A),G)\n\
    \     \\      /                                              /\n      \\    /\
    \                                              /\n    +-------+---+   P1: (C-S1,G),\
    \ (C-S2(A),G)     +---+--------+\n    |VRF A-1|   |---------------------------------|\
    \   |VRF A-2 |\n    +-------+PE1|                                 |PE2+--------+\n\
    \    |VRF B-1|   |---------------------------------|   |VRF B-2 |\n    +-------+---+\
    \   P2: (C-S2(B),G)               +---+--------+\n        /                  \
    \                             /    \\\n       /                              \
    \                 /      \\\n     C-S2(B)                             Join(C-S2(B),G)\
    \   Join(C-S1,G)\n      Figure 1: Ambiguity of Extranet and Non-extranet Source\
    \ Address\n   Suppose that:\n   o  C-G is an SSM C-group used in VPN-A and VPN-B.\n\
    \   o  VRF A-1, on PE1, contains an extranet C-source, with IP address\n     \
    \ C-S1, that is allowed to have receivers in VPN-B.  VRF A-1 thus\n      exports\
    \ to VPN-B a UMH-eligible route matching C-S1.\n   o  In addition, VRF A-1 contains\
    \ a non-extranet C-source with IP\n      address C-S2.  VRF A-1 exports a UMH-eligible\
    \ route matching C-S2\n      to other VPN-A VRFs but NOT to VPN-B.\n   o  VRF\
    \ B-1, also on PE1, contains a non-extranet C-source with IP\n      address C-S2.\
    \  A UMH-eligible route matching C-S2 is thus exported\n      from VRF B-1 to\
    \ other VRFs in VPN-B.\n   o  Host(C-S2,A) != Host(C-S2,B).  That is, C-S2 is\
    \ an ambiguous\n      address in any extranet that contains both VPN-A VRFs and\
    \ VPN-B\n      VRFs.\n   o  VRF B-2, on some other PE, say PE2, requests the multicast\
    \ flow\n      (C-S1,C-G).  In the context of VRF B-2, C-S1 matches the route\n\
    \      exported from VRF A-1.  Thus, B-2's request to receive the\n      (C-S1,C-G)\
    \ flow is transmitted to VRF A-1.\n   o  VRF A-1 responds to VRF B-2's request\
    \ for (C-S1,C-G) traffic by\n      transmitting that traffic on P-tunnel P1.\n\
    \   o  VRF B-2 joins P-tunnel P1 in order to receive the (C-S1,C-G)\n      traffic.\n\
    \   o  VRF A-2, on PE2, requests the (non-extranet) multicast flow\n      (C-S2,C-G).\
    \  In the context of VRF A-2, C-S2 matches the route\n      exported from VRF\
    \ A-1.  Thus, A-2's request to receive the\n      (C-S2,C-G) traffic is transmitted\
    \ to VRF A-1.\n   o  VRF A-1 responds to VRF A-2's request for (C-S2,C-G) traffic\
    \ by\n      transmitting that traffic on P-tunnel P1.\n   o  VRF A-2 joins P-tunnel\
    \ P1 in order to receive the (C-S2,C-G)\n      traffic.\n   o  VRF B-2 requests\
    \ the (non-extranet) multicast flow (C-S2,C-G).  In\n      the context of VRF\
    \ B-2, C-S2 matches the route exported from VRF\n      B-1.  Thus, B-2's request\
    \ to receive the (C-S2,C-G) flow is\n      transmitted to VRF B-1.\n   o  VRF\
    \ B-1 responds to VRF B-2's request for (C-S2,C-G) traffic by\n      transmitting\
    \ that traffic on P-tunnel P2.\n   o  VRF B-2 joins P-tunnel P2.\n   Since VRF\
    \ B-2 has joined P-tunnel P1 and P-tunnel P2, it will receive\n   (C-S2,C-G) traffic\
    \ on both P-tunnels.  The (C-S2,C-G) traffic that\n   VRF B-2 needs to receive\
    \ is traveling on P-tunnel P2; this (C-S2,C-G)\n   traffic must be forwarded by\
    \ B-2 to any attached customer sites that\n   have C-receivers for it.  But B-2\
    \ MUST discard the (C-S2,C-G) traffic\n   that it receives on P1, as this is not\
    \ the traffic that it has\n   requested.  If the (C-S2,C-G) traffic arriving on\
    \ P1 were forwarded\n   to B-2's customer sites, the C-receivers would not be\
    \ able to\n   distinguish the two flows, and the result would be a corrupted data\n\
    \   stream.\n   Note that the procedures of Section 9.1.1 of [RFC6513] (\"Discarding\n\
    \   Packets from Wrong PE\") will not cause VRF B-2 to discard the\n   (C-S2,C-G)\
    \ traffic that arrives on tunnel P1, because P1 and P2 have\n   the same upstream\
    \ PE.\n   Therefore, it is necessary to EITHER (1) prevent the above scenario\n\
    \   from occurring OR (2) ensure that multicast data packets will be\n   discarded\
    \ if they arrive on the wrong P-tunnel (even if they arrive\n   from the expected\
    \ PE).  See Section 2.3 for further discussion of\n   this issue.\n"
- title: '2.2.  Ambiguity: P-Tunnel with Multiple Extranet Flows'
  contents:
  - "2.2.  Ambiguity: P-Tunnel with Multiple Extranet Flows\n   Figure 2 illustrates\
    \ another example of how overlapping address\n   spaces may cause a problem.\n\
    \ C-S2(A2D) C-S1(A2C)                               Join(C-S2(A2D),G)\n     \\\
    \      /                                              /\n      \\    /       \
    \                                       /\n    +-------+---+ P1: (C-S1(A2C),G),\
    \ (C-S2(A2D),G)+---+--------+\n    |VRF A-1|   |---------------------------------|\
    \   |VRF D-1 |\n    +-------+PE1|                                 |PE2+--------+\n\
    \    |VRF B-1|   |---------------------------------|   |VRF C-1 |\n    +-------+---+\
    \ P2: (C-S2(B2C),G)               +---+--------+\n        /                  \
    \                            /  \\\n       /                                 \
    \             /    \\\n     C-S2(B2C)                                       /\
    \      \\\n                                                   Join     Join\n\
    \                                            (C-S2(B2C),G)  (C-S1(A2C),G)\n  \
    \           Figure 2: Ambiguity of Extranet Source Addresses\n   Suppose that:\n\
    \   o  C-G is an SSM C-group address that is used in VPN-A, VPN-B, VPN-C,\n  \
    \    and VPN-D.\n   o  VRF A-1, on PE1, contains an extranet C-source, with IP\
    \ address\n      C-S1, that is allowed by policy to have C-receivers in VPN-C\
    \ (but\n      not in VPN-D).  VRF A-1 thus exports a UMH-eligible route matching\n\
    \      C-S1 to VPN-C.\n   o  In addition, VRF A-1 contains an extranet C-source,\
    \ with IP\n      address C-S2, that is allowed by policy to have C-receivers in\n\
    \      VPN-D (but not in VPN-C).  VRF A-1 thus exports a UMH-eligible\n      route\
    \ matching C-S2 to VPN-D.\n   o  VRF B-1, also on PE1, contains an extranet C-source,\
    \ with IP\n      address C-S2, that is allowed by policy to have C-receivers in\n\
    \      VPN-C (but not in VPN-D).  VRF B-1 thus exports a UMH-eligible\n      route\
    \ matching C-S2 to VPN-C.\n   o  Host(C-S2,A) != Host(C-S2,B).  That is, C-S2\
    \ is an ambiguous\n      address in any extranet that contains both VPN-A VRFs\
    \ and\n      VPN-B VRFs.\n   o  VRF C-1, on some other PE, say PE2, requests the\
    \ extranet\n      multicast flow (C-S1,C-G).  In the context of VRF C-1, C-S1\n\
    \      matches the route exported from VRF A-1.  Thus, C-1's request to\n    \
    \  receive the (C-S1,C-G) flow is transmitted to VRF A-1.\n   o  VRF A-1 responds\
    \ to VRF C-1's request for (C-S1,C-G) traffic by\n      transmitting that traffic\
    \ on P-tunnel P1.\n   o  VRF C-1 joins P-tunnel P1 in order to receive the (C-S1,C-G)\n\
    \      traffic.\n   o  VRF C-1 requests the extranet multicast flow (C-S2,C-G).\
    \  In the\n      context of VRF C-1, C-S2 matches the route exported from VRF\
    \ B-1.\n      Thus, C-1's request to receive the (C-S2,C-G) flow is transmitted\n\
    \      to VRF B-1.\n   o  VRF B-1 responds by transmitting its (C-S2,C-G) traffic\
    \ on\n      P-tunnel P2.\n   o  VRF C-1 joins P-tunnel P2 in order to receive\
    \ the (C-S2,C-G)\n      traffic.\n   o  VRF D-1, on PE2, requests the extranet\
    \ multicast flow (C-S2,C-G).\n      In the context of VRF D-1, C-S2 matches the\
    \ route exported from\n      VRF A-1.  Thus, D-1's request to receive the (C-S2,C-G)\
    \ flow is\n      transmitted to VRF A-1.\n   o  VRF A-1 responds by transmitting\
    \ its (C-S2,C-G) traffic on\n      P-tunnel P1.\n   o  VRF D-1 joins P-tunnel\
    \ P1 in order to receive the (C-S2,C-G)\n      traffic.\n   In this example, VRF\
    \ A-1 has chosen to use the same P-tunnel, P1, to\n   carry both its (C-S2,C-G)\
    \ traffic and the (C-S1,C-G) traffic.  VRF\n   C-1 has joined tunnel P1 in order\
    \ to receive the (C-S1,C-G) traffic\n   from VRF A-1, which means that VRF C-1\
    \ will also receive the unwanted\n   (C-S2,C-G) traffic from P1.  VRF C-1 is also\
    \ expecting (C-S2,C-G)\n   traffic from VRF B-1; this traffic will be received\
    \ from P2.  Thus,\n   VRF C-1 is receiving (C-S2,C-G) traffic on both tunnels,\
    \ and both\n   C-flows arrive from the expected PE, PE1.\n   Therefore, it is\
    \ necessary to EITHER (1) prevent the above scenario\n   from occurring OR (2)\
    \ ensure that VRF C-1 discards any (C-S,C-G)\n   traffic that arrives from the\
    \ wrong P-tunnel.  See Section 2.3 for\n   further discussion of this issue.\n\
    \   Note that the ambiguity described in this section (Section 2.2) would\n  \
    \ not occur if C-G were an (ASM) extranet C-group.  In that case, the\n   scenario\
    \ would violate the rule, given previously in Section 2,\n   requiring that all\
    \ sources sending to a particular ASM extranet\n   C-group must have addresses\
    \ that are unambiguous over all the MVPNs\n   receiving traffic for that C-group.\n"
- title: 2.3.  Preventing Misdelivery in These Scenarios
  contents:
  - "2.3.  Preventing Misdelivery in These Scenarios\n   There are two ways to prevent\
    \ the scenarios discussed in Sections 2.1\n   and 2.2 from resulting in misdelivery\
    \ of data; these techniques are\n   discussed in Sections 2.3.1 and 2.3.2, respectively.\n"
- title: 2.3.1.  Do Not Deliver Packets from the Wrong P-tunnel
  contents:
  - "2.3.1.  Do Not Deliver Packets from the Wrong P-tunnel\n   Consider a particular\
    \ C-flow that has receivers in a particular VRF.\n   Sections 6 and 7 describe\
    \ a set of procedures that enable an egress\n   PE to determine the \"expected\
    \ P-tunnel\" for that C-flow in the\n   context of that VRF.  If a PE receives\
    \ packets of the C-flow (as\n   determined by the IP source and/or destination\
    \ address of the\n   packet), it checks to see if the packet was received on the\
    \ expected\n   P-tunnel for that VRF.  If so, the packet is delivered to the VRF\n\
    \   (and thus to the C-flow's receivers in that VRF).  If not, the packet\n  \
    \ is not delivered to the VRF.\n   Note that at a given egress PE, the wrong P-tunnel\
    \ for one VRF may be\n   the correct P-tunnel for another.\n   These procedures,\
    \ if applied at every PE that joins a given P-tunnel,\n   are sufficient to prevent\
    \ misdelivery of traffic in the scenarios\n   discussed in Sections 2.1 and 2.2.\n\
    \   IF these procedures cannot be applied by every PE that is attached to\n  \
    \ a given extranet, then the policies of Section 2.3.2 MUST be applied\n   at\
    \ every VRF containing C-sources for that extranet.\n   In some cases, however,\
    \ it may be safe to deliver packets that arrive\n   from other than the expected\
    \ P-tunnel.  Suppose that it is known that\n   every packet gets transmitted on\
    \ only a single P-tunnel.  (This will\n   be the case if the \"single PMSI per\
    \ C-flow\" transmission model,\n   discussed in Section 3.1, is being used.) \
    \ Suppose also that it is\n   known that T1 and T2 carry only packets that arrived\
    \ at the same\n   ingress PE, over one or more VRF interfaces that are associated\
    \ with\n   the same VRF (i.e., that there is a particular VRF that is the\n  \
    \ ingress VRF for ALL the packets carried by T1 or T2).  In this case,\n   if\
    \ T1 is the expected P-tunnel for a given (C-S,C-G), it is NOT\n   necessary to\
    \ discard (S,G) packets that arrive over T2.\n   It is not always possible to\
    \ determine whether two P-tunnels are\n   carrying packets from the same ingress\
    \ VRF.  However, in some cases,\n   this can be determined by examination of the\
    \ A-D routes in which the\n   tunnels have been advertised.\n   Consider the following\
    \ example:\n   o  Tunnel T1 is a Point-to-Multipoint (P2MP) multipoint Label\n\
    \      Distribution Protocol (mLDP) or RSVP-TE P-tunnel advertised in an\n   \
    \   Intra-AS I-PMSI A-D route (call it \"R1\").\n   o  Tunnel T2 is a P2MP mLDP\
    \ or RSVP-TE P-tunnel advertised in an\n      S-PMSI A-D route (call it \"R2\"\
    ).\n   o  The respective NLRIs of R1 and R2 contain the same RD value.\n   o \
    \ The MPLS Label field of R1's PTA is zero, and the MPLS label value\n      of\
    \ R2's PTA is zero.\n   In this example, it can be concluded that T1 and T2 are\
    \ carrying\n   packets from the same ingress VRF.  Thus, if T1 is the expected\n\
    \   P-tunnel for a (C-S,C-G) flow, (S,G) packets from T2 can be safely\n   delivered\
    \ to the egress VRF; they do not need to be discarded.\n   Similarly, if T2 is\
    \ the expected P-tunnel for a (C-S,C-G) flow, (S,G)\n   packets from T1 can be\
    \ safely delivered to the egress VRF.\n   Another example is the following:\n\
    \   o  Tunnel T3 is a P2MP mLDP or RSVP-TE P-tunnel advertised in a\n      (C-*,C-*)\
    \ S-PMSI A-D route (call it \"R3\").\n   o  Tunnel T4 is a P2MP mLDP or RSVP-TE\
    \ P-tunnel advertised in a\n      (C-S,C-G) S-PMSI A-D route (call it \"R4\").\n\
    \   o  The respective NLRIs of R3 and R4 contain the same RD value.\n   o  The\
    \ MPLS Label field of R3's PTA is zero, and the MPLS label value\n      of R4's\
    \ PTA is zero.\n   In this example, it can be concluded that T3 and T4 are carrying\n\
    \   packets from the same ingress VRF.  Thus, if T3 is the expected\n   P-tunnel\
    \ for a (C-S,C-G) flow, (S,G) packets from T4 can be safely\n   delivered to the\
    \ egress VRF; they do not need to be discarded.\n   Similarly, if T4 is the expected\
    \ P-tunnel for a (C-S,C-G) flow,\n   (S,G) packets from T3 can be safely delivered\
    \ to the egress VRF.\n   When Ingress Replication (IR) P-tunnels are being used,\
    \ please see\n   [MVPN-IR], especially Section 7 (\"The PTA's 'MPLS Label' Field\"\
    ) for\n   a discussion of how to determine when packets from other than the\n\
    \   expected P-tunnel must be discarded.\n"
- title: 2.3.2.  Policies to Prevent Ambiguity on a P-Tunnel
  contents:
  - "2.3.2.  Policies to Prevent Ambiguity on a P-Tunnel\n   For P-tunnels that are\
    \ advertised in S-PMSI A-D routes whose NLRI\n   contains (C-S,C-G) or (C-S,C-*),\
    \ the ambiguities described in\n   Sections 2.1 and 2.2 can be prevented by provisioning\
    \ a policy that\n   assigns, to such P-tunnels, only flows from the same C-source.\n\
    \   However, it is not always possible to determine, through inspection\n   of\
    \ the control messages, whether this policy has been deployed.  For\n   instance,\
    \ suppose that (1) a given VRF has imported a set of S-PMSI\n   A-D routes, (2)\
    \ each route in the set has bound only a single\n   (C-S1,C-G1) to a single P-tunnel,\
    \ and (3) each route in the set\n   identifies a different P-tunnel in its PTA\
    \ than the P-tunnel\n   identified by the PTA of any other route in the set. \
    \ One cannot\n   infer from this that there is no ambiguity, as the same P-tunnel\
    \ may\n   also have been advertised in an S-PMSI A-D route that is not imported\n\
    \   by the given VRF, and that S-PMSI A-D route may have bound\n   (C-S2,C-G2)\
    \ to the P-tunnel, where C-S1 != C-S2.\n   Therefore, in order to determine that\
    \ a given P-tunnel (advertised in\n   a (C-S,C-G) or (C-S,C-*) S-PMSI A-D route)\
    \ carries only C-flows from\n   a single C-source, a PE must have a priori knowledge\
    \ (through\n   provisioning) that this policy has been deployed.  In the remainder\n\
    \   of this document, we will refer to this policy as the \"single\n   C-source\
    \ per (C-S,C-G) or (C-S,C-*) P-tunnel\" policy.  Note that this\n   policy is\
    \ only applicable to P-tunnels that are advertised only in\n   (C-S,C-G) or (C-S,C-*)\
    \ S-PMSI A-D routes.\n   Of course, if a P-tunnel is advertised in (a) an I-PMSI\
    \ A-D route,\n   (b) an S-PMSI A-D route whose NLRI contains (C-*,C-*), or (c)\
    \ an\n   S-PMSI A-D route whose NLRI contains (C-*,C-G), then it is always\n \
    \  possible for the P-tunnel to contain traffic from multiple C-sources;\n   there\
    \ is no policy that can prevent that.\n   However, if a P-tunnel advertised in\
    \ a (C-*,C-G) S-PMSI A-D route\n   contains only traffic addressed to a single\
    \ C-G, the address\n   uniqueness rules of Section 2 prevent the C-source addresses\
    \ from\n   being ambiguous; the set of C-sources transmitting to a particular\n\
    \   extranet C-group address must be unambiguous over the set of MVPNs\n   that\
    \ have receivers for that C-group.  So, for P-tunnels that are\n   advertised\
    \ in (C-*,C-G) S-PMSI A-D routes, the ambiguities described\n   in Sections 2.1\
    \ and 2.2 can be prevented by provisioning a policy\n   that assigns to such P-tunnels\
    \ only flows to the same extranet\n   C-group.  We will refer to this policy as\
    \ the \"single C-group per\n   (C-*,C-G) P-tunnel\" policy.\n   These considerations\
    \ can be summarized as follows.  IF the procedures\n   referenced in Section 2.3.1\
    \ cannot be applied, then the PEs MUST be\n   provisioned so that all of the following\
    \ conditions hold true for the\n   VRFs that contain extranet C-sources:\n   o\
    \  the \"single C-source per (C-S,C-G) or (C-S,C-*) P-tunnel\" policy\n      is\
    \ provisioned,\n   o  either no (C-*,C-G) S-PMSI A-D routes are advertised or\
    \ the\n      \"single C-group per (C-*,C-G) P-tunnel\" policy is provisioned,\n\
    \   o  no P-tunnels are advertised in I-PMSI A-D routes, and\n   o  no (C-*,C-*)\
    \ S-PMSI A-D routes are advertised.\n   Section 3 of this document describes a\
    \ procedure known as \"extranet\n   separation\".  When extranet separation is\
    \ used, the ambiguity\n   described in Section 2.1 is prevented.  However, the\
    \ ambiguity\n   described in Section 2.2 is not prevented by extranet separation.\n\
    \   Therefore, the use of extranet separation is not a sufficient\n   condition\
    \ for avoiding the use of the procedures discussed in\n   Section 2.3.1.  Extranet\
    \ separation is, however, implied by the\n   policies discussed in this section\
    \ (Section 2.3.2).\n"
- title: 3.  Extranet Transmission Models
  contents:
  - "3.  Extranet Transmission Models\n   This document specifies several \"extranet\
    \ transmission\" models.  A\n   given VRF containing extranet C-sources or C-receivers\
    \ MUST use only\n   one of these models.  Further, if VRF-S contains extranet\
    \ C-sources,\n   VRF-R contains extranet C-receivers, and it is allowed by policy\
    \ for\n   an extranet C-receiver in VRF-R to receive a C-flow from an extranet\n\
    \   C-source in VRF-S, then VRF-S and VRF-R MUST use the same extranet\n   transmission\
    \ model.  The model used by a given VRF is determined by\n   provisioning.\n"
- title: 3.1.  Transmitting an Extranet C-Flow on a Single PMSI
  contents:
  - "3.1.  Transmitting an Extranet C-Flow on a Single PMSI\n   In one extranet transmission\
    \ model, which we call the \"transmitting\n   an extranet C-flow on a single PMSI\"\
    \ model or, more simply, the\n   \"single PMSI per C-flow\" model, a PE transmitting\
    \ a packet of an\n   extranet C-flow transmits it on only a single PMSI.  If the\
    \ PMSI is\n   instantiated by a multicast P-tunnel, this means that the PE\n \
    \  transmits the packet on a single P-tunnel.  Of course, if the PE is a\n   replication\
    \ point for that multicast P-tunnel, the packet is\n   transmitted more than once\
    \ by the PE.  Similarly, if the PMSI is\n   instantiated by IR, each packet may\
    \ be transmitted multiple times.\n   It is still the case, though, that the packet\
    \ is transmitted only on\n   one PMSI.\n   This document provides procedures for\
    \ supporting this transmission\n   model using either BGP or PIM as the PE-PE\
    \ C-multicast control\n   protocol.\n   There are two variants of this transmission\
    \ model: \"without extranet\n   separation\" and \"with extranet separation\"\
    .\n"
- title: 3.1.1.  Without Extranet Separation
  contents:
  - "3.1.1.  Without Extranet Separation\n   In this variant, multicast data traffic\
    \ from extranet C-sources and\n   from non-extranet C-sources may be carried in\
    \ the same P-tunnel.\n   This document provides procedures for supporting this\
    \ variant using\n   either BGP or PIM as the PE-PE C-multicast control protocol.\n"
- title: 3.1.2.  With Extranet Separation
  contents:
  - "3.1.2.  With Extranet Separation\n   In this variant, multicast data traffic\
    \ from extranet C-sources and\n   from non-extranet C-sources are never carried\
    \ in the same P-tunnel.\n   Under certain circumstances, this can reduce the amount\
    \ of multicast\n   data traffic that is delivered unnecessarily to certain PE\
    \ routers.\n   It also eliminates the ambiguity discussed in Section 2.1.\n  \
    \ By definition, when extranet separation is used, the following rule\n   MUST\
    \ be applied:\n      Traffic from extranet C-sources MUST NOT be carried in the\
    \ same\n      P-tunnel as traffic from non-extranet C-sources.\n   This rule does\
    \ not impact those VRFs that contain only non-extranet\n   C-sources, nor does\
    \ it impact those VRFs that contain only extranet\n   C-sources.  However, if\
    \ a particular VRF contains both kinds of\n   C-sources, it will need to advertise\
    \ some P-tunnels that are used for\n   carrying only extranet C-flows and some\
    \ that are used only for\n   carrying non-extranet C-flows.\n   This document\
    \ provides procedures for supporting extranet separation\n   when BGP is used\
    \ as the PE-PE C-multicast control protocol.  Support\n   for extranet separation\
    \ using PIM as the PE-PE C-multicast control\n   protocol is outside the scope\
    \ of this document.\n"
- title: 3.2.  Transmitting an Extranet C-Flow over Multiple PMSIs
  contents:
  - "3.2.  Transmitting an Extranet C-Flow over Multiple PMSIs\n   The second extranet\
    \ transmission model is called the \"transmitting an\n   extranet C-flow over\
    \ multiple PMSIs\" model or, more simply, the\n   \"multiple PMSIs per C-flow\"\
    \ model.  In this model, a PE may transmit\n   the packets of an extranet C-flow\
    \ on several different PMSIs.\n   Support for extranet separation with this model\
    \ is outside the scope\n   of this document.\n   This document provides procedures\
    \ for supporting this transmission\n   model when PIM is used as the PE-PE C-multicast\
    \ control protocol.\n   Support for this transmission model when BGP is used as\
    \ the PE-PE\n   C-multicast control protocol is outside the scope of this document.\n"
- title: 4.  Distribution of Routes That Match C-S/C-RP Addresses
  contents:
  - '4.  Distribution of Routes That Match C-S/C-RP Addresses

    '
- title: 4.1.  UMH-Eligible Routes
  contents:
  - "4.1.  UMH-Eligible Routes\n   As described in Section 5.1 of [RFC6513], in order\
    \ for a C-flow\n   (C-S,C-G) to be carried across the SP backbone, a VRF that\
    \ has\n   multicast receivers for that C-flow must import a route that matches\n\
    \   C-S, and this route must be \"eligible for UMH selection\".  In this\n   document,\
    \ we will refer to these routes as \"UMH-eligible extranet\n   C-source routes\"\
    .\n   The UMH-eligible extranet C-source routes do not necessarily have to\n \
    \  be unicast routes; they MAY be SAFI 129 routes (see Section 5.1.1 of\n   [RFC6513]).\
    \  For example, suppose that one wants a VPN-R C-receiver\n   to be able to receive\
    \ extranet C-flows from C-sources in VPN-S but\n   does not want any VPN-R system\
    \ to be able to send unicast traffic to\n   those C-sources.  One can achieve\
    \ this by using SAFI 129 routes as\n   the UMH-eligible routes exported from VPN-S\
    \ and imported by VPN-R.\n   Since SAFI 129 routes are used only for UMH determination\
    \ and not for\n   unicast routing, this allows the multicast traffic to be forwarded\n\
    \   properly but does not create unicast routes to the C-sources.\n   If a customer\
    \ is using PIM-SM in the ASM model and one or more\n   customer sites have C-receivers\
    \ that are allowed by policy to join a\n   (C-*,C-G) tree, where C-G is an extranet\
    \ C-group, then any VRF with\n   C-receivers for that group MUST import a UMH-eligible\
    \ route that\n   matches C-RP, where C-RP is the Rendezvous Point (RP) address\n\
    \   for C-G.\n   The UMH-eligible extranet C-source and C-RP routes do not have\
    \ to be\n   \"host routes\".  That is, they can be routes whose IPv4 address\n\
    \   prefixes are not 32 bits in length or whose IPv6 address prefixes are\n  \
    \ not 128 bits in length.  So, it is possible for a UMH-eligible\n   extranet\
    \ C-source route to match the address of an extranet C-source\n   and to also\
    \ match the address of a non-extranet C-source.  However,\n   if such a route\
    \ is exported from a VPN-S VRF and imported by a VPN-R\n   VRF, VPN-R receivers\
    \ will be able to receive C-flows from any\n   non-extranet C-sources whose addresses\
    \ match that route.  To prevent\n   this, the VPN-S VRF SHOULD be provisioned\
    \ such that it will NOT\n   export a UMH-eligible route that matches (in the context\
    \ of the VPN-R\n   VRF) both extranet C-sources and non-extranet C-sources.  Failure\
    \ to\n   follow this rule may result in a VPN security violation.  (See\n   Section\
    \ 10.)\n   In general, one does not want ALL the routes from the VPN-S VRFs to\n\
    \   be exported to all the VPN-R VRFs, as only a subset of the routes in\n   the\
    \ VPN-S VRFs will be UMH-eligible extranet C-source routes.  Route\n   distribution\
    \ is, as is always the case for a BGP/MPLS IP VPN\n   [RFC4364], controlled by\
    \ Route Targets (RTs).  A variety of route\n   distribution policies can be created\
    \ by appropriately provisioning\n   the import and export RTs of the various VRFs.\n\
    \   For example, the VPN-S VRFs that contain extranet C-sources could be\n   configured\
    \ to apply an export RT whose value is \"RT-A-extranet\" to\n   the routes that\
    \ match the extranet C-sources.  The VPN-R VRFs that\n   contain extranet C-receivers\
    \ allowed to receive extranet C-flows\n   from VPN-S extranet C-sources could\
    \ then be configured with\n   \"RT-A-extranet\" as an import RT.\n   Arbitrarily\
    \ complex policies can be created by suitable manipulation\n   of the import and\
    \ export RTs.\n"
- title: 4.1.1.  Extranet Separation
  contents:
  - "4.1.1.  Extranet Separation\n   If extranet separation is being used and a given\
    \ VRF is exporting\n   UMH-eligible routes for both extranet C-sources and non-extranet\n\
    \   C-sources, then the VRF MUST be configured not only with its\n   default RD\
    \ but also with an extranet RD.  The exported UMH-eligible\n   routes MUST contain\
    \ the extranet RD in their NLRIs.\n"
- title: 4.2.  Distribution of Unicast Routes Matching C-RPs and DRs
  contents:
  - "4.2.  Distribution of Unicast Routes Matching C-RPs and DRs\n   Consider a C-source,\
    \ C-S, that may transmit to a particular extranet\n   C-group, C-G.\n   In order\
    \ to follow the procedures of [RFC7761],\n   o  The \"first-hop designated router\
    \ (DR)\" for C-S needs to be able to\n      unicast PIM Register messages to a\
    \ C-RP that services C-G.\n   o  The C-RPs servicing C-G need to be able to unicast\
    \ PIM\n      Register-Stop messages to the DR for C-S.\n   It follows that if\
    \ a VRF contains C-S but does not contain a C-RP for\n   C-G, then the VRF MUST\
    \ import a unicast route matching a C-RP for\n   C-G.  Note that the unicast route\
    \ matching the C-RP is needed whether\n   or not the VRF has also imported a SAFI\
    \ 129 route matching the C-RP.\n   (If the VRF also contains receivers for C-G\
    \ and UMH determination is\n   being done using SAFI 129 routes, both a unicast\
    \ route and a SAFI 129\n   matching C-RP route are needed.)\n   Similarly, if\
    \ a VRF contains a C-RP for C-G but does not contain C-S,\n   the VRF MUST import\
    \ a unicast route matching the DR for C-S.  Note\n   that the unicast route matching\
    \ the DR for C-S is needed even if UMH\n   determination is being done using SAFI\
    \ 129 routes; in that case, if\n   the VRF also contains receivers for C-G, it\
    \ needs to import a\n   SAFI 129 route matching C-S and a unicast route matching\
    \ the DR\n   for C-S.\n   If, for a particular extranet C-group, C-G, the customer\
    \ is using\n   \"anycast-RP\" [RFC3446] [RFC4610] or the Multicast Source Discovery\n\
    \   Protocol (MSDP) [RFC3618], then all the C-RPs serving C-G need to\n   send\
    \ unicast messages to each other.  Thus, any VRF that contains a\n   C-RP for\
    \ C-G needs to import unicast routes matching ALL the other\n   C-RPs that serve\
    \ C-G.\n   The need to distribute these unicast routes is usually not a problem\n\
    \   as long as all the C-sources and C-RPs for C-G are in the same MVPN.\n   If,\
    \ however, the C-sources are not all in the same MVPN, great care\n   must be\
    \ taken to ensure that the unicast routes mentioned above are\n   properly distributed.\n\
    \   There may be scenarios in which all the C-sources for C-G are in the\n   same\
    \ MVPN, but there are receivers in different VPNs, and some or all\n   of the\
    \ VPNs with receivers have their own C-RPs for C-G.  In this\n   case, care must\
    \ be taken to ensure that the C-RPs can all unicast to\n   each other.\n"
- title: 4.3.  Route Targets and Ambiguous UMH-Eligible Routes
  contents:
  - "4.3.  Route Targets and Ambiguous UMH-Eligible Routes\n   This section imposes\
    \ a constraint on the way RTs are assigned to\n   (a) UMH-eligible routes and\
    \ (b) the BGP A-D routes that advertise\n   P-tunnels (i.e., BGP A-D routes that\
    \ contain a PTA).  The constraint\n   specified here applies to any extranet for\
    \ which the ambiguity\n   described in Section 2.2 is possible.  (The conditions\
    \ under which\n   such ambiguity is possible are also described in Section 2.2.)\n\
    \   We want to ensure that, in any given VRF, the UMH-eligible route\n   matching\
    \ a given extranet C-source has an RT in common with every BGP\n   A-D route that\
    \ advertises a P-tunnel that may be used to carry\n   extranet multicast traffic\
    \ from that C-source.  We also want to\n   ensure that the UMH-eligible route\
    \ matching a given extranet C-source\n   does not have any RT in common with any\
    \ BGP A-D route that advertises\n   a P-tunnel that may be used to carry any multicast\
    \ traffic from a\n   different C-source that has the same IP address.  This enables\
    \ us to\n   determine whether traffic that appears to be from the given C-source\n\
    \   is really arriving on the wrong P-tunnel and hence is really from a\n   different\
    \ C-source with the same IP address.\n   Suppose that an IP address C-S is used\
    \ in VPN-A as the address of one\n   system and used in VPN-B as the address of\
    \ a different system.  In\n   this case, one or more VPN-A VRFs may export a VPN-IP\
    \ route whose\n   NLRI is <RD1,S>, and one or more VPN-B VRFs may export a VPN-IP\
    \ route\n   whose NLRI is <RD2,S>, where RD1 != RD2.  Consider two routes -- R1\n\
    \   and R2 -- for which the following conditions all hold:\n   o  R1 and R2 are\
    \ UMH-eligible extranet C-source or C-RP routes, or\n      are unicast routes\
    \ matching a C-RP.\n   o  R1 is exported from a VRF of VPN-A, while R2 is exported\
    \ from a\n      VRF of a different VPN, say VPN-B.\n   o  R1's NLRI specifies\
    \ IP address prefix S/n.\n   o  R2's NLRI specifies IP address prefix S/m.\n \
    \  o  m >= n (S/m is either the same as or more specific than S/n).\n   o  There\
    \ is some host address H such that:\n      *  H denotes a different system in\
    \ VPN-A than in VPN-B, and\n      *  H/m == S/m (so either S/m or S/n might be\
    \ a longest match for H\n         in some VRF).\n   We impose the following constraint:\
    \ RTs MUST be assigned in such a\n   way that R1 and R2 do not have any RT in\
    \ common.\n   (This constraint is not as onerous as it may seem.  Typically, R1\
    \ and\n   R2 would not have an RT in common, as that might result in their\n \
    \  being imported into the same VRF, making the address H ambiguous in\n   that\
    \ VRF.)\n   Sections 6 and 7 specify procedures for determining if a received\n\
    \   C-flow has been received over the expected P-tunnel.  Those\n   procedures\
    \ will not work if this constraint is violated.  (The\n   constraint described\
    \ in this section is necessary, but not\n   sufficient, for the procedures of\
    \ Sections 6 and 7 to work;\n   additional constraints that cover the assignment\
    \ of RTs to BGP A-D\n   routes are given in subsequent sections.)\n"
- title: 4.4.  Dynamically Marking Extranet Routes
  contents:
  - '4.4.  Dynamically Marking Extranet Routes

    '
- title: 4.4.1.  The Extranet Source Extended Community
  contents:
  - "4.4.1.  The Extranet Source Extended Community\n   Sections 4.1, 4.2, and 4.3\
    \ place specific requirements on the way in\n   which certain VPN-IP routes are\
    \ distributed.  In order to ensure that\n   these requirements are met, a VPN\
    \ customer must tell its SP which\n   routes are the matching routes for extranet\
    \ C-sources and C-RPs.\n   This may be done as part of the provisioning process.\
    \  Note that this\n   does not necessarily require customer/provider interaction\
    \ every time\n   the customer adds a new extranet C-source or C-RP, but only when\
    \ the\n   IP address of the new C-source or C-RP does not match an existing\n\
    \   route that is already being distributed as a VPN-IP extranet route.\n   Nevertheless,\
    \ it seems worthwhile to support an OPTIONAL mechanism\n   that allows a customer\
    \ to dynamically mark certain routes as being\n   extranet routes.\n   To facilitate\
    \ this, we define a new Transitive Opaque Extended\n   Community (see [RFC4360],\
    \ [RFC7153], and Section 9 of this document):\n   the Extranet Source Extended\
    \ Community.  When a Customer Edge (CE)\n   router advertises (via BGP) a route\
    \ to a PE router and the AFI/SAFI\n   of the route is 1/1, 1/2, 1/4, 2/1, 2/2,\
    \ or 2/4, the Extranet Source\n   Extended Community MAY be attached to the route.\
    \  The value field of\n   the Extended Community MUST be set to zero.  By placing\
    \ this Extended\n   Community on a particular route, a CE router indicates to\
    \ a PE router\n   that the procedures of Sections 4.1, 4.2, and 4.3 are to be\
    \ applied\n   to that route.  That is, the CE router may use this Extended\n \
    \  Community to indicate to the PE router that a particular route is to\n   be\
    \ treated as a route that matches the address of an extranet source\n   and is\
    \ to be exported accordingly to other VPNs.  A PE router that\n   interprets this\
    \ Extended Community MUST ignore the contents of the\n   value field.\n   Whether\
    \ a CE router uses the Extranet Source Extended Community is\n   determined by\
    \ the configuration of the CE router.  If used, the set\n   of routes to which\
    \ the Extended Community is attached is also\n   determined by configuration of\
    \ the CE.  Note that a particular PE\n   router may or may not support the use\
    \ of the Extranet Source Extended\n   Community by a particular CE router; this\
    \ is determined by the\n   service agreement between the SP and its customer.\n\
    \   If a CE is advertising SAFI 2 routes to the PE as the UMH-eligible\n   extranet\
    \ C-source and C-RP routes and the CE is using the Extranet\n   Source Extended\
    \ Community, it is important that the CE attach that\n   Extended Community to\
    \ the SAFI 2 routes, rather than just to the\n   corresponding SAFI 1 routes.\
    \  Otherwise, extranet receivers may not\n   be able to join the (C-S,C-G) or\
    \ (C-*,C-G) multicast trees.\n   However, if the C-sources and the C-RPs for a\
    \ given extranet C-group\n   are not all in the same VPN, the Extended Community\
    \ would also have\n   to be attached to the SAFI 1 routes that match the C-RP\
    \ addresses and\n   to the SAFI 1 routes that match the addresses of the first-hop\n\
    \   designated routers for all the C-sources.  Otherwise, the first-hop\n   routers\
    \ might not be able to send PIM Register messages to the C-RPs,\n   and the C-RPs\
    \ might not be able to send PIM Register-Stop messages to\n   the first-hop routers.\n\
    \   While this Extended Community allows a customer to inform the SP\n   dynamically\
    \ that certain routes are \"extranet routes\", it does not\n   allow a customer\
    \ to control the set of RTs that the route will carry\n   when it is redistributed\
    \ as a VPN-IP route.  Thus, it is only useful\n   when all the extranet routes\
    \ from a given VRF are exported with\n   exactly the same set of RTs.  (cf. Section\
    \ 4.3.1 of [RFC4364], which\n   does provide a mechanism that, if properly supported\
    \ by the SP,\n   allows the customer to determine the set of RTs carried by a\
    \ VPN-IP\n   route.)  A CE SHOULD NOT attach the Extranet Source Extended\n  \
    \ Community to any route for which it uses another method of specifying\n   the\
    \ RTs to be carried by that route.  A CE SHOULD NOT attach the\n   Extranet Source\
    \ Extended Community to a route unless all the extranet\n   routes from the CE's\
    \ VPN are intended to carry the same set of RTs.\n   A PE SHOULD ignore the Extranet\
    \ Source Extended Community if it\n   appears on a route that the CE should not\
    \ have put it on.  A PE that\n   ignores the Extranet Source Extended Community\
    \ SHOULD NOT follow the\n   procedures of Section 4.4.2.\n   Note that misconfiguration\
    \ on the CE router can result in the\n   Extranet Source Extended Community being\
    \ mistakenly attached to a\n   route that is not intended to be exported as an\
    \ extranet route.  This\n   could result in a VPN security violation.\n"
- title: 4.4.2.  Distribution of Extranet Source Extended Community
  contents:
  - "4.4.2.  Distribution of Extranet Source Extended Community\n   Suppose that a\
    \ PE receives from a CE a route (call it \"R\") with the\n   Extranet Source Extended\
    \ Community.  The PE must determine (via the\n   considerations discussed in Section\
    \ 4.4.1) whether it should ignore\n   that Extended Community on route R; if it\
    \ should ignore the Extended\n   Community, the procedures described in this section\
    \ are not followed.\n   Otherwise, when the PE originates a VPN-IP route corresponding\
    \ to\n   route R, the PE MUST attach this Extended Community to that route.\n\
    \   A Route Reflector MUST NOT add or remove the Extranet Source Extended\n  \
    \ Community from the VPN-IP routes reflected by the Route Reflector,\n   including\
    \ the case where VPN-IP routes received via Internal BGP\n   (IBGP) are reflected\
    \ to External BGP (EBGP) peers (inter-AS\n   option (c); see Section 10 of [RFC4364]).\
    \  The value of the Extended\n   Community MUST NOT be changed by the Route Reflector.\n\
    \   When re-advertising VPN-IP routes, Autonomous System Border Routers\n   (ASBRs)\
    \ MUST NOT add/remove the Extranet Source Extended Community\n   from these routes.\
    \  This includes inter-AS options (b) and (c) (see\n   Section 10 of [RFC4364]).\
    \  The value of the Extended Community\n   MUST NOT be changed by the ASBRs.\n\
    \   When a PE advertises (via BGP) IP routes to a CE, these routes\n   MUST NOT\
    \ carry the Extranet Source Extended Community unless the\n   PE-CE connection\
    \ is actually an inter-AS option (a) connection (see\n   Section 10 of [RFC4364]).\
    \  When the PE-CE connection is not an\n   inter-AS option (a) connection, a CE\
    \ that receives an IP route with\n   the Extranet Source Extended Community MUST\
    \ remove it from the route\n   before re-advertising the route.\n   The rules\
    \ for attaching the Extranet Source Extended Community to a\n   VPN-IP route,\
    \ and the rules for propagating that Extended Community,\n   are needed in order\
    \ to support the scenario in which a VPN contains\n   an option (a) interconnect\
    \ (see Section 10 of [RFC4364]).  At the\n   option (a) interconnect, the VPN-IP\
    \ route gets translated back to an\n   IP route, and the RTs are stripped off\
    \ before the IP route is\n   propagated.  If the Extranet Source Extended Community\
    \ has also been\n   stripped off, there is no way for the router at the other\
    \ end of the\n   option (a) interconnect to know that the route represents an\
    \ extranet\n   source.  Thus, the technique of using the Extranet Source Extended\n\
    \   Community to dynamically signal that a particular route represents an\n  \
    \ extranet source will not work correctly across an option (a)\n   interconnect\
    \ unless the rules in this section are followed.\n"
- title: 4.5.  The Extranet Separation Extended Community
  contents:
  - "4.5.  The Extranet Separation Extended Community\n   We define a new Transitive\
    \ Opaque Extended Community: the Extranet\n   Separation Extended Community (see\
    \ [RFC4360], [RFC7153], and\n   Section 9 of this document).  This Extended Community\
    \ is used only\n   when extranet separation is being used.  Its value field MUST\
    \ be set\n   to zero upon origination, MUST be ignored upon reception, and MUST\
    \ be\n   passed unchanged by intermediate routers.  A Route Reflector MUST NOT\n\
    \   add or remove the Extranet Separation Extended Community from the\n   routes\
    \ it reflects, including the case where routes received via IBGP\n   are reflected\
    \ to EBGP peers (inter-AS option (c); see Section 10 of\n   [RFC4364]).\n   If\
    \ a VRF has been provisioned to use extranet separation and that VRF\n   has been\
    \ provisioned to transmit any extranet C-flows on a P-tunnel\n   that it advertises\
    \ in an I-PMSI A-D route or a (C-*,C-*) S-PMSI A-D\n   route, then any UMH-eligible\
    \ routes that are exported from that VRF\n   following the procedures of Sections\
    \ 4.1, 4.2, and 4.3 MUST carry the\n   Extranet Separation Extended Community.\
    \  In addition, if an I-PMSI\n   A-D route and/or (C-*,C-*) S-PMSI A-D route exported\
    \ from that VRF is\n   used to carry extranet traffic, that A-D route MUST also\
    \ carry the\n   Extranet Separation Extended Community.  Further details may be\
    \ found\n   in Sections 7.3, 7.4.4, and 7.4.5.\n"
- title: 5.  Origination and Distribution of BGP A-D Routes
  contents:
  - "5.  Origination and Distribution of BGP A-D Routes\n   Except where otherwise\
    \ specified, this section describes procedures\n   and restrictions that are independent\
    \ of the PE-PE C-multicast\n   control protocol.\n"
- title: 5.1.  Route Targets of UMH-Eligible Routes and A-D Routes
  contents:
  - "5.1.  Route Targets of UMH-Eligible Routes and A-D Routes\n   Suppose that there\
    \ is an extranet C-flow such that:\n   o  The extranet C-source of that C-flow\
    \ is in VRF A-1.\n   o  One or more extranet C-receivers of that C-flow are in\
    \ VRF B-1.\n   In this case, VRF A-1 MUST export a UMH-eligible route that matches\n\
    \   the extranet C-source address, and VRF B-1 MUST import that route.\n   In\
    \ addition, VRF A-1 MUST export an Intra-AS I-PMSI A-D route or an\n   S-PMSI\
    \ A-D route specifying the P-tunnel through which it will send\n   the data traffic\
    \ of the given extranet C-flow, and VRF B-1 MUST\n   import that route.  If BGP\
    \ is the PE-PE C-multicast control protocol,\n   then under certain conditions\
    \ (as specified in [RFC6514]), VRF A-1\n   may also need to export a Source Active\
    \ A-D route specifying that it\n   contains a source of the given C-flow, and\
    \ VRF B-1 must import that\n   Source Active A-D route.  That is, in order for\
    \ VRF B-1 to receive a\n   C-flow from a given extranet C-source contained in\
    \ VRF A-1, VRF A-1\n   MUST export a set of A-D routes that are \"about\" that\
    \ source, and VRF\n   B-1 MUST import them.\n   One way to ensure this is to provision\
    \ an RT that is carried by all\n   the routes exported from VRF A-1 that are \"\
    about\" a given extranet\n   C-source and also provision this RT as an import\
    \ RT at any VRF (such\n   as VRF B-1) that is allowed to receive extranet flows\
    \ from that\n   source.\n   If the \"single PMSI per C-flow\" transmission model\
    \ is being used\n   (with or without extranet separation), there is an additional\n\
    \   requirement, stated below, regarding the way RTs are provisioned, as\n   the\
    \ RTs carried by a UMH-eligible route that matches a given extranet\n   C-source\
    \ may need to be used to identify the A-D routes that are\n   \"about\" that source.\n\
    \   Consider the following scenario:\n   o  IP address S is the address of one\
    \ system in VPN-A and the address\n      of a different system in VPN-B.\n   o\
    \  VRF A-1 on PE1 exports UMH-eligible route R1, which is a matching\n      route\
    \ for S.\n   o  VRF A-1 on PE1 exports an A-D route P1 whose PTA identifies a\n\
    \      P-tunnel through which VRF A-1 may send traffic whose C-source is\n   \
    \   S, where one of the following conditions holds:\n      *  P1 is an I-PMSI\
    \ A-D route, OR\n      *  P1 is an S-PMSI A-D route whose NLRI contains (C-*,C-*)\
    \ or\n         (C-*,C-G), OR\n      *  P1 is an S-PMSI A-D route whose NLRI contains\
    \ (C-S,C-G) or\n         (C-S,C-*), BUT the \"single C-source per (C-S,C-G) or\
    \ (C-S,C-*)\n         P-tunnel\" policy is not provisioned, OR\n      *  P1 is\
    \ a Source Active A-D route whose NLRI contains (C-S,C-G).\n   o  VRF B-1 on PE1\
    \ exports a UMH-eligible route R2, which is a\n      matching route for S.\n \
    \  o  VRF B-1 on PE1 exports an A-D route P2 whose PTA identifies a\n      P-tunnel\
    \ on which VRF B-1 may send traffic whose C-source is S,\n      where one of the\
    \ following conditions holds:\n      *  P2 is an I-PMSI A-D route, OR\n      *\
    \  P2 is an S-PMSI A-D route whose NLRI specifies (C-*,C-*) or\n         (C-*,C-G),\
    \ OR\n      *  P2 is an S-PMSI A-D whose NLRI specifies (C-S,C-G) or\n       \
    \  (C-S,C-*), BUT the \"single C-source per (C-S,C-G) or (C-S,C-*)\n         P-tunnel\"\
    \ policy is not provisioned, OR\n      *  P2 is a Source Active A-D route whose\
    \ NLRI contains (C-S,C-G).\n   As implied by the rules of Section 4.1, there MUST\
    \ NOT be any RT that\n   is common to both R1 and R2.  In addition, the following\
    \ set of rules\n   for RT assignment MUST be followed when extranets are supported.\n\
    \   These rules support all the extranet transmission models described in\n  \
    \ this specification:\n   o  There MUST NOT be any RT that is carried by both\
    \ P1 and P2.\n   o  The intersection of the set of RTs carried by P1 and the set\
    \ of\n      RTs carried by R1 MUST be non-null, and any VRF that imports both\n\
    \      P1 and R1 MUST be configured with an import RT from this\n      intersection.\n\
    \   o  The intersection of the set of RTs carried by P2 and the set of\n     \
    \ RTs carried by R2 MUST be non-null, and any VRF that imports both\n      P2\
    \ and R2 MUST be configured with an import RT from this\n      intersection.\n\
    \   Suppose that VRF C-1 on PE2 imports P1 and R1 from VRF A-1 while also\n  \
    \ importing P2 from VRF B-1.  Since\n   o  R1 is VRF C-1's route to S,\n   o \
    \ R1 has an RT in common with P1, and\n   o  R1 has no RT in common with P2,\n\
    \   it can be concluded that VRF C-1 should expect that multicast traffic\n  \
    \ from S will arrive on the P-tunnel specified in P1.  See Sections 6\n   and\
    \ 7 for more details on determining the expected P-tunnel for a\n   given extranet\
    \ C-flow.\n   While the assignment of import and export RTs to routes is a\n \
    \  deployment and provisioning issue rather than a protocol issue, it\n   should\
    \ be understood that failure to follow these rules is likely to\n   result in\
    \ VPN security violations.\n"
- title: 5.2.  Considerations for Particular Inclusive Tunnel Types
  contents:
  - "5.2.  Considerations for Particular Inclusive Tunnel Types\n   An Inclusive Tunnel\
    \ (sometimes referred to as an \"Inclusive Tree\";\n   see Section 2.1.1 of [RFC6513])\
    \ is a tunnel that, by default, carries\n   all the multicast traffic of a given\
    \ MVPN that enters the backbone\n   network via a particular PE.  An Inclusive\
    \ Tunnel is advertised in\n   the PTA of an I-PMSI A-D route.\n"
- title: 5.2.1.  RSVP-TE P2MP or Ingress Replication
  contents:
  - "5.2.1.  RSVP-TE P2MP or Ingress Replication\n   This section applies when Inclusive\
    \ Tunnels are created using either\n   RSVP-TE P2MP or IR.\n   Suppose that a\
    \ VRF, say VRF-S, contains a given extranet C-source\n   C-S, and VRF-S advertises\
    \ in its Intra-AS I-PMSI A-D route either a\n   P2MP RSVP-TE P-tunnel or an IR\
    \ P-tunnel to carry extranet traffic.\n   In order for VRF-S to set up the P2MP\
    \ RSVP-TE or IR P-tunnel, it must\n   know all the PEs that are leaf nodes of\
    \ the P-tunnel, and to learn\n   this it must import an Intra-AS I-PMSI A-D route\
    \ from every VRF that\n   needs to receive data through that tunnel.\n   Therefore,\
    \ if VRF-R contains an extranet C-receiver that is allowed\n   by policy to receive\
    \ extranet flows from C-S, the RT(s) carried by\n   the Intra-AS I-PMSI A-D routes\
    \ originated by VRF-R MUST be such that\n   those Intra-AS I-PMSI A-D routes will\
    \ be imported into VRF-S.\n   In the case of IR, this has the following consequence:\
    \ if an egress\n   PE has n VRFs with receivers for a flow that VRF-S transmits\
    \ on its\n   I-PMSI, that egress PE will receive n copies of the same packet,\
    \ one\n   for each of the n VRFs.\n   Note that Section 9.1.1 of [RFC6514] prohibits\
    \ the \"Leaf Information\n   Required\" flag from being set in the PTA of an Intra-AS\
    \ I-PMSI A-D\n   route.  If this prohibition is ever removed, the requirement\
    \ of this\n   section will apply only if VRF-S does not set that flag.\n"
- title: 5.2.2.  Ingress Replication
  contents:
  - "5.2.2.  Ingress Replication\n   This section applies only when Inclusive Tunnels\
    \ are created via IR.\n   [RFC6513] and [RFC6514] specify procedures that allow\
    \ I-PMSIs to be\n   instantiated by IR.  The concept of an IR P-tunnel, and the\n\
    \   procedures for supporting IR P-tunnels, are explained more fully in\n   [MVPN-IR].\
    \  An IR P-tunnel can be thought of as a P2MP tree in which\n   a packet is transmitted\
    \ from one node on the tree to another by being\n   encapsulated and sent through\
    \ a unicast tunnel.\n   As discussed in Section 2, when I-PMSIs are used to support\n\
    \   extranets, egress PEs MUST have the ability to discard customer\n   multicast\
    \ data packets that arrive on the wrong P-tunnel.  When\n   I-PMSIs are instantiated\
    \ by IR, this implies that the following two\n   procedures MUST be followed:\n\
    \   1.  One of the following three procedures MUST be followed:\n       a.  the\
    \ \"Single Forwarder Selection\" procedures of Section 9.1.2\n           of [RFC6513]\n\
    \       b.  the \"native PIM methods\" of Section 9.1.3 of [RFC6513]\n       c.\
    \  the unicast encapsulation used to transmit packets along the\n           IR\
    \ P-tunnel is such as to enable the receiving node to\n           identify the\
    \ transmitting node (note that this would not be\n           the case if, for\
    \ example, the unicast tunnels were MP2P LSPs)\n       and\n   2.  If a PE assigns\
    \ an MPLS label value in the PTA of an Intra-AS or\n       Inter-AS I-PMSI A-D\
    \ route that it originates, that label value\n       MUST NOT appear in the PTA\
    \ of any other I-PMSI or S-PMSI A-D\n       route originated by the same PE.\n\
    \   Failure to follow these procedures would make it impossible to\n   discard\
    \ packets that arrive on the wrong P-tunnel and thus could lead\n   to duplication\
    \ of data.\n   If it is desired to support extranets while also using IR to\n\
    \   instantiate the PMSIs, an alternative is to use (C-*,C-*) S-PMSIs\n   instead\
    \ of I-PMSIs.  (See [RFC6625], as well as Sections 7.2.2,\n   7.3.2, and 7.4.4\
    \ of this document.)  This has much the same effect in\n   the data plane, and\
    \ there are no restrictions on the type of unicast\n   tunnel that can be used\
    \ for instantiating S-PMSIs.\n   Section 6.4.5 of [RFC6513] describes a way to\
    \ support VPNs using\n   I-PMSIs that are instantiated by IR, using no S-PMSIs,\
    \ but using\n   \"explicit tracking\" to ensure that a C-flow goes only to egress\
    \ PEs\n   that have receivers for it.  This document does not provide\n   procedures\
    \ to support extranets using that model.\n"
- title: 6.  When PIM Is the PE-PE C-Multicast Control Plane
  contents:
  - "6.  When PIM Is the PE-PE C-Multicast Control Plane\n   As specified in [RFC6513],\
    \ when PIM is used as the PE-PE C-multicast\n   control plane for a particular\
    \ MVPN, there is a \"Multidirectional\n   Inclusive Provider Multicast Service\
    \ Interface\" (MI-PMSI) for that\n   MVPN, and all the PEs of that MVPN must be\
    \ able to send and receive\n   on that MI-PMSI.  Associated with each VRF of the\
    \ MVPN is a PIM\n   C-instance, and the PIM C-instance treats the MI-PMSI as if\
    \ it were a\n   LAN interface.  That is, the \"ordinary\" PIM procedures run over\
    \ the\n   MI-PMSI just as they would over a real LAN interface, except that the\n\
    \   data-plane and control-plane \"Reverse Path Forwarding (RPF) checks\"\n  \
    \ need to be modified.  Section 5.2 of [RFC6513] specifies the RPF\n   check modifications\
    \ for non-extranet MVPN service.\n   For example, suppose that there are two VPNs:\
    \ VPN-S and VPN-R.  In\n   the absence of extranet support, all the VRFs of VPN-S\
    \ are connected\n   via one MI-PMSI (call it \"the VPN-S MI-PMSI\"), and all the\
    \ VRFs of\n   VPN-R are connected via another (\"the VPN-R MI-PMSI\").  If we\
    \ want to\n   provide extranet service in which the extranet C-sources are attached\n\
    \   to some set of VPN-S VRFs while the extranet C-receivers are attached\n  \
    \ to some set of VPN-R VRFs, then we have two choices:\n   1.  either the VPN-R\
    \ VRFs need to join the VPN-S MI-PMSI, or\n   2.  the VPN-S VRFs need to join\
    \ the VPN-R MI-PMSI.\n   The first choice is used to support the \"single PMSI\
    \ per C-flow\"\n   transmission model.  The second choice is used to support the\n\
    \   \"multiple PMSIs per C-flow\" transmission model.\n   Procedures for both\
    \ models are described below.\n   To support these models, it must be possible\
    \ to determine which\n   I-PMSI A-D routes are associated with the VPN-S I-PMSI\
    \ and which\n   I-PMSI A-D routes are associated with the VPN-R I-PMSI.  Procedures\n\
    \   are given for assigning RTs to these routes in a way that makes this\n   determination\
    \ possible.\n   Both models allow the use of S-PMSIs to carry multicast data traffic.\n\
    \   If a VRF containing receivers can receive from multiple MI-PMSIs,\n   each\
    \ S-PMSI must be uniquely associated with a particular MI-PMSI.\n   Procedures\
    \ are given for assigning RTs to these routes in a way that\n   makes this determination\
    \ possible.\n   All the procedures specified in Sections 3, 4, and 5 still apply.\n\
    \   Note that there are no special extranet procedures for Inter-AS\n   I-PMSI\
    \ A-D routes or for Leaf A-D routes.  Source Active A-D routes\n   are not used\
    \ when PIM is the PE-PE C-multicast protocol.\n"
- title: 6.1.  Provisioning VRFs with RTs
  contents:
  - '6.1.  Provisioning VRFs with RTs

    '
- title: 6.1.1.  Incoming and Outgoing Extranet RTs
  contents:
  - "6.1.1.  Incoming and Outgoing Extranet RTs\n   In the absence of extranet service,\
    \ suppose that each VRF of a given\n   VPN (call it \"VPN-S\") is configured with\
    \ RT-S as its import and\n   export RT, and that each VRF of a second VPN (call\
    \ it \"VPN-R\") is\n   configured with RT-R as its import and export RT.  We will\
    \ refer to\n   RT-S and RT-R as \"non-extranet RTs\".\n   Now suppose that VPN-S\
    \ contains some extranet C-sources and VPN-R\n   contains some extranet C-receivers\
    \ that are allowed by policy to\n   receive extranet C-flows from the VPN-S extranet\
    \ C-sources.\n   To set up this S-to-R extranet, provisioning an additional RT\
    \ (call\n   it \"RT-S-to-R\") whose value is, in general, distinct from RT-S and\n\
    \   RT-R is REQUIRED.\n   A VPN-S VRF that contains extranet C-sources allowed\
    \ to transmit to\n   VPN-R MUST be configured with RT-S-to-R as an \"Outgoing\
    \ Extranet RT\".\n   A VPN-R VRF that contains extranet C-receivers allowed to\
    \ receive\n   packets from VPN-S MUST be configured with RT-S-to-R as an \"Incoming\n\
    \   Extranet RT\".\n   Note that the terms \"Incoming\" and \"Outgoing\" in this\
    \ context refer\n   to the direction of multicast data packets relative to the\
    \ VRF.\n   The Incoming Extranet RTs and Outgoing Extranet RTs that are\n   configured\
    \ for a given VRF serve as import RTs for that VRF.  They\n   also serve as export\
    \ RTs, but only for specific routes as specified\n   in Section 6.1.2 below.\n\
    \   Note that any VRF that contains both extranet C-sources and extranet\n   C-receivers\
    \ MUST be configured with both Outgoing Extranet RTs and\n   Incoming Extranet\
    \ RTs.\n   A VRF MAY be configured with more than one Incoming Extranet RT\n \
    \  and/or Outgoing Extranet RT.\n   If it happens to be the case that all C-sources\
    \ in VPN-S are extranet\n   C-sources allowed to transmit to VPN-R, then VPN-S\
    \ VRFs MAY be\n   configured such that RT-S is both a non-extranet RT and an Outgoing\n\
    \   Extranet RT, and VPN-R VRFs MAY be configured such that RT-S is an\n   Incoming\
    \ Extranet RT.\n"
- title: 6.1.2.  UMH-Eligible Routes and RTs
  contents:
  - "6.1.2.  UMH-Eligible Routes and RTs\n   Suppose that R1 is a route exported from\
    \ a VPN-S VRF and matching an\n   extranet C-source that is allowed by policy\
    \ to transmit to VPN-R.  In\n   that case, R1 MUST carry the Outgoing Extranet\
    \ RT used for the S-to-R\n   extranet.  This will cause the route to be imported\
    \ into the VPN-R\n   VRFs that have extranet C-receivers that are allowed by policy\
    \ to\n   receive from VPN-S.\n   The rules of Section 4 regarding RTs and ambiguous\
    \ addresses still\n   apply.\n"
- title: 6.1.3.  PIM C-Instance Reverse Path Forwarding Determination
  contents:
  - "6.1.3.  PIM C-Instance Reverse Path Forwarding Determination\n   Suppose that\
    \ a PIM control message (call it \"M\") is received by a\n   given VRF (call it\
    \ \"VRF-V\") from a particular P-tunnel T.  In order\n   to process control message\
    \ M, the PIM C-instance associated with\n   VRF-V may need to do an \"RPF determination\"\
    \ (see Section 5.2.2 of\n   [RFC6513]) for a particular IP prefix S.  RPF determination\
    \ is based\n   upon the rules for UMH selection as specified in Section 5.1 of\n\
    \   [RFC6513].\n   This document specifies an additional constraint on the UMH\
    \ selection\n   procedure.  When doing RPF determination for a PIM control message\n\
    \   received over a P-tunnel, a route matching prefix S is not considered\n  \
    \ to be eligible for UMH selection unless there is an RT (call it\n   \"RT1\"\
    ), configured as one of VRF-V's Outgoing Extranet RTs, such that\n   the following\
    \ two conditions both hold:\n   1.  The route matching S is exported from VRF-V\
    \ carrying RT1, and\n   2.  An I-PMSI A-D route advertising P-tunnel T (in its\
    \ PTA) has been\n       imported into VRF-V, and that I-PMSI A-D route carries\
    \ RT1.\n"
- title: 6.2.  "Single PMSI per C-Flow" Model
  contents:
  - "6.2.  \"Single PMSI per C-Flow\" Model\n   In this model, if a VPN-S VRF has\
    \ extranet multicast C-sources and a\n   VPN-R VRF has extranet multicast C-receivers\
    \ allowed by policy to\n   receive from the C-sources in the VPN-S VRF, then the\
    \ VPN-R VRF joins\n   the MI-PMSI that VPN-S uses for its non-extranet traffic.\n"
- title: 6.2.1.  Forming the MI-PMSIs
  contents:
  - "6.2.1.  Forming the MI-PMSIs\n   Consider a VPN-S VRF that has extranet C-sources.\
    \  Per [RFC6513],\n   each VPN-S VRF must originate an Intra-AS I-PMSI A-D route\
    \ containing\n   a PTA specifying the P-tunnel to be used as part of the VPN-S\n\
    \   MI-PMSI.  In the absence of extranet service, this route carries the\n   VRF's\
    \ non-extranet RT, RT-S.  When extranet service is provided\n   (using the \"\
    single PMSI per C-flow\" model), this route MUST also\n   carry each of the VRF's\
    \ Outgoing Extranet RTs.\n   Consider a VPN-R VRF that has extranet C-receivers.\
    \  Per [RFC6513],\n   each VPN-R VRF must originate an Intra-AS I-PMSI A-D route\
    \ containing\n   a PTA specifying the P-tunnel to be used as part of the VPN-R\n\
    \   MI-PMSI.  This route carries the VRF's non-extranet RT, RT-R.  When\n   extranet\
    \ service is provided (using the \"single PMSI per C-flow\"\n   model), the VPN-R\
    \ VRF MUST also originate one or more additional\n   Intra-AS I-PMSI A-D routes.\
    \  It MUST originate one additional\n   Intra-AS I-PMSI A-D route for each Incoming\
    \ Extranet RT with which it\n   has been configured; each such route will carry\
    \ exactly one of the\n   configured Incoming Extranet RTs.\n   Note that when\
    \ a VRF originates more than one Intra-AS I-PMSI A-D\n   route, each of them MUST\
    \ contain a different RD in its NLRI.  In\n   addition, we add the requirement\
    \ that any pair of such routes\n   MUST NOT contain an RT in common.\n   A VRF\
    \ with extranet C-sources MUST join the P-tunnels advertised in\n   the imported\
    \ I-PMSI A-D routes that carry its non-extranet RT or any\n   of its Outgoing\
    \ Extranet RTs.  This set of P-tunnels will be treated\n   as instantiating a\
    \ single MI-PMSI; the associated PIM C-instance will\n   treat that MI-PMSI as\
    \ a single LAN and will run PIM procedures on\n   that LAN, as specified in [RFC6513].\
    \  The fact that the MI-PMSI\n   attaches to VRFs of different VPNs is not known\
    \ to the PIM C-instance\n   of the VRF containing the sources.\n   A VRF with\
    \ extranet C-receivers MUST join the P-tunnels advertised in\n   all the imported\
    \ I-PMSI A-D routes.  The set of P-tunnels advertised\n   in the I-PMSI A-D routes\
    \ that carry a particular Incoming Extranet RT\n   are treated as instantiating\
    \ a particular MI-PMSI.  So, a VRF with\n   C-receivers will \"see\" several MI-PMSIs,\
    \ one corresponding to the\n   non-extranet, and as many as one for each configured\
    \ Incoming\n   Extranet RT.  The PIM C-instance associated with the VRF will treat\n\
    \   each of these MI-PMSIs as a separate LAN interface.\n   As an example, suppose\
    \ that:\n   o  All VPN-R VRFs are configured with RT-R as a non-extranet import\n\
    \      and export RT, and\n   o  VPN-R VRFs with extranet receivers are configured\
    \ with RT-S-to-R\n      as an Incoming Extranet RT, and\n   o  VPN-S VRFs with\
    \ extranet transmitters are configured with:\n      *  RT-S as a non-extranet\
    \ import and export RT\n      *  a list of IP addresses that are the addresses\
    \ of the extranet\n         sources\n      *  RT-S-to-R as an Outgoing Extranet\
    \ RT\n   VPN-S VRFs will then export UMH-eligible routes matching extranet\n \
    \  C-sources, and these routes will carry both RT-S and RT-S-to-R.  Each\n   VPN-S\
    \ VRF will also export an Intra-AS I-PMSI A-D route that carries\n   both RT-S\
    \ and RT-S-to-R.\n   VPN-R VRFs will originate and export two Intra-AS I-PMSI\
    \ A-D routes:\n   one carrying RT-R and one carrying RT-S-to-R.  The Intra-AS\
    \ I-PMSI\n   A-D route with RT-S-to-R will be imported into the VPN-S VRFs.\n\
    \   VPN-R will regard all the I-PMSI A-D routes it has exported or\n   imported\
    \ with RT-S-to-R as part of a single MI-PMSI.  VPN-R will\n   regard all the I-PMSI\
    \ A-D routes it has exported or imported with\n   RT-R as part of a second MI-PMSI.\
    \  The PIM C-instance associated with\n   a VPN-R VRF will treat the two MI-PMSIs\
    \ as two separate LAN\n   interfaces.  However, the VPN-S VRFs will regard all\
    \ the I-PMSI A-D\n   routes imported with RT-S or RT-S-to-R as establishing only\
    \ a single\n   MI-PMSI.  One can think of this as follows: the VPN-R VRFs have\n\
    \   joined the VPN-S MI-PMSI as well as the VPN-R MI-PMSI.\n   Extranets consisting\
    \ of more than two VPNs are easily supported as\n   follows.  Suppose that there\
    \ are three VPNs: VPN-A, VPN-B, and VPN-C.\n   VPN-A and VPN-B have extranet C-sources,\
    \ and VPN-C contains receivers\n   for both VPN-A extranet C-sources and VPN-B\
    \ extranet C-sources.  In\n   this case, the VPN-C VRFs that have receivers for\
    \ both VPN-A and\n   VPN-B sources may be provisioned as follows.  These VPN-C\
    \ VRFs may be\n   provisioned with RT-C as a non-extranet RT, and with RT-A-to-C\
    \ and\n   RT-B-to-C as Incoming Extranet RTs.  In this case, the VPN-C VRFs\n\
    \   that are so provisioned will originate three Intra-AS I-PMSI A-D\n   routes\
    \ (each with a different RD in its NLRI), each of which carries\n   exactly one\
    \ of the three RTs just mentioned.  The VPN-B VRFs with\n   extranet C-sources\
    \ will be provisioned with RT-B-to-C as an Outgoing\n   Extranet RT, and the VPN-A\
    \ VRFs will be provisioned with RT-A-to-C as\n   an Outgoing Extranet RT.  The\
    \ result will be that the PIM C-instance\n   associated with a VPN-C VRF will\
    \ see three LAN interfaces: one for\n   the non-extranet and one for each of the\
    \ two extranets.  This\n   generalizes easily to the case where there are VPN-C\
    \ receivers in\n   n different extranets (i.e., receiving extranet flows whose\
    \ sources\n   are in n different VPNs).\n   Suppose again that there are three\
    \ VPNs -- VPN-A, VPN-B, and VPN-C --\n   but in this example VPN-A is the only\
    \ one with extranet sources while\n   VPN-B and VPN-C both have receivers for\
    \ the VPN-A extranet sources.\n   This can be provisioned as either one extranet\
    \ or two extranets.\n   To provision it as one extranet, the VPN-A VRFs are configured\
    \ with\n   one Outgoing Extranet RT (call it \"RT-A-extranet\").  The VPN-B and\n\
    \   VPN-C VRFs with extranet receivers will be provisioned with\n   RT-A-extranet\
    \ as the Incoming Extranet RT.  Thus, the VPN-B and VPN-C\n   VRFs will each originate\
    \ two Intra-AS I-PMSI A-D routes: one for the\n   non-extranet and one for the\
    \ extranet.  From a given VRF, the\n   Intra-AS I-PMSI A-D route for the extranet\
    \ will carry RT-A-extranet\n   but will not share any RT with the non-extranet\
    \ A-D routes exported\n   from the same VRF.\n   The result is that the VPN-B\
    \ and VPN-C VRFs each belong to two\n   MI-PMSIs: one for the extranet and one\
    \ for the intranet.  The MI-PMSI\n   for the extranet attaches VPN-A VRFs, VPN-B\
    \ VRFs, and VPN-C VRFs.\n   Alternatively, one could provision the VPN-A VRFs\
    \ so that some\n   UMH-eligible extranet source routes carry an RT that we will\
    \ call\n   \"RT-A-to-B\" and some carry an RT that we will call \"RT-A-to-C\"\
    .  The\n   VPN-A VRFs would be configured with both of these as Outgoing\n   Extranet\
    \ RTs.  To allow an extranet flow from a VPN-A source to have\n   both VPN-B and\
    \ VPN-C receivers, the UMH-eligible route for that\n   source would carry both\
    \ RTs.  VPN-B VRFs (but not VPN-C VRFs) would\n   be provisioned with RT-A-to-B\
    \ as an Incoming Extranet RT.  VPN-C VRFs\n   (but not VPN-B VRFs) would be provisioned\
    \ with RT-A-to-C as an\n   Incoming Extranet RT.\n   Following the rules above,\
    \ if any VPN-A extranet source is to have\n   both VPN-B and VPN-C receivers,\
    \ the VPN-B and VPN-C VRFs will each\n   originate two I-PMSI A-D routes: one\
    \ for the extranet and one for the\n   non-extranet.  The single Intra-AS I-PMSI\
    \ A-D route originated by the\n   VPN-A VRFs will have both RT-A-to-B and RT-A-to-C\
    \ among its RTs (as\n   well as VPN-A's non-extranet RT).  The extranet I-PMSI\
    \ A-D route\n   originated from a VPN-B VRF would have RT-A-to-B, and the extranet\n\
    \   I-PMSI A-D route originated from a VPN-C VRF would have RT-A-to-C.\n   If\
    \ a given VRF contains both extranet C-receivers and extranet\n   C-sources, the\
    \ procedures described above still work, as the VRF will\n   be configured with\
    \ both Incoming Extranet RTs and Outgoing Extranet\n   RTs; the VRF functions\
    \ as both a VPN-S VRF and a VPN-R VRF.\n"
- title: 6.2.2.  S-PMSIs
  contents:
  - "6.2.2.  S-PMSIs\n   When PIM is used as the PE-PE C-multicast control plane,\
    \ every S-PMSI\n   is considered to be part of the \"emulated LAN\" that \"corresponds\"\
    \ to\n   a particular MI-PMSI.\n   When the bindings of C-flows to particular\
    \ S-PMSIs are announced via\n   S-PMSI Join messages (Section 7 of [RFC6513])\
    \ sent on the MI-PMSI,\n   the S-PMSI is considered to be part of the same LAN\
    \ interface as the\n   corresponding MI-PMSI.\n   When the bindings of C-flows\
    \ to particular S-PMSIs are announced via\n   S-PMSI A-D routes, any S-PMSI A-D\
    \ route exported from that VRF MUST\n   have an RT in common with exactly one\
    \ of the Intra-AS A-D routes\n   exported from that VRF, and this MUST be one\
    \ of the VRF's Outgoing\n   Extranet RTs.  Further, the S-PMSI A-D route MUST\
    \ NOT have an RT in\n   common with any other Intra-AS A-D route exported from\
    \ a VRF on the\n   same PE.  A given S-PMSI A-D route will be considered to \"\
    correspond\"\n   to the MI-PMSI of the Intra-AS I-PMSI A-D route (originated from\
    \ the\n   same PE) with which it shares an RT.\n   The MI-PMSI that corresponds\
    \ to a given S-PMSI is determined as\n   follows:\n   o  If (1) there is an Intra-AS\
    \ I-PMSI A-D route originated by the\n      same PE that originated the S-PMSI\
    \ A-D route, (2) those two routes\n      have an RT in common, and (3) that RT\
    \ is one of the VRF's Incoming\n      Extranet RTs, then the S-PMSI corresponds\
    \ to the I-PMSI associated\n      with that Intra-AS I-PMSI A-D route.\n   o \
    \ Otherwise, if (1) there is an Inter-AS I-PMSI A-D route originated\n      in\
    \ the same AS as the S-PMSI A-D route, (2) those two routes have\n      an RT\
    \ in common, and (3) that RT is one of the VRF's Incoming\n      Extranet RTs,\
    \ then the S-PMSI corresponds to the I-PMSI associated\n      with that Inter-AS\
    \ I-PMSI A-D route.\n   o  Otherwise, there must be a configuration error (a violation\
    \ of the\n      requirements of Sections 3, 4, and 5 of this document).\n   When\
    \ wildcard S-PMSIs are used, the rules given in [RFC6625] for\n   determining\
    \ whether a given S-PMSI A-D route is a \"match for\n   reception\" to a given\
    \ (C-S,C-G) or (C-*,C-G) are modified as follows:\n      A given S-PMSI A-D route\
    \ MUST NOT be considered to be a \"match for\n      reception\" for a given (C-S,C-G)\
    \ or (C-*,C-G) state UNLESS that\n      S-PMSI A-D route \"corresponds\" (as defined\
    \ above) to the MI-PMSI\n      that is the incoming interface for the given state.\n\
    \   The rules given in [RFC6625] for determining whether a given S-PMSI\n   A-D\
    \ route is a \"match for transmission\" are unchanged.\n"
- title: 6.2.3.  Sending PIM Control Packets
  contents:
  - "6.2.3.  Sending PIM Control Packets\n   Suppose that a PE, say PE1, receives\
    \ a PIM Join(S,G) from a CE, over\n   a VRF interface that is associated with\
    \ a VPN-R VRF.  The PE does the\n   RPF check for S by looking up S in the VPN-R\
    \ VRF.  The PIM C-instance\n   associated with that VRF must determine the correct\
    \ P-tunnel over\n   which to send a PIM Join(S,G) to other PEs.\n   To do this,\
    \ PE1 finds, in the VRF associated with the interface over\n   which the Join\
    \ was received, the selected UMH route for S, following\n   the procedures of\
    \ Section 5.1 of [RFC6513].  PE1 determines the set\n   of RTs carried by that\
    \ route.  PE1 then checks to see if there is an\n   Intra-AS I-PMSI A-D route,\
    \ currently originated by PE1, that has an\n   RT in common with the selected\
    \ UMH route for S.\n   If the rules of Sections 3, 4, and 5 have been followed,\
    \ each of\n   PE1's selected UMH routes will share an RT with a single one of\
    \ PE1's\n   currently originated Intra-AS I-PMSI A-D routes.  If this is so, the\n\
    \   Join is sent on the P-tunnel advertised in the PTA of that route.\n   Otherwise,\
    \ the Join MUST NOT be sent.\n   In essence, this procedure makes the RPF check\
    \ for C-S resolve to the\n   MI-PMSI that is serving as the next-hop \"interface\"\
    \ to C-S.\n   If a PE receives a PIM Join(*,G) from a CE, the procedure for doing\n\
    \   the RPF check is the same, except that the selected UMH route will be\n  \
    \ a route to the C-RP associated with the C-G group.\n"
- title: 6.2.4.  Receiving PIM Control Packets
  contents:
  - "6.2.4.  Receiving PIM Control Packets\n   When a PIM C-instance receives a PIM\
    \ control message from a P-tunnel,\n   it needs to identify the message's incoming\
    \ interface.  This incoming\n   interface is the MI-PMSI of which the P-tunnel\
    \ is a part.\n"
- title: 6.2.5.  Sending and Receiving Data Packets
  contents:
  - "6.2.5.  Sending and Receiving Data Packets\n   The rules for choosing the PMSI\
    \ on which to send a multicast data\n   packet are as specified in [RFC6513] and\
    \ [RFC6625], with one new\n   restriction: a VPN-S VRF always transmits a multicast\
    \ data packet\n   either on the VPN-S MI-PMSI or on an S-PMSI that corresponds\
    \ to the\n   VPN-S MI-PMSI.  From the perspective of the PIM C-instance, there\
    \ is\n   only one outgoing interface.\n   When a PIM C-instance receives a multicast\
    \ data packet from a given\n   P-tunnel and that P-tunnel is being used to instantiate\
    \ an MI-PMSI,\n   the MI-PMSI of which the P-tunnel is a part (see Sections 6.2.1\
    \ and\n   6.2.2) is considered to be the packet's incoming interface.  If the\n\
    \   packet is received on a P-tunnel that was advertised in an S-PMSI A-D\n  \
    \ route, the packet's incoming interface is the MI-PMSI to which that\n   S-PMSI\
    \ route corresponds, as defined in Section 6.2.2.  Ordinary PIM\n   rules for\
    \ data-plane RPF checks apply.\n   Following ordinary PIM procedures, packets\
    \ arriving from an\n   unexpected incoming interface are discarded.  This eliminates\
    \ any\n   problems due to the ambiguities described in Sections 2.1 and 2.2.\n"
- title: 6.3.  "Multiple PMSIs per C-Flow" Model
  contents:
  - "6.3.  \"Multiple PMSIs per C-Flow\" Model\n   In this model, if a VPN-S VRF has\
    \ extranet multicast C-sources and a\n   VPN-R VRF has extranet multicast C-receivers\
    \ allowed by policy to\n   receive from the C-sources in the VPN-S VRF, then the\
    \ VPN-S VRF joins\n   the MI-PMSI that VPN-R uses for its non-extranet traffic.\n\
    \   In the \"single PMSI per C-flow\" transmission model (as described in\n  \
    \ Section 6.2), a PE that needs to transmit a multicast data packet to\n   a set\
    \ of other PEs transmits the packet on a single PMSI.  This means\n   that if\
    \ a packet needs to be transmitted from a VPN-A VRF and\n   received at a VPN-B\
    \ VRF and a VPN-C VRF, there must be some P-tunnel\n   from which the VPN-B and\
    \ VPN-C VRFs can both receive packets.\n   In the \"multiple PMSIs per C-flow\"\
    \ transmission model, a PE that\n   needs to transmit a multicast data packet\
    \ to a set of other PEs may\n   transmit the packet on several different PMSIs.\
    \  (Of course, any\n   given packet is transmitted only once on a given P-tunnel.)\
    \  For\n   example, if a C-flow (C-S,C-G) has a VPN-A C-source, a VPN-B\n   receiver,\
    \ and a VPN-C receiver, there could be one PMSI that the\n   VPN-A VRF uses to\
    \ transmit the packet to the VPN-B VRFs and\n   another PMSI that the VPN-A VRF\
    \ uses to transmit the packet to the\n   VPN-C VRFs.\n"
- title: 6.3.1.  Forming the MI-PMSIs
  contents:
  - "6.3.1.  Forming the MI-PMSIs\n   Consider a VPN-R VRF that has extranet C-receivers.\
    \  Per [RFC6513],\n   each VPN-R VRF must originate an Intra-AS I-PMSI A-D route\
    \ containing\n   a PTA specifying the P-tunnel to be used as part of the VPN-R\n\
    \   MI-PMSI.  In the absence of extranet service, this route carries the\n   VRF's\
    \ non-extranet RT, RT-R.  When extranet service is provided\n   (using the \"\
    single PMSI per C-flow\" model), this route MUST also\n   carry each of the VRF's\
    \ Incoming Extranet RTs.\n   Consider a VPN-S VRF that has extranet C-sources.\
    \  Per [RFC6513],\n   each VPN-S VRF must originate an Intra-AS I-PMSI A-D route\
    \ containing\n   a PTA specifying the P-tunnel to be used as part of the VPN-S\n\
    \   MI-PMSI.  This route carries the VRF's non-extranet RT, RT-S.  When\n   extranet\
    \ service is provided using the \"multiple PMSIs per C-flow\"\n   model, the VPN-S\
    \ VRF MUST also originate one or more additional\n   Intra-AS I-PMSI A-D routes.\
    \  It MUST originate one additional\n   Intra-AS I-PMSI A-D route for each Outgoing\
    \ Extranet RT with which it\n   has been configured; each such route will have\
    \ a distinct RD and will\n   carry exactly one of the configured Outgoing Extranet\
    \ RTs.\n   As with the \"single PMSI per C-flow\" transmission model, VRFs\n \
    \  containing extranet C-receivers need to import UMH-eligible extranet\n   C-source\
    \ routes from VRFs containing C-sources.  This is ensured by\n   the rules of\
    \ Sections 3, 4, and 5.\n   However, in the \"multiple PMSIs per C-flow\" model,\
    \ a VRF containing\n   only C-receivers originates only a single Intra-AS I-PMSI\
    \ A-D route\n   carrying the non-extranet RT and all the Incoming Extranet RTs.\n\
    \   When a VRF containing C-receivers imports Intra-AS I-PMSI A-D routes\n   that\
    \ carry the non-extranet RT or one of the Incoming Extranet RTs,\n   the P-tunnels\
    \ specified in the PTA of all such routes are considered\n   to be part of the\
    \ same MI-PMSI.  That is, the associated PIM\n   C-instance will treat them as\
    \ part of a single interface.\n   In this model, it is the VRF containing extranet\
    \ C-sources that MUST\n   originate multiple Intra-AS I-PMSI A-D routes.  Each\
    \ such route MUST\n   have a distinct RD, and the set of RTs carried by any one\
    \ of these\n   routes MUST be disjoint from the set carried by any other.  There\n\
    \   MUST be one such route for each of the VRF's Outgoing Extranet RTs,\n   and\
    \ each such route MUST carry exactly one of the VRF's Outgoing\n   Extranet RTs.\
    \  The VRFs containing extranet C-sources MUST also\n   import all the A-D routes\
    \ originated by the VRFs containing extranet\n   C-receivers.  If a set of originated\
    \ and/or imported Intra-AS I-PMSI\n   A-D routes have an RT in common and that\
    \ RT is one of the VRF's\n   Outgoing Export RTs, then those routes are considered\
    \ to be \"about\"\n   the same MI-PMSI.  The PIM C-instance of the VRF treats\
    \ each MI-PMSI\n   as a LAN interface.\n   In effect, if VPN-S has only extranet\
    \ C-sources and VPN-R has only\n   extranet C-receivers, this model has the VPN-S\
    \ VRFs join the VPN-R\n   MI-PMSI.  The VPN-S VRFs will thus be attached to multiple\
    \ MI-PMSIs,\n   while the VPN-R VRFs are attached to only one.  The fact that\
    \ the\n   VPN-R MI-PMSI is attached to VPN-S VRFs is not known to the PIM\n  \
    \ C-instance at the VPN-R VRFs.\n   If a VPN-A VRF has extranet C-sources allowed\
    \ to send to C-receivers\n   in a VPN-B VRF and the VPN-B VRF has C-sources allowed\
    \ to send to\n   C-receivers in the VPN-A VRF, the above procedures still work\
    \ as\n   specified.\n   Following normal PIM procedures, when the PIM C-instance\
    \ at a VRF\n   with extranet C-sources receives a Join(C-S,C-G) or a Join(C-*,C-G)\n\
    \   over an MI-PMSI, it may create (C-S,C-G) or (C-*,C-G) state, and the\n   MI-PMSI\
    \ over which the Join was received may be added to the set of\n   outgoing interfaces\
    \ for that multicast state.  If n MI-PMSIs are\n   added to the outgoing interface\
    \ list for a particular multicast\n   state, a multicast data packet may need\
    \ to be replicated n times and\n   transmitted once on each of the n MI-PMSIs.\n\
    \   Since all of the multicast data packets received from another PE are\n   received\
    \ over a single emulated LAN, it is not necessary to have any\n   special procedures\
    \ to determine a packet's incoming interface.  The\n   ambiguities described in\
    \ Sections 2.1 and 2.2 do not occur, because a\n   VPN-R VRF can only receive\
    \ multicast data traffic that has been\n   requested by a VPN-R VRF.\n"
- title: 7.  When BGP Is the PE-PE C-Multicast Control Plane
  contents:
  - "7.  When BGP Is the PE-PE C-Multicast Control Plane\n   This document assumes\
    \ that if BGP is used as the PE-PE C-multicast\n   control plane, the \"single\
    \ PMSI per C-flow\" model is used.\n   Procedures for providing the \"multiple\
    \ PMSIs per C-flow\" model with\n   BGP C-multicast are outside the scope of this\
    \ document.\n   When BGP is used as the C-multicast control plane, the \"single\
    \ PMSI\n   per C-flow\" model may be used either with or without extranet\n  \
    \ separation.  (Recall that \"extranet separation\" means that no\n   P-tunnel\
    \ can carry traffic from both extranet sources and\n   non-extranet sources.)\
    \  In either case, the data traffic may be\n   carried on Inclusive Tunnels only,\
    \ Selective Tunnels only (known as\n   the \"S-PMSI only\" model), or a combination\
    \ of Inclusive Tunnels and\n   Selective Tunnels.  This is determined by provisioning.\
    \  The\n   procedures specified below support all three choices.\n   Note that\
    \ there are no special extranet procedures for Inter-AS\n   I-PMSI A-D routes\
    \ or for Leaf A-D routes.\n"
- title: 7.1.  Originating C-Multicast Routes
  contents:
  - "7.1.  Originating C-Multicast Routes\n   This section applies whether extranet\
    \ separation is used or not.\n   When it is necessary to originate a C-multicast\
    \ Source Tree Join for\n   (C-S,C-G), a PE must follow the procedures of Section\
    \ 11.1.3\n   (\"Constructing the Rest of the C-Multicast Route\") of [RFC6514]\
    \ to\n   find the selected UMH route for C-S.  When it is necessary to\n   originate\
    \ a C-multicast Shared Tree Join for (C-*,C-G), where C-G is\n   an ASM group,\
    \ a PE must follow the procedures of that section to find\n   the selected UMH\
    \ route for C-G's C-RP.\n   Section 11.1.3 of [RFC6514] specifies how information\
    \ from the\n   selected UMH route is used to find an Intra-AS I-PMSI A-D route\
    \ or an\n   Inter-AS I-PMSI A-D route.  Information from that I-PMSI A-D route\
    \ is\n   then used to construct part of the C-multicast route.\n   For extranets,\
    \ the rules given in Section 7.4.5 of this document are\n   used to find the Inter-AS\
    \ I-PMSI A-D route or an Intra-AS I-PMSI A-D\n   route that \"corresponds\" to\
    \ the selected UMH route; the rules in\n   Section 7.4.5 replace the rules given\
    \ in Section 11.1.3 of [RFC6514]\n   for finding the Inter-AS or Intra-AS I-PMSI\
    \ A-D route.\n   Information from this I-PMSI A-D route is then used, as specified\
    \ in\n   Section 11.1.3 of [RFC6514], to construct the C-multicast route.\n"
- title: 7.2.  Originating A-D Routes without Extranet Separation
  contents:
  - '7.2.  Originating A-D Routes without Extranet Separation

    '
- title: 7.2.1.  Intra-AS I-PMSI A-D Routes
  contents:
  - "7.2.1.  Intra-AS I-PMSI A-D Routes\n   Consider a VRF (call it \"VRF-S\") that\
    \ contains extranet C-sources and\n   exports UMH-eligible routes matching those\
    \ C-sources.  The VRF may\n   also originate and export an Intra-AS I-PMSI A-D\
    \ route.\n   As specified in [RFC6514], if exactly one Intra-AS I-PMSI A-D route\n\
    \   is originated by and exported from VRF-S, the RTs carried by that\n   route\
    \ MUST be chosen such that every VRF that imports a UMH-eligible\n   route from\
    \ VRF-S also imports this Intra-AS I-PMSI A-D route.\n   If inclusive P-tunnels\
    \ are being used to carry extranet C-flows,\n   there are additional requirements\
    \ on the way the RTs carried by the\n   Intra-AS I-PMSI A-D routes must be chosen,\
    \ as specified in the\n   following paragraph.\n   If VRF-S is using inclusive\
    \ P-tunnels but is not using extranet\n   separation, there is one inclusive P-tunnel\
    \ rooted at VRF-S, and this\n   tunnel carries both extranet and non-extranet\
    \ C-flows.  This\n   Inclusive Tunnel is identified in the PTA of the Intra-AS\
    \ I-PMSI A-D\n   route originated from VRF-S.  The set of RTs carried by this\
    \ Intra-AS\n   I-PMSI A-D route MUST be chosen so as to ensure that every VRF\
    \ that\n   imports a UMH-eligible route from this VRF-S also imports this\n  \
    \ Intra-AS I-PMSI A-D route.  Further, the set of RTs carried by this\n   Intra-AS\
    \ I-PMSI A-D route MUST be chosen such that it has at least\n   one RT in common\
    \ with every UMH-eligible route that is exported from\n   the VRF.\n"
- title: 7.2.2.  S-PMSI A-D Routes
  contents:
  - "7.2.2.  S-PMSI A-D Routes\n   Let R-SP be an S-PMSI A-D route that is exported\
    \ from VRF-S.  Suppose\n   that R-SP is used to bind some or all of the extranet\
    \ C-flows from a\n   given extranet C-source to a given selective P-tunnel.  Let\
    \ R-UMH be\n   a UMH-eligible route that is exported from VRF-S and matches the\n\
    \   given extranet C-source.  In that case, R-SP and R-UMH MUST have at\n   least\
    \ one RT in common.  Further, the RTs carried by these two routes\n   MUST be\
    \ such that every VRF that imports R-UMH also imports R-SP.\n   These rules apply\
    \ whether or not R-SP uses wildcards [RFC6625].\n   An implementation MUST allow\
    \ the set of RTs carried by the S-PMSI A-D\n   routes to be specified by configuration.\
    \  In the absence of such\n   configuration, an S-PMSI A-D route originated by\
    \ a given VRF, say\n   VRF-X, MUST carry a default set of RTs, as specified by\
    \ the following\n   rules:\n   1.  By default, an S-PMSI A-D route originated\
    \ by VRF-X for a given\n       (C-S,C-G) or (C-S,C-*) carries the same RT(s) as\
    \ the UMH-eligible\n       route originated by VRF-X that matches C-S.\n   2.\
    \  By default, an S-PMSI A-D route originated by VRF-X for a given\n       (C-*,C-G)\
    \ carries as its RTs a set union of all RT(s) of the\n       UMH-eligible route(s)\
    \ matching the multicast C-sources contained\n       in VRF-X that could originate\
    \ traffic for that C-G.  Moreover, if\n       the VRF contains (as defined in\
    \ Section 1.1) the C-RP of C-G,\n       then this set union also includes the\
    \ RT(s) of the UMH-eligible\n       route matching C-RP and the RT(s) of the unicast\
    \ VPN-IP route\n       matching C-RP.\n   3.  By default, if a (C-*,C-*) S-PMSI\
    \ A-D route originated by VRF-X\n       is to be used for both extranet and non-extranet\
    \ traffic, it\n       carries the same RTs that would be carried (as specified\
    \ in\n       Section 7.2.1) by an I-PMSI A-D route originated by VRF-X if that\n\
    \       I-PMSI A-D route were advertising an inclusive P-tunnel for\n       carrying\
    \ both extranet and non-extranet traffic.  In general, a\n       given VRF would\
    \ not originate both (a) an S-PMSI A-D route\n       advertising a (C-*,C-*) selective\
    \ P-tunnel for both extranet and\n       non-extranet traffic and (b) an I-PMSI\
    \ A-D route advertising an\n       inclusive P-tunnel for both extranet and non-extranet\
    \ traffic, as\n       the inclusive P-tunnel would not get used in that case.\n"
- title: 7.2.3.  Source Active A-D Routes
  contents:
  - '7.2.3.  Source Active A-D Routes

    '
- title: 7.2.3.1.  When Inter-Site Shared Trees Are Used
  contents:
  - "7.2.3.1.  When Inter-Site Shared Trees Are Used\n   This section applies when\
    \ inter-site shared trees are used, as\n   specified in Section 13 of [RFC6514].\n\
    \   If VRF-S exports a Source Active A-D route that contains C-S in the\n   Multicast\
    \ Source field of its NLRI and VRF-S also exports a\n   UMH-eligible route matching\
    \ C-S, the Source Active A-D route MUST\n   carry at least one RT in common with\
    \ the UMH-eligible route.  The RT\n   MUST be chosen such that the following condition\
    \ holds: if a VRF, say\n   VRF-R, contains an extranet C-receiver allowed by policy\
    \ to receive\n   extranet traffic from C-S, then VRF-R imports both the UMH-eligible\n\
    \   route and the Source Active A-D route.\n   By default, a Source Active A-D\
    \ route for a given (C-S,C-G), exported\n   by a given VRF, carries the same set\
    \ of RTs as the UMH-eligible route\n   matching C-S that is exported from that\
    \ VRF.\n"
- title: 7.2.3.2.  When Inter-Site Shared Trees Are Not Used
  contents:
  - "7.2.3.2.  When Inter-Site Shared Trees Are Not Used\n   This section applies\
    \ when inter-site shared trees are not used, as\n   specified in Section 14 of\
    \ [RFC6514].\n   Suppose that a VRF, say VRF-X, contains the C-RP for a given\
    \ extranet\n   C-group, say C-G.  If C-S is an active source for C-G, then,\n\
    \   following the procedures of Section 14.1 of [RFC6514], VRF-X may\n   export\
    \ a Source Active A-D route that contains C-S in the Multicast\n   Source field\
    \ of its NLRI.  With the following text, this document\n   replaces the rule specified\
    \ in Section 14.1 of [RFC6514] for\n   constructing the RT(s) carried by such\
    \ a route: VRF-X MUST be\n   configured such that the Source Active A-D route\
    \ for (C-S,C-G)\n   carries the same set of RTs as the UMH-eligible route matching\
    \ C-S\n   that is exported from the VRF(s) containing C-S.  This way, if a VRF,\n\
    \   say VRF-R, contains an extranet C-receiver allowed by policy to\n   receive\
    \ extranet traffic from C-S, then VRF-R imports both the\n   UMH-eligible route\
    \ and the Source Active A-D route.\n"
- title: 7.3.  Originating A-D Routes with Extranet Separation
  contents:
  - "7.3.  Originating A-D Routes with Extranet Separation\n   If a VRF contains both\
    \ extranet C-sources and non-extranet C-sources,\n   it MUST be configured with\
    \ both a default RD and an extranet RD (see\n   Section 1.3).  The use of these\
    \ RDs is explained in the following\n   subsections.\n"
- title: 7.3.1.  Intra-AS I-PMSI A-D Routes
  contents:
  - "7.3.1.  Intra-AS I-PMSI A-D Routes\n   This section applies when VRF-S is using\
    \ extranet separation AND when\n   VRF-S is using an inclusive P-tunnel to carry\
    \ some or all of the\n   extranet C-flows that it needs to transmit to other VRFs.\n\
    \   If VRF-S contains both extranet C-sources and non-extranet C-sources,\n  \
    \ and inclusive P-tunnels are used to carry both extranet C-flows and\n   non-extranet\
    \ C-flows, then there MUST be two Inclusive Tunnels from\n   VRF-S, one of which\
    \ is to be used only to carry extranet C-flows (the\n   \"extranet inclusive P-tunnel\"\
    ) and one of which is to be used only to\n   carry non-extranet C-flows (the \"\
    non-extranet inclusive P-tunnel\").\n   In this case, the VRF MUST originate two\
    \ Intra-AS I-PMSI A-D routes.\n   Their respective NLRIs MUST of course have different\
    \ RDs.  One of the\n   Intra-AS I-PMSI A-D routes identifies the extranet inclusive\
    \ P-tunnel\n   in its PTA.  This route MUST have the VRF's extranet RD in its\
    \ NLRI.\n   The other route identifies the non-extranet inclusive P-tunnel in\
    \ its\n   PTA.  This route MUST have the VRF's default RD in its PTA.\n   If VRF-S\
    \ uses an inclusive P-tunnel for carrying extranet traffic but\n   does not use\
    \ an inclusive P-tunnel for carrying non-extranet traffic,\n   then of course\
    \ only a single Intra-AS I-PMSI A-D route need be\n   originated.  The PTA of\
    \ this route identifies the \"extranet inclusive\n   P-tunnel\".  The NLRI of\
    \ that route MUST contain the VRF's\n   extranet RD.\n   An Intra-AS I-PMSI A-D\
    \ route whose PTA identifies an extranet\n   inclusive P-tunnel MUST carry the\
    \ Extranet Separation Extended\n   Community defined in Section 4.5.\n   The RTs\
    \ carried by an Intra-AS I-PMSI A-D route whose PTA identifies\n   the \"extranet\
    \ inclusive P-tunnel\" MUST be chosen such that the\n   following condition holds:\
    \ if a VRF (call it \"VRF-R\") imports a\n   UMH-eligible route from VRF-S and\
    \ that route matches an extranet\n   C-source, then VRF-R also imports that Intra-AS\
    \ I-PMSI A-D route.\n   Note that when extranet separation is used, it is possible\
    \ to use an\n   inclusive P-tunnel for non-extranet traffic while using only\n\
    \   selective P-tunnels for extranet traffic.  It is also possible to use\n  \
    \ an inclusive P-tunnel for extranet traffic while using only selective\n   P-tunnels\
    \ for non-extranet traffic.\n"
- title: 7.3.2.  S-PMSI A-D Routes
  contents:
  - "7.3.2.  S-PMSI A-D Routes\n   Let R-SP be an S-PMSI A-D route that is exported\
    \ from VRF-S.  Suppose\n   that R-SP is used to bind some or all of the extranet\
    \ C-flows from a\n   given extranet C-source to a given selective P-tunnel.  Let\
    \ R-UMH be\n   a UMH-eligible route that is exported from VRF-S and matches the\n\
    \   given extranet C-source.  In that case, R-SP and R-UMH MUST have at\n   least\
    \ one RT in common.  Further, the RTs carried by these two routes\n   MUST be\
    \ such that every VRF that imports R-UMH also imports R-SP.\n   These rules apply\
    \ whether or not R-SP uses wildcards [RFC6625].\n   The following rules, specific\
    \ to the use of extranet separation,\n   apply:\n   o  A selective P-tunnel MUST\
    \ NOT carry C-flows from both extranet and\n      non-extranet C-sources.\n  \
    \ o  If it is desired to use a (C-*,C-*) S-PMSI to carry extranet\n      traffic\
    \ and also use a (C-*,C-*) S-PMSI to carry non-extranet\n      traffic, then two\
    \ (C-*,C-*) S-PMSI A-D routes MUST be originated.\n      These two routes MUST\
    \ have different RDs in their respective NLRI\n      fields, and their respective\
    \ PTAs MUST identify different\n      P-tunnels.  If the route advertises a P-tunnel\
    \ that carries only\n      non-extranet traffic, the route's NLRI MUST contain\
    \ the VRF's\n      default RD.  If the route advertises a P-tunnel that carries\
    \ only\n      extranet traffic, the route's NLRI MUST contain the VRF's\n    \
    \  extranet RD.\n   o  In the following cases, an S-PMSI A-D route exported from\
    \ the VRF\n      MUST have the VRF's extranet RD in its NLRI:\n      *  The S-PMSI\
    \ A-D route is a (C-S,C-G) or a (C-S,C-*) S-PMSI A-D\n         route, and C-S\
    \ is an extranet C-source.\n      *  The S-PMSI A-D route is a (C-*,C-G) S-PMSI\
    \ A-D route, and C-G\n         is an extranet C-group.\n      In all other cases,\
    \ a (C-S,C-G), (C-S,C-*), or (C-*,C-G) S-PMSI\n      A-D route MUST have the VRF's\
    \ default RD in its NLRI.\n   o  A (C-*,C-*) S-PMSI A-D route advertising a P-tunnel\
    \ that is used\n      to carry extranet traffic MUST carry the Extranet Separation\n\
    \      Extended Community defined in Section 4.5.\n   An implementation MUST allow\
    \ the set of RTs carried by the S-PMSI A-D\n   routes to be specified by configuration.\
    \  In the absence of such\n   configuration, an S-PMSI A-D route originated by\
    \ a given VRF, say\n   VRF-X, MUST carry a default set of RTs, as specified by\
    \ the following\n   rules:\n   1.  Rule 1 of Section 7.2.2 applies.\n   2.  By\
    \ default, if C-G is an extranet C-group, rule 2 of\n       Section 7.2.2 applies.\n\
    \   3.  By default, if a (C-*,C-*) S-PMSI A-D route originated by VRF-X\n    \
    \   is to be used for extranet traffic, it carries the same RTs that\n       would\
    \ be carried (as specified in Section 7.3.1) by an I-PMSI A-D\n       route originated\
    \ by VRF-X if that I-PMSI A-D route were\n       advertising an inclusive P-tunnel\
    \ for carrying extranet traffic.\n       In general, a given VRF would not originate\
    \ both an S-PMSI A-D\n       route advertising a (C-*,C-*) selective P-tunnel\
    \ for extranet\n       traffic and an I-PMSI A-D route advertising an inclusive\
    \ P-tunnel\n       for extranet traffic, as the inclusive P-tunnel would not get\n\
    \       used in that case.\n"
- title: 7.3.3.  Source Active A-D Routes
  contents:
  - "7.3.3.  Source Active A-D Routes\n   The procedures of Section 7.2.3 apply.\n\
    \   However, if a Source Active A-D route is exported from a given VRF\n   and\
    \ the route contains C-S, where C-S is an extranet C-source, then\n   the RD of\
    \ the route's NLRI MUST be the extranet RD of the VRF.\n   Otherwise, the RD is\
    \ the default RD of the VRF.\n"
- title: 7.4.  Determining the Expected P-Tunnel for a C-Flow
  contents:
  - "7.4.  Determining the Expected P-Tunnel for a C-Flow\n   This section applies\
    \ whether extranet separation is used or not.\n   In the context of a VRF with\
    \ receivers for a particular C-flow, a PE\n   must determine the P-tunnel over\
    \ which packets of that C-flow are\n   expected to arrive.  This is done by finding\
    \ an I-PMSI or S-PMSI A-D\n   route that \"matches\" the flow.  The matching A-D\
    \ route will contain a\n   PTA that specifies the P-tunnel being used to carry\
    \ the traffic of\n   that C-flow.  We will refer to this P-tunnel as the \"expected\n\
    \   P-tunnel\" for the C-flow.  (Note that, per [MVPN-IR], if the PTA\n   specifies\
    \ a tunnel of type \"Ingress Replication\" (IR), the identifier\n   of the P-tunnel\
    \ is actually the NLRI of the I-PMSI or S-PMSI A-D\n   route.  If the PTA specifies\
    \ a tunnel type other than IR, the\n   identifier of the P-tunnel is found in\
    \ the Tunnel Identifier field of\n   the PTA.)\n   A PE that needs to receive\
    \ a given (C-S,C-G) or (C-*,C-G) C-flow MUST\n   join the expected P-tunnel for\
    \ that C-flow, and the PE MUST remain\n   joined to the P-tunnel as long as (1)\
    \ the PE continues to need to\n   receive the given C-flow and (2) the P-tunnel\
    \ continues to remain the\n   expected P-tunnel for that C-flow.  Procedures for\
    \ joining and\n   leaving a tunnel depend, of course, on the tunnel type.\n  \
    \ If a PTA specifies a non-zero MPLS label for a tunnel that is not an\n   IR\
    \ tunnel, then the PE originating the A-D route containing that PTA\n   is advertising\
    \ an aggregate P-tunnel.  The aggregate P-tunnel can be\n   thought of as an outer\
    \ P-tunnel multiplexing some number of inner\n   P-tunnels.  The inner P-tunnels\
    \ are demultiplexed by means of the\n   MPLS label in the PTA.  In this document,\
    \ when we talk of the\n   \"expected P-tunnel\" in the context of an aggregate\
    \ P-tunnel, we refer\n   to a particular inner P-tunnel, not to the outer P-tunnel.\
    \  It is\n   this \"inner P-tunnel\" that is the expected P-tunnel for a given\n\
    \   C-flow.\n   In order to find the expected P-tunnel for a given C-flow, the\n\
    \   upstream PE of the C-flow is first determined.  Then, the S-PMSI A-D\n   routes\
    \ originated by that PE are examined, and their NLRIs compared\n   to the (C-S/C-RP,C-G)\
    \ of the flow, to see if there is a \"match for\n   reception\".  (If there is\
    \ no S-PMSI A-D route that matches a given\n   C-flow, the expected P-tunnel for\
    \ that C-flow may have been\n   advertised in an I-PMSI A-D route; see Section\
    \ 7.4.5.)\n   The rules for determining, in non-extranet cases, whether a given\n\
    \   C-flow is a \"match for reception\" for a given S-PMSI A-D route are\n   given\
    \ in Section 3.2 of [RFC6625].  Note that we use the terms\n   \"installed\" and\
    \ \"originated\" as they are defined in Section 3.2 of\n   [RFC6625].  (See also\
    \ Section 1.1 of this document.)\n   This specification provides additional rules\
    \ for determining whether\n   a given S-PMSI A-D route is a \"match for reception\"\
    \ for a given\n   (C-S/C-RP,C-G).  Note that these rules all assume the context\
    \ of a\n   particular VRF into which the A-D route has been imported.\n   The\
    \ rules given in [RFC6625] for determining whether a given S-PMSI\n   A-D route\
    \ is a \"match for transmission\" remain unchanged.\n   Suppose that a PE has\
    \ originated a C-multicast Shared Tree Join for\n   (C-*,C-G) but has not originated\
    \ a C-multicast Source Tree Join for\n   (C-S,C-G).  Suppose also that the PE\
    \ has received and installed a\n   Source Active A-D route for (C-S,C-G).  As\
    \ described in Section 13.2\n   of [RFC6514], the PE must receive the (C-S,C-G)\
    \ traffic from the\n   tunnel the originator of the installed Source Active A-D\
    \ route uses\n   for sending (C-S,C-G).\n   The originator of the installed Source\
    \ Active A-D route is determined\n   as follows:\n   1.  Look at the \"UMH Route\
    \ Candidate Set\" for C-S, as defined in\n       Section 5.1.3 of [RFC6513].\n\
    \   2.  From that set, select a subset of UMH routes to C-S, such that\n     \
    \  each route in the subset has at least one RT in common with the\n       Source\
    \ Active A-D route and at least one of the RTs in common is\n       an import\
    \ RT of the VRF.\n   3.  From that subset, find the route whose RD is the same\
    \ as the RD\n       from the NLRI of the Source Active A-D route.\n   4.  The\
    \ upstream PE is the PE identified in the VRF Route Import\n       Extended Community\
    \ of that route.\n   5.  The upstream AS is the AS identified in the Source AS\
    \ Extended\n       Community of that route.\n   If step 2 results in an empty\
    \ set or step 3 fails to find a route,\n   then the upstream PE of the Source\
    \ Active A-D route cannot be\n   determined, and it is necessary to act as if\
    \ the Source Active A-D\n   route had not been installed.  (A subsequent change\
    \ to the UMH Route\n   Candidate Set for C-S may require that a new attempt be\
    \ made to\n   determine the upstream PE.)\n   Once the upstream PE is determined,\
    \ the P-tunnel over which the flow\n   is expected is determined according to\
    \ the procedures already\n   described in this section.\n"
- title: 7.4.1.  (C-S,C-G) S-PMSI A-D Routes
  contents:
  - "7.4.1.  (C-S,C-G) S-PMSI A-D Routes\n   When extranet functionality is being\
    \ provided, an S-PMSI A-D route\n   whose NLRI contains (C-S,C-G) is NOT considered\
    \ to be a \"match for\n   reception\" for a given C-flow (C-S,C-G) unless one\
    \ of the following\n   conditions holds (in addition to the conditions specified\
    \ in\n   [RFC6625]):\n   o  the \"single C-source per (C-S,C-G) or (C-S,C-*) P-tunnel\"\
    \ is\n      provisioned, or\n   o  the selected UMH route for C-S has at least\
    \ one RT in common with\n      the S-PMSI A-D route, and at least one of the common\
    \ RTs is an\n      import RT of the VRF.\n"
- title: 7.4.2.  (C-S,C-*) S-PMSI A-D Routes
  contents:
  - "7.4.2.  (C-S,C-*) S-PMSI A-D Routes\n   When extranet functionality is being\
    \ provided, an S-PMSI A-D route\n   whose NLRI contains (C-S,C-*) is NOT considered\
    \ to be a \"match for\n   reception\" for a given C-flow (C-S,C-G) unless one\
    \ of the following\n   conditions holds (in addition to the conditions specified\
    \ in\n   [RFC6625]):\n   o  the \"single C-source per (C-S,C-G) or (C-S,C-*) P-tunnel\"\
    \ is\n      provisioned, or\n   o  the selected UMH route for C-S has at least\
    \ one RT in common with\n      the S-PMSI A-D route, and at least one of the common\
    \ RTs is an\n      import RT of the VRF.\n"
- title: 7.4.3.  (C-*,C-G) S-PMSI A-D Routes
  contents:
  - "7.4.3.  (C-*,C-G) S-PMSI A-D Routes\n   When extranet functionality is being\
    \ provided, an S-PMSI A-D route\n   whose NLRI contains (C-*,C-G) is NOT considered\
    \ to be a \"match for\n   reception\" for a given C-flow (C-S,C-G) in a given\
    \ VRF unless either\n   condition 1 or condition 2 below holds (in addition to\
    \ the conditions\n   specified in [RFC6625]):\n   1.  The given VRF has currently\
    \ originated a C-multicast Shared Tree\n       Join route for (C-*,C-G), and\n\
    \       a.  (C-*,C-G) matches an installed (C-*,C-G) S-PMSI A-D route\n      \
    \     (according to [RFC6625]) in the given VRF, and\n       b.  either\n    \
    \       i.     the \"single C-group per (C-*,C-G) P-tunnel\" policy has\n    \
    \              been provisioned, or\n           ii.    the RTs of that S-PMSI\
    \ A-D route form a non-empty\n                  intersection with the RTs carried\
    \ in the VRF's\n                  selected UMH route for C-RP of that C-G, or\n\
    \           iii.   installed in the VRF is at least one (C-S,C-G) Source\n   \
    \               Active A-D route that was originated by the same PE as\n     \
    \             the (C-*,C-G) S-PMSI A-D route.\n   2.  The given VRF does not have\
    \ a currently originated C-multicast\n       Shared Tree Join for (C-*,C-G), but\n\
    \       a.  there are one or more values for C-S for which the VRF has a\n   \
    \        currently originated Source Tree Join C-multicast route for\n       \
    \    (C-S,C-G), and\n       b.  the (C-* C-G) S-PMSI A-D route matches (according\
    \ to\n           [RFC6625]) each such (C-S,C-G), and\n       c.  either\n    \
    \       i.    the \"single C-group per (C-*,C-G) P-tunnel\" policy has\n     \
    \            been provisioned, or\n           ii.   the RTs of that S-PMSI A-D\
    \ route form a non-empty\n                 intersection with the RTs carried in\
    \ the VRF's selected\n                 UMH routes for each such C-S\n       If\
    \ a VRF has an installed (C-*,C-G) S-PMSI A-D route but does not\n       have\
    \ a (C-S,C-G) or (C-*,C-G) multicast state that matches that\n       route for\
    \ reception, the procedures of Section 12.3 (\"Receiving\n       S-PMSI A-D Routes\
    \ by PEs\") of [RFC6514] are not invoked for that\n       route.  If those multicast\
    \ states are created at some later time\n       when the route is still installed,\
    \ the procedures of Section 12.3\n       of [RFC6514] are invoked at that time.\n"
- title: 7.4.4.  (C-*,C-*) S-PMSI A-D Routes
  contents:
  - "7.4.4.  (C-*,C-*) S-PMSI A-D Routes\n   A (C-*,C-*) S-PMSI A-D route (call it\
    \ \"R-AD\") is NOT considered to be\n   a \"match for reception\" for a given\
    \ C-flow (C-S,C-G) or (C-*,C-G)\n   unless the following conditions hold (in addition\
    \ to the conditions\n   specified in [RFC6625]):\n   o  The selected UMH route\
    \ (call it \"R-UMH\") for C-S or for C-G's\n      C-RP, respectively, has at least\
    \ one RT in common with R-AD, and\n      at least one of the common RTs is an\
    \ import RT of the VRF.\n   o  Either R-AD and R-UMH both carry the Extranet Separation\
    \ Extended\n      Community or neither carries the Extranet Separation Extended\n\
    \      Community.\n"
- title: 7.4.5.  I-PMSI A-D Routes
  contents:
  - "7.4.5.  I-PMSI A-D Routes\n   If a particular egress VRF in a particular egress\
    \ PE contains no\n   matching S-PMSI A-D routes for a particular C-flow, then\
    \ the C-flow\n   is expected to arrive (at that egress VRF) on an inclusive P-tunnel.\n\
    \   Suppose that an egress PE has originated a (C-S,C-G) C-multicast\n   Source\
    \ Tree Join.  Let R-UMH be the selected UMH route (in the given\n   egress VRF)\
    \ for C-S.  As specified in [RFC6514], the selected\n   upstream PE for (C-S,C-G)\
    \ is determined from the VRF Route Import\n   Extended Community of R-UMH, and\
    \ the \"selected upstream AS\" for the\n   flow is determined from the Source\
    \ AS Extended Community of R-UMH.\n   Suppose that an egress PE has originated\
    \ a (C-*,C-G) C-multicast\n   Shared Tree Join but has not originated a (C-S,C-G)\
    \ C-multicast\n   Source Tree Join.  If the egress VRF does not have a (C-S,C-G)\
    \ Source\n   Active A-D route installed, the selected upstream PE is determined\n\
    \   from the VRF Route Import Extended Community of the installed\n   UMH-eligible\
    \ route matching C-RP, where C-RP is the RP for the group\n   C-G.  The selected\
    \ upstream AS for the flow is determined from the\n   Source AS Extended Community\
    \ of that route.  If the egress VRF does\n   have a (C-S,C-G) Source Active A-D\
    \ route installed, the selected\n   upstream PE and upstream AS are determined\
    \ as specified in\n   Section 7.4.  In either case, let R-UMH be the installed\
    \ UMH-eligible\n   route matching C-S.\n   The inclusive P-tunnel that is expected\
    \ to be carrying a particular\n   C-flow is found as follows:\n   o  If the selected\
    \ upstream AS is the local AS or segmented Inter-AS\n      P-tunnels are not being\
    \ used to instantiate I-PMSIs, then look in\n      the VRF for an installed Intra-AS\
    \ I-PMSI A-D route, R-AD, such\n      that (a) R-AD is originated by the selected\
    \ upstream PE, (b) R-AD\n      has at least one RT in common with R-UMH, (c) at\
    \ least one of the\n      common RTs is an import RT of the local VRF, and (d)\
    \ either R-AD\n      and R-UMH both carry the Extranet Separation Extended Community\
    \ or\n      neither carries the Extranet Separation Extended Community.\n    \
    \  The PTA of R-AD specifies the P-tunnel over which the traffic of\n      the\
    \ given C-flow is expected.\n   o  If the selected upstream AS is not the local\
    \ AS and segmented\n      Inter-AS P-tunnels are being used to instantiate I-PMSIs,\
    \ then\n      look in the VRF for an installed Inter-AS I-PMSI A-D route, R-AD,\n\
    \      such that (a) the Source AS field of R-AD's NLRI contains the AS\n    \
    \  number of the selected upstream AS, (b) R-AD has at least one RT\n      in\
    \ common with R-UMH, (c) at least one of the common RTs is an\n      import RT\
    \ of the local VRF, and (d) either R-AD and R-UMH both\n      carry the Extranet\
    \ Separation Extended Community or neither\n      carries the Extranet Separation\
    \ Extended Community.\n      The PTA of R-AD specifies the P-tunnel over which\
    \ the traffic of\n      the given C-flow is expected.\n"
- title: 7.5.  Packets Arriving from the Wrong P-Tunnel
  contents:
  - "7.5.  Packets Arriving from the Wrong P-Tunnel\n   Any packets that arrive on\
    \ a P-tunnel other than the expected\n   P-tunnel (as defined in Section 7.4)\
    \ MUST be discarded unless it is\n   known that all the packets carried by both\
    \ P-tunnels are from the\n   same ingress VRF.  (See Section 2.3.1 for a more\
    \ detailed discussion\n   of when to discard packets from other than the expected\
    \ P-tunnel.)\n   Note that packets arriving on the wrong P-tunnel are to be discarded\n\
    \   even if they are arriving from the expected PE.\n"
- title: 8.  Multiple Extranet VRFs on the Same PE
  contents:
  - "8.  Multiple Extranet VRFs on the Same PE\n   When multiple VRFs that contain\
    \ extranet receivers for a given\n   extranet source are present on the same PE,\
    \ this PE becomes a single\n   leaf of the P-tunnel used for sending (multicast)\
    \ traffic from that\n   source to these extranet receivers.  The PE MUST be able\
    \ to replicate\n   this traffic to the multiple VRFs.  Specific procedures for\
    \ doing so\n   are local to the PE and are outside the scope of this document.\n\
    \   Two or more VRFs on the same PE may import the same S-PMSI A-D route.\n  \
    \ If this S-PMSI A-D route contains a PTA that has its \"Leaf\n   Information\
    \ Required\" flag set, it may be necessary for the PE to\n   originate a Leaf\
    \ A-D route whose NLRI is computed from the NLRI of\n   the S-PMSI A-D route.\
    \  (Details are provided in [RFC6514].)  Note\n   that for a given S-PMSI A-D\
    \ route, the PE can originate only one\n   corresponding Leaf A-D route, even\
    \ if the S-PMSI A-D route is\n   imported into multiple VRFs.  This Leaf A-D route\
    \ can thus be thought\n   of as originating from several VRFs.  It MUST NOT be\
    \ withdrawn by the\n   PE until there are no longer any VRFs originating it.\n\
    \   [RFC6514] specifies conditions under which a PE originates a\n   C-multicast\
    \ Source Tree Join or a C-multicast Shared Tree Join, based\n   on the (*,G) and\
    \ (S,G) states associated with a given VRF.  It also\n   specifies the procedure\
    \ for computing the NLRI of each such route.\n   While a given PE may contain\
    \ two or more VRFs that have (extranet)\n   receivers for the same extranet C-flow,\
    \ the PE cannot originate more\n   than one BGP route with a given NLRI.  If there\
    \ are multiple VRFs,\n   each of which has state that is sufficient to cause a\
    \ given\n   C-multicast route to be originated, the route can be thought of as\n\
    \   originating from several VRFs.  It MUST NOT be withdrawn by the PE\n   until\
    \ there is no longer any VRF with multicast state sufficient to\n   cause the\
    \ route to be originated.\n   For a given extranet, the site(s) that contains\
    \ the extranet\n   source(s) and the site(s) that contains the extranet receiver(s)\
    \ may\n   be connected to the same PE.  In this scenario, the procedures by\n\
    \   which (multicast) traffic from these sources is delivered to these\n   receivers\
    \ are local to the PE and are outside the scope of this\n   document.\n   An implementation\
    \ MUST support multiple extranet VRFs on a PE.\n"
- title: 9.  IANA Considerations
  contents:
  - "9.  IANA Considerations\n   IANA has allocated two new codepoints from the \"\
    First Come First\n   Served\" [RFC5226] range of the \"Transitive Opaque Extended\
    \ Community\n   Sub-Types\" registry (under the top-level registry \"Border Gateway\n\
    \   Protocol (BGP) Extended Communities\" registry).\n   o  Extranet Source Extended\
    \ Community (0x04)\n   o  Extranet Separation Extended Community (0x05)\n"
- title: 10.  Security Considerations
  contents:
  - "10.  Security Considerations\n   The security considerations of [RFC6513] and\
    \ [RFC6514] are\n   applicable.\n   As is the case with any application of technology\
    \ based upon\n   [RFC4364], misconfiguration of the RTs may result in VPN security\n\
    \   violations (i.e., may result in a packet being delivered to a VPN\n   where,\
    \ according to policy, it is not supposed to go).\n   In those cases where the\
    \ set of extranet sources of a particular VRF\n   are manually configured, improper\
    \ configuration of the VRF can result\n   in VPN security violations -- traffic\
    \ from a host that is not an\n   extranet source may be treated as if it were\
    \ traffic from an extranet\n   source.\n   Section 4.4 specifies the optional\
    \ use of a new Extended Community --\n   the Extranet Source Extended Community.\
    \  Security considerations\n   regarding the use and distribution of that Extended\
    \ Community are\n   discussed in that section.\n   The procedures of this document\
    \ do not provide encryption of the data\n   flows that are sent across the SP\
    \ backbone network.  Hence, these\n   procedures do not by themselves ensure the\
    \ privacy or integrity of\n   the data against attacks on the backbone network.\n\
    \   In general, different VPNs are allowed to have overlapping IP address\n  \
    \ spaces; i.e., a host in one VPN may have the same IP address as a\n   host in\
    \ another.  This is safe because the customer routes from a\n   given VPN do not\
    \ pass into other VPNs.  Even if there are overlapping\n   address spaces among\
    \ VPNs, the routes that are known at any given VPN\n   site are unambiguous, as\
    \ long as the address space of that VPN is\n   unambiguous.  However, this is\
    \ not necessarily true when extranet\n   service is provided.  If an extranet\
    \ C-receiver in VPN-R is to be\n   able to receive multicast traffic from an extranet\
    \ C-source in VPN-S,\n   then the address of the VPN-S extranet C-source must\
    \ be imported into\n   one or more VPN-R VRFs.  If that address is also the address\
    \ of a\n   VPN-R non-extranet C-source, then a system attempting to receive an\n\
    \   extranet C-flow from the VPN-R extranet C-source may instead receive\n   a\
    \ non-extranet C-flow from the VPN-S C-source.  Otherwise, a VPN\n   security\
    \ violation may result.\n   That is, when provisioning an extranet between two\
    \ VPNs that have\n   overlapping address spaces, one must ensure that the IP addresses\
    \ of\n   the extranet sources and the extranet receivers are not from the\n  \
    \ overlapping part of the address space.  This document specifies that\n   if\
    \ a route is imported into a given VRF, all addresses that match\n   that route\
    \ must be unambiguous in the context of that VRF.  Improper\n   provisioning of\
    \ the extranet source addresses or improper\n   provisioning of the RTs may cause\
    \ this rule to be violated and may\n   result in a VPN security violation.\n \
    \  It is possible that a given multicast C-source is the source of\n   multiple\
    \ flows, some of which are intended to be extranet C-flows and\n   some of which\
    \ are intended to be non-extranet flows.  However, the\n   procedures of this\
    \ document will allow any C-receiver that is able to\n   receive the extranet\
    \ C-flows from a given C-source to also receive\n   the non-extranet C-flows from\
    \ that source.  As a result, VPN security\n   violations may result if any system\
    \ is a C-source for both extranet\n   and non-extranet C-flows.  However, the\
    \ set of C-flows transmitted by\n   a given C-source is not under the control\
    \ of the SP.  SPs who offer\n   the extranet MVPN service must make sure that\
    \ this potential for VPN\n   security violations is clearly understood by the\
    \ customers who\n   administer the C-sources.\n   This specification does not\
    \ require that UMH-eligible routes be \"host\n   routes\"; they may be less specific\
    \ routes.  So, it is possible for\n   the NLRI of a UMH-eligible route to contain\
    \ an address prefix that\n   matches the address of both an extranet C-source\
    \ and a non-extranet\n   C-source.  If such a route is exported from a VPN-S VRF\
    \ and imported\n   by a VPN-R VRF, C-receivers contained in VPN-R will be able\
    \ to\n   receive C-flows from the non-extranet C-sources whose addresses match\n\
    \   that route.  This may result in VPN security violations.  Service\n   providers\
    \ who offer the extranet MVPN service must make sure that\n   this is clearly\
    \ understood by the customers who administer the\n   distribution of routes from\
    \ CE routers to PE routers.\n   If the address ambiguities described in Sections\
    \ 2.1 and 2.2 are not\n   prohibited by deployment of the policies described in\
    \ Section 2.3.2,\n   VRFs must be able to discard traffic that arrives on the\
    \ wrong\n   P-tunnel (as specified in Sections 2.3.1 and 7.5).  Otherwise, VPN\n\
    \   security violations may occur.\n"
- title: 11.  References
  contents:
  - '11.  References

    '
- title: 11.1.  Normative References
  contents:
  - "11.1.  Normative References\n   [RFC2119]  Bradner, S., \"Key words for use in\
    \ RFCs to Indicate\n              Requirement Levels\", BCP 14, RFC 2119,\n  \
    \            DOI 10.17487/RFC2119, March 1997,\n              <http://www.rfc-editor.org/info/rfc2119>.\n\
    \   [RFC4360]  Sangli, S., Tappan, D., and Y. Rekhter, \"BGP Extended\n      \
    \        Communities Attribute\", RFC 4360, DOI 10.17487/RFC4360,\n          \
    \    February 2006, <http://www.rfc-editor.org/info/rfc4360>.\n   [RFC4364]  Rosen,\
    \ E. and Y. Rekhter, \"BGP/MPLS IP Virtual Private\n              Networks (VPNs)\"\
    , RFC 4364, DOI 10.17487/RFC4364,\n              February 2006, <http://www.rfc-editor.org/info/rfc4364>.\n\
    \   [RFC6513]  Rosen, E., Ed., and R. Aggarwal, Ed., \"Multicast in\n        \
    \      MPLS/BGP IP VPNs\", RFC 6513, DOI 10.17487/RFC6513,\n              February\
    \ 2012, <http://www.rfc-editor.org/info/rfc6513>.\n   [RFC6514]  Aggarwal, R.,\
    \ Rosen, E., Morin, T., and Y. Rekhter, \"BGP\n              Encodings and Procedures\
    \ for Multicast in MPLS/BGP IP\n              VPNs\", RFC 6514, DOI 10.17487/RFC6514,\
    \ February 2012,\n              <http://www.rfc-editor.org/info/rfc6514>.\n  \
    \ [RFC6625]  Rosen, E., Ed., Rekhter, Y., Ed., Hendrickx, W., and R.\n       \
    \       Qiu, \"Wildcards in Multicast VPN Auto-Discovery Routes\",\n         \
    \     RFC 6625, DOI 10.17487/RFC6625, May 2012,\n              <http://www.rfc-editor.org/info/rfc6625>.\n\
    \   [RFC7153]  Rosen, E. and Y. Rekhter, \"IANA Registries for BGP\n         \
    \     Extended Communities\", RFC 7153, DOI 10.17487/RFC7153,\n              March\
    \ 2014, <http://www.rfc-editor.org/info/rfc7153>.\n   [RFC7761]  Fenner, B., Handley,\
    \ M., Holbrook, H., Kouvelas, I.,\n              Parekh, R., Zhang, Z., and L.\
    \ Zheng, \"Protocol Independent\n              Multicast - Sparse Mode (PIM-SM):\
    \ Protocol Specification\n              (Revised)\", STD 83, RFC 7761, DOI 10.17487/RFC7761,\n\
    \              March 2016, <http://www.rfc-editor.org/info/rfc7761>.\n"
- title: 11.2.  Informative References
  contents:
  - "11.2.  Informative References\n   [MVPN-IR]  Rosen, E., Ed., Subramanian, K.,\
    \ and Z. Zhang, \"Ingress\n              Replication Tunnels in Multicast VPN\"\
    , Work in Progress,\n              draft-ietf-bess-ir-03, April 2016.\n   [RFC3446]\
    \  Kim, D., Meyer, D., Kilmer, H., and D. Farinacci, \"Anycast\n             \
    \ Rendevous Point (RP) mechanism using Protocol Independent\n              Multicast\
    \ (PIM) and Multicast Source Discovery Protocol\n              (MSDP)\", RFC 3446,\
    \ DOI 10.17487/RFC3446, January 2003,\n              <http://www.rfc-editor.org/info/rfc3446>.\n\
    \   [RFC3618]  Fenner, B., Ed., and D. Meyer, Ed., \"Multicast Source\n      \
    \        Discovery Protocol (MSDP)\", RFC 3618,\n              DOI 10.17487/RFC3618,\
    \ October 2003,\n              <http://www.rfc-editor.org/info/rfc3618>.\n   [RFC4610]\
    \  Farinacci, D. and Y. Cai, \"Anycast-RP Using Protocol\n              Independent\
    \ Multicast (PIM)\", RFC 4610,\n              DOI 10.17487/RFC4610, August 2006,\n\
    \              <http://www.rfc-editor.org/info/rfc4610>.\n   [RFC4875]  Aggarwal,\
    \ R., Ed., Papadimitriou, D., Ed., and S.\n              Yasukawa, Ed., \"Extensions\
    \ to Resource Reservation\n              Protocol - Traffic Engineering (RSVP-TE)\
    \ for Point-to-\n              Multipoint TE Label Switched Paths (LSPs)\", RFC\
    \ 4875,\n              DOI 10.17487/RFC4875, May 2007,\n              <http://www.rfc-editor.org/info/rfc4875>.\n\
    \   [RFC5015]  Handley, M., Kouvelas, I., Speakman, T., and L. Vicisano,\n   \
    \           \"Bidirectional Protocol Independent Multicast\n              (BIDIR-PIM)\"\
    , RFC 5015, DOI 10.17487/RFC5015,\n              October 2007, <http://www.rfc-editor.org/info/rfc5015>.\n\
    \   [RFC5059]  Bhaskar, N., Gall, A., Lingard, J., and S. Venaas,\n          \
    \    \"Bootstrap Router (BSR) Mechanism for Protocol Independent\n           \
    \   Multicast (PIM)\", RFC 5059, DOI 10.17487/RFC5059,\n              January\
    \ 2008, <http://www.rfc-editor.org/info/rfc5059>.\n   [RFC5226]  Narten, T. and\
    \ H. Alvestrand, \"Guidelines for Writing an\n              IANA Considerations\
    \ Section in RFCs\", BCP 26, RFC 5226,\n              DOI 10.17487/RFC5226, May\
    \ 2008,\n              <http://www.rfc-editor.org/info/rfc5226>.\n   [RFC6388]\
    \  Wijnands, IJ., Ed., Minei, I., Ed., Kompella, K., and B.\n              Thomas,\
    \ \"Label Distribution Protocol Extensions for Point-\n              to-Multipoint\
    \ and Multipoint-to-Multipoint Label Switched\n              Paths\", RFC 6388,\
    \ DOI 10.17487/RFC6388, November 2011,\n              <http://www.rfc-editor.org/info/rfc6388>.\n"
- title: Acknowledgments
  contents:
  - "Acknowledgments\n   The authors wish to thank DP Ayyadevara, Robert Kebler, Padmini\n\
    \   Misra, Rayen Mohanty, Maria Napierala, Karthik Subramanian, and Kurt\n   Windisch\
    \ for their contributions to this work.\n   We also wish to thank Lizhong Jin\
    \ and Rishabh Parekh for their\n   reviews and comments.\n   Special thanks to\
    \ Jeffrey (Zhaohui) Zhang for his careful review and\n   for providing the ASCII\
    \ art appearing in Section 2.\n"
- title: Contributors
  contents:
  - "Contributors\n   Below is a list of other contributing authors, in alphabetical\
    \ order:\n   Wim Henderickx\n   Nokia\n   Copernicuslaan 50\n   Antwerp  2018\n\
    \   Belgium\n   Email: wim.henderickx@nokia.com\n   Praveen Muley\n   Nokia\n\
    \   Email: Praveen.Muley@nokia.com\n   Ray Qiu\n   Juniper Networks, Inc.\n  \
    \ 1194 North Mathilda Avenue\n   Sunnyvale, CA  94089\n   United States\n   Email:\
    \ rqiu@juniper.net\n   IJsbrand Wijnands\n   Cisco Systems, Inc.\n   De Kleetlaan\
    \ 6a\n   Diegem  1831\n   Belgium\n   Email: ice@cisco.com\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Yakov Rekhter (editor)\n   Juniper Networks, Inc.\n  \
    \ 1194 North Mathilda Avenue\n   Sunnyvale, CA  94089\n   United States\n   Eric\
    \ C. Rosen (editor)\n   Juniper Networks, Inc.\n   10 Technology Park Drive\n\
    \   Westford, Massachusetts  01886\n   United States\n   Email: erosen@juniper.net\n\
    \   Rahul Aggarwal\n   Arktan\n   Email: raggarwa_1@yahoo.com\n   Yiqun Cai\n\
    \   Alibaba Group\n   400 S El Camino Real #400\n   San Mateo, CA  94402\n   United\
    \ States\n   Email: yiqun.cai@alibaba-inc.com\n   Thomas Morin\n   Orange\n  \
    \ 2 Avenue Pierre-Marzin\n   22307 Lannion Cedex\n   France\n   Email: thomas.morin@orange.com\n"
