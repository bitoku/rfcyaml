- title: __initial_text__
  contents:
  - "              Problem Statement: Mobile IPv4 Traversal of\n                 Virtual\
    \ Private Network (VPN) Gateways\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This memo provides information for the Internet community.\
    \  It does\n   not specify an Internet standard of any kind.  Distribution of\
    \ this\n   memo is unlimited.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (C) The Internet Society (2005).\n"
- title: Abstract
  contents:
  - "Abstract\n   Deploying Mobile-IP v4 in networks that are connected to the Internet\n\
    \   through a Virtual Private Network (VPN) gateway presents some\n   problems\
    \ that do not currently have well-described solutions.  This\n   document aims\
    \ to describe and illustrate these problems, and to\n   propose some guidelines\
    \ for possible solutions.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1. Introduction ....................................................2\n\
    \      1.1. Overview of the Problem ....................................3\n  \
    \    1.2. Specification of Requirements ..............................3\n    \
    \  1.3. Terminology ................................................3\n   2. MIP\
    \ and VPN Deployment Scenarios ................................4\n      2.1. MIPv4\
    \ HA(s) Inside the Intranet behind a VPN Gateway .......5\n      2.2. VPN Gateway\
    \ and MIPv4 HA(s) on the VPN Domain Border .......6\n      2.3. Combined VPN Gateway\
    \ and MIPv4 HA ..........................7\n      2.4. MIPv4 HA(s) Outside the\
    \ VPN Domain .........................8\n      2.5. Combined VPN Gateway and MIPv4\
    \ HA(s) on the Local Link .....9\n   3. Deployment Scenarios Selection ..................................9\n\
    \   4. Problem Statement ..............................................10\n  \
    \    4.1. Registering in Co-Located Mode ............................11\n    \
    \  4.2. Registering via an FA .....................................12\n      4.3.\
    \ Summary: MIP Incompatibilities with IPsec-Based\n           VPN Gateways ..............................................13\n\
    \   5. Solution Guidelines ............................................14\n  \
    \    5.1. Preservation of Existing VPN Infrastructure ...............14\n    \
    \  5.2. Software Upgrades to Existing VPN Client and Gateways .....14\n      5.3.\
    \ IPsec Protocol ............................................14\n      5.4. Multi-Vendor\
    \ Interoperability .............................14\n      5.5. MIPv4 Protocol\
    \ ............................................15\n      5.6. Handoff Overhead\
    \ ..........................................15\n      5.7. Scalability, Availability,\
    \ Reliability, and Performance ...15\n      5.8. Functional Entities .......................................15\n\
    \      5.9. Implications of Intervening NAT Gateways ..................15\n  \
    \    5.10. Security Requirements ....................................16\n   6.\
    \ Security Considerations ........................................16\n   7. Acknowledgements\
    \ ...............................................16\n   8. References .....................................................17\n\
    \      8.1. Normative References ......................................17\n  \
    \    8.2. Informative References ....................................17\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   Mobile IP [RFC3344] agents are being deployed in enterprise\
    \ networks\n   to enable mobility across wired and wireless LANs while roaming\n\
    \   inside the enterprise Intranet.  With the growing deployment of IEEE\n   802.11\
    \ access points (\"hot spots\") in public places such as hotels,\n   airports,\
    \ and convention centers, and with wireless WAN data networks\n   such as General\
    \ Packet Radio Service (GPRS), the need is increasing\n   for enabling mobile\
    \ users to maintain their transport connections and\n   constant reachability\
    \ while connecting back to their target \"home\"\n   networks protected by Virtual\
    \ Private Network (VPN) technology.  This\n   implies that Mobile IP and VPN technologies\
    \ have to coexist and\n   function together in order to provide mobility and security\
    \ to the\n   enterprise mobile users.\n   The goal of this document is to:\n \
    \  o  Identify and describe practical deployment scenarios for Mobile IP\n   \
    \   and VPN in enterprise and operator environments.\n   o  Identify example usage\
    \ scenarios for remote users roaming outside\n      the \"home\" network protected\
    \ by a VPN gateway.\n   o  Articulate the problems resulting from Mobile IP and\
    \ VPN\n      coexistence.\n   o  Specify a set of framework guidelines to evaluate\
    \ proposed\n      solutions for supporting multi-vendor seamless IPv4 mobility\n\
    \      across IPsec-based VPN gateways.\n"
- title: 1.1.  Overview of the Problem
  contents:
  - "1.1.  Overview of the Problem\n   Access to the Intranet is typically guarded\
    \ by both a firewall and a\n   VPN device.  The Intranet can only be accessed\
    \ by respecting the\n   security policies in the firewall and the VPN device.\n\
    \   When MIP is deployed in a corporate Intranet (also referred to as a\n   VPN\
    \ domain), roaming between the Intranet (i.e., trusted domain) and\n   the Internet\
    \ (i.e., untrusted domain) becomes problematic.  It would\n   be desirable to\
    \ have seamless session mobility between the two\n   domains, because MIP was\
    \ designed for session mobility regardless of\n   the network point of attachment.\
    \  Unfortunately, the current MIP\n   standards fall short of this promise for\
    \ an important customer\n   segment: corporate users (using VPN for remote access)\
    \ who desire to\n   add mobility support because of a need to have continuous\
    \ access to\n   Intranet resources while roaming outside the Intranet from one\
    \ subnet\n   to another, or between the VPN domain and the Internet.\n   From\
    \ the beginning, one explicitly stated restriction was that it was\n   assumed\
    \ that installed firewalls and VPN gateways had to be kept\n   unchanged, rather\
    \ than replaced or upgraded, because they have much\n   wider deployments than\
    \ MIP at the time of writing.  Therefore, any\n   solutions would need to minimize\
    \ the impact on existing VPN and\n   firewall deployments, related standards,\
    \ and \"de facto\" standards.\n"
- title: 1.2.  Specification of Requirements
  contents:
  - "1.2.  Specification of Requirements\n   In this document, several words are used\
    \ to signify the requirements\n   of the specification.  These words are often\
    \ capitalized.  The key\n   words \"MUST\", \"MUST NOT\", \"REQUIRED\", \"SHALL\"\
    , \"SHALL NOT\", \"SHOULD\",\n   \"SHOULD NOT\", \"RECOMMENDED\", \"MAY\", and\
    \ \"OPTIONAL\" in this document\n   are to be interpreted as described in [RFC2119].\n"
- title: 1.3.  Terminology
  contents:
  - "1.3.  Terminology\n   MIPv4         Mobile IP for IPv4 [RFC3344]\n   MIPv6  \
    \       Mobile IP for IPv6\n   VPN           Virtual Private Network\n   GW  \
    \          Gateway\n   VPN Domain    An Intranet protected by a VPN gateway.\n\
    \   DMZ           (Demilitarized Zone) A small network inserted as a\n       \
    \          \"neutral zone\" between a company's private network and\n        \
    \         the outside public network to prevent outside users\n              \
    \   from getting direct access to the company's private\n                 network.\n\
    \   Home Network  A network, possibly virtual, having a network prefix\n     \
    \            matching that of a mobile node's home address.\n   Home Agent   \
    \ A router on a mobile node's home network which tunnels\n                 datagrams\
    \ for delivery to the mobile node when it is\n                 away from home,\
    \ and maintains current location\n                 information for the mobile\
    \ node.\n   MN            Refers to a mobile node that runs both MIP and IPsec-\n\
    \                 based VPN client software.\n   MIPv4 inside IPsec-ESP tunnel\n\
    \                 MIPv4 packets are encapsulated in an IPsec-ESP tunnel\n    \
    \             established between the Mobile Node and the VPN\n              \
    \   gateway.\n   IPsec-ESP inside MIPv4 tunnel\n                 IPsec-ESP packets\
    \ are encapsulated in a MIPv4 tunnel\n                 established between the\
    \ Mobile Node and the home agent.\n"
- title: 2.  MIP and VPN Deployment Scenarios
  contents:
  - "2.  MIP and VPN Deployment Scenarios\n   This section describes a set of deployment\
    \ scenarios wherein MIP\n   agents and VPN gateways have to coexist to provide\
    \ mobility and\n   security.  The intention is to identify practical deployment\n\
    \   scenarios for MIP and VPNs where MIP technology might be extended to\n   solve\
    \ problems resulting from the desire for co-existence.\n   The network topology\
    \ in the following diagrams consists of an\n   Intranet connected to the public\
    \ network (i.e., the Internet).  Here,\n   the word \"Intranet\" refers to a private\
    \ network (where private\n   addresses [RFC1918] are typically used) protected\
    \ by a VPN gateway\n   and perhaps by a layer-3 transparent or non-transparent\
    \ firewall.\n   When private addresses are used, the non-transparent firewall\
    \ also\n   functions as a Network Address Translator (NAT) or Network Address\n\
    \   Port Translator (NAPT) bridging between the two address realms (i.e.,\n  \
    \ the Intranet and the Internet).\n   Firewalls may be placed on either side of\
    \ the VPN gateway; these are\n   referred to as inner and outer firewalls.  The\
    \ inner and outer\n   firewalls typically inspect outbound traffic (i.e., from\
    \ the Intranet\n   to the Internet) and inbound traffic (i.e., from the Internet\
    \ to the\n   Intranet), respectively.  When a firewall is present, it MUST be\n\
    \   configured to allow Mobile IP traffic (both control and tunneled data\n  \
    \ packets) to go through.  As our focus here is the relationship\n   between MIP\
    \ and VPN, we have purposely omitted firewalls from the\n   following scenarios\
    \ in order to keep things simple.\n   It is assumed that encryption is not enforced\
    \ inside the VPN domain\n   because: 1) the VPN domain (Intranet) is viewed as\
    \ a trusted network,\n   and users allowed inside the Intranet are also trusted,\
    \ and 2) it is\n   a common VPN deployment practice where the VPN is used to guard\
    \ the\n   Intranet resources from unauthorized users attached to an untrusted\n\
    \   network, and to provide a secure communication channel for authorized\n  \
    \ users to access resources inside the Intranet from outside.\n   The following\
    \ sub-sections introduce five representative combinations\n   of MIPv4 HA and\
    \ VPN gateway placement.\n   In order to give a reasonably complete survey of\
    \ MIPv4 and VPN co-\n   existence scenarios, those in Sections 2.3 and 2.5 are\
    \ included even\n   though, as covered in more detail below, there are no co-existence\n\
    \   problems to be solved in these two cases.\n"
- title: 2.1.  MIPv4 HA(s) Inside the Intranet behind a VPN Gateway
  contents:
  - "2.1.  MIPv4 HA(s) Inside the Intranet behind a VPN Gateway\n   MIPv4 HAs are\
    \ deployed inside the Intranet protected by a VPN\n   gateway, and are not directly\
    \ reachable by the MNs outside the\n   Intranet.\n     ..Foreign Network..   \
    \          .....VPN Domain..(Intranet).....\n     .                 .        \
    \     .                              .\n     .  +----+  +----+ .           +----+\
    \     +-------+  +-------+  .\n     .  |MNs |  | FA | .           | VPN|     |\
    \ Router|  |  HA   |  .\n     .  |away|  |    | .<=========>|    |     | 1..n\
    \  |  | 1..n  |  .\n     .  +----+  +----+ .           | GW |     +-------+  +-------+\
    \  .\n     .                 .           +----+                           .\n\
    \     ...................             .        +-------+  +-------+  .\n     \
    \                                .        |  CN   |  | MNs   |  .\n          \
    \                           .        | 1..n  |  | home  |  .\n               \
    \                      .        +-------+  +-------+  .\n                    \
    \                 .                              .\n                         \
    \            ................................\n                              \
    \   Figure 1\n   Direct application of MIPv4 standards [RFC3344] is successfully\
    \ used\n   to provide mobility for users inside the Intranet.  However, mobile\n\
    \   users outside the Intranet can only access the Intranet resources\n   (e.g.,\
    \ MIP agents) through the VPN gateway, which will allow only\n   authenticated\
    \ IPsec traffic inside.  This implies that the MIPv4\n   traffic has to run inside\
    \ IPsec, which leads to two distinct\n   problems:\n   1.  When the foreign network\
    \ has an FA deployed (e.g., as in CDMA\n       2000), MIPv4 registration becomes\
    \ impossible.  This is because\n       the MIPv4 traffic between MN and VPN gateway\
    \ is encrypted, and\n       the FA (which is likely in a different administrative\
    \ domain)\n       cannot inspect the MIPv4 headers needed for relaying the MIPv4\n\
    \       packets.  Please see Section 4.2 for more details.\n   2.  In co-located\
    \ mode, successful registration is possible but the\n       VPN tunnel has to\
    \ be re-negotiated every time the MN changes its\n       point of network attachment.\n\
    \   These problems are articulated in Section 4.\n   This deployment scenario\
    \ may not be common yet, but it is practical\n   and is becoming important as\
    \ there is an increasing need for\n   providing corporate remote users with continuous\
    \ access to the\n   Intranet resources.\n"
- title: 2.2.  VPN Gateway and MIPv4 HA(s) on the VPN Domain Border
  contents:
  - "2.2.  VPN Gateway and MIPv4 HA(s) on the VPN Domain Border\n   A MIPv4 HA is\
    \ deployed on the VPN domain border (e.g., in the DMZ)\n   together with the VPN\
    \ gateway, and it is directly reachable by MNs\n   inside or outside the Intranet.\n\
    \     ..Foreign Network..             .....VPN Domain..(Intranet).....\n     .\
    \                 .             .                              .\n     .  +----+\
    \  +----+ .           +----+     +-------+             .\n     .  |MNs |  | FA\
    \ | .           | VPN|     | Router|             .\n     .  |away|  |    | .<=========>|\
    \    |     | 1..n  |             .\n     .  +----+  +----+ .    /\\     | GW |\
    \     +-------+             .\n     .                 .    ||     +----+     \
    \                      .\n     .                 .    ||     +----+     +-------+\
    \  +-------+  .\n     .                 .    ++====>| HA |     |  CN   |  | MNs\
    \   |  .\n     ...................           |    |     | 1..n  |  | home  | \
    \ .\n                                   +----+     +-------+  +-------+  .\n \
    \                                    .                              .\n      \
    \                               ................................\n           \
    \                      Figure 2\n   Please note that in deployments where the\
    \ security policy prohibits\n   direct communication between the MN (roaming outside\
    \ the Intranet)\n   and outside machines, the HA can be configured to forward\
    \ only\n   encrypted traffic from/to the MN.\n   The MIPv4 HA has a public interface\
    \ connected to the Internet, and a\n   private interface attached to the Intranet.\
    \  Mobile users will most\n   likely have a virtual home network associated with\
    \ the MIPv4 HA's\n   private interface, so that the mobile users are always away\
    \ from home\n   and thus registered with the MIPv4 HA.  Furthermore, in deployments\n\
    \   where the VPN gateway and the HA are placed in a corporate DMZ, this\n   implies\
    \ that MIPv4 traffic will always be routed through the DMZ\n   (regardless of\
    \ whether MNs are located outside or inside the\n   Intranet), which may not be\
    \ acceptable to IT departments in large\n   corporations.\n   This deployment\
    \ can be used with two different configurations: \"MIPv4\n   inside IPsec-ESP\
    \ tunnel\" and \"IPsec-ESP inside MIPv4 tunnel\".  The\n   \"MIPv4 inside IPsec-ESP\
    \ tunnel\" has the same problems as the scenario\n   in Section 2.1.  (Namely,\
    \ MIPv4 registration becomes impossible when\n   the registration is to be done\
    \ via an FA, and furthermore, in co-\n   located mode, the VPN tunnel has to be\
    \ re-negotiated every time the\n   MN changes its point of attachment.)  The \"\
    IPsec-ESP inside MIPv4\n   tunnel\" does not have the problems described in Section\
    \ 2.1; however,\n   it will require some modifications to the routing logic of\
    \ the MIPv4\n   HA or the VPN gateway.\n"
- title: 2.3.  Combined VPN Gateway and MIPv4 HA
  contents:
  - "2.3.  Combined VPN Gateway and MIPv4 HA\n   This is similar to the deployment\
    \ scenario described in Section 2.2,\n   with the exception that the VPN gateway\
    \ and MIPv4 HA are running on\n   the same physical machine.\n     ..Foreign Network..\
    \             .....VPN Domain..(Intranet).....\n     .                 .     \
    \        .                              .\n     .  +----+  +----+ .          \
    \ +----+     +-------+             .\n     .  |MNs |  | FA | .           | VPN|\
    \     | Router|             .\n     .  |away|  |    | .<==========| GW |     |\
    \ 1..n  |             .\n     .  +----+  +----+ .           |  + |     +-------+\
    \             .\n     .                 .           | HA |                   \
    \        .\n     ...................           +----+     +-------+  +-------+\
    \  .\n                                     .        |  CN   |  | MNs   |  .\n\
    \                                     .        | 1..n  |  | home  |  .\n     \
    \                                .        +-------+  +-------+  .\n          \
    \                           .                              .\n               \
    \                      ................................\n                    \
    \             Figure 3\n   Running MIPv4 HA and VPN on the same machine resolves\
    \ routing-related\n   issues that exist in Section 2.2 when a \"IPsec-ESP inside\
    \ MIPv4\n   tunnel\" configuration is used.  However, it does not promote multi-\n\
    \   vendor interoperability in environments where MIPv4 HA and VPN\n   technologies\
    \ must be acquired from different vendors.\n"
- title: 2.4.  MIPv4 HA(s) Outside the VPN Domain
  contents:
  - "2.4.  MIPv4 HA(s) Outside the VPN Domain\n   In this scenario, MIPv4 HAs are\
    \ deployed outside the Intranet (e.g.,\n   in an operator network), as depicted\
    \ in Figure 4, below.\n     ..Foreign Network..             .....VPN Domain..(Intranet).....\n\
    \     .                 .             .                              .\n     .\
    \  +----+  +----+ .           +----+     +-------+             .\n     .  |MNs\
    \ |  | FA | .           | VPN|     | Router|             .\n     .  |away|  |\
    \    | .<==========| GW |     | 1..n  |             .\n     .  +----+  +----+\
    \ .    /\\     |    |     +-------+             .\n     .                 .  \
    \  ||     |    |                           .\n     ...................    || \
    \    |    |     +-------+  +-------+  .\n                            ||     |\
    \    |     |  CN   |  | MNs   |  .\n     .....MIPv4 Home....    ||     |    |\
    \     | 1..n  |  | home  |  .\n     .                 .<===++     |    |     +-------+\
    \  +-------+  .\n     . +------+        .           +----+                   \
    \        .\n     . | HAs  |        .             .                           \
    \   .\n     . | 1..n |        .             ................................\n\
    \     . +------+        .\n     ...................\n                        \
    \         Figure 4\n   The IPsec tunnel endpoints will be the MN and the VPN gateway.\
    \  The\n   'home network' will most likely be a virtual home network, located\
    \ at\n   the HA, through which authorized remote users (i.e., those that have\n\
    \   successfully established a connection to the corporate VPN) can reach\n  \
    \ the Corporate Intranet and maintain their transport session\n   connectivity\
    \ while roaming outside the Intranet from one subnet to\n   another.  Please note\
    \ that this deployment scenario does not support\n   mobility inside the Intranet.\n\
    \   In this case, it is most practical to run IPsec-ESP inside a MIPv4\n   tunnel\
    \ (i.e., the MIPv4 tunnel endpoints are the MN and the HA; the\n   IPsec-ESP packet\
    \ from the MN and to the VPN gateway is encapsulated\n   in the MIPv4 tunnel).\
    \  This is because the MNs can register with the\n   HA without establishing an\
    \ IPsec tunnel to the VPN gateway.\n"
- title: 2.5.  Combined VPN Gateway and MIPv4 HA(s) on the Local Link
  contents:
  - "2.5.  Combined VPN Gateway and MIPv4 HA(s) on the Local Link\n   This is similar\
    \ to the deployment scenario described in Section 2.3,\n   with the difference\
    \ that the VPN gateway/HA is sitting on the local\n   link.  In this case, the\
    \ VPN gateway and HA would most naturally be\n   co-located in the same box, although\
    \ this is in no way a requirement.\n   The VPN/HA is assumed to be reachable from\
    \ the external network;\n   i.e., it is assumed to have a public IP address, and\
    \ the firewall is\n   assumed to be configured to allow direct access to the VPN/HA\
    \ from\n   the external network.\n     ..Foreign Network..             .....VPN\
    \ Domain..(Intranet).....\n     .                 .             .            \
    \                  .\n     .  +----+  +----+ .         +------+     +-------+\
    \  +-------+  .\n     .  |MNs |  | FA | .         | Fire |     | Router|  | VPN/HA|\
    \  .\n     .  |away|  |    | .<=======>| wall |     | 1..n  |  | 1..n  |  .\n\
    \     .  +----+  +----+ .         |      |     +-------+  +-------+  .\n     .\
    \                 .         | NAT  |                           .\n     ...................\
    \         +------+     +-------+  +-------+  .\n                             \
    \        .        |  CN   |  | MNs   |  .\n                                  \
    \   .        | 1..n  |  | home  |  .\n                                     . \
    \       +-------+  +-------+  .\n                                     .      \
    \                        .\n                                     ................................\n\
    \                                 Figure 5\n   This deployment works today without\
    \ any technical problems with\n   IPsec-ESP running inside a MIPv4 tunnel.  If\
    \ you were to run MIPv\n   inside the IPsec-ESP tunnel, it would have the same\
    \ problems as in\n   Section 2.1, so it is deployed with the IPsec-ESP running\
    \ inside the\n   MIPv4 tunnel.  This deployment is not practical for large deployments\n\
    \   (on the order of thousands of users) because of the large and\n   distributed\
    \ security perimeter.\n"
- title: 3.  Deployment Scenarios Selection
  contents:
  - "3.  Deployment Scenarios Selection\n   The deployment scenarios described in\
    \ Section 2 were evaluated to\n   identify those most in need of solving.  The\
    \ evaluation was done\n   based on two main criteria: 1) Is the deployment scenario\
    \ common and\n   practical? and 2) Does the deployment scenario reveal any problems\n\
    \   resulting from MIPv4 and VPN coexistence?\n   The authors believe that the\
    \ scenario in Section 2.1 is the most\n   important and practical one because\
    \ of a rising need for providing\n   corporate remote users with continuous access\
    \ to their Intranet\n   resources.  After analyzing each scenario, one realizes\
    \ that problems\n   occurring in scenarios in Sections 2.2 and 2.4 are either\
    \ the same as\n   those in the scenario in Section 2.1 or a subset of them.  Therefore,\n\
    \   solving the scenario in Section 2.1 will also solve the scenarios in\n   Sections\
    \ 2.2 and 2.4.  The scenarios in Sections 2.3 and 2.5 do not\n   introduce functional\
    \ problems resulting from MIPv4 and VPN co-\n   existence, and thus there is no\
    \ need to seek a solution.  A solution\n   for the deployment scenario in Section\
    \ 2.1 is therefore seen as\n   essential, and this in turn can also be applied\
    \ to solve problems in\n   other scenarios.  In subsequent sections, we will articulate\
    \ the\n   roaming scenarios, the problems, and the solution guidelines relevant\n\
    \   to the scenario in Section 2.1.\n"
- title: 4.  Problem Statement
  contents:
  - "4.  Problem Statement\n   This section describes roaming scenarios corresponding\
    \ to the\n   deployment scenario in Section 2.1 where an MN needs to have\n  \
    \ continuous access to the Intranet resources regardless of whether it\n   is\
    \ roaming inside or outside the Intranet, and their associated\n   problems. \
    \ The scenarios are constructed based on a multi-subnetted,\n   MIPv4-enabled\
    \ Intranet (hereafter referred to as Intranet or VPN\n   domain) protected by\
    \ an IPsec-based VPN gateway as depicted in\n   Figure 6.\n     ....Internet.......\
    \             .....VPN Domain..(Intranet).....\n     .                 .     \
    \        .                              .\n     .  +----+         .          \
    \ +----+     +-------+  +-------+  .\n     .  |MNs |         .           | VPN|\
    \     | Router|  | VPN/HA|  .\n     .  |away|         .<=========>|    |     |\
    \ 1..n  |  | 1..n  |  .\n     .  +----+         .           | GW |     +-------+\
    \  +-------+  .\n     .                 .           +----+                   \
    \        .\n     ...................             .        +-------+  +-------+\
    \  .\n                                     .        |  CN   |  | MNs   |  .\n\
    \                                     .        | 1..n  |  | home  |  .\n     \
    \                                .        +-------+  +-------+  .\n          \
    \                           .                              .\n               \
    \                      ................................\n               Figure\
    \ 6: Intranet protected by a VPN gateway\n   The Intranet, as depicted in Figure\
    \ 6, may include both wired (IEEE\n   802.3) and IEEE 802.11 wireless LAN deployments.\
    \  However, it is also\n   possible to see IEEE 802.11 deployments outside the\
    \ Intranet due to\n   the perceived lack of current 802.11 security, as depicted\
    \ in\n   Figure 7.\n     ....Internet.......             .....VPN Domain..(Intranet).....\n\
    \     .                 .             .                              .\n     .\
    \  +----+         .           +----+     +-------+  +-------+  .\n     .  |MNs\
    \ |         .           | VPN|     | Router|  | VPN/HA|  .\n     .  |away|   \
    \      .<=========>|    |     | 1..n  |  | 1..n  |  .\n     .  +----+        \
    \ .           | GW |     +-------+  +-------+  .\n     .                 .   \
    \        |    |                           .\n     ...................        \
    \   |    |     +-------+  +-------+  .\n                                   | \
    \   |     |  CN   |  | MNs   |  .\n         ..802.11 Wireless.. <====>|    | \
    \    | 1..n  |  | home  |  .\n         .    Network      .       +----+     +-------+\
    \  +-------+  .\n         .                 .         .                      \
    \        .\n         ...................         ................................\n\
    \    Figure 7: IEEE 802.11 Wireless deployment outside the home network\n"
- title: 4.1.  Registering in Co-Located Mode
  contents:
  - "4.1.  Registering in Co-Located Mode\n   In co-located mode, the IPsec tunnel\
    \ endpoints would be at the MN and\n   the VPN gateway, which (supposing we have\
    \ the scenario described in\n   Section 2.1) results in the mobile-ip tunnel from\
    \ MN to HA being\n   encapsulated inside the IPsec tunnel.  See Figure 8 below.\
    \  This\n   scenario is still possible, but has some major drawbacks.\n     ....Internet.......\
    \             .....VPN Domain..(Intranet).....\n     .                 .     \
    \        .                              .\n     .  +----+         .          \
    \ +----+     +-------+  +-------+  .\n     .  |MNs |         .           | VPN|\
    \     | Router|  | VPN/HA|  .\n     .  |away|<###################>|    |-----|\
    \ 1..n  |->| 1..n  |  .\n     .  +----+         .   \\       | GW |     +-------+\
    \  +-------+  .\n     .                 .    \\      +----+                  \
    \         .\n     ...................   mip       .        +-------+  +-------+\
    \  .\n                           inside    .        |  CN   |  | MNs   |  .\n\
    \                           IPsec     .        | 1..n  |  | home  |  .\n     \
    \                                .        +-------+  +-------+  .\n          \
    \                           .                              .\n               \
    \                      ................................\n                    \
    \             Figure 8\n   The MN obtains an address at its point of attachment\
    \ (via DHCP\n   [RFC2131] or some other means), and then sets up an IPsec tunnel\
    \ to\n   the VPN gateway, after which it can successfully register with its HA\n\
    \   through the IPsec tunnel.  The IPsec tunnel SA (Security Association)\n  \
    \ is identified by a triplet consisting of SPI (Security Parameter\n   Index),\
    \ MN's IP destination address (i.e., the address obtained at\n   the point of\
    \ attachment), and Security Protocol (AH or ESP)\n   Identifier as described in\
    \ [RFC2401].  This means that as the MN's IP\n   destination address changes on\
    \ each IP subnet handoff, the IPsec\n   tunnel needs to be re-established.  This\
    \ could have noticeable\n   performance implications on real-time applications\
    \ and in resource-\n   constrained wireless networks.  In effect, we don't have\
    \ mobility\n   support for the tunnel endpoint changes associated with MN movements.\n"
- title: 4.2.  Registering via an FA
  contents:
  - "4.2.  Registering via an FA\n   In the case where a mobile node is in a network\
    \ where mobility\n   support is provided through the use of an FA, and no DHCP\
    \ allocated\n   address and co-located mode is possible, we run into severe trouble.\n\
    \   This is illustrated in Figure 9 and explained below:\n     ..Foreign Network..\
    \             .....VPN Domain..(Intranet).....\n     .                 .     \
    \        .                              .\n     . +----+   +----+ .          \
    \ +----+     +-------+  +-------+  .\n     . |MNs |   | FA | .           | VPN|\
    \     | Router|  | VPN/HA|  .\n     . |away|<??|    |<###########>|    |-----|\
    \ 1..n  |->| 1..n  |  .\n     . +----+ \\ +----+ .   \\       | GW |     +-------+\
    \  +-------+  .\n     .         \\       .    \\      +----+                 \
    \          .\n     ...........\\.......   mip       .        +-------+  +-------+\
    \  .\n                 \\         inside    .        |  CN   |  | MNs   |  .\n\
    \            MN expects     IPsec     .        | 1..n  |  | home  |  .\n     \
    \       IPsec traffic            .        +-------+  +-------+  .\n          \
    \                           .                              .\n               \
    \                      ................................\n                    \
    \             Figure 9\n   When arriving at the visited network on the left in\
    \ this figure, the\n   MN has to reach the FA with registration requests in order\
    \ to have\n   the FA send them on to the HA.  However, the MN in all likelihood\n\
    \   cannot register with the FA because the registration requests will be\n  \
    \ sent encrypted, and the FA will not be able to decrypt them.  If the\n   MN\
    \ would have a policy that allowed split tunneling so that it could\n   reach\
    \ the FA with clear text messages, then the FA would still not be\n   able to\
    \ get through the VPN gateway unless the HA is reachable from\n   outside and\
    \ the Intranet security policy allows MIP registration\n   packets to bypass the\
    \ VPN gateway.\n   Even if the HA is reachable and the MIP registration succeeds,\
    \ the FA\n   (which is likely in a different administrative domain) will not be\n\
    \   able to relay packets between the MN and the VPN gateway.  Packets\n   from\
    \ the MN will be encapsulated by the FA with IP-in-IP [RFC2003],\n   which the\
    \ VPN gateway will drop, and packets from the VPN gateway\n   will have ESP payloads\
    \ (with IP-in-IP inside), which the FA will drop\n   (as it expects IP-in-IP-encapsulated\
    \ traffic to the MN).\n   The use of a 'trusted FA' has also been suggested in\
    \ this scenario,\n   meaning an FA that is actually a combined VPN GW and FA.\
    \  The\n   scenario will work fine in this case, as the tunnel end-points are\
    \ at\n   the FA and the VPN gateway as shown in Figure 10 below.  However, we\n\
    \   cannot expect that the FA in access networks (e.g., wireless hot-\n   spots\
    \ or CDMA 2000 networks) will have security associations with any\n   given corporate\
    \ network, so this is not particularly realistic in the\n   general mobility case.\n\
    \     ..Foreign Network..             .....VPN Domain..(Intranet).....\n     .\
    \                 .             .                              .\n     . +----+\
    \   +----+ .           +----+     +-------+  +-------+  .\n     . | FA |   | VPN|\
    \ .           | VPN|     | Router|  | VPN/HA|  .\n     . |    |<--| GW |<###########>|\
    \    |-----| 1..n  |->| 1..n  |  .\n     . +----+   +----+ .   \\       | GW |\
    \     +-------+  +-------+  .\n     .    |            .    \\      +----+    \
    \                       .\n     . +----+          .   mip       .        +-------+\
    \  +-------+  .\n     . |MNs |          .   inside    .        |  CN   |  | MNs\
    \   |  .\n     . |away|          .   IPsec     .        | 1..n  |  | home  | \
    \ .\n     . +----+          .             .        +-------+  +-------+  .\n \
    \    ...................             .                              .\n      \
    \                               ................................\n           \
    \                      Figure 10\n   Furthermore, this solution would leave the\
    \ traffic between FA and MN\n   unprotected, and as this link in particular may\
    \ be a wireless link,\n   this is clearly undesirable.\n"
- title: '4.3.  Summary: MIP Incompatibilities with IPsec-Based VPN Gateways'
  contents:
  - "4.3.  Summary: MIP Incompatibilities with IPsec-Based VPN Gateways\n   An MN\
    \ roaming outside the Intranet has to establish an IPsec tunnel\n   to its home\
    \ VPN gateway first, in order to be able to register with\n   its home agent.\
    \  This is because the MN cannot reach its HA (inside\n   the private protected\
    \ network) directly from the outside.  This\n   implies that the MIPv4 traffic\
    \ from the MN to a node inside the\n   Intranet is forced to run inside an IPsec\
    \ tunnel, and thus that it\n   will not be in the clear.  This in turn leads to\
    \ two distinct\n   problems depending on whether the MN uses co-located or non-co-\n\
    \   located modes to register with its HA.\n   In co-located mode, the IPsec tunnel\
    \ needs to be re-established on\n   each IP subnet handoff, which will have performance\
    \ implications on\n   real-time applications and resource-constrained wireless\
    \ networks.\n   In non-co-located mode (i.e., using an FA care-of address), the\n\
    \   problem becomes severe, as the MN may be unable to register with its\n   HA\
    \ through the FA because the FA cannot understand MIPv4 registration\n   requests\
    \ if they are encrypted in the IPsec tunnel (i.e., split\n   tunneling is not\
    \ supported).  Even if the MN could reach the FA with\n   non-encrypted registration\
    \ requests (i.e., split tunneling is\n   supported), and the requests going from\
    \ the FA to the HA can pass\n   through the VPN gateway, there would still be\
    \ a problem with routing\n   of data packets between the Intranet and the internet.\
    \  This is\n   because the VPN will not allow IP-in-IP-encapsulated packets from\
    \ the\n   FA to go through.  And furthermore, ESP-encapsulated packets from the\n\
    \   VPN gateway to the MN will be dropped by the FA, as it expects IP-\n   in-IP-encapsulated\
    \ traffic to the MN.\n"
- title: 5.  Solution Guidelines
  contents:
  - "5.  Solution Guidelines\n   This section describes guidelines for a solution\
    \ to MIPv4 traversal\n   across VPN gateways.\n"
- title: 5.1.  Preservation of Existing VPN Infrastructure
  contents:
  - "5.1.  Preservation of Existing VPN Infrastructure\n   o  The solution MUST work\
    \ with currently deployed VPN gateways.  This\n      is the whole raison d'etre\
    \ of this investigation:  Finding a way\n      to deploy Mobile-IP in cases where\
    \ a VPN solution is already in\n      place.\n"
- title: 5.2.  Software Upgrades to Existing VPN Client and Gateways
  contents:
  - "5.2.  Software Upgrades to Existing VPN Client and Gateways\n   o  The solution\
    \ SHOULD minimize changes to existing VPN\n      client/gateway software.\n"
- title: 5.3.  IPsec Protocol
  contents:
  - "5.3.  IPsec Protocol\n   o  The solution SHOULD NOT require any changes to existing\
    \ IPsec or\n      key-exchange standard protocols implemented by VPN gateways.\n\
    \   o  The solution SHOULD NOT require that the VPN gateway or the VPN\n     \
    \ client implement any new protocols in addition to the existing\n      standard\
    \ protocols.\n"
- title: 5.4.  Multi-Vendor Interoperability
  contents:
  - "5.4.  Multi-Vendor Interoperability\n   o  The solution MUST provide multi-vendor\
    \ interoperability, whereby\n      MIPv4 mobility agents, mobility clients (MN),\
    \ VPN server, and VPN\n      client solutions may come from four different vendors.\
    \  This is\n      typical for medium and large enterprises that purchase and deploy\n\
    \      best-of-breed multi-vendor solutions for IP routing, VPNs,\n      firewalls,\
    \ etc.\n"
- title: 5.5.  MIPv4 Protocol
  contents:
  - "5.5.  MIPv4 Protocol\n   o  The solution MUST adhere to MIPv4 protocol [RFC3344].\
    \  That is,\n      the solution MUST NOT impose any changes that violate MIPv4\n\
    \      protocol.\n   o  The solution MAY introduce new extensions to MIPv4 nodes\
    \ per\n      guidelines specified in the MIPv4 protocol [RFC3344].  However, in\n\
    \      order to overcome barriers to deployment, it is highly desirable\n    \
    \  to avoid any changes to MIPv4 mobility agents such as the FA and\n      HA.\n\
    \   o  The solution MAY require more than one instance of MIPv4 running\n    \
    \  in parallel (multiple encapsulation).\n"
- title: 5.6.  Handoff Overhead
  contents:
  - "5.6.  Handoff Overhead\n   o  It is imperative to keep the key management overhead\
    \ down to a\n      minimum, in order to support fast handoffs across IP subnets.\n\
    \      Therefore, the solution MUST propose a mechanism to avoid or\n      minimize\
    \ IPsec tunnel SA renegotiation and IKE renegotiation as\n      the MN changes\
    \ its current point of network attachment.\n"
- title: 5.7.  Scalability, Availability, Reliability, and Performance
  contents:
  - "5.7.  Scalability, Availability, Reliability, and Performance\n   o  The solution\
    \ complexity MUST increase at most linearly with the\n      number of MNs registered\
    \ and accessing resources inside the\n      Intranet.\n   o  The solution MAY\
    \ introduce additional header or tunneling overhead\n      if needed.\n"
- title: 5.8.  Functional Entities
  contents:
  - "5.8.  Functional Entities\n   o  The solution MAY introduce new MIPv4-compliant\
    \ functional\n      entities.\n"
- title: 5.9.  Implications of Intervening NAT Gateways
  contents:
  - "5.9.  Implications of Intervening NAT Gateways\n   o  The solution MUST be able\
    \ to work with the existing MIPv4 and\n      IPsec NAT traversal solutions [RFC3519]\
    \ [RFC3715] [RFC3947].\n"
- title: 5.10.  Security Requirements
  contents:
  - "5.10.  Security Requirements\n   o  The solution MUST provide security that is\
    \ not inferior to what is\n      already provided to existing \"nomadic computing\"\
    \ remote access\n      users; i.e., for confidentiality, authentication, message\n\
    \      integrity, protection against replay attacks, and related security\n  \
    \    services.\n"
- title: 6.  Security Considerations
  contents:
  - "6.  Security Considerations\n   This document describes an existing problem and\
    \ proposes guidelines\n   for possible solutions; as such, its security implications\
    \ are\n   indirect, through the guidelines it proposes for the solutions.\n  \
    \ Section 5.10 gives the relevant security requirements.\n"
- title: 7.  Acknowledgements
  contents:
  - "7.  Acknowledgements\n   The authors who contributed text to this document were,\
    \ in no\n   particular order: Farid Adrangi, Milind Kulkarni, Gopal Dommety, Eli\n\
    \   Gelasco, Qiang Zhang, Sami Vaarala, Dorothy Gellert, Nitsan Baider,\n   and\
    \ Henrik Levkowetz.\n   The authors would like to thank other contributors, especially\n\
    \   Prakash Iyer, Mike Andrews, Ranjit Narjala, Joe Lau, Kent Leung,\n   Alpesh\
    \ Patel, Phil Roberts, Hans Sjostrand, Serge Tessier, Antti\n   Nuopponen, Alan\
    \ O'Neill, Gaetan Feige, and Brijesh Kumar, for their\n   feedback and help in\
    \ improving this document.\n"
- title: 8.  References
  contents:
  - '8.  References

    '
- title: 8.1.  Normative References
  contents:
  - "8.1.  Normative References\n   [RFC3344]  Perkins, C., \"IP Mobility Support\
    \ for IPv4\", RFC 3344,\n              August 2002.\n"
- title: 8.2.  Informative References
  contents:
  - "8.2.  Informative References\n   [RFC1918]  Rekhter, Y., Moskowitz, B., Karrenberg,\
    \ D., de Groot, G.,\n              and E. Lear, \"Address Allocation for Private\
    \ Internets\",\n              BCP 5, RFC 1918, February 1996.\n   [RFC2003]  Perkins,\
    \ C., \"IP Encapsulation within IP\", RFC 2003,\n              October 1996.\n\
    \   [RFC2119]  Bradner, S., \"Key words for use in RFCs to Indicate\n        \
    \      Requirement Levels\", BCP 14, RFC 2119, March 1997.\n   [RFC2131]  Droms,\
    \ R., \"Dynamic Host Configuration Protocol\", RFC\n              2131, March\
    \ 1997.\n   [RFC2401]  Kent, S. and R. Atkinson, \"Security Architecture for the\n\
    \              Internet Protocol\", RFC 2401, November 1998.\n   [RFC3519]  Levkowetz,\
    \ H. and S. Vaarala, \"Mobile IP Traversal of\n              Network Address Translation\
    \ (NAT) Devices\", RFC 3519, May\n              2003.\n   [RFC3715]  Aboba, B.\
    \ and W. Dixon, \"IPsec-Network Address Translation\n              (NAT) Compatibility\
    \ Requirements\", RFC 3715, March 2004.\n   [RFC3947]  Kivinen, T., Swander, B.,\
    \ Huttunen, A., and V. Volpe,\n              \"Negotiation of NAT-Traversal in\
    \ the IKE\", RFC 3947,\n              January 2005.\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Farid Adrangi\n   Intel Corporation\n   2111 N.E. 25th\
    \ Avenue\n   Hillsboro  OR\n   USA\n   Phone: +1 503-712-1791\n   EMail: farid.adrangi@intel.com\n\
    \   Henrik Levkowetz\n   Ericsson Research\n   Torshamsgatan 23\n   SE-164 80\
    \ Stockholm\n   SWEDEN\n   Phone: +46 7 08 32 16 08\n   EMail: henrik@levkowetz.com\n"
- title: Full Copyright Statement
  contents:
  - "Full Copyright Statement\n   Copyright (C) The Internet Society (2005).\n   This\
    \ document is subject to the rights, licenses and restrictions\n   contained in\
    \ BCP 78, and except as set forth therein, the authors\n   retain all their rights.\n\
    \   This document and the information contained herein are provided on an\n  \
    \ \"AS IS\" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS\n  \
    \ OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY AND THE INTERNET\n   ENGINEERING\
    \ TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS OR IMPLIED,\n   INCLUDING BUT NOT\
    \ LIMITED TO ANY WARRANTY THAT THE USE OF THE\n   INFORMATION HEREIN WILL NOT\
    \ INFRINGE ANY RIGHTS OR ANY IMPLIED\n   WARRANTIES OF MERCHANTABILITY OR FITNESS\
    \ FOR A PARTICULAR PURPOSE.\n"
- title: Intellectual Property
  contents:
  - "Intellectual Property\n   The IETF takes no position regarding the validity or\
    \ scope of any\n   Intellectual Property Rights or other rights that might be\
    \ claimed to\n   pertain to the implementation or use of the technology described\
    \ in\n   this document or the extent to which any license under such rights\n\
    \   might or might not be available; nor does it represent that it has\n   made\
    \ any independent effort to identify any such rights.  Information\n   on the\
    \ procedures with respect to rights in RFC documents can be\n   found in BCP 78\
    \ and BCP 79.\n   Copies of IPR disclosures made to the IETF Secretariat and any\n\
    \   assurances of licenses to be made available, or the result of an\n   attempt\
    \ made to obtain a general license or permission for the use of\n   such proprietary\
    \ rights by implementers or users of this\n   specification can be obtained from\
    \ the IETF on-line IPR repository at\n   http://www.ietf.org/ipr.\n   The IETF\
    \ invites any interested party to bring to its attention any\n   copyrights, patents\
    \ or patent applications, or other proprietary\n   rights that may cover technology\
    \ that may be required to implement\n   this standard.  Please address the information\
    \ to the IETF at ietf-\n   ipr@ietf.org.\n"
- title: Acknowledgement
  contents:
  - "Acknowledgement\n   Funding for the RFC Editor function is currently provided\
    \ by the\n   Internet Society.\n"
