- title: __initial_text__
  contents:
  - '   Using Conditional Router Advertisements for Enterprise Multihoming

    '
- title: Abstract
  contents:
  - "Abstract\n   This document discusses the most common scenarios of connecting\
    \ an\n   enterprise network to multiple ISPs using an address space assigned\n\
    \   by an ISP and how the approach proposed in \"Enterprise Multihoming\n   using\
    \ Provider-Assigned Addresses without Network Prefix Translation:\n   Requirements\
    \ and Solution\" could be applied in those scenarios.  The\n   problem of enterprise\
    \ multihoming without address translation of any\n   form has not been solved\
    \ yet as it requires both the network to\n   select the correct egress ISP based\
    \ on the packet source address and\n   hosts to select the correct source address\
    \ based on the desired\n   egress ISP for that traffic.  The aforementioned document\
    \ proposes a\n   solution to this problem by introducing a new routing functionality\n\
    \   (Source Address Dependent Routing) to solve the uplink selection\n   issue.\
    \  It also proposes using Router Advertisements to influence the\n   host source\
    \ address selection.  It focuses on solving the general\n   problem and covering\
    \ various complex use cases, and this document\n   adopts its proposed approach\
    \ to provide a solution for a limited\n   number of common use cases.  In particular,\
    \ the focus of this\n   document is on scenarios in which an enterprise network\
    \ has two\n   Internet uplinks used either in primary/backup mode or simultaneously\n\
    \   and hosts in that network might not yet properly support multihoming\n   as\
    \ described in RFC 8028.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This document is not an Internet Standards Track specification;\
    \ it is\n   published for informational purposes.\n   This document is a product\
    \ of the Internet Engineering Task Force\n   (IETF).  It represents the consensus\
    \ of the IETF community.  It has\n   received public review and has been approved\
    \ for publication by the\n   Internet Engineering Steering Group (IESG).  Not\
    \ all documents\n   approved by the IESG are candidates for any level of Internet\n\
    \   Standard; see Section 2 of RFC 7841.\n   Information about the current status\
    \ of this document, any errata,\n   and how to provide feedback on it may be obtained\
    \ at\n   https://www.rfc-editor.org/info/rfc8475.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2018 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (https://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.  Code Components\
    \ extracted from this document must\n   include Simplified BSD License text as\
    \ described in Section 4.e of\n   the Trust Legal Provisions and are provided\
    \ without warranty as\n   described in the Simplified BSD License.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1.  Introduction  . . . . . . . . . . . . . . . . . . .\
    \ . . . . .   3\n     1.1.  Requirements Language . . . . . . . . . . . . . .\
    \ . . . .   4\n   2.  Common Enterprise Multihoming Scenarios . . . . . . . .\
    \ . . .   4\n     2.1.  Two ISP Uplinks, Primary and Backup . . . . . . . . .\
    \ . .   4\n     2.2.  Two ISP Uplinks, Used for Load-Balancing  . . . . . . .\
    \ .   5\n   3.  Conditional Router Advertisements . . . . . . . . . . . . . .\
    \   5\n     3.1.  Solution Overview . . . . . . . . . . . . . . . . . . . .  \
    \ 5\n       3.1.1.  Uplink Selection  . . . . . . . . . . . . . . . . . .   5\n\
    \       3.1.2.  Source Address Selection and Conditional RAs  . . . .   5\n  \
    \   3.2.  Example Scenarios . . . . . . . . . . . . . . . . . . . .   8\n    \
    \   3.2.1.  Single Router, Primary/Backup Uplinks . . . . . . . .   8\n      \
    \ 3.2.2.  Two Routers, Primary/Backup Uplinks . . . . . . . . .   9\n       3.2.3.\
    \  Single Router, Load-Balancing between Uplinks . . . .  12\n       3.2.4.  Two\
    \ Routers, Load-Balancing between Uplinks . . . . .  12\n       3.2.5.  Topologies\
    \ with Dedicated Border Routers  . . . . . .  13\n       3.2.6.  Intrasite Communication\
    \ during Simultaneous Uplinks\n               Outage  . . . . . . . . . . . .\
    \ . . . . . . . . . . .  15\n       3.2.7.  Uplink Damping  . . . . . . . . .\
    \ . . . . . . . . . .  15\n       3.2.8.  Routing Packets When the Corresponding\
    \ Uplink Is\n               Unavailable . . . . . . . . . . . . . . . . . . .\
    \ . .  16\n     3.3.  Solution Limitations  . . . . . . . . . . . . . . . . .\
    \ .  16\n       3.3.1.  Connections Preservation  . . . . . . . . . . . . . .\
    \  17\n   4.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .  17\n\
    \   5.  Security Considerations . . . . . . . . . . . . . . . . . . .  18\n  \
    \   5.1.  Privacy Considerations  . . . . . . . . . . . . . . . . .  18\n   6.\
    \  References  . . . . . . . . . . . . . . . . . . . . . . . . .  18\n     6.1.\
    \  Normative References  . . . . . . . . . . . . . . . . . .  18\n     6.2.  Informative\
    \ References  . . . . . . . . . . . . . . . . .  20\n   Acknowledgements  . .\
    \ . . . . . . . . . . . . . . . . . . . . . .  20\n   Authors' Addresses  . .\
    \ . . . . . . . . . . . . . . . . . . . . .  21\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   Multihoming is an obvious requirement for many enterprise\
    \ networks to\n   ensure the desired level of network reliability.  However, using\
    \ more\n   than one ISP (and address space assigned by those ISPs) introduces\n\
    \   the problem of assigning IP addresses to hosts.  In IPv4, there is no\n  \
    \ choice but using address space [RFC1918] and NAT [RFC3022] at the\n   network\
    \ edge [RFC4116].  Using Provider Independent (PI) address\n   space is not always\
    \ an option, since it requires running BGP between\n   the enterprise network\
    \ and the ISPs.  The administrative overhead of\n   obtaining and managing PI\
    \ address space can also be a concern.  As\n   IPv6 hosts can, by design, have\
    \ multiple addresses of the global\n   scope [RFC4291], multihoming using provider\
    \ addresses looks even\n   easier for IPv6: each ISP assigns an IPv6 block (usually\
    \ /48), and\n   hosts in the enterprise network have addresses assigned from each\
    \ ISP\n   block.  However, using IPv6 provider-assigned (PA) blocks in a\n   multihoming\
    \ scenario introduces some challenges, including, but not\n   limited to:\n  \
    \ o  Selecting the correct uplink based on the packet source address;\n   o  Signaling\
    \ to hosts that some source addresses should or should not\n      be used (e.g.,\
    \ an uplink to the ISP went down or became available\n      again).\n   [PROVIDER-ASSIGNED]\
    \ discusses these and other related challenges in\n   detail in relation to the\
    \ general multihoming scenario for enterprise\n   networks.  It proposes a solution\
    \ that relies heavily on Rule 5.5 of\n   the default address selection algorithm\
    \ [RFC6724].  Rule 5.5 makes\n   hosts prefer source addresses in a prefix advertised\
    \ by the next hop\n   and, therefore, is very useful in multihomed scenarios when\
    \ different\n   routers may advertise different prefixes.  While [RFC6724] defines\n\
    \   Rule 5.5 as optional, the recent [RFC8028] recommends that multihomed\n  \
    \ hosts SHOULD support it.  Unfortunately, that rule has not been\n   widely implemented\
    \ at the time of writing.  Therefore, network\n   administrators in enterprise\
    \ networks can't yet assume that all\n   devices in their network support Rule\
    \ 5.5, especially in the quite\n   common BYOD (\"Bring Your Own Device\") scenario.\
    \  However, while it\n   does not seem feasible to solve all the possible multihoming\n\
    \   scenarios without relying on Rule 5.5, it is possible to provide IPv6\n  \
    \ multihoming using PA address space for the most common use cases.\n   This document\
    \ discusses how the general approach described in\n   [PROVIDER-ASSIGNED] can\
    \ be applied to solve multihoming scenarios\n   when:\n   o  An enterprise network\
    \ has two or more ISP uplinks;\n   o  Those uplinks are used for Internet access\
    \ in active/backup or\n      load-sharing mode without any sophisticated traffic\
    \ engineering\n      requirements;\n   o  Each ISP assigns the network a subnet\
    \ from its own PA address\n      space; and\n   o  Hosts in the enterprise network\
    \ are not expected to support Rule\n      5.5 of the default address selection\
    \ algorithm [RFC6724].\n"
- title: 1.1.  Requirements Language
  contents:
  - "1.1.  Requirements Language\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\"\
    , \"SHALL\", \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"\
    NOT RECOMMENDED\", \"MAY\", and\n   \"OPTIONAL\" in this document are to be interpreted\
    \ as described in\n   BCP 14 [RFC2119] [RFC8174] when, and only when, they appear\
    \ in all\n   capitals, as shown here.\n"
- title: 2.  Common Enterprise Multihoming Scenarios
  contents:
  - '2.  Common Enterprise Multihoming Scenarios

    '
- title: 2.1.  Two ISP Uplinks, Primary and Backup
  contents:
  - "2.1.  Two ISP Uplinks, Primary and Backup\n   This scenario has the following\
    \ key characteristics:\n   o  The enterprise network uses uplinks to two (or more)\
    \ ISPs for\n      Internet access;\n   o  Each ISP assigns IPv6 PA address space\
    \ for the network;\n   o  Uplink(s) to one ISP is a primary (preferred) one. \
    \ All other\n      uplinks are backup and are not expected to be used while the\n\
    \      primary one is operational;\n   o  If the primary uplink is operational,\
    \ all Internet traffic should\n      flow via that uplink;\n   o  When the primary\
    \ uplink fails, the Internet traffic needs to flow\n      via the backup uplinks;\n\
    \   o  Recovery of the primary uplink needs to trigger the traffic\n      switchover\
    \ from the backup uplinks back to the primary one;\n   o  Hosts in the enterprise\
    \ network are not expected to support Rule\n      5.5 of the default address selection\
    \ algorithm [RFC6724].\n"
- title: 2.2.  Two ISP Uplinks, Used for Load-Balancing
  contents:
  - "2.2.  Two ISP Uplinks, Used for Load-Balancing\n   This scenario has the following\
    \ key characteristics:\n   o  The enterprise network is using uplinks to two (or\
    \ more) ISPs for\n      Internet access;\n   o  Each ISP assigns an IPv6 PA address\
    \ space;\n   o  All the uplinks may be used simultaneously, with the traffic flows\n\
    \      being randomly (not necessarily equally) distributed between them;\n  \
    \ o  Hosts in the enterprise network are not expected to support Rule\n      5.5\
    \ of the default address selection algorithm [RFC6724].\n"
- title: 3.  Conditional Router Advertisements
  contents:
  - '3.  Conditional Router Advertisements

    '
- title: 3.1.  Solution Overview
  contents:
  - '3.1.  Solution Overview

    '
- title: 3.1.1.  Uplink Selection
  contents:
  - "3.1.1.  Uplink Selection\n   As discussed in [PROVIDER-ASSIGNED], one of the\
    \ two main problems to\n   be solved in the enterprise multihoming scenario is\
    \ the problem of\n   the next-hop (uplink) selection based on the packet source\
    \ address.\n   For example, if the enterprise network has two uplinks, to ISP_A\
    \ and\n   ISP_B, and hosts have addresses from subnet_A and subnet_B (belonging\n\
    \   to ISP_A and ISP_B, respectively), then packets sourced from subnet_A\n  \
    \ must be sent to the ISP_A uplink while packets sourced from subnet_B\n   must\
    \ be sent to the ISP_B uplink.  Sending packets with source\n   addresses belonging\
    \ to one ISP address space to another ISP might\n   cause those packets to be\
    \ filtered out if those ISPs or their uplinks\n   implement antispoofing ingress\
    \ filtering [RFC2827][RFC3704].\n   While some work is being done in the Source\
    \ Address Dependent Routing\n   (SADR) (such as [DESTINATION]), the simplest way\
    \ to implement the\n   desired functionality currently is to apply a policy that\
    \ selects a\n   next hop or an egress interface based on the packet source address.\n\
    \   Currently, most SMB/Enterprise-grade routers have such functionality\n   available.\n"
- title: 3.1.2.  Source Address Selection and Conditional RAs
  contents:
  - "3.1.2.  Source Address Selection and Conditional RAs\n   Another problem to be\
    \ solved in the multihoming scenario is the\n   source address selection on hosts.\
    \  In the normal situation (all\n   uplinks are up/operational), hosts have multiple\
    \ global unique\n   addresses and can rely on the default address selection algorithm\n\
    \   [RFC6724] to pick up a source address, while the network is\n   responsible\
    \ for choosing the correct uplink based on the source\n   address selected by\
    \ a host, as described in Section 3.1.1.  However,\n   some network topology changes\
    \ (i.e., changing uplink status) might\n   affect the global reachability for\
    \ packets sourced from particular\n   prefixes; therefore, such changes have to\
    \ be signaled back to the\n   hosts.  For example:\n   o  An uplink to ISP_A went\
    \ down.  Hosts should not use addresses from\n      an ISP_A prefix;\n   o  A\
    \ primary uplink to ISP_A that was not operational has come back\n      up.  Hosts\
    \ should start using the source addresses from an ISP_A\n      prefix.\n   [PROVIDER-ASSIGNED]\
    \ provides a detailed explanation of why Stateless\n   Address Autoconfiguration\
    \ (SLAAC) [RFC4862] and Router Advertisements\n   (RAs) [RFC4861] are the most\
    \ suitable mechanisms for signaling\n   network topology changes to hosts, thereby\
    \ influencing the source\n   address selection.  Sending an RA to change the preferred\
    \ lifetime\n   for a given prefix provides the following functionality:\n   o\
    \  Deprecating addresses by sending an RA with preferred_lifetime set\n      to\
    \ 0 in the corresponding Prefix Information option (PIO)\n      [RFC4861].  This\
    \ indicates to hosts that addresses from that\n      prefix should not be used;\n\
    \   o  Making a previously unused (deprecated) prefix usable again by\n      sending\
    \ an RA containing a PIO with nonzero preferred lifetime.\n      This indicates\
    \ to hosts that addresses from that prefix can be\n      used again.\n   It should\
    \ be noted that only the preferred lifetime for the affected\n   prefix needs\
    \ to be changed.  As the goal is to influence the source\n   address selection\
    \ algorithm on hosts rather than prevent them from\n   forming addresses from\
    \ a specific prefix, the valid lifetime should\n   not be changed.  Actually,\
    \ changing the valid lifetime would not even\n   be possible for unauthenticated\
    \ RAs (which is the most common\n   deployment scenario), because Section 5.5.3\
    \ of [RFC4862] prevents\n   hosts from setting the valid lifetime for addresses\
    \ to zero unless\n   RAs are authenticated.\n   To provide the desired functionality,\
    \ first-hop routers are required\n   to:\n   o  Send RAs triggered by defined\
    \ event policies in response to an\n      uplink status change event; and\n  \
    \ o  While sending periodic or solicited RAs, set the value in the\n      given\
    \ RA field (e.g., PIO preferred lifetime) based on the uplink\n      status.\n\
    \   The exact definition of the \"uplink status\" depends on the network\n   topology\
    \ and may include conditions like:\n   o  Uplink interface status change;\n  \
    \ o  Presence of a particular route in the routing table;\n   o  Presence of a\
    \ particular route with a particular attribute (next\n      hop, tag, etc.) in\
    \ the routing table;\n   o  Protocol adjacency change.\n   In some scenarios,\
    \ when two routers are providing first-hop\n   redundancy via Virtual Router Redundancy\
    \ Protocol (VRRP) [RFC5798],\n   the master-backup status can be considered to\
    \ be a condition for\n   sending RAs and changing the preferred lifetime value.\
    \  See\n   Section 3.2.2 for more details.\n   If hosts are provided with the\
    \ IPv6 addresses of ISP DNS servers via\n   a Recursive DNS Server (RDNSS) (see\
    \ \"IPv6 Router Advertisement\n   Options for DNS Configuration\" [RFC8106]),\
    \ it might be desirable for\n   the conditional RAs to update the Lifetime field\
    \ of the RDNSS option\n   as well.\n   The trigger is not only forcing the router\
    \ to send an unsolicited RA\n   to propagate the topology changes to all hosts.\
    \  Obviously, the\n   values of the RA fields (like PIO Preferred Lifetime or\
    \ DNS Server\n   Lifetime) changed by the particular trigger need to stay the\
    \ same\n   until another event causes the value to be updated.  For example, if\n\
    \   an ISP_A uplink failure causes the prefix to be deprecated, all\n   solicited\
    \ and unsolicited RAs sent by the router need to have the\n   preferred lifetime\
    \ for that PIO set to 0 until the uplink comes back\n   up.\n   It should be noted\
    \ that the proposed solution is quite similar to the\n   existing requirement\
    \ L-13 for IPv6 Customer Edge Routers [RFC7084]\n   and the documented behavior\
    \ of homenet devices [RFC7788].  It is\n   using the same mechanism of deprecating\
    \ a prefix when the\n   corresponding uplink is not operational, applying it to\
    \ an\n   enterprise-network scenario.\n"
- title: 3.2.  Example Scenarios
  contents:
  - "3.2.  Example Scenarios\n   This section illustrates how the conditional RAs\
    \ solution can be\n   applied to the most common enterprise multihoming scenarios,\n\
    \   described in Section 2.\n"
- title: 3.2.1.  Single Router, Primary/Backup Uplinks
  contents:
  - "3.2.1.  Single Router, Primary/Backup Uplinks\n                             \
    \                                 --------\n                                 \
    \            ,-------,       /        \\\n                   +----+ 2001:db8:1::/48\
    \  ,'         ',    :          :\n                   |    |-----------------+\
    \    ISP_A    +--+:          :\n 2001:db8:1:1::/64 |    |                  ',\
    \         ,'    :          :\n                   |    |                    '-------'\
    \      :          :\n"
- title: 'H1-----------------| R1 |                                   : INTERNET :'
  contents:
  - "H1-----------------| R1 |                                   : INTERNET :\n  \
    \                 |    |                    ,-------,      :          :\n 2001:db8:2:1::/64\
    \ |    | 2001:db8:2::/48  ,'         ',    :          :\n                   |\
    \    |-----------------+    ISP_B    +--+:          :\n                   +----+\
    \                  ',         ,'    :          :\n                           \
    \                  '-------'       \\        /\n                             \
    \                                 --------\n              Figure 1: Single Router,\
    \ Primary/Backup Uplinks\n   Let's look at a simple network topology where a single\
    \ router acts as\n   a border router to terminate two ISP uplinks and as a first-hop\n\
    \   router for hosts.  Each ISP assigns a /48 to the network, and the\n   ISP_A\
    \ uplink is a primary one, to be used for all Internet traffic,\n   while the\
    \ ISP_B uplink is a backup, to be used only when the primary\n   uplink is not\
    \ operational.\n   To ensure that packets with source addresses from ISP_A and\
    \ ISP_B are\n   only routed to ISP_A and ISP_B uplinks, respectively, the network\n\
    \   administrator needs to configure a policy on R1:\n   IF (packet_source_address\
    \ is in 2001:db8:1::/48)\n       and\n       (packet_destination_address is not\
    \ in\n       (2001:db8:1::/48 or 2001:db8:2::/48))\n       THEN\n           default\
    \ next hop is ISP_A_uplink\n   IF (packet_source_address is in 2001:db8:2::/48)\n\
    \       and\n       (packet_destination_address is not in\n       (2001:db8:1::/48\
    \ or 2001:db8:2::/48))\n       THEN\n           default next hop is ISP_B_uplink\n\
    \   Under normal circumstances, it is desirable that all traffic be sent\n   via\
    \ the ISP_A uplink; therefore, hosts (the host H1 in the example\n   topology\
    \ figure) should be using source addresses from\n   2001:db8:1:1::/64.  When or\
    \ if the ISP_A uplink fails, hosts should\n   stop using the 2001:db8:1:1::/64\
    \ prefix and start using\n   2001:db8:2:1::/64 until the ISP_A uplink comes back\
    \ up.  To achieve\n   this, the RA configuration on the R1 device for the interface\
    \ facing\n   H1 needs to have the following policy:\n   prefix 2001:db8:1:1::/64\
    \ {\n       IF (ISP_A_uplink is up)\n           THEN\n               preferred_lifetime\
    \ = 604800\n           ELSE\n               preferred_lifetime = 0\n   }\n   prefix\
    \ 2001:db8:2:1::/64 {\n       IF (ISP_A_Uplink is up)\n           THEN\n     \
    \          preferred_lifetime = 0\n           ELSE\n               preferred_lifetime\
    \ = 604800\n   }\n   A similar policy needs to be applied to the RDNSS lifetime\
    \ if ISP_A\n   and ISP_B DNS servers are used.\n"
- title: 3.2.2.  Two Routers, Primary/Backup Uplinks
  contents:
  - "3.2.2.  Two Routers, Primary/Backup Uplinks\n   Let's look at a more complex\
    \ scenario where two border routers are\n   terminating two ISP uplinks (one each),\
    \ acting as redundant first-hop\n   routers for hosts.  The topology is shown\
    \ in Figure 2.\n                                                             \
    \ --------\n                                             ,-------,       /   \
    \     \\\n  2001:db8:1:1::/64 +----+ 2001:db8:1::/48 ,'         ',    :      \
    \    :\n                   _|    |----------------+    ISP_A    +--+:        \
    \  :\n                  | | R1 |                 ',         ,'    :          :\n\
    \                  | +----+                   '-------'      :          :\n"
- title: 'H1----------------|                                         : INTERNET :'
  contents:
  - "H1----------------|                                         : INTERNET :\n  \
    \                | +----+                   ,-------,      :          :\n    \
    \              |_|    | 2001:db8:2::/48 ,'         ',    :          :\n      \
    \              | R2 |----------------+    ISP_B    +--+:          :\n 2001:db8:2:1::/64\
    \  +----+                 ',         ,'    :          :\n                    \
    \                         '-------'       \\        /\n                      \
    \                                        --------\n               Figure 2: Two\
    \ Routers, Primary/Backup Uplinks\n   In this scenario, R1 sends RAs with PIO\
    \ for 2001:db8:1:1::/64 (ISP_A\n   address space), and R2 sends RAs with PIO for\
    \ 2001:db8:2:1::/64\n   (ISP_B address space).  Each router needs to have a forwarding\
    \ policy\n   configured for packets received on its hosts-facing interface:\n\
    \   IF (packet_source_address is in 2001:db8:1::/48)\n       and\n       (packet_destination_address\
    \ is not in\n       (2001:db8:1::/48 or 2001:db8:2::/48))\n       THEN\n     \
    \      default next hop is ISP_A_uplink\n   IF (packet_source_address is in 2001:db8:2::/48)\n\
    \       and\n       (packet_destination_address is not in\n       (2001:db8:1::/48\
    \ or 2001:db8:2::/48))\n       THEN\n           default next hop is ISP_B_uplink\n\
    \   In this case, there is more than one way to ensure that hosts are\n   selecting\
    \ the correct source address based on the uplink status.  If\n   VRRP is used\
    \ to provide first-hop redundancy, and the master router\n   is the one with the\
    \ active uplink, then the simplest way is to use\n   the VRRP mastership as a\
    \ condition for RA.  So, if ISP_A is the\n   primary uplink, the routers R1 and\
    \ R2 need to be configured in the\n   following way:\n   R1 is the VRRP master\
    \ by default (when the ISP_A uplink is up).  If\n   the ISP_A uplink is down,\
    \ then R1 becomes a backup (the VRRP\n   interface-status tracking is expected\
    \ to be used to automatically\n   modify the VRRP priorities and trigger the mastership\
    \ switchover).\n   RAs on R1's interface facing H1 needs to have the following\
    \ policy\n   applied:\n   prefix 2001:db8:1:1::/64 {\n       IF (vrrp_master)\n\
    \           THEN\n               preferred_lifetime = 604800\n           ELSE\n\
    \               preferred_lifetime = 0\n   }\n   R2 is VRRP backup by default.\
    \  RA on R2's interface facing H1 needs\n   to have the following policy applied:\n\
    \   prefix 2001:db8:2:1::/64 {\n       IF(vrrp_master)\n           THEN\n    \
    \           preferred_lifetime = 604800\n           ELSE\n               preferred_lifetime\
    \ = 0\n   }\n   If VRRP is not used or interface status tracking is not used for\n\
    \   mastership switchover, then each router needs to be able to detect\n   the\
    \ uplink failure/recovery on the neighboring router, so that RAs\n   with updated\
    \ preferred lifetime values are triggered.  Depending on\n   the network setup,\
    \ various triggers can be used, such as a route to\n   the uplink interface subnet\
    \ or a default route received from the\n   uplink.  The obvious drawback of using\
    \ the routing table to trigger\n   the conditional RAs is that some additional\
    \ configuration is\n   required.  For example, if a route to the prefix assigned\
    \ to the ISP\n   uplink is used as a trigger, then the conditional RA policy would\n\
    \   have the following logic:\n   R1:\n   prefix 2001:db8:1:1::/64 {\n       IF\
    \ (ISP_A_uplink is up)\n           THEN\n               preferred_lifetime = 604800\n\
    \           ELSE\n              preferred_lifetime = 0\n   }\n   R2:\n   prefix\
    \ 2001:db8:2:1::/64 {\n       IF (ISP_A_uplink_route is present)\n           THEN\n\
    \               preferred_lifetime = 0\n           ELSE\n               preferred_lifetime\
    \ = 604800\n   }\n"
- title: 3.2.3.  Single Router, Load-Balancing between Uplinks
  contents:
  - "3.2.3.  Single Router, Load-Balancing between Uplinks\n   Let's look at the example\
    \ topology shown in Figure 1, but with both\n   uplinks used simultaneously. \
    \ In this case, R1 would send RAs\n   containing PIOs for both prefixes, 2001:db8:1:1::/64\
    \ and\n   2001:db8:2:1::/64, changing the preferred lifetime based on\n   particular\
    \ uplink availability.  If the interface status is used as\n   an uplink availability\
    \ indicator, then the policy logic would look\n   like the following:\n   prefix\
    \ 2001:db8:1:1::/64 {\n       IF (ISP_A_uplink is up)\n           THEN\n     \
    \          preferred_lifetime  = 604800\n           ELSE\n               preferred_lifetime\
    \ = 0\n   }\n   prefix 2001:db8:2:1::/64 {\n       IF (ISP_B_uplink is up)\n \
    \          THEN\n               preferred_lifetime  = 604800\n           ELSE\n\
    \               preferred_lifetime = 0\n   }\n   R1 needs a forwarding policy\
    \ to be applied to forward packets to the\n   correct uplink based on the source\
    \ address, similar to the policy\n   described in Section 3.2.1.\n"
- title: 3.2.4.  Two Routers, Load-Balancing between Uplinks
  contents:
  - "3.2.4.  Two Routers, Load-Balancing between Uplinks\n   In this scenario, the\
    \ example topology is similar to the one shown in\n   Figure 2, but both uplinks\
    \ can be used at the same time.  This means\n   that both R1 and R2 need to have\
    \ the corresponding forwarding policy\n   to forward packets based on their source\
    \ addresses.\n   Each router would send RAs with PIO for the corresponding prefix,\n\
    \   setting preferred_lifetime to a nonzero value when the ISP uplink is\n   up\
    \ and deprecating the prefix by setting preferred_lifetime to 0 in\n   the case\
    \ of uplink failure.  The uplink recovery would trigger\n   another RA with a\
    \ nonzero preferred lifetime to make the addresses\n   from the prefix preferred\
    \ again.  The example RA policy on R1 and R2\n   would look like:\n   R1:\n  \
    \ prefix 2001:db8:1:1::/64 {\n       IF (ISP_A_uplink is up)\n           THEN\n\
    \               preferred_lifetime  = 604800\n           ELSE\n              \
    \ preferred_lifetime = 0\n   }\n   R2:\n   prefix 2001:db8:2:1::/64 {\n      \
    \ IF (ISP_B_uplink is up)\n           THEN\n               preferred_lifetime\
    \  = 604800\n           ELSE\n               preferred_lifetime = 0\n   }\n"
- title: 3.2.5.  Topologies with Dedicated Border Routers
  contents:
  - "3.2.5.  Topologies with Dedicated Border Routers\n   For simplicity, all topologies\
    \ above show the ISP uplinks terminated\n   on the first-hop routers.  Obviously,\
    \ the proposed approach can be\n   used in more complex topologies when dedicated\
    \ devices are used for\n   terminating ISP uplinks.  In that case, VRRP mastership\
    \ or interface\n   status cannot be used as a trigger for conditional RAs.  Route\n\
    \   presence as described in Section 3.2.2 should be used instead.\n   Let's look\
    \ at the example topology shown in Figure 3:\n                               \
    \ 2001:db8:1::/48              --------\n    2001:db8:1:1::/64               \
    \      ,-------,        ,'        ',\n              +----+  +---+  +----+    \
    \ ,'         ',     :            :\n             _|    |--|   |--| R3 |----+ \
    \   ISP_A    +---+:            :\n            | | R1 |  |   |  +----+     ', \
    \        ,'     :            :\n            | +----+  |   |               '-------'\
    \       :            :\n  H1--------|         |LAN|                          \
    \     :  INTERNET  :\n            | +----+  |   |               ,-------,    \
    \   :            :\n            |_|    |  |   |  +----+     ,'         ',    \
    \ :            :\n              | R2 |--|   |--| R4 |----+    ISP_B    +---+:\
    \            :\n              +----+  +---+  +----+     ',         ,'     :  \
    \          :\n  2001:db8:2:1::/64                       '-------'        ',  \
    \      ,'\n                                2001:db8:2::/48              --------\n\
    \                    Figure 3: Dedicated Border Routers\n   For example, if ISP_A\
    \ is a primary uplink and ISP_B is a backup, then\n   the following policy might\
    \ be used to achieve the desired behavior\n   (H1 is using ISP_A address space,\
    \ 2001:db8:1:1::/64, while the ISP_A\n   uplink is up and only using the ISP_B\
    \ 2001:db8:2:1::/64 prefix if the\n   uplink is non-operational):\n   R1 and R2\
    \ policy:\n   prefix 2001:db8:1:1::/64 {\n       IF (ISP_A_uplink_route is present)\n\
    \           THEN\n               preferred_lifetime = 604800\n           ELSE\n\
    \               preferred_lifetime = 0\n   }\n   prefix 2001:db8:2:1::/64 {\n\
    \       IF (ISP_A_uplink_route is present)\n           THEN\n               preferred_lifetime\
    \ = 0\n           ELSE\n               preferred_lifetime = 604800\n   }\n   For\
    \ the load-balancing case, the policy would look slightly\n   different: each\
    \ prefix has a nonzero preferred_lifetime only if the\n   corresponding ISP uplink\
    \ route is present:\n   prefix 2001:db8:1:1::/64 {\n       IF (ISP_A_uplink_route\
    \ is present)\n           THEN\n               preferred_lifetime = 604800\n \
    \          ELSE\n               preferred_lifetime = 0\n   }\n   prefix 2001:db8:2:1::/64\
    \ {\n       IF (ISP_B_uplink_route is present)\n           THEN\n            \
    \   preferred_lifetime = 604800\n           ELSE\n               preferred_lifetime\
    \ = 0\n   }\n"
- title: 3.2.6.  Intrasite Communication during Simultaneous Uplinks Outage
  contents:
  - "3.2.6.  Intrasite Communication during Simultaneous Uplinks Outage\n   Prefix\
    \ deprecation as a result of an uplink status change might lead\n   to a situation\
    \ in which all global prefixes are deprecated (all ISP\n   uplinks are not operational\
    \ for some reason).  Even when there is no\n   Internet connectivity, it might\
    \ be still desirable to have intrasite\n   IPv6 connectivity (especially when\
    \ the network in question is an\n   IPv6-only one).  However, while an address\
    \ is in a deprecated state,\n   its use is discouraged, but not strictly forbidden\
    \ [RFC4862].  In\n   such a scenario, all IPv6 source addresses in the candidate\
    \ set\n   [RFC6724] are deprecated, which means that they still can be used (as\n\
    \   there are no preferred addresses available), and the source address\n   selection\
    \ algorithm can pick up one of them, allowing intrasite\n   communication.  However,\
    \ some operating systems might just fall back\n   to IPv4 if the network interface\
    \ has no preferred IPv6 global\n   addresses.  Therefore, if intrasite connectivity\
    \ is vital during\n   simultaneous outages of multiple uplinks, administrators\
    \ might\n   consider using Unique Local Addresses (ULAs) [RFC4193] or\n   provisioning\
    \ additional backup uplinks to protect the network from\n   double-failure cases.\n"
- title: 3.2.7.  Uplink Damping
  contents:
  - "3.2.7.  Uplink Damping\n   If an actively used uplink (a primary one or one used\
    \ in a load-\n   balancing scenario) starts flapping, it might lead to the undesirable\n\
    \   situation of flapping addresses on hosts: every time the uplink goes\n   up,\
    \ hosts receive an RA with a nonzero preferred PIO lifetime, and\n   every time\
    \ the uplink goes down, all addresses in the affected prefix\n   become deprecated.\
    \  This would, undoubtedly, negatively impact the\n   user experience, not to\
    \ mention the impact of spikes of duplicate\n   address detection traffic every\
    \ time an uplink comes back up.\n   Therefore, it's recommended that router vendors\
    \ implement some form\n   of damping policy for conditional RAs and either postpone\
    \ sending an\n   RA with a nonzero lifetime for a PIO when the uplink comes up\
    \ for a\n   number of seconds or (even) introduce accumulated penalties/\n   exponential\
    \ backoff algorithm for such delays.  (In the case of\n   multiple simultaneous\
    \ uplink failure, when all but one of the uplinks\n   are down and the last remaining\
    \ one is flapping, it might result in\n   all addresses being deprecated for a\
    \ while after the flapping uplink\n   recovers.)\n"
- title: 3.2.8.  Routing Packets When the Corresponding Uplink Is Unavailable
  contents:
  - "3.2.8.  Routing Packets When the Corresponding Uplink Is Unavailable\n   Deprecating\
    \ IPv6 addresses by setting the preferred lifetime to 0\n   discourages but does\
    \ not strictly forbid its usage in new\n   communications.  A deprecated address\
    \ may still be used for existing\n   connections [RFC4862].  Therefore, when an\
    \ ISP uplink goes down, the\n   corresponding border router might still receive\
    \ packets with source\n   addresses belonging to that ISP address space while\
    \ there is no\n   available uplink to send those packets to.\n   The expected\
    \ router behavior would depend on the uplink selection\n   mechanism.  For example,\
    \ if some form of SADR is used, then such\n   packets will be dropped as there\
    \ is no route to the destination.  If\n   policy-based routing is used to set\
    \ a next hop, then the behavior\n   would be implementation dependent and may\
    \ vary from dropping the\n   packets to forwarding them based on the routing table\
    \ entries.  It\n   should be noted that there is no return path to the packet\
    \ source (as\n   the ISP uplink is not operational).  Therefore, even if the outgoing\n\
    \   packets are sent to another ISP, the return traffic might not be\n   delivered.\n"
- title: 3.3.  Solution Limitations
  contents:
  - "3.3.  Solution Limitations\n   It should be noted that the proposed approach\
    \ is not a \"silver\n   bullet\" for all possible multihoming scenarios.  It would\
    \ work very\n   well for networks with relatively simple topologies and\n   straightforward\
    \ routing policies.  The more complex the network\n   topology and the corresponding\
    \ routing policies, the more\n   configuration would be required to implement\
    \ the solution.\n   Another limitation is related to the load-balancing between\
    \ the\n   uplinks.  In the scenario in which both uplinks are active, hosts\n\
    \   would select the source prefix using the Default Address Selection\n   algorithm\
    \ [RFC6724]; therefore, the load between two uplinks most\n   likely would not\
    \ be evenly distributed.  (However, the proposed\n   mechanism does allow a creative\
    \ way of controlling uplinks load in\n   software-defined networks where controllers\
    \ might selectively\n   deprecate prefixes on some hosts but not others to move\
    \ egress\n   traffic between uplinks).  Also, the prefix selection does not take\n\
    \   into account any other properties of uplinks (such as latency), so\n   egress\
    \ traffic might not be sent to the nearest uplink if the\n   corresponding prefix\
    \ is selected as a source.  In general, if not all\n   uplinks are equal, and\
    \ some uplinks are expected to be preferred over\n   others, then the network\
    \ administrator should ensure that prefixes\n   from non-preferred ISP(s) are\
    \ kept deprecated (so primary/backup\n   setup is used).\n"
- title: 3.3.1.  Connections Preservation
  contents:
  - "3.3.1.  Connections Preservation\n   The proposed solution is not designed to\
    \ preserve connection state\n   after an uplink failure.  If all uplinks to an\
    \ ISP go down, all\n   sessions to/from addresses from that ISP address space\
    \ are\n   interrupted as there is no egress path for those packets and there is\n\
    \   no return path from the Internet to the corresponding prefix.  In\n   this\
    \ regard, it is similar to IPv4 multihoming using NAT, where an\n   uplink failure\
    \ and failover to another uplink means that a public\n   IPv4 address changes\
    \ and all existing connections are interrupted.\n   However, an uplink recovery\
    \ does not necessarily lead to connections\n   interruption.  In the load-sharing/balancing\
    \ scenario, an uplink\n   recovery does not affect any existing connections at\
    \ all.  In the\n   active/backup topology, when the primary uplink recovers from\
    \ the\n   failure and the backup prefix is deprecated, the existing sessions\n\
    \   (established to/from the backup ISP addresses) can be preserved if\n   the\
    \ routers are configured as described in Section 3.2.1 and send\n   packets with\
    \ the backup ISP source addresses to the backup uplink,\n   even when the primary\
    \ one is operational.  As a result, the primary\n   uplink recovery makes the\
    \ usage of the backup ISP addresses\n   discouraged but still possible.\n   It\
    \ should be noted that in IPv4 multihoming with NAT, when the egress\n   interface\
    \ is chosen without taking packet source address into account\n   (as internal\
    \ hosts usually have addresses from [RFC1918] space),\n   sessions might not be\
    \ preserved after an uplink recovery unless\n   packet forwarding is integrated\
    \ with existing NAT sessions tracking.\n"
- title: 4.  IANA Considerations
  contents:
  - "4.  IANA Considerations\n   This document has no IANA actions.\n"
- title: 5.  Security Considerations
  contents:
  - "5.  Security Considerations\n   This memo introduces no new security considerations.\
    \  It relies on\n   RAs [RFC4861] and the SLAAC [RFC4862] mechanism and inherits\
    \ their\n   security properties.  If an attacker is able to send a rogue RA, they\n\
    \   could deprecate IPv6 addresses on hosts or influence source-address-\n   selection\
    \ processes on hosts.\n   The potential attack vectors include, but are not limited\
    \ to:\n   o  An attacker sends a rogue RA deprecating IPv6 addresses on hosts;\n\
    \   o  An attacker sends a rogue RA making addresses preferred while the\n   \
    \   corresponding ISP uplink is not operational;\n   o  An attacker sends a rogue\
    \ RA making addresses preferred for a\n      backup ISP, steering traffic to an\
    \ undesirable (e.g., more\n      expensive) uplink.\n   Therefore, the network\
    \ administrators SHOULD secure RAs, e.g., by\n   deploying an RA guard [RFC6105].\n"
- title: 5.1.  Privacy Considerations
  contents:
  - "5.1.  Privacy Considerations\n   This memo introduces no new privacy considerations.\n"
- title: 6.  References
  contents:
  - '6.  References

    '
- title: 6.1.  Normative References
  contents:
  - "6.1.  Normative References\n   [RFC1918]  Rekhter, Y., Moskowitz, B., Karrenberg,\
    \ D., de Groot, G.,\n              and E. Lear, \"Address Allocation for Private\
    \ Internets\",\n              BCP 5, RFC 1918, DOI 10.17487/RFC1918, February\
    \ 1996,\n              <https://www.rfc-editor.org/info/rfc1918>.\n   [RFC2119]\
    \  Bradner, S., \"Key words for use in RFCs to Indicate\n              Requirement\
    \ Levels\", BCP 14, RFC 2119,\n              DOI 10.17487/RFC2119, March 1997,\n\
    \              <https://www.rfc-editor.org/info/rfc2119>.\n   [RFC2827]  Ferguson,\
    \ P. and D. Senie, \"Network Ingress Filtering:\n              Defeating Denial\
    \ of Service Attacks which employ IP Source\n              Address Spoofing\"\
    , BCP 38, RFC 2827, DOI 10.17487/RFC2827,\n              May 2000, <https://www.rfc-editor.org/info/rfc2827>.\n\
    \   [RFC3022]  Srisuresh, P. and K. Egevang, \"Traditional IP Network\n      \
    \        Address Translator (Traditional NAT)\", RFC 3022,\n              DOI\
    \ 10.17487/RFC3022, January 2001,\n              <https://www.rfc-editor.org/info/rfc3022>.\n\
    \   [RFC3704]  Baker, F. and P. Savola, \"Ingress Filtering for Multihomed\n \
    \             Networks\", BCP 84, RFC 3704, DOI 10.17487/RFC3704, March\n    \
    \          2004, <https://www.rfc-editor.org/info/rfc3704>.\n   [RFC4116]  Abley,\
    \ J., Lindqvist, K., Davies, E., Black, B., and V.\n              Gill, \"IPv4\
    \ Multihoming Practices and Limitations\",\n              RFC 4116, DOI 10.17487/RFC4116,\
    \ July 2005,\n              <https://www.rfc-editor.org/info/rfc4116>.\n   [RFC4193]\
    \  Hinden, R. and B. Haberman, \"Unique Local IPv6 Unicast\n              Addresses\"\
    , RFC 4193, DOI 10.17487/RFC4193, October 2005,\n              <https://www.rfc-editor.org/info/rfc4193>.\n\
    \   [RFC4291]  Hinden, R. and S. Deering, \"IP Version 6 Addressing\n        \
    \      Architecture\", RFC 4291, DOI 10.17487/RFC4291, February\n            \
    \  2006, <https://www.rfc-editor.org/info/rfc4291>.\n   [RFC4862]  Thomson, S.,\
    \ Narten, T., and T. Jinmei, \"IPv6 Stateless\n              Address Autoconfiguration\"\
    , RFC 4862,\n              DOI 10.17487/RFC4862, September 2007,\n           \
    \   <https://www.rfc-editor.org/info/rfc4862>.\n   [RFC6105]  Levy-Abegnoli, E.,\
    \ Van de Velde, G., Popoviciu, C., and J.\n              Mohacsi, \"IPv6 Router\
    \ Advertisement Guard\", RFC 6105,\n              DOI 10.17487/RFC6105, February\
    \ 2011,\n              <https://www.rfc-editor.org/info/rfc6105>.\n   [RFC6724]\
    \  Thaler, D., Ed., Draves, R., Matsumoto, A., and T. Chown,\n              \"\
    Default Address Selection for Internet Protocol Version 6\n              (IPv6)\"\
    , RFC 6724, DOI 10.17487/RFC6724, September 2012,\n              <https://www.rfc-editor.org/info/rfc6724>.\n\
    \   [RFC8028]  Baker, F. and B. Carpenter, \"First-Hop Router Selection by\n \
    \             Hosts in a Multi-Prefix Network\", RFC 8028,\n              DOI\
    \ 10.17487/RFC8028, November 2016,\n              <https://www.rfc-editor.org/info/rfc8028>.\n\
    \   [RFC8106]  Jeong, J., Park, S., Beloeil, L., and S. Madanapalli,\n       \
    \       \"IPv6 Router Advertisement Options for DNS Configuration\",\n       \
    \       RFC 8106, DOI 10.17487/RFC8106, March 2017,\n              <https://www.rfc-editor.org/info/rfc8106>.\n\
    \   [RFC8174]  Leiba, B., \"Ambiguity of Uppercase vs Lowercase in RFC\n     \
    \         2119 Key Words\", BCP 14, RFC 8174, DOI 10.17487/RFC8174,\n        \
    \      May 2017, <https://www.rfc-editor.org/info/rfc8174>.\n"
- title: 6.2.  Informative References
  contents:
  - "6.2.  Informative References\n   [DESTINATION]\n              Lamparter, D. and\
    \ A. Smirnov, \"Destination/Source\n              Routing\", Work in Progress,\n\
    \              draft-ietf-rtgwg-dst-src-routing-06, October 2017.\n   [PROVIDER-ASSIGNED]\n\
    \              Baker, F., Bowers, C., and J. Linkova, \"Enterprise\n         \
    \     Multihoming using Provider-Assigned Addresses without\n              Network\
    \ Prefix Translation: Requirements and Solution\",\n              Work in Progress,\n\
    \              draft-ietf-rtgwg-enterprise-pa-multihoming-07, June 2018.\n   [RFC4861]\
    \  Narten, T., Nordmark, E., Simpson, W., and H. Soliman,\n              \"Neighbor\
    \ Discovery for IP version 6 (IPv6)\", RFC 4861,\n              DOI 10.17487/RFC4861,\
    \ September 2007,\n              <https://www.rfc-editor.org/info/rfc4861>.\n\
    \   [RFC5798]  Nadas, S., Ed., \"Virtual Router Redundancy Protocol (VRRP)\n \
    \             Version 3 for IPv4 and IPv6\", RFC 5798,\n              DOI 10.17487/RFC5798,\
    \ March 2010,\n              <https://www.rfc-editor.org/info/rfc5798>.\n   [RFC7084]\
    \  Singh, H., Beebee, W., Donley, C., and B. Stark, \"Basic\n              Requirements\
    \ for IPv6 Customer Edge Routers\", RFC 7084,\n              DOI 10.17487/RFC7084,\
    \ November 2013,\n              <https://www.rfc-editor.org/info/rfc7084>.\n \
    \  [RFC7788]  Stenberg, M., Barth, S., and P. Pfister, \"Home Networking\n   \
    \           Control Protocol\", RFC 7788, DOI 10.17487/RFC7788, April\n      \
    \        2016, <https://www.rfc-editor.org/info/rfc7788>.\n"
- title: Acknowledgements
  contents:
  - "Acknowledgements\n   Thanks to the following people (in alphabetical order) for\
    \ their\n   review and feedback: Mikael Abrahamsson, Lorenzo Colitti, Marcus\n\
    \   Keane, Erik Kline, David Lamparter, Dusan Mudric, Erik Nordmark, and\n   Dave\
    \ Thaler.\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Jen Linkova\n   Google\n   Mountain View, California \
    \ 94043\n   United States of America\n   Email: furry@google.com\n   Massimiliano\
    \ Stucchi\n   RIPE NCC\n   Stationsplein, 11\n   Amsterdam  1012 AB\n   The Netherlands\n\
    \   Email: mstucchi@ripe.net\n"
