- contents:
  - '                      Multicast VPN State Damping

    '
  title: __initial_text__
- contents:
  - "Abstract\n   This document describes procedures to damp Multicast VPN (MVPN)\n
    \  routing state changes and control the effect of the churn due to the\n   multicast
    dynamicity in customer sites.  The procedures described in\n   this document are
    applicable to BGP-based multicast VPN and help\n   avoid uncontrolled control-plane
    load increase in the core routing\n   infrastructure.  The new procedures proposed
    were inspired by BGP\n   unicast route damping principles that have been adapted
    to multicast.\n"
  title: Abstract
- contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This
    document is a product of the Internet Engineering Task Force\n   (IETF).  It represents
    the consensus of the IETF community.  It has\n   received public review and has
    been approved for publication by the\n   Internet Engineering Steering Group (IESG).
    \ Further information on\n   Internet Standards is available in Section 2 of RFC
    7841.\n   Information about the current status of this document, any errata,\n
    \  and how to provide feedback on it may be obtained at\n   http://www.rfc-editor.org/info/rfc7899.\n"
  title: Status of This Memo
- contents:
  - "Copyright Notice\n   Copyright (c) 2016 IETF Trust and the persons identified
    as the\n   document authors.  All rights reserved.\n   This document is subject
    to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n
    \  (http://trustee.ietf.org/license-info) in effect on the date of\n   publication
    of this document.  Please review these documents\n   carefully, as they describe
    your rights and restrictions with respect\n   to this document.  Code Components
    extracted from this document must\n   include Simplified BSD License text as described
    in Section 4.e of\n   the Trust Legal Provisions and are provided without warranty
    as\n   described in the Simplified BSD License.\n"
  title: Copyright Notice
- contents:
  - "Table of Contents\n   1.  Introduction  . . . . . . . . . . . . . . . . . . .
    . . . . .   3\n   2.  Terminology . . . . . . . . . . . . . . . . . . . . . .
    . . .   4\n   3.  Overview  . . . . . . . . . . . . . . . . . . . . . . . . .
    .   4\n   4.  Existing Mechanisms . . . . . . . . . . . . . . . . . . . . .   5\n
    \    4.1.  Rate-Limiting Multicast Control Traffic . . . . . . . . .   5\n     4.2.
    \ Existing PIM, IGMP, and MLD Timers  . . . . . . . . . . .   6\n     4.3.  BGP
    Route Damping . . . . . . . . . . . . . . . . . . . .   6\n   5.  Procedures for
    Multicast State Damping  . . . . . . . . . . .   7\n     5.1.  PIM Procedures
    \ . . . . . . . . . . . . . . . . . . . . .   7\n     5.2.  Procedures for Multicast
    VPN State Damping  . . . . . . .  10\n   6.  Procedures for P-Tunnel State Damping
    . . . . . . . . . . . .  12\n     6.1.  Damping MVPN P-Tunnel Change Events .
    . . . . . . . . . .  12\n     6.2.  Procedures for Ethernet VPNs  . . . . . .
    . . . . . . . .  13\n   7.  Operational Considerations  . . . . . . . . . . .
    . . . . . .  13\n     7.1.  Enabling Multicast Damping  . . . . . . . . . . .
    . . . .  13\n     7.2.  Troubleshooting and Monitoring  . . . . . . . . . . .
    . .  13\n     7.3.  Default and Maximum Values  . . . . . . . . . . . . . . .
    \ 13\n   8.  Security Considerations . . . . . . . . . . . . . . . . . . .  15\n
    \  9.  References  . . . . . . . . . . . . . . . . . . . . . . . . .  16\n     9.1.
    \ Normative References  . . . . . . . . . . . . . . . . . .  16\n     9.2.  Informative
    References  . . . . . . . . . . . . . . . . .  17\n   Acknowledgements  . . .
    . . . . . . . . . . . . . . . . . . . . .  17\n   Authors' Addresses  . . . .
    . . . . . . . . . . . . . . . . . . .  18\n"
  title: Table of Contents
- contents:
  - "1.  Introduction\n   In a multicast VPN [RFC6513] deployed with BGP-based procedures\n
    \  [RFC6514], when receivers in VPN sites join and leave a given\n   multicast
    group or channel through multicast membership control\n   protocols (Internet
    Group Management Protocol (IGMP) [RFC3376] and\n   Multicast Listener Discovery
    (MLD) [RFC3810]), multicast routing\n   protocols accordingly adjust multicast
    routing states and P-multicast\n   tree states to forward or prune multicast traffic
    to these receivers.\n   Similar challenges arise in the context of the multicast\n
    \  specification for Virtual Private LAN Service (VPLS) [RFC7117].\n   In VPN
    contexts, providing isolation between customers of a shared\n   infrastructure
    is a core requirement resulting in stringent\n   expectations with regard to risks
    of denial-of-service attacks.\n   By nature, multicast memberships change based
    on the behavior of\n   multicast applications running on end hosts.  Hence, the
    frequency of\n   membership changes can legitimately be much higher than the typical\n
    \  churn of unicast routing states.\n   Therefore, mechanisms need to be put in
    place to ensure that the load\n   put on the BGP control plane, and on the P-tunnel
    setup control\n   plane, remains under control regardless of the frequency at
    which\n   multicast membership changes are made by end hosts.\n   This document
    describes procedures inspired by existing BGP route\n   damping [RFC2439] that
    are aimed at offering means to set an upper\n   bound to the amount of processing
    for the MVPN control-plane\n   protocols: more precisely, the BGP control plane
    in [RFC6514], the\n   P-tunnel control-plane protocol in the contexts of [RFC6514],
    and the\n   multicast specification for VPLS [RFC7117].  The goal of setting this\n
    \  upper bound is pursued simultaneous with the goal of preserving the\n   service
    provided (delivering the multicast stream as requested by\n   Customer Edge devices),
    although at the expense of a minimal increase\n   of average bandwidth use in
    the provider network).  The upper bound\n   to the control-plane load due to the
    processing of a given multicast\n   state is controlled indirectly via configurable
    parameters.\n   Section 16 of [RFC6514] specifically spells out the need for damping\n
    \  the activity of C-multicast and Leaf Auto-discovery routes and\n   outlines
    how to do it by \"delaying the advertisement of withdrawals\n   of C-multicast
    routes\".  This specification provides appropriate\n   detail on how to implement
    this approach and how to provide control\n   to the operator; for this reason,
    it is an update to [RFC6514].\n   The base principle of this specification is
    described in Section 3.\n   Existing mechanisms that could be relied upon are
    discussed in\n   Section 4.  Section 5 details the procedures introduced by this\n
    \  specification.\n   Section 6 provides specific details related to the damping
    of\n   multicast VPNs P-tunnel state.\n   Finally, Section 7 discusses operational
    considerations related to\n   the proposed mechanism.\n"
  title: 1.  Introduction
- contents:
  - "2.  Terminology\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\", \"SHALL\",
    \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"MAY\", and \"OPTIONAL\"
    in this\n   document are to be interpreted as described in RFC 2119 [RFC2119].\n
    \  This document reuses terminology from [RFC7761] and [RFC6514].\n   In this
    specification, damping of a multicast state will be said to\n   be \"active\"
    or \"inactive\".  Note that in [RFC2439], the term used for\n   a unicast route
    that is dampened is \"suppressed\", but we will avoid\n   this term in this specification
    given that the proposed solution\n   consists in holding active a damped multicast
    state.\n"
  title: 2.  Terminology
- contents:
  - "3.  Overview\n   The procedures described in this document allow the network
    operator\n   to configure multicast VPN PEs (Provider Edge routers) so that they\n
    \  can delay the propagation of multicast state prune messages between\n   PEs
    when faced with a rate of multicast state dynamicity exceeding a\n   certain configurable
    threshold.  Assuming that the number of\n   multicast states that can be created
    by a receiver is bounded,\n   delaying the propagation of multicast state pruning
    results in\n   setting up an upper bound to the average frequency at which the\n
    \  router will send state updates to an upstream router.\n   From the point of
    view of a downstream router, such as a CE (Customer\n   Edge router), this approach
    has no impact: the multicast routing\n   state changes that it solicits to its
    PE will be honored without any\n   additional delay.  Indeed, the propagation
    of Joins is not impacted\n   by the procedures specified here, and having the
    upstream router\n   delay state prune propagation to its own upstream router does
    not\n   affect what traffic is sent to the downstream router.  In particular,\n
    \  the amount of bandwidth used on the PE-CE link downstream to a PE\n   applying
    this damping technique is not increased.\n   This approach increases the average
    bandwidth utilization on a link\n   upstream to a PE applying this technique,
    such as a PE-PE link:\n   indeed, a given multicast flow will be forwarded for
    a longer time\n   than if no damping was applied.  That said, it is expected that
    this\n   technique will meet the goals of protecting the multicast routing\n   infrastructure
    control plane without a significant average increase\n   of bandwidth; for instance,
    damping events happening at a frequency\n   higher than one event per X seconds
    can be done without increasing by\n   more than X seconds the time during which
    a multicast flow is present\n   on a link.\n   That said, simulation of the exponential
    decay algorithm shows that\n   the multicast state churn can be drastically reduced
    without\n   significantly increasing the duration for which multicast traffic
    is\n   forwarded.  Hence, using this technique will efficiently protect the\n
    \  multicast routing infrastructure control plane against the issues\n   described
    here without a significant average increase of bandwidth.\n   The exception will
    be a scenario with strict constraints on multicast\n   bandwidth, where extending
    the time a multicast flow is forwarded\n   would result in congestion.\n   To
    be practical, such a mechanism requires configurability.  In\n   particular, means
    are required to control when damping is triggered\n   and to allow delaying the
    pruning of a multicast state for a time\n   increasing with the churn of this
    multicast state.  This will let the\n   operator control the trade-off made between
    minimizing the dynamicity\n   and reducing bandwidth consumption.\n"
  title: 3.  Overview
- contents:
  - "4.  Existing Mechanisms\n   This section describes mechanisms that could be considered
    to address\n   the issue but that end up appearing as not suitable or not efficient\n
    \  enough.\n"
  - contents:
    - "4.1.  Rate-Limiting Multicast Control Traffic\n   The Protocol Independent
      Multicast - Sparse Mode (PIM-SM)\n   specification [RFC7761] examines multicast
      security threats and,\n   among other things, the risk of denial-of-service
      attacks described\n   in Section 1.  A mechanism relying on rate-limiting PIM
      messages is\n   proposed in Section 5.3.3 of [RFC4609] but has the identified\n
      \  drawbacks of impacting the service delivered and having side-effects\n   on
      legitimate users.\n"
    title: 4.1.  Rate-Limiting Multicast Control Traffic
  - contents:
    - "4.2.  Existing PIM, IGMP, and MLD Timers\n   In the context of PIM multicast
      routing protocols [RFC7761], a\n   mechanism exists that may offer a form of
      de facto damping of\n   multicast states, under some conditions.  Indeed, when
      active, the\n   prune override mechanism consists in having a PIM upstream router\n
      \  introduce a delay (\"prune override interval\") before taking into\n   account
      a PIM Prune message sent by a downstream neighbor.\n   This mechanism has not
      been designed specifically for the purpose of\n   damping multicast state, but
      as a means to allow PIM to operate on\n   multi-access networks.  See Section
      4.3.3 of [RFC7761].  However,\n   when active, this mechanism will prevent a
      downstream router from\n   producing multicast routing protocol messages that
      would cause, for a\n   given multicast state, the upstream router to send to
      its own\n   upstream router multicast routing protocol messages at a rate higher\n
      \  than 1/[JP_Override_Interval].  This provides a form of de facto\n   damping.\n
      \  Similarly, the IGMP and MLD multicast membership control protocols\n   can
      provide a similar behavior under the right conditions.\n   These mechanisms
      are not considered suitable to meet the goals\n   spelled out in Section 1,
      the main reasons being that:\n   o  when enabled, these mechanisms require additional
      bandwidth on the\n      local link on which the effect of a prune is delayed
      (in our case,\n      the PE-CE link);\n   o  when enabled, these mechanisms
      require disabling explicit tracking\n      (see Section 4.3.3 of [RFC7761]),
      even though enabling this\n      feature may otherwise be desired;\n   o  on
      certain implementations, these mechanisms are incompatible with\n      behaviors
      that cannot be turned off (e.g., implementation applying\n      a fast-leave
      behavior on interfaces with only two neighbors);\n   o  they do not provide
      a suitable level of configurability; and\n   o  they do not provide a way to
      discriminate between multicast flows\n      based on estimation of their dynamicity.\n"
    title: 4.2.  Existing PIM, IGMP, and MLD Timers
  - contents:
    - "4.3.  BGP Route Damping\n   The procedures defined in [RFC2439] and [RFC7196]
      for BGP route flap\n   damping are useful for operators who want to control
      the impact of\n   unicast route churn on the routing infrastructure and offer
      a\n   standardized set of parameters to control damping.\n   These procedures
      are not directly relevant in a multicast context for\n   the following reasons:\n
      \  o  they are not specified for multicast routing protocol in general,\n      and\n
      \  o  even in contexts where BGP routes are used to carry multicast\n      routing
      states (e.g., [RFC6514]), these procedures do not allow\n      the implementation
      of the principle described in this document;\n      the main reason being that
      a damped route becomes suppressed while\n      the target behavior would be
      to keep advertising when damping is\n      triggered on a multicast route.\n
      \  However, the set of parameters standardized to control the thresholds\n   of
      the exponential decay mechanism can be relevantly reused.  This is\n   the approach
      proposed for the procedures described in this document\n   (Section 5).  Motivations
      for doing so are to help the network\n   operator deploy this feature based
      on consistent configuration\n   parameters and to obtain predictable results
      without the drawbacks of\n   relying on rate-limiting multicast control protocol
      exchanges (as is\n   exposed in Section 4.1) or on the use of existing PIM/IGMP
      timers (as\n   is exposed in Section 4.2).\n"
    title: 4.3.  BGP Route Damping
  title: 4.  Existing Mechanisms
- contents:
  - '5.  Procedures for Multicast State Damping

    '
  - contents:
    - "5.1.  PIM Procedures\n   This section describes procedures for multicast state
      damping\n   satisfying the goals spelled out in Section 1.  This section\n   describes
      procedures for (S,G) states in the PIM-SM protocol\n   [RFC7761]; they apply
      unchanged for such states created based on\n   multicast group management protocols
      (IGMP [RFC3376], MLD [RFC3810])\n   on downstream interfaces.  The same procedures
      are applied to (*,G)\n   states in the context of PIM-SM Any-Source Multicast
      (ASM) groups\n   (damping is not applied to (S,G,Rpt) Prune state).\n   The
      following notions of [RFC2439] are reused in these procedures:\n   figure-of-merit:
      \ A number reflecting the current estimation of\n      recent past activity
      of an (S,G) multicast routing state, which\n      increases based on routing
      events related to this state and\n      decreases between these events following
      an exponential decay\n      function (see below); the activation or inactivation
      of damping on\n      the state is based on this number.  This number is associated
      with\n      the upstream state machine for (S,G) and is initialized to a value\n
      \     of zero on state creation.\n   exponential decay function:  A mathematical
      function as defined in\n      Section 2.3 of [RFC2439] (ignoring the first paragraph
      of the\n      section, as it does not apply here).\n   decay-half-life:  The
      duration used to control how fast the\n      exponential decay of the *figure-of-merit*
      is; this parameter of\n      the exponential decay function is the time duration
      during which\n      the *figure-of-merit* will be reduced by half when in the
      absence\n      of a routing event (configurable parameter).\n   cutoff-threshold:
      \ The value of the *figure-of-merit* over which\n      damping is applied (configurable
      parameter).\n   reuse-threshold:  The value of the *figure-of-merit* under which\n
      \     damping stops being applied (configurable parameter).\n   In addition
      to these values, a configurable *increment-factor*\n   parameter is introduced
      that controls by how much the *figure-of-\n   merit* is incremented on multicast
      state update events.\n   Section 7.3 proposes default and maximum values for
      the configurable\n   parameters.\n   On reception of updated multicast membership
      or routing information\n   on a downstream interface I for a given (S,G) state,
      which results in\n   a change of the state of the PIM downstream state machine
      (see\n   Section 4.5.3 of [RFC7761]), a router implementing these procedures\n
      \  MUST:\n   o  apply procedures of [RFC7761] unchanged, for everything relating\n
      \     to what multicast traffic ends up being sent on downstream\n      interfaces,
      including interface I\n   o  update the *figure-of-merit* following the exponential
      decay\n      algorithm\n   o  increase the *figure-of-merit* for the (S,G) by
      the *increment-\n      factor*\n   o  update the damping state for the (S,G)
      state: damping becomes\n      active on the state if the recomputed *figure-of-merit*
      is\n      strictly above the configured *cutoff-threshold*:\n      *  if damping
      remains inactive on (S,G) state, update the upstream\n         state machine
      as usual (as per Section 4.5.7 of [RFC7761]).\n      *  if damping becomes active
      for the (S,G) state:\n         +  if the received message has caused the upstream
      state\n            machine to transition to Joined state, update the upstream\n
      \           state machine for (S,G) applying usual PIM procedures in\n            Section
      4.5.7 of [RFC7761] and including sending a PIM Join\n            to the upstream
      neighbor\n         +  if the received message has caused the upstream state\n
      \           machine to transition to NotJoined state, do not update the\n            upstream
      state machine for (S,G)\n         +  hold the upstream state machine in Joined
      state until the\n            reuse threshold is reached: for the purpose of
      updating this\n            state machine, events that may result in updating
      the state\n            based on [RFC7761] SHOULD be ignored until the *reuse-\n
      \           threshold* is reached.  The effect is that in the meantime,\n            while
      PIM Join messages may be sent as refreshes to the\n            upstream neighbor,
      no PIM Prune message will be sent.\n      *  if damping was already active,
      do not update the upstream state\n         machine for (S,G); the upstream state
      machine was frozen after\n         processing the previous message.\n   Once
      the *figure-of-merit* for (S,G) damping state decays to a value\n   strictly
      below the configured *reuse-threshold*, the upstream state\n   machine for (S,G)
      is recomputed based on states of downstream state\n   machines, eventually leading
      to a PIM Join or Prune message to be\n   sent to the upstream neighbor.\n   Given
      the specificity of multicast applications, it is REQUIRED for\n   the implementation
      to let the operator configure the *decay-half-\n   life* in seconds, rather
      than in minutes.\n   This specification does not impose the use of a particular
      technique\n   to update the *figure-of-merit* following the exponential decay\n
      \  controlled by the configured *decay-half-life*.  For instance, the\n   same
      techniques as the ones described in [RFC2439] can be applied.\n   The only requirement
      is that the *figure-of-merit* has to be updated\n   prior to increasing it and
      that its decay below the *reuse-threshold*\n   has to be reacted upon in a timely
      manner: in particular, if the\n   recomputation is done with a fixed time granularity,
      this granularity\n   should be low enough to not significantly delay the inactivation
      of\n   damping on a multicast state beyond what the operator wanted to\n   configure
      (e.g., for a *decay-half-life* of 10s, recomputing the\n   *figure-of-merit*
      each minute would result in a multicast state\n   remaining damped for a much
      longer time than specified).\n   PIM implementations typically follow the suggestion
      from Section 4.1\n   of [RFC7761] that:\n      implementations will only maintain
      state when it is relevant to\n      forwarding operations - for example, the
      'NoInfo' state might be\n      assumed from the lack of other state information,
      rather than\n      being held explicitly.\n   To properly implement damping
      procedures, an implementation MUST keep\n   an explicit (S,G) state as long
      as damping is active on an (S,G).\n   Once an (S,G) state expires, and damping
      becomes inactive on this\n   state, its associated *figure-of-merit* and damping
      state are removed\n   as well.\n   Note that these procedures:\n   o  do not
      impact PIM procedures related to refreshes or expiration of\n      multicast
      routing states: PIM Prune messages triggered by the\n      expiration of the
      (S,G) keep-alive timer are not suppressed or\n      delayed, and the reception
      of Join messages not causing transition\n      of state on the downstream interface
      does not lead to incrementing\n      the *figure-of-merit*;\n   o  do not impact
      the PIM Assert mechanism: in particular, PIM Prune\n      messages triggered
      by a change of the PIM Assert winner on the\n      upstream interface are not
      suppressed or delayed;\n   o  do not impact PIM Prune messages that are sent
      when the RPF\n      neighbor is updated for a given multicast flow; and\n   o
      \ do not impact PIM Prune messages that are sent in the context of\n      switching
      between a Rendezvous Point Tree and a Shortest Path\n      Tree.\n   Note also
      that no action is triggered based on the reception of PIM\n   Prune messages
      (or corresponding IGMP/MLD messages) that relate to\n   non-existing (S,G) state:
      in particular, no *figure-of-merit* or\n   damping state is created in this
      case.\n"
    title: 5.1.  PIM Procedures
  - contents:
    - "5.2.  Procedures for Multicast VPN State Damping\n   The procedures described
      in Section 5.1 can be applied in the Virtual\n   Routing and Forwarding (VRF)
      PIM-SM implementation (in the \"C-PIM\n   instance\"), with the corresponding
      action to suppressing the emission\n   of a Prune(S,G) message being to not
      withdraw the C-multicast Source\n   Tree Join (C-S,C-G) BGP route.  An implementation
      of [RFC6513]\n   relying on the use of PIM to carry C-multicast routing information\n
      \  MUST support this technique to be compliant with this specification.\n   In
      the context of [RFC6514], where BGP is used to distribute\n   C-multicast routing
      information, the following procedure is proposed\n   as an alternative to the
      procedures in Section 5.1 and consists in\n   applying damping in the BGP implementation
      based on existing BGP\n   damping mechanisms applied to C-multicast Source Tree
      Join routes and\n   Shared Tree Join routes (and as well to Leaf A-D routes
      - see\n   Section 6) and modified to implement the behavior described in\n   Section
      3 along the following guidelines:\n   o  not withdrawing (instead of not advertising)
      damped routes;\n   o  providing means to configure the *decay-half-life* in
      seconds if\n      that option is not already available; and\n   o  using parameters
      for the exponential decay that are specific to\n      multicast based on default
      values and multicast-specific\n      configuration.\n   While these procedures
      would typically be implemented on PE routers,\n   in a context where BGP Route
      Reflectors (RRs) [RFC4456] are used it\n   can be considered useful to also
      be able to apply damping on RRs as\n   well to provide additional protection
      against activity created behind\n   multiple PEs.  Additionally, for MVPN Inter-AS
      deployments, it can be\n   needed to protect one Autonomous System (AS) from
      the dynamicity of\n   multicast VPN routing events from other ASes.\n   The
      choice to implement damping based on BGP routes or the procedures\n   described
      in Section 5.1 is up to the implementor, but at least one\n   of the two MUST
      be implemented.  In the perspective of allowing\n   damping to be done on RRs
      and Autonomous System Border Routers\n   (ASBRs), implementing the BGP approach
      is recommended.\n   When not all routers in a deployment have the capability
      to drop\n   traffic coming from the wrong PE (as spelled out in Section 9.1.1
      of\n   [RFC6513]), then the withdrawal of a C-multicast route resulting from\n
      \  a change in the Upstream Multicast Hop or Upstream Multicast PE\n   SHOULD
      NOT be damped.  An implementation of this specification MUST\n   do at least
      one of the two following things:\n   o  not damp these withdrawals by default,
      and/or\n   o  provide a tuning knob to disable the damping of these withdrawals.\n
      \  Additionally, in such a deployment context, it is RECOMMENDED not to\n   enable
      any multicast VPN route damping on RRs and ASBRs since these\n   types of equipment
      cannot distinguish the event having caused a\n   C-multicast to be withdrawn.\n
      \  Note well that it is out of scope of this section to consider the\n   application
      of these damping techniques on MVPN BGP routes other than\n   C-multicast routes.\n"
    title: 5.2.  Procedures for Multicast VPN State Damping
  title: 5.  Procedures for Multicast State Damping
- contents:
  - '6.  Procedures for P-Tunnel State Damping

    '
  - contents:
    - "6.1.  Damping MVPN P-Tunnel Change Events\n   When selective P-tunnels are
      used (see Section 7 of [RFC6513]), the\n   effect of updating the upstream state
      machine for a given (C-S,C-G)\n   state on a PE connected to multicast receivers
      is not only to\n   generate activity to propagate C-multicast routing information
      to the\n   source connected PE, but also to possibly trigger changes related
      to\n   the P-tunnels carrying (C-S,C-G) traffic.  Protecting the provider\n
      \  network from an excessive amount of change in the state of P-tunnels\n   is
      required, and this section details how this can be done.\n   A PE implementing
      these procedures for MVPN MUST damp Leaf A-D routes\n   in the same manner as
      it would for C-multicast routes (see\n   Section 5.2).\n   A PE implementing
      these procedures for MVPN MUST damp the activity\n   related to removing itself
      from a P-tunnel.  Possible ways to do so\n   depend on the type of P-tunnel,
      and local implementation details are\n   left up to the implementor.\n   The
      following is proposed as an example of how the above can be\n   achieved:\n
      \  o  For P-tunnels implemented with the PIM protocol, this consists in\n      applying
      multicast state damping techniques described in\n      Section 5.1 to the P-PIM
      instance, at least for (S,G) states\n      corresponding to P-tunnels.\n   o
      \ For P-tunnels implemented with multipoint LDP (mLDP), this\n      consists
      in applying damping techniques completely similar to the\n      one described
      in Section 5 but generalized to apply to mLDP\n      states.\n   o  For root-initiated
      P-tunnels (P-tunnels implemented with the\n      Point-to-Multipoint (P2MP)
      RSVP-TE, or relying on ingress\n      replication), no particular action needs
      to be implemented to damp\n      P-tunnels membership, if the activity of Leaf
      A-D route themselves\n      is damped.\n   o  Another possibility is to base
      the decision to join or not join\n      the P-tunnel to which a given (C-S,C-G)
      is bound and to advertise\n      or not advertise a Leaf A-D route related to
      (C-S,C-G) based on\n      whether or not a C-multicast Source Tree Join route
      is being\n      advertised for (C-S,C-G) rather than by relying on the state
      of\n      the C-PIM Upstream state machine for (C-S,C-G).\n"
    title: 6.1.  Damping MVPN P-Tunnel Change Events
  - contents:
    - "6.2.  Procedures for Ethernet VPNs\n   Specifications exist to support or optimize
      multicast and broadcast\n   in the context of Ethernet VPNs [RFC7117] relying
      on the use of\n   Selective P-Multicast Service Interface (S-PMSI) and P-tunnels.
      \ For\n   the same reasons as for IP multicast VPNs, an implementation of\n
      \  [RFC7117] MUST follow the procedures described in Section 6.1 to be\n   compliant
      with this specification.\n"
    title: 6.2.  Procedures for Ethernet VPNs
  title: 6.  Procedures for P-Tunnel State Damping
- contents:
  - '7.  Operational Considerations

    '
  - contents:
    - "7.1.  Enabling Multicast Damping\n   In the context of multicast VPNs, these
      procedures would be enabled\n   on PE routers.  Additionally, in the case of
      C-multicast routing\n   based on BGP extensions ([RFC6514]), these procedures
      can be enabled\n   on ASBRs and RRs.\n"
    title: 7.1.  Enabling Multicast Damping
  - contents:
    - "7.2.  Troubleshooting and Monitoring\n   Implementing the damping mechanisms
      described in this document should\n   be complemented by appropriate tools to
      observe and troubleshoot\n   damping activity.\n   Complementing the existing
      interface providing information on\n   multicast states with information on
      eventual damping of\n   corresponding states (e.g., Multicast Routing Information
      Base (MRIB)\n   states) is RECOMMENDED for C-multicast routing states and P-tunnel\n
      \  states.\n"
    title: 7.2.  Troubleshooting and Monitoring
  - contents:
    - "7.3.  Default and Maximum Values\n   Considering that, by design, multicast
      streams will be delivered\n   unchanged to the end user independent of the value
      chosen for the\n   configurable parameters, and that the only trade-off being
      made is an\n   increase of bandwidth use, the default and maximum values do
      not have\n   to be perfectly tuned.\n   This section proposes default and maximum
      values that are\n   conservative, so as to not significantly impact network
      dimensioning\n   but still prevent multicast state churn going beyond what can
      be\n   considered a reasonably low churn for a multicast state (see below\n
      \  for illustrations in order of magnitude of the effect of these\n   values).\n
      \  The following values are RECOMMENDED to be adopted as default values:\n   o
      \ *increment-factor*: 1000\n   o  *cutoff-threshold*: 3000\n   o  *decay-half-life*:
      10s\n   o  *reuse-threshold*: 1500\n   For unicast damping, it is common to
      set an upper bound to the time\n   during which a route is suppressed.  In the
      case of multicast state\n   damping, which relies on not withdrawing a damped
      route, it may be\n   desirable to avoid a situation where a multicast flow would
      keep\n   flowing in a portion of the network for a very long time in the\n   absence
      of receivers.\n   The proposed default maximum value for the *figure-of-merit*
      is\n   20x*increment-factor*, i.e., 20000 with the proposed default\n   *increment-factor*
      of 1000.\n   As illustrations, with these values:\n   o  a multicast state updated
      less frequently than once every 6 s will\n      not be damped at all;\n   o
      \ a multicast state changing once per second for 3 s, and then not\n      changing,
      will not be damped;\n   o  a multicast state changing once per second for 4
      s, and then not\n      changing, will be damped after the fourth change for
      approximately\n      13 s;\n   o  a multicast state changing twice per second
      for 15 s, and then not\n      changing, will be damped after the fourth change
      for approximately\n      50 s; and\n   o  a multicast state changing at a fast
      pace for a long time will\n      reach the maximum of *figure-of-merit*; once
      the activity on this\n      state stops, corresponding traffic may still flow
      in the network\n      for approximately 37 s before dampening stops being active.\n
      \  The following values are proposed as maximums:\n   o  *decay-half-life*:
      60 s\n   o  *cutoff-threshold*: 50000\n   More aggressive protection against
      the risk of denial of service can\n   be achieved by increasing the *increment-factor*
      or the\n   *decay-half-life*, or by reducing the *cutoff-threshold* and/or\n
      \  *reuse-threshold*.\n"
    title: 7.3.  Default and Maximum Values
  title: 7.  Operational Considerations
- contents:
  - "8.  Security Considerations\n   The procedures defined in this document do not
    introduce additional\n   security issues not already present in the contexts addressed
    and\n   actually aim at addressing some of the identified risks without\n   introducing
    as much denial-of-service risk as some of the mechanisms\n   already defined.\n
    \  The protection provided relates to the control plane of the multicast\n   routing
    protocols, including the components implementing the routing\n   protocols and
    the components responsible for updating the multicast\n   forwarding plane.\n
    \  The procedures described are meant to provide some level of\n   protection
    for the router on which they are enabled by reducing the\n   amount of routing
    state updates that it needs to send to its upstream\n   neighbor or peers but
    do not provide any reduction of the control-\n   plane load related to processing
    routing information from downstream\n   neighbors.  Protecting routers from an
    increase in control-plane load\n   due to activity on downstream interfaces toward
    core routers (or in\n   the context of BGP-based MVPN C-multicast routing, BGP
    peers) relies\n   on the activation of damping on corresponding downstream neighbors\n
    \  (or BGP peers) and/or at the edge of the network.  Protecting routers\n   from
    an increase in control-plane load due to activity on customer-\n   facing downstream
    interfaces or downstream interfaces to routers in\n   another administrative domain
    is out of the scope of this document\n   and should use already defined mechanisms
    (see [RFC4609]).\n   To be effective, the procedures described here must be complemented\n
    \  by configuration limiting the number of multicast states that can be\n   created
    on a multicast router through protocol interactions with\n   multicast receivers,
    neighbor routers in adjacent ASes, or in\n   multicast VPN contexts with multicast
    CEs.  Note well that the two\n   mechanisms may interact: the state for which
    Prune has been requested\n   may still remain taken into account for some time
    if damping has been\n   triggered and hence result in an otherwise acceptable
    new state from\n   being successfully created.\n   Additionally, it is worth noting
    that these procedures are not meant\n   to protect against peaks of control-plane
    load but only address\n   averaged load.  For instance, assuming a set of multicast
    states are\n   submitted to the same Join/Prune events, damping can prevent more\n
    \  than a certain number of Join/Prune messages to be sent upstream in\n   the
    period of time that elapses between the reception of Join/Prune\n   messages triggering
    the activation of damping on these states and\n   when damping becomes inactive
    after decay.\n"
  title: 8.  Security Considerations
- contents:
  - '9.  References

    '
  - contents:
    - "9.1.  Normative References\n   [RFC2119]  Bradner, S., \"Key words for use
      in RFCs to Indicate\n              Requirement Levels\", BCP 14, RFC 2119,\n
      \             DOI 10.17487/RFC2119, March 1997,\n              <http://www.rfc-editor.org/info/rfc2119>.\n
      \  [RFC2439]  Villamizar, C., Chandra, R., and R. Govindan, \"BGP Route\n              Flap
      Damping\", RFC 2439, DOI 10.17487/RFC2439, November\n              1998, <http://www.rfc-editor.org/info/rfc2439>.\n
      \  [RFC3376]  Cain, B., Deering, S., Kouvelas, I., Fenner, B., and A.\n              Thyagarajan,
      \"Internet Group Management Protocol, Version\n              3\", RFC 3376,
      DOI 10.17487/RFC3376, October 2002,\n              <http://www.rfc-editor.org/info/rfc3376>.\n
      \  [RFC3810]  Vida, R., Ed. and L. Costa, Ed., \"Multicast Listener\n              Discovery
      Version 2 (MLDv2) for IPv6\", RFC 3810,\n              DOI 10.17487/RFC3810,
      June 2004,\n              <http://www.rfc-editor.org/info/rfc3810>.\n   [RFC6513]
      \ Rosen, E., Ed. and R. Aggarwal, Ed., \"Multicast in MPLS/\n              BGP
      IP VPNs\", RFC 6513, DOI 10.17487/RFC6513, February\n              2012, <http://www.rfc-editor.org/info/rfc6513>.\n
      \  [RFC6514]  Aggarwal, R., Rosen, E., Morin, T., and Y. Rekhter, \"BGP\n              Encodings
      and Procedures for Multicast in MPLS/BGP IP\n              VPNs\", RFC 6514,
      DOI 10.17487/RFC6514, February 2012,\n              <http://www.rfc-editor.org/info/rfc6514>.\n
      \  [RFC7117]  Aggarwal, R., Ed., Kamite, Y., Fang, L., Rekhter, Y., and\n              C.
      Kodeboniya, \"Multicast in Virtual Private LAN Service\n              (VPLS)\",
      RFC 7117, DOI 10.17487/RFC7117, February 2014,\n              <http://www.rfc-editor.org/info/rfc7117>.\n
      \  [RFC7196]  Pelsser, C., Bush, R., Patel, K., Mohapatra, P., and O.\n              Maennel,
      \"Making Route Flap Damping Usable\", RFC 7196,\n              DOI 10.17487/RFC7196,
      May 2014,\n              <http://www.rfc-editor.org/info/rfc7196>.\n   [RFC7761]
      \ Fenner, B., Handley, M., Holbrook, H., Kouvelas, I.,\n              Parekh,
      R., Zhang, Z., and L. Zheng, \"Protocol Independent\n              Multicast
      - Sparse Mode (PIM-SM): Protocol Specification\n              (Revised)\", STD
      83, RFC 7761, DOI 10.17487/RFC7761, March\n              2016, <http://www.rfc-editor.org/info/rfc7761>.\n"
    title: 9.1.  Normative References
  - contents:
    - "9.2.  Informative References\n   [RFC4456]  Bates, T., Chen, E., and R. Chandra,
      \"BGP Route\n              Reflection: An Alternative to Full Mesh Internal
      BGP\n              (IBGP)\", RFC 4456, DOI 10.17487/RFC4456, April 2006,\n              <http://www.rfc-editor.org/info/rfc4456>.\n
      \  [RFC4609]  Savola, P., Lehtonen, R., and D. Meyer, \"Protocol\n              Independent
      Multicast - Sparse Mode (PIM-SM) Multicast\n              Routing Security Issues
      and Enhancements\", RFC 4609,\n              DOI 10.17487/RFC4609, October 2006,\n
      \             <http://www.rfc-editor.org/info/rfc4609>.\n"
    title: 9.2.  Informative References
  title: 9.  References
- contents:
  - "Acknowledgements\n   We would like to thank Bruno Decraene and Lenny Giuliano
    for\n   discussions that helped shape this proposal.  We would also like to\n
    \  thank Yakov Rekhter and Eric Rosen for their reviews and helpful\n   comments.
    \ Thanks to Wim Henderickx for his comments and support of\n   this proposal.
    \ Additionally, Martin Vigoureux, Gunter Van De Velde,\n   and Alvaro Retana provided
    useful comments to finalize the document.\n"
  title: Acknowledgements
- contents:
  - "Authors' Addresses\n   Thomas Morin (editor)\n   Orange\n   2, avenue Pierre
    Marzin\n   Lannion  22307\n   France\n   Email: thomas.morin@orange.com\n   Stephane
    Litkowski\n   Orange\n   France\n   Email: stephane.litkowski@orange.com\n   Keyur
    Patel\n   Cisco Systems\n   170 W. Tasman Drive\n   San Jose, CA  95134\n   United
    States of America\n   Email: keyupate@cisco.com\n   Zhaohui Zhang\n   Juniper
    Networks Inc.\n   10 Technology Park Drive\n   Westford, MA  01886\n   United
    States of America\n   Email: zzhang@juniper.net\n   Robert Kebler\n   Juniper
    Networks Inc.\n   10 Technology Park Drive\n   Westford, MA  01886\n   United
    States of America\n   Email: rkebler@juniper.net\n   Jeffrey Haas\n   Juniper
    Networks\n   Email: jhaas@juniper.net\n"
  title: Authors' Addresses
