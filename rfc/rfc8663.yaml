- title: __initial_text__
  contents:
  - '                      MPLS Segment Routing over IP

    '
- title: Abstract
  contents:
  - "Abstract\n   MPLS Segment Routing (SR-MPLS) is a method of source routing a packet\n\
    \   through an MPLS data plane by imposing a stack of MPLS labels on the\n   packet\
    \ to specify the path together with any packet-specific\n   instructions to be\
    \ executed on it.  SR-MPLS can be leveraged to\n   realize a source-routing mechanism\
    \ across MPLS, IPv4, and IPv6 data\n   planes by using an MPLS label stack as\
    \ a source-routing instruction\n   set while making no changes to SR-MPLS specifications\
    \ and\n   interworking with SR-MPLS implementations.\n   This document describes\
    \ how SR-MPLS-capable routers and IP-only\n   routers can seamlessly coexist and\
    \ interoperate through the use of\n   SR-MPLS label stacks and IP encapsulation/tunneling\
    \ such as MPLS-\n   over-UDP as defined in RFC 7510.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This\
    \ document is a product of the Internet Engineering Task Force\n   (IETF).  It\
    \ represents the consensus of the IETF community.  It has\n   received public\
    \ review and has been approved for publication by the\n   Internet Engineering\
    \ Steering Group (IESG).  Further information on\n   Internet Standards is available\
    \ in Section 2 of RFC 7841.\n   Information about the current status of this document,\
    \ any errata,\n   and how to provide feedback on it may be obtained at\n   https://www.rfc-editor.org/info/rfc8663.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2019 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (https://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.  Code Components\
    \ extracted from this document must\n   include Simplified BSD License text as\
    \ described in Section 4.e of\n   the Trust Legal Provisions and are provided\
    \ without warranty as\n   described in the Simplified BSD License.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1.  Introduction\n     1.1.  Terminology\n   2.  Use Cases\n\
    \   3.  Procedures of SR-MPLS-over-IP\n     3.1.  Forwarding Entry Construction\n\
    \       3.1.1.  FIB Construction Example\n     3.2.  Packet-Forwarding Procedures\n\
    \       3.2.1.  Packet Forwarding with Penultimate Hop Popping\n       3.2.2.\
    \  Packet Forwarding without Penultimate Hop Popping\n       3.2.3.  Additional\
    \ Forwarding Procedures\n   4.  IANA Considerations\n   5.  Security Considerations\n\
    \   6.  References\n     6.1.  Normative References\n     6.2.  Informative References\n\
    \   Acknowledgements\n   Contributors\n   Authors' Addresses\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   MPLS Segment Routing (SR-MPLS) [RFC8660] is a method of\
    \ source\n   routing a packet through an MPLS data plane.  This is achieved by\
    \ the\n   sender imposing a stack of MPLS labels that partially or completely\n\
    \   specify the path that the packet is to take and any instructions to\n   be\
    \ executed on the packet as it passes through the network.  SR-MPLS\n   uses an\
    \ MPLS label stack to encode a sequence of source-routing\n   instructions.  This\
    \ can be used to realize a source-routing mechanism\n   that can operate across\
    \ MPLS, IPv4, and IPv6 data planes.  This\n   approach makes no changes to SR-MPLS\
    \ specifications and allows\n   interworking with SR-MPLS implementations.  More\
    \ specifically, the\n   source-routing instructions in a source-routed packet\
    \ could be\n   uniformly encoded as an MPLS label stack regardless of whether\
    \ the\n   underlay is IPv4, IPv6 (including Segment Routing for IPv6 (SRv6)\n\
    \   [RFC8354]), or MPLS.\n   This document describes how SR-MPLS-capable routers\
    \ and IP-only\n   routers can seamlessly coexist and interoperate through the\
    \ use of\n   SR-MPLS label stacks and IP encapsulation/tunneling such as MPLS-\n\
    \   over-UDP [RFC7510].\n   Section 2 describes various use cases for tunneling\
    \ SR-MPLS over IP.\n   Section 3 describes a typical application scenario and\
    \ how the packet\n   forwarding happens.\n"
- title: 1.1.  Terminology
  contents:
  - "1.1.  Terminology\n   This memo makes use of the terms defined in [RFC3031] and\
    \ [RFC8660].\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\", \"SHALL\"\
    , \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"NOT RECOMMENDED\"\
    , \"MAY\", and\n   \"OPTIONAL\" in this document are to be interpreted as described\
    \ in\n   BCP 14 [RFC2119] [RFC8174] when, and only when, they appear in all\n\
    \   capitals, as shown here.\n"
- title: 2.  Use Cases
  contents:
  - "2.  Use Cases\n   Tunneling SR-MPLS using IPv4 and/or IPv6 (including SRv6) tunnels\
    \ is\n   useful at least in the use cases listed below.  In all cases, this\n\
    \   can be enabled using an IP tunneling mechanism such as MPLS-over-UDP\n   as\
    \ described in [RFC7510].  The tunnel selected MUST have its remote\n   endpoint\
    \ (destination) address equal to the address of the next node\n   capable of SR-MPLS\
    \ identified as being on the SR path (i.e., the\n   egress of the active segment).\
    \  The local endpoint (source) address\n   is set to an address of the encapsulating\
    \ node.  [RFC7510] gives\n   further advice on how to set the source address if\
    \ the UDP zero-\n   checksum mode is used with MPLS-over-UDP.  Using UDP as the\n\
    \   encapsulation may be particularly beneficial because it is agnostic\n   of\
    \ the underlying transport.\n   *  Incremental deployment of the SR-MPLS technology\
    \ may be\n      facilitated by tunneling SR-MPLS packets across parts of a network\n\
    \      that are not SR-MPLS as shown in Figure 1.  This demonstrates how\n   \
    \   islands of SR-MPLS may be connected across a legacy network.  It\n      may\
    \ be particularly useful for joining sites (such as data\n      centers).\n  \
    \                       ________________________\n          _______       (  \
    \                      )       _______\n        ( SR-MPLS )   (              \
    \              )   ( SR-MPLS )\n       (  Network  ) (                       \
    \       ) (  Network  )\n      (        | Border |    SR-in-UDP Tunnel    | Border\
    \ |        )\n      (        | Router |========================| Router |    \
    \    )\n      (        |   R1   |                        |   R2   |        )\n\
    \         (_______)     (                          )     (_______)\n         \
    \               (________________________)\n          Figure 1: SR-MPLS-over-UDP\
    \ to Tunnel between SR-MPLS Sites\n   *  If the encoding of entropy [RFC6790]\
    \ is desired, IP-tunneling\n      mechanisms that allow the encoding of entropy,\
    \ such as MPLS-over-\n      UDP encapsulation [RFC7510] where the source port\
    \ of the UDP\n      header is used as an entropy field, may be used to maximize\
    \ the\n      utilization of Equal-Cost Multipath (ECMP) and/or Link Aggregation\n\
    \      Groups (LAGs), especially when it is difficult to make use of the\n   \
    \   entropy-label mechanism.  This is to be contrasted with [RFC4023]\n      where\
    \ MPLS-over-IP does not provide for an entropy mechanism.\n      Refer to [RFC8662])\
    \ for more discussion about using entropy labels\n      in SR-MPLS.\n   *  Tunneling\
    \ MPLS over IP provides a technology that enables Segment\n      Routing (SR)\
    \ in an IPv4 and/or IPv6 network where the routers do\n      not support SRv6\
    \ capabilities [IPv6-SRH] and where MPLS forwarding\n      is not an option. \
    \ This is shown in Figure 2.\n                      __________________________________\n\
    \                   __(           IP Network             )__\n               \
    \ __(                                        )__\n          --------   --   --\
    \  |SR|  --  |SR|  --  |SR|  --   --------\n         | Ingress| |IR| |IR| |  |\
    \ |IR| |  | |IR| |  | |IR| | Egress|\n      -->| Router |===========|  |======|\
    \  |======|  |======| Router|-->\n         |   SR   | |  | |  | |  | |  | |  |\
    \ |  | |  | |  | |   SR  |\n               (__             --        --      \
    \  --       __)\n                  (__                                    __)\n\
    \                     (__________________________________)\n        Key:\n   \
    \       IR : IP-only Router\n          SR : SR-MPLS-capable Router\n         \
    \ == : SR-MPLS-over-UDP Tunnel\n                Figure 2: SR-MPLS Enabled within\
    \ an IP Network\n"
- title: 3.  Procedures of SR-MPLS-over-IP
  contents:
  - "3.  Procedures of SR-MPLS-over-IP\n   This section describes the construction\
    \ of forwarding information\n   base (FIB) entries and the forwarding behavior\
    \ that allow the\n   deployment of SR-MPLS when some routers in the network are\
    \ IP only\n   (i.e., do not support SR-MPLS).  Note that the examples in Sections\n\
    \   3.1.1 and 3.2 assume that OSPF or IS-IS is enabled; in fact, other\n   mechanisms\
    \ of discovery and advertisement could be used including\n   other routing protocols\
    \ (such as BGP) or a central controller.\n"
- title: 3.1.  Forwarding Entry Construction
  contents:
  - "3.1.  Forwarding Entry Construction\n   This subsection describes how to construct\
    \ the forwarding information\n   base (FIB) entry on an SR-MPLS-capable router\
    \ when some or all of the\n   next hops along the shortest path towards a prefix\
    \ Segment Identifier\n   (Prefix-SID) are IP-only routers.  Section 3.1.1 provides\
    \ a concrete\n   example of how the process applies when using OSPF or IS-IS.\n\
    \   Consider router A that receives a labeled packet with top label L(E)\n   that\
    \ corresponds to the Prefix-SID SID(E) of prefix P(E) advertised\n   by router\
    \ E.  Suppose the i-th next-hop router (termed NHi) along the\n   shortest path\
    \ from router A toward SID(E) is not SR-MPLS capable\n   while both routers A\
    \ and E are SR-MPLS capable.  The following\n   processing steps apply:\n   *\
    \  Router E is SR-MPLS capable, so it advertises a Segment Routing\n      Global\
    \ Block (SRGB).  The SRGB is defined in [RFC8402].  There are\n      a number\
    \ of ways that the advertisement can be achieved including\n      IGPs, BGP, and\
    \ configuration/management protocols.  For example,\n      see [DC-GATEWAY].\n\
    \   *  When Router E advertises the Prefix-SID SID(E) of prefix P(E), it\n   \
    \   MUST also advertise the egress endpoint address and the\n      encapsulation\
    \ type of any tunnel used to reach E.  This\n      information is flooded domain\
    \ wide.\n   *  If A and E are in different routing domains, then the information\n\
    \      MUST be flooded into both domains.  How this is achieved depends\n    \
    \  on the advertisement mechanism being used.  The objective is that\n      router\
    \ A knows the characteristics of router E that originated the\n      advertisement\
    \ of SID(E).\n   *  Router A programs the FIB entry for prefix P(E) corresponding\
    \ to\n      the SID(E) according to whether a pop or swap action is advertised\n\
    \      for the prefix.  The resulting action may be:\n      -  pop the top label\n\
    \      -  swap the top label to a value equal to SID(E) plus the lower\n     \
    \    bound of the SRGB of E\n   Once constructed, the FIB can be used by a router\
    \ to tell it how to\n   process packets.  It encapsulates the packets according\
    \ to the\n   appropriate encapsulation advertised for the segment and then sends\n\
    \   the packets towards the next hop NHi.\n"
- title: 3.1.1.  FIB Construction Example
  contents:
  - "3.1.1.  FIB Construction Example\n   This section is non-normative and provides\
    \ a worked example of how a\n   FIB might be constructed using OSPF and IS-IS\
    \ extensions.  It is\n   based on the process described in Section 3.1.\n   *\
    \  Router E is SR-MPLS capable, so it advertises a Segment Routing\n      Global\
    \ Block (SRGB) using [RFC8665] or [RFC8667].\n   *  When Router E advertises the\
    \ Prefix-SID SID(E) of prefix P(E), it\n      also advertises the encapsulation\
    \ endpoint address and the tunnel\n      type of any tunnel used to reach E using\
    \ [ISIS-ENCAP] or\n      [OSPF-ENCAP].\n   *  If A and E are in different domains,\
    \ then the information is\n      flooded into both domains and any intervening\
    \ domains.\n      -  The OSPF Tunnel Encapsulations TLV [OSPF-ENCAP] or the IS-IS\n\
    \         Tunnel Encapsulation Type sub-TLV [ISIS-ENCAP] is flooded\n        \
    \ domain wide.\n      -  The OSPF SID/Label Range TLV [RFC8665] or the IS-IS SR-\n\
    \         Capabilities sub-TLV [RFC8667] is advertised domain wide so\n      \
    \   that router A knows the characteristics of router E.\n      -  When router\
    \ E advertises the prefix P(E):\n         o  If router E is running IS-IS, it\
    \ uses the extended\n            reachability TLV (TLVs 135, 235, 236, 237) and\
    \ associates\n            the IPv4/IPv6 or IPv4/IPv6 Source Router ID sub-TLV(s)\n\
    \            [RFC7794].\n         o  If router E is running OSPF, it uses the\
    \ OSPFv2 Extended\n            Prefix Opaque Link-State Advertisement (LSA) [RFC7684]\
    \ and\n            sets the flooding scope to Autonomous System (AS) wide.\n \
    \     -  If router E is running IS-IS and advertises the IS-IS Router\n      \
    \   CAPABILITY TLV (TLV 242) [RFC7981], it sets the \"Router ID\"\n         field\
    \ to a valid value or includes an IPv6 TE Router ID sub-TLV\n         (TLV 12),\
    \ or it does both.  The \"S\" bit (flooding scope) of the\n         IS-IS Router\
    \ CAPABILITY TLV (TLV 242) is set to \"1\".\n   *  Router A programs the FIB entry\
    \ for prefix P(E) corresponding to\n      the SID(E) according to whether a pop\
    \ or swap action is advertised\n      for the prefix as follows:\n      -  If\
    \ the No-PHP (NP) Flag in OSPF or the Persistent (P) Flag in\n         IS-IS is\
    \ clear:\n            pop the top label\n      -  If the No-PHP (NP) Flag in OSPF\
    \ or the Persistent (P) Flag in\n         IS-IS is set:\n            swap the\
    \ top label to a value equal to SID(E) plus the lower\n            bound of the\
    \ SRGB of E\n   When forwarding the packet according to the constructed FIB entry,\n\
    \   the router encapsulates the packet according to the encapsulation as\n   advertised\
    \ using the mechanisms described in [ISIS-ENCAP] or\n   [OSPF-ENCAP].  It then\
    \ sends the packets towards the next hop NHi.\n   Note that [RFC7510] specifies\
    \ the use of port number 6635 to indicate\n   that the payload of a UDP packet\
    \ is MPLS, and port number 6636 for\n   MPLS-over-UDP utilizing DTLS.  However,\
    \ [ISIS-ENCAP] and [OSPF-ENCAP]\n   provide dynamic protocol mechanisms to configure\
    \ the use of any\n   Dynamic Port for a tunnel that uses UDP encapsulation.  Nothing\
    \ in\n   this document prevents the use of an IGP or any other mechanism to\n\
    \   negotiate the use of a Dynamic Port when UDP encapsulation is used\n   for\
    \ SR-MPLS, but if no such mechanism is used, then the port numbers\n   specified\
    \ in [RFC7510] are used.\n"
- title: 3.2.  Packet-Forwarding Procedures
  contents:
  - "3.2.  Packet-Forwarding Procedures\n   [RFC7510] specifies an IP-based encapsulation\
    \ for MPLS, i.e., MPLS-\n   over-UDP.  This approach is applicable where IP-based\
    \ encapsulation\n   for MPLS is required and further fine-grained load balancing\
    \ of MPLS\n   packets over IP networks over ECMP and/or LAGs is also required.\n\
    \   This section provides details about the forwarding procedure when UDP\n  \
    \ encapsulation is adopted for SR-MPLS-over-IP.  Other encapsulation\n   and tunneling\
    \ mechanisms can be applied using similar techniques, but\n   for clarity, this\
    \ section uses UDP encapsulation as the exemplar.\n   Nodes that are SR-MPLS capable\
    \ can process SR-MPLS packets.  Not all\n   of the nodes in an SR-MPLS domain\
    \ are SR-MPLS capable.  Some nodes\n   may be \"legacy routers\" that cannot handle\
    \ SR-MPLS packets but can\n   forward IP packets.  A node capable of SR-MPLS MAY\
    \ advertise its\n   capabilities using the IGP as described in Section 3.  There\
    \ are six\n   types of nodes in an SR-MPLS domain:\n   *  Domain ingress nodes\
    \ that receive packets and encapsulate them for\n      transmission across the\
    \ domain.  Those packets may be any payload\n      protocol including native IP\
    \ packets or packets that are already\n      MPLS encapsulated.\n   *  Legacy\
    \ transit nodes that are IP routers but that are not SR-MPLS\n      capable (i.e.,\
    \ are not able to perform Segment Routing).\n   *  Transit nodes that are SR-MPLS\
    \ capable but that are not identified\n      by a SID in the SID stack.\n   *\
    \  Transit nodes that are SR-MPLS capable and need to perform SR-MPLS\n      routing\
    \ because they are identified by a SID in the SID stack.\n   *  The penultimate\
    \ node capable of SR-MPLS on the path that processes\n      the last SID on the\
    \ stack on behalf of the domain egress node.\n   *  The domain egress node that\
    \ forwards the payload packet for\n      ultimate delivery.\n"
- title: 3.2.1.  Packet Forwarding with Penultimate Hop Popping
  contents:
  - "3.2.1.  Packet Forwarding with Penultimate Hop Popping\n   The description in\
    \ this section assumes that the label associated\n   with each Prefix-SID is advertised\
    \ by the owner of the Prefix-SID as\n   a Penultimate Hop-Popping (PHP) label.\
    \  That is, if one of the IGP\n   flooding mechanisms is used, the NP-Flag in\
    \ OSPF or the P-Flag in IS-\n   IS associated with the Prefix-SID is not set.\n\
    \      |  A  +-------+  B  +-------+  C  +-------+  D  +-------+  H  |\n     \
    \               |  E  +-------+  F  +-------+  G  |\n           +--------+\n \
    \          |IP(A->E)|\n           |  UDP   |                 |IP(E->G)|      \
    \  |IP(G->H)|\n           |  L(G)  |                 |  UDP   |        |  UDP\
    \   |\n           |  L(H)  |                 |  L(H)  |        |Exp Null|\n  \
    \         | Packet |     --->        | Packet |  --->  | Packet |\n          \
    \      Figure 3: Packet-Forwarding Example with PHP\n   In the example shown in\
    \ Figure 3, assume that routers A, E, G, and H\n   are capable of SR-MPLS while\
    \ the remaining routers (B, C, D, and F)\n   are only capable of forwarding IP\
    \ packets.  Routers A, E, G, and H\n   advertise their Segment Routing related\
    \ information, such as via IS-\n   IS or OSPF.\n   Now assume that router A (the\
    \ Domain ingress) wants to send a packet\n   to router H (the Domain egress) via\
    \ the explicit path {E->G->H}.\n   Router A will impose an MPLS label stack on\
    \ the packet that\n   corresponds to that explicit path.  Since the next hop toward\
    \ router\n   E is only IP capable (B is a legacy transit node), router A replaces\n\
    \   the top label (that indicated router E) with a UDP-based tunnel for\n   MPLS\
    \ (i.e., MPLS-over-UDP [RFC7510]) to router E and then sends the\n   packet. \
    \ In other words, router A pops the top label and then\n   encapsulates the MPLS\
    \ packet in a UDP tunnel to router E.\n   When the IP-encapsulated MPLS packet\
    \ arrives at router E (which is a\n   transit node capable of SR-MPLS), router\
    \ E strips the IP-based tunnel\n   header and then processes the decapsulated\
    \ MPLS packet.  The top\n   label indicates that the packet must be forwarded\
    \ toward router G.\n   Since the next hop toward router G is only IP capable,\
    \ router E\n   replaces the current top label with an MPLS-over-UDP tunnel toward\n\
    \   router G and sends it out.  That is, router E pops the top label and\n   then\
    \ encapsulates the MPLS packet in a UDP tunnel to router G.\n   When the packet\
    \ arrives at router G, router G will strip the IP-based\n   tunnel header and\
    \ then process the decapsulated MPLS packet.  The top\n   label indicates that\
    \ the packet must be forwarded toward router H.\n   Since the next hop toward\
    \ router H is only IP capable (D is a legacy\n   transit router), router G would\
    \ replace the current top label with an\n   MPLS-over-UDP tunnel toward router\
    \ H and send it out.  However, since\n   router G reaches the bottom of the label\
    \ stack (G is the penultimate\n   node capable of SR-MPLS on the path), this would\
    \ leave the original\n   packet that router A wanted to send to router H encapsulated\
    \ in UDP\n   as if it was MPLS (i.e., with a UDP header and destination port\n\
    \   indicating MPLS) even though the original packet could have been any\n   protocol.\
    \  That is, the final SR-MPLS has been popped exposing the\n   payload packet.\n\
    \   To handle this, when a router (here it is router G) pops the final\n   SR-MPLS\
    \ label, it inserts an explicit NULL label [RFC3032] before\n   encapsulating\
    \ the packet in an MPLS-over-UDP tunnel toward router H\n   and sending it out.\
    \  That is, router G pops the top label, discovers\n   it has reached the bottom\
    \ of stack, pushes an explicit NULL label,\n   and then encapsulates the MPLS\
    \ packet in a UDP tunnel to router H.\n"
- title: 3.2.2.  Packet Forwarding without Penultimate Hop Popping
  contents:
  - "3.2.2.  Packet Forwarding without Penultimate Hop Popping\n   Figure 4 demonstrates\
    \ the packet walk in the case where the label\n   associated with each Prefix-SID\
    \ advertised by the owner of the\n   Prefix-SID is not a Penultimate Hop-Popping\
    \ (PHP) label (e.g., the\n   NP-Flag in OSPF or the P-Flag in IS-IS associated\
    \ with the Prefix-SID\n   is set).  Apart from the PHP function, the roles of\
    \ the routers are\n   unchanged from Section 3.2.1.\n     |  A  +-------+  B \
    \ +-------+  C  +--------+  D  +--------+  H  |\n                   |  E  +-------+\
    \  F  +--------+  G  |\n          +--------+\n          |IP(A->E)|\n         \
    \ |  UDP   |                 |IP(E->G)|\n          |  L(E)  |                \
    \ |  UDP   |        |IP(G->H)|\n          |  L(G)  |                 |  L(G) \
    \ |        |  UDP   |\n          |  L(H)  |                 |  L(H)  |       \
    \ |  L(H)  |\n          | Packet |     --->        | Packet |  --->  | Packet\
    \ |\n              Figure 4: Packet-Forwarding Example without PHP\n   As can\
    \ be seen from the figure, the SR-MPLS label for each segment is\n   left in place\
    \ until the end of the segment where it is popped and the\n   next instruction\
    \ is processed.\n"
- title: 3.2.3.  Additional Forwarding Procedures
  contents:
  - "3.2.3.  Additional Forwarding Procedures\n   Non-MPLS Interfaces:  Although the\
    \ description in the previous two\n      sections is based on the use of Prefix-SIDs,\
    \ tunneling SR-MPLS\n      packets is useful when the top label of a received\
    \ SR-MPLS packet\n      indicates an Adjacency SID and the corresponding adjacent\
    \ node to\n      that Adjacency SID is not capable of MPLS forwarding but can\
    \ still\n      process SR-MPLS packets.  In this scenario, the top label would\
    \ be\n      replaced by an IP tunnel toward that adjacent node and then\n    \
    \  forwarded over the corresponding link indicated by the Adjacency\n      SID.\n\
    \   When to Use IP-Based Tunnels:  The description in the previous two\n     \
    \ sections is based on the assumption that an MPLS-over-UDP tunnel\n      is used\
    \ when the next hop towards the next segment is not MPLS\n      enabled.  However,\
    \ even in the case where the next hop towards the\n      next segment is MPLS\
    \ capable, an MPLS-over-UDP tunnel towards the\n      next segment could still\
    \ be used instead due to local policies.\n      For instance, in the example as\
    \ described in Figure 4, assume F is\n      now a transit node capable of SR-MPLS\
    \ while all the other\n      assumptions remain unchanged; since F is not identified\
    \ by a SID\n      in the stack and an MPLS-over-UDP tunnel is preferred to an\
    \ MPLS\n      LSP according to local policies, router E replaces the current top\n\
    \      label with an MPLS-over-UDP tunnel toward router G and sends it\n     \
    \ out.  (Note that if an MPLS LSP was preferred, the packet would be\n      forwarded\
    \ as native SR-MPLS.)\n   IP Header Fields:  When encapsulating an MPLS packet\
    \ in UDP, the\n      resulting packet is further encapsulated in IP for transmission.\n\
    \      IPv4 or IPv6 may be used according to the capabilities of the\n      network.\
    \  The address fields are set as described in Section 2.\n      The other IP header\
    \ fields (such as the ECN field [RFC6040], the\n      Differentiated Services\
    \ Code Point (DSCP) [RFC2983], or IPv6 Flow\n      Label) on each UDP-encapsulated\
    \ segment SHOULD be configurable\n      according to the operator's policy; they\
    \ may be copied from the\n      header of the incoming packet; they may be promoted\
    \ from the\n      header of the payload packet; they may be set according to\n\
    \      instructions programmed to be associated with the SID; or they may\n  \
    \    be configured dependent on the outgoing interface and payload.\n      The\
    \ TTL field setting in the encapsulating packet header is\n      handled as described\
    \ in [RFC7510], which refers to [RFC4023].\n   Entropy and ECMP:  When encapsulating\
    \ an MPLS packet with an IP\n      tunnel header that is capable of encoding entropy\
    \ (such as\n      [RFC7510]), the corresponding entropy field (the source port\
    \ in\n      the case of a UDP tunnel) MAY be filled with an entropy value that\n\
    \      is generated by the encapsulator to uniquely identify a flow.\n      However,\
    \ what constitutes a flow is locally determined by the\n      encapsulator.  For\
    \ instance, if the MPLS label stack contains at\n      least one entropy label\
    \ and the encapsulator is capable of reading\n      that entropy label, the entropy\
    \ label value could be directly\n      copied to the source port of the UDP header.\
    \  Otherwise, the\n      encapsulator may have to perform a hash on the whole\
    \ label stack\n      or the five-tuple of the SR-MPLS payload if the payload is\n\
    \      determined as an IP packet.  To avoid recalculating the hash or\n     \
    \ hunting for the entropy label each time the packet is encapsulated\n      in\
    \ a UDP tunnel, it MAY be desirable that the entropy value\n      contained in\
    \ the incoming packet (i.e., the UDP source port value)\n      is retained when\
    \ stripping the UDP header and is reused as the\n      entropy value of the outgoing\
    \ packet.\n   Congestion Considerations:  Section 5 of [RFC7510] provides a\n\
    \      detailed analysis of the implications of congestion in MPLS-over-\n   \
    \   UDP systems and builds on Section 3.1.3 of [RFC8085], which\n      describes\
    \ the congestion implications of UDP tunnels.  All of\n      those considerations\
    \ apply to SR-MPLS-over-UDP tunnels as\n      described in this document.  In\
    \ particular, it should be noted\n      that the traffic carried in SR-MPLS flows\
    \ is likely to be IP\n      traffic.\n"
- title: 4.  IANA Considerations
  contents:
  - "4.  IANA Considerations\n   This document has no IANA actions.\n"
- title: 5.  Security Considerations
  contents:
  - "5.  Security Considerations\n   The security consideration of [RFC8354] (which\
    \ redirects the reader\n   to [RFC5095]) and [RFC7510] apply.  DTLS [RFC6347]\
    \ SHOULD be used\n   where security is needed on an SR-MPLS-over-UDP segment including\n\
    \   when the IP segment crosses the public Internet or some other\n   untrusted\
    \ environment.  [RFC8402] provides security considerations\n   for Segment Routing,\
    \ and Section 8.1 of [RFC8402] is particularly\n   applicable to SR-MPLS.\n  \
    \ It is difficult for an attacker to pass a raw MPLS-encoded packet\n   into a\
    \ network, and operators have considerable experience in\n   excluding such packets\
    \ at the network boundaries, for example, by\n   excluding all packets that are\
    \ revealed to be carrying an MPLS packet\n   as the payload of IP tunnels.  Further\
    \ discussion of MPLS security is\n   found in [RFC5920].\n   It is easy for a\
    \ network ingress node to detect any attempt to\n   smuggle an IP packet into\
    \ the network since it would see that the UDP\n   destination port was set to\
    \ MPLS, and such filtering SHOULD be\n   applied.  If, however, the mechanisms\
    \ described in [RFC8665] or\n   [RFC8667] are applied, a wider variety of UDP\
    \ port numbers might be\n   in use making port filtering harder.\n   SR packets\
    \ not having a destination address terminating in the\n   network would be transparently\
    \ carried and would pose no different\n   security risk to the network under consideration\
    \ than any other\n   traffic.\n   Where control-plane techniques are used (as\
    \ described in Section 3),\n   it is important that these protocols are adequately\
    \ secured for the\n   environment in which they are run as discussed in [RFC6862]\
    \ and\n   [RFC5920].\n"
- title: 6.  References
  contents:
  - '6.  References

    '
- title: 6.1.  Normative References
  contents:
  - "6.1.  Normative References\n   [RFC2119]  Bradner, S., \"Key words for use in\
    \ RFCs to Indicate\n              Requirement Levels\", BCP 14, RFC 2119,\n  \
    \            DOI 10.17487/RFC2119, March 1997,\n              <https://www.rfc-editor.org/info/rfc2119>.\n\
    \   [RFC3031]  Rosen, E., Viswanathan, A., and R. Callon, \"Multiprotocol\n  \
    \            Label Switching Architecture\", RFC 3031,\n              DOI 10.17487/RFC3031,\
    \ January 2001,\n              <https://www.rfc-editor.org/info/rfc3031>.\n  \
    \ [RFC3032]  Rosen, E., Tappan, D., Fedorkow, G., Rekhter, Y.,\n             \
    \ Farinacci, D., Li, T., and A. Conta, \"MPLS Label Stack\n              Encoding\"\
    , RFC 3032, DOI 10.17487/RFC3032, January 2001,\n              <https://www.rfc-editor.org/info/rfc3032>.\n\
    \   [RFC4023]  Worster, T., Rekhter, Y., and E. Rosen, Ed.,\n              \"\
    Encapsulating MPLS in IP or Generic Routing Encapsulation\n              (GRE)\"\
    , RFC 4023, DOI 10.17487/RFC4023, March 2005,\n              <https://www.rfc-editor.org/info/rfc4023>.\n\
    \   [RFC5095]  Abley, J., Savola, P., and G. Neville-Neil, \"Deprecation\n   \
    \           of Type 0 Routing Headers in IPv6\", RFC 5095,\n              DOI\
    \ 10.17487/RFC5095, December 2007,\n              <https://www.rfc-editor.org/info/rfc5095>.\n\
    \   [RFC6040]  Briscoe, B., \"Tunnelling of Explicit Congestion\n            \
    \  Notification\", RFC 6040, DOI 10.17487/RFC6040, November\n              2010,\
    \ <https://www.rfc-editor.org/info/rfc6040>.\n   [RFC6347]  Rescorla, E. and N.\
    \ Modadugu, \"Datagram Transport Layer\n              Security Version 1.2\",\
    \ RFC 6347, DOI 10.17487/RFC6347,\n              January 2012, <https://www.rfc-editor.org/info/rfc6347>.\n\
    \   [RFC7510]  Xu, X., Sheth, N., Yong, L., Callon, R., and D. Black,\n      \
    \        \"Encapsulating MPLS in UDP\", RFC 7510,\n              DOI 10.17487/RFC7510,\
    \ April 2015,\n              <https://www.rfc-editor.org/info/rfc7510>.\n   [RFC7684]\
    \  Psenak, P., Gredler, H., Shakir, R., Henderickx, W.,\n              Tantsura,\
    \ J., and A. Lindem, \"OSPFv2 Prefix/Link Attribute\n              Advertisement\"\
    , RFC 7684, DOI 10.17487/RFC7684, November\n              2015, <https://www.rfc-editor.org/info/rfc7684>.\n\
    \   [RFC7794]  Ginsberg, L., Ed., Decraene, B., Previdi, S., Xu, X., and\n   \
    \           U. Chunduri, \"IS-IS Prefix Attributes for Extended IPv4\n       \
    \       and IPv6 Reachability\", RFC 7794, DOI 10.17487/RFC7794,\n           \
    \   March 2016, <https://www.rfc-editor.org/info/rfc7794>.\n   [RFC7981]  Ginsberg,\
    \ L., Previdi, S., and M. Chen, \"IS-IS Extensions\n              for Advertising\
    \ Router Information\", RFC 7981,\n              DOI 10.17487/RFC7981, October\
    \ 2016,\n              <https://www.rfc-editor.org/info/rfc7981>.\n   [RFC8174]\
    \  Leiba, B., \"Ambiguity of Uppercase vs Lowercase in RFC\n              2119\
    \ Key Words\", BCP 14, RFC 8174, DOI 10.17487/RFC8174,\n              May 2017,\
    \ <https://www.rfc-editor.org/info/rfc8174>.\n   [RFC8402]  Filsfils, C., Ed.,\
    \ Previdi, S., Ed., Ginsberg, L.,\n              Decraene, B., Litkowski, S.,\
    \ and R. Shakir, \"Segment\n              Routing Architecture\", RFC 8402, DOI\
    \ 10.17487/RFC8402,\n              July 2018, <https://www.rfc-editor.org/info/rfc8402>.\n\
    \   [RFC8660]  Bashandy, A., Filsfils, C., Previdi, S., Decraene, B.,\n      \
    \        Litkowski, S., and R. Shakir, \"Segment Routing with the\n          \
    \    MPLS Data Plane\", RFC 8660, DOI 10.17487/RFC8660, December\n           \
    \   2019, <https://www.rfc-editor.org/info/rfc8660>.\n"
- title: 6.2.  Informative References
  contents:
  - "6.2.  Informative References\n   [DC-GATEWAY]\n              Farrel, A., Drake,\
    \ J., Rosen, E., Patel, K., and L. Jalil,\n              \"Gateway Auto-Discovery\
    \ and Route Advertisement for\n              Segment Routing Enabled Domain Interconnection\"\
    , Work in\n              Progress, Internet-Draft, draft-ietf-bess-datacenter-\n\
    \              gateway-04, 21 August 2019, <https://tools.ietf.org/html/\n   \
    \           draft-ietf-bess-datacenter-gateway-04>.\n   [IPv6-SRH] Filsfils, C.,\
    \ Dukes, D., Previdi, S., Leddy, J.,\n              Matsushima, S., and D. Voyer,\
    \ \"IPv6 Segment Routing Header\n              (SRH)\", Work in Progress, Internet-Draft,\
    \ draft-ietf-6man-\n              segment-routing-header-26, 22 October 2019,\n\
    \              <https://tools.ietf.org/html/draft-ietf-6man-segment-\n       \
    \       routing-header-26>.\n   [ISIS-ENCAP]\n              Xu, X., Decraene,\
    \ B., Raszuk, R., Chunduri, U., Contreras,\n              L., and L. Jalil, \"\
    Advertising Tunnelling Capability in\n              IS-IS\", Work in Progress,\
    \ Internet-Draft, draft-ietf-isis-\n              encapsulation-cap-01, 24 April\
    \ 2017,\n              <https://tools.ietf.org/html/draft-ietf-isis-\n       \
    \       encapsulation-cap-01>.\n   [OSPF-ENCAP]\n              Xu, X., Decraene,\
    \ B., Raszuk, R., Contreras, L., and L.\n              Jalil, \"The Tunnel Encapsulations\
    \ OSPF Router\n              Information\", Work in Progress, Internet-Draft,\
    \ draft-\n              ietf-ospf-encapsulation-cap-09, 10 October 2017,\n   \
    \           <https://tools.ietf.org/html/draft-ietf-ospf-\n              encapsulation-cap-09>.\n\
    \   [RFC2983]  Black, D., \"Differentiated Services and Tunnels\",\n         \
    \     RFC 2983, DOI 10.17487/RFC2983, October 2000,\n              <https://www.rfc-editor.org/info/rfc2983>.\n\
    \   [RFC5920]  Fang, L., Ed., \"Security Framework for MPLS and GMPLS\n      \
    \        Networks\", RFC 5920, DOI 10.17487/RFC5920, July 2010,\n            \
    \  <https://www.rfc-editor.org/info/rfc5920>.\n   [RFC6790]  Kompella, K., Drake,\
    \ J., Amante, S., Henderickx, W., and\n              L. Yong, \"The Use of Entropy\
    \ Labels in MPLS Forwarding\",\n              RFC 6790, DOI 10.17487/RFC6790,\
    \ November 2012,\n              <https://www.rfc-editor.org/info/rfc6790>.\n \
    \  [RFC6862]  Lebovitz, G., Bhatia, M., and B. Weis, \"Keying and\n          \
    \    Authentication for Routing Protocols (KARP) Overview,\n              Threats,\
    \ and Requirements\", RFC 6862,\n              DOI 10.17487/RFC6862, March 2013,\n\
    \              <https://www.rfc-editor.org/info/rfc6862>.\n   [RFC8085]  Eggert,\
    \ L., Fairhurst, G., and G. Shepherd, \"UDP Usage\n              Guidelines\"\
    , BCP 145, RFC 8085, DOI 10.17487/RFC8085,\n              March 2017, <https://www.rfc-editor.org/info/rfc8085>.\n\
    \   [RFC8354]  Brzozowski, J., Leddy, J., Filsfils, C., Maglione, R.,\n      \
    \        Ed., and M. Townsley, \"Use Cases for IPv6 Source Packet\n          \
    \    Routing in Networking (SPRING)\", RFC 8354,\n              DOI 10.17487/RFC8354,\
    \ March 2018,\n              <https://www.rfc-editor.org/info/rfc8354>.\n   [RFC8662]\
    \  Kini, S., Kompella, K., Sivabalan, S., Litkowski, S.,\n              Shakir,\
    \ R., and J. Tantsura, \"Entropy Label for Source\n              Packet Routing\
    \ in Networking (SPRING) Tunnels\", RFC 8662,\n              DOI 10.17487/RFC8662,\
    \ December 2019,\n              <https://www.rfc-editor.org/info/rfc8662>.\n \
    \  [RFC8665]  Psenak, P., Ed., Previdi, S., Ed., Filsfils, C., Gredler,\n    \
    \          H., Shakir, R., Henderickx, W., and J. Tantsura, \"OSPF\n         \
    \     Extensions for Segment Routing\", RFC 8665,\n              DOI 10.17487/RFC8665,\
    \ December 2019,\n              <https://www.rfc-editor.org/info/rfc8665>.\n \
    \  [RFC8667]  Previdi, S., Ed., Ginsberg, L., Ed., Filsfils, C.,\n           \
    \   Bashandy, A., Gredler, H., and B. Decraene, \"IS-IS\n              Extensions\
    \ for Segment Routing\", RFC 8667,\n              DOI 10.17487/RFC8667, December\
    \ 2019,\n              <https://www.rfc-editor.org/info/rfc8667>.\n"
- title: Acknowledgements
  contents:
  - "Acknowledgements\n   Thanks to Joel Halpern, Bruno Decraene, Loa Andersson, Ron\
    \ Bonica,\n   Eric Rosen, Jim Guichard, Gunter Van De Velde, Andy Malis, Robert\n\
    \   Sparks, and Al Morton for their insightful comments on this document.\n  \
    \ Additional thanks to Mirja Kuehlewind, Alvaro Retana, Spencer\n   Dawkins, Benjamin\
    \ Kaduk, Martin Vigoureux, Suresh Krishnan, and Eric\n   Vyncke for careful reviews\
    \ and resulting comments.\n"
- title: Contributors
  contents:
  - "Contributors\n   Ahmed Bashandy\n   Individual\n   Email: abashandy.ietf@gmail.com\n\
    \   Clarence Filsfils\n   Cisco\n   Email: cfilsfil@cisco.com\n   John Drake\n\
    \   Juniper\n   Email: jdrake@juniper.net\n   Shaowen Ma\n   Mellanox Technologies\n\
    \   Email: mashaowen@gmail.com\n   Mach Chen\n   Huawei\n   Email: mach.chen@huawei.com\n\
    \   Hamid Assarpour\n   Broadcom\n   Email:hamid.assarpour@broadcom.com\n   Robert\
    \ Raszuk\n   Bloomberg LP\n   Email: robert@raszuk.net\n   Uma Chunduri\n   Huawei\n\
    \   Email: uma.chunduri@gmail.com\n   Luis M. Contreras\n   Telefonica I+D\n \
    \  Email: luismiguel.contrerasmurillo@telefonica.com\n   Luay Jalil\n   Verizon\n\
    \   Email: luay.jalil@verizon.com\n   Gunter Van De Velde\n   Nokia\n   Email:\
    \ gunter.van_de_velde@nokia.com\n   Tal Mizrahi\n   Marvell\n   Email: talmi@marvell.com\n\
    \   Jeff Tantsura\n   Apstra, Inc.\n   Email: jefftant.ietf@gmail.com\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Xiaohu Xu\n   Alibaba, Inc\n   Email: xiaohu.xxh@alibaba-inc.com\n\
    \   Stewart Bryant\n   Futurewei Technologies\n   Email: stewart.bryant@gmail.com\n\
    \   Adrian Farrel\n   Old Dog Consulting\n   Email: adrian@olddog.co.uk\n   Syed\
    \ Hassan\n   Cisco\n   Email: shassan@cisco.com\n   Wim Henderickx\n   Nokia\n\
    \   Email: wim.henderickx@nokia.com\n   Zhenbin Li\n"
