- title: __initial_text__
  contents:
  - "      Integrated Services Digital Network (ISDN) User Part (ISUP)\n         \
    \     to Session Initiation Protocol (SIP) Mapping\n"
- title: Status of this Memo
  contents:
  - "Status of this Memo\n   This document specifies an Internet standards track protocol\
    \ for the\n   Internet community, and requests discussion and suggestions for\n\
    \   improvements.  Please refer to the current edition of the \"Internet\n   Official\
    \ Protocol Standards\" (STD 1) for the standardization state\n   and status of\
    \ this protocol.  Distribution of this memo is unlimited.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (C) The Internet Society (2002).  All Rights Reserved.\n"
- title: Abstract
  contents:
  - "Abstract\n   This document describes a way to perform the mapping between two\n\
    \   signaling protocols: the Session Initiation Protocol (SIP) and the\n   Integrated\
    \ Services Digital Network (ISDN) User Part (ISUP) of\n   Signaling System No.\
    \ 7 (SS7).  This mechanism might be implemented\n   when using SIP in an environment\
    \ where part of the call involves\n   interworking with the Public Switched Telephone\
    \ Network (PSTN).\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1.      Introduction............................................\
    \  3\n   2.      Scope...................................................  4\n\
    \   3.      Terminology.............................................  5\n   4.\
    \      Scenarios...............................................  5\n   5.    \
    \  SIP Mechanisms Required.................................  7\n   5.1     'Transparent'\
    \ Transit of ISUP Messages..................  7\n   5.2     Understanding MIME\
    \ Multipart Bodies.....................  7\n   5.3     Transmission of DTMF Information........................\
    \  8\n   5.4     Reliable Transmission of Provisional Responses..........  8\n\
    \   5.5     Early Media.............................................  8\n   5.6\
    \     Mid-Call Transactions which do not change SIP state.....  9\n   5.7    \
    \ Privacy Protection......................................  9\n   5.8     CANCEL\
    \ causes........................................... 10\n   6.      Mapping.................................................\
    \ 10\n   7.      SIP to ISUP Mapping..................................... 11\n\
    \   7.1     SIP to ISUP Call flows.................................. 11\n   7.1.1\
    \   En-bloc Call Setup (no auto-answer)..................... 11\n   7.1.2   Auto-answer\
    \ call setup.................................. 12\n   7.1.3   ISUP T7 Expires.........................................\
    \ 13\n   7.1.4   SIP Timeout............................................. 14\n\
    \   7.1.5   ISUP Setup Failure...................................... 15\n   7.1.6\
    \   Cause Present in ACM Message............................ 16\n   7.1.7   Call\
    \ Canceled by SIP.................................... 17\n   7.2     State Machine...........................................\
    \ 18\n   7.2.1   INVITE received......................................... 19\n\
    \   7.2.1.1 INVITE to IAM procedures................................ 19\n   7.2.2\
    \   ISUP T7 expires......................................... 23\n   7.2.3   CANCEL\
    \ or BYE received.................................. 23\n   7.2.4   REL received............................................\
    \ 24\n   7.2.4.1 ISDN Cause Code to Status Code Mapping.................. 24\n\
    \   7.2.5   Early ACM received...................................... 27\n   7.2.6\
    \   ACM received............................................ 27\n   7.2.7   CON\
    \ or ANM Received..................................... 28\n   7.2.8   Timer T9\
    \ Expires........................................ 29\n   7.2.9   CPG Received............................................\
    \ 29\n   7.3     ACK received............................................ 30\n\
    \   8.      ISUP to SIP Mapping..................................... 30\n   8.1\
    \     ISUP to SIP Call Flows.................................. 30\n   8.1.1  \
    \ En-bloc call setup (non auto-answer).................... 31\n   8.1.2   Auto-answer\
    \ call setup.................................. 32\n   8.1.3   SIP Timeout.............................................\
    \ 33\n   8.1.4   ISUP T9 Expires......................................... 34\n\
    \   8.1.5   SIP Error Response...................................... 35\n   8.1.6\
    \   SIP Redirection......................................... 36\n   8.1.7   Call\
    \ Canceled by ISUP................................... 37\n   8.2     State Machine...........................................\
    \ 39\n   8.2.1   Initial Address Message received........................ 39\n\
    \   8.2.1.1 IAM to INVITE procedures................................ 40\n   8.2.2\
    \   100 received............................................ 41\n   8.2.3   18x\
    \ received............................................ 41\n   8.2.4   2xx received............................................\
    \ 43\n   8.2.5   3xx Received............................................ 44\n\
    \   8.2.6   4xx-6xx Received........................................ 44\n   8.2.6.1\
    \ SIP Status Code to ISDN Cause Code Mapping.............. 45\n   8.2.7   REL\
    \ Received............................................ 47\n   8.2.8   ISUP T11\
    \ Expires........................................ 47\n   9.      Suspend/Resume\
    \ and Hold................................. 48\n   9.1     SUS and RES.............................................\
    \ 48\n   9.2     Hold (re-INVITE)........................................ 50\n\
    \   10.     Normal Release of the Connection........................ 50\n   10.1\
    \    SIP initiated release................................... 50\n   10.2    ISUP\
    \ initiated release.................................. 51\n   10.2.1  Caller hangs\
    \ up......................................... 51\n   10.2.2  Callee hangs up (SUS)...................................\
    \ 52\n   11.     ISUP Maintenance Messages............................... 52\n\
    \   11.1    Reset messages.......................................... 52\n   11.2\
    \    Blocking messages....................................... 53\n   11.3    Continuity\
    \ Checks....................................... 53\n   12.     Construction of\
    \ Telephony URIs.......................... 54\n   12.1    ISUP format to tel URL\
    \ mapping.......................... 56\n   12.2    tel URL to ISUP format mapping..........................\
    \ 57\n   13.     Other ISUP flavors...................................... 58\n\
    \   13.1    Guidelines for sending other ISUP messages.............. 58\n   14.\
    \     Acronyms................................................ 60\n   15.    \
    \ Security Considerations................................. 60\n   16.     IANA\
    \ Considerations..................................... 64\n   17.     Acknowledgments.........................................\
    \ 64\n   18.     Normative References.................................... 64\n\
    \   19.     Non-Normative References................................ 65\n    \
    \       Authors' Addresses...................................... 67\n        \
    \   Full Copyright Statement................................ 68\n"
- title: 1. Introduction
  contents:
  - "1. Introduction\n   SIP [1] is an application layer protocol for establishing,\n\
    \   terminating and modifying multimedia sessions.  It is typically\n   carried\
    \ over IP.  Telephone calls are considered a type of multimedia\n   sessions where\
    \ just audio is exchanged.\n   Integrated Services Digital Network (ISDN) User\
    \ Part (ISUP) [12] is a\n   level 4 protocol used in Signaling System No. 7 (SS7)\
    \ networks.  It\n   typically runs over Message Transfer Part (MTP) although it\
    \ can also\n   run over IP (see SCTP [19]).  ISUP is used for controlling telephone\n\
    \   calls and for maintenance of the network (blocking circuits,\n   resetting\
    \ circuits etc.).\n   A module performing the mapping between these two protocols\
    \ is\n   usually referred to as Media Gateway Controller (MGC), although the\n\
    \   terms 'softswitch' or 'call agent' are also sometimes used.  An MGC\n   has\
    \ logical interfaces facing both networks, the network carrying\n   ISUP and the\
    \ network carrying SIP.  The MGC also has some\n   capabilities for controlling\
    \ the voice path; there is typically a\n   Media Gateway (MG) with E1/T1 trunking\
    \ interfaces (voice from Public\n   Switched Telephone Network - PSTN) and with\
    \ IP interfaces (Voice over\n   IP - VoIP).  The MGC and the MG can be merged\
    \ together in one\n   physical box or kept separate.\n   These MGCs are frequently\
    \ used to bridge SIP and ISUP networks so\n   that calls originating in the PSTN\
    \ can reach IP telephone endpoints\n   and vice versa.  This is useful for cases\
    \ in which PSTN calls need to\n   take advantage of services in IP world, in which\
    \ IP networks are used\n   as transit networks for PSTN-PSTN calls, architectures\
    \ in which calls\n   originate on desktop 'softphones' but terminate at PSTN terminals,\n\
    \   and many other similar next-generation telephone architectures.\n   This document\
    \ describes logic and procedures which an MGC might use\n   to implement the mapping\
    \ between SIP and ISUP by illustrating the\n   correspondences, at the message\
    \ level and parameter level, between\n   the protocols.  It also describes the\
    \ interplay between parallel\n   state machines for these two protocols as a recommendation\
    \ for\n   implementers to synchronize protocol events in interworking\n   architectures.\n"
- title: 2. Scope
  contents:
  - "2. Scope\n   This document focuses on the translation of ISUP messages into SIP\n\
    \   messages, and the mapping of ISUP parameters into SIP headers.  For\n   ISUP\
    \ calls that traverse a SIP network, the purpose of translation is\n   to allow\
    \ SIP elements such as proxy servers (which do not typically\n   understand ISUP)\
    \ to make routing decisions based on ISUP criteria\n   such as the called party\
    \ number.  This document consequently provides\n   a SIP mapping only for those\
    \ ISUP parameters which might be used by\n   intermediaries in the routing of\
    \ SIP requests.  As a side effect of\n   this approach, translation also increases\
    \ the overall\n   interoperability by providing critical information about the\
    \ call to\n   SIP endpoints that cannot understand encapsulated ISUP, or perhaps\n\
    \   which merely cannot understand the particular ISUP variant\n   encapsulated\
    \ in a message.\n   This document also only takes into account the call functionality\
    \ of\n   ISUP.  Maintenance messages dealing with PSTN trunks are treated only\n\
    \   as far as they affect the control of an ongoing call; otherwise these\n  \
    \ messages neither have nor require any analog in SIP.\n   Messages indicating\
    \ error or congestion situations in the PSTN (MTP-\n   3) and the recovery mechanisms\
    \ used such as User Part Available and\n   User Part Test ISUP messages are outside\
    \ the scope of this document\n   There are several flavors of ISUP.  International\
    \ Telecommunication\n   Union Telecommunication Standardization Sector (ITU-T)\
    \ International\n   ISUP [12] is used through this document; some differences\
    \ with the\n   American National Standards Institute (ANSI) [11] ISUP and the\n\
    \   Telecommunication Technology Committee (TTC) ISUP are also outlined.\n   ITU-T\
    \ ISUP is used in this document because it is the most widely\n   known of all\
    \ the ISUP flavors.  Due to the small number of fields\n   that map directly from\
    \ ISUP to SIP, the signaling differences between\n   ITU-T ISUP and specific national\
    \ variants of ISUP will generally have\n   little to no impact on the mapping.\
    \  Note, however, that the ITU-T\n   has not substantially standardized practices\
    \ for Local Number\n   Portability (LNP) since portability tends to be grounded\
    \ in national\n   numbering plan practices, and that consequently LNP must be\
    \ described\n   on a virtually per-nation basis.  The number portability practices\n\
    \   described in this document are presented as an optional mechanism.\n   Mapping\
    \ of SIP headers to ISUP parameters in this document focuses\n   largely on the\
    \ mapping between the parameters found in the ISUP\n   Initial Address Message\
    \ (IAM) and the headers associated with the SIP\n   INVITE message; both of these\
    \ messages are used in their respective\n   protocols to request the establishment\
    \ of a call.  Once an INVITE has\n   been sent for a particular session, such\
    \ headers as the To and From\n   field become essentially fixed, and no further\
    \ translation will be\n   required during subsequent signaling, which is routed\
    \ in accordance\n   with Via and Route headers.  Hence, the problem of parameter-to-\n\
    \   header mapping in SIP-T is confined more or less to the IAM and the\n   INVITE.\
    \  Some additional detail is given in the population of\n   parameters in the\
    \ ISUP messages Address Complete Message (ACM) and\n   Release Message (REL) based\
    \ on SIP status codes.\n   This document describes when the media path associated\
    \ with a SIP\n   call is to be initialized, terminated, modified, etc., but it\
    \ does\n   not go into details such as how the initialization is performed or\n\
    \   which protocols are used for that purpose.\n"
- title: 3. Terminology
  contents:
  - "3. Terminology\n   In this document, the key words \"MUST\", \"MUST NOT\", \"\
    REQUIRED\",\n   \"SHALL\", \"SHALL NOT\", \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\"\
    , \"NOT\n   RECOMMENDED\", \"MAY\", and \"OPTIONAL\" are to be interpreted as\n\
    \   described in RFC2119 [2] and indicate requirement levels for\n   compliant\
    \ SIP implementations.\n"
- title: 4. Scenarios
  contents:
  - "4. Scenarios\n   There are several scenarios where ISUP-SIP mapping takes place.\
    \  The\n   way the messages are generated is different depending on the\n   scenario.\n\
    \   When there is a single MGC and the call is from a SIP phone to a PSTN\n  \
    \ phone, or vice versa, the MGC generates the ISUP messages based on\n   the methods\
    \ described in this document.\n   +-------------+       +-----+       +-------------+\n\
    \   | PSTN switch +-------+ MGC +-------+ SIP UAC/UAS |\n   +-------------+  \
    \     +-----+       +-------------+\n   The scenario where a call originates in\
    \ the PSTN, goes into a SIP\n   network and terminates in the PSTN again is known\
    \ as \"SIP bridging\".\n   SIP bridging should provide ISUP transparency between\
    \ the PSTN\n   switches handling the call.  This is achieved by encapsulating\
    \ the\n   incoming ISUP messages in the body of the SIP messages (see [3]).  In\n\
    \   this case, the ISUP messages generated by the egress MGC are the ones\n  \
    \ present in the SIP body (possibly with some modifications; for\n   example,\
    \ if the called number in the request Uniform Resource\n   Identifier - URI -\
    \ is different from the one present in the ISUP due\n   to SIP redirection, the\
    \ ISUP message will need to be adjusted).\n   +------+   +-------------+   +-----+\
    \   +------------+   +------+\n   | PSTN +---+ Ingress MGC +---+ SIP +---+ Egress\
    \ MGC +---+ PSTN |\n   +------+   +-------------+   +-----+   +------------+ \
    \  +------+\n   SIP is used in the middle of both MGCs because the voice path\
    \ has to\n   be established through the IP network between both MGs; this\n  \
    \ structure also allows the call to take advantage of certain SIP\n   services.\
    \  ISUP messages in the SIP bodies provide further\n   information (such as cause\
    \ values and optional parameters) to the\n   peer MGC.\n   In both scenarios,\
    \ the ingress MGC places the incoming ISUP messages\n   in the SIP body by default.\
    \  Note that this has security\n   implications; see Section 15.  If the recipient\
    \ of these messages\n   (typically a SIP User Agent Client/User Agent Server -\
    \ UAC/UAS) does\n   not understand them, a negotiation using the SIP 'Accept'\
    \ and\n   'Require' headers will take place and they will not be included in\n\
    \   the next SIP message exchange.\n   There can be a Signaling Gateway (SG) between\
    \ the PSTN and the MGC.\n   It encapsulates the ISUP messages over IP in a manner\
    \ such as the one\n   described in [19].  The mapping described in this document\
    \ is not\n   affected by the underlying transport protocol of ISUP.\n   Note that\
    \ overlap dialing mechanisms (use of the Subsequent Address\n   Message - SAM)\
    \ are outside the scope of this document.  This document\n   assumes that gateways\
    \ facing ISUP networks in which overlap dialing\n   is used will implement timers\
    \ to insure that all digits have been\n   collected before an INVITE is transmitted\
    \ to a SIP network.\n   In some instances, gateways may receive incomplete ISUP\
    \ messages\n   which indicate message segmentation due to excessive message length.\n\
    \   Commonly these messages will be followed by a Segmentation Message\n   (SGM)\
    \ containing the remainder of the original ISUP message.  An\n   incomplete message\
    \ may not contain sufficient parameters to allow for\n   a proper mapping to SIP;\
    \ similarly, encapsulating (see below) an\n   incomplete ISUP message may be confusing\
    \ to terminating gateways.\n   Consequently, a gateway MUST wait until a complete\
    \ ISUP message is\n   received (which may involve waiting until one or more SGMs\
    \ arrive)\n   before sending any corresponding INVITE.\n"
- title: 5. SIP Mechanisms Required
  contents:
  - "5. SIP Mechanisms Required\n   For a correct mapping between ISUP and SIP, some\
    \ SIP mechanisms above\n   and beyond those available in the base SIP specification\
    \ are needed.\n   These mechanisms are discussed below.  If the SIP UAC/UAS involved\
    \ in\n   the call does not support them, it is still possible to proceed, but\n\
    \   the behavior in the establishment of the call may be slightly\n   different\
    \ than that expected by the user (e.g., other party answers\n   before receiving\
    \ the ringback tone, user is not informed about the\n   call being forwarded,\
    \ etc.).\n"
- title: 5.1 'Transparent' Transit of ISUP Messages
  contents:
  - "5.1 'Transparent' Transit of ISUP Messages\n   To allow gateways to take advantage\
    \ of the full range of services\n   afforded by the existing telephone network\
    \ when placing calls from\n   PSTN to PSTN across a SIP network, SIP messages\
    \ MUST be capable of\n   transporting ISUP payloads from gateway to gateway. \
    \ The format for\n   encapsulating these ISUP messages is defined in [3].\n  \
    \ SIP user agents which do not understand ISUP are permitted to ignore\n   these\
    \ optional MIME bodies.\n"
- title: 5.2 Understanding MIME Multipart Bodies
  contents:
  - "5.2 Understanding MIME Multipart Bodies\n   In most PSTN interworking situations,\
    \ SIP message bodies will be\n   required to carry session information (Session\
    \ Description Protocol -\n   SDP) in addition to ISUP and/or billing information.\n\
    \   PSTN interworking nodes MUST understand the MIME type of\n   \"multipart/mixed\"\
    \ as defined in RFC2046 [4].  Clients express support\n   for this by including\
    \ \"multipart/mixed\" in an \"Accept\" header.\n"
- title: 5.3 Transmission of Dual-Tone Multifrequency (DTMF) Information
  contents:
  - "5.3 Transmission of Dual-Tone Multifrequency (DTMF) Information\n   How DTMF\
    \ tones played by the user are transmitted by a gateway is\n   completely orthogonal\
    \ to how SIP and ISUP are interworked; however,\n   as DTMF carriage is a component\
    \ of a complete gatewaying solution\n   some guidance is offered here.\n   Since\
    \ the codec selected for voice transmission may not be ideally\n   suited for\
    \ carrying DTMF information, a symbolic method of\n   transmitting this information\
    \ in-band is desirable (since out-of-band\n   transmission alone would provide\
    \ many challenges for synchronization\n   of the media stream for tone re-insertion).\
    \  This transmission MAY be\n   performed as described in RFC2833 [5].\n"
- title: 5.4 Reliable Transmission of Provisional Responses
  contents:
  - "5.4 Reliable Transmission of Provisional Responses\n   Provisional responses\
    \ (in the 1xx class) are used in the transmission\n   of call progress information.\
    \  PSTN interworking in particular relies\n   on these messages for control of\
    \ the media channel and timing of call\n   events.\n   When interworking with\
    \ the PSTN, SIP messages MUST be sent reliably\n   end-to-end; reliability of\
    \ requests is guaranteed by the base\n   protocol.  One application-layer provisional\
    \ reliability mechanism\n   for responses is described in [18].\n"
- title: 5.5 Early Media
  contents:
  - "5.5 Early Media\n   Early media denotes the capability to play media (audio for\n\
    \   telephony) before a SIP session has been established (before a 2xx\n   response\
    \ code has been sent).  For telephony, establishment of media\n   in the backwards\
    \ direction is desirable so that tones and\n   announcements can be played, especially\
    \ when interworking with a\n   network that cannot signal call status out of band\
    \ (such as a legacy\n   MF network).  In cases where interworking has not been\
    \ encountered,\n   use of early media is almost always undesirable since it consumes\n\
    \   inter-machine trunk recourses to play media for which no revenue is\n   collected.\
    \  Note that since an INVITE almost always contains the SDP\n   required to send\
    \ media in the backwards direction, and requires that\n   user agents prepare\
    \ themselves to receive backwards media as soon as\n   an INVITE transmitted,\
    \ the baseline SIP protocol has enough support\n   to enable rudimentary unidirectional\
    \ early media systems.  However,\n   this mechanism has a number of limitations\
    \ - for example, media\n   streams offered in the SDP of the INVITE cannot be\
    \ modified or\n   declined, and bidirectional RTCP required for session maintenance\n\
    \   cannot be established.\n   Therefore gateways MAY support more sophisticated\
    \ early media systems\n   as they come to be better understood.  One mechanism\
    \ that provides a\n   way of initiating a fully-featured early media system is\
    \ described in\n   [20].\n   Note that in SIP networks not just switches but also\
    \ user agents can\n   generate the 18x response codes and initiate early backwards\
    \ media,\n   and that therefore some gateways may wish to enforce policies that\n\
    \   restrict the use of backwards media from arbitrary user agents (see\n   Section\
    \ 15).\n"
- title: 5.6 Mid-Call Transactions which do not change SIP state
  contents:
  - "5.6 Mid-Call Transactions which do not change SIP state\n   When interworking\
    \ with the PSTN, there are situations when gateways\n   will need to send messages\
    \ to each other over SIP that do not\n   correspond to any SIP operations.\n \
    \  In support of mid-call transactions and other ISUP events that do not\n   correspond\
    \ to existing SIP methods, SIP gateways MUST support the\n   INFO method, defined\
    \ in RFC2976 [6].  Note that this document does\n   not prescribe or endorse the\
    \ use of INFO to carry DTMF digits.\n   Gateways MUST accept \"405 Method Not\
    \ Allowed\" and \"501 Not\n   Implemented\" as non-fatal responses to INFO requests\
    \ - that is, any\n   call in progress MUST NOT be torn down if a destination so\
    \ rejects an\n   INFO request sent by a gateway.\n"
- title: 5.7 Privacy Protection
  contents:
  - "5.7 Privacy Protection\n   ISUP has a concept of presentation restriction - a\
    \ mechanism by which\n   a user can specify that they would not like their telephone\
    \ number to\n   be displayed to the person they are calling (presumably someone\
    \ with\n   Caller ID).  When a gateway receives an ISUP request that requires\n\
    \   presentation restriction, it must therefore shield the identity of\n   the\
    \ caller in some fashion.\n   The base SIP protocol supports a method of specifying\
    \ that a user is\n   anonymous.  However, this system has a number of limitations\
    \ - for\n   example, it reveals the identity of the gateway itself, which could\n\
    \   be a privacy-impacting disclosure.  Therefore gateways MAY support\n   more\
    \ sophisticated privacy systems.  One mechanism that provides a\n   way of supporting\
    \ fully-featured privacy negotiation (which interacts\n   well with identity management\
    \ systems) is described in [9B].\n"
- title: 5.8 CANCEL causes
  contents:
  - "5.8 CANCEL causes\n   There is a way in ISUP to signal that you would like to\
    \ discontinue\n   an attempt to set up a call - the general-purpose REL is sent\
    \ in the\n   forwards direction.  There is a similar concept in SIP - that of\
    \ a\n   CANCEL request that is sent in order to discontinue the establishment\n\
    \   of a SIP dialog.  For various reasons, however, CANCEL requests\n   cannot\
    \ contain message bodies, and therefore in order to carry the\n   important information\
    \ in the REL (the cause code) end-to-end in sip\n   bridging cases, ISUP encapsulation\
    \ cannot be used.\n   Ordinarily, this is not a big problem, because for practical\
    \ purposes\n   the only reason that a REL is ever issued to cancel a call setup\n\
    \   attempt is that a user hangs up the phone while it is still ringing\n   (which\
    \ results in a \"Normal clearing\" cause code).  However, under\n   exceptional\
    \ conditions, like catastrophic network failure, a REL may\n   be sent with a\
    \ different cause code, and it would be handy if a SIP\n   network could carry\
    \ the cause code end-to-end.  Therefore gateways\n   MAY support a mechanism for\
    \ end-to-end delivery of such failure\n   reasons.  One mechanism that provides\
    \ this capability is described in\n   [9].\n"
- title: 6. Mapping
  contents:
  - "6. Mapping\n   The mapping between ISUP and SIP is described using call flow\n\
    \   diagrams and state machines.  One state machine handles calls from\n   SIP\
    \ to ISUP and the second from ISUP to SIP.  There are details, such\n   as some\
    \ retransmissions and some states (waiting for the Release\n   Complete Message\
    \ - RLC, waiting for SIP ACK etc.), that are not shown\n   in the figures in order\
    \ to make them easier to follow.\n   The boxes represent the different states\
    \ of the gateway, and the\n   arrows show changes in the state.  The event that\
    \ triggers the change\n   in the state and the actions to take appear on the arrow:\
    \ event /\n   section describing the actions to take.\n   For example, 'INVITE\
    \ / 7.2.1' indicates that an INVITE request has\n   been received by the gateway,\
    \ and the procedure upon reception is\n   described in the section 7.2.1 of this\
    \ document.\n   It is RECOMMENDED that gateways implement functional equivalence\
    \ with\n   the call flows detailed in Section 7.1 and Section 8.1.  Deviations\n\
    \   from these flows are permissible in support of national ISUP\n   variants,\
    \ or any of the conservative policies recommended in Section\n   15.\n"
- title: 7. SIP to ISUP Mapping
  contents:
  - '7. SIP to ISUP Mapping

    '
- title: 7.1 SIP to ISUP Call flows
  contents:
  - "7.1 SIP to ISUP Call flows\n   The following call flows illustrate the order\
    \ of messages in typical\n   success and error cases when setting up a call initiated\
    \ from the SIP\n   network.  \"100 Trying\" acknowledgements to INVITE requests\
    \ are not\n   displayed below although they are required in many architectures.\n\
    \   In these diagrams, all call signaling (SIP, ISUP) is going to and\n   from\
    \ the MGC; media handling (e.g., audio cut-through, trunk freeing)\n   is being\
    \ performed by the MG, under the control of the MGC.  For the\n   purpose of simplicity,\
    \ these are shown as a single node, labeled\n   \"MGC/MG.\"\n"
- title: 7.1.1 En-bloc Call Setup (no auto-answer)
  contents:
  - "7.1.1 En-bloc Call Setup (no auto-answer)\n       SIP                       MGC/MG\
    \                       PSTN\n        1|---------INVITE---------->|          \
    \                |\n         |<----------100------------|                    \
    \      |\n         |                          |------------IAM---------->|2\n\
    \         |                          |<=========Audio===========|\n         |\
    \                          |<-----------ACM-----------|3\n        4|<----------18x------------|\
    \                          |\n         |<=========Audio===========|          \
    \                |\n         |                          |<-----------CPG-----------|5\n\
    \        6|<----------18x------------|                          |\n         |\
    \                          |<-----------ANM-----------|7\n         |         \
    \                 |<=========Audio==========>|\n        8|<----------200------------|\
    \                          |\n         |<=========Audio==========>|          \
    \                |\n        9|-----------ACK----------->|                    \
    \      |\n   1.  When a SIP user wishes to begin a session with a PSTN user, the\n\
    \       SIP node issues an INVITE request.\n   2.  Upon receipt of an INVITE request,\
    \ the gateway maps it to an IAM\n       message and sends it to the ISUP network.\n\
    \   3.  The remote ISUP node indicates that the address is sufficient to\n   \
    \    set up a call by sending back an ACM message.\n   4.  The \"called party\
    \ status\" code in the ACM message is mapped to a\n       SIP provisional response\
    \ (as described in Section 7.2.5 and\n       Section 7.2.6) and returned to the\
    \ SIP node.  This response may\n       contain SDP to establish an early media\
    \ stream (as shown in the\n       diagram).  If no SDP is present, the audio will\
    \ be established in\n       both directions after step 8.\n   5.  If the ISUP\
    \ variant permits, the remote ISUP node may issue a\n       variety of Call Progress\
    \ (CPG) messages to indicate, for example,\n       that the call is being forwarded.\n\
    \   6.  Upon receipt of a CPG message, the gateway will map the event\n      \
    \ code to a SIP provisional response (see Section 7.2.9) and send\n       it to\
    \ the SIP node.\n   7.  Once the PSTN user answers, an Answer (ANM) message will\
    \ be sent\n       to the gateway.\n   8.  Upon receipt of the ANM, the gateway\
    \ will send a 200 message to\n       the SIP node.\n   9.  The SIP node, upon\
    \ receiving an INVITE final response (200), will\n       send an ACK to acknowledge\
    \ receipt.\n"
- title: 7.1.2 Auto-answer call setup
  contents:
  - "7.1.2 Auto-answer call setup\n       SIP                       MGC/MG       \
    \                PSTN\n        1|---------INVITE---------->|                 \
    \         |\n         |<----------100------------|                          |\n\
    \         |                          |------------IAM---------->|2\n         |\
    \                          |<=========Audio===========|\n         |          \
    \                |<-----------CON-----------|3\n         |                   \
    \       |<=========Audio==========>|\n        4|<----------200------------|  \
    \                        |\n         |<=========Audio==========>|            \
    \              |\n        5|-----------ACK----------->|                      \
    \    |\n   Note that this flow is not supported in ANSI networks.\n   1.  When\
    \ a SIP user wishes to begin a session with a PSTN user, the\n       SIP node\
    \ issues an INVITE request.\n   2.  Upon receipt of an INVITE request, the gateway\
    \ maps it to an IAM\n       message and sends it to the ISUP network.\n   3. \
    \ Since the remote node is configured for automatic answering, it\n       will\
    \ send a Connect Message (CON) upon receipt of the IAM.  (For\n       ANSI, this\
    \ message will be an ANM).\n   4.  Upon receipt of the CON, the gateway will send\
    \ a 200 message to\n       the SIP node.\n   5.  The SIP node, upon receiving\
    \ an INVITE final response (200), will\n       send an ACK to acknowledge receipt.\n"
- title: 7.1.3 ISUP T7 Expires
  contents:
  - "7.1.3 ISUP T7 Expires\n       SIP                       MGC/MG              \
    \         PSTN\n        1|---------INVITE---------->|                        \
    \  |\n         |<----------100------------|                          |\n     \
    \    |                          |------------IAM---------->|2\n         |    \
    \                      |<=========Audio===========|\n         |              \
    \            |    *** T7 Expires ***    |\n         |             ** MG Releases\
    \ PSTN Trunk **            |\n        4|<----------504------------|------------REL---------->|3\n\
    \        5|-----------ACK----------->|                          |\n   1.  When\
    \ a SIP user wishes to begin a session with a PSTN user, the\n       SIP node\
    \ issues an INVITE request.\n   2.  Upon receipt of an INVITE request, the gateway\
    \ maps it to an IAM\n       message and sends it to the ISUP network.  The ISUP\
    \ timer T7 is\n       started at this point.\n   3.  The ISUP timer T7 expires\
    \ before receipt of an ACM or CON\n       message, so a REL message is sent to\
    \ cancel the call.\n   4.  A gateway timeout message is sent back to the SIP node.\n\
    \   5.  The SIP node, upon receiving an INVITE final response (504), will\n  \
    \     send an ACK to acknowledge receipt.\n"
- title: 7.1.4 SIP Timeout
  contents:
  - "7.1.4 SIP Timeout\n       SIP                       MGC/MG                  \
    \     PSTN\n        1|---------INVITE---------->|                          |\n\
    \         |<----------100------------|                          |\n         |\
    \                          |------------IAM---------->|2\n         |         \
    \                 |<=========Audio===========|\n         |                   \
    \       |<-----------CON-----------|3\n         |                          |<=========Audio==========>|\n\
    \        4|<----------200------------|                          |\n         |\
    \    *** T1 Expires ***    |                          |\n         |<----------200------------|\
    \                          |\n         |    *** T1 Expires ***    |          \
    \                |\n         |<----------200------------|                    \
    \      |\n         |    *** T1 Expires ***    |                          |\n \
    \        |<----------200------------|                          |\n         | \
    \   *** T1 Expires ***    |                          |\n         |<----------200------------|\
    \                          |\n         |    *** T1 Expires ***    |          \
    \                |\n         |<----------200------------|                    \
    \      |\n         |    *** T1 Expires ***    |                          |\n \
    \       5|<----------200------------|                          |\n         | \
    \   *** T1 Expires ***    |                          |\n         |           \
    \  ** MG Releases PSTN Trunk **            |\n        7|<----------BYE------------|------------REL---------->|6\n\
    \         |                          |<-----------RLC-----------|8\n   1.  When\
    \ a SIP user wishes to begin a session with a PSTN user, the\n       SIP node\
    \ issues an INVITE request.\n   2.  Upon receipt of an INVITE request, the gateway\
    \ maps it to an IAM\n       message and sends it to the ISUP network.\n   3. \
    \ Since the remote node is configured for automatic answering, it\n       will\
    \ send a CON message upon receipt of the IAM.  In ANSI flows,\n       rather than\
    \ a CON, an ANM (without ACM) would be sent.\n   4.  Upon receipt of the ANM,\
    \ the gateway will send a 200 message to\n       the SIP node and set SIP timer\
    \ T1.\n   5.  The response is retransmitted every time the SIP timer T1\n    \
    \   expires.\n   6.  After seven retransmissions, the call is torn down by sending\
    \ a\n       REL to the ISUP node, with a cause code of 102 (recover on timer\n\
    \       expiry).\n   7.  A BYE is transmitted to the SIP node in an attempt to\
    \ close the\n       call.  Further handling for this clean up is not shown, since\
    \ the\n       SIP node's state is not easily known in this scenario.\n   8.  Upon\
    \ receipt of the REL message, the remote ISUP node will reply\n       with an\
    \ RLC message.\n"
- title: 7.1.5 ISUP Setup Failure
  contents:
  - "7.1.5 ISUP Setup Failure\n       SIP                       MGC/MG           \
    \            PSTN\n        1|---------INVITE---------->|                     \
    \     |\n         |<----------100------------|                          |\n  \
    \       |                          |------------IAM---------->|2\n         | \
    \                         |<-----------REL-----------|3\n         |          \
    \                |------------RLC---------->|4\n        5|<----------4xx+-----------|\
    \                          |\n        6|-----------ACK----------->|          \
    \                |\n   1.  When a SIP user wishes to begin a session with a PSTN\
    \ user, the\n       SIP node issues an INVITE request.\n   2.  Upon receipt of\
    \ an INVITE request, the gateway maps it to an IAM\n       message and sends it\
    \ to the ISUP network.\n   3.  Since the remote ISUP node is unable to complete\
    \ the call, it\n       will send a REL.\n   4.  The gateway releases the circuit\
    \ and confirms that it is\n       available for reuse by sending an RLC.\n   5.\
    \  The gateway translates the cause code in the REL to a SIP error\n       response\
    \ (see Section 7.2.4) and sends it to the SIP node.\n   6.  The SIP node sends\
    \ an ACK to acknowledge receipt of the INVITE\n       final response.\n"
- title: 7.1.6 Cause Present in ACM Message
  contents:
  - "7.1.6 Cause Present in ACM Message\n       SIP                       MGC/MG \
    \                      PSTN\n        1|---------INVITE---------->|           \
    \               |\n         |<----------100------------|                     \
    \     |\n         |                          |------------IAM---------->|2\n \
    \        |                          |<=========Audio===========|\n         | \
    \                         |<---ACM with cause code---|3\n        4|<------183\
    \ with SDP-------|                          |\n         |<=========Audio===========|\
    \                          |\n                     ** Interwork timer expires\
    \ **\n        5|<----------4xx+-----------|                          |\n     \
    \    |                          |------------REL---------->|6\n         |    \
    \                      |<-----------RLC-----------|7\n        8|-----------ACK----------->|\
    \                          |\n   1.  When a SIP user wishes to begin a session\
    \ with a PSTN user, the\n       SIP node issues an INVITE request.\n   2.  Upon\
    \ receipt of an INVITE request, the gateway maps it to an IAM\n       message\
    \ and sends it to the ISUP network.\n   3.  Since the ISUP node is unable to complete\
    \ the call and wants to\n       generate the error tone/announcement itself, it\
    \ sends an ACM with\n       a cause code.  The gateway starts an interwork timer.\n\
    \   4.  Upon receipt of an ACM with cause (presence of the CAI\n       parameter),\
    \ the gateway will generate a 183 message towards the\n       SIP node; this contains\
    \ SDP to establish early media cut-through.\n   5.  A final INVITE response, based\
    \ on the cause code received in the\n       earlier ACM message, is generated\
    \ and sent to the SIP node to\n       terminate the call.  See Section 7.2.4.1\
    \ for the table which\n       contains the mapping from cause code to SIP response.\n\
    \   6.  Upon expiration of the interwork timer, a REL is sent towards the\n  \
    \     PSTN node to terminate the call.  Note that the SIP node can also\n    \
    \   terminate the call by sending a CANCEL before the interwork timer\n      \
    \ expires.  In this case, the signaling progresses as in Section\n       7.1.7.\n\
    \   7.  Upon receipt of the REL message, the remote ISUP node will reply\n   \
    \    with an RLC message.\n   8.  The SIP node sends an ACK to acknowledge receipt\
    \ of the INVITE\n       final response.\n"
- title: 7.1.7 Call Canceled by SIP
  contents:
  - "7.1.7 Call Canceled by SIP\n       SIP                       MGC/MG         \
    \              PSTN\n        1|---------INVITE---------->|                   \
    \       |\n         |<----------100------------|                          |\n\
    \         |                          |------------IAM---------->|2\n         |\
    \                          |<=========Audio===========|\n         |          \
    \                |<-----------ACM-----------|3\n        4|<----------18x------------|\
    \                          |\n         |<=========Audio===========|          \
    \                |\n         |            ** MG Releases IP Resources **     \
    \      |\n        5|----------CANCEL--------->|                          |\n \
    \       6|<----------200------------|                          |\n         | \
    \            ** MG Releases PSTN Trunk **            |\n         |           \
    \               |------------REL---------->|7\n        8|<----------487------------|\
    \                          |\n         |                          |<-----------RLC-----------|9\n\
    \       10|-----------ACK----------->|                          |\n   1.  When\
    \ a SIP user wishes to begin a session with a PSTN user, the\n       SIP node\
    \ issues an INVITE request.\n   2.  Upon receipt of an INVITE request, the gateway\
    \ maps it to an IAM\n       message and sends it to the ISUP network.\n   3. \
    \ The remote ISUP node indicates that the address is sufficient to\n       set\
    \ up a call by sending back an ACM message.\n   4.  The \"called party status\"\
    \ code in the ACM message is mapped to a\n       SIP provisional response (as\
    \ described in Section 7.2.5 and\n       Section 7.2.6) and returned to the SIP\
    \ node.  This response may\n       contain SDP to establish an early media stream.\n\
    \   5.  To cancel the call before it is answered, the SIP node sends a\n     \
    \  CANCEL request.\n   6.  The CANCEL request is confirmed with a 200 response.\n\
    \   7.  Upon receipt of the CANCEL request, the gateway sends a REL\n       message\
    \ to terminate the ISUP call.\n   8.  The gateway sends a \"487 Call Cancelled\"\
    \ message to the SIP node\n       to complete the INVITE transaction.\n   9. \
    \ Upon receipt of the REL message, the remote ISUP node will reply\n       with\
    \ an RLC message.\n   10.  Upon receipt of the 487, the SIP node will confirm\
    \ reception\n        with an ACK.\n"
- title: 7.2 State Machine
  contents:
  - "7.2 State Machine\n   Note that REL can be received in any state; the handling\
    \ is the same\n   for each case (see Section 10).\n                          \
    \     +---------+\n      +----------------------->|  Idle   |<---------------------+\n\
    \      |                        +----+----+                      |\n      |  \
    \                           |                           |\n      |           \
    \                  | INVITE/6.2.1              |\n      |                    \
    \         V                           |\n      |      T7/6.2.2   +-------------------------+\
    \   REL/6.2.4 |\n      +<----------------+         Trying          +------------>+\n\
    \      |                 +-+--------+------+-------+             |\n      |  \
    \  CANCEL/6.2.3 | |        |      |                     |\n      +<----------------+\
    \ | E.ACM/ | ACM/ | CON/ANM             |\n      |                   | 6.2.5 \
    \ |6.2.6 | 6.2.7               |\n      |                   V        |      |\
    \                     |\n      | T9/6.2.8  +--------------+ |      |         \
    \            |\n      +<----------+ Not alerting | |      |                  \
    \   |\n      |           +-------+------+ |      |                     |\n   \
    \   |  CANCEL/6.2.3 |   |        |      |                     |\n      |<--------------+\
    \   | CPG/   |      |                     |\n      |                   | 6.2.9\
    \  |      |                     |\n      |                   V        V      |\
    \                     |\n      |    T9/6.2.8     +---------------+ |    REL/6.2.4\
    \        |\n      +<----------------+    Alerting   |-|-------------------->|\n\
    \      |<----------------+--+-----+------+ |                     |\n      |  CANCEL/6.2.3\
    \      |  ^  |        |                     |\n      |               CPG/ |  |\
    \  | ANM/   |                     |\n      |              6.2.9 +--+  | 6.2.7\
    \  |                     |\n      |                          V        V      \
    \               |\n      |                 +-------------------------+    REL/9.2\
    \  |\n      |                 |     Waiting for ACK     |------------>|\n    \
    \  |                 +-------------+-----------+             |\n      |      \
    \                         |                         |\n      |               \
    \                | ACK/6.2.10              |\n      |                        \
    \       V                         |\n      |     BYE/9.1     +-------------------------+\
    \    REL/9.2  |\n      +<----------------+        Connected        +------------>+\n\
    \                        +-------------------------+\n"
- title: 7.2.1 INVITE received
  contents:
  - "7.2.1 INVITE received\n   When an INVITE request is received by the gateway,\
    \ a \"100 Trying\"\n   response MAY be sent back to the SIP network indicating\
    \ that the\n   gateway is handling the call.\n   The necessary hardware resources\
    \ for the media stream MUST be\n   reserved in the gateway when the INVITE is\
    \ received, since an IAM\n   message cannot be sent before the resource reservation\
    \ (especially\n   TCIC selection) takes place.  Typically the resources consist\
    \ of a\n   time slot in an E1/T1 and an RTP/UDP port on the IP side.  Resources\n\
    \   might also include any quality-of-service provisions (although no\n   such\
    \ practices are recommended in this document).\n   After sending the IAM the timer\
    \ T7 is started.  The default value of\n   T7 is between 20 and 30 seconds.  The\
    \ gateway goes to the 'Trying'\n   state.\n"
- title: 7.2.1.1 INVITE to IAM procedures
  contents:
  - "7.2.1.1 INVITE to IAM procedures\n   This section details the mapping of the\
    \ SIP headers in an INVITE\n   message to the ISUP parameters in an Initial Address\
    \ Message (IAM).\n   A PSTN-SIP gateway is responsible for creating an IAM when\
    \ it\n   receives an INVITE.\n   Five mandatory parameters appear within the IAM\
    \ message: the Called\n   Party Number (CPN), the Nature of Connection Indicator\
    \ (NCI), the\n   Forward Call Indicators (FCI), the Calling Party's Category (CPC),\n\
    \   and finally a parameter that indicates the desired bearer\n   characteristics\
    \ of the call - in some ISUP variants the Transmission\n   Medium Requirement\
    \ (TMR) is required, in others the User Service\n   Information (USI) (or both).\
    \  All IAM messages MUST contain these\n   five parameters at a minimum.  Thus,\
    \ every gateway must have a means\n   of populating each of those five parameters\
    \ when an INVITE is\n   received.  Many of the values that will appear in these\
    \ parameters\n   (such as the NCI or USI) will most likely be the same for each\
    \ IAM\n   created by the gateway.  Others (such as the CPN) will vary on a\n \
    \  call-by-call basis; the gateway extracts information from the INVITE\n   in\
    \ order to properly populate these parameters.\n   There are also quite a few\
    \ optional parameters that can appear in an\n   IAM message; Q.763 [17] lists\
    \ 29 in all.  However, each of these\n   parameters need not to be translated\
    \ in order to achieve the goals of\n   SIP-ISUP mapping.  As is stated above,\
    \ translation allows SIP network\n   elements to understand the basic PSTN context\
    \ of the session (who it\n   is for, and so on) if they are not capable of deciphering\
    \ any\n   encapsulated ISUP.  Parameters that are only meaningful to the PSTN\n\
    \   will be carried through PSTN-SIP- PSTN networks via encapsulation -\n   translation\
    \ is not necessary for these parameters.  Of the\n   aforementioned 29 optional\
    \ parameters, only the following are\n   immediately useful for translation: the\
    \ Calling Party's Number (CIN,\n   which is commonly present), Transit Network\
    \ Selection (TNS), Carrier\n   Identification Parameter (CIP, present in ANSI\
    \ networks), Original\n   Called Number (OCN), and the Generic Digits (known in\
    \ some variants\n   as the Generic Address Parameter (GAP)).\n   When a SIP INVITE\
    \ arrives at a PSTN gateway, the gateway SHOULD\n   attempt to make use of encapsulated\
    \ ISUP (see [3]), if any, within\n   the INVITE to assist in the formulation of\
    \ outbound PSTN signaling,\n   but SHOULD also heed the security considerations\
    \ in Section 15.  If\n   possible, the gateway SHOULD reuse the values of each\
    \ of the ISUP\n   parameters of the encapsulated IAM as it formulates an IAM that\
    \ it\n   will send across its PSTN interface.  In some cases, the gateway will\n\
    \   be unable to make use of that ISUP - for example, if the gateway\n   cannot\
    \ understand the ISUP variant and must therefore ignore the\n   encapsulated body.\
    \  Even when there is comprehensible encapsulated\n   ISUP, the relevant values\
    \ of SIP header fields MUST 'overwrite'\n   through the process of translation\
    \ the parameter values that would\n   have been set based on encapsulated ISUP.\
    \  In other words, the\n   updates to the critical session context parameters\
    \ that are created\n   in the SIP network take precedence, in ISUP-SIP-ISUP bridging\
    \ cases,\n   over the encapsulated ISUP.  This allows many basic services,\n \
    \  including various sorts of call forwarding and redirection, to be\n   implemented\
    \ in the SIP network.\n   For example, if an INVITE arrives at a gateway with\
    \ an encapsulated\n   IAM with a CPN field indicating the telephone number +12025332699,\n\
    \   but the Request-URI of the INVITE indicates 'tel:+15105550110', the\n   gateway\
    \ MUST use the telephone number in the Request-URI, rather than\n   the one in\
    \ the encapsulated IAM, when creating the IAM that the\n   gateway will send to\
    \ the PSTN.  Further details of how SIP header\n   fields are translated into\
    \ ISUP parameters follow.\n   Gateways MUST be provisioned with default values\
    \ for mandatory ISUP\n   parameters that cannot be derived from translation(such\
    \ as the NCI or\n   TMR parameters) for those cases in which no encapsulated ISUP\
    \ is\n   present.  The FCI parameter MUST also have a default, as only the 'M'\n\
    \   bit of the default may be overwritten during the process of\n   translation\
    \ if the optional number portability translation mechanisms\n   described below\
    \ are used.\n   The first step in the translation of the fields of an INVITE message\n\
    \   to the parameters of an IAM is the inspection of the Request-URI.\n   If the\
    \ optional number portability practices are supported by the\n   gateway, then\
    \ the following steps related to handling of the 'npdi'\n   and 'rn' parameters\
    \ of the Request-URI should be followed.\n   If there is no 'npdi=yes' field within\
    \ the Request-URI, then the\n   primary telephone number in the tel URL (the digits\
    \ immediately\n   following 'tel:') MUST be converted to ISUP format, following\
    \ the\n   procedures described in Section 12, and used to populate the CPN\n \
    \  parameter.\n   If the 'npdi=yes' field exists in the Request-URI, then the\
    \ FCI\n   parameter bit for 'number translated' within the IAM MUST reflect\n\
    \   that a number portability dip has been performed.\n   If in addition to the\
    \ 'npdi=yes' field there is no 'rn=' field\n   present, then the main telephone\
    \ number in the tel URL MUST be\n   converted to ISUP format (see Section 12)\
    \ and used to populate the\n   CPN parameter.  This indicates that a portability\
    \ dip took place, but\n   that the called party's number was not ported.\n   If\
    \ in addition to the 'npdi=yes' field an 'rn=' field is present,\n   then in ANSI\
    \ ISUP the 'rn=' field MUST be converted to ISUP format\n   and used to populate\
    \ the CPN.  The main telephone number in the tel\n   URL MUST be converted to\
    \ ISUP format and used to populate the Generic\n   Digits Parameter (or GAP in\
    \ ANSI).  In some other ISUP variants, the\n   number given in the 'rn=' field\
    \ would instead be prepended to the\n   main telephone number (with or without\
    \ a prefix or separator) and the\n   combined result MUST be used to populate\
    \ the CPN.  Once the 'rn=' and\n   'npdi=' parameters have been translation, the\
    \ number portability\n   translation practices are complete.\n   The following\
    \ mandatory translation practices are performed after\n   number portability translations,\
    \ if any.\n   If number portability practices are not supported by the gateway,\n\
    \   then the primary telephone number in the tel URL (the digits\n   immediately\
    \ following 'tel:') MUST be converted to ISUP format,\n   following the procedures\
    \ described in Section 12, and used to\n   populate the CPN parameter.\n   If\
    \ the primary telephone number in the Request-URI and that of the To\n   header\
    \ are at variance, then the To header SHOULD be used to populate\n   an OCN parameter.\
    \  Otherwise the To header SHOULD be ignored.\n   Some optional translation procedures\
    \ are provided for carrier-based\n   routing.  If the 'cic=' parameter is present\
    \ in the Request-URI, the\n   gateway SHOULD consult local policy to make sure\
    \ that it is\n   appropriate to transmit this Carrier Identification Code (CIC,\
    \ not to\n   be confused with the MTP3 'circuit identification code') in the IAM;\n\
    \   if the gateway supports many independent trunks, it may need to\n   choose\
    \ a particular trunk that points to the carrier identified by\n   the CIC, or\
    \ a tandem through which that carrier is reachable.\n   Policies for such trunks\
    \ (based on the preferences of the carriers\n   with which the trunks are associated\
    \ and the ISUP variant in use)\n   SHOULD dictate whether the CIP or TNS parameter\
    \ is used to carry the\n   CIC.  In the absence of any pre-arranged policies,\
    \ the TNS should be\n   used when the CPN parameter is in an international format\
    \ (i.e., the\n   tel URL portion of the Request-URI is preceded by a '+', which\
    \ will\n   generate a CPN in international format), and (where supported) the\n\
    \   CIP should be used in other cases.\n   When a SIP call has been routed to\
    \ a gateway, then the Request-URI\n   will most likely contain a tel URL (or a\
    \ SIP URI with a tel URL user\n   portion) - SIP-ISUP gateways that receive Request-URIs\
    \ that do not\n   contain valid telephone numbers SHOULD reject such requests\
    \ with an\n   appropriate response code.  Gateways SHOULD however continue to\n\
    \   process requests with a From header field that does not contain a\n   telephone\
    \ number, as will sometimes be the case if a call originated\n   at a SIP phone\
    \ that employs a SIP URI user@host convention.  The CIN\n   parameter SHOULD be\
    \ omitted from the outbound IAM if the From field\n   is unusable.  Note that\
    \ as an alternative, gateway implementers MAY\n   consider some non-standard way\
    \ of mapping particular SIP URIs to\n   telephone numbers.\n   When a gateway\
    \ receives a message with (comprehensible) encapsulated\n   ISUP, it MUST set\
    \ the FCI indicator in the generated IAM so that all\n   interworking-related\
    \ bits have the same values as their counterparts\n   in the encapsulated ISUP.\
    \  In most cases, these indicators will state\n   that no interworking was encountered,\
    \ unless interworking has been\n   encountered somewhere else in the call path.\
    \  If usable encapsulated\n   ISUP is not present in an INVITE received by the\
    \ gateway, it is\n   STRONGLY RECOMMENDED that the gateway set the Interworking\
    \ Indicator\n   bit of the FCI to 'no interworking' and the ISDN User Part Indicator\n\
    \   to 'ISUP used all the way'; the gateway MAY also set the Originating\n   Access\
    \ indicator to 'Originating access non-ISDN' (generally, it is\n   not safe to\
    \ assume that SIP phones will support ISDN endpoint\n   services, and the procedures\
    \ in this document do not detail mappings\n   to translate all such services).\n\
    \   Note that when 'interworking encountered' is set in the FCI parameter\n  \
    \ of the IAM, this indicates that ISUP is interworking with a network\n   which\
    \ is not capable of providing as many services as ISUP does.\n   ISUP networks\
    \ will therefore not employ certain features they\n   otherwise normally would,\
    \ including potentially the use of ISDN cause\n   codes in failure conditions\
    \ (as opposed to sending ACMs followed by\n   audible announcements).  If desired,\
    \ gateway vendors MAY provide a\n   configurable option, usable at the discretion\
    \ of service providers,\n   that will signal in the FCI that interworking has\
    \ been encountered\n   (and that ISUP is not used all the way) when encapsulated\
    \ ISUP is not\n   present; however, doing so may significantly limit the efficiency\
    \ and\n   transparency of SIP-ISUP translation.\n   Claiming to be an ISDN node\
    \ might make the callee request ISDN user\n   to user services.  Since user to\
    \ user services 1 and 2 must be\n   requested by the caller, they do not represent\
    \ a problem (see [14]).\n   User to user service 3 can be requested by the callee\
    \ also.  In non-\n   SIP bridging situations, the MGC should be capable of rejecting\
    \ this\n   service request.\n"
- title: 7.2.2 ISUP T7 expires
  contents:
  - "7.2.2 ISUP T7 expires\n   Since no response was received from the PSTN all the\
    \ resources in the\n   MG are released.  A '504 Server Timeout' SHOULD be sent\
    \ back to the\n   SIP network.  A REL message with cause value 102 (protocol error,\n\
    \   recovery on timer expiry) SHOULD be sent to the PSTN.  Gateways can\n   expect\
    \ the PSTN to respond with RLC and the SIP network to respond\n   with an ACK\
    \ indicating that the release sequence has been completed.\n"
- title: 7.2.3 CANCEL or BYE received
  contents:
  - "7.2.3 CANCEL or BYE received\n   If a CANCEL or BYE request is received before\
    \ a final SIP response\n   has been sent, a '200 OK' MUST be sent to the SIP network\
    \ to confirm\n   the CANCEL or BYE; a 487 MUST also be sent to terminate the INVITE\n\
    \   transaction.  All the resources are released and a REL message SHOULD\n  \
    \ be sent to the PSTN with cause value 16 (normal clearing).  Gateways\n   can\
    \ expect an RLC from the PSTN to be received indicating that the\n   release sequence\
    \ is complete.\n   In SIP bridging situations, a REL might be encapsulated in\
    \ the body\n   of a BYE request.  Although BYE is usually mapped to cause code\
    \ 16\n   (normal clearing), under exceptional circumstances the cause code in\n\
    \   the REL message might be different.  Therefore the Cause Indicator\n   parameter\
    \ of the encapsulated REL should be re-used in the REL sent\n   to the PSTN.\n\
    \   Note that a BYE or CANCEL request may contain a Reason header that\n   SHOULD\
    \ be mapped to the Cause Indicator parameter (see Section 5.8).\n   If a BYE contains\
    \ both a Reason header and encapsulated ISUP, the\n   value in the Reason header\
    \ MUST be preferred.\n   All the resources in the gateway SHOULD be released before\
    \ the\n   gateway sends any REL message.\n"
- title: 7.2.4 REL received
  contents:
  - "7.2.4 REL received\n   This section applies when a REL is received before a final\
    \ SIP\n   response has been sent.  Typically, this condition arises when a call\n\
    \   has been rejected by the PSTN.\n   Any gateway resources SHOULD be released\
    \ immediately and an RLC MUST\n   be sent to the ISUP network to indicate that\
    \ the circuit is available\n   for reuse.\n   If the INVITE that originated this\
    \ transaction contained a legitimate\n   and comprehensible encapsulated ISUP\
    \ message (i.e., an IAM using a\n   variant supported by the gateway, preferably\
    \ with a digital\n   signature), then encapsulated ISUP SHOULD be sent in the\
    \ response to\n   the INVITE when possible (since this suggests an ISUP-SIP-ISUP\n\
    \   bridging case) - therefore, the REL message just received SHOULD be\n   included\
    \ in the body of the SIP response.  The gateway SHOULD NOT\n   return a response\
    \ with encapsulated ISUP if the originator of the\n   INVITE did not enclose ISUP\
    \ itself.\n   Note that the receipt of certain maintenance messages in response\
    \ to\n   IAM such as Blocking Message (BLO) or Reset Message (RSC) (or their\n\
    \   circuit group message equivalents) may also result in the teardown of\n  \
    \ calls in this phase of the state machine.  Behavior for maintenance\n   messages\
    \ is given below in Section 11.\n"
- title: 7.2.4.1 ISDN Cause Code to Status Code Mapping
  contents:
  - "7.2.4.1 ISDN Cause Code to Status Code Mapping\n   The use of the REL message\
    \ in the SS7 network is very general,\n   whereas SIP has a number of specific\
    \ tools that, collectively, play\n   the same role as REL - namely BYE, CANCEL,\
    \ and the various\n   status/response codes.  An REL can be sent to tear down\
    \ a call that\n   is already in progress (BYE), to cancel a previously sent call\
    \ setup\n   request that has not yet been completed (CANCEL), or to reject a call\n\
    \   setup request (IAM) that has just been received (corresponding to a\n   SIP\
    \ status code).\n   Note that it is not necessarily appropriate to map some ISDN\
    \ cause\n   codes to SIP messages because these cause codes are only meaningful\n\
    \   to the ISUP interface of a gateway.  A good example of this is cause\n   code\
    \ 44 \"Request circuit or channel not available.\" 44 signifies that\n   the CIC\
    \ for which an IAM had been sent was believed by the receiving\n   equipment to\
    \ be in a state incompatible with a new call request -\n   however, the appropriate\
    \ behavior in this case is for the originating\n   switch to re-send the IAM for\
    \ a different CIC, not for the call to be\n   torn down.  Clearly, there is not\
    \ (nor should there be) an SIP status\n   code indicating that a new CIC should\
    \ be selected - this matter is\n   internal to the originating gateway.  Hence\
    \ receipt of cause code 44\n   should not result in any SIP status code being\
    \ sent; effectively, the\n   cause code is untranslatable.\n   If a cause value\
    \ other than those listed below is received, the\n   default response '500 Server\
    \ internal error' SHOULD be used.\n   Finally, in addition to the ISDN Cause Code,\
    \ the CAI parameter also\n   contains a cause 'location' that gives some sense\
    \ of which entity in\n   the network was responsible for terminating the call\
    \ (the most\n   important distinction being between the user and the network).\
    \  In\n   most cases, the cause location does not affect the mapping to a SIP\n\
    \   status code; some exceptions are noted below.  A diagnostic field may\n  \
    \ also be present for some ISDN causes; this diagnostic will contain\n   additional\
    \ data pertaining to the termination of the call.\n   The following mapping values\
    \ are RECOMMENDED:\n   Normal event\n   ISUP Cause value                     \
    \   SIP response\n   ----------------                        ------------\n  \
    \ 1  unallocated number                   404 Not Found\n   2  no route to network\
    \                  404 Not found\n   3  no route to destination              404\
    \ Not found\n   16 normal call clearing                 --- (*)\n   17 user busy\
    \                            486 Busy here\n   18 no user responding         \
    \          408 Request Timeout\n   19 no answer from the user              480\
    \ Temporarily unavailable\n   20 subscriber absent                    480 Temporarily\
    \ unavailable\n   21 call rejected                        403 Forbidden (+)\n\
    \   22 number changed (w/o diagnostic)      410 Gone\n   22 number changed (w/\
    \ diagnostic)       301 Moved Permanently\n   23 redirection to new destination\
    \       410 Gone\n   26 non-selected user clearing           404 Not Found (=)\n\
    \   27 destination out of order             502 Bad Gateway\n   28 address incomplete\
    \                   484 Address incomplete\n   29 facility rejected          \
    \          501 Not implemented\n   31 normal unspecified                   480\
    \ Temporarily unavailable\n   (*) ISDN Cause 16 will usually result in a BYE or\
    \ CANCEL\n   (+) If the cause location is 'user' than the 6xx code could be given\n\
    \   rather than the 4xx code (i.e., 403 becomes 603)\n   (=) ANSI procedure -\
    \ in ANSI networks, 26 is overloaded to signify\n   'misrouted ported number'.\
    \  Presumably, a number portability dip\n   should have been performed by a prior\
    \ network.  Otherwise cause 26 is\n   usually not used in ISUP procedures.\n \
    \  A REL with ISDN cause 22 (number changed) might contain information\n   about\
    \ a new number where the callee might be reachable in the\n   diagnostic field.\
    \  If the MGC is able to process this information it\n   SHOULD be added to the\
    \ SIP response (301) in a Contact header.\n   Resource unavailable\n   This kind\
    \ of cause value indicates a temporary failure.  A 'Retry-\n   After' header MAY\
    \ be added to the response if appropriate.\n   ISUP Cause value              \
    \          SIP response\n   ----------------                        ------------\n\
    \   34 no circuit available                 503 Service unavailable\n   38 network\
    \ out of order                 503 Service unavailable\n   41 temporary failure\
    \                    503 Service unavailable\n   42 switching equipment congestion\
    \       503 Service unavailable\n   47 resource unavailable                 503\
    \ Service unavailable\n   Service or option not available\n   This kind of cause\
    \ value indicates that there is a problem with the\n   request, rather than something\
    \ that will resolve itself over time.\n   ISUP Cause value                   \
    \     SIP response\n   ----------------                        ------------\n\
    \   55 incoming calls barred within CUG     403 Forbidden\n   57 bearer capability\
    \ not authorized     403 Forbidden\n   58 bearer capability not presently    \
    \  503 Service unavailable\n      available\n   Service or option not available\n\
    \   ISUP Cause value                        SIP response\n   ----------------\
    \                        ------------\n   65 bearer capability not implemented\
    \    488 Not Acceptable Here\n   70 only restricted digital avail        488 Not\
    \ Acceptable Here\n   79 service or option not implemented    501 Not implemented\n\
    \   Invalid message\n   ISUP Cause value                        SIP response\n\
    \   ----------------                        ------------\n   87 user not member\
    \ of CUG               403 Forbidden\n   88 incompatible destination         \
    \    503 Service unavailable\n   Protocol error\n   ISUP Cause value         \
    \               SIP response\n   ----------------                        ------------\n\
    \   102 recovery of timer expiry            504 Gateway timeout\n   111 protocol\
    \ error                      500 Server internal error\n   Interworking\n   ISUP\
    \ Cause value                        SIP response\n   ----------------       \
    \                 ------------\n   127 interworking unspecified            500\
    \ Server internal error\n"
- title: 7.2.5 Early ACM received
  contents:
  - "7.2.5 Early ACM received\n   An ACM message is sent in certain situations to\
    \ indicate that the\n   call is in progress in order to satisfy ISUP timers, rather\
    \ than to\n   signify that the callee is being alerted.  This occurs for example\
    \ in\n   mobile networks, where roaming can delay call setup significantly.\n\
    \   The early ACM is sent before the user is alerted to reset T7 and\n   start\
    \ T9.  An ACM is considered an 'early ACM' if the Called Party's\n   Status Indicator\
    \ is set to 00 (no indication).\n   After sending an early ACM, the ISUP network\
    \ can be expected to\n   indicate the further progress of the call by sending\
    \ CPGs.\n   When an early ACM is received the gateway SHOULD send a 183 Session\n\
    \   Progress response (see [1]) to the SIP network.  In SIP bridging\n   situations\
    \ (where encapsulated ISUP was contained in the INVITE that\n   initiated this\
    \ call) the early ACM SHOULD also be included in the\n   response body.\n   Note\
    \ that sending 183 before a gateway has confirmation that the\n   address is complete\
    \ (ACM) creates known problems in SIP bridging\n   cases, and it SHOULD NOT therefore\
    \ be sent.\n"
- title: 7.2.6 ACM received
  contents:
  - "7.2.6 ACM received\n   Most commonly, on receipt of an ACM a provisional response\
    \ (in the\n   18x class) SHOULD be sent to the SIP network.  If the INVITE that\n\
    \   initiated this session contained legitimate and comprehensible\n   encapsulated\
    \ ISUP, then the ACM received by the gateway SHOULD be\n   encapsulated in the\
    \ provisional response.\n   If the ACM contains a Backward Call Indicators parameter\
    \ with a value\n   of 'subscriber free', the gateway SHOULD send a '180 Ringing'\n\
    \   response.  When a 180 is sent, it is assumed, in the absence of any\n   early\
    \ media extension, that any necessary ringback tones will be\n   generated locally\
    \ by the SIP user agent to which the gateway is\n   responding (which may in turn\
    \ be a gateway).\n   If the Backward Call Indicators (BCI) parameter of the ACM\
    \ indicates\n   that interworking has been encountered (generally designating\
    \ that\n   the ISUP network sending the ACM is interworking with a less\n   sophisticated\
    \ network which cannot report its status via out-of-band\n   signaling), then\
    \ there may be in-band announcements of call status\n   such as an audible busy\
    \ tone or caller intercept message, and if\n   possible a backwards media transmission\
    \ SHOULD be initiated.\n   Backwards media SHOULD also be transmitted if the Optional\
    \ Backward\n   Call Indicators parameter field for in-band media is set.  For\
    \ more\n   information on early media (before 200 OK/ANM) see Section 5.5.\n \
    \  After early media transmission has been initiated, the gateway SHOULD\n   send\
    \ a 183 Session Progress response code.\n   Gateways MAY have some means of ascertaining\
    \ the disposition of in-\n   band audio media; for example, a way of determining\
    \ by inspecting\n   signaling in some ISUP variants, or by listening to the audio,\
    \ that\n   ringing, or a busy tone, is being played over the circuit.  Such\n\
    \   gateways MAY elect to discard the media and send the corresponding\n   response\
    \ code (such as 180 or 486) in its stead.  However, the\n   implementation of\
    \ such a gateway would entail overcoming a number of\n   known challenges that\
    \ are outside the scope of this document.\n   When they receive an ACM, switches\
    \ in many ISUP networks start a\n   timer known as \"T9\" which usually lasts\
    \ between 90 seconds and 3\n   minutes (see [13]).  When early media is being\
    \ played, this timer\n   permits the caller to hear backwards audio media (in\
    \ the form\n   ringback, tones or announcements) from a remote switch in the ISUP\n\
    \   network for that period of time without incurring any charge for the\n   connection.\
    \  The nearest possible local ISUP exchange to the callee\n   generates the ringback\
    \ tone or voice announcements.  If longer\n   announcements have to be played,\
    \ the network has to send an ANM,\n   which initiates bidirectional media of indefinite\
    \ duration.  In\n   common ISUP network practice, billing commences when the ANM\
    \ is\n   received.  Some networks do not support timer T9.\n"
- title: 7.2.7 CON or ANM Received
  contents:
  - "7.2.7 CON or ANM Received\n   When an ANM or CON message is received, the call\
    \ has been answered\n   and thus '200 OK' response SHOULD be sent to the SIP network.\
    \  This\n   200 OK SHOULD contain an answer to the media offered in the INVITE.\n\
    \   In SIP bridging situations (when the INVITE that initiated this call\n   contained\
    \ legitimate and comprehensible encapsulated ISUP), the ISUP\n   message is included\
    \ in the body of the 200 OK response.  If it has\n   not done so already, the\
    \ gateway MUST establish a bidirectional media\n   stream at this time.\n   When\
    \ there is interworking with some legacy networks, it is possible\n   for an ISUP\
    \ switch to receive an ANM immediately after an early ACM\n   (without CPG or\
    \ any other backwards messaging), or without receiving\n   any ACM at all (when\
    \ an automaton answers the call).  In this\n   situation the SIP user will never\
    \ have received a 18x provisional\n   response, and consequently they will not\
    \ hear any kind of ringtone\n   before the callee answers.  This may result in\
    \ some clipping of the\n   initial forward media from the caller (since forward\
    \ media\n   transmission cannot commence until SDP has been acquired from the\n\
    \   destination).  In ISDN (see [12]) this is solved by connecting the\n   voice\
    \ path backwards before sending the IAM.\n"
- title: 7.2.8 Timer T9 Expires
  contents:
  - "7.2.8 Timer T9 Expires\n   The expiry of this timer (which is not used in all\
    \ networks)\n   signifies that an ANM has not arrived a significant period of\
    \ time\n   after alerting began (with the transmission of an ACM) for this call.\n\
    \   Usually, this means that the callee's terminal has been alerted for\n   many\
    \ rings but has not been answered.  It may also occur in\n   interworking cases\
    \ when the network is playing a status announcement\n   (such as one indicating\
    \ that a number is not in service) that has\n   cycled several times.  Whatever\
    \ the cause of the protracted\n   incomplete call, when this timer expires the\
    \ call MUST be released.\n   All of the gateway resources related to the media\
    \ path SHOULD be\n   released.  A '480 Temporarily Unavailable' response code\
    \ SHOULD be\n   sent to the SIP network, and an REL message with cause value 19\
    \ (no\n   answer from the user) SHOULD be sent to the ISUP network.  The PSTN\n\
    \   can be expected to respond with an RLC and the SIP network to respond\n  \
    \ with an ACK indicating that the release sequence has been completed.\n"
- title: 7.2.9 CPG Received
  contents:
  - "7.2.9 CPG Received\n   A CPG is a provisional message that can indicate progress,\
    \ alerting\n   or in-band information.  If a CPG suggests that in-band information\n\
    \   is available, the gateway SHOULD begin to transmit early media and\n   cut\
    \ through the unidirectional backwards media path.\n   In SIP bridging situations\
    \ (when the INVITE that initiated this\n   session contained legitimate and comprehensible\
    \ encapsulated ISUP),\n   the CPG SHOULD be sent in the body of a particular 18x\
    \ response,\n   determined from the CPG Event Code as follows:\n   ISUP event\
    \ code                         SIP response\n   ----------------             \
    \           ------------\n   1 Alerting                              180 Ringing\n\
    \   2 Progress                              183 Session progress\n   3 In-band\
    \ information                   183 Session progress\n   4 Call forward; line\
    \ busy               181 Call is being forwarded\n   5 Call forward; no reply\
    \                181 Call is being forwarded\n   6 Call forward; unconditional\
    \           181 Call is being forwarded\n   - (no event code present)        \
    \       183 Session progress\n   Note that if the CPG does not indicate \"Alerting,\"\
    \ the current state\n   will not change.\n"
- title: 7.3 ACK received
  contents:
  - "7.3 ACK received\n   At this stage, the call is fully connected and the conversation\
    \ can\n   take place.  No ISUP message should be sent by the gateway when an\n\
    \   ACK is received.\n"
- title: 8. ISUP to SIP Mapping
  contents:
  - '8. ISUP to SIP Mapping

    '
- title: 8.1 ISUP to SIP Call Flows
  contents:
  - "8.1 ISUP to SIP Call Flows\n   The following call flows illustrate the order\
    \ of messages in typical\n   success and error cases when setting up a call initiated\
    \ from the\n   PSTN network.  \"100 Trying\" acknowledgements to INVITE requests\
    \ are\n   not depicted, since their presence is optional.\n   In these diagrams,\
    \ all call signaling (SIP, ISUP) is going to and\n   from the MGC; media handling\
    \ (e.g., audio cut-through, trunk freeing)\n   is being performed by the MG, under\
    \ the control of the MGC.  For the\n   purpose of simplicity, these are shown\
    \ as a single node, labeled\n   \"MGC/MG\".\n"
- title: 8.1.1 En-bloc call setup (non auto-answer)
  contents:
  - "8.1.1 En-bloc call setup (non auto-answer)\n       SIP                      \
    \ MGC/MG                       PSTN\n         |                          |<-----------IAM-----------|1\n\
    \         |                          |==========Audio==========>|\n        2|<--------INVITE-----------|\
    \                          |\n         |-----------100----------->|          \
    \                |\n        3|-----------18x----------->|                    \
    \      |\n         |==========Audio==========>|                          |\n \
    \        |                          |=========================>|\n         | \
    \                         |------------ACM---------->|4\n        5|-----------18x----------->|\
    \                          |\n         |                          |------------CPG---------->|6\n\
    \        7|-----------200-(I)------->|                          |\n         |<=========Audio==========>|\
    \                          |\n         |                          |------------ANM---------->|8\n\
    \         |                          |<=========Audio==========>|\n        9|<----------ACK------------|\
    \                          |\n   1.  When a PSTN user wishes to begin a session\
    \ with a SIP user, the\n       PSTN network generates an IAM message towards the\
    \ gateway.\n   2.  Upon receipt of the IAM message, the gateway generates an INVITE\n\
    \       message, and sends it to an appropriate SIP node.\n   3.  When an event\
    \ signifying that the call has sufficient addressing\n       information occurs,\
    \ the SIP node will generate a provisional\n       response of 180 or greater.\n\
    \   4.  Upon receipt of a provisional response of 180 or greater, the\n      \
    \ gateway will generate an ACM message.  If the response is not\n       180, the\
    \ ACM will carry a \"called party status\" value of \"no\n       indication.\"\
    \n   5.  The SIP node may use further provisional messages to indicate\n     \
    \  session progress.\n   6.  After an ACM has been sent, all provisional responses\
    \ will\n       translate into ISUP CPG messages as indicated in Section 8.2.3.\n\
    \   7.  When the SIP node answers the call, it will send a 200 OK\n       message.\n\
    \   8.  Upon receipt of the 200 OK message, the gateway will send an ANM\n   \
    \    message towards the ISUP node.\n   9.  The gateway will send an ACK to the\
    \ SIP node to acknowledge\n       receipt of the INVITE final response.\n"
- title: 8.1.2 Auto-answer call setup
  contents:
  - "8.1.2 Auto-answer call setup\n       SIP                       MGC/MG       \
    \                PSTN\n         |                          |<-----------IAM-----------|1\n\
    \         |                          |==========Audio==========>|\n        2|<--------INVITE-----------|\
    \                          |\n        3|-----------200----------->|          \
    \                |\n         |<=========Audio==========>|                    \
    \      |\n         |                          |------------CON---------->|4\n\
    \         |                          |<=========Audio==========>|\n        5|<----------ACK------------|\
    \                          |\n   1.  When a PSTN user wishes to begin a session\
    \ with a SIP user, the\n       PSTN network generates an IAM message towards the\
    \ gateway.\n   2.  Upon receipt of the IAM message, the gateway generates an INVITE\n\
    \       message and sends it to an appropriate SIP node based on called\n    \
    \   number analysis.\n   3.  Since the SIP node is set up to automatically answer\
    \ the call, it\n       will send a 200 OK message.\n   4.  Upon receipt of the\
    \ 200 OK message, the gateway will send a CON\n       message towards the ISUP\
    \ node.\n   5.  The gateway will send an ACK to the SIP node to acknowledge\n\
    \       receipt of the INVITE final response.\n"
- title: 8.1.3 SIP Timeout
  contents:
  - "8.1.3 SIP Timeout\n       SIP                       MGC/MG                  \
    \     PSTN\n         |                          |<-----------IAM-----------|1\n\
    \         |                          |==========Audio==========>|\n        2|<--------INVITE-----------|\
    \                          |\n         |    *** T1 Expires ***    |          \
    \                |\n        3|<--------INVITE-----------|                    \
    \      |\n         |    *** T1 Expires ***    |                          |\n \
    \        |<--------INVITE-----------|                          |\n         | \
    \                         |    *** T11 Expires ***   |\n         |           \
    \               |------------ACM---------->|4\n         |    *** T1 Expires ***\
    \    |                          |\n         |<--------INVITE-----------|     \
    \                     |\n         |    *** T1 Expires ***    |               \
    \           |\n         |<--------INVITE-----------|                         \
    \ |\n         |    *** T1 Expires ***    |                          |\n      \
    \   |<--------INVITE-----------|                          |\n         |    ***\
    \ T1 Expires ***    |                          |\n         |<--------INVITE-----------|\
    \                          |\n         |    *** T1 Expires ***    |          \
    \                |\n         |             ** MG Releases PSTN Trunk **      \
    \      |\n         |                          |------------REL---------->|5\n\
    \        6|<--------CANCEL-----------|                          |\n         |\
    \                          |<-----------RLC-----------|7\n   1.  When a PSTN user\
    \ wishes to begin a session with a SIP user, the\n       PSTN network generates\
    \ an IAM message towards the gateway.\n   2.  Upon receipt of the IAM message,\
    \ the gateway generates an INVITE\n       message, and sends it to an appropriate\
    \ SIP node based on called\n       number analysis.  The ISUP timer T11 and SIP\
    \ timer T1 are set at\n       this time.\n   3.  The INVITE message will continue\
    \ to be sent to the SIP node each\n       time the timer T1 expires.  The SIP\
    \ standard specifies that\n       INVITE transmission will be performed 7 times\
    \ if no response is\n       received.\n   4.  When T11 expires, an ACM message\
    \ will be sent to the ISUP node to\n       prevent the call from being torn down\
    \ by the remote node's ISUP\n       T7.  This ACM contains a 'Called Party Status'\
    \ value of 'no\n       indication.'\n   5.  Once the maximum number of INVITE\
    \ requests has been sent, the\n       gateway will send a REL (cause code 18)\
    \ to the ISUP node to\n       terminate the call.\n   6.  The gateway also sends\
    \ a CANCEL message to the SIP node to\n       terminate any initiation attempts.\n\
    \   7.  Upon receipt of the REL, the remote ISUP node will send an RLC to\n  \
    \     acknowledge.\n"
- title: 8.1.4 ISUP T9 Expires
  contents:
  - "8.1.4 ISUP T9 Expires\n       SIP                       MGC/MG              \
    \         PSTN\n         |                          |<-----------IAM-----------|1\n\
    \         |                          |==========Audio==========>|\n        2|<--------INVITE-----------|\
    \                          |\n         |    *** T1 Expires ***    |          \
    \                |\n        3|<--------INVITE-----------|                    \
    \      |\n         |    *** T1 Expires ***    |                          |\n \
    \        |<--------INVITE-----------|                          |\n         | \
    \                         |    *** T11 Expires ***   |\n         |           \
    \               |------------ACM---------->|4\n         |    *** T1 Expires ***\
    \    |                          |\n         |<--------INVITE-----------|     \
    \                     |\n         |    *** T1 Expires ***    |               \
    \           |\n         |<--------INVITE-----------|                         \
    \ |\n         |    *** T1 Expires ***    |                          |\n      \
    \   |<--------INVITE-----------|                          |\n         |      \
    \                    |    *** T9 Expires ***    |\n         |             ** MG\
    \ Releases PSTN Trunk **            |\n         |                          |<-----------REL-----------|5\n\
    \         |                          |------------RLC---------->|6\n        7|<--------CANCEL-----------|\
    \                          |\n   1.  When a PSTN user wishes to begin a session\
    \ with a SIP user, the\n       PSTN network generates an IAM message towards the\
    \ gateway.\n   2.  Upon receipt of the IAM message, the gateway generates an INVITE\n\
    \       message, and sends it to an appropriate SIP node based on called\n   \
    \    number analysis.  The ISUP timer T11 and SIP timer T1 are set at\n      \
    \ this time.\n   3.  The INVITE message will continue to be sent to the SIP node\
    \ each\n       time the timer T1 expires.  The SIP standard specifies that\n \
    \      INVITE transmission will be performed 7 times if no response is\n     \
    \  received.  Since SIP T1 starts at 1/2 second or more and doubles\n       each\
    \ time it is retransmitted, it will be at least a minute\n       before SIP times\
    \ out the INVITE request; since SIP T1 is allowed\n       to be larger than 500\
    \ ms initially, it is possible that 7 x SIP\n       T1 will be longer than ISUP\
    \ T11 + ISUP T9.\n   4.  When T11 expires, an ACM message will be sent to the\
    \ ISUP node to\n       prevent the call from being torn down by the remote node's\
    \ ISUP\n       T7.  This ACM contains a 'Called Party Status' value of 'no\n \
    \      indication.'\n   5.  When ISUP T9 in the remote PSTN node expires, it will\
    \ send a REL.\n   6.  Upon receipt of the REL, the gateway will send an RLC to\n\
    \       acknowledge.\n   7.  The REL will trigger a CANCEL request, which gets\
    \ sent to the SIP\n       node.\n"
- title: 8.1.5 SIP Error Response
  contents:
  - "8.1.5 SIP Error Response\n       SIP                       MGC/MG           \
    \            PSTN\n         |                          |<-----------IAM-----------|1\n\
    \         |                          |==========Audio==========>|\n        2|<--------INVITE-----------|\
    \                          |\n        3|-----------4xx+---------->|          \
    \                |\n        4|<----------ACK------------|                    \
    \      |\n         |             ** MG Releases PSTN Trunk **            |\n \
    \        |                          |------------REL---------->|5\n         |\
    \                          |<-----------RLC-----------|6\n   1.  When a PSTN user\
    \ wishes to begin a session with a SIP user, the\n       PSTN network generates\
    \ an IAM message towards the gateway.\n   2.  Upon receipt of the IAM message,\
    \ the gateway generates an INVITE\n       message, and sends it to an appropriate\
    \ SIP node based on called\n       number analysis.\n   3.  The SIP node indicates\
    \ an error condition by replying with a\n       response with a code of 400 or\
    \ greater.\n   4.  The gateway sends an ACK message to acknowledge receipt of\
    \ the\n       INVITE final response.\n   5.  An ISUP REL message is generated\
    \ from the SIP code, as specified\n       in Section 8.2.6.1.\n   6.  The remote\
    \ ISUP node confirms receipt of the REL message with an\n       RLC message.\n"
- title: 8.1.6 SIP Redirection
  contents:
  - "8.1.6 SIP Redirection\n       SIP node 1                MGC/MG              \
    \         PSTN\n         |                          |<-----------IAM-----------|1\n\
    \         |                          |==========Audio==========>|\n        2|<--------INVITE-----------|\
    \                          |\n        3|-----------3xx+---------->|          \
    \                |\n         |                          |------------CPG---------->|4\n\
    \        5|<----------ACK------------|                          |\n          \
    \                          |                          |\n                    \
    \                |                          |\n       SIP node 2             \
    \      |                          |\n        6|<--------INVITE-----------|   \
    \                       |\n        7|-----------18x----------->|             \
    \             |\n         |<=========Audio===========|                       \
    \   |\n         |                          |------------ACM---------->|8\n   \
    \     9|-----------200-(I)------->|                          |\n         |<=========Audio==========>|\
    \                          |\n         |                          |------------ANM---------->|10\n\
    \         |                          |<=========Audio==========>|\n       11|<----------ACK------------|\
    \                          |\n   1.  When a PSTN user wishes to begin a session\
    \ with a SIP user, the\n       PSTN network generates an IAM message towards the\
    \ gateway.\n   2.  Upon receipt of the IAM message, the gateway generates an INVITE\n\
    \       message, and sends it to an appropriate SIP node based on called\n   \
    \    number analysis.\n   3.  The SIP node indicates that the resource which the\
    \ user is\n       attempting to contact is at a different location by sending\
    \ a 3xx\n       message.  In this instance we assume the Contact URL specifies\
    \ a\n       valid URL reachable by a VoIP SIP call.\n   4.  The gateway sends\
    \ a CPG with event indication that the call is\n       being forwarded upon receipt\
    \ of the 3xx message.  Note that this\n       translation should be able to be\
    \ disabled by configuration, as\n       some ISUP nodes do not support receipt\
    \ of CPG messages before ACM\n       messages.\n   5.  The gateway acknowledges\
    \ receipt of the INVITE final response by\n       sending an ACK message to the\
    \ SIP node.\n   6.  The gateway re-sends the INVITE message to the address indicated\n\
    \       in the Contact: field of the 3xx message.\n   7.  When an event signifying\
    \ that the call has sufficient addressing\n       information occurs, the SIP\
    \ node will generate a provisional\n       response of 180 or greater.\n   8.\
    \  Upon receipt of a provisional response of 180 or greater, the\n       gateway\
    \ will generate an ACM message with an event code as\n       indicated in Section\
    \ 8.2.3.\n   9.  When the SIP node answers the call, it will send a 200 OK\n \
    \      message.\n   10. Upon receipt of the 200 OK message, the gateway will send\
    \ an ANM\n       message towards the ISUP node.\n   11. The gateway will send\
    \ an ACK to the SIP node to acknowledge\n       receipt of the INVITE final response.\n"
- title: 8.1.7 Call Canceled by ISUP
  contents:
  - "8.1.7 Call Canceled by ISUP\n       SIP                       MGC/MG        \
    \               PSTN\n         |                          |<-----------IAM-----------|1\n\
    \         |                          |==========Audio==========>|\n        2|<--------INVITE-----------|\
    \                          |\n        3|-----------18x----------->|          \
    \                |\n         |==========Audio==========>|                    \
    \      |\n         |                          |------------ACM---------->|4\n\
    \         |             ** MG Releases PSTN Trunk **            |\n         |\
    \                          |<-----------REL-----------|5\n         |         \
    \                 |------------RLC---------->|6\n        7|<---------CANCEL----------|\
    \                          |\n         |            ** MG Releases IP Resources\
    \ **           |\n        8|-----------200----------->|                      \
    \    |\n        9|-----------487----------->|                          |\n   \
    \    10|<----------ACK------------|                          |\n   1.  When a\
    \ PSTN user wishes to begin a session with a SIP user, the\n       PSTN network\
    \ generates an IAM message towards the gateway.\n   2.  Upon receipt of the IAM\
    \ message, the gateway generates an INVITE\n       message, and sends it to an\
    \ appropriate SIP node based on called\n       number analysis.\n   3.  When an\
    \ event signifying that the call has sufficient addressing\n       information\
    \ occurs, the SIP node will generate a provisional\n       response of 180 or\
    \ greater.\n   4.  Upon receipt of a provisional response of 180 or greater, the\n\
    \       gateway will generate an ACM message with an event code as\n       indicated\
    \ in Section 8.2.3.\n   5.  If the calling party hangs up before the SIP node\
    \ answers the\n       call, a REL message will be generated.\n   6.  The gateway\
    \ frees the PSTN circuit and indicates that it is\n       available for reuse\
    \ by sending an RLC.\n   7.  Upon receipt of a REL message before an INVITE final\
    \ response,\n       the gateway will send a CANCEL towards the SIP node.\n   8.\
    \  Upon receipt of the CANCEL, the SIP node will send a 200\n       response.\n\
    \   9.  The remote SIP node will send a \"487 Call Cancelled\" to complete\n \
    \      the INVITE transaction.\n   10. The gateway will send an ACK to the SIP\
    \ node to acknowledge\n       receipt of the INVITE final response.\n"
- title: 8.2 State Machine
  contents:
  - "8.2 State Machine\n   Note that REL may arrive in any state.  Whenever this occurs,\
    \ the\n   actions in section Section 8.2.7. are taken.  Not all of these\n   transitions\
    \ are shown in this diagram.\n                                 +---------+\n \
    \       +----------------------->|  Idle   |<---------------------+\n        |\
    \                        +----+----+                      |\n        |       \
    \                      |                           |\n        |              \
    \               | IAM/7.2.1                 |\n        |                     \
    \        V                           |\n        |    REL/7.2.7    +-------------------------+\
    \ 400+/7.2.6  |\n        +<----------------+         Trying          |------------>|\n\
    \        |                 +-+--------+------+-------+             |\n       \
    \ |                   |        |      |                     |\n        |     \
    \              | T11/   | 18x/ | 200/                |\n        |            \
    \       | 7.2.8  |7.2.3 | 7.2.4               |\n        |                   V\
    \        |      |                     |\n        | REL/7.2.7 +--------------+\
    \ |      |      400+/7.2.6     |\n        |<----------| Progressing  |-|------|-------------------->|\n\
    \        |           +--+----+------+ |      |                     |\n       \
    \ |              |    |        |      |                     |\n        |     \
    \   200/  |    | 18x/   |      |                     |\n        |        7.2.4\
    \ |    | 7.2.3  |      |                     |\n        |              |    V\
    \        V      |                     |\n        |  REL/7.2.7   |  +---------------+\
    \ |      400+/7.2.6     |\n        |<-------------|--|    Alerting   |-|-------------------->|\n\
    \        |              |  +--------+------+ |                     |\n       \
    \ |              |           |        |                     |\n        |     \
    \         |           | 200/   |                     |\n        |            \
    \  |           | 7.2.4  |                     |\n        |              V    \
    \       V        V                     |\n        |     BYE/9.1 +-----------------------------+\
    \    REL/9.2  |\n        +<------------+          Connected          +------------>+\n\
    \                      +-----------------------------+\n"
- title: 8.2.1 Initial Address Message received
  contents:
  - "8.2.1 Initial Address Message received\n   Upon receipt of an IAM, the gateway\
    \ SHOULD reserve appropriate\n   internal resources (Digital Signal Processors\
    \ - DSPs - and the like)\n   necessary for handling the IP side of the call. \
    \ It MAY make any\n   necessary preparations to connect audio in the backwards\
    \ direction\n   (towards the caller).\n"
- title: 8.2.1.1 IAM to INVITE procedures
  contents:
  - "8.2.1.1 IAM to INVITE procedures\n   When an IAM arrives at a PSTN-SIP gateway,\
    \ a SIP INVITE message MUST\n   be created for transmission to the SIP network.\
    \  This section details\n   the process by which a gateway populates the fields\
    \ of the INVITE\n   based on parameters found within the IAM.\n   The context\
    \ of the call setup request read by the gateway in the IAM\n   will be mapped\
    \ primarily to two URIs in the INVITE, one representing\n   the originator of\
    \ the session and the other its destination.  The\n   former will always appear\
    \ in the From header (after it has been\n   converted from ISUP format by the\
    \ procedure described in Section 12),\n   and the latter is almost always used\
    \ for both the To header and the\n   Request-URI.\n   Once the address of the\
    \ called party number has been read from the\n   IAM, it SHOULD be translated\
    \ into a destination tel URL that will\n   serve as the Request-URI of the INVITE.\
    \  Alternatively, a gateway MAY\n   first attempt a Telephone Number Mapping (ENUM)\
    \ [8] query to resolve\n   the called party number to a URI.  Some additional\
    \ ISUP fields MAY be\n   added to the tel URL after translation has been completed,\
    \ namely:\n   o  If the gateway supports carrier-based routing (which is optional\n\
    \      in this specification), it SHOULD ascertain if either the CIP (in\n   \
    \   ANSI networks) or TNS parameter is present in the IAM.  If a value\n     \
    \ is present, the CIC SHOULD be extracted from the given parameter\n      and\
    \ analyzed by the gateway.  A 'cic=' field with the value of the\n      CIC SHOULD\
    \ be appended to the destination tel URL, if doing so is\n      in keeping with\
    \ local policy (i.e., provided that the CIC does not\n      indicate the network\
    \ which owns the gateway or some similar\n      condition).  Note that if it is\
    \ created, the 'cic=' parameter MUST\n      be prefixed with the country code\
    \ used or implied in the called\n      party number, so that CIC '5062' becomes,\
    \ in the United States,\n      '+1-5062'.  For further information on the 'cic='\
    \ tel URL field\n      see [21].\n   o  If the gateway supports number portability-based\
    \ routing (which is\n      optional in this specification), then the gateway will\
    \ need to\n      look at a few other fields.  To correctly map the FCI 'number\n\
    \      translated' bit indicating that an LNP dip had been performed in\n    \
    \  the PSTN, an 'npdi=yes' field SHOULD be appended to the tel URL.\n      If\
    \ a GAP is present in the IAM, then the contents of the CPN (the\n      Location\
    \ Routing Number - LRN) SHOULD be translated from ISUP\n      format (as described\
    \ in Section 12) and copied into an 'rn=' field\n      which must be appended\
    \ to the tel URL, whereas the GAP itself\n      should be translated to ISUP format\
    \ and used to populate the\n      primary telephone number field of the tel URL.\
    \  Note that in some\n      national numbering plans, both the LRN and the dialed\
    \ number may\n      be stored in the CPN parameter, in which case they must be\n\
    \      separated out into different fields to be stored in the tel URL.\n    \
    \  Note that LRNs are necessarily national in scope, and consequently\n      they\
    \ MUST NOT be preceded by a '+' in the 'rn=' field.  For\n      further information\
    \ on these tel URL fields see [21].\n   In most cases, the resulting destination\
    \ tel URL SHOULD be used in\n   both the To field and Request-URI sent by the\
    \ gateway.  However, if\n   the OCN parameter is present in the IAM, the To field\
    \ SHOULD be\n   constructed from the translation (from ISUP format following Section\n\
    \   12 of the OCN parameter, and hence the Request-URI and To field MAY\n   be\
    \ different.\n   The construction of the From header field is dependent on the\n\
    \   presence of a CIN parameter.  If the CIN is not present, then the\n   gateway\
    \ SHOULD create a dummy From header field containing a SIP URI\n   without a user\
    \ portion which communicates only the hostname of the\n   gateway (e.g., 'sip:gw.sipcarrier.com).\
    \  If the CIN is available,\n   then it SHOULD be translated (in accordance with\
    \ the procedure\n   described above) into a tel URL which should populate the\
    \ From header\n   field.  In either case, local policy or requests for presentation\n\
    \   restriction (see Section 12.1) MAY result in a different value for\n   the\
    \ From header field.\n"
- title: 8.2.2 100 received
  contents:
  - "8.2.2 100 received\n   A 100 response SHOULD NOT trigger any PSTN interworking\
    \ messages; it\n   only serves the purpose of suppressing INVITE retransmissions.\n"
- title: 8.2.3 18x received
  contents:
  - "8.2.3 18x received\n   Upon receipt of a 18x provisional response, if no ACM\
    \ has been sent\n   and no legitimate and comprehensible ISUP is present in the\
    \ 18x\n   message body, then the ISUP message SHOULD be generated according to\n\
    \   the following table.  Note that if an early ACM is sent, the call\n   MUST\
    \ enter state \"Progressing\" instead of state \"Alerting.\"\n   Response received\
    \                        Message sent by the MGC\n   -----------------       \
    \                 -----------------------\n   180 Ringing                    \
    \          ACM (BCI = subscriber free)\n   181 Call is being forwarded       \
    \       Early ACM and CPG, event=6\n   182 Queued                            \
    \   ACM (BCI = no indication)\n   183 Session progress message             ACM\
    \ (BCI = no indication)\n   If an ACM has already been sent and no ISUP is present\
    \ in the 18x\n   message body, an ISUP message SHOULD be generated according to\
    \ the\n   following table.\n   Response received                        Message\
    \ sent by the MGC\n   -----------------                        -----------------------\n\
    \   180 Ringing                              CPG, event = 1 (Alerting)\n   181\
    \ Call is being forwarded              CPG, event = 6 (Forwarding)\n   182 Queued\
    \                               CPG, event = 2 (Progress)\n   183 Session progress\
    \ message             CPG, event = 2 (Progress)\n   Upon receipt of a 180 response,\
    \ the gateway SHOULD generate the\n   ringback tone to be heard by the caller\
    \ on the PSTN side (unless the\n   gateway knows that ringback will be provided\
    \ by the network on the\n   PSTN side).\n   Note however that a gateway might\
    \ receive media at any time after it\n   has transmitted an SDP offer that it\
    \ has sent in an INVITE, even\n   before a 18x provisional response is received.\
    \  Therefore the gateway\n   MUST be prepared to play this media to the caller\
    \ on the PSTN side\n   (if necessary, ceasing any ringback tone that it may have\
    \ begun to\n   generate and then playing media).  Note that the gateway may also\n\
    \   receive SDP offers in responses for an early media session using some\n  \
    \ SIP extension, see Section 5.5.  If a gateway receives a 183 response\n   while\
    \ it is playing backwards media, then when it generates a mapping\n   for this\
    \ response, if no encapsulated ISUP is present, the gateway\n   SHOULD indicate\
    \ that in-band information is available (for example,\n   with the Event Information\
    \ parameter of the CPG message or the\n   Optional Backward Call Indicators parameter\
    \ of the ACM).\n   When an ACM is sent, the mandatory Backward Call Indicators\
    \ parameter\n   must be set, as well as any optional parameters as gateway policy\n\
    \   dictates.  If legitimate and comprehensible ISUP is present in the\n   18x\
    \ response, the gateway SHOULD re-use the appropriate parameters of\n   the ISUP\
    \ message contained in the response body, including the value\n   of the Backward\
    \ Call Indicator parameter, as it formulates a message\n   that it will send across\
    \ its PSTN interface.  In the absence of a\n   usable encapsulated ACM, the BCI\
    \ parameter SHOULD be set as follows:\n   Message type:                      \
    \      ACM\n   Backward Call Indicators\n   Charge indicator:                \
    \      10 charge\n   Called party's status indicator:       01 subscriber free\
    \ or\n                                          00 no indication\n   Called party's\
    \ category indicator:     01 ordinary subscriber\n   End-to-end method indicator:\
    \           00 no end-to-end method\n   Interworking indicator:              \
    \  0  no interworking\n   End-to-end information indicator:      0  no end-to-end\
    \ info\n   ISDN user part indicator:              1  ISUP used all the way\n \
    \  Holding indicator:                     0  no holding\n   ISDN access indicator:\
    \                 0  No ISDN access\n   Echo control device indicator:       \
    \  It depends on the call\n   SCCP method indicator:                 00 no indication\n\
    \   Note that when the ISUP Backward Call Indicator parameter\n   Interworking\
    \ indicator field is set to 'interworking encountered',\n   this indicates that\
    \ ISDN is interworking with a network which is not\n   capable of providing as\
    \ many services as ISDN does.  ISUP therefore\n   may not employ certain features\
    \ it otherwise normally uses.  Gateway\n   vendors MAY however provide a configurable\
    \ option, usable at the\n   discretion of service providers when they require\
    \ additional ISUP\n   services, that in the absence of encapsulated ISUP will\
    \ signal in the\n   BCI that interworking has been encountered, and that ISUP\
    \ is not used\n   all the way, for those operators that as a matter of policy\
    \ would\n   rather operate in this mode.  For more information on the effects\
    \ of\n   interworking see Section 7.2.1.1.\n"
- title: 8.2.4 2xx received
  contents:
  - "8.2.4 2xx received\n   Response received                        Message sent\
    \ by the MGC\n   -----------------                        -----------------------\n\
    \   200 OK                                   ANM, ACK\n   After receiving a 200\
    \ OK response the gateway MUST establish a\n   directional media path in the gateway\
    \ and send an ANM to the PSTN as\n   well as an ACK to the SIP network.\n   If\
    \ the 200 OK response arrives before the gateway has sent an ACM, a\n   CON is\
    \ sent instead of the ANM, in those ISUP variants that support\n   the CON message.\n\
    \   When a legitimate and comprehensible ANM is encapsulated in the 200\n   OK\
    \ response, the gateway SHOULD re-use any relevant ISUP parameters\n   in the\
    \ ANM it sends to the PSTN.\n   Note that gateways may sometimes receive 200 OK\
    \ responses for\n   requests other than INVITE (for example, those used in managing\n\
    \   provisional responses, or the INFO method).  The procedures described\n  \
    \ in this section apply only to 200 OK responses received as a result\n   of sending\
    \ an INVITE.  The gateway SHOULD NOT send any PSTN messages\n   if it receives\
    \ a 200 OK in response to non-INVITE requests it has\n   sent.\n"
- title: 8.2.5 3xx Received
  contents:
  - "8.2.5 3xx Received\n   When any 3xx response (a redirection) is received, the\
    \ gateway SHOULD\n   try to reach the destination by sending one or more new call\
    \ setup\n   requests using URIs found in any Contact header field(s) present in\n\
    \   the response, as is mandated in the base SIP specification.  Such 3xx\n  \
    \ responses are typically sent by a redirect server, and can be thought\n   of\
    \ as similar to a location register in mobile PSTN networks.\n   If a particular\
    \ URI presented in the Contact header of a 3xx is best\n   reachable (according\
    \ to the gateway's routing policies) via the PSTN,\n   the gateway SHOULD send\
    \ a new IAM and from that moment on act as a\n   normal PSTN switch (no SIP involved)\
    \ - usually this will be the case\n   when the URI in the Contact header is a\
    \ tel URL, one that the gateway\n   cannot reach locally and one for which there\
    \ is no ENUM mapping.\n   Alternatively, the gateway MAY send a REL message to\
    \ the PSTN with a\n   redirection indicator (23) and a diagnostic field corresponding\
    \ to\n   the telephone number in the URI.  If, however, the new location is\n\
    \   best reachable using SIP (if the URI in the Contact header contains\n   no\
    \ telephone number at all), the MGC SHOULD send a new INVITE with a\n   Request-URI\
    \ possibly a new IAM generated by the MGC in the message\n   body.\n   While it\
    \ is exploring a long list of Contact header fields with SIP\n   requests, a gateway\
    \ MAY send a CPG message with an event code of 6\n   (Forwarding) to the PSTN\
    \ in order to indicate that the call is\n   proceeding (where permitted by the\
    \ ISUP variant in question).\n   All redirection situations have to be treated\
    \ very carefully because\n   they involved special charging situations.  In PSTN\
    \ the caller\n   typically pays for the first leg (to the gateway) and the callee\
    \ pays\n   the second (from the forwarding switch to the destination).\n"
- title: 8.2.6 4xx-6xx Received
  contents:
  - "8.2.6 4xx-6xx Received\n   When a response code of 400 or greater is received\
    \ by the gateway,\n   then the INVITE previously sent by the gateway has been\
    \ rejected.\n   Under most circumstances the gateway SHOULD release the resources\
    \ in\n   the gateway, send a REL to the PSTN with a cause value and send an\n\
    \   ACK to the SIP network.  Some specific circumstances are identified\n   below\
    \ in which a gateway MAY attempt to rectify a SIP-specific\n   problem communicated\
    \ by a status code without releasing the call by\n   retrying the request.  When\
    \ a REL is sent to the PSTN, the gateway\n   expects the arrival of an RLC indicating\
    \ that the release sequence is\n   complete.\n"
- title: 8.2.6.1 SIP Status Code to ISDN Cause Code Mapping
  contents:
  - "8.2.6.1 SIP Status Code to ISDN Cause Code Mapping\n   When a REL message is\
    \ generated due to a SIP rejection response that\n   contains an encapsulated\
    \ REL message, the Cause Indicator (CAI)\n   parameter in the generated REL SHOULD\
    \ be set to the value of the CAI\n   parameter received in the encapsulated REL.\
    \  If no encapsulated ISUP\n   is present, the mapping below between status code\
    \ and cause codes are\n   RECOMMENDED.\n   Any SIP status codes not listed below\
    \ (associated with SIP\n   extensions, versions of SIP subsequent to the issue\
    \ of this document,\n   or simply omitted) should be mapping to cause code 31\
    \ \"Normal,\n   unspecified\".  These mappings cover only responses; note that\
    \ the BYE\n   and CANCEL requests, which are also used to tear down a dialog,\n\
    \   SHOULD be mapped to 16 \"Normal clearing\" under most circumstances\n   (although\
    \ see Section 5.8).\n   By default, the cause location associated with the CAI\
    \ parameter\n   should be encoded such that 6xx codes are given the location 'user',\n\
    \   whereas 4xx and 5xx codes are given a 'network' location.  Exceptions\n  \
    \ are marked below.\n   Just as there are certain ISDN cause codes that are ISUP-specific\
    \ and\n   have no corollary SIP action, so there are SIP status codes that\n \
    \  should not simply be translated to ISUP - some SIP-specific action\n   should\
    \ be attempted first.  See the note on the (+) tag below.\n   Response received\
    \                     Cause value in the REL\n   -----------------           \
    \          ----------------------\n   400 Bad Request                       41\
    \ Temporary Failure\n   401 Unauthorized                      21 Call rejected\
    \ (*)\n   402 Payment required                  21 Call rejected\n   403 Forbidden\
    \                         21 Call rejected\n   404 Not found                 \
    \         1 Unallocated number\n   405 Method not allowed                63 Service\
    \ or option\n                                            unavailable\n   406 Not\
    \ acceptable                    79 Service/option not\n                      \
    \                      implemented (+)\n   407 Proxy authentication required \
    \    21 Call rejected (*)\n   408 Request timeout                  102 Recovery\
    \ on timer expiry\n   410 Gone                              22 Number changed\n\
    \                                            (w/o diagnostic)\n   413 Request\
    \ Entity too long          127 Interworking (+)\n   414 Request-URI too long \
    \            127 Interworking (+)\n   415 Unsupported media type            79\
    \ Service/option not\n                                            implemented\
    \ (+)\n   416 Unsupported URI Scheme           127 Interworking (+)\n   420 Bad\
    \ extension                    127 Interworking (+)\n   421 Extension Required\
    \               127 Interworking (+)\n   423 Interval Too Brief              \
    \ 127 Interworking (+)\n   480 Temporarily unavailable           18 No user responding\n\
    \   481 Call/Transaction Does not Exist   41 Temporary Failure\n   482 Loop Detected\
    \                     25 Exchange - routing error\n   483 Too many hops      \
    \               25 Exchange - routing error\n   484 Address incomplete       \
    \         28 Invalid Number Format (+)\n   485 Ambiguous                     \
    \     1 Unallocated number\n   486 Busy here                         17 User busy\n\
    \   487 Request Terminated               --- (no mapping)\n   488 Not Acceptable\
    \ here              --- by Warning header\n   500 Server internal error      \
    \       41 Temporary failure\n   501 Not implemented                   79 Not\
    \ implemented, unspecified\n   502 Bad gateway                       38 Network\
    \ out of order\n   503 Service unavailable               41 Temporary failure\n\
    \   504 Server time-out                  102 Recovery on timer expiry\n   504\
    \ Version Not Supported            127 Interworking (+)\n   513 Message Too Large\
    \                127 Interworking (+)\n   600 Busy everywhere                \
    \   17 User busy\n   603 Decline                           21 Call rejected\n\
    \   604 Does not exist anywhere            1 Unallocated number\n   606 Not acceptable\
    \                   --- by Warning header\n   (*) In some cases, it may be possible\
    \ for a SIP gateway to provide\n   credentials to the SIP UAS that is rejecting\
    \ an INVITE due to\n   authorization failure.  If the gateway can authenticate\
    \ itself, then\n   obviously it SHOULD do so and proceed with the call; only if\
    \ the\n   gateway cannot authenticate itself should cause code 21 be sent.\n \
    \  (+) If at all possible, a SIP gateway SHOULD respond to these\n   protocol\
    \ errors by remedying unacceptable behavior and attempting to\n   re-originate\
    \ the session.  Only if this proves impossible should the\n   SIP gateway fail\
    \ the ISUP half of the call.\n   When the Warning header is present in a SIP 606\
    \ or 488 message, there\n   may be specific ISDN cause code mappings appropriate\
    \ to the Warning\n   code.  This document recommends that '31 Normal, unspecified'\
    \ SHOULD\n   by default be used for most currently assigned Warning codes.  If\
    \ the\n   Warning code speaks to an unavailable bearer capability, cause code\n\
    \   '65 Bearer Capability Not Implemented' is a RECOMMENDED mapping.\n"
- title: 8.2.7 REL Received
  contents:
  - "8.2.7 REL Received\n   This circumstance generally arises when the user on the\
    \ PSTN side\n   hangs up before the call has been answered; the gateway therefore\n\
    \   aborts the establishment of the session.  A CANCEL request MUST be\n   issued\
    \ (a BYE is not used, since no final response has arrived from\n   the SIP side).\
    \  A 200 OK for the CANCEL can be expected by the\n   gateway, and finally a 487\
    \ for the INVITE arrives (which the gateway\n   ACKs in turn).\n   The gateway\
    \ SHOULD store state information related to this dialog for\n   a certain period\
    \ of time, since a 200 final response for the INVITE\n   originally sent might\
    \ arrive (even after the reception of the 200 OK\n   for the CANCEL).  In this\
    \ situation, the gateway MUST send an ACK\n   followed by an appropriate BYE request.\n\
    \   In SIP bridging situations, the REL message cannot be encapsulated in\n  \
    \ a CANCEL message (since CANCEL cannot have a message body).  Usually,\n   the\
    \ REL message will contain a CAI value of 16 \"Normal clearing\".  If\n   the\
    \ value is other than a 16, the gateway MAY wish to use some other\n   means of\
    \ communicating the cause value (see Section 5.8).\n"
- title: 8.2.8 ISUP T11 Expires
  contents:
  - "8.2.8 ISUP T11 Expires\n   In order to prevent the remote ISUP node's timer T7\
    \ from expiring,\n   the gateway MAY keep its own supervisory timer; ISUP defines\
    \ this\n   timer as T11.  T11's duration is carefully chosen so that it will\n\
    \   always be shorter than the T7 of any node to which the gateway is\n   communicating.\n\
    \   To clarify timer T11's relevance with respect to SIP interworking,\n   Q.764\
    \ [12] explains its use as: \"If in normal operation, a delay in\n   the receipt\
    \ of an address complete signal from the succeeding network\n   is expected, the\
    \ last common channel signaling exchange will\n   originate and send an address\
    \ complete message 15 to 20 seconds\n   [timer (T11)] after receiving the latest\
    \ address message.\" Since SIP\n   nodes have no obligation to respond to an INVITE\
    \ request within 20\n   seconds,  SIP interworking inarguably qualifies as such\
    \ a situation.\n   If the gateway supports this optional mechanism, then if its\
    \ T11\n   expires, it SHOULD send an early ACM (i.e., called party status set\n\
    \   to \"no indication\") to prevent the expiration of the remote node's T7\n\
    \   (where permitted by the ISUP variant).  See Section 8.2.3 for the\n   value\
    \ of the ACM parameters.\n   If a \"180 Ringing\" message arrives subsequently,\
    \ it SHOULD be sent in\n   a CPG, as shown in Section 8.2.3.\n   See Section 8.1.3\
    \ for an example callflow that includes the\n   expiration of T11.\n"
- title: 9. Suspend/Resume and Hold
  contents:
  - '9. Suspend/Resume and Hold

    '
- title: 9.1 Suspend (SUS) and Resume (RES) Messages
  contents:
  - "9.1 Suspend (SUS) and Resume (RES) Messages\n   In ISDN networks, a user can\
    \ generate a SUS (timer T2, user\n   initiated) in order to unplug the terminal\
    \ from the socket and plug\n   it in another one.  A RES is sent once the terminal\
    \ has been\n   reconnected and the T2 timer has not expired.  SUS is also frequently\n\
    \   used to signaling an on-hook state for a remote terminal before\n   timers\
    \ leading to the transmission of a REL message are sent (this is\n   the more\
    \ common case by far).  While a call is suspended, no audio\n   media is passed\
    \ end-to-end.\n   When a SUS is sent for a call that has a SIP leg, a gateway\
    \ MAY\n   suspend IP media transmission until a RES is received.  Putting the\n\
    \   media on hold insures that bandwidth is conserved when no audio\n   traffic\
    \ needs to be transmitted.\n   If media suspension is appropriate, then when a\
    \ SUS arrives from the\n   PSTN, the MGC MAY send an INVITE to request that the\
    \ far-end's\n   transmission of the media stream be placed on hold.  The subsequent\n\
    \   reception of a RES from the PSTN SHOULD then trigger a re-INVITE that\n  \
    \ requests the resumption of the media stream.  Note that the MGC may\n   or may\
    \ not elect to stop transmitting any media itself when it\n   requests the cessation\
    \ of far-end transmission.\n   If media suspension is not required by the MGC\
    \ receiving the SUS from\n   the PSTN, the SIP INFO [6] method MAY be used to\
    \ transmit an\n   encapsulated SUS rather than a re-INVITE.  Note that the recipient\
    \ of\n   such an INFO request may be a simple SIP phone that does not\n   understand\
    \ ISUP (and would therefore take no action on receipt of\n   this message); if\
    \ a prospective destination for an INFO-encapsulated\n   SUS has not used encapsulated\
    \ ISUP in any messages it has previously\n   sent, the gateway SHOULD NOT relay\
    \ the INFO method, but rather should\n   handle the SUS and the corresponding\
    \ RES without signaling their\n   arrival to the SIP network.\n   In any case,\
    \ subsequent RES messages MUST be transmitted in the same\n   method that was\
    \ used for the corresponding SUS (i.e., if an INFO is\n   used for a SUS, INFO\
    \ should also be used for the subsequent RES).\n   Regardless of whether the INFO\
    \ or re-INVITE mechanism is used to\n   carry a SUS message, neither has any implication\
    \ that the originating\n   side will cease sending IP media.  The recipient of\
    \ an encapsulated\n   SUS message MAY therefore elect to send a re-INVITE themselves\
    \ to\n   suspend media transmission from the MGC side if desired.\n   The following\
    \ example uses the INVITE mechanism. Note that this flow\n   is informative, not\
    \ proscriptive; compliant gateways are free to\n   implement functionally equivalent\
    \ flows, as described in the\n   preceding paragraphs.\n        SIP          \
    \             MGC/MG                       PSTN\n          |                 \
    \         |<-----------SUS-----------|1\n         2|<--------INVITE-----------|\
    \                          |\n         3|-----------200----------->|         \
    \                 |\n         4|<----------ACK------------|                  \
    \        |\n          |                          |<-----------RES-----------|5\n\
    \         6|<--------INVITE-----------|                          |\n         7|-----------200----------->|\
    \                          |\n         8|<----------ACK------------|         \
    \                 |\n   The handling of a network-initiated SUS immediately prior\
    \ to call\n   teardown is handled in Section 10.2.2.\n"
- title: 9.2 Hold (re-INVITE)
  contents:
  - "9.2 Hold (re-INVITE)\n   After a call has been connected, a re-INVITE could be\
    \ sent to a\n   gateway from the SIP side in order to place the call on hold.\
    \  This\n   re-INVITE will have an SDP offer indicating that the originator of\n\
    \   the re-INVITE no longer wishes to receive media.\n        SIP            \
    \           MGC/MG                       PSTN\n         1|---------INVITE---------->|\
    \                          |\n          |                          |------------CPG---------->|2\n\
    \         3|<----------200------------|                          |\n         4|-----------ACK----------->|\
    \                          |\n   When such a re-INVITE is received, the gateway\
    \ SHOULD send a CPG in\n   order to express that the call has been placed on hold.\
    \  The CPG\n   SHOULD contain a Generic Notification Indicator (or, in ANSI\n\
    \   networks, a Notification Indicator) with a value of 'remote hold'.\n   If,\
    \ subsequent to the sending of the re-INVITE, the SIP side wishes\n   to take\
    \ the remote end off hold and begin receiving media again, it\n   SHOULD repeat\
    \ the flow above with an INVITE that contains an SDP\n   offer with an appropriate\
    \ media destination.  The Generic\n   Notification Indicator would in this instance\
    \ have a value of 'remote\n   retrieval' (or in some variants 'remote hold released').\n\
    \   Finally, note that a CPG with hold indicators may be received by a\n   gateway\
    \ from the PSTN.  In the interests of conserving bandwidth, the\n   gateway SHOULD\
    \ stop sending media until the call is resumed and\n   SHOULD send a re-INVITE\
    \ to the SIP leg of the call requesting that\n   the remote side stop sending\
    \ media.\n"
- title: 10. Normal Release of the Connection
  contents:
  - "10. Normal Release of the Connection\n   From the perspective of a gateway, either\
    \ the SIP side or the ISUP\n   side can release a call, regardless of which side\
    \ initiated the call.\n   Note that cancellation of a call setup request (either\
    \ from the ISUP\n   or SIP side) is discussed elsewhere in this document (in Section\n\
    \   8.2.7 and Section 7.2.3, respectively).\n   Gateways SHOULD implement functional\
    \ equivalence with the flows in\n   this section.\n"
- title: 10.1 SIP initiated release
  contents:
  - "10.1 SIP initiated release\n   For a normal termination of the dialog (receipt\
    \ of a BYE request),\n   the gateway MUST immediately send a 200 response.  The\
    \ gateway then\n   MUST release any media resources in the gateway (DSPs, TCIC\
    \ locks,\n   and so on) and send an REL with a cause code of 16 (normal call\n\
    \   clearing) to the PSTN.  Release of resources is confirmed by the PSTN\n  \
    \ side with an RLC message.\n   In SIP bridging situations, the cause code of\
    \ any REL encapsulated in\n   the BYE request SHOULD be re-used in any REL that\
    \ the gateway sends\n   to the PSTN.\n        SIP                       MGC/MG\
    \                       PSTN\n         1|-----------BYE----------->|         \
    \                 |\n          |            ** MG Releases IP Resources **   \
    \        |\n         2|<----------200------------|                          |\n\
    \          |             ** MG Releases PSTN Trunk **            |\n         \
    \ |                          |------------REL---------->|3\n          |      \
    \                    |<-----------RLC-----------|4\n"
- title: 10.2 ISUP initiated release
  contents:
  - "10.2 ISUP initiated release\n   If the release of the connection was caused by\
    \ the reception of a\n   REL, the REL SHOULD be encapsulated in the BYE sent by\
    \ the gateway.\n   Whether the caller or callee hangs up first, the gateway SHOULD\n\
    \   release any internal resources used in support of the call and then\n   MUST\
    \ confirm that the circuit is ready for re-use by sending an RLC.\n"
- title: 10.2.1 Caller hangs up
  contents:
  - "10.2.1 Caller hangs up\n   When the caller hangs up, the SIP dialog MUST be terminated\
    \ by\n   sending a BYE request (which is confirmed with a 200).\n        SIP \
    \                      MGC/MG                       PSTN\n          |        \
    \                  |<-----------REL-----------|1\n          |             ** MG\
    \ Releases PSTN Trunk **            |\n          |                          |------------RLC---------->|2\n\
    \         3|<----------BYE------------|                          |\n         \
    \ |            ** MG Releases IP Resources **           |\n         4|-----------200----------->|\
    \                          |\n"
- title: 10.2.2 Callee hangs up (SUS)
  contents:
  - "10.2.2 Callee hangs up (SUS)\n   In some PSTN scenarios, if the callee hangs\
    \ up in the middle of a\n   call, the local exchange sends a SUS instead of a\
    \ REL and starts a\n   timer (T6, SUS is network initiated).  When the timer expires,\
    \ the\n   REL is sent.  This necessitates a slightly different SIP flow; see\n\
    \   Section 9 for more information on handling suspension.  It is\n   RECOMMENDED\
    \ that gateways implement functional equivalence with the\n   following flow for\
    \ this case:\n        SIP                       MGC/MG                       PSTN\n\
    \          |                          |<-----------SUS-----------|1\n        \
    \ 2|<--------INVITE-----------|                          |\n         3|-----------200----------->|\
    \                          |\n         4|<----------ACK------------|         \
    \                 |\n          |                          |    *** T6 Expires\
    \ ***    |\n          |                          |<-----------REL-----------|5\n\
    \          |             ** MG Releases PSTN Trunk **            |\n         \
    \ |                          |------------RLC---------->|6\n         7|<----------BYE------------|\
    \                          |\n          |            ** MG Releases IP Resources\
    \ **           |\n         8|-----------200----------->|                     \
    \     |\n"
- title: 11. ISUP Maintenance Messages
  contents:
  - "11. ISUP Maintenance Messages\n   ISUP contains a set of messages used for maintenance\
    \ purposes.  They\n   can be received during any ongoing call.  There are basically\
    \ two\n   kinds of maintenance messages (apart from the continuity check):\n \
    \  messages for blocking circuits and messages for resetting circuits.\n"
- title: 11.1 Reset messages
  contents:
  - "11.1 Reset messages\n   Upon reception of an RSC message for a circuit currently\
    \ being used\n   by the gateway for a call, the call MUST be released immediately\n\
    \   (this typically results from a serious maintenance condition).  RSC\n   MUST\
    \ be answered with an RLC after resetting the circuit in the\n   gateway.  Group\
    \ reset (GRS) messages which target a range of circuits\n   are answered with\
    \ a Circuit Group Reset ACK Message (GRA) after\n   resetting all the circuits\
    \ affected by the message.\n   The gateways SHOULD behave as if a REL had been\
    \ received in order to\n   release the dialog on the SIP side.  A BYE or a CANCEL\
    \ are sent\n   depending of the status of the call.  See the procedures in Section\n\
    \   10.\n"
- title: 11.2 Blocking messages
  contents:
  - "11.2 Blocking messages\n   There are two kinds of blocking messages: maintenance\
    \ messages or\n   hardware-failure messages.  Maintenance blocking messages indicate\n\
    \   that the circuit is to be blocked for any subsequent calls, but these\n  \
    \ messages do not affect any ongoing call.  This allows circuits to be\n   gradually\
    \ quiesced and taken out of service for maintenance.\n   Hardware-oriented blocking\
    \ messages have to be treated as reset\n   messages.  They generally are sent\
    \ only when a hardware failure has\n   occurred.  Media transmission for all calls\
    \ in progress on these\n   circuits would be affected by this hardware condition,\
    \ and therefore\n   all calls must be released immediately.\n   BLO is always\
    \ maintenance oriented and it is answered by the gateway\n   with a Blocking ACK\
    \ Message (BLA) when the circuit is blocked - this\n   requires no corresponding\
    \ SIP actions.  Circuit Group Blocking (CGB)\n   messages have a \"type indicator\"\
    \ inside the Circuit Group Supervision\n   Message Type Indicator.  It indicates\
    \ if the CGB is maintenance or\n   hardware failure oriented.  If the CGB results\
    \ from a hardware\n   failure, then each call in progress in the affected range\
    \ of circuits\n   MUST be terminated immediately as if a REL had been received,\n\
    \   following the procedures in Section 10.  CGBs MUST be answered with\n   CGBAs.\n"
- title: 11.3  Continuity Checks
  contents:
  - "11.3  Continuity Checks\n   A continuity check is a test performed on a circuit\
    \ that involves the\n   reflection of a tone generated at the originating switch\
    \ by a\n   loopback at the destination switch.  Two variants of the continuity\n\
    \   check appear in ISUP: the implicit continuity check request within an\n  \
    \ IAM (in which case the continuity check takes place as a precondition\n   before\
    \ call setup begins), and the explicit continuity check signaled\n   by a Continuity\
    \ Check Request (CCR) message.  PSTN gateways in\n   regions that support continuity\
    \ checking generally SHOULD have some\n   way of accommodating these tests (if\
    \ they hope to be fielded by\n   providers that interconnect with any major carrier).\n\
    \   When a CCR is received by a PSTN-SIP gateway, the gateway SHOULD NOT\n   send\
    \ any corresponding SIP messages; the scope of the continuity\n   check applies\
    \ only to the PSTN trunks, not to any IP media paths\n   beyond the gateway. \
    \ CCR messages also do not designate any called\n   party number, or any other\
    \ way to determine what SIP user agent\n   server should be reached.\n   When\
    \ an IAM with the Continuity Check Indicator flag set within the\n   NCI parameter\
    \ is received, the gateway MUST process the continuity\n   check before sending\
    \ an INVITE message (and proceeding normally with\n   call setup); if the continuity\
    \ check fails (a COT with Continuity\n   Indicator of 'failed' is received), then\
    \ an INVITE MUST NOT be sent.\n"
- title: 12. Construction of Telephony URIs
  contents:
  - "12. Construction of Telephony URIs\n   SIP proxy servers MAY route SIP messages\
    \ on any signaling criteria\n   desired by network administrators, but generally\
    \ the Request-URI is\n   the foremost routing criterion.  The To and From headers\
    \ are also\n   frequently of interest in making routing decisions.  SIP-ISUP mapping\n\
    \   assumes that proxy servers are interested in at least these three\n   fields\
    \ of SIP messages, all of which contain URIs.\n   SIP-ISUP mapping frequently\
    \ requires the representation of telephone\n   numbers in these URIs.  In some\
    \ instances these numbers will be\n   presented first in ISUP messages, and SS7-SIP\
    \ gateways will need to\n   translate the ISUP formats of these numbers into SIP\
    \ URIs.  In other\n   cases the reverse transformation will be required.\n   The\
    \ most common format used in SIP for the representation of\n   telephone numbers\
    \ is the tel URL [7].  When converting between\n   formats, the tel URL MAY constitute\
    \ the entirety of a URI field in a\n   SIP message, or it MAY appear as the user\
    \ portion of a SIP URI.  For\n   example, a To field might appear as:\n   To:\
    \ tel:+17208881000\n   Or\n   To: sip:+17208881000@level3.com\n   Whether or not\
    \ a particular gateway or endpoint should formulate URIs\n   in the tel or SIP\
    \ format is a matter of local administrative policy -\n   if the presence of a\
    \ host portion would aid the surrounding network\n   in routing calls, the SIP\
    \ format should be used.  A gateway MUST\n   accept either tel or SIP URIs from\
    \ its peers.\n   The '+' sign preceding the number in tel URLs indicates that\
    \ the\n   digits which follow constitute a fully-qualified E.164 [16] number;\n\
    \   essentially, this means that a country code is provided before any\n   national-specific\
    \ area codes, exchange/city codes, or address codes.\n   The absence of a '+'\
    \ sign MAY signify that the number is merely\n   nationally significant, or perhaps\
    \ that a private dialing plan is in\n   use.  When the '+' sign is not present,\
    \ but a telephone number is\n   represented by the user portion of the URI, the\
    \ SIP URI SHOULD\n   contain the optional ';user=phone' parameter; e.g.,\n   To:\
    \ sip:83000@sip.example.net;user=phone\n   However, it is strongly RECOMMENDED\
    \ that only internationally\n   significant E.164 numbers be passed between SIP-T\
    \ gateways,\n   especially when such gateways are in different regions or different\n\
    \   administrative domains.  In many if not most SIP-T networks, gateways\n  \
    \ are not responsible for end-to-end routing of SIP calls; practically\n   speaking,\
    \ gateways have no way of knowing if the call will terminate\n   in a local or\
    \ remote administrative domain and/or region, and hence\n   gateways SHOULD always\
    \ assume that calls require an international\n   numbering plan.  There is no\
    \ guarantee that recipients of SIP\n   signaling will be capable of understanding\
    \ national dialing plans\n   used by the originators of calls - if the originating\
    \ gateway does\n   not internationalize the signaling, the context in which the\
    \ digits\n   were dialed cannot be extrapolated by far-end network elements.\n\
    \   In ISUP signaling, a telephone number appears in a common format that\n  \
    \ is used in several parameters, including the CPN and CIN; when it\n   represents\
    \ a calling party number it sports some additional\n   information (detailed below).\
    \  For the purposes of this document, we\n   will refer to this format as 'ISUP\
    \ format' - if the additional\n   calling party information is present, the format\
    \ shall be referred to\n   as 'ISUP- calling format'.  The format consists of\
    \ a byte called the\n   Nature of Address (NoA) indicator, followed by another\
    \ byte which\n   contains the Numbering Plan Indicator (NPI), both of which are\n\
    \   prefixed to a variable-length series of bytes that contains the\n   digits\
    \ of the telephone number in Binary Coded Decimal (BCD) format.\n   In the calling\
    \ party number case, the NPI's byte also contains bit\n   fields which represent\
    \ the caller's presentation preferences and the\n   status of any call screening\
    \ checks performed up until this point in\n   the call.\n        H G F E D C B\
    \ A       H G F E D C B A\n       +-+-+-+-+-+-+-+-+     +-+-+-+-+-+-+-+-+\n  \
    \     | |    NoA      |     | |    NoA      |\n       +-+-+-+-+-+-+-+-+     +-+-+-+-+-+-+-+-+\n\
    \       | | NPI | spare |     | | NPI |PrI|ScI|\n       +-+-+-+-+-+-+-+-+    \
    \ +-+-+-+-+-+-+-+-+\n       | dig...| dig 1 |     | dig...| dig 1 |\n       |\
    \      ...      |     |      ...      |\n       | dig n | dig...|     | dig n\
    \ | dig...|\n       +-+-+-+-+-+-+-+-+     +-+-+-+-+-+-+-+-+\n         ISUP format\
    \        ISUP calling format\n              ISUP numbering formats\n   The NPI\
    \ field is generally set to the value 'ISDN (Telephony)\n   numbering plan (Recommendation\
    \ E.164)', but this does not mean that\n   the digits which follow necessarily\
    \ contain a country code; the NoA\n   field dictates whether the telephone number\
    \ is in a national or\n   international format.  When the represented number is\
    \ not designated\n   to be in an international format, the NoA generally provides\n\
    \   information specific to the national dialing plan - based on this\n   information\
    \ one can usually determine how to convert the number in\n   question into an\
    \ international format.  Note that if the NPI contains\n   a value other than\
    \ 'ISDN numbering plan', then the tel URL may not be\n   suitable for carrying\
    \ the address digits, and the handling for such\n   calls is outside the scope\
    \ of this document.\n"
- title: 12.1 ISUP format to tel URL mapping
  contents:
  - "12.1 ISUP format to tel URL mapping\n   Based on the above, conversion from ISUP\
    \ format to a tel URL is as\n   follows.  First, provided that the NPI field indicates\
    \ that the\n   telephone number format uses E.164, the NoA is consulted.  If the\
    \ NoA\n   indicates that the number is an international number, then the\n   telephone\
    \ number digits SHOULD be appended unmodified to a 'tel:+'\n   string.  If the\
    \ NoA has the value 'national (significant) number',\n   then a country code MUST\
    \ be prefixed to the telephone number digits\n   before they are committed to\
    \ a tel URL; if the gateway performing\n   this conversion interconnects with\
    \ switches homed to several\n   different country codes, presumably the appropriate\
    \ country code\n   SHOULD be chosen based on the originating switch or trunk group.\
    \  If\n   the NoA has the value 'subscriber number', both a country code and\n\
    \   any other numbering components necessary for the numbering plan in\n   question\
    \ (such as area codes or city codes) MAY need to be added in\n   order for the\
    \ number to be internationally significant - however,\n   such procedures vary\
    \ greatly from country to country, and hence they\n   cannot be specified in detail\
    \ here.  Only if a country or network-\n   specific value is used for the NoA\
    \ SHOULD a tel URL not include a '+'\n   sign; in these cases, gateways SHOULD\
    \ simply copy the provided digits\n   into the tel URL and append a 'user=phone'\
    \ parameter if a SIP URI\n   format is used.  Any non-standard or proprietary\
    \ mechanisms used to\n   communicate further context for the call in ISUP are\
    \ outside the\n   scope of this document.\n   If a nationally-specific parameter\
    \ is present that allows for the\n   transmission of the calling party's name\
    \ (such as the Generic Name\n   Parameter in ANSI), then generally, if presentation\
    \ is not\n   restricted, this information SHOULD be used to populate the display-\n\
    \   name portion of the From field.\n   If ISUP calling format is being converted\
    \ rather than ISUP format,\n   then two additional pieces of information must\
    \ be taken into account:\n   presentation indicators and screening indicators.\
    \  If the\n   presentation indicators are set to 'presentation restricted', then\
    \ a\n   special URI is created by the gateway which communicates to the far\n\
    \   end that the caller's identity has been omitted.  This URI SHOULD be\n   a\
    \ SIP URI with a display-name and username of 'Anonymous', e.g.:\n   From: Anonymous\
    \ <sip:anonymous@anonymous.invalid>\n   For further information about privacy\
    \ in SIP, see Section 5.7.\n   If presentation is set to 'address unavailable',\
    \ then gateways should\n   treat the IAM as if the CIN parameter was omitted.\
    \  Screening\n   indicators should not be translated, as they are only meaningful\n\
    \   end-to-end.\n"
- title: 12.2 tel URL to ISUP format mapping
  contents:
  - "12.2 tel URL to ISUP format mapping\n   Conversion from tel URLs to ISUP format\
    \ is simpler.  If the URI is in\n   international format, then the gateway SHOULD\
    \ consult the leading\n   country code of the URI.  If the country code is local\
    \ to the gateway\n   (the gateway has one or more trunks that point to switches\
    \ which are\n   homed to the country code in question), the gateway SHOULD set\
    \ the\n   NoA to reflect 'national (significant) number' and strip the country\n\
    \   code from the URI before populating the digits field.  If the country\n  \
    \ code is not local to the gateway, the gateway SHOULD set the NoA to\n   'international\
    \ number' and retain the country code.  In either case\n   the NPI MUST be set\
    \ to 'ISDN numbering plan'.\n   If the URI is not in international format, the\
    \ gateway MAY attempt to\n   treat the telephone number within the URI as if it\
    \ were appropriate\n   to its national or network-specific dialing plan; if doing\
    \ so gives\n   rise to internal gateway errors or the gateway does not support\
    \ such\n   procedures, then the gateway SHOULD respond with appropriate SIP\n\
    \   status codes to express that the URI could not be understood (if the\n   URI\
    \ in question is the Request-URI, a 484).\n   When converting from a tel URL to\
    \ ISUP calling format, the procedure\n   is identical to that described in the\
    \ preceding paragraphs, but\n   additionally, the presentation indicator SHOULD\
    \ be set to\n   'presentation allowed' and the screening indicator to 'network\n\
    \   provided', unless some service provider policy or user profile\n   specifically\
    \ disallows presentation.\n"
- title: 13. Other ISUP flavors
  contents:
  - "13. Other ISUP flavors\n   Other flavors of ISUP different than ITU-T ISUP have\
    \ different\n   parameters and more features.  Some of the parameters have more\n\
    \   possible values and provide more information about the status of the\n   call.\n\
    \   The Circuit Query Message (CQM) and Circuit Query Response (CQR) are\n   used\
    \ in many ISUP variants.  These messages have no analog in SIP,\n   although receipt\
    \ of a CQR may cause state reconciliation if the\n   originating and destination\
    \ switches have become desynchronized; as\n   states are reconciled some calls\
    \ may be terminated, which may cause\n   SIP or ISUP messages to be sent (as described\
    \ in Section 10).\n   However, differences in the message flows are more important.\
    \  In\n   ANSI [11] ISUP, the CON message MUST NOT be sent; an ANM is sent\n \
    \  instead (when no ACM has been sent before the call is answered).  In\n   call\
    \ forwarding situations, CPGs MAY be sent before the ACM is sent.\n   SAMs MUST\
    \ NOT be sent; 'en-bloc' signaling is always used.  The ANSI\n   Exit Message\
    \ (EXM) SHOULD NOT result in any SIP signaling in\n   gateways.  ANSI also uses\
    \ the Circuit Reservation Message (CRM) and\n   Circuit Reservation Acknowledgment\
    \ (CRA) as part of its interworking\n   procedures - in the event that an MGC\
    \ does receive a CRM, a CRA\n   SHOULD be sent in return (in some implementations,\
    \ transmissions of a\n   CRA could conceivably be based on a resource reservation\
    \ system);\n   after a CRA is sent, the MGC SHOULD wait for a subsequent IAM and\n\
    \   process it normally.  Any further circuit reservation mechanism is\n   outside\
    \ the scope of this document.\n   Although receipt of a Confusion (CFN) message\
    \ is an indication of a\n   protocol error, corresponding SIP messages SHOULD\
    \ NOT be sent on\n   receipt of a CFN - the CFN should be handled with ISUP-specific\n\
    \   procedures by the gateway (usually by retransmission of the packet to\n  \
    \ which the CFN responded).  Only if ISUP procedures fails repeatedly\n   should\
    \ this cause a SIP error condition (and call failure) to arise.\n   In TTC ISUP\
    \ CPGs MAY be sent before the ACM is sent.  Messages such\n   as a Charging Information\
    \ Message (CHG) MAY be sent between ACM and\n   ANM.  'En-bloc' signaling is always\
    \ used and there is no T9 timer.\n"
- title: 13.1 Guidelines for sending other ISUP messages
  contents:
  - "13.1 Guidelines for sending other ISUP messages\n   Some ISUP variants send more\
    \ messages than the ones described in this\n   document.  Therefore, some guidelines\
    \ are provided here with regard\n   to transport and mapping of these ISUP message.\n\
    \   From the caller to the callee, other ISUP messages SHOULD be\n   encapsulated\
    \ (see [3]) inside INFO messages, even if the INVITE\n   transaction is still\
    \ not finished.  Note that SIP does not ensure\n   that INFO requests are delivered\
    \ in order, and therefore in adverse\n   network conditions an egress gateway\
    \ might process INFOs out of\n   order.  This issue, however, does not represent\
    \ an important problem\n   since it is not likely to happen and its effects are\
    \ negligible in\n   most of the situations.  The Information (INF) message and\n\
    \   Information Response (INR) are examples of messages that should be\n   encapsulated\
    \ within an INFO.  Gateway implementers might also\n   consider building systems\
    \ that wait for each INFO transaction to\n   complete before initiating a new\
    \ INFO transaction.\n   From the callee to the caller, if a message is received\
    \ by a gateway\n   before the call has been answered (i.e., ANM is received) it\
    \ SHOULD\n   be encapsulated in an INFO, provided that this will not be the first\n\
    \   SIP message sent in the backwards direction (in which case it SHOULD\n   be\
    \ encapsulated in a provisional 1xx response).  Similarly a message\n   which\
    \ is received on the originating side (probably in response to an\n   INR) before\
    \ a 200 OK has been received by the gateway should be\n   carried within an INFO.\
    \  In order for this mechanism to function\n   properly in the forward direction,\
    \ any necessary Contact or To-tag\n   must have appeared in a previous provisional\
    \ response or the message\n   might not be correctly routed to its destination.\
    \  As such all SIP-T\n   gateways MUST send all provisional responses with a Contact\
    \ header\n   and any necessary tags in order to enable proper routing of new\n\
    \   requests issued before a final response has been received.  When the\n   INVITE\
    \ transaction is finished INFO requests SHOULD also be used in\n   this direction.\n"
- title: 14. Acronyms
  contents:
  - "14. Acronyms\n   ACK                Acknowledgment\n   ACM                Address\
    \ Complete Message\n   ANM                Answer Message\n   ANSI            \
    \   American National Standards Institute\n   BLA                Blocking ACK\
    \ message\n   BLO                Blocking Message\n   CGB                Circuit\
    \ Group Blocking Message\n   CGBA               Circuit Group Blocking ACK Message\n\
    \   CHG                Charging Information Message\n   CON                Connect\
    \ Message\n   CPG                Call Progress Message\n   CUG               \
    \ Closed User Group\n   GRA                Circuit Group Reset ACK Message\n \
    \  GRS                Circuit Group Reset Message\n   HLR                Home\
    \ Location Register\n   IAM                Initial Address Message\n   IETF  \
    \             Internet Engineering Task Force\n   IP                 Internet\
    \ Protocol\n   ISDN               Integrated Services Digital Network\n   ISUP\
    \               ISDN User Part\n   ITU-T              International Telecommunication\
    \ Union\n                      Telecommunication Standardization Sector\n   MG\
    \                 Media Gateway\n   MGC                Media Gateway Controller\n\
    \   MTP                Message Transfer Part\n   REL                Release Message\n\
    \   RES                Resume Message\n   RLC                Release Complete\
    \ Message\n   RTP                Real-time Transport Protocol\n   SCCP       \
    \        Signaling Connection Control Part\n   SG                 Signaling Gateway\n\
    \   SIP                Session Initiation Protocol\n   SS7                Signaling\
    \ System No. 7\n   SUS                Suspend Message\n   TTC                Telecommunication\
    \ Technology Committee\n   UAC                User Agent Client\n   UAS      \
    \          User Agent Server\n   UDP                User Datagram Protocol\n \
    \  VoIP               Voice over IP\n"
- title: 15. Security Considerations
  contents:
  - "15. Security Considerations\n   The translation of ISUP parameters into SIP headers\
    \ may introduce\n   some privacy and security concerns above and beyond those\
    \ that have\n   been identified for other functions of SIP-T [9A].  Merely securing\n\
    \   encapsulated ISUP, for example, would not provide adequate privacy\n   for\
    \ a user requesting presentation restriction if the Calling Party\n   Number parameter\
    \ is openly mapped to the From header.  Section 12.2\n   shows how SIP Privacy\
    \ [9B] should be used for this function.  Since\n   the scope of SIP-ISUP mapping\
    \ has been restricted to only those\n   parameters that will be translated into\
    \ the headers and fields used\n   to route SIP requests, gateways consequently\
    \ reveal through\n   translation the minimum possible amount of information.\n\
    \   A security analysis of ISUP is beyond the scope of this document.\n   ISUP\
    \ bridging across SIP is discussed more fully in [9A], but Section\n   7.2.1.1\
    \ discusses processing the translated ISUP values in relation\n   to any embedded\
    \ ISUP in a request arriving at PSTN gateway.  Lack of\n   ISUP security analysis\
    \ may pose some risks if embedded ISUP is\n   blindly interpreted.  Accordingly,\
    \ gateways SHOULD NOT blindly trust\n   embedded ISUP unless the request was strongly\
    \ authenticated [9A], and\n   the sender is trusted, e.g., is another MGC that\
    \ is authorized to use\n   ISUP over SIP in bridge mode.  When requests are received\
    \ from\n   arbitrary end points, gateways SHOULD filter any received ISUP.  In\n\
    \   particular, only known-safe commands and parameters should be\n   accepted\
    \ or passed through.  Filtering by deleting believed-to-be\n   dangerous entries\
    \ does not work well.\n   In most respects, the information that is translated\
    \ from ISUP to SIP\n   has no special security requirements.  In order for translated\n\
    \   parameters to be used to route requests, they should be legible to\n   intermediaries;\
    \ end-to-end confidentiality of this data would be\n   unnecessary and most likely\
    \ detrimental.  There are also numerous\n   circumstances under which intermediaries\
    \ can legitimately overwrite\n   the values that have been provided by translation,\
    \ and hence\n   integrity over these headers is similarly not desirable.\n   There\
    \ are some concerns however that arise from the other direction\n   of mapping,\
    \ the mapping of SIP headers to ISUP parameters, which are\n   enumerated in the\
    \ following paragraphs.  When end users dial numbers\n   in the PSTN today, their\
    \ selections populate the telephone number\n   portion of the Called Party Number\
    \ parameter, as well as the digit\n   portions of the Carrier Identification Code\
    \ and Transit Network\n   Selection parameters of an ISUP IAM.  Similarly, the\
    \ tel URL and its\n   optional parameters in the Request-URI of a SIP, which can\
    \ be created\n   directly by end users of a SIP device, map to those parameters\
    \ at a\n   gateway.  However, in the PSTN, policy can prevent the user from\n\
    \   dialing certain (invalid or restricted) numbers, or selecting certain\n  \
    \ carrier identification codes.  Thus, gateway operators MAY wish to\n   use corresponding\
    \ policies to restrict the use of certain tel URLs,\n   or tel URL parameters,\
    \ when authorizing a call.\n   The fields relevant to number portability, which\
    \ include in ANSI ISUP\n   the LRN portion of the Generic Address Parameter and\
    \ the 'M' bit of\n   the Forward Call Indicators, are used to route calls in the\
    \ PSTN.\n   Since these fields are rendered as tel URL parameters in the SIP-ISUP\n\
    \   mapping, users can set the value of these fields arbitrarily.\n   Consequently,\
    \ an end-user could change the end office to which a call\n   would be routed\
    \ (though if LRN value were chosen at random, it is\n   more likely that it would\
    \ prevent the call from being delivered\n   altogether).  The PSTN is relatively\
    \ resilient to calls that have\n   been misrouted on account of local number portability,\
    \ however.  In\n   some networks, a REL message with some sort of \"misrouted\
    \ ported\n   number\" cause code is sent in the backwards direction when such\
    \ a\n   condition arises.  Alternatively, the PSTN switch to which a call was\n\
    \   misrouted can forward the call along to the proper switch after\n   making\
    \ its own number portability query - this is an interim number\n   portability\
    \ practice that is still common in most segments of the\n   PSTN that support\
    \ portability.  It is not anticipated that end users\n   will typically set these\
    \ SIP fields, and the risks associated with\n   allowing an adventurous or malicious\
    \ user to set the LRN do not seem\n   to be grave, but they should be noted by\
    \ network operators.  The\n   limited degree to which SIP signaling contributes\
    \ to the interworking\n   indicators of the Forward Call Indicators and Backward\
    \ Call Indicator\n   parameters incurs no foreseeable risks.\n   Some additional\
    \ risks may result from the SIP response code to ISUP\n   Cause Code parameter\
    \ mapping.  SIP user agents could conceivably\n   respond to an INVITE from a\
    \ gateway with any arbitrary SIP response\n   code, and thus they can dictate\
    \ (within the boundaries of the\n   mappings supported by the gateway) the Q.850\
    \ cause code that will be\n   sent by the gateway in the resulting REL message.\
    \  Generally\n   speaking, the manner in which a call is rejected is unlikely\
    \ to\n   provide any avenue for fraud or denial of service - to the best\n   knowledge\
    \ of the authors there is no cause code identified in this\n   document that would\
    \ signal that some call should not be billed, or\n   that the network should take\
    \ critical resources off-line.  However,\n   operators may want to scrutinize\
    \ the set of cause codes that could be\n   mapped from SIP response codes (listed\
    \ in 7.2.6.1) to make sure that\n   no undesirable network-specific behavior could\
    \ result from operating\n   a gateway supporting the recommended mappings.  In\
    \ some cases,\n   operators MAY wish to implement gateway policies that use alternative\n\
    \   mappings, perhaps selectively based on authorization data.\n   If the Request-URI\
    \ and the To header field of a request received at a\n   gateway differ, Section\
    \ 7.2.1.1 recommends that the To header (if it\n   is a telephone number) should\
    \ map to the Original Called Number\n   parameter, and the Request-URI to the\
    \ Called Party Number parameter.\n   However, the user can, at the outset of a\
    \ request, select a To header\n   field value that differs from the Request-URI;\
    \ these two field values\n   are not required to be the same.  This essentially\
    \ allows a user to\n   set the ISUP Original Called Number parameter arbitrarily.\
    \  Any\n   applications that rely on the Original Called Number for settlement\n\
    \   purposes could be affected by this mapping recommendation.  It is\n   anticipated\
    \ that future SIP work in this space will arrive at a\n   better general account\
    \ of the re-targeting of SIP requests that may\n   be applicable to the OCN mapping.\n\
    \   The arbitrary population of the From header of requests by SIP user\n   agents\
    \ has some well-understood security implications for devices\n   that rely on\
    \ the From header as an accurate representation of the\n   identity of the originator.\
    \  Any gateway that intends to use the From\n   header to populate the called\
    \ party's number parameter of an ISUP IAM\n   message should authenticate the\
    \ originator of the request and make\n   sure that they are authorized to assert\
    \ that calling number (or make\n   use of some more secure method to ascertain\
    \ the identity of the\n   caller).  Note that gateways, like all other SIP user\
    \ agents, MUST\n   support Digest authentication as described in [1].\n   There\
    \ is another class of potential risk that is related to the cut-\n   through of\
    \ the backwards media path before the call is answered.\n   Several practices\
    \ described in this document recommend that a gateway\n   signal an ACM when a\
    \ called user agent returns a 18x provisional\n   response code.  At that time,\
    \ backwards media will be cut through\n   end-to-end in the ISUP network, and\
    \ it is possible for the called\n   user agent then to play arbitrary audio to\
    \ the caller for an\n   indefinite period of time before transmitting a final\
    \ response (in\n   the form of a 2xx or higher response code).  There are conceivable\n\
    \   respects in which this capability could be used illegitimately by the\n  \
    \ called user agent.  It is also however a useful feature to allow\n   progress\
    \ tones and announcements to be played in the backwards\n   direction in the 'ACM\
    \ sent' state (so that the caller won't be billed\n   for calls that don't actually\
    \ complete but for which failure\n   conditions must be rendered to the user as\
    \ in-band audio).  In fact,\n   ISUP commonly uses this backwards cut-through\
    \ capability in order to\n   pass tones and announcements relating to the status\
    \ of a call when an\n   ISUP network interworks with legacy networks that are\
    \ not capable of\n   expressing Q.850 cause codes.\n   It is the contention of\
    \ the authors that SIP introduces no risks with\n   regard to backwards media\
    \ that do not exist in Q.931-ISUP mapping,\n   but gateways implementers MAY develop\
    \ an optional mechanism (possibly\n   something that could be configured by an\
    \ operator) that would cut off\n   such 'early media' on a brief timer - it is\
    \ unlikely that more than\n   20 or 30 seconds of early media is necessary to\
    \ convey status\n   information about the call (see Section 7.2.6).  A more conservative\n\
    \   approach would be to never cut through backwards media in the gateway\n  \
    \ until a 2xx final response has been received, provided that the\n   gateway\
    \ implements some way of prevent clipping of the initial media\n   associated\
    \ with the call.\n   Unlike a traditional PSTN phone, a SIP user agent can launch\
    \ multiple\n   simultaneous requests in order to reach a particular resource.\
    \  It\n   would be trivial for a SIP user agent to launch 100 SIP requests at\
    \ a\n   100 port gateway, thereby tying up all of its ports.  A malicious\n  \
    \ user could choose to launch requests to telephone numbers that are\n   known\
    \ never to answer, which would saturate these resources\n   indefinitely and potentially\
    \ without incurring any charges.  Gateways\n   therefore MAY support policies\
    \ that restrict the number of\n   simultaneous requests originating from the same\
    \ authenticated source,\n   or similar mechanisms to address this possible denial-of-service\n\
    \   attack.\n"
- title: 16. IANA Considerations
  contents:
  - "16. IANA Considerations\n   This document introduces no new considerations for\
    \ IANA.\n"
- title: 17. Acknowledgments
  contents:
  - "17. Acknowledgments\n   This document existed as an Internet-Draft for four years,\
    \ and it\n   received innumerable contributions from members of the various\n\
    \   Transport Area IETF working groups that it called home (which\n   included\
    \ the MMUSIC, SIP and SIPPING WGs).  In particular, the\n   authors would like\
    \ to thank Olli Hynonen, Tomas Mecklin, Bill\n   Kavadas, Jonathan Rosenberg,\
    \ Henning Schulzrinne, Takuya Sawada,\n   Miguel A. Garcia, Igor Slepchin, Douglas\
    \ C. Sicker, Sam Hoffpauir,\n   Jean-Francois Mule, Christer Holmberg, Doug Hurtig,\
    \ Tahir Gun, Jan\n   Van Geel, Romel Khan, Mike Hammer, Mike Pierce, Roland Jesske,\
    \ Moter\n   Du, John Elwell, Steve Bellovin, Mark Watson, Denis Alexeitsev, Lars\n\
    \   Tovander, Al Varney and William T.  Marshall for their help and\n   feedback\
    \ on this document.  The authors would also like to thank\n   ITU-T SG11 for their\
    \ advice on ISUP procedures.\n"
- title: 18. Normative References
  contents:
  - "18. Normative References\n   [1]  Rosenberg, J., Schulzrinne, H., Camarillo,\
    \ G., Johnston, A.,\n        Peterson, J., Sparks, R., Handley, M. and E. Schooler,\
    \ \"SIP:\n        Session Initiation Protocol\", RFC 3261, June 2002.\n   [2]\
    \  Bradner, S., \"Key words for use in RFCs to indicate requirement\n        levels\"\
    , BCP 14, RFC 2119, March 1997.\n   [3]  Zimmerer, E., Peterson, J., Vemuri, A.,\
    \ Ong, L., Audet, F.,\n        Watson, M. and M. Zonoun, \"MIME media types for\
    \ ISUP and QSIG\n        objects\", RFC 3204, December 2001.\n   [4]  Freed, N.\
    \ and N. Borenstein, \"Multipurpose Internet Mail\n        Extensions (MIME) Part\
    \ Two: Media Types\", RFC 2046, November\n        1996.\n   [5]  Schulzrinne,\
    \ H. and S. Petrack, \"RTP Payload for DTMF Digits,\n        Telephony Tones and\
    \ Telephony Signals\", RFC 2833, May 2000.\n   [6]  Donovan, S., \"The SIP INFO\
    \ Method\", RFC 2976, October 2000.\n   [7]  Vaha-Sipila, A., \"URLs for Telephone\
    \ Calls\", RFC 2806, April\n        2000.\n   [8]  Faltstrom, P., \"E.164 number\
    \ and DNS\", RFC 2916, September 2000.\n   [9]  Schulzrinne, H., Camarillo, G.\
    \ and D. Oran, \"The Reason Header\n        Field for the Session Initiation Protocol\"\
    , RFC 3326, December\n        2002.\n   [9A] Vemuri, A. and J. Peterson, \"Session\
    \ Initiation Protocol for\n        Telephones (SIP-T): Context and Architectures\"\
    , BCP 63, RFC\n        3372, September 2002.\n   [9B] Peterson, J., \"A Privacy\
    \ Mechanism for the Session Initiation\n        Protocol (SIP)\", RFC 3323, November\
    \ 2002.\n"
- title: 19. Non-Normative References
  contents:
  - "19. Non-Normative References\n   [10] International Telecommunications Union,\
    \ \"Application of the ISDN\n        user part of CCITT Signaling System No. 7\
    \ for international ISDN\n        interconnection\", ITU-T Q.767, February 1991,\n\
    \        <http://www.itu.int>.\n   [11] American National Standards Institute,\
    \ \"Signaling System No. 7;\n        ISDN User Part\", ANSI T1.113, January 1995,\n\
    \        <http://www.itu.int>.\n   [12] International Telecommunications Union,\
    \ \"Signaling System No. 7;\n        ISDN User Part Signaling procedures\", ITU-T\
    \ Q.764, December\n        1999, <http://www.itu.int>.\n   [13] International\
    \ Telecommunications Union, \"Abnormal conditions -\n        Special release\"\
    , ITU-T Q.118, September 1997,\n        <http://www.itu.int>.\n   [14] International\
    \ Telecommunications Union, \"Specifications of\n        Signaling System No.\
    \ 7 - ISDN supplementary services\", ITU-T\n        Q.737, June 1997, <http://www.itu.int>.\n\
    \   [15] International Telecommunications Union, \"Usage of cause location\n \
    \       in the Digital Subscriber Signaling System No. 1 and the\n        Signaling\
    \ System No. 7 ISDN User Part\", ITU-T Q.850, May 1998,\n        <http://www.itu.int>.\n\
    \   [16] International Telecommunications Union, \"The international\n       \
    \ public telecommunications numbering plan\", ITU-T E.164, May\n        1997,\
    \ <http://www.itu.int>.\n   [17] International Telecommunications Union, \"Formats\
    \ and codes of\n        the ISDN User Part of Signaling System No. 7\", ITU-T\
    \ Q.763,\n        December 1999, <http://www.itu.int>.\n   [18] Rosenberg, J.\
    \ and H. Schulzrinne, \"Reliability of Provisional\n        Responses in SIP\"\
    , RFC 3262, June 2002.\n   [19] Stewart, R., \"Stream Control Transmission Protocol\"\
    , RFC 2960,\n        October 2000.\n   [20] Rosenberg, J., \"The Session Initiation\
    \ Protocol (SIP) UPDATE\n        Method\", RFC 3311, October 2002.\n   [21] Yu,\
    \ J., \"Extensions to the 'tel' and 'fax' URL in support of\n        Number Portability\
    \ and Freephone Service\", Work in Progress.\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Gonzalo Camarillo\n   Ericsson\n   Advanced Signalling\
    \ Research Lab.\n   FIN-02420 Jorvas\n   Finland\n   Phone: +358 9 299 3371\n\
    \   URI: http://www.ericsson.com/\n   EMail: Gonzalo.Camarillo@Ericsson.com\n\
    \   Adam Roach\n   dynamicsoft\n   5100 Tennyson Parkway\n   Suite 1200\n   Plano,\
    \ TX  75024\n   USA\n   URI: sip:adam@dynamicsoft.com\n   EMail: adam@dynamicsoft.com\n\
    \   Jon Peterson\n   NeuStar, Inc.\n   1800 Sutter St\n   Suite 570\n   Concord,\
    \ CA  94520\n   USA\n   Phone: +1 925/363-8720\n   EMail: jon.peterson@neustar.biz\n\
    \   URI: http://www.neustar.biz/\n   Lyndon Ong\n   Ciena\n   10480 Ridgeview\
    \ Court\n   Cupertino, CA  95014\n   USA\n   URI: http://www.ciena.com/\n   EMail:\
    \ lyOng@ciena.com\n"
- title: Full Copyright Statement
  contents:
  - "Full Copyright Statement\n   Copyright (C) The Internet Society (2002).  All\
    \ Rights Reserved.\n   This document and translations of it may be copied and\
    \ furnished to\n   others, and derivative works that comment on or otherwise explain\
    \ it\n   or assist in its implementation may be prepared, copied, published\n\
    \   and distributed, in whole or in part, without restriction of any\n   kind,\
    \ provided that the above copyright notice and this paragraph are\n   included\
    \ on all such copies and derivative works.  However, this\n   document itself\
    \ may not be modified in any way, such as by removing\n   the copyright notice\
    \ or references to the Internet Society or other\n   Internet organizations, except\
    \ as needed for the purpose of\n   developing Internet standards in which case\
    \ the procedures for\n   copyrights defined in the Internet Standards process\
    \ must be\n   followed, or as required to translate it into languages other than\n\
    \   English.\n   The limited permissions granted above are perpetual and will\
    \ not be\n   revoked by the Internet Society or its successors or assigns.\n \
    \  This document and the information contained herein is provided on an\n   \"\
    AS IS\" basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING\n   TASK FORCE\
    \ DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING\n   BUT NOT LIMITED\
    \ TO ANY WARRANTY THAT THE USE OF THE INFORMATION\n   HEREIN WILL NOT INFRINGE\
    \ ANY RIGHTS OR ANY IMPLIED WARRANTIES OF\n   MERCHANTABILITY OR FITNESS FOR A\
    \ PARTICULAR PURPOSE.\n"
- title: Acknowledgement
  contents:
  - "Acknowledgement\n   Funding for the RFC Editor function is currently provided\
    \ by the\n   Internet Society.\n"
