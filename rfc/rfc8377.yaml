- title: __initial_text__
  contents:
  - "         Transparent Interconnection of Lots of Links (TRILL):\n            \
    \                 Multi-Topology\n"
- title: Abstract
  contents:
  - "Abstract\n   This document specifies extensions to the IETF TRILL (Transparent\n\
    \   Interconnection of Lots of Links) protocol to support multi-topology\n   routing\
    \ of unicast and multi-destination traffic based on IS-IS\n   (Intermediate System\
    \ to Intermediate System) multi-topology specified\n   in RFC 5120.  This document\
    \ updates RFCs 6325 and 7177.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This\
    \ document is a product of the Internet Engineering Task Force\n   (IETF).  It\
    \ represents the consensus of the IETF community.  It has\n   received public\
    \ review and has been approved for publication by the\n   Internet Engineering\
    \ Steering Group (IESG).  Further information on\n   Internet Standards is available\
    \ in Section 2 of RFC 7841.\n   Information about the current status of this document,\
    \ any errata,\n   and how to provide feedback on it may be obtained at\n   https://www.rfc-editor.org/info/rfc8377.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2018 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (https://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.  Code Components\
    \ extracted from this document must\n   include Simplified BSD License text as\
    \ described in Section 4.e of\n   the Trust Legal Provisions and are provided\
    \ without warranty as\n   described in the Simplified BSD License.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1. Introduction ....................................................2\n\
    \      1.1. Terminology ................................................4\n  \
    \ 2. Topologies ......................................................5\n    \
    \  2.2. Links and Multi-Topology ...................................5\n      2.3.\
    \ TRILL Switches and Multi-Topology ..........................6\n      2.4. TRILL\
    \ Data Packets and Multi-Topology ......................6\n           2.4.1. Explicit\
    \ Topology Labeling Support ..................7\n           2.4.2. The Explicit\
    \ Topology Label .........................8\n           2.4.3. TRILL Use of the\
    \ MT Label ...........................8\n   3. TRILL Multi-Topology Adjacency\
    \ and Routing .....................10\n      3.1. Adjacency .................................................10\n\
    \      3.2. TRILL Switch Nicknames ....................................10\n  \
    \    3.3. TRILL Unicast Routing .....................................11\n    \
    \  3.4. TRILL Multi-Destination Routing ...........................11\n      \
    \     3.4.1. Distribution Trees .................................11\n        \
    \   3.4.2. Multi-Access Links .................................13\n   4. Mixed\
    \ Links ....................................................13\n   5. Other Multi-Topology\
    \ Considerations ............................14\n      5.1. Address Learning ..........................................14\n\
    \           5.1.1. Data Plane Learning ................................14\n  \
    \         5.1.2. Multi-Topology ESADI ...............................14\n    \
    \  5.2. Legacy Stubs ..............................................14\n      5.3.\
    \ RBridge Channel Messages ..................................14\n      5.4. Implementations\
    \ Considerations ............................15\n   6. Allocation Considerations\
    \ ......................................15\n      6.1. IEEE Registration Authority\
    \ Considerations ................15\n      6.2. IANA Considerations .......................................15\n\
    \   7. Security Considerations ........................................16\n  \
    \ 8. References .....................................................17\n    \
    \  8.1. Normative References ......................................17\n      8.2.\
    \ Informative References ....................................18\n   Appendix A.\
    \ Differences from RFC 5120 .............................19\n   Acknowledgements\
    \ ..................................................19\n   Authors' Addresses\
    \ ................................................20\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   This document specifies extensions to the IETF TRILL (Transparent\n\
    \   Interconnection of Lots of Links) protocol [RFC6325] [RFC7177]\n   [RFC7780]\
    \ to support multi-topology routing for both unicast and\n   multi-destination\
    \ traffic based on IS-IS (Intermediate System to\n   Intermediate System) [IS-IS]\
    \ multi-topology [RFC5120].\n   Implementation and use of multi-topology are optional,\
    \ and use\n   requires configuration.  It is anticipated that not all TRILL\n\
    \   campuses will need or use multi-topology.\n   Multi-topology creates different\
    \ topologies or subsets from a single\n   physical TRILL campus topology.  This\
    \ is different from Data Labels\n   (VLANs and Fine-Grained Labels (FGLs) [RFC7172]).\
    \  Data Labels\n   specify communities of end stations and can be viewed as creating\n\
    \   virtual topologies of end station connectivity.  However, in a single\n  \
    \ topology TRILL campus, TRILL Data packets can use any part of the\n   physical\
    \ topology of TRILL switches and links between TRILL switches,\n   regardless\
    \ of the Data Label of that packet's payload.  In a multi-\n   topology TRILL\
    \ campus, TRILL data packets in a topology are\n   restricted to the TRILL switches\
    \ and links that are in their\n   topology, regardless of the Data Label of their\
    \ payload.\n   The essence of multi-topology behavior is that a multi-topology\n\
    \   router classifies packets as to the topology within which they should\n  \
    \ be routed and uses logically different routing tables for different\n   topologies.\
    \  If routers in the network do not agree on the topology\n   classification of\
    \ packets or links, persistent routing loops can\n   occur.  It is the responsibility\
    \ of the network manager to\n   consistently configure multi-topology to avoid\
    \ such routing loops.\n   The multi-topology TRILL extensions can be used for\
    \ a wide variety of\n   purposes, such as maintaining separate routing domains\
    \ for isolated\n   multicast or IPv6 islands, routing a class of traffic so that\
    \ it\n   avoids certain TRILL switches that lack some characteristic needed by\n\
    \   that traffic, or making a class of traffic avoid certain links due to\n  \
    \ security, reliability, or other concerns.\n   It is possible for a particular\
    \ topology to not be fully connected,\n   either intentionally or due to node\
    \ or link failures or incorrect\n   configuration.  This results in two or more\
    \ islands of that topology\n   that cannot communicate.  In such a case, end stations\
    \ connected in\n   that topology to different islands will be unable to communicate\
    \ with\n   each other.\n   Multi-topology TRILL supports regions of topology-ignorant\
    \ TRILL\n   switches as part of a multi-topology campus; however, such regions\n\
    \   can only ingress to, egress from, or transit TRILL Data packets in\n   the\
    \ special base topology zero.\n"
- title: 1.1.  Terminology
  contents:
  - "1.1.  Terminology\n   The terminology and abbreviations of [RFC6325] are used\
    \ in this\n   document.  Some of these are paraphrased below for convenience.\
    \  Some\n   additional terms are also listed.\n      campus: The name for a TRILL\
    \ network, like \"bridged LAN\" is a name\n         for a bridged network.  It\
    \ does not have any academic\n         implication.\n      DRB: Designated RBridge\
    \ [RFC7177].\n      FGL: Fine-Grained Labeling or Fine-Grained Labeled or Fine-Grained\n\
    \         Label [RFC7172].  By implication, an \"FGL TRILL switch\" does\n   \
    \      not support Multi-Topology (MT).\n      IS: Intermediate System [IS-IS].\n\
    \      LSP: Link State PDU (Protocol Data Unit) [IS-IS].  For TRILL, this\n  \
    \       includes Level 1 LSPs and Extended Level 1 Flooding Scope LSPs\n     \
    \    [RFC7780].\n      MT: Multi-Topology [RFC5120].\n      MT TRILL Switch: A\
    \ TRILL switch supporting the multi-topology\n         feature specified in this\
    \ document.  An MT TRILL switch MUST\n         support FGL in the sense that it\
    \ MUST be FGL safe [RFC7172].\n      RBridge: Routing Bridge; an alternative name\
    \ for a TRILL switch.\n      TRILL: Transparent Interconnection of Lots of Links\
    \ or Tunneled\n         Routing in the Link Layer [RFC6325].\n      TRILL Switch:\
    \ A device implementing the TRILL protocol.  TRILL\n         switches are Intermediate\
    \ Systems (routers) [IS-IS].\n      VL: VLAN Labeling or VLAN Labeled or VLAN\
    \ Label [RFC7172].  By\n         implication, a \"VL RBridge\" or \"VL TRILL switch\"\
    \ does not\n         support FGL or MT.\n   The key words \"MUST\", \"MUST NOT\"\
    , \"REQUIRED\", \"SHALL\", \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\"\
    , \"NOT RECOMMENDED\", \"MAY\", and\n   \"OPTIONAL\" in this document are to be\
    \ interpreted as described in\n   BCP 14 [RFC2119] [RFC8174] when, and only when,\
    \ they appear in all\n   capitals, as shown here.\n"
- title: 2.  Topologies
  contents:
  - "2.  Topologies\n   In TRILL multi-topology, a topology is a subset of the TRILL\
    \ switches\n   and of the links between TRILL switches in the TRILL campus.  TRILL\n\
    \   Data packets are constrained to the subset of switches and links\n   corresponding\
    \ to the packet's topology.  TRILL multi-topology is\n   based on IS-IS multi-topology\
    \ [RFC5120].  See Appendix A for\n   differences between TRILL multi-topology\
    \ and [RFC5120].\n   The zero topology is special, as described in Section 2.1.\
    \  Sections\n   2.2, 2.3, and 2.4 discuss the topology of links, TRILL switches,\
    \ and\n   TRILL Data packets, respectively.\n"
- title: 2.1.  Special Topology Zero
  contents:
  - "2.1.  Special Topology Zero\n   The zero topology is special as the default base\
    \ topology.  All TRILL\n   switches and links are considered to be in, and MUST\
    \ support,\n   topology zero.  Thus, for example, topology zero can be used for\n\
    \   general TRILL switch access within a campus for management messages,\n   Bidirectional\
    \ Forwarding Detection (BFD) messages [RFC7175], RBridge\n   Channel messages\
    \ [RFC7178], and the like.\n"
- title: 2.2.  Links and Multi-Topology
  contents:
  - "2.2.  Links and Multi-Topology\n   Multi-topology TRILL switches advertise the\
    \ topologies for which they\n   are willing to send and receive TRILL Data packets\
    \ on a port by\n   listing those topologies in one or more MT TLVs [RFC5120] appearing\n\
    \   in every TRILL Hello [RFC7177] they send out that port, except that\n   they\
    \ MUST handle topology zero, which it is optional to list.\n   A link is usable\
    \ for TRILL Data packets in non-zero topology T only\n   if:\n   (1) all TRILL\
    \ switch ports on the link advertise topology T support\n       in their Hellos,\
    \ and\n   (2) if any TRILL switch port on the link requires explicit TRILL Data\n\
    \       packet topology labeling (see Section 2.4) every other TRILL\n       switch\
    \ port on the link is capable of generating explicit packet\n       topology labeling.\n"
- title: 2.3.  TRILL Switches and Multi-Topology
  contents:
  - "2.3.  TRILL Switches and Multi-Topology\n   A TRILL switch advertises the topologies\
    \ that it supports by listing\n   them in one or more MT TLVs [RFC5120] in its\
    \ LSP, except that it MUST\n   support topology zero, which is optional to list.\
    \  For robust and\n   rapid flooding, MT TLV(s) SHOULD be advertised in core LSP\
    \ fragment\n   zero.\n   There is no \"MT capability bit\".  A TRILL switch advertises\
    \ that it\n   is MT capable by advertising in its LSP support for any topology\
    \ or\n   topologies with the MT TLV, even if it just explicitly advertises\n \
    \  support for topology zero.\n"
- title: 2.4.  TRILL Data Packets and Multi-Topology
  contents:
  - "2.4.  TRILL Data Packets and Multi-Topology\n   The topology of a TRILL Data\
    \ packet is commonly determined from\n   either (1) some field or fields present\
    \ in the packet itself or (2)\n   the port on which the packet was received; however,\
    \ optional explicit\n   topology labeling of TRILL Data packets is also proved.\
    \  This can be\n   included in the data labeling area of TRILL Data packets as\
    \ specified\n   below.\n   Examples of fields that might be used to determine\
    \ topology are\n   values or ranges of values of the payload VLAN or FGL [RFC7172],\n\
    \   packet priority, IP version (IPv6 versus IPv4) or IP protocol,\n   Ethertype,\
    \ unicast versus multi-destination payload, IP\n   Differentiated Services Code\
    \ Point (DSCP) bits, or the like.\n   Multi-topology does not apply to TRILL IS-IS\
    \ packets or to link level\n   control frames.  Those messages are link local\
    \ and can be thought of\n   as being above all topologies.  Multi-topology only\
    \ applies to TRILL\n   Data packets.\n"
- title: 2.4.1.  Explicit Topology Labeling Support
  contents:
  - "2.4.1.  Explicit Topology Labeling Support\n   Support of the topology label\
    \ is optional.  Support could depend on\n   port hardware and is indicated by\
    \ a 2-bit capability field in the\n   Port TRILL Version sub-TLV [RFC7176] appearing\
    \ in the Port\n   Capabilities TLV in Hellos.  If there is no Port TRILL Capabilities\n\
    \   sub-TLV in a Hello, then it is assumed that explicit topology\n   labeling\
    \ is not supported on that port.  See the table below for the\n   meaning of values\
    \ of the Explicit Topology capability field:\n      Value   Meaning\n      -----\
    \   -------\n       0       No support.  Cannot send TRILL Data packets with an\n\
    \               explicit topology label and will likely treat as\n           \
    \    erroneous and discard any TRILL Data packet received with\n             \
    \  a topology label.  Such a port is assumed to have the\n               ability\
    \ and configuration to correctly classify TRILL\n               Data packets into\
    \ all topologies for which it is\n               advertising support in its Hellos,\
    \ either by examining\n               those packets or because they are arriving\
    \ at that port.\n       1       Capable of inserting an explicit topology label\
    \ in TRILL\n               Data packets sent and tolerant of such labels in received\n\
    \               TRILL Data packets.  Such a port is capable, for all of\n    \
    \           the topologies it supports, of determining TRILL Data\n          \
    \     packet topology without an explicit label.  Thus, it does\n            \
    \   not require such a label in received TRILL Data packets.\n               On\
    \ receiving a packet whose explicit topology label\n               differs from\
    \ the port's topology determination for that\n               packet, the TRILL\
    \ switch MUST discard the packet.\n    2 & 3      Require an explicit topology\
    \ label in received TRILL Data\n               packets except for topology zero.\
    \  Any TRILL Data packets\n               received without such a label are classified\
    \ as being in\n               topology zero.   Also capable of inserting an explicit\n\
    \               topology label in TRILL Data packets sent.  (Values 2 and\n  \
    \             3 are treated the same, which is the same as saying that\n     \
    \          if the 2 bit is on, the 1 bit is ignored.)\n   In a Hello on Port P,\
    \ a TRILL switch advertising support for topology\n   T but not advertising that\
    \ it requires explicit topology labeling is\n   assumed to have the ability and\
    \ configuration to correctly classify\n   TRILL Data packets into topology T by\
    \ examination of those TRILL Data\n   packets and/or by using the fact that they\
    \ are arriving at port P.\n   When a TRILL switch transmits a TRILL Data packet\
    \ onto a link, if any\n   other TRILL switch on that link requires explicit topology\
    \ labeling,\n   an explicit topology label MUST be included unless the TRILL Data\n\
    \   packet is in topology zero, in which case, an explicit topology label\n  \
    \ MAY be included.  If a topology label is not so required, but all\n   other\
    \ TRILL switches on that link support explicit topology labeling,\n   then such\
    \ a label MAY be included.\n"
- title: 2.4.2.  The Explicit Topology Label
  contents:
  - "2.4.2.  The Explicit Topology Label\n   This section specifies the explicit topology\
    \ label.  Its use by TRILL\n   is specified in Section 2.4.3.  This label may\
    \ be used by other\n   technologies besides TRILL.  The MT Label is structured\
    \ as follows:\n    0                   1                   2                 \
    \  3\n    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n  \
    \ +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n   |    \
    \ MT Ethertype 0x9A22       | V | R |         MT-ID         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \                            Figure 1: MT Label\n   Where the fields are as follows:\n\
    \   MT Ethertype: The MT Label Ethertype (see Section 6.1).\n   V: The version\
    \ number of the MT Label.  This document specifies\n      version zero.\n   R:\
    \ A 2-bit reserved field that MUST be sent as zero and ignored on\n      receipt.\n\
    \   MT-ID: The 12-bit topology using the topology number space of the MT\n   \
    \   TLV [RFC5120].\n"
- title: 2.4.3.  TRILL Use of the MT Label
  contents:
  - "2.4.3.  TRILL Use of the MT Label\n   With the addition of the version zero MT\
    \ Label, the four standardized\n   content varieties for the TRILL Data packet\
    \ data labeling area (the\n   area after the Inner.MacSA -- or Flag Word if the\
    \ Flag Word is\n   present [RFC7780] -- and before the payload) are as show below.\n\
    \   TRILL Data packets received with any other data labeling are\n   discarded.\
    \  {PRI, D} is a 3-bit priority and a drop eligibility\n   indicator bit [RFC7780].\n\
    \   All MT TRILL switches MUST support FGL, in the sense of being FGL\n   safe\
    \ [RFC7172]; thus, they MUST support all four data labeling area\n   contents\
    \ shown below.  (This requirement is imposed, rather than\n   having FGL support\
    \ and MT support be independent, to reduce the\n   number of variations in RBridges\
    \ and simplify testing.)\n   1. C-VLAN [RFC6325]\n                           1\
    \ 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 3 3\n       0 1 2 3 4 5 6 7 8 9 0 1 2\
    \ 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      |  C-VLAN = 0x8100              | PRI |D|  VLAN ID              |\n   \
    \   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n   2. FGL\
    \ [RFC7172]\n                           1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2\
    \ 2 3 3\n       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0\
    \ 1\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      |  FGL = 0x893B                 | PRI |D|  FGL High Part        |\n   \
    \   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n      |\
    \  FGL = 0x893B                 | PRI |D|  FGL Low Part         |\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   3. MT C-VLAN [RFC8377]\n                           1 1 1 1 1 1 1 1 1 1 2 2\
    \ 2 2 2 2 2 2 2 2 3 3\n       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3\
    \ 4 5 6 7 8 9 0 1\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      |  MT Ethertype = 0x9A22        | 0 | R |  MT-ID                |\n   \
    \   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n      |\
    \  C-VLAN = 0x8100              | PRI |D|  VLAN ID              |\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   4. MT FGL [RFC8377] [RFC7172]\n                           1 1 1 1 1 1 1 1\
    \ 1 1 2 2 2 2 2 2 2 2 2 2 3 3\n       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9\
    \ 0 1 2 3 4 5 6 7 8 9 0 1\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      |  MT Ethertype = 0x9A22        | 0 | R |  MT-ID                |\n   \
    \   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n      |\
    \  FGL = 0x893B                 | PRI |D|  FGL High Part        |\n      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \      |  FGL = 0x893B                 | PRI |D|  FGL Low Part         |\n   \
    \   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n   Inclusion\
    \ or use of S-VLAN or further stacked tags are beyond the\n   scope of this document,\
    \ but, as stated in [RFC6325], are obvious\n   extensions.\n"
- title: 3.  TRILL Multi-Topology Adjacency and Routing
  contents:
  - "3.  TRILL Multi-Topology Adjacency and Routing\n   Routing calculations in IS-IS\
    \ are based on adjacency.  Section 3.1\n   specifies multi-topology TRILL adjacency.\
    \  Section 3.2 describes the\n   handling of nicknames.  Sections 3.3 and 3.4\
    \ specify how unicast and\n   multi-destination TRILL multi-topology routing differ\
    \ from the TRILL\n   base protocol routing.\n"
- title: 3.1.  Adjacency
  contents:
  - "3.1.  Adjacency\n   There is no change in the determination or announcement of\
    \ adjacency\n   for topology zero, which is as specified in [RFC7177].  When a\n\
    \   topology zero adjacency reaches the Report state, as specified in\n   [RFC7177],\
    \ the adjacency is announced in core LSPs using the Extended\n   Intermediate\
    \ System Reachability TLV (#22).  This will be compatible\n   with any legacy\
    \ topology-ignorant RBridges that might not support E-\n   L1FS FS-LSPs [RFC7780].\n\
    \   Adjacency is announced for non-zero topologies in LSPs using the MT\n   Reachable\
    \ Intermediate Systems TLV (#222) as specified in [RFC5120].\n   A TRILL switch\
    \ reports adjacency for non-zero topology T if and only\n   if that adjacency\
    \ is in the Report state [RFC7177] and the two\n   conditions listed in Section\
    \ 2.2 are true, namely:\n   1. All the ports on the link are announcing support\
    \ of topology T.\n   2. If any port announces that it requires explicit topology\
    \ labeling\n      (Explicit Topology capability field value 2 or 3), all other\
    \ ports\n      advertise that they are capable of producing such labeling\n  \
    \    (Explicit Topology capability field value of 1, 2, or 3).\n"
- title: 3.2.  TRILL Switch Nicknames
  contents:
  - "3.2.  TRILL Switch Nicknames\n   TRILL switches are usually identified within\
    \ the TRILL protocol (for\n   example, in the TRILL Header) by nicknames [RFC6325]\
    \ [RFC7780].  Such\n   nicknames can be viewed as simply 16-bit abbreviation for\
    \ a TRILL\n   switch's (or pseudo-node's) 7-byte IS-IS System ID.  A TRILL switch\n\
    \   or pseudo-node can have more than one nickname, each of which\n   identifies\
    \ it.\n   Nicknames are common across all topologies, just as IS-IS System IDs\n\
    \   are.  Nicknames are determined as specified in [RFC6325] and\n   [RFC7780]\
    \ using only the Nickname sub-TLVs appearing in Router\n   Capabilities TLVs (#242)\
    \ advertised by TRILL switches.  In\n   particular, the nickname allocation algorithm\
    \ ignores Nickname sub-\n   TLVs that appear in MT Router Capability TLVs (#144).\
    \  (However,\n   Nickname sub-TLVs that appear in MT Router Capability TLVs with\
    \ a\n   non-zero topology do affect the choice of distribution tree roots as\n\
    \   described in Section 3.4.1.)\n   To minimize transient inconsistencies, all\
    \ Nickname sub-TLVs\n   advertised by a TRILL switch for a particular nickname,\
    \ whether in\n   Router Capability or MT Router Capability TLVs, SHOULD appear\
    \ in the\n   same LSP PDU.  If that is not the case, then all LSP PDUs in which\n\
    \   they do occur SHOULD be flooded as an atomic action.\n"
- title: 3.3.  TRILL Unicast Routing
  contents:
  - "3.3.  TRILL Unicast Routing\n   TRILL Data packets being TRILL unicast (those\
    \ with TRILL Header M bit\n   = 0) are routed based on the egress nickname using\
    \ logically separate\n   forwarding tables per topology T, where each such table\
    \ has been\n   calculated based on least cost routing within T: that is, only\
    \ using\n   links and nodes that support T.  Thus, the next hop when forwarding\n\
    \   TRILL Data packets is determined by a lookup logically based on\n   {topology,\
    \ egress nickname}.\n"
- title: 3.4.  TRILL Multi-Destination Routing
  contents:
  - "3.4.  TRILL Multi-Destination Routing\n   TRILL sends multi-destination data\
    \ packets (those packets with TRILL\n   Header M bit = 1) over a distribution\
    \ tree.  Trees are designated by\n   nicknames that appear in the \"egress nickname\"\
    \ field of multi-\n   destination TRILL Data packet TRILL Headers.  To constrain\
    \ multi-\n   destination packets to a topology T and still distribute them\n \
    \  properly requires the use of a distribution tree constrained to T.\n   Handling\
    \ such TRILL Data packets and distribution trees in TRILL MT\n   is as described\
    \ in the subsections below.\n"
- title: 3.4.1.  Distribution Trees
  contents:
  - "3.4.1.  Distribution Trees\n   General provisions for distribution trees and\
    \ how those trees are\n   determined are as specified in [RFC6325], [RFC7172],\
    \ and [RFC7780].\n   The distribution trees for topology zero are determined as\
    \ specified\n   in those references and are the same as they would be with topology-\n\
    \   ignorant TRILL switches.\n   The TRILL distribution tree construction and\
    \ packet handling for some\n   non-zero topology T are determined as specified\
    \ in [RFC6325],\n   [RFC7172], and [RFC7780] with the following changes:\n   \
    \   o  As specified in [RFC5120], only links usable with topology T\n        \
    \ TRILL Data packets are considered when building a distribution\n         tree\
    \ for topology T.  As a result, such trees are automatically\n         limited\
    \ to and separately span every internally connected\n         island of topology\
    \ T.  In other words, if non-zero topology T\n         consists of disjoint islands,\
    \ each distribution tree\n         construction for topology T is local to one\
    \ such island.\n      o  Only the Nickname sub-TLV, Trees sub-TLV, Tree Identifiers\
    \ sub-\n         TLV, and Trees Used sub-TLV occurring in an MT Router\n     \
    \    Capabilities TLV (#144) specifying topology T are used in\n         determining\
    \ the tree root(s), if any, for a connected area of\n         non-zero topology\
    \ T.\n         +  There may be non-zero topologies with no multi-destination\n\
    \            traffic or, as described in [RFC5120], even topologies with\n   \
    \         no traffic at all.  For example, if only known destination\n       \
    \     unicast IPv6 TRILL Data packets were in topology T and all\n           \
    \ multi-destination IPv6 TRILL Data packets were in some other\n            topology,\
    \ there would be no need for a distribution tree for\n            topology T.\
    \  For this reason, a Number of Trees to Compute\n            field value of zero\
    \ in the Trees sub-TLV for the TRILL\n            switch holding the highest priority\
    \ to be a tree root for a\n            non-zero topology T is honored and causes\
    \ no distribution\n            trees to be calculated for non-zero topology T.\
    \  This is\n            different from the base topology zero where, as specified\
    \ in\n            [RFC6325], a zero Number of Trees to Compute field value\n \
    \           causes one tree to be computed.\n      o  Nicknames are allocated\
    \ as described in Section 3.2.  If a\n         TRILL switch advertising that it\
    \ provides topology T service\n         holds nickname N, the priority of N to\
    \ be a tree root is given\n         by the tree root priority field of the Nickname\
    \ sub-TLV that\n         has N in its nickname field and occurs in a topology\
    \ T MT\n         Router Capabilities TLV advertised by that TRILL switch.  If\
    \ no\n         such Nickname sub-TLV can be found, the priority of N to be a\n\
    \         tree root is the default for an FGL TRILL switch as specified\n    \
    \     in [RFC7172].\n         +  There could be multiple topology T Nickname sub-TLVs\
    \ for N\n            being advertised for a particular RBridge or pseudo-node,\n\
    \            due to transient conditions or errors.  In that case, any\n     \
    \       advertised in a core LSP PDU are preferred to those\n            advertised\
    \ in an E-L1FS FS-LSP PDU.  Within those\n            categories, the one in the\
    \ lowest numbered fragment is used\n            and if there are multiple in that\
    \ fragment, the one with the\n            smallest offset from the beginning of\
    \ the PDU is used.\n      o  Tree pruning for topology T uses only the Interested\
    \ VLANs sub-\n         TLVs and Interested Labels sub-TLVs [RFC7176] advertised\
    \ in MT\n         Router Capabilities TLVs for topology T.\n   An MT TRILL switch\
    \ MUST have logically separate routing tables per\n   topology for the forwarding\
    \ of multi-destination traffic.\n"
- title: 3.4.2.  Multi-Access Links
  contents:
  - "3.4.2.  Multi-Access Links\n   Multi-destination TRILL Data packets are forwarded\
    \ on broadcast\n   (multi-access) links in such a way as to be received by all\
    \ other\n   TRILL switch ports on the link.  For example, on Ethernet links they\n\
    \   are sent with a multicast Outer.MacDA [RFC6325].  Care must be taken\n   that\
    \ a TRILL Data packet in a non-zero topology is only forwarded by\n   an MT TRILL\
    \ switch.\n   For this reason, a non-zero topology TRILL Data packet MUST NOT\
    \ be\n   forwarded onto a link unless the link meets the requirements\n   specified\
    \ in Section 2.2 for use in that topology even if there are\n   one or more MT\
    \ TRILL switch ports on the link.\n"
- title: 4.  Mixed Links
  contents:
  - "4.  Mixed Links\n   There might be any combination of MT, FGL, or even VL TRILL\
    \ switches\n   [RFC7172] on a link.  DRB (Designated RBridge) election and Forwarder\n\
    \   appointment on the link work as previously specified in [RFC8139] and\n  \
    \ [RFC7177].  It is up to the network manager to configure and manage\n   the\
    \ TRILL switches on a link so that the desired switch is DRB and\n   the desired\
    \ switch is the Appointed Forwarder for the appropriate\n   VLANs.\n   Frames\
    \ ingressed by MT TRILL switches can potentially be in any\n   topology recognized\
    \ by the switch and permitted on the ingress port.\n   Frames ingressed by VL\
    \ or FGL TRILL switches can only be in the base\n   zero topology.  Because FGL\
    \ and VL TRILL switches do not understand\n   topologies, all occurrences of the\
    \ following sub-TLVs MUST occur only\n   in MT Port Capability TLVs with a zero\
    \ MT-ID.  Any occurrence of\n   these sub-TLVs in an MT Port Capability TLV with\
    \ a nonzero MT-ID is\n   ignored.\n      Special VLANs and Flags Sub-TLV\n   \
    \   Enabled-VLANs Sub-TLV\n      Appointed Forwarders Sub-TLV\n      VLANs Appointed\
    \ Sub-TLV\n   Native frames cannot be explicitly labeled (see Section 2.4) as\
    \ to\n   their topology.\n"
- title: 5.  Other Multi-Topology Considerations
  contents:
  - '5.  Other Multi-Topology Considerations

    '
- title: 5.1.  Address Learning
  contents:
  - "5.1.  Address Learning\n   The learning of end station Media Access Control (MAC)\
    \ addresses is\n   per topology as well as per label (VLAN or FGL).  The same\
    \ MAC\n   address can occur within a TRILL campus for different end stations\n\
    \   that differ only in topology without confusion.\n"
- title: 5.1.1.  Data Plane Learning
  contents:
  - "5.1.1.  Data Plane Learning\n   End station MAC addresses learned from ingressing\
    \ native frames or\n   egressing TRILL Data packets are, for MT TRILL switches,\
    \ qualified by\n   topology.  That is, either the topology into which that TRILL\
    \ switch\n   classified the ingressed native frame or the topology that the\n\
    \   egressed TRILL Data frame was in.\n"
- title: 5.1.2.  Multi-Topology ESADI
  contents:
  - "5.1.2.  Multi-Topology ESADI\n   In an MT TRILL switch, End Station Address Distribution\
    \ Information\n   (ESADI) [RFC7357] operates per label (VLAN or FGL) per topology.\n\
    \   Since ESADI messages appear, to transit TRILL switches, like normal\n   multi-destination\
    \ TRILL Data packets, ESADI link state databases and\n   ESADI protocol operation\
    \ are per topology as well as per label and\n   local to each area of multi-destination\
    \ TRILL data connectivity for\n   that topology.\n"
- title: 5.2.  Legacy Stubs
  contents:
  - "5.2.  Legacy Stubs\n   Areas of topology-ignorant TRILL switches can be connected\
    \ to and\n   become part of an MT TRILL campus but will only be able to ingress\n\
    \   to, transit, or egress from topology zero TRILL Data packets.\n"
- title: 5.3.  RBridge Channel Messages
  contents:
  - "5.3.  RBridge Channel Messages\n   RBridge Channel messages [RFC7178], such as\
    \ BFD over TRILL [RFC7175]\n   appear, to transit TRILL switches, like normal\
    \ multi-destination\n   TRILL Data packets.  Thus, they have a topology and, if\
    \ that topology\n   is non-zero, are constrained by topology like other TRILL\
    \ Data\n   packets.  Generally, when sent for network management purposes, they\n\
    \   are sent in topology zero to avoid such constraint.\n"
- title: 5.4.  Implementations Considerations
  contents:
  - "5.4.  Implementations Considerations\n   MT is an optional TRILL switch capability.\n\
    \   Experience with the actual deployment of Layer 3 IS-IS MT [RFC5120]\n   indicates\
    \ that a single router handling more than eight topologies is\n   rare.  There\
    \ may be many more than eight distinct topologies in a\n   routed area, such as\
    \ a TRILL campus; in that case, many of these\n   topologies will be handled by\
    \ disjoint sets of routers and/or links.\n   Based on this deployment experience,\
    \ a TRILL switch capable of\n   handling eight or more topologies can be considered\
    \ a full\n   implementation while a TRILL switch capable of handling four\n  \
    \ topologies can be considered a minimal implementation but still\n   useful under\
    \ some circumstances.\n"
- title: 6.  Allocation Considerations
  contents:
  - "6.  Allocation Considerations\n   IEEE Registration Authority and IANA considerations\
    \ are given below.\n"
- title: 6.1.  IEEE Registration Authority Considerations
  contents:
  - "6.1.  IEEE Registration Authority Considerations\n   The IEEE Registration Authority\
    \ has allocated Ethertype 0x9A22 for\n   the MT Label (see Section 2.4).\n"
- title: 6.2.  IANA Considerations
  contents:
  - "6.2.  IANA Considerations\n   IANA has assigned a field of two adjacent bits\
    \ (14-15) of the\n   Capabilities bits of the Port TRILL Version Sub-TLV for the\
    \ Explicit\n   Topology capability field and updated the \"PORT-TRILL-VER Sub-TLV\n\
    \   Capability Flags\" registry as follows.\n       Bit     Description      \
    \           Reference\n      -----   -------------------------    ---------------\n\
    \      14-15   Topology labeling support.   [RFC8377]\n   IANA has created the\
    \ informational \"TRILL Ethertypes\" subregistry in\n   the \"Transparent Interconnection\
    \ of Lots of Links (TRILL) Parameters\"\n   registry.\n   Name: TRILL Ethertypes\n\
    \   Registration Procedure(s): Ethertypes are assigned by the IEEE\n      Registration\
    \ Authority.  Updates to this registry are coordinated\n      with the designated\
    \ expert.\n   Reference: [RFC8377]\n   Note: This registry provides centralized\
    \ documentation of\n      Ethertypes that were assigned by the IEEE for initial\
    \ use\n      with TRILL.  In some cases, particularly L2-IS-IS and MT,\n     \
    \ they may be used with other protocols.\n   Value    Mnemonic    Explanation\
    \           Reference\n   ------   --------   ---------------------  ---------\n\
    \   0x22F3    TRILL     TRILL data             [RFC6325]\n   0x22F4    L2-IS-IS\
    \  IS-IS                  [RFC6325]\n   0x893B    FGL       Fine Grained Labeling\
    \  [RFC7172]\n   0x8946    -         TRILL RBridge Channel  [RFC7178]\n   0x9A22\
    \    MT        Multi-Topology         [RFC8377]\n"
- title: 7.  Security Considerations
  contents:
  - "7.  Security Considerations\n   Multiple topologies are sometimes used for the\
    \ isolation or security\n   of traffic.  For example, if some links were more\
    \ likely than others\n   to be subject to adversarial observation, it might be\
    \ desirable to\n   classify certain sensitive traffic in a topology that excluded\
    \ those\n   links.\n   Delivery of data originating in one topology outside of\
    \ that topology\n   is generally a security policy violation to be avoided at\
    \ all\n   reasonable costs.  Using IS-IS security [RFC5310] on all IS-IS PDUs\n\
    \   and link security appropriate to the link technology on all links\n   involved,\
    \ particularly those between RBridges, supports the avoidance\n   of such violations.\n\
    \   For general TRILL security considerations, see [RFC6325].\n"
- title: 8.  References
  contents:
  - '8.  References

    '
- title: 8.1.  Normative References
  contents:
  - "8.1.  Normative References\n   [IS-IS]    ISO/IEC 10589:2002, Second Edition,\
    \ \"Intermediate System\n              to Intermediate System Intra-Domain Routeing\
    \ Exchange\n              Protocol for use in Conjunction with the Protocol for\n\
    \              Providing the Connectionless-mode Network Service (ISO\n      \
    \        8473)\", 2002.\n   [RFC2119]  Bradner, S., \"Key words for use in RFCs\
    \ to Indicate\n              Requirement Levels\", BCP 14, RFC 2119,\n       \
    \       DOI 10.17487/RFC2119, March 1997,\n              <https://www.rfc-editor.org/info/rfc2119>.\n\
    \   [RFC5120]  Przygienda, T., Shen, N., and N. Sheth, \"M-ISIS: Multi\n     \
    \         Topology (MT) Routing in Intermediate System to\n              Intermediate\
    \ Systems (IS-ISs)\", RFC 5120,\n              DOI 10.17487/RFC5120, February\
    \ 2008,\n              <https://www.rfc-editor.org/info/rfc5120>.\n   [RFC5310]\
    \  Bhatia, M., Manral, V., Li, T., Atkinson, R., White, R.,\n              and\
    \ M. Fanto, \"IS-IS Generic Cryptographic\n              Authentication\", RFC\
    \ 5310, DOI 10.17487/RFC5310, February\n              2009, <https://www.rfc-editor.org/info/rfc5310>.\n\
    \   [RFC6325]  Perlman, R., Eastlake 3rd, D., Dutt, D., Gai, S., and A.\n    \
    \          Ghanwani, \"Routing Bridges (RBridges): Base Protocol\n           \
    \   Specification\", RFC 6325, DOI 10.17487/RFC6325, July 2011,\n            \
    \  <https://www.rfc-editor.org/info/rfc6325>.\n   [RFC7172]  Eastlake 3rd, D.,\
    \ Zhang, M., Agarwal, P., Perlman, R., and\n              D. Dutt, \"Transparent\
    \ Interconnection of Lots of Links\n              (TRILL): Fine-Grained Labeling\"\
    , RFC 7172,\n              DOI 10.17487/RFC7172, May 2014,\n              <https://www.rfc-editor.org/info/rfc7172>.\n\
    \   [RFC7176]  Eastlake 3rd, D., Senevirathne, T., Ghanwani, A., Dutt,\n     \
    \         D., and A. Banerjee, \"Transparent Interconnection of Lots\n       \
    \       of Links (TRILL) Use of IS-IS\", RFC 7176,\n              DOI 10.17487/RFC7176,\
    \ May 2014,\n              <https://www.rfc-editor.org/info/rfc7176>.\n   [RFC7177]\
    \  Eastlake 3rd, D., Perlman, R., Ghanwani, A., Yang, H., and\n              V.\
    \ Manral, \"Transparent Interconnection of Lots of Links\n              (TRILL):\
    \ Adjacency\", RFC 7177, DOI 10.17487/RFC7177, May\n              2014, <https://www.rfc-editor.org/info/rfc7177>.\n\
    \   [RFC7178]  Eastlake 3rd, D., Manral, V., Li, Y., Aldrin, S., and D.\n    \
    \          Ward, \"Transparent Interconnection of Lots of Links\n            \
    \  (TRILL): RBridge Channel Support\", RFC 7178,\n              DOI 10.17487/RFC7178,\
    \ May 2014,\n              <https://www.rfc-editor.org/info/rfc7178>.\n   [RFC7357]\
    \  Zhai, H., Hu, F., Perlman, R., Eastlake 3rd, D., and O.\n              Stokes,\
    \ \"Transparent Interconnection of Lots of Links\n              (TRILL): End Station\
    \ Address Distribution Information\n              (ESADI) Protocol\", RFC 7357,\
    \ DOI 10.17487/RFC7357,\n              September 2014, <https://www.rfc-editor.org/info/rfc7357>.\n\
    \   [RFC7780]  Eastlake 3rd, D., Zhang, M., Perlman, R., Banerjee, A.,\n     \
    \         Ghanwani, A., and S. Gupta, \"Transparent Interconnection\n        \
    \      of Lots of Links (TRILL): Clarifications, Corrections, and\n          \
    \    Updates\", RFC 7780, DOI 10.17487/RFC7780, February 2016,\n             \
    \ <https://www.rfc-editor.org/info/rfc7780>.\n   [RFC8174]  Leiba, B., \"Ambiguity\
    \ of Uppercase vs Lowercase in RFC\n              2119 Key Words\", BCP 14, RFC\
    \ 8174, DOI 10.17487/RFC8174,\n              May 2017, <https://www.rfc-editor.org/info/rfc8174>.\n"
- title: 8.2.  Informative References
  contents:
  - "8.2.  Informative References\n   [RFC7175]  Manral, V., Eastlake 3rd, D., Ward,\
    \ D., and A. Banerjee,\n              \"Transparent Interconnection of Lots of\
    \ Links (TRILL):\n              Bidirectional Forwarding Detection (BFD) Support\"\
    , RFC\n              7175, DOI 10.17487/RFC7175, May 2014, <https://www.rfc-\n\
    \              editor.org/info/rfc7175>.\n   [RFC8139]  Eastlake 3rd, D., Li,\
    \ Y., Umair, M., Banerjee, A., and F.\n              Hu, \"Transparent Interconnection\
    \ of Lots of Links (TRILL):\n              Appointed Forwarders\", RFC 8139, DOI\
    \ 10.17487/RFC8139,\n              June 2017, <https://www.rfc-editor.org/info/rfc8139>.\n"
- title: Appendix A.  Differences from RFC 5120
  contents:
  - "Appendix A.  Differences from RFC 5120\n   TRILL multi-topology, as specified\
    \ in this document, differs from RFC\n   5120 as follows:\n   1. [RFC5120] provides\
    \ for unicast multi-topology.  This document\n      extends that to cover multi-destination\
    \ TRILL data distribution\n      (see Section 3.4).\n   2. [RFC5120] assumes the\
    \ topology of data packets is always\n      determined implicitly, that is, based\
    \ on the port over which the\n      packets are received and/or preexisting fields\
    \ within the packet.\n      This document supports such implicit determination,\
    \ but it extends\n      this by providing for optional explicit topology labeling\
    \ of data\n      packets (see Section 2.4).\n   3. [RFC5120] makes support of\
    \ the default topology zero optional for\n      MT routers and links.  For simplicity\
    \ and ease in network\n      management, this document requires all TRILL switches\
    \ and links\n      between TRILL switches to support topology zero (see Section\
    \ 2.1).\n"
- title: Acknowledgements
  contents:
  - "Acknowledgements\n   The comments and contributions of the following are gratefully\n\
    \   acknowledged:\n   Vishwas Manral and Martin Vigoureux\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Donald Eastlake 3rd\n   Huawei Technologies\n   1424 Pro\
    \ Shop Court\n   Davenport, FL 33896\n   United States of America\n   Phone: +1-508-333-2270\n\
    \   Email: d3e3e3@gmail.com\n   Mingui Zhang\n   Huawei Technologies Co., Ltd.\n\
    \   HuaWei Building, No.3 Xinxi Rd., Shang-Di\n   Information Industry Base, Hai-Dian\
    \ District,\n   Beijing, 100085\n   China\n   Email: zhangmingui@huawei.com\n\
    \   Ayan Banerjee\n   Cisco\n   170 W. Tasman Drive\n   San Jose, CA 95134\n \
    \  United States of America\n   Email: ayabaner@cisco.com\n"
