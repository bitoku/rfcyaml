- title: __initial_text__
  contents:
  - '               SMTP Extension for Internationalized Email

    '
- title: Abstract
  contents:
  - "Abstract\n   This document specifies an SMTP extension for transport and delivery\n\
    \   of email messages with internationalized email addresses or header\n   information.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This\
    \ document is a product of the Internet Engineering Task Force\n   (IETF).  It\
    \ represents the consensus of the IETF community.  It has\n   received public\
    \ review and has been approved for publication by the\n   Internet Engineering\
    \ Steering Group (IESG).  Further information on\n   Internet Standards is available\
    \ in Section 2 of RFC 5741.\n   Information about the current status of this document,\
    \ any errata,\n   and how to provide feedback on it may be obtained at\n   http://www.rfc-editor.org/info/rfc6531.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2012 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (http://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.  Code Components\
    \ extracted from this document must\n   include Simplified BSD License text as\
    \ described in Section 4.e of\n   the Trust Legal Provisions and are provided\
    \ without warranty as\n   described in the Simplified BSD License.\n   This document\
    \ may contain material from IETF Documents or IETF\n   Contributions published\
    \ or made publicly available before November\n   10, 2008.  The person(s) controlling\
    \ the copyright in some of this\n   material may not have granted the IETF Trust\
    \ the right to allow\n   modifications of such material outside the IETF Standards\
    \ Process.\n   Without obtaining an adequate license from the person(s) controlling\n\
    \   the copyright in such materials, this document may not be modified\n   outside\
    \ the IETF Standards Process, and derivative works of it may\n   not be created\
    \ outside the IETF Standards Process, except to format\n   it for publication\
    \ as an RFC or to translate it into languages other\n   than English.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1.  Introduction . . . . . . . . . . . . . . . . . . .\
    \ . . . . . .  3\n     1.1.  Terminology  . . . . . . . . . . . . . . . . . .\
    \ . . . . .  3\n     1.2.  Changes Made to Other Specifications . . . . . . .\
    \ . . . .  3\n   2.  Overview of Operation  . . . . . . . . . . . . . . . . .\
    \ . . .  4\n   3.  Mail Transport-Level Protocol  . . . . . . . . . . . . . .\
    \ . .  4\n     3.1.  Framework for the Internationalization Extension . . . .\
    \ .  4\n     3.2.  The SMTPUTF8 Extension . . . . . . . . . . . . . . . . . .\
    \  5\n     3.3.  Extended Mailbox Address Syntax  . . . . . . . . . . . . .  7\n\
    \     3.4.  MAIL Command Parameter Usage . . . . . . . . . . . . . . .  8\n  \
    \   3.5.  Non-ASCII Addresses and Reply-Codes  . . . . . . . . . . .  9\n    \
    \ 3.6.  Body Parts and SMTP Extensions . . . . . . . . . . . . . .  9\n     3.7.\
    \  Additional ESMTP Changes and Clarifications  . . . . . . . 10\n       3.7.1.\
    \  The Initial SMTP Exchange  . . . . . . . . . . . . . . 10\n       3.7.2.  Mail\
    \ eXchangers  . . . . . . . . . . . . . . . . . . . 10\n       3.7.3.  Trace Information\
    \  . . . . . . . . . . . . . . . . . . 11\n       3.7.4.  UTF-8 Strings in Replies\
    \ . . . . . . . . . . . . . . . 11\n   4.  IANA Considerations  . . . . . . .\
    \ . . . . . . . . . . . . . . 13\n     4.1.  SMTP Service Extensions Registry\
    \ . . . . . . . . . . . . . 13\n     4.2.  SMTP Enhanced Status Code Registry\
    \ . . . . . . . . . . . . 13\n     4.3.  WITH Protocol Types Sub-Registry of the\
    \ Mail\n           Transmission Types Registry  . . . . . . . . . . . . . . .\
    \ 15\n   5.  Security Considerations  . . . . . . . . . . . . . . . . . . . 15\n\
    \   6.  Acknowledgements . . . . . . . . . . . . . . . . . . . . . . . 16\n  \
    \ 7.  References . . . . . . . . . . . . . . . . . . . . . . . . . . 16\n    \
    \ 7.1.  Normative References . . . . . . . . . . . . . . . . . . . 16\n     7.2.\
    \  Informative References . . . . . . . . . . . . . . . . . . 18\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   The document defines a Simple Mail Transfer Protocol [RFC5321]\n\
    \   extension so servers can advertise the ability to accept and process\n   internationalized\
    \ email addresses (see Section 1.1) and\n   internationalized email headers [RFC6532].\n\
    \   An extended overview of the extension model for internationalized\n   email\
    \ addresses and the email header appears in RFC 6530 [RFC6530],\n   referred to\
    \ as \"the framework document\" in this specification.  A\n   thorough understanding\
    \ of the information in that document and in the\n   base Internet email specifications\
    \ [RFC5321] [RFC5322] is necessary\n   to understand and implement this specification.\n"
- title: 1.1.  Terminology
  contents:
  - "1.1.  Terminology\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\", \"\
    SHALL\", \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"MAY\"\
    , and \"OPTIONAL\" in this\n   document are to be interpreted as described in\
    \ RFC 2119 [RFC2119].\n   The terms \"UTF-8 string\" or \"UTF-8 character\" are\
    \ used to refer to\n   Unicode characters, which may or may not be members of\
    \ the ASCII\n   subset, in UTF-8 [RFC3629], a standard Unicode Encoding Form.\
    \  All\n   other specialized terms used in this specification are defined in the\n\
    \   framework document or in the base Internet email specifications.  In\n   particular,\
    \ the terms \"ASCII address\", \"internationalized email\n   address\", \"non-ASCII\
    \ address\", \"SMTPUTF8\", \"internationalized\n   message\", and \"message\"\
    \ are used in this document according to the\n   definitions in the framework\
    \ document [RFC6530].\n   Strings referred to in this document, including ASCII\
    \ strings, MUST\n   be expressed in UTF-8.\n   This specification uses Augmented\
    \ BNF (ABNF) rules [RFC5234].  Some\n   basic rules in this document are identified\
    \ in Section 3.3 as being\n   defined (under the same names) in RFC 5234 [RFC5234],\
    \ RFC 5321\n   [RFC5321], RFC 5890 [RFC5890], or RFC 6532 [RFC6532].\n"
- title: 1.2.  Changes Made to Other Specifications
  contents:
  - "1.2.  Changes Made to Other Specifications\n   This specification extends some\
    \ syntax rules defined in RFC 5321 and\n   permits internationalized email addresses\
    \ in the envelope and in\n   trace fields, but it does not modify RFC 5321.  It\
    \ permits data\n   formats defined in RFC 6532 [RFC6532], but it does not modify\
    \ RFC\n   5322.  It does require that the 8BITMIME extension [RFC6152] be\n  \
    \ announced by the SMTPUTF8-aware SMTP server and used with\n   \"BODY=8BITMIME\"\
    \ by the SMTPUTF8-aware SMTP client, but it does not\n   modify the 8BITMIME specification\
    \ in any way.\n   This specification replaces an earlier, experimental, approach\
    \ to the\n   same problem [RFC5336].  Section 6 of RFC 6530 [RFC6530] describes\n\
    \   the changes in approach between RFC 5336 [RFC5336] and this\n   specification.\
    \  Anyone trying to convert an implementation from the\n   experimental specification\
    \ to the specification in this document will\n   need to review those changes\
    \ carefully.\n"
- title: 2.  Overview of Operation
  contents:
  - "2.  Overview of Operation\n   This document specifies an element of the email\
    \ internationalization\n   work, specifically the definition of an SMTP extension\
    \ for\n   internationalized email.  The extension is identified with the token\n\
    \   \"SMTPUTF8\".\n   The internationalized email headers specification [RFC6532]\
    \ provides\n   the details of email header features enabled by this extension.\n"
- title: 3.  Mail Transport-Level Protocol
  contents:
  - '3.  Mail Transport-Level Protocol

    '
- title: 3.1.  Framework for the Internationalization Extension
  contents:
  - "3.1.  Framework for the Internationalization Extension\n   The following service\
    \ extension is defined:\n   1.   The name of the SMTP service extension is \"\
    Internationalized\n        Email\".\n   2.   The EHLO keyword value associated\
    \ with this extension is\n        \"SMTPUTF8\".\n   3.   No parameter values are\
    \ defined for this EHLO keyword value.  In\n        order to permit future (although\
    \ unanticipated) extensions, the\n        EHLO response MUST NOT contain any parameters\
    \ for this keyword.\n        The SMTPUTF8-aware SMTP client MUST ignore any parameters\
    \ if\n        they appear for this keyword; that is, the SMTPUTF8-aware SMTP\n\
    \        client MUST behave as if the parameters do not appear.  If an\n     \
    \   SMTP server includes SMTPUTF8 in its EHLO response, it MUST be\n        fully\
    \ compliant with this version of this specification.\n   4.   One OPTIONAL parameter,\
    \ SMTPUTF8, is added to the MAIL command.\n        The parameter does not accept\
    \ a value.  If this parameter is set\n        in the MAIL command, it indicates\
    \ that the SMTP client is\n        SMTPUTF8-aware.  Its presence also asserts\
    \ that the envelope\n        includes the non-ASCII address, the message being\
    \ sent is an\n        internationalized message, or the message being sent needs\
    \ the\n        SMTPUTF8 support.\n   5.   The maximum length of a MAIL command\
    \ line is increased by 10\n        characters to accommodate the possible addition\
    \ of the SMTPUTF8\n        parameter.\n   6.   One OPTIONAL parameter, SMTPUTF8,\
    \ is added to the VERIFY (VRFY)\n        and EXPAND (EXPN) commands.  The SMTPUTF8\
    \ parameter does not\n        accept a value.  The parameter indicates that the\
    \ SMTP client\n        can accept Unicode characters in UTF-8 encoding in replies\
    \ from\n        the VRFY and EXPN commands.\n   7.   No additional SMTP verbs\
    \ are defined by this extension.\n   8.   Servers offering this extension MUST\
    \ provide support for, and\n        announce, the 8BITMIME extension [RFC6152].\n\
    \   9.   The reverse-path and forward-path of the SMTP MAIL and RCPT\n       \
    \ commands are extended to allow Unicode characters encoded in\n        UTF-8\
    \ in mailbox names (addresses).\n   10.  The mail message body is extended as\
    \ specified in RFC 6532\n        [RFC6532].\n   11.  The SMTPUTF8 extension is\
    \ valid on the submission port\n        [RFC6409].  It may also be used with the\
    \ Local Mail Transfer\n        Protocol (LMTP) [RFC2033].  When these protocols\
    \ are used, their\n        use should be reflected in the trace field WITH keywords\
    \ as\n        appropriate [RFC3848].\n"
- title: 3.2.  The SMTPUTF8 Extension
  contents:
  - "3.2.  The SMTPUTF8 Extension\n   An SMTP server that announces the SMTPUTF8 extension\
    \ MUST be prepared\n   to accept a UTF-8 string [RFC3629] in any position in which\
    \ RFC 5321\n   specifies that a <mailbox> can appear.  Although the characters\
    \ in\n   the <local-part> are permitted to contain non-ASCII characters, the\n\
    \   actual parsing of the <local-part> and the delimiters used are\n   unchanged\
    \ from the base email specification [RFC5321].  Any domain\n   name to be looked\
    \ up in the DNS MUST conform to and be processed as\n   specified for Internationalizing\
    \ Domain Names in Applications (IDNA)\n   [RFC5890].  When doing lookups, the\
    \ SMTPUTF8-aware SMTP client or\n   server MUST either use a Unicode-aware DNS\
    \ library, or transform the\n   internationalized domain name to A-label form\
    \ (i.e., a fully-\n   qualified domain name that contains one or more A-labels\
    \ but no\n   U-labels) as specified in RFC 5890 [RFC5890].\n   An SMTP client\
    \ that receives the SMTPUTF8 extension keyword in\n   response to the EHLO command\
    \ MAY transmit mailbox names within SMTP\n   commands as internationalized strings\
    \ in UTF-8 form.  It MAY send a\n   UTF-8 header [RFC6532] (which may also include\
    \ mailbox names in\n   UTF-8).  It MAY transmit the domain parts of mailbox names\
    \ within\n   SMTP commands or the message header as A-labels or U-labels\n   [RFC5890].\
    \  The presence of the SMTPUTF8 extension does not change\n   the server-relaying\
    \ behaviors described in RFC 5321.\n   If the SMTPUTF8 SMTP extension is not offered\
    \ by the SMTP server, the\n   SMTPUTF8-aware SMTP client MUST NOT transmit an\
    \ internationalized\n   email address and MUST NOT transmit a mail message containing\n\
    \   internationalized mail headers as described in RFC 6532 [RFC6532] at\n   any\
    \ level within its MIME structure [RFC2045].  (For this paragraph,\n   the internationalized\
    \ domain name in A-label form as specified in\n   IDNA definitions [RFC5890] is\
    \ not considered to be\n   \"internationalized\".)  Instead, if an SMTPUTF8-aware\
    \ SMTP client\n   (sender) attempts to transfer an internationalized message and\n\
    \   encounters an SMTP server that does not support the extension, the\n   best\
    \ action for it to take depends on other conditions.  In\n   particular:\n   o\
    \  If it is a Message Submission Agent (MSA) [RFC6409] [RFC5598], it\n      MAY\
    \ choose its own way to deal with this scenario using the wide\n      discretion\
    \ for changing addresses or otherwise fixing up and\n      transforming messages\
    \ allowed by RFC 6409.  As long as the\n      resulting message conforms to the\
    \ requirements of RFC 5321 (i.e.,\n      without the SMTPUTF8 extension), the\
    \ details of that\n      transformation are outside the scope of this document.\n\
    \   o  If it is not an MSA or is an MSA and does not choose to transform\n   \
    \   the message to one that does not require the SMTPUTF8 extension,\n      it\
    \ SHOULD reject the message.  As usual, this can be done either\n      by generating\
    \ an appropriate reply during the SMTP transaction or\n      by accepting the\
    \ message and then generating and transmitting a\n      non-delivery notification.\
    \  If the latter choice is made, the\n      notification process MUST conform\
    \ to the requirements of RFC 5321,\n      RFC 3464 [RFC3464], and RFC 6533 [RFC6533].\n\
    \   o  As specified in Section 2.2.3 of RFC 5321, an SMTP client with\n      additional\
    \ information and/or knowledge of special circumstances\n      MAY choose to requeue\
    \ the message and try later and/or try an\n      alternate MX host as specified\
    \ in that section.\n   This document applies when an SMTPUTF8-aware SMTP client\
    \ or server\n   supports the SMTPUTF8 extension.  For all other cases, and for\n\
    \   addresses and messages that do not require an SMTPUTF8 extension,\n   SMTPUTF8-aware\
    \ SMTP clients and servers do not change the behavior\n   specified in RFC 5321\
    \ [RFC5321].\n   If an SMTPUTF8-aware SMTP server advertises the Delivery Status\n\
    \   Notification (DSN) [RFC3461] extension, it MUST implement RFC 6533\n   [RFC6533].\n"
- title: 3.3.  Extended Mailbox Address Syntax
  contents:
  - "3.3.  Extended Mailbox Address Syntax\n   RFC 5321, Section 4.1.2, defines the\
    \ syntax of a <Mailbox> entirely\n   in terms of ASCII characters.  This document\
    \ extends <Mailbox> to add\n   support of non-ASCII characters.\n   The key changes\
    \ made by this specification include:\n   o  The <Mailbox> ABNF rule is imported\
    \ from RFC 5321 and updated in\n      order to support the internationalized email\
    \ address.  Other\n      related rules are imported from RFC 5321, RFC 5234, RFC\
    \ 5890, and\n      RFC 6532, or are extended in this document.\n   o  The definition\
    \ of <sub-domain> is extended to permit both the RFC\n      5321 definition and\
    \ a UTF-8 string in a DNS label that conforms\n      with IDNA definitions [RFC5890].\n\
    \   o  The definition of <atext> is extended to permit both the RFC 5321\n   \
    \   definition and a UTF-8 string.  That string MUST NOT contain any\n      of\
    \ the ASCII graphics or control characters.\n   The following ABNF rules imported\
    \ from RFC 5321, Section 4.1.2, are\n   updated directly or indirectly by this\
    \ document:\n   o  <Mailbox>\n   o  <Local-part>\n   o  <Dot-string>\n   o  <Quoted-string>\n\
    \   o  <QcontentSMTP>\n   o  <Domain>\n   o  <Atom>\n   The following ABNF rule\
    \ will be imported from RFC 6532, Section 3.1,\n   directly:\n   o  <UTF8-non-ascii>\n\
    \   The following ABNF rule will be imported from RFC 5234, Appendix B.1,\n  \
    \ directly:\n   o  <DQUOTE>\n   The following ABNF rule will be imported from\
    \ RFC 5890, Section\n   2.3.2.1, directly:\n   o  <U-label>\n   The following\
    \ rules are extended in ABNF [RFC5234] as follows.\n   sub-domain   =/  U-label\n\
    \    ; extend the definition of sub-domain in RFC 5321, Section 4.1.2\n   atext\
    \   =/  UTF8-non-ascii\n    ; extend the implicit definition of atext in\n   \
    \ ; RFC 5321, Section 4.1.2, which ultimately points to\n    ; the actual definition\
    \ in RFC 5322, Section 3.2.3\n   qtextSMTP  =/ UTF8-non-ascii\n    ; extend the\
    \ definition of qtextSMTP in RFC 5321, Section 4.1.2\n   esmtp-value  =/ UTF8-non-ascii\n\
    \    ; extend the definition of esmtp-value in RFC 5321, Section 4.1.2\n"
- title: 3.4.  MAIL Command Parameter Usage
  contents:
  - "3.4.  MAIL Command Parameter Usage\n   If the envelope or message being sent\
    \ requires the capabilities of\n   the SMTPUTF8 extension, the SMTPUTF8-aware\
    \ SMTP client MUST supply\n   the SMTPUTF8 parameter with the MAIL command.  If\
    \ this parameter is\n   provided, it MUST not accept a value.  If the SMTPUTF8-aware\
    \ SMTP\n   client is aware that neither the envelope nor the message being sent\n\
    \   requires any of the SMTPUTF8 extension capabilities, it SHOULD NOT\n   supply\
    \ the SMTPUTF8 parameter with the MAIL command.\n   Because there is no guarantee\
    \ that a next-hop SMTP server will\n   support the SMTPUTF8 extension, use of\
    \ the SMTPUTF8 extension always\n   carries a risk of transmission failure.  In\
    \ fact, during the early\n   stages of deployment for the SMTPUTF8 extension,\
    \ the risk will be\n   quite high.  Hence, there is a distinct near-term advantage\
    \ for\n   ASCII-only messages to be sent without using this extension.  The\n\
    \   long-term advantage of casting ASCII [ASCII] characters (0x7f and\n   below)\
    \ as UTF-8 form is that it permits pure-Unicode environments.\n"
- title: 3.5.  Non-ASCII Addresses and Reply-Codes
  contents:
  - "3.5.  Non-ASCII Addresses and Reply-Codes\n   An SMTPUTF8-aware SMTP client MUST\
    \ NOT send an internationalized\n   message to an SMTP server that does not support\
    \ SMTPUTF8.  If the\n   SMTP server does not support this option, then the SMTPUTF8-aware\n\
    \   SMTP client has three choices according to Section 3.2 of this\n   specification.\n\
    \   The three-digit reply-codes used in this section are based on their\n   meanings\
    \ as defined in RFC 5321.\n   When messages are rejected because the RCPT command\
    \ requires an ASCII\n   address, the reply-code 553 is returned with the meaning\
    \ \"mailbox\n   name not allowed\".  When messages are rejected because the MAIL\n\
    \   command requires an ASCII address, the reply-code 550 is returned\n   with\
    \ the meaning \"mailbox unavailable\".  When the SMTPUTF8-aware SMTP\n   server\
    \ supports enhanced mail system status codes [RFC3463], reply-\n   code \"X.6.7\"\
    \ [RFC5248] (see Section 4) is used, meaning \"Non-ASCII\n   addresses not permitted\
    \ for that sender/recipient\".\n   When messages are rejected for other reasons,\
    \ the server follows the\n   model of the base email specification in RFC 5321;\
    \ this extension\n   does not change those circumstances or reply messages.\n\
    \   If a message is rejected after the final \".\" of the DATA command\n   because\
    \ one or more recipients are unable to accept and process a\n   message with internationalized\
    \ email headers, the reply-code \"554\" is\n   used with the meaning \"Transaction\
    \ failed\".  If the SMTPUTF8-aware\n   SMTP server supports enhanced mail system\
    \ status codes [RFC3463],\n   reply code \"X.6.9\" [RFC5248] (see Section 4) is\
    \ used to indicate this\n   condition, meaning \"UTF-8 header message cannot be\
    \ transmitted to one\n   or more recipients, so the message must be rejected\"\
    .\n   The SMTPUTF8-aware SMTP servers are encouraged to detect that\n   recipients\
    \ cannot accept internationalized messages and generate an\n   error after the\
    \ RCPT command rather than waiting until after the DATA\n   command to issue an\
    \ error.\n"
- title: 3.6.  Body Parts and SMTP Extensions
  contents:
  - "3.6.  Body Parts and SMTP Extensions\n   The MAIL command parameter SMTPUTF8\
    \ asserts that a message is an\n   internationalized message or the message being\
    \ sent needs the\n   SMTPUTF8 support.  There is still a chance that a message\
    \ being sent\n   via the MAIL command with the SMTPUTF8 parameter is not an\n\
    \   internationalized message.  An SMTPUTF8-aware SMTP client or server\n   that\
    \ requires accurate knowledge of whether a message is\n   internationalized needs\
    \ to parse all message header fields and MIME\n   header fields [RFC2045] in the\
    \ message body.  However, this\n   specification does not require that the SMTPUTF8-aware\
    \ SMTP client or\n   server inspects the message.\n   Although this specification\
    \ requires that SMTPUTF8-aware SMTP servers\n   support the 8BITMIME extension\
    \ [RFC6152] to ensure that servers have\n   adequate handling capability for 8-bit\
    \ data, it does not require non-\n   ASCII body parts in the MIME message as specified\
    \ in RFC 2045.  The\n   SMTPUTF8 extension MAY be used as follows (assuming it\
    \ is appropriate\n   given the body content):\n   -  with the BODY=8BITMIME parameter\
    \ [RFC6152], or\n   -  with the BODY=BINARYMIME parameter, if the SMTP server\
    \ advertises\n      BINARYMIME [RFC3030].\n"
- title: 3.7.  Additional ESMTP Changes and Clarifications
  contents:
  - "3.7.  Additional ESMTP Changes and Clarifications\n   The information carried\
    \ in the mail transport process involves\n   addresses (\"mailboxes\") and domain\
    \ names in various contexts in\n   addition to the MAIL and RCPT commands and\
    \ extended alternatives to\n   them.  In general, the rule is that, when RFC 5321\
    \ specifies a\n   mailbox, this SMTP extension requires UTF-8 form to be used\
    \ for the\n   entire string.  When RFC 5321 specifies a domain name, the\n   internationalized\
    \ domain name SHOULD be in U-label form if the\n   SMTPUTF8 extension is supported;\
    \ otherwise, it SHOULD be in A-label\n   form.\n   The following subsections list\
    \ and discuss all of the relevant cases.\n"
- title: 3.7.1.  The Initial SMTP Exchange
  contents:
  - "3.7.1.  The Initial SMTP Exchange\n   When an SMTP connection is opened, the\
    \ SMTP server sends a \"greeting\"\n   response consisting of the 220 reply-code\
    \ and some information.  The\n   SMTP client then sends the EHLO command.  Since\
    \ the SMTP client\n   cannot know whether the SMTP server supports SMTPUTF8 until\
    \ after it\n   receives the response to the EHLO, the SMTPUTF8-aware SMTP client\n\
    \   MUST send only ASCII (LDH label or A-label [RFC5890]) domains in the\n   EHLO\
    \ command.  If the SMTPUTF8-aware SMTP server provides domain\n   names in the\
    \ EHLO response, they MUST be in the form of LDH labels or\n   A-labels.\n"
- title: 3.7.2.  Mail eXchangers
  contents:
  - "3.7.2.  Mail eXchangers\n   If multiple DNS MX records are used to specify multiple\
    \ servers for a\n   domain (as described in Section 5 of RFC 5321 [RFC5321]),\
    \ it is\n   strongly advised that all or none of them SHOULD support the SMTPUTF8\n\
    \   extension.  Otherwise, unexpected rejections can happen during\n   temporary\
    \ or permanent failures, which users might perceive as\n   serious reliability\
    \ issues.\n"
- title: 3.7.3.  Trace Information
  contents:
  - "3.7.3.  Trace Information\n   The trace information <Return-path-line>, <Time-stamp-line>,\
    \ and\n   their related rules are defined in Section 4.4 of RFC 5321 [RFC5321].\n\
    \   This document updates <Mailbox> and <Domain> to support non-ASCII\n   characters.\
    \  When the SMTPUTF8 extension is used, the 'Reverse-path'\n   clause of the Return-path-line\
    \ may include an internationalized\n   domain name that uses the U-label form.\
    \  Also, the 'Stamp' clause of\n   the Time-stamp-line may include an internationalized\
    \ domain name that\n   uses the U-label form.\n   If the messages that include\
    \ trace fields are sent by an SMTPUTF8-\n   aware SMTP client or relay server\
    \ without the SMTPUTF8 parameter\n   included in the MAIL commands, trace field\
    \ values must conform to RFC\n   5321 regardless of the SMTP server's capability.\n\
    \   When an SMTPUTF8-aware SMTP server adds a trace field to a message\n   that\
    \ was or will be transmitted with the SMTPUTF8 parameter included\n   in the MAIL\
    \ commands, that server SHOULD use the U-label form for\n   internationalized\
    \ domain names in the new trace field.\n   The protocol value of the 'WITH' clause\
    \ when this extension is used\n   is one of the SMTPUTF8 values specified in the\
    \ \"IANA Considerations\"\n   section of this document.\n"
- title: 3.7.4.  UTF-8 Strings in Replies
  contents:
  - '3.7.4.  UTF-8 Strings in Replies

    '
- title: 3.7.4.1.  MAIL Command
  contents:
  - "3.7.4.1.  MAIL Command\n   If an SMTP client follows this specification and sends\
    \ any MAIL\n   commands containing the SMTPUTF8 parameter, the SMTPUTF8-aware\
    \ SMTP\n   server is permitted to use UTF-8 characters in the email address\n\
    \   associated with 251 and 551 reply-codes, and the SMTP client MUST be\n   able\
    \ to accept and process them.  If a given MAIL command does not\n   include the\
    \ SMTPUTF8 parameter, the SMTPUTF8-aware SMTP server MUST\n   NOT return a 251\
    \ or 551 response containing a non-ASCII mailbox.\n   Instead, it MUST transform\
    \ such responses into 250 or 550 responses\n   that do not contain non-ASCII addresses.\n"
- title: 3.7.4.2.  VRFY and EXPN Commands and the SMTPUTF8 Parameter
  contents:
  - "3.7.4.2.  VRFY and EXPN Commands and the SMTPUTF8 Parameter\n   If the SMTPUTF8\
    \ parameter is transmitted with the VRFY and EXPN\n   commands, it indicates that\
    \ the SMTP client can accept UTF-8 strings\n   in replies to those commands. \
    \ The parameter with the VRFY and EXPN\n   commands SHOULD only be used after\
    \ the SMTP client sees the EHLO\n   response with the SMTPUTF8 keyword.  This\
    \ allows an SMTPUTF8-aware\n   SMTP server to use UTF-8 strings in mailbox names\
    \ and full names that\n   occur in replies, without concern that the SMTP client\
    \ might be\n   confused by them.  An SMTP client that conforms to this specification\n\
    \   MUST accept and correctly process replies to the VRFY and EXPN\n   commands\
    \ that contain UTF-8 strings.  However, an SMTPUTF8-aware SMTP\n   server MUST\
    \ NOT use UTF-8 strings in replies if the SMTP client does\n   not specifically\
    \ allow such replies by transmitting this parameter\n   with the VRFY and EXPN\
    \ commands.\n   Most replies do not require that a mailbox name be included in\
    \ the\n   returned text, and therefore a UTF-8 string is not needed in them.\n\
    \   Some replies, notably those resulting from successful execution of\n   the\
    \ VRFY and EXPN commands, do include the mailbox.\n   VERIFY (VRFY) and EXPAND\
    \ (EXPN) command syntaxes are changed to:\n   vrfy = \"VRFY\" SP String\n    \
    \ [ SP \"SMTPUTF8\" ] CRLF\n    ; String may include Non-ASCII characters\n  \
    \ expn = \"EXPN\" SP String\n     [ SP \"SMTPUTF8\" ] CRLF\n    ; String may include\
    \ Non-ASCII characters\n   The SMTPUTF8 parameter does not accept a value.  If\
    \ the reply to a\n   VRFY or EXPN command requires a UTF-8 string, but the SMTP\
    \ client did\n   not use the SMTPUTF8 parameter, then the SMTPUTF8-aware SMTP\
    \ server\n   MUST use either the reply-code 252 or 550.  Reply-code 252, defined\n\
    \   in RFC 5321 [RFC5321], means \"Cannot VRFY user, but will accept the\n   message\
    \ and attempt the delivery\".  Reply-code 550, also defined in\n   RFC 5321 [RFC5321],\
    \ means \"Requested action not taken: mailbox\n   unavailable\".  When the SMTPUTF8-aware\
    \ SMTP server supports enhanced\n   mail system status codes [RFC3463], the enhanced\
    \ reply-code as\n   specified below is used.  Using the SMTPUTF8 parameter with\
    \ a VRFY or\n   EXPN command enables UTF-8 replies for that command only.\n  \
    \ If a normal success response (i.e., 250) is returned, the response\n   MAY include\
    \ the full name of the user and MUST include the mailbox of\n   the user.  It\
    \ MUST be in either of the following forms:\n   User Name <Mailbox>\n    ; Mailbox\
    \ is defined in Section 3.3 of this document.\n    ; User Name can contain non-ASCII\
    \ characters.\n   Mailbox\n    ; Mailbox is defined in Section 3.3 of this document.\n\
    \   If the SMTP reply requires UTF-8 strings, but a UTF-8 string is not\n   allowed\
    \ in the reply, and the SMTPUTF8-aware SMTP server supports\n   enhanced mail\
    \ system status codes [RFC3463], the enhanced reply-code\n   is \"X.6.8\" [RFC5248]\
    \ (see Section 4), meaning \"A reply containing a\n   UTF-8 string is required\
    \ to show the mailbox name, but that form of\n   response is not permitted by\
    \ the SMTP client\".\n   If the SMTP client does not support the SMTPUTF8 extension,\
    \ but\n   receives a UTF-8 string in a reply, it may not be able to properly\n\
    \   report the reply to the user, and some clients might mishandle that\n   reply.\
    \  Internationalized messages in replies are only allowed in the\n   commands\
    \ under the situations described above.\n   Although UTF-8 strings are needed\
    \ to represent email addresses in\n   responses under the rules specified in this\
    \ section, this extension\n   does not permit the use of UTF-8 strings for any\
    \ other purposes.\n   SMTPUTF8-aware SMTP servers MUST NOT include non-ASCII characters\
    \ in\n   replies except in the limited cases specifically permitted in this\n\
    \   section.\n"
- title: 4.  IANA Considerations
  contents:
  - '4.  IANA Considerations

    '
- title: 4.1.  SMTP Service Extensions Registry
  contents:
  - "4.1.  SMTP Service Extensions Registry\n   IANA has added a new value \"SMTPUTF8\"\
    \ to the \"SMTP Service Extension\"\n   registry of the \"Mail Parameters\" registry,\
    \ according to the\n   following data:\n        +----------+---------------------------------+-----------+\n\
    \        | Keywords | Description                     | Reference |\n        +----------+---------------------------------+-----------+\n\
    \        | SMTPUTF8 | Internationalized email address | [RFC6531] |\n        +----------+---------------------------------+-----------+\n"
- title: 4.2.  SMTP Enhanced Status Code Registry
  contents:
  - "4.2.  SMTP Enhanced Status Code Registry\n   The code definitions in this document\
    \ replace those specified in RFC\n   5336, following the guidance in Sections\
    \ 3.5 and 3.7.4.2 of this\n   document, and based on RFC 5248 [RFC5248].  IANA\
    \ has updated the\n   \"Simple Mail Transfer Protocol (SMTP) Enhanced Status Code\
    \ Registry\"\n   with the following data:\n    Code:        X.6.7\n    Sample\
    \ Text: Non-ASCII addresses not permitted for that\n                 sender/recipient\n\
    \    Associated basic status code: 550, 553\n    Description: This indicates the\
    \ reception of a MAIL or RCPT command\n                 that non-ASCII addresses\
    \ are not permitted.\n    Defined:     RFC 6531 (Standards Track)\n    Submitter:\
    \   Jiankang YAO\n    Change controller: ima@ietf.org\n    Code:        X.6.8\n\
    \    Sample Text: UTF-8 string reply is required, but not permitted by\n     \
    \            the SMTP client\n    Associated basic status code: 252, 550, 553\n\
    \    Description: This indicates that a reply containing a UTF-8 string\n    \
    \             is required to show the mailbox name, but that form of\n       \
    \          response is not permitted by the SMTP client.\n    Defined:     RFC\
    \ 6531 (Standards Track)\n    Submitter:   Jiankang YAO\n    Change controller:\
    \ ima@ietf.org\n    Code:        X.6.9\n    Sample Text: UTF-8 header message\
    \ cannot be transferred to one or\n                 more recipients, so the message\
    \ must be rejected\n    Associated basic status code: 550\n    Description: This\
    \ indicates that transaction failed after the\n                 final \".\" of\
    \ the DATA command.\n    Defined:     RFC 6531 (Standards Track)\n    Submitter:\
    \   Jiankang YAO\n    Change controller: ima@ietf.org\n    Code:        X.6.10\n\
    \    Description: This is a duplicate of X.6.8 and is thus deprecated.\n"
- title: 4.3.  WITH Protocol Types Sub-Registry of the Mail Transmission Types
  contents:
  - "4.3.  WITH Protocol Types Sub-Registry of the Mail Transmission Types\n     \
    \ Registry\n   IANA has modified or added the following entries in the \"WITH\n\
    \   protocol types\" sub-registry under the \"Mail Transmission Types\"\n   registry.\n\
    \   +--------------+------------------------------+---------------------+\n  \
    \ | WITH         | Description                  | Reference           |\n   |\
    \ protocol     |                              |                     |\n   | types\
    \        |                              |                     |\n   +--------------+------------------------------+---------------------+\n\
    \   | UTF8SMTP     | ESMTP with SMTPUTF8          | [RFC6531]           |\n  \
    \ | UTF8SMTPA    | ESMTP with SMTPUTF8 and AUTH | [RFC4954] [RFC6531] |\n   |\
    \ UTF8SMTPS    | ESMTP with SMTPUTF8 and      | [RFC3207] [RFC6531] |\n   |  \
    \            | STARTTLS                     |                     |\n   | UTF8SMTPSA\
    \   | ESMTP with SMTPUTF8 and both | [RFC3207] [RFC4954] |\n   |             \
    \ | STARTTLS and AUTH            | [RFC6531]           |\n   | UTF8LMTP     |\
    \ LMTP with SMTPUTF8           | [RFC6531]           |\n   | UTF8LMTPA    | LMTP\
    \ with SMTPUTF8 and AUTH  | [RFC4954] [RFC6531] |\n   | UTF8LMTPS    | LMTP with\
    \ SMTPUTF8 and       | [RFC3207] [RFC6531] |\n   |              | STARTTLS   \
    \                  |                     |\n   | UTF8LMTPSA   | LMTP with SMTPUTF8\
    \ and both  | [RFC3207] [RFC4954] |\n   |              | STARTTLS and AUTH   \
    \         | [RFC6531]           |\n   +--------------+------------------------------+---------------------+\n"
- title: 5.  Security Considerations
  contents:
  - "5.  Security Considerations\n   The extended security considerations discussion\
    \ in the framework\n   document [RFC6530] applies here.\n   More security considerations\
    \ are discussed below:\n   Beyond the use inside the email global system (in SMTP\
    \ envelopes and\n   message headers), internationalized email addresses will also\
    \ show up\n   inside other cases, in particular:\n   o  the logging systems of\
    \ SMTP transactions and other logs to monitor\n      the email systems;\n   o\
    \  the trouble ticket systems used by security teams to manage\n      security\
    \ incidents, when an email address is involved;\n   In order to avoid problems\
    \ that could cause loss of data, this will\n   likely require extending these\
    \ systems to support full UTF-8, or\n   require providing an adequate mechanism\
    \ for mapping non-ASCII strings\n   to ASCII.\n   Another security aspect to be\
    \ considered is related to the ability by\n   security team members to quickly\
    \ understand, read, and identify email\n   addresses from the logs, when they\
    \ are tracking an incident.\n   Mechanisms to automatically and quickly provide\
    \ the origin or\n   ownership of an internationalized email address SHALL be implemented\n\
    \   for use by log readers that cannot easily read non-ASCII information.\n  \
    \ The SMTP commands VRFY and EXPN are sometimes used in SMTP\n   transactions\
    \ where there is no message to transfer (by tools used to\n   take automated actions\
    \ in case potential spam messages are\n   identified).  Sections 3.5 and 7.3 of\
    \ RFC 5321 give detailed\n   descriptions of use and possible behaviors.  Implementation\
    \ of\n   internationalized addresses can also affect logs and actions by these\n\
    \   tools.\n"
- title: 6.  Acknowledgements
  contents:
  - "6.  Acknowledgements\n   This document revises RFC 5336 [RFC5336] based on the\
    \ result of the\n   Email Address Internationalization (EAI) working group's discussion.\n\
    \   Many EAI working group members did tests and implementations to move\n   this\
    \ document to the Standards Track.  Significant comments and\n   suggestions were\
    \ received from Xiaodong LEE, Nai-Wen HSU, Yangwoo KO,\n   Yoshiro YONEYA, and\
    \ other members of JET and were incorporated into\n   the specification.  Additional\
    \ important comments and suggestions,\n   and often specific text, were contributed\
    \ by many members of the\n   working group and design team.  Those contributions\
    \ include material\n   from John C. Klensin, Charles Lindsey, Dave Crocker, Harald\
    \ Tveit\n   Alvestrand, Marcos Sanz, Chris Newman, Martin Duerst, Edmon Chung,\n\
    \   Tony Finch, Kari Hurtta, Randall Gellens, Frank Ellermann, Alexey\n   Melnikov,\
    \ Pete Resnick, S. Moonesamy, Soobok Lee, Shawn Steele,\n   Alfred Hoenes, Miguel\
    \ Garcia, Magnus Westerlund, Joseph Yee, and Lars\n   Eggert.  Of course, none\
    \ of the individuals are necessarily\n   responsible for the combination of ideas\
    \ represented here.\n   Thanks a lot to Dave Crocker for his comments and helping\
    \ with ABNF\n   refinement.\n"
- title: 7.  References
  contents:
  - '7.  References

    '
- title: 7.1.  Normative References
  contents:
  - "7.1.  Normative References\n   [ASCII]    American National Standards Institute\
    \  (formerly United\n              States of America Standards Institute), \"\
    USA Code for\n              Information Interchange\", ANSI X3.4-1968, 1968.\n\
    \   [RFC2119]  Bradner, S., \"Key words for use in RFCs to Indicate\n        \
    \      Requirement Levels\", BCP 14, RFC 2119, March 1997.\n   [RFC3461]  Moore,\
    \ K., \"Simple Mail Transfer Protocol (SMTP) Service\n              Extension\
    \ for Delivery Status Notifications (DSNs)\",\n              RFC 3461, January\
    \ 2003.\n   [RFC3463]  Vaudreuil, G., \"Enhanced Mail System Status Codes\",\n\
    \              RFC 3463, January 2003.\n   [RFC3464]  Moore, K. and G. Vaudreuil,\
    \ \"An Extensible Message Format\n              for Delivery Status Notifications\"\
    , RFC 3464,\n              January 2003.\n   [RFC3629]  Yergeau, F., \"UTF-8,\
    \ a transformation format of ISO\n              10646\", RFC 3629, November 2003.\n\
    \   [RFC3848]  Newman, C., \"ESMTP and LMTP Transmission Types\n             \
    \ Registration\", RFC 3848, July 2004.\n   [RFC5234]  Crocker, D. and P. Overell,\
    \ \"Augmented BNF for Syntax\n              Specifications: ABNF\", STD 68, RFC\
    \ 5234, January 2008.\n   [RFC5248]  Hansen, T. and J. Klensin, \"A Registry for\
    \ SMTP Enhanced\n              Mail System Status Codes\", RFC 5248, June 2008.\n\
    \   [RFC5321]  Klensin, J., \"Simple Mail Transfer Protocol\", RFC 5321,\n   \
    \           October 2008.\n   [RFC5322]  Resnick, P., Ed., \"Internet Message\
    \ Format\", RFC 5322,\n              October 2008.\n   [RFC5890]  Klensin, J.,\
    \ \"Internationalizing Domain Names in\n              Applications (IDNA definitions)\"\
    , RFC 5890, June 2010.\n   [RFC6152]  Klensin, J., Freed, N., Rose, M., and D.\
    \ Crocker, \"SMTP\n              Service Extension for 8-bit MIME Transport\"\
    , STD 71,\n              RFC 6152, March 2011.\n   [RFC6409]  Gellens, R. and\
    \ J. Klensin, \"Message Submission for Mail\",\n              STD 72, RFC 6409,\
    \ November 2011.\n   [RFC6530]  Klensin, J. and Y. Ko, \"Overview and Framework\
    \ for\n              Internationalized Email\", RFC 6530, February 2012.\n   [RFC6532]\
    \  Yang, A., Steele, S., and N. Freed, \"Internationalized\n              Email\
    \ Headers\", RFC 6532, February 2012.\n   [RFC6533]  Hansen, T., Ed., Newman,\
    \ C., and A. Melnikov, Ed.,\n              \"Internationalized Delivery Status\
    \ and Disposition\n              Notifications\", RFC RFC6533, February 2012.\n"
- title: 7.2.  Informative References
  contents:
  - "7.2.  Informative References\n   [RFC2033]  Myers, J., \"Local Mail Transfer\
    \ Protocol\", RFC 2033,\n              October 1996.\n   [RFC2045]  Freed, N.\
    \ and N. Borenstein, \"Multipurpose Internet Mail\n              Extensions (MIME)\
    \ Part One: Format of Internet Message\n              Bodies\", RFC 2045, November\
    \ 1996.\n   [RFC3030]  Vaudreuil, G., \"SMTP Service Extensions for Transmission\n\
    \              of Large and Binary MIME Messages\", RFC 3030,\n              December\
    \ 2000.\n   [RFC3207]  Hoffman, P., \"SMTP Service Extension for Secure SMTP over\n\
    \              Transport Layer Security\", RFC 3207, February 2002.\n   [RFC4954]\
    \  Siemborski, R. and A. Melnikov, \"SMTP Service Extension\n              for\
    \ Authentication\", RFC 4954, July 2007.\n   [RFC5336]  Yao, J. and W. Mao, \"\
    SMTP Extension for Internationalized\n              Email Addresses\", RFC 5336,\
    \ September 2008.\n   [RFC5598]  Crocker, D., \"Internet Mail Architecture\",\
    \ RFC 5598,\n              July 2009.\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Jiankang YAO\n   CNNIC\n   No.4 South 4th Street, Zhongguancun\n\
    \   Beijing\n   China\n   Phone: +86 10 58813007\n   EMail: yaojk@cnnic.cn\n \
    \  Wei MAO\n   CNNIC\n   No.4 South 4th Street, Zhongguancun\n   Beijing\n   China\n\
    \   Phone: +86 10 58812230\n   EMail: maowei_ietf@cnnic.cn\n"
