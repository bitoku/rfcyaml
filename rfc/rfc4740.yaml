- title: __initial_text__
  contents:
  - '         Diameter Session Initiation Protocol (SIP) Application

    '
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This document specifies an Internet standards track protocol\
    \ for the\n   Internet community, and requests discussion and suggestions for\n\
    \   improvements.  Please refer to the current edition of the \"Internet\n   Official\
    \ Protocol Standards\" (STD 1) for the standardization state\n   and status of\
    \ this protocol.  Distribution of this memo is unlimited.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (C) The IETF Trust (2006).\n"
- title: Abstract
  contents:
  - "Abstract\n   This document specifies the Diameter Session Initiation Protocol\n\
    \   (SIP) application.  This is a Diameter application that allows a\n   Diameter\
    \ client to request authentication and authorization\n   information.  This application\
    \ is designed to be used in conjunction\n   with SIP and provides a Diameter client\
    \ co-located with a SIP server,\n   with the ability to request the authentication\
    \ of users and\n   authorization of SIP resources usage from a Diameter server.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1. Introduction ....................................................4\n\
    \   2. Terminology .....................................................5\n  \
    \ 3. Definitions .....................................................5\n   4.\
    \ Acronyms ........................................................6\n   5. Applicability\
    \ Statement .........................................6\n   6. Overview of Operation\
    \ ...........................................7\n      6.1. General Architecture\
    \ .......................................7\n      6.2. Diameter Server Authenticates\
    \ the User .....................9\n      6.3. Delegating Final Authentication\
    \ Check to the SIP Server ...12\n      6.4. SIP Server Requests Authentication\
    \ and Authorization ......15\n      6.5. Locating the Recipient of the SIP Request\
    \ .................16\n      6.6. Update of the User Profile ................................17\n\
    \      6.7. SIP Soft State Termination ................................18\n  \
    \    6.8. Diameter Server Discovery .................................19\n   7.\
    \ Advertising Application Support ................................21\n   8. Diameter\
    \ SIP Application Command Codes .........................22\n      8.1. User-Authorization-Request\
    \ (UAR) Command ..................22\n      8.2. User-Authorization-Answer (UAA)\
    \ Command ...................23\n      8.3. Server-Assignment-Request (SAR) Command\
    \ ...................27\n      8.4. Server-Assignment-Answer (SAA) Command ....................29\n\
    \      8.5. Location-Info-Request (LIR) Command .......................33\n  \
    \    8.6. Location-Info-Answer (LIA) Command ........................33\n    \
    \  8.7. Multimedia-Auth-Request (MAR) Command .....................35\n      8.8.\
    \ Multimedia-Auth-Answer (MAA) Command ......................36\n      8.9. Registration-Termination-Request\
    \ (RTR) Command ............39\n      8.10. Registration-Termination-Answer (RTA)\
    \ Command ............39\n      8.11. Push-Profile-Request (PPR) Command .......................41\n\
    \      8.12. Push-Profile-Answer (PPA) Command ........................42\n  \
    \ 9. Diameter SIP Application AVPs ..................................44\n    \
    \  9.1. SIP-Accounting-Information AVP ............................46\n      \
    \     9.1.1. SIP-Accounting-Server-URI AVP ......................47\n        \
    \   9.1.2. SIP-Credit-Control-Server-URI AVP ..................47\n      9.2.\
    \ SIP-Server-URI AVP ........................................47\n      9.3. SIP-Server-Capabilities\
    \ AVP ...............................47\n           9.3.1. SIP-Mandatory-Capability\
    \ AVP .......................48\n           9.3.2. SIP-Optional-Capability AVP\
    \ ........................48\n      9.4. SIP-Server-Assignment-Type AVP ............................48\n\
    \      9.5. SIP-Auth-Data-Item AVP ....................................50\n  \
    \         9.5.1. SIP-Authentication-Scheme AVP ......................50\n    \
    \       9.5.2. SIP-Item-Number AVP ................................51\n      \
    \     9.5.3. SIP-Authenticate AVP ...............................51\n        \
    \   9.5.4. SIP-Authorization AVP ..............................52\n          \
    \ 9.5.5. SIP-Authentication-Info AVP ........................52\n           9.5.6.\
    \ Digest AVPs ........................................53\n      9.6. SIP-Number-Auth-Items\
    \ AVP .................................55\n      9.7. SIP-Deregistration-Reason\
    \ AVP .............................55\n           9.7.1. SIP-Reason-Code AVP ................................55\n\
    \           9.7.2. SIP-Reason-Info AVP ................................56\n  \
    \    9.8. SIP-AOR AVP ...............................................56\n    \
    \  9.9. SIP-Visited-Network-Id AVP ................................56\n      9.10.\
    \ SIP-User-Authorization-Type AVP ..........................56\n      9.11. SIP-Supported-User-Data-Type\
    \ AVP .........................57\n      9.12. SIP-User-Data AVP ........................................57\n\
    \           9.12.1. SIP-User-Data-Type AVP ............................58\n  \
    \         9.12.2. SIP-User-Data-Contents AVP ........................58\n    \
    \  9.13. SIP-User-Data-Already-Available AVP ......................58\n      9.14.\
    \ SIP-Method AVP ...........................................59\n   10. New Values\
    \ for Existing AVPs ..................................59\n      10.1. Extension\
    \ to the Result-Code AVP Values ..................59\n           10.1.1. Success\
    \ Result-Code AVP Values ....................59\n           10.1.2. Transient\
    \ Failures Result-Code AVP Values .........60\n           10.1.3. Permanent Failures\
    \ Result-Code AVP Values .........60\n   11. Authentication Details ........................................61\n\
    \   12. Migration from RADIUS .........................................63\n  \
    \    12.1. Gateway from RADIUS Client to Diameter Server ............63\n    \
    \  12.2. Gateway from Diameter Client to RADIUS Server ............63\n      12.3.\
    \ Known Limitations ........................................64\n   13. IANA Considerations\
    \ ...........................................64\n      13.1. Application Identifier\
    \ ...................................64\n      13.2. Command Codes ............................................65\n\
    \      13.3. AVP Codes ................................................65\n  \
    \    13.4. Additional Values for the Result-Code AVP Value ..........65\n    \
    \  13.5. Creation of the SIP-Server-Assignment-Type\n            Section in the\
    \ AAA .......................................66\n      13.6. Creation of the SIP-Authentication-Scheme\
    \ Section\n            in the AAA ...............................................66\n\
    \      13.7. Creation of the SIP-Reason-Code Section in the\n            AAA Registry\
    \ .............................................66\n      13.8. Creation of the\
    \ SIP-User-Authorization-Type\n            Section in the AAA .......................................66\n\
    \      13.9. Creation of the SIP-User-Data-Already-Available\n            Section\
    \ in the ...........................................66\n   14. Security Considerations\
    \ .......................................67\n      14.1. Final Authentication\
    \ Check in the Diameter\n            Client/SIP Server ........................................67\n\
    \   15. Contributors ..................................................68\n  \
    \ 16. Acknowledgements ..............................................68\n   17.\
    \ References ....................................................68\n      17.1.\
    \ Normative References .....................................68\n      17.2. Informative\
    \ References ...................................69\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   This document specifies the Diameter Session Initiation\
    \ Protocol\n   (SIP) application.  This is a Diameter application that allows\
    \ a\n   Diameter client to request authentication and authorization\n   information\
    \ to a Diameter server for SIP-based IP multimedia services\n   (see [RFC3261]\
    \ about SIP).  Furthermore, this Diameter SIP\n   application provides the Diameter\
    \ client with functions that go\n   beyond the typical authorization and authentication,\
    \ such as the\n   ability to download or receive updated user profiles, or rudimentary\n\
    \   routing functions that can assist a SIP server in finding another SIP\n  \
    \ server allocated to the user.\n   We assume that the SIP server (such as SIP\
    \ proxy server, registrar,\n   redirect server, or alike) and the Diameter client\
    \ are co-located in\n   the same node, so that the SIP server is able to receive\
    \ and process\n   SIP requests and responses.  In turn, the SIP server relies\
    \ on the\n   Authentication, Authorization, and Accounting (AAA) infrastructure\n\
    \   for authenticating the SIP request and authorizing the usage of\n   particular\
    \ SIP services.\n   This document provides Diameter procedures to implement certain\n\
    \   required functionality when SIP is the protocol chosen to initiate\n   and\
    \ tear down multimedia sessions or when SIP is used for other\n   non-session-related\
    \ applications.  However, this document does not\n   mandate any particular mapping\
    \ of SIP procedures to Diameter SIP\n   application procedures, nor does it mandate\
    \ any particular sequence\n   of events between SIP and Diameter.  This document\
    \ provides useful\n   examples to show the interaction between SIP and the Diameter\
    \ SIP\n   application in order to achieve the desired functionality.\n   This\
    \ application does not require and is not related to other\n   authentication\
    \ services provided by the Diameter Mobile IPv4\n   [RFC4004] or the Diameter\
    \ Network Access Server [RFC4005]\n   applications.\n   This Diameter SIP application\
    \ is loosely related to the Diameter\n   credit-control application [RFC4006].\
    \  Although both applications are\n   independent, the Diameter SIP application\
    \ is able to supply the\n   addresses of credit-control servers that will be implementing\
    \ the\n   Diameter credit-control application [RFC4006].\n   Section 5 discusses\
    \ assumptions and configurations assumed by this\n   document.\n   Section 6 provides\
    \ the reader with informative descriptions of the\n   Diameter SIP application\
    \ commands and responses and with some\n   guidance about their linkage with SIP\
    \ procedures.\n   Advertisement of this application is specified in Section 7.\n\
    \   Section 8 provides a normative description of all the new Diameter\n   commands\
    \ defined by this specification.\n   This application extends the Result-Code\
    \ Attribute-Value-Pair (AVP)\n   with some new values.  Further information is\
    \ described in\n   Section 10.\n   This application defines some new AVPs.  All\
    \ these AVPs are described\n   in Section 9.\n   Some extra information about\
    \ authentication is provided in\n   Section 11.\n"
- title: 2.  Terminology
  contents:
  - "2.  Terminology\n   In this document, the key words \"MUST\", \"MUST NOT\", \"\
    REQUIRED\",\n   \"SHALL\", \"SHALL NOT\", \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\"\
    , \"NOT\n   RECOMMENDED\", \"MAY\", and \"OPTIONAL\" are to be interpreted as\n\
    \   described in BCP 14, RFC 2119 [RFC2119] and indicate requirement\n   levels\
    \ for compliant implementations.\n"
- title: 3.  Definitions
  contents:
  - "3.  Definitions\n   For the purpose of this document, the following terms and\
    \ definitions\n   apply:\n   Node:  an addressable device attached to a computer\
    \ network that\n      implements SIP functionality, Diameter functionality, or\
    \ a\n      combination of both.\n   For the purpose of this document, the following\
    \ terms and definitions\n   given in RFC 3261 [RFC3261] Section 6, apply:\n  \
    \ o  Address-of-Record (AOR)\n   o  Outbound proxy\n   o  Proxy\n   o  Registrar\n\
    \   o  Server (SIP server)\n   o  User Agent (UA)\n   o  User Agent Client (UAC)\n\
    \   o  User Agent Server (UAS)\n   For the purpose of this document, the following\
    \ terms and definitions\n   given in RFC 3588 [RFC3588] Section 1.3, apply:\n\
    \   o  Authorization\n   o  Authentication\n   o  Attribute-Value Pair (AVP)\n\
    \   o  Diameter Client\n   o  Diameter Server\n   o  Home Realm\n   o  Redirect\
    \ Agent\n   o  User\n"
- title: 4.  Acronyms
  contents:
  - "4.  Acronyms\n   AKA:  Authentication and Key Agreement\n   LIR:  Location-Info-Request\n\
    \   LIA:  Location-Info-Answer\n   MAR:  Multimedia-Auth-Request\n   MAA:  Multimedia-Auth-Answer\n\
    \   PPR:  Push-Profile-Request\n   PPA:  Push-Profile-Answer\n   RTR:  Registration-Termination-Request\n\
    \   RTA:  Registration-Termination-Answer\n   SAR:  Server-Assignment-Request\n\
    \   SAA:  Server-Assignment-Answer\n   SL:   Subscriber Locator\n   UAR:  User-Authorization-Request\n\
    \   UAA:  User-Authorization-Answer\n"
- title: 5.  Applicability Statement
  contents:
  - "5.  Applicability Statement\n   This document assumes a general architecture\
    \ where a Home Realm is\n   composed of one or more nodes implementing Diameter\
    \ or SIP functions.\n   Users are issuing SIP requests to access SIP resources.\
    \  For each\n   particular user, the Home Realm needs to authenticate and authorize\n\
    \   the usage of those resources and/or the route to the appropriate\n   node.\
    \  We assume that the database containing the user-related data\n   is located\
    \ outside the SIP node that requires authorization.  Data\n   belonging to different\
    \ users may be stored in different nodes in the\n   Home Realm, but we assume\
    \ that all the data related to a particular\n   user is stored in a single node.\n\
    \      Note: Central to the architecture is the fact that the user data\n    \
    \  is stored in a single point in the network.  This restriction does\n      not\
    \ mandate a particular implementation, e.g., it is possible to\n      implement\
    \ clusters of databases operating in mirror mode to\n      provide redundancy.\
    \  The property required by this specification\n      is that the user data the\
    \ Diameter server has access to is stored\n      safely in what is seen, from\
    \ the external point of view, as a\n      single user database.\n   This document\
    \ allows several configurations of the Home Realm.  In\n   one configuration,\
    \ a SIP server (proxy, registrar, etc.) is allocated\n   to a user for the purpose\
    \ of triggering and executing services.  The\n   allocation of the SIP server\
    \ may be done dynamically, e.g., at the\n   time the user registers in the network.\
    \  This configuration requires\n   a SIP server, typically located at the edge\
    \ of the network, that is\n   able to allocate another SIP server for the user\
    \ and that also\n   supports routing of SIP requests and responses towards that\
    \ allocated\n   SIP server.  Both SIP server nodes implement a Diameter client.\n\
    \   In another configuration, the address of a SIP outbound proxy is\n   configured\
    \ (by means outside the scope of this specification) into\n   the SIP User Agent.\
    \  The outbound Diameter client in the SIP outbound\n   proxy node authenticates\
    \ the user, requests authorization for SIP\n   requests, and performs accounting\
    \ activities.\n"
- title: 6.  Overview of Operation
  contents:
  - "6.  Overview of Operation\n   This section provides an informative description\
    \ of how the Diameter\n   SIP application can be used together with SIP.  This\
    \ section is not\n   intended to mandate any specific usage of the Diameter SIP\n\
    \   application nor does it mandate a specific mapping between SIP and\n   Diameter\
    \ messages.  We provide a collection of examples that show how\n   the required\
    \ AAA functionality can be achieved in conjunction with\n   SIP.\n"
- title: 6.1.  General Architecture
  contents:
  - "6.1.  General Architecture\n   The Diameter SIP application can be used in a\
    \ SIP environment where\n   an interface to a AAA infrastructure is required to\
    \ authenticate and\n   authorize the usage of SIP resources.  This application\
    \ provides\n   support for SIP User Agents and proxies that implement and use\
    \ HTTP\n   Digest authentication [RFC2617], which is the authentication\n   mechanism\
    \ mandated by SIP [RFC3261].  The application is extensible\n   and, if need arises,\
    \ it can be extended to provide support for other\n   authentication mechanisms\
    \ or extensions to HTTP Digest authentication\n   when they occur.\n   This application\
    \ provides limited support for accounting services as\n   follows: the Diameter\
    \ server is able to provide the addresses of\n   accounting severs to the Diameter\
    \ client.  Figure 1, below, shows a\n   general overview of the integration of\
    \ the SIP architecture with the\n   AAA architecture.\n   According to Figure\
    \ 1, there are one or more SIP User Agents (UAs)\n   that initiate or terminate\
    \ SIP traffic through one or more SIP\n   servers.  Both SIP servers implement\
    \ a Diameter client that supports\n   the Diameter application described in this\
    \ specification.\n                               +--------+\n                \
    \  UAR/UAA +--->|Diameter|<----+ PPR/PPA\n                  LIR/LIA |    | server\
    \ |     | MAR/MAA\n                          |    +--------+     | SAR/SAA\n \
    \                         |                   | RTR/RTA\n                    \
    \      |                   |\n                          v                   v\n\
    \   +------+   SIP     +--------+    SIP   +--------+   SIP     +------+\n   |\
    \ SIP  |<--------->|  SIP   |<-------->|  SIP   |<--------->| SIP  |\n   |  UA\
    \  |           |server 1|          |server 2|           |  UA  |\n   +------+\
    \           +--------+          +--------+           +------+\n              \
    \            ^                   ^\n                  UAR/UAA |              \
    \     |\n                  LIR/LIA |                   | MAR/MAA\n           \
    \               |    +--------+     | SAR/SAA\n                          +--->|Diameter|<----+\n\
    \                               |   SL   |\n                               +--------+\n\
    \        Figure 1: Architecture of the Diameter application for SIP\n   In Figure\
    \ 1, it can be seen that SIP server 1 sends different\n   Diameter commands and\
    \ receives different responses than those sent\n   and received by SIP server\
    \ 2.  This is because SIP server 1 in\n   Figure 1 is located at the edge of a\
    \ network, and its main task is to\n   locate SIP server 2.  SIP server 2 is requesting\
    \ and receiving\n   authentication and authorization data from the Diameter server\
    \ and is\n   not located at the edge of the network.\n   This Diameter application\
    \ assumes that all the data pertaining to a\n   given user is stored in a single\
    \ Diameter server.  For redundancy\n   purposes, several Diameter servers can\
    \ be configured in a redundancy\n   fashion, in which case all of them keep the\
    \ data synchronized and\n   operate externally as a single Diameter server.\n\
    \   With respect to SIP server 1 in Figure 1, the Diameter SIP\n   application\
    \ provides support for the existence of a farm of these\n   servers, typically\
    \ configured through one or more DNS records that\n   point to several hosts (this\
    \ is a typical configuration in common SIP\n   deployments).  There is no requirement\
    \ for these types of servers to\n   keep state related to the Diameter SIP application.\n\
    \   The Diameter SIP application provides support for a feature that\n   allows\
    \ an administrative domain to provide a collection of SIP\n   servers 2 (as per\
    \ Figure 1).  Once the user registers for the first\n   time, one of these SIP\
    \ servers is selected and all the SIP requests\n   related to the user are processed\
    \ by the same SIP server.\n   The Diameter Subscriber Locator (SL) serves the\
    \ purpose of locating\n   the Diameter server that contains the user-related data.\
    \  Its\n   functionality is based on the Diameter redirect mechanism and is\n\
    \   further described in Section 6.8.\n   It should be noted that this document\
    \ does not mandate any particular\n   SIP/AAA architecture.  However, the Diameter\
    \ SIP application provides\n   the functionality needed to accommodate all the\
    \ different\n   architectures where SIP and Diameter are used.\n   The following\
    \ subsections provide an informative overview of the\n   Diameter SIP application,\
    \ its commands, and a possible interaction\n   with SIP signaling.\n"
- title: 6.2.  Diameter Server Authenticates the User
  contents:
  - "6.2.  Diameter Server Authenticates the User\n   This is the generic mechanism\
    \ to authenticate users.  In this\n   approach, we show an example of an administrative\
    \ network where the\n   Diameter server is authenticating SIP user requests. \
    \ This could be\n   the case of a medium-size network where the Diameter server\
    \ is\n   keeping user records and authenticating SIP requests to perform a\n \
    \  certain transaction.  We have chosen to show a SIP REGISTER request\n   in\
    \ the example, but the SIP server could request authentication of\n   any other\
    \ SIP request.\n                    +--------+           +--------+         +--------+\n\
    \                    |  SIP   |           |Diameter|         |  SIP   |\n    \
    \                |server 1|           | server |         |server 2|\n        \
    \            +--------+           +--------+         +--------+\n            \
    \             |                   |                   |\n    1. SIP REGISTER \
    \     |                   |                   |\n    -------------------->|  \
    \   2. UAR        |                   |\n                         |------------------>|\
    \                   |\n                         |     3. UAA        |        \
    \           |\n                         |<------------------|                \
    \   |\n                         |         4. SIP REGISTER               |\n  \
    \                       |-------------------------------------->|\n          \
    \               |                   |      5. MAR       |\n                  \
    \       |                   |<------------------|\n                         |\
    \                   |      6. MAA       |\n                         |        \
    \           |------------------>|\n                         |         7. SIP 401\
    \ (Unauthorized)     |\n    8. SIP 401 (Unauth.) |<--------------------------------------|\n\
    \    <--------------------|                   |                   |\n    9. SIP\
    \ REGISTER      |                   |                   |\n    -------------------->|\
    \     10. UAR       |                   |\n                         |------------------>|\
    \                   |\n                         |     11. UAA       |        \
    \           |\n                         |<------------------|                \
    \   |\n                         |         12. SIP REGISTER              |\n  \
    \                       |-------------------------------------->|\n          \
    \               |                   |      13. MAR      |\n                  \
    \       |                   |<------------------|\n                         |\
    \                   |      14. MAA      |\n                         |        \
    \           |------------------>|\n                         |         15. SIP\
    \ 200 (OK)              |\n    16. SIP 200 (OK)     |<--------------------------------------|\n\
    \    <--------------------|                   |                   |\n        \
    \                 |                   |      17. SAR      |\n                \
    \         |                   |<------------------|\n                        \
    \ |                   |      18. SAA      |\n                         |      \
    \             |------------------>|\n                         |              \
    \     |                   |\n         Figure 2: Authentication performed in the\
    \ Diameter server\n   According to Figure 2, a SIP User Agent Client (UAC) sends\
    \ a SIP\n   REGISTER request (step 1) to SIP server 1, which receives the SIP\n\
    \   request.  In Figure 2, we assume that this SIP server is located at\n   the\
    \ edge of the administrative home domain.  The Diameter client in\n   SIP server\
    \ 1 contacts its Diameter server by sending a Diameter\n   User-Authorization-Request\
    \ (UAR) message (step 2) to determine if\n   this user is allowed to receive service,\
    \ and if so, request the\n   address of a local SIP server capable of handling\
    \ this user.  The\n   Diameter server answers with a Diameter User-Authorization-Answer\n\
    \   (UAA) message (step 3), which indicates a list of capabilities that\n   SIP\
    \ server 1 may use to select an appropriate SIP server (SIP server\n   2) and/or\
    \ a SIP or SIPS URI pointing to SIP server 2.\n   SIP server 1 forwards the SIP\
    \ REGISTER request (step 4) to an\n   appropriate SIP server (SIP server 2). \
    \ Then the Diameter client in\n   SIP server 2 requests user authentication from\
    \ the Diameter server by\n   sending a Diameter Multimedia-Auth-Request (MAR)\
    \ message (step 5).\n   This request also serves to make the Diameter server aware\
    \ of the SIP\n   or SIPS URI of SIP server 2, so as to return subsequent requests\
    \ for\n   the same user to the same SIP server 2.  The Diameter server responds\n\
    \   with a Diameter Multimedia-Auth-Answer (MAA) message (step 6) with\n   Result-Code\
    \ AVP set to the value DIAMETER_MULTI_ROUND_AUTH.  The\n   Diameter server also\
    \ generates a nonce and includes a challenge in\n   the MAA message.  SIP server\
    \ 2 uses that challenge to map into the\n   WWW-Authenticate header in the SIP\
    \ 401 (Unauthorized) response (step\n   7), which is sent back to SIP server 1\
    \ and then to the SIP UAC (step\n   8).\n   SIP server 1 receives a next SIP REGISTER\
    \ request containing the user\n   credentials (step 9).  Note that SIP server\
    \ 1 does not need to keep a\n   state, and even more, there is no guarantee that\
    \ the SIP request\n   arrives at the same SIP server 1; there could be a farm\
    \ of SIP\n   servers 1 operating in redundant configuration.  The Diameter client\n\
    \   in SIP server 1 contacts the Diameter server by sending a Diameter\n   UAR\
    \ message (step 10) to determine the SIP server allocated to the\n   user.  The\
    \ Diameter server sends the SIP or SIPS URI of SIP server 2\n   in a Diameter\
    \ UAA message (step 11).\n   Then SIP server 1 forwards the SIP REGISTER request\
    \ to SIP server 2\n   (step 12).  SIP server 2 extracts the credentials from the\
    \ SIP\n   REGISTER request.  The Diameter client in SIP server 2 sends those\n\
    \   credentials in a Diameter MAR message (step 13) to the Diameter\n   server.\
    \  At this point, the Diameter server is able to authenticate\n   the user, and\
    \ upon success, returns a Diameter MAA message (step 14)\n   with the AVP Result-Code\
    \ set to the value DIAMETER_SUCCESS.\n   Then SIP server 2 generates a SIP 200\
    \ (OK) response (step 15), which\n   is forwarded to SIP server 1 and eventually\
    \ to the SIP UAC (step 16).\n   If the Diameter client in SIP server 2 is interested\
    \ in downloading\n   the user profile information or is required to store the\
    \ address of\n   the SIP server in the Diameter server, then the Diameter client\
    \ sends\n   a Diameter SAR message (step 17) to the Diameter server.  The\n  \
    \ Diameter server replies with a Diameter SAA message (step 18) that\n   contains\
    \ the requested user profile information and the\n   acknowledgement of the SIP\
    \ server address storage.  These actions are\n   needed when the SIP server has\
    \ to retrieve a user profile used to\n   provide services to the served user,\
    \ or when the SIP server keeps a\n   state for the user, so the Diameter server\
    \ needs to store the SIP\n   server's address.\n"
- title: 6.3.  Delegating Final Authentication Check to the SIP Server
  contents:
  - "6.3.  Delegating Final Authentication Check to the SIP Server\n   An operator\
    \ with a large base of installed SIP servers may wish to\n   minimize the number\
    \ of round-trips between the Diameter client and\n   the Diameter server.  We\
    \ provide support for a mechanism where the\n   Diameter server delegates the\
    \ final authentication check to the SIP\n   server, thereby saving a round-trip.\
    \  Section 14.1 discusses the\n   security considerations of this scenario.\n\
    \   It must noted that this scenario is not applicable when the Diameter\n   server\
    \ is configured to use a session MD5 (MD5-sess) algorithm,\n   because the Diameter\
    \ server requires the client nonce to compute the\n   H(A1) before sending it\
    \ to the Diameter client.  However, the client\n   nonce might not be available\
    \ at that time.\n                    +--------+           +--------+         +--------+\n\
    \                    |  SIP   |           |Diameter|         |  SIP   |\n    \
    \                |server 1|           | server |         |server 2|\n        \
    \            +--------+           +--------+         +--------+\n            \
    \             |                   |                   |\n    1. SIP REGISTER \
    \     |                   |                   |\n    -------------------->|  \
    \   2. UAR        |                   |\n                         |------------------>|\
    \                   |\n                         |     3. UAA        |        \
    \           |\n                         |<------------------|                \
    \   |\n                         |         4. SIP REGISTER               |\n  \
    \                       |-------------------------------------->|\n          \
    \               |                   |      5. MAR       |\n                  \
    \       |                   |<------------------|\n                         |\
    \                   |      6. MAA       |\n                         |        \
    \           |------------------>|\n                         |         7. SIP 401\
    \ (Unauthorized)     |\n    8. SIP 401 (Unauth.) |<--------------------------------------|\n\
    \    <--------------------|                   |                   |\n    9. SIP\
    \ REGISTER      |                   |                   |\n    -------------------->|\
    \     10. UAR       |                   |\n                         |------------------>|\
    \                   |\n                         |     11. UAA       |        \
    \           |\n                         |<------------------|                \
    \   |\n                         |         12. SIP REGISTER              |\n  \
    \                       |-------------------------------------->|\n          \
    \               |                   |      13. SAR      |\n                  \
    \       |                   |<------------------|\n                         |\
    \                   |      14. SAA      |\n                         |        \
    \           |------------------>|\n                         |         15. SIP\
    \ 200 (OK)              |\n    16. SIP 200 (OK)     |<--------------------------------------|\n\
    \    <--------------------|                   |                   |\n        \
    \                 |                   |                   |\n         Figure 3:\
    \ Delegation of authentication to the SIP server\n   Figure 3 shows an example\
    \ where a SIP server is dynamically allocated\n   to serve a SIP User Agent with\
    \ the support of the Diameter server.\n   This may be the case of certain architectures,\
    \ such as that of the\n   3rd Generation Partnership Project (3GPP) IP Multimedia\
    \ Core Network\n   Subsystem.\n   A first SIP server receives a SIP REGISTER request\
    \ (step 1) whose\n   target is the home network domain.  In Figure 3, we assume\
    \ that this\n   SIP server is located at the edge of the administrative home domain.\n\
    \   The Diameter client in this SIP server requests authorization from\n   the\
    \ Diameter server to proceed with the registration, by sending a\n   Diameter\
    \ User-Authorization-Request (UAR) message (step 2).  The\n   message includes,\
    \ among other Attribute-Value-Pairs (AVPs), the SIP\n   Address-Of-Record (AOR)\
    \ that is included in the SIP REGISTER request.\n   The Diameter server verifies\
    \ the SIP AOR and, if it is a valid\n   defined user in the home network, authorizes\
    \ the registration to\n   proceed.  The Diameter server responds with a Diameter\n\
    \   User-Authorization-Answer (UAA) message (step 3), which informs the\n   Diameter\
    \ client/SIP server about the result of the user\n   authorization.  In case of\
    \ a successful authorization, the Diameter\n   UAA message indicates the address\
    \ of a local SIP server (SIP server 2\n   in Figure 3) and/or a list of capabilities\
    \ that SIP server 1 may use\n   to select an appropriate SIP server 2.\n   When\
    \ the authorization is successful, SIP server 1 forwards the SIP\n   REGISTER\
    \ request (step 4) to the appropriate SIP server (SIP server\n   2).  The Diameter\
    \ client in SIP server 2 requests authentication\n   parameters by sending a Diameter\
    \ Multimedia-Auth-Request (MAR)\n   message (step 5) to the Diameter server. \
    \ This request also makes the\n   Diameter server aware of the SIP or SIPS URI\
    \ of SIP server 2, so as\n   to return subsequent requests of the same user to\
    \ the same SIP server\n   2.  The Diameter server responds with a Diameter\n \
    \  Multimedia-Auth-Answer (MAA) message (step 6), which includes a nonce\n   and\
    \ all the rest of the parameters necessary for the designated\n   authentication\
    \ algorithm associated with the user.  Among others, the\n   MAA message includes\
    \ a Digest-HA1 AVP that contains H(A1) (as defined\n   in RFC 2617 [RFC2617]),\
    \ and that allows the Diameter client to\n   calculate the expected response.\
    \  Then the Diameter client can\n   compare this expected response with the response\
    \ to the challenge\n   sent from the SIP UA.  The absence of the Digest-HA1 AVP\
    \ in MAA\n   indicates that authentication and authorization take place in the\n\
    \   Diameter server, as per the scenario described in Section 6.2.\n   SIP server\
    \ 2 creates a SIP 401 (Unauthorized) SIP response (step 7)\n   based on the challenge\
    \ included in the MAA message, including the\n   authentication material needed\
    \ by the SIP User Agent Client (UAC) to\n   include the appropriate credentials.\
    \  SIP server 1 forwards the SIP\n   response to the SIP UAC (step 8).\n   The\
    \ SIP server 1 receives the next SIP REGISTER request containing\n   the user\
    \ credentials (step 9).  Because SIP server 1 does not need to\n   keep a state\
    \ (and there is no guarantee that the SIP request arrives\n   to the same SIP\
    \ server 1), the Diameter client in SIP server 1\n   contacts the Diameter server\
    \ again by sending a Diameter UAR message\n   (step 10) to determine the SIP server\
    \ allocated to the user.  The\n   Diameter server sends the SIP or SIPS URI of\
    \ SIP server 2 in a\n   Diameter UAA message (step 11).\n   SIP server 1 forwards\
    \ the SIP REGISTER request to SIP server 2 (step\n   12).  SIP server 2 validates\
    \ the credentials by comparing the\n   response supplied by the SIP UA with the\
    \ expected response calculated\n   by the SIP server 2 (based on the H(A1) received\
    \ from the Diameter\n   server).\n   If the credentials are valid, SIP server\
    \ 2 sends a Diameter\n   Server-Assignment-Request (SAR) message (step 13) requesting\
    \ the\n   Diameter server to confirm the completion of the authentication\n  \
    \ procedure and to confirm the SIP or SIPS URI of the SIP server that\n   is currently\
    \ serving the user.  The Diameter SAR message also serves\n   the purpose of requesting\
    \ that the Diameter server send the user\n   profile to the SIP server.  The Diameter\
    \ server responds with a\n   Diameter Server-Assignment-Answer (SAA) message (step\
    \ 14).  If the\n   Result-Code AVP value does not inform SIP Server 2 of an error,\
    \ the\n   SAA message can include zero or more SIP-User-Data AVPs containing\n\
    \   the information that SIP server 2 needs in order to provide a service\n  \
    \ to the user.\n   SIP server 2 generates a SIP 200 (OK) response (step 15), which\
    \ is\n   forwarded to SIP server 1 and eventually to the SIP UAC (step 16).\n"
- title: 6.4.  SIP Server Requests Authentication and Authorization
  contents:
  - "6.4.  SIP Server Requests Authentication and Authorization\n   Figure 4 depicts\
    \ a typical scenario where a stateless SIP proxy\n   requests authentication information\
    \ and authorization to a Diameter\n   server, for the purpose of providing SIP\
    \ routing services to a SIP\n   User Agent.  The SIP proxy server may be configured\
    \ as an outbound\n   SIP proxy, so that all the requests initiated by the SIP\
    \ UA traverse\n   the SIP proxy.\n   According to Figure 4, a SIP User Agent sends\
    \ a SIP request to its\n   outbound SIP proxy server.  In this case, the message\
    \ is a SIP INVITE\n   request (see step 1), but it could be any other SIP request.\
    \  We\n   assume that this SIP request does not contain any credentials at this\n\
    \   time.  The outbound SIP proxy server needs to authenticate and\n   authorize\
    \ the proxy services offered to the user.  The Diameter\n   client in the SIP\
    \ server sends a Multimedia-Auth-Request (MAR)\n   message (step 2).  The Diameter\
    \ server generates a nonce and sends a\n   Multimedia-Auth-Answer (MAA) message\
    \ (step 3) that includes the nonce\n   and the rest of the data necessary for\
    \ the SIP server to challenge\n   the user, typically with HTTP Digest Authentication\
    \ indicated in the\n   MAA message.  This data enables the SIP server to create\
    \ a SIP 407\n   (Proxy Authentication Required) response (step 4) that contains\
    \ a\n   challenge.  The SIP UA creates a new INVITE request (step 5) that\n  \
    \ contains the credentials.  The Diameter client in the SIP server\n   sends the\
    \ credentials to the Diameter server in a new Diameter MAR\n   message (step 6).\
    \  The Diameter server validates the credentials and\n   authorize the SIP transaction\
    \ in a Diameter MAA message (step 7).\n   The SIP server forwards the SIP INVITE\
    \ request to its destination\n   (step 8) as per regular SIP procedures.  Eventually,\
    \ the session\n   setup is confirmed with a SIP 200 (OK) response (step 9) that\
    \ is\n   forwarded to the SIP UA (step 10).  The session setup is complete.\n\
    \                +--------+         +--------+\n                |Diameter|   \
    \      |  SIP   |\n                | server |         | server |\n           \
    \     +--------+         +--------+\n                    |                   |\n\
    \                    |                   |\n             1. SIP INVITE       \
    \       |\n    ----------------------------------->|\n                    |  \
    \    2. MAR       |\n                    |<------------------|\n             \
    \       |      3. MAA       |\n                    |------------------>|\n   \
    \                 |                   |\n             4. SIP 407 (Proxy      \
    \    |\n         Authentication Required)       |\n    <-----------------------------------|\n\
    \                    |                   |\n             5. SIP INVITE       \
    \       |\n    ----------------------------------->|\n                    |  \
    \    6. MAR       |\n                    |<------------------|\n             \
    \       |      7. MAA       |\n                    |------------------>| 8. SIP\
    \ INVITE\n                    |                   |---------------->\n       \
    \             |                   | 9. SIP 200 (OK)\n             10. SIP 200\
    \ (OK)           |<----------------\n    <-----------------------------------|\n\
    \                    |                   |\n                Figure 4: SIP server\
    \ requests authorization\n"
- title: 6.5.  Locating the Recipient of the SIP Request
  contents:
  - "6.5.  Locating the Recipient of the SIP Request\n   Figure 5 shows the scenario\
    \ where SIP server 1 may be configured as a\n   SIP edge proxy server, processing\
    \ SIP traffic at the edge of a\n   network.  SIP server 1 receives a SIP INVITE\
    \ request (step 1).  SIP\n   server 1 needs to find the address of SIP server\
    \ 2, which is serving\n   the recipient of the SIP request.  The Diameter client\
    \ in SIP server\n   1 sends a Diameter Location-Info-Request (LIR) message (step\
    \ 2) to\n   the Diameter server.  The Diameter server responds with a Diameter\n\
    \   Location-Info-Answer (LIA) message (step 3) that contains the SIP or\n   SIPS\
    \ URI of SIP server 2.  SIP server 1 then forwards the SIP INVITE\n   to SIP server\
    \ 2 (step 4).  SIP server 2 eventually forwards the SIP\n   INVITE to the appropriate\
    \ UAS (step 5).\n             +--------+         +--------+      +--------+\n\
    \             |  SIP   |         |Diameter|      |  SIP   |\n             |server\
    \ 1|         | server |      |server 2|\n             +--------+         +--------+\
    \      +--------+\n                  |                 |                |\n  \
    \ 1. SIP INVITE  |                 |                |\n   -------------->|   \
    \  2. LIR      |                |\n                  |---------------->|     \
    \           |\n                  |     3. LIA      |                |\n      \
    \            |<----------------|                |\n                  |       \
    \  4. SIP INVITE            |\n                  |--------------------------------->|\n\
    \                  |                 |                | 5. SIP INVITE\n      \
    \            |                 |                |-------------->\n           \
    \       |                 |                |\n                  |            \
    \     |                |\n            Figure 5: Locating the SIP server of the\
    \ recipient\n   Although the example shows the connection between a SIP INVITE\n\
    \   request and the Diameter LIR message, any SIP request other than\n   REGISTER\
    \ (such as SUBSCRIBE, OPTIONS, etc.) would trigger the same\n   Diameter message.\
    \  (A SIP REGISTER request will trigger a Diameter\n   UAR message, as indicated\
    \ in Figure 2 and Figure 3.)\n   The scenario described in this section is also\
    \ applicable in case an\n   outbound SIP server is not interested in authenticating\
    \ the user, but\n   is required to locate a further SIP server to route the outbound\
    \ SIP\n   requests.  In this case, the outbound SIP server is mapped to SIP\n\
    \   server 1 as shown in Figure 5.\n"
- title: 6.6.  Update of the User Profile
  contents:
  - "6.6.  Update of the User Profile\n   The Diameter SIP application provides a\
    \ mechanism for a Diameter\n   server to asynchronously download a user profile\
    \ to a SIP server\n   whenever there is an update of such user profile.  It must\
    \ be noted\n   that the Diameter server also attaches the user profile to the\n\
    \   Diameter Server-Assignment-Answer (SAA) message.  This is valid for\n   most\
    \ of the daily situations; however, the administrator may decide\n   to update\
    \ or modify the user profile for a particular user, due to,\n   e.g., new services\
    \ made available to the user.  This may involve\n   mechanisms outside the scope\
    \ of this specification, such as human\n   intervention, in the Diameter server.\
    \  In this situation, the\n   Diameter server is able to push the new user profile\
    \ into the SIP\n   server allocated to the user.\n   The scenario is illustrated\
    \ in Figure 6.  When the user profile\n   changes, the Diameter server sends a\
    \ Diameter Push-Profile-Request\n   (PPR) message (step 1) to the Diameter client\
    \ in the SIP server\n   allocated to that user (SIP server 2 in the examples).\
    \  The Diameter\n   PPR message contains one or more SIP-User-Data AVPs, a User-Name\
    \ AVP\n   and zero or more SIP-AOR AVPs.  The Diameter client in SIP server 2\n\
    \   acknowledges the Diameter PPR message by sending a Diameter\n   Push-Profile-Answer\
    \ (PPA) message (step 2) to the Diameter server.\n                   +--------+\
    \          +--------+\n                   |Diameter|          |  SIP   |\n   \
    \                | server |          |server 2|\n                   +--------+\
    \          +--------+\n                       |                   |\n        \
    \               |     1. PPR        |\n                       |------------------>|\n\
    \                       |                   |\n                       |     2.\
    \ PPA        |\n                       |<------------------|\n               \
    \        |                   |\n      Figure 6: Diameter server pushes an update\
    \ of the user profile\n"
- title: 6.7.  SIP Soft State Termination
  contents:
  - "6.7.  SIP Soft State Termination\n   SIP can create soft states in SIP nodes\
    \ based on events such as SIP\n   registrations or SIP event subscriptions.  These\
    \ states are\n   periodically refreshed, and cease to exist if they are not refreshed.\n\
    \   Additionally, an administrative action can be taken to terminate a\n   SIP\
    \ soft state, or the SIP UA can explicitly terminate a SIP soft\n   state.\n \
    \  The Diameter base protocol offers a mechanism to create and delete\n   states\
    \ in Diameter nodes.  These states are called Diameter user\n   sessions.  The\
    \ Diameter server decides whether to use a Diameter user\n   session as a mechanism\
    \ to map to a SIP soft state.  If the Diameter\n   server decides to use Diameter\
    \ user sessions, the termination of a\n   Diameter user session implies the termination\
    \ of the corresponding\n   SIP soft state (e.g., registration, event subscription),\
    \ and vice\n   versa.  If the Diameter server does not use Diameter user sessions,\n\
    \   this Diameter SIP application offers specific commands to manage the\n   SIP\
    \ soft states.  Implementations compliant with this specification\n   MUST support\
    \ both mechanisms of session management.\n   We provide support for both Diameter\
    \ client- and Diameter\n   server-initiated session termination.  Depending on\
    \ whether Diameter\n   sessions are used, termination of a SIP soft state can\
    \ be achieved by\n   one of the following methods:\n   o  When the Diameter client\
    \ (SIP proxy) wants to terminate the SIP\n      soft state and Diameter user sessions\
    \ are not maintained (i.e.,\n      the Auth-Session-State AVP has been previously\
    \ set to\n      NO_STATE_MAINTAINED), the Diameter client MUST send a\n      Server-Assignment-Request\
    \ (SAR) message with the\n      SIP-Server-Assignment-Type AVP (Section 9.4) set\
    \ to any of the\n      deregistration values:  TIMEOUT_DEREGISTRATION,\n     \
    \ USER_DEREGISTRATION, TIMEOUT_DEREGISTRATION_STORE_SERVER_NAME,\n      USER_DEREGISTRATION_STORE_SERVER_NAME,\n\
    \      ADMINISTRATIVE_DEREGISTRATION, DEREGISTRATION_TOO_MUCH_DATA.\n   o  When\
    \ the Diameter client (SIP proxy) wants to terminate the SIP\n      soft state\
    \ and Diameter user sessions are maintained (i.e., the\n      Auth-Session-State\
    \ AVP has been previously set to\n      STATE_MAINTAINED), the Diameter client\
    \ MUST send a Session-\n      Termination-Request (STR) message as per regular\
    \ procedures\n      according to RFC 3588 [RFC3588].\n   o  When the Diameter\
    \ server wants to terminate the SIP soft state and\n      Diameter user sessions\
    \ are not maintained (i.e., the\n      Auth-Session-State AVP has been previously\
    \ set to\n      NO_STATE_MAINTAINED), the Diameter server MUST send a\n      Registration-Termination-Request\
    \ (RTR) message (see Section 8.9).\n   o  When the Diameter server wants to terminate\
    \ the SIP soft state and\n      Diameter user sessions are maintained (i.e., the\n\
    \      Auth-Session-State AVP has been previously set to\n      STATE_MAINTAINED),\
    \ the Diameter server MUST send an\n      Abort-Session-Request (ASR) message\
    \ as per regular procedures\n      according to RFC 3588 [RFC3588].\n"
- title: 6.8.  Diameter Server Discovery
  contents:
  - "6.8.  Diameter Server Discovery\n   The basic architecture assumption of this\
    \ document is that all the\n   data related to a user is stored in a unique Diameter\
    \ server.\n   Contrary to general opinion, this does not create a single point\
    \ of\n   failure.  It is assumed that Diameter servers are configured in a\n \
    \  redundant fashion in an attempt to mitigate the\n   single-point-of-failure\
    \ problem.\n   In large networks, where the number of users may be significantly\n\
    \   high, there might be a need to scale the number of Diameter servers.\n   All\
    \ the data associated with a user is still stored in one Diameter\n   server (typically,\
    \ operating in a redundant configuration), but the\n   data associated with different\
    \ users may reside in different Diameter\n   servers.\n   Although this configuration\
    \ scales well, it introduces a new problem,\n   namely: given the user's SIP AOR\
    \ as an input, how to determine which\n   of various Diameter servers is storing\
    \ the data for that particular\n   SIP AOR.  We solve this problem with inspiration\
    \ from the Diameter\n   redirection mechanism specified in RFC 3588 [RFC3588].\
    \  We include in\n   the architecture a new Diameter node that, for the purpose\
    \ of this\n   document, is known as Diameter Subscriber Locator (SL).  The Diameter\n\
    \   SL contains a database or routing tables that map SIP AORs to\n   Diameter\
    \ server URIs.  A particular Diameter server URI points to the\n   actual Diameter\
    \ server that stores all the data related to a\n   particular SIP AOR, and in\
    \ consequence, to the user who owns the SIP\n   AOR.  The Diameter SL acts in\
    \ a similar way to a Diameter Redirect\n   Agent, dispatching Diameter requests\
    \ (e.g., providing the redirection\n   URI in the answer).  The Diameter SL can\
    \ redirect all the request\n   pertaining to a user by setting the Redirect-Host-Usage\
    \ AVP with a\n   value ALL_USER, as specified in RFC 3588 [RFC3588].\n   The Diameter\
    \ SL can be replicated in different nodes along the\n   network, for the purpose\
    \ of building scalability and redundancy.  The\n   database or routing tables\
    \ have to be consistent across all these\n   different Diameter SLs, so that equal\
    \ Diameter requests will produce\n   equal Diameter answers, no matter which Diameter\
    \ SL processes the\n   request.\n           +--------+   +--------+  +--------+\
    \  +--------+\n           |  SIP   |   |Diameter|  |Diameter|  |  SIP   |\n  \
    \         |server 1|   |SL red. |  |server 1|  |server 2|\n           +--------+\
    \   +--------+  +--------+  +--------+\n                |           |        \
    \   |            |\n   1. SIP INVITE|           |           |            |\n \
    \  ------------>| 2. LIR    |           |            |\n                |---------->|\
    \           |            |\n                | 3. LIA    |           |        \
    \    |\n                |<----------|           |            |\n             \
    \   |       4. LIR          |            |\n                |---------------------->|\
    \            |\n                |       5. LIA          |            |\n     \
    \           |<----------------------|            |\n                |        \
    \ 6. SIP INVITE |            |\n                |----------------------------------->|\
    \ 7. SIP INVITE\n                |           |           |            | ------------->\n\
    \                |           |           |            |\n      Figure 7: Locating\
    \ a Diameter server.  SL redirecting requests\n   Figure 7 shows an example of\
    \ operation of a Diameter SL acting in\n   redirect mode.  SIP server 1 receives\
    \ an INVITE request (step 1)\n   addressed (in the SIP Request-URI) to a user\
    \ for which the Diameter\n   client in SIP server 1 does not possess routing information.\
    \  In\n   other words, the Diameter client in SIP server 1 does not know the\n\
    \   URI of the Diameter server 1.  The Diameter client sends a Diameter\n   LIR\
    \ message (step 2) to any of the Diameter SLs configured in the\n   network. \
    \ The address of those SLs is assumed to be pre-provisioned\n   in the Diameter\
    \ client.  The Diameter SL, based on the contents of\n   the SIP-AOR AVP and its\
    \ own routing tables, determines the Diameter\n   server that stores the information\
    \ allocated to such user.  Then it\n   builds a Diameter LIA message (step 3)\
    \ that includes a Result-Code\n   AVP set to DIAMETER_REDIRECT_INDICATION and\
    \ one Redirect-Host AVP,\n   whose value is set to the URI of the Diameter server\
    \ that stores the\n   information related to such user.  Then the Diameter client\
    \ in SIP\n   server 1 builds a new LIR message (step 4) addressed to the Diameter\n\
    \   server received in the Redirect-Host AVP.  The rest of the procedure\n   is\
    \ completed as described in previous sections.\n"
- title: 7.  Advertising Application Support
  contents:
  - "7.  Advertising Application Support\n   Diameter implementations conforming to\
    \ this specification MUST\n   advertise its support by including an Auth-Application-Id\
    \ AVP in the\n   Capabilities-Exchange-Request (CER) and Capabilities-Exchange-Answer\n\
    \   (CEA) commands, according to the Diameter base protocol, RFC 3588\n   [RFC3588].\
    \  This Auth-Application-Id AVP MUST be set to the value of\n   this Diameter\
    \ SIP application (Section 13.1 indicates the actual\n   value allocated by IANA).\n"
- title: 8.  Diameter SIP Application Command Codes
  contents:
  - "8.  Diameter SIP Application Command Codes\n   All the Diameter implementations\
    \ conforming to this specification\n   MUST implement and support the list of\
    \ Diameter commands listed in\n   Table 1.\n   +-------------------------------------+-------+------+--------------+\n\
    \   | Command Name                        | Abbr. | Code | Reference    |\n  \
    \ +-------------------------------------+-------+------+--------------+\n   |\
    \ User-Authorization-Request          |  UAR  |  283 | Section 8.1  |\n   | User-Authorization-Answer\
    \           |  UAA  |  283 | Section 8.2  |\n   | Server-Assignment-Request  \
    \         |  SAR  |  284 | Section 8.3  |\n   | Server-Assignment-Answer     \
    \       |  SAA  |  284 | Section 8.4  |\n   | Location-Info-Request          \
    \     |  LIR  |  285 | Section 8.5  |\n   | Location-Info-Answer             \
    \   |  LIA  |  285 | Section 8.6  |\n   | Multimedia-Auth-Request            \
    \ |  MAR  |  286 | Section 8.7  |\n   | Multimedia-Auth-Answer              |\
    \  MAA  |  286 | Section 8.8  |\n   | Registration-Termination-Request    |  RTR\
    \  |  287 | Section 8.9  |\n   | Registration-Termination-Answer     |  RTA  |\
    \  287 | Section 8.10 |\n   | Push-Profile-Request                |  PPR  |  288\
    \ | Section 8.11 |\n   | Push-Profile-Answer                 |  PPA  |  288 |\
    \ Section 8.12 |\n   +-------------------------------------+-------+------+--------------+\n\
    \                      Table 1: Defined command codes\n   Sections defining commands\
    \ contain the Message Format for that\n   particular command.  The Message Formats\
    \ included in this document\n   are defined as per Section 3.2 of RFC 3588 [RFC3588].\n"
- title: 8.1.  User-Authorization-Request (UAR) Command
  contents:
  - "8.1.  User-Authorization-Request (UAR) Command\n   The User-Authorization-Request\
    \ (UAR) is indicated by the Command-Code\n   set to 283 and the Command Flags'\
    \ 'R' bit set.  The Diameter client\n   in a SIP server sends this command to\
    \ the Diameter server to request\n   authorization for the SIP User Agent to route\
    \ a SIP REGISTER request.\n   Because the SIP REGISTER request implicitly carries\
    \ a permission to\n   bind an AOR to a contact address, the Diameter client uses\
    \ the\n   Diameter UAR as a first authorization request towards the Diameter\n\
    \   server to authorize the registration.  For instance, the Diameter\n   server\
    \ can verify that the AOR is a legitimate user of the realm.\n   The Diameter\
    \ client in the SIP server requests authorization for one\n   of the possible\
    \ values defined in the SIP-User-Authorization-Type AVP\n   (Section 9.10).\n\
    \   The user name used for authentication of the user is conveyed in a\n   User-Name\
    \ AVP (defined in the Diameter base protocol, RFC 3588\n   [RFC3588]).  The location\
    \ of the authentication user name in the SIP\n   REGISTER request varies depending\
    \ on the authentication mechanism.\n   When the authentication mechanism is HTTP\
    \ Digest as defined in RFC\n   2617 [RFC2617], the authentication user name is\
    \ found in the\n   \"username\" directive of the SIP Authorization header field\
    \ value.\n   This Diameter SIP application only provides support for HTTP Digest\n\
    \   authentication in SIP; other authentication mechanisms are not\n   currently\
    \ supported.\n   The SIP or SIPS URI to be registered is conveyed in the SIP-AOR\
    \ AVP\n   (Section 9.8).  Typically this SIP or SIPS URI is found in the To\n\
    \   header field value of the SIP REGISTER request that triggered the\n   Diameter\
    \ UAR message.\n   The SIP-Visited-Network-Id AVP indicates the network that is\n\
    \   providing SIP services (e.g., SIP proxy functionality or any other\n   kind\
    \ of services) to the SIP User Agent.\n   The Message Format of the UAR command\
    \ is as follows:\n       <UAR> ::= < Diameter Header: 283, REQ, PXY >\n      \
    \           < Session-Id >\n                 { Auth-Application-Id }\n       \
    \          { Auth-Session-State }\n                 { Origin-Host }\n        \
    \         { Origin-Realm }\n                 { Destination-Realm }\n         \
    \        { SIP-AOR }\n                 [ Destination-Host ]\n                \
    \ [ User-Name ]\n                 [ SIP-Visited-Network-Id ]\n               \
    \  [ SIP-User-Authorization-Type ]\n               * [ Proxy-Info ]\n        \
    \       * [ Route-Record ]\n               * [ AVP ]\n"
- title: 8.2.  User-Authorization-Answer (UAA) Command
  contents:
  - "8.2.  User-Authorization-Answer (UAA) Command\n   The User-Authorization-Answer\
    \ (UAA) is indicated by the Command-Code\n   set to 283 and the Command Flags'\
    \ 'R' bit cleared.  The Diameter\n   server sends this command in response to\
    \ a previously received\n   Diameter User-Authorization-Request (UAR) command.\
    \  The Diameter\n   server indicates the result of the requested registration\n\
    \   authorization.  Additionally, the Diameter server may indicate a\n   collection\
    \ of SIP capabilities that assists the Diameter client to\n   select a SIP proxy\
    \ to the AOR under registration.\n   In addition to the values already defined\
    \ in RFC 3588 [RFC3588], the\n   Result-Code AVP may contain one of the values\
    \ defined in\n   Section 10.1.\n   Whenever the Diameter server fails to process\
    \ the Diameter UAR\n   message, it MUST stop processing and return the relevant\
    \ error in the\n   Diameter UAA message.  When there is success in the process,\
    \ the\n   Diameter server MUST set the code to DIAMETER_SUCCESS in the Diameter\n\
    \   UAA message.\n   If the Diameter server requires a User-Name AVP value to\
    \ process the\n   Diameter UAR request, but the Diameter UAR message did not contain\
    \ a\n   User-Name AVP value, the Diameter server MUST set the Result-Code AVP\n\
    \   value to DIAMETER_USER_NAME_REQUIRED (see Section 10.1.2) and return\n   it\
    \ in a Diameter UAA message.  Upon reception of this Diameter UAA\n   message\
    \ with the Result-Code AVP value set to\n   DIAMETER_USER_NAME_REQUIRED, the SIP\
    \ server typically requests\n   authentication by sending a SIP 401 (Unauthorized)\
    \ or SIP 407 (Proxy\n   Authentication Required) response back to the originator.\n\
    \   When the authorization procedure succeeds, the Diameter server\n   constructs\
    \ a User-Authorization-Answer (UAA) message that MUST\n   include (1) the address\
    \ of the SIP server already assigned to the\n   user name, (2) the capabilities\
    \ needed by the SIP server (Diameter\n   client) to select another SIP server\
    \ for the user, or (3) a\n   combination of the previous two options.\n   If the\
    \ Diameter server is already aware of a SIP server allocated to\n   the user,\
    \ the Diameter UAA message contains the address of that SIP\n   server.\n   The\
    \ Diameter UAA message contains the capabilities required by a SIP\n   server\
    \ to trigger and execute services.  It is required that these\n   capabilities\
    \ are present in the Diameter UAA message due to the\n   possibility that the\
    \ Diameter client (in the SIP server) allocates a\n   different SIP server to\
    \ trigger and execute services for that\n   particular user.\n   If a User-Name\
    \ AVP is present in the Diameter UAR message, then the\n   Diameter server MUST\
    \ verify the existence of the user in the realm,\n   i.e., the User-Name AVP value\
    \ is a valid user within that realm.  If\n   the Diameter server does not recognize\
    \ the user name received in the\n   User-Name AVP, the Diameter server MUST build\
    \ a Diameter User-\n   Authorization-Answer (UAA) message and MUST set the Result-Code\
    \ AVP\n   to DIAMETER_ERROR_USER_UNKNOWN.\n   If a User-Name AVP is present in\
    \ the Diameter UAR message, then the\n   Diameter server MUST authorize that User-Name\
    \ AVP value is able to\n   register the SIP or SIPS URI included in the SIP-AOR\
    \ AVP.  If this\n   authorization fails, the Diameter server must set the Result-Code\
    \ AVP\n   to DIAMETER_ERROR_IDENTITIES_DONT_MATCH and send it in a Diameter\n\
    \   User-Authorization-Answer (UAA) message.\n      Note: Correlation between\
    \ User-Name and SIP-AOR AVP values is\n      required in order to avoid registration\
    \ of a SIP-AOR allocated to\n      another user.\n   If there is a SIP-Visited-Network-Id\
    \ AVP in the Diameter UAR message,\n   and the SIP-User-Authorization-Type AVP\
    \ value received in the\n   Diameter UAR message is set to REGISTRATION or REGISTRATION&\n\
    \   CAPABILITIES, then the Diameter server SHOULD verify whether the user\n  \
    \ is allowed to roam into the network specified in the\n   SIP-Visited-Network-Id\
    \ AVP in the Diameter UAR message.  If the user\n   is not allowed to roam into\
    \ that network, the Diameter AAA server\n   MUST set the Result-Code AVP value\
    \ in the Diameter UAA message to\n   DIAMETER_ERROR_ROAMING_NOT_ALLOWED.\n   If\
    \ the SIP-User-Authorization-Type AVP value received in the Diameter\n   UAR message\
    \ is set to REGISTRATION or REGISTRATION&CAPABILITIES, then\n   the Diameter server\
    \ SHOULD verify whether the SIP-AOR AVP value is\n   authorized to register in\
    \ the Home Realm.  Where the SIP AOR is not\n   authorized to register in the\
    \ Home Realm, the Diameter server MUST\n   set the Result-Code AVP to DIAMETER_AUTHORIZATION_REJECTED\
    \ and send\n   it in a Diameter UAA message.\n   When the SIP-User-Authorization-Type\
    \ AVP is not present in the\n   Diameter UAR message, or when it is present and\
    \ its value is set to\n   REGISTRATION, then:\n   o  If the Diameter server is\
    \ not aware of any previous registration\n      of the user name (including registrations\
    \ of other SIP AORs\n      allocated to the same user name), then the Diameter\
    \ server does\n      not know of any SIP server allocated to the user.  In this\
    \ case,\n      the Diameter server MUST set the Result-Code AVP value to\n   \
    \   DIAMETER_FIRST_REGISTRATION in the Diameter UAA message, and the\n      Diameter\
    \ server SHOULD include the required SIP server\n      capabilities in the SIP-Server-Capabilities\
    \ AVP value in the\n      Diameter UAA message.  The SIP-Server-Capabilities AVP\
    \ assists the\n      Diameter client (SIP server) to select an appropriate SIP\
    \ server\n      for the user, according to the required capabilities.\n   o  In\
    \ some cases, the Diameter server is aware of a previously\n      assigned SIP\
    \ server for the same or different SIP AORs allocated\n      to the same user\
    \ name.  In these cases, re-assignment of a new SIP\n      server may or may not\
    \ be needed, depending on the capabilities of\n      the SIP server.  The Diameter\
    \ server MUST always include the\n      allocated SIP server URI in the SIP-Server-URI\
    \ AVP of the UAA\n      message.  If the Diameter server does not return the SIP\n\
    \      capabilities, the Diameter server MUST set the Result-Code AVP in\n   \
    \   the Diameter UAA message to DIAMETER_SUBSEQUENT_REGISTRATION.\n      Otherwise\
    \ (i.e., if the Diameter server includes a\n      SIP-Server-Capabilities AVP),\
    \ then the Diameter server MUST set\n      the Result-Code AVP in the Diameter\
    \ UAA message to\n      DIAMETER_SERVER_SELECTION.  Then the Diameter client determines,\n\
    \      based on the received information, whether it needs to select a\n     \
    \ new SIP server.\n   When the SIP-User-Authorization-Type AVP value received\
    \ in the\n   Diameter UAR message is set to REGISTRATION&CAPABILITIES, then\n\
    \   Diameter Server MUST return the list of capabilities in the\n   SIP-Server-Capabilities\
    \ AVP value of the Diameter UAA message, it\n   MUST set the Result-Code to DIAMETER_SUCCESS,\
    \ and it MUST NOT return\n   a SIP-Server-URI AVP.  The SIP-Server-Capabilities\
    \ AVP enables the\n   SIP server (Diameter client) to select another appropriate\
    \ SIP server\n   for invoking and executing services for the user, depending on\
    \ the\n   required capabilities.  The Diameter server MAY leave the list of\n\
    \   capabilities empty to indicate that any SIP server can be selected.\n   When\
    \ the SIP-User-Authorization-Type AVP value received in the\n   Diameter UAR message\
    \ is set to DEREGISTRATION, then:\n   o  If the Diameter server is aware of a\
    \ SIP server assigned to the\n      SIP AOR under deregistration, the Diameter\
    \ server MUST set the\n      Result-Code AVP to DIAMETER_SUCCESS and MUST set\
    \ the\n      SIP-Server-URI AVP value to the known SIP server, and return them\n\
    \      in the Diameter UAA message.\n   o  If the Diameter server is not aware\
    \ of a SIP server assigned to\n      the SIP AOR under deregistration, then the\
    \ Diameter server MUST\n      set the Result-Code AVP in the Diameter UAA message\
    \ to\n      DIAMETER_ERROR_IDENTITY_NOT_REGISTERED.\n   The Message Format of\
    \ the UAA command is as follows:\n       <UAA> ::= < Diameter Header: 283, PXY\
    \ >\n                 < Session-Id >\n                 { Auth-Application-Id }\n\
    \                 { Auth-Session-State }\n                 { Result-Code }\n \
    \                { Origin-Host }\n                 { Origin-Realm }\n        \
    \         [ SIP-Server-URI ]\n                 [ SIP-Server-Capabilities ]\n \
    \                [ Authorization-Lifetime ]\n                 [ Auth-Grace-Period\
    \ ]\n                 [ Redirect-Host ]\n                 [ Redirect-Host-Usage\
    \ ]\n                 [ Redirect-Max-Cache-Time ]\n               * [ Proxy-Info\
    \ ]\n               * [ Route-Record ]\n               * [ AVP ]\n"
- title: 8.3.  Server-Assignment-Request (SAR) Command
  contents:
  - "8.3.  Server-Assignment-Request (SAR) Command\n   The Server-Assignment-Request\
    \ (SAR) command is indicated by the\n   Command-Code set to 284 and the Command\
    \ Flags' 'R' bit set.  The\n   Diameter client in a SIP server sends this command\
    \ to the Diameter\n   server to indicate the completion of the authentication\
    \ process and\n   to request that the Diameter server store the URI of the SIP\
    \ server\n   that is currently serving the user.  The main functions of the\n\
    \   Diameter SAR command are to inform the Diameter server of the URI of\n   the\
    \ SIP server allocated to the user, and to store or clear it from\n   the Diameter\
    \ server.  Additionally, the Diameter client can request\n   to download the user\
    \ profile or part of it.\n   During the registration procedure, a SIP server becomes\
    \ assigned to\n   the user.  The Diameter client in the assigned SIP server MUST\n\
    \   include its own URI in the SIP-Server-URI AVP of the\n   Server-Assignment-Request\
    \ (SAR) Diameter message and send it to the\n   Diameter server.  The Diameter\
    \ server then becomes aware of the\n   allocation of the SIP server to the user\
    \ name and the server's URI.\n   The Diameter client in the SIP server MAY send\
    \ a Diameter SAR message\n   because of other reasons.  These reasons are identified\
    \ in the\n   SIP-Server-Assignment-Type AVP (Section 9.4) value.  For instance,\
    \ a\n   Diameter client in a SIP server may contact the Diameter server to\n \
    \  request deregistration of a user, to inform the Diameter server of an\n   authentication\
    \ failure, or just to download the user profile.  For a\n   complete description\
    \ of all the SIP-Server-Assignment-Type AVP\n   values, see Section 9.4.\n   Typically\
    \ the reception of a SIP REGISTER request in a SIP server\n   will trigger the\
    \ Diameter client in the SIP server to send the\n   Diameter SAR message.  However,\
    \ if a SIP server is receiving other\n   SIP request, such as INVITE, and the\
    \ SIP server does not have the\n   user profile, the Diameter client in the SIP\
    \ server may send the\n   Diameter SAR message to the Diameter server in order\
    \ to download the\n   user profile and make the Diameter server aware of the SIP\
    \ server\n   assigned to the user.\n   The user profile is an important piece\
    \ of information that dictates\n   the behavior of the SIP server when triggering\
    \ or providing services\n   for the user.  Typically the user profile is divided\
    \ into:\n   o  Services to be rendered to the user when the user is registered\n\
    \      and initiates a SIP request.\n   o  Services to be rendered to the user\
    \ when the user is registered\n      and a SIP request destined to that user arrives\
    \ to the SIP proxy.\n   o  Services to be rendered to the user when the user is\
    \ not\n      registered and a SIP request destined to that user arrives to the\n\
    \      SIP proxy.\n   The SIP-Server-Assignment-Type AVP indicates the reason\
    \ why the\n   Diameter client (SIP server) contacted the Diameter server.  If\
    \ the\n   Diameter client sets the SIP-Server-Assignment-Type AVP value to\n \
    \  REGISTRATION, RE_REGISTRATION, UNREGISTERED_USER, NO_ASSIGNMENT,\n   AUTHENTICATION_FAILURE\
    \ or AUTHENTICATION_TIMEOUT, the Diameter client\n   MUST include exactly one\
    \ SIP-AOR AVP in the Diameter SAR message.\n   The SAR message MAY contain zero\
    \ or more SIP-Supported-User-Data-Type\n   AVPs.  Each of them contains a type\
    \ of user data understood by the\n   SIP server.  This allows the Diameter client\
    \ to provide an indication\n   to the Diameter server of the different format\
    \ of user data\n   understood by the SIP server.  The Diameter server uses this\n\
    \   information to select one or more SIP-User-Data AVPs that will be\n   included\
    \ in the SAA message.\n   The Message Format of the SAR command is as follows:\n\
    \       <SAR> ::= < Diameter Header: 284, REQ, PXY >\n                 < Session-Id\
    \ >\n                 { Auth-Application-Id }\n                 { Auth-Session-State\
    \ }\n                 { Origin-Host }\n                 { Origin-Realm }\n   \
    \              { Destination-Realm }\n                 { SIP-Server-Assignment-Type\
    \ }\n                 { SIP-User-Data-Already-Available }\n                 [\
    \ Destination-Host ]\n                 [ User-Name ]\n                 [ SIP-Server-URI\
    \ ]\n               * [ SIP-Supported-User-Data-Type ]\n               * [ SIP-AOR\
    \ ]\n               * [ Proxy-Info ]\n               * [ Route-Record ]\n    \
    \           * [ AVP ]\n"
- title: 8.4.  Server-Assignment-Answer (SAA) Command
  contents:
  - "8.4.  Server-Assignment-Answer (SAA) Command\n   The Server-Assignment-Answer\
    \ (SAA) is indicated by the Command-Code\n   set to 284 and the Command Flags'\
    \ 'R' bit cleared.  The Diameter\n   server sends this command in response to\
    \ a previously received\n   Diameter Server-Assignment-Request (SAR) command.\
    \  The response may\n   include the user profile or part of it, if requested.\n\
    \   In addition to the values already defined in RFC 3588 [RFC3588], the\n   Result-Code\
    \ AVP may contain one of the values defined in\n   Section 10.1.\n   The Result-Code\
    \ AVP value in the Diameter SAA message may indicate a\n   success or an error\
    \ in the execution of the Diameter SAR command.  If\n   Result-Code AVP value\
    \ in the Diameter SAA message does not contain an\n   error code, the SAA message\
    \ MAY include one or more SIP-User-Data\n   AVPs that typically contain the profile\
    \ of the user, indicating\n   services that the SIP server can provide to that\
    \ user.\n   The Diameter server MAY include one or more\n   SIP-Supported-User-Data-Type\
    \ AVPs, each one identifying a type of\n   user data format supported in the Diameter\
    \ server.  If there is not a\n   common supported user data type between the Diameter\
    \ client and the\n   Diameter server, the Diameter server SHOULD declare its list\
    \ of\n   supported user data types by including one or more\n   SIP-Supported-User-Data-Type\
    \ AVPs in a Diameter SAA message.  This\n   indication is merely for debugging\
    \ reasons, since there is not a\n   fallback mechanism that allows the Diameter\
    \ client to retrieve the\n   profile in a supported format.\n   If the Diameter\
    \ server requires a User-Name AVP value to process the\n   Diameter SAR request,\
    \ but the Diameter SAR message did not contain a\n   User-Name AVP value, the\
    \ Diameter server MUST set the Result-Code AVP\n   value to DIAMETER_USER_NAME_REQUIRED\
    \ (see Section 10.1.2) and return\n   it in a Diameter SAA message.  Upon reception\
    \ of this Diameter SAA\n   message with the Result-Code AVP value set to\n   DIAMETER_USER_NAME_REQUIRED,\
    \ the SIP server typically requests\n   authentication by generating a SIP 401\
    \ (Unauthorized) or SIP 407\n   (Proxy Authentication Required) response back\
    \ to the originator.\n   If the User-Name AVP is included in the Diameter SAR\
    \ message, upon\n   reception of the Diameter SAR message, the Diameter server\
    \ MUST\n   verify the existence of the user in the realm, i.e., the User-Name\n\
    \   AVP value is a valid user within that realm.  If the Diameter server\n   does\
    \ not recognize the user name received in the User-Name AVP, the\n   Diameter\
    \ server MUST build a Diameter Server-Assignment-Answer (SAA)\n   message and\
    \ MUST set the Result-Code AVP to\n   DIAMETER_ERROR_USER_UNKNOWN.\n   Then the\
    \ Diameter server MUST authorize that User-Name AVP value is a\n   valid authentication\
    \ name for the SIP or SIPS URI included in the\n   SIP-AOR AVP of the Diameter\
    \ SAR message.  If this authorization\n   fails, the Diameter server must set\
    \ the Result-Code AVP to\n   DIAMETER_ERROR_IDENTITIES_DONT_MATCH and send it\
    \ in a Diameter\n   Server-Assignment-Answer (SAA) message.\n   After successful\
    \ execution of the Diameter SAR command, the Diameter\n   server MUST clear the\
    \ \"authentication pending\" flag and SHOULD move\n   the temporarily stored SIP\
    \ server URI to permanent storage.\n   The actions of the Diameter server upon\
    \ reception of the Diameter SAR\n   message depend on the value of the SIP-Server-Assignment-Type:\n\
    \   o  If the SIP-Server-Assignment-Type AVP value in the Diameter SAR\n     \
    \ message is set to REGISTRATION or RE_REGISTRATION, the Diameter\n      server\
    \ SHOULD verify that there is only one SIP-AOR AVP.\n      Otherwise, the Diameter\
    \ server MUST answer with a Diameter SAA\n      message with the Result-Code AVP\
    \ value set to\n      DIAMETER_AVP_OCCURS_TOO_MANY_TIMES and MUST NOT include\
    \ any\n      SIP-User-Data AVP.  If there is only one SIP-AOR AVP and if the\n\
    \      SIP-User-Data-Already-Available AVP value is set to\n      USER_DATA_NOT_AVAILABLE,\
    \ then the Diameter server SHOULD include\n      one or more user profile data\
    \ with the SIP or SIPS URI (SIP-AOR\n      AVP) and all other SIP identities associated\
    \ with that AVP in the\n      SIP-User-Data AVP value of the Diameter SAA message.\
    \  On selecting\n      the type of user data, the Diameter server SHOULD take\
    \ into\n      account the supported formats at the SIP server\n      (SIP-Supported-User-Data-Type\
    \ AVP in the SAR message) and the\n      local policy.  Additionally, the Diameter\
    \ server MUST set the\n      Result-Code AVP value to DIAMETER_SUCCESS in the\
    \ Diameter SAA\n      message.  The Diameter server considers the SIP AOR authenticated\n\
    \      and registered.\n   o  If the SIP-Server-Assignment-Type AVP value in the\
    \ Diameter SAR\n      message is set to UNREGISTERED_USER, then the Diameter server\
    \ MUST\n      store the SIP server address included in the SIP-Server-URI AVP\n\
    \      value.  The Diameter server will return the SIP server address in\n   \
    \   Diameter Location-Info-Answer (LIA) messages.  If the\n      SIP-User-Data-Already-Available\
    \ AVP value is set to\n      USER_DATA_NOT_AVAILABLE, then the Diameter server\
    \ SHOULD include\n      one or more user profile data associated with the SIP\
    \ or SIPS URI\n      (SIP-AOR AVP) and associated identities in the SIP-User-Data\
    \ AVP\n      value of the Diameter SAA message.  On selecting the type of user\n\
    \      data, the Diameter server SHOULD take into account the supported\n    \
    \  formats at the SIP server (SIP-Supported-User-Data-Type AVP in the\n      SAR\
    \ message) and the local policy.  The Diameter server MUST set\n      the Result-Code\
    \ AVP value to DIAMETER_SUCCESS.  The Diameter\n      server considers the SIP\
    \ AOR UNREGISTERED, but with a SIP server\n      allocated to trigger and provide\
    \ services for unregistered users.\n      Note that in case of UNREGISTERED_USER\
    \ (SIP-Server-Assignment-Type\n      AVP), the Diameter server MUST verify that\
    \ there is only one\n      SIP-AOR AVP.  Otherwise, the Diameter server MUST answer\
    \ the\n      Diameter SAR message with a Diameter SAA message, and it MUST set\n\
    \      the Result-Code AVP value to DIAMETER_AVP_OCCURS_TOO_MANY_TIMES\n     \
    \ and MUST NOT include any SIP-User-Data AVP.\n      If the User-Name AVP was\
    \ not present in the Diameter SAR message\n      and the SIP-AOR is not known\
    \ for the Diameter server, the Diameter\n      server MUST NOT include a User-Name\
    \ AVP in the Diameter SAA\n      message and MUST set the Result-Code AVP value\
    \ to\n      DIAMETER_ERROR_USER_UNKNOWN.\n   o  If the SIP-Server-Assignment-Type\
    \ AVP value in the Diameter SAR\n      message is set to TIMEOUT_DEREGISTRATION,\
    \ USER_DEREGISTRATION,\n      DEREGISTRATION_TOO_MUCH_DATA, or ADMINISTRATIVE_DEREGISTRATION,\n\
    \      the Diameter server MUST clear the SIP server address associated\n    \
    \  with all SIP AORs indicated in each of the SIP-AOR AVP values\n      included\
    \ in the Diameter SAR message.  The Diameter server\n      considers all of these\
    \ SIP AORs as not registered.  The Diameter\n      server MUST set the Result-Code\
    \ AVP value to DIAMETER_SUCCESS in\n      the Diameter SAA message.\n   o  If\
    \ the SIP-Server-Assignment-Type AVP value in the Diameter SAR\n      message\
    \ is set to TIMEOUT_DEREGISTRATION_STORE_SERVER_NAME or\n      USER_DEREGISTRATION_STORE_SERVER_NAME,\
    \ the Diameter server MAY\n      keep the SIP server address associated with the\
    \ SIP AORs included\n      in the SIP-AOR AVP values of the Diameter SAR message,\
    \ even though\n      the SIP AORs become unregistered.  This feature allows a\
    \ SIP\n      server to request that the Diameter server remain an assigned SIP\n\
    \      server for those SIP AORs (SIP-AOR AVP values) allocated to the\n     \
    \ same user name, and avoid SIP server assignment.  The Diameter\n      server\
    \ MUST consider all these SIP AORs as not registered.  If the\n      Diameter\
    \ server honors the request of the Diameter client (SIP\n      server) to remain\
    \ as an allocated SIP server, then the Diameter\n      server MUST keep the SIP\
    \ server assigned to those SIP AORs\n      allocated to the username and MUST\
    \ set the Result-Code AVP value\n      to DIAMETER_SUCCESS in the Diameter SAA\
    \ message.  Otherwise, when\n      the Diameter server does not honor the request\
    \ of the Diameter\n      client (SIP server) to remain as an allocated SIP server,\
    \ the\n      Diameter server MUST clear the SIP server name assigned to those\n\
    \      SIP AORs and it MUST set the Result-Code AVP value to\n      DIAMETER_SUCCESS_SERVER_NAME_NOT_STORED\
    \ in the Diameter SAA\n      message.\n   o  If the SIP-Server-Assignment-Type\
    \ AVP value in the Diameter SAR\n      message is set to NO_ASSIGNMENT, the Diameter\
    \ server SHOULD first\n      verify that the SIP-Server-URI AVP value in the Diameter\
    \ SAR\n      message is the same URI as the one assigned to the SIP-AOR AVP\n\
    \      value.  If they differ, then the Diameter server MUST set the\n      Result-Code\
    \ AVP value to DIAMETER_UNABLE_TO_COMPLY in the Diameter\n      SAA message. \
    \ Otherwise, if the SIP-User-Data-Already-Available\n      AVP value is set to\
    \ USER_DATA_NOT_AVAILABLE, then the Diameter\n      server SHOULD include the\
    \ user profile data with the SIP or SIPS\n      URI (SIP-AOR AVP) and all other\
    \ SIP identities associated with\n      that AVP in the SIP-User-Data AVP value\
    \ of the Diameter SAA\n      message.  On selecting the type of user data, the\
    \ Diameter server\n      SHOULD take into account the supported formats at the\
    \ SIP server\n      (SIP-Supported-User-Data-Type AVP in the SAR message) and\
    \ the\n      local policy.\n   o  If the SIP-Server-Assignment-Type AVP value\
    \ in the Diameter SAR\n      message is set to AUTHENTICATION_FAILURE or\n   \
    \   AUTHENTICATION_TIMEOUT, the Diameter server MUST verify that there\n     \
    \ is exactly one SIP-AOR AVP in the Diameter SAR message.  If the\n      number\
    \ of occurrences of the SIP-AOR AVP is not exactly one, the\n      Diameter server\
    \ MUST set the Result-Code AVP value to\n      DIAMETER_AVP_OCCURS_TOO_MANY_TIMES\
    \ in the Diameter SAA message,\n      and SHOULD not take further actions.  If\
    \ there is exactly one\n      SIP-AOR AVP in the Diameter SAR message, the Diameter\
    \ server MUST\n      clear the address of the SIP server assigned to the SIP AOR\n\
    \      allocated to the user name, and the Diameter server MUST set the\n    \
    \  Result-Code AVP value to DIAMETER_SUCCESS in the Diameter SAA\n      message.\
    \  The Diameter server MUST consider the SIP AOR as not\n      registered.\n \
    \  The Message Format of the SAA command is as follows:\n       <SAA> ::= < Diameter\
    \ Header: 284, PXY >\n                 < Session-Id >\n                 { Auth-Application-Id\
    \ }\n                 { Result-Code }\n                 { Auth-Session-State }\n\
    \                 { Origin-Host }\n                 { Origin-Realm }\n       \
    \        * [ SIP-User-Data ]\n                 [ SIP-Accounting-Information ]\n\
    \               * [ SIP-Supported-User-Data-Type ]\n                 [ User-Name\
    \ ]\n                 [ Auth-Grace-Period ]\n                 [ Authorization-Lifetime\
    \ ]\n                 [ Redirect-Host ]\n                 [ Redirect-Host-Usage\
    \ ]\n                 [ Redirect-Max-Cache-Time ]\n               * [ Proxy-Info\
    \ ]\n               * [ Route-Record ]\n               * [ AVP ]\n"
- title: 8.5.  Location-Info-Request (LIR) Command
  contents:
  - "8.5.  Location-Info-Request (LIR) Command\n   The Location-Info-Request (LIR)\
    \ is indicated by the Command-Code set\n   to 285 and the Command Flags' 'R' bit\
    \ set.  The Diameter client in a\n   SIP server sends this command to the Diameter\
    \ server to request\n   routing information, e.g., the URI of the SIP server assigned\
    \ to the\n   SIP-AOR AVP value allocated to the users.\n   The Message Format\
    \ of the LIR command is as follows:\n       <LIR> ::= < Diameter Header: 285,\
    \ REQ, PXY >\n                 < Session-Id >\n                 { Auth-Application-Id\
    \ }\n                 { Auth-Session-State }\n                 { Origin-Host }\n\
    \                 { Origin-Realm }\n                 { Destination-Realm }\n \
    \                { SIP-AOR }\n                 [ Destination-Host ]\n        \
    \       * [ Proxy-Info ]\n               * [ Route-Record ]\n               *\
    \ [ AVP ]\n"
- title: 8.6.  Location-Info-Answer (LIA) Command
  contents:
  - "8.6.  Location-Info-Answer (LIA) Command\n   The Location-Info-Answer (LIA) is\
    \ indicated by the Command-Code set\n   to 285 and the Command Flags' 'R' bit\
    \ cleared.  The Diameter server\n   sends this command in response to a previously\
    \ received Diameter\n   Location-Info-Request (LIR) command.\n   In addition to\
    \ the values already defined in RFC 3588 [RFC3588], the\n   Result-Code AVP may\
    \ contain one of the values defined in\n   Section 10.1.  When the Diameter server\
    \ finds an error in processing\n   the Diameter LIR message, the Diameter server\
    \ MUST stop the process\n   of the message and answer with a Diameter LIA message\
    \ that includes\n   the appropriate error code in the Result-Code AVP value. \
    \ When there\n   is no error, the Diameter server MUST set the Result-Code AVP\
    \ value\n   to DIAMETER_SUCCESS in the Diameter LIA message.\n   One of the errors\
    \ that the Diameter server may find is that the\n   SIP-AOR AVP value is not a\
    \ valid user in the realm.  In such cases,\n   the Diameter server MUST set the\
    \ Result-Code AVP value to\n   DIAMETER_ERROR_USER_UNKNOWN and return it in a\
    \ Diameter LIA message.\n   If the Diameter server cannot process the Diameter\
    \ LIR command, e.g.,\n   due to a database error, the Diameter server MUST set\
    \ the Result-Code\n   AVP value to DIAMETER_UNABLE_TO_COMPLY and return it in\
    \ a Diameter\n   LIA message.  The Diameter server MUST NOT include any SIP-Server-URI\n\
    \   or SIP-Server-Capabilities AVP in the Diameter LIA message.\n   The Diameter\
    \ server may or may not be aware of a SIP server assigned\n   to the SIP-AOR AVP\
    \ value included in the Diameter LIR message.  If\n   the Diameter server is aware\
    \ of a SIP server allocated to that\n   particular user, the Diameter server MUST\
    \ include the URI of such SIP\n   server in the SIP-Server-URI AVP and return\
    \ it in a Diameter LIA\n   message.  This is typically the situation when the\
    \ user is either\n   registered, or unregistered but a SIP server is still assigned\
    \ to the\n   user.\n   When the Diameter server is not aware of a SIP server allocated\
    \ to\n   the user (typically the case when the user unregistered), the\n   Result-Code\
    \ AVP value in the Diameter LIA message depends on whether\n   the Diameter server\
    \ is aware that the user has services defined for\n   unregistered users:\n  \
    \ o  Those users who have services defined for unregistered users may\n      require\
    \ the allocation of a SIP server to trigger and perhaps\n      execute those services.\
    \  Therefore, when the Diameter server is\n      not aware of an assigned SIP\
    \ server, but the user has services\n      defined for unregistered users, the\
    \ Diameter server MUST set the\n      Result-Code AVP value to DIAMETER_UNREGISTERED_SERVICE\
    \ and return\n      it in a Diameter LIA message.  The Diameter server MAY also\n\
    \      include a SIP-Server-Capabilities AVP to facilitate the SIP server\n  \
    \    (Diameter client) with the selection of an appropriate SIP server\n     \
    \ with the required capabilities.  Absence of the SIP-Server-\n      Capabilities\
    \ AVP indicates to the SIP server (Diameter client)\n      that any SIP server\
    \ is suitable to be allocated for the user.\n   o  Those users who do not have\
    \ service defined for unregistered users\n      do not require further processing.\
    \  The Diameter server MUST set\n      the Result-Code AVP value to\n      DIAMETER_ERROR_IDENTITY_NOT_REGISTERED\
    \ and return it to the\n      Diameter client in a Diameter LIA message.  The\
    \ SIP server\n      (Diameter client) may return the appropriate SIP response\
    \ (e.g.,\n      480 (Temporarily unavailable)) to the original SIP request.\n\
    \   The Message Format of the LIA command is as follows:\n       <LIA> ::= < Diameter\
    \ Header: 285, PXY >\n                 < Session-Id >\n                 { Auth-Application-Id\
    \ }\n                 { Result-Code }\n                 { Auth-Session-State }\n\
    \                 { Origin-Host }\n                 { Origin-Realm }\n       \
    \          [ SIP-Server-URI ]\n                 [ SIP-Server-Capabilities ]\n\
    \                 [ Auth-Grace-Period ]\n                 [ Authorization-Lifetime\
    \ ]\n                 [ Redirect-Host ]\n                 [ Redirect-Host-Usage\
    \ ]\n                 [ Redirect-Max-Cache-Time ]\n               * [ Proxy-Info\
    \ ]\n               * [ Route-Record ]\n               * [ AVP ]\n"
- title: 8.7.  Multimedia-Auth-Request (MAR) Command
  contents:
  - "8.7.  Multimedia-Auth-Request (MAR) Command\n   The Multimedia-Auth-Request (MAR)\
    \ command is indicated by the\n   Command-Code set to 286 and the Command Flags'\
    \ 'R' bit set.  The\n   Diameter client in a SIP server sends this command to\
    \ the Diameter\n   server to request that the Diameter server authenticate and\
    \ authorize\n   a user attempt to use some SIP service (in this context, SIP service\n\
    \   can be something as simple as a SIP subscription or using the proxy\n   services\
    \ for a SIP request).\n   The MAR command may also register the SIP server's own\
    \ URI to the\n   Diameter server, so that future LIR/LIA messages can return this\
    \ URI.\n   If the SIP server is acting as a SIP registrar (see examples in\n \
    \  Sections 6.2 and 6.3), its Diameter client MUST include a SIP-\n   Server-URI\
    \ AVP in the MAR command.  In any other cases (see example\n   in Section 6.4),\
    \ its Diameter client MUST NOT include a SIP-Server-\n   URI AVP in the MAR command.\n\
    \   The SIP-Method AVP MUST include the SIP method name of the SIP\n   request\
    \ that triggered this Diameter MAR message.  The Diameter\n   server can use this\
    \ AVP to authorize some SIP requests depending on\n   the method.\n   The Diameter\
    \ MAR message MUST include a SIP-AOR AVP.  The SIP-AOR AVP\n   indicates the target\
    \ of the SIP request.  The value of the AVP is\n   extracted from different places\
    \ in SIP request, depending on the\n   semantics of the SIP request.  For SIP\
    \ REGISTER messages the SIP-AOR\n   AVP value indicates the intended public user\
    \ identity under\n   registration, and it is the SIP or SIPS URI populated in\
    \ the To\n   header field value (addr-spec as per RFC 3261 [RFC3261]) of the SIP\n\
    \   REGISTER request.  For other types of SIP requests, such as INVITE,\n   SUBSCRIBE,\
    \ MESSAGE, etc., the SIP-AOR AVP value indicates the\n   intended destination\
    \ of the request.  This is typically populated in\n   the Request-URI of the SIP\
    \ request.  Extracting the SIP-AOR AVP value\n   from the proper SIP header field\
    \ is the Diameter client's\n   responsibility.  Extensions to SIP (new SIP methods\
    \ or new semantics)\n   may require the SIP-AOR to be extracted from other parts\
    \ of the\n   request.\n   If the SIP request includes some sort of authentication\
    \ information,\n   the Diameter client MUST include the user name, extracted from\
    \ the\n   authentication information of the SIP request, in the User-Name AVP\n\
    \   value.\n   The Message Format of the MAR command is as follows:\n       <MAR>\
    \ ::= < Diameter Header: 286, REQ, PXY >\n                 < Session-Id >\n  \
    \               { Auth-Application-Id }\n                 { Auth-Session-State\
    \ }\n                 { Origin-Host }\n                 { Origin-Realm }\n   \
    \              { Destination-Realm }\n                 { SIP-AOR }\n         \
    \        { SIP-Method }\n                 [ Destination-Host ]\n             \
    \    [ User-Name ]\n                 [ SIP-Server-URI ]\n                 [ SIP-Number-Auth-Items\
    \ ]\n                 [ SIP-Auth-Data-Item ]\n               * [ Proxy-Info ]\n\
    \               * [ Route-Record ]\n               * [ AVP ]\n"
- title: 8.8.  Multimedia-Auth-Answer (MAA) Command
  contents:
  - "8.8.  Multimedia-Auth-Answer (MAA) Command\n   The Multimedia-Auth-Answer (MAA)\
    \ is indicated by the Command-Code set\n   to 286 and the Command Flags' 'R' bit\
    \ cleared.  The Diameter server\n   sends this command in response to a previously\
    \ received Diameter\n   Multimedia-Auth-Request (MAR) command.\n   In addition\
    \ to the values already defined in RFC 3588 [RFC3588], the\n   Result-Code AVP\
    \ may contain one of the values defined in\n   Section 10.1.\n   If the Diameter\
    \ server requires a User-Name AVP value to process the\n   Diameter MAR request,\
    \ but the Diameter MAR message did not contain a\n   User-Name AVP value, the\
    \ Diameter server MUST set the Result-Code AVP\n   value to DIAMETER_USER_NAME_REQUIRED\
    \ (see Section 10.1.2) and return\n   it in a Diameter MAA message.  The Diameter\
    \ server MAY include a\n   SIP-Number-Auth-Items AVP and one or more SIP-Auth-Data-Item\
    \ AVPs\n   with authentication information (e.g., a challenge).  Upon reception\n\
    \   of this Diameter MAA message with the Result-Code AVP value set to\n   DIAMETER_USER_NAME_REQUIRED,\
    \ the SIP server typically requests\n   authentication by generating a SIP 401\
    \ (Unauthorized) or SIP 407\n   (Proxy Authentication Required) response back\
    \ to the originator.\n   If the User-Name AVP is present in the Diameter MAR message,\
    \ the\n   Diameter server MUST verify the existence of the user in the realm,\n\
    \   i.e., the User-Name AVP value is a valid user within that realm.  If\n   the\
    \ Diameter server does not recognize the user name received in the\n   User-Name\
    \ AVP, the Diameter server MUST build a Diameter\n   Multimedia-Auth-Answer (MAA)\
    \ message and MUST set the Result-Code AVP\n   to DIAMETER_ERROR_USER_UNKNOWN.\n\
    \   If the SIP-Methods AVP value of the Diameter MAR message is set to\n   REGISTER\
    \ and a User-Name AVP is present, then the Diameter server\n   MUST authorize\
    \ that User-Name AVP value is able to use the URI\n   included in the SIP-AOR\
    \ AVP.  If this authorization fails, the\n   Diameter server must set the Result-Code\
    \ AVP to\n   DIAMETER_ERROR_IDENTITIES_DONT_MATCH and send it in a Diameter\n\
    \   Multimedia-Auth-Answer (MAA) message.\n      Note: Correlation between User-Name\
    \ and SIP-AOR AVP values is only\n      required for SIP REGISTER request, to\
    \ prevent a user from\n      registering a SIP-AOR allocated to another user.\
    \  In other types\n      of SIP requests (e.g., INVITE), the SIP-AOR indicates\
    \ the intended\n      destination of the request, rather than the originator of\
    \ it.\n   The Diameter server MUST verify whether the authentication scheme\n\
    \   (SIP-Authentication-Scheme AVP value) indicated in the grouped\n   SIP-Auth-Data-Item\
    \ AVP is supported or not.  If that authentication\n   scheme is not supported,\
    \ then the Diameter server MUST set the\n   Result-Code AVP to DIAMETER_ERROR_AUTH_SCHEME_NOT_SUPPORTED\
    \ and send\n   it in a Diameter Multimedia-Auth-Answer (MAA) message.\n   If the\
    \ SIP-Number-Auth-Items AVP is present in the Diameter MAR\n   message, it indicates\
    \ the number of authentication data items that\n   the Diameter client is requesting.\
    \  It is RECOMMENDED that the\n   Diameter server, when building the Diameter\
    \ MAA message, includes a\n   number of SIP-Auth-Data-Item AVPs that are a subset\
    \ of the\n   authentication data items requested by the Diameter client in the\n\
    \   SIP-Number-Auth-Items AVP value of the Diameter MAR message.\n   If the SIP-Server-URI\
    \ AVP is present in the Diameter MAR message,\n   then the Diameter server MUST\
    \ compare the stored SIP server (assigned\n   to the user) with the SIP-Server-URI\
    \ AVP value (received in the\n   Diameter MAR message).  If they don't match,\
    \ the Diameter server MUST\n   temporarily save the newly received SIP server\
    \ assigned to the user,\n   and MUST set an \"authentication pending\" flag for\
    \ the user.  If they\n   match, the Diameter server shall clear the \"authentication\
    \ pending\"\n   flag for the user.\n   In any other situation, if there is a success\
    \ in processing the\n   Diameter MAR command and the Diameter server stored the\n\
    \   SIP-Server-URI, the Diameter server MUST set the Result-Code AVP\n   value\
    \ to DIAMETER_SUCCESS and return it in a Diameter MAA message.\n   If there is\
    \ a success in processing the Diameter MAR command, but the\n   Diameter server\
    \ does not store the SIP-Server-URI because the AVP was\n   not present in the\
    \ Diameter MAR command, then the Diameter server\n   MUST set the Result-Code\
    \ AVP value to either:\n   1.  DIAMETER_SUCCESS_AUTH_SENT_SERVER_NOT_STORED, if\
    \ the Diameter\n       server is sending authentication credentials to create\
    \ a\n       challenge.\n   2.  DIAMETER_SUCCESS_SERVER_NAME_NOT_STORED, if the\
    \ Diameter server\n       successfully authenticated the user and authorized the\
    \ SIP server\n       to proceed with the SIP request.\n   Otherwise, the Diameter\
    \ server MUST set the Result-Code AVP value to\n   DIAMETER_UNABLE_TO_COMPLY,\
    \ and it MUST NOT include any\n   SIP-Auth-Data-Item AVP.\n   The Message Format\
    \ of the MAA command is as follows:\n       <MAA> ::= < Diameter Header: 286,\
    \ PXY >\n                 < Session-Id >\n                 { Auth-Application-Id\
    \ }\n                 { Result-Code }\n                 { Auth-Session-State }\n\
    \                 { Origin-Host }\n                 { Origin-Realm }\n       \
    \          [ User-Name ]\n                 [ SIP-AOR ]\n                 [ SIP-Number-Auth-Items\
    \ ]\n               * [ SIP-Auth-Data-Item ]\n                 [ Authorization-Lifetime\
    \ ]\n                 [ Auth-Grace-Period ]\n                 [ Redirect-Host\
    \ ]\n                 [ Redirect-Host-Usage ]\n                 [ Redirect-Max-Cache-Time\
    \ ]\n               * [ Proxy-Info ]\n               * [ Route-Record ]\n    \
    \           * [ AVP ]\n"
- title: 8.9.  Registration-Termination-Request (RTR) Command
  contents:
  - "8.9.  Registration-Termination-Request (RTR) Command\n   The Registration-Termination-Request\
    \ (RTR) command is indicated by\n   the Command-Code set to 287 and the Command\
    \ Flags' 'R' bit set.  The\n   Diameter server sends this command to the Diameter\
    \ client in a SIP\n   server to indicate to the SIP server that one or more SIP\
    \ AORs have\n   to be deregistered.  The command allows an operator to\n   administratively\
    \ cancel the registration of a user from a centralized\n   Diameter server.\n\
    \   The Diameter server has the capability to initiate the deregistration\n  \
    \ of a user and inform the SIP server by means of the Diameter RTR\n   command.\
    \  The Diameter server can decide whether only one SIP AOR is\n   going to be\
    \ deregistered, a list of SIP AORs, or all the SIP AORs\n   allocated to the user.\n\
    \   The absence of a SIP-AOR AVP in the Diameter RTR message indicates\n   that\
    \ all the SIP AORs allocated to the user identified by the\n   User-Name AVP are\
    \ being deregistered.\n   The Diameter server MUST include a SIP-Deregistration-Reason\
    \ AVP\n   value to indicate the reason for the deregistration.\n   The Message\
    \ Format of the RTR command is as follows:\n       <RTR> ::= < Diameter Header:\
    \ 287, REQ, PXY >\n                 < Session-Id >\n                 { Auth-Application-Id\
    \ }\n                 { Auth-Session-State }\n                 { Origin-Host }\n\
    \                 { Origin-Realm }\n                 { Destination-Host }\n  \
    \               { SIP-Deregistration-Reason }\n                 [ Destination-Realm\
    \ ]\n                 [ User-Name ]\n               * [ SIP-AOR ]\n          \
    \     * [ Proxy-Info ]\n               * [ Route-Record ]\n               * [\
    \ AVP ]\n"
- title: 8.10.  Registration-Termination-Answer (RTA) Command
  contents:
  - "8.10.  Registration-Termination-Answer (RTA) Command\n   The Registration-Termination-Answer\
    \ (RTA) is indicated by the\n   Command-Code set to 287 and the Command Flags'\
    \ 'R' bit cleared.  The\n   Diameter client sends this command in response to\
    \ a previously\n   received Diameter Registration-Termination-Request (RTR) command.\n\
    \   In addition to the values already defined in RFC 3588 [RFC3588], the\n   Result-Code\
    \ AVP may contain one of the values defined in\n   Section 10.1.\n   If the SIP\
    \ server (Diameter client) requires a User-Name AVP value to\n   process the Diameter\
    \ RTR request, but the Diameter RTR message did\n   not contain a User-Name AVP\
    \ value, the Diameter client MUST set the\n   Result-Code AVP value to DIAMETER_USER_NAME_REQUIRED\
    \ (see Section\n   10.1.2) and return it in a Diameter RTA message.\n   The SIP\
    \ server (Diameter client) applies the administrative\n   deregistration to each\
    \ of the URIs included in each of the SIP-AOR\n   AVP values, or, if there is\
    \ no SIP-AOR AVP present in the Diameter\n   RTR request, to all the URIs allocated\
    \ to the User-Name AVP value.\n   The value of the SIP-Deregistration-Reason AVP\
    \ in the Diameter RTR\n   command has an effect on the actions performed at the\
    \ SIP server\n   (Diameter client):\n   o  If the value is set to PERMANENT_TERMINATION,\
    \ then the user has\n      terminated his/her registration to the realm.  If informing\
    \ the\n      interested parties (e.g., subscribers to the \"reg\" event\n    \
    \  [RFC3680]) about the administrative deregistration is supported\n      through\
    \ SIP procedures, the SIP server (Diameter client) will do\n      so.  The Diameter\
    \ Client in the SIP Server SHOULD NOT request a\n      new user registration.\
    \  The SIP server clears the registration\n      state of the deregistered AORs.\n\
    \   o  If the value is set to NEW_SIP_SERVER_ASSIGNED, the Diameter\n      server\
    \ informs the SIP server (Diameter client) that a new SIP\n      server has been\
    \ allocated to the user, due to some reason.  The\n      SIP server, if supported\
    \ through SIP procedures, will inform the\n      interested parties (e.g., subscribers\
    \ to the \"reg\" event\n      [RFC3680]) about the administrative deregistration\
    \ at this SIP\n      server.  The Diameter client in the SIP server SHOULD NOT\
    \ request\n      a new user registration.  The SIP server clears the registration\n\
    \      state of the deregistered SIP AORs.\n   o  If the value is set to SIP_SERVER_CHANGE,\
    \ the Diameter server\n      informs the SIP server (Diameter client) that a new\
    \ SIP server has\n      to be allocated to the user, e.g., due to user's capabilities\n\
    \      requiring a new SIP server, or not enough resources in the current\n  \
    \    SIP server.  If informing the interested parties about the\n      administrative\
    \ deregistration is supported through SIP procedures\n      (e.g., subscriptions\
    \ to the \"reg\" event [RFC3680]), the SIP server\n      will do so.  The Diameter\
    \ client in the SIP Server SHOULD NOT\n      request a new user registration.\
    \  The SIP server clears the\n      registration state of the deregistered SIP\
    \ AORs.\n   o  If the value is set to REMOVE_SIP_SERVER, the Diameter server\n\
    \      informs the SIP server (Diameter client) that the SIP server will\n   \
    \   no longer be bound in the Diameter server with that user.  The SIP\n     \
    \ server can delete all data related to the user.\n   The Message Format of the\
    \ RTA command is as follows:\n       <RTA> ::= < Diameter Header: 287, PXY >\n\
    \                 < Session-Id >\n                 { Auth-Application-Id }\n \
    \                { Result-Code }\n                 { Auth-Session-State }\n  \
    \               { Origin-Host }\n                 { Origin-Realm }\n         \
    \        [ Authorization-Lifetime ]\n                 [ Auth-Grace-Period ]\n\
    \                 [ Redirect-Host ]\n                 [ Redirect-Host-Usage ]\n\
    \                 [ Redirect-Max-Cache-Time ]\n               * [ Proxy-Info ]\n\
    \               * [ Route-Record ]\n               * [ AVP ]\n"
- title: 8.11.  Push-Profile-Request (PPR) Command
  contents:
  - "8.11.  Push-Profile-Request (PPR) Command\n   The Push-Profile-Request (PPR)\
    \ command is indicated by the\n   Command-Code set to 288 and the Command Flags'\
    \ 'R' bit set.  The\n   Diameter server sends this command to the Diameter client\
    \ in a SIP\n   server to update either the user profile of an already registered\n\
    \   user in that SIP server or the SIP accounting information.  This\n   allows\
    \ an operator to modify the data of a user profile or the\n   accounting information\
    \ and push it to the SIP server where the user\n   is registered.\n   Each user\
    \ has a user profile associated with him/her and other\n   accounting information.\
    \  The profile or the accounting information\n   may change with time, e.g., due\
    \ to addition of new services to the\n   user.  When the user profile or the accounting\
    \ information changes,\n   the Diameter server sends a Diameter Push-Profile-Request\
    \ (PPR)\n   command to the Diameter client in a SIP server, in order to start\n\
    \   applying those new services.\n   A PPR command MAY contain a SIP-Accounting-Information\
    \ AVP that\n   updates the addresses of the accounting servers.  Changes in the\n\
    \   addresses of the accounting servers take effect immediately.  The\n   Diameter\
    \ client SHOULD close any existing accounting session with the\n   existing server\
    \ and start providing accounting information to the\n   newly acquired accounting\
    \ server.\n   A PPR command MAY contain zero or more SIP-User-Data AVP values\n\
    \   containing the new user profile.  On selecting the type of user data,\n  \
    \ the Diameter server SHOULD take into account the supported formats at\n   the\
    \ SIP server (SIP-Supported-User-Data-Type AVP sent in a previous\n   SAR message)\
    \ and the local policy.\n   The User-Name AVP indicates the user to whom the profile\
    \ is\n   applicable.\n   The Message Format of the PPR command is as follows:\n\
    \       <PPR> ::= < Diameter Header: 288, REQ, PXY >\n                 < Session-Id\
    \ >\n                 { Auth-Application-Id }\n                 { Auth-Session-State\
    \ }\n                 { Origin-Host }\n                 { Origin-Realm }\n   \
    \              { Destination-Realm }\n                 { User-Name }\n       \
    \        * [ SIP-User-Data ]\n                 [ SIP-Accounting-Information ]\n\
    \                 [ Destination-Host ]\n                 [ Authorization-Lifetime\
    \ ]\n                 [ Auth-Grace-Period ]\n               * [ Proxy-Info ]\n\
    \               * [ Route-Record ]\n               * [ AVP ]\n"
- title: 8.12.  Push-Profile-Answer (PPA) Command
  contents:
  - "8.12.  Push-Profile-Answer (PPA) Command\n   The Push-Profile-Answer (PPA) is\
    \ indicated by the Command-Code set to\n   288 and the Command Flags' 'R' bit\
    \ cleared.  The Diameter client\n   sends this command in response to a previously\
    \ received Diameter\n   Push-Profile-Request (PPR) command.\n   In addition to\
    \ the values already defined in RFC 3588 [RFC3588], the\n   Result-Code AVP may\
    \ contain one of the values defined in\n   Section 10.1.\n   If there is no error\
    \ when processing the received Diameter PPR\n   message, the SIP server (Diameter\
    \ client) MUST download the received\n   user profile from the SIP-User-Data AVP\
    \ values in the Diameter PPR\n   message and store it associated with the user\
    \ specified in the\n   User-Name AVP value.\n   If the SIP server does not recognize\
    \ or does not support some of the\n   data transferred in the SIP-User-Data AVP\
    \ values, the Diameter client\n   in the SIP server MUST return a Diameter PPA\
    \ message that includes a\n   Result-Code AVP set to the value\n   DIAMETER_ERROR_NOT_SUPPORTED_USER_DATA.\n\
    \   If the SIP server (Diameter client) receives a Diameter PPR message\n   with\
    \ a User-Name AVP that is unknown, the Diameter client MUST set\n   the Result-Code\
    \ AVP value to DIAMETER_ERROR_USER_UNKNOWN and MUST\n   return it to the Diameter\
    \ server in a Diameter PPA message.\n   If the SIP server (Diameter client) receives\
    \ in the\n   SIP-User-Data-Content AVP value (of the grouped SIP-User-Data AVP)\n\
    \   more data than it can accept, it MUST set the Result-Code AVP value\n   to\
    \ DIAMETER_ERROR_TOO_MUCH_DATA and MUST return it to the Diameter\n   server in\
    \ a Diameter PPA message.  The SIP server MUST NOT override\n   the existing user\
    \ profile with the one received in the PPR message.\n   If the Diameter server\
    \ receives the Result-Code AVP value set to\n   DIAMETER_ERROR_TOO_MUCH_DATA in\
    \ a Diameter PPA message, it SHOULD\n   force a new re-registration of the user\
    \ by sending to the Diameter\n   client a Diameter Registration-Termination-Request\
    \ (RTR) with the\n   SIP-Deregistration-Reason AVP value set to SIP_SERVER_CHANGE.\
    \  This\n   will force a re-registration of the user and will trigger a selection\n\
    \   of a new SIP server.\n   If the Diameter client is not able to honor the command,\
    \ for any\n   other reason, it MUST set the Result-Code AVP value to\n   DIAMETER_UNABLE_TO_COMPLY\
    \ and it MUST return it in a Diameter PPA\n   message.\n   The Message Format\
    \ of the PPA command is as follows:\n       <PPA> ::= < Diameter Header: 288,\
    \ PXY >\n                 < Session-Id >\n                 { Auth-Application-Id\
    \ }\n                 { Result-Code }\n                 { Auth-Session-State }\n\
    \                 { Origin-Host }\n                 { Origin-Realm }\n       \
    \          [ Redirect-Host ]\n                 [ Redirect-Host-Usage ]\n     \
    \            [ Redirect-Max-Cache-Time ]\n               * [ Proxy-Info ]\n  \
    \             * [ Route-Record ]\n               * [ AVP ]\n"
- title: 9.  Diameter SIP Application AVPs
  contents:
  - "9.  Diameter SIP Application AVPs\n   This section defines new AVPs used in this\
    \ Diameter SIP application.\n   Applications compliant with this specification\
    \ MUST implement these\n   AVPs.\n   Table 2 lists the new AVPs defined in this\
    \ Diameter SIP application.\n   The following abbreviations are used in the Data-Type\
    \ column:\n   o  DURI: DiameterURI\n   o  E: Enumerated\n   o  G: Grouped\n  \
    \ o  OS: OctetString\n   o  UTF8S: UTF8String\n   o  U32: Unsigned32\n   +-----------------------------------+------+----------------+-------+\n\
    \   | Attribute Name                    | AVP  | Reference      | Data- |\n  \
    \ |                                   | Code |                | Type  |\n   +-----------------------------------+------+----------------+-------+\n\
    \   | SIP-Accounting-Information        |  368 | Section 9.1    | G     |\n  \
    \ | SIP-Accounting-Server-URI         |  369 | Section 9.1.1  | DURI  |\n   |\
    \ SIP-Credit-Control-Server-URI     |  370 | Section 9.1.2  | DURI  |\n   | SIP-Server-URI\
    \                    |  371 | Section 9.2    | UTF8S |\n   | SIP-Server-Capabilities\
    \           |  372 | Section 9.3    | G     |\n   | SIP-Mandatory-Capability \
    \         |  373 | Section 9.3.1  | U32   |\n   | SIP-Optional-Capability    \
    \       |  374 | Section 9.3.2  | U32   |\n   | SIP-Server-Assignment-Type   \
    \     |  375 | Section 9.4    | E     |\n   | SIP-Auth-Data-Item             \
    \   |  376 | Section 9.5    | G     |\n   | SIP-Authentication-Scheme        \
    \ |  377 | Section 9.5.1  | E     |\n   | SIP-Item-Number                   |\
    \  378 | Section 9.5.2  | U32   |\n   | SIP-Authenticate                  |  379\
    \ | Section 9.5.3  | G     |\n   | SIP-Authorization                 |  380 |\
    \ Section 9.5.4  | G     |\n   | SIP-Authentication-Info           |  381 | Section\
    \ 9.5.5  | G     |\n   | SIP-Number-Auth-Items             |  382 | Section 9.6\
    \    | U32   |\n   | SIP-Deregistration-Reason         |  383 | Section 9.7  \
    \  | G     |\n   | SIP-Reason-Code                   |  384 | Section 9.7.1  |\
    \ E     |\n   | SIP-Reason-Info                   |  385 | Section 9.7.2  | UTF8S\
    \ |\n   | SIP-Visited-Network-Id            |  386 | Section 9.9    | UTF8S |\n\
    \   | SIP-User-Authorization-Type       |  387 | Section 9.10   | E     |\n  \
    \ | SIP-Supported-User-Data-Type      |  388 | Section 9.11   | UTF8S |\n   |\
    \ SIP-User-Data                     |  389 | Section 9.12   | G     |\n   | SIP-User-Data-Type\
    \                |  390 | Section 9.12.1 | UTF8S |\n   | SIP-User-Data-Contents\
    \            |  391 | Section 9.12.2 | OS    |\n   | SIP-User-Data-Already-Available\
    \   |  392 | Section 9.13   | E     |\n   | SIP-Method                       \
    \ |  393 | Section 9.14   | UTF8S |\n   +-----------------------------------+------+----------------+-------+\n\
    \                           Table 2: Defined AVPs\n   Table 3 expands the table\
    \ of AVPs included in Section 4.5 of RFC 3588\n   [RFC3588].  The table indicates\
    \ the Diameter AVPs defined in this\n   Diameter SIP Application, their possible\
    \ flag values, and whether the\n   AVP may be encrypted.  The acronyms 'M', 'P',\
    \ and 'V' refer to AVP\n   flags whose semantics are described in RFC 3588 [RFC3588].\
    \  The value\n   of the 'Encr' column is also described in RFC 3588 [RFC3588].\n\
    \   +----------------------------------+------+-----+-----+------+------+\n  \
    \ | Attribute Name                   | MUST | MAY | SHD | MUST | Encr |\n   |\
    \                                  |      |     | NOT |  NOT |      |\n   +----------------------------------+------+-----+-----+------+------+\n\
    \   | SIP-Accounting-Information       |   M  |  P  |     |   V  |   N  |\n  \
    \ | SIP-Accounting-Server-URI        |   M  |  P  |     |   V  |   N  |\n   |\
    \ SIP-Credit-Control-Server-URI    |   M  |  P  |     |   V  |   N  |\n   | SIP-Server-URI\
    \                   |   M  |  P  |     |   V  |   N  |\n   | SIP-Server-Capabilities\
    \          |   M  |  P  |     |   V  |   N  |\n   | SIP-Mandatory-Capability \
    \        |   M  |  P  |     |   V  |   N  |\n   | SIP-Optional-Capability    \
    \      |   M  |  P  |     |   V  |   N  |\n   | SIP-Server-Assignment-Type   \
    \    |   M  |  P  |     |   V  |   N  |\n   | SIP-Auth-Data-Item             \
    \  |   M  |  P  |     |   V  |   N  |\n   | SIP-Authentication-Scheme        |\
    \   M  |  P  |     |   V  |   N  |\n   | SIP-Item-Number                  |  \
    \ M  |  P  |     |   V  |   N  |\n   | SIP-Authenticate                 |   M\
    \  |  P  |     |   V  |   N  |\n   | SIP-Authorization                |   M  |\
    \  P  |     |   V  |   N  |\n   | SIP-Authentication-Info          |   M  |  P\
    \  |     |   V  |   N  |\n   | SIP-Number-Auth-Items            |   M  |  P  |\
    \     |   V  |   N  |\n   | SIP-Deregistration-Reason        |   M  |  P  |  \
    \   |   V  |   N  |\n   | SIP-Reason-Code                  |   M  |  P  |    \
    \ |   V  |   N  |\n   | SIP-Reason-Info                  |   M  |  P  |     |\
    \   V  |   N  |\n   | SIP-Visited-Network-Id           |   M  |  P  |     |  \
    \ V  |   N  |\n   | SIP-User-Authorization-Type      |   M  |  P  |     |   V\
    \  |   N  |\n   | SIP-Supported-User-Data-Type     |   M  |  P  |     |   V  |\
    \   N  |\n   | SIP-User-Data                    |   M  |  P  |     |   V  |  \
    \ N  |\n   | SIP-User-Data-Type               |   M  |  P  |     |   V  |   N\
    \  |\n   | SIP-User-Data-Contents           |   M  |  P  |     |   V  |   N  |\n\
    \   | SIP-User-Data-Already-Available  |   M  |  P  |     |   V  |   N  |\n  \
    \ | SIP-Method                       |   M  |  P  |     |   V  |   N  |\n   +----------------------------------+------+-----+-----+------+------+\n\
    \                  Table 3: Summary of the new AVPs flags\n"
- title: 9.1.  SIP-Accounting-Information AVP
  contents:
  - "9.1.  SIP-Accounting-Information AVP\n   The SIP-Accounting-Information (AVP\
    \ Code 368) is of type Grouped, and\n   contains the Diameter addresses of those\
    \ nodes that are able to\n   collect accounting information.\n   The SIP-Accounting-Information\
    \ AVP is defined as follows (per the\n   grouped-avp-def of RFC 3588 [RFC3588]):\n\
    \      SIP-Accounting-Information ::= < AVP Header: 368 >\n                  \
    \                 * [ SIP-Accounting-Server-URI ]\n                          \
    \         * [ SIP-Credit-Control-Server-URI ]\n                              \
    \     * [ AVP]\n"
- title: 9.1.1.  SIP-Accounting-Server-URI AVP
  contents:
  - "9.1.1.  SIP-Accounting-Server-URI AVP\n   The SIP-Accounting-Server-URI AVP (AVP\
    \ Code 369) is of type\n   DiameterURI.  This AVP contains the address of a Diameter\
    \ server that\n   is able to receive SIP-session-related accounting information.\n"
- title: 9.1.2.  SIP-Credit-Control-Server-URI AVP
  contents:
  - "9.1.2.  SIP-Credit-Control-Server-URI AVP\n   The SIP-Credit-Control-Server-URI\
    \ AVP (AVP Code 370) is of type\n   DiameterURI.  This AVP contains the address\
    \ of a Diameter server that\n   is able to authorize real-time credit control\
    \ usage.  The Diameter\n   Credit-Control Application [RFC4006] may be used for\
    \ this purpose.\n"
- title: 9.2.  SIP-Server-URI AVP
  contents:
  - "9.2.  SIP-Server-URI AVP\n   The SIP-Server-URI AVP (AVP Code 371) is of type\
    \ UTF8String.  This\n   AVP contains a SIP or SIPS URI (as defined in RFC 3261\
    \ [RFC3261])\n   that identifies a SIP server.\n"
- title: 9.3.  SIP-Server-Capabilities AVP
  contents:
  - "9.3.  SIP-Server-Capabilities AVP\n   The SIP-Server-Capabilities AVP (AVP Code\
    \ 372) is of type Grouped.\n   The Diameter indicates in this AVP the requirements\
    \ for a particular\n   SIP capability, so that the Diameter client (SIP server)\
    \ is able to\n   select another appropriate SIP server to serve the user.\n  \
    \ The SIP-Server-Capabilities AVP allows a Diameter client (SIP server)\n   to\
    \ select another SIP server for triggering or executing services to\n   the user.\
    \  A user may have enabled some services that require the\n   implementation of\
    \ certain capabilities in the SIP server that\n   triggers or executes those services.\
    \  For example, the SIP server\n   that triggers or executes services to this\
    \ user may need to implement\n   SIP servlets [JSR-000116], Call Processing Language\
    \ (CPL) [RFC3880],\n   or any other kind of capability.  Or perhaps that user\
    \ belongs to a\n   premium users group that has a certain stringent quality-of-service\n\
    \   agreement that requires a fast SIP server.  The capabilities required\n  \
    \ or recommended to a given user are conveyed in the\n   SIP-Server-Capabilities\
    \ AVP.  When it receives them, the Diameter\n   client (SIP server) that does\
    \ the SIP server selection needs to have\n   the means to find out available SIP\
    \ servers that meet the required or\n   optional capabilities.  Such means are\
    \ outside the scope of this\n   specification.\n   Note that the SIP-Server-Capabilities\
    \ AVP assists the Diameter client\n   (SIP server) to produce a subset of all\
    \ the available SIP servers to\n   be allocated to the user in the Home Realm;\
    \ this is the subset that\n   conforms the requirements of capabilities on a per-user\
    \ basis.\n   Typically this subset will be formed of more than a single SIP\n\
    \   server, so once the subset of those SIP servers is identified, it is\n   possible\
    \ that several instances of these SIP servers exist, in which\n   case the Diameter\
    \ client (SIP server) should choose one particular\n   SIP server to execute and\
    \ trigger services to this user.  It is\n   expected that at this point the SIP\
    \ server (Diameter client) will\n   follow the procedures of RFC 3263 [RFC3263]\
    \ to allocate one SIP\n   server to the user.\n   The SIP-Server-Capabilities\
    \ AVP is defined as follows (per the\n   grouped-avp-def of RFC 3588 [RFC3588]):\n\
    \      SIP-Server-Capabilities ::= < AVP Header: 372 >\n                     \
    \           * [ SIP-Mandatory-Capability ]\n                                *\
    \ [ SIP-Optional-Capability ]\n                                * [ SIP-Server-URI\
    \ ]\n                                * [ AVP ]\n"
- title: 9.3.1.  SIP-Mandatory-Capability AVP
  contents:
  - "9.3.1.  SIP-Mandatory-Capability AVP\n   The SIP-Mandatory-Capability AVP (AVP\
    \ Code 373) is of type\n   Unsigned32.  The value represents a certain capability\
    \ (or set of\n   capabilities) that have to be fulfilled by the SIP server allocated\n\
    \   to the user.\n   The semantics of the different values are not standardized,\
    \ as it is\n   a matter of the administrative network to allocate its own semantics\n\
    \   within its own network.  Each value has to represent a single\n   capability\
    \ within the administrative network.\n"
- title: 9.3.2.  SIP-Optional-Capability AVP
  contents:
  - "9.3.2.  SIP-Optional-Capability AVP\n   The SIP-Optional-Capability AVP (AVP\
    \ Code 374) is of type Unsigned32.\n   The value represents a certain capability\
    \ (or set of capabilities)\n   that, optionally, may be fulfilled by the SIP server\
    \ allocated to the\n   user.\n   The semantics of the different values are not\
    \ standardized, as it is\n   a matter of the administrative network to allocate\
    \ its own semantics\n   within its own network.  Each value has to represent a\
    \ single\n   capability within the administrative network.\n"
- title: 9.4.  SIP-Server-Assignment-Type AVP
  contents:
  - "9.4.  SIP-Server-Assignment-Type AVP\n   The SIP-Server-Assignment-Type AVP (AVP\
    \ Code 375) is of type\n   Enumerated and indicates the type of server update\
    \ being performed in\n   a Diameter Server-Assignment-Request (SAR) operation.\
    \  The following\n   values are defined:\n   o  NO_ASSIGNMENT (0)\n      The Diameter\
    \ client uses this value to request the user profile of\n      a SIP AOR, without\
    \ affecting the registration state of that\n      identity.\n   o  REGISTRATION\
    \ (1)\n      First SIP registration of a SIP AOR.\n   o  RE_REGISTRATION (2)\n\
    \      Subsequent SIP registration of a SIP AOR.\n   o  UNREGISTERED_USER (3)\n\
    \      The SIP server has received a SIP request (e.g., SIP INVITE)\n      addressed\
    \ for a SIP AOR that is not registered.\n   o  TIMEOUT_DEREGISTRATION (4)\n  \
    \    The SIP registration timer of an identity has expired.\n   o  USER_DEREGISTRATION\
    \ (5)\n      The SIP server has received a request to deregister a SIP AOR.\n\
    \   o  TIMEOUT_DEREGISTRATION_STORE_SERVER_NAME (6)\n      The SIP registration\
    \ timer of an identity has expired.  The SIP\n      server keeps the user data\
    \ stored and requests the Diameter server\n      to store the SIP server address.\n\
    \   o  USER_DEREGISTRATION_STORE_SERVER_NAME (7)\n      The SIP server has received\
    \ a user-initiated deregistration\n      request.  The SIP server keeps the user\
    \ data stored and requests\n      the Diameter server to store the SIP server\
    \ address.\n   o  ADMINISTRATIVE_DEREGISTRATION (8)\n      The SIP server, due\
    \ to administrative reasons, has deregistered a\n      SIP AOR.\n   o  AUTHENTICATION_FAILURE\
    \ (9)\n      The authentication of a user has failed.\n   o  AUTHENTICATION_TIMEOUT\
    \ (10)\n      The authentication timer has expired.\n   o  DEREGISTRATION_TOO_MUCH_DATA\
    \ (11)\n      The SIP server has requested user profile information from the\n\
    \      Diameter server and has received a volume of data higher than it\n    \
    \  can accept.\n"
- title: 9.5.  SIP-Auth-Data-Item AVP
  contents:
  - "9.5.  SIP-Auth-Data-Item AVP\n   The SIP-Auth-Data-Item (AVP Code 376) is of\
    \ type Grouped and contains\n   the authentication and/or authorization information\
    \ pertaining to a\n   user.\n   When the Diameter server uses the grouped SIP-Auth-Data-Item\
    \ AVP to\n   include a SIP-Authenticate AVP, the Diameter server MUST send a\n\
    \   maximum of one authentication data item (e.g., in case the SIP\n   request\
    \ contained several credentials).  Section 11 contains a\n   detailed discussion\
    \ and normative text of the case when a SIP request\n   contains several credentials.\n\
    \   The SIP-Auth-Data-Item AVP is defined as follows (per the\n   grouped-avp-def\
    \ of RFC 3588 [RFC3588]):\n      SIP-Auth-Data-Item ::= < AVP Header: 376 >\n\
    \                             { SIP-Authentication-Scheme }\n                \
    \             [ SIP-Item-Number ]\n                             [ SIP-Authenticate\
    \ ]\n                             [ SIP-Authorization ]\n                    \
    \         [ SIP-Authentication-Info ]\n                           * [ AVP ]\n"
- title: 9.5.1.  SIP-Authentication-Scheme AVP
  contents:
  - "9.5.1.  SIP-Authentication-Scheme AVP\n   The SIP-Authentication-Scheme AVP (AVP\
    \ Code 377) is of type\n   Enumerated and indicates the authentication scheme\
    \ used in the\n   authentication of SIP services.  RFC 2617 identifies this value\
    \ as an\n   \"auth-scheme\" (see Section 1.2 of RFC 2617 [RFC2617]).  The only\n\
    \   currently defined value is:\n   o  DIGEST (0) to indicate HTTP Digest authentication\
    \ as specified in\n      RFC 2617 [RFC2617] Section 3.2.1.  Derivative work is\
    \ also\n      considered Digest authentication scheme, as long as the\n      \"\
    auth-scheme\" is identified as Digest in the SIP headers carrying\n      the HTTP\
    \ authentication.  This includes, e.g., the HTTP Digest\n      authentication\
    \ using AKA [RFC3310].\n   Each HTTP Digest directive (parameter) is transported\
    \ in a\n   corresponding AVP, whose name follows the pattern Digest-*.  The\n\
    \   Digest-* AVPs are RADIUS attributes imported from the RADIUS\n   Extension\
    \ for Digest Authentication [RFC4590] namespace, allowing a\n   smooth transition\
    \ between RADIUS and Diameter applications supporting\n   SIP.  The Diameter SIP\
    \ application goes a step further by grouping\n   the Digest-* AVPs into the SIP-Authenticate,\
    \ SIP-Authorization, and\n   SIP-Authentication-Info grouped AVPs that correspond\
    \ to the SIP WWW-\n   Authenticate/Proxy-Authentication, Authorization/Proxy-Authorization,\n\
    \   and Authentication-Info headers fields, respectively.\n      Note: Due to\
    \ the fact that HTTP Digest authentication [RFC2617] is\n      the only mandatory\
    \ authentication mechanism in SIP, this memo only\n      provides support for\
    \ HTTP Digest authentication and derivative\n      work such as HTTP Digest authentication\
    \ using AKA [RFC3310].\n      Extensions to this memo can register new values\
    \ and new AVPs to\n      provide support for other authentication schemes or extensions\
    \ to\n      HTTP Digest authentication.\n      Note: Although RFC 2617 [RFC2617]\
    \ defines the Basic and Digest\n      schemes for authenticating HTTP requests,\
    \ RFC 3261 [RFC3261] only\n      imports HTTP Digest as a mechanism to provide\
    \ authentication in\n      SIP.\n   Due to syntactic requirements, HTTP Digest\
    \ authentication has to\n   escape quote characters in contents of HTTP Digest\
    \ directives.  When\n   translating directives into Digest-* AVPs, the Diameter\
    \ client or\n   server removes the surrounding quotes where present, as required\
    \ by\n   the syntax of the Digest-* attributes defined in the \"RADIUS\n   Extension\
    \ for Digest Authentication\" [RFC4590].\n"
- title: 9.5.2.  SIP-Item-Number AVP
  contents:
  - "9.5.2.  SIP-Item-Number AVP\n   The SIP-Item-Number (AVP Code 378) is of type\
    \ Unsigned32 and is\n   included in a SIP-Auth-Data-Item grouped AVP in circumstances\
    \ where\n   there are multiple occurrences of SIP-Auth-Data-Item AVPs and the\n\
    \   order of processing is relevant.  The AVP indicates the order in\n   which\
    \ the Grouped SIP-Auth-Data-Item should be processed.  Lower\n   values of the\
    \ SIP-Item-Number AVP indicate that the whole\n   SIP-Auth-Data-Item SHOULD be\
    \ processed before other\n   SIP-Auth-Data-Item AVPs that contain higher values\
    \ in the\n   SIP-Item-Number AVP.\n"
- title: 9.5.3.  SIP-Authenticate AVP
  contents:
  - "9.5.3.  SIP-Authenticate AVP\n   The SIP-Authenticate AVP (AVP Code 379) is of\
    \ type Grouped and\n   contains a reconstruction of either the SIP WWW-Authenticate\
    \ or\n   Proxy-Authentication header fields specified in RFC 2617 [RFC2617]\n\
    \   for the HTTP Digest authentication scheme.  Additionally, the AVP may\n  \
    \ include a Digest-HA1 AVP that contains H(A1) (as defined in RFC 2617\n   [RFC2617]).\
    \  H(A1) allows the Diameter client to create an expected\n   response and compare\
    \ it with the Digest response received from the\n   SIP UA.\n   The SIP-Authenticate\
    \ AVP is defined as follows (per the\n   grouped-avp-def of RFC 3588 [RFC3588]):\n\
    \      SIP-Authenticate ::= < AVP Header: 379 >\n                           {\
    \ Digest-Realm }\n                           { Digest-Nonce }\n              \
    \             [ Digest-Domain ]\n                           [ Digest-Opaque ]\n\
    \                           [ Digest-Stale ]\n                           [ Digest-Algorithm\
    \ ]\n                           [ Digest-QoP ]\n                           [ Digest-HA1]\n\
    \                         * [ Digest-Auth-Param ]\n                         *\
    \ [ AVP ]\n"
- title: 9.5.4.  SIP-Authorization AVP
  contents:
  - "9.5.4.  SIP-Authorization AVP\n   The SIP-Authorization AVP (AVP Code 380) is\
    \ of type Grouped and\n   contains a reconstruction of either the SIP Authorization\
    \ or\n   Proxy-Authorization header fields specified in RFC 2617 [RFC2617] for\n\
    \   the HTTP Digest authentication scheme.\n   The SIP-Authorization AVP is defined\
    \ as follows (per the\n   grouped-avp-def of RFC 3588 [RFC3588]):\n      SIP-Authorization\
    \ ::= < AVP Header: 380 >\n                            { Digest-Username }\n \
    \                           { Digest-Realm }\n                            { Digest-Nonce\
    \ }\n                            { Digest-URI }\n                            {\
    \ Digest-Response }\n                            [ Digest-Algorithm ]\n      \
    \                      [ Digest-CNonce ]\n                            [ Digest-Opaque\
    \ ]\n                            [ Digest-QoP ]\n                            [\
    \ Digest-Nonce-Count ]\n                            [ Digest-Method]\n       \
    \                     [ Digest-Entity-Body-Hash ]\n                          *\
    \ [ Digest-Auth-Param ]\n                          * [ AVP ]\n"
- title: 9.5.5.  SIP-Authentication-Info AVP
  contents:
  - "9.5.5.  SIP-Authentication-Info AVP\n   The SIP-Authentication-Info AVP (AVP\
    \ Code 381) is of type Grouped and\n   contains a reconstruction of the SIP Authentication-Info\
    \ header\n   specified in RFC 2617 [RFC2617] for the HTTP Digest authentication\n\
    \   scheme.\n   The SIP-Authentication-Info AVP is defined as follows (per the\n\
    \   grouped-avp-def of RFC 3588 [RFC3588]):\n      SIP-Authentication-Info ::=\
    \ < AVP Header: 381 >\n                                  [ Digest-Nextnonce ]\n\
    \                                  [ Digest-QoP ]\n                          \
    \        [ Digest-Response-Auth ]\n                                  [ Digest-CNonce\
    \ ]\n                                  [ Digest-Nonce-Count ]\n              \
    \                  * [ AVP ]\n   Note that, in some cases, the Digest-Response-Auth\
    \ AVP cannot be\n   calculated at the Diameter server, but has to be calculated\
    \ at the\n   Diameter client (SIP server).  For example, if the value of the\n\
    \   quality of protection (qop) parameter in Digest is set to \"auth-int\",\n\
    \   then the response-digest (rspauth parameter value in Digest) is\n   calculated\
    \ with the hash of the body of the SIP response, which is\n   not available at\
    \ the Diameter server.  In this case, the Diameter\n   client (SIP server) must\
    \ calculate the response-digest once the body\n   of the SIP response is calculated.\n\
    \   Therefore, a value of \"auth-int\" in the Digest-QoP AVP of the\n   SIP-Authentication-Info\
    \ AVP indicates that the Diameter client (SIP\n   server) MUST compute the Digest\
    \ \"rspauth\" parameter value at the\n   Diameter client (SIP server).\n"
- title: 9.5.6.  Digest AVPs
  contents:
  - "9.5.6.  Digest AVPs\n   The following AVPs are RADIUS attributes defined in the\
    \ RADIUS\n   Extension for Digest Authentication [RFC4590] and imported by this\n\
    \   specification: Digest-AKA-Auts, Digest-Algorithm, Digest-Auth-Param,\n   Digest-CNonce,\
    \ Digest-Domain, Digest-Entity-Body-Hash, Digest-HA1,\n   Digest-Method, Digest-Nextnonce,\
    \ Digest-Nonce, Digest-Nonce-Count,\n   Digest-Opaque, Digest-QoP, Digest-Realm,\
    \ Digest-Response,\n   Digest-Response-Auth, Digest-URI, Digest-Username, and\
    \ Digest-Stale.\n"
- title: 9.5.6.1.  Considerations about Digest-HA1 AVP
  contents:
  - "9.5.6.1.  Considerations about Digest-HA1 AVP\n   The Digest-HA1 AVP contains\
    \ the value, pre-calculated at the Diameter\n   server, of H(A1) as defined in\
    \ RFC 2617 [RFC2617].  The Diameter\n   client can use H(A1) to calculate the\
    \ expected Digest response,\n   according to this challenge.  If the SIP UA is\
    \ in possession of the\n   credentials, the calculated expected response and the\
    \ response sent\n   from the SIP UA will match.  The Diameter server MAY include\
    \ this AVP\n   to enable and assist the SIP server in authenticating the SIP UA.\n\
    \   This scenario is not applicable when the Diameter server is\n   configured\
    \ to use a session MD5 (MD5-sess) algorithm, because the\n   Diameter server requires\
    \ the client nonce to compute the H(A1) before\n   sending it to the Diameter\
    \ client, and the client nonce might not be\n   available when the computation\
    \ of H(A1) is done.  Therefore, if the\n   final authentication is delegated to\
    \ the Diameter client, it is\n   RECOMMENDED to configure the Diameter server\
    \ to use algorithms\n   different than MD5-sess in HTTP Digest.\n   It is up to\
    \ the Diameter server to include a Digest-HA1 AVP.  The\n   Diameter server calculates\
    \ the Digest H(A1) with the username,\n   password, and realm (and nonce and cnonce,\
    \ if applicable) as inputs,\n   and places the result in the Digest-HA1 AVP value.\
    \  For more details\n   of the A1 computation, see RFC 2617 [RFC2617] Section\
    \ 3.2.2.2.  The\n   Diameter client can calculate the Digest expected response\
    \ with H(A1)\n   as input, as described in RFC 2617 [RFC2617] Section 3.2.2.\n\
    \   Section 11 provides further normative details about the usage of the\n   Digest-HA1\
    \ AVP.\n"
- title: 9.5.6.2.  Considerations about Digest-Entity-Body-Hash AVP
  contents:
  - "9.5.6.2.  Considerations about Digest-Entity-Body-Hash AVP\n   The Digest-Entity-Body-Hash\
    \ AVP contains a hash of the entity body\n   contained in the SIP message.  This\
    \ hash is required by HTTP Digest\n   with quality of protection set to \"auth-int\"\
    .  Diameter clients MUST\n   use this AVP to transport the hash of the entity\
    \ body when HTTP\n   Digest is the authentication mechanism and the Diameter server\n\
    \   requires verification of the integrity of the entity body (e.g., qop\n   parameter\
    \ set to \"auth-int\").\n   The clarifications described in Section 22.4 of RFC\
    \ 3261 [RFC3261]\n   about the hash of empty entity bodies apply to the\n   Digest-Entity-Body-Hash\
    \ AVP.\n"
- title: 9.5.6.3.  Considerations about Digest-Auth-Param AVP
  contents:
  - "9.5.6.3.  Considerations about Digest-Auth-Param AVP\n   The Digest-Auth-Param\
    \ AVP is the mechanism whereby the Diameter\n   client and Diameter server can\
    \ exchange possible extension parameters\n   contained in Digest headers that\
    \ are either not understood by the\n   Diameter client or for which there are\
    \ no corresponding stand-alone\n   AVPs.  Unlike the previously listed Digest-*\
    \ AVPs, the\n   Digest-Auth-Param contains not only the value, but also the parameter\n\
    \   name, since it is unknown to the Diameter client.  The Diameter node\n   MUST\
    \ insert one Digest parameter/value combination per AVP value.  If\n   the Digest\
    \ header contains several unknown parameters, then the\n   Diameter implementation\
    \ MUST repeat this AVP and each instance MUST\n   contain one different unknown\
    \ Digest parameter/value combination.\n   This AVP corresponds to the \"auth-param\"\
    \ parameter defined in Section\n   3.2.1 of RFC 2617 [RFC2617].\n   Example: Assume\
    \ that the Diameter server wants the SIP server to send\n   a \"foo\" parameter\
    \ with the value set to \"bar\", so that the SIP server\n   sends that combination\
    \ in a SIP WWW-Authenticate header field.  The\n   Diameter server builds a grouped\
    \ SIP-Authenticate AVP that contains a\n   Digest-Auth-Param whose value is set\
    \ to foo=\"bar\".  Then the SIP\n   server creates the WWW-Authenticate header\
    \ field with all the digest\n   parameters (received in Digest-* AVPs) and adds\
    \ the foo=\"bar\"\n   parameter to that header field.\n"
- title: 9.6.  SIP-Number-Auth-Items AVP
  contents:
  - "9.6.  SIP-Number-Auth-Items AVP\n   The SIP-Number-Auth-Items AVP (AVP Code 382)\
    \ is of type Unsigned32\n   and indicates the number of authentication and/or\
    \ authorization\n   credentials that the Diameter server included in a Diameter\
    \ message.\n   When the AVP is present in a request, it indicates the number of\n\
    \   SIP-Auth-Data-Items the Diameter client is requesting.  This can be\n   used,\
    \ for instance, when the SIP server is requesting several\n   pre-calculated authentication\
    \ credentials.  In the answer message,\n   the SIP-Number-Auth-Items AVP indicates\
    \ the actual number of items\n   that the Diameter server included.\n"
- title: 9.7.  SIP-Deregistration-Reason AVP
  contents:
  - "9.7.  SIP-Deregistration-Reason AVP\n   The SIP-Deregistration-Reason AVP (AVP\
    \ Code 383) is of type Grouped\n   and indicates the reason for a deregistration\
    \ operation.\n   The SIP-Deregistration-Reason AVP is defined as follows (per\
    \ the\n   grouped-avp-def of RFC 3588 [RFC3588]):\n      SIP-Deregistration-Reason\
    \ ::= < AVP Header: 383 >\n                                    { SIP-Reason-Code\
    \ }\n                                    [ SIP-Reason-Info ]\n               \
    \                   * [ AVP ]\n"
- title: 9.7.1.  SIP-Reason-Code AVP
  contents:
  - "9.7.1.  SIP-Reason-Code AVP\n   The SIP-Reason-Code AVP (AVP Code 384) is of\
    \ type Enumerated and\n   defines the reason for the network initiated deregistration.\
    \  The\n   following values are defined:\n   o  PERMANENT_TERMINATION (0)\n  \
    \ o  NEW_SIP_SERVER_ASSIGNED (1)\n   o  SIP_SERVER_CHANGE (2)\n   o  REMOVE_SIP_SERVER\
    \ (3)\n"
- title: 9.7.2.  SIP-Reason-Info AVP
  contents:
  - "9.7.2.  SIP-Reason-Info AVP\n   The SIP-Reason-Info AVP (AVP Code 385) is of\
    \ type UTF8String and\n   contains textual information that can be rendered to\
    \ the user, about\n   the reason for a deregistration.\n"
- title: 9.8.  SIP-AOR AVP
  contents:
  - "9.8.  SIP-AOR AVP\n   The SIP-AOR AVP is a RADIUS attribute imported from the\
    \ RADIUS\n   Extension for Digest Authentication [RFC4590] namespace, allowing\
    \ a\n   smooth transition between RADIUS and Diameter applications supporting\n\
    \   SIP.  The SIP-AOR AVP carries the URI of the intended user related to\n  \
    \ the SIP request (whose location in SIP may vary depending on the\n   actual\
    \ SIP request and whether the SIP server is acting on Diameter\n   due to a SIP-originated\
    \ or terminating requests).\n   The Diameter client (SIP server) uses the value\
    \ found in a SIP\n   Request-URI or a header field value of the SIP request to\
    \ construct\n   the SIP-AOR AVP.  The selection of a Request-URI or a particular\n\
    \   header field to create the value of the SIP-AOR AVP depends on the\n   semantics\
    \ of the SIP message and whether the SIP server is acting for\n   originating\
    \ or terminating requests.  For instance, when the SIP\n   server receives an\
    \ INVITE request addressed to the served user (e.g.,\n   the SIP server is receiving\
    \ a terminating SIP request), it maps the\n   SIP Request-URI of the SIP request\
    \ to this AVP.  However, when the\n   SIP server receives an INVITE request originated\
    \ by the served user,\n   it can map either the P-Asserted-Identity or the From\
    \ header field\n   values to this AVP.  If the SIP server is acting as a SIP registrar,\n\
    \   then it maps the To header field of the REGISTER request to the\n   SIP-AOR\
    \ AVP.\n"
- title: 9.9.  SIP-Visited-Network-Id AVP
  contents:
  - "9.9.  SIP-Visited-Network-Id AVP\n   The SIP-Visited-Network-Id AVP (AVP Code\
    \ 386) is of type UTF8String.\n   This AVP contains an identifier that helps the\
    \ home network identify\n   the visited network (e.g., the visited network domain\
    \ name), in order\n   to authorize roaming to that visited network.\n"
- title: 9.10.  SIP-User-Authorization-Type AVP
  contents:
  - "9.10.  SIP-User-Authorization-Type AVP\n   The SIP-User-Authorization-Type AVP\
    \ (AVP Code 387) is of type\n   Enumerated and indicates the type of user authorization\
    \ being\n   performed in a User Authorization operation, i.e., the Diameter\n\
    \   User-Authorization-Request (UAR) command.  The following values are\n   defined:\n\
    \   o  REGISTRATION (0)\n      This value is used for initial registration or\
    \ re-registration.\n      This is the default value.\n   o  DEREGISTRATION (1)\n\
    \      This value is used for deregistration.\n   o  REGISTRATION_AND_CAPABILITIES\
    \ (2)\n      This value is used for initial registration or re-registration\n\
    \      when the SIP server explicitly requests the Diameter server to get\n  \
    \    capability information.  This capability information helps the SIP\n    \
    \  server to allocate another SIP server to serve the user.\n"
- title: 9.11.  SIP-Supported-User-Data-Type AVP
  contents:
  - "9.11.  SIP-Supported-User-Data-Type AVP\n   The SIP-Supported-User-Data-Type\
    \ AVP (AVP Code 388) is of type\n   UTF8String and contains a string that identifies\
    \ the type of\n   supported user data (user profile, see SIP-User-Data AVP\n \
    \  (Section 9.12)) supported in the node.  The AVP can be repeated, if\n   the\
    \ SIP server supports several user data types.  In case of\n   repetition, the\
    \ Diameter client should order the different instances\n   of this AVP according\
    \ to its preferences.\n   When the Diameter client inserts this AVP in a SAR message,\
    \ it allows\n   the Diameter client to provide an indication to the Diameter server\n\
    \   of the types of user data supported by the SIP server.  The Diameter\n   server,\
    \ upon inspection of these AVPs, will return a suitable\n   SIP-User-Data AVP\
    \ (Section 9.12) of the type indicated in the\n   SIP-User-Data-Type AVP (Section\
    \ 9.12.1).\n"
- title: 9.12.  SIP-User-Data AVP
  contents:
  - "9.12.  SIP-User-Data AVP\n   The SIP-User-Data AVP (AVP Code 389) is of type\
    \ Grouped.  This AVP\n   allows the Diameter server to transport user-specific\
    \ data, such as a\n   user profile, to the SIP server (in the Diameter client).\
    \  The\n   Diameter server selects a type of user data that is understood by the\n\
    \   SIP server in the Diameter client, and has been indicated in a\n   SIP-Supported-User-Data-Type\
    \ AVP.  In case the Diameter client\n   indicated support for several types of\
    \ user data, the Diameter server\n   SHOULD choose the first type supported by\
    \ the client.\n   The SIP-User-Data grouped AVP contains a SIP-User-Data-Type\
    \ AVP that\n   indicates the type of user data included in the\n   SIP-User-Data-Contents-AVP.\n\
    \   The SIP-User-Data AVP is defined as follows (per the grouped-avp-def\n   of\
    \ RFC 3588 [RFC3588]):\n      SIP-User-Data ::= < AVP Header: 389 >\n        \
    \                { SIP-User-Data-Type }\n                        { SIP-User-Data-Contents\
    \ }\n                      * [ AVP ]\n"
- title: 9.12.1.  SIP-User-Data-Type AVP
  contents:
  - "9.12.1.  SIP-User-Data-Type AVP\n   The SIP-User-Data AVP (AVP Code 390) is of\
    \ type UTF8String and\n   contains a string that identifies the type of user data\
    \ included in\n   the SIP-User-Data AVP (Section 9.12).\n   This document does\
    \ not specify a convention to characterize the type\n   of user data contained\
    \ in the SIP-User-Data AVP (Section 9.12).  It\n   is believed that in most cases\
    \ this feature will be used in\n   environments controlled by a network administrator\
    \ who can configure\n   both the client and server to assign the same value type\
    \ at the\n   client and server.  It is also RECOMMENDED that organizations\n \
    \  developing their own profile of SIP-User-Data AVP (Section 9.12)\n   allocate\
    \ a type based on their canonical DNS name.  For instance,\n   organization \"\
    example.com\" can define several types of SIP-User-Data\n   and allocate the types\
    \ \"type1.dsa.example.com\",\n   \"type2.dsa.example.com\", and so on.  This convention\
    \ will avoid a\n   clash in the allocation of types of SIP-User-Data AVP (Section\
    \ 9.12).\n"
- title: 9.12.2.  SIP-User-Data-Contents AVP
  contents:
  - "9.12.2.  SIP-User-Data-Contents AVP\n   The SIP-User-Data-Contents AVP (AVP Code\
    \ 391) is of type OctetString.\n   The Diameter peers do not need to understand\
    \ the value of this AVP.\n   The AVP contains the user profile data required for\
    \ a SIP server to\n   give service to the user.\n"
- title: 9.13.  SIP-User-Data-Already-Available AVP
  contents:
  - "9.13.  SIP-User-Data-Already-Available AVP\n   The SIP-User-Data-Already-Available\
    \ AVP (AVP Code 392) is of type\n   Enumerated and gives an indication to the\
    \ Diameter server about\n   whether the Diameter client (SIP server) already received\
    \ the portion\n   of the user profile needed in order to serve the user.  The\
    \ following\n   values are defined:\n   o  USER_DATA_NOT_AVAILABLE (0)\n     \
    \ The Diameter client (SIP server) does not have the data that it\n      needs\
    \ to serve the user.\n   o  USER_DATA_ALREADY_AVAILABLE (1)\n      The Diameter\
    \ client (SIP server) already has received the data\n      that it needs to serve\
    \ the user.\n"
- title: 9.14.  SIP-Method AVP
  contents:
  - "9.14.  SIP-Method AVP\n   The SIP-Method-AVP (AVP Code 393) is of type UTF8String\
    \ and contains\n   the method of the SIP request that triggered the Diameter message.\n\
    \   The Diameter server MUST use this AVP solely for authorization of SIP\n  \
    \ requests, and MUST NOT use it to compute the Digest authentication.\n   To compute\
    \ the Digest authentication, the Diameter server MUST use\n   the Digest-Method\
    \ AVP instead.\n"
- title: 10.  New Values for Existing AVPs
  contents:
  - "10.  New Values for Existing AVPs\n   This section defines new values that the\
    \ Diameter SIP application\n   extends to already existing AVPs.\n"
- title: 10.1.  Extension to the Result-Code AVP Values
  contents:
  - "10.1.  Extension to the Result-Code AVP Values\n   The Result-Code AVP is already\
    \ defined in RFC 3588 [RFC3588].  In\n   addition to the values already defined\
    \ in RFC 3588 [RFC3588], the\n   Diameter SIP application defines the following\
    \ new Result-Code AVP\n   values:\n"
- title: 10.1.1.  Success Result-Code AVP Values
  contents:
  - "10.1.1.  Success Result-Code AVP Values\n   A Diameter peer uses Result-Code\
    \ AVP values that fall into the\n   success category to inform the remote peer\
    \ that a request has been\n   successfully completed.\n   o  DIAMETER_FIRST_REGISTRATION\
    \ 2003\n      The user was not previously registered.  The Diameter server has\n\
    \      now authorized the registration.\n   o  DIAMETER_SUBSEQUENT_REGISTRATION\
    \ 2004\n      The user is already registered.  The Diameter server has now\n \
    \     authorized the re-registration.\n   o  DIAMETER_UNREGISTERED_SERVICE 2005\n\
    \      The user is not currently registered, but the requested service\n     \
    \ can still be granted to the user.\n   o  DIAMETER_SUCCESS_SERVER_NAME_NOT_STORED\
    \ 2006\n      The request operation was successfully processed.  The Diameter\n\
    \      server does not keep a record of the SIP server address assigned\n    \
    \  to the user.\n   o  DIAMETER_SERVER_SELECTION 2007\n      The Diameter server\
    \ has authorized the registration.  The user has\n      already been assigned\
    \ a SIP server, but it may be necessary to\n      select a new SIP server for\
    \ the user.\n   o  DIAMETER_SUCCESS_AUTH_SENT_SERVER_NOT_STORED 2008\n      The\
    \ requested operation was successfully executed.  The Diameter\n      server is\
    \ sending a number of authentication credentials in the\n      answer message.\
    \  The Diameter server does not keep a record of the\n      SIP server.\n"
- title: 10.1.2.  Transient Failures Result-Code AVP Values
  contents:
  - "10.1.2.  Transient Failures Result-Code AVP Values\n   A Diameter peer uses a\
    \ Result-Code AVP value that falls in the\n   transient failures category to inform\
    \ the remote peer that a request\n   could not be satisfied at the time it was\
    \ received, but it MAY be\n   satisfied by the Diameter peer in the future.\n\
    \   o  DIAMETER_USER_NAME_REQUIRED 4013\n      The Diameter request did not contain\
    \ a User-Name AVP, which is\n      required to complete the transaction.  The\
    \ Diameter peer MAY\n      include a User-Name AVP and attempt the request again.\n"
- title: 10.1.3.  Permanent Failures Result-Code AVP Values
  contents:
  - "10.1.3.  Permanent Failures Result-Code AVP Values\n   A Diameter peer uses a\
    \ Result-Code AVP value that falls into the\n   permanent failure category to\
    \ inform the remote peer that the request\n   failed and should not be attempted\
    \ again.\n   o  DIAMETER_ERROR_USER_UNKNOWN 5032\n      The SIP-AOR AVP value\
    \ does not belong to a known user in this\n      realm.\n   o  DIAMETER_ERROR_IDENTITIES_DONT_MATCH\
    \ 5033\n      The value in one of the SIP-AOR AVPs is not allocated to the user\n\
    \      specified in the User-Name AVP.\n   o  DIAMETER_ERROR_IDENTITY_NOT_REGISTERED\
    \ 5034\n      A query for location information is received for a SIP AOR that\n\
    \      has not been registered before.  The user to which this identity\n    \
    \  belongs cannot be given service in this situation.\n   o  DIAMETER_ERROR_ROAMING_NOT_ALLOWED\
    \ 5035\n      The user is not allowed to roam to the visited network.\n   o  DIAMETER_ERROR_IDENTITY_ALREADY_REGISTERED\
    \ 5036\n      The identity being registered has already been assigned a server\n\
    \      and the registration status does not allow that it is overwritten.\n  \
    \ o  DIAMETER_ERROR_AUTH_SCHEME_NOT_SUPPORTED 5037\n      The authentication scheme\
    \ indicated in an authentication request\n      is not supported.\n   o  DIAMETER_ERROR_IN_ASSIGNMENT_TYPE\
    \ 5038\n      The SIP server address sent in the SIP-Server-URI AVP value of the\n\
    \      Diameter Server-Assignment-Request (SAR) command is the same SIP\n    \
    \  server address that is currently assigned to the user name, but\n      the\
    \ SIP-Server-Assignment-Type AVP is not allowed.  For example,\n      the user\
    \ is registered and the Server-Assignment-Request indicates\n      the assignment\
    \ for an unregistered user.\n   o  DIAMETER_ERROR_TOO_MUCH_DATA 5039\n      The\
    \ Diameter peer in the SIP server receives more data than it can\n      accept.\
    \  The SIP server cannot overwrite the already stored data.\n   o  DIAMETER_ERROR_NOT\
    \ SUPPORTED_USER_DATA 5040\n      The SIP server informs the Diameter server that\
    \ the received\n      subscription data contained information that was not recognized\
    \ or\n      supported.\n"
- title: 11.  Authentication Details
  contents:
  - "11.  Authentication Details\n   Authenticating a user can occur through various\
    \ mechanisms.\n   Currently HTTP Digest authentication is supported.  The actual\n\
    \   authentication is performed in either the SIP server or the Diameter\n   server.\n\
    \   If the Diameter server wants to assure that authentication will take\n   place\
    \ in the Diameter server (as opposed to a delegated\n   authentication taking\
    \ place in the SIP server), it MUST NOT include a\n   Digest-HA1 AVP (part of\
    \ the grouped SIP-Authenticate AVP, which in\n   turn is part of the SIP-Auth-Data-Item\
    \ AVP) in a MAA message.  The\n   Diameter server MAY include a pre-calculated\
    \ Digest-HA1 AVP in the\n   MAA message if it wants to delegate authentication\
    \ of the user to the\n   SIP server.\n   Note that on systems where the SIP User\
    \ Agent is using HTTP Digest\n   authentication [RFC2617] inside of Transport\
    \ Layer Security (TLS)\n   [RFC4346], where only the SIP proxy server has a certificate,\n\
    \   delegating authentication to the SIP server (by making Digest-HA1\n   available\
    \ to the SIP server) might reduce the load on the Diameter\n   server.\n   When\
    \ requesting authentication, the Diameter client indicates in the\n   SIP-Number-Auth-Items\
    \ AVP value of a Diameter MAR message how many\n   authentication credentials\
    \ are being requested.  In the Diameter MAA\n   message, the Diameter server MAY\
    \ include more than one\n   SIP-Auth-Data-Item AVP, but it is only useful for\
    \ the Diameter client\n   if the Digest-QoP AVP was set to 'auth-int' (in the\
    \ MAR message), and\n   if future authentications will have the same realm.  When\
    \ including\n   more than one SIP-Auth-Data-Item AVP, the Diameter server SHOULD\n\
    \   indicate how many instances of SIP-Auth-Data-Item AVPs are present\n   with\
    \ the SIP-Number-Auth-Items AVP.  This number may be different\n   from the one\
    \ requested in the Diameter MAR message.  If multiple\n   SIP-Auth-Data-Item AVPs\
    \ are present, and their ordering is\n   significant, the Diameter server MUST\
    \ include a SIP-Item-Number AVP\n   in each grouping to indicate the order.  The\n\
    \   SIP-Authentication-Scheme AVP indicates \"Digest\" and the\n   SIP-Authenticate\
    \ AVP contains data (typically a challenge of some\n   kind) that the user can\
    \ use for her authentication.  The grouped\n   SIP-Authorization AVP contains\
    \ the AVPs that conform to the response\n   expected from the user.\n   If the\
    \ Diameter server performs the authentication of the user, the\n   Diameter MAR\
    \ message that the Diameter client sends to the Diameter\n   server MUST include\
    \ all the authentication credentials supplied by\n   the SIP UA (there might be\
    \ more than one credential, e.g., different\n   realms, authentication of proxies,\
    \ etc.).  Each credential is\n   inserted in a grouped SIP-Authorization AVP (part\
    \ of the grouped\n   SIP-Auth-Data-Item AVP).  The Diameter client MUST insert\
    \ a\n   SIP-Number-Auth-Items AVP with the value set to the number of\n   credentials\
    \ enclosed.  If necessary, the Digest-Entity-Body-Hash AVP\n   will contain a\
    \ hash of the body, needed to perform the\n   authentication.  If the authentication\
    \ is successful, the Diameter\n   MAA message will contain a Result-Code AVP indicating\
    \ success, and if\n   necessary, the Diameter server MAY include one or more\n\
    \   SIP-Auth-Data-Item AVPs to provide further authentication credentials\n  \
    \ to the SIP server.  If the authentication is unsuccessful due to\n   missing\
    \ credentials, the Diameter MAA message will include a\n   SIP-Auth-Data-Item\
    \ AVP with the SIP-Authentication-Scheme and\n   SIP-Authenticate AVPs containing\
    \ data (typically a challenge of some\n   kind) that the user can use to authenticate\
    \ itself.\n   There are situations where a SIP request traverses several proxies,\n\
    \   and each of the proxies requests to authenticate the SIP UA.  In this\n  \
    \ situation, it is a valid scenario that a SIP request received at a\n   SIP server\
    \ contains several sets of credentials.  The 'realm'\n   directive in HTTP is\
    \ the key that the Diameter client can use to\n   determine which credential is\
    \ applicable.  Also, none of the realms\n   may be of interest to the Diameter\
    \ client, in which case the Diameter\n   client MUST consider that no credentials\
    \ (of interest) were sent.  In\n   any case, a Diameter client MUST send zero\
    \ or exactly one credential\n   to the Diameter server.  The Diameter client MUST\
    \ choose the\n   credential based on the 'realm' directive in the\n   Authorization/Proxy-Authorization\
    \ header field, and it MUST match the\n   realm of the Diameter client.\n   It\
    \ must be noted that nonces are always generated in the Diameter\n   server.\n"
- title: 12.  Migration from RADIUS
  contents:
  - "12.  Migration from RADIUS\n   RADIUS offers support for HTTP Digest authentication\
    \ in the RADIUS\n   Extension for Digest Authentication [RFC4590].  A number of\
    \ AVPs (the\n   Digest-* AVPs) of this Diameter SIP application are imported from\
    \ the\n   RADIUS attributes namespace, thus making the migration from RADIUS to\n\
    \   Diameter smooth.\n   Note that the RADIUS Extension for Digest Authentication\
    \ [RFC4590]\n   provides a more limited scope than this Diameter SIP application.\n\
    \   Specifically, the RADIUS extension for Digest Authentication merely\n   provides\
    \ support for HTTP Digest authentication, whereas the Diameter\n   SIP application\
    \ provides support for user location, profile\n   downloading and update, etc.\n\
    \   The following sections discuss several configurations in which a\n   gateway\
    \ translates RADIUS to Diameter and vice versa.\n"
- title: 12.1.  Gateway from RADIUS Client to Diameter Server
  contents:
  - "12.1.  Gateway from RADIUS Client to Diameter Server\n   The gateway maps Access-Request\
    \ messages to MAR request.  If a RADIUS\n   Access-Request message contains at\
    \ least one Digest-* attribute, the\n   gateway maps all Digest-* attributes to\
    \ the AVPs of a Diameter\n   SIP-Authorization AVP, constructs a MAR message,\
    \ and sends it to the\n   Diameter server.  If the RADIUS Access-Request message\
    \ does not\n   contain any Digest-* attribute, then the RADIUS client does not\
    \ want\n   to apply HTTP Digest authentication, in which case, actions at the\n\
    \   gateway are outside the scope of this document.\n   The Diameter server responds\
    \ with a MAA message.  If the MAA message\n   contains a Result-Code AVP set to\
    \ the value DIAMETER_MULTI_ROUND_AUTH\n   and contains challenge parameters in\
    \ a SIP-Authenticate AVP, then the\n   gateway translates the AVPs of SIP-Authenticate\
    \ AVP and puts the\n   resulting RADIUS attributes into an Access-Challenge message.\
    \  It\n   sends the Access-Challenge message to the RADIUS client.\n   If the\
    \ MAA message contains a SIP-Authentication-Info and a\n   Digest-Response AVP,\
    \ the gateway converts these AVPs to the\n   corresponding RADIUS attributes and\
    \ constructs a RADIUS message.  If\n   the Result-Code AVP is DIAMETER_SUCCESS,\
    \ an Access-Accept is sent.\n   In all other cases, an Access-Reject is sent.\n"
- title: 12.2.  Gateway from Diameter Client to RADIUS Server
  contents:
  - "12.2.  Gateway from Diameter Client to RADIUS Server\n   The Diameter client\
    \ sends a Diameter MAR message to the gateway.  If\n   the MAR message does not\
    \ contain SIP-Auth-Data-Item AVPs, the gateway\n   constructs an Access-Request\
    \ message and maps the SIP-AOR and\n   SIP-Method AVPs to RADIUS attributes. \
    \ The gateway sends the\n   Access-Request message to the RADIUS server, which\
    \ will respond with\n   an Access-Challenge.  The gateway creates a MAA message\
    \ with a\n   Result-Code AVP set to DIAMETER_MULTI_ROUND_AUTH and maps the\n \
    \  Digest-* attributes to Diameter AVPs in a SIP-Authenticate AVP.  The\n   gateway\
    \ sends the resulting MAA to the Diameter client, which will\n   respond with\
    \ a new MAR.\n   The gateway checks the SIP-Auth-Data-Item AVPs of this MAR for\
    \ an AVP\n   where the Digest-Realm AVP matches the locally configured realm\n\
    \   value.  It takes the AVPs from this SIP-Auth-Data-Item AVP, converts\n   them\
    \ into the corresponding RADIUS attributes and constructs a RADIUS\n   Access-Request\
    \ message.  The gateway sends the Access-Request message\n   to the RADIUS server.\
    \  If the RADIUS server responds with an\n   Access-Accept message, the gateway\
    \ converts the RADIUS attributes to\n   Diameter AVPs, constructs a MAA message\
    \ with a Result-Code AVP set to\n   DIAMETER_SUCCESS and sends this message to\
    \ the Diameter client.  If\n   the RADIUS server responds with an Access-Reject\
    \ message, the gateway\n   converts the RADIUS attributes to Diameter AVPs, constructs\
    \ a MAA\n   message with a Result-Code AVP set to\n   DIAMETER_ERROR_IDENTITIES_DONT_MATCH,\
    \ and sends this message to the\n   Diameter client.\n"
- title: 12.3.  Known Limitations
  contents:
  - "12.3.  Known Limitations\n   As mentioned earlier, there is not a 100% match\
    \ between the Diameter\n   SIP application and the RADIUS Extension for Digest\
    \ Authentication\n   [RFC4590].  In particular, the RADIUS Extension for Digest\n\
    \   Authentication [RFC4590] does not offer equivalent functionality to\n   the\
    \ Diameter UAR/UAA, SAR/SAA, LIR/LIA, RTR/RTA, and PPR/PPA messages\n   defined\
    \ by this specification.\n"
- title: 13.  IANA Considerations
  contents:
  - "13.  IANA Considerations\n   This document serves as IANA registration request\
    \ for a number of\n   items that should be registered in the AAA parameters registry.\n"
- title: 13.1.  Application Identifier
  contents:
  - "13.1.  Application Identifier\n   This document defines a standards-track Application-ID\
    \ that falls\n   into the Application Identifier standards-track address space\
    \ defined\n   by RFC 3588 [RFC3588] Section 11.3.  This Application-ID has been\n\
    \   registered in the Application IDs sub-registry of the AAA parameters\n   registry\
    \ with the following data:\n    ID values     Name                           \
    \     Reference\n   -----------    ------------------------            ---------\n\
    \           6      Diameter Session Initiation         RFC 4740\n            \
    \      Protocol (SIP) Application\n"
- title: 13.2.  Command Codes
  contents:
  - "13.2.  Command Codes\n   This document defines new standard commands whose Command\
    \ Codes are\n   to be allocated within the standard permanent Command Codes address\n\
    \   space defined in RFC 3588 [RFC3588] Section 11.2.1.  These command\n   codes\
    \ should be registered in the Command Codes sub-registry of the\n   AAA parameters\
    \ registry.\n   Table 1 in Section 8 contains the detailed list of Command Code\
    \ names\n   and values that are part of this Diameter application.\n"
- title: 13.3.  AVP Codes
  contents:
  - "13.3.  AVP Codes\n   This document defines new standard AVPs, whose AVP Codes\
    \ are to be\n   allocated within the AVP Codes address space defined in RFC 3588\n\
    \   [RFC3588] Section 11.4.  These AVP codes have been registered in the\n   AVP\
    \ Codes sub-registry of the AAA parameters registry.\n   Table 2 in Section 9\
    \ contains the detailed list of AVP names and AVP\n   codes that are part of this\
    \ Diameter application.\n"
- title: 13.4.  Additional Values for the Result-Code AVP Value
  contents:
  - "13.4.  Additional Values for the Result-Code AVP Value\n   This document defines\
    \ new standard Result-Code AVP values to be\n   allocated within the Result-Code\
    \ AVP address space defined in RFC\n   3588 [RFC3588] Section 14.4.1.  These values\
    \ are listed in the\n   Result-Code AVP values section of the AVP Specific Values\n\
    \   sub-registry of the AAA parameters registry.\n   Section 10.1.1 lists the\
    \ new Result-Code AVP values that fall into\n   the success category, according\
    \ to RFC 3588 [RFC3588] Section 7.1.2.\n   Section 10.1.2 lists the new Result-Code\
    \ AVP values that fall into\n   the transient failures category, according to\
    \ RFC 3588 [RFC3588]\n   Section 7.1.4.\n   Section 10.1.3 lists the new Result-Code\
    \ AVP values that fall into\n   the permanent failures category, according to\
    \ RFC 3588 [RFC3588]\n   Section 7.1.5.\n"
- title: 13.5.  Creation of the SIP-Server-Assignment-Type Section in the AAA
  contents:
  - "13.5.  Creation of the SIP-Server-Assignment-Type Section in the AAA\n      \
    \ Registry\n   This document defines a new SIP-Server-Assignment-Type AVP (see\n\
    \   Section 9.4).  This AVP is of type Enumerated.  We define an initial\n   set\
    \ of values that should be registered by IANA.  IANA should create\n   a new \"\
    SIP-Sever-Assignment-Type AVP values\" section under the AVP\n   Specific Values\
    \ sub-registry of the AAA parameters registry.  The\n   initial list of values\
    \ is listed in Section 9.4.\n"
- title: 13.6.  Creation of the SIP-Authentication-Scheme Section in the AAA
  contents:
  - "13.6.  Creation of the SIP-Authentication-Scheme Section in the AAA\n       Registry\n\
    \   This document defines a new SIP-Authentication-Scheme AVP (see\n   Section\
    \ 9.5.1).  This AVP is of type Enumerated.  We currently define\n   a single value\
    \ that should be registered by IANA.  IANA should create\n   a new \"SIP-Authentication-Scheme\
    \ AVP values\" section under the AVP\n   Specific Values sub-registry of the AAA\
    \ parameters registry.  The\n   initial list of values is included in Section\
    \ 9.5.1.\n"
- title: 13.7.  Creation of the SIP-Reason-Code Section in the AAA Registry
  contents:
  - "13.7.  Creation of the SIP-Reason-Code Section in the AAA Registry\n   This document\
    \ defines a new SIP-Reason-Code AVP (see Section 9.7.1).\n   This AVP is of type\
    \ Enumerated.  We define an initial set of values\n   that should be registered\
    \ by IANA.  IANA should create a new\n   \"SIP-Reason-Code AVP values\" section\
    \ under the AVP Specific Values\n   sub-registry of the AAA parameters registry.\
    \  The initial list of\n   values is listed in Section 9.7.1.\n"
- title: 13.8.  Creation of the SIP-User-Authorization-Type Section in the AAA
  contents:
  - "13.8.  Creation of the SIP-User-Authorization-Type Section in the AAA\n     \
    \  Registry\n   This document defines a new SIP-User-Authorization-Type AVP (see\n\
    \   Section 9.10).  This AVP is of type Enumerated.  We define an initial\n  \
    \ set of values that should be registered by IANA.  IANA should create\n   a new\
    \ \"SIP-User-Authorization-Type AVP values\" section under the AVP\n   Specific\
    \ Values sub-registry of the AAA parameters registry.  The\n   initial list of\
    \ values is listed in Section 9.10.\n"
- title: 13.9.  Creation of the SIP-User-Data-Already-Available Section in the
  contents:
  - "13.9.  Creation of the SIP-User-Data-Already-Available Section in the\n     \
    \  AAA Registry\n   This document defines a new SIP-User-Data-Already-Available\
    \ AVP (see\n   Section 9.13).  This AVP is of type Enumerated.  We define an initial\n\
    \   set of values which should be registered by IANA.  IANA should create\n  \
    \ a new \"SIP-User-Data-Already-Available AVP values\" section under the\n   AVP\
    \ Specific Values sub-registry of the AAA parameters registry.  The\n   initial\
    \ list of values is listed in Section 9.13.\n"
- title: 14.  Security Considerations
  contents:
  - "14.  Security Considerations\n   This memo does not describe a stand-alone protocol,\
    \ but a particular\n   application for the Diameter protocol [RFC3588].  Consequently,\
    \ all\n   the security considerations applicable to Diameter automatically\n \
    \  apply to this memo.  In particular, Section 13 of RFC 3588 applies to\n   this\
    \ memo.\n   This Diameter SIP application allows a Diameter client to use the\n\
    \   properties of HTTP Digest authentication [RFC2617] by evaluating or\n   sending\
    \ to the Diameter server the credentials supplied by a user.\n   The discussion\
    \ of HTTP Digest authentication in Section 4 of RFC 2617\n   [RFC2617] is also\
    \ applicable to this memo.\n   This Diameter SIP application also allows a Diameter\
    \ client to use\n   the properties of HTTP Digest authentication using AKA [RFC3310]\
    \ by\n   evaluating or sending to the Diameter server the credentials supplied\n\
    \   by a user.  Section 5 of RFC 3310 [RFC3310] is also applicable to\n   this\
    \ memo.\n"
- title: 14.1.  Final Authentication Check in the Diameter Client/SIP Server
  contents:
  - "14.1.  Final Authentication Check in the Diameter Client/SIP Server\n   The Diameter\
    \ SIP application can be configured to operate in a\n   scenario where the final\
    \ authentication check is performed in the\n   Diameter client (SIP server). \
    \ There are a number of security\n   considerations associated to it; all of them\
    \ are consequences of the\n   requirement to transfer H(A1) from the Diameter\
    \ server to the\n   Diameter client:\n   o  Both Diameter client and server must\
    \ trust each other, such as\n      when both client and server belong to the same\
    \ administrative\n      domain.\n   o  To avoid eavesdroppers, the transport protocol\
    \ between the\n      Diameter client and server MUST be secured.  RFC 3588 [RFC3588]\n\
    \      specifies TLS [RFC4346] and IPsec as possible transport protection\n  \
    \    mechanisms for Diameter.\n   Due to these security considerations, it is\
    \ RECOMMENDED to configure\n   the Diameter SIP application to operate in the\
    \ mode where the final\n   authentication check is performed in the Diameter server.\n"
- title: 15.  Contributors
  contents:
  - "15.  Contributors\n   The authors would like to thank the following contributors\
    \ who made\n   substantial contributions to this work:\n          Pete McCann\
    \           Lucent\n          Jaakko Rajaniemi      Nokia\n   Wolfgang Beck (Deutsche\
    \ Telekom AG) provided the text in Section 12,\n   \"Migration from RADIUS\".\n"
- title: 16.  Acknowledgements
  contents:
  - "16.  Acknowledgements\n   The authors would like to thank Tony Johansson and\
    \ Kevin Purser for\n   their invaluable contribution to the start-up of this application\
    \ and\n   the continuous progress.  The authors would like to thank Daniel\n \
    \  Warren, Jayshree Bharatia, Kuntal Chowdhury, Jari Arkko, Avi Lior,\n   Wolfgang\
    \ Beck, Ulrich Wiehe, Cullen Jennings, Anu Leinonen, Glen\n   Zorn, German Blanco,\
    \ Mikko Aittola, Bert Wijnen, and Sam Hartman for\n   their reviews and valuable\
    \ comments.\n   The Diameter SIP application is based on the Diameter application\
    \ for\n   the Cx interface of the 3GPP IP Multimedia Subsystem [3GPP.29.229].\n\
    \   The authors would like to thank 3GPP Working Group CN4 for this work.\n"
- title: 17.  References
  contents:
  - '17.  References

    '
- title: 17.1.  Normative References
  contents:
  - "17.1.  Normative References\n   [RFC2119]      Bradner, S., \"Key words for use\
    \ in RFCs to Indicate\n                  Requirement Levels\", BCP 14, RFC 2119,\
    \ March 1997.\n   [RFC2617]      Franks, J., Hallam-Baker, P., Hostetler, J.,\
    \ Lawrence,\n                  S., Leach, P., Luotonen, A., and L. Stewart, \"\
    HTTP\n                  Authentication: Basic and Digest Access\n            \
    \      Authentication\", RFC 2617, June 1999.\n   [RFC3261]      Rosenberg, J.,\
    \ Schulzrinne, H., Camarillo, G.,\n                  Johnston, A., Peterson, J.,\
    \ Sparks, R., Handley, M.,\n                  and E.  Schooler, \"SIP: Session\
    \ Initiation Protocol\",\n                  RFC 3261, June 2002.\n   [RFC3310]\
    \      Niemi, A., Arkko, J., and V. Torvinen, \"Hypertext\n                  Transfer\
    \ Protocol (HTTP) Digest Authentication Using\n                  Authentication\
    \ and Key Agreement (AKA)\", RFC 3310,\n                  September 2002.\n  \
    \ [RFC3588]      Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and\n     \
    \             J.  Arkko, \"Diameter Base Protocol\", RFC 3588,\n             \
    \     September 2003.\n   [RFC4590]      Sterman, B., Sadolevsky, D., Schwartz,\
    \ D., Williams,\n                  D., and W. Beck, \"RADIUS Extension for Digest\n\
    \                  Authentication\", RFC 4590, July 2006.\n"
- title: 17.2.  Informative References
  contents:
  - "17.2.  Informative References\n   [RFC4346]      Dierks, T. and E. Rescorla,\
    \ \"The Transport Layer\n                  Security (TLS) Protocol Version 1.1\"\
    , RFC 4346, April\n                  2006.\n   [RFC3263]      Rosenberg, J. and\
    \ H. Schulzrinne, \"Session Initiation\n                  Protocol (SIP): Locating\
    \ SIP Servers\", RFC 3263,\n                  June 2002.\n   [RFC3680]      Rosenberg,\
    \ J., \"A Session Initiation Protocol (SIP)\n                  Event Package for\
    \ Registrations\", RFC 3680,\n                  March 2004.\n   [RFC3880]    \
    \  Lennox, J., Wu, X., and H. Schulzrinne, \"Call\n                  Processing\
    \ Language (CPL): A Language for User Control\n                  of Internet Telephony\
    \ Services\", RFC 3880,\n                  October 2004.\n   [RFC4004]      Calhoun,\
    \ P., Johansson, T., Perkins, C., Hiller, T.,\n                  and P. McCann,\
    \ \"Diameter Mobile IPv4 Application\",\n                  RFC 4004, August 2005.\n\
    \   [RFC4005]      Calhoun, P., Zorn, G., Spence, D., and D. Mitton,\n       \
    \           \"Diameter Network Access Server Application\",\n                \
    \  RFC 4005, August 2005.\n   [RFC4006]      Hakala, H., Mattila, L., Koskinen,\
    \ J-P., Stura, M.,\n                  and J. Loughney, \"Diameter Credit-Control\n\
    \                  Application\", RFC 4006, August 2005.\n   [3GPP.29.229]  3GPP,\
    \ \"Cx and Dx interfaces based on the Diameter\n                  protocol; Protocol\
    \ details\", 3GPP TS 29.229 5.12.0,\n                  June 2006.\n   [JSR-000116]\
    \   Java Community Process, \"SIP Servlet API Specification\n                \
    \  1.0 Final Release\", JSR 000116, March 2003.\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Miguel A. Garcia-Martin (Editor)\n   Nokia\n   P.O. Box\
    \ 407\n   NOKIA GROUP, FIN  00045\n   Finland\n   Phone: +358 50 480 4586\n  \
    \ EMail: miguel.an.garcia@nokia.com\n   Maria-Carmen Belinchon\n   Ericsson\n\
    \   Via de los Poblados 13\n   Madrid  28033\n   Spain\n   Phone: +34 91 339 3535\n\
    \   EMail: maria.carmen.belinchon@ericsson.com\n   Miguel A. Pallares-Lopez\n\
    \   Ericsson\n   Via de los Poblados 13\n   Madrid  28033\n   Spain\n   Phone:\
    \ +34 91 339 4222\n   EMail: miguel-angel.pallares@ericsson.com\n   Carolina Canales-Valenzuela\n\
    \   Ericsson\n   Via de los Poblados 13\n   Madrid  28033\n   Spain\n   Phone:\
    \ +34 91 339 2680\n   EMail: carolina.canales@ericsson.com\n   Kalle Tammi\n \
    \  Nokia\n   P.O.Box 785\n   Tampere  33101\n   Finland\n   Phone: +358 40 505\
    \ 8670\n   EMail: kalle.tammi@nokia.com\n"
- title: Full Copyright Statement
  contents:
  - "Full Copyright Statement\n   Copyright (C) The IETF Trust (2006).\n   This document\
    \ is subject to the rights, licenses and restrictions\n   contained in BCP 78,\
    \ and except as set forth therein, the authors\n   retain all their rights.\n\
    \   This document and the information contained herein are provided on an\n  \
    \ \"AS IS\" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS\n  \
    \ OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST,\n   AND THE\
    \ INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,\n   EXPRESS OR IMPLIED,\
    \ INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT\n   THE USE OF THE INFORMATION\
    \ HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY\n   IMPLIED WARRANTIES OF MERCHANTABILITY\
    \ OR FITNESS FOR A PARTICULAR\n   PURPOSE.\n"
- title: Intellectual Property
  contents:
  - "Intellectual Property\n   The IETF takes no position regarding the validity or\
    \ scope of any\n   Intellectual Property Rights or other rights that might be\
    \ claimed to\n   pertain to the implementation or use of the technology described\
    \ in\n   this document or the extent to which any license under such rights\n\
    \   might or might not be available; nor does it represent that it has\n   made\
    \ any independent effort to identify any such rights.  Information\n   on the\
    \ procedures with respect to rights in RFC documents can be\n   found in BCP 78\
    \ and BCP 79.\n   Copies of IPR disclosures made to the IETF Secretariat and any\n\
    \   assurances of licenses to be made available, or the result of an\n   attempt\
    \ made to obtain a general license or permission for the use of\n   such proprietary\
    \ rights by implementers or users of this\n   specification can be obtained from\
    \ the IETF on-line IPR repository at\n   http://www.ietf.org/ipr.\n   The IETF\
    \ invites any interested party to bring to its attention any\n   copyrights, patents\
    \ or patent applications, or other proprietary\n   rights that may cover technology\
    \ that may be required to implement\n   this standard.  Please address the information\
    \ to the IETF at\n   ietf-ipr@ietf.org.\n"
- title: Acknowledgement
  contents:
  - "Acknowledgement\n   Funding for the RFC Editor function is currently provided\
    \ by the\n   Internet Society.\n"
