Abstract This memo describes a Real time Transport Protocol (RTP) payload format for the Society of Motion Picture and Television Engineers (SMPTE)
ancillary space (ANC) data, as defined by SMPTE ST 291 1.
SMPTE ANC data is generally used along with professional video formats to carry a range of ancillary data types, including time code, Closed Captioning, and the Active Format Description (AFD).
This memo describes a Real time Transport Protocol (RTP) payload format for the Society of Motion Picture and Television Engineers (SMPTE)
ancillary space (ANC) data, as defined by SMPTE ST 291 1 [ST291].
ANC data is transmitted in the ancillary space of serial digital video interfaces, the space outside of the active video region of images intended for users to view.
Ancillary space roughly corresponds to vertical and horizontal blanking periods of cathode ray tube type displays.
ANC data can carry a range of data types, including time code, Closed Captioning, and the Active Format Description (AFD).
ANC data is generally associated with the carriage of metadata within the bit stream of a Serial Digital Interface (SDI), such as the standard definition (SD)
Serial Digital Interface, the 1.5 Gb/s Serial Digital Interface for high definition (HD) television applications, or the 3 Gb/s Signal/Data Serial Interface (SMPTE ST 259 [ST259], SMPTE ST 292 1 [ST292], and SMPTE ST 424 [ST424]).
ANC data packet payload definitions for a specific application are specified by a SMPTE Standard, Recommended Practice, Registered Disclosure Document, or by a document generated by another organization, a company, or an individual (an entity).
When a payload format is registered with SMPTE, it is identified by a registered data identification word.
This memo describes an RTP payload that supports carriage of ANC data packets that originate from any location within any SMPTE defined SDI signal.
This payload also supports the carriage of ANC data packets that did not originate from an SDI signal.
Sufficient information is provided to enable the ANC data packets at the output of the decoder to be restored to their original locations in the serial digital video signal raster (if that is desired).
An optional media type parameter allows for the signaling of carriage of one or more types of ANC data as specified by data identification (DID) and secondary data identification (SDID) words.
Another optional media type parameter allows for the identification of the Video Payload ID (VPID) code of the source interface of ANC data packets.
Note that the Ancillary Data Flag (ADF) word is not specifically carried in this RTP payload.
The ADF might be specified in a document defining an interconnecting digital video interface; otherwise, a default ADF is specified by SMPTE ST 291
This ANC data payload can be used by itself or used along with a range of RTP video formats.
In particular, it has been designed so that it could be used along with "RTP Payload Format for Uncompressed Video" [RFC4175] or "RTP Payload Format for JPEG 2000 Video Streams" [RFC5371].
The data model in this document for the ANC data RTP payload is based on the data model of SMPTE ST 2038
[ST2038], which standardizes the carriage of ANC data packets in an MPEG 2 Transport Stream.
The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14
when, and only when, they appear in all capitals, as shown here.
RTP Payload Format for SMPTE ST 291 Ancillary Data
An example of the format of an RTP packet containing SMPTE ST 291 ANC data is shown below:
SMPTE Ancillary Data RTP Packet Format
In this example, two ANC data packets are present.
The first has four 10 bit User Data Words, and the second has five 10 bit User Data Words (note that few ANC data packets are this small; thus, this example does not reflect actual defined ANC data packets and does not specifically call out the DIDs and SDIDs).
The ANC data packets are located on lines 9 and 10 of the SDI raster.
The term "network byte order" in the payload format SHALL refer to the Data Transmission Order as defined in Appendix B of RFC 791 [RFC0791].
RTP packet header fields SHALL be interpreted as per RFC 3550 [RFC3550], with the following specifics:
The timestamp field is interpreted in a similar fashion to RFC 4175
For progressive scan video, the timestamp denotes the sampling instant of the frame to which the ANC data in the RTP packet belongs.
RTP packets MUST NOT include ANC data from multiple frames, and all RTP packets with ANC data belonging to the same frame MUST have the same timestamp.
For interlaced video, the timestamp denotes the sampling instant of the field to which the ANC data in the RTP packet belongs.
RTP packets MUST NOT include ANC data packets from multiple fields, and all RTP packets belonging to the same field MUST have the same timestamp.
If the sampling instant does not correspond to an integer value of the clock, the value SHALL be truncated to the next lowest integer with no ambiguity.
Section 3.1 describes timestamp clock rates.
Marker bit (M): 1 bit The marker bit set to "1" indicates the last ANC data RTP packet for a frame (for progressive scan video) or the last ANC data RTP packet for a field (for interlaced video).
The ANC data RTP payload header fields are defined as: Extended Sequence Number: 16 bits
The high order bits of the extended 32 bit sequence number, in network byte order.
This is the same as the Extended Sequence Number field in RFC 4175
Length: 16 bits Number of octets of the ANC data RTP payload, beginning with the "C" bit of the first ANC packet data header, as an unsigned integer in network byte order.
Note that all word align fields contribute to the calculation of the Length field.
ANC Count: 8 bits This field is the count of the total number of ANC data packets carried in the RTP payload, as an unsigned integer.
A single ANC data RTP packet payload cannot carry more than 255 ANC data packets.
If more than 255 ANC data packets need to be carried in a field or frame, additional RTP packets carrying ANC data MAY be sent with the same RTP timestamp but with different sequence numbers.
ANC Count of 0 indicates that there are no ANC data packets in the payload (for example, an RTP packet that carries no actual ANC data packets even though its marker bit indicates the last ANC data RTP packet in a field/ frame).
If the ANC Count is 0, the Length will also be 0.
These two bits relate to signaling the field specified by the RTP timestamp in an interlaced SDI raster.
A value of 0b00 indicates that either the video format is progressive or that no field is specified.
A value of 0b10 indicates that the timestamp refers to the first field of an interlaced video signal.
A value of 0b11 indicates that the timestamp refers to the second field of an interlaced video signal.
The value 0b01 is not valid.
Receivers SHOULD ignore an ANC data packet with an F field value of 0b01 and SHOULD process any other ANC data packets with valid F field values that are present in the RTP payload.
Note that some multi stream SDI interfaces might use multiple interlaced signal streams to transmit progressive images, in which case the "F" bits would refer to the field of the interlaced stream used for transport of the ANC data packet.
reserved: 22 bits The 22 reserved bits of value "0" follow the F field to ensure that the first ANC data packet header field in the payload begins 32 bit word aligned with the start of the RTP header to ease implementation.
For each ANC data packet in the payload, the following ANC data packet header fields MUST be present:
C: 1 bit This flag, when set to "1", indicates that the ANC data corresponds to the color difference data channel (C).
When set to "0", this flag indicates either that the ANC data corresponds to the luma (Y) data channel, that the ANC data source is from an SD signal, or that the ANC data source has no specific luma or color difference data channels.
For ANC data from a multi stream interface source, the C flag SHALL refer to the channel of the stream used to transport the ANC data packet.
For situations where there is no SDI source, if the ANC data type definition specifically requires the use of the C or Y data channel, the C flag SHALL reflect that requirement.
Line Number: 11 bits This field contains the digital interface line number that corresponds to the location of the ANC data packet as an unsigned integer in network byte order.
Without specific line location within the field or
Note that the lines that are available to convey ANC data are as defined in the applicable sample structure specification (e.g., SMPTE ST 274 [ST274], SMPTE ST 296 [ST296], ITU R BT.656
[BT656]) and are possibly further restricted per SMPTE RP 168 [RP168].
In multi stream interfaces, this field refers to the line number that an ANC data packet is carried on within a particular data stream in the interface.
Horizontal Offset: 12 bits This field defines the location of the ANC data packet in an SDI raster relative to the start of active video (SAV; a digital synchronizing signal present in SDI interfaces) as an unsigned integer in network byte order.
A value of 0 means that the ADF of the ANC data packet begins immediately following SAV.
The horizontal offset from SAV is measured in terms of 10 bit words of the indicated data stream and data channel.
In multi stream interfaces, this field refers to the horizontal location where an ANC data packet is placed on a line carried within a particular data stream in the interface.
Note that HANC data space will generally have higher luma sample numbers than any samples in the active digital line.
Also note that SMPTE ST 296 [ST296] (1280 x 720 progressive active images) image sampling systems 7 and 8 (
1280 x 720 progressive @ 24 fps and
1280 x 720 progressive @ 23.98 fps respectively) have a luma sample number maximum of 4124.
It is unlikely that an actual implementation would have an ANC data packet begin at a Horizontal Offset beyond 4091 (0xFFB) in these formats; should that occur, the Horizontal Offset value 0xFFC can be used to signal a horizontal offset larger than can be represented in the field.
Further note that the 12 bit field of Horizontal Offset is kept that size in this memo to maintain easy conversion to/from SMPTE ST 2038
[ST2038], which also has a 12 bit Horizontal Offset field.
S (Data Stream Flag): 1 bit This field indicates whether the data stream number of a multi stream data mapping used to transport the ANC data packet is specified.
If the S bit is '0', then the StreamNum field provides no guidance regarding the source data stream number of the ANC data packet.
If the S bit is '1', then the StreamNum field carries information regarding the source data stream number of the ANC data packet.
If the S bit (Data Stream Flag) is '1', then the StreamNum field MUST carry identification of the source data stream number of the ANC data packet.
If the data stream is numbered, then the StreamNum field SHALL carry the number of the source data stream minus one.
If the source multi stream interface does not have numbered data streams, the following numbers SHALL be used in this field: '0' for link A data stream and '1' for link B data stream.
For stereoscopic multi stream interface formats that do not have numbered streams, the following numbers SHALL be used in this field: '0' for left eye stream and '1' for right eye stream.
Note that in multi link SDI connections, the physical link that a particular stream utilizes is typically specified by the interface standard.
Also note that numbering of data streams is across the interface as a whole.
For example, in the SMPTE ST 425 3 dual link 3 Gb/s interface, the data streams are numbered 1 4 with data streams 1 and 2 on link 1 and data streams 3 and 4 on link 2.
An ANC data packet with the header fields Line Number of 0x7FF and Horizontal Offset of 0xFFF SHALL be considered to be carried without any specific location within the field or frame.
For each ANC data packet in the payload, immediately after the ANC data packet header fields, the following data fields MUST be present with the fields DID, SDID, Data Count, User Data Words, and Checksum Word representing the 10 bit words carried in the ANC data packet, as per SMPTE ST 291 1 [ST291]:
Data identification word SDID: 10 bits Secondary data identification word.
Used only for a "Type 2" ANC data packet.
Note that in a "Type 1" ANC data packet, this word will actually carry the data block number (DBN).
The lower 8 bits of Data Count, corresponding to bits b7 (MSB; most significant bit) through b0 (LSB; least significant bit) of the 10 bit Data Count word, contain the actual count of 10 bit words in User Data Words.
Bit b8 is the even parity for bits b7 through b0, and bit b9 is the inverse (logical NOT) of bit b8.
User Data Words: integer number of 10 bit words User Data Words (UDW) are used to convey information of a type as identified by the DID word or the DID and SDID words.
The number of 10 bit words in the UDW is defined by the Data Count field.
The 10 bit words are carried in order starting with the most significant bit and ending with the least significant bit.
Checksum Word: 10 bits The Checksum Word can be used to determine the validity of the ANC data packet from the DID word through the UDW.
It consists of 10 bits, where bits b8 (MSB) through b0 (LSB) define the checksum value and bit b9 is the inverse (logical NOT) of bit b8.
The checksum value is equal to the nine least significant bits of the sum of the nine least significant bits of the DID word, the SDID word, the Data Count word, and all User Data Words in the ANC data packet.
The checksum is initialized to zero before calculation, and any "end carry" resulting from the checksum calculation is ignored.
At the end of each ANC data packet in the payload: word align: bits as needed to complete 32 bit word Word align contains enough "0" bits as needed to complete the last 32 bit word of an ANC data packet in the RTP payload.
If an ANC data packet in the RTP payload ends and is aligned with a word boundary, there is no need to add any word alignment bits.
Word align SHALL be used even for the last ANC data packet in an RTP packet.
Word align SHALL NOT be used if there are zero ANC data packets being carried in the RTP packet.
When reconstructing an SDI signal based on this payload, it is important to place ANC data packets into the locations indicated by the ANC data packet header fields C, Line Number and Horizontal Offset, and also to follow the requirements of Section 7 of SMPTE ST 291 1 [ST291], "Ancillary Data Space Formatting (Component or Composite Interface)", which includes rules on the placement of initial ANC data into allowed spaces as well as the contiguity of ANC data packet sequences within those spaces in order to assure that the resulting ANC data packets in the SDI signal are valid.
The optional media type parameter VPID Code can inform receivers of the type of originating SDI interface.
For multi stream originating interfaces, the StreamNum field can provide information regarding which stream an ANC data packet can be placed in to match the ANC data location in the originating SDI interface.
Senders of this payload SHOULD transmit available ANC data packets as soon as practical to reduce end to end latency, especially if the receivers will be embedding the received ANC data packet into an SDI signal emission.
One millisecond is a reasonable upper bound for the amount of time between when an ANC data packet becomes available to a sender and the emission of an RTP payload containing that ANC data packet.
ANC data packets with headers that indicate specific location within a field or frame SHOULD be sent in raster scan order, both in terms of packing position within an RTP packet and in terms of transmission time of RTP packets.
This RTP payload format is identified using the "video/smpte291" media type, which is registered in accordance with RFC 4855 [RFC4855]; the template defined in RFC 6838
Note that the media type definition is in the "video" tree due to the expected use of SMPTE ST 291 Ancillary Data along with video formats.
Media Type Definition Type name:
Rate: RTP timestamp clock rate.
When an ANC data RTP stream is to be associated with an RTP video stream, the RTP timestamp rates SHOULD be the same to ensure that ANC data packets can be associated with the appropriate frame or field.
Otherwise, a 90 kHz rate SHOULD be used.
Note that techniques described in RFC 7273
[RFC7273] can provide a common reference clock for multiple RTP streams intended for synchronized presentation.
SDID: Data identification and secondary data identification words.
The presence of the DID SDID parameters signals that all ANC data packets of this stream are of a particular type or types, i.e., labeled with particular DIDs and SDIDs.
DID and SDID values of SMPTE registered ANC data packet types can be found in the SMPTE Registry for Data Identification Word Assignments [SMPTE RA].
"Type 1" ANC data packets (which do not have SDIDs defined)
SHALL be labeled with SDID 0x00.
DID and SDID values can be registered with SMPTE as per SMPTE ST 291 1 [ST291].
The absence of the DID SDID parameter signals that determination of the DID and SDID of ANC data packets in the payload can only be achieved through direct inspection of the ANC data packet fields.
The ABNF description of the DID SDID parameter is described in Section 4.
: This integer parameter specifies the Video Payload ID (VPID) code of the source interface of ANC data packets using the value from byte 1 of the VPID as defined in SMPTE ST 352 [ST352].
The integer SHALL be made with bit 7 of VPID byte 1 being the most significant bit and bit 0 of VPID byte 1 being the least significant bit.
For example, 132 refers to SMPTE ST 292 1, 720 line video payloads on a 1.5 Gb/s (nominal) serial digital interface.
Encoding considerations: This media type is framed and binary; see Section 4.8 of RFC 6838
Data items in smpte291 can be very diverse.
Receivers might only be capable of interpreting a subset of the possible data items.
Some implementations might care about the location of the ANC data packets in the SDI raster, but other implementations might not care.
Published specification: RFC 8331 Applications that use this media type: Devices that stream real time professional video, especially those that interoperate with legacy serial digital interfaces (SDI).
Deprecated alias names for this type: N/A Magic number(s):
: N/A Macintosh file type code(s): N/A Person & email address to contact for further information:
COMMON Restrictions on usage: This media type depends on RTP framing and hence is only defined for transfer via RTP RFC 3550
Transport within other framing protocols is not defined at this time.
T. Edwards <thomas.edwards@fox.com> Change controller:
The IETF PAYLOAD Working Group, or other party as designated by the IESG.
The mapping of the above defined payload format media type and its parameters SHALL be done according to Section 3 of RFC 4855 [RFC4855].
The type name ("video") goes in SDP
"m " as the media name.
The optional parameters VPID Code and
DID SDID, when present, are included in the "a fmtp" attribute line of SDP as a semicolon  separated list of parameter value pairs.
DID and SDID values SHALL be specified in hexadecimal with a "0x" prefix (such as "0x61").
The ABNF as per RFC 5234
[RFC5234] of the DID SDID optional parameter SHALL be:
For example, EIA 608 Closed Caption data would be signaled with the parameter DID SDID {0x61,0x02}.
If a DID SDID parameter is not specified, then the ANC data stream might potentially contain ANC data packets of any type.
Multiple DID SDID parameters can be specified (separated by semicolons) to signal the presence of multiple types of ANC data in the stream.
DID SDID {0x61,0x02};DID SDID {0x41,0x05}, for example, signals the presence of EIA 608 Closed Captions as well as AFD/Bar Data.
Multiple DID SDID parameters do not imply any particular ordering of the different types of ANC data packets in the stream.
If the optional parameter VPID Code is present, it SHALL be present only once in the semicolon separated list, taking a single integer value.
A sample SDP mapping for ANC data is as follows:
m video 30000 RTP/AVP 112
a rtpmap:112 smpte291/90000 a fmtp:112
In this example, a dynamic payload type 112 is used for ANC data.
The 90 kHz RTP timestamp rate is specified in the "a rtpmap" line after the subtype.
In the "a fmtp:" line, DID 0x61 and SDID 0x02 are specified (registered to EIA 608 Closed Caption Data by SMPTE), and also DID 0x41 and SDID 0x05
The VPID Code is 132 (referring to SMPTE ST 292 1, 720 line video payloads on a 1.5 Gb/s serial digital interface).
Grouping ANC Data Streams with Other Media Streams
To indicate the association of an ANC data stream with a particular video stream, implementers MAY group the "m" lines together using Flow Identification ("FID") semantics as defined in RFC 5888 [RFC5888].
A sample SDP mapping for grouping ANC data with video as described in RFC 4175
IP4 host.example.com s Professional Networked Media Test i
A test of synchronized video and ANC data t 0 0 a group:
FID V1 M1 m video 50000 RTP/AVP 96 c IN IP4 233.252.0.1/255
raw/90000 a fmtp:96 sampling YCbCr 4:2:2
; width 1280; height 720; depth 10 a mid:
V1 m video 50010 RTP/AVP 97 c IN IP4 233.252.0.2/255
DID SDID {0x61,0x02};DID SDID {0x41,0x05}
Offer/Answer Model and Declarative Considerations 5.1.
Offer/Answer Model Receivers might wish to receive ANC data streams with specific DID SDID parameters.
Thus, when offering ANC data streams using the Session Description Protocol (SDP) in an Offer/Answer model [RFC3264], the offerer MAY provide a list of ANC data streams available with specific DID SDID parameters in the fmtp line.
The answerer MAY (1) respond with all or a subset of the streams offered along with fmtp lines with all or a subset of the DID SDID parameters offered, (
2) set the corresponding port number to 0 to decline the smpte291 stream if not in the same media section as a corresponding video stream, or (3) remove the corresponding payload type if the smpte291 stream is in the same media section as a corresponding video stream.
There are no restrictions on updating DID SDID parameters in a subsequent offer.
Declarative SDP Considerations For declarative use of SDP, nothing specific is defined for this payload format.
The configuration given by the SDP MUST be used when sending and/or receiving media in the session.
The media type "video/smpte291" is defined in Section 3.1.
IANA has registered "video/smpte291" in the "Media Types" registry.
Security Considerations RTP packets using the payload format defined in this specification are subject to the security considerations discussed in the RTP specification [RFC3550] and in any applicable RTP profile such as RTP/AVP [RFC3551], RTP/AVPF [RFC4585], RTP/SAVP [RFC3711], or RTP/ SAVPF [RFC5124].
However, as "Securing the RTP Protocol Framework: Why RTP Does Not Mandate a Single Media Security Solution" [RFC7202] discusses, it is not the responsibility of an RTP payload format to discuss or mandate what solutions are to be used to meet the basic security goals like confidentiality, integrity, and source authenticity for RTP in general.
This responsibility lays on anyone using RTP in an application.
They can find guidance on available security mechanisms and important considerations in "Options for Securing RTP Sessions" [RFC7201].
Applications SHOULD use one or more appropriately strong security mechanisms.
The rest of this section discusses the security impacting properties of the payload format itself.
To avoid potential buffer overflow attacks, receivers SHOULD validate that the ANC data packets in the RTP payload are of the appropriate length (using the Data Count field) for the ANC data type specified by DID and SDID.
Also, the Checksum Word SHOULD be checked against the ANC data packet to ensure that its data has not been damaged in transit; note that the Checksum Word is unlikely to provide a payload integrity check in case of a directed attack.
Some receivers will simply move the ANC data packet bits from the RTP payload into SDI.
It might still be a good idea for these "re  embedders" to perform the above mentioned validity tests to avoid downstream SDI systems from becoming confused by bad ANC data packets, which could be used for a denial of service attack.
Re embedders" into SDI SHOULD also double check that the Line Number and Horizontal Offset lead to the ANC data packet being inserted into a legal area to carry ANC data in the SDI video bit stream of the output video format.
