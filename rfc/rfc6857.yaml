- title: __initial_text__
  contents:
  - ' Post-Delivery Message Downgrading for Internationalized Email Messages

    '
- title: Abstract
  contents:
  - "Abstract\n   The Email Address Internationalization (SMTPUTF8) extension to SMTP\n\
    \   allows Unicode characters encoded in UTF-8 and outside the ASCII\n   repertoire\
    \ in mail header fields.  Upgraded POP and IMAP servers\n   support internationalized\
    \ messages.  If a POP or IMAP client does not\n   support Email Address Internationalization,\
    \ a POP or IMAP server\n   cannot deliver internationalized messages to the client\
    \ and cannot\n   remove the message.  To avoid that situation, this document describes\n\
    \   a mechanism for converting internationalized messages into the\n   traditional\
    \ message format.  As part of the conversion process,\n   message elements that\
    \ require internationalized treatment are recoded\n   or removed, and receivers\
    \ are able to recognize that they received\n   messages containing such elements,\
    \ even if they cannot process the\n   internationalized elements.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This\
    \ document is a product of the Internet Engineering Task Force\n   (IETF).  It\
    \ represents the consensus of the IETF community.  It has\n   received public\
    \ review and has been approved for publication by the\n   Internet Engineering\
    \ Steering Group (IESG).  Further information on\n   Internet Standards is available\
    \ in Section 2 of RFC 5741.\n   Information about the current status of this document,\
    \ any errata,\n   and how to provide feedback on it may be obtained at\n   http://www.rfc-editor.org/info/rfc6857.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2013 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (http://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.  Code Components\
    \ extracted from this document must\n   include Simplified BSD License text as\
    \ described in Section 4.e of\n   the Trust Legal Provisions and are provided\
    \ without warranty as\n   described in the Simplified BSD License.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1.  Introduction . . . . . . . . . . . . . . . . . . .\
    \ . . . . . .  4\n     1.1.  Problem Statement  . . . . . . . . . . . . . . .\
    \ . . . . .  4\n     1.2.  Possible Solutions . . . . . . . . . . . . . . . .\
    \ . . . .  4\n     1.3.  Approach Taken in This Specification . . . . . . . .\
    \ . . .  5\n   2.  Terminology  . . . . . . . . . . . . . . . . . . . . . . .\
    \ . .  6\n   3.  Email Message Header Field Downgrading . . . . . . . . . . .\
    \ .  7\n     3.1.  Downgrading Method for Each ABNF Element . . . . . . . . .\
    \  7\n       3.1.1.  Unstructured Downgrading . . . . . . . . . . . . . . .  7\n\
    \       3.1.2.  Word Downgrading . . . . . . . . . . . . . . . . . . .  7\n  \
    \     3.1.3.  Comment Downgrading  . . . . . . . . . . . . . . . . .  7\n    \
    \   3.1.4.  MIME-Value Downgrading . . . . . . . . . . . . . . . .  7\n      \
    \ 3.1.5.  Display-Name Downgrading . . . . . . . . . . . . . . .  7\n       3.1.6.\
    \  Domain Downgrading . . . . . . . . . . . . . . . . . .  8\n       3.1.7.  Group\
    \ Downgrading  . . . . . . . . . . . . . . . . . .  8\n       3.1.8.  Mailbox\
    \ Downgrading  . . . . . . . . . . . . . . . . .  8\n       3.1.9.  Type-Addr\
    \ Downgrading  . . . . . . . . . . . . . . . .  9\n       3.1.10. Encapsulation:\
    \ A Last Resort . . . . . . . . . . . . .  9\n     3.2.  Downgrading Method for\
    \ Each Header Field . . . . . . . . . 10\n       3.2.1.  Address Header Fields\
    \ That Contain <address>\n               Elements . . . . . . . . . . . . . .\
    \ . . . . . . . . . 10\n       3.2.2.  Non-ASCII Strings in <comment> Elements\
    \  . . . . . . . 11\n       3.2.3.  Message-ID Header Fields . . . . . . . . .\
    \ . . . . . . 11\n       3.2.4.  Received Header Field  . . . . . . . . . . .\
    \ . . . . . 11\n       3.2.5.  MIME Content Header Fields . . . . . . . . . .\
    \ . . . . 12\n       3.2.6.  Non-ASCII Characters in <unstructured> Elements \
    \ . . . 12\n       3.2.7.  Non-ASCII Characters in <phrase> Elements  . . . .\
    \ . . 12\n       3.2.8.  Other Header Fields  . . . . . . . . . . . . . . . .\
    \ . 12\n   4.  MIME Body Parts and Delivery Status Notifications  . . . . . .\
    \ 12\n     4.1.  MIME Body Part Header Field Downgrading  . . . . . . . . . 13\n\
    \     4.2.  Delivery Status Notification Downgrading . . . . . . . . . 13\n  \
    \ 5.  Security Considerations  . . . . . . . . . . . . . . . . . . . 13\n   6.\
    \  Implementation Note: Encoded-Word Encoding . . . . . . . . . . 14\n   7.  IANA\
    \ Considerations  . . . . . . . . . . . . . . . . . . . . . 15\n     7.1.  Obsolescence\
    \ of Existing Downgraded-* Header Fields  . . . 15\n     7.2.  Registration of\
    \ New Downgraded-* Header Fields . . . . . . 15\n   8.  Acknowledgements . . .\
    \ . . . . . . . . . . . . . . . . . . . . 16\n   9.  References . . . . . . .\
    \ . . . . . . . . . . . . . . . . . . . 16\n     9.1.  Normative References .\
    \ . . . . . . . . . . . . . . . . . . 16\n     9.2.  Informative References .\
    \ . . . . . . . . . . . . . . . . . 18\n   Appendix A.  Downgrading Example .\
    \ . . . . . . . . . . . . . . . . 19\n"
- title: 1.  Introduction
  contents:
  - '1.  Introduction

    '
- title: 1.1.  Problem Statement
  contents:
  - "1.1.  Problem Statement\n   Traditional (legacy) mail systems, which are defined\
    \ by the Internet\n   Message Format [RFC5322] and other specifications, allow\
    \ only ASCII\n   characters in mail header field values.  The SMTPUTF8 extension\n\
    \   [RFC6530] [RFC6531] [RFC6532] allows Unicode characters encoded in\n   UTF-8\
    \ [RFC3629] in these mail header fields.  \"Raw non-ASCII strings\"\n   refers\
    \ to strings of those characters in which at least one of them\n   is not part\
    \ of the ASCII repertoire.\n   If a header field contains non-ASCII strings, a\
    \ POP or IMAP server\n   cannot deliver internationalized messages to legacy clients\
    \ that do\n   not send UTF8 commands or have UTF8 capability.  Also, because they\n\
    \   have no obvious or standardized way to explain what is going on to\n   clients,\
    \ a POP or IMAP server cannot even safely discard the message.\n"
- title: 1.2.  Possible Solutions
  contents:
  - "1.2.  Possible Solutions\n   There are four plausible approaches to the problem.\
    \  The preferred\n   approach depends on the particular circumstances and relationship\n\
    \   among the delivery SMTP server, the mail store, the POP or IMAP\n   server,\
    \ and the users and their Mail User Agent (MUA) clients.  The\n   four approaches\
    \ are as follows:\n   1.  If the delivery Mail Transport Agent (MTA) has sufficient\n\
    \       knowledge about the POP or IMAP server and the clients being\n       used,\
    \ the message may be rejected as undeliverable.\n   2.  A new, surrogate, message\
    \ may be created by downgrading the\n       original one in the POP or IMAP server\
    \ in a way that preserves\n       maximum information at the expense of some complexity\
    \ and that\n       does not create security or operational problems in the mail\n\
    \       system.  These surrogate messages are referred to as \"downgraded\"\n\
    \       in this specification and as \"surrogate messages\" elsewhere.\n   3.\
    \  Some intermediate downgrading may be applied that balances\n       additional\
    \ information loss against lower complexity and greater\n       ease of implementation.\n\
    \   4.  The POP or IMAP server may fabricate a message that is intended\n    \
    \   to notify the client that an internationalized message is waiting\n      \
    \ but cannot be delivered until an upgraded client is available.\n"
- title: 1.3.  Approach Taken in This Specification
  contents:
  - "1.3.  Approach Taken in This Specification\n   This specification describes the\
    \ second of these options.  It is\n   worth noting that, at least in the general\
    \ case, none of these\n   options preserves sufficient information to guarantee\
    \ that it is\n   possible to reply to an incoming message without loss of information,\n\
    \   so the choice may be considered one of the available \"least bad\"\n   options.\
    \  While this document specifies a well-designed mechanism, it\n   is only an\
    \ interim solution while clients are being upgraded\n   [RFC6855] [RFC6856].\n\
    \   This message downgrading mechanism converts mail header fields to an\n   all-ASCII\
    \ representation.  The POP or IMAP server can use the\n   downgrading mechanism\
    \ and then deliver the internationalized message\n   in a traditional form, which\
    \ allows receivers to know whether a\n   message is internationalized or unknown\
    \ or broken.\n   The Internationalized Mail Header specification [RFC6532] allows\n\
    \   UTF-8 characters (see Section 2) to be used in mail header fields and\n  \
    \ MIME header fields.  The Internationalized Mail Transport\n   specification\
    \ [RFC6531] allows UTF-8 characters to be used in some\n   trace header fields.\
    \  The message downgrading mechanism specified\n   here describes the method by\
    \ which internationalized messages\n   [RFC6530] [RFC6532] are converted to traditional\
    \ email messages\n   [RFC5322].\n   This document provides a precise definition\
    \ of the minimum-\n   information-loss message downgrading process.\n   Downgrading\
    \ consists of the following two parts:\n   o  Email header field downgrading\n\
    \   o  MIME header field downgrading\n   Email header field downgrading is described\
    \ in Section 3.  It\n   generates ASCII-only header fields.\n   Header fields\
    \ starting with Downgraded- are introduced in\n   Section 3.1.10.  They preserve\
    \ the information that appeared in the\n   original header fields.\n   The definition\
    \ of MIME header fields in internationalized messages is\n   described in RFC\
    \ 6532.  A delivery status notification may contain\n   non-ASCII addresses. \
    \ MIME header field downgrading is described in\n   Section 4.1.  Delivery status\
    \ notification downgrading is described\n   in Section 4.2.  It generates ASCII-only\
    \ MIME header fields.\n   Displaying downgraded messages that originally contained\n\
    \   internationalized header fields is out of scope of this document.  A\n   POP\
    \ or IMAP client that does not support UTF8 extensions as defined\n   for POP3\
    \ \"UTF8 command\" and IMAP \"ENABLE UTF8=ACCEPT command\" does\n   not recognize\
    \ the internationalized message format [RFC6532].\n"
- title: 2.  Terminology
  contents:
  - "2.  Terminology\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\", \"SHALL\"\
    , \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"MAY\", and\
    \ \"OPTIONAL\" in this\n   document are to be interpreted as described in RFC\
    \ 2119 [RFC2119].\n   Many of the specialized terms used in this specification\
    \ are defined\n   in other documents.  They include \"Overview and Framework for\n\
    \   Internationalized Email\" [RFC6530], the Internet Message Format\n   specification\
    \ [RFC5322], and some of the basic MIME documents\n   [RFC2045] [RFC2183].  This\
    \ specification makes extensive use of the\n   MIME Message Header Extensions\
    \ [RFC2047] and extended MIME parameter\n   encodings [RFC2231].  For convenience,\
    \ both are described as\n   \"encoded-words\" or \"encoded-word encoding\".  All\
    \ of the encoded-words\n   generated according to this specification use UTF-8\
    \ as their charset.\n   The terms \"U-label\", \"A-label\", and \"IDNA\" are used\
    \ as defined in the\n   IDNA Definitions document [RFC5890].  The terms \"ASCII\
    \ address\",\n   \"non-ASCII address\", \"SMTPUTF8\", \"message\", and \"internationalized\n\
    \   message\" are used as defined RFC 6530.  The term \"non-ASCII string\"\n \
    \  is used with the definition provided in the Internationalized Email\n   Headers\
    \ document [RFC6532].  The term \"UTF-8 character\" is used\n   informally in\
    \ this document to denote a Unicode character, encoded in\n   UTF-8, outside the\
    \ ASCII repertoire.  Such characters are more\n   formally described using the\
    \ ABNF element <UTF8-non-ascii>, defined\n   in RFC 6532.\n   This document refers\
    \ to the Augmented Backus-Naur Form (ABNF)\n   [RFC5234] elements that appear\
    \ in RFC 5322 and RFC 2045.  RFC 5322\n   describes the ABNF elements <CFWS>,\
    \ <comment>, <display-name>,\n   <group>, <id-left>, <id-right>, <mailbox>, <quoted-string>,\n\
    \   <unstructured>, and <word>.  RFC 2045 describes the ABNF element\n   <value>.\
    \  Section 3.3 of the Internationalized Mail Transport\n   specification [RFC6531]\
    \ and Section 3.2 of the Internationalized\n   Email Headers document [RFC6532]\
    \ updated <domain> to allow non-ASCII\n   characters.\n   Some additional terms\
    \ are defined locally in-line below.\n"
- title: 3.  Email Message Header Field Downgrading
  contents:
  - "3.  Email Message Header Field Downgrading\n   This section defines the method\
    \ for converting each header field that\n   may contain non-ASCII strings into\
    \ ASCII.  Section 3.1 describes the\n   methods for rewriting each ABNF element.\
    \  Section 3.2 describes the\n   methods for rewriting each header field.\n"
- title: 3.1.  Downgrading Method for Each ABNF Element
  contents:
  - "3.1.  Downgrading Method for Each ABNF Element\n   Header field downgrading is\
    \ defined below for each ABNF element.\n   Conversion of the header field terminates\
    \ when no characters other\n   than those in the ASCII repertoire remain in the\
    \ header field.\n"
- title: 3.1.1.  Unstructured Downgrading
  contents:
  - "3.1.1.  Unstructured Downgrading\n   If the header field has an <unstructured>\
    \ field that contains\n   non-ASCII strings, apply encoded-word encoding.\n"
- title: 3.1.2.  Word Downgrading
  contents:
  - "3.1.2.  Word Downgrading\n   If the header field has any <word> fields that contain\
    \ non-ASCII\n   strings, apply encoded-word encoding.\n"
- title: 3.1.3.  Comment Downgrading
  contents:
  - "3.1.3.  Comment Downgrading\n   If the header field has any <comment> fields\
    \ that contain non-ASCII\n   strings, apply encoded-word encoding.\n"
- title: 3.1.4.  MIME-Value Downgrading
  contents:
  - "3.1.4.  MIME-Value Downgrading\n   If the header field has any <value> elements\
    \ [RFC2045] that contain\n   non-ASCII strings, remove any <CFWS> that appear\
    \ outside DQUOTE\n   [RFC5234] that appear in those elements, then encode the\
    \ <value>\n   elements as extended MIME parameter encodings [RFC2231] and leave\
    \ the\n   language information empty.\n"
- title: 3.1.5.  Display-Name Downgrading
  contents:
  - "3.1.5.  Display-Name Downgrading\n   If the header field has any <address> (<mailbox>\
    \ or <group>)\n   elements, and they have <display-name> elements that contain\n\
    \   non-ASCII strings, encode the <display-name> elements as encoded-\n   words.\
    \  Display-Name downgrading uses the same algorithm as Word\n   downgrading.\n"
- title: 3.1.6.  Domain Downgrading
  contents:
  - "3.1.6.  Domain Downgrading\n   If the header field has any <domain> elements\
    \ that contain U-labels,\n   rewrite the non-ASCII domain name into an ASCII domain\
    \ name using\n   A-labels [RFC5891].\n"
- title: 3.1.7.  Group Downgrading
  contents:
  - "3.1.7.  Group Downgrading\n   <group> is defined in Section 3.4 of the Internet\
    \ Message Format\n   specification [RFC5322].  The <group> element may contain\
    \ <mailbox>\n   elements that contain non-ASCII addresses.\n   If a <group> element\
    \ contains <mailbox> elements and one of those\n   <mailbox> elements contains\
    \ a non-ASCII <local-part>, rewrite the\n   <group> element as\n   display-name\
    \ \" \" ENCODED_WORD \" :;\"\n   where the <ENCODED_WORD> is the original <group-list>\
    \ encoded as\n   encoded-words.\n   Otherwise, the <group> element contains an\
    \ ASCII-only <local-part>.\n   If the <group> element contains non-ASCII <mailbox>\
    \ elements, they\n   contain non-ASCII domain names.  Rewrite the non-ASCII domain\
    \ names\n   into ASCII domain names using A-labels [RFC5891].  Generated\n   <mailbox>\
    \ elements contain ASCII addresses only.\n"
- title: 3.1.8.  Mailbox Downgrading
  contents:
  - "3.1.8.  Mailbox Downgrading\n   If the <local-part> of the <mailbox> element\
    \ contains no characters\n   other than those in the ASCII repertoire, the <domain>\
    \ element may\n   contain non-ASCII characters.  Rewrite the non-ASCII domain\
    \ names\n   into ASCII domain names using A-labels [RFC5891].\n   Otherwise, the\
    \ <local-part> may contain non-ASCII characters.  The\n   <local-part> that contains\
    \ characters outside the ASCII repertoire\n   has no equivalent format for ASCII\
    \ addresses.  The <addr-spec>\n   element that contains non-ASCII strings may\
    \ appear in two forms as:\n   \"<\" addr-spec \">\"\n   or\n   addr-spec\n   Rewrite\
    \ both as:\n   ENCODED-WORD \" :;\"\n   where the <ENCODED-WORD> is the original\
    \ <addr-spec> encoded as\n   encoded-words.\n"
- title: 3.1.9.  Type-Addr Downgrading
  contents:
  - "3.1.9.  Type-Addr Downgrading\n   If the header field contains <utf-8-type-addr>\
    \ and the\n   <utf-8-type-addr> contains raw non-ASCII strings (<UTF8-non-ascii>),\n\
    \   it is in utf-8-address form [RFC6533].  Convert it to\n   utf-8-addr-xtext\
    \ form [RFC6533].  Comment downgrading is also\n   performed in this case.  If\
    \ the address type is unrecognized and the\n   header field contains non-ASCII\
    \ strings, then fall back to using\n   Encapsulation on the entire header field\
    \ as specified in\n   Section 3.1.10.\n"
- title: '3.1.10.  Encapsulation: A Last Resort'
  contents:
  - "3.1.10.  Encapsulation: A Last Resort\n   As a last resort, when header fields\
    \ cannot be converted as discussed\n   in the previous subsection, the fields\
    \ are deleted and replaced by\n   specialized new header fields.  Those fields\
    \ are defined to preserve,\n   in encoded form, as much information as possible\
    \ from the header\n   field values of the incoming message.  This mechanism is\
    \ known as\n   Encapsulation downgrading in this specification because it preserves\n\
    \   the original information in a different form.  The syntax of these\n   new\
    \ header fields is:\n   fields                   =/ downgraded\n   downgraded\
    \ =  \"Downgraded-Message-Id:\"         unstructured CRLF /\n                \
    \ \"Downgraded-Resent-Message-Id:\"  unstructured CRLF /\n                 \"\
    Downgraded-In-Reply-To:\"        unstructured CRLF /\n                 \"Downgraded-References:\"\
    \         unstructured CRLF /\n                 \"Downgraded-Original-Recipient:\"\
    \ unstructured CRLF /\n                 \"Downgraded-Final-Recipient:\"    unstructured\
    \ CRLF\n   Applying this procedure to the \"Received:\" header field is\n   prohibited.\
    \  Encapsulation downgrading is allowed for \"Message-ID:\",\n   \"In-Reply-To:\"\
    , \"References:\", \"Original-Recipient:\", and\n   \"Final-Recipient:\" header\
    \ fields.\n   To preserve a header field in a Downgraded- header field:\n   1.\
    \  Generate a new header field.\n       *  The field name is a concatenation of\
    \ Downgraded- and the\n          original field name.\n       *  The initial new\
    \ field value is the original header field\n          value.\n   2.  Treat the\
    \ initial new header field value as if it were\n       unstructured, and then\
    \ apply the encoded-word encoding as\n       necessary so that the resulting new\
    \ header field value is\n       completely in ASCII.\n   3.  Remove the original\
    \ header field.\n"
- title: 3.2.  Downgrading Method for Each Header Field
  contents:
  - "3.2.  Downgrading Method for Each Header Field\n   The Mail and MIME Header Fields\
    \ document [RFC4021] establishes a\n   registry of header fields.  This section\
    \ describes the downgrading\n   method for each header field listed in that registry\
    \ as of the date\n   of publication of this specification.\n   If the entire mail\
    \ header field contains no characters other than\n   those in the ASCII repertoire,\
    \ email header field downgrading is not\n   required.  Each header field's downgrading\
    \ method is described below.\n"
- title: 3.2.1.  Address Header Fields That Contain <address> Elements
  contents:
  - "3.2.1.  Address Header Fields That Contain <address> Elements\n   From:\n   Sender:\n\
    \   To:\n   Cc:\n   Bcc:\n   Reply-To:\n   Resent-From:\n   Resent-Sender:\n \
    \  Resent-To:\n   Resent-Cc:\n   Resent-Bcc:\n   Resent-Reply-To:\n   Return-Path:\n\
    \   Disposition-Notification-To:\n   If the header field contains non-ASCII characters,\
    \ first perform\n   Comment downgrading and Display-Name downgrading as described\
    \ in the\n   corresponding subsections of Section 3.1.  If the header field still\n\
    \   contains non-ASCII characters, complete the following two steps:\n   1.  If\
    \ the header field contains <group> elements that contain\n       non-ASCII addresses,\
    \ perform Group downgrading on those elements.\n   2.  If the header field contains\
    \ <mailbox> elements that contain\n       non-ASCII addresses, perform Mailbox\
    \ downgrading on those\n       elements.\n   This procedure may generate empty\
    \ <group> elements in the \"From:\" and\n   \"Sender:\" header fields.  The Group\
    \ Syntax document [RFC6854] updates\n   the Internet Message Format specification\
    \ [RFC5322] to allow (empty)\n   <group> elements in the \"From:\" and \"Sender:\"\
    \ header fields.\n"
- title: 3.2.2.  Non-ASCII Strings in <comment> Elements
  contents:
  - "3.2.2.  Non-ASCII Strings in <comment> Elements\n   Date:\n   Resent-Date:\n\
    \   MIME-Version:\n   Content-ID:\n   Content-Transfer-Encoding:\n   Content-Language:\n\
    \   Accept-Language:\n   Auto-Submitted:\n   Except in comments, these header\
    \ fields do not contain characters\n   other than those in the ASCII repertoire.\
    \  If the header field\n   contains UTF-8 characters in comments, perform Comment\
    \ downgrading.\n"
- title: 3.2.3.  Message-ID Header Fields
  contents:
  - "3.2.3.  Message-ID Header Fields\n   Message-ID:\n   Resent-Message-ID:\n   In-Reply-To:\n\
    \   References:\n   If there are non-ASCII strings in <id-left> or <id-right>\
    \ elements,\n   perform Encapsulation.  Otherwise, the header field contains UTF-8\n\
    \   characters in comments and Comment downgrading should be performed.\n"
- title: 3.2.4.  Received Header Field
  contents:
  - "3.2.4.  Received Header Field\n   Received:\n   If <domain> elements or <mailbox>\
    \ elements contain U-labels, perform\n   Domain downgrading as specified in Section\
    \ 3.1.6.  Comments may\n   contain non-ASCII strings; if so, perform Comment downgrading.\n\
    \   After the Domain downgrading and the Comment downgrading, if the\n   \"FOR\"\
    \ clause contains a non-ASCII <local-part>, remove the FOR\n   clause.  If the\
    \ \"ID\" clause contains a non-ASCII value, remove the ID\n   clause.\n"
- title: 3.2.5.  MIME Content Header Fields
  contents:
  - "3.2.5.  MIME Content Header Fields\n   Content-Type:\n   Content-Disposition:\n\
    \   If there are non-ASCII strings in <value> or <CFWS> elements, perform\n  \
    \ MIME-Value and Comment downgrading.\n"
- title: 3.2.6.  Non-ASCII Characters in <unstructured> Elements
  contents:
  - "3.2.6.  Non-ASCII Characters in <unstructured> Elements\n   Subject:\n   Comments:\n\
    \   Content-Description:\n   If non-ASCII strings are present in <unstructured>\
    \ elements, perform\n   Unstructured downgrading.\n"
- title: 3.2.7.  Non-ASCII Characters in <phrase> Elements
  contents:
  - "3.2.7.  Non-ASCII Characters in <phrase> Elements\n   Keywords:\n   If non-ASCII\
    \ strings are present in <phrase> elements, perform Word\n   downgrading.\n"
- title: 3.2.8.  Other Header Fields
  contents:
  - "3.2.8.  Other Header Fields\n   Other header fields that are not covered in this\
    \ document (such as\n   implementation-specific or user-defined fields) might\
    \ also contain\n   non-ASCII strings.  Any header field that does not have a conversion\n\
    \   method defined above will be in this category and treated as follows.\n  \
    \ If there are non-ASCII strings present in the header fields, perform\n   Unstructured\
    \ downgrading.\n   If the software understands the header field's structure and\
    \ a\n   downgrading algorithm other than Unstructured is applicable, that\n  \
    \ software SHOULD use that algorithm; Unstructured downgrading is used\n   when\
    \ there is no other option.\n   Mailing list header fields (those that start in\
    \ \"List-\") are part of\n   this category.\n"
- title: 4.  MIME Body Parts and Delivery Status Notifications
  contents:
  - "4.  MIME Body Parts and Delivery Status Notifications\n   Both the MIME body\
    \ part header fields [RFC2045] [RFC6532] and the\n   contents of a delivery status\
    \ notification [RFC6533] may contain\n   non-ASCII characters.\n"
- title: 4.1.  MIME Body Part Header Field Downgrading
  contents:
  - "4.1.  MIME Body Part Header Field Downgrading\n   RFC 6532 specifies an extension\
    \ that permits MIME header fields,\n   including body part header fields, to contain\
    \ non-ASCII strings.\n   This section defines the conversion method to ASCII-only\
    \ header\n   fields for each MIME header field that contains non-ASCII strings.\n\
    \   Parse the message body's MIME structure at all levels and check each\n   MIME\
    \ header field to see whether it contains non-ASCII strings.  If\n   the header\
    \ field contains non-ASCII strings in the header field\n   value, the header field\
    \ is a target of the MIME body part header\n   field's downgrading.  The downgrading\
    \ methods used for the MIME body\n   part header fields Content-ID, Content-Type,\
    \ Content-Disposition, and\n   Content-Description are the same as those used\
    \ for the header fields\n   of the same name described in Section 3.2\n"
- title: 4.2.  Delivery Status Notification Downgrading
  contents:
  - "4.2.  Delivery Status Notification Downgrading\n   If the message contains a\
    \ delivery status notification (see Section 6\n   of the SMTP DSN Extension [RFC3461]),\
    \ perform the following tests and\n   conversions.\n   If there are \"Original-Recipient:\"\
    \ and \"Final-Recipient:\" header\n   fields, and the header fields contain non-ASCII\
    \ strings, perform\n   Type-Addr downgrading.\n"
- title: 5.  Security Considerations
  contents:
  - "5.  Security Considerations\n   The purpose of post-delivery message downgrading\
    \ is to allow POP and\n   IMAP servers to deliver internationalized messages to\
    \ traditional POP\n   and IMAP clients and to permit the clients to display those\
    \ messages.\n   Users that receive such messages can know that they were\n   internationalized.\
    \  It does not permit receivers to read the messages\n   in their original form\
    \ and, in general, will not permit generating\n   replies, at least without significant\
    \ user intervention.\n   After downgrading as specified in this document, the\
    \ header fields of\n   a message will contain ASCII characters only, some of them\
    \ in\n   encoded-word form.  Nothing in this document or other SMTPUTF8\n   specifications\
    \ [RFC6530] [RFC6531] alters the basic properties of\n   MIME that allow characters\
    \ outside the ASCII repertoire in encodings\n   as specified for them.  Thus,\
    \ this document inherits the security\n   considerations associated with MIME-encoded\
    \ header fields as\n   specified in RFC 2047 [RFC2047] and with UTF-8 itself as\
    \ specified in\n   RFC 3629 [RFC3629].\n   Rewriting header fields increases the\
    \ opportunities for undetected\n   spoofing by malicious senders.  However, the\
    \ rewritten header field\n   values are preserved in equivalent MIME form or in\
    \ newly defined\n   header fields for which traditional MUAs have no special processing\n\
    \   procedures.\n   The techniques described here may invalidate methods that\
    \ depend on\n   digital signatures over any part of the message, which includes\
    \ the\n   top-level header fields and body part header fields.  Depending on\n\
    \   the specific message being downgraded, at least the following\n   techniques\
    \ are likely to break: DomainKeys Identified Mail (DKIM) and\n   possibly S/MIME\
    \ and Pretty Good Privacy (PGP).  The downgrade\n   mechanism SHOULD NOT remove\
    \ signatures even if the signatures will\n   fail validation after downgrading.\
    \  As much of the information as\n   possible from the original message SHOULD\
    \ be preserved.  In addition,\n   MUAs may be able to use the presence of an Authentication-Results\n\
    \   header field [RFC5451] to assess whether the digital signatures were\n   valid\
    \ before the header fields were downgraded.\n   While information in any email\
    \ header field should usually be treated\n   with some suspicion, current email\
    \ systems commonly employ various\n   mechanisms and protocols to make the information\
    \ more trustworthy.\n   Information in the new Downgraded-* header fields is not\
    \ inspected by\n   traditional MUAs and may be even less trustworthy than the\n\
    \   traditional header fields.  Note that the Downgraded-* header fields\n   could\
    \ have been inserted with malicious intent (and with content\n   unrelated to\
    \ the traditional header fields); however, traditional\n   MUAs do not evaluate\
    \ Downgraded-* header fields.\n   See the Security Considerations sections in\
    \ the Group Syntax document\n   [RFC6854] and the Internationalized Email Framework\
    \ [RFC6530] for\n   more discussion.\n"
- title: '6.  Implementation Note: Encoded-Word Encoding'
  contents:
  - "6.  Implementation Note: Encoded-Word Encoding\n   While the specification of\
    \ encoded-words includes specific rules for\n   dealing with whitespace in adjacent\
    \ encoded words [RFC2047], there\n   are a number of deployed implementations\
    \ that fail to implement the\n   algorithm correctly.  As a result, whitespace\
    \ behavior is somewhat\n   unpredictable, in practice, when multiple encoded words\
    \ are used.\n   While RFC 5322 states that implementations SHOULD limit lines\
    \ to 78\n   characters or less, implementations MAY choose to allow overly long\n\
    \   encoded words to work around faulty implementations of encoded-words.\n  \
    \ Implementations that choose to do so SHOULD have an optional\n   mechanism to\
    \ limit line length to 78 characters.\n"
- title: 7.  IANA Considerations
  contents:
  - "7.  IANA Considerations\n   The experimental specification from which this document\
    \ was partially\n   derived [RFC5504] specifies that no new header fields beginning\
    \ with\n   Downgraded- are to be registered.  That restriction is now lifted,\n\
    \   and this document makes a new set of registrations, replacing the\n   experimental\
    \ fields with standard ones.\n"
- title: 7.1.  Obsolescence of Existing Downgraded-* Header Fields
  contents:
  - "7.1.  Obsolescence of Existing Downgraded-* Header Fields\n   The Downgraded-*\
    \ header fields that were registered as experimental\n   fields in RFC 5504 are\
    \ no longer in use.  IANA has changed the status\n   from \"experimental\" to\
    \ \"obsoleted\" for every name in the \"Permanent\n   Message Header Field Names\"\
    \ registry that began with Downgraded-.\n"
- title: 7.2.  Registration of New Downgraded-* Header Fields
  contents:
  - "7.2.  Registration of New Downgraded-* Header Fields\n   The following header\
    \ fields have been registered in the \"Permanent\n   Message Header Field Names\"\
    \ registry, in accordance with the\n   procedures set out in the Header Field\
    \ Registration document\n   [RFC3864].\n   Header field name:  Downgraded-Message-Id\n\
    \   Applicable protocol:  mail\n   Status:  standard\n   Author/change controller:\
    \  IETF\n   Specification document(s):  This document (Section 3.1.10)\n   Header\
    \ field name:  Downgraded-In-Reply-To\n   Applicable protocol:  mail\n   Status:\
    \  standard\n   Author/change controller:  IETF\n   Specification document(s):\
    \  This document (Section 3.1.10)\n   Header field name:  Downgraded-References\n\
    \   Applicable protocol:  mail\n   Status:  standard\n   Author/change controller:\
    \  IETF\n   Specification document(s):  This document (Section 3.1.10)\n   Header\
    \ field name:  Downgraded-Original-Recipient\n   Applicable protocol:  mail\n\
    \   Status:  standard\n   Author/change controller:  IETF\n   Specification document(s):\
    \  This document (Section 3.1.10)\n   Header field name:  Downgraded-Final-Recipient\n\
    \   Applicable protocol:  mail\n   Status:  standard\n   Author/change controller:\
    \  IETF\n   Specification document(s):  This document (Section 3.1.10)\n"
- title: 8.  Acknowledgements
  contents:
  - "8.  Acknowledgements\n   This document draws heavily from the experimental in-transit\
    \ message\n   downgrading procedure described RFC 5504.  The contributions of\
    \ the\n   coauthor of that earlier document, Y. Yoneya, are gratefully\n   acknowledged.\
    \  Significant comments and suggestions were received\n   from John Klensin, Barry\
    \ Leiba, Randall Gellens, Pete Resnick, Martin\n   J. Durst, and other WG participants.\n"
- title: 9.  References
  contents:
  - '9.  References

    '
- title: 9.1.  Normative References
  contents:
  - "9.1.  Normative References\n   [RFC2045]  Freed, N. and N. Borenstein, \"Multipurpose\
    \ Internet Mail\n              Extensions (MIME) Part One: Format of Internet\
    \ Message\n              Bodies\", RFC 2045, November 1996.\n   [RFC2047]  Moore,\
    \ K., \"MIME (Multipurpose Internet Mail Extensions)\n              Part Three:\
    \ Message Header Extensions for Non-ASCII Text\",\n              RFC 2047, November\
    \ 1996.\n   [RFC2119]  Bradner, S., \"Key words for use in RFCs to Indicate\n\
    \              Requirement Levels\", BCP 14, RFC 2119, March 1997.\n   [RFC2183]\
    \  Troost, R., Dorner, S., and K. Moore, \"Communicating\n              Presentation\
    \ Information in Internet Messages: The\n              Content-Disposition Header\
    \ Field\", RFC 2183, August 1997.\n   [RFC2231]  Freed, N. and K. Moore, \"MIME\
    \ Parameter Value and Encoded\n              Word Extensions:\n              Character\
    \ Sets, Languages, and Continuations\", RFC 2231,\n              November 1997.\n\
    \   [RFC3461]  Moore, K., \"Simple Mail Transfer Protocol (SMTP) Service\n   \
    \           Extension for Delivery Status Notifications (DSNs)\",\n          \
    \    RFC 3461, January 2003.\n   [RFC3629]  Yergeau, F., \"UTF-8, a transformation\
    \ format of ISO\n              10646\", STD 63, RFC 3629, November 2003.\n   [RFC3864]\
    \  Klyne, G., Nottingham, M., and J. Mogul, \"Registration\n              Procedures\
    \ for Message Header Fields\", BCP 90, RFC 3864,\n              September 2004.\n\
    \   [RFC4021]  Klyne, G. and J. Palme, \"Registration of Mail and MIME\n     \
    \         Header Fields\", RFC 4021, March 2005.\n   [RFC5322]  Resnick, P., Ed.,\
    \ \"Internet Message Format\", RFC 5322,\n              October 2008.\n   [RFC5890]\
    \  Klensin, J., \"Internationalized Domain Names for\n              Applications\
    \ (IDNA): Definitions and Document Framework\",\n              RFC 5890, August\
    \ 2010.\n   [RFC5891]  Klensin, J., \"Internationalized Domain Names in\n    \
    \          Applications (IDNA): Protocol\", RFC 5891, August 2010.\n   [RFC6530]\
    \  Klensin, J. and Y. Ko, \"Overview and Framework for\n              Internationalized\
    \ Email\", RFC 6530, February 2012.\n   [RFC6531]  Yao, J. and W. Mao, \"SMTP\
    \ Extension for Internationalized\n              Email\", RFC 6531, February 2012.\n\
    \   [RFC6532]  Yang, A., Steele, S., and N. Freed, \"Internationalized\n     \
    \         Email Headers\", RFC 6532, February 2012.\n   [RFC6533]  Hansen, T.,\
    \ Newman, C., and A. Melnikov,\n              \"Internationalized Delivery Status\
    \ and Disposition\n              Notifications\", RFC 6533, February 2012.\n \
    \  [RFC6854]  Leiba, B., \"Update to Internet Message Format to Allow\n      \
    \        Group Syntax in the \"From:\" and \"Sender:\" Header Fields\",\n    \
    \          RFC 6854, March 2013.\n   [RFC6855]  Resnick, P., Ed., Newman, C.,\
    \ Ed., and S. Shen, Ed., \"IMAP\n              Support for UTF-8\", RFC 6855,\
    \ March 2013.\n   [RFC6856]  Gellens, R., Newman, C., Yao, J., and K. Fujiwara,\
    \ \"Post\n              Office Protocol Version 3 (POP3) Support for UTF-8\",\n\
    \              RFC 6856, March 2013.\n"
- title: 9.2.  Informative References
  contents:
  - "9.2.  Informative References\n   [RFC5234]  Crocker, D. and P. Overell, \"Augmented\
    \ BNF for Syntax\n              Specifications: ABNF\", STD 68, RFC 5234, January\
    \ 2008.\n   [RFC5451]  Kucherawy, M., \"Message Header Field for Indicating\n\
    \              Message Authentication Status\", RFC 5451, April 2009.\n   [RFC5504]\
    \  Fujiwara, K. and Y. Yoneya, \"Downgrading Mechanism for\n              Email\
    \ Address Internationalization\", RFC 5504, March 2009.\n"
- title: Appendix A.  Downgrading Example
  contents:
  - "Appendix A.  Downgrading Example\n   This appendix shows a message downgrading\
    \ example.  Consider a\n   received mail message where:\n   o  The sender address\
    \ is a non-ASCII address,\n      \"NON-ASCII-LOCAL@example.com\".  Its display-name\
    \ is\n      \"DISPLAY-LOCAL\".\n   o  The \"To:\" header field contains two non-ASCII\
    \ addresses,\n      \"NON-ASCII-REMOTE1@example.net\" and\n      \"NON-ASCII-REMOTE2@example.com\"\
    .  Their display-names are\n      \"DISPLAY-REMOTE1\" and \"DISPLAY-REMOTE2\"\
    .\n   o  The \"Cc:\" header field contains a non-ASCII address,\n      \"NON-ASCII-REMOTE3@example.org\"\
    .  Its display-name is\n      \"DISPLAY-REMOTE3\".\n   o  Four display-names contain\
    \ non-ASCII characters.\n   o  The \"Subject:\" header field is \"NON-ASCII-SUBJECT\"\
    , which contains\n      non-ASCII strings.\n   o  The \"Message-Id:\" header field\
    \ contains \"NON-ASCII-MESSAGE_ID\",\n      which contains non-ASCII strings.\n\
    \   o  There is an unknown header field \"X-Unknown-Header:\", which\n      contains\
    \ non-ASCII strings.\n   Return-Path: <NON-ASCII-LOCAL@example.com>\n   Received:\
    \ from ... by ... for <NON-ASCII-REMOTE1@example.net>\n   Received: from ... by\
    \ ... for <NON-ASCII-REMOTE1@example.net>\n   From: DISPLAY-LOCAL <NON-ASCII-LOCAL@example.com>\n\
    \   To: DISPLAY-REMOTE1 <NON-ASCII-REMOTE1@example.net>,\n       DISPLAY-REMOTE2\
    \ <NON-ASCII-REMOTE2@example.com>\n   Cc: DISPLAY-REMOTE3 <NON-ASCII-REMOTE3@example.org>\n\
    \   Subject: NON-ASCII-SUBJECT\n   Date: Mon, 30 Jul 2012 01:23:45 -0000\n   Message-Id:\
    \ NON-ASCII-MESSAGE_ID\n   Mime-Version: 1.0\n   Content-Type: text/plain; charset=\"\
    UTF-8\"\n   Content-Transfer-Encoding: 8bit\n   X-Unknown-Header: NON-ASCII-CHARACTERS\n\
    \   MAIL_BODY\n                 Figure 1: Received Message in a Maildrop\n   The\
    \ downgraded message is shown in Figure 2.  \"Return-Path:\",\n   \"From:\", \"\
    To:\", and \"Cc:\" header fields are rewritten.  \"Subject:\"\n   and \"X-Unknown-Header:\"\
    \ header fields are encoded as encoded-words.\n   The \"Message-Id:\" header field\
    \ is encapsulated as a\n   \"Downgraded-Message-Id:\" header field.\n   Return-Path:\
    \ =?UTF-8?Q?NON-ASCII-LOCAL@example.com?= :;\n   Received: from ... by ...\n \
    \  Received: from ... by ...\n   From: =?UTF-8?Q?DISPLAY-LOCAL?=\n         =?UTF-8?Q?NON-ASCII-LOCAL@example.com?=\
    \ :;\n   To:   =?UTF-8?Q?DISPLAY-REMOTE1?=\n         =?UTF-8?Q?NON-ASCII-REMOTE1@example.net?=\
    \ :;,\n         =?UTF-8?Q?DISPLAY-REMOTE2?=\n         =?UTF-8?Q?NON-ASCII-REMOTE2@example.com?=\
    \ :;,\n   Cc:   =?UTF-8?Q?DISPLAY-REMOTE3?=\n         =?UTF-8?Q?NON-ASCII-REMOTE3@example.org?=\
    \ :;\n   Subject: =?UTF-8?Q?NON-ASCII-SUBJECT?=\n   Date: Mon, 30 Jul 2012 01:23:45\
    \ -0000\n   Downgraded-Message-Id: =?UTF-8?Q?MESSAGE_ID?=\n   Mime-Version: 1.0\n\
    \   Content-Type: text/plain; charset=\"UTF-8\"\n   Content-Transfer-Encoding:\
    \ 8bit\n   X-Unknown-Header: =?UTF-8?Q?NON-ASCII-CHARACTERS?=\n   MAIL_BODY\n\
    \                       Figure 2: Downgraded Message\n"
- title: Author's Address
  contents:
  - "Author's Address\n   Kazunori Fujiwara\n   Japan Registry Services Co., Ltd.\n\
    \   Chiyoda First Bldg. East 13F, 3-8-1 Nishi-Kanda\n   Chiyoda-ku, Tokyo  101-0065\n\
    \   Japan\n   Phone: +81 3 5215 8451\n   EMail: fujiwara@jprs.co.jp\n"
