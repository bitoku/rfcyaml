- title: __initial_text__
  contents:
  - '          Analysis of Failure Cases in IPv6 Roaming Scenarios

    '
- title: Abstract
  contents:
  - "Abstract\n   This document identifies a set of failure cases that may be\n  \
    \ encountered by IPv6-enabled mobile customers in roaming scenarios.\n   The analysis\
    \ reveals that the failure causes include improper\n   configurations, incomplete\
    \ functionality support in equipment, and\n   inconsistent IPv6 deployment strategies\
    \ between the home and the\n   visited networks.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This document is not an Internet Standards Track specification;\
    \ it is\n   published for informational purposes.\n   This document is a product\
    \ of the Internet Engineering Task Force\n   (IETF).  It represents the consensus\
    \ of the IETF community.  It has\n   received public review and has been approved\
    \ for publication by the\n   Internet Engineering Steering Group (IESG).  Not\
    \ all documents\n   approved by the IESG are a candidate for any level of Internet\n\
    \   Standard; see Section 2 of RFC 5741.\n   Information about the current status\
    \ of this document, any errata,\n   and how to provide feedback on it may be obtained\
    \ at\n   http://www.rfc-editor.org/info/rfc7445.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2015 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (http://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.  Code Components\
    \ extracted from this document must\n   include Simplified BSD License text as\
    \ described in Section 4.e of\n   the Trust Legal Provisions and are provided\
    \ without warranty as\n   described in the Simplified BSD License.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1.  Introduction  . . . . . . . . . . . . . . . . . . .\
    \ . . . . .   3\n     1.1.  Terminology . . . . . . . . . . . . . . . . . . .\
    \ . . . .   3\n   2.  Background  . . . . . . . . . . . . . . . . . . . . . .\
    \ . . .   4\n     2.1.  Roaming Architecture: An Overview . . . . . . . . . .\
    \ . .   4\n       2.1.1.  Home Routed Mode  . . . . . . . . . . . . . . . . .\
    \ .   4\n       2.1.2.  Local Breakout Mode . . . . . . . . . . . . . . . . .\
    \   5\n     2.2.  Typical Roaming Scenarios . . . . . . . . . . . . . . . .  \
    \ 6\n   3.  Failure Case in the Network Attachment  . . . . . . . . . . .   7\n\
    \   4.  Failure Cases in the PDP/PDN Creation . . . . . . . . . . . .   9\n  \
    \   4.1.  Case 1: Splitting Dual-Stack Bearer . . . . . . . . . . .   9\n    \
    \ 4.2.  Case 2: IPv6 PDP/PDN Unsupported  . . . . . . . . . . . .  11\n     4.3.\
    \  Case 3: Inappropriate Roaming APN Set . . . . . . . . . .  11\n     4.4.  Case\
    \ 4: Fallback Failure  . . . . . . . . . . . . . . . .  11\n   5.  Failure Cases\
    \ in the Service Requests . . . . . . . . . . . .  12\n     5.1.  Lack of IPv6\
    \ Support in Applications  . . . . . . . . . .  12\n     5.2.  464XLAT Support\
    \ . . . . . . . . . . . . . . . . . . . . .  12\n   6.  HLR/HSS User Profile Setting\
    \  . . . . . . . . . . . . . . . .  13\n   7.  Discussion  . . . . . . . . . .\
    \ . . . . . . . . . . . . . . .  14\n   8.  Security Considerations . . . . .\
    \ . . . . . . . . . . . . . .  15\n   9.  References  . . . . . . . . . . . .\
    \ . . . . . . . . . . . . .  16\n     9.1.  Normative References  . . . . . .\
    \ . . . . . . . . . . . .  16\n     9.2.  Informative References  . . . . . .\
    \ . . . . . . . . . . .  16\n   Acknowledgements  . . . . . . . . . . . . . .\
    \ . . . . . . . . . .  18\n   Contributors  . . . . . . . . . . . . . . . . .\
    \ . . . . . . . . .  18\n   Authors' Addresses  . . . . . . . . . . . . . . .\
    \ . . . . . . . .  19\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   Many mobile operators have deployed IPv6, or are about to,\
    \ in their\n   operational networks.  A customer in such a network can be provided\n\
    \   IPv6 connectivity if their User Equipment (UE) is IPv6 compliant.\n   Operators\
    \ may adopt various approaches to deploy IPv6 in mobile\n   networks, such as\
    \ the solutions described in [TR23.975].  Depending\n   on network conditions,\
    \ either dual-stack or IPv6-only deployment\n   schemes can be enabled.\n   A\
    \ detailed overview of IPv6 support in 3GPP architectures is provided\n   in [RFC6459].\n\
    \   It has been observed and reported that a mobile subscriber roaming\n   around\
    \ a different operator's areas may experience service disruption\n   due to inconsistent\
    \ configurations and incomplete functionality of\n   equipment in the network.\
    \  This document focuses on these issues.\n"
- title: 1.1.  Terminology
  contents:
  - "1.1.  Terminology\n   This document makes use of these terms:\n   o  Mobile networks\
    \ refer to 3GPP mobile networks.\n   o  Mobile UE denotes a 3GPP device that can\
    \ be connected to 3GPP\n      mobile networks.\n   o  The Public Land Mobile Network\
    \ (PLMN) is a network that is\n      operated by a single administrative entity.\
    \  A PLMN (and therefore\n      also an operator) is identified by the Mobile\
    \ Country Code (MCC)\n      and the Mobile Network Code (MNC).  Each (telecommunications)\n\
    \      operator providing mobile services has its own PLMN [RFC6459].\n   o  The\
    \ Home Location Register (HLR) is a pre-Release 5 database (but\n      is also\
    \ used in real deployments of Release 5 and later) that\n      contains subscriber\
    \ data and information related to call routing.\n      All subscribers of an operator\
    \ and the subscribers' enabled\n      services are provisioned in the HLR [RFC6459].\n\
    \   o  The Home Subscriber Server (HSS) is a database for a given\n      subscriber\
    \ and was introduced in 3GPP Release 5.  It is the entity\n      containing the\
    \ subscription-related information to support the\n      network entities actually\
    \ handling calls/sessions [RFC6459].\n   o  \"HLR/HSS\" is used collectively for\
    \ the subscriber database unless\n      referring to the failure case related\
    \ to General Packet Radio\n      Service (GPRS) Subscriber data from the HLR.\n\
    \   An overview of key 3GPP functional elements is documented in\n   [RFC6459].\n\
    \   \"Mobile device\" and \"mobile UE\" are used interchangeably.\n"
- title: 2.  Background
  contents:
  - '2.  Background

    '
- title: '2.1.  Roaming Architecture: An Overview'
  contents:
  - "2.1.  Roaming Architecture: An Overview\n   Roaming occurs in two scenarios:\n\
    \   o  International roaming: a mobile UE enters a visited network\n      operated\
    \ by a different operator, where a different PLMN code is\n      used.  The UEs\
    \ could, either in an automatic mode or in a manual\n      mode, attach to the\
    \ visited PLMN.\n   o  Intra-PLMN mobility: an operator may have one or multiple\
    \ PLMN\n      codes.  A mobile UE could pre-configure the codes to identify the\n\
    \      Home PLMN (HPLMN) or Equivalent HPLMN (EHPLMN).  Intra-PLMN\n      mobility\
    \ allows the UE to move to a different area of HPLMN and\n      EHPLMN.  When\
    \ the subscriber profile is not stored in the visited\n      area, HLR/HSS in\
    \ the Home area will transmit the profile to the\n      Serving GPRS Support Node\
    \ (SGSN) / Mobility Management Entity\n      (MME) in the visited area so as to\
    \ complete network attachment.\n   When a UE is turned on or is transferred via\
    \ a handover to a visited\n   network, the mobile device will scan all radio channels\
    \ and find\n   available PLMNs to attach to.  The SGSN or the MME in the visited\n\
    \   networks must contact the HLR or HSS to retrieve the subscriber\n   profile.\n\
    \   Steering of roaming may also be used by the HPLMN to further restrict\n  \
    \ which of the available networks the UE may be attached to.  Once the\n   authentication\
    \ and registration stage is completed, the Packet Data\n   Protocol (PDP) or Packet\
    \ Data Networks (PDN) activation and traffic\n   flows may be operated differently\
    \ according to the subscriber profile\n   stored in the HLR or the HSS.\n   The\
    \ following subsections describe two roaming modes: Home-routed\n   traffic (Section\
    \ 2.1.1) and Local breakout (Section 2.1.2).\n"
- title: 2.1.1.  Home Routed Mode
  contents:
  - "2.1.1.  Home Routed Mode\n   In this mode, the subscriber's UE gets IP addresses\
    \ from the home\n   network.  All traffic belonging to that UE is therefore routed\
    \ to the\n   home network (Figure 1).\n   GPRS roaming exchange (GRX) or Internetwork\
    \ Packet Exchange (IPX)\n   networks [IR.34] are likely to be invoked as the transit\
    \ network to\n   deliver the traffic.  This is the main mode for international\
    \ roaming\n   of Internet data services to facilitate the charging process between\n\
    \   the two involved operators.\n +-----------------------------+            +------------------------+\n\
    \ |Visited Network              |            |Home Network            |\n |  +----+\
    \        +----+---+   | (GRX/IPX)  |    +--------+ Traffic Flow\n |  | UE |=======>|SGSN/SGW|====================>|GGSN/PGW|============>\n\
    \ |  +----+        +----+---+   |            |    +--------+          |\n |  \
    \              |MME |       |            |                        |\n |      \
    \          +----+       | Signaling  |    +--------+          |\n |          \
    \         |-------------------------->|HLR/HSS |          |\n |              \
    \               |            |    +--------+          |\n +-----------------------------+\
    \            +------------------------+\n                       Figure 1: Home\
    \ Routed Traffic\n"
- title: 2.1.2.  Local Breakout Mode
  contents:
  - "2.1.2.  Local Breakout Mode\n   In the local breakout mode, IP addresses are\
    \ assigned by the visited\n   network to a roaming mobile UE.  Unlike the home\
    \ routed mode, the\n   traffic doesn't have to traverse GRX/IPX; it is offloaded\
    \ locally at\n   a network node close to that device's point of attachment in\
    \ the\n   visited network.  This mode ensures a more optimized forwarding path\n\
    \   for the delivery of packets belonging to a visiting UE (Figure 2).\n     +----------------------------+\
    \            +----------------+\n     |Visited Network             |         \
    \   |Home Network    |\n     |  +----+        +--------+  | Signaling  |    +--------+\
    \  |\n     |  | UE |=======>|SGSN/MME|------------------->|HLR/HSS |  |\n    \
    \ |  +----+        +---+----+  | (GRX/IPX)  |    +--------+  |\n     |       \
    \         |SGW|       |            |                |\n     |                +---+\
    \       |            |                |\n     |                  ||        | \
    \           |                |\n     |              +--------+    |          \
    \  |                |\n     |              |GGSN/PGW|    |            |      \
    \          |\n     |              +--------+    |            |               \
    \ |\n     |    Traffic Flow  ||        |            |                |\n     +------------------||--------+\
    \            +----------------+\n                        \\/\n               \
    \          Figure 2: Local Breakout\n   The international roaming of services\
    \ based on the IP Multimedia\n   Subsystem (IMS), e.g., Voice over LTE (VoLTE)[IR.92],\
    \ is claimed to\n   select the local breakout mode in [IR.65].  Data service roaming\n\
    \   across different areas within an operator network might use local\n   breakout\
    \ mode in order to get more efficient traffic forwarding and\n   also ease emergency\
    \ services.  The local breakout mode could also be\n   applied to an operator's\
    \ alliance for international roaming of data\n   service.\n   EU Roaming Regulation\
    \ III [EU-Roaming-III] involves local breakout\n   mode allowing European subscribers\
    \ roaming in European 2G/3G networks\n   to have their Internet data routed directly\
    \ to the Internet from\n   their current Visited Public Land Mobile Network (VPLMN).\n\
    \   Specific local breakout-related configuration considerations are\n   listed\
    \ below:\n   o  Operators may add the APN-OI-Replacement flag defined in 3GPP\n\
    \      [TS29.272] into the user's subscription data.  The visited network\n  \
    \    indicates a local domain name to replace the user requested Access\n    \
    \  Point Name (APN).  Consequently, the traffic would be steered to\n      the\
    \ visited network.  Those functions are normally deployed for\n      the intra-PLMN\
    \ mobility cases.\n   o  Operators may also configure the VPLMN-Dynamic-Address-Allowed\n\
    \      flag [TS29.272] in the user's profile to enable local breakout\n      mode\
    \ in VPLMNs.\n   o  3GPP specified the Selected IP Traffic Offload (SIPTO) function\n\
    \      [TS23.401] since Release 10 in order to get efficient route paths.\n  \
    \    It enables an operator to offload a portion of the traffic at a\n      network\
    \ node close to the UE's point of attachment to the network.\n   o  The Global\
    \ System for Mobile Communications Association (GSMA) has\n      defined Roaming\
    \ Architecture for Voice over LTE with Local\n      Breakout (RAVEL) [IR.65] as\
    \ the IMS international roaming\n      architecture.  Local breakout mode has\
    \ been adopted for the IMS\n      roaming architecture.\n"
- title: 2.2.  Typical Roaming Scenarios
  contents:
  - "2.2.  Typical Roaming Scenarios\n   Three stages occur when a subscriber roams\
    \ to a visited network and\n   intends to invoke services:\n   o  Network attachment:\
    \ this occurs when the UE enters a visited\n      network.  During the attachment\
    \ phase, the visited network should\n      authenticate the subscriber and make\
    \ a location update to the\n      HSS/HLR in the home network of the subscriber.\
    \  Accordingly, the\n      subscriber profile is offered from the HSS/HLR.  The\
    \ subscriber\n      profile contains the allowed APNs, the allowed PDP/PDN Types,\
    \ and\n      rules regarding the routing of data sessions (i.e., home routed or\n\
    \      local breakout mode) [TS29.272].  The SGSN/MME in the visited\n      network\
    \ can use this information to facilitate the subsequent\n      PDP/PDN session\
    \ creation.\n   o  PDP/PDN context creation: this occurs after the subscriber's\
    \ UE\n      has been successfully attached to the network.  This stage is\n  \
    \    integrated with the attachment stage in the case of 4G, but is a\n      separate\
    \ process in 2G/3G. 3GPP specifies three types of PDP/PDN\n      to describe connections:\
    \ PDP/PDN Type IPv4, PDP/PDN Type IPv6, and\n      PDP/PDN Type IPv4v6.  When\
    \ a subscriber creates a data session,\n      their device requests a particular\
    \ PDP/PDN Type.  The allowed\n      PDP/PDN Types for that subscriber are learned\
    \ in the attachment\n      stage.  Hence, the SGSN and MME via the Serving Gateway\
    \ (SGW)\n      could initiate a PDP/PDN request to Gateway GSN (GGSN) / Packet\n\
    \      Data Network Gateway (PGW) modulo subscription grants.\n   o  Service requests:\
    \ when the PDP/PDN context is created\n      successfully, UEs may launch applications\
    \ and request services\n      based on the allocated IP addresses.  The service\
    \ traffic will be\n      transmitted via the visited network.\n   Failures that\
    \ occur at the attachment stage (Section 3) are\n   independent of home routed\
    \ and the local breakout modes.  Most\n   failure cases in the PDP/PDN context\
    \ creation (Section 4) and in\n   service requests (Section 5) occur in the local\
    \ breakout mode.\n"
- title: 3.  Failure Case in the Network Attachment
  contents:
  - "3.  Failure Case in the Network Attachment\n   3GPP specified PDP/PDN Type IPv4v6\
    \ in order to allow a UE to get both\n   an IPv4 address and an IPv6 prefix within\
    \ a single PDP/PDN bearer.\n   This option is stored as a part of subscription\
    \ data for a subscriber\n   in the HLR/HSS.  PDP/PDN Type IPv4v6 has been introduced\
    \ at the\n   inception of the Evolved Packet System (EPS) in 4G networks.\n  \
    \ The nodes in 4G networks should present no issues with the handling\n   of this\
    \ PDN Type.  However, the level of support varies in 2G/3G\n   networks depending\
    \ on the SGSN software version.  In theory, S4-SGSN\n   (i.e., an SGSN with S4\
    \ interface) has supported the PDP/PDN Type\n   IPv4v6 since Release 8, and Gn-SGSN\
    \ (i.e., the SGSN with Gn\n   interface) has supported it since Release 9.  In\
    \ most cases,\n   operators normally use Gn-SGSN to connect either GGSN in 3G\
    \ or Packet\n   Data Network Gateway (PGW) in 4G.\n   The MAP (Mobile Application\
    \ Part) protocol, as defined in 3GPP\n   [TS29.002], is used over the Gr interface\
    \ between SGSN and HLR.  The\n   MAP Information Element (IE) \"ext-pdp-Type\"\
    \ contains the IPv4v6 PDP\n   Type that is conveyed to SGSN from the HLR within\
    \ the Insert\n   Subscriber Data (ISD) MAP operation.  If the SGSN does not support\n\
    \   the IPv4v6 PDP Type, it will not support the \"ext-pdp-Type\" IE;\n   consequently,\
    \ it must silently discard that IE and continue\n   processing the rest of the\
    \ ISD MAP message.  An issue that has been\n   observed is that multiple SGSNs\
    \ are unable to correctly process a\n   subscriber's data received in the Insert\
    \ Subscriber Data Procedure\n   [TS23.060].  As a consequence, it will likely\
    \ discard the subscriber\n   attach request.  This is erroneous behavior due to\
    \ the equipment not\n   being compliant with 3GPP Release 9.\n   In order to avoid\
    \ encountering this attach problem at a visited SGSN,\n   both operators should\
    \ make a comprehensive roaming agreement to\n   support IPv6 and ensure that it\
    \ aligns with the GSMA documents, e.g.,\n   [IR.33], [IR.88], and [IR.21].  Such\
    \ an agreement requires the\n   visited operator to get the necessary patch on\
    \ all its SGSN nodes to\n   support the \"ext-pdp-Type\" MAP IE sent by the HLR.\
    \  To ensure data-\n   session continuity in Radio Access Technology (RAT) handovers,\
    \ the\n   PDN Type sent by the HSS to the MME should be consistent with the PDP\n\
    \   Type sent by the HLR to the Gn-SGSN.  Where roaming agreements and\n   visited\
    \ SGSN nodes have not been updated, the HPLMN also has to make\n   use of specific\
    \ implementations (not standardized by 3GPP, discussed\n   further in Section\
    \ 6) in the HLR/HSS of the home network.  That is,\n   when the HLR/HSS receives\
    \ an Update Location message from a visited\n   SGSN not known to support dual-stack\
    \ in a single bearer, subscription\n   data allowing only PDP/PDN Type IPv4 or\
    \ IPv6 will be sent to that\n   SGSN in the Insert Subscriber Data procedure.\
    \  This guarantees that\n   the user profile is compatible with the visited SGSN/MME\
    \ capability.\n   In addition, HSS may not have to change if the PGW is aware\
    \ of the\n   subscriber's roaming status and only restricts the accepted PDN Type\n\
    \   consistent with PDP Type sent by the HLR.  For example, a AAA server\n   may\
    \ coordinate with the PGW to decide the allowed PDN Type.\n   Alternatively, HPLMNs\
    \ without the non-standardized capability to\n   suppress the sending of \"ext-pdp-Type\"\
    \ by the HLR may have to remove\n   this attribute from APNs with roaming service.\
    \  PDN Type IPv4v6 must\n   also be removed from the corresponding profile for\
    \ the APN in the\n   HSS.  This will restrict their roaming UEs to only IPv4 or\
    \ IPv6\n   PDP/PDN activation.  This alternative has problems:\n   o  The HPLMN\
    \ cannot support dual-stack in a single bearer at home\n      where the APN profile\
    \ in the HLR/HSS is also used for roaming.\n   o  The UE may set up separate parallel\
    \ bearers for IPv4 and IPv6,\n      where only single-stack IPv4 or IPv6 service\
    \ is preferred by the\n      operator.\n"
- title: 4.  Failure Cases in the PDP/PDN Creation
  contents:
  - "4.  Failure Cases in the PDP/PDN Creation\n   When a subscriber's UE succeeds\
    \ in the attach stage, the IP\n   allocation process takes place to retrieve IP\
    \ addresses.  In general,\n   a PDP/PDN Type IPv4v6 request implicitly allows\
    \ the network side to\n   make several IP assignment options, including IPv4-only,\
    \ IPv6-only,\n   IPv4 and IPv6 in single PDP/PDN bearer, and IPv4 and IPv6 in\n\
    \   separated PDP/PDN bearers.\n   A PDP/PDN Type IPv4 or IPv6 restricts the network\
    \ side to only\n   allocate the requested IP address family.\n   This section\
    \ summarizes several failures in the Home Routed (HR) and\n   Local Breakout (LBO)\
    \ mode as shown in Table 1.\n        +-------+-------------+------------------------+---------+\n\
    \        | Case# | UE request  |  PDP/PDN IP Type       |  Mode   |\n        |\
    \       |             |  permitted on GGSN/PGW |         |\n        +-------+-------------+------------------------+---------+\n\
    \        |       |    IPv4v6   |      IPv4v6            |  HR     |\n        |\
    \  #1   |-------------+------------------------+---------+\n        |       |\
    \    IPv4v6   |      IPv4 or IPv6      |  LBO    |\n        +-------+-------------+------------------------+---------+\n\
    \        |  #2   |     IPv6    |      IPv6              |  HR     |\n        +-------+-------------+------------------------+---------+\n\
    \        |  #3   |     IPv4    |      IPv6              |  HR     |\n        +-------+-------------+------------------------+---------+\n\
    \        |  #4   |     IPv6    |      IPv4              |  LBO    |\n        +-------+-------------+------------------------+---------+\n\
    \              Table 1: Failure Cases in the PDP/PDN Creation\n"
- title: '4.1.  Case 1: Splitting Dual-Stack Bearer'
  contents:
  - "4.1.  Case 1: Splitting Dual-Stack Bearer\n   Dual-stack capability is provided\
    \ using separate PDP/PDN activation\n   in the visited network that doesn't support\
    \ PDP/PDN Type IPv4v6.\n   That means only separate, parallel, single-stack IPv4\
    \ and IPv6\n   PDP/PDN connections are allowed to be initiated to separately\n\
    \   allocate an IPv4 address and an IPv6 prefix.  The SGSN does not\n   support\
    \ the Dual Address Bearer Flag (DAF) or does not set the DAF\n   because the operator\
    \ uses single addressing per bearer to support\n   interworking with nodes of\
    \ earlier releases.  Regardless of home\n   routed or local breakout mode, GGSN/PGW\
    \ will change PDN/PDP Type to a\n   single address PDP/PDN Type and return the\
    \ Session Management (SM)\n   Cause #52 \"single address bearers only allowed\"\
    \ or SM Cause #28\n   \"unknown PDP address or PDP type\" as per [TS24.008] and\
    \ [TS24.301] to\n   the UE.  In this case, the UE may make another PDP/PDN request\
    \ with a\n   single address PDP Type (IPv4 or IPv6) other than the one already\n\
    \   activated.\n   This approach suffers from the following drawbacks:\n   o \
    \ The parallel PDP/PDN activation would likely double PDP/PDN bearer\n      resource\
    \ on the network side and Radio Access Bearer (RAB)\n      resource on the Radio\
    \ Access Network (RAN) side.  It also impacts\n      the capacity of the GGSN/PGW,\
    \ since only a certain amount of\n      PDP/PDN activation is allowed on those\
    \ nodes.\n   o  Some networks may allow only one PDP/PDN to be alive for each\n\
    \      subscriber.  For example, an IPv6 PDP/PDN will be rejected if the\n   \
    \   subscriber has an active IPv4 PDP/PDN.  Therefore, the subscriber\n      would\
    \ not be able to obtain the IPv6 connection in the visited\n      network.  It\
    \ is even worse, as they may have a risk of losing all\n      data connectivity\
    \ if the IPv6 PDP gets rejected with a permanent\n      error at the APN level\
    \ and not an error specific to the PDP-Type\n      IPv6 requested.\n   o  Additional\
    \ correlations between those two PDP/PDN contexts are\n      required on the charging\
    \ system.\n   o  Policy and Charging Rules Function (PCRF) [TS29.212] / Policy\
    \ and\n      Charging Enforcement Function (PCEF) treats the IPv4 and IPv6\n \
    \     sessions as independent and performs different quality-of-service\n    \
    \  (QoS) policies.  The subscriber may have an unstable experience\n      due\
    \ to different behaviors on each IP version connection.\n   o  Mobile devices\
    \ may have a limitation on the number of allowed\n      simultaneous PDP/PDN contexts.\
    \  Excessive PDP/PDN activations may\n      result in service disruption.\n  \
    \ In order to avoid the issue, the roaming agreement in the home routed\n   mode\
    \ should make sure the visited SGSN supports and sets the DAF.\n   Since the PDP/PDN\
    \ Type IPv4v6 is supported in the GGSN/PGW of the\n   home network, it's expected\
    \ that the visited SGSN/MME could create a\n   dual-stack bearer as the UE requested.\n\
    \   In the local breakout mode, the visited SGSN may only allow single IP\n  \
    \ version addressing.  In this case, the DAF on the visited SGSN/MME\n   has to\
    \ be unset.  One approach is to set a dedicated APN [TS23.003]\n   profile to\
    \ only request PDP/PDN Type IPv4 in the roaming network.\n   Some operators may\
    \ also consider not adopting the local breakout mode\n   to avoid the risks.\n"
- title: '4.2.  Case 2: IPv6 PDP/PDN Unsupported'
  contents:
  - "4.2.  Case 2: IPv6 PDP/PDN Unsupported\n   PDP/PDN Type IPv6 has good compatibility\
    \ to visited networks during\n   the network attachment.  In order to support\
    \ the IPv6-only visitors,\n   SGSN/MME in the visited network is required to accept\
    \ IPv6-only\n   PDP/PDN activation requests and enable IPv6 on the user plane\
    \ in the\n   direction of the home network.\n   In some cases, IPv6-only visitors\
    \ may still be subject to the SGSN\n   capability in visited networks.  This becomes\
    \ especially risky if the\n   home operator performs roaming steering targeted\
    \ to an operator that\n   doesn't allow IPv6.  The visited SGSN may just directly\
    \ reject the\n   PDP context activation.  Therefore, it's expected that the visited\n\
    \   network is IPv6 roaming-friendly to enable the functions on SGSN/MME\n   by\
    \ default.  Otherwise, operators may consider steering the roaming\n   traffic\
    \ to the IPv6-enabled visited network that has an IPv6 roaming\n   agreement.\n"
- title: '4.3.  Case 3: Inappropriate Roaming APN Set'
  contents:
  - "4.3.  Case 3: Inappropriate Roaming APN Set\n   If IPv6 single stack with the\
    \ home routed mode is deployed, the\n   requested PDP/PDN Type should also be\
    \ IPv6.  Some implementations\n   that support the roaming APN profile may set\
    \ IPv4 as the default\n   PDP/PDN Type, since the visited network is incapable\
    \ of supporting\n   PDP/PDN Types IPv4v6 (Section 4.1) and IPv6 (Section 4.2).\
    \  The\n   PDP/PDN request will fail because the APN in the home network only\n\
    \   allows IPv6.  Therefore, the roaming APNs have to be compliant with\n   the\
    \ home network configuration when home routed mode is adopted.\n"
- title: '4.4.  Case 4: Fallback Failure'
  contents:
  - "4.4.  Case 4: Fallback Failure\n   In the local breakout mode, PDP/PDN Type IPv6\
    \ should have no issues\n   to pass through the network attachment process, since\
    \ 3GPP specified\n   the PDP/PDN Type IPv6 as early as PDP/PDN Type IPv4.  When\
    \ a visitor\n   requests PDP/PDN Type IPv6, the network should only return the\n\
    \   expected IPv6 prefix.  The UE may fail to get an IPv6 prefix if the\n   visited\
    \ network only allocates an IPv4 address.  In this case, the\n   visited network\
    \ will reject the request and send the cause code to\n   the UE.\n   A proper\
    \ fallback scheme for PDP/PDN Type IPv6 is desirable; however,\n   there is no\
    \ standard way to specify this behavior.  The roaming APN\n   profile could help\
    \ to address the issue by setting the PDP/PDN Type\n   to IPv4.  For instance,\
    \ the Android system solves the issue by\n   configuring the roaming protocol\
    \ to IPv4 for the APN.  It guarantees\n   that UE will always initiate a PDP/PDN\
    \ Type IPv4 in the roaming area.\n"
- title: 5.  Failure Cases in the Service Requests
  contents:
  - "5.  Failure Cases in the Service Requests\n   After the successful network attachment\
    \ and IP address allocation,\n   applications could start to request service based\
    \ on the activated\n   PDP/PDN context.  The service request may depend on specific\
    \ IP\n   family or network collaboration.  If traffic is offloaded locally\n \
    \  (Section 2.1.2), the visited network may not be able to accommodate\n   the\
    \ UE's service requests.  This section describes the failures.\n"
- title: 5.1.  Lack of IPv6 Support in Applications
  contents:
  - "5.1.  Lack of IPv6 Support in Applications\n   Operators may only allow IPv6\
    \ in the IMS APN.  VoLTE [IR.92] and Rich\n   Communication Suite (RCS) [RCC.07]\
    \ use the APN to offer voice service\n   for visitors.  The IMS roaming in RAVEL\
    \ architecture [IR.65] offloads\n   voice and video traffic in the visited network;\
    \ therefore, a dual-\n   stack visitor can only be assigned with an IPv6 prefix\
    \ but no IPv4\n   address.  If the applications can't support IPv6, the service\
    \ is\n   likely to fail.\n   Translation-based methods, for example, 464XLAT [RFC6877]\
    \ or Bump-in-\n   the-Host (BIH) [RFC6535], may help to address the issue if there\
    \ are\n   IPv6 compatibility problems.  The translation function could be\n  \
    \ enabled in an IPv6-only network and disabled in a dual-stack or IPv4\n   network;\
    \ therefore, the IPv4 applications only get the translation in\n   the IPv6 network\
    \ and they perform normally in an IPv4 or dual-stack\n   network.\n"
- title: 5.2.  464XLAT Support
  contents:
  - "5.2.  464XLAT Support\n   464XLAT [RFC6877] is proposed to address the IPv4 compatibility\
    \ issue\n   in an IPv6-only connectivity environment.  The customer-side\n   translator\
    \ (CLAT) function on a mobile device is likely used in\n   conjunction with a\
    \ PDP/PDN IPv6 Type request and cooperates with a\n   remote NAT64 [RFC6146] device.\n\
    \   464XLAT may use the mechanism defined in [RFC7050] or [RFC7225] to\n   detect\
    \ the presence of NAT64 devices and to learn the IPv6 prefix\n   used for protocol\
    \ translation [RFC6052].\n   In the local breakout approach, a UE with the 464XLAT\
    \ function\n   roaming on an IPv6 visited network may encounter various situations.\n\
    \   For example, the visited network may not have deployed DNS64\n   [RFC6147]\
    \ but only NAT64, or CLAT may not be able to discover the\n   provider-side translator\
    \ (PLAT) translation IPv6 prefix used as a\n   destination of the PLAT.  If the\
    \ visited network doesn't have a NAT64\n   and DNS64 deployed, 464XLAT can't perform\
    \ successfully due to the\n   lack of PLAT collaboration.  Even in the case of\
    \ the presence of\n   NAT64 and DNS64, a pre-configured PLAT IPv6 prefix in the\
    \ CLAT may\n   cause failure because it can't match the PLAT translation.\n  \
    \ Considering the various network configurations, operators may turn\n   off local\
    \ breakout and use the home routed mode to perform 464XLAT.\n   Alternatively,\
    \ UE may support the different roaming profile\n   configuration to adopt 464XLAT\
    \ in the home network and use IPv4-only\n   in the visited networks.\n"
- title: 6.  HLR/HSS User Profile Setting
  contents:
  - "6.  HLR/HSS User Profile Setting\n   A proper user profile configuration would\
    \ provide a deterministic\n   outcome to the PDP/PDN creation stage where dual-stack,\
    \ IPv4-only,\n   and IPv6-only connectivity requests may come from devices.  The\n\
    \   HLR/HSS may have to apply extra logic (not standardized by 3GPP) to\n   achieve\
    \ this.  It is also desirable that the network be able to set\n   up connectivity\
    \ of any requested PDP/PDN context type.\n   The following are examples to illustrate\
    \ the settings for the\n   scenarios and the decision criteria to be applied when\
    \ returning user\n   profile information from the HLR to the visited SGSN.\n \
    \                      user profile #1:\n                       PDP-Context ::=\
    \ SEQUENCE {\n                       pdp-ContextId ContextId,\n              \
    \         pdp-Type  PDP-Type-IPv4\n                         ....\n           \
    \            ext-pdp-Type PDP-Type-IPv4v6\n                         ...\n    \
    \                   }\n                       user profile #2:\n             \
    \          PDP-Context ::= SEQUENCE {\n                       pdp-ContextId ContextId,\n\
    \                       pdp-Type  PDP-Type-IPv6\n                         ....\n\
    \                       }\n    Scenario 1: Support of IPv6-Only, IPv4-Only, and\
    \ Dual-Stack Devices\n   The full PDP-context parameters are referred to Section\
    \ 17.7.1\n   (\"Mobile Service data types\") of [TS29.002].  User profiles #1\
    \ and #2\n   share the same \"ContextId\".  The setting of user profile #1 enables\n\
    \   IPv4-only and dual-stack devices to work.  User profile #2 fulfills\n   the\
    \ request if the device asks for IPv6-only PDP context.\n                    \
    \   user profile #1:\n                       PDP-Context ::= SEQUENCE {\n    \
    \                   pdp-ContextId ContextId,\n                       pdp-Type\
    \  PDP-Type-IPv4\n                         ....\n                       ext-pdp-Type\
    \ PDP-Type-IPv4v6\n                         ...\n                       }\n  \
    \                     user profile #2:\n                       PDP-Context ::=\
    \ SEQUENCE {\n                       pdp-ContextId ContextId,\n              \
    \         pdp-Type  PDP-Type-IPv4\n                         ....\n           \
    \            }\n   Scenario 2: Support of Dual-Stack Devices with Pre-Release\
    \ 9 Visited\n                            SGSN (vSGSN) Access\n   User profiles\
    \ #1 and #2 share the same \"ContextId\".  If a visited\n   SGSN is identified\
    \ as early as pre-Release 9, the HLR/HSS should only\n   send user profile #2\
    \ to the visited SGSN.\n"
- title: 7.  Discussion
  contents:
  - "7.  Discussion\n   Several failure cases have been discussed in this document.\
    \  It has\n   been illustrated that the major problems happen at three stages:\
    \ the\n   initial network attachment, the PDP/PDN creation, and service\n   requests.\n\
    \   In the network attachment stage, PDP/PDN Type IPv4v6 is the major\n   concern\
    \ to the visited pre-Release 9 SGSN.  3GPP didn't specify\n   PDP/PDN Type IPv4v6\
    \ in the earlier releases.  That PDP/PDN Type is\n   supported in the newly built\
    \ EPS network, but it isn't supported well\n   in the third-generation network.\
    \  Visited SGSNs may discard the\n   subscriber's attach requests because the\
    \ SGSN is unable to correctly\n   process PDP/PDN Type IPv4v6.  Operators may\
    \ have to adopt temporary\n   solutions unless all the interworking nodes (i.e.,\
    \ the SGSN) in the\n   visited network have been upgraded to support the ext-PDP-Type\n\
    \   feature.\n   In the PDP/PDN creation stage, support of PDP/PDN Types IPv4v6\
    \ and\n   IPv6 on the visited SGSN is the major concern.  It has been observed\n\
    \   that single-stack IPv6 in the home routed mode is a viable approach\n   to\
    \ deploy IPv6.  It is desirable that the visited SGSN have the\n   ability to\
    \ enable IPv6 on the user plane by default.  For support of\n   the PDP/PDN Type\
    \ IPv4v6, it is suggested to set the DAF.  As a\n   complementary function, the\
    \ implementation of a roaming APN\n   configuration is useful to accommodate the\
    \ visited network.  However,\n   it should consider roaming architecture and the\
    \ permitted PDP/PDN\n   Type to properly set the UE.  Roaming APN in the home\
    \ routed mode is\n   recommended to align with home network profile setting. \
    \ In the local\n   breakout case, PDP/PDN Type IPv4 could be selected as a safe\
    \ way to\n   initiate PDP/PDN activation.\n   In the service requests stage, the\
    \ failure cases mostly occur in the\n   local breakout case.  The visited network\
    \ may not be able to satisfy\n   the requested capability from applications or\
    \ UEs.  Operators may\n   consider using home routed mode to avoid these problems.\
    \  Several\n   solutions, in either the network side or mobile device side, can\
    \ also\n   help to address the issue.  For example,\n   o  464XLAT could help\
    \ IPv4 applications access IPv6 visited networks.\n   o  Networks can deploy a\
    \ AAA server to coordinate the mobile device\n      capability.  Once the GGSN/PGW\
    \ receives the session creation\n      request, it will initiate a request to\
    \ a AAA server in the home\n      network via the RADIUS or Diameter protocol\
    \ [TS29.061].  The\n      request contains subscriber and visited network information,\
    \ e.g.,\n      PDP/PDN Type, International Mobile Equipment Identity (IMEI),\n\
    \      Software Version (SV) and visited SGSN/MME location code, etc.\n      The\
    \ AAA server could take mobile device capability and combine it\n      with the\
    \ visited network information to ultimately determine the\n      type of session\
    \ to be created, i.e., IPv4, IPv6, or IPv4v6.\n"
- title: 8.  Security Considerations
  contents:
  - "8.  Security Considerations\n   Although this document defines neither a new\
    \ architecture nor a new\n   protocol, the reader is encouraged to refer to [RFC6459]\
    \ for a\n   generic discussion on IPv6-related security considerations.\n"
- title: 9.  References
  contents:
  - '9.  References

    '
- title: 9.1.  Normative References
  contents:
  - "9.1.  Normative References\n   [IR.21]    Global System for Mobile Communications\
    \ Association\n              (GSMA), \"Roaming Database, Structure and Updating\n\
    \              Procedures\", IR.21, Version 7.4, November 2013.\n   [IR.65]  \
    \  Global System for Mobile Communications Association\n              (GSMA),\
    \ \"IMS Roaming and Interworking Guidelines\", IR.65,\n              Version 15.0,\
    \ January 2015.\n   [RFC6146]  Bagnulo, M., Matthews, P., and I. van Beijnum,\
    \ \"Stateful\n              NAT64: Network Address and Protocol Translation from\
    \ IPv6\n              Clients to IPv4 Servers\", RFC 6146, April 2011,\n     \
    \         <http://www.rfc-editor.org/info/rfc6146>.\n   [RFC6147]  Bagnulo, M.,\
    \ Sullivan, A., Matthews, P., and I. van\n              Beijnum, \"DNS64: DNS\
    \ Extensions for Network Address\n              Translation from IPv6 Clients\
    \ to IPv4 Servers\", RFC 6147,\n              April 2011, <http://www.rfc-editor.org/info/rfc6147>.\n\
    \   [RFC6877]  Mawatari, M., Kawashima, M., and C. Byrne, \"464XLAT:\n       \
    \       Combination of Stateful and Stateless Translation\", RFC\n           \
    \   6877, April 2013,\n              <http://www.rfc-editor.org/info/rfc6877>.\n\
    \   [TS23.060] 3GPP, \"General Packet Radio Service (GPRS); Service\n        \
    \      description; Stage 2 v9.00\", TS 23.060, March 2009.\n   [TS23.401] 3GPP,\
    \ \"General Packet Radio Service (GPRS) enhancements\n              for Evolved\
    \ Universal Terrestrial Radio Access Network\n              (E-UTRAN) access v9.00\"\
    , TS 23.401, March 2009.\n   [TS29.002] 3GPP, \"Mobile Application Part (MAP)\
    \ specification\n              v9.12.0\", TS 29.002, December 2009.\n   [TS29.272]\
    \ 3GPP, \"Mobility Management Entity (MME) and Serving GPRS\n   Support Node (SGSN)\
    \ related interfaces based on Diameter protocol\n   v9.00\", TS 29.272, September\
    \ 2009.\n"
- title: 9.2.  Informative References
  contents:
  - "9.2.  Informative References\n   [EU-Roaming-III]\n              Amdocs Inc.,\
    \ \"Amdocs 2014 EU Roaming Regulation III\n              Solution\", July 2013,\
    \ <http://www.amdocs.com/Products/\n              Revenue-Management/Documents/\n\
    \              amdocs-eu-roaming-regulation-III-solution.pdf>.\n   [IR.33]   \
    \ Global System for Mobile Communications Association\n              (GSMA), \"\
    GPRS Roaming Guidelines\", IR.33, Version 7.0,\n              June 2014.\n   [IR.34]\
    \    Global System for Mobile Communications Association\n              (GSMA),\
    \ \"Guidelines for IPX Provider networks\", IR.34\n              Version 11.0,\
    \ January 2015.\n   [IR.88]    Global System for Mobile Communications Association\n\
    \              (GSMA), \"LTE Roaming Guidelines\", IR.88, Version 12.0,\n    \
    \          January 2015.\n   [IR.92]    Global System for Mobile Communications\
    \ Association\n              (GSMA), \"IMS Profile for Voice and SMS\", IR.92,\
    \ Version\n              7.1, January 2015.\n   [RCC.07]   Global System for Mobile\
    \ Communications Association\n              (GSMA), \"Rich Communication Suite\
    \ 5.2 Advanced\n              Communications Services and Client Specification\"\
    , RCC.07,\n              Version 5.0, May 2014.\n   [RFC6052]  Bao, C., Huitema,\
    \ C., Bagnulo, M., Boucadair, M., and X.\n              Li, \"IPv6 Addressing\
    \ of IPv4/IPv6 Translators\", RFC 6052,\n              October 2010, <http://www.rfc-editor.org/info/rfc6052>.\n\
    \   [RFC6459]  Korhonen, J., Ed., Soininen, J., Patil, B., Savolainen,\n     \
    \         T., Bajko, G., and K. Iisakkila, \"IPv6 in 3rd Generation\n        \
    \      Partnership Project (3GPP) Evolved Packet System (EPS)\",\n           \
    \   RFC 6459, January 2012,\n              <http://www.rfc-editor.org/info/rfc6459>.\n\
    \   [RFC6535]  Huang, B., Deng, H., and T. Savolainen, \"Dual-Stack Hosts\n  \
    \            Using \"Bump-in-the-Host\" (BIH)\", RFC 6535, February 2012,\n  \
    \            <http://www.rfc-editor.org/info/rfc6535>.\n   [RFC7050]  Savolainen,\
    \ T., Korhonen, J., and D. Wing, \"Discovery of\n              the IPv6 Prefix\
    \ Used for IPv6 Address Synthesis\", RFC\n              7050, November 2013,\n\
    \              <http://www.rfc-editor.org/info/rfc7050>.\n   [RFC7225]  Boucadair,\
    \ M., \"Discovering NAT64 IPv6 Prefixes Using the\n              Port Control\
    \ Protocol (PCP)\", RFC 7225, May 2014,\n              <http://www.rfc-editor.org/info/rfc7225>.\n\
    \   [TR23.975] 3GPP, \"IPv6 migration guidelines\", TR 23.975, June 2011.\n  \
    \ [TS23.003] 3GPP, \"Numbering, addressing and identification v9.0.0\",\n    \
    \          TS 23.003, September 2009.\n   [TS24.008] 3GPP, \"Mobile radio interface\
    \ Layer 3 specification; Core\n              network protocols; Stage 3 v9.00\"\
    , TS 24.008, September\n              2009.\n   [TS24.301] 3GPP, \"Non-Access-Stratum\
    \ (NAS) protocol for Evolved\n              Packet System (EPS) ; Stage 3 v9.00\"\
    , TS 24.301, September\n              2009.\n   [TS29.061] 3GPP, \"Interworking\
    \ between the Public Land Mobile Network\n              (PLMN) supporting packet\
    \ based services and Packet Data\n              Networks (PDN) v9.14.0\", TS 29.061,\
    \ January 2015.\n   [TS29.212] 3GPP, \"Policy and Charging Control (PCC); Reference\
    \ points\n              v9.0.0\", TS 29.212, September 2009.\n"
- title: Acknowledgements
  contents:
  - "Acknowledgements\n   Many thanks to F. Baker and J. Brzozowski for their support.\n\
    \   This document is the result of the IETF v6ops IPv6-Roaming design\n   team\
    \ effort.\n   The authors would like to thank Mikael Abrahamsson, Victor Kuarsingh,\n\
    \   Nick Heatley, Alexandru Petrescu, Tore Anderson, Cameron Byrne,\n   Holger\
    \ Metschulat, and Geir Egeland for their helpful discussions and\n   comments.\n\
    \   The authors especially thank Fred Baker and Ross Chandler for their\n   efforts\
    \ and contributions that substantially improved the readability\n   of the document.\n"
- title: Contributors
  contents:
  - "Contributors\n   The following individual contributed to this document.\n   \
    \   Vizdal Ales\n      Deutsche Telekom AG\n      Tomickova 2144/1\n      Prague\
    \ 4,  149 00\n      Czech Republic\n      EMail: ales.vizdal@t-mobile.cz\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Gang Chen\n   China Mobile\n   53A,Xibianmennei Ave.,\n\
    \   Xicheng District,\n   Beijing  100053\n   China\n   EMail: phdgang@gmail.com,\
    \ chengang@chinamobile.com\n   Hui Deng\n   China Mobile\n   53A,Xibianmennei\
    \ Ave.,\n   Xuanwu District,\n   Beijing  100053\n   China\n   EMail: denghui@chinamobile.com\n\
    \   Dave Michaud\n   Rogers Communications\n   8200 Dixie Rd.\n   Brampton, ON\
    \ L6T 0C1\n   Canada\n   EMail: dave.michaud@rci.rogers.com\n   Jouni Korhonen\n\
    \   Broadcom Corporation\n   3151 Zanker Rd.\n   San Jose, CA  95134\n   United\
    \ States\n   EMail: jouni.nospam@gmail.com\n   Mohamed Boucadair\n   France Telecom\n\
    \   Rennes,\n   35000\n   France\n   EMail: mohamed.boucadair@orange.com\n"
