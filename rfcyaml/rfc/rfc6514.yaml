- contents:
  - '     BGP Encodings and Procedures for Multicast in MPLS/BGP IP VPNs

    '
  title: __initial_text__
- contents:
  - "Abstract\n   This document describes the BGP encodings and procedures for\n   exchanging
    the information elements required by Multicast in MPLS/BGP\n   IP VPNs, as specified
    in RFC 6513.\n"
  title: Abstract
- contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This
    document is a product of the Internet Engineering Task Force\n   (IETF).  It represents
    the consensus of the IETF community.  It has\n   received public review and has
    been approved for publication by the\n   Internet Engineering Steering Group (IESG).
    \ Further information on\n   Internet Standards is available in Section 2 of RFC
    5741.\n   Information about the current status of this document, any errata,\n
    \  and how to provide feedback on it may be obtained at\n   http://www.rfc-editor.org/info/rfc6514.\n"
  title: Status of This Memo
- contents:
  - "Copyright Notice\n   Copyright (c) 2012 IETF Trust and the persons identified
    as the\n   document authors.  All rights reserved.\n   This document is subject
    to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n
    \  (http://trustee.ietf.org/license-info) in effect on the date of\n   publication
    of this document.  Please review these documents\n   carefully, as they describe
    your rights and restrictions with respect\n   to this document.  Code Components
    extracted from this document must\n   include Simplified BSD License text as described
    in Section 4.e of\n   the Trust Legal Provisions and are provided without warranty
    as\n   described in the Simplified BSD License.\n"
  title: Copyright Notice
- contents:
  - "Table of Contents\n   1. Introduction ....................................................4\n
    \  2. Specification of Requirements ...................................4\n   3.
    Terminology .....................................................4\n   4. MCAST-VPN
    NLRI ..................................................5\n     4.1. Intra-AS I-PMSI
    A-D Route ...................................6\n     4.2. Inter-AS I-PMSI A-D
    Route ...................................7\n     4.3. S-PMSI A-D Route ............................................7\n
    \    4.4. Leaf A-D Route ..............................................8\n     4.5.
    Source Active A-D Route .....................................9\n     4.6. C-Multicast
    Route ..........................................10\n   5. PMSI Tunnel Attribute
    ..........................................10\n   6. Source AS Extended Community
    ...................................13\n   7. VRF Route Import Extended Community
    ............................14\n   8. PE Distinguisher Labels Attribute ..............................15\n
    \  9. MVPN Auto-Discovery/Binding ....................................16\n     9.1.
    MVPN Auto-Discovery/Binding - Intra-AS Operations ..........16\n       9.1.1.
    Originating Intra-AS I-PMSI A-D Routes .................16\n       9.1.2. Receiving
    Intra-AS I-PMSI A-D Routes ...................19\n     9.2. MVPN Auto-Discovery/Binding
    - Inter-AS Operations ..........20\n       9.2.1. Originating Inter-AS I-PMSI
    A-D Routes .................22\n       9.2.2. When Not to Originate Inter-AS I-PMSI
    A-D Routes .......23\n       9.2.3. Propagating Inter-AS I-PMSI A-D Routes .................23\n
    \        9.2.3.1. Propagating Inter-AS I-PMSI A-D Routes - Overview ..23\n         9.2.3.2.
    Inter-AS I-PMSI A-D Route Received via EBGP ........24\n           9.2.3.2.1.
    Originating Leaf A-D Route into EBGP ...........25\n         9.2.3.3. Leaf A-D
    Route Received via EBGP ...................26\n         9.2.3.4. Inter-AS I-PMSI
    A-D Route Received via IBGP ........27\n           9.2.3.4.1. Originating Leaf
    A-D Route into IBGP ...........28\n         9.2.3.5. Leaf A-D Route Received via
    IBGP ...................29\n         9.2.3.6. Optimizing Bandwidth by IP Filtering
    on ASBRs ......30\n   10. Non-Congruent Unicast and Multicast Connectivity ..............30\n
    \  11. Exchange of C-Multicast Routing Information among PEs .........32\n     11.1.
    Originating C-Multicast Routes by a PE ....................32\n       11.1.1.
    Originating Routes: PIM as the C-Multicast Protocol ...32\n         11.1.1.1.
    Originating Source Tree Join C-Multicast Route ....33\n         11.1.1.2. Originating
    Shared Tree Join C-Multicast Route ....33\n       11.1.2. Originating Routes:
    mLDP as the C-Multicast Protocol ..34\n       11.1.3. Constructing the Rest of
    the C-Multicast Route ........34\n       11.1.4. Unicast Route Changes .................................35\n
    \    11.2. Propagating C-Multicast Routes by an ASBR .................36\n     11.3.
    Receiving C-Multicast Routes by a PE ......................37\n       11.3.1.
    Receiving Routes: PIM as the C-Multicast Protocol .....37\n         11.3.1.1.
    Receiving Source Tree Join C-Multicast Route ......38\n         11.3.1.2. Receiving
    Shared Tree Join C-Multicast Route ......38\n       11.3.2. Receiving Routes:
    mLDP as the C-Multicast Protocol ....39\n     11.4. C-Multicast Routes Aggregation
    ............................39\n   12. Using S-PMSI A-D Routes to Bind C-Trees
    to P-Tunnels ..........40\n     12.1. Originating S-PMSI A-D Routes .............................40\n
    \    12.2. Handling S-PMSI A-D Routes by ASBRs .......................43\n       12.2.1.
    Merging S-PMSI into an I-PMSI .........................43\n     12.3. Receiving
    S-PMSI A-D Routes by PEs ........................44\n   13. Switching from Shared
    a C-Tree to a Source C-Tree .............45\n     13.1. Source within a Site -
    Source Active Advertisement ........46\n     13.2. Receiving Source Active A-D
    Route .........................47\n       13.2.1. Pruning Sources off the Shared
    Tree ...................48\n   14. Supporting PIM-SM without Inter-Site Shared
    C-Trees ...........49\n     14.1. Discovering Active Multicast Sources ......................50\n
    \    14.2. Receiver(s) within a Site .................................51\n     14.3.
    Receiving C-Multicast Routes by a PE ......................52\n   15. Carrier's
    Carrier .............................................52\n   16. Scalability Considerations
    ....................................52\n     16.1. Dampening C-Multicast Routes
    ..............................54\n       16.1.1. Dampening Withdrawals of C-Multicast
    Routes ...........54\n       16.1.2. Dampening Source/Shared Tree Join C-Multicast
    Routes ..55\n     16.2. Dampening Withdrawals of Leaf A-D Routes ..................55\n
    \  17. Security Considerations .......................................55\n   18.
    IANA Considerations ...........................................56\n   19. Acknowledgements
    ..............................................57\n   20. References ....................................................57\n
    \    20.1. Normative References ......................................57\n     20.2.
    Informative References ....................................58\n"
  title: Table of Contents
- contents:
  - "1.  Introduction\n   This document describes the BGP encodings and procedures
    for\n   exchanging the information elements required by Multicast in MPLS/BGP\n
    \  IP VPNs, as specified in [MVPN].  This document assumes a thorough\n   familiarity
    with the procedures, concepts, and terms described in\n   [MVPN].\n   This document
    defines a new Network Layer Reachability Information\n   (NLRI), MCAST-VPN NLRI.
    \ The MCAST-VPN NLRI is used for MVPN auto-\n   discovery, advertising MVPN to
    Inclusive P-Multicast Service\n   Interface (I-PMSI) tunnel binding, advertising
    (C-S,C-G) to Selective\n   PMSI (S-PMSI) tunnel binding, VPN customer multicast
    routing\n   information exchange among Provider Edge routers (PEs), choosing a\n
    \  single forwarder PE, and for procedures in support of co-locating a\n   Customer
    Rendezvous Point (C-RP) on a PE.\n   This document specifies two new BGP attributes:
    the P-Multicast\n   Service Interface Tunnel (PMSI Tunnel) attribute and the PE\n
    \  Distinguisher Label attribute.\n   This document also defines two new BGP Extended
    Communities: the\n   Source Autonomous System (AS) Extended Community and the
    VPN Routing\n   and Forwarding (VRF) Route Import Extended Community.\n"
  title: 1.  Introduction
- contents:
  - "2.  Specification of Requirements\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\",
    \"SHALL\", \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"MAY\",
    and \"OPTIONAL\" in this\n   document are to be interpreted as described in [RFC2119].\n"
  title: 2.  Specification of Requirements
- contents:
  - "3.  Terminology\n   In the context of this document, we will refer to the MVPN
    auto-\n   discovery/binding information carried in BGP as \"auto-discovery\n   routes\"
    (\"A-D routes\").  For a given MVPN, there are the following\n   types of A-D
    routes:\n      + Intra-AS I-PMSI A-D route;\n      + Inter-AS I-PMSI A-D route;\n
    \     + S-PMSI A-D route;\n      + Leaf A-D route;\n      + Source Active A-D
    route.\n   In the context of this document, we will refer to the MVPN customers'\n
    \  multicast routing information carried in BGP as \"C-multicast routes\".\n   For
    a given MVPN, there are the following types of C-multicast\n   routes:\n      +
    Shared Tree Join route;\n      + Source Tree Join route;\n   For each MVPN present
    on a PE, the PE maintains a Tree Information\n   Base (MVPN-TIB).  This is the
    same as TIB defined in [RFC4601],\n   except that instead of a single TIB, a PE
    maintains multiple MVPN-\n   TIBs: one per each MVPN.\n   Throughout this document,
    we will use the term \"VPN-IP route\" to mean\n   a route that is either in the
    VPN-IPv4 address family [RFC4364] or in\n   the VPN-IPv6 address family [RFC4659].\n"
  title: 3.  Terminology
- contents:
  - "4.  MCAST-VPN NLRI\n   This document defines a new BGP NLRI, called the MCAST-VPN
    NLRI.\n   The following is the format of the MCAST-VPN NLRI:\n      +-----------------------------------+\n
    \     |    Route Type (1 octet)           |\n      +-----------------------------------+\n
    \     |     Length (1 octet)              |\n      +-----------------------------------+\n
    \     | Route Type specific (variable)    |\n      +-----------------------------------+\n
    \  The Route Type field defines the encoding of the rest of MCAST-VPN\n   NLRI
    (Route Type specific MCAST-VPN NLRI).\n   The Length field indicates the length
    in octets of the Route Type\n   specific field of the MCAST-VPN NLRI.\n   This
    document defines the following Route Types for A-D routes:\n      + 1 - Intra-AS
    I-PMSI A-D route;\n      + 2 - Inter-AS I-PMSI A-D route;\n      + 3 - S-PMSI
    A-D route;\n      + 4 - Leaf A-D route;\n      + 5 - Source Active A-D route.\n
    \  This document defines the following Route Types for C-multicast\n   routes:\n
    \     + 6 - Shared Tree Join route;\n      + 7 - Source Tree Join route;\n   The
    MCAST-VPN NLRI is carried in BGP [RFC4271] using BGP\n   Multiprotocol Extensions
    [RFC4760] with an Address Family Identifier\n   (AFI) of 1 or 2 and a Subsequent
    AFI (SAFI) of MCAST-VPN.  The NLRI\n   field in the MP_REACH_NLRI/MP_UNREACH_NLRI
    attribute contains the\n   MCAST-VPN NLRI (encoded as specified above).  The value
    of the AFI\n   field in the MP_REACH_NLRI/MP_UNREACH_NLRI attribute that carries
    the\n   MCAST-VPN NLRI determines whether the multicast source and multicast\n
    \  group addresses carried in the S-PMSI A-D routes, Source Active A-D\n   routes,
    and C-multicast routes are IPv4 or IPv6 addresses (AFI 1\n   indicates IPv4 addresses,
    AFI 2 indicates IPv6 addresses).\n   In order for two BGP speakers to exchange
    labeled MCAST-VPN NLRIs,\n   they must use a BGP Capabilities Advertisement to
    ensure that they\n   both are capable of properly processing such an NLRI.  This
    is done\n   as specified in [RFC4760], by using capability code 1 (multiprotocol\n
    \  BGP) with an AFI of 1 or 2 and an SAFI of MCAST-VPN.\n   The following describes
    the format of the Route Type specific MCAST-\n   VPN NLRI for various Route Types
    defined in this document.\n"
  - contents:
    - "4.1.  Intra-AS I-PMSI A-D Route\n   An Intra-AS I-PMSI A-D Route Type specific
      MCAST-VPN NLRI consists of\n   the following:\n      +-----------------------------------+\n
      \     |      RD   (8 octets)              |\n      +-----------------------------------+\n
      \     |   Originating Router's IP Addr    |\n      +-----------------------------------+\n
      \  The Route Distinguisher (RD) is encoded as described in [RFC4364].\n   Usage
      of Intra-AS I-PMSI A-D routes is described in Section 9.2.\n"
    title: 4.1.  Intra-AS I-PMSI A-D Route
  - contents:
    - "4.2.  Inter-AS I-PMSI A-D Route\n   An Inter-AS I-PMSI A-D Route Type specific
      MCAST-VPN NLRI consists of\n   the following:\n      +-----------------------------------+\n
      \     |      RD   (8 octets)              |\n      +-----------------------------------+\n
      \     |      Source AS (4 octets)         |\n      +-----------------------------------+\n
      \  The RD is encoded as described in [RFC4364].\n   The Source AS contains an
      Autonomous System Number (ASN).\n   Two-octet ASNs are encoded in the two low-order
      octets of the Source\n   AS field, with the two high-order octets set to zero.\n
      \  Usage of Inter-AS I-PMSI A-D routes is described in Section 9.1.\n"
    title: 4.2.  Inter-AS I-PMSI A-D Route
  - contents:
    - "4.3.  S-PMSI A-D Route\n   An S-PMSI A-D Route Type specific MCAST-VPN NLRI
      consists of the\n   following:\n      +-----------------------------------+\n
      \     |      RD   (8 octets)              |\n      +-----------------------------------+\n
      \     | Multicast Source Length (1 octet) |\n      +-----------------------------------+\n
      \     |  Multicast Source (variable)      |\n      +-----------------------------------+\n
      \     |  Multicast Group Length (1 octet) |\n      +-----------------------------------+\n
      \     |  Multicast Group   (variable)     |\n      +-----------------------------------+\n
      \     |   Originating Router's IP Addr    |\n      +-----------------------------------+\n
      \  The RD is encoded as described in [RFC4364].\n   The Multicast Source field
      contains the C-S address.  If the\n   Multicast Source field contains an IPv4
      address, then the value of\n   the Multicast Source Length field is 32.  If
      the Multicast Source\n   field contains an IPv6 address, then the value of the
      Multicast\n   Source Length field is 128.\n   The Multicast Group field contains
      the C-G address or C-LDP (Label\n   Distribution Protocol) MP Opaque Value Element
      (use of C-LDP MP\n   Opaque Value Element is described in the Section 11.3.2.
      \ If the\n   Multicast Group field contains an IPv4 address, then the value
      of the\n   Multicast Group Length field is 32.  If the Multicast Group field\n
      \  contains an IPv6 address, then the value of the Multicast Group\n   Length
      field is 128.\n   Usage of other values of the Multicast Source Length and Multicast\n
      \  Group Length fields is outside the scope of this document.\n   Usage of S-PMSI
      A-D routes is described in Section 12.\n"
    title: 4.3.  S-PMSI A-D Route
  - contents:
    - "4.4.  Leaf A-D Route\n   A Leaf A-D Route Type specific MCAST-VPN NLRI consists
      of the\n   following:\n      +-----------------------------------+\n      |
      \     Route Key (variable)         |\n      +-----------------------------------+\n
      \     |   Originating Router's IP Addr    |\n      +-----------------------------------+\n
      \  Leaf A-D routes may be originated as a result of processing a\n   received
      Inter-AS I-PMSI A-D route or S-PMSI A-D route.  A Leaf A-D\n   route is originated
      in these situations only if the received route\n   has a PMSI Tunnel attribute
      whose \"Leaf Information Required\" bit is\n   set to 1.\n   If a Leaf A-D route
      is originated as a result of processing one of\n   the received routes specified
      in the previous paragraph, the Route\n   Key of the Leaf A-D route is set to
      the NLRI of the received route.\n   Details of the use of the Leaf A-D route
      may be found in Sections\n   9.2.3.2.1, 9.2.3.3, 9.2.3.4.1, 9.2.3.5, and 12.3.\n"
    title: 4.4.  Leaf A-D Route
  - contents:
    - "4.5.  Source Active A-D Route\n   A Source Active A-D Route Type specific MCAST-VPN
      NLRI consists of\n   the following:\n      +-----------------------------------+\n
      \     |      RD   (8 octets)              |\n      +-----------------------------------+\n
      \     | Multicast Source Length (1 octet) |\n      +-----------------------------------+\n
      \     |   Multicast Source (variable)     |\n      +-----------------------------------+\n
      \     |  Multicast Group Length (1 octet) |\n      +-----------------------------------+\n
      \     |  Multicast Group (variable)       |\n      +-----------------------------------+\n
      \  The RD is encoded as described in [RFC4364].\n   The Multicast Source field
      contains the C-S address.  If the\n   Multicast Source field contains an IPv4
      address, then the value of\n   the Multicast Source Length field is 32.  If
      the Multicast Source\n   field contains an IPv6 address, then the value of the
      Multicast\n   Source Length field is 128.\n   Use of the Source Active A-D routes
      with the Multicast Source Length\n   field of 0 is outside the scope of this
      document.\n   The Multicast Group field contains the C-G address.  If the Multicast\n
      \  Group field contains an IPv4 address, then the value of the Multicast\n   Group
      Length field is 32.  If the Multicast Group field contains an\n   IPv6 address,
      then the value of the Multicast Group Length field is\n   128.\n   Source Active
      A-D routes with a Multicast group belonging to the\n   Source Specific Multicast
      (SSM) range (as defined in [RFC4607], and\n   potentially extended locally on
      a router) MUST NOT be advertised by a\n   router and MUST be discarded if received.\n
      \  Usage of Source Active A-D routes is described in Sections 13 and 14.\n"
    title: 4.5.  Source Active A-D Route
  - contents:
    - "4.6.  C-Multicast Route\n   A Shared Tree Join route and a Source Tree Join
      Route Type specific\n   MCAST-VPN NLRI consists of the following:\n      +-----------------------------------+\n
      \     |      RD   (8 octets)              |\n      +-----------------------------------+\n
      \     |    Source AS (4 octets)           |\n      +-----------------------------------+\n
      \     | Multicast Source Length (1 octet) |\n      +-----------------------------------+\n
      \     |   Multicast Source (variable)     |\n      +-----------------------------------+\n
      \     |  Multicast Group Length (1 octet) |\n      +-----------------------------------+\n
      \     |  Multicast Group   (variable)     |\n      +-----------------------------------+\n
      \  The RD is encoded as described in [RFC4364].\n   The Source AS contains an
      ASN.  Two-octet ASNs are encoded in the\n   low-order two octets of the Source
      AS field.\n   For a Shared Tree Join route, the Multicast Source field contains
      the\n   C-RP address; for a Source Tree Join route, the Multicast Source\n   field
      contains the C-S address.  If the Multicast Source field\n   contains an IPv4
      address, then the value of the Multicast Source\n   Length field is 32.  If
      the Multicast Source field contains an IPv6\n   address, then the value of the
      Multicast Source Length field is 128.\n   The Multicast Group field contains
      the C-G address or C-MP Opaque\n   Value Element.  If the Multicast Group field
      contains an IPv4\n   address, then the value of the Multicast Group Length field
      is 32.\n   If the Multicast Group field contains an IPv6 address, then the value\n
      \  of the Multicast Group Length field is 128.\n   Usage of C-multicast routes
      is described in Section 11.\n"
    title: 4.6.  C-Multicast Route
  title: 4.  MCAST-VPN NLRI
- contents:
  - "5.  PMSI Tunnel Attribute\n   This document defines and uses a new BGP attribute
    called the\n   \"P-Multicast Service Interface Tunnel (PMSI Tunnel) attribute\".
    \ This\n   is an optional transitive BGP attribute.  The format of this\n   attribute
    is defined as follows:\n      +---------------------------------+\n      |  Flags
    (1 octet)                |\n      +---------------------------------+\n      |
    \ Tunnel Type (1 octets)         |\n      +---------------------------------+\n
    \     |  MPLS Label (3 octets)          |\n      +---------------------------------+\n
    \     |  Tunnel Identifier (variable)   |\n      +---------------------------------+\n
    \  The Flags field has the following format:\n       0 1 2 3 4 5 6 7\n      +-+-+-+-+-+-+-+-+\n
    \     |  reserved   |L|\n      +-+-+-+-+-+-+-+-+\n   This document defines the
    following flags:\n     + Leaf Information Required (L)\n   The Tunnel Type identifies
    the type of the tunneling technology used\n   to establish the PMSI tunnel.  The
    type determines the syntax and\n   semantics of the Tunnel Identifier field.  This
    document defines the\n   following Tunnel Types:\n      + 0 - No tunnel information
    present\n      + 1 - RSVP-TE P2MP LSP\n      + 2 - mLDP P2MP LSP\n      + 3 -
    PIM-SSM Tree\n      + 4 - PIM-SM Tree\n      + 5 - BIDIR-PIM Tree\n      + 6 -
    Ingress Replication\n      + 7 - mLDP MP2MP LSP\n   If the MPLS Label field is
    non-zero, then it contains an MPLS label\n   encoded as 3 octets, where the high-order
    20 bits contain the label\n   value.  Absence of an MPLS Label is indicated by
    setting the MPLS\n   Label field to zero.\n   When the Tunnel Type is set to \"No
    tunnel information present\", the\n   PMSI Tunnel attribute carries no tunnel
    information (no Tunnel\n   Identifier).  This type is to be used only in the following
    case: to\n   enable explicit tracking for a particular customer multicast flow
    (by\n   setting the Leaf Information Required flag to 1), but without binding\n
    \  this flow to a particular provider tunnel (by omitting any tunnel\n   information).\n
    \  When the Tunnel Type is set to RSVP - Traffic Engineering (RSVP-TE)\n   Point-to-Multipoint
    (P2MP) Label Switched Path (LSP), the Tunnel\n   Identifier is <Extended Tunnel
    ID, Reserved, Tunnel ID, P2MP ID> as\n   carried in the RSVP-TE P2MP LSP SESSION
    Object [RFC4875].\n   When the Tunnel Type is set to multipoint Label Distribution
    Protocol\n   (mLDP) P2MP LSP, the Tunnel Identifier is a P2MP Forwarding\n   Equivalence
    Class (FEC) Element [mLDP].\n   When the Tunnel Type is set to Protocol Independent
    Multicast -\n   Sparse Mode (PIM-SM) tree, the Tunnel Identifier is <Sender Address,\n
    \  P-Multicast Group>.  The node that originated the attribute MUST use\n   the
    address carried in the Sender Address as the source IP address\n   for the IP/GRE
    (Generic Routing Encapsulation) encapsulation of the\n   MVPN data.\n   When the
    Tunnel Type is set to PIM-SSM tree, the Tunnel Identifier is\n   <P-Root Node
    Address, P-Multicast Group>.  The node that originates\n   the attribute MUST
    use the address carried in the P-Root Node Address\n   as the source IP address
    for the IP/GRE encapsulation of the MVPN\n   data.  The P-Multicast Group in the
    Tunnel Identifier of the Tunnel\n   attribute MUST NOT be expected to be the same
    group for all Intra-AS\n   A-D routes for the same MVPN.  According to [RFC4607],
    the group\n   address can be locally allocated by the originating PE without any\n
    \  consideration for the group address used by other PE on the same\n   MVPN.\n
    \  When the Tunnel Type is set to BIDIR-PIM tree, the Tunnel Identifier\n   is
    <Sender Address, P-Multicast Group>.  The node that originated the\n   attribute
    MUST use the address carried in the Sender Address as the\n   source IP address
    for the IP/GRE encapsulation of the MVPN data.\n   When the Tunnel Type is set
    to PIM-SM or BIDIR-PIM tree, then the\n   P-Multicast Group in the Tunnel Identifier
    of the Tunnel attribute\n   SHOULD contain the same multicast group address for
    all Intra-AS\n   I-PMSI A-D routes for the same MVPN originated by PEs within
    a given\n   AS.  How this multicast group address is chosen is outside the scope\n
    \  of this specification.\n   When the Tunnel Type is set to Ingress Replication,
    the Tunnel\n   Identifier carries the unicast tunnel endpoint IP address of the\n
    \  local PE that is to be this PE's receiving endpoint address for the\n   tunnel.\n
    \  When the Tunnel Type is set to mLDP Multipoint-to-Multipoint (MP2MP)\n   LSP,
    the Tunnel Identifier is an MP2MP FEC Element [mLDP].\n   The use of mLDP MP2MP
    LSPs as Provider tunnels (P-tunnels) requires\n   procedures that are outside
    the scope of this document.\n   A router that supports the PMSI Tunnel attribute
    considers this\n   attribute to be malformed if either (a) it contains an undefined\n
    \  tunnel type in the Tunnel Type field of the attribute, or (b) the\n   router
    cannot parse the Tunnel Identifier field of the attribute as a\n   tunnel identifier
    of the tunnel types specified in the Tunnel Type\n   field of the attribute.\n
    \  When a router that receives a BGP Update that contains the PMSI\n   Tunnel
    attribute with its Partial bit set determines that the\n   attribute is malformed,
    the router SHOULD treat this Update as though\n   all the routes contained in
    this Update had been withdrawn.\n   An implementation MUST provide debugging facilities
    to permit issues\n   caused by a malformed PMSI Tunnel attribute to be diagnosed.
    \ At a\n   minimum, such facilities MUST include logging an error when such an\n
    \  attribute is detected.\n   The PMSI Tunnel attribute is used in conjunction
    with Intra-AS I-PMSI\n   A-D routes, Inter-AS I-PMSI A-D routes, S-PMSI A-D routes,
    and Leaf\n   A-D routes.\n"
  title: 5.  PMSI Tunnel Attribute
- contents:
  - "6.  Source AS Extended Community\n   This document defines a new BGP Extended
    Community called \"Source\n   AS\".\n   The Source AS is an AS-specific Extended
    Community, of an extended\n   type, and is transitive across AS boundaries [RFC4360].\n
    \  The Global Administrator field of this Community MUST be set to the\n   ASN
    of the PE.  The Local Administrator field of this Community MUST\n   be set to
    0.\n   Consider a given MVPN that uses BGP for exchanging C-multicast\n   routes,
    and/or uses segmented inter-AS tunnels.  A PE that has sites\n   of that MVPN
    connected to it, and originates a (unicast) route to\n   VPN-IP addresses associated
    with the destinations within these sites,\n   MUST include in the BGP Update message
    that carries this route the\n   Source AS Extended Community.\n   The usage of
    a received Source AS Extended Community is described in\n   Section 11.1.3.\n"
  title: 6.  Source AS Extended Community
- contents:
  - "7.  VRF Route Import Extended Community\n   This document defines a new BGP Extended
    Community called \"VRF Route\n   Import\".\n   The VRF Route Import is an IP-address-specific
    Extended Community, of\n   an extended type, and is transitive across AS boundaries
    [RFC4360].\n   To support MVPN in addition to the import/export Route Target(s)\n
    \  Extended Communities used by the unicast routing, each VRF on a PE\n   MUST
    have an import Route Target Extended Community, except if it is\n   known a priori
    that none of the (local) MVPN sites associated with\n   the VRF contain multicast
    source(s) and/or C-RP; in which case, the\n   VRF need not have this import Route
    Target.\n   We refer to this Route Target as the \"C-multicast Import RT\", as
    this\n   Route Target controls imports of C-multicast routes into a particular\n
    \  VRF.\n   A PE constructs C-multicast Import RT as follows:\n    + The Global
    Administrator field of the C-multicast Import RT MUST\n      be set to an IP address
    of the PE.  This address SHOULD be common\n      for all the VRFs on the PE (e.g.,
    this address may be the PE's\n      loopback address).\n    + The Local Administrator
    field of the C-multicast Import RT\n      associated with a given VRF contains
    a 2-octet number that\n      uniquely identifies that VRF within the PE that contains
    the VRF\n      (procedures for assigning such numbers are purely local to the
    PE\n      and are outside the scope of this document).\n   The way C-multicast
    Import RT is constructed allows it to uniquely\n   identify a VRF.\n   A PE that
    has site(s) of a given MVPN connected to it needs to\n   communicate the value
    of the C-multicast Import RT associated with\n   the VRF of that MVPN on the PE
    to all other PEs that have sites of\n   that MVPN.  To accomplish this, a PE that
    originates a (unicast)\n   route to VPN-IP addresses MUST include in the BGP Updates
    message\n   that carries this route the VRF Route Import Extended Community that\n
    \  has the value of the C-multicast Import RT of the VRF associated with\n   the
    route, except if it is known a priori (e.g., via provisioning)\n   that none of
    these addresses could act as multicast sources and/or\n   RP; in which case, the
    (unicast) route MUST NOT carry the VRF Route\n   Import Extended Community.\n
    \  If a PE uses Route Target Constraint [RT-CONSTRAIN], the PE SHOULD\n   advertise
    all such C-multicast Import RTs using Route Target\n   Constraints (note that
    doing this requires just a single Route Target\n   Constraint advertisement by
    the PE).  This allows each C-multicast\n   route to reach only the relevant PE.
    \ To constrain distribution of\n   the Route Target Constraint routes to the AS
    of the advertising PE,\n   these routes SHOULD carry the NO_EXPORT Community [RFC1997].\n
    \  Usage of VRF Route Import Extended Community is described in\n   Section 11.1.3.\n"
  title: 7.  VRF Route Import Extended Community
- contents:
  - "8.  PE Distinguisher Labels Attribute\n   This document defines a new BGP attribute,
    called the \"PE\n   Distinguisher Labels\" attribute.  This is an optional transitive
    BGP\n   attribute.  The format of this attribute is defined as follows:\n      +---------------------------------+\n
    \     |           PE Address            |\n      +---------------------------------+\n
    \     |     Label (3 octets)            |\n      +---------------------------------+\n
    \     .......\n      +---------------------------------+\n      |           PE
    Address            |\n      +---------------------------------+\n      |     Label
    (3 octets)            |\n      +---------------------------------+\n   The Label
    field contains an MPLS label encoded as 3 octets, where the\n   high-order 20
    bits contain the label value.\n   A router that supports the PE Distinguisher
    Labels attribute\n   considers this attribute to be malformed if the PE Address
    field does\n   not contain a unicast address.  The attribute is also considered
    to\n   be malformed if: (a) the PE Address field is expected to be an IPv4\n   address,
    and the length of the attribute is not a multiple of 7 or\n   (b) the PE Address
    field is expected to be an IPv6 address, and the\n   length of the attribute is
    not a multiple of 19.  The length of the\n   Route Type field of MCAST-VPN NLRI
    of the route that carries the PE\n   Distinguisher Labels attribute provides the
    information on whether\n   the PE Address field contains an IPv4 or IPv6 address.
    \ Each of the\n   PE addresses in the PE Distinguisher Labels attribute MUST be
    of the\n   same address family as the \"Originating Router's IP Address\" of the\n
    \  route that is carrying the attribute.\n   When a router that receives a BGP
    Update that contains the PE\n   Distinguisher Labels attribute with its Partial
    bit set determines\n   that the attribute is malformed, the router SHOULD treat
    this Update\n   as though all the routes contained in this Update had been withdrawn.\n
    \  An implementation MUST provide debugging facilities to permit issues\n   caused
    by malformed PE Distinguisher Label attribute to be diagnosed.\n   At a minimum,
    such facilities MUST include logging an error when such\n   an attribute is detected.\n
    \  Usage of this attribute is described in [MVPN].\n"
  title: 8.  PE Distinguisher Labels Attribute
- contents:
  - "9.  MVPN Auto-Discovery/Binding\n   This section specifies procedures for the
    auto-discovery of MVPN\n   memberships and the distribution of information used
    to instantiate\n   I-PMSIs.\n   There are two MVPN auto-discovery/binding mechanisms,
    dubbed \"intra-\n   AS\" and \"inter-AS\" respectively.\n   The intra-AS mechanisms
    provide auto-discovery/binding within a\n   single AS.\n   The intra-AS mechanisms
    also provide auto-discovery/binding across\n   multiple ASes when non-segmented
    inter-AS tunnels are being used.\n   The inter-AS mechanisms provide auto-discovery/binding
    across\n   multiple ASes when segmented inter-AS tunnels are being used.\n   Note
    that if a multi-AS system uses option (a) of section 10 of\n   [RFC4364], the
    notion of inter-AS tunnels does not apply, and so it\n   needs only the intra-AS
    mechanisms.\n"
  - contents:
    - "9.1.  MVPN Auto-Discovery/Binding - Intra-AS Operations\n   This section describes
      exchanges of Intra-AS I-PMSI A-D routes\n   originated/received by PEs within
      the same AS, or if non-segmented\n   inter-AS tunnels are used, then by all
      PEs.\n"
    - contents:
      - "9.1.1.  Originating Intra-AS I-PMSI A-D Routes\n   To participate in the
        MVPN auto-discovery/binding, a PE router that\n   has a given VRF of a given
        MVPN MUST, except for the cases specified\n   in this section, originate an
        Intra-AS I-PMSI A-D route and\n   advertises this route in IBGP.  The route
        is constructed as follows.\n   The route carries a single MCAST-VPN NLRI with
        the RD set to the RD\n   of the VRF, and the Originating Router's IP Address
        field set to the\n   IP address that the PE places in the Global Administrator
        field of\n   the VRF Route Import Extended Community of the VPN-IP routes\n
        \  advertised by the PE.  Note that the <RD, Originating Router's IP\n   Address>
        tuple uniquely identifies a given multicast VRF.\n   The route carries the
        PMSI Tunnel attribute if and only if an I-PMSI\n   is used for the MVPN (the
        conditions under which an I-PMSI is used\n   can be found in [MVPN]).  Depending
        on the technology used for the\n   P-tunnel for the MVPN on the PE, the PMSI
        Tunnel attribute of the\n   Intra-AS I-PMSI A-D route is constructed as follows.\n
        \   + If the PE that originates the advertisement uses a P-multicast\n      tree
        for the P-tunnel for the MVPN, the PMSI Tunnel attribute MUST\n      contain
        the identity of the tree (note that the PE could create\n      the identity
        of the tree prior to the actual instantiation of the\n      tree).\n    +
        A PE that uses a P-multicast tree for the P-tunnel MAY aggregate\n      two
        or more MVPNs present on the PE onto the same tree.  In this\n      case,
        in addition to carrying the identity of the tree, the PMSI\n      Tunnel attribute
        of the Intra-AS I-PMSI A-D route MUST carry an\n      MPLS upstream-assigned
        label that the PE has bound uniquely to the\n      MVPN associated with this
        route (as determined by its RTs).\n      If the PE has already advertised
        Intra-AS I-PMSI A-D routes for\n      two or more MVPNs that it now desires
        to aggregate, then the PE\n      MUST re-advertise those routes.  The re-advertised
        routes MUST be\n      the same as the original ones, except for the PMSI Tunnel\n
        \     attribute and the label carried in that attribute.\n    + If the PE
        that originates the advertisement uses ingress\n      replication for the
        P-tunnel for the MVPN, the route MUST include\n      the PMSI Tunnel attribute
        with the Tunnel Type set to Ingress\n      Replication and Tunnel Identifier
        set to a routable address of the\n      PE.  The PMSI Tunnel attribute MUST
        carry a downstream-assigned\n      MPLS label.  This label is used to demultiplex
        the MVPN traffic\n      received over a unicast tunnel by the PE.\n    + The
        Leaf Information Required flag of the PMSI Tunnel attribute\n      MUST be
        set to zero and MUST be ignored on receipt.\n   Discovery of PE capabilities
        in terms of what tunnel types they\n   support is outside the scope of this
        document.  Within a given AS,\n   PEs participating in an MVPN are expected
        to advertise tunnel\n   bindings whose tunnel types are supported by all other
        PEs that are\n   participating in this MVPN and are part of the same AS.  In
        addition,\n   in the inter-AS scenario with non-segmented inter-AS tunnels,
        the\n   tunnel types have to be supported by all PEs that are participating\n
        \  in this MVPN, irrespective of whether or not these PEs are in the\n   same
        AS.\n   The Next Hop field of the MP_REACH_NLRI attribute of the route MUST\n
        \  be set to the same IP address as the one carried in the Originating\n   Router's
        IP Address field.\n   By default, the distribution of the Intra-AS I-PMSI
        A-D routes is\n   controlled by the same Route Targets as the ones used for
        the\n   distribution of VPN-IP unicast routes.  That is, by default, the\n
        \  Intra-AS I-PMSI A-D route MUST carry the export Route Target used by\n
        \  the unicast routing.  If any other PE has one of these Route Targets\n
        \  configured as an import Route Target for a VRF present on the PE, it\n
        \  treats the advertising PE as a member in the MVPN to which the VRF\n   belongs.
        \ The default could be modified via configuration by having a\n   set of Route
        Targets used for the Intra-AS I-PMSI A-D routes being\n   distinct from the
        ones used for the VPN-IP unicast routes (see also\n   Section 10).\n   To
        constrain distribution of the intra-AS membership/binding\n   information
        to the AS of the advertising PE, the BGP Update message\n   originated by
        the advertising PE SHOULD carry the NO_EXPORT Community\n   [RFC1997].\n   Note
        that if non-segmented inter-AS P-tunnels are being used, then\n   the Intra-AS
        I-PMSI routes need to be distributed to other ASes and\n   MUST NOT carry
        the NO_EXPORT Community.\n   When BGP is used to exchange C-multicast routes,
        if (a) it is known a\n   priori that, as a matter of policy, none of the MVPN
        sites connected\n   to a given PE are allowed to send multicast traffic to
        other sites of\n   that MVPN (in other words, all these sites are only in
        the Receiver\n   Sites set), (b) the PE does not use ingress replication for
        the\n   incoming traffic of that MVPN, and (c) none of the other PEs that\n
        \  have VRFs of that MVPN use RSVP-TE P2MP LSP for that MVPN, then the\n   local
        PE SHOULD NOT originate an Intra-AS I-PMSI A-D route.\n   When BGP is used
        to exchange C-multicast routes, if it is known a\n   priori that, as a matter
        of policy, none of the MVPN sites connected\n   to a given PE can receive
        multicast traffic from other sites of that\n   MVPN (in other words, all these
        sites are only in the Sender Sites\n   set), and the PE uses ingress replication
        for that MVPN, then the PE\n   SHOULD NOT originate an Intra-AS I-PMSI A-D
        route for that MVPN.\n"
      title: 9.1.1.  Originating Intra-AS I-PMSI A-D Routes
    - contents:
      - "9.1.2.  Receiving Intra-AS I-PMSI A-D Routes\n   When a PE receives a BGP
        Update message that carries an Intra-AS\n   I-PMSI A-D route such that (a)
        at least one of the Route Targets of\n   the route matches one of the import
        Route Targets configured for a\n   particular VRF on the local PE, (b) either
        the route was originated\n   by some other PE within the same AS as the local
        PE, or the MVPN\n   associated with the VRF uses non-segmented inter-AS tunnels,
        and (c)\n   the BGP route selection determines that this is the best route
        with\n   respect to the NLRI carried by the route, the PE performs the\n   following.\n
        \  If the route does not carry the PMSI Tunnel attribute and ingress\n   replication
        is not used, either a) the PE that originated the route\n   will be using
        only S-PMSIs to send traffic to remote PEs, or b) as a\n   matter of policy,
        the PE that originated the route cannot send\n   multicast traffic from the
        MVPN sites connected to it to other sites\n   of that MVPN (in other words,
        the sites connected to the PE are only\n   in the Receiver Sites set).\n   When
        BGP is used to exchange C-multicast routes, to distinguish\n   between cases
        (a) and (b), we use the presence/absence of the VRF\n   Route Import Extended
        Community in the unicast VPN routes, as\n   follows.  As specified in Section
        7, if it is know a priori that none\n   of the addresses carried in the NLRI
        of a given (unicast) VPN route\n   could act as multicast sources and/or C-RP,
        then such a route does\n   not carry the VRF Route Import Extended Community.
        \ Hence, based on\n   the Upstream Multicast Hop (UMH) selection algorithm
        specified in\n   [MVPN], such a route will be ineligible for the UMH selection.
        \ This\n   implies that if a given VPN route is selected by the UMH selection\n
        \  procedures, and the PE that originates this VPN route also originates\n
        \  an Intra-AS I-PMSI A-D route, but this route does not carry the PMSI\n
        \  Tunnel attribute, then this PE will be using only S-PMSIs for sending\n
        \  (multicast) data.\n   If the route carries the PMSI Tunnel attribute, then:\n
        \   + If the Tunnel Type in the PMSI Tunnel attribute is set to Ingress\n
        \     Replication, then the MPLS label and the address carried in the\n      Tunnel
        Identifier field of the PMSI Tunnel attribute should be\n      used when the
        local PE sends multicast traffic to the PE that\n      originated the route.\n
        \   + If the Tunnel Type in the PMSI Tunnel attribute is set to mLDP\n      P2MP
        LSP, mLDP MP2MP LSP, PIM-SSM tree, PIM-SM tree, or BIDIR-PIM\n      tree,
        the PE SHOULD join as soon as possible the P-multicast tree\n      whose identity
        is carried in the Tunnel Identifier.\n    + If the Tunnel Type in the PMSI
        Tunnel attribute is set to RSVP-TE\n      P2MP LSP, then the PE that originated
        the route MUST establish an\n      RSVP-TE P2MP LSP with the local PE as a
        leaf.  This LSP may have\n      been established before the local PE receives
        the route, or it may\n      be established after the local PE receives the
        route.\n    + The receiving PE has to establish the appropriate state to\n
        \     properly handle the traffic received on the P-multicast tree.\n    +
        If the PMSI Tunnel attribute does not carry a label, then all\n      packets
        that are received on the P-multicast tree, as identified\n      by the PMSI
        Tunnel attribute, are forwarded using the VRF that has\n      at least one
        of its import Route Targets that matches one of the\n      Route Targets of
        the received Intra-AS I-PMSI A-D route.\n    + If the PMSI Tunnel attribute
        has the Tunnel Type set to mLDP P2MP\n      LSP, PIM-SSM tree, PIM-SM tree,
        BIDIR-PIM tree, or RSVP-TE P2MP\n      LSP, and the attribute also carries
        an MPLS label, then this is an\n      upstream-assigned label, and all packets
        that are received on the\n      P-multicast tree, as identified by the PMSI
        Tunnel attribute, with\n      that upstream-assigned label are forwarded using
        the VRF that has\n      at least one of its import Route Targets that matches
        one of the\n      Route Targets of the received Intra-AS I-PMSI A-D route.\n
        \  Irrespective of whether the route carries the PMSI Tunnel attribute,\n
        \  if the local PE uses RSVP-TE P2MP LSP for sending (multicast) traffic\n
        \  from the VRF to the sites attached to other PEs, then the local PE\n   uses
        the Originating Router's IP address information carried in the\n   route to
        add the PE that originated the route as a leaf node to the\n   LSP.\n"
      title: 9.1.2.  Receiving Intra-AS I-PMSI A-D Routes
    title: 9.1.  MVPN Auto-Discovery/Binding - Intra-AS Operations
  - contents:
    - "9.2.  MVPN Auto-Discovery/Binding - Inter-AS Operations\n   This section applies
      only to the case where segmented inter-AS\n   tunnels are used.\n   An Autonomous
      System Border Router (ASBR) may be configured to\n   support a particular MVPN
      as follows:\n    + An ASBR MUST be configured with a set of (import) Route Targets\n
      \     (RTs) that specifies the set of MVPNs supported by the ASBR.\n      These
      Route Targets control acceptance of Intra-AS/Inter-AS I-PMSI\n      A-D routes
      by the ASBR.  As long as unicast and multicast\n      connectivity are congruent,
      this could be the same set of Route\n      Targets as the one used for supporting
      unicast (and therefore\n      would not require any additional configuration
      above and beyond of\n      what is required for unicast).  Note that instead
      of being\n      configured, the ASBR MAY obtain this set of (import) Route Targets\n
      \     (RTs) by using Route Target Constraint [RT-CONSTRAIN].\n    + The ASBR
      MUST be (auto-)configured with an import Route Target\n      called \"ASBR Import
      RT\".  ASBR Import RT controls acceptance of\n      Leaf A-D routes and C-multicast
      routes by the ASBR, and is used to\n      constrain distribution of both Leaf
      A-D routes and C-multicast\n      routes (see Section 11).\n      ASBR Import
      RT is an IP-address-specific Route Target.  The Global\n      Administrator
      field of the ASBR Import RT MUST be set to the IP\n      address carried in
      the Next Hop of all the Inter-AS I-PMSI A-D\n      routes and S-PMSI A-D routes
      advertised by this ASBR (if the ASBR\n      uses different Next Hops, then the
      ASBR MUST be (auto-)configured\n      with multiple ASBR Import RTs, one per
      each such Next Hop).  The\n      Local Administrator field of the ASBR Import
      RT MUST be set to 0.\n      If the ASBR supports Route Target Constraint [RT-CONSTRAIN],
      the\n      ASBR SHOULD advertise its ASBR Import RT within its own AS using\n
      \     Route Target Constraints.  To constrain distribution of the Route\n      Target
      Constraint routes to the AS of the advertising ASBR, these\n      routes SHOULD
      carry the NO_EXPORT Community [RFC1997].\n    + The ASBR MUST be configured
      with the tunnel types for the intra-AS\n      segments of the MVPNs supported
      by the ASBR, as well as (depending\n      on the tunnel type) the information
      needed to create the PMSI\n      attribute for these tunnel types.  Note that
      instead of being\n      configured, the ASBR MAY derive the tunnel types from
      the Intra-AS\n      I-PMSI A-D routes received by the ASBR.\n    + If the ASBR
      originates an Inter-AS I-PMSI A-D route for a\n      particular MVPN present
      on some of the PEs within its own AS, the\n      ASBR MUST be (auto-)configured
      with an RD for that MVPN.  It is\n      RECOMMENDED that one of the following
      two options be used:\n  (1) To allow more aggregation of Inter-AS I-PMSI A-D
      routes, it is\n      recommended that all the ASBRs within an AS that are configured
      to\n      originate an Inter-AS I-PMSI A-D route for a particular MVPN be\n
      \     configured with the same RD (although for a given MVPN each AS may\n      assign
      this RD on its own, without coordination with other ASes).\n  (2) To allow more
      control over spreading MVPN traffic among multiple\n      ASBRs within a given
      AS, it is recommended that each ASBR have a\n      distinct RD per each MVPN;
      in which case, such an RD SHOULD be\n      auto-configured.\n   If an ASBR is
      configured to support a particular MVPN, the ASBR MUST\n   participate in the
      intra-AS MVPN auto-discovery/binding procedures\n   for that MVPN within the
      ASBR's own AS, as specified in Section 9.1.\n   Moreover, in addition to the
      above, the ASBR performs procedures\n   described in Sections 9.2.1, 9.2.2,
      and 9.2.3.\n"
    - contents:
      - "9.2.1.  Originating Inter-AS I-PMSI A-D Routes\n   For a given MVPN configured
        on an ASBR when the ASBR determines\n   (using the intra-AS auto-discovery
        procedures) that at least one of\n   the PEs of its own AS has (directly)
        connected site(s) of the MVPN,\n   the ASBR originates an Inter-AS I-PMSI
        A-D route and advertises it in\n   External BGP (EBGP).  The route is constructed
        as follows:\n    + The route carries a single MCAST-VPN NLRI with the RD set
        to the\n      RD configured for that MVPN on the ASBR, and the Source AS set
        to\n      the ASN of the ASBR.\n    + The route carries the PMSI Tunnel attribute
        if and only if an\n      I-PMSI is used for the MVPN.  The Tunnel Type in
        the attribute is\n      set to Ingress Replication; the Leaf Information Required
        flag is\n      set to 1; the attribute carries no MPLS labels.\n    + The
        Next Hop field of the MP_REACH_NLRI attribute is set to a\n      routable
        IP address of the ASBR.\n    + The default policy for aggregation of Intra-AS
        I-PMSI A-D routes\n      into an Inter-AS I-PMSI A-D route is that a given
        Inter-AS I-PMSI\n      A-D route aggregates only the Intra-AS I-PMSI A-D routes
        that\n      carry exactly the same set of RTs (note that this set may have\n
        \     just one RT).  In this case, an Inter-AS I-PMSI A-D route\n      originated
        by an ASBR carries exactly the same RT(s) as the RT(s)\n      carried by the
        Intra-AS I-PMSI A-D routes that the ASBR aggregates\n      into that Inter-AS
        I-PMSI A-D route.  An implementation MUST\n      support the default policy
        for aggregation of Intra-AS I-PMSI A-D\n      routes into an Inter-AS I-PMSI
        A-D route.\n    + The default policy for aggregation could be modified via\n
        \     configuration on the ASBR.  An implementation MAY support such\n      functionality.
        \ Modified policy MUST include rules for\n      constructing RTs carried by
        the Inter-AS I-PMSI A-D routes\n      originated by the ASBR.\n   An Inter-AS
        I-PMSI A-D route for a given <AS, MVPN> indicates the\n   presence of the
        MVPN sites connected to one or more PEs of the AS.\n   An Inter-AS I-PMSI
        A-D route originated by an ASBR aggregates Intra-\n   AS I-PMSI A-D routes
        originated within the ASBR's own AS.  Thus,\n   while the Intra-AS I-PMSI
        A-D routes originated within an AS are at\n   the granularity of <PE, MVPN>
        within that AS, outside of that AS the\n   (aggregated) Inter-AS I-PMSI A-D
        routes could be at the granularity\n   of <AS, MVPN>.\n"
      title: 9.2.1.  Originating Inter-AS I-PMSI A-D Routes
    - contents:
      - "9.2.2.  When Not to Originate Inter-AS I-PMSI A-D Routes\n   If, for a given
        MVPN and a given AS, all of the sites connected to\n   the PEs within the
        AS are known a priori to have no multicast\n   sources, then ASBRs of that
        AS MAY refrain from originating an Inter-\n   AS I-PMSI A-D route for that
        MVPN at all.\n"
      title: 9.2.2.  When Not to Originate Inter-AS I-PMSI A-D Routes
    - contents:
      - "9.2.3.  Propagating Inter-AS I-PMSI A-D Routes\n   An Inter-AS I-PMSI A-D
        route for a given MVPN originated by an ASBR\n   within a given AS is propagated
        via BGP to other ASes.\n"
      - contents:
        - "9.2.3.1.  Propagating Inter-AS I-PMSI A-D Routes - Overview\n   Suppose
          that ASBR A installs an Inter-AS I-PMSI A-D route for MVPN V\n   that originated
          at a particular AS, AS1.  The BGP Next Hop of that\n   route becomes A's
          \"upstream multicast hop\" on a multicast\n   distribution tree for V that
          is rooted at AS1.  When the Inter-AS\n   I-PMSI A-D routes have been distributed
          to all the necessary ASes,\n   they define a \"reverse path\" from any AS
          that supports MVPN V back to\n   AS1.  For instance, if AS2 supports MVPN
          V, then there will be a\n   reverse path for MVPN V from AS2 to AS1.  This
          path is a sequence of\n   ASBRs, the first of which is in AS2, and the last
          of which is in AS1.\n   Each ASBR in the sequence is the BGP Next Hop of
          the previous ASBR in\n   the sequence on the given Inter-AS I-PMSI A-D route.\n
          \  This reverse path information can be used to construct a\n   unidirectional
          multicast distribution tree for MVPN V, containing all\n   the ASes that
          support V, and having AS1 at the root.  We call such a\n   tree an \"inter-AS
          tree\".  Multicast data originating in MVPN sites\n   connected to PEs within
          a given AS will travel downstream along the\n   tree, which is rooted at
          that AS.\n   The path along an inter-AS tree is a sequence of ASBRs; it
          is still\n   necessary to specify how the multicast data gets from a given
          ASBR to\n   the set of ASBRs that are immediately downstream of the given
          ASBR\n   along the tree.  This is done by creating \"segments\": ASBRs in\n
          \  adjacent ASes will be connected by inter-AS segments, ASBRs in the\n
          \  same AS will be connected by \"intra-AS segments\".\n   An ASBR initiates
          creation of an intra-AS segment when the ASBR\n   receives an Inter-AS I-PMSI
          A-D route from an EBGP neighbor.\n   Creation of the segment is completed
          as a result of distributing, via\n   IBGP, this route within the ASBR's
          own AS.\n   For a given inter-AS tunnel, each of its intra-AS segments could
          be\n   constructed by its own independent mechanism.  Moreover, by using\n
          \  upstream-assigned labels within a given AS multiple intra-AS segments\n
          \  of different inter-AS tunnels of either the same or different MVPNs\n
          \  may share the same P-multicast tree.\n   If the P-multicast tree that
          serves as a particular intra-AS segment\n   of an inter-AS tunnel is created
          by a multicast control protocol that\n   uses receiver-initiated joins (e.g.,
          mLDP, any PIM variant), and this\n   P-multicast tree does not aggregate
          multiple segments, then all the\n   information needed to create that segment
          is present in the PMSI\n   Tunnel attribute of the Inter-AS I-PMSI A-D routes.
          \ However, if the\n   P-multicast tree that serves as the segment is created
          by a protocol\n   that does not use receiver-initiated joins (e.g., RSVP-TE,
          ingress\n   unicast replication), or if this P-multicast tree aggregates
          multiple\n   segments (irrespective of the multicast control protocol used
          to\n   create the tree), then it is also necessary to use Leaf A-D routes.\n
          \  The precise conditions under which Leaf A-D routes need to be used\n
          \  are described in subsequent sections.\n   Since (aggregated) Inter-AS
          I-PMSI A-D routes could have granularity\n   of <AS, MVPN>, an MVPN that
          is present in N ASes could have a total\n   of N inter-AS tunnels.  Thus,
          for a given MVPN, the number of inter-\n   AS tunnels constituting the I-PMSIs
          is independent of the number of\n   PEs that have this MVPN.\n   The precise
          rules for distributing and processing the Inter-AS I-PMSI\n   A-D routes
          across ASes are given in the following sections.\n"
        title: 9.2.3.1.  Propagating Inter-AS I-PMSI A-D Routes - Overview
      - contents:
        - "9.2.3.2.  Inter-AS I-PMSI A-D Route Received via EBGP\n   When an ASBR
          receives, from one of its EBGP neighbors, a BGP Update\n   message that
          carries an Inter-AS I-PMSI A-D route, if (a) at least\n   one of the Route
          Targets carried in the message matches one of the\n   import Route Targets
          configured on the ASBR, and (b) the ASBR\n   determines that the received
          route is the best route for its NLRI,\n   the ASBR re-advertises this route
          to other PEs and ASBRs within its\n   own AS (handling of this route by
          other PEs and ASBRs is described in\n   Section 9.2.3.4).\n   When re-advertising
          an Inter-AS I-PMSI A-D route, the ASBR MUST set\n   the Next Hop field of
          the MP_REACH_NLRI attribute to a routable IP\n   address of the ASBR.\n
          \  If the received Inter-AS I-PMSI A-D route carries the PMSI Tunnel\n   attribute,
          then, depending on the technology used to instantiate the\n   intra-AS segment
          of the inter-AS tunnel, the ASBR constructs the PMSI\n   Tunnel attribute
          of the re-advertised Inter-AS I-PMSI A-D route as\n   follows.\n    + If
          the ASBR uses ingress replication for the intra-AS segment of\n      the
          inter-AS tunnel, the re-advertised route MUST carry the PMSI\n      Tunnel
          attribute with the Tunnel Type set to Ingress Replication,\n      but no
          MPLS labels.\n    + If the ASBR uses a P-multicast tree for the intra-AS
          segment of\n      the inter-AS tunnel, the PMSI Tunnel attribute MUST contain
          the\n      identity of the tree (note that the ASBR could create the identity\n
          \     of the tree prior to the actual instantiation of the tree).  If,\n
          \     in order to instantiate the tree, the ASBR needs to know the\n      leaves
          of the tree, then the ASBR obtains this information from\n      the Leaf
          A-D routes received from other PEs/ASBRs in the ASBR's\n      own AS (as
          described in Section 9.2.3.5) by setting the Leaf\n      Information Required
          flag in the PMSI Tunnel attribute to 1.\n    + An ASBR that uses a P-multicast
          tree as the intra-AS segment of\n      the inter-AS tunnel MAY aggregate
          two or more MVPNs present on the\n      ASBR onto the same tree.  In this
          case, in addition to the\n      identity of the tree, the PMSI Tunnel attribute
          of the Inter-AS I-\n      PMSI A-D route MUST carry an MPLS upstream-assigned
          label that the\n      PE has bound uniquely to the MVPN associated with
          this route (as\n      determined by its RTs).\n      If the ASBR has already
          advertised Inter-AS I-PMSI A-D routes for\n      two or more MVPNs that
          it now desires to aggregate, then the ASBR\n      MUST re-advertise those
          routes.  The re-advertised routes MUST be\n      the same as the original
          ones, except for the PMSI Tunnel\n      attribute and the MVPN label.\n"
        - contents:
          - "9.2.3.2.1.  Originating Leaf A-D Route into EBGP\n   In addition, the
            ASBR MUST send to the EBGP neighbor from whom it\n   received the Inter-AS
            I-PMSI A-D route, a BGP Update message that\n   carries a Leaf A-D route
            constructed as follows.\n    + The route carries a single MCAST-VPN NLRI
            with the Route Key field\n      set to the MCAST-VPN NLRI of the Inter-AS
            I-PMSI A-D route\n      received from that neighbor and the Originating
            Router's IP\n      address set to the IP address of the ASBR (this MUST
            be a routable\n      IP address).\n    + The Leaf A-D route MUST include
            the PMSI Tunnel attribute with the\n      Tunnel Type set to Ingress Replication
            and the Tunnel Identifier\n      set to a routable address of the advertising
            router.  The PMSI\n      Tunnel attribute MUST carry a downstream-assigned
            MPLS label that\n      is used by the advertising router to demultiplex
            the MVPN traffic\n      received over a unicast tunnel from the EBGP neighbor.\n
            \   + The ASBR constructs an IP-based Route Target Extended Community
            by\n      placing the IP address carried in the Next Hop of the received\n
            \     Inter-AS I-PMSI A-D route in the Global Administrator field of the\n
            \     Community, with the Local Administrator field of this Community\n
            \     set to 0 and setting the Extended Communities attribute of the\n
            \     Leaf A-D route to that Community.  Note that this Route Target is\n
            \     the same as the ASBR Import RT of the EBGP neighbor from which the\n
            \     ASBR received the Inter-AS I-PMSI A-D route.\n    + The Next Hop
            field of the MP_REACH_NLRI attribute of the route\n      MUST be set to
            the same IP address as the one carried in the\n      Originating Router's
            IP Address field of the route.\n    + To constrain the distribution scope
            of this route, the route MUST\n      carry the NO_ADVERTISE BGP Community
            [RFC1997].\n   Handling of this Leaf A-D route by the EBGP neighbor is
            described in\n   Section 9.2.3.3.\n   The ASBR MUST set up its forwarding
            state such that packets that\n   arrive on the one-hop ASBR-ASBR LSP,
            as specified in the PMSI Tunnel\n   attribute of the Leaf A-D route, are
            transmitted on the intra-AS\n   segment, as specified in the PMSI Tunnel
            attribute of the Inter-AS\n   I-PMSI A-D route that the ASBR re-advertises
            in its own AS.  However,\n   the packets MAY be filtered before forwarding,
            as specified in\n   Section 9.2.3.6.\n"
          title: 9.2.3.2.1.  Originating Leaf A-D Route into EBGP
        title: 9.2.3.2.  Inter-AS I-PMSI A-D Route Received via EBGP
      - contents:
        - "9.2.3.3.  Leaf A-D Route Received via EBGP\n   When an ASBR receives, via
          EBGP, a Leaf A-D route originated by its\n   neighbor ASBR, if the Route
          Target carried in the Extended\n   Communities attribute of the route matches
          one of the ASBR Import RT\n   (auto-)configured on the ASBR, the ASBR performs
          the following.\n    + The ASBR finds an Inter-AS I-PMSI A-D route whose
          MCAST-VPN NLRI\n      has the same value as the Route Key field of the Leaf
          A-D route.\n    + If the found Inter-AS I-PMSI A-D route was originated
          by ASBR\n      itself, then the ASBR sets up its forwarding state such that\n
          \     packets received on the intra-AS tunnels originating in the ASBR's\n
          \     own AS are transmitted on the one-hop ASBR-ASBR LSP specified by\n
          \     the MPLS label carried in the PMSI Tunnel attribute of the\n      received
          Leaf A-D route.  (However, the packets MAY be filtered\n      before transmission
          as specified in Section 9.2.3.6).  The intra-\n      AS tunnels are specified
          in the PMSI Tunnel attribute of all the\n      Intra-AS I-PMSI A-D routes
          received by the ASBR that the ASBR\n      aggregated into the Inter-AS I-PMSI
          A-D route.  For each of these\n      intra-AS tunnels, if a non-zero MPLS
          label is carried in the PMSI\n      Tunnel attribute (i.e., aggregation
          is used), then only packets\n      received on the inner LSP corresponding
          to that label MUST be\n      forwarded, not the packets received on the
          outer LSP, as the outer\n      LSP possibly carries the traffic of other
          VPNs.\n    + If the found Inter-AS I-PMSI A-D route was originated by some\n
          \     other ASBR, then the ASBR sets up its forwarding state such that\n
          \     packets received on the intra-AS tunnel segment, as specified in\n
          \     the PMSI Tunnel attribute of the found Inter-AS I-PMSI A-D route,\n
          \     are transmitted on the one-hop ASBR-ASBR LSP, as specified by the\n
          \     MPLS label carried in the PMSI Tunnel attribute of the Leaf A-D\n
          \     route.\n"
        title: 9.2.3.3.  Leaf A-D Route Received via EBGP
      - contents:
        - "9.2.3.4.  Inter-AS I-PMSI A-D Route Received via IBGP\n   In the context
          of this section, we use the term \"PE/ASBR router\" to\n   denote either
          a PE or an ASBR router.\n   If a given Inter-AS I-PMSI A-D route is received
          via IBGP by a BGP\n   route reflector, the BGP route reflector MUST NOT
          modify the Next Hop\n   field of the MP_REACH_NLRI attribute when re-advertising
          the route\n   into IBGP (this is because the information carried in the
          Next Hop is\n   used for controlling flow of C-multicast routes, as specified
          in\n   Section 11.2).\n   If a given Inter-AS I-PMSI A-D route is advertised
          within an AS by\n   multiple ASBRs of that AS, the BGP best route selection
          performed by\n   other PE/ASBR routers within the AS does not require all
          these\n   PE/ASBR routers to select the route advertised by the same ASBR
          -- to\n   the contrary, different PE/ASBR routers may select routes advertised\n
          \  by different ASBRs.\n   When a PE/ASBR router receives, from one of its
          IBGP neighbors, a BGP\n   Update message that carries an Inter-AS I-PMSI
          A-D route, if (a) at\n   least one of the Route Targets carried in the message
          matches one of\n   the import Route Targets configured on the PE/ASBR, and
          (b) the\n   PE/ASBR determines that the received route is the best route
          to the\n   destination carried in the NLRI of the route, the PE/ASBR performs\n
          \  the following operations.\n    + If the router is a PE, then the router
          imports the route into the\n      VRF(s) that have the matching import Route
          Targets.\n    + If the router is an ASBR, then the ASBR propagates the route
          to\n      its EBGP neighbors.  When propagating the route to the EBGP\n
          \     neighbors, the ASBR MUST set the Next Hop field of the\n      MP_REACH_NLRI
          attribute to a routable IP address of the ASBR.  If\n      the received
          Inter-AS I-PMSI A-D route carries the PMSI Tunnel\n      attribute, then
          the propagated route MUST carry the PMSI Tunnel\n      attribute with the
          Tunnel Type set to Ingress Replication; the\n      attribute carries no
          MPLS labels.\n    + If the received Inter-AS I-PMSI A-D route carries the
          PMSI Tunnel\n      attribute with the Tunnel Type set to mLDP P2MP LSP,
          PIM-SSM tree,\n      PIM-SM tree, or BIDIR-PIM tree, the PE/ASBR SHOULD
          join as soon as\n      possible the P-multicast tree whose identity is carried
          in the\n      Tunnel Identifier.\n    + If the received Inter-AS I-PMSI
          A-D route carries the PMSI Tunnel\n      attribute with the Tunnel Identifier
          set to RSVP-TE P2MP LSP, then\n      the ASBR that originated the route
          MUST establish an RSVP-TE P2MP\n      LSP with the local PE/ASBR as a leaf.
          \ This LSP MAY have been\n      established before the local PE/ASBR receives
          the route, or it MAY\n      be established after the local PE receives the
          route.\n    + If the received Inter-AS I-PMSI A-D route carries the PMSI
          Tunnel\n      attribute with the Tunnel Type set to mLDP P2MP LSP, RSVP-TE
          P2MP\n      LSP, PIM-SSM, PIM-SM tree, or BIDIR-PIM tree, but the attribute\n
          \     does not carry a label, then the P-multicast tree, as identified\n
          \     by the PMSI Tunnel attribute, is an intra-AS LSP segment that is\n
          \     part of the inter-AS tunnel for the MVPN advertised by the Inter-\n
          \     AS I-PMSI A-D route and rooted at the AS that originated the\n      Inter-AS
          I-PMSI A-D route.  If the PMSI Tunnel attribute carries a\n      (upstream-assigned)
          label, then a combination of this tree and the\n      label identifies the
          intra-AS segment.  If the receiving router is\n      an ASBR, this intra-AS
          segment may further be stitched to the\n      ASBR-ASBR inter-AS segment
          of the inter-AS tunnel.  If the PE/ASBR\n      has local receivers in the
          MVPN, packets received over the intra-\n      AS segment must be forwarded
          to the local receivers using the\n      local VRF.\n"
        - contents:
          - "9.2.3.4.1.  Originating Leaf A-D Route into IBGP\n   If the Leaf Information
            Required flag in the PMSI Tunnel attribute of\n   the received Inter-AS
            I-PMSI A-D route is set to 1, then the PE/ASBR\n   MUST originate a new
            Leaf A-D route as follows.\n    + The route carries a single MCAST-VPN
            NLRI with the Route Key field\n      set to the MCAST-VPN NLRI of the
            Inter-AS I-PMSI A-D route\n      received from that neighbor and the Originating
            Router's IP\n      address set to the IP address of the PE/ASBR (this
            MUST be a\n      routable IP address).\n    + If the received Inter-AS
            I-PMSI A-D route carries the PMSI Tunnel\n      attribute with the Tunnel
            Type set to Ingress Replication, then\n      the Leaf A-D route MUST carry
            the PMSI Tunnel attribute with the\n      Tunnel Type set to Ingress Replication.
            \ The Tunnel Identifier\n      MUST carry a routable address of the PE/ASBR.
            \ The PMSI Tunnel\n      attribute MUST carry a downstream-assigned MPLS
            label that is used\n      to demultiplex the MVPN traffic received over
            a unicast tunnel by\n      the PE/ASBR.\n    + The PE/ASBR constructs
            an IP-based Route Target Extended Community\n      by placing the IP address
            carried in the Next Hop of the received\n      Inter-AS I-PMSI A-D route
            in the Global Administrator field of the\n      Community, with the Local
            Administrator field of this Community\n      set to 0 and setting the
            Extended Communities attribute of the\n      Leaf A-D route to that Community.\n
            \   + The Next Hop field of the MP_REACH_NLRI attribute of the route\n
            \     MUST be set to the same IP address as the one carried in the\n      Originating
            Router's IP Address field of the route.\n    + To constrain the distribution
            scope of this route, the route MUST\n      carry the NO_EXPORT Community
            [RFC1997].\n    + Once the Leaf A-D route is constructed, the PE/ASBR
            advertises\n      this route into IBGP.\n"
          title: 9.2.3.4.1.  Originating Leaf A-D Route into IBGP
        title: 9.2.3.4.  Inter-AS I-PMSI A-D Route Received via IBGP
      - contents:
        - "9.2.3.5.  Leaf A-D Route Received via IBGP\n   When an ASBR receives, via
          IBGP, a Leaf A-D route, if the Route\n   Target carried in the Extended
          Communities attribute of the route\n   matches one of the ASBR Import RT
          (auto-)configured on the ASBR, the\n   ASBR performs the following.\n   The
          ASBR finds an Inter-AS I-PMSI A-D route whose MCAST-VPN NLRI has\n   the
          same value as the Route Key field of the Leaf A-D route.\n   The received
          route may carry either (a) no PMSI Tunnel attribute, or\n   (b) the PMSI
          Tunnel attribute, but only with the Tunnel Type set to\n   Ingress Replication.\n
          \  If the received route does not carry the PMSI Tunnel attribute, the\n
          \  ASBR uses the information from the received route to determine the\n
          \  leaves of the P-multicast tree rooted at the ASBR that would be used\n
          \  for the intra-AS segment associated with the found Inter-AS I-PMSI\n
          \  A-D route.  The IP address of a leaf is the IP address carried in the\n
          \  Originating Router's IP address field of the received Leaf A-D route.\n
          \  If the received route carries the PMSI Tunnel attribute with the\n   Tunnel
          Type set to Ingress Replication, the ASBR uses the information\n   carried
          by the route to construct the intra-AS segment with ingress\n   replication.\n"
        title: 9.2.3.5.  Leaf A-D Route Received via IBGP
      - contents:
        - "9.2.3.6.  Optimizing Bandwidth by IP Filtering on ASBRs\n   An ASBR that
          has a given Inter-AS I-PMSI A-D route MAY discard some\n   of the traffic
          carried in the tunnel specified in the PMSI Tunnel\n   attribute of this
          route, if the ASBR determines that there are no\n   downstream receivers
          for that traffic.\n   When BGP is being used to distribute C-multicast routes,
          an ASBR that\n   has a given Inter-AS I-PMSI A-D route MAY discard traffic
          from a\n   particular customer multicast source C-S and destined to a particular\n
          \  customer multicast group address C-G that is carried over the tunnel\n
          \  specified in the PMSI Tunnel attribute of the route, if none of the\n
          \  C-multicast routes on the ASBR with RD and Source AS being the same\n
          \  as the RD and Source AS of the Inter-AS I-PMSI A-D route matches the\n
          \  (C-S,C-G) tuple.  A C-multicast route is said to match a (C-S,C-G)\n
          \  tuple, if it is a Source Tree Join route with Multicast Source set to\n
          \  C-S and Multicast Group set to C-G or a Shared Tree Join route with\n
          \  Multicast Group set to C-G.\n   The above procedures MAY also apply to
          an ASBR that originates a\n   given Inter-AS I-PMSI A-D route.  In this
          case, the ASBR applies them\n   to the traffic carried over the tunnels
          specified in the PMSI Tunnel\n   attribute of the Intra-AS I-PMSI A-D routes
          that the ASBR aggregates\n   into the Inter-AS I-PMSI A-D route and whose
          tails are stitched to\n   the one-hop ASBR-ASBR tunnel specified in the
          Inter-AS I-PMSI A-D\n   route.\n"
        title: 9.2.3.6.  Optimizing Bandwidth by IP Filtering on ASBRs
      title: 9.2.3.  Propagating Inter-AS I-PMSI A-D Routes
    title: 9.2.  MVPN Auto-Discovery/Binding - Inter-AS Operations
  title: 9.  MVPN Auto-Discovery/Binding
- contents:
  - "10.  Non-Congruent Unicast and Multicast Connectivity\n   It is possible to deploy
    MVPN such that the multicast routing and the\n   unicast routing are \"non-congruent\".
    \ For instance, the CEs may be\n   distributing to the PEs a special set of unicast
    routes that are to\n   be used exclusively for the purpose of upstream multicast
    hop\n   selection, and not used for unicast routing at all.  (For example,\n   when
    BGP is the CE-PE unicast routing protocol, the CEs may be using\n   SAFI 2 (\"Network
    Layer Reachability Information used for multicast\n   forwarding\" [IANA-SAFI]),
    and either IPv4 or IPv6 AFI to distribute a\n   special set of routes that are
    to be used for, and only for, upstream\n   multicast hop selection.) In such a
    situation, we will speak of the\n   MVPN as having two VRFs on a given PE: one
    containing the routes that\n   are used for unicast, the other containing the
    unicast routes that\n   are used for UMH selection.  We will call the former the
    \"unicast\n   routing VRF\" and the latter the \"UMH VRF\" (upstream-multicast-hop\n
    \  VRF).\n   In this document, when we speak without qualification of the MVPN's\n
    \  VRF, then if the MVPN has both a unicast VRF and a UMH VRF, we are\n   speaking
    of the UMH VRF.  (Of course, if there is no separate UMH\n   VRF, then we are
    speaking of the unicast VRF.)\n   If there is a separate UMH VRF, it MAY have
    its own import and export\n   Route Targets, different from the ones used by the
    unicast VRF.\n   These Route Targets MUST be used to control distribution of auto-\n
    \  discovery routes.  In addition, the export Route Targets of the UMH\n   VRF
    are added to the Route Targets used by the unicast VRF when\n   originating (unicast)
    VPN-IP routes.  The import Route Targets\n   associated with a given UMH VRF are
    used to determine which of the\n   received (unicast) VPN-IP routes should be
    accepted into the UMH VRF.\n   If a PE maintains an UMH VRF for that MVPN, then
    it is RECOMMENDED\n   that the UMH VRF use the same RD as the one used by the
    unicast VRF\n   of that MVPN.\n   If an MVPN site is multihomed to several PEs,
    then to support non-\n   congruent unicast and multicast connectivity, on each
    of these PEs,\n   the UMH VRF of the MVPN MUST use its own distinct RD (although
    on a\n   given PE, the RD used by the UMH VRF SHOULD be the same as the one\n
    \  used by the unicast VRF).\n   If an MVPN has a UMH VRF distinct from its unicast
    VRF, then one\n   option to support non-congruency is to exchange the routes to/from\n
    \  that UMH VRF by using the same AFI/SAFI as used by the routes from\n   the
    unicast VRF.\n   Another option is to exchange the routes to/from the UMH VRF
    using\n   the IPv4 or IPv6 AFI (as appropriate), but with the SAFI set to SAFI\n
    \  129 \"Multicast for BGP/MPLS IP Virtual Private Networks (VPNs)\"\n   [IANA-SAFI].
    \ The NLRI carried by these routes is defined as follows:\n      +---------------------------+\n
    \     |   Length (1 octet)        |\n      +---------------------------+\n      |
    \  Prefix (variable)       |\n      +---------------------------+\n   The use
    and the meaning of these fields are as follows:\n   a) Length:\n      The Length
    field indicates the length, in bits, of the address\n      prefix.\n   b) Prefix:\n
    \     The Prefix field contains a Route Distinguisher as defined in\n      [RFC4364]
    prepended to an IPv4 or IPv6 address prefix, followed by\n      enough trailing
    bits to make the end of the field fall on an octet\n      boundary.  Note that
    the value of trailing bits is irrelevant.\n   These routes MUST carry the VRF
    Route Import Extended Community.  If,\n   for a given MVPN, BGP is used for exchanging
    C-multicast routes, or\n   if segmented inter-AS tunnels are used, then these
    routes MUST also\n   carry the Source AS Extended Community.\n   The detailed
    procedures for selecting forwarder PE in the presence of\n   such routes are outside
    the scope of this document.  However, this\n   document requires these procedures
    to preserve the constraints\n   imposed by the single forwarder PE selection procedures,
    as specified\n   in [MVPN].\n"
  title: 10.  Non-Congruent Unicast and Multicast Connectivity
- contents:
  - "11.  Exchange of C-Multicast Routing Information among PEs\n   VPN C-Multicast
    Routing Information is exchanged among PEs by using\n   C-multicast routes that
    are carried using an MCAST-VPN NLRI.  These\n   routes are originated and propagated
    as follows.\n"
  - contents:
    - "11.1.  Originating C-Multicast Routes by a PE\n   Part of the procedures for
      constructing MCAST-VPN NLRI depends on the\n   multicast routing protocol between
      CE and PE (C-multicast protocol).\n"
    - contents:
      - "11.1.1.  Originating Routes: PIM as the C-Multicast Protocol\n   The following
        specifies the construction of MCAST-VPN NLRI of\n   C-multicast routes for
        the case where the C-multicast protocol is\n   PIM.  These C-multicast routes
        are originated as a result of updates\n   in the (C-S,C-G), or (C-*,C-G) state
        learned by a PE via the\n   C-multicast protocol.\n   Note that creation and
        deletion of (C-S,C-G,rpt) states on a PE when\n   the C-multicast protocol
        is PIM do not result in any BGP actions.\n"
      - contents:
        - "11.1.1.1.  Originating Source Tree Join C-Multicast Route\n   Whenever
          (a) a C-PIM instance on a particular PE creates a new\n   (C-S,C-G) state,
          and (b) the selected upstream PE for C-S (see\n   [MVPN]) is not the local
          PE, then the local PE MUST originate a\n   C-multicast route of type Source
          Tree Join.  The Multicast Source\n   field in the MCAST-VPN NLRI of the
          route is set to C-S; the Multicast\n   Group field is set of C-G.\n   This
          C-multicast route is said to \"correspond\" to the C-PIM (C-S,C-G)\n   state.\n
          \  The semantics of the route are such that the PE has one or more\n   receivers
          for (C-S,C-G) in the sites connected to the PE (the route\n   has the (C-S,C-G)
          Join semantics).\n   Whenever a C-PIM instance on a particular PE deletes
          a (C-S,C-G)\n   state, the corresponding C-multicast route MUST be withdrawn.
          \ (The\n   withdrawal of the route has the (C-S,C-G) Prune semantics).  The\n
          \  MCAST-VPN NLRI of the withdrawn route is carried in the\n   MP_UNREACH_NLRI
          attribute.\n"
        title: 11.1.1.1.  Originating Source Tree Join C-Multicast Route
      - contents:
        - "11.1.1.2.  Originating Shared Tree Join C-Multicast Route\n   Whenever
          (a) a C-PIM instance on a particular PE creates a new\n   (C-*,C-G) state,
          and (b) the selected upstream PE for the C-RP\n   corresponding to the C-G
          (see [MVPN]) is not the local PE, then the\n   local PE MUST originate a
          C-multicast route of type Shared Tree Join.\n   The Multicast Source field
          in the MCAST-VPN NLRI of the route is set\n   to the C-RP address.  The
          Multicast Group field in the MCAST-VPN NLRI\n   is set to the C-G address.\n
          \  This C-multicast route is said to \"correspond\" to the C-PIM (C-*,C-G)\n
          \  state.\n   The semantics of the route are such that the PE has one or
          more\n   receivers for (C-*,C-G) in the sites connected to the PE (the route\n
          \  has the (C-*,C-G) Join semantics).\n   Whenever a C-PIM instance on a
          particular PE deletes a (C-*,C-G)\n   state, the corresponding C-multicast
          route MUST be withdrawn.  (The\n   withdrawal of the route has the (C-S,C-G)
          Prune semantics).  The\n   MCAST-VPN NLRI of the withdrawn route is carried
          in the\n   MP_UNREACH_NLRI attribute.\n"
        title: 11.1.1.2.  Originating Shared Tree Join C-Multicast Route
      title: '11.1.1.  Originating Routes: PIM as the C-Multicast Protocol'
    - contents:
      - "11.1.2.  Originating Routes: mLDP as the C-Multicast Protocol\n   The following
        specifies the construction of the MCAST-VPN NLRI of\n   C-multicast routes
        for the case where the C-multicast protocol is\n   mLDP [mLDP].\n   Whenever
        a PE receives, from one of its CEs, a P2MP Label Map\n   <X, Y, L> over interface
        I, where X is the Root Node Address, Y is\n   the Opaque Value, and L is an
        MPLS label, the PE checks whether it\n   already has state for <X, Y> in the
        VRF associated with the CE.  If\n   so, then all the PE needs to do in this
        case is to update its\n   forwarding state by adding <I, L> to the forwarding
        state associated\n   with <X, Y>.\n   If the PE does not have state for <X,
        Y> in the VRF associated with\n   the CE, then the PE constructs a Source
        Tree Join C-multicast route\n   whose MCAST-VPN NLRI contains X as the Multicast
        Source field, and Y\n   as the Multicast Group field.\n   Whenever a PE deletes
        a previously created <X, Y> state that had\n   resulted in originating a C-multicast
        route, the PE withdraws the\n   C-multicast route.  The MCAST-VPN NLRI of
        the withdrawn route is\n   carried in the MP_UNREACH_NLRI attribute.\n"
      title: '11.1.2.  Originating Routes: mLDP as the C-Multicast Protocol'
    - contents:
      - "11.1.3.  Constructing the Rest of the C-Multicast Route\n   The rest of the
        C-multicast route is constructed as follows (the same\n   procedures apply
        to both PIM and mLDP as the C-Multicast protocol).\n   The local PE executes
        the procedures of [MVPN] to find the selected\n   Upstream Multicast Hop (UMH)
        route and the selected upstream PE for\n   the address carries in the Multicast
        Source field of MCAST-VPN NLRI.\n   From the selected UMH route, the local
        PE extracts (a) the ASN of the\n   upstream PE (as carried in the Source AS
        Extended Community of the\n   route), and (b) the C-multicast Import RT of
        the VRF on the upstream\n   PE (the value of this C-multicast Import RT is
        the value of the VRF\n   Route Import Extended Community carried by the route).
        \ The Source AS\n   field in the C-multicast route is set to that AS.  The
        Route Target\n   Extended Community of the C-multicast route is set to that\n
        \  C-multicast Import RT.\n   If there is more than one (remote) PE that originates
        the (unicast)\n   route to the address carried in the Multicast Source field
        of the\n   MCAST-VPN NLRI, then the procedures for selecting the UMH route
        and\n   the upstream PE to reach that address are as specified in [MVPN].\n
        \  If the local and the upstream PEs are in the same AS, then the RD of\n
        \  the advertised MCAST-VPN NLRI is set to the RD of the VPN-IP route\n   that
        contains the address carried in the Multicast Source field.\n   The C-multicast
        route is then advertised into IBGP.\n   If the local and the upstream PEs
        are in different ASes, then the\n   local PE finds in its VRF an Inter-AS
        I-PMSI A-D route whose Source\n   AS field carries the ASN of the upstream
        PE.  The RD of the found\n   Inter-AS I-PMSI A-D route is used as the RD of
        the advertised\n   C-multicast route.  The local PE constructs an IP-based
        Route Target\n   Extended Community by placing the Next Hop of the found Inter-AS
        I-\n   PMSI A-D route in the Global Administrator field of this Community,\n
        \  with the Local Administrator field of this Community set to 0; it\n   then
        adds this Community to the Extended Communities attribute of the\n   C-multicast
        route.  (Note that this Route Target is the same as the\n   ASBR Import RT
        of the ASBR identified by the Next Hop of the found\n   Inter-AS I-PMSI A-D
        route.)\n   Inter-AS I-PMSI A-D routes are not used to support non-segmented\n
        \  inter-AS tunnels.  To support non-segmented inter-AS tunnels, if the\n
        \  local and the upstream PEs are in different ASes, the local system\n   finds
        in its VRF an Intra-AS I-PMSI A-D route from the upstream PE\n   (the Originating
        Router's IP Address field of that route has the same\n   value as the one
        carried in the VRF Route Import of the (unicast)\n   route to the address
        carried in the Multicast Source field).  The RD\n   of the found Intra-AS
        I-PMSI A-D route is used as the RD of the\n   advertised C-multicast route.
        \ The Source AS field in the C-multicast\n   route is set to value of the
        Originating Router's IP Address field of\n   the found Intra-AS I-PMSI A-D
        route.\n   The Next Hop field of the MP_REACH_NLRI attribute MUST be set to
        a\n   routable IP address of the local PE.\n   If the Next Hop of the found
        (Inter-AS or Intra-AS) I-PMSI A-D route\n   is an EBGP neighbor of the local
        PE, then the PE advertises the C-\n   multicast route to that neighbor.  If
        the Next Hop of the found\n   (Inter-AS or Intra-AS) I-PMSI A-D route is within
        the same AS as the\n   local PE, then the PE advertises the C-multicast route
        into IBGP.\n"
      title: 11.1.3.  Constructing the Rest of the C-Multicast Route
    - contents:
      - "11.1.4.  Unicast Route Changes\n   The particular UMH route that is selected
        by a given PE for a given\n   C-S may be influenced by the network's unicast
        routing.  In that\n   case, a change in the unicast routing may invalidate
        prior choices of\n   the UMH route for some C-S.  If this happens, the local
        PE MUST\n   execute the UMH route selection procedures for C-S again.  If
        the\n   result is that a different UMH route is selected, then for all C-G,\n
        \  any previously originated C-multicast routes for (C-S,C-G) MUST be\n   re-originated.\n
        \  Similarly, if a unicast routing change results in a change of the UMH\n
        \  route for a C-RP, then for all C-G such that C-RP is the RP\n   associated
        with C-G, any previously originated C-multicast routes for\n   (C-*,C-G) MUST
        be re-originated.\n"
      title: 11.1.4.  Unicast Route Changes
    title: 11.1.  Originating C-Multicast Routes by a PE
  - contents:
    - "11.2.  Propagating C-Multicast Routes by an ASBR\n   When an ASBR receives
      a BGP Update message that carries a C-multicast\n   route, if at least one of
      the Route Targets of the route matches one\n   of the ASBR Import RTs (auto-)configured
      on the ASBR, the ASBR finds\n   an Inter-AS I-PMSI A-D route whose RD and Source
      AS matches the RD\n   and Source AS carried in the C-multicast route.  If no
      matching route\n   is found, the ASBR takes no further action.  If a matching
      route is\n   found, the ASBR proceeds as follows.\n   To support non-segmented
      inter-AS tunnels, instead of matching the RD\n   and Source AS carried in the
      C-multicast route against the RD and\n   Source AS of an Inter-AS I-PMSI A-D
      route, the ASBR should match it\n   against the RD and the Originating Router's
      IP Address of the Intra-\n   AS I-PMSI A-D routes.\n   The ASBR first checks
      if it already has one or more C-multicast\n   routes that have the same MCAST-VPN
      NLRI as the newly received route.\n   If such a route(s) already exists, the
      ASBR keeps the newly received\n   route, but SHALL NOT re-advertise the newly
      received route.\n   Otherwise, the ASBR re-advertises the route, as described
      in this\n   section.\n   When an ASBR receives a BGP Update message that carries
      a withdrawal\n   of a previously advertised C-multicast route, the ASBR first
      checks\n   if it already has at least one other C-multicast route that has the\n
      \  same MCAST-VPN NLRI.  If such a route already exists, the ASBR\n   processes
      the withdrawn route, but SHALL NOT re-advertise the\n   withdrawal.  Otherwise,
      the ASBR re-advertises the withdrawal of the\n   previously advertised C-multicast
      route, as described below.\n   If the ASBR is the ASBR that originated the found
      Inter-AS I-PMSI A-D\n   route, then before re-advertising the C-multicast route
      into IBGP,\n   the ASBR removes from the route the Route Target that matches
      one of\n   the ASBR Import RTs (auto-)configured on the ASBR.\n   If the ASBR
      is not the ASBR that originated the found Inter-AS I-PMSI\n   A-D route, then
      before re-advertising the C-multicast route, the ASBR\n   modifies the Extended
      Communities attribute of the C-multicast route\n   by replacing the Route Target
      of the route that matches one of the\n   ASBR Import RTs (auto-)configured on
      the ASBR with a new Route Target\n   constructed as follows.  The new Route
      Target is an IP-based Route\n   Target that has the Global Administrator field
      set to the Next Hop of\n   the found Inter-AS I-PMSI A-D route, and Local Administrator
      field of\n   this Community set to 0.  Note that this newly constructed Route\n
      \  Target is the same as the ASBR Import RT of the ASBR identified by\n   the
      Next Hop of the found Inter-AS I-PMSI A-D route.  The rest of the\n   Extended
      Communities attribute of the route SHOULD be passed\n   unmodified.\n   The
      Next Hop field of the MP_REACH_NLRI attribute SHOULD be set to an\n   IP address
      of the ASBR.\n   If the Next Hop field of the MP_REACH_NLRI of the found (Inter-AS
      or\n   Intra-AS) I-PMSI A-D route is an EBGP neighbor of the ASBR, then the\n
      \  ASBR re-advertises the C-multicast route to that neighbor.  If the\n   Next
      Hop field of the MP_REACH_NLRI of the found (Inter-AS or Intra-\n   AS) I-PMSI
      A-D route is an IBGP neighbor of the ASBR, the ASBR re-\n   advertises the C-multicast
      route into IBGP.  If it is the ASBR that\n   originated the found Inter-AS I-PMSI
      A-D route in the first place,\n   then the ASBR just re-advertises the C-multicast
      route into IBGP.\n"
    title: 11.2.  Propagating C-Multicast Routes by an ASBR
  - contents:
    - "11.3.  Receiving C-Multicast Routes by a PE\n   When a PE receives a C-multicast
      route the PE checks if any of the\n   Route Target Extended Communities carried
      in the Extended Communities\n   attribute of the route match any of the C-multicast
      Import RTs\n   associated with the VRFs of any MVPN maintained by the PE.  If
      no\n   match is found, the PE SHOULD discard the route.  Otherwise, (if a\n
      \  match is found), the PE checks if the address carried in the\n   Multicast
      Source field of the C-multicast route matches one of the\n   (unicast) VPN-IP
      routes advertised by PE from the VRF.  If no match\n   is found the PE SHOULD
      discard the route.  Otherwise, (if a match is\n   found), the PE proceeds as
      follows, depending on the multicast\n   routing protocol between CE and PE (C-multicast
      protocol).\n"
    - contents:
      - "11.3.1.  Receiving Routes: PIM as the C-Multicast Protocol\n   The following
        describes procedures when PIM is used as the multicast\n   routing protocol
        between CE and PE (C-multicast protocol).\n   Since C-multicast routing information
        is disseminated by BGP, PIM\n   messages are never sent from one PE to another.\n"
      - contents:
        - "11.3.1.1.  Receiving Source Tree Join C-Multicast Route\n   If the received
          route has the Route Type set to Source Tree Join,\n   then the PE creates
          a new (C-S,C-G) state in its MVPN-TIB from the\n   Multicast Source and
          Multicast Group fields in the MCAST-VPN NLRI of\n   the route, if such a
          state does not already exist.\n   If the local policy on the PE is to bind
          (C-S,C-G) to an S-PMSI, then\n   the PE adds the S-PMSI to the outgoing
          interface list of the\n   (C-S,C-G) state, if it is not already there.  Otherwise,
          the PE adds\n   an I-PMSI to the outgoing interface list of the (C-S,C-G)
          state, if\n   it is not already there.\n   When, for a said VRF, the last
          Source Tree Join C-multicast route for\n   (C-S,C-G) is withdrawn, resulting
          in the situation where the VRF\n   contains no Source Tree Join C-multicast
          route for (C-S,C-G), the PE\n   MUST remove the I-PMSI/S-PMSI from the outgoing
          interface list of the\n   (C-S,C-G) state.  Depending on the (C-S,C-G) state
          of the PE-CE\n   interfaces, this may result in the PE using PIM procedures
          to prune\n   itself off the (C-S,C-G) tree.  If C-G is not in the SSM range
          for\n   the VRF, then removing the I-PMSI/S-PMSI from the outgoing interface\n
          \  list of the (C-S,C-G) state SHOULD be done after a delay that is\n   controlled
          by a timer.  The value of the timer MUST be configurable.\n   The purpose
          of this timer is to ensure that the PE does not stop\n   forwarding (C-S,C-G)
          onto a PMSI tunnel until all the PEs of the same\n   MVPN have had time
          to receive the withdrawal of the Source Active A-D\n   route for (C-S,C-G)
          (see Section 13.1), and the PE connected to C-RP\n   starts forwarding (C-S,C-G)
          on the C-RPT.\n   Note that before the PE stops forwarding (C-S,C-G), there
          is a\n   possibility to have (C-S,C-G) packets being sent at the same time
          on\n   the PMSI by both the local PE and the PE connected to the site that\n
          \  contains C-RP.  This would result in a transient unnecessary traffic\n
          \  on the provider backbone.  However, no duplicates will reach customer\n
          \  hosts subscribed to C-G as long as the downstream PEs apply\n   procedures
          described in Section 9.1 of [MVPN].\n"
        title: 11.3.1.1.  Receiving Source Tree Join C-Multicast Route
      - contents:
        - "11.3.1.2.  Receiving Shared Tree Join C-Multicast Route\n   If the received
          route has the Route Type set to Shared Tree Join,\n   then the PE creates
          a new (C-*,C-G) state in its MVPN-TIB with the RP\n   address for that state
          taken from the Multicast Source, and C-G for\n   that state taken from the
          Multicast Group fields of the MCAST-VPN\n   NLRI of the route, if such a
          state does not already exist.  If there\n   is no S-PMSI for (C-*,C-G),
          then the PE adds I-PMSI to the outgoing\n   interface list of the state
          if it is not already there.  If there is\n   an S-PMSI for (C-*,C-G), then
          the PE adds S-PMSI to the outgoing\n   interface list of the state if it
          is not already there.\n   When, for a said VRF, the last Shared Tree Join
          C-multicast route for\n   (C-*,C-G) is withdrawn, resulting in the situation
          where the VRF\n   contains no Shared Tree Join C-multicast route for (C-*,C-G),
          the PE\n   MUST remove the I-PMSI/S-PMSI from the outgoing interface list
          of the\n   (C-*,C-G) state.  Depending on the (C-*,C-G) state of the PE-CE\n
          \  interfaces, this may result in the PE using PIM procedures to prune\n
          \  itself off the (C-*,C-G) tree.\n"
        title: 11.3.1.2.  Receiving Shared Tree Join C-Multicast Route
      title: '11.3.1.  Receiving Routes: PIM as the C-Multicast Protocol'
    - contents:
      - "11.3.2.  Receiving Routes: mLDP as the C-Multicast Protocol\n   The following
        describes procedures when mLDP is used as the multicast\n   routing protocol
        between CE and PE (C-multicast protocol).\n   When mLDP is used as a C-multicast
        protocol, the only valid type of a\n   C-multicast route that a PE could receive
        is a Source Tree Join\n   C-multicast route.\n   When the PE receives a Source
        Tree Join C-multicast route, the PE\n   applies, in the scope of this VRF,
        the P2MP mLDP procedures for a\n   transit node using the value carried in
        the Multicast Source field of\n   the route as the C-Root Node Identifier,
        and the value carried in the\n   Multicast Group of the route as the C-LDP
        MP Opaque Value Element.\n   If there is no S-PMSI for <C-Root Node Identifier,
        C-LDP MP Opaque\n   Value Element>, then the PE creates and advertises an
        S-PMSI as\n   described in Section 12 using C-Root Node Identifier as the
        value for\n   the Multicast Source field of the S-PMSI A-D route and C-LDP
        MP\n   Opaque Value Element as the value for the Multicast Group field of\n
        \  the route.\n   To improve scalability when mLDP is used as the C-Multicast
        protocol\n   for a given MVPN, within each AS that has sites of that MVPN\n
        \  connected to the PEs of that AS, all the S-PMSIs of that MVPN MAY be\n
        \  aggregated into a single P-multicast tree (by using upstream-assigned\n
        \  labels).\n"
      title: '11.3.2.  Receiving Routes: mLDP as the C-Multicast Protocol'
    title: 11.3.  Receiving C-Multicast Routes by a PE
  - contents:
    - "11.4.  C-Multicast Routes Aggregation\n   Note that C-multicast routes are
      \"de facto\" aggregated by BGP.  This\n   is because the MCAST-VPN NLRIs advertised
      by multiple PEs, for a\n   C-multicast route for a particular C-S and C-G (or
      a particular C-*\n   and C-G) of a given MVPN are identical.\n   Hence, a BGP
      route reflector or ASBR that receives multiple such\n   routes with the same
      NLRI will re-advertise only one of these routes\n   to other BGP speakers.\n
      \  This implies that C-multicast routes for a given (S,G) of a given\n   MVPN
      originated by PEs that are clients of a given route reflector\n   are aggregated
      by the route reflector.  For instance, if multiple PEs\n   that are clients
      of a route reflector, have receivers for a specific\n   SSM channel of a MVPN,
      they will all advertise an identical NLRI for\n   the Source Tree Join C-multicast
      route.  However, only one\n   C-multicast route will be advertised by the route
      reflector for this\n   specific SSM channel of that MVPN, to other PEs and route
      reflectors\n   that are clients of the route reflector.\n   This also implies
      that an ASBR aggregates all the received\n   C-multicast routes for a given
      (S,G) (or a given (*,G)) of a given\n   MVPN into a single C-multicast route.\n
      \  To further reduce the routing churn due to C-multicast routes\n   changes,
      a route reflector that re-advertises a C-multicast route\n   SHOULD set the
      Next Hop field of the MP_REACH_NLRI attribute of the\n   route to an IP address
      of the route reflector.  Likewise, an ASBR\n   that re-advertises a C-multicast
      route SHOULD set the Next Hop field\n   of the MP_REACH_NLRI attribute of the
      route to an IP address of the\n   ASBR.\n   Further, a BGP receiver, which receives
      multiple such routes with the\n   same NLRI for the same C-multicast route,
      will potentially create\n   forwarding state based on a single C-multicast route.
      \ Per the\n   procedures described in Section 11.3, this forwarding state will
      be\n   the same as the state that would have been created based on another\n
      \  route with same NLRI.\n"
    title: 11.4.  C-Multicast Routes Aggregation
  title: 11.  Exchange of C-Multicast Routing Information among PEs
- contents:
  - "12.  Using S-PMSI A-D Routes to Bind C-Trees to P-Tunnels\n   This section describes
    BGP-based procedures for using S-PMSIs A-D\n   routes to bind (C-S,C-G) trees
    to P-tunnels.\n"
  - contents:
    - "12.1.  Originating S-PMSI A-D Routes\n   The following describes procedures
      for originating S-PMSI A-D routes\n   by a PE.\n   The PE constructs the MCAST-VPN
      NLRI of an S-PMSI A-D route for a\n   given (C-S,C-G) as follows.\n    + The
      RD in this NLRI is set to the RD of the MVPN's VRF associated\n      with (C-S,C-G).\n
      \   + The Multicast Source field MUST contain the source address\n      associated
      with the C-multicast stream, and the Multicast Source\n      Length field is
      set appropriately to reflect this.\n    + The Multicast Group field MUST contain
      the group address\n      associated with the C-multicast stream, and the Multicast
      Group\n      Length field is set appropriately to reflect this.\n    + The Originating
      Router's IP Address field MUST be set to the IP\n      address that the (local)
      PE places in the Global Administrator\n      field of the VRF Route Import Extended
      Community of the VPN-IP\n      routes advertised by the PE.  Note that the <RD,
      Originating\n      Router's IP address> tuple uniquely identifies a given multicast\n
      \     VRF.\n   The PE constructs the rest of the S-PMSI A-D route as follows.\n
      \  Depending on the type of P-multicast tree used for the P-tunnel, the\n   PMSI
      Tunnel attribute of the S-PMSI A-D route is constructed as\n   follows:\n    +
      The PMSI Tunnel attribute MUST contain the identity of the\n      P-multicast
      tree (note that the PE could create the identity of\n      the tree prior to
      the actual instantiation of the tree).\n    + If, in order to establish the
      P-multicast tree, the PE needs to\n      know the leaves of the tree within
      its own AS, then the PE obtains\n      this information from the Leaf A-D routes
      received from other\n      PEs/ASBRs within its own AS (as other PEs/ASBRs originate
      Leaf A-D\n      routes in response to receiving the S-PMSI A-D route) by setting\n
      \     the Leaf Information Required flag in the PMSI Tunnel attribute to\n      1.\n
      \   + If a PE originates S-PMSI A-D routes with the Leaf Information\n      Required
      flag in the PMSI Tunnel attribute set to 1, then the PE\n      MUST be (auto-)configured
      with an import Route Target, which\n      controls acceptance of Leaf A-D routes
      by the PE.  (Procedures for\n      originating Leaf A-D routes by the PEs that
      receive the S-PMSI A-D\n      route are described in Section 12.3.)\n      This
      Route Target is IP address specific.  The Global\n      Administrator field
      of this Route Target MUST be set to the IP\n      address carried in the Next
      Hop of all the S-PMSI A-D routes\n      advertised by this PE (if the PE uses
      different Next Hops, then\n      the PE MUST be (auto-)configured with multiple
      import RTs, one per\n      each such Next Hop).  The Local Administrator field
      of this Route\n      Target MUST be set to 0.\n      If the PE supports Route
      Target Constraint [RT-CONSTRAIN], the PE\n      SHOULD advertise this import
      Route Target within its own AS using\n      Route Target Constraints.  To constrain
      distribution of the Route\n      Target Constraint routes to the AS of the advertising
      PE, these\n      routes SHOULD carry the NO_EXPORT Community [RFC1997].\n    +
      A PE MAY aggregate two or more S-PMSIs originated by the PE onto\n      the
      same P-multicast tree.  If the PE already advertises S-PMSI\n      A-D routes
      for these S-PMSIs, then aggregation requires the PE to\n      re-advertise these
      routes.  The re-advertised routes MUST be the\n      same as the original ones,
      except for the PMSI Tunnel attribute.\n      If the PE has not previously advertised
      S-PMSI A-D routes for\n      these S-PMSIs, then the aggregation requires the
      PE to advertise\n      (new) S-PMSI A-D routes for these S-PMSIs.  The PMSI
      Tunnel\n      attribute in the newly advertised/re-advertised routes MUST carry\n
      \     the identity of the P-multicast tree that aggregates the S-PMSIs.\n      If
      at least some of the S-PMSIs aggregated onto the same\n      P-multicast tree
      belong to different MVPNs, then all these routes\n      MUST carry an MPLS upstream-assigned
      label [RFC5331].\n   If all these aggregated S-PMSIs belong to the same MVPN,
      and this\n   MVPN uses PIM as its C-multicast routing protocol, then the\n   corresponding
      S-PMSI A-D routes MAY carry an MPLS upstream-assigned\n   label [RFC5331].  Moreover,
      in this case, the labels MUST be distinct\n   on a per-MVPN basis and MAY be
      distinct on a per-route basis.\n   If all these aggregated S-PMSIs belong to
      the MVPN(s) that uses mLDP\n   as its C-multicast routing protocol, then the
      corresponding S-PMSI\n   A-D routes MUST carry an MPLS upstream-assigned label
      [RFC5331], and\n   these labels MUST be distinct on a per-route (per-mLDP FEC)
      basis,\n   irrespective of whether the aggregated S-PMSIs belong to the same
      or\n   different MVPNs.\n   The Next Hop field of the MP_REACH_NLRI attribute
      of the route MUST\n   be set to the same IP address as the one carried in the
      Originating\n   Router's IP Address field.\n   The route always carries a set
      of Route Targets.  The default set of\n   Route Targets is determined as follows:\n
      \   + If there is a (unicast) VPN-IP route to C-S originated from the\n      VRF,
      but no (unicast) VPN-IP route to C-RP originated from the\n      VRF, then the
      set of Route Targets is formed by a set intersection\n      between the set
      of Route Targets carried in the Intra-AS I-PMSI A-\n      D route originated
      from the VRF and the set of Route Targets\n      carried by the (unicast) VPN-IP
      route to C-S.\n    + If there is no (unicast) VPN-IP route to C-S originated
      from the\n      VRF, but there is a (unicast) VPN-IP route to C-RP originated
      from\n      the VRF, then the set of Route Targets is formed by a set\n      intersection
      between the set of Route Targets carried in the\n      intra-AS I-PMSI A-D route
      originated from the VRF and the set of\n      Route Targets carried by the (unicast)
      VPN-IP route to C-RP.\n    + If there is a (unicast) VPN-IP route to C-S originated
      from the\n      VRF, and a (unicast) VPN-IP route to C-RP originated from the
      VRF,\n      then the set of Route Targets is formed by a set intersection\n
      \     between the set of Route Targets carried in the Intra-AS I-PMSI A-\n      D
      route originated from the VRF and the set union of Route Targets\n      carried
      by the (unicast) VPN-IP route to C-S and the (unicast)\n      VPN-IP route to
      C-RP.\n   In each of the above cases, an implementation MUST allow the set of\n
      \  Route Targets carried by the route to be specified by configuration.\n   In
      the absence of a configured set of Route Targets, the route MUST\n   carry the
      default set of Route Targets, as specified above.\n"
    title: 12.1.  Originating S-PMSI A-D Routes
  - contents:
    - "12.2.  Handling S-PMSI A-D Routes by ASBRs\n   Procedures for handling an S-PMSI
      A-D route by ASBRs (both within and\n   outside of the AS of the PE that originates
      the route) are the same\n   as specified in Section 9.2.3, except that instead
      of Inter-AS I-PMSI\n   A-D routes, the procedures apply to S-PMSI A-D routes.\n"
    - contents:
      - "12.2.1.  Merging S-PMSI into an I-PMSI\n   Consider the situation where:\n
        \   + An ASBR is receiving (or expecting to receive) inter-AS (C-S,C-G)\n
        \     data from upstream via an S-PMSI.\n    + The ASBR is sending (or expecting
        to send) the inter-AS (C-S,C-G)\n      data downstream via an I-PMSI.\n   This
        situation may occur if the upstream providers have a policy of\n   using S-PMSIs
        but the downstream providers have a policy of using\n   I-PMSIs.  To support
        this situation, an ASBR MAY, under certain\n   conditions, merge one or more
        upstream S-PMSIs into a downstream\n   I-PMSI.\n   An S-PMSI (corresponding
        to a particular S-PMSI A-D route) MAY be\n   merged by a particular ASBR into
        an I-PMSI (corresponding to a\n   particular Inter-AS I-PMSI A-D route) if
        and only if the following\n   conditions all hold:\n    + BGP is used to exchange
        C-multicast routes.\n    + The S-PMSI A-D route and the Inter-AS I-PMSI A-D
        route originate\n      in the same AS.  The Inter-AS I-PMSI A-D route carries
        the\n      originating AS in the Source AS field of the NLRI of the route
        and\n      in the AS_PATH attribute of the route.  The S-PMSI A-D route\n
        \     carries the originating AS in the AS_PATH attribute of the route.\n
        \   + The S-PMSI A-D route and the Inter-AS I-PMSI A-D route have\n      exactly
        the same set of RTs.\n    + For each (C-S,C-G) mentioned in the S-PMSI route,
        if the ASBR has\n      installed a Source Tree Join (C-S,C-G) C-multicast
        route, then the\n      S-PMSI route was originated by the upstream PE of the
        C-multicast\n      route.  The address of the upstream PE is carried in the
        RT of the\n      C-multicast route.  The address of the PE that originated
        the\n      S-PMSI route is carried in the Originating Router's IP Address\n
        \     field of the MCAST-VPN NLRI of the route.\n    + The ASBR supports the
        optional capability to discard (C-S,C-G)\n      traffic received on an I-PMSI.\n
        \  An ASBR performs merging by stitching the tail end of the P-tunnel,\n   as
        specified in the PMSI Tunnel attribute of the S-PMSI A-D route\n   received
        by the ASBR, to the head of the P-tunnel, as specified in\n   the PMSI Tunnel
        attribute of the Inter-AS I-PMSI A-D route re-\n   advertised by the ASBR.\n
        \  IP processing during merge: If an ASBR merges a (C-S,C-G) S-PMSI A-D\n
        \  route into an Inter-AS I-PMSI A-D route, the ASBR MUST discard all\n   (C-S,C-G)
        traffic it receives on the tunnel advertised in the I-PMSI\n   A-D route.\n
        \  An ASBR that merges an S-PMSI A-D route into an Inter-AS I-PMSI A-D\n   route
        MUST NOT re-advertise the S-PMSI A-D route.\n"
      title: 12.2.1.  Merging S-PMSI into an I-PMSI
    title: 12.2.  Handling S-PMSI A-D Routes by ASBRs
  - contents:
    - "12.3.  Receiving S-PMSI A-D Routes by PEs\n   Consider a PE that receives an
      S-PMSI A-D route.  If one or more of\n   the VRFs on the PE have their import
      Route Targets that contain one\n   or more of the Route Targets carried by the
      received S-PMSI A-D\n   route, then for each such VRF (and associated MVPN-TIB)
      the PE\n   performs the following.\n   Procedures for receiving an S-PMSI A-D
      route by a PE (both within and\n   outside of the AS of the PE that originates
      the route) are the same\n   as specified in Section 9.2.3.4 except that (a)
      instead of Inter-AS\n   I-PMSI A-D routes, the procedures apply to S-PMSI A-D
      routes and (b)\n   a PE performs procedures specified in that section only if,
      in\n   addition to the criteria there, one of the following is true:\n    +
      the PE originates a Source Tree Join (C-S,C-G) C-multicast route,\n      and
      the upstream PE of that route is the PE that originates the\n      S-PMSI A-D
      route; or\n    + the PE does not originate a Source Tree Join (C-S,C-G) C-multicast\n
      \     route, but it originates a Shared Tree Join (C-*,C-G) C-multicast\n      route.
      \ The best (as determined by the BGP route selection\n      procedures) Source
      Active A-D route for (C-S,C-G) selected by the\n      PE is originated by the
      same PE as the one that originates the\n      S-PMSI A-D route; or\n    + the
      PE does not originate a Source Tree Join (C-S,C-G), has not\n      received
      any Source Active A-D routes for (C-S,C-G), but does\n      originate a Shared
      Tree Join (C-*,C-G) route.  The upstream PE for\n      that route is the PE
      that originates the received S-PMSI A-D\n      route.\n   If the received S-PMSI
      A-D route has a PMSI Tunnel attribute with the\n   Leaf Information Required
      flag set to 1, then the PE originates a\n   Leaf A-D route.  The Route Key of
      the Leaf A-D route is set to the\n   MCAST-VPN NLRI of the S-PMSI A-D route.
      \ The rest of the Leaf A-D\n   route is constructed using the same procedures
      as specified in\n   section 9.2.3.4.1, except that instead of originating Leaf
      A-D routes\n   in response to receiving Inter-AS I-PMSI A-D routes, the procedures\n
      \  apply to originating Leaf A-D routes in response to receiving S-PMSI\n   A-D
      routes.\n   In addition to the procedures specified in Section 9.2.3.4.1, the
      PE\n   MUST set up its forwarding path to receive (C-S,C-G) traffic from the\n
      \  tunnel advertised by the S-PMSI A-D route (the PE MUST switch to the\n   S-PMSI).\n
      \  If a PE that is a leaf node of a particular Selective tunnel\n   determines
      that it no longer needs to receive any of (C-S,C-G)s\n   carried over that tunnel,
      the PE SHOULD prune itself off that tunnel.\n   Procedures for pruning are specific
      to a particular tunneling\n   technology.\n"
    title: 12.3.  Receiving S-PMSI A-D Routes by PEs
  title: 12.  Using S-PMSI A-D Routes to Bind C-Trees to P-Tunnels
- contents:
  - "13.  Switching from Shared a C-Tree to a Source C-Tree\n   The procedures defined
    in this section only apply when the\n   C-multicast routing protocol is PIM [RFC4601];
    moreover, they only\n   apply for the multicast ASM mode and MUST NOT be applied
    to multicast\n   group addresses belonging to the SSM range.  The procedures also
    MUST\n   NOT be applied when the C-multicast routing protocol is BIDIR-PIM\n   [RFC5015].\n
    \  The procedures of this section are applicable only to MVPNs that use\n   both
    shared (i.e., rooted at a C-RP) and source (i.e., rooted at a\n   C-S) inter-site
    C-trees.\n   These procedures are not applicable to MVPNs that do not use shared\n
    \  inter-site C-trees and rely solely on source inter-site C-trees.  See\n   Section
    14 for the procedures applicable to that scenario.\n   Whether or not a given
    MVPN uses both inter-site shared and source\n   C-trees must be known a priori
    (e.g., via provisioning).\n   In the scenario where an MVPN customer switches
    from a C-RP-based\n   tree (RPT) to the shortest path tree (SPT), in order to
    avoid packet\n   duplication, choosing of a single consistent upstream PE, as\n
    \  described in [MVPN], may not suffice.  To illustrate this, consider a\n   set
    of PEs {PE2, PE4, PE6} that are on the C-RP tree for (C-*,C-G)\n   and have chosen
    a consistent upstream PE, as described in [MVPN], for\n   (C-*,C-G) state.  Further,
    this upstream PE, say PE1, is using a\n   Multidirectional Inclusive PMSI (MI-PMSI)
    for (C-*,C-G).  If a site\n   attached to one of these PEs, say PE2, switches
    to the C-S tree for\n   (C-S,C-G), PE2 generates a Source Tree Join C-multicast
    route towards\n   the upstream PE that is on the path to C-S, say PE3.  PE3 also
    uses\n   the MI-PMSI for (C-S,C-G), as PE1 uses for (C-*,C-G).  This results\n
    \  in {PE2, PE4, PE6} receiving duplicate traffic for (C-S,C-G) -- both\n   on
    the C-RP tree (from PE1) and C-S tree (from PE3).  If it is\n   desirable to suppress
    receiving duplicate traffic, then it is\n   necessary to choose a single forwarder
    PE for (C-S,C-G).  The\n   following describes how this is achieved.\n"
  - contents:
    - "13.1.  Source within a Site - Source Active Advertisement\n   When, as a result
      of receiving a Source Tree Join C-multicast route\n   for (C-S,C-G) from some
      other PE the local PE adds either the S-PMSI\n   or the I-PMSI to the outgoing
      interface list of the (C-S,C-G) state\n   (see Section 11.3.1.1), the local
      PE MUST originate a Source Active\n   A-D route if the PE has not originated
      such route already.  The route\n   carries a single MCAST-VPN NLRI constructed
      as follows:\n    + The RD in this NLRI is set to the RD of the VRF of the MVPN
      on the\n      PE.\n    + The Multicast Source field MUST be set to C-S.  The
      Multicast\n      Source Length field is set appropriately to reflect this.\n
      \   + The Multicast Group field MUST be set to C-G.  The Multicast Group\n      Length
      field is set appropriately to reflect this.\n   The Next Hop field of the MP_REACH_NLRI
      attribute MUST be set to the\n   IP address that the PE places in the Global
      Administrator field of\n   the VRF Route Import Extended Community of the VPN-IP
      routes\n   advertised by the PE from the MVPN's VRF.\n   The route SHOULD carry
      the same set of Route Targets as the Intra-AS\n   I-PMSI A-D route of the MVPN
      originated by the PE.\n   Using the normal BGP procedures, the Source Active
      A-D route is\n   propagated to all the PEs of the MVPN.\n   Note that the advertisement
      of a Source Active A-D route for a given\n   (C-S,C-G) could be combined, if
      desired, with the advertisement of an\n   S-PMSI A-D route for the same (C-S,C-G).
      \ This is accomplished by\n   using the same BGP Update message to carry both
      the NLRI of the\n   S-PMSI A-D route and the NLRI of the Source Active A-D route.\n
      \  Note that even if the originating PE advertises both the Source\n   Active
      A-D route and the S-PMSI A-D route in the same BGP Update\n   message, an implementation
      cannot assume that all other PEs will\n   receive both of these routes in the
      same Update message.\n   When, as a result of receiving a withdrawal of the
      previously\n   advertised Source Tree Join C-multicast route for (C-S,C-G),
      the PE\n   is going to remove the S-PMSI/I-PMSI from the outgoing interface
      list\n   of the (C-S,C-G) state.  The local PE MUST also withdraw the Source\n
      \  Active A-D route for (C-S,C-G), if such a route has been advertised.\n   Note
      that if the PE is also acting as a C-RP, but inter-site shared\n   trees are
      being used, the reception of a PIM Register message by the\n   PE does not result
      in the origination of a Source Active A-D route.\n"
    title: 13.1.  Source within a Site - Source Active Advertisement
  - contents:
    - "13.2.  Receiving Source Active A-D Route\n   When a PE receives a new Source
      Active A-D route from some other PE,\n   the PE finds a VRF whose import Route
      Targets match one or more of\n   the Route Targets carried by the route.  If
      the match is found, then\n   the PE updates the VRF with the received route.\n
      \  We say that a given (C-S,C-G) Source Active A-D route stored in a\n   given
      VRF on a PE matches a given (C-*,C-G) entry present in the\n   MVPN-TIB associated
      with the VRF if C-G carried by the route is the\n   same as C-G of the entry,
      and the PE originates a Shared Tree Join\n   C-multicast route for the same
      C-G as the C-G of the entry.\n   When (as a result of receiving PIM messages
      from one of its CEs) a PE\n   creates in one of its MVPN-TIBs a (new) (C-*,C-G)
      entry with a non-\n   empty outgoing interface list that contains one or more
      PE-CE\n   interfaces, the PE MUST check if it has any matching Source Active\n
      \  A-D routes.  If there is one or more such matching route, such that\n   the
      PE does not have (C-S,C-G) state in its MVPN-TIB for (C-S,C-G)\n   carried in
      the route, then the PE selects one of them (using the BGP\n   route selection
      procedures), and sets up its forwarding path to\n   receive (C-S,C-G) traffic
      from the tunnel that the originator of the\n   selected Source Active A-D route
      uses for sending (C-S,C-G).\n   When, as a result of receiving a new Source
      Active A-D route, a PE\n   updates its VRF with the route, the PE MUST check
      if the newly\n   received route matches any (C-*,C-G) entries.  If (a) there
      is a\n   matching entry, (b) the PE does not have (C-S,C-G) state in its MVPN-\n
      \  TIB for (C-S,C-G) carried in the route, and (c) the received route is\n   selected
      as the best (using the BGP route selection procedures), then\n   the PE sets
      up its forwarding path to receive (C-S,C-G) traffic from\n   the tunnel the
      originator of the selected Source Active A-D route\n   uses for sending (C-S,C-G).\n
      \  Note that if the PE is also acting as a C-RP, and inter-site shared\n   trees
      are being used, the BGP Source Active A-D routes do not replace\n   the Multicast
      Source Discovery Protocol (MSDP) or PIM-based Anycast\n   RP peerings among
      C-RPs that would be needed to disseminate source\n   discovery information among
      C-RPs.\n"
    - contents:
      - "13.2.1.  Pruning Sources off the Shared Tree\n   In addition to the procedures
        in the previous section, a PE applies\n   the following procedure when importing
        a Source Active A-D route for\n   (C-S,C-G) into a VRF.\n   The PE finds a
        (C-*,C-G) entry in the MVPN-TIB whose C-G is the same\n   as the C-G carried
        in the Multicast Group field of the Source Active\n   A-D route.\n   If the
        outgoing interface list (oif) for the found (C-*,C-G) entry in\n   the MVPN-TIB
        on the PE contains either I-PMSI or S-PMSI, and the PE\n   does not originate
        the Source Tree Join C-multicast route for\n   (C-S,C-G) (where C-S is address
        carried in the Multicast Source field\n   and C-G is the address carried in
        the Multicast Group field of the\n   received Source Active A-D route), then
        the PE MUST transition the\n   (C-S,C-G,rpt) downstream state machine on I-PMSI/S-PMSI
        to the Prune\n   state.  (Conceptually, the C-PIM state machine on the PE
        will act \"as\n   if\" it had received Prune (C-S,C-G,rpt) on I-PMSI/S-PMSI,
        without\n   actually having received one.)  Depending on the (C-S,C-G,rpt)
        state\n   of the PE-CE interfaces, this may result in the PE using PIM\n   procedures
        to prune the C-S off the (C-*,C-G) tree.\n   Transitioning the state machine
        to the Prune state SHOULD be done\n   after a delay that is controlled by
        a timer.  The value of the timer\n   MUST be configurable.  The purpose of
        this timer is to ensure that\n   the C-S is not pruned off the shared tree
        until all PEs have had time\n   to receive the Source Active A-D route for
        (C-S,C-G).\n   Note that before C-S is pruned off the shared tree, there is
        a\n   possibility to have (C-S,C-G) packets sent at the same time on the\n
        \  PMSI by distinct PEs.  This would result in a transient unnecessary\n   traffic
        on the provider backbone.  However, no duplicates will reach\n   customer
        hosts subscribed to C-G as long as the downstream PEs apply\n   procedures
        described in Section 9.1 of [MVPN].\n   The PE MUST keep the (C-S,C-G,rpt)
        downstream state machine on\n   I-PMSI/S-PMSI in the Prune state for as long
        as (a) the outgoing\n   interface list (oif) for the found (C-*,C-G) entry
        in the MVPN-TIB on\n   the PE contains either I-PMSI or S-PMSI, (b) the PE
        has at least one\n   Source Active A-D route for (C-S,C-G), and (c) the PE
        does not\n   originate the Source Tree Join C-multicast route for (C-S,C-G).
        \ Once\n   any of these conditions become no longer valid, the PE MUST\n   transition
        the (C-S,C-G,rpt) downstream state machine on\n   I-PMSI/S-PMSI to the NoInfo
        state.\n   Note that changing the state on the downstream state machine on\n
        \  I-PMSI/S-PMSI, as described above, does not imply exchanging PIM\n   messages
        over I-PMSI/S-PMSI.\n   Also, note that except for the scenario described
        in the third\n   paragraph of this section, in all other scenarios relying
        solely on\n   PIM procedures on the PE is sufficient to ensure the correct
        behavior\n   when pruning sources off the shared tree.\n"
      title: 13.2.1.  Pruning Sources off the Shared Tree
    title: 13.2.  Receiving Source Active A-D Route
  title: 13.  Switching from Shared a C-Tree to a Source C-Tree
- contents:
  - "14.  Supporting PIM-SM without Inter-Site Shared C-Trees\n   The procedures defined
    in this section only apply when the\n   C-multicast routing protocol is PIM [RFC4601];
    moreover, only apply\n   for the multicast ASM mode, and MUST NOT be applied to
    multicast\n   group addresses belonging to the SSM range.  The procedures also
    MUST\n   NOT be applied when the C-multicast routing protocol is BIDIR-PIM\n   [RFC5015].\n
    \  The procedures of this section are applicable only to MVPNs that do\n   not
    use inter-site shared (i.e., rooted at a C-RP) C-trees.\n   These procedures are
    not applicable to MVPNs that use both shared and\n   shortest path inter-site
    C-trees.  See Section 13 for the procedures\n   applicable to that scenario.\n
    \  Whether or not a given MVPN uses inter-site shared C-trees must be\n   known
    a priori (e.g., via provisioning).\n"
  - contents:
    - "14.1.  Discovering Active Multicast Sources\n   A PE can obtain information
      about active multicast sources within a\n   given MVPN in a variety of ways.
      \ One way is for the PE to act as a\n   fully functional customer RP (C-RP)
      for that MVPN.  Another way is to\n   use PIM Anycast RP procedures [PIM-ANYCAST-RP]
      to convey information\n   about active multicast sources from one or more of
      the MVPN C-RPs to\n   the PE.  Yet another way is to use MSDP [MSDP] to convey
      information\n   about active multicast sources from the MVPN C-RPs to the PE.\n
      \  When a PE using any of the above methods first learns of a new\n   (multicast)
      source within that MVPN, the PE constructs a Source\n   Active A-D route and
      sends this route to all other PEs that have one\n   or more sites of that MVPN
      connected to them.  The route carries a\n   single MCAST-VPN NLRI constructed
      as follows:\n    + The RD in this NLRI is set to the RD of the VRF of the MVPN
      on the\n      PE.\n    + The Multicast Source field MUST be set to the source
      IP address of\n      the multicast data packet carried in the PIM Register message\n
      \     (RP/PIM register case) or of the MSDP Source-Active message (MSDP\n      case).
      \ The Multicast Source Length field is set appropriately to\n      reflect this.\n
      \   + The Multicast Group field MUST be set to the group IP address of\n      the
      multicast data packet carried in the PIM Register message\n      (RP/PIM register
      case) or of the MSDP Source-Active message (MSDP\n      case).  The Multicast
      Group Length field is set appropriately to\n      reflect this.\n   The Next
      Hop field of the MP_REACH_NLRI attribute MUST be set to the\n   IP address that
      the PE places in the Global Administrator field of\n   the VRF Route Import
      Extended Community of the VPN-IP routes\n   advertised by the PE.\n   The route
      SHOULD carry the same set of Route Targets as the Intra-AS\n   I-PMSI A-D route
      of the MVPN originated by the PE.\n   Using the normal BGP procedures, the Source
      Active A-D route is\n   propagated to all the PEs of the MVPN.\n   When a PE
      that previously advertised a Source Active A-D route for a\n   given (multicast)
      source learns that the source is no longer active\n   (the PE learns this by
      using the same mechanism by which the PE\n   learned that the source was active),
      the PE SHOULD withdraw the\n   previously advertised Source Active route.\n"
    title: 14.1.  Discovering Active Multicast Sources
  - contents:
    - "14.2.  Receiver(s) within a Site\n   A PE follows the procedures specified
      in Section 11.1, except that\n   the procedures specified in Section 11.1.1.2
      are replaced with the\n   procedures specified in this section.\n   When a PE
      receives a new Source Active A-D route, the PE finds a VRF\n   whose import
      Route Targets match one or more of the Route Targets\n   carried by the route.
      \ If the match is found, then the PE updates the\n   VRF with the received route.\n
      \  We say that a given (C-S,C-G) Source Active A-D route stored in a\n   given
      VRF matches a given (C-*,C-G) entry present in the MVPN-TIB\n   associated with
      the VRF if C-G carried by the route is the same as\n   C-G of the entry.\n   When
      (as a result of receiving PIM messages from one of its CEs) a PE\n   creates,
      in one of its MVPN-TIBs, a (new) (C-*,C-G) entry with a non-\n   empty outgoing
      interface list that contains one or more PE-CE\n   interfaces, the PE MUST check
      if it has any matching Source Active\n   A-D routes.  If there is one or more
      such matching routes, and the\n   best path to C-S carried in the matching route(s)
      is reachable\n   through some other PE, then for each such route the PE MUST
      originate\n   a Source Tree Join C-multicast route.  If there is one or more
      such\n   matching routes, and the best path to C-S carried in the matching\n
      \  route(s) is reachable through a CE connected to the PE, then for each\n   such
      route the PE MUST originate a PIM Join (C-S,C-G) towards the CE.\n   When, as
      a result of receiving a new Source Active A-D route, a PE\n   updates its VRF
      with the route, the PE MUST check if the newly\n   received route matches any
      (C-*,C-G) entries.  If there is a matching\n   entry, and the best path to C-S
      carried in the (A-D) route is\n   reachable through some other PE, the PE MUST
      originate a Source Tree\n   Join C-multicast route for the (C-S,C-G) carried
      by the route.  If\n   there is a matching entry, and the best path to C-S carried
      in the\n   (A-D) route is reachable through a CE connected to the PE, the PE\n
      \  MUST originate a PIM Join (C-S,C-G) towards the CE.\n   Construction and
      distribution of the Source Tree Join C-multicast\n   route follows the procedures
      specified in Section 11.1.1.1, except\n   that the Multicast Source Length,
      Multicast Source, Multicast Group\n   Length, and Multicast Group fields in
      the MCAST-VPN NLRI of the\n   Source Tree Join C-multicast route are copied
      from the corresponding\n   field in the Source Active A-D route.\n   A PE MUST
      withdraw a Source Tree Join C-multicast route for (C-S,C-G)\n   if, as a result
      of having received PIM messages from one of its CEs,\n   the PE creates a Prune
      (C-S,C-G,rpt) upstream state in one of its\n   MVPN-TIBs but has no (C-S,C-G)
      Joined state in that MVPN-TIB and had\n   previously advertised the said route.
      \ (This is even if the VRF\n   associated with the MVPN-TIB still has a (C-S,C-G)
      Source Active A-D\n   route.)\n   A PE MUST withdraw a Source Tree Join C-multicast
      route for (C-S,C-G)\n   if the Source Active A-D route that triggered the advertisement
      of\n   the C-multicast route is withdrawn.\n   When a PE deletes the (C-*,C-G)
      state (e.g., due to receiving PIM\n   Prune (C-*,C-G) from its CEs), the PE
      MUST withdraw all the Source\n   Tree Join C-multicast routes for C-G that have
      been advertised by the\n   PE, except for the routes for which the PE still
      maintains the\n   corresponding (C-S,C-G) state.\n   Even though PIM is used
      as a C-multicast protocol, procedures\n   described in Section 11.1.1.2 do not
      apply here, as only the Source\n   Tree Join C-multicast routes are exchanged
      among PEs.\n"
    title: 14.2.  Receiver(s) within a Site
  - contents:
    - "14.3.  Receiving C-Multicast Routes by a PE\n   In this model, the only valid
      type of a C-multicast route that a PE\n   could receive is a Source Tree Join
      C-multicast route.  Processing of\n   such a route follows the procedures specified
      in Section 11.3.1.1.\n"
    title: 14.3.  Receiving C-Multicast Routes by a PE
  title: 14.  Supporting PIM-SM without Inter-Site Shared C-Trees
- contents:
  - "15.  Carrier's Carrier\n   A way to support the Carrier's Carrier model is provided
    by using\n   mLDP as the CE-PE multicast routing and label distribution protocol,\n
    \  as specified in this document.\n   To improve scalability, it is RECOMMENDED
    that for the Carrier's\n   Carrier scenario within an AS, all the S-PMSIs of a
    given MVPN be\n   aggregated into a single P-multicast tree (by using upstream-assigned\n
    \  labels).\n"
  title: 15.  Carrier's Carrier
- contents:
  - "16.  Scalability Considerations\n   A PE should use Route Target Constraint [RT-CONSTRAIN]
    to advertise\n   the Route Targets that the PE uses for the VRF Route Imports
    Extended\n   Community (note that doing this requires just a single Route Target\n
    \  Constraint advertisement by the PE).  This allows each C-multicast\n   route
    to reach only the relevant PE, rather than all the PEs\n   participating the an
    MVPN.\n   To keep the intra-AS membership/binding information within the AS of\n
    \  the advertising router the BGP Update message originated by the\n   advertising
    router SHOULD carry the NO_EXPORT Community [RFC1997].\n   An Inter-AS I-PMSI
    A-D route originated by an ASBR aggregates Intra-\n   AS I-PMSI A-D routes originated
    within the ASBR's own AS.  Thus,\n   while the Intra-AS I-PMSI A-D routes originated
    within an AS are at\n   the granularity of <PE, MVPN> within that AS, outside
    of that AS the\n   (aggregated) Inter-AS I-PMSI A-D routes are at the granularity
    of\n   <AS, MVPN>.  An Inter-AS I-PMSI A-D route for a given <AS, MVPN>\n   indicates
    the presence of one or more sites of the MVPN connected to\n   the PEs of the
    AS.\n   For a given inter-AS tunnel, each of its intra-AS segments could be\n
    \  constructed by its own mechanism.  Moreover, by using upstream-\n   assigned
    labels within a given AS, multiple intra-AS segments of\n   different inter-AS
    tunnels of either the same or different MVPNs may\n   share the same P-multicast
    tree.\n   Since (aggregated) Inter-AS I-PMSI A-D routes may have a granularity\n
    \  of <AS, MVPN>, an MVPN that is present in N ASes would have total of\n   N
    inter-AS tunnels.  Thus, for a given MVPN, the number of inter-AS\n   tunnels
    is independent of the number of PEs that have this MVPN.\n   Within each Autonomous
    System, BGP route reflectors can be\n   partitioned among MVPNs present in that
    Autonomous System so that\n   each partition carries routes for only a subset
    of the MVPNs\n   supported by the service provider.  Thus, no single route reflector\n
    \  is required to maintain routes for all MVPNs.  Moreover, route\n   reflectors
    used for MVPN do not have to be used for VPN-IP routes\n   (although they may
    be used for VPN-IP routes as well).\n   As described in Section 11.4, C-multicast
    routes for a given (S,G) of\n   a given MVPN originated by PEs that are clients
    of a given route\n   reflector are aggregated by the route reflector.  Therefore,
    even if,\n   within a route reflector cluster, there are multiple C-multicast\n
    \  routes for a given (S,G) of a given MVPN, outside of the cluster, all\n   these
    routes are aggregated into a single C-multicast route.\n   Additional aggregation
    of C-multicast routes occurs at ASBRs, where\n   an ASBR aggregates all the received
    C-multicast routes for a given\n   (S,G) of a given MVPN into a single C-multicast
    route.  Moreover,\n   both route reflectors and ASBRs maintain C-multicast routes
    only in\n   the control plane, but not in the data plane.\n"
  - contents:
    - "16.1.  Dampening C-Multicast Routes\n   The rate of C-multicast routing changes
      advertised by a PE is not\n   necessarily directly proportional to the rate
      of multicast routing\n   changes within the MVPN sites connected to the PE,
      as after the first\n   (C-S,C-G) Join originated within a site, all the subsequent
      Joins for\n   same (C-S,C-G) originated within the sites of the same MVPN connected\n
      \  to the PE do not cause origination of new C-multicast routes by the\n   PE.\n
      \  Depending on how multicast VPN is engineered, dynamic addition and\n   removal
      of P2MP RSVP-TE leaves through advertisement/withdrawal of\n   Leaf A-D routes
      will happen.  Dampening techniques can be used to\n   limit corresponding processing.\n
      \  To lessen the control plane overhead associated with the processing\n   of
      C-multicast routes, this document proposes OPTIONAL route\n   dampening procedures
      similar to what is described in [RFC2439].  The\n   following OPTIONAL procedures
      can be enabled on a PE, ASBR, or BGP\n   Route Reflector advertising or receiving
      C-multicast routes.\n"
    - contents:
      - "16.1.1.  Dampening Withdrawals of C-Multicast Routes\n   A PE/ASBR/route
        reflector can OPTIONALLY delay the advertisement of\n   withdrawals of C-multicast
        routes.  An implementation SHOULD provide\n   the ability to control the delay
        via a configurable timer, possibly\n   with some backoff algorithm to adapt
        the delay to multicast routing\n   activity.\n   Dampening of withdrawals
        of C-multicast routes does not impede the\n   multicast Join latency observed
        by MVPN customers, and it also does\n   not impede the multicast leave latency
        observed by a CE, as multicast\n   forwarding from the VRF will stop as soon
        as C-multicast state is\n   removed in the VRF.\n   The potential drawbacks
        of dampening of withdrawals of C-multicast\n   routes are as follows:\n    +
        Until the withdrawals are actually sent, multicast traffic for the\n      C-multicast
        routes in question will be continued to be transmitted\n      to the PE, which
        will just have to discard it.  Note that the PE\n      may receive useless
        (multicast) traffic anyway, irrespective of\n      dampening of withdrawals
        of C-multicast routes due to the use of\n      I-PMSIs.\n    + Any state in
        the upstream PEs that would be removed as a result of\n      processing the
        withdrawals will remain until the withdrawals are\n      sent.\n   Discussion
        on whether the potential drawbacks mentioned above are of\n   any practical
        significance is outside the scope of this document.\n"
      title: 16.1.1.  Dampening Withdrawals of C-Multicast Routes
    - contents:
      - "16.1.2.  Dampening Source/Shared Tree Join C-Multicast Routes\n   A PE/ASBR/route
        reflector can OPTIONALLY delay the advertisement of\n   Source/Shared Tree
        Join C-multicast routes.  An implementation SHOULD\n   provide the ability
        to control the delay via a configurable timer,\n   possibly with some backoff
        algorithm to adapt the delay to multicast\n   routing activity.\n   Dampening
        Source/Shared Tree Join C-multicast routes will not impede\n   multicast Join
        latency observed by a given MVPN, except if the PE\n   advertising the Source/Shared
        Tree Join C-multicast route for a\n   particular C-S/C-RP is the first to
        do so for all the sites of the\n   MVPN that share the same upstream PE with
        respect to the C-S/C-RP.\n"
      title: 16.1.2.  Dampening Source/Shared Tree Join C-Multicast Routes
    title: 16.1.  Dampening C-Multicast Routes
  - contents:
    - "16.2.  Dampening Withdrawals of Leaf A-D Routes\n   Similar to the procedures
      proposed above for withdrawal of\n   C-multicast routes, dampening can be applied
      to the withdrawal of\n   Leaf A-D routes.\n"
    title: 16.2.  Dampening Withdrawals of Leaf A-D Routes
  title: 16.  Scalability Considerations
- contents:
  - "17.  Security Considerations\n   The mechanisms described in this document could
    reuse the existing\n   BGP security mechanisms [RFC4271] [RFC4272].  The security
    model and\n   threats specific to Provider Provisioned VPNs, including L3VPNs,
    are\n   discussed in [RFC4111].  [MVPN] discusses additional threats specific\n
    \  to the use of multicast in L3VPNs.  There is currently work in\n   progress
    to improve the security of TCP authentication.  When the\n   document is finalized
    as an RFC, the method defined in [RFC5925]\n   SHOULD be used where authentication
    of BGP control packets is needed.\n   A PE router MUST NOT accept, from CEs routes,
    with MCAST-VPN SAFI.\n   If BGP is used as a CE-PE routing protocol, then when
    a PE receives a\n   route from a CE, if this route carries the VRF Route Import
    Extended\n   Community, the PE MUST remove this Community from the route before\n
    \  turning it into a VPN-IP route.  Routes that a PE advertises to a CE\n   MUST
    NOT carry the VRF Route Import Extended Community.\n   It is important to protect
    the control plane resources within the PE\n   to prevent any one VPN from hogging
    excessive resources.  This is the\n   subject of the remainder of the Security
    Considerations section.\n   When C-multicast routing information is exchanged
    among PEs using\n   BGP, an implementation SHOULD provide the ability to rate
    limit BGP\n   messages used for this exchange.  This SHOULD be provided on a per-\n
    \  PE, per-MVPN granularity.\n   An implementation SHOULD provide capabilities
    to impose an upper\n   bound on the number of S-PMSI A-D routes, as well as on
    how\n   frequently they may be originated.  This SHOULD be provided on a per-\n
    \  PE, per-MVPN granularity.\n   In conjunction with the procedures specified
    in Section 14, an\n   implementation SHOULD provide capabilities to impose an
    upper bound\n   on the number of Source Active A-D routes, as well as on how\n
    \  frequently they may be originated.  This SHOULD be provided on a per-\n   PE,
    per-MVPN granularity.\n   In conjunction with the procedures specified in Section
    13 limiting\n   the amount of (C-S,C-G) state would limit the amount of Source
    Active\n   A-D route, as in the context of this section, Source Active A-D\n   routes
    are created in response to Source Tree Join C-multicast\n   routes, and Source
    Tree Join C-multicast routes are created as a\n   result of creation of (C-S,C-G)
    state on PEs.  However, to provide an\n   extra level of robustness in the context
    of these procedures, an\n   implementation MAY provide capabilities to impose
    an upper bound on\n   the number of Source Active A-D routes, as well as on how
    frequently\n   they may be originated.  This MAY be provided on a per-PE, per-MVPN\n
    \  granularity.\n   Section 16.1.1 describes optional procedures for dampening\n
    \  withdrawals of C-multicast routes.  It is RECOMMENDED that an\n   implementation
    support such procedures.\n   Section 16.1.1 describes optional procedures for
    dampening\n   withdrawals of Leaf A-D routes.  It is RECOMMENDED that an\n   implementation
    support such procedures.\n"
  title: 17.  Security Considerations
- contents:
  - "18.  IANA Considerations\n   This document defines a new BGP Extended Community
    called \"Source\n   AS\".  This Community is of an extended type and is transitive.
    \ The\n   Type value for this Community has been allocated from the two-octet\n
    \  AS-Specific Extended Community registry as 0x0009 and from the four-\n   octet
    AS-Specific Extended Community registry as 0x0209.\n   This document defines a
    new BGP Extended Community called \"VRF Route\n   Import\" (Type value 0x010b).
    \ This Community is IP address specific,\n   of an extended type, and is transitive.\n
    \  This document defines a new NLRI, called \"MCAST-VPN\", to be carried\n   in
    BGP using multiprotocol extensions.  It has been assigned SAFI 5.\n   Also, SAFI
    129 has been assigned to \"Multicast for BGP/MPLS IP\n   Virtual Private Networks
    (VPNs)\".\n   This document defines a new BGP optional transitive attribute, called\n
    \  \"PMSI_TUNNEL\".  IANA has assigned the codepoint 22 in the \"BGP Path\n   Attributes\"
    registry to the PMSI_TUNNEL attribute.\n   This document defines a new BGP optional
    transitive attribute, called\n   \"PE Distinguisher Labels\".  IANA has assigned
    the codepoint 27 in the\n   \"BGP Path Attributes\" registry to the PE Distinguisher
    Labels\n   attribute.\n"
  title: 18.  IANA Considerations
- contents:
  - "19.  Acknowledgements\n   We would like to thank Chaitanya Kodeboniya for helpful
    discussions.\n   We would also like to thank members of the L3VPN IETF Working
    Group\n   for insightful comments and review.\n"
  title: 19.  Acknowledgements
- contents:
  - '20.  References

    '
  - contents:
    - "20.1.  Normative References\n   [IANA-SAFI] IANA, \"Subsequent Address Family
      Identifiers (SAFI)\n               Parameters\", http://www.iana.org.\n   [MVPN]
      \     Rosen, E., Ed. and R. Aggarwal, Ed., \"Mulitcast in\n               MPLS/BGP
      IP VPNs\", RFC 6513, February 2012.\n   [RFC1997]   Chandra, R., Traina, P.,
      and T. Li, \"BGP Communities\n               Attribute\", RFC 1997, August 1996.\n
      \  [RFC2119]   Bradner, S., \"Key words for use in RFCs to Indicate\n               Requirement
      Levels\", BCP 14, RFC 2119, March 1997.\n   [RFC4271]   Rekhter, Y., Ed., Li,
      T., Ed., and S. Hares, Ed., \"A\n               Border Gateway Protocol 4 (BGP-4)\",
      RFC 4271, January\n               2006.\n   [RFC4360]   Sangli, S., Tappan,
      D., and Y. Rekhter, \"BGP Extended\n               Communities Attribute\",
      RFC 4360, February 2006.\n   [RFC4364]   Rosen, E. and Y. Rekhter, \"BGP/MPLS
      IP Virtual Private\n               Networks (VPNs)\", RFC 4364, February 2006.\n
      \  [RFC4601]   Fenner, B., Handley, M., Holbrook, H., and I. Kouvelas,\n               \"Protocol
      Independent Multicast - Sparse Mode (PIM-SM):\n               Protocol Specification
      (Revised)\", RFC 4601, August 2006.\n   [RFC4659]   De Clercq, J., Ooms, D.,
      Carugi, M., and F. Le Faucheur,\n               \"BGP-MPLS IP Virtual Private
      Network (VPN) Extension for\n               IPv6 VPN\", RFC 4659, September
      2006.\n   [RFC4760]   Bates, T., Chandra, R., Katz, D., and Y. Rekhter,\n               \"Multiprotocol
      Extensions for BGP-4\", RFC 4760, January\n               2007.\n"
    title: 20.1.  Normative References
  - contents:
    - "20.2.  Informative References\n   [mLDP]      Wijnands, IJ., Ed., Minei, I.,
      Ed., Kompella, K., and B.\n               Thomas, \"Label Distribution Protocol
      Extensions for\n               Point-to-Multipoint and Multipoint-to-Multipoint
      Label\n               Switched Paths\", RFC 6388, November 2011.\n   [MSDP]
      \     Fenner, B., Ed., and D. Meyer, Ed., \"Multicast Source\n               Discovery
      Protocol (MSDP)\", RFC 3618, October 2003.\n   [PIM-ANYCAST-RP]\n               Farinacci,
      D. and Y. Cai, \"Anycast-RP Using Protocol\n               Independent Multicast
      (PIM)\", RFC 4610, August 2006.\n   [RFC5331]   Aggarwal, R., Rekhter, Y., and
      E. Rosen, \"MPLS Upstream\n               Label Assignment and Context-Specific
      Label Space\", RFC\n               5331, August 2008.\n   [RT-CONSTRAIN]\n               Marques,
      P., Bonica, R., Fang, L., Martini, L., Raszuk,\n               R., Patel, K.,
      and J. Guichard, \"Constrained Route\n               Distribution for Border
      Gateway Protocol/MultiProtocol\n               Label Switching (BGP/MPLS) Internet
      Protocol (IP) Virtual\n               Private Networks (VPNs)\", RFC 4684, November
      2006.\n   [RFC2439]   Villamizar, C., Chandra, R., and R. Govindan, \"BGP Route\n
      \              Flap Damping\", RFC 2439, November 1998.\n   [RFC4111]   Fang,
      L., Ed., \"Security Framework for Provider-\n               Provisioned Virtual
      Private Networks (PPVPNs)\", RFC 4111,\n               July 2005.\n   [RFC4272]
      \  Murphy, S., \"BGP Security Vulnerabilities Analysis\", RFC\n               4272,
      January 2006.\n   [RFC4607]   Holbrook, H. and B. Cain, \"Source-Specific Multicast
      for\n               IP\", RFC 4607, August 2006.\n   [RFC4875]   Aggarwal, R.,
      Ed., Papadimitriou, D., Ed., and S.\n               Yasukawa, Ed., \"Extensions
      to Resource Reservation\n               Protocol - Traffic Engineering (RSVP-TE)
      for Point-to-\n               Multipoint TE Label Switched Paths (LSPs)\", RFC
      4875, May\n               2007.\n   [RFC5015]   Handley, M., Kouvelas, I., Speakman,
      T., and L. Vicisano,\n               \"Bidirectional Protocol Independent Multicast
      (BIDIR-\n               PIM)\", RFC 5015, October 2007.\n   [RFC5925]   Touch,
      J., Mankin, A., and R. Bonica, \"The TCP\n               Authentication Option\",
      RFC 5925, June 2010.\n"
    title: 20.2.  Informative References
  title: 20.  References
- contents:
  - "Authors' Addresses\n   Rahul Aggarwal\n   Juniper Networks\n   1194 North Mathilda
    Ave.\n   Sunnyvale, CA 94089\n   EMail: raggarwa_1@yahoo.com\n   Eric C. Rosen\n
    \  Cisco Systems, Inc.\n   1414 Massachusetts Avenue\n   Boxborough, MA, 01719\n
    \  EMail: erosen@cisco.com\n   Thomas Morin\n   France Telecom - Orange\n   2,
    avenue Pierre-Marzin\n   22307 Lannion Cedex\n   France\n   EMail: thomas.morin@orange.com\n
    \  Yakov Rekhter\n   Juniper Networks\n   1194 North Mathilda Ave.\n   Sunnyvale,
    CA 94089\n   EMail: yakov@juniper.net\n"
  title: Authors' Addresses
