Abstract This document describes the Diameter protocol application used for Authentication, Authorization, and Accounting (AAA) services in the Network Access Server (NAS) environment.
When combined with the Diameter Base protocol, Transport Profile, and Extensible Authentication Protocol specifications, this application specification satisfies typical network access services requirements.
Initial deployments of the Diameter protocol are expected to include legacy systems.
Therefore, this application has been carefully designed to ease the burden of protocol conversion between RADIUS and Diameter.
This is achieved by including the RADIUS attribute space to eliminate the need to perform many attribute translations.
The interactions between Diameter applications and RADIUS specified in this document are to be applied to all Diameter applications.
In this sense, this document extends the Base Diameter protocol.
This document describes the Diameter protocol application used for AAA in the Network Access Server (NAS) environment.
When combined with the Diameter Base protocol [BASE], Transport Profile [DiamTrans], and EAP [DiamEAP] specifications, this Diameter NAS application specification satisfies NAS related requirements defined in RFC 2989 [AAACriteria] and RFC 3169 [NASCriteria].
Initial deployments of the Diameter protocol are expected to include legacy systems.
Therefore, this application has been carefully designed to ease the burden of protocol conversion between RADIUS and Diameter.
This is achieved by including the RADIUS attribute space to eliminate the need to perform many attribute translations.
The interactions specified in this document between Diameter applications and RADIUS are to be applied to all Diameter applications.
In this sense, this document extends the Base Diameter protocol [BASE].
First, this document describes the operation of a Diameter NAS application.
Then it defines the Diameter message Command Codes.
The following sections list the AVPs used in these messages, grouped by common usage.
These are session identification, authentication, authorization, tunneling, and accounting.
The authorization AVPs are further broken down by service type.
Interaction and backward compatibility issues with RADIUS are discussed in later sections.
The base Diameter [BASE] specification section 1.4 defines most of the terminology used in this document.
Additionally, the following terms and acronyms are used in this application: NAS (Network Access Server)
A device that provides an access service for a user to a network.
The service may be a network connection or a value added service such as terminal emulation [NASModel].
PPP (Point to Point Protocol)
PPP is the primary IP datalink used for dial in NAS connection service [PPP].
CHAP (Challenge Handshake Authentication Protocol)
An authentication process used in PPP [PPPCHAP].
A deprecated PPP authentication process, but often used for backward compatibility [PAP].
SLIP (Serial Line Interface Protocol)
A serial datalink that only supports IP.
A design prior to PPP.
ARAP (Appletalk Remote Access Protocol)
A serial datalink for accessing Appletalk networks [ARAP].
The network protocol used by NetWare networks [IPX].
LAN protocol for terminal services [LAT].
In this document, this term is used to describe access services that use tunneling methods.
In this document, the key words "MAY", "MUST", "MUST NOT", "OPTIONAL", "RECOMMENDED", "SHOULD", and "SHOULD NOT" are to be interpreted as described in [Keywords].
Advertising Application Support Diameter applications conforming to this specification MUST advertise support by including the value of one (1) in the Auth Application Id of Capabilities Exchange Request (CER), AA Request (AAR), and AA  Answer (AAA) messages.
All other messages are defined by [BASE] and use the Base application id value.
NAS Calls, Ports, and Sessions
The arrival of a new call or service connection at a port of a Network Access Server (NAS) starts a Diameter NAS message exchange.
Information about the call, the identity of the user, and the user's authentication information are packaged into a Diameter AA Request (AAR) message and sent to a server.
The server processes the information and responds with a Diameter AA Answer (AAA) message that contains authorization information for the NAS, or a failure code (Result Code AVP).
A value of DIAMETER MULTI ROUND AUTH indicates an additional authentication exchange, and several AAR and AAA messages may be exchanged until the transaction completes.
Depending on the Auth Request Type AVP, the Diameter protocol allows authorization only requests that contain no authentication information from the client.
This capability goes beyond the Call Check capabilities described in section 5.6 of [RADIUS] in that no access decision is requested.
As a result, service cannot be started as a result of a response to an authorization only request without introducing a significant security vulnerability.
Since no equivalent capability exists in RADIUS, authorization only requests from a NAS implementing Diameter may not be easily translated to an equivalent RADIUS message by a Diameter/RADIUS gateway.
For example, when a Diameter authorization only request cannot be translated to a RADIUS Call Check, it would be necessary for the Diameter/RADIUS gateway to add authentication information to the RADIUS Access Request.
On receiving the Access Reply, the Diameter/RADIUS gateway would need to discard the access decision (Accept/Reject).
It is not clear whether these translations can be accomplished without adding significant security vulnerabilities.
When the authentication or authorization exchange completes successfully, the NAS application SHOULD start a session context.
If the Result Code of DIAMETER MULTI ROUND AUTH is returned, the exchange continues until a success or error is returned.
If accounting is active, the application MUST also send an Accounting message [BASE].
An Accounting Record Type of START RECORD is sent for a new session.
If a session fails to start, the EVENT RECORD message is sent with the reason for the failure described.
Note that the return of an unsupportable Accounting Realtime Required value [BASE] would result in a failure to establish the session.
Diameter Session Reauthentication or Reauthorization The Diameter Base protocol allows users to be periodically reauthenticated and/or reauthorized.
In such instances, the Session Id AVP in the AAR message MUST be the same as the one present in the original authentication/authorization message.
A Diameter server informs the NAS of the maximum time allowed before reauthentication or reauthorization via the Authorization Lifetime AVP [BASE].
A NAS MAY reauthenticate and/or reauthorize before the end, but A NAS MUST reauthenticate and/or reauthorize at the end of the period provided by the Authorization Lifetime AVP.
The failure of a reauthentication exchange will terminate the service.
Furthermore, it is possible for Diameter servers to issue an unsolicited reauthentication and/or reauthorization request (e.g., Re Auth Request (RAR) message [BASE]) to the NAS.
Upon receipt of such a message, the NAS MUST respond to the request with a Re Auth  Answer (RAA) message [BASE].
If the RAR properly identifies an active session, the NAS will initiate a new local reauthentication or authorization sequence as indicated by the Re Auth Request Type value.
This will cause the NAS to send a new AAR message using
The server will respond with an AAA message to specify the new service parameters.
If accounting is active, every change of authentication or authorization SHOULD generate an accounting message.
If the NAS service is a continuation of the prior user context, then an Accounting Record Type of INTERIM RECORD indicating the new session attributes and cumulative status would be appropriate.
If a new user or a significant change in authorization is detected by the NAS, then the service may send two messages of the types STOP RECORD and START RECORD.
Accounting may change the subsession identifiers (Acct Session ID, or Acct Sub Session Id) to indicate such sub  sessions.
A service may also use a different Session
Id value for accounting (see [BASE] section 9.6).
However, the Diameter Session ID AVP value used for the initial authorization exchange MUST be used to generate an STR message when the session context is terminated.
When a NAS receives an indication that a user's session is being disconnected by the client (e.g., LCP Terminate is received) or an administrative command, the NAS MUST issue a Session Termination  Request (STR) [BASE] to its Diameter Server.
This will ensure that any resources maintained on the servers are freed appropriately.
Furthermore, a NAS that receives an Abort Session Request (ASR) [BASE] MUST issue an ASA if the session identified is active and disconnect the PPP (or tunneling) session.
If accounting is active, an Accounting STOP RECORD message [BASE] MUST be sent upon termination of the session context.
More information on Diameter Session Termination is included in [BASE] sections 8.4 and 8.5.
This section defines the Diameter message Command Code [BASE] values that MUST be supported by all Diameter implementations conforming to this specification.
The Command Codes are as follows:
The AA Request (AAR), which is indicated by setting the Command Code field to 265 and the 'R' bit in the Command Flags field, is used to request authentication and/or authorization for a given NAS user.
The type of request is identified through the Auth Request Type AVP [BASE].
The recommended value for most RADIUS interoperabily situations is AUTHORIZE AUTHENTICATE.
If Authentication is requested, the User Name attribute SHOULD be present, as well as any additional authentication AVPs that would carry the password information.
A request for authorization SHOULD only include the information from which the authorization will be performed, such as the User Name, Called Station Id, or Calling  Station Id AVPs.
All requests SHOULD contain AVPs uniquely identifying the source of the call, such as Origin Host and NAS Port.
Certain networks MAY use different AVPs for authorization purposes.
A request for authorization will include some AVPs defined in section 6.
It is possible for a single session to be authorized first and then for an authentication request to follow.
This AA Request message MAY be the result of a multi round authentication exchange, which occurs when the AA Answer message is received with the Result Code AVP set to DIAMETER MULTI ROUND AUTH.
A subsequent AAR message SHOULD be sent, with the User Password AVP that includes the user's response to the prompt, and MUST include any State AVPs that were present in the AAA message.
< Diameter Header: 265, REQ, PXY >
[ NAS IPv6 Address ]
[ NAS Port ] [
[ NAS Port Type ]
[ Origin AAA Protocol ]
[ Origin State Id ]
[ Auth Grace Period ]
[ Auth Session State ]
[ Calling Station Id ]
[ Framed IP Address ]
[ ARAP Security Data ]
[ Login IP Host ]
[ Login LAT Node ]
[ Login LAT Port ]
[ Login LAT Service ]
The AA Answer (AAA) message is indicated by setting the Command Code field to 265 and clearing the 'R' bit in the Command Flags field.
It is sent in response to the AA Request (AAR) message.
If authorization was requested, a successful response will include the authorization AVPs appropriate for the service being provided, as defined in section 6.
For authentication exchanges requiring more than a single round trip, the server MUST set the Result Code AVP to DIAMETER MULTI ROUND AUTH.
An AAA message with this result code MAY include one Reply Message or more and MAY include zero or one State AVPs.
If the Reply Message AVP was present, the network access server SHOULD send the text to the user's client to display to the user, instructing the client to prompt the user for a response.
For example, this capability can be achieved in PPP via PAP.
If the access client is unable to prompt the user for a new response, it MUST treat the AA Answer (AAA) with the Reply Message AVP as an error and deny access.
Message Format <AA Answer> ::
< Diameter Header: 265, PXY >
[ Auth Grace Period ]
[ Multi Round Time Out ]
[ Origin AAA Protocol ]
[ Origin State Id ]
[ ARAP Zone Access ]
[ Framed Appletalk Link ]
[ Framed IP Address ]
[ Login IP Host ]
[ Login LAT Node ]
[ Login LAT Port ]
[ Login LAT Service ]
[ Login TCP Port ]
[ NAS Filter Rule ]
[ QoS Filter Rule ]
[ Redirect Host Usage ]
[ Redirect Max Cache Time ]
Command A Diameter server may initiate a re authentication and/or re  authorization service for a particular session by issuing a Re Auth  Request (RAR) message [BASE].
For example, for pre paid services, the Diameter server that originally authorized a session may need some confirmation that the user is still using the services.
If a NAS receives an RAR message with Session
Id equal to a currently active session and a Re Auth Type that includes authentication, it MUST initiate a re authentication toward the user, if the service supports this particular feature.
< Diameter Header: 258, REQ, PXY >
[ Origin AAA Protocol ]
[ Origin State Id ]
[ NAS IPv6 Address ]
[ NAS Port ] [
[ NAS Port Type ]
[ Framed IPv6 Prefix ]
[ Framed Interface Id ]
[ Called Station Id ]
[ Calling Station Id ]
[ Originating Line Info ]
[ Acct Session Id ]
[ Acct Multi Session Id ]
The Re Auth Answer (RAA) message [BASE] is sent in response to the RAR.
The Result Code AVP MUST be present and indicates the disposition of the request.
A successful RAA transaction MUST be followed by an AAR message.
Diameter Header: 258, PXY >
[ Origin AAA Protocol ]
[ Origin State Id ]
[ Redirected Host Cache Time ]
[ Auth Grace Period ]
[ Re Auth Request Type ]
The Session Termination Request (STR) message [BASE] is sent by the NAS to inform the Diameter Server that an authenticated and/or authorized session is being terminated.
Message Format <ST Request> :
< Diameter Header: 275, REQ, PXY >
[ Origin State Id ]
The Session Termination Answer (STA) message [BASE] is sent by the Diameter Server to acknowledge the notification that the session has been terminated.
The Result Code AVP MUST be present and MAY contain an indication that an error occurred while the STR was being serviced.
Upon sending or receiving the STA, the Diameter Server MUST release all resources for the session indicated by the Session Id AVP.
Any intermediate server in the Proxy Chain MAY also release any resources, if necessary.
< Diameter Header: 275, PXY >
[ Error Reporting Host ]
[ Origin State Id ]
[ Redirect Max Cache Time ]
Abort Session Request (ASR) Command
The Abort Session Request (ASR) message [BASE] may be sent by any server to the NAS providing session service, to request that the session identified by the Session Id be stopped.
< Diameter Header: 274, REQ, PXY >
[ Origin AAA Protocol ]
[ Origin State Id ]
[ NAS IPv6 Address ]
[ NAS Port ] [
[ NAS Port Type ]
[ Framed IPv6 Prefix ]
[ Framed Interface Id ]
[ Called Station Id ]
[ Calling Station Id ]
[ Originating Line Info ]
[ Acct Session Id ]
[ Acct Multi Session Id ]
The ASA message [BASE] is sent in response to the ASR.
Code AVP MUST be present and indicates the disposition of the request.
If the session identified by Session Id in the ASR was successfully terminated, Result Code is set to DIAMETER SUCCESS.
If the session is not currently active, Result Code is set to DIAMETER UNKNOWN SESSION ID.
If the access device does not stop the session for any other reason, Result Code is set to DIAMETER UNABLE TO COMPLY.
Diameter Header: 274, PXY >
[ Origin AAA Protocol ]
[ Origin State Id ]
[ State] [ Error Message ]
[ Error Reporting Host ]
[ Redirected Max Cache Time ]
The ACR message [BASE] is sent by the NAS to report its session information to a target server downstream.
Either of Acct Application Id or Vendor Specific Application
d AVPs MUST be present.
If the Vendor Specific Application Id grouped AVP is present, it must have an Acct Application Id inside.
The AVPs listed in the Base MUST be assumed to be present, as appropriate.
NAS service specific accounting AVPs SHOULD be present as described in section 8 and the rest of this specification.
< Diameter Header: 271, REQ, PXY >
[ Vendor Specific Application Id ]
[ User Name ] [
[ Acct Session Id ]
[ Acct Multi Session Id ]
[ Origin AAA Protocol ]
[ Origin State Id ]
[ Acct Delay Time ]
[ NAS IPv6 Address ]
[ NAS Port ] [
[ NAS Port Type ]
[ Accounting Output Packets ]
[ Acct Tunnel Connection ]
[ Acct Tunnel Packets Lost ]
[ Calling Station Id ]
[ Accounting Realtime Required ]
[ Acct Interim Interval ]
[ NAS Filter Rule ]
[ Framed IPv6 Pool ]
[ Login IP Host ]
[ Login LAT Node ]
[ Login LAT Port ]
[ Login LAT Service ]
[ Login TCP Port ]
The ACA message [BASE] is used to acknowledge an Accounting Request command.
The Accounting Answer command contains the same Session Id as the Request.
If the Accounting Request was protected by end to  end security, then the corresponding ACA message MUST be protected as well.
Only the target Diameter Server or home Diameter Server SHOULD respond with the Accounting Answer command.
Either Acct Application Id or Vendor Specific Application
d AVPs MUST be present, as it was in the request.
The AVPs listed in the Base MUST be assumed to be present, as appropriate.
NAS service specific accounting AVPs SHOULD be present as described in section 8 and the rest of this specification.
Message Format <AC Answer> ::
[ Vendor Specific Application Id ]
[ User Name ] [
[ Acct Session Id ]
[ Acct Multi Session Id ]
[ Error Reporting Host ]
[ Origin State Id ]
[ NAS IPv6 Address ]
[ NAS Port ] [
[ NAS Port Type ]
[ Accounting Realtime Required ]
[ Acct Interim Interval ]
NAS Session AVPs Diameter reserves the AVP Codes 0 255 for RADIUS functions that are implemented in Diameter.
AVPs new to Diameter have code values of 256 and greater.
A Diameter message that includes one of these AVPs may represent functions not present in the RADIUS environment and may cause interoperability issues, should the request traverse an AAA system that only supports the RADIUS protocol.
Some RADIUS attributes are not allowed or supported directly in Diameter.
See section 9 for more information.
This section contains the AVPs specific to NAS Diameter applications that are needed to identify the call and session context and status information.
On a request, this information allows the server to qualify the session.
These AVPs are used in addition to the Base AVPs of: Session Id Auth Application
Origin Host Origin Realm Auth Request Type Termination Cause
The following table describes the session level AVPs; their AVP Code values, types, and possible flag values; and whether the AVP MAY be encrypted.
The NAS Port AVP (AVP Code 5) is of type Unsigned32 and contains the physical or virtual port number of the NAS which is authenticating the user.
Note that "port" is meant in its sense as a service connection on the NAS, not as an IP protocol identifier.
Either NAS Port or NAS Port
(AVP Code 87) SHOULD be present in AA Request (AAR) commands if the NAS differentiates among its ports.
Id AVP (AVP Code 87) is of type UTF8String
and consists of ASCII text identifying the port of the NAS authenticating the user.
Note that "port" is meant in its sense as a service connection on the NAS, not as an IP protocol identifier.
Either NAS Port or NAS Port
Id SHOULD be present in AA Request (AAR) commands if the NAS differentiates among its ports.
Id is intended for use by NASes that cannot conveniently number their ports.
The NAS Port Type AVP (AVP Code 61) is of type Enumerated and contains the type of the port on which the NAS is authenticating the user.
This AVP SHOULD be present if the NAS uses the same NAS Port number ranges for different service types concurrently.
The supported values are defined in [RADIUSTypes].
The following list is informational and subject to change by the IANA. 0
ADSL CAP Asymmetric DSL, Carrierless Amplitude Phase Modulation 13
IDSL ISDN Digital Subscriber Line 15
Digital Subscriber Line of unknown type 17
AVP (AVP Code 30) is of type UTF8String and allows the NAS to send the ASCII string describing the layer 2 address the user contacted in the request.
For dialup access, this can be a phone number obtained by using Dialed Number Identification (DNIS) or a similar technology.
Note that this may be different from the phone number
the call comes in on.
For use with IEEE 802 access, the Called Station
Id MAY contain a MAC address formatted as described in [RAD802.1X].
It SHOULD only be present in authentication and/or authorization requests.
If the Auth Request Type AVP is set to authorization only and the User Name AVP is absent, the Diameter Server MAY perform authorization based on this field.
This can be used by a NAS to request whether a call should be answered based on the DNIS.
The codification of this field's allowed usage range is outside the scope of this specification.
AVP (AVP Code 31) is of type UTF8String and allows the NAS to send the ASCII string describing the layer 2 address from which the user connected in the request.
For dialup access, this is the phone number the call came from, using Automatic Number Identification (ANI) or a similar technology.
For use with IEEE 802 access, the Calling Station Id AVP MAY contain a MAC address, formated as described in [RAD802.1X].
It SHOULD only be present in authentication and/or authorization requests.
If the Auth Request Type AVP is set to authorization only and the User Name AVP is absent, the Diameter Server MAY perform authorization based on this field.
This can be used by a NAS to request whether a call should be answered based on the layer 2 address (ANI, MAC Address, etc.)
The codification of this field's allowed usage range is outside the scope of this specification.
The Connect Info AVP (AVP Code 77) is of type UTF8String and is sent in the AA Request message or ACR
When sent in the Access Request, it indicates the nature of the user's connection.
The connection speed SHOULD be included at the beginning of the first Connect Info AVP in the message.
For example: "28800 V42BIS/LAPM" or "52000/31200 V90" More than one Connect Info attribute may be present in an Accounting Request packet to accommodate expected efforts by the ITU to have modems report more connection information in a standard format that might exceed 252 octets.
If sent in the ACR STOP, this attribute may summarize statistics relating to session quality.
For example, in IEEE 802.11, the Connect Info attribute may contain information on the number of link layer retransmissions.
The exact format of this attribute is implementation specific.
Originating Line Info AVP The Originating Line Info AVP (AVP Code 94) is of type OctetString and is sent by the NAS system to convey information about the origin of the call from an SS7 system.
The originating line information (OLI) element indicates the nature and/or characteristics of the line from which a call originated (e.g., pay phone, hotel, cellular).
Telephone companies are starting to offer OLI to their customers as an option over Primary Rate Interface (PRI).
Internet Service Providers (ISPs) can use OLI in addition to Called Station Id and Calling Station Id attributes to differentiate customer calls and to define different services.
The Value field contains two octets (00 99).
ANSI T1.113 and BELLCORE 394 can be used for additional information about these values and their use.
For more information on current assignment values, see [ANITypes].
Plain Old Telephone Service (POTS)
Multiparty Line (more than 2) 02
ANI Failure 03    ANI Observed 04
Special Operator Handling Required 08
Automatic Identified Outward Dialing (AIOD)
Coin or Non Coin 24
(Pay Origination) 27    Toll Free Service (Coin Control Origination)
29    Prison/Inmate Service 30 32
Intercept 30    Intercept (Blank) 31
Unrestricted Use 52    Outward Wide Area Telecommunications Service (OUTWATS) 60    Telecommunications Relay Service (TRS)(Unrestricted)
Pay Station, No Coin Control 93    Access for Private Virtual Network Service 4.9.
The Reply Message AVP (AVP Code 18) is of type UTF8String and contains text that MAY be displayed to the user.
When used in an AA Answer message with a successful Result Code AVP, it indicates success.
When found in an AAA message with a Result Code other than DIAMETER SUCCESS, the AVP contains a failure message.
The Reply Message AVP MAY indicate dialog text to prompt the user before another AA Request attempt.
When used in an AA Answer with a Result Code of DIAMETER MULTI ROUND AUTH or in an Re Auth Request message, it MAY contain a dialog text to prompt the user for a response.
Multiple Reply Messages MAY be included, and if any are displayed, they MUST be displayed in the same order as they appear in the Diameter message.
This section defines the AVPs necessary to carry the authentication information in the Diameter protocol.
The functionality defined here provides a RADIUS like AAA service over a more reliable and secure transport, as defined in the base protocol [BASE].
The following table describes the AVPs; their AVP Code values, types, and possible flag values, and whether the AVP MAY be encrypted.
The User Password AVP (AVP Code 2) is of type OctetString and contains the password of the user to be authenticated, or the user's input in a multi round authentication exchange.
The User Password AVP contains a user password or one time password and therefore represents sensitive information.
As required in [BASE], Diameter messages are encrypted by using IPsec or TLS.
Unless this AVP is used for one time passwords, the User Password AVP SHOULD NOT be used in untrusted proxy environments without encrypting it by using end to end security techniques, such as the proposed CMS Security [DiamCMS].
The clear text password (prior to encryption) MUST NOT be longer than 128 bytes in length.
The Password Retry AVP (AVP Code 75) is of type Unsigned32 and MAY be included in the AA Answer if the Result Code indicates an authentication failure.
The value of this AVP indicates how many authentication attempts a user is permitted before being disconnected.
This AVP is primarily intended for use when the Framed Protocol AVP (see section 6.10.1) is set to ARAP.
The Prompt AVP (AVP Code 76) is of type Enumerated and
MAY be present in the AA Answer message.
When present, it is used by the NAS to determine whether the user's response, when entered, should be echoed.
The supported values are listed in [RADIUSTypes].
The following list is informational: 0
No Echo 1  Echo 5.4.
The CHAP Auth AVP (AVP Code 402) is of type Grouped and contains the information necessary to authenticate a user using the PPP Challenge Handshake Authentication Protocol (CHAP) [PPPCHAP].
If the CHAP Auth AVP is found in a message, the CHAP Challenge AVP MUST be present as well.
The optional AVPs containing the CHAP response depend upon the value of the CHAP Algorithm AVP.
The CHAP Algorithm AVP (AVP Code 403) is of type Enumerated and contains the algorithm identifier used in the computation of the CHAP response [PPPCHAP].
The CHAP response is computed by using the procedure described in [PPPCHAP].
This algorithm requires that the CHAP Response AVP MUST be present in the CHAP Auth AVP.
The CHAP Ident AVP (AVP Code 404) is of type OctetString and contains the 1 octet CHAP Identifier used in the computation of the CHAP response [PPPCHAP].
The CHAP Response AVP (AVP Code 405) is of type OctetString and contains the 16 octet authentication data provided by the user in response to the CHAP challenge [PPPCHAP].
The CHAP Challenge AVP (AVP Code 60) is of type OctetString and contains the CHAP Challenge sent by the NAS to the CHAP peer [PPPCHAP].
The ARAP Password AVP (AVP Code 70) is of type OctetString and is only present when the Framed Protocol AVP (see section 6.10.1) is included in the message and is set to ARAP.
This AVP MUST NOT be present if either the User Password or the CHAP Auth AVP is present.
See [RADIUSExt] for more information on the contents of this AVP. 5.10.
The ARAP Challenge Response AVP (AVP Code 84) is of type OctetString and is only present when the Framed Protocol AVP (see section 6.10.1) is included in the message and is set to ARAP.
This AVP contains an 8 octet response to the dial in client's challenge.
The RADIUS server calculates this value by taking the dial in client's challenge from the high order 8 octets of the ARAP Password AVP and performing DES encryption on this value with the authenticating user's password as the key.
If the user's password is fewer than 8 octets in length, the password is padded at the end with NULL octets to a length of 8 before it is used as a key.
The ARAP Security AVP (AVP Code 73) is of type Unsigned32 and MAY be present in the AA Answer message if the Framed Protocol AVP (see section 6.10.1)
is set to the value of ARAP, and the Result Code AVP is set to DIAMETER MULTI ROUND AUTH.
See [RADIUSExt] for more information on the format of this AVP.
The ARAP Security AVP (AVP Code 74) is of type OctetString and MAY be present in the AA Request or AA Answer message if the Framed Protocol AVP is set to the value of ARAP, and the Result Code AVP is set to DIAMETER MULTI ROUND AUTH.
This AVP contains the security module challenge or response associated with the ARAP Security Module specified in ARAP Security.
This section contains the authorization AVPs supported in the NAS Application.
The Service Type AVP SHOULD be present in all messages, and, based on its value, additional AVPs defined in this section and in section 7 MAY be present.
Due to space constraints, the short form IPFltrRule is used to represent IPFilterRule, and QoSFltrRule is used for QoSFilterRule.
Y    Login LAT Node    35
Y    Login LAT Port    63
The Service Type AVP (AVP Code 6) is of type Enumerated and contains the type of service the user has requested or the type of service to be provided.
One such AVP MAY be present in an authentication and/or authorization request or response.
A NAS is not required to implement all of these service types.
It MUST treat unknown or unsupported Service Types received in a response as a failure and end the session with a DIAMETER INVALID AVP VALUE Result Code.
When used in a request, the Service Type AVP SHOULD be considered a hint to the server that the NAS believes the user would prefer the kind of service indicated.
The server is not required to honor the hint.
Furthermore, if the service specified by the server is supported, but not compatible with the current mode of access, the NAS MUST fail to start the session.
The NAS MUST also generate the appropriate error message(s).
The following values have been defined for the Service Type AVP.
The complete list of defined values can be found in [RADIUS] and [RADIUSTypes].
The following list is informational: 1  Login 2
Only 9  Callback NAS Prompt 10
Check 11  Callback Administrative 12
Fax 14  Modem Relay 15  IAPP
The user should be connected to a host.
The message MAY include additional AVPs defined in sections 6.16 or 6.17.
The message MAY include additional AVPs defined in section 6.10, or section 7 for tunneling services.
The user should be disconnected and called back, then connected to a host.
The message MAY include additional AVPs defined in this section.
The user should be disconnected and called back, and then a Framed Protocol, such as PPP or SLIP, should be started for the User.
The message MAY include additional AVPs defined in section 6.10, or in section 7 for tunneling services.
The Callback Number AVP (AVP Code 19) is of type UTF8String and contains a dialing string to be used for callback.
It MAY be used in an authentication and/or authorization request as a hint to the server that a Callback service is desired, but the server is not required to honor the hint in the corresponding response.
The codification of this field's allowed usage range is outside the scope of this specification.
AVP (AVP Code 20) is of type UTF8String and contains the name of a place to be called, to be interpreted by the NAS.
This AVP MAY be present in an authentication and/or authorization response.
This AVP is not roaming friendly as it assumes that the Callback Id is configured on the NAS.
Using the Callback Number AVP therefore preferable.
The Idle Timeout AVP (AVP Code 28) is of type Unsigned32 and sets the maximum number of consecutive seconds of idle connection allowable to the user before termination of the session or before a prompt is issued.
The default is none, or system specific.
The Port Limit AVP (AVP Code 62) is of type Unsigned32 and sets the maximum number of ports the NAS provides to the user.
It MAY be used in an authentication and/or authorization request as a hint to the server that multilink PPP [PPPMP] service is desired, but the server is not required to honor the hint in the corresponding response.
The NAS Filter Rule AVP (AVP Code 400) is of type IPFilterRule and provides filter rules that need to be configured on the NAS for the user.
One or more of these AVPs MAY be present in an authorization response.
The Filter Id AVP (AVP Code 11) is of type UTF8String and contains the name of the filter list for this user.
Zero or more Filter I
d AVPs MAY be sent in an authorization answer.
Identifying a filter list by name allows the filter to be used on different NASes without regard to filter list implementation details.
However, this AVP is not roaming friendly, as filter naming differs from one service provider to another.
In non RADIUS environments, it is RECOMMENDED that the NAS Filter  Rule AVP be used instead.
The Configuration Token AVP (AVP Code 78) is of type OctetString and is sent by a Diameter Server to a Diameter Proxy Agent or Translation Agent in an AA Answer command to indicate a type of user profile to be used.
It should not be sent to a Diameter Client (NAS).
The format of the Data field of this AVP is site specific.
The QoS Filter Rule AVP (AVP Code 407) is of type QoSFilterRule and provides QoS filter rules that need to be configured on the NAS for the user.
One or more such AVPs MAY be present in an authorization response.
Note: Due to an editorial mistake in [BASE], only the AVP format is discussed.
The complete QoSFilterRule definition was not included.
It is reprinted here for clarification.
The QosFilterRule format is derived from the OctetString AVP Base Format.
It uses the ASCII charset.
Each packet is evaluated once.
If no rule matches, the packet is treated as best effort.
An access device unable to interpret or apply a QoS rule SHOULD NOT terminate the session.
filters MUST follow the following format: action dir proto from src to dst [options] tag    Mark packet with a specific DSCP [DIFFSERV].
The DSCP option MUST be included.
The metering options MUST be included.
The format is as described under IPFilterRule.
The format is as described under IPFilterRule.
The format is as described under IPFilterRule.
DSCP <color> Color values as defined in [DIFFSERV].
Exact matching of DSCP values is required (no masks or ranges).
metering <rate> <color under> <color over>
The metering option provides Assured Forwarding, as defined in [DIFFSERVAF], and MUST be present if the action is set to meter.
The rate option is the throughput, in bits per second, used by the access device to mark packets.
Traffic over the rate is marked with the color over codepoint, and traffic under the rate is marked with the color under codepoint.
The color under and color over options contain the drop preferences and MUST conform to the recommended codepoint keywords described in [DIFFSERVAF] (e.g., AF13).
The metering option also supports the strict limit on traffic required by Expedited Forwarding, as defined in [DIFFSERVEF].
The color over option may contain the keyword "drop" to prevent forwarding of traffic that exceeds the rate parameter.
The rule syntax is a modified subset of ipfw(8) from FreeBSD, and the ipfw.c code may provide a useful base for implementations.
This section lists the authorization AVPs necessary to support framed access, such as PPP and SLIP.
AVPs defined in this section MAY be present in a message if the Service Type AVP was set to "Framed" or "Callback Framed".
The Framed Protocol AVP (AVP Code 7) is of type Enumerated and contains the framing to be used for framed access.
This AVP MAY be present in both requests and responses.
The supported values are listed in [RADIUSTypes].
The following list is informational: 1  PPP 2  SLIP 3  AppleTalk Remote Access Protocol (ARAP)
Gandalf proprietary SingleLink/MultiLink protocol 5
Framed Routing AVP The Framed Routing AVP (AVP Code 10) is of type Enumerated and contains the routing method for the user when the user is a router to a network.
This AVP SHOULD only be present in authorization responses.
The supported values are listed in [RADIUSTypes].
The following list is informational: 0
None 1  Send routing packets 2  Listen for routing packets 3  Send and Listen 6.10.3.
The Framed MTU AVP (AVP Code 12) is of type Unsigned32 and contains the Maximum Transmission Unit to be configured for the user, when it is not negotiated by some other means (such as PPP).
This AVP SHOULD only be present in authorization responses.
The MTU value MUST be in the range from 64 to 65535.
The Framed Compression AVP (AVP Code 13) is of type Enumerated and contains the compression protocol to be used for the link.
It MAY be used in an authorization request as a hint to the server that a specific compression type is desired, but the server is not required to honor the hint in the corresponding response.
More than one compression protocol AVP MAY be sent.
The NAS is responsible for applying the proper compression protocol to the appropriate link traffic.
The supported values are listed in [RADIUSTypes].
The following list is informational: 0
None 1  VJ TCP/IP header compression 2  IPX header compression 3  Stac LZS compression 6.11.
The AVPs defined in this section are used when the user requests, or is being granted, access service to IP.
The Framed IP Address AVP (AVP Code 8) [RADIUS] is of type OctetString and contains an IPv4 address of the type specified in the attribute value to be configured for the user.
It MAY be used in an authorization request as a hint to the server that a specific address is desired, but the server is not required to honor the hint in the corresponding response.
Two values have special significance: 0xFFFFFFFF and 0xFFFFFFFE.
The value 0xFFFFFFFF indicates that the NAS should allow the user to select an address (i.e., negotiated).
The value 0xFFFFFFFE indicates that the NAS should select an address for the user (e.g., assigned from a pool of addresses kept by the NAS).
The Framed IP Netmask AVP (AVP Code 9) is of type OctetString and contains the four octets of the IPv4 netmask to be configured for the user when the user is a router to a network.
It MAY be used in an authorization request as a hint to the server that a specific netmask is desired, but the server is not required to honor the hint in the corresponding response.
This AVP MUST be present in a response if the request included this AVP with a value of 0xFFFFFFFF.
The Framed Route AVP (AVP Code 22) is of type UTF8String and contains the ASCII routing information to be configured for the user on the NAS.
Zero or more of these AVPs MAY be present in an authorization response.
The string MUST contain a destination prefix in dotted quad form optionally followed by a slash and a decimal length specifier stating how many high order bits of the prefix should be used.
This is followed by a space, a gateway address in dotted quad form, a space, and one or more metrics separated by spaces; for example, "192.168.1.0/24 192.168.1.1 1".
The length specifier may be omitted, in which case it should default to 8 bits for class A prefixes, to 16 bits for class B prefixes, and to 24 bits for class C prefixes; for example, "192.168.1.0 192.168.1.1 1".
Whenever the gateway address is specified as "0.0.0.0" the IP address of the user SHOULD be used as the gateway address.
The Framed Pool AVP (AVP Code 88) is of type OctetString and contains the name of an assigned address pool that SHOULD be used to assign an address for the user.
If a NAS does not support multiple address pools, the NAS SHOULD ignore this AVP.
Address pools are usually used for IP addresses but can be used for other protocols if the NAS supports pools for those protocols.
Although specified as type OctetString for compatibility with RADIUS [RADIUSExt], the encoding of the Data field SHOULD also conform to the rules for the UTF8String Data Format.
AVP (AVP Code 96) is of type Unsigned64 and contains the IPv6 interface identifier to be configured for the user.
It MAY be used in authorization requests as a hint to the server that a specific interface id is desired, but the server is not required to honor the hint in the corresponding response.
The Framed IPv6 Prefix AVP (AVP Code 97) is of type OctetString and contains the IPv6 prefix to be configured for the user.
One or more AVPs MAY be used in authorization requests as a hint to the server that specific IPv6 prefixes are desired, but the server is not required to honor the hint in the corresponding response.
The Framed IPv6 Route AVP (AVP Code 99) is of type UTF8String and contains the ASCII routing information to be configured for the user on the NAS.
Zero or more of these AVPs MAY be present in an authorization response.
The string MUST contain an IPv6 address prefix followed by a slash and a decimal length specifier stating how many high order bits of the prefix should be used.
This is followed by a space, a gateway address in hexadecimal notation, a space, and one or more metrics separated by spaces; for example, "2000:0:0:106::/64 2000::106:
Whenever the gateway address is the IPv6 unspecified address, the IP address of the user SHOULD be used as the gateway address, such as in: "2000:0:0:106::/64 :: 1".
The Framed IPv6 Pool AVP (AVP Code 100) is of type OctetString and contains the name of an assigned pool that SHOULD be used to assign an IPv6 prefix for the user.
If the access device does not support multiple prefix pools, it MUST ignore this AVP.
Although specified as type OctetString for compatibility with RADIUS [RADIUSIPv6], the encoding of the Data field SHOULD also conform to the rules for the UTF8String Data Format.
The AVPs defined in this section are used when the user requests, or is being granted, access to an IPX network service.
The Framed IPX Network AVP (AVP Code 23) is of type Unsigned32 and contains the IPX Network number to be configured for the user.
It MAY be used in an authorization request as a hint to the server that a specific address is desired, but the server is not required to honor the hint in the corresponding response.
Two addresses have special significance: 0xFFFFFFFF and 0xFFFFFFFE.
The value 0xFFFFFFFF indicates that the NAS should allow the user to select an address (i.e., Negotiated).
The value 0xFFFFFFFE indicates that the NAS should select an address for the user (e.g., assign it from a pool of one or more IPX networks kept by the NAS).
The AVPs defined in this section are used when the user requests, or is being granted, access to an AppleTalk network [AppleTalk].
Framed AppleTalk Link AVP The Framed AppleTalk Link AVP (AVP Code 37) is of type Unsigned32 and contains the AppleTalk network number that should be used for the serial link to the user, which is another AppleTalk router.
This AVP MUST only be present in an authorization response and is never used when the user is not another router.
Despite the size of the field, values range from 0 to 65,535.
The special value of 0 indicates an unnumbered serial link.
A value of 1 to 65,535 means that the serial line between the NAS and the user should be assigned that value as an AppleTalk network number.
The Framed AppleTalk Network AVP (AVP Code 38) is of type Unsigned32 and contains the AppleTalk Network number that the NAS should probe to allocate an AppleTalk node for the user.
This AVP MUST only be present in an authorization response and is never used when the user is not another router.
Multiple instances of this AVP indicate that the NAS may probe, using any of the network numbers specified.
Despite the size of the field, values range from 0 to 65,535.
The special value 0 indicates that the NAS should assign a network for the user, using its default cable range.
A value between 1 and 65,535 (inclusive) indicates to the AppleTalk Network that the NAS should probe to find an address for the user.
The Framed AppleTalk Zone AVP (AVP Code 39) is of type OctetString and contains the AppleTalk Default Zone to be used for this user.
This AVP MUST only be present in an authorization response.
Multiple instances of this AVP in the same message are not allowed.
The codification of this field's allowed range is outside the scope of this specification.
The AVPs defined in this section are used when the user requests, or is being granted, access to the AppleTalk network via the AppleTalk Remote Access Protocol [ARAP].
They are only present if the Framed  Protocol AVP (see section 6.10.1) is set to ARAP.
Section 2.2 of RFC 2869
[RADIUSExt] describes the operational use of these attributes.
AVP (AVP Code 71) is of type OctetString and MAY be present in the AA Accept message if the Framed Protocol AVP is set to the value of ARAP.
See [RADIUSExt] for more information about the format of this AVP.
The ARAP Zone Access AVP (AVP Code 72) is of type Enumerated and
MAY be present in the AA Accept message if the Framed Protocol AVP is set to the value of ARAP.
The supported values are listed in [RADIUSTypes] and defined in [RADIUSExt].
Non Framed Access Authorization AVPs
This section contains the authorization AVPs that are needed to support terminal server functionality.
AVPs defined in this section MAY be present in a message if the Service Type AVP was set to "Login" or "Callback Login".
The Login IP Host AVP (AVP Code 14) [RADIUS] is of type OctetString and contains the IPv4 address of a host with which to connect the user when the Login Service AVP is included.
It MAY be used in an AA Request command as a hint to the Diameter Server that a specific host is desired, but the Diameter Server is not required to honor the hint in the AA Answer.
Two addresses have special significance: all ones and 0.
The value of all ones indicates that the NAS SHOULD allow the user to select an address.
The value 0 indicates that the NAS SHOULD select a host to connect the user to.
The Login IPv6 Host AVP (AVP Code 98)
[RADIUSIPv6] is of type OctetString and contains the IPv6 address of a host with which to connect the user when the Login Service AVP is included.
It MAY be used in an AA Request command as a hint to the Diameter Server that a specific host is desired, but the Diameter Server is not required to honor the hint in the AA Answer.
Two addresses have special significance: 0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF and 0.
The value 0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF indicates that the NAS SHOULD allow the user to select an address.
The value 0 indicates that the NAS SHOULD select a host to connect the user to.
The Login Service AVP (AVP Code 15) is of type Enumerated and contains the service that should be used to connect the user to the login host.
This AVP SHOULD only be present in authorization responses.
The supported values are listed in [RADIUSTypes].
The following list is informational: 0  Telnet 1  Rlogin 2  TCP Clear 3  PortMaster (proprietary)
X25 T3POS 8  TCP Clear Quiet
(suppresses any NAS generated connect string)
The AVPs described in this section MAY be present if the Login  Service AVP is set to Telnet, Rlogin, TCP Clear, or TCP Clear Quiet.
The Login TCP Port AVP (AVP Code 16) is of type Unsigned32 and contains the TCP port with which the user is to be connected when the Login Service AVP is also present.
This AVP SHOULD only be present in authorization responses.
The value MUST NOT be greater than 65,535.
The AVPs described in this section MAY be present if the Login  Service AVP is set to LAT [LAT].
The Login LAT Service AVP (AVP Code 34) is of type OctetString and contains the system with which the user is to be connected by LAT.
It MAY be used in an authorization request as a hint to the server that a specific service is desired, but the server is not required to honor the hint in the corresponding response.
This AVP MUST only be present in the response if the Login Service AVP states that LAT is desired.
Administrators use this service attribute when dealing with clustered systems, such as a VAX or Alpha cluster.
In these environments, several different time sharing hosts share the same resources (disks, printers, etc.), and administrators often configure each host to offer access (service) to each of the shared resources.
In this case, each host in the cluster advertises its services through LAT broadcasts.
Sophisticated users often know which service providers (machines) are faster and tend to use a node name when initiating a LAT connection.
Some administrators want particular users to use certain machines as a primitive form of load balancing (although LAT knows how to do load balancing itself).
The String field contains the identity of the LAT service to use.
The LAT Architecture allows this string to contain $ (dollar), (hyphen), .
(underscore), numerics, upper  and lowercase alphabetics, and the ISO Latin 1 character set extension [ISOLatin].
All LAT string comparisons are case insensitive.
The Login LAT Node AVP (AVP Code 35) is of type OctetString and contains the Node with which the user is to be automatically connected by LAT.
It MAY be used in an authorization request as a hint to the server that a specific LAT node is desired, but the server is not required to honor the hint in the corresponding response.
This AVP MUST only be present in a response if the Login  Service Type AVP is set to LAT.
The String field contains the identity of the LAT service to use.
The LAT Architecture allows this string to contain $ (dollar), (hyphen), .
(underscore), numerics, upper  and lowercase alphabetics, and the ISO Latin 1 character set extension [ISOLatin].
All LAT string comparisons are case insensitive.
The Login LAT Group AVP (AVP Code 36) is of type OctetString and contains a string identifying the LAT group codes this user is authorized to use.
It MAY be used in an authorization request as a hint to the server that a specific group is desired, but the server is not required to honor the hint in the corresponding response.
This AVP MUST only be present in a response if the Login Service Type AVP is set to LAT.
LAT supports 256 different group codes, which LAT uses as a form of access rights.
LAT encodes the group codes as a 256 bit bitmap.
Administrators can assign one or more of the group code bits at the LAT service provider; it will only accept LAT connections that have these group codes set in the bitmap.
The administrators assign a bitmap of authorized group codes to each user.
LAT gets these from the operating system and uses them in its requests to the service providers.
The codification of the range of allowed usage of this field is outside the scope of this specification.
The Login LAT Port AVP (AVP Code 63) is of type OctetString and contains the Port with which the user is to be connected by LAT.
It MAY be used in an authorization request as a hint to the server that a specific port is desired, but the server is not required to honor the hint in the corresponding response.
This AVP MUST only be present in a response if the Login Service Type AVP is set to LAT.
The String field contains the identity of the LAT service to use.
The LAT Architecture allows this string to contain $ (dollar), (hyphen), .
(underscore), numerics, upper  and lower case alphabetics, and the ISO Latin 1 character set extension [ISOLatin].
All LAT string comparisons are case insensitive.
Some NASes support compulsory tunnel services in which the incoming connection data is conveyed by an encapsulation method to a gateway elsewhere in the network.
This is typically transparent to the service user, and the tunnel characteristics may be described by the remote AAA server, based on the user's authorization information.
Several tunnel characteristics may be returned, and the NAS implementation may choose one [RADTunnels], [RADTunlAcct].
The Tunneling AVP (AVP Code 401) is of type Grouped and contains the following AVPs, used to describe a compulsory tunnel service: [RADTunnels], [RADTunlAcct].
Its data field has the following ABNF grammar:
[ Tunnel Client Auth Id ]
[ Tunnel Server Auth Id ]
[ Tunnel Assignment Id ]
The Tunnel Type AVP (AVP Code 64) is of type Enumerated and contains the tunneling protocol(s) to be used (in the case of a tunnel initiator) or in use (in the case of a tunnel terminator).
It MAY be used in an authorization request as a hint to the server that a specific tunnel type is desired, but the server is not required to honor the hint in the corresponding response.
The Tunnel Type AVP SHOULD also be included in Accounting Request messages.
A tunnel initiator is not required to implement any of these tunnel types.
If a tunnel initiator receives a response that contains only unknown or unsupported Tunnel Types, the tunnel initiator MUST behave as though a response were received with the Result Code indicating a failure.
The supported values are listed in [RADIUSTypes].
The following list is informational: 1  Point to Point Tunneling Protocol (PPTP) 2
Ascend Tunnel Management Protocol (ATMP) 5  Virtual Tunneling Protocol (VTP)
IP Authentication Header in the Tunnel mode (AH)
7  IP in IP Encapsulation (IP IP)
Minimal IP in IP Encapsulation (MIN IP IP)
IP Encapsulating Security Payload in the Tunnel mode (ESP)
10  Generic Route Encapsulation (GRE)
11  Bay Dial Virtual Services (DVS)
12  IP in IP Tunneling 13  Virtual LANs (VLAN)
The Tunnel Medium Type AVP (AVP Code 65) is of type Enumerated and contains the transport medium to use when creating a tunnel for protocols (such as L2TP) that can operate over multiple transports.
It MAY be used in an authorization request as a hint to the server that a specific medium is desired, but the server is not required to honor the hint in the corresponding response.
The supported values are listed in [RADIUSTypes].
The following list is informational: 1  IPv4 (IP version 4)
IPv6 (IP version 6) 3  NSAP 4  HDLC (8 bit multidrop)
BBN 1822 6  802 (includes all 802 media plus Ethernet "canonical format")
8  E.164 (SMDS, Frame Relay, ATM)
IPX 12  Appletalk 13  Decnet IV 14  Banyan Vines 15  E.164 with NSAP format subaddress 7.4.
AVP The Tunnel Client Endpoint AVP (AVP Code 66) is of type UTF8String and contains the address of the initiator end of the tunnel.
It MAY be used in an authorization request as a hint to the server that a specific endpoint is desired, but the server is not required to honor the hint in the corresponding response.
This AVP SHOULD be included in the corresponding Accounting Request messages, in which case it indicates the address from which the tunnel was initiated.
This AVP, along with the Tunnel Server  Endpoint and Session
AVP [BASE], MAY be used to provide a globally unique means to identify a tunnel for accounting and auditing purposes.
If Tunnel Medium Type is IPv4 (1), then this string is either the fully qualified domain name (FQDN) of the tunnel client machine, or a "dotted decimal" IP address.
Implementations MUST support the dotted decimal format and SHOULD support the FQDN format for IP addresses.
If Tunnel Medium Type is IPv6 (2), then this string is either the FQDN of the tunnel client machine, or a text representation of the address in either the preferred or alternate form [IPv6Addr].
Conforming implementations MUST support the preferred form and SHOULD support both the alternate text form and the FQDN format for IPv6 addresses.
If Tunnel Medium Type is neither IPv4 nor IPv6, then this string is a tag referring to configuration data local to the Diameter client that describes the interface or medium specific client address to use.
The Tunnel Server Endpoint AVP (AVP Code 67) is of type UTF8String and contains the address of the server end of the tunnel.
It MAY be used in an authorization request as a hint to the server that a specific endpoint is desired, but the server is not required to honor the hint in the corresponding response.
This AVP SHOULD be included in the corresponding Accounting Request messages, in which case it indicates the address from which the tunnel was initiated.
This AVP, along with the Tunnel Client  Endpoint and Session
AVP [BASE], MAY be used to provide a globally unique means to identify a tunnel for accounting and auditing purposes.
If Tunnel Medium Type is IPv4 (1), then this string is either the fully qualified domain name (FQDN) of the tunnel server machine, or a "dotted decimal" IP address.
Implementations MUST support the dotted decimal format and SHOULD support the FQDN format for IP addresses.
If Tunnel Medium Type is IPv6 (2), then this string is either the FQDN of the tunnel server machine, or a text representation of the address in either the preferred or alternate form [IPv6Addr].
Implementations MUST support the preferred form and SHOULD support both the alternate text form and the FQDN format for IPv6 addresses.
If Tunnel Medium Type is not IPv4 or IPv6, this string is a tag referring to configuration data local to the Diameter client that describes the interface or medium specific server address to use.
The Tunnel Password AVP (AVP Code 69) is of type OctetString and may contain a password to be used to authenticate to a remote server.
The Tunnel Password AVP contains sensitive information.
This value is not protected in the same manner as RADIUS [RADTunnels].
As required in [BASE], Diameter messages are encrypted by using IPsec or TLS.
The Tunnel Password AVP SHOULD NOT be used in untrusted proxy environments without encrypting it by using end to end security techniques, such as CMS Security [DiamCMS].
AVP (AVP Code 81) is of type OctetString and contains the group Id for a particular tunneled session.
The Tunnel Private Group Id AVP MAY be included in an authorization request if the tunnel initiator can predetermine the group resulting from a particular connection.
It SHOULD be included in the authorization response if this tunnel session is to be treated as belonging to a particular private group.
Private groups may be used to associate a tunneled session with a particular group of users.
For example, it MAY be used to facilitate routing of unregistered IP addresses through a particular interface.
This AVP SHOULD be included in the Accounting Request messages that pertain to the tunneled session.
The Tunnel Assignment Id AVP
(AVP Code 82) is of type OctetString and is used to indicate to the tunnel initiator the particular tunnel to which a session is to be assigned.
Some tunneling protocols, such as [PPTP] and [L2TP], allow for sessions between the same two tunnel endpoints to be multiplexed over the same tunnel and also for a given session to use its own dedicated tunnel.
This attribute provides a mechanism for Diameter to inform the tunnel initiator (e.g., PAC, LAC) whether to assign the session to a multiplexed tunnel or to a separate tunnel.
Furthermore, it allows for sessions sharing multiplexed tunnels to be assigned to different multiplexed tunnels.
A particular tunneling implementation may assign differing characteristics to particular tunnels.
For example, different tunnels may be assigned different QoS parameters.
Such tunnels may be used to carry either individual or multiple sessions.
Id attribute thus allows the Diameter server to indicate that a particular session is to be assigned to a tunnel providing an appropriate level of service.
It is expected that any QoS related Diameter tunneling attributes defined in the future accompanying this one will be associated by the tunnel initiator with the Id given by this attribute.
In the meantime, any semantic given to a particular I
d string is a matter left to local configuration in the tunnel initiator.
AVP is of significance only to Diameter and the tunnel initiator.
it specifies is only intended to be of local use to Diameter and the tunnel initiator.
The Id assigned by the tunnel initiator is not conveyed to the tunnel peer.
This attribute MAY be included in authorization responses.
The tunnel initiator receiving this attribute MAY choose to ignore it and to assign the session to an arbitrary multiplexed or non multiplexed tunnel between the desired endpoints.
This AVP SHOULD also be included in the Accounting Request messages pertaining to the tunneled session.
If a tunnel initiator supports the Tunnel Assignment
AVP, then it should assign a session to a tunnel in the following manner:  If this AVP is present and a tunnel exists between the specified endpoints with the specified Id, then the session should be assigned to that tunnel.
If this AVP is present and no tunnel exists between the specified endpoints with the specified Id, then a new tunnel should be established for the session and the specified Id should be associated with the new tunnel.
If this AVP is not present, then the session is assigned to an unnamed tunnel.
If an unnamed tunnel does not yet exist between the specified endpoints, then it is established and used for this session and for subsequent ones established without the Tunnel Assignment
A tunnel initiator MUST NOT assign a session for which a Tunnel Assignment
Id AVP was not specified to a named tunnel (i.e., one that was initiated by a session specifying this AVP).
Note that the same Id may be used to name different tunnels if these tunnels are between different endpoints.
The Tunnel Preference AVP (AVP Code 83) is of type Unsigned32 and is used to identify the relative preference assigned to each tunnel when more than one set of tunneling AVPs is returned within separate Grouped AVP AVPs.
It MAY be used in an authorization request as a hint to the server that a specific preference is desired, but the server is not required to honor the hint in the corresponding response.
For example, suppose that AVPs describing two tunnels are returned by the server, one with a Tunnel Type of PPTP and the other with a Tunnel Type of L2TP.
If the tunnel initiator supports only one of the Tunnel Types returned, it will initiate a tunnel of that type.
If, however, it supports both tunnel protocols, it SHOULD use the value of the Tunnel Preference AVP to decide which tunnel should be started.
The tunnel with the lowest numerical value in the Value field of this AVP SHOULD be given the highest preference.
The values assigned to two or more instances of the Tunnel Preference AVP within a given authorization response MAY be identical.
In this case, the tunnel initiator SHOULD use locally configured metrics to decide which set of AVPs to use.
The Tunnel Client Auth I
AVP (AVP Code 90) is of type UTF8String and specifies the name used by the tunnel initiator during the authentication phase of tunnel establishment.
It MAY be used in an authorization request as a hint to the server that a specific preference is desired, but the server is not required to honor the hint in the corresponding response.
This AVP MUST be present in the authorization response if an authentication name other than the default is desired.
This AVP SHOULD be included in the Accounting  Request messages pertaining to the tunneled session.
AVP (AVP Code 91) is of type UTF8String and specifies the name used by the tunnel terminator during the authentication phase of tunnel establishment.
It MAY be used in an authorization request as a hint to the server that a specific preference is desired, but the server is not required to honor the hint in the corresponding response.
This AVP MUST be present in the authorization response if an authentication name other than the default is desired.
This AVP SHOULD be included in the Accounting  Request messages pertaining to the tunneled session.
NAS Accounting Applications implementing this specification use Diameter Accounting, as defined in [BASE], and the AVPs in the following section.
Service specific AVP usage is defined in the tables in section 10.
If accounting is active, Accounting Request (ACR) messages SHOULD be sent after the completion of any Authentication or Authorization transaction and at the end of a Session.
The Accounting Record Type value indicates the type of event.
All other AVPs identify the session and provide additional information relevant to the event.
The successful completion of the first Authentication or Authorization transaction SHOULD cause a START RECORD to be sent.
If additional Authentications or Authorizations occur in later transactions, the first exchange should generate a START RECORD, and the later an INTERIM RECORD.
For a given session, there MUST only be one set of matching START and STOP records, with any number of INTERIM RECORDS in between, or one EVENT RECORD indicating the reason a session wasn't started.
The following table describes the AVPs; their AVP Code values, types, and possible flag values; and whether the AVP MAY be encrypted.
The Accounting Input Octets AVP (AVP Code 363) is of type Unsigned64 and contains the number of octets received from the user.
For NAS usage, this AVP indicates how many octets have been received from the port in the course of this session.
It can only be present in ACR messages with an Accounting Record Type of INTERIM RECORD or STOP RECORD.
The Accounting Output Octets AVP (AVP Code 364) is of type Unsigned64 and contains the number of octets sent to the user.
For NAS usage, this AVP indicates how many octets have been sent to the port in the course of this session.
It can only be present in ACR messages with an Accounting Record Type of INTERIM RECORD or STOP RECORD.
The Accounting Input Packets (AVP Code 365) is of type Unsigned64 and contains the number of packets received from the user.
For NAS usage, this AVP indicates how many packets have been received from the port over the course of a session being provided to a Framed User.
It can only be present in ACR messages with an Accounting  Record Type of INTERIM RECORD or STOP RECORD.
The Accounting Output Packets (AVP Code 366) is of type Unsigned64 and contains the number of IP packets sent to the user.
For NAS usage, this AVP indicates how many packets have been sent to the port over the course of a session being provided to a Framed User.
It can only be present in ACR messages with an Accounting  Record Type of INTERIM RECORD or STOP RECORD.
The Acct Session Time AVP (AVP Code 46) is of type Unsigned32 and indicates the length of the current session in seconds.
It can only be present in ACR messages with an Accounting Record Type of INTERIM RECORD or STOP RECORD.
The Acct Authentic AVP (AVP Code 45) is of type Enumerated and specifies how the user was authenticated.
The supported values are listed in [RADIUSTypes].
The following list is informational: 1
RADIUS 2  Local 3  Remote 4  Diameter 8.7.
The Accounting Auth Method AVP (AVP Code 406) is of type Enumerated.
A NAS MAY include this AVP in an Accounting Request message to indicate the method used to authenticate the user.
(Note that this is equivalent to the RADIUS MS Acct Auth Type VSA attribute).
The following values are defined: 1  PAP 2  CHAP 3  MS CHAP 1 4  MS CHAP 2 5  EAP 7  None 8.8.
The Acct Delay Time AVP (AVP Code 41) is of type Unsigned32 and indicates the number of seconds the Diameter client has been trying to send the Accounting Request (ACR).
The accounting server may subtract this value from the time when the ACR arrives at the server to calculate the approximate time of the event that caused the ACR to be generated.
This AVP is not used for retransmissions at the transport level (TCP or SCTP).
Rather, it may be used when an ACR command cannot be transmitted because there is no appropriate peer to transmit it to or was rejected because it could not be delivered.
In these cases, the command MAY be buffered and transmitted later, when an appropriate peer connection is available or after sufficient time has passed that the destination host may be reachable and operational.
If the ACR is resent in this way, the Acct Delay Time AVP SHOULD be included.
The value of this AVP indicates the number of seconds that elapsed between the time of the first attempt at transmission and the current attempt.
The Acct Link Count AVP (AVP Code 51) is of type Unsigned32 and indicates the total number of links that have been active (current or closed) in a given multilink session at the time the accounting record is generated.
This AVP MAY be included in Accounting Requests for any session that may be part of a multilink service.
The Acct Link Count AVP may be used to make it easier for an accounting server to know when it has all the records for a given multilink service.
When the number of Accounting Requests received with Accounting Record Type   STOP RECORD and with the same Acct  Multi Session Id and unique Session Ids equals the largest value of Acct Link Count seen in those Accounting Requests, all STOP RECORD Accounting Requests for that multilink service have been received.
The following example, showing eight Accounting Requests, illustrates how the Acct Link Count AVP is used.
In the table below, only the relevant AVPs are shown, although additional AVPs containing accounting information will be present in the Accounting Requests.
The Acct Tunnel Connection AVP (AVP Code 68) is of type OctetString and contains the identifier assigned to the tunnel session.
This AVP, along with the Tunnel Client Endpoint and Tunnel Server Endpoint AVPs, may be used to provide a means to uniquely identify a tunnel session for auditing purposes.
The format of the identifier in this AVP depends upon the value of the Tunnel Type AVP.
For example, to identify an L2TP tunnel connection fully, the L2TP Tunnel Id and Call Id might be encoded in this field.
The exact encoding of this field is implementation dependent.
Acct Tunnel Packets Lost AVP
The Acct Tunnel Packets Lost AVP (AVP Code 86) is of type Unsigned32 and contains the number of packets lost on a given link.
This section describes some basic guidelines that servers acting as AAA Translation Agents may use.
A complete description of all the differences between RADIUS and Diameter is beyond the scope of this section and document.
Note that this document does not restrict implementations from creating additional translation methods, as long as the translation function doesn't violate the RADIUS or the Diameter protocols.
Although the Diameter protocol is in many ways a superset of RADIUS functions, a number of RADIUS representations are not allowed, so that new capabilities can be used without the old problems.
There are primarily two different situations that must be handled: one in which a RADIUS request is received that must be forwarded as a Diameter request, and another in which the inverse is true.
RADIUS does not support a peer to peer architecture, and server initiated operations are generally not supported.
See [RADDynAuth] for an alternative.
Some RADIUS attributes are encrypted.
RADIUS security and encryption techniques are applied on a hop per hop basis.
A Diameter agent will have to decrypt RADIUS attribute data entering the Diameter system, and if that information is forwarded, the agent MUST secure it by using Diameter specific techniques.
Note that this section uses the two terms, "AVP" and "attribute", in a concise and specific manner.
The former is used to signify a Diameter AVP, and the latter to signify a RADIUS attribute.
RADIUS Request Forwarded as Diameter Request
This section describes the actions that should be taken when a Translation Agent receives a RADIUS message to be translated to a Diameter message.
Note that RADIUS servers are assumed to be stateless.
It is also quite possible for the RADIUS messages that comprise the session (i.e., authentication and accounting messages) to be handled by different Translation Agents in the proxy network.
Therefore, a RADIUS/Diameter Translation Agent SHOULD NOT be assumed to have an accurate track on session state information.
When a Translation Agent receives a RADIUS message, the following steps should be taken:  If a Message Authenticator attribute is present, the value MUST be checked but not included in the Diameter message.
If it is incorrect, the RADIUS message should be silently discarded.
The gateway system SHOULD generate and include a Message  Authenticator in returned RADIUS responses.
The transport address of the sender MUST be checked against the NAS identifying attributes.
See the description of NAS  Identifier and NAS IP Address below.
The Translation Agent must maintain transaction state information relevant to the RADIUS request, such as the Identifier field in the RADIUS header, any existing RADIUS Proxy State attribute, and the source IP address and port number of the UDP packet.
These may be maintained locally in a state table or saved in a Proxy Info AVP group.
A Diameter Session Id AVP value must be created using a session state mapping mechanism.
If the RADIUS request contained a State attribute and the prefix of the data is "Diameter/", the data following the prefix contains the Diameter Origin Host/Origin Realm/Session
If no such attributes are present and the RADIUS command is an Access Request, a new Session Id is created.
Id is included in the Session
The Diameter Origin Host and Origin Realm AVPs MUST be created and added by using the information from an FQDN corresponding to the NAS IP Address attribute (preferred if available), and/or to the NAS Identifier attribute.
(Note that the RADIUS NAS Identifier is not required to be an FQDN.)
an Origin AAA Protocol AVP added, indicating the protocol of origin of the message.
The Proxy Info group SHOULD be added, with the local server's identity specified in the Proxy Host AVP.
This should ensure that the response is returned to this system.
The Destination Realm AVP is created from the information found in the RADIUS User Name attribute.
If the RADIUS User Password attribute is present, the password must be unencrypted by using the link's RADIUS
The unencrypted value must be forwarded in a User Password AVP using Diameter security.
If the RADIUS CHAP Password attribute is present, the Ident and Data portion of the attribute are used to create the CHAP Auth grouped AVP.
If the RADIUS message contains an address attribute, it MUST be converted to the appropriate Diameter AVP and type.
If the RADIUS message contains Tunnel information [RADTunnels], the attributes or tagged groups should each be converted to a Diameter Tunneling Grouped AVP set.
If the tunnel information contains a Tunnel Password attribute, the RADIUS encryption must be resolved, and the password forwarded, by using Diameter security methods.
If the RADIUS message received is an Accounting Request, the Acct Status Type attribute value must be converted to a Accounting Record Type AVP value.
If the Acct Status Type attribute value is STOP, the local server MUST issue a Session Termination Request message once the Diameter Accounting Answer message has been received.
If the Accounting message contains an Acct Termination Cause attribute, it should be translated to the equivalent Termination Cause AVP value.
If the RADIUS message contains the Accounting Input Octets, Accounting Input Packets, Accounting Output Octets, or Accounting Output Packets, these attributes must be converted to the Diameter equivalents.
Further, if the Acct Input  Gigawords or Acct Output Gigawords attributes are present, these must be used to properly compute the Diameter accounting AVPs.
The corresponding Diameter response is always guaranteed to be received by the same Translation Agent that translated the original request, due to the contents of the Proxy Info AVP group in the Diameter request.
The following steps are applied to the response message during the Diameter to RADIUS translation:  If the Diameter Command Code is set to AA Answer and the Result Code AVP is set to DIAMETER MULTI ROUND AUTH, the gateway must send a RADIUS Access Challenge.
This must have the Origin Host, Origin Realm, and Diameter Session
This is necessary to ensure that the Translation Agent receiving the subsequent RADIUS Access  Request will have access to the Session Identifier and be able to set the Destination Host to the correct value.
If the Multi Round Time Out AVP is present, the value of the AVP MUST be inserted in the RADIUS Session Timeout AVP.
If the Command Code is set to AA Answer, the Diameter Session
AVP is saved in a new RADIUS Class attribute whose format consists of the string "Diameter/" followed by the Diameter Session Identifier.
This will ensure that the subsequent Accounting messages, which could be received by any Translation Agent, would have access to the original Diameter Session Identifier.
If a Proxy State attribute was present in the RADIUS request, the same attribute is added in the response.
This information may be found in the Proxy Info AVP group, or in a local state table.
If state information regarding the RADIUS request was saved in a Proxy Info AVP or local state table, the RADIUS Identifier and UDP IP Address and port number are extracted and used in issuing the RADIUS reply.
When translating a Diameter AA Answer (with successful result code) to RADIUS Access Accept that contains a Session Timeout or Authorization Lifetime AVP, take the following steps:  If the Diameter message contains a Session Timeout AVP but no Authorization Lifetime AVP, translate it to a Session Timeout attribute (not a Termination Action).
If the Diameter message contains an Authorization Lifetime AVP but no Session Timeout AVP, translate it to a Session Timeout attribute and a Termination Action set to AA REQUEST.
(Remove Authorization Lifetime and Re Auth Request Type.)
If the Diameter message has both, the Session Timeout must be greater than or equal to the Authorization Lifetime (required by [BASE]).
Translate it to a Session Timeout value (with value from Authorization Lifetime AVP, the smaller one) and with the Termination Action set to AA REQUEST.
(Remove the Authorization Lifetime and Re Auth Request Type.)
A Diameter/RADIUS gateway may communicate with a server that implements RADIUS Dynamic Authorization [RADDynAuth].
If the server supports these functions, it MUST be listening on the assigned port and would receive RADIUS CoA Request and Disconnect Request messages.
These can be mapped into the Diameter Re Auth Request (RAR) and Abort Session Request (ASR) message exchanges, respectively [BASE].
If the [RADDynAuth] is not supported, the port would not be active and the RADIUS server would receive an ICMP Port Unreachable indication.
Alternatively, if the messages are received but with an inappropriate Service Type, the gateway can respond with the appropriate NAK message and an Error Cause attribute with the value of 405, "Unsupported Service".
The RADIUS CoA Request and Disconnect Request messages will not contain
a Diameter Session Id.  Diameter requires that this value match an active session context.
The gateway MUST have a session
Id cache (or other means) to identify the sessions these functions pertain to.
If unable to identify the session, the gateway (or NAS) should return an Error Cause value 503, "Session Context Not Found".
The RADIUS CoA Request message only supports a change of authorization attributes, and the received CoA Request SHOULD include a Service Type of "Authorize Only".
This indicates an extended exchange request by the rules given in [RADDynAuth] section 3.2, note 6.
This is the only type of exchange supported by Diameter [BASE].
For the CoA Request, the translated RAR message will have a Re Auth  Type of AUTHORIZE ONLY.
The returned RAA will be translated into a CoA NAK with Error Cause "Request Initiated".
The gateway's Diameter client SHOULD also start a reauthorization sequence by sending an AAR message, which will be translated into an Access Request message.
The RADIUS server will use the Access Accept (or Access Reject) message to convey the new authorization attributes, which the gateway will pass back in an AAA message.
Any attributes included in the COA Request or Access Accept message are to be considered mandatory in Diameter.
If they cannot be supported, they MUST result in an error message return to the RADIUS server, with an Error Cause of "Unsupported Attribute".
The Diameter NAS will attempt to apply all the attributes supplied in the AA message to the session.
A RADIUS Disconnect Request message received by the gateway would be translated to a Diameter Abort Session Request (ASR) message [BASE].
The results will be returned by the Diameter client in an Abort  Session Answer (ASA) message.
A success indication would translate to a RADIUS Disconnect ACK, and a failure would generate a Disconnect NAK.
Diameter Request Forwarded as RADIUS Request
When a server receives a Diameter request to be forwarded to a RADIUS entity, the following are examples of the steps that may be taken:
The Origin Host AVP's value is inserted into the NAS Identifier attribute.
The following information MUST be present in the corresponding Diameter response and therefore MUST be saved, either in a local state table or encoded in a RADIUS Proxy State attribute: 1.
Any other AVP that MUST be present in the response and has no corresponding RADIUS attribute.
If the CHAP Auth AVP is present, the grouped AVPs are used to create the RADIUS CHAP Password attribute data.
If the User Password AVP is present, the data should be encrypted and forwarded by using RADIUS rules.
The same is true for any other RADIUS encrypted attribute values.
Address must be translated to the corresponding RADIUS attribute.
If the Accounting Input Octets, Accounting Input Packets, Accounting Output Octets, or Accounting Output Packets AVPs are present, they must be translated to the corresponding RADIUS attributes.
If the value of the Diameter AVPs do not fit within a 32 bit RADIUS attribute, the RADIUS Acct Input  Gigawords and Acct Output Gigawords must be used.
If the RADIUS link supports the Message Authenticator attribute [RADIUSExt], it SHOULD be generated and added to the request.
When the corresponding response is received by the Translation Agent, which is guaranteed in the RADIUS protocol, the following steps may be taken:  If the RADIUS code is set to Access Challenge, a Diameter AA  Answer message is created with the Result Code set to DIAMETER MULTI ROUND AUTH.
If the Session Timeout AVP is present in the RADIUS message, its value is inserted into the Multi Round Time Out AVP.
If a Proxy State attribute is present, extract the encoded information; otherwise, retrieve the original Proxy Info AVP group information from the local state table.
The response's Origin Host information is created from the FQDN of the RADIUS message's source IP address.
The same FQDN is also stored to a Route Record AVP.
The response's Destination Host AVP is copied from the saved request's Origin Host information.
Id information can be recovered from local state, or from the constructed State or Proxy State attribute, as above.
If a Proxy Info AVP was present in the request, the same AVP MUST be added to the response.
If the RADIUS State attributes are present, they must be present in the Diameter response, minus those added by the gateway.
Any other AVPs that were saved at request time, and that MUST be present in the response, are added to the message.
When translating a RADIUS Access Accept to Diameter AA Answer that contains a Session Timeout attribute, do the following:  If the RADIUS message contains a Session Timeout attribute and a Termination Action attribute set to DEFAULT (or no Termination Action attribute at all), translate it to AA Answer with a Session Timeout AVP and remove the Termination Action attribute.
If the RADIUS message contains a Session Timeout attribute and a Termination Action attribute set to AA REQUEST, translate it to AA Answer with Authorization Lifetime AVP and with Re Auth  Request Type set to AUTHORIZE AUTHENTICATE and remove the Session Timeout attribute.
A RADIUS/Diameter gateway communicating with a RADIUS client that implements RADIUS Dynamic Authorization [RADDynAuth] may translate Diameter Re
Auth Request (RAR) messages and Abort Session Request (ASR) messages [BASE] into RADIUS CoA Request and Disconnect Request messages respectively.
If the RADIUS client does not support the capability, the gateway will receive an ICMP Port Unreachable indication when it transmits the RADIUS message.
Even if the NAS supports [RADDynAuth], it may not support the Service Type in the request message.
In this case it will respond with a NAK message and (optionally) an Error Cause attribute with value 405, "Unsupported Service".
If the gateway encounters these error conditions, or if it does not support [RADDynAuth], it sends a Diameter Answer message with an Result Code AVP of "DIAMETER COMMAND UNSUPPORTED" to the AAA server.
When encoding the RADIUS messages, the gateway MUST include the Diameter Session ID in the RADIUS State attribute value, as mentioned above.
The RADIUS client should return it in the response.
A Diameter Re Auth Request (RAR) message [BASE] received by the gateway will be translated into a RADIUS CoA Request and sent to the RADIUS client.
The RADIUS client should respond with a CoA ACK or CoA NAK message, which the gateway should translate into a Re Auth  Answer (RAA) message.
If the gateway receives a RADIUS CoA NAK response containing a Service Type Attribute with value "Authorize Only" and an Error Cause Attribute with value
"Request Initiated", this indicates an extended exchange request per [RADDynAuth] section 3.2, note 6.
The response is translated to a Diameter Re Auth Answer (RAA) with a Result Code AVP of "DIAMETER LIMITED SUCCESS" sent to the AAA server.
Subsequently, the gateway should receive a RADIUS Access Request from the NAS, with a Service Type of "Authorize Only".
This is translated into a Diameter AA Request with an Auth Request Type AVP of AUTHORIZE ONLY and sent to the AAA server.
The AAA server will then reply with a Diameter AA Answer, which is translated into a RADIUS Access Accept or Access Reject, depending on the value of the Result Code AVP.
A Diameter Abort Session Request (ASR) message [BASE] received by the gateway will be translated into a RADIUS Disconnect Request and sent to the RADIUS client.
The RADIUS client should respond with a Disconnect ACK or Disconnect NAK message, which the gateway should translate into an Abort Session Answer (ASA) message.
If the gateway receives a RADIUS Disconnect NAK response containing a Service Type Attribute with value "Authorize Only" and an Error Cause Attribute with value "Request Initiated", the Disconnect NAK response is translated into a Diameter Abort Session Answer (ASA) with a Result Code AVP of "DIAMETER LIMITED SUCCESS" sent to the AAA server.
Subsequently, the gateway should receive a RADIUS Access Request from the NAS, with a Service Type of "Authorize Only".
This is translated into a Diameter AA Request with an Auth Request Type AVP of AUTHORIZE ONLY and sent to the AAA server.
The AAA server will then reply with a Diameter AA Answer, which is translated into a RADIUS Access Accept or Access Reject, depending on the value of the Result Code AVP.
AVPs Used Only for Compatibility The AVPs defined in this section
SHOULD only be used for backwards compatibility when a Diameter/RADIUS translation function is invoked and are not typically originated by Diameter systems during normal operations.
The NAS Identifier AVP (AVP Code 32) [RADIUS] is of type UTF8String and contains the identity of the NAS providing service to the user.
This AVP SHOULD only be added by a RADIUS/Diameter Translation Agent.
When this AVP is present, the Origin Host AVP identifies the NAS providing service to the user.
In RADIUS it would be possible for a rogue NAS to forge the NAS  Identifier attribute.
Diameter/RADIUS translation agents SHOULD attempt to check a received NAS Identifier attribute against the source address of the RADIUS packet, by doing an A/AAAA RR query.
If the NAS Identifier attribute contains an FQDN, then such a query would resolve to an IP address matching the source address.
However, the NAS Identifier attribute is not required to contain an FQDN, so such a query could fail.
If it fails, an error should be logged, but no action should be taken, other than a reverse lookup on the source address and insert the resulting FQDN into the Route Record AVP.
Diameter agents and servers SHOULD check whether a NAS Identifier AVP corresponds to an entry in the Route Record AVP.
If no match is found, then an error is logged, but no other action is taken.
The NAS IP Address AVP (AVP Code 4)
[RADIUS] is of type OctetString and contains the IP Address of the NAS providing service to the user.
This AVP SHOULD only be added by a RADIUS/Diameter Translation Agent.
When this AVP is present, the Origin Host AVP identifies the NAS providing service to the user.
In RADIUS it would be possible for a rogue NAS to forge the NAS IP  Address attribute value.
Diameter/RADIUS translation agents MUST check a received NAS IP Address or NAS IPv6 Address attribute against the source address of the RADIUS packet.
If they do not match and the Diameter/RADIUS translation agent does not know whether the packet was sent by a RADIUS proxy or NAS (e.g., no Proxy State attribute), then by default it is assumed that the source address corresponds to a RADIUS proxy, and that the NAS Address is behind that proxy, potentially with some additional RADIUS proxies in between.
The Diameter/RADIUS translation agent MUST insert entries in the Route Record AVP corresponding to the apparent route.
This implies doing a reverse lookup on the source address and NAS IP  Address or NAS IPv6 Address
attributes to determine the corresponding FQDNs.
If the source address and the NAS IP Address or NAS IPv6 Address do not match, and the Diameter/RADIUS translation agent knows that it is talking directly to the NAS (e.g., there are no RADIUS proxies between it and the NAS), then the error should be logged, and the packet MUST be discarded.
Diameter agents and servers MUST check whether the NAS IP Address AVP corresponds to an entry in the Route Record AVP.
This is done by doing a reverse lookup (PTR RR) for the NAS IP Address to retrieve the corresponding FQDN, and by checking for a match with the Route  Record AVP.
If no match is found, then an error is logged, but no other action is taken.
The NAS IPv6 Address AVP (AVP Code 95)
[RADIUSIPv6] is of type OctetString and contains the IPv6 Address of the NAS providing service to the user.
This AVP SHOULD only be added by a RADIUS/Diameter Translation Agent.
When this AVP is present, the Origin Host AVP identifies the NAS providing service to the user.
In RADIUS it would be possible for a rogue NAS to forge the NAS  IPv6 Address attribute.
Diameter/RADIUS translation agents MUST check a received NAS IPv6 Address attribute against the source address of the RADIUS packet.
If they do not match and the Diameter/RADIUS translation agent does not know whether the packet was sent by a RADIUS proxy or NAS (e.g., no Proxy State attribute), then by default it is assumed that the source address corresponds to a RADIUS proxy, and that the NAS IPv6 Address is behind that proxy, potentially with some additional RADIUS proxies in between.
The Diameter/RADIUS translation agent MUST insert entries in the Route  Record AVP corresponding to the apparent route.
This implies doing a reverse lookup on the source address and NAS IPv6 Address
attributes to determine the corresponding FQDNs.
If the source address and the NAS IPv6 Address do not match, and the Diameter/RADIUS translation agent knows that it is talking directly to the NAS (e.g., there are no RADIUS proxies between it and the NAS), then the error should be logged, and the packet MUST be discarded.
Diameter agents and servers MUST check whether the NAS IPv6 Address AVP corresponds to an entry in the Route Record AVP.
This is done by doing a reverse lookup (PTR RR) for the NAS IPv6 Address to retrieve the corresponding FQDN, and by checking for a match with the Record  Route AVP.
If no match is found, then an error is logged, but no other action is taken.
The State AVP (AVP Code 24) [RADIUS] is of type OctetString and has two uses in the Diameter NAS application.
The State AVP MAY be sent by a Diameter Server to a NAS in an AA  Response command that contains a Result Code of DIAMETER MULTI ROUND AUTH.
If so, the NAS MUST return it unmodified in the subsequent AA Request command.
The State AVP MAY also be sent by a Diameter Server to a NAS in an AA Response command that also includes a Termination Action AVP with the value of AA REQUEST.
If the NAS performs the Termination Action by sending a new AA Request command upon termination of the current service, it MUST return the State AVP unmodified in the new request command.
In either usage, the NAS MUST NOT interpret the AVP locally.
Usage of the State AVP is implementation dependent.
Termination Cause AVP Code Values
This section defines a mapping between Termination Cause AVP code values and RADIUS Acct Terminate Cause attribute code values from RFC 2866
[RADIUSAcct] and [RADIUSTypes], thereby allowing a RADIUS/Diameter Translation Agent to convert between the attribute and AVP values.
This section thus extends the definitions in the "Termination Cause AVP" section of the Base Diameter specification.
The table in this section defines the mapping between Termination  Cause AVP and RADIUS Acct Terminate Cause causes.
Maximum session length timer expired.
Service Unavailable  NAS was unable to provide requested service.
The Origin AAA Protocol AVP (AVP Code 408) is of the type Enumerated and should be inserted in a Diameter message translated by a gateway system from another AAA protocol, such as RADIUS.
It identifies the source protocol of the message to the Diameter system receiving the message.
The following RADIUS attributes MUST NOT appear in a Diameter message.
Instead, they are translated to other Diameter AVPs or handled in some special manner.
The rules for the treatment of the attributes are discussed in sections 9.1, 9.2, and 9.6.
RFC 2866    Accounting Input Packets 48 Acct Output Packets
RFC 2866    Accounting Output Packets 49
Acct Output Gigawords    RFC 2869
Accounting Output Octets 80 Message Authenticator
RFC 2869    none check and discard 9.5.
In general, Diameter AVPs that are not RADIUS compatible have code values greater than 255.
The table in the section above shows the AVPs that can be converted into RADIUS attributes.
Another problem may occur with Diameter AVP values that may be more than 253 octets in length.
Some RADIUS attributes (including but not limited to (8)Reply Message, (79)EAP Message, and (77)Connect Info) allow concatenation of multiple instances to overcome this limitation.
If this is not possible, a Result Code of DIAMETER INVALID AVP LENGTH should be returned.
RADIUS Vendor Specific Attributes RADIUS supports the inclusion of Vendor Specific Attributes (VSAs) through the use of attribute 26.
The recommended format [RADIUS] of the attribute data field includes a 4 octet vendor code followed by a one octet vendor type field and a one octet length field.
The last two fields MAY be repeated.
A system communicating between Diameter and RADIUS MAY have specific knowledge of vendor formats, and MAY be able to translate between the two formats.
However, given the deployment of many RADIUS vendor formats that do not follow the example format in RFC 2865 [RADIUS], (e.g., those that use a longer vendor type code)
the translations in the next two sections will not work in general for those VSAs.
RFC 2865 states that a robust implementation SHOULD support the field as undistinguished octets.
Systems that don't have vendor format knowledge MAY discard such attributes without knowing a suitable translation.
An alternative format is under consideration [VSA], which proposes encodings that would preserve the native information and not require vendor knowledge in the gateway system.
The following sections are an example for translating RADIUS VSAs that use the example RADIUS format, and Diameter VSAs that have type codes less than 255, and value field lengths less than 252.
Forwarding a Diameter Vendor Specific AVP as a RADIUS VSA For Type codes
, the value field length MUST be less than 252 or the AVP will be discarded.
The RADIUS VSA attribute should consist of the following fields;
RADIUS Type   26, Vendor Specific Attribute RADIUS Length   total length of attribute (header   data)
Diameter Vendor code RADIUS Vendor type code   low order byte of Diameter AVP code RADIUS Vendor data length   length of Diameter data
If the Diameter AVP code is greater than 255, then the RADIUS speaking code may use a Vendor specific field coding, if it knows one for that vendor.
Otherwise, the AVP will be ignored.
If it is flagged as Mandatory, a "DIAMETER AVP UNSUPPORTED" Result Code will be returned, and the RADIUS message will not be sent.
Forwarding a RADIUS VSA as a Diameter Vendor Specific AVP
The Diameter AVP will consist of the following fields:
Diameter Flags: V 1, M 0,
P 0 Diameter Vendor code
VSA Vendor code Diameter AVP code
VSA Vendor type code Diameter AVP length   length of AVP (header   data)
VSA vendor data Note that the VSAs are considered optional by RADIUS rules, and this specification does not set the Mandatory flag.
If an implementor desires a VSA be made mandatory because it represents a required service policy, the RADIUS gateway should have a process to set the bit on the Diameter side.
If the RADIUS receiving code knows of vendor specific field interpretations for the specific vendor, it may employ them to parse an extended AVP code or data length.
Otherwise the recommended standard fields will be used.
Nested Multiple vendor data fields MUST be expanded into multiple Diameter AVPs.
The following tables present the AVPs used by NAS applications in NAS messages and specify in which Diameter messages they MAY or MAY NOT be present.
[BASE] messages and AVPs are not described in this document.
Note that AVPs that can only be present within a Grouped AVP are not represented in this table.
The table uses the following symbols: 0
The AVP MUST NOT be present in the message. 0
Zero or more instances of the AVP MAY be present in the message. 0
1   Zero or one instance of the AVP MAY be present in the message.
One instance of the AVP MUST be present in the message.
The table in this section is limited to the Command Codes defined in this specification.
The tables in this section are used to show which AVPs defined in this document are to be present and used in NAS application Accounting messages.
These AVPs are defined in this document, as well as in [BASE] and [RADIUSAcct].
Accounting Framed Access AVP Table
The table in this section is used when the Service Type specifies Framed Access.
Accounting Non Framed Access AVP Table
The table in this section is used when the Service Type specifies Non Framed Access.
This section provides guidance to the Internet Assigned Numbers Authority (IANA) regarding registration of values related to the Diameter protocol, in accordance with BCP 26 [IANAConsid].
This document defines values in the namespaces that have been created and defined in the Diameter Base [BASE].
The IANA Considerations section of that document details the assignment criteria.
Values assigned in this document, or by future IANA action, must be coordinated within this shared namespace.
This specification assigns the value 265 from the Command Code namespace defined in [BASE].
See sections 3.1 and 3.2 for the assignment of the namespace in this specification.
This specification assigns the values 363 366 and 400 408 from the AVP Code namespace defined in [BASE].
See sections 4 and 5 for the assignment of the namespace in this specification.
Note that the values 363 366 are jointly, but consistently, assigned in [DiamMIP].
This document also creates one new namespace to be managed by IANA, as described in section 11.5.
This specification also specifies the use of AVPs in the 0 255 range, which are defined in [RADIUSTypes].
These values are assigned by the policy in RFC 2865 section 6 [RADIUS] and are amended by RFC 3575 [RADIUSIANA].
This specification uses the value one (1) in the Application Identifier namespace as assigned in [BASE].
See section 1.2 above for more information.
As defined in section 5.5, the CHAP Algorithm AVP (AVP Code 403) uses the values of the "PPP AUTHENTICATION ALGORITHMS" namespace defined in [PPPCHAP].
Accounting Auth Method AVP Values
As defined in section 8.6, the Accounting Auth Method AVP (AVP Code 406) defines the values 1 5.
All remaining values are available for assignment via IETF Consensus [IANA].
Origin AAA Protocol AVP Values
As defined in section 9.3.6, the Origin AAA Protocol AVP (AVP Code 408) defines the value 1.
All remaining values are available for assignment with a "Specification Required" policy [IANAConsid].
This document describes the extension of Diameter for the NAS application.
The security considerations of the Diameter protocol itself have been discussed in [BASE].
Use of this application of Diameter MUST take into consideration the security issues and requirements of the Base protocol.
This document does not contain a security protocol but does discuss how PPP authentication protocols can be carried within the Diameter protocol.
The PPP authentication protocols described are PAP and CHAP.
The use of PAP SHOULD be discouraged, as it exposes users' passwords to possibly non trusted entities.
However, PAP is also frequently used for use with One Time Passwords, which do not expose a security risk.
This document also describes how CHAP can be carried within the Diameter protocol, which is required for RADIUS backward compatibility.
The CHAP protocol, as used in a RADIUS environment, facilitates authentication replay attacks.
The use of the EAP authentication protocols described in [DiamEAP] can offer better security, given a method suitable for the circumstances.
