- title: __initial_text__
  contents:
  - ''
- title: Independent Submission                                      P. Srisuresh
  contents:
  - "Independent Submission                                      P. Srisuresh\n  \
    \             Unintended Consequences of NAT Deployments\n                   \
    \  with Overlapping Address Space\n"
- title: Abstract
  contents:
  - "Abstract\n   This document identifies two deployment scenarios that have arisen\n\
    \   from the unconventional network topologies formed using Network\n   Address\
    \ Translator (NAT) devices.  First, the simplicity of\n   administering networks\
    \ through the combination of NAT and DHCP has\n   increasingly lead to the deployment\
    \ of multi-level inter-connected\n   private networks involving overlapping private\
    \ IP address spaces.\n   Second, the proliferation of private networks in enterprises,\
    \ hotels\n   and conferences, and the wide-spread use of Virtual Private Networks\n\
    \   (VPNs) to access an enterprise intranet from remote locations has\n   increasingly\
    \ lead to overlapping private IP address space between\n   remote and corporate\
    \ networks.  This document does not dismiss these\n   unconventional scenarios\
    \ as invalid, but recognizes them as real and\n   offers recommendations to help\
    \ ensure these deployments can\n   function without a meltdown.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This document is not an Internet Standards Track specification;\
    \ it is\n   published for informational purposes.\n   This is a contribution to\
    \ the RFC Series, independently of any\n   other RFC stream.  The RFC Editor has\
    \ chosen to publish this\n   document at its discretion and makes no statement\
    \ about its value\n   for implementation or deployment.  Documents approved for\n\
    \   publication by the RFC Editor are not a candidate for any level of\n   Internet\
    \ Standard; see Section 2 of RFC 5741.\n   Information about the current status\
    \ of this document, any\n   errata, and how to provide feedback on it may be obtained\
    \ at\n   http://www.rfc-editor.org/info/rfc5684.\n"
- title: Copyright
  contents:
  - "Copyright\n   Copyright (c) 2010 IETF Trust and the persons identified as the\n\
    \   document authors.  All rights reserved.\n   This document is subject to BCP\
    \ 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n  \
    \ (http:trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1. Introduction and Scope ..........................................3\n\
    \   2. Terminology and Conventions Used ................................4\n  \
    \ 3. Multi-Level NAT Network Topologies ..............................4\n    \
    \  3.1. Operational Details of the Multi-Level NAT Network .........6\n      \
    \     3.1.1. Client/Server Communication .........................7\n        \
    \   3.1.2. Peer-to-Peer Communication ..........................7\n      3.2.\
    \ Anomalies of the Multi-Level NAT Network ...................8\n           3.2.1.\
    \ Plug-and-Play NAT Devices ..........................10\n           3.2.2. Unconventional\
    \ Addressing on NAT Devices ...........11\n           3.2.3. Multi-Level NAT Translations\
    \ .......................12\n           3.2.4. Mistaken End Host Identity .........................13\n\
    \   4. Remote Access VPN Network Topologies ...........................14\n  \
    \    4.1. Operational Details of the Remote Access VPN Network ......17\n    \
    \  4.2. Anomalies of the Remote Access VPNs .......................18\n      \
    \     4.2.1. Remote Router and DHCP Server Address Conflict .....18\n        \
    \   4.2.2. Simultaneous Connectivity Conflict .................20\n          \
    \ 4.2.3. VIP Address Conflict ...............................21\n           4.2.4.\
    \ Mistaken End Host Identity .........................22\n   5. Summary of Recommendations\
    \ .....................................22\n   6. Security Considerations ........................................24\n\
    \   7. Acknowledgements ...............................................24\n  \
    \ 8. References .....................................................25\n    \
    \  8.1. Normative References ......................................25\n      8.2.\
    \ Informative References ....................................25\n"
- title: 1.  Introduction and Scope
  contents:
  - "1.  Introduction and Scope\n   The Internet was originally designed to use a\
    \ single, global 32-bit\n   IP address space to uniquely identify hosts on the\
    \ network, allowing\n   applications on one host to address and initiate communications\
    \ with\n   applications on any other host regardless of the respective host's\n\
    \   topological locations or administrative domains.  For a variety of\n   pragmatic\
    \ reasons, however, the Internet has gradually drifted away\n   from strict conformance\
    \ to this ideal of a single flat global address\n   space, and towards a hierarchy\
    \ of smaller \"private\" address spaces\n   [RFC1918] clustered around a large\
    \ central \"public\" address space.\n   The most important pragmatic causes of\
    \ this unintended evolution of\n   the Internet's architecture appear to be the\
    \ following.\n   1. Depletion of the 32-bit IPv4 address space due to the exploding\n\
    \      total number of hosts on the Internet.  Although IPv6 promises to\n   \
    \   solve this problem, the uptake of IPv6 has in practice been slower\n     \
    \ than expected.\n   2. Perceived Security and Privacy: Traditional NAT devices\
    \ provide a\n      filtering function that permits session flows to cross the\
    \ NAT in\n      just one direction, from private hosts to public network hosts.\n\
    \      This filtering function is widely perceived as a security benefit.\n  \
    \    In addition, the NAT's translation of a host's original IP\n      addresses\
    \ and port number in a private network into an unrelated,\n      external IP address\
    \ and port number is perceived by some as a\n      privacy benefit.\n   3. Ease-of-Use:\
    \ NAT vendors often combine the NAT function with a\n      DHCP server function\
    \ in the same device, which creates a\n      compelling, effectively \"plug-and-play\"\
    \ method of setting up small\n      Internet-attached personal networks that is\
    \ often much easier in\n      practice for unsophisticated consumers than configuring\
    \ an IP\n      subnet.  The many popular and inexpensive consumer NAT devices\
    \ on\n      the market are usually configured \"out of the box\" to obtain a\n\
    \      single \"public\" IP address from an ISP or \"upstream\" network via\n\
    \      DHCP ([DHCP]), and the NAT device in turn acts as both a DHCP\n      server\
    \ and default router for any \"downstream\" hosts (and even\n      other NATs)\
    \ that the user plugs into it.  Consumer NATs in this\n      way effectively create\
    \ and manage private home networks\n      automatically without requiring any\
    \ knowledge of network protocols\n      or management on the part of the user.\
    \  Auto-configuration of\n      private hosts makes NAT devices a compelling solution\
    \ in this\n      common scenario.\n   [NAT-PROT] identifies various complications\
    \ with application\n   protocols due to NAT devices.  This document acts as an\
    \ adjunct to\n   [NAT-PROT].  The scope of the document is restricted to the two\n\
    \   scenarios identified in sections 3 and 4, arising out of\n   unconventional\
    \ NAT deployment and private address space overlap.\n   Even though the scenarios\
    \ appear unconventional, they are not\n   uncommon to find.  For each scenario,\
    \ the document describes the\n   seeming anomalies and offers recommendations\
    \ on how best to make the\n   topologies work.\n   Section 2 describes the terminology\
    \ and conventions used in the\n   document.  Section 3 describes the problem of\
    \ private address space\n   overlap in a multi-level NAT topology, the anomalies\
    \ with the\n   topology, and recommendations to address the anomalies.  Section\
    \ 4\n   describes the problem of private address space overlap with remote\n \
    \  access Virtual Private Network (VPN) connections, the anomalies with\n   the\
    \ topology, and recommendations to address the anomalies.  Section\n   5 describes\
    \ the security considerations in these scenarios.\n"
- title: 2.  Terminology and Conventions Used
  contents:
  - "2.  Terminology and Conventions Used\n   In this document, the IP addresses 192.0.2.1,\
    \ 192.0.2.64,\n   192.0.2.128, and 192.0.2.254 are used as example public IP addresses\n\
    \   [RFC5735].  Although these addresses are all from the same /24\n   network,\
    \ this is a limitation of the example addresses available in\n   [RFC5735].  In\
    \ practice, these addresses would be on different\n   networks.\n   Readers are\
    \ urged to refer to [NAT-TERM] for information on NAT\n   taxonomy and terminology.\
    \  Unless prefixed with a NAT type or\n   explicitly stated otherwise, the term\
    \ NAT, used throughout this\n   document, refers to Traditional NAT [NAT-TRAD].\
    \  Traditional NAT has\n   two variations, namely, Basic NAT and Network Address\
    \ Port Translator\n   (NAPT).  Of these, NAPT is by far the most commonly deployed\
    \ NAT\n   device.  NAPT allows multiple private hosts to share a single public\n\
    \   IP address simultaneously.\n"
- title: 3.  Multi-Level NAT Network Topologies
  contents:
  - "3.  Multi-Level NAT Network Topologies\n   Due to the pragmatic considerations\
    \ discussed in the previous section\n   and perhaps others, NATs are increasingly,\
    \ and often unintentionally,\n   used to create hierarchically interconnected\
    \ clusters of private\n   networks as illustrated in figure 1 below.  The creation\
    \ of multi-\n   level hierarchies is often unintentional, since each level of\
    \ NAT is\n   typically deployed by a separate administrative entity such as an\n\
    \   ISP, a corporation, or a home user.\n                                Public\
    \ Internet\n                            (Public IP Addresses)\n        ----+---------------+---------------+---------------+----\n\
    \            |               |               |               |\n            |\
    \               |               |               |\n        192.0.2.1      192.0.2.64\
    \     192.0.2.128     192.0.2.254\n        +-------+        Host A          Host\
    \ B      +-------------+\n        | NAT-1 |        (Alice)         (Jim)     \
    \  |    NAT-2    |\n        | (Bob) |                                    | (CheapoISP)\
    \ |\n        +-------+                                    +-------------+\n  \
    \      10.1.1.1                                        10.1.1.1\n            |\
    \                                               |\n            |             \
    \                                  |\n        Private Network 1              \
    \        Private Network 2\n      (Private IP Addresses)                 (Private\
    \ IP Addresses)\n        ----+--------+----      ----+-----------------------+----\n\
    \            |        |              |           |           |\n            |\
    \        |              |           |           |\n        10.1.1.10 10.1.1.11\
    \     10.1.1.10   10.1.1.11   10.1.1.12\n         Host C    Host D       +-------+\
    \    Host E     +-------+\n                                | NAT-3 |    (Mary)\
    \     | NAT-4 |\n                                | (Ann) |               | (Lex)\
    \ |\n                                +-------+               +-------+\n     \
    \                           10.1.1.1                10.1.1.1\n               \
    \                     |                       |\n                            \
    \        |                       |\n                Private Network 3   |    \
    \     Private Network 4\n              (Private IP Addresses)|       (Private\
    \ IP Addresses)\n                ----+-----------+---+       ----+-----------+----\n\
    \                    |           |               |           |\n             \
    \       |           |               |           |\n                10.1.1.10 \
    \  10.1.1.11       10.1.1.10   10.1.1.11\n                 Host F      Host G\
    \          Host H      Host I\n      Figure 1. Multi-Level NAT Topology with Overlapping\
    \ Address Space\n   In the above scenario, Bob, Alice, Jim, and CheapoISP have\
    \ each\n   obtained a \"genuine\", globally routable IP address from an upstream\n\
    \   service provider.  Alice and Jim have chosen to attach only a single\n   machine\
    \ at each of these public IP addresses, preserving the\n   originally intended\
    \ architecture of the Internet and making their\n   hosts, A and B, globally addressable\
    \ throughout the Internet.  Bob,\n   in contrast, has purchased and attached a\
    \ typical consumer NAT box.\n   Bob's NAT obtains its external IP address (192.0.2.1)\
    \ from Bob's ISP\n   via DHCP, and automatically creates a private 10.1.1.x network\
    \ for\n   Bob's hosts C and D, acting as the DHCP server and default router for\n\
    \   this private network.  Bob probably does not even know anything about\n  \
    \ IP addresses; he merely knows that plugging the NAT into the Internet\n   as\
    \ instructed by the ISP, and then plugging his hosts into the NAT as\n   the NAT's\
    \ manual indicates, seems to work and gives all of his hosts\n   access to Internet.\n\
    \   CheapoISP, an inexpensive service provider, has allocated only one or\n  \
    \ a few globally routable IP addresses, and uses NAT to share these\n   public\
    \ IP addresses among its many customers.  Such an arrangement is\n   becoming\
    \ increasingly common, especially in rapidly developing\n   countries where the\
    \ exploding number of Internet-attached hosts\n   greatly outstrips the ability\
    \ of ISPs to obtain globally unique IP\n   addresses for them.  CheapoISP has\
    \ chosen the popular 10.1.1.x\n   address for its private network, since this\
    \ is one of the three well-\n   known private IP address blocks allocated in [RFC1918]\
    \ specifically\n   for this purpose.\n   Of the three incentives listed in section\
    \ 1 for NAT deployment, the\n   last two still apply even to customers of ISPs\
    \ that use NAT,\n   resulting in multi-level NAT topologies as illustrated in\
    \ the right\n   side of the above diagram.  Even three-level NAT topologies are\
    \ known\n   to exist.  CheapoISP's customers Ann, Mary, and Lex have each\n  \
    \ obtained a single IP address on CheapoISP's network (Private Network\n   2),\
    \ via DHCP.  Mary attaches only a single host at this point, but\n   Ann and Lex\
    \ each independently purchase and deploy consumer NATs in\n   the same way that\
    \ Bob did above.  As it turns out, these consumer\n   NATs also happen to use\
    \ 10.1.1.x addresses for the private networks\n   they create, since these are\
    \ the configuration defaults hard-coded\n   into the NATs by their vendors.  Ann\
    \ and Lex probably know nothing\n   about IP addresses, and in particular they\
    \ are probably unaware that\n   the IP address spaces of their own private networks\
    \ overlap not only\n   with each other but also with the private IP address space\
    \ used by\n   their immediately upstream network.\n   Nevertheless, despite this\
    \ direct overlap, all of the \"multi-level\n   NATed hosts\" -- F, G, H, and I\
    \ in this case -- all nominally function\n   and are able to initiate connections\
    \ to any public server on the\n   public Internet that has a globally routable\
    \ IP address.  Connections\n   made from these hosts to the main Internet are\
    \ merely translated\n   twice: once by the consumer NAT (NAT-3 or NAT-44) into\
    \ the IP address\n   space of CheapoISP's Private Network 2 and then again by\
    \ CheapoISP's\n   NAT-2 into the public Internet's global IP address space.\n"
- title: 3.1.  Operational Details of the Multi-Level NAT Network
  contents:
  - "3.1.  Operational Details of the Multi-Level NAT Network\n   In the \"de facto\"\
    \ Internet address architecture that has resulted\n   from the above pragmatic\
    \ and economic incentives, only the nodes on\n   the public Internet have globally\
    \ unique IP addresses assigned by the\n   official IP address registries.  IP\
    \ addresses on different private\n   networks are typically managed independently\
    \ -- either manually by\n   the administrator of the private network itself, or\
    \ automatically by\n   the NAT through which the private network is connected\
    \ to its\n   \"upstream\" service provider.\n   By convention, nodes on private\
    \ networks are usually assigned IP\n   addresses in one of the private address\
    \ space ranges specifically\n   allocated to this purpose in RFC 1918, ensuring\
    \ that private IP\n   addresses are easily distinguishable and do not conflict\
    \ with the\n   public IP addresses officially assigned to globally routable Internet\n\
    \   hosts.  However, when plug-and-play NATs are used to create\n   hierarchically\
    \ interconnected clusters of private networks, a given\n   private IP address\
    \ can be and often is reused across many different\n   private networks.  In figure\
    \ 1 above, for example, private networks\n   1, 2, 3, and 4 all have a node with\
    \ IP address 10.1.1.10.\n"
- title: 3.1.1.  Client/Server Communication
  contents:
  - "3.1.1.  Client/Server Communication\n   When a host on a private network initiates\
    \ a client/server-style\n   communication session with a server on the public\
    \ Internet, via the\n   server's public IP address, the NAT intercepts the packets\
    \ comprising\n   that session (usually as a consequence of being the default router\n\
    \   for the private network), and modifies the packets' IP and TCP/UDP\n   headers\
    \ so as to make the session appear externally as if it were\n   initiated by the\
    \ NAT itself.\n   For example, if host C above initiates a connection to host\
    \ A at IP\n   address 192.0.2.64, NAT-1 modifies the packets comprising the session\n\
    \   so as to appear on the public Internet as if the session originated\n   from\
    \ NAT-1.  Similarly, if host F on private network 3 initiates a\n   connection\
    \ to host A, NAT-3 modifies the outgoing packet so the\n   packet appears on private\
    \ network 2 as if it had originated from\n   NAT-3 at IP address 10.1.1.10.  When\
    \ the modified packet traverses\n   NAT-2 on private network 2, NAT-2 further\
    \ modifies the outgoing\n   packet so as to appear on the public Internet as if\
    \ it had originated\n   from NAT-2 at public IP address 192.0.2.254.  The NATs\
    \ in effect\n   serve as proxies that give their private \"downstream\" client\
    \ nodes a\n   temporary presence on \"upstream\" networks to support individual\n\
    \   communication sessions.\n   In summary, all hosts on the private networks\
    \ 1, 2, 3, and 4 in\n   figure 1 above are able to establish a client/server-style\n\
    \   communication sessions with servers on the public Internet.\n"
- title: 3.1.2.  Peer-to-Peer Communication
  contents:
  - "3.1.2.  Peer-to-Peer Communication\n   While this network organization functions\
    \ in practice for\n   client/server-style communication, when the client is behind\
    \ one or\n   more levels of NAT and the server is on the public Internet, the\
    \ lack\n   of globally routable addresses for hosts on private networks makes\n\
    \   direct peer-to-peer communication between those hosts difficult.  For\n  \
    \ example, two private hosts F and H on the network shown above might\n   \"meet\"\
    \ and learn of each other through a well-known server on the\n   public Internet,\
    \ such as host A, and desire to establish direct\n   communication between G and\
    \ H without requiring A to forward each\n   packet.  If G and H merely learn each\
    \ other's (private) IP addresses\n   from a registry kept by A, their attempts\
    \ to connect to each other\n   will fail because G and H reside on different private\
    \ networks.\n   Worse, if their connection attempts are not properly authenticated,\n\
    \   they may appear to succeed but end up talking to the wrong host.  For\n  \
    \ example, G may end up talking to host F, the host on private network\n   3 that\
    \ happens to have the same private IP address as host H.  Host H\n   might similarly\
    \ end up unintentionally connecting to host I.\n   In summary, peer-to-peer communication\
    \ between hosts on disjoint\n   private networks 1, 2, 3, and 4 in figure 1 above\
    \ is a challenge\n   without the assistance of a well-known server on the public\
    \ Internet.\n   However, with assistance from a node in the public Internet, all\n\
    \   hosts on the private networks 1, 2, 3, and 4 in figure 1 above are\n   able\
    \ to establish a peer-to-peer-style communication session amongst\n   themselves\
    \ as well as with hosts on the public Internet.\n"
- title: 3.2.  Anomalies of the Multi-Level NAT Network
  contents:
  - "3.2.  Anomalies of the Multi-Level NAT Network\n   Even though conventional wisdom\
    \ would suggest that the network\n   described above is seriously broken, in practice\
    \ it still works in\n   many ways.  We break up figure 1 into two sub-figures\
    \ to better\n   illustrate the anomalies.  Figure 1.1 is the left half of figure\
    \ 1\n   and reflects the conventional single NAT deployment that is widely\n \
    \  prevalent in many last-mile locations.  The deployment in figure 1.1\n   is\
    \ popularly viewed as a pragmatic solution to work around the\n   depletion of\
    \ IPv4 address space and is not considered broken.  Figure\n   1.2 is the right\
    \ half of figure-1 and is representative of the\n   anomalies we are about to\
    \ discuss.\n                      Public Internet\n                    (Public\
    \ IP Addresses)\n        ----+---------------+---------------+-----------\n  \
    \          |               |               |\n            |               |  \
    \             |\n        192.0.2.1      192.0.2.64     192.0.2.128\n        +-------+\
    \        Host A          Host B\n        | NAT-1 |        (Alice)         (Jim)\n\
    \        | (Bob) |\n        +-------+\n        10.1.1.1\n            |\n     \
    \       |\n        Private Network 1\n      (Private IP Addresses)\n        ----+--------+----\n\
    \            |        |\n            |        |\n        10.1.1.10 10.1.1.11\n\
    \         Host C    Host D\n          Figure 1.1. Conventional Single-level NAT\
    \ Network topology\n                        Public Internet\n                \
    \      (Public IP Addresses)\n                ---+---------------+---------------+----\n\
    \                   |               |               |\n                   |  \
    \             |               |\n               192.0.2.64     192.0.2.128   \
    \  192.0.2.254\n                Host A          Host B      +-------------+\n\
    \                (Alice)         (Jim)       |    NAT-2    |\n               \
    \                             | (CheapoISP) |\n                              \
    \              +-------------+\n                                             \
    \  10.1.1.1\n                                                   |\n          \
    \                                         |\n                                \
    \          Private Network 2\n                                        (Private\
    \ IP Addresses)\n                 ----+---------------+-------------+--+-------\n\
    \                     |               |                |\n                   \
    \  |               |                |\n                 10.1.1.10       10.1.1.11\
    \        10.1.1.12\n                 +-------+        Host E          +-------+\n\
    \                 | NAT-3 |        (Mary)          | NAT-4 |\n               \
    \  | (Ann) |                        | (Lex) |\n                 +-------+    \
    \                    +-------+\n                 10.1.1.1                    \
    \     10.1.1.1\n                     |                                |\n    \
    \                 |                                |\n            Private Network\
    \ 3                 Private Network 4\n          (Private IP Addresses)      \
    \      (Private IP Addresses)\n       ----+-----------+------             ----+-----------+----\n\
    \           |           |                       |           |\n           |  \
    \         |                       |           |\n      10.1.1.10   10.1.1.11 \
    \               10.1.1.10   10.1.1.11\n        Host F      Host G            \
    \       Host H      Host I\n         Figure 1.2. Unconventional Multi-Level NAT\
    \ Network Topology\n"
- title: 3.2.1.  Plug-and-Play NAT Devices
  contents:
  - "3.2.1.  Plug-and-Play NAT Devices\n   Consumer NAT devices are predominantly\
    \ plug-and-play NAT devices, and\n   assume minimal user intervention during device\
    \ setup.  The plug-and-\n   play NAT devices provide DHCP service on one interface\
    \ and NAT\n   function on another interface.  Vendors of the consumer NAT devices\n\
    \   make assumptions about how their consumers configure and hook up\n   their\
    \ PCs to the device.  When consumers do not adhere to the vendor\n   assumptions,\
    \ the consumers can end up with a broken network.\n   A plug-and-play NAT device\
    \ provides DHCP service on the LAN attached\n   to the private interface, and\
    \ assumes that all private hosts at the\n   consumer site have DHCP client enabled\
    \ and are connected to the\n   single LAN.  Consumers need to be aware that all\
    \ private hosts must\n   be on a single LAN, with no router in between.\n   A\
    \ plug-and-play NAT device also assumes that there is no other NAT\n   device\
    \ or DHCP server device on the same LAN at the customer\n   premises.  When there\
    \ are multiple plug-and-play NAT devices on the\n   same LAN, each NAT device\
    \ will offer DHCP service on the same LAN,\n   and may even be from the same private\
    \ address pool.  This could\n   result in multiple end nodes on the same LAN ending\
    \ up with identical\n   IP addresses and breaking network connectivity.\n   As\
    \ it turns out, most consumer deployments have a single LAN where\n   there they\
    \ deploy a plug-and-play NAT device and the concerns raised\n   above have not\
    \ been an issue in reality.\n"
- title: 3.2.2.  Unconventional Addressing on NAT Devices
  contents:
  - "3.2.2.  Unconventional Addressing on NAT Devices\n   Let us consider the unconventional\
    \ addressing with NAT-3 and NAT-4.\n   NAT-3 and NAT-4 are apparently multi-homed\
    \ on the same subnet through\n   both their interfaces.  NAT-3 is on subnet 10.1.1/24\
    \ through its\n   external interface facing NAT-2, as well as through its private\n\
    \   interface facing clients host F and host G.  Likewise, NAT-4 also has\n  \
    \ two interfaces on the same subnet 10.1.1/24.\n   In a traditional network, when\
    \ a node has multiple interfaces with IP\n   addresses on the same subnet, it\
    \ is natural to assume that all\n   interfaces with addresses on the same subnet\
    \ must be on a single\n   connected LAN (bridged LAN or a single physical LAN).\
    \  Clearly, that\n   is not the case here.  Even though both NAT-3 and NAT-4 have\
    \ two\n   interfaces on the same subnet 10.1.1/24, the NAT devices view the two\n\
    \   interfaces as being on two disjoint subnets and routing realms.  The\n   plug-and-play\
    \ NAT devices are really not multi-homed on the same\n   subnet as in a traditional\
    \ sense.\n   In a traditional network, both NAT-3 and NAT-4 in figure 1.2 should\n\
    \   be incapable of communicating reliably as a transport endpoint with\n   other\
    \ nodes on their adjacent networks (e.g., private networks 2 and\n   3 in the\
    \ case of NAT-3 and private Networks 2 and 4 in the case of\n   NAT-4).  This\
    \ is because applications on either of the NAT devices\n   cannot know to differentiate\
    \ packets from hosts on either of the\n   subnets bearing the same IP address.\
    \  If NAT-3 attempts to resolve\n   the IP address of a neighboring host in the\
    \ conventional manner by\n   broadcasting an Address Resolution Protocol (ARP)\
    \ request on all of\n   its physical interfaces bearing the same subnet, it may\
    \ get a\n   different response on each of its physical interfaces.\n   Even though\
    \ both NAT-3 and NAT-4 have hosts bearing the same IP\n   address on the adjacent\
    \ networks, the NAT devices do communicate\n   effectively as endpoints.  Many\
    \ of the plug-and-play NAT devices\n   offer a limited number of services on them.\
    \  For example, many of the\n   NAT devices respond to pings from hosts on either\
    \ of the interfaces.\n   Even though a NAT device is often not actively managed,\
    \ many of the\n   NAT devices are equipped to be managed from the private interface.\n\
    \   This unconventional communication with NAT devices is achievable\n   because\
    \ many of the NAT devices conform to REQ-7 of [BEH-UDP] and\n   view the two interfaces\
    \ as being on two disjoint routing domains and\n   distinguish between sessions\
    \ initiated from hosts on either interface\n   (private or public).\n"
- title: 3.2.3.  Multi-Level NAT Translations
  contents:
  - "3.2.3.  Multi-Level NAT Translations\n   Use of a single NAT to connect private\
    \ hosts to the public Internet\n   as in figure 1.1 is a fairly common practice.\
    \  Many consumer NATs are\n   deployed this way.  However, use of multi-level\
    \ NAT translations as\n   in figure 1.2 is not a common practice and is not well\
    \ understood.\n   Let us consider the conventional single NAT translation in figure\n\
    \   1.1.  Because the public and private IP address ranges are\n   numerically\
    \ disjoint, nodes on private networks can make use of both\n   public and private\
    \ IP addresses when initiating network communication\n   sessions.  Nodes on a\
    \ private network can use private IP addresses to\n   refer to other nodes on\
    \ the same private network, and public IP\n   addresses to refer to nodes on the\
    \ public Internet.  For example,\n   host C in figure 1.1 is on private network\
    \ 1 and can directly address\n   hosts A, B, and D using their assigned IP addresses.\
    \  This is in\n   spite of the fact that hosts A and B are on the public Internet\
    \ and\n   host D alone is on the private network.\n   Next, let us consider the\
    \ unconventional multi-level NAT topology in\n   figure 1.2.  In this scenario,\
    \ private hosts are able to connect to\n   hosts on the public Internet.  But,\
    \ private hosts are not able to\n   connect with all other private hosts.  For\
    \ example, host F in figure\n   1.2 can directly address hosts A, B, and G using\
    \ their assigned IP\n   addresses, but F has no way to address any of the other\
    \ hosts in the\n   diagram.  Host F in particular cannot address host E by its\
    \ assigned\n   IP address, even though host E is located on the immediately\n\
    \   \"upstream\" private network through which F is connected to the\n   Internet.\
    \  Host E has the same IP address as host G.  Yet, this\n   addressing is \"legitimate\"\
    \ in the NAT world because the two hosts are\n   on different private networks.\n\
    \   It would seem that the topology in figure 1.2 with multiple NAT\n   translations\
    \ is broken because private hosts are not able to address\n   each other directly.\
    \  However, the network is not broken.  Nodes on\n   any private network have\
    \ no direct method of addressing nodes on\n   other private networks.  The private\
    \ networks 1, 2, 3, and 4 are all\n   disjoint.  Hosts on private network 1 are\
    \ unable to directly address\n   nodes on private networks 2, 3, or 4 and vice\
    \ versa.  Multiple NAT\n   translations were not the cause of this.\n   As described\
    \ in sections 3.1.1 and 3.1.2, client-server and peer-to-\n   peer communication\
    \ can and should be possible even with multi-level\n   NAT topology deployment.\
    \  A host on any private network must be able\n   to communicate with any other\
    \ host, no matter to which private\n   network the host is attached or where the\
    \ private network is located.\n   Host F should be able to communicate with host\
    \ E and carry out both\n   client-server communication and peer-to-peer communication,\
    \ and vice\n   versa.  Host F and host E form a hairpin session through NAT-2\
    \ to\n   communicate with each other.  Each host uses the public endpoint\n  \
    \ assigned by the Internet-facing NAT (NAT-2) to address its peer.\n   When the\
    \ deployed NAT devices conform to the hairpin translation\n   requirements in\
    \ [BEH-UDP], [BEH-TCP], and [BEH-ICMP], peer nodes are\n   able to connect even\
    \ in this type of multi-level NAT topologies.\n"
- title: 3.2.4.  Mistaken End Host Identity
  contents:
  - "3.2.4.  Mistaken End Host Identity\n   Mistaken end host identity can result\
    \ in accidental malfunction in\n   some cases of multi-level NAT deployments.\
    \  Consider the scenario in\n   figure 1.3.  Figure 1.3 depicts two levels of\
    \ NATs between an end-\n   user in private network 3 and the public Internet.\n\
    \   Suppose CheapoISP assigns 10.1.1.11 to its DNS resolver, which it\n   advertises\
    \ through DHCP to NAT-3, the gateway for Ann's home.  NAT-3\n   in turn advertises\
    \ 10.1.1.11 as the DNS resolver to host F\n   (10.1.1.10) and host G (10.1.1.11)\
    \ on private network 3.  However,\n   when host F sends a DNS query to 10.1.1.11,\
    \ it will be delivered\n   locally to host G on private network 3 rather than\
    \ CheapoISP's DNS\n   resolver.  This is clearly a case of mistaken identity due\
    \ to\n   CheapoISP advertising a server that could potentially overlap with\n\
    \   its customers' IP addresses.\n                  Public Internet\n        \
    \        (Public IP Addresses)\n          ---+---------------+---------------+----\n\
    \             |               |               |\n             |              \
    \ |               |\n         192.0.2.64     192.0.2.128     192.0.2.254\n   \
    \       Host A          Host B      +-------------+\n          (Alice)       \
    \  (Jim)       |    NAT-2    |\n                                      | (CheapoISP)\
    \ |\n                                      +-------------+\n                 \
    \                        10.1.1.1\n                                          \
    \   |\n                                             |\n                      \
    \              Private Network 2\n                                  (Private IP\
    \ Addresses)\n      ------------+------------------+-------+----------\n     \
    \             |                  |\n              10.1.1.10              |\n \
    \             +-------+         10.1.1.11\n              | NAT-3 |          Host\
    \ E\n              | (Ann) |          (DNS Resolver)\n              +-------+\n\
    \               10.1.1.1\n                   |    Private Network 3\n        \
    \           |  (Private IP Addresses)\n           ----+---+-----------+----------------\n\
    \               |               |\n               |               |\n        \
    \  10.1.1.10       10.1.1.11\n            Host F          Host G\n       Figure\
    \ 1.3. Mistaken Server Identity in Multi-Level NAT Topology\n   Recommendation-1:\
    \ ISPs, using NAT devices to provide connectivity to\n   customers, should assign\
    \ non-overlapping addresses to servers\n   advertised to customers.  One way to\
    \ do this would be to assign\n   global addresses to advertised servers.\n"
- title: 4.  Remote Access VPN Network Topologies
  contents:
  - "4.  Remote Access VPN Network Topologies\n   Enterprises use remote access VPN\
    \ to allow secure access to employees\n   working outside the enterprise premises.\
    \  While outside the\n   enterprise premises, an employee may be located in his/her\
    \ home\n   office, hotel, conference, or a partner's office.  In all cases, it\n\
    \   is desirable for the employee at the remote site to have unhindered\n   access\
    \ to his/her corporate network and the applications running on\n   the corporate\
    \ network.  While doing so, the employee should not\n   jeopardize the integrity\
    \ and confidentiality of the corporate network\n   and the applications running\
    \ on the network.\n   IPsec, Layer 2 Tunneling Protocol (L2TP), and Secure Socket\
    \ Layer\n   (SSL) are some of the well-known secure VPN technologies used by the\n\
    \   remote access vendors.  Besides authenticating employees for granting\n  \
    \ access, remote access VPN servers often enforce different forms of\n   security\
    \ (e.g., IPsec, SSL) to protect the integrity and\n   confidentiality of the run-time\
    \ traffic between the VPN client and\n   the VPN server.\n   Many enterprises\
    \ deploy their internal networks using private address\n   space as defined in\
    \ RFC 1918 and use NAT devices to connect to the\n   public Internet.  Further,\
    \ many of the applications in the corporate\n   network refer to information (such\
    \ as URLs) and services using\n   private addresses in the corporate network.\
    \  Applications such as the\n   Network File Systems (NFS) rely on simple source-IP-address-based\n\
    \   filtering to restrict access to corporate users.  These are some\n   reasons\
    \ why the remote access VPN servers are configured with a block\n   of IP addresses\
    \ from the corporate private network to assign to\n   remote access clients. \
    \ VPN clients use the virtual IP (VIP) address\n   assigned to them (by the corporate\
    \ VPN server) to access applications\n   inside the corporate network.\n   Consider\
    \ the remote access VPN scenario in figure 2 below.\n                     (Corporate\
    \ Private Network 10.0.0.0/8)\n                     ---------------+----------------------\n\
    \                                    |\n                                 10.1.1.10\n\
    \                          +---------+-------+\n                          | Enterprise\
    \ Site |\n                          | Remote Access   |\n                    \
    \      | VPN Server      |\n                          +--------+--------+\n  \
    \                           192.0.2.1\n                                   |\n\
    \                         {---------+------}\n                       {       \
    \             }\n                     {                        }\n           \
    \        {      Public Internet       }\n                   {   (Public IP Addresses)\
    \    }\n                     {                        }\n                    \
    \   {                    }\n                         {---------+------}\n    \
    \                               |\n                             192.0.2.254\n\
    \                          +--------+--------+\n                          | Remote\
    \ Site     |\n                          |  Plug-and-Play  |\n                \
    \          | NAT Router      |\n                          +--------+--------+\n\
    \                               10.1.1.1\n                                   |\n\
    \      Remote Site Private Network  |\n      -----+-----------+-----------+-------------+-----------\n\
    \           |           |           |             |\n        10.1.1.10  10.1.1.11\
    \   10.1.1.12     10.1.1.13\n         Host A    Host B      +--------+    Host\
    \ C\n                               | VPN    |\n                             \
    \  | Client |\n                               | on a PC|\n                   \
    \            +--------+\n          Figure 2. Remote Access VPN with Overlapping\
    \ Address Space\n   In the above scenario, say an employee of the corporation\
    \ is at a\n   remote location and attempts to access the corporate network using\n\
    \   the VPN client, the corporate network is laid out using the address\n   pool\
    \ of 10.0.0.0/8 as defined in RFC 1918, and the VPN server is\n   configured with\
    \ an address block of 10.1.1.0/24 to assign virtual IP\n   addresses to remote\
    \ access VPN clients.  Now, say the employee at the\n   remote site is attached\
    \ to a network on the remote site that also\n   happens to be using a network\
    \ based on the RFC 1918 address space and\n   coincidentally overlaps the corporate\
    \ network.  In this scenario, it\n   is conventionally problematic for the VPN\
    \ client to connect to the\n   server(s) and other hosts at the enterprise.\n\
    \   Nevertheless, despite the direct address overlap, the remote access\n   VPN\
    \ connection between the VPN client at the remote site and the VPN\n   server\
    \ at the enterprise should remain connected and should be made\n   to work.  That\
    \ is, the NAT device at the remote site should not\n   obstruct the VPN connection\
    \ traversing it.  Additionally, the remote\n   user should be able to connect\
    \ to any host at the enterprise through\n   the VPN from the remote desktop.\n\
    \   The following subsections describe the operational details of the\n   VPN,\
    \ anomalies with the address overlap, and recommendations on how\n   best to address\
    \ the situation.\n"
- title: 4.1.  Operational Details of Remote Access VPN Network
  contents:
  - "4.1.  Operational Details of Remote Access VPN Network\n   As mentioned earlier,\
    \ in the \"de facto\" Internet address\n   architecture, only the nodes on the\
    \ public Internet have globally\n   unique IP addresses assigned by the official\
    \ IP address registries.\n   Many of the networks in the edges use private IP\
    \ addresses from RFC\n   1918 and use NAT devices to connect their private networks\
    \ to the\n   public Internet.  Many enterprises adapted the approach of using\n\
    \   private IP addresses internally.  Employees within the enterprise's\n   intranet\
    \ private network are \"trusted\" and may connect to any of the\n   internal hosts\
    \ with minimal administrative or policy enforcement\n   overhead.  When an employee\
    \ leaves the enterprise premises, remote\n   access VPN provides the same level\
    \ of intranet connectivity to the\n   remote user.\n   The objective of this section\
    \ is to provide an overview of the\n   operational details of a remote access\
    \ VPN application so the reader\n   has an appreciation for the problem of remote\
    \ address space overlap.\n   This is not a tutorial or specification of remote\
    \ access VPN\n   products, per se.\n   When an employee at a remote site launches\
    \ his/her remote access VPN\n   client, the VPN server at the corporate premises\
    \ demands that the VPN\n   client authenticate itself.  When the authentication\
    \ succeeds, the\n   VPN server assigns a Virtual IP (VIP) address to the client\
    \ for\n   connecting with the corporate intranet.  From this point onwards,\n\
    \   while the VPN is active, outgoing IP packets directed to the hosts in\n  \
    \ the corporate intranet are tunneled through the VPN, in that the VPN\n   server\
    \ serves as the next-hop and the VPN connection as the next-hop\n   link for these\
    \ packets.  Within the corporate intranet, the\n   outbound IP packets appear\
    \ as arriving from the VIP address.  So, IP\n   packets from the corporate hosts\
    \ to the remote user are sent to the\n   remote user's VIP address and the IP\
    \ packets are tunneled inbound to\n   the remote user's PC through the VPN tunnel.\n\
    \   This works well so long as the subnets in the corporate network do\n   not\
    \ conflict with subnets at the remote site where the remote user's\n   PC is located.\
    \  However, when the corporate network is built using\n   RFC 1918 private address\
    \ space and the remote location where the VPN\n   client is launched is also using\
    \ an overlapping network from RFC 1918\n   address space, there can be addressing\
    \ conflicts.  The remote user's\n   PC will have a conflict in accessing nodes\
    \ on the corporate site and\n   nodes at the remote site bearing the same IP address\
    \ simultaneously.\n   Consequently, the VPN client may be unable to have full\
    \ access to the\n   employee's corporate network and the local network at the\
    \ remote site\n   simultaneously.\n   In spite of address overlap, remote access\
    \ VPN clients should be able\n   to successfully establish connections with intranet\
    \ hosts in the\n   enterprise.\n"
- title: 4.2.  Anomalies of the Remote Access VPNs
  contents:
  - "4.2.  Anomalies of the Remote Access VPNs\n   Even though conventional wisdom\
    \ would suggest that the remote access\n   VPN scenario with overlapping address\
    \ space would be seriously\n   broken, in practice it still works in many ways.\
    \  Let us look at some\n   anomalies where there might be a problem and identify\
    \ solutions\n   through which the remote access VPN application could be made\
    \ to work\n   even under the problem situations.\n"
- title: 4.2.1.  Remote Router and DHCP Server Address Conflict
  contents:
  - "4.2.1.  Remote Router and DHCP Server Address Conflict\n   Routing and DHCP service\
    \ are bootstrap services essential for a\n   remote host to establish a VPN connection.\
    \  Without DHCP lease, the\n   remote host cannot communicate over the IP network.\
    \  Without a router\n   to connect to the Internet, the remote host is unable\
    \ to access past\n   the local subnet to connect to the VPN server at the enterprise.\
    \  It\n   is essential that neither of these bootstrap services be tampered\n\
    \   with at the remote host in order for the VPN connection to stay\n   operational.\
    \  Typically, a plug-and-play NAT device at the remote\n   site provides both\
    \ routing and DHCP services from the same IP\n   address.\n   When there is address\
    \ overlap between hosts at the corporate intranet\n   and hosts at the remote\
    \ site, the remote VPN user is often unaware of\n   the address conflict.  Address\
    \ overlap could potentially cause the\n   remote user to lose connectivity to\
    \ the enterprise entirely or lose\n   connectivity to an arbitrary block of hosts\
    \ at the enterprise.\n   Consider, for example, a scenario where the IP address\
    \ of the DHCP\n   server at the remote site matched the IP address of a host at\
    \ the\n   enterprise network.  When the remote user's PC is ready to renew the\n\
    \   lease of the locally assigned IP address, the remote user's VPN\n   client\
    \ would incorrectly identify the IP packet as being addressed to\n   an enterprise\
    \ host and tunnel the DHCP renewal packet over the VPN to\n   the remote VPN server.\
    \  The DHCP renewal requests simply do not reach\n   the DHCP server at the remote\
    \ site.  As a result, the remote PC would\n   eventually lose the lease on the\
    \ IP address and the VPN connection to\n   the enterprise would be broken.\n \
    \  Consider another scenario where the IP address of the remote user's\n   router\
    \ overlapped with the IP address of a host in the enterprise\n   network.  If\
    \ the remote user's PC were to send a ping or some type of\n   periodic keep-alive\
    \ packets to the router (say, to test the liveness\n   of the router), the packets\
    \ would be intercepted by the VPN client\n   and simply redirected to the VPN\
    \ tunnel.  This type of unintended\n   redirection has the twin effect of hijacking\
    \ critical packets\n   addressed to the router as well as the host in the enterprise\
    \ network\n   (bearing the same IP address as the remote router) being bombarded\n\
    \   with unintended keep-alive packets.  Loss of connectivity to the\n   router\
    \ can result in the VPN connection being broken.\n   Clearly, it is not desirable\
    \ to route traffic directed to the local\n   router or DHCP server to be redirected\
    \ to the corporate intranet.  A\n   VPN client on a remote PC should be configured\
    \ such that IP packets\n   whose target IP address matches any of the following\
    \ are disallowed\n   to be redirected over the VPN:\n   a) IP address of the VPN\
    \ client's next-hop router, used to access the\n      VPN server.\n   b) IP address\
    \ of the DHCP server, providing address lease on the\n      remote host network\
    \ interface.\n   Recommendation-2: A VPN client on a remote PC should be configured\n\
    \   such that IP packets whose target IP address matches *any* of (a) or\n   (b)\
    \ are disallowed to be redirected over the VPN:\n   a) IP address of the VPN client's\
    \ next-hop router, used to access the\n      VPN server.\n   b) IP address of\
    \ the DHCP server, providing address lease on the\n      remote host network interface.\n"
- title: 4.2.2.  Simultaneous Connectivity Conflict
  contents:
  - "4.2.2.  Simultaneous Connectivity Conflict\n   Ideally speaking, it is not desirable\
    \ for the corporate intranet to\n   conflict with any of the hosts at the remote\
    \ site.  As a general\n   practice, if simultaneous communication with end hosts\
    \ at the remote\n   location is important, it is advisable to disallow access\
    \ to any\n   corporate network resource that overlaps the client's subnet at the\n\
    \   remote site.  By doing this, the remote user is able to connect to\n   all\
    \ local hosts simultaneously while the VPN connection is active.\n   Some VPN\
    \ clients allow the remote PC to access the corporate network\n   over VPN and\
    \ all other subnets directly without routing through the\n   VPN.  Such a configuration\
    \ is termed as \"Split VPN\" configuration.\n   \"Split VPN\" configuration allows\
    \ the remote user to run applications\n   requiring communication with hosts at\
    \ the remote site or the public\n   Internet, as well as hosts at the corporate\
    \ intranet, unless there is\n   address overlap with the remote subnet.  Applications\
    \ needing access\n   to the hosts at the remote site or the public Internet do\
    \ not\n   traverse the VPN, and hence are likely to have better performance\n\
    \   when compared to traversing the VPN.  This can be quite valuable for\n   latency-sensitive\
    \ applications such as Voice over IP (VoIP) and\n   interactive gaming.  If there\
    \ is no overriding security concern to\n   directly accessing hosts at the remote\
    \ site or the public Internet,\n   the VPN client on remote PC should be configured\
    \ in \"Split VPN\" mode.\n   If simultaneous connectivity to hosts at the remote\
    \ site is not\n   important, the VPN client may be configured to direct all\n\
    \   communication traffic from the remote user to the VPN.  Such a\n   configuration\
    \ is termed as \"Non-Split VPN\" configuration.  \"Non-Split\n   VPN\" configuration\
    \ ensures that all communication from the remote\n   user's PC traverses the VPN\
    \ link and is routed through the VPN\n   server, with the exception of traffic\
    \ directed to the router and DHCP\n   server at the remote site.  No other communication\
    \ takes place with\n   hosts at the remote site.  Applications needing access\
    \ to the public\n   Internet also traverse the VPN.  If the goal is to maximize\
    \ the\n   security and reliability of connectivity to the corporate network,\n\
    \   the VPN client on remote PC should be configured in \"Non-Split VPN\"\n  \
    \ mode.  \"Non-Split VPN\" configuration will minimize the likelihood of\n   access\
    \ loss to corporate hosts.\n   Recommendation-3: A VPN client on a remote PC should\
    \ be configured in\n   \"Non-Split VPN\" mode if the deployment goal is (a), or\
    \ in \"Split VPN\"\n   mode if the deployment goal is (b):\n   a) If the goal\
    \ is to maximize the security and reliability of\n      connectivity to the corporate\
    \ network, the VPN client on the\n      remote PC should be configured in \"Non-Split\
    \ VPN\" mode.  \"Non-\n      Split VPN\" mode ensures that the VPN client directs\
    \ all traffic\n      from the remote user to the VPN server (at the corporate\
    \ site),\n      with the exception of traffic directed to the router and DHCP\n\
    \      server at the remote site.\n   b) If there is no overriding security concern\
    \ to directly accessing\n      hosts at the remote site or the public Internet,\
    \ the VPN client on\n      the remote PC should be configured in \"Split VPN\"\
    \ mode.  \"Split\n      VPN\" mode ensures that only the corporate traffic is\
    \ directed over\n      the VPN.  All other traffic does not have the overhead\
    \ of\n      traversing the VPN.\n"
- title: 4.2.3.  VIP Address Conflict
  contents:
  - "4.2.3.  VIP Address Conflict\n   When the VIP address assigned to the VPN client\
    \ at the remote site is\n   in direct conflict with the IP address of the existing\
    \ network\n   interface, the VPN client might be unable to establish the VPN\n\
    \   connection.\n   Consider a scenario where the VIP address assigned by the\
    \ VPN server\n   directly matched the IP address of the networking interface at\
    \ the\n   remote site.  When the VPN client on the remote host attempts to set\n\
    \   the VIP address on a virtual adapter (specific to the remote access\n   application),\
    \ the VIP address configuration will simply fail due to\n   conflict with the\
    \ IP address of the existing network interface.  The\n   configuration failure\
    \ in turn can result in the remote access VPN\n   tunnel not being established.\n\
    \   Clearly, it is not advisable to have the VIP address overlap the IP\n   address\
    \ of the remote user's existing network interface.  As a\n   general rule, it\
    \ is not advisable for the VIP address to overlap any\n   IP address in the remote\
    \ user's local subnet, as the VPN client on\n   the remote PC might be forced\
    \ to respond to ARP requests on the\n   remote site and the VPN client might not\
    \ process the handling of ARP\n   requests gracefully.\n   Some VPN vendors offer\
    \ provisions to detect conflict of VIP addresses\n   with remote site address\
    \ space and switch between two or more address\n   pools with different subnets\
    \ so the VIP address assigned is not in\n   conflict with the address space at\
    \ remote site.  Enterprises\n   deploying VPNs that support this type of vendor\
    \ provisioning are\n   advised to configure the VPN server with a minimum of two\
    \ distinct IP\n   address pools.  However, this is not universally the case.\n\
    \   Alternately, enterprises may deploy two or more VPN servers with\n   different\
    \ address pools.  By doing so, a VPN client that detects\n   conflict of a VIP\
    \ address with the subnet at the remote site will\n   have the ability to switch\
    \ to an alternate VPN server that will not\n   conflict.\n   Recommendation-4:\
    \ Enterprises deploying remote access VPN solutions\n   are advised to adapt a\
    \ strategy of (a) or (b) to avoid VIP address\n   conflict with the subnet at\
    \ the remote site.\n   a) If the VPN server being deployed has been provisioned\
    \ to configure\n      two or more address pools, configure the VPN server with\
    \ a minimum\n      of two distinct IP address pools.\n   b) Deploy two or more\
    \ VPN servers with distinct IP address pools.  By\n      doing so, a VPN client\
    \ that detects conflicts of VIP addresses\n      with the subnet at the remote\
    \ site will have the ability to switch\n      to an alternate VPN server that\
    \ will not conflict.\n"
- title: 4.2.4.  Mistaken End Host Identity
  contents:
  - "4.2.4.  Mistaken End Host Identity\n   When \"Split VPN\" is configured on the\
    \ VPN client on a remote PC,\n   there can be a potential security threat due\
    \ to mistaken identity.\n   Say, a certain service (e.g., SMTP mail service) is\
    \ configured on\n   exactly the same IP address on both the corporate site and\
    \ the remote\n   site.  The user could unknowingly be using the service on the\
    \ remote\n   site, thereby violating the integrity and confidentiality of the\n\
    \   contents relating to that application.  Potentially, remote user mail\n  \
    \ messages could be hijacked by the ISP's mail server.\n   Enterprises deploying\
    \ remote access VPN servers should allocate\n   global IP addresses for the critical\
    \ servers the remote VPN clients\n   typically need to access.  By doing this,\
    \ even if most of the private\n   corporate network uses RFC 1918 address space,\
    \ this will ensure that\n   the remote VPN clients can always access the critical\
    \ servers\n   regardless of the private address space used at the remote attachment\n\
    \   point.  This is akin to Recommendation-1 provided in conjunction with\n  \
    \ multi-level NAT deployments.\n   Recommendation-5: When \"Split VPN\" is configured\
    \ on a VPN client of a\n   remote PC, enterprises deploying remote access VPN\
    \ servers are\n   advised to assign global IP addresses for the critical servers\
    \ the\n   remote VPN clients are likely to access.\n"
- title: 5.  Summary of Recommendations
  contents:
  - "5.  Summary of Recommendations\n   NAT vendors are advised to refer to the BEHAVE\
    \ protocol documents\n   ([BEH-UDP], [BEH-TCP], and [BEH-ICMP]) for a comprehensive\
    \ list of\n   conformance requirements for NAT devices.\n   The following is a\
    \ summary of recommendations to support the\n   unconventional NAT topologies\
    \ identified in this document.  The\n   recommendations are deployment-specific\
    \ and addressed to the\n   personnel responsible for the deployments.  These personnel\
    \ include\n   ISP administrators and enterprise IT administrators.\n   Recommendation-1:\
    \ ISPs, using NAT devices to provide connectivity to\n   customers, should assign\
    \ non-overlapping addresses to servers\n   advertised to customers.  One way to\
    \ do this would be to assign\n   global addresses to advertised servers.\n   Recommendation-2:\
    \ A VPN client on a remote PC should be configured\n   such that IP packets whose\
    \ target IP address matches *any* of (a) or\n   (b) are disallowed to be redirected\
    \ over the VPN:\n   a) IP address of the VPN client's next-hop router, used to\
    \ access the\n      VPN server.\n   b) IP address of the DHCP server, providing\
    \ address lease on the\n      remote host network interface.\n   Recommendation-3:\
    \ A VPN client on a remote PC should be configured in\n   \"Non-Split VPN\" mode\
    \ if the deployment goal is (a), or in \"Split VPN\"\n   mode if the deployment\
    \ goal is (b):\n   a) If the goal is to maximize the security and reliability\
    \ of\n      connectivity to the corporate network, the VPN client on the\n   \
    \   remote PC should be configured in \"Non-Split VPN\" mode.  \"Non-\n      Split\
    \ VPN\" mode ensures that the VPN client directs all traffic\n      from the remote\
    \ user to the VPN server (at the corporate site),\n      with the exception of\
    \ traffic directed to the router and DHCP\n      server at the remote site.\n\
    \   b) If there is no overriding security concern to directly accessing\n    \
    \  hosts at the remote site or the public Internet, the VPN client on\n      the\
    \ remote PC should be configured in \"Split VPN\" mode.  \"Split\n      VPN\"\
    \ mode ensures that only the corporate traffic is directed over\n      the VPN.\
    \  All other traffic does not have the overhead of\n      traversing the VPN.\n\
    \   Recommendation-4: Enterprises deploying remote access VPN solutions\n   are\
    \ advised to adapt a strategy of (a) or (b) to avoid VIP address\n   conflict\
    \ with the subnet at the remote site.\n   a) If the VPN server being deployed\
    \ has been provisioned to configure\n      two or more address pools, configure\
    \ the VPN server with a minimum\n      of two distinct IP address pools.\n   b)\
    \ Deploy two or more VPN servers with distinct IP address pools.  By\n      doing\
    \ so, a VPN client that detects conflicts of VIP addresses\n      with the subnet\
    \ at the remote site will have the ability to switch\n      to an alternate VPN\
    \ server that will not conflict.\n   Recommendation-5: When \"Split VPN\" is configured\
    \ on a VPN client of a\n   remote PC, enterprises deploying remote access VPN\
    \ servers are\n   advised to assign global IP addresses for the critical servers\
    \ the\n   remote VPN clients are likely to access.\n"
- title: 6.  Security Considerations
  contents:
  - "6.  Security Considerations\n   This document does not inherently create new\
    \ security issues.\n   Security issues known to DHCP servers and NAT devices are\
    \ applicable,\n   but not within the scope of this document.  Likewise, security\
    \ issues\n   specific to remote access VPN devices are also applicable to the\n\
    \   remote access VPN topology, but not within the scope of this\n   document.\
    \  The security issues reviewed here only those relevant to\n   the topologies\
    \ described in sections 2 and 3, specifically as they\n   apply to private address\
    \ space overlap in the topologies described.\n   Mistaken end host identity is\
    \ a security concern present in both\n   topologies discussed.  Mistaken end host\
    \ identity, described in\n   sections 2.2.4 and 3.2.4 for each of the topologies\
    \ reviewed,\n   essentially points the possibility of application services being\n\
    \   hijacked by the wrong application server (e.g., Mail server).\n   Security\
    \ violation due to mistaken end host identity arises\n   principally due to critical\
    \ servers being assigned RFC 1918 private\n   addresses.  The recommendation suggested\
    \ for both scenarios is to\n   assign globally unique public IP addresses for\
    \ the critical servers.\n   It is also recommended in section 2.1.2 that applications\
    \ adapt end-\n   to-end authentication and not depend on source IP address for\n\
    \   authentication.  Doing this will thwart connection hijacking and\n   denial-of-service\
    \ attacks.\n"
- title: 7.  Acknowledgements
  contents:
  - "7.  Acknowledgements\n   The authors wish to thank Dan Wing for reviewing the\
    \ document in\n   detail and making helpful suggestions in reorganizing the document\n\
    \   format.  The authors also wish to thank Ralph Droms for helping with\n   rewording\
    \ the text and Recommendation-1 in section 3.2.4 and Cullen\n   Jennings for helping\
    \ with rewording the text and Recommendation-3 in\n   section 4.2.2.\n"
- title: 8.  References
  contents:
  - '8.  References

    '
- title: 8.1.  Normative References
  contents:
  - "8.1.  Normative References\n   [BEH-ICMP]  Srisuresh, P., Ford, B., Sivakumar,\
    \ S., and S. Guha, \"NAT\n               Behavioral Requirements for ICMP\", BCP\
    \ 148, RFC 5508,\n               April 2009.\n   [BEH-TCP]   Guha, S., Ed., Biswas,\
    \ K., Ford, B., Sivakumar, S., and\n               P. Srisuresh, \"NAT Behavioral\
    \ Requirements for TCP\", BCP\n               142, RFC 5382, October 2008.\n \
    \  [BEH-UDP]   Audet, F., Ed., and C. Jennings, \"Network Address\n          \
    \     Translation (NAT) Behavioral Requirements for Unicast\n               UDP\"\
    , BCP 127, RFC 4787, January 2007.\n   [NAT-TERM]  Srisuresh, P. and M. Holdrege,\
    \ \"IP Network Address\n               Translator (NAT) Terminology and Considerations\"\
    , RFC\n               2663, August 1999.\n   [NAT-TRAD]  Srisuresh, P. and K.\
    \ Egevang, \"Traditional IP Network\n               Address Translator (Traditional\
    \ NAT)\", RFC 3022, January\n               2001.\n   [RFC1918]   Rekhter, Y.,\
    \ Moskowitz, B., Karrenberg, D., de Groot, G.,\n               and E. Lear, \"\
    Address Allocation for Private Internets\",\n               BCP 5, RFC 1918, February\
    \ 1996.\n"
- title: 8.2.  Informative References
  contents:
  - "8.2.  Informative References\n   [DHCP]      Droms, R., \"Dynamic Host Configuration\
    \ Protocol\", RFC\n               2131, March 1997.\n   [NAT-PROT]  Holdrege,\
    \ M. and P. Srisuresh, \"Protocol Complications\n               with the IP Network\
    \ Address Translator\", RFC 3027,\n               January 2001.\n   [RFC5735]\
    \   Cotton, M. and L. Vegoda, \"Special Use IPv4 Addresses\",\n              \
    \ BCP 153, RFC 5735, January 2010.\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Pyda Srisuresh\n   EMC Corporation\n   1161 San Antonio\
    \ Rd.\n   Mountain View, CA  94043\n   U.S.A.\n   Phone: +1 408 836 4773\n   EMail:\
    \ srisuresh@yahoo.com\n   Bryan Ford\n   Department of Computer Science\n   Yale\
    \ University\n   51 Prospect St.\n   New Haven, CT 06511\n   Phone: +1-203-432-1055\n\
    \   EMail: bryan.ford@yale.edu\n"
