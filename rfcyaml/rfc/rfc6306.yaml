- title: __initial_text__
  contents:
  - ''
- title: Internet Research Task Force (IRTF)                          P. Frejborg
  contents:
  - "Internet Research Task Force (IRTF)                          P. Frejborg\n  \
    \                    Hierarchical IPv4 Framework\n"
- title: Abstract
  contents:
  - "Abstract\n   This document describes a framework for how the current IPv4 address\n\
    \   space can be divided into two new address categories: a core address\n   space\
    \ (Area Locators, ALOCs) that is globally unique, and an edge\n   address space\
    \ (Endpoint Locators, ELOCs) that is regionally unique.\n   In the future, the\
    \ ELOC space will only be significant in a private\n   network or in a service\
    \ provider domain.  Therefore, a 32x32 bit\n   addressing scheme and a hierarchical\
    \ routing architecture are\n   achieved.  The hierarchical IPv4 framework is backwards\
    \ compatible\n   with the current IPv4 Internet.\n   This document also discusses\
    \ a method for decoupling the location and\n   identifier functions -- future\
    \ applications can make use of the\n   separation.  The framework requires extensions\
    \ to the existing Domain\n   Name System (DNS), the existing IPv4 stack of the\
    \ endpoints,\n   middleboxes, and routers in the Internet.  The framework can\
    \ be\n   implemented incrementally for endpoints, DNS, middleboxes, and\n   routers.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This document is not an Internet Standards Track specification;\
    \ it is\n   published for examination, experimental implementation, and\n   evaluation.\n\
    \   This document defines an Experimental Protocol for the Internet\n   community.\
    \  This document is a product of the Internet Research Task\n   Force (IRTF).\
    \  The IRTF publishes the results of Internet-related\n   research and development\
    \ activities.  These results might not be\n   suitable for deployment.  This RFC\
    \ represents the individual\n   opinion(s) of one or more members of the Routing\
    \ Research Group of\n   the Internet Research Task Force (IRTF).  Documents approved\
    \ for\n   publication by the IRSG are not a candidate for any level of Internet\n\
    \   Standard; see Section 2 of RFC 5741.\n   Information about the current status\
    \ of this document, any errata,\n   and how to provide feedback on it may be obtained\
    \ at\n   http://www.rfc-editor.org/info/rfc6306.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2011 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (http://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1. Introduction ....................................................4\n\
    \   2. Requirements Notation ...........................................7\n  \
    \ 3. Definitions of Terms ............................................7\n   4.\
    \ Hierarchical Addressing .........................................9\n   5. Intermediate\
    \ Routing Architecture ..............................11\n      5.1. Overview ..................................................11\n\
    \      5.2. Life of a hIPv4 Session ...................................15\n  \
    \ 6. Long-Term Routing Architecture .................................18\n    \
    \  6.1. Overview ..................................................19\n      6.2.\
    \ Exit, DFZ, and Approach Routing ...........................21\n   7. Decoupling\
    \ Location and Identification .........................23\n   8. ALOC Use Cases\
    \ .................................................24\n   9. Mandatory Extensions\
    \ ...........................................28\n      9.1. Overview ..................................................28\n\
    \      9.2. DNS Extensions ............................................29\n  \
    \    9.3. Extensions to the IPv4 Header .............................30\n   10.\
    \ Consequences ..................................................34\n      10.1.\
    \ Overlapping Local and Remote ELOC Prefixes/Ports .........34\n      10.2. Large\
    \ Encapsulated Packets ...............................35\n      10.3. Affected\
    \ Applications ....................................35\n      10.4. ICMP .....................................................37\n\
    \      10.5. Multicast ................................................37\n  \
    \ 11. Traffic Engineering Considerations ............................38\n    \
    \  11.1. Valiant Load-Balancing ...................................39\n   12.\
    \ Mobility Considerations .......................................40\n   13. Transition\
    \ Considerations .....................................42\n   14. Security Considerations\
    \ .......................................43\n   15. Conclusions ...................................................45\n\
    \   16. References ....................................................47\n  \
    \    16.1. Normative References .....................................47\n    \
    \  16.2. Informative References ...................................47\n   17.\
    \ Acknowlegments ................................................50\n   Appendix\
    \ A. Short Term and Future IPv4 Address Allocation Policy ..51\n   Appendix B.\
    \ Multi-Homing becomes Multi-Pathing ....................53\n   Appendix C. Incentives\
    \ and Transition Arguments ...................57\n   Appendix D. Integration with\
    \ CES Architectures ....................58\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   A Locator/Identifier Separation Protocol [LISP] presentation\
    \ from a\n   breakout session at an expo held in January, 2008, triggered a\n\
    \   research study; findings from the study are described in this\n   document.\
    \  Further studies revealed that the routing community at\n   IETF is concerned\
    \ about the scalability of the routing and addressing\n   system of the future\
    \ Internet.  The Internet Architecture Board (IAB)\n   held a Routing and Addressing\
    \ workshop on October 18-19, 2006, in\n   Amsterdam.  The outcome from the workshop\
    \ is documented in [RFC4984].\n   Also, the IRTF had established a Routing Research\
    \ Group [RRG] in 2007\n   and created some design guidelines; see [RFC6227].\n\
    \   The author of this document found the LISP approach very interesting\n   because\
    \ the IP address space is proposed to be separated into two\n   groups: Routing\
    \ Locators (RLOCs), which are present in the global\n   routing table of the Internet\
    \ called the Default-Free Zone (DFZ), and\n   Endpoint Identifiers (EIDs), which\
    \ are only present in edge networks\n   attached to the Internet.\n   The proposed\
    \ LISP architecture reduces the routing information in the\n   DFZ, but it also\
    \ introduces a new mapping system that would require a\n   caching solution at\
    \ the border routers installed between the edge\n   networks and DFZ.  EID prefixes\
    \ are not needed in the DFZ since a\n   tunneling (overlay) scheme is applied\
    \ between the border routers.  To\n   the author, this seems to be a complex architecture\
    \ that could be\n   improved by applying lessons learned from similar past architectures\n\
    \   -- in the '90s, overlay architectures were common, deployed on top of\n  \
    \ Frame Relay and ATM technologies.  Cache-based routing architectures\n   have\
    \ also been tried, for example, Ipsilon's IP Switching.  These\n   architectures\
    \ have largely been replaced by MPLS [RFC3031] for\n   several reasons -- one\
    \ being that overlay and caching solutions have\n   historically suffered from\
    \ scalability issues.  Technology has\n   certainly evolved since the '90s.  The\
    \ scalability issues of overlay\n   and caching solutions may prove to be less\
    \ relevant for modern\n   hardware and new methods; see [Revisiting_Route_Caching]\n\
    \   Nevertheless, the author has some doubt whether overlay and caching\n   will\
    \ scale well, based upon lessons learned from past overlay and\n   caching architectures.\
    \  The hierarchical IPv4 framework proposal\n   arose from the question of whether\
    \ the edge and core IP addressing\n   groupings from LISP could be used without\
    \ creating an overlay\n   solution by borrowing ideas from MPLS to develop a peer-to-peer\n\
    \   architecture.  That is, instead of tunneling, why not swap IP\n   addresses\
    \ (hereafter called locators) on a node in the DFZ?  By\n   introducing a shim\
    \ header to the IPv4 header and Realm Border Router\n   (RBR) functionality on\
    \ the network, the edge locators are no longer\n   needed in the routing table\
    \ of DFZ.\n   Two architectural options existed regarding how to assemble the\n\
    \   packet so that RBR functionality can be applied in the DFZ: the\n   packet\
    \ was assembled by either an ingress network node (similar to\n   LISP or MPLS)\
    \ or at the endpoint itself.  The major drawback in\n   assembling the packet\
    \ with a shim header at the endpoint is that the\n   endpoint's stack must be\
    \ upgraded; however, a significant advantage\n   is that the Path MTU Discovery\
    \ issue, as discussed in, e.g., LISP,\n   would not exist.  In addition, the caching\
    \ scalability issue is\n   mitigated to the greatest extent possible by pushing\
    \ caching to the\n   endpoint.\n   This approach also opened up the possibility\
    \ of extending the current\n   IP address scheme with a new dimension.  In an\
    \ MPLS network,\n   overlapping IP addresses are allowed since the forwarding\
    \ plane is\n   leveraging label information from the MPLS shim header.  By applying\n\
    \   RBR functionality, extending the current IPv4 header with a shim\n   header\
    \ and assembling the new header at endpoints, an IP network can\n   also carry\
    \ packets with overlapping edge locators, although the core\n   locators must\
    \ still be globally unique.  The location of an endpoint\n   is also no longer\
    \ described by a single address space; it is\n   described by a combination of\
    \ an edge locator and a core locator, or\n   a set of core locators.\n   Later\
    \ on, it was determined that the current 32-bit address scheme\n   can be extended\
    \ to 64 bits -- 32 bits reserved for globally unique\n   core locators and 32\
    \ bits reserved for locally unique edge locators.\n   The new 64-bit addressing\
    \ scheme is backwards compatible with the\n   currently deployed Internet addressing\
    \ scheme.\n   By making the architectural decisions described above, the foundation\n\
    \   for the hierarchical IPv4 framework was laid out.\n   Note that the hierarchical\
    \ IPv4 framework is abbreviated as hIPv4,\n   which is close to the abbreviation\
    \ of Host Identity Protocol (HIP)\n   [RFC4423].  Thus, the reader needs to pay\
    \ attention to the use of the\n   two abbreviations -- hIPv4 and HIP, which represent\
    \ two different\n   architectures.\n   Use of the hIPv4 abbreviation has caused\
    \ much confusion, but it was\n   chosen for two reasons:\n   o Hierarchical -\
    \ to emphasize that a hierarchical addressing scheme\n     is developed.  A formalized\
    \ hierarchy is achieved in the routing\n     architecture.  Some literature describes\
    \ today's Internet as\n     already using hierarchical addressing.  The author\
    \ believes that\n     this claim is not valid -- today's Internet uses one flat\
    \ address\n     space.\n     It is true that we have hierarchical routing in place.\
    \  A routing\n     architecture can consist of at least three types of areas:\
    \ stub\n     area, backbone area, and autonomous system (AS).  The current flat\n\
    \     address space is summarized or aggregated at border routers between\n  \
    \   the areas to suppress the size of a routing table.  In order to\n     carry\
    \ out summaries or aggregates of prefixes, the address space\n     must be continuous\
    \ over the areas.\n     Thus, the author concludes that the current method is\
    \ best\n     described as an aggregating addressing scheme since there are\n \
    \    address block dependencies between the areas.  Dividing addresses\n     into\
    \ edge and core locator spaces (a formalized hierarchy) opens up\n     a new dimension\
    \ -- the edge locator space can still be deployed as\n     an aggregating address\
    \ scheme on the three types of areas mentioned\n     earlier.  In hIPv4, the core\
    \ locators are combined with edge\n     locators, independent from each other\
    \ -- the two locator space\n     allocation policies are separated and no dependencies\
    \ exist between\n     the two addressing schemes in the long-term architecture.\n\
    \     A new hierarchical addressing scheme is achieved: a two-level\n     addressing\
    \ scheme describing how the endpoint is attached to the\n     local network and\
    \ also how the endpoint is attached to the\n     Internet.  This change in the\
    \ addressing scheme will enable a\n     fourth level, called the Area Locator\
    \ (ALOC) realm, at the routing\n     architecture.\n   o IPv4 - to emphasize that\
    \ the framework is still based upon the IPv4\n     addressing scheme, and is only\
    \ an evolution from the currently\n     deployed addressing scheme of the Internet.\n\
    \   While performing this research study, the author reviewed a previous\n   hierarchical\
    \ addressing and routing architecture that had been\n   proposed in the past,\
    \ the Extended Internet Protocol (EIP) [RFC1385].\n   Should the hIPv4 framework\
    \ ever be developed from a research study to\n   a standard RFC, it is recommended\
    \ that the hierarchical IPv4\n   framework name be replaced with Extended Internet\
    \ Protocol, EIP,\n   since both architectures share similarities, e.g., backwards\n\
    \   compatibility with existing deployed architecture, hierarchical\n   addressing,\
    \ etc., and the hIPv4 abbreviation can be mixed up with\n   HIP.\n   This document\
    \ is an individual contribution to the IRTF Routing\n   Research Group (RRG);\
    \ discussions between those on the mailing list\n   of the group have influenced\
    \ the framework.  The views in this\n   document are considered controversial\
    \ by the IRTF Routing Research\n   Group (RRG), but the group reached a consensus\
    \ that the document\n   should still be published.  Since consensus was not achieved\
    \ at RGG\n   regarding which proposal should be preferred -- as stated in\n  \
    \ [RFC6115]: \"The group explored a number of proposed solutions but did\n   not\
    \ reach consensus on a single best approach\" -- thus, all proposals\n   produced\
    \ within RRG can be considered controversial.\n"
- title: 2.  Requirements Notation
  contents:
  - "2.  Requirements Notation\n   The key words MUST, MUST NOT, REQUIRED, SHALL,\
    \ SHALL NOT, SHOULD,\n   SHOULD NOT, RECOMMENDED, MAY, and OPTIONAL in this document\
    \ are to be\n   interpreted as described in [RFC2119].\n"
- title: 3.  Definitions of Terms
  contents:
  - "3.  Definitions of Terms\n   This document makes use of the following terms:\n\
    \   Regional Internet Registry (RIR):\n      This is an organization overseeing\
    \ the allocation and registration\n      of Internet number resources within a\
    \ particular region of the\n      world.  Resources include IP addresses (both\
    \ IPv4 and IPv6) and\n      autonomous system numbers.\n   Locator:\n      A name\
    \ for a point of attachment within the topology at a given\n      layer.  Objects\
    \ that change their point(s) of attachment will need\n      to change their associated\
    \ locator(s).\n   Global Locator Block (GLB):\n      An IPv4 address block that\
    \ is globally unique.\n   Area Locator (ALOC):\n      An IPv4 address (/32) assigned\
    \ to locate an ALOC realm in the\n      Internet.  The ALOC is assigned by an\
    \ RIR to a service provider.\n      The ALOC is globally unique because it is\
    \ allocated from the GLB.\n   Endpoint Locator (ELOC):\n      An IPv4 address\
    \ assigned to locate an endpoint in a local network.\n      The ELOC block is\
    \ assigned by an RIR to a service provider or to\n      an enterprise.  In the\
    \ intermediate routing architecture, the ELOC\n      block is only unique in a\
    \ geographical region.  The final policy\n      of uniqueness shall be defined\
    \ by the RIRs.  In the long-term\n      routing architecture, the ELOC block is\
    \ no longer assigned by an\n      RIR; it is only unique in the local ALOC realm.\n\
    \   ALOC realm:\n      An area in the Internet with at least one attached Realm\
    \ Border\n      Router (RBR).  Also, an ALOC must be assigned to the ALOC realm.\n\
    \      The Routing Information Base (RIB) of an ALOC realm holds both\n      local\
    \ ELOC prefixes and global ALOC prefixes.  An ALOC realm\n      exchanges only\
    \ ALOC prefixes with other ALOC realms.\n   Realm Border Router (RBR):\n     \
    \ A router or node that is able to identify and process the hIPv4\n      header.\
    \  In the intermediate routing architecture, the RBR shall\n      be able to produce\
    \ a service, that is, to swap the prefixes in the\n      IP header and locator\
    \ header, and then forward the packet\n      according to the value in the destination\
    \ address field of the IP\n      header.  In the long-term routing architecture,\
    \ the RBR is not\n      required to produce the swap service.  Instead, the RBR\
    \ can make\n      use of the Forwarding Indicator field in the locator header.\
    \  Once\n      the FI-bits are processed, the RBR forwards the packet according\n\
    \      to the value in the destination address of the IP header or\n      according\
    \ to the value in the ELOC field of the locator header.\n      The RBR must have\
    \ the ALOC assigned as its locator.\n   Locator Header:\n      A 4-byte or 12-byte\
    \ field, inserted between the IP header and\n      transport protocol header.\
    \  If an identifier/locator split scheme\n      is used, the size of the locator\
    \ header is further expanded.\n   Identifier:\n      The name of an object at\
    \ a given layer.  Identifiers have no\n      topological sensitivity and do not\
    \ have to change, even if the\n      object changes its point(s) of attachment\
    \ within the network\n      topology.\n   Identifier/locator split scheme:\n \
    \     Separate identifiers used by applications from locators that are\n     \
    \ used for routing.  The exchange of identifiers can occur\n      discreetly between\
    \ endpoints that have established a session, or\n      the identifier/locator\
    \ split can be mapped at a public database.\n   Session:\n      An interactive\
    \ information exchange between endpoints that is\n      established at a certain\
    \ time and torn down at a later time.\n   Provider Independent Address Space (PI\
    \ addresses/prefixes):\n      An IPv4 address block that is assigned by a Regional\
    \ Internet\n      Registry directly to a user organization.\n   Provider Aggregatable\
    \ Address Space (PA addresses/prefixes):\n      An IPv4 address block assigned\
    \ by a Regional Internet Registry to\n      an Internet Service Provider that\
    \ can be aggregated into a single\n      route advertisement.\n   Site mobility:\n\
    \      A site wishing to change its attachment point to the Internet\n      without\
    \ changing its IP address block.\n   Endpoint mobility:\n      An endpoint moves\
    \ relatively rapidly between different networks,\n      changing its IP layer\
    \ network attachment point.\n   Subflow:\n      A flow of packets operating over\
    \ an individual path, the flow\n      forming part of a larger transport protocol\
    \ connection.\n"
- title: 4.  Hierarchical Addressing
  contents:
  - "4.  Hierarchical Addressing\n   The current IP addressing (IPv4) and the future\
    \ addressing (IPv6)\n   schemes of the Internet are unidimensional by their nature.\
    \  This\n   limitation -- the unidimensional addressing scheme -- has created\n\
    \   some roadblocks, for example, breaking end-to-end connectivity due to\n  \
    \ NAT, limited deployment of Stream Control Transmission Protocol\n   (SCTP) [RFC4960],\
    \ etc., for further growth of the Internet.\n   If we compare the Internet's current\
    \ addressing schemes to other\n   global addressing or location schemes, we notice\
    \ that the other\n   schemes use several levels in their structures.  For example,\
    \ the\n   postal system uses street address, city, and country to locate a\n \
    \  destination.  To locate a geographical site, we use longitude and\n   latitude\
    \ in the cartography system.  The other global network, the\n   Public Switched\
    \ Telephone Network (PSTN), has been built upon a\n   three-level numbering scheme\
    \ that has enabled a hierarchical\n   signaling architecture.  By expanding the\
    \ current IPv4 addressing\n   scheme from a single level to a two-level addressing\
    \ structure, most\n   of the issues discussed in [RFC4984] can be solved.  Also,\
    \ a\n   hierarchical addressing scheme would better describe the Internet we\n\
    \   have in place today.\n   Looking back, it seems that the architecture of the\
    \ Internet changed\n   quite radically from the intended architecture with the\
    \ introduction\n   of [RFC1918], which divides the hosts into three categories\
    \ and the\n   address space into two categories: globally unique and private\n\
    \   address spaces.  This idea allowed for further growth of the Internet\n  \
    \ and extended the life of the IPv4 address space, and it ended up\n   becoming\
    \ much more successful than expected.  RFC 1918 didn't solve\n   the multi-homing\
    \ requirements for endpoints providing services for\n   Internet users, that is,\
    \ multi-homed sites with globally unique IP\n   addresses at endpoints to be accessed\
    \ from the Internet.\n   Multi-homing has imposed some challenges for the routing\
    \ architecture\n   that [RRG] is addressing in [RFC6115].  Almost all proposals\
    \ in the\n   report suggest a core and edge locator separation or elimination\
    \ to\n   create a scalable routing architecture.  The core locator space can\n\
    \   be viewed to be similar to the globally unique address space, and the\n  \
    \ edge locator space similar to the private address space in RFC 1918.\n   RFC\
    \ 1918 has already demonstrated that Internet scales better with\n   the help\
    \ of categorized address spaces, that is, globally unique and\n   private address\
    \ spaces.  The RRG proposals suggest that the Internet\n   will be able to scale\
    \ even further by introducing core and edge\n   locators.  Why not then change\
    \ the addressing scheme (both IPv4 and\n   IPv6 addressing schemes, though this\
    \ document is only focusing on\n   IPv4) to better reflect the current and forthcoming\
    \ Internet routing\n   architecture?  If we continue to use a flat addressing\
    \ scheme, and\n   combine it with core (global) and edge (private) locator (address)\n\
    \   categories, the routing architecture will have to support additional\n   mechanisms,\
    \ such as NAT, tunneling, or locator rewriting with the\n   help of an identifier\
    \ to overcome the mismatch.  The result will be\n   that information is lost or\
    \ hidden for the endpoints.  With a two-\n   level addressing scheme, these additional\
    \ mechanisms can be removed\n   and core/edge locators can be used to create new\
    \ routing and\n   forwarding directives.\n   A convenient way to understand the\
    \ two-level addressing scheme of the\n   hIPv4 framework is to compare it to the\
    \ PSTN numbering scheme\n   (E.164), which uses country codes, national destination\
    \ codes, and\n   subscriber numbers.  The Area Locator (ALOC) prefix in the hIPv4\n\
    \   addressing scheme can be considered similar to the country code in\n   PSTN;\
    \ i.e., the ALOC prefix locates an area in the Internet called an\n   ALOC realm.\
    \  The Endpoint Locator (ELOC) prefixes in hIPv4 can be\n   compared to the subscriber\
    \ numbers in PSTN -- the ELOC is regionally\n   unique (in the future, locally\
    \ unique) at the attached ALOC realm.\n   The ELOC can also be attached simultaneously\
    \ to several ALOC realms.\n   By inserting the ALOC and ELOC elements as a shim\
    \ header (similar to\n   the MPLS and [RBridge] architectures) between the IPv4\
    \ header and the\n   transport protocol header, a hIPv4 header is created.  From\
    \ the\n   network point of view, the hIPv4 header \"looks and feels like\" an\n\
    \   IPv4 header, thus fulfilling some of the goals as outlined in EIP and\n  \
    \ in the early definition of [Nimrod].  The outcome is that the current\n   forwarding\
    \ plane does not need to be upgraded, though some minor\n   changes are needed\
    \ in the control plane (e.g., ICMP extensions).\n"
- title: 5.  Intermediate Routing Architecture
  contents:
  - "5.  Intermediate Routing Architecture\n   The intermediate routing architecture\
    \ is backwards compatible with\n   the currently deployed Internet; that is, the\
    \ forwarding plane\n   remains intact except that the control plane needs to be\
    \ upgraded to\n   support ICMP extensions.  The endpoint's stack needs to be upgraded,\n\
    \   and middleboxes need to be upgraded or replaced.  In order to speed\n   up\
    \ the transition phase, middleboxes might be installed in front of\n   endpoints\
    \ so that their stack upgrade can be postponed; for further\n   details, see Appendix\
    \ D.\n"
- title: 5.1.  Overview
  contents:
  - "5.1.  Overview\n   As mentioned in previous sections, the role of an Area Locator\
    \ (ALOC)\n   prefix is similar to a country code in PSTN; the ALOC prefix provides\n\
    \   a location functionality of an area within an autonomous system (AS),\n  \
    \ or an area spanning over a group of ASes, in the Internet.  An area\n   can\
    \ have several ALOC prefixes assigned, e.g., for traffic\n   engineering purposes\
    \ such as load balancing among several\n   ingress/egress points at the area.\
    \  The ALOC prefix is used for\n   routing and forwarding purposes on the Internet,\
    \ and so the ALOC\n   prefix must be globally unique and is allocated from an\
    \ IPv4 address\n   block.  This globally unique IPv4 address block is called the\
    \ Global\n   Locator Block (GLB).\n   When an area within an AS (or a group of\
    \ ASes) is assigned an ALOC\n   prefix, the area has the potential to become an\
    \ ALOC realm.  In order\n   to establish an ALOC realm, more elements, more than\
    \ just the ALOC\n   prefix, are needed.  One or multiple Realm Border Routers\
    \ (RBRs) must\n   be attached to the ALOC realm.  An RBR element is a node capable\
    \ of\n   swapping the prefixes of the IP header and the new shim header,\n   called\
    \ the locator header.  The swap service is described in detail\n   in Section\
    \ 5.2, step 3.\n   Today's routers do not support this RBR functionality.  Therefore,\n\
    \   the new functionality will most likely be developed on an external\n   device\
    \ attached to a router belonging to the ALOC realm.  The\n   external RBR might\
    \ be a server with two interfaces attached to a\n   router, the first interface\
    \ configured with the prefix of the ALOC\n   and the second with any IPv4 prefix.\
    \  The RBRs do not make use of\n   dynamic routing protocols, so neither a Forwarding\
    \ Information Base\n   (FIB) nor a cache is needed -- the RBR performs a service,\
    \ swapping\n   headers.\n   The swap service is applied on a per-packet basis,\
    \ and the\n   information needed to carry out the swap is included in the locator\n\
    \   header of the hIPv4 packet.  Thus, a standalone device with\n   sufficient\
    \ computing and I/O resources to handle the incoming traffic\n   can take the\
    \ role as an RBR.  Later on, the RBR functionality might\n   be integrated into\
    \ the forwarding plane of a router.  It is expected\n   that one RBR will not\
    \ be able to handle all the incoming traffic\n   designated for an ALOC realm\
    \ and that having a single RBR would also\n   create a potential single point\
    \ of failure in the network.\n   Therefore, several RBRs might be installed in\
    \ the ALOC realm and the\n   RBRs shall use the ALOC prefix as their locator,\
    \ and the routers\n   announce the ALOC prefix as an anycast locator within the\
    \ local ALOC\n   realm.  The ALOC prefix is advertised throughout the DFZ by BGP\n\
    \   mechanisms.  The placement of the RBRs in the network will influence\n   the\
    \ ingress traffic to the ALOC realm.\n   Since the forwarding paradigm of multicast\
    \ packets is quite different\n   from forwarding unicast packets, the multicast\
    \ functionality will\n   have an impact on the RBR.  Because the multicast RBR\
    \ (mRBR)\n   functionality is not available on today's routers, an external device\n\
    \   is needed -- later on the functionality might be integrated into the\n   routers.\
    \  The mRBR shall take the role of an anycast Rendezvous Point\n   with the Multicast\
    \ Source Discovery Protocol (MSDP) [RFC3618] and\n   Protocol Independent Multicast\
    \ (PIM) [RFC4601] capabilities, but to\n   swap headers neither a FIB nor a cache\
    \ is required.  As with the RBR,\n   the multicast hIPv4 packets are carrying\
    \ all needed information in\n   their headers in order to apply the swap service;\
    \ for details, see\n   Section 10.5.\n   The ALOC realm is not yet fully constructed.\
    \  We can now locate the\n   ALOC realm on the Internet, but to locate the endpoints\
    \ attached to\n   the ALOC realm, a new element is needed: the Endpoint Locator\
    \ (ELOC).\n   As mentioned in the previous section, the ELOC prefixes can be\n\
    \   considered similar to the subscriber numbers in PSTN.  The ELOC is\n   not\
    \ a new element but a redefinition of the current IPv4 address\n   configured\
    \ at an endpoint.  The term redefinition is applied because\n   when the hIPv4\
    \ framework is fully implemented, the global uniqueness\n   of the IPv4 addresses\
    \ is no longer valid.  A more regional address\n   allocation policy of IPv4 addresses\
    \ can be deployed, as discussed in\n   Appendix A.  The ELOC prefix will only\
    \ be used for routing and\n   forwarding purposes inside the local and remote\
    \ ALOC realms, and it\n   is not used in the intermediate ALOC realms.\n   When\
    \ an initiator is establishing a session to a responder residing\n   outside the\
    \ local ALOC realm, the value in the destination address\n   field of the IP header\
    \ of an outgoing packet is no longer the remote\n   destination address (ELOC\
    \ prefix); instead, the remote ALOC prefix is\n   installed in the destination\
    \ address field of the IP header.  Because\n   the value in the destination address\
    \ field of the IP header is\n   carrying an ALOC prefix, the intermediate ALOC\
    \ realms do not need to\n   install the ELOC prefixes of other ALOC realms in\
    \ their routing\n   tables.  It is sufficient for the intermediate ALOC realms\
    \ to carry\n   only the ALOC prefixes.\n   The outcome is that the routing tables\
    \ at each ALOC realm will be\n   reduced when the hIPV4 framework is fully implemented.\
    \  The ALOC\n   prefixes are still globally unique and must be installed in the\
    \ DFZ.\n   Thus, the service provider cannot control the growth of the ALOC\n\
    \   prefixes, but she/he can control the amount of local ELOC prefixes in\n  \
    \ her/his local ALOC realm.\n   When the hIPv4 packet arrives at the remote ALOC\
    \ realm, it is\n   forwarded to the nearest RBR, since the value in the destination\n\
    \   address field of the IP header is the remote ALOC prefix.  When the\n   RBR\
    \ has swapped the hIPv4 header, the value in the destination\n   address field\
    \ of the IP header is the remote ELOC; thus, the hIPv4\n   packet will be forwarded\
    \ to the final destination at the remote ALOC\n   realm.  An endpoint using an\
    \ ELOC prefix can be attached\n   simultaneously to two different ALOC realms\
    \ without the requirement\n   to deploy a classical multi-homing solution; for\
    \ details, see Section\n   12 and Appendix B.\n   Understanding that the addressing\
    \ structure is no longer\n   unidimensional and that a second level of hierarchy\
    \ has been added,\n   it is important to solve the problems of locating the remote\
    \ ELOC\n   (endpoint) and remote ALOC realm on the Internet, as well as\n   determining\
    \ where to assemble the header of the hIPv4 packet.  The\n   hierarchical IPv4\
    \ framework relies upon the Domain Name System needs\n   to support a new record\
    \ type so that the ALOC information can be\n   distributed to the endpoints. \
    \ To construct the header of the hIPv4\n   packet, either the endpoint or an intermediate\
    \ node (e.g., a proxy)\n   should be used.  A proxy solution is likely to prove\
    \ suboptimal due\n   to a complication induced by the proxy's need to listen to\
    \ DNS\n   messages, and a cache solution has scalability issues.\n   A better\
    \ solution is to extend the current IPv4 stack at the\n   endpoints so that the\
    \ ALOC and ELOC elements are incorporated at the\n   endpoint's stack; however,\
    \ backwards compatibility must be preserved.\n   Most applications will not be\
    \ aware of the extensions while other IP-\n   aware applications, such as Mobile\
    \ IP, SIP, IPsec AH and so on (see\n   Section 10.3) will suffer and cannot be\
    \ used outside their ALOC realm\n   when the hIPv4 framework is fully implemented,\
    \ unless they are\n   upgraded.  The reason is that the IP-aware applications\
    \ depend upon\n   the underlying network addressing structure, e.g., to identify\
    \ an\n   endpoint.\n   Note that the applications used inside the local ALOC realm\
    \ (e.g.,\n   enterprise's private network) do not need to be upgraded -- neither\n\
    \   in the intermediate nor in the long-term routing architecture.  The\n   classical\
    \ IPv4 framework is preserved in that only IP-aware\n   applications used between\
    \ ALOC realms need to be upgraded to support\n   the hIPv4 header.\n   Figure\
    \ 1 shows a conceptual overview of the intermediate routing\n   architecture.\
    \  When this architecture is in place, the ELOC space is\n   no longer globally\
    \ unique.  Instead, a regional allocation policy can\n   be implemented.  For\
    \ further details, see Appendix A.  The transition\n   from the current routing\
    \ architecture to the intermediate routing\n   architecture is discussed in Appendix\
    \ D.\n      Legend: *attachment point in the ALOC realm\n              UER=Unique\
    \ ELOC region\n              EP=Endpoint\n      |-------------------------------------------------------------|\n\
    \      |            UER1          |       |           UER2           |\n     \
    \ |-------------------------------------------------------------|\n      | Enterprise1\
    \ |    ISP1    |  ISP  |    ISP2    | Enterprise2 |\n      |  ALOC Realm | ALOC\
    \ Realm | Tier1 | ALOC Realm |  ALOC Realm |\n      |             |          \
    \  |       |            |             |\n      |   *EP       |  *RBR      |  \
    \     |  *RBR      |   *EP       |\n      |    ELOC1    |   ALOC1    |       |\
    \   ALOC2    |    ELOC4    |\n      |             |            |       |     \
    \       |             |\n      |             |   *EP      |       |   *EP    \
    \  |             |\n      |             |    ELOC2   |       |    ELOC3   |  \
    \           |\n      |             |            |       |            |       \
    \      |\n      |-------------|xxxxxxxxxxxxxx DFZ xxxxxxxxxxxxxx| ------------|\n\
    \      |     RIB     |    RIB     |  RIB  |    RIB     |    RIB      |\n     \
    \ |             |            |       |            |             |\n      |   \
    \ ALOC1    |   ALOC1    | ALOC1 |   ALOC2    |    ALOC2    |\n      |    ELOC1\
    \    |   ALOC2    | ALOC2 |   ALOC1    |    ELOC4    |\n      |             |\
    \   ELOC2    |       |   ELOC3    |             |\n      |             |   ELOC1\
    \    |       |   ELOC4    |             |\n      |             |            |\
    \       |            |             |\n      |-------------------------------------------------------------|\n\
    \             Figure 1: Intermediate routing architecture of hIPv4\n"
- title: 5.2.  Life of a hIPv4 Session
  contents:
  - "5.2.  Life of a hIPv4 Session\n   This section provides an example of a hIPv4\
    \ session between two hIPv4\n   endpoints: an initiator and a responder residing\
    \ in different ALOC\n   realms.\n   When the hIPv4 stack is assembling the packet\
    \ for transport, the\n   hIPv4 stack shall decide if a classical IPv4 or a hIPv4\
    \ header is\n   used based on the ALOC information received by a DNS reply.  If\
    \ the\n   initiator's local ALOC prefix equals the responder's ALOC prefix,\n\
    \   there is no need to use the hIPv4 header for routing purposes,\n   because\
    \ both the initiator and responder reside in the local ALOC\n   realm.  The packet\
    \ is routed according to the prefixes in the IP\n   header since the packet will\
    \ not exit the local ALOC realm.  When the\n   local ALOC prefix does not match\
    \ the remote ALOC prefix, a hIPv4\n   header must be assembled because the packet\
    \ needs to be routed to a\n   remote ALOC realm.\n   A session between two endpoints\
    \ inside an ALOC realm might use the\n   locator header -- not for routing purposes,\
    \ but to make use of\n   Valiant Load-Balancing [VLB] for multipath-enabled transport\n\
    \   protocols (see Section 11.1) or to make use of an identifier/locator\n   split\
    \ scheme (see Section 7).  When making use of VLB, the initiator\n   adds the\
    \ locator header to the packet and by setting the VLB-bits to\n   01 or 11, indicating\
    \ to the responder and intermediate routers that\n   VLB is requested for the\
    \ subflow.  Because this is an intra-ALOC\n   realm session, there is no need\
    \ to add ALOC and ELOC fields to the\n   locator header, and thus the size of\
    \ the locator header will be 4\n   bytes.\n   If an identifier/locator split scheme\
    \ is applied for the session\n   (intra-ALOC or inter-ALOC), the initiator must\
    \ set the I-bit to 1 and\n   make use of the Locator Header Length field.  Identifier/locator\n\
    \   split scheme information is inserted into the locator header after\n   the\
    \ Locator Header Length field.\n   How a hIPv4 session is established follows:\n\
    \   1. The initiator queries the DNS server.  The hIPv4 stack notices\n      that\
    \ the local and remote ALOCs do not match and therefore must\n      use the hIPv4\
    \ header for the session.  The hIPv4 stack of the\n      initiator must assemble\
    \ the packet by the following method:\n      a. Set the local IP address from\
    \ the API in the source address\n         field of the IP header.\n      b. Set\
    \ the remote IP address from the API in the ELOC field of the\n         locator\
    \ header.\n      c. Set the local ALOC prefix in the ALOC field of the locator\n\
    \         header.\n      d. Set the remote ALOC prefix in the destination address\
    \ field of\n         the IP header.\n      e. Set the transport protocol value\
    \ in the protocol field of the\n         locator header and set the hIPv4 protocol\
    \ value in the protocol\n         field of the IP header.\n      f. Set the desired\
    \ parameters in the A-, I-, S-, VLB-, and L-\n         fields of the locator header.\n\
    \      g. Set the FI-bits of the locator header to 00.\n      h. Calculate IP,\
    \ locator, and transport protocol header checksums.\n         The transport protocol\
    \ header calculation does not include the\n         locator header fields.  When\
    \ completed, the packet is\n         transmitted.\n   2. The hIPv4 packet is routed\
    \ throughout the Internet based on the\n      value in the destination address\
    \ field of the IP header.\n   3. The hIPv4 packet will reach the closest RBR of\
    \ the remote ALOC\n      realm.  When the RBR notices that the value in the destination\n\
    \      address of the IP header matches the local ALOC prefix, the RBR\n     \
    \ must:\n      a. Verify that the received packet uses the hIPv4 protocol value\n\
    \         in the protocol field of the IP header.\n      b. Verify IP, locator,\
    \ and transport protocol header checksums.\n         The transport protocol header\
    \ verification does not include the\n         locator header fields.\n      c.\
    \ Replace the source address in the IP header with the ALOC\n         prefix of\
    \ the locator header.\n      d. Replace the destination address in the IP header\
    \ with the ELOC\n         prefix of the locator header.\n      e. Replace the\
    \ ALOC prefix in the locator header with the\n         destination address of\
    \ the IP header.\n      f. Replace the ELOC prefix in the locator header with\
    \ the source\n         address of the IP header.\n      g. Set the S-field to\
    \ 1.\n      h. Decrease the Time to Live (TTL) value by one.\n      i. Calculate\
    \ IP, locator, and transport protocol header checksums.\n         The transport\
    \ header calculation does not include the locator\n         header fields.\n \
    \     j. Forward the packet according to the value in the destination\n      \
    \   address field of the IP header.\n   4. The swapped hIPv4 packet is now routed\
    \ inside the remote ALOC\n      realm based on the new value in the destination\
    \ address field of\n      the IP header to the final destination.\n   5. The responder\
    \ receives the hIPv4 packet.\n      a. The hIPv4 stack must verify that the received\
    \ packet uses the\n         hIPv4 protocol value in the protocol field of the\
    \ IP header.\n      b. Verify IP, locator, and transport protocol header checksums.\n\
    \         The transport protocol header verification does not include the\n  \
    \       locator header fields.\n   6. The hIPv4 stack of the responder must present\
    \ the following to the\n      extended IPv4 socket API:\n      a. The source address\
    \ of the IP header as the remote ALOC prefix.\n      b. The destination address\
    \ of the IP header as the local IP\n         address.\n      c. Verify that the\
    \ received ALOC prefix of the locator header\n         equals the local ALOC prefix.\n\
    \      d. The ELOC prefix of the locator header as the remote IP address.\n  \
    \ The responder's application will respond to the initiator and the\n   returning\
    \ packet will take almost the same steps, which are steps 1\n   to 6, as when\
    \ the initiator started the session.  In step 1, the\n   responder does not need\
    \ to do a DNS lookup since all information is\n   provided by the packet.\n"
- title: 6.  Long-Term Routing Architecture
  contents:
  - "6.  Long-Term Routing Architecture\n   The long-term routing architecture is\
    \ established once the forwarding\n   planes of private ALOC realms or service\
    \ providers ALOC realms\n   containing subscribers are upgraded.  The forwarding\
    \ planes of\n   transit DFZ routers do not need to be upgraded.  Why then would\n\
    \   private network or service provider administrators upgrade their\n   infrastructure?\
    \  There are two incentives:\n   o  The overlay local ALOC exit routing topology\
    \ (as discussed in\n      Section 11) can be replaced by a peer-to-peer local\
    \ ALOC exit\n      routing topology, which is simpler to operate, thus decreasing\n\
    \      operational expenditures.\n   o  Locator freedom: Once the local ALOC realm\
    \ is upgraded, the\n      enterprise or service provider can use the full 32-bit\
    \ ELOC\n      address space to remove address space constraints and to design\
    \ a\n      well-aggregated routing topology with an overdimensioned ELOC\n   \
    \   allocation policy.\n   When an enterprise or service provider upgrades the\
    \ forwarding plane\n   in their ALOC realm, the previous PI or PA address space\
    \ allocation\n   is released back to the RIR to be used for ALOC allocations in\
    \ the\n   GLB.\n"
- title: 6.1.  Overview
  contents:
  - "6.1.  Overview\n   The swap service at the RBR was added to the framework in\
    \ order to\n   provide a smooth transition from the current IPv4 framework to\
    \ the\n   hIPv4 framework; a major upgrade of the current forwarding plane is\n\
    \   avoided by the introduction of the swap service.  In the future, the\n   swap\
    \ service can be left \"as is\" in the ALOC realm, if preferred, or\n   the swap\
    \ service can be pushed towards the edge of the ALOC realm\n   when routers are\
    \ upgraded in their natural lifecycle process.\n   Once an upgrade of a router\
    \ is required because of, for example,\n   increased demand for bandwidth, the\
    \ modified forwarding plane might\n   concurrently support IPv4 and hIPv4 forwarding\
    \ -- and the swap\n   service can be pushed towards the edge and in the future\
    \ removed at\n   the ALOC realm.  This is accomplished by adding an extension\
    \ to the\n   current routing protocols, both IGP and BGP.  When an RBR receives\
    \ a\n   hIPv4 packet where the value of the destination address field in the\n\
    \   IP header matches the local ALOC prefix, the RBR will -- contrary to\n   the\
    \ tasks defined in Section 5.2, step 3 -- look up the ELOC field in\n   the locator\
    \ header and compare this prefix against the FIB.  If the\n   next-hop entry is\
    \ RBR-capable, the packet will be forwarded according\n   to the ELOC prefix.\
    \  If the next-hop is a classical IPv4 router, the\n   RBR must apply the tasks\
    \ defined in Section 5.2, step 3 and, once\n   completed, forward the packet according\
    \ to the new value in the\n   destination address field of the IP header.\n  \
    \ When all endpoints (that need to establish sessions outside the local\n   ALOC\
    \ realm) and infrastructure nodes in an ALOC realm are hIPv4-\n   capable, there\
    \ is no need to apply swap service for unicast sessions.\n   Forwarding decisions\
    \ can be based on information in the IP and\n   locator headers.  In the local\
    \ ALOC realm, packets are routed to\n   their upstream anycast or unicast ALOC\
    \ RBR according to the ALOC\n   prefix in the locator header; local ALOC exit\
    \ routing is applied\n   against the local ALOC FIB.  Remote ELOC approach routing\
    \ is applied\n   against the ELOC FIB in the remote ALOC realm.\n   Note that\
    \ IP and transport protocol headers will remain intact\n   (except for TTL values,\
    \ since the RBR is a router); only FI and LH\n   checksum values in the locator\
    \ header will alternate in local ALOC\n   exit routing mode and remote ELOC approach\
    \ routing mode.\n   Figure 2 shows a conceptual overview of the long-term hIPv4\
    \ routing\n   architecture.\n   Legend: *attachment point in the ALOC realm\n\
    \           UER=Unique ELOC region\n           EP=Endpoint\n           aRBR=anycast\
    \ RBR\n           uRBR=unicast RBR\n     |-------------------------------------------------------------|\n\
    \     |    UER1     |    UER2    |       |    UER3    |    UER4     |\n     |-------------------------------------------------------------|\n\
    \     | Enterprise1 |    ISP1    |  ISP  |    ISP2    | Enterprise2 |\n     |\
    \  ALOC Realm | ALOC Realm | Tier1 | ALOC Realm |  ALOC Realm |\n     |      \
    \       |            |       |            |             |\n     |   *EP      \
    \ |  *aRBR     |       |  *aRBR     |   *EP       |\n     |    ELOC1    |   ALOC1.1\
    \  |       |   ALOC2.1  |    ELOC4    |\n     |             |            |   \
    \    |            |             |\n     |             *uRBR        |       | \
    \       uRBR*             |\n     |             |ALOC1.2     |       |     ALOC2.2|\
    \             |\n     |             |            |       |            |      \
    \       |\n     |             |   *EP      |       |   *EP      |            \
    \ |\n     |             |    ELOC2   |       |    ELOC3   |             |\n  \
    \   |             |            |       |            |             |\n     |-------------|xxxxxxxxxxxxxx\
    \ DFZ xxxxxxxxxxxxxx|-------------|\n     |     RIB     |    RIB     |  RIB  |\
    \    RIB     |    RIB      |\n     |             |            |       |      \
    \      |             |\n     |   ALOC1.2   |   ALOC1.1  | ALOC1 |   ALOC2.1  |\
    \   ALOC2.2   |\n     |   ELOC1     |   ALOC1.2  | ALOC2 |   ALOC2.2  |   ELOC4\
    \     |\n     |             |   ALOC2    |       |   ALOC1    |             |\n\
    \     |             |   ELOC2    |       |   ELOC3    |             |\n     |\
    \             |            |       |            |             |\n     |-------------------------------------------------------------|\n\
    \              Figure 2: Long-term routing architecture of hIPv4\n   Also, the\
    \ swap service for multicast can be removed when the\n   forwarding planes are\
    \ upgraded in all consequent ALOC realms.  The\n   source's ALOC RBR sets the\
    \ FI-bits to 11, and a Reverse Path\n   Forwarding (RPF) check is hereafter applied\
    \ against the ALOC prefix\n   in the locator header.  Here, IP and transport protocol\
    \ headers will\n   not alternate.\n   A long-term evolution will provide a 32x32\
    \ bit locator space.  The\n   ALOC prefixes are allocated only to service providers;\
    \ ELOC prefixes\n   are only significant at a local ALOC realm.  An enterprise\
    \ can use a\n   32-bit locator space for its private network (the ALOC prefix\
    \ is\n   rented from the attached ISP), and an ISP can use a 32-bit ELOC space\n\
    \   to provide Internet connectivity services for its directly attached\n   customers\
    \ (residential and enterprise).\n"
- title: 6.2.  Exit, DFZ, and Approach Routing
  contents:
  - "6.2.  Exit, DFZ, and Approach Routing\n   This section provides an example of\
    \ a hIPv4 session between two hIPv4\n   endpoints: an initiator in an ALOC realm\
    \ where the forwarding plane\n   has been upgraded to support the hIPv4 framework,\
    \ and a responder\n   residing in a remote ALOC realm with the classical IPv4\
    \ forwarding\n   plane.\n   When the forwarding plane at the local ALOC realm\
    \ has been upgraded,\n   the endpoints must be informed about it; that is, extensions\
    \ to DHCP\n   are needed or the endpoints are manually configured to be notified\n\
    \   that the local ALOC realm is fully hIPv4 compliant.\n   How a hIPV4 session\
    \ is established follows:\n   1. The initiator queries the DNS server.  The hIPv4\
    \ stack notices\n      that the local and remote ALOCs do not match and therefore\
    \ must\n      use the hIPv4 header for the session.  The hIPv4 stack of the\n\
    \      initiator must assemble the packet as described in Section 5.2,\n     \
    \ step 1, except for the following:\n      g. Set the FI-bits of the locator header\
    \ to 01.\n   2. The hIPv4 packet is routed throughout the local ALOC realm\n \
    \     according to the ALOC prefix of the locator header; local ALOC\n      exit\
    \ routing is applied.\n   3. The hIPv4 packet will reach the closest RBR of the\
    \ local ALOC\n      realm.  When the RBR notices that the packet's ALOC prefix\
    \ of the\n      locator header matches the local ALOC prefix and the FI-bits are\n\
    \      set to 01, the RBR must:\n      a. Verify that the received packet uses\
    \ the hIPv4 protocol value\n         in the protocol field of the IP header.\n\
    \      b. Verify the IP and locator header checksums.\n      c. Set the FI-bits\
    \ of the locator header to 00.\n      d. Decrease the TTL value by one.\n    \
    \  e. Calculate IP and locator header checksums.\n      f. Forward the packet\
    \ according to the value in the destination\n         address field of the IP\
    \ header.\n   4. The hIPv4 packet is routed to the responder as described in\n\
    \      Section 5.2, steps 2 to 6.  DFZ routing is applied.\n   5. The responder's\
    \ application responds to the initiator and the\n      returning packet takes\
    \ almost the same steps as described in\n      Section 5.2 except for:\n   6.\
    \ The hIPv4 packet will reach the closest RBR of the initiator's\n      ALOC realm.\
    \  When the RBR notices that the value in the\n      destination address field\
    \ of the IP header matches the local ALOC\n      prefix and the FI-bits are set\
    \ to 00, the RBR must:\n      a. Verify that the received packet uses the hIPv4\
    \ protocol value\n         in the protocol field of the IP header.\n      b. Verify\
    \ the IP and locator header checksums.\n      c. Set the FI-bits of the locator\
    \ header to 10.\n      d. Decrease the TTL value by one.\n      e. Calculate IP\
    \ and locator header checksums.\n      f. Forward the packet according to the\
    \ ELOC prefix of the locator\n         header.\n   7. The hIPv4 packet is routed\
    \ throughout the initiator's ALOC realm\n      according to the ELOC prefix of\
    \ the locator header.  Remote ELOC\n      approach routing is applied.\n   8.\
    \ The hIPv4 stack of the responder must present the following to the\n      extended\
    \ IPv4 socket API:\n      a. The source address of the IP header as the remote\
    \ IP address.\n      b. The destination address of the IP header as the local\
    \ ALOC\n         prefix.\n      c. The ALOC prefix of the locator header as the\
    \ remote ALOC\n         prefix.\n      d. The ELOC prefix of the locator header\
    \ as the local IP address.\n"
- title: 7.  Decoupling Location and Identification
  contents:
  - "7.  Decoupling Location and Identification\n   The design guidelines and rationale\
    \ behind decoupling the location\n   from identification are stated in [RFC6227].\
    \  Another important\n   influence source is the report and presentations from\
    \ the [Dagstuhl]\n   workshop that declared \"a future Internet architecture must\
    \ hence\n   decouple the functions of IP addresses as names, locators, and\n \
    \  forwarding directives in order to facilitate the growth and new\n   network-topological\
    \ dynamisms of the Internet\".\n   Therefore, identifier elements need to be added\
    \ to the hIPv4\n   framework to provide a path for future applications to be able\
    \ to\n   remove the current dependency on the underlying network layer\n   addressing\
    \ scheme (local and remote IP address tuple).\n   However, there are various ways\
    \ to apply an identifier/locator split,\n   as discussed in an [ID/loc_Split]\
    \ presentation from the MobiArch\n   workshop at Sigcomm 2008.  Thus, the hIPv4\
    \ framework will not propose\n   or define a single identifier/locator split solution;\
    \ a split can be\n   achieved by, for example, a multipath transport protocol\
    \ or by an\n   identifier/locator database scheme such as HIP.  A placeholder\
    \ has\n   been added to the locator header so identifier/locator split schemes\n\
    \   can be integrated into the hIPv4 framework.  But identifier/locator\n   split\
    \ schemes may cause privacy inconveniences, as discussed in\n   [Mobility_&_Privacy].\n\
    \   Multipath transport protocols, such as SCTP and the currently under\n   development\
    \ Multipath TCP (MPTCP) [RFC6182], are the most interesting\n   candidates to\
    \ enable an identifier/locator split for the hIPv4\n   framework.  MPTCP is especially\
    \ interesting from hIPv4's point of\n   view; one of the main goals of MPTCP is\
    \ to provide backwards\n   compatibility with current implementations: hIPv4 shares\
    \ the same\n   goal.\n   MPTCP itself does not provide an identifier/locator database\
    \ scheme\n   as HIP does.  Instead, MPTCP is proposing a token -- with local\n\
    \   meaning -- to manage and bundle subflows under one session between\n   two\
    \ endpoints.  The token can be considered to have the\n   characteristics of a\
    \ session identifier, providing a generic cookie\n   mechanism for the application\
    \ layer and creating a session layer\n   between the application and transport\
    \ layers.  Thus, the use of a\n   session identifier will provide a mechanism\
    \ to improve mobility, both\n   in site and endpoint mobility scenarios.\n   Since\
    \ the session identifier improves site and endpoint mobility,\n   routing scalability\
    \ is improved by introducing a hierarchical\n   addressing scheme, why then add\
    \ an identifier/locator database scheme\n   to the hIPv4 framework?  Introducing\
    \ an identifier/locator database\n   scheme, as described in HIP, Identifier/Locator\
    \ Network Protocol\n   [ILNP] and Name-Based Sockets [NBS], might ease or remove\
    \ the locator\n   renumbering dependencies at firewalls that are used to scope\
    \ security\n   zones, but this approach would fundamentally change the currently\n\
    \   deployed security architecture.\n   However, combining an identifier/locator\
    \ database scheme with DNS\n   Security (DNSSEC) [RFC4033] is interesting.  Today,\
    \ security zones\n   are scoped by using locator prefixes in the security rule\
    \ sets.\n   Instead, a Fully Qualified Domain Name (FQDN) could be used in the\n\
    \   rule sets and the renumbering of locator prefixes would no longer\n   depend\
    \ upon the security rule sets in firewalls.  Another interesting\n   aspect is\
    \ that an FQDN is and needs to be globally unique.  The ALOC\n   prefix must be\
    \ globally unique, but ELOC prefixes are only regionally\n   unique and in the\
    \ long-term only locally unique.  Nevertheless,\n   combining identifier/locator\
    \ database schemes with security\n   architectures and DNSSEC needs further study.\n\
    \   In order to provide multi-homing and mobility capabilities for single\n  \
    \ path transport protocols such as TCP and UDP, an identifier/locator\n   database\
    \ scheme is needed.  This scheme can also be used to create a\n   bidirectional\
    \ NAT traversal solution with a locator translation map\n   consisting of private\
    \ locator prefixes and public identifiers at the\n   border router.\n   The hIPv4\
    \ routing architecture provides only location information for\n   the endpoints;\
    \ that is, the ELOC describes how the endpoint is\n   attached to the local network,\
    \ and the ALOC prefixes describe how the\n   endpoint is attached to the Internet.\
    \  Identifier/locator split\n   schemes are decoupled from the routing architecture\
    \ -- the\n   application layer may or may not make use of an identifier/locator\n\
    \   split scheme.\n"
- title: 8.  ALOC Use Cases
  contents:
  - "8.  ALOC Use Cases\n   Several ALOC use cases are explored in this section. \
    \ As mentioned in\n   Section 5.1, ALOC describes an area in the Internet that\
    \ can span\n   several autonomous systems (ASes), or if the area is equal to an\
    \ AS\n   you can say that the ALOC describes an AS.  When the ALOC describes\n\
    \   an area, it is hereafter called an anycast ALOC.\n   The ALOC can also be\
    \ used to describe a specific node between two\n   ALOC realms, e.g., a node installed\
    \ between a private and an ISP ALOC\n   realm, or between two private ALOC realms.\
    \  In this use case the ALOC\n   describes an attachment point, e.g., where a\
    \ private network is\n   attached to the Internet.  This ALOC type is hereafter\
    \ called a\n   unicast ALOC.\n   The main difference between anycast and unicast\
    \ ALOC types is:\n   o  In an anycast ALOC scenario, ELOC routing information\
    \ is shared\n      between the attached ALOC realms.\n   o  In a unicast ALOC\
    \ scenario, no ELOC routing information is shared\n      between the attached\
    \ ALOC realms.\n   Unicast ALOC functionalities should not be deployed between\
    \ private\n   and ISP ALOC realms in the intermediate routing architecture --\
    \ it\n   would require too many locators from the GLB space.  Instead, unicast\n\
    \   ALOC functionality will be used to separate private ALOC realms.\n   ALOC\
    \ space is divided into two types, a globally unique ALOC space\n   (a.k.a. GLB)\
    \ that is installed in DFZ, and a private ALOC space that\n   is used inside private\
    \ networks.  Private ALOCs use the same locator\n   space as defined in [RFC1918];\
    \ a private ALOC must be unique inside\n   the private network and not overlap\
    \ private ELOC prefixes.  Only ISPs\n   should be allowed to apply for global\
    \ ALOC prefixes.  For further\n   discussion, see Appendix A.  The ISP should\
    \ aggregate global ALOC\n   prefixes as much as possible in order to reduce the\
    \ size of the\n   routing table in DFZ.\n   When a user logs on to the enterprise's\
    \ network, the endpoint will\n   receive the following locator prefixes via provisioning\
    \ means (e.g.,\n   DHCP or manually configured):\n   o  One ELOC prefix for each\
    \ network interface.\n   o  One private ALOC prefix due to\n      -  The enterprise\
    \ has recently been merged with another enterprise\n         and overlapping ELOC\
    \ spaces exist.\n   o  Several private ALOC prefixes due to\n      -  The enterprise\
    \ network spans high-speed long-distance\n         connections.  It is well-known\
    \ that TCP cannot sustain high\n         throughput for extended periods of time.\
    \  Higher throughput\n         might be achieved by using multiple paths concurrently.\n\
    \   o  One or several global ALOC prefixes.  These ALOCs describe how the\n  \
    \    enterprise network is attached to the Internet.\n   As the user establishes\
    \ a session to a remote endpoint, DNS is\n   usually used to resolve remote locator\
    \ prefixes.  DNS will return\n   ELOC and ALOC prefixes of the remote endpoint.\
    \  If no ALOC prefixes\n   are returned, a classical IPv4 session is initiated\
    \ to the remote\n   endpoint.  When ALOC prefixes are returned, the initiator\
    \ compares\n   the ALOC prefixes with its own local ALOC prefixes (that are provided\n\
    \   via DHCP or manually configured).\n   o  If the remote ALOC prefix is from\
    \ the private ALOC space, the\n      initiator will use the given private ALOC\
    \ prefix for the session.\n   Two use cases exist to design a network to use private\
    \ ALOC\n   functionality.  The remote endpoint is far away, leveraging high-\n\
    \   speed long-distance connections, and in order to improve performance\n   for\
    \ the session a multipath transport protocol should be used.\n   The other use\
    \ case is when the remote endpoint resides in a network\n   that recently has\
    \ been merged and private ELOC [RFC1918] spaces\n   overlap if no renumbering\
    \ is applied.  One or several unicast ALOC\n   solutions are needed in the network\
    \ between the initiator and\n   responder.  For long-distance sessions with no\
    \ overlapping ELOC\n   prefixes, anycast or unicast ALOC solutions can be deployed.\n\
    \   A third use case follows; again the initiator compares returned ALOC\n   prefixes\
    \ from DNS with its own local ALOC prefixes:\n   o  If the remote ALOC prefix\
    \ is from the global ALOC space and the\n      remote ALOC doesn't match the given\
    \ global ALOC prefix, the\n      initiator will use the given global ALOC prefix\
    \ for the session.\n   In this use case the remote endpoint resides outside the\
    \ enterprise's\n   private network, and the global remote ALOC prefixes indicate\
    \ how the\n   remote network is attached to the Internet.  When a multipath\n\
    \   transport protocol is used, the subflows can be routed via separate\n   border\
    \ routers to the remote endpoint -- both at the local and remote\n   sites, if\
    \ both are multi-homed.  The initiator's egress packets in\n   the local ALOC\
    \ realm can be identified by the protocol value in the\n   IP header, routed to\
    \ an explicit path (e.g., MPLS LSP, L2TPv3 tunnel,\n   etc.) based on the ALOC\
    \ prefix in the locator header.  A local ALOC\n   overlay exit routing scheme\
    \ can be designed.  In the long-term\n   routing architecture the overlay, the\
    \ tunnel mechanism, can be\n   removed; see Section 6.2.\n   Figure 3 shows a\
    \ conceptual diagram with two endpoints having a\n   multipath session over a\
    \ VPN connection and over the Internet (in the\n   intermediate routing architecture).\n\
    \   Legend: *attachment point in the ALOC realm\n           UER=Unique ELOC region\n\
    \           EP=Endpoint\n           aRBR=anycast RBR\n           uRBR=unicast\
    \ RBR\n           BR=Border Router\n     |-------------------------------------------------------------|\n\
    \     |            UER1          |       |           UER2           |\n     |-----------------------------------------------|-------------|\n\
    \     | Enterprise1 |                                 | Enterprise2 |\n     |\
    \  ALOC Realm |                                 |  ALOC Realm |\n     |      \
    \       |---------------------------------|             |\n     |            \
    \ |              VPN                |             |\n     |             |    \
    \       ALOC Realm            |             |\n     |             *uRBR3     \
    \                  uRBR4*             |\n     |             |ALOC3           \
    \            ALOC4|             |\n     |             |xxxxxxxxxxxX VPN RIB xxxxxxxxxxxx|\
    \             |\n     |             |                                 |      \
    \       |\n     |             |           ALOC3 & ALOC4         |            \
    \ |\n     |             |---------------------------------|             |\n  \
    \   |   *EP1      |                                 |   *EP2      |\n     |  \
    \  ELOC1    |---------------------------------|    ELOC2    |\n     |        \
    \     |    ISP1    |  ISP  |    ISP2    |             |\n     |             |\
    \ ALOC Realm | Tier1 | ALOC Realm |             |\n     |             |      \
    \      |       |            |             |\n     |          BR1*  *aRBR     |\
    \       |  *aRBR     *BR2          |\n     |             |   ALOC1    |      \
    \ |   ALOC2    |             |\n     |             |            |       |    \
    \        |             |\n     |-------------|xxxxxxxxxxxxxx DFZ xxxxxxxxxxxxxx|-------------|\n\
    \     |     RIB     |    RIB     |  RIB  |    RIB     |    RIB      |\n     |\
    \             |            |       |            |             |\n     |   ALOC1\
    \     |   ALOC1    | ALOC1 |   ALOC2    |   ALOC2     |\n     |   ALOC3     |\
    \   ALOC2    | ALOC2 |   ALOC1    |   ALOC4     |\n     |   ALOC4     |   ELOC1\
    \    |       |   ELOC2    |   ALOC3     |\n     |   ELOC1     |            | \
    \      |            |   ELOC2     |\n     |             |            |       |\
    \            |             |\n     |-------------------------------------------------------------|\n\
    \             Figure 3: Multi-pathing via VPN and the Internet\n   The first subflow\
    \ is established from the initiator (EP1) via uRBR3\n   and uRBR4 (both use a\
    \ private unicast ALOC prefix) to the responder\n   (EP2).  Normal unicast forwarding\
    \ is applied; ALOC prefixes of uRBR3\n   and uRBR4 are installed in the routing\
    \ tables of both the local and\n   remote ALOC realms.  A second subflow is established\
    \ via the\n   Internet, that is, via BR1->BR2 to EP2. 0/0 exit routing is used\
    \ to\n   enter the Internet at both ALOC realms.\n   Note that ELOC prefixes can\
    \ overlap since the local and remote ALOC\n   realms reside in different ELOC\
    \ regions and are separated by private\n   unicast ALOC prefixes.\n   The fourth\
    \ use case is to leverage the private and global ALOC\n   functionalities to be\
    \ aligned with the design and implementation of\n   [Split-DNS] solutions.\n \
    \  The fifth use case is for residential users.  A residential user may\n   use\
    \ one or several ALOC prefixes, depending upon the service offer\n   and network\
    \ design of the ISP.  If the ISP prefers to offer advanced\n   support for multipath\
    \ transport protocols and local ALOC exit\n   routing, the residential user is\
    \ provided with several ALOC prefixes.\n   The ALOC provided for residential users\
    \ is taken from the GLB space\n   and anycast ALOC functionality is applied.\n"
- title: 9.  Mandatory Extensions
  contents:
  - '9.  Mandatory Extensions

    '
- title: 9.1.  Overview
  contents:
  - "9.1.  Overview\n   To implement the hierarchical IPv4 framework, some basic rules\
    \ are\n   needed:\n   1. The DNS architecture must support a new extension; an\
    \ A type\n      Resource Record should be able to associate ALOC prefixes.\n \
    \  2. An endpoint upgraded to support hIPv4 shall have information about\n   \
    \   the local ALOC prefixes; the local ALOC prefixes can be configured\n     \
    \ manually or provided via provisioning means such as DHCP.\n   3. A globally\
    \ unique IPv4 address block shall be reserved; this block\n      is called the\
    \ Global Locator Block (GLB).  A service provider can\n      have one or several\
    \ ALOC prefixes allocated from the GLB.\n   4. ALOC prefixes are announced via\
    \ current BGP to adjacent peers.\n      They are installed in the RIB of the DFZ.\
    \  When the hIPV4\n      framework is fully implemented, only ALOC prefixes are\
    \ announced\n      between the BGP peers in the DFZ.\n   5. An ALOC realm must\
    \ have one or several RBRs attached to it.  The\n      ALOC prefix is configured\
    \ as an anycast IP address on the RBR.\n      The anycast IP address is installed\
    \ to appropriate routing\n      protocols in order to be distributed to the DFZ.\n\
    \   6. The IPv4 socket API at endpoints must be extended to support local\n  \
    \    and remote ALOC prefixes.  The modified IPv4 socket API must be\n      backwards\
    \ compatible with the current IPv4 socket API.  The\n      outgoing hIPv4 packet\
    \ must be assembled by the hIPv4 stack with\n      the local IP address from the\
    \ socket as the source address and the\n      remote ALOC prefix as the destination\
    \ address in the IP header.\n      The local ALOC prefix is inserted in the ALOC\
    \ field of the locator\n      header.  The remote IP address from the socket API\
    \ is inserted in\n      the ELOC field of the locator header.\n"
- title: 9.2.  DNS Extensions
  contents:
  - "9.2.  DNS Extensions\n   Since the hierarchical IPv4 framework introduces an\
    \ extended\n   addressing scheme and because DNS serves as the \"phone book\"\
    \ for the\n   Internet, it is obvious that DNS needs a new Resource Record (RR)\n\
    \   type to serve endpoints that are upgraded to support hIPv4.  Future\n   RR\
    \ types must follow the guidelines described in [RFC3597] and\n   [RFC5395] with\
    \ the following characteristics:\n   o  Associated with the appropriate Fully\
    \ Qualified Domain Name\n      (FQDN), inserted in the NAME field.\n   o  Assigned\
    \ a new integer (QTYPE) in the TYPE field, to be assigned\n      by IANA.\n  \
    \ o  The CLASS field is set to IN.\n   o  The RDATA field is of an unknown type\
    \ as defined in [RFC3597] and\n      shall have the following format:\n      o\
    \  Preference subfield: A 16-bit integer that specifies the\n         preference\
    \ given to this RR among others associated with a\n         FQDN.  Lower values\
    \ are preferred over higher values.\n      o  ALOC subfield: A 32-bit integer\
    \ that specifies the Area Locator\n         of the associated FQDN.\n        \
    \          +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+\n               \
    \   |                 Preference                    |\n                  +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+\n\
    \                  |                                               |\n       \
    \           |                    ALOC                       |\n              \
    \    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+\n                     \
    \    Figure 4: RDATA format of the ALOC RR\n   Only endpoints that have been upgraded\
    \ to support hIPv4 shall make\n   use of the new ALOC RR. Also, there is no need\
    \ to define a new ELOC\n   RR because the A RR is used for that purpose when the\
    \ ALOC RR is\n   returned.\n"
- title: 9.3.  Extensions to the IPv4 Header
  contents:
  - "9.3.  Extensions to the IPv4 Header\n   Figure 5 shows how the locator header\
    \ is added to the current IPv4\n   header, creating a hIPv4 header.\n   0    \
    \               1                   2                   3\n   0 1 2 3 4 5 6 7\
    \ 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |Version|  IHL  |Type of Service|          Total Length         |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |         Identification        |Flags|      Fragment Offset    |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |  Time to Live |    Protocol   |         Header Checksum       |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                       Source Address                          |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                     Destination Address                       |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                    Options                    |    Padding    |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |A|I|S| FI|VLB|L|    Protocol   |         LH Checksum           |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                    Area Locator (optional)                    |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |                 Endpoint Locator (optional)                   |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \   |     LH Length (optional)    |        Padding (optional)       |\n   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \                          Figure 5: hIPv4 header\n   Version: 4 bits\n      The\
    \ Version field is identical to that of RFC 791.\n   IHL: 4 bits\n      The Internet\
    \ Header Length field is identical to that of RFC 791.\n   Type of Service: 8\
    \ bits\n      The Type of Service is identical to that of RFC 791.\n   Total Length:\
    \  16 bits\n      The Total Length field is identical to that of RFC 791.\n  \
    \ Identification:  16 bits\n      The Identification field is identical to that\
    \ of RFC 791.\n   Flags:  3 bits\n      The Flags field is identical to that of\
    \ RFC 791.\n   Fragment Offset:  13 bits\n      The Fragment Offset field is identical\
    \ to that of RFC 791.\n   Time to Live:  8 bits\n      The Time to Live field\
    \ is identical to that of RFC 791.\n   Protocol:  8 bits\n      A new protocol\
    \ number must be assigned for hIPv4.\n   Header Checksum:  16 bits\n      The\
    \ Header Checksum field is identical to that of RFC 791.\n   Source Address: 32\
    \ bits\n      The Source Address field is identical to that of RFC 791.\n   Destination\
    \ Address: 32 bits\n      The Destination Address field is identical to that of\
    \ RFC 791.\n   Options and Padding: Variable length\n      The Options and Padding\
    \ fields are identical to that of RFC 791.\n   ALOC Realm Bit, A-bit: 1 bit\n\
    \      When the initiator and responder reside in different ALOC realms,\n   \
    \   the A-bit is set to 1 and the Area and Endpoint Locator fields\n      must\
    \ be used in the locator header.  The size of the locator\n      header is 12\
    \ bytes.  When the A-bit is set to 0, the initiator and\n      responder reside\
    \ within the same ALOC realm.  The Area and\n      Endpoint Locator shall not\
    \ be used in the locator header.  The\n      size of the locator header is 4 bytes.\n\
    \   Identifier Bit, I-bit: 1 bit\n      The identifier bit is set to 1 if the\
    \ endpoint is using an\n      identifier/locator split scheme within the locator\
    \ header.  The\n      identifier/locator split scheme must indicate by how much\
    \ the size\n      of the locator header is increased.  The Locator Header Length\n\
    \      field is also added to the locator header.\n   Swap Bit, S-bit: 1 bit\n\
    \      The initiator sets the swap bit to 0 in the hIPv4 packet.  An RBR\n   \
    \   will set this bit to 1 when it is swapping the source and\n      destination\
    \ addresses of the IP header with the ALOC and ELOC\n      prefixes of the locator\
    \ header.\n   Forwarding Indicator, FI-bits: 2 bits\n      The purpose of the\
    \ Forwarding Indicator (FI) field is to provide a\n      mechanism for a future\
    \ forwarding plane to identify which\n      Forwarding Information Base (FIB)\
    \ should be used for inter-ALOC\n      realm sessions.  The new forwarding plane\
    \ will remove the swap\n      functionality of IP and locator header values for\
    \ both unicast and\n      multicast sessions.  The outcome is that the IP and\
    \ transport\n      protocol headers will remain intact and only FI and LH checksum\n\
    \      values in the locator header will alternate.  The following values\n  \
    \    are defined:\n         01: Local ALOC exit routing mode.  The initiator shall\
    \ set the\n         FI-bits to 01 and the ALOC prefix in the locator header is\
    \ used\n         to forward the packets to the RBR that is the owner of the\n\
    \         local ALOC prefix.  The RBR shall change the FI-bits to 00.\n      \
    \   00: DFZ routing mode.  The local ALOC RBR shall forward the\n         packets\
    \ according to the value in the destination address field\n         of the IP\
    \ header.  The DFZ routers shall forward the packets\n         based on the value\
    \ in the destination address field of the IP\n         header unless the destination\
    \ address matches the local ALOC\n         prefix.  When this situation occurs,\
    \ the packet enters the\n         remote ALOC realm and the remote RBR shall change\
    \ the FI-bits\n         to 10.\n         10: Remote ELOC approach routing mode.\
    \  The remote ALOC RBR and\n         following routers shall forward the packets\
    \ based on the ELOC\n         prefix in the locator header.\n         11: Inter-ALOC\
    \ RPF check mode.  The local ALOC RBR changes the\n         FI-bits to 11 and\
    \ the following inter-ALOC routers on the\n         shared tree shall apply the\
    \ RPF check against the ALOC prefix\n         in the locator header.\n   Valiant\
    \ Load-Balancing, VLB-bits: 2 bits (optional, subject for\n   further research)\n\
    \      The purpose of the Valiant Load-Balancing field is to provide a\n     \
    \ mechanism for multipath-enabled transport protocols to request\n      explicit\
    \ paths in the network for subflows, which are component\n      parts of a session\
    \ between two endpoints.  The subflow path\n      request can be set as follows:\n\
    \         00: Latency-sensitive application.  Only one single subflow\n      \
    \   (multipath not applied), the shortest path through the network\n         is\
    \ requested.\n         01: First subflow.  The shortest path or Valiant Load-Balancing\n\
    \         might be applied.\n         11: Next subflow(s).  Valiant Load-Balancing\
    \ should be applied\n   Load-Balanced, L-bit: 1 bit (optional, subject for further\
    \ research)\n      The initiator must set the L-bit to zero.  A Valiant Load-\n\
    \      Balancing-capable node can apply VLB switching for the session if\n   \
    \   the value is set to zero; if the value is set to 1, VLB switching\n      is\
    \ not allowed.  When VLB switching is applied for the session,\n      the node\
    \ applying the VLB algorithm must set the value to 1.\n   Protocol: 8 bits\n \
    \     The Protocol field is identical to that of RFC 791.\n   Locator Header Checksum:\
    \ 16 bits\n      A checksum is calculated for the locator header only.  The\n\
    \      checksum is computed at the initiator, recomputed at the RBR, and\n   \
    \   verified at the responder.  The checksum algorithm is identical to\n     \
    \ that of RFC 791.\n   Area Locator (optional): 32 bits\n      The Area Locator\
    \ is an IPv4 address assigned to locate an ALOC\n      realm in the Internet.\
    \  The ALOC is assigned by an RIR to a\n      service provider.  The ALOC is globally\
    \ unique because it is\n      allocated from the GLB.\n   Endpoint Locator (optional):\
    \ 32 bits\n      The Endpoint Locator is an IPv4 address assigned to locate an\n\
    \      endpoint in a local network.  The ELOC block is assigned by an RIR\n  \
    \    to a service provider or to an enterprise.  In the intermediate\n      routing\
    \ architecture the ELOC block is only unique in a\n      geographical region.\
    \  The final policy of uniqueness shall be\n      defined by the RIRs.  In the\
    \ long-term routing architecture the\n      ELOC block is no longer assigned by\
    \ an RIR; it is only unique in\n      the local ALOC realm.\n   Locator Header\
    \ Length (optional): 16 bits\n      The Locator Header Length is the total length\
    \ of the locator\n      header.  Locator Header Length is applied when the identifier\
    \ bit\n      is set to 1.  Identifier/locator split scheme parameters are\n  \
    \    inserted into the locator header after this field.\n   Padding (optional):\
    \ variable\n      The locator header padding is used to ensure that the locator\n\
    \      header ends on a 32-bit boundary.  The padding is zero.\n"
- title: 10.  Consequences
  contents:
  - '10.  Consequences

    '
- title: 10.1.  Overlapping Local and Remote ELOC Prefixes/Ports
  contents:
  - "10.1.  Overlapping Local and Remote ELOC Prefixes/Ports\n   Because an ELOC prefix\
    \ is only significant within the local ALOC\n   realm, there is a slight possibility\
    \ that a session between two\n   endpoints residing in separate ALOC realms might\
    \ use the same local\n   and remote ELOC prefixes.  But the session is still unique\
    \ because\n   the two processes communicating over the transport protocol form\
    \ a\n   logical session that is uniquely identifiable by the 5-tuple\n   involved,\
    \ by the combination of <protocol, local IP address, local\n   port, remote IP\
    \ address, remote port>.\n   The session might no longer be unique when two initiators\
    \ with the\n   same local ELOC prefix residing in two separate ALOC realms are\n\
    \   accessing a responder located in a third ALOC realm.  In this\n   scenario,\
    \ the possibility exists that the initiators will use the\n   same local port\
    \ value.  This situation will cause an \"identical\n   session situation\" for\
    \ the application layer.\n   To overcome this scenario, the hIPv4 stack must accept\
    \ only one\n   unique session with the help of the ALOC information.  If there\
    \ is an\n   \"identical session situation\", i.e., both initiators use the same\n\
    \   values in the 5-tuple <protocol, local IP address, local port, remote\n  \
    \ IP address, remote port>, the hIPv4 stack shall allow only the first\n   established\
    \ session to continue.  The following sessions must be\n   prohibited and the\
    \ initiator is informed by ICMP notification about\n   the \"identical session\
    \ situation\".\n   MPTCP introduces a token that is locally significant and currently\n\
    \   defined as 32 bits long.  The token will provide a sixth tuple for\n   future\
    \ applications to identify and verify the uniqueness of a\n   session.  Thus,\
    \ the probability to have an \"identical session\n   situation\" is further reduced.\
    \  By adding an identifier/locator\n   database scheme to the hIPv4 framework,\
    \ the \"identical session\n   situation\" is completely removed.\n"
- title: 10.2.  Large Encapsulated Packets
  contents:
  - "10.2.  Large Encapsulated Packets\n   Adding the locator header to an IPv4 packet\
    \ in order to create a\n   hIPv4 packet will increase the size of it, but since\
    \ the packet is\n   assembled at the endpoint it will not add complications of\
    \ the\n   current Path MTU Discovery (PMTUD) mechanism in the network.  The\n\
    \   intermediate network between two endpoints will not see any\n   difference\
    \ in the size of packets; IPv4 and hIPv4 packet sizes are\n   the same from the\
    \ network point of view.\n"
- title: 10.3.  Affected Applications
  contents:
  - "10.3.  Affected Applications\n   There are several applications that insert IP\
    \ address information to\n   the payload of a packet.  Some applications use the\
    \ IP address\n   information to create new sessions or for identification purposes.\n\
    \   Some applications collect IP address information to be used as\n   referrals.\
    \  This section tries to list the applications that need to\n   be enhanced; however,\
    \ this is by no means a comprehensive list.  The\n   applications can be divided\
    \ into five main categories:\n   o  Applications based on raw sockets - a raw\
    \ socket receives packets\n      containing the complete header, in contrast to\
    \ the other sockets\n      that only receive the payload.\n   o  Applications\
    \ needed to enable the hIPv4 framework, such as DNS and\n      DHCP databases,\
    \ which must be extended to support ALOC prefixes.\n   o  Applications that insert\
    \ IP addresses into the payload or use the\n      IP address for setting up new\
    \ sessions or for some kind of\n      identification or as referrals.  An application\
    \ belonging to this\n      category cannot set up sessions to other ALOC realms\
    \ until\n      extensions have been incorporated.  Within the local ALOC realm\n\
    \      there are no restrictions since the current IPv4 scheme is still\n    \
    \  valid.  The following applications have been identified:\n      -  SIP: IP\
    \ addresses are inserted in the SDP offers/answers, XML\n         body, Contact,\
    \ Via, maddr, Route, Record-Route SIP headers.\n      -  Mobile IP: the mobile\
    \ node uses several IP addresses during the\n         registration process.\n\
    \      -  IPsec AH: designed to detect alterations at the IP packet\n        \
    \ header.\n      -  RSVP: Resource Reservation Protocol (RSVP) messages are sent\n\
    \         hop-by-hop between RSVP-capable routers to construct an\n         explicit\
    \ path.\n      -  ICMP: notifications need to be able to incorporate ALOC\n  \
    \       information and assemble the hIPv4 header in order to be routed\n    \
    \     back to the source.\n      -  Source Specific Multicast: the receiver must\
    \ specify the source\n         address.\n      -  IGMPv3: a source-list is included\
    \ in the IGMP reports.\n   o  Applications related to security, such as firewalls,\
    \ must be\n      enhanced to support ALOC prefixes.\n   o  Applications that will\
    \ function with FQDN, but many use IP\n      addresses instead, such as ping,\
    \ traceroute, telnet, and so on.\n      The CLI syntax needs to be upgraded to\
    \ support ALOC and ELOC\n      information via the extended socket API.\n   At\
    \ first glance, it seems that a lot of applications need to be re-\n   engineered\
    \ and ported, but the situation is not all that bad.  The\n   applications used\
    \ inside the local ALOC realm (e.g., an enterprise's\n   private network) do not\
    \ need to be upgraded, neither in the\n   intermediate nor in the long-term architecture.\
    \  The classical IPv4\n   framework is preserved.  Only IP-aware applications\
    \ used between ALOC\n   realms need to be upgraded to support the hIPv4 header.\
    \  IPv6 has the\n   definitions in place of the applications mentioned above,\
    \ but the\n   migration of applications from IPv4 to IPv6 can impose some capital\n\
    \   expenditures for enterprises, especially if the applications are\n   customized\
    \ or homegrown; see [Porting_IPv4].\n   As stated earlier, hIPv4 does not require\
    \ to port applications used\n   inside a private network.  The conclusion is that,\
    \ whatever next\n   generation architecture is deployed, some applications will\
    \ suffer,\n   either during the transition period or when being re-engineered\
    \ in\n   order to be compatible with the new architecture.\n"
- title: 10.4.  ICMP
  contents:
  - "10.4.  ICMP\n   As long as the ICMP request is executed inside the local ALOC\
    \ realm,\n   the normal IPv4 ICMP mechanism can be used.  As soon as the ICMP\n\
    \   request exits the local ALOC realm, the locator header shall be used\n   in\
    \ the notifications.  Therefore, extensions to the ICMP shall be\n   implemented.\
    \  These shall be compatible with [RFC4884] and support\n   ALOC and ELOC information.\n"
- title: 10.5.  Multicast
  contents:
  - "10.5.  Multicast\n   Since local ELOC prefixes are only installed in the routing\
    \ table of\n   the local ALOC realm, there is a constraint with Reverse Path\n\
    \   Forwarding (RPF) that is used to ensure loop-free forwarding of\n   multicast\
    \ packets.  The source address of a multicast group (S,G) is\n   used against\
    \ the RPF check.  The address of the source can no longer\n   be used as a RPF\
    \ checkpoint outside the local ALOC realm.\n   To enable RPF globally for an (S,G),\
    \ the multicast-enabled RBR (mRBR)\n   must at the source's ALOC realm replace\
    \ the value of the source\n   address field in the IP header with the local ALOC\
    \ prefix for inter-\n   ALOC multicast streams.  This can be achieved if the local\
    \ RBR acts\n   also as an anycast Rendezvous Point with MSDP and PIM capabilities.\n\
    \   With these functionalities the RBR becomes a multicast-enabled RBR\n   (mRBR).\
    \  The source registers at the mRBR and a source tree is\n   established between\
    \ the source and the mRBR.  When an inter-ALOC\n   realm receiver subscribes to\
    \ the multicast group, the mRBR has to\n   swap the hIPv4 header in the following\
    \ way:\n   a. Verify that the received packet uses the hIPv4 protocol value in\n\
    \      the protocol field of the IP header.\n   b. Verify IP, locator, and transport\
    \ protocol header checksums.\n   c. Replace the source address in the IP header\
    \ with the local ALOC\n      prefix.\n   d. Set the S-field to 1.\n   e. Decrease\
    \ the TTL value by one.\n   f. Calculate IP, locator, and transport protocol header\
    \ checksums.\n      Transport protocol header calculations do not include the\
    \ locator\n      header fields.\n   g. Forward the packet to the shared multicast\
    \ tree.\n   In order for the mRBR to function as described above, the source must\n\
    \   assemble the multicast hIPv4 packet in the following way:\n   a. Set the local\
    \ IP address (S) from the API in the source address\n      field of the IP header\
    \ and in the ELOC field of the locator\n      header.\n   b. Set the multicast\
    \ address (G) from the API in the destination\n      address field of the IP header.\n\
    \   c. Set the local ALOC prefix in the ALOC field of the locator header.\n  \
    \ d. Set the transport protocol value in the protocol field of the\n      locator\
    \ header and the hIPv4 protocol value in the protocol field\n      of the IP header.\n\
    \   e. Set the desired parameters in the A-, I-, S-, VLB-, and L-fields\n    \
    \  of the locator header.\n   f. Set the FI-bits of the locator header to 00.\n\
    \   g. Calculate IP, locator, and transport protocol header checksums.\n     \
    \ Transport protocol header calculations do not include the locator\n      header\
    \ fields.  When completed, the packet is transmitted.\n   The downstream routers\
    \ from the mRBR towards the receiver will use\n   the source address (which is\
    \ the source's ALOC prefix after the mRBR)\n   in the IP header for RPF verification.\
    \  In order for the receiver to\n   create Real-time Transport Control Protocol\
    \ (RTCP) receiver reports,\n   all information is provided in the hIPv4 header\
    \ of the packet.\n   Because Source Specific Multicast (SSM) and IGMPv3 use IP\
    \ addresses\n   in the payload, both protocols need to be modified to support\
    \ the\n   hIPv4 framework.\n"
- title: 11.  Traffic Engineering Considerations
  contents:
  - "11.  Traffic Engineering Considerations\n   When the intermediate phase of the\
    \ hIPv4 framework is fully\n   implemented, ingress load balancing to an ALOC\
    \ realm can be\n   influenced by the placement of RBRs at the realm; an RBR provides\
    \ a\n   shortest path scheme.  Also, if RIR policies allow, a service\n   provider\
    \ can have several ALOCs assigned.  Hence, traffic engineering\n   and filtering\
    \ can be done with the help of ALOC prefixes.  For\n   example, sensitive traffic\
    \ can be aggregated under one ALOC prefix\n   that is not fully distributed into\
    \ the DFZ.\n   If needed, an ALOC traffic engineering solution between ALOC realms\n\
    \   might be developed, to create explicit paths that can be engineered\n   via\
    \ specific ALOC prefixes.  For example, develop a mechanism similar\n   to the\
    \ one described in [Pathlet_Routing].  Further studies are\n   needed; first it\
    \ should be evaluated whether there is demand for such\n   a solution.\n   Ingress\
    \ load balancing to a private remote ALOC realm (remote site)\n   is influenced\
    \ by how many attachment points to the Internet the site\n   uses and where the\
    \ attachment points are placed at the site.  In\n   order to apply local ALOC\
    \ exit routing, e.g., from a multi-homed\n   site, some new network nodes are\
    \ needed between the initiator and the\n   border routers of the site.\n   In\
    \ the intermediate routing architecture this is achieved by using\n   overlay\
    \ architectures such as MPLS LSP, L2TPv3 tunnels, etc.  The new\n   network node(s)\
    \ shall be able to identify hIPv4 packets, based on the\n   protocol field in\
    \ the IP header, and switch the packets to explicit\n   paths based on the ALOC\
    \ prefix in the locator header.  In the long-\n   term routing architecture the\
    \ overlay solution is replaced with a new\n   forwarding plane; see Section 6.2.\n\
    \   Together with a multipath transport protocol, the subflows can be\n   routed\
    \ via specific attachment points, that is, border routers\n   sitting between\
    \ the private local/remote ALOC realms (multi-homed\n   sites) and the Internet.\
    \  Multi-homing becomes multi-pathing.  For\n   details, see Appendix B.\n"
- title: 11.1.  Valiant Load-Balancing
  contents:
  - "11.1.  Valiant Load-Balancing\n   The use of multipath-enabled transport protocols\
    \ opens up the\n   possibility to develop a new design methodology of backbone\
    \ networks,\n   based on Valiant Load-Balancing [VLB].  If two sites that are\n\
    \   connected with a single uplink to the Internet, and the endpoints are\n  \
    \ using multipath-enabled transport protocols and are attached to the\n   network\
    \ with only one interface/ELOC-prefix, both subflows will most\n   likely take\
    \ the shortest path throughout the Internet.  That is, both\n   subflows are established\
    \ over the same links and when there is\n   congestion on a link or a failure\
    \ of a link, both subflows might\n   simultaneously drop packets.  Thus, the benefit\
    \ of multi-pathing is\n   lost.\n   The \"subflows-over-same-links\" scenario\
    \ can be avoided if the\n   subflows are traffic engineered to traverse the Internet\
    \ on different\n   paths, but this is difficult to achieve by using classical\
    \ traffic\n   engineering, such as IGP tuning or MPLS-based traffic engineering.\n\
    \   By adding a mechanism to the locator header, the \"subflows-over-same-\n \
    \  links\" scenario might be avoided.\n   If the RBR functionality is deployed\
    \ on a Valiant Load-Balancing\n   enabled backbone node -- hereafter called vRBR\
    \ -- and the backbone\n   nodes are interconnected via logical full meshed connections,\
    \ Valiant\n   Load-Balancing can be applied for the subflows.  When a subflow\
    \ has\n   the appropriate bits set in the VLB-field of the locator header, the\n\
    \   first ingress vRBR shall do VLB switching of the subflow.  That is,\n   the\
    \ ingress vRBR is allowed to do VLB switching of the subflow's\n   packets if\
    \ the VLB-bits are set to 01 or 11, the L-bit is set to 0,\n   and the local ALOC\
    \ prefix of the vRBR matches the ALOC-field's\n   prefix.  If there are no ALOC\
    \ and ELOC fields in the locator header,\n   but the other fields' values are\
    \ set as described above, the vRBR\n   should apply VLB switching as well for\
    \ the subflow -- because it is\n   an intra-ALOC realm subflow belonging to a\
    \ multipath-enabled session.\n   With this combination of parameters in the locator\
    \ header, the\n   subflow is VLB switched only at the first ALOC realm and the\
    \ subflows\n   might be routed throughout the Internet on different paths.  If\
    \ VLB\n   switching is applied at every ALOC realm, this would most likely add\n\
    \   too much latency for the subflows.  The VLB switching at the first\n   ALOC\
    \ realm will not separate the subflows on the first and last mile\n   links (site\
    \ with a single uplink).  If the subflows on the first and\n   last mile link\
    \ need to be routed on separate links, the endpoints\n   should be deployed in\
    \ a multi-homed environment.  Studies on how\n   Valiant Load-Balancing is influencing\
    \ traffic patterns between\n   interconnected VLB [iVLB] backbone networks have\
    \ been done.\n   Nevertheless, more studies are needed regarding Valiant Load-\n\
    \   Balancing scenarios.\n"
- title: 12.  Mobility Considerations
  contents:
  - "12.  Mobility Considerations\n   This section considers two types of mobility\
    \ solutions: site mobility\n   and endpoint mobility.\n   Site mobility:\n   Today,\
    \ classical multi-homing is the most common solution for\n   enterprises that\
    \ wish to achieve site mobility.  Multi-homing is one\n   of the key findings\
    \ behind the growth of the DFZ RIB; see [RFC4984],\n   Sections 2.1 and 3.1.2.\
    \  The hIPv4 framework can provide a solution\n   for enterprises to have site\
    \ mobility without the requirement of\n   implementing a classical multi-homed\
    \ solution.\n   One of the reasons to deploy multi-homing is to avoid renumbering\
    \ of\n   the local infrastructure when an upstream ISP is replaced.  Thus,\n \
    \  today, PI-address blocks are deployed at enterprises.  In the\n   intermediate\
    \ routing architecture, an enterprise is allocated a\n   regional PI ELOC block\
    \ (for details, see Appendix A) that is used for\n   internal routing.  The upstream\
    \ ISP provides an ALOC prefix that\n   describes how the enterprise's network\
    \ is connected to the Internet.\n   If the enterprise wishes to switch to another\
    \ ISP, it only changes\n   the ALOC prefix at endpoints, from the previous ISP's\
    \ ALOC prefix to\n   the new ISP's ALOC prefix, without connectivity interruptions\
    \ in the\n   local network since the ALOC prefix is only used for Internet\n \
    \  connectivity -- several ALOCs can be used simultaneously at the\n   endpoints;\
    \ thus, a smooth migration from one ISP to another is\n   possible.  In the long-term\
    \ routing architecture, when the forwarding\n   plane is upgraded, the regional\
    \ PI ELOC block is returned to the RIR\n   and the enterprise can use a full 32-bit\
    \ ELOC space to design the\n   internal routing topology.\n   An enterprise can\
    \ easily become multi-homed or switch ISPs.  The\n   local ELOC block is used\
    \ for internal routing and upstream ISPs\n   provide their ALOC prefixes for Internet\
    \ connectivity.  Multi-homing\n   is discussed in detail in Appendix B.\n   Endpoint\
    \ mobility:\n   As said earlier, MPTCP is the most interesting identifier/locator\n\
    \   split scheme to solve endpoint mobility scenarios.  MPTCP introduces\n   a\
    \ token, which is locally significant and currently defined as 32\n   bits long.\
    \  The token will provide a sixth tuple to identify and\n   verify the uniqueness\
    \ of a session.  This sixth tuple -- the token --\n   does not depend upon the\
    \ underlying layer, the IP layer.  The session\n   is identified with the help\
    \ of the token and thus the application is\n   not aware when the locator parameters\
    \ are changed, e.g., during a\n   roaming situation, but it is required that the\
    \ application is not\n   making use of ELOC/ALOC information.  In multi-homed\
    \ scenarios, the\n   application can make use of ELOC information, which will\
    \ not change\n   if the endpoint is fixed to the location.\n   Security issues\
    \ arise: the token can be captured during the session\n   by, for example, a man-in-the-middle\
    \ attack.  These attacks can be\n   mitigated by applying [tcpcrypt], for example.\
    \  If the application\n   requires full protection against man-in-the-middle attacks,\
    \ the user\n   should apply the Transport Layer Security Protocol (TLS) [RFC5246]\n\
    \   for the session.\n   The most common endpoint mobility use case today is that\
    \ the\n   responder resides in the fixed network and the initiator is mobile.\n\
    \   Thus, MPTCP will provide roaming capabilities for the mobile\n   endpoint,\
    \ if both endpoints are making use of the MPTCP extension.\n   However, in some\
    \ use cases, the fixed endpoint needs to initialize a\n   session to a mobile\
    \ responder.  Therefore, Mobile IP (MIP) [RFC5944]\n   should incorporate the\
    \ hIPv4 extension -- MIP provides a rendezvous\n   service for the mobile endpoints.\n\
    \   Also, many applications provide rendezvous services for their users,\n   e.g.,\
    \ SIP, peer-to-peer, Instant Messaging services.  A generic\n   rendezvous service\
    \ solution can be provided by an identifier/locator\n   database scheme, e.g.,\
    \ HIP, ILNP, or NBS.  If desired, the user\n   (actually the application) can\
    \ make use of one of these rendezvous\n   service schemes, such as extended MIP,\
    \ some application-specific\n   rendezvous services, or a generic rendezvous service\
    \ -- or some\n   combination of them.\n   The hIPv4 framework will not define\
    \ which identifier/locator split\n   solution should be used for endpoint mobility.\
    \  The hIPv4 framework\n   is focusing on routing scalability and supports several\n\
    \   identifier/locator split solutions that can be exploited to develop\n   new\
    \ services, with the focus on endpoint mobility.\n"
- title: 13.  Transition Considerations
  contents:
  - "13.  Transition Considerations\n   The hIPv4 framework is not introducing any\
    \ new protocols that would\n   be mandatory for the transition from IPv4 to hIPv4;\
    \ instead,\n   extensions are added to existing protocols.  The hIPv4 framework\n\
    \   requires extensions to the current IPv4 stack, to infrastructure\n   systems,\
    \ and to some applications that use IP address information,\n   but the current\
    \ forwarding plane in the Internet remains intact,\n   except that a new forwarding\
    \ element (the RBR) is required to create\n   an ALOC realm.\n   Extensions to\
    \ the IPv4 stack, to infrastructure systems, and to\n   applications that make\
    \ use of IP address information can be deployed\n   in parallel with the current\
    \ IPv4 framework.  Genuine hIPv4 sessions\n   can be established between endpoints\
    \ even though the current\n   unidimensional addressing structure is still present.\n\
    \   When will the unidimensional addressing structure be replaced by a\n   hierarchical\
    \ addressing scheme and a fourth hierarchy added to the\n   routing architecture?\
    \  The author thinks there are two possible\n   tipping points:\n   o  When the\
    \ RIB of DFZ is getting close to the capabilities of\n      current forwarding\
    \ planes.  Who will pay for the upgrade?  Or will\n      the service provider\
    \ only accept ALOC prefixes from other service\n      providers and avoid capital\
    \ expenditures?\n   o  When the depletion of IPv4 addresses is causing enough\
    \ problems\n      for service providers and enterprises.\n   The biggest risk\
    \ and reason why the hIPv4 framework will not succeed\n   is the very short time\
    \ frame until the expected depletion of the IPv4\n   address space occurs -- actually\
    \ the first RIR has run out of IPv4\n   addresses during the IESG review process\
    \ of this document (April\n   2011).  Also, will enterprises give up their global\
    \ allocation of the\n   current IPv4 address block they have gained, as an IPv4\
    \ address block\n   has become an asset with an economical value.\n   The transition\
    \ requires the upgrade of endpoint's stack, and this is\n   a drawback compared\
    \ to the [CES] architectures proposed in [RFC6115].\n   A transition to an architecture\
    \ that requires the upgrade of\n   endpoint's stack is considerably slower than\
    \ an architecture that\n   requires only upgrade of some network nodes.  But the\
    \ transition\n   might not be as slow or challenging at it first seems since hIPv4\
    \ is\n   an evolution of the current deployed Internet.\n   o  Not all endpoints\
    \ need to be upgraded; the endpoints that do not\n      establish sessions to\
    \ other ALOC realms can continue to make use\n      of the classical IPv4 framework.\
    \  Also, legacy applications that\n      are used only inside a local ALOC realm\
    \ do not need to be ported\n      to another framework.  For further details,\
    \ see Appendix C.\n   o  Upgrading endpoint's stack, e.g., at critical or complicated\n\
    \      systems, will definitely take time; thus, it would be more\n      convenient\
    \ to install a middlebox in front of such systems.  It is\n      obvious that\
    \ the hIPv4 framework needs a middlebox solution to\n      speed up the transition;\
    \ combining CES architectures with the\n      hIPv4 framework might produce such\
    \ a middlebox.  For further\n      details, see Appendix D.\n   o  The framework\
    \ is incrementally deployable.  Not all endpoints in\n      the Internet need\
    \ to be upgraded before the first IPv4 block can\n      be released from a globally\
    \ unique allocation status to a\n      regionally unique allocation status.  That\
    \ is, to achieve ELOC\n      status for the prefixes used in a local network in\
    \ the\n      intermediate routing architecture, see Appendix D.  An ALOC realm\n\
    \      that wishes to achieve local unique status for its ELOC block in\n    \
    \  the long-term routing architecture does not need to wait for other\n      ALOC\
    \ realms to proceed to the same level simultaneously.  It is\n      sufficient\
    \ that the other ALOC realms have achieved the\n      intermediate routing architecture\
    \ status.  For further details,\n      see Section 6.\n"
- title: 14.  Security Considerations
  contents:
  - "14.  Security Considerations\n   Because the hIPv4 framework does not introduce\
    \ other network\n   mechanisms than a new type of border router to the currently\
    \ deployed\n   routing architecture, the best current practices for securing ISP\n\
    \   networks are still valid.  Since the DFZ will no longer contain ELOC\n   prefixes,\
    \ there are some benefits and complications regarding\n   security that need to\
    \ be taken into account.\n   The hijacking of a single ELOC prefix by longest\
    \ match from another\n   ALOC realm is no longer possible because the prefixes\
    \ are separated\n   by a locator, the ALOC.  To carry out a hijack of a certain\
    \ ELOC\n   prefix, the whole ALOC realm must be routed via a bogus ALOC realm.\n\
    \   Studies should be done with the Secure Inter-Domain Routing (SIDR)\n   working\
    \ group to determine whether the ALOC prefixes can be protected\n   from hijacking.\n\
    \   By not being able to hijack a certain ELOC prefix, there are some\n   implications\
    \ when mitigating distributed denial-of-service (DDoS)\n   attacks.  This implication\
    \ occurs especially in the long-term routing\n   architecture, e.g., when a multi-homed\
    \ enterprise is connected with\n   unicast ALOC RBRs to the ISPs.\n   One method\
    \ used today to mitigate DDoS attacks is to inject a more\n   specific prefix\
    \ (typically host prefix) to the routing table so that\n   the victim of the attack\
    \ is \"relocated\", i.e., a sinkhole is created\n   in front of the victim.  The\
    \ sinkhole may separate bogus traffic from\n   valid traffic or analyze the attack.\
    \  The challenge in the long-term\n   routing architecture is how to reroute a\
    \ specific ELOC prefix of the\n   multi-homed enterprise when the ELOC prefix\
    \ cannot be installed in\n   the ISP's routing table.\n   Creating a sinkhole\
    \ for all traffic designated to an ALOC realm might\n   be challenging and expensive,\
    \ depending on the size of the multi-\n   homed enterprise.  To have the sinkhole\
    \ at the enterprise's ALOC\n   realm may saturate the connections between the\
    \ enterprise and ISPs,\n   thus this approach is not a real option.\n   By borrowing\
    \ ideas from a service-centric networking architecture\n   [SCAFFOLD], a sinkhole\
    \ service can be created.  An example of how a\n   distributed sinkhole service\
    \ can be designed follows:\n      a. A firewall (or similar node) at the victim's\
    \ ALOC realm\n         discovers an attack.  The security staff at the enterprise\n\
    \         realizes that the amount of the incoming traffic caused by the\n   \
    \      attack is soon saturating the connections or other resources.\n       \
    \  Thus, the staff informs the upstream ISPs of the attack, also\n         about\
    \ the victim's ALOC prefix X and ELOC prefix Y.\n      b. The ISP reserves the\
    \ resources for the sinkhole service.  These\n         resources make use of ALOC\
    \ prefix Z; the resources are\n         programmed with a service ID and the victim's\
    \ X and Y prefixes.\n         The ISP informs the victim's security staff of the\
    \ service ID.\n         The ISP applies a NAT rule on their RBRs and/or hIPv4-enabled\n\
    \         routers.  The NAT rule replaces the destination address in the\n   \
    \      IP header of packets with Z when the destination address of the\n     \
    \    IP header matches X and the ELOC prefix of the locator header\n         matches\
    \ Y.  Also, the service ID is inserted to the locator\n         header; the service\
    \ ID acts as a referral for the sinkhole.  It\n         is possible that the sinkhole\
    \ serves several victims; thus, a\n         referral is needed.  PMTUD issues\
    \ must be taken into account.\n      c. The victim's inbound traffic is now routed\
    \ at the RBRs and/or\n         hIPv4-enabled routers to the sinkhole(s); the traffic\
    \ is\n         identified by the service ID.  Bogus traffic is discarded at\n\
    \         the sinkhole, for valid traffic the value of the destination\n     \
    \    address in the IP header Z is replaced with X.  By using a\n         service\
    \ ID in the analyzed packets, the enterprise is informed\n         that the packets\
    \ containing service ID are valid traffic and\n         allowed to be forwarded\
    \ to the victim.  It might be possible\n         that not all upstream ISPs are\
    \ redirecting traffic to the\n         distributed sinkholes.  Thus, traffic that\
    \ does not contain the\n         agreed service ID might be bogus.  Also, by inserting\
    \ a service\n         ID to the valid packets, overlay solutions between the routers,\n\
    \         sinkholes, and victim can be avoided.  In case the valid packet\n  \
    \       with a service ID traverses another RBR or hIPv4-enabled router\n    \
    \     containing the same NAT rule, that packet is not rerouted to\n         the\
    \ sinkhole.  The enterprise shall ensure that the victim does\n         not use\
    \ the service ID in its replies -- if the attacker\n         becomes aware of\
    \ the service ID, the sinkhole is disarmed.\n   Today, traffic is sent to sinkholes\
    \ by injecting host routes into the\n   routing table.  This method can still\
    \ be used inside an ALOC realm\n   for intra-ALOC attacks.  For attacks spanning\
    \ over several ALOC\n   realms new methods are needed; one example is described\
    \ above.  It is\n   desirable that the RBR and hIPv4-enabled routers are capable\
    \ of\n   applying NAT rules and inserting service ID to selected packets in\n\
    \   the forwarding plane.\n"
- title: 15.  Conclusions
  contents:
  - "15.  Conclusions\n   This document offers a high-level overview of the hierarchical\
    \ IPv4\n   framework that could be built in parallel with the current Internet\n\
    \   by implementing extensions at several architectures.  Implementation\n   of\
    \ the hIPv4 framework will not require a major service window break\n   in the\
    \ Internet or at the private networks of enterprises.\n   Basically, the hIPv4\
    \ framework is an evolution of the current IPv4\n   framework.\n   The transition\
    \ to hIPv4 might be attractive for enterprises since the\n   hIPv4 framework does\
    \ not create a catch-22 situation, e.g., when\n   should an application used only\
    \ inside the private network be ported\n   from IPv4 to IPv6?  Also, what is the\
    \ business justification for\n   porting the application to IPv6?  Another matter\
    \ is that when an\n   IPv4/v6 dual-stack solution is used it could impose operational\n\
    \   expenditures, especially with rule sets at firewalls -- both in front\n  \
    \ of servers and at clients.\n   If an enterprise chooses to deploy hIPv4, however,\
    \ the legacy\n   applications do not need to be ported because hIPv4 is backwards\n\
    \   compatible with the classical IPv4 framework.  This means lower costs\n  \
    \ for the enterprise, and an additional bonus is the new stack's\n   capabilities\
    \ to better serve mobility use cases.\n   But the enterprise must take the decision\
    \ soon and act promptly,\n   because the IPv4 address depletion is a reality in\
    \ the very near\n   future.  If the decision is delayed, IPv6 will arrive, and\
    \ then,\n   sooner or later, the legacy applications will need to be ported.\n\
    \   However, though this document has focused only on IPv4, a similar\n   scheme\
    \ can be deployed for IPv6 in the future, that is, creating a\n   64x64 bit locator\
    \ space.  But some benefits would have been lost at\n   the time this document\
    \ was written, such as:\n      o  Backwards compatibility with the current Internet\
    \ and therefore\n         no smooth migration plan is gained.\n      o  The locator\
    \ header, including ALOC and ELOC prefixes, would\n         have been larger,\
    \ 160 bits versus 96 bits.  And the identifier\n         (EUI-64) would always\
    \ have been present, which can be\n         considered as pros or cons, depending\
    \ upon one's view of the\n         privacy issue, as discussed in [RFC4941] and\
    \ in\n         [Mobility_& _Privacy].\n   If an enterprise prefers hIPv4 (e.g.,\
    \ due to gaining additional IPv4\n   addresses and smooth migration capabilities),\
    \ there is an\n   unintentional side effect (from the enterprise's point of view)\
    \ on\n   the routing architecture of the Internet; multi-homing becomes multi-\n\
    \   pathing, and an opportunity opens up for the service providers to\n   create\
    \ an Internet routing architecture that holds less prefixes and\n   generates\
    \ less BGP updates in DFZ than the current Internet.\n   The hIPv4 framework is\
    \ providing a new hierarchy in the routing\n   subsystem and is complementary\
    \ work to multipath-enabled transport\n   protocols (such as MPTCP and SCTP) and\
    \ service-centric networking\n   architectures (such as SCAFFOLD).  End users\
    \ and enterprises are not\n   interested in routing issues in the Internet; instead,\
    \ a holistic\n   view should be applied on the three disciplines with a focus\
    \ on new\n   service opportunities and communicated to the end users and\n   enterprises.\
    \  Then perhaps the transition request to a new routing\n   architecture will\
    \ be accepted and carried out.  However, more work is\n   needed to accomplish\
    \ a holistic framework of the three disciplines.\n"
- title: 16.  References
  contents:
  - '16.  References

    '
- title: 16.1.  Normative References
  contents:
  - "16.1.  Normative References\n   [RFC1385]   Wang, Z., \"EIP: The Extended Internet\
    \ Protocol\", RFC\n               1385, November 1992.\n   [RFC1812]   Baker,\
    \ F., Ed., \"Requirements for IP Version 4 Routers\",\n               RFC 1812,\
    \ June 1995.\n   [RFC1918]   Rekhter, Y., Moskowitz, B., Karrenberg, D., de Groot,\
    \ G.,\n               and E. Lear, \"Address Allocation for Private Internets\"\
    ,\n               BCP 5, RFC 1918, February 1996.\n   [RFC2119]   Bradner, S.,\
    \ \"Key words for use in RFCs to Indicate\n               Requirement Levels\"\
    , BCP 14, RFC 2119, March 1997.\n   [RFC3031]   Rosen, E., Viswanathan, A., and\
    \ R. Callon, \"Multiprotocol\n               Label Switching Architecture\", RFC\
    \ 3031, January 2001.\n   [RFC4033]   Arends, R., Austein, R., Larson, M., Massey,\
    \ D., and S.\n               Rose, \"DNS Security Introduction and Requirements\"\
    , RFC\n               4033, March 2005.\n   [RFC4601]   Fenner, B., Handley, M.,\
    \ Holbrook, H., and I. Kouvelas,\n               \"Protocol Independent Multicast\
    \ - Sparse Mode (PIM-SM):\n               Protocol Specification (Revised)\",\
    \ RFC 4601, August 2006.\n   [RFC4884]   Bonica, R., Gan, D., Tappan, D., and\
    \ C. Pignataro,\n               \"Extended ICMP to Support Multi-Part Messages\"\
    , RFC 4884,\n               April 2007.\n   [RFC5246]   Dierks, T. and E. Rescorla,\
    \ \"The Transport Layer Security\n               (TLS) Protocol Version 1.2\"\
    , RFC 5246, August 2008.\n   [RFC5944]   Perkins, C., Ed., \"IP Mobility Support\
    \ for IPv4,\n               Revised\", RFC 5944, November 2010.\n"
- title: 16.2.  Informative References
  contents:
  - "16.2.  Informative References\n   [CES]       Jen, D., Meisel, M., Yan, H. Massey,\
    \ D., Wang, L., Zhang,\n               B., Zhang, L., \"Towards A New Internet\
    \ Routing\n               Architecture: Arguments for Separating Edges from Transit\n\
    \               Core\", 2008, http://conferences.sigcomm.org/\n              \
    \ hotnets/2008/papers/18.pdf.\n   [Dagstuhl]  Arkko, J., Braun, M.B., Brim, S.,\
    \ Eggert, L., Vogt, C.,\n               Zhang, L., \"Perspectives Workshop: Naming\
    \ and Addressing\n               in a Future Internet\", 2009, http://www.dagstuhl.de/\n\
    \               de/programm/kalender/semhp/?semnr=09102.\n   [ID/loc_Split]\n\
    \               Thaler, D., \"Why do we really want an ID/locator split\n    \
    \           anyway?\", 2008,\n               http://conferences.sigcomm.org/sigcomm/2008/workshops/\n\
    \               mobiarch/slides/thaler.pdf.\n   [ILNP]      Atkinson, R., \"ILNP\
    \ Concept of Operations\", Work in\n               Progress, February 2011.\n\
    \   [iVLB]      Babaioff, M., Chuang, J., \"On the Optimality and\n          \
    \     Interconnection of Valiant Load-Balancing Networks\",\n               2007,\
    \ http://people.ischool.berkeley.edu/~chuang/\n               pubs/VLB-infocom07.pdf.\n\
    \   [LISP]      Farinacci, D., Fuller, V., Meyer, D., and D. Lewis,\n        \
    \       \"Locator/ID Separation Protocol\", Work in Progress, June\n         \
    \      2011.\n   [Mobility_&_Privacy]\n               Brim, S., Linsner. M., McLaughlin,\
    \ B., and K. Wierenga,\n               \"Mobility and Privacy\", Work in Progress,\
    \ March 2011.\n   [NBS]       Ubillos, J., Xu, M., Ming, Z., and C. Vogt, \"Name-Based\n\
    \               Sockets Architecture\", Work in Progress, September 2010.\n  \
    \ [Nimrod]    Chiappa, N., \"A New IP Routing and Addressing\n               Architecture\"\
    , 1991, http://ana-3.lcs.mit.edu/\n               ~jnc/nimrod/overview.txt.\n\
    \   [Pathlet_Routing]\n               Godfrey, P.G., Shenker, S., Stoica, I.,\
    \ \"Pathlet\n               Routing\", 2008,\n               http://conferences.sigcomm.org/hotnets/2008/\n\
    \               papers/17.pdf.\n   [Porting_IPv4]\n               DeLong, O.,\
    \ \"Porting IPv4 applications to dual stack,\n               with examples\",\
    \ 2010,\n               http://www.apricot.net/apricot2010/program/tutorials/\n\
    \               porting-ipv4-apps.html.\n   [RBridge]   Perlman, R., \"RBridges,\
    \ Transparent Routing\", 2004,\n               http://www.ieee-infocom.org/2004/Papers/26_1.PDF.\n\
    \   [Revisiting_Route_Caching]\n               Kim, C., Caesar, M., Gerber, A.,\
    \ Rexford, J., \"Revisiting\n               Route Caching: The World Should Be\
    \ Flat\", 2009,\n               http://www.springerlink.com/content/80w13260665v2013/.\n\
    \   [RFC3597]   Gustafsson, A., \"Handling of Unknown DNS Resource Record\n  \
    \             (RR) Types\", RFC 3597, September 2003.\n   [RFC3618]   Fenner,\
    \ B., Ed., and D. Meyer, Ed., \"Multicast Source\n               Discovery Protocol\
    \ (MSDP)\", RFC 3618, October 2003.\n   [RFC4423]   Moskowitz, R. and P. Nikander,\
    \ \"Host Identity Protocol\n               (HIP) Architecture\", RFC 4423, May\
    \ 2006.\n   [RFC4941]   Narten, T., Draves, R., and S. Krishnan, \"Privacy\n \
    \              Extensions for Stateless Address Autoconfiguration in\n       \
    \        IPv6\", RFC 4941, September 2007.\n   [RFC4960]   Stewart, R., Ed., \"\
    Stream Control Transmission Protocol\",\n               RFC 4960, September 2007.\n\
    \   [RFC4984]   Meyer, D., Ed., Zhang, L., Ed., and K. Fall, Ed., \"Report\n \
    \              from the IAB Workshop on Routing and Addressing\", RFC\n      \
    \         4984, September 2007.\n   [RFC5395]   Eastlake 3rd, D., \"Domain Name\
    \ System (DNS) IANA\n               Considerations\", RFC 5395, November 2008.\n\
    \   [RFC5880]   Katz, D. and D. Ward, \"Bidirectional Forwarding Detection\n \
    \              (BFD)\", RFC 5880, June 2010.\n   [RFC6115]   Li, T., Ed., \"Recommendation\
    \ for a Routing Architecture\",\n               RFC 6115, February 2011.\n   [RFC6182]\
    \   Ford, A., Raiciu, C., Handley, M., Barre, S., and J.\n               Iyengar,\
    \ \"Architectural Guidelines for Multipath TCP\n               Development\",\
    \ RFC 6182, March 2011.\n   [RFC6227]   Li, T., Ed., \"Design Goals for Scalable\
    \ Internet\n               Routing\", RFC 6227, May 2011.\n   [RRG]       RRG,\
    \ \"IRTF Routing Research Group Home Page\",\n               http://tools.ietf.org/group/irtf/trac/wiki/\n\
    \               RoutingResearchGroup.\n   [SCAFFOLD]  Freedman, M.J., Arye, M.,\
    \ Gopalan, P., Steven Y. Ko,\n               S.Y., Nordstrom, E., Rexford, J.,\
    \ Shue, D. \"Service-\n               Centric Networking with SCAFFOLD\", September\
    \ 2010\n               http://www.cs.princeton.edu/research/techreps/TR-885-10.\n\
    \   [Split-DNS] BIND 9 Administrator Reference Manual,\n               http://www.bind9.net/manual/bind/9.3.1/\n\
    \               Bv9ARM.ch04.html#AEN767.\n   [tcpcrypt]  Bittau, A., Hamburg,\
    \ M., Handley, M., Mazi`eres, D.,\n               Boneh, D., \"The case for ubiquitous\
    \ transport-level\n               encryption\", 2010, http://tcpcrypt.org/tcpcrypt.pdf.\n\
    \   [VLB]       Zhang-Shen, R., McKeown, N., \"Designing a Predictable\n     \
    \          Internet Backbone with Valiant Load-Balancing\", 2004,\n          \
    \     http://conferences.sigcomm.org/hotnets/\n               2004/HotNets-III%20Proceedings/zhang-shen.pdf.\n"
- title: 17.  Acknowledgments
  contents:
  - "17.  Acknowledgments\n   The active participants at the Routing Research Group\
    \ [RRG] mailing\n   list are acknowledged.  They have provided ideas, proposals,\
    \ and\n   discussions that have influenced the architecture of the hIPv4\n   framework.\
    \  The following persons, in alphabetical order, have\n   provided valuable review\
    \ input: Aki Anttila, Mohamed Boucadair, Antti\n   Jarvenpaa, Dae Young Kim, Mark\
    \ Lewis, Wes Toman, and Robin Whittle.\n   Also, during the IRSG and IESG review\
    \ process, Rajeev Koodli, Wesley\n   Eddy, Jari Arkko, and Adrian Farrel provided\
    \ valuable review input.\n   Lastly, a special thanks to Alfred Schwab from the\
    \ Poughkeepsie ITSO\n   for his editorial assistance.\n"
- title: Appendix A.  Short-Term and Future IPv4 Address Allocation Policy
  contents:
  - "Appendix A.  Short-Term and Future IPv4 Address Allocation Policy\n   In this\
    \ section, we study how the hIPv4 framework could influence the\n   IPv4 address\
    \ allocation policies to ensure that the new framework\n   will enable some reusage\
    \ of IPv4 address blocks.  It is the Regional\n   Internet Registries (RIRs) that\
    \ shall define the final policies.\n   When the intermediate routing architecture\
    \ (see Figure 1) is fully\n   implemented, every ALOC realm could have a full\
    \ IPv4 address space,\n   except the GLB, from which to allocate ELOC blocks.\
    \  There are some\n   implications, however.  In order for an enterprise to achieve\
    \ site\n   mobility, that is, to change service provider without changing its\n\
    \   ELOC scheme, the enterprise should implement an autonomous system\n   (AS)\
    \ solution with an ALOC prefix at the attachment point to the\n   service provider.\n\
    \   Larger enterprises have the resources to implement AS border routing.\n  \
    \ Most large enterprises have already implemented multi-homing\n   solutions.\
    \  Small and midsize enterprises (SMEs) may not have the\n   resources to implement\
    \ AS border routing, or the implementation\n   introduces unnecessary costs for\
    \ the SME.  Also, if every enterprise\n   needs to have an allocated ALOC prefix,\
    \ this will have an impact on\n   the RIB at the DFZ -- the RIB will be populated\
    \ with a huge number of\n   non-aggregatable ALOC prefixes.\n   It is clear that\
    \ a compromise is needed.  An SME site usually deploys\n   a single uplink to\
    \ the Internet and should be able to reserve a PI\n   ELOC block from the RIR\
    \ without being forced to create an ALOC realm,\n   that is, implement an RBR\
    \ solution and AS border routing.  Since the\n   PI ELOC block is no longer globally\
    \ unique, an SME can only reserve\n   the PI ELOC block for the region where it\
    \ is active or has its\n   attachment point to the Internet.  The attachment point\
    \ rarely\n   changes to another country; therefore, it is sufficient that the\
    \ PI\n   ELOC block is regionally unique.\n   When the enterprise replaces its\
    \ Internet service provider, it does\n   not have to change its ELOC scheme --\
    \ only the local ALOC prefix at\n   the endpoints is changed.  The internal traffic\
    \ at an enterprise does\n   not make use of the ALOC prefix.  The internal routing\
    \ uses only the\n   ELOC prefixes, and thus the internal routing and addressing\n\
    \   architectures are preserved.\n   Mergers and acquisitions of enterprises can\
    \ cause ELOC conflicts,\n   because the PI ELOC block is hereafter only regionally\
    \ unique.  If an\n   enterprise in region A acquires an enterprise in region B,\
    \ there is a\n   slight chance that both enterprises have overlapping ELOC prefixes.\n\
    \   If overlapping of ELOC prefixes occurs, the private unicast ALOC\n   solution\
    \ can be implemented to separate them -- if all affected\n   endpoints support\
    \ the hIPv4 framework.\n   Finally, residential users will receive only PA locators.\
    \  When a\n   residential user changes a service provider, she/he has to replace\n\
    \   the locators.  Since a PA ELOC block is no longer globally unique,\n   every\
    \ Internet service provider can use the PA ELOC blocks at their\n   ALOC realms;\
    \ the PA locators become kind of private locators for the\n   service providers.\n\
    \   If the forwarding planes and all hosts that establish inter-ALOC\n   realm\
    \ sessions are upgraded to support the hIPv4 framework, that is,\n   the long-term\
    \ routing architecture (see Figure 2) is implemented,\n   several interesting\
    \ possibilities occur:\n   o  The regional allocation policy for PI ELOC spaces\
    \ can be removed,\n      and the enterprise can make use of the whole IPv4 address\
    \ space\n      that is globally unique today.  The ELOC space is hereafter only\n\
    \      significant at a local ALOC realm.\n   o  In case of mergers or acquisitions\
    \ of enterprises, the private\n      unicast ALOC solution can be used to separate\
    \ overlapping ELOC\n      spaces.\n   o  The GLB space can be expanded to make\
    \ use of all 32 bits (except\n      for the blocks defined in RFC 1918) for anycast\
    \ and unicast ALOC\n      allocations; only ISPs are allowed to apply for GLB\
    \ prefixes.\n   o  The global anycast ALOC solution can be replaced with the global\n\
    \      unicast ALOC solution since the ISP and enterprise no longer need\n   \
    \   to share ELOC routing information.  Also, there is enough space in\n     \
    \ the GLB to reserve global unicast ALOC prefix(es) for every\n      enterprise.\n\
    \   o  Residential users will still use global anycast ALOC solutions,\n     \
    \ and if they change service providers, their locators need to be\n      replaced.\n\
    \   The result is that a 32x32 bit locator space is achieved.  When an\n   enterprise\
    \ replaces an ISP with another ISP, only the ALOC prefix(es)\n   is replaced at\
    \ endpoints and infrastructure nodes.  Renumbering of\n   ALOC prefixes can be\
    \ automated by, for example, DHCP and extensions\n   to IGP.\n"
- title: Appendix B.  Multi-Homing becomes Multi-Pathing
  contents:
  - "Appendix B.  Multi-Homing becomes Multi-Pathing\n   When the transition to the\
    \ intermediate routing architecture (see\n   Figure 1) is fully completed, the\
    \ RIB of an ISP that has created an\n   ALOC realm will have the following entries:\n\
    \   o  The PA ELOC blocks of directly attached customers (residential and\n  \
    \    enterprises)\n   o  The PI ELOC blocks of directly attached customers (e.g.,\n\
    \      enterprises)\n   o  The globally unique ALOC prefixes, received from other\
    \ service\n      providers\n   The ISP will not carry any PA or PI ELOC blocks\
    \ from other service\n   providers in its routing table.  In order to do routing\
    \ and\n   forwarding of packets between ISPs, only ALOC information of other\n\
    \   ISPs is needed.\n   Then, the question is how to keep the growth of ALOC reasonable?\
    \  If\n   the enterprise is using PI addresses, has an AS number, and is\n   implementing\
    \ BGP, why not apply for an ALOC prefix?\n   Classical multi-homing is causing\
    \ the biggest impact on the growth of\n   the size of the RIB in the DFZ -- so\
    \ replacing a /20 IPv4 prefix with\n   a /32 ALOC prefix will not reduce the size\
    \ of the RIB in the DFZ.\n   Most likely, the only way to prevent this from happening\
    \ is to impose\n   a yearly cost for the allocation of an ALOC prefix, except\
    \ if you are\n   a service provider that is providing access and/or transit traffic\n\
    \   for your customers.  And it is reasonable to impose a cost for\n   allocating\
    \ an ALOC prefix for the non-service providers, because when\n   an enterprise\
    \ uses an ALOC prefix, it is reserving a FIB entry\n   throughout the DFZ; the\
    \ ALOC FIB entry needs to have power, space,\n   hardware, and cooling on all\
    \ the routers in the DFZ.\n   Implementing this kind of ALOC allocating policy\
    \ will reduce the RIB\n   size in the DFZ quite well, because multi-homing will\
    \ no longer\n   increase the RIB size of the DFZ.  But this policy will have some\n\
    \   impact on the resilience behavior because by compressing routing\n   information\
    \ we will lose visibility in the network.  In today's\n   multi-homing solutions\
    \ the network always knows where the remote\n   endpoint resides.  In case of\
    \ a link or network failure, a backup\n   path is calculated and an alternative\
    \ path is found, and all routers\n   in the DFZ are aware of the change in the\
    \ topology.  This\n   functionality has off-loaded the workload of the endpoints;\
    \ they only\n   need to find the closest ingress router and the network will deliver\n\
    \   the packets to the egress router, regardless (almost) of what\n   failures\
    \ happen in the network.  And with the growth of multi-homed\n   prefixes, the\
    \ routers in the DFZ have been forced to carry greater\n   workloads, perhaps\
    \ close to their limits -- the workload between the\n   network and endpoints\
    \ is not in balance.  The conclusion is that the\n   endpoints should take more\
    \ responsibility for their sessions by\n   offloading the workload in the network.\
    \  How?  Let us walk through an\n   example.\n   A remote enterprise has been\
    \ given an ELOC block 192.168.1.0/24,\n   either via static routing or BGP announced\
    \ to the upstream service\n   providers.  The upstream service providers provide\
    \ the ALOC\n   information for the enterprise, 10.1.1.1 and 10.2.2.2.  A remote\n\
    \   endpoint has been installed and given ELOC 192.168.1.1 -- the ELOC is\n  \
    \ a locator defining where the remote endpoint is attached to the\n   remote network.\
    \  The remote endpoint has been assigned ALOCs 10.1.1.1\n   and 10.2.2.2 -- an\
    \ ALOC is a locator defining the attachment point of\n   the remote network to\
    \ the Internet.\n   The initiator (local endpoint) that has ELOC 172.16.1.1 and\
    \ ALOC\n   prefixes 10.3.3.3 and 10.4.4.4 has established a session by using\n\
    \   ALOC 10.3.3.3 to the responder (remote endpoint) at ELOC 192.168.1.1\n   and\
    \ ALOC 10.1.1.1.  That is, both networks 192.168.10/24 and\n   172.16.1.0/24 are\
    \ multi-homed.  ALOCs are not available in the\n   current IP stack's API, but\
    \ both ELOCs are seen as the local and\n   remote IP addresses in the API, so\
    \ the application will communicate\n   between IP addresses 172.16.1.1 and 192.168.1.1.\
    \  If ALOC prefixes\n   are included, the session is established between 10.3.3.3:172.16.1.1\n\
    \   and 10.1.1.1:192.168.1.1.\n   Next, a network failure occurs and the link\
    \ between the responder\n   border router (BR-R1) and service provider that owns\
    \ ALOC 10.1.1.1\n   goes down.  The border router of the initiator (BR-I3) will\
    \ not be\n   aware of the situation, because only ALOC information is exchanged\n\
    \   between service providers and ELOC information is compressed to stay\n   within\
    \ ALOC realms.  But BR-R1 will notice the link failure; BR-R1\n   could rewrite\
    \ the ALOC field in the locator header for this session\n   from 10.1.1.1 to 10.2.2.2\
    \ and send the packets to the second service\n   provider via BR-R2.  The session\
    \ between the initiator\n   10.3.3.3:172.16.1.1 and the responder 10.2.2.2:192.168.1.1\
    \ remains\n   intact because the legacy 5-tuple at the IP stack API does not\n\
    \   change.  Only the ALOC prefix of the responder has changed and this\n   information\
    \ is not shown to the application.  An assumption here is\n   that the hIPv4 stack\
    \ does accept changes of ALOC prefixes on the fly\n   (more about this later).\n\
    \   If the network link between the BR-I3 and ISP providing ALOC 10.3.3.3\n  \
    \ fails, BR-I3 could rewrite the ALOC prefix in the locator header and\n   route\
    \ the packets via BR-I4 and the session would stay up.  If there\n   is a failure\
    \ somewhere in the network, the border routers might\n   receive an ICMP destination\
    \ unreachable message (if not blocked by\n   some security functionality) and\
    \ thus try to switch the session over\n   to the other ISP by replacing the ALOC\
    \ prefixes in the hIPv4 header.\n   Or the endpoints might try themselves to switch\
    \ to the other ALOCs\n   after a certain time-out in the session.  In all session\
    \ transition\n   cases the legacy 5-tuple remains intact.\n   If border routers\
    \ or one of the endpoints changes the ALOC prefix\n   without a negotiation with\
    \ the remote endpoint, security issues\n   arise.  Can the endpoints trust the\
    \ remote endpoint when ALOC\n   prefixes are changed on the fly -- is it still\
    \ the same remote\n   endpoint or has the session been hijacked by a bogus endpoint?\
    \  The\n   obvious answer is that an identification mechanism is needed to\n \
    \  ensure that after a change in the path or a change of the attachment\n   point\
    \ of the endpoint, the endpoints are still the same.  An\n   identifier needs\
    \ to be exchanged during the transition of the\n   session.\n   Identifier/locator\
    \ split schemes have been discussed on the [RRG]\n   mailing list, for example,\
    \ multipath-enabled transport protocols and\n   identifier database schemes. \
    \ Both types of identifiers can be used\n   to protect the session from being\
    \ hijacked.  A session identifier\n   will provide a low-level security mechanism,\
    \ offering some protection\n   against hijacking of the session and also provide\
    \ mobility.  SCTP\n   uses the verification tag to identify the association; MPTCP\n\
    \   incorporates a token functionality for the same purpose -- both can\n   be\
    \ considered to fulfill the characteristics of a session identifier.\n   [tcpcrypt]\
    \ can be used to further mitigate session hijacking.  If the\n   application requires\
    \ full protection against man-in-the-middle\n   attacks, TLS should be applied\
    \ for the session.  Both transport\n   protocols are also multipath-capable. \
    \ Implementing multipath-capable\n   transport protocols in a multi-homed environment\
    \ will provide new\n   capabilities, such as:\n   o  Concurrent and separate exit/entry\
    \ paths via different attachment\n      points at multi-homed sites.\n   o  True\
    \ dynamic load-balancing, in which the endpoints do not\n      participate in\
    \ any routing protocols or do not update rendezvous\n      solutions due to network\
    \ link or node failures.\n   o  Only a single Network Interface Card (NIC) on\
    \ the endpoints is\n      required.\n   o  In case of a border router or ISP failure,\
    \ the multipath transport\n      protocol will provide resilience.\n   By adding\
    \ more intelligence at the endpoints, such as multipath-\n   enabled transport\
    \ protocols, the workload of the network is offloaded\n   and can take less responsibility\
    \ for providing visibility of\n   destination prefixes on the Internet; for example,\
    \ prefix compression\n   in the DFZ can be applied and only the attachment points\
    \ of a local\n   network need to be announced in the DFZ.  And the IP address\
    \ space no\n   longer needs to be globally unique; it is sufficient that only\
    \ a part\n   is globally unique, with the rest being only regionally unique (in\n\
    \   the long-term routing architecture, locally unique) as discussed in\n   Appendix\
    \ A.\n   The outcome is that the current multi-homing solution can migrate\n \
    \  towards a multi-pathing environment that will have the following\n   characteristics:\n\
    \   o  An AS number is not mandatory for enterprises.\n   o  BGP is not mandatory\
    \ at the enterprise's border routers; static\n      routing with Bidirectional\
    \ Forwarding Detection (BFD) [RFC5880] is\n      an option.\n   o  Allocation\
    \ of global ALOC prefixes for the enterprise should not\n      be allowed; instead,\
    \ upstream ISPs provide the global ALOC\n      prefixes for the enterprise.\n\
    \   o  MPTCP provides dynamic load-balancing without using routing\n      protocols;\
    \ several paths can be used simultaneously and thus\n      resilience is achieved.\n\
    \   o  Provides low growth of RIB entries at the DFZ.\n   o  When static routing\
    \ is used between the enterprise and the ISP:\n      -  The RIB size at the enterprise's\
    \ border routers does not depend\n         upon the size of the RIB in the DFZ\
    \ or in adjacent ISPs.\n      -  The enterprise's border router cannot cause BGP\
    \ churn in the\n         DFZ or in the adjacent ISPs' RIB.\n   o  When dynamic\
    \ routing is used between the enterprise and the ISP:\n      -  The RIB size at\
    \ the enterprise's border routers depends upon\n         the size of the RIB in\
    \ the DFZ and adjacent ISPs.\n      -  The enterprise's border router can cause\
    \ BGP churn for the\n         adjacent ISPs, but not in the DFZ.\n   o  The cost\
    \ of the border router should be less than in today's\n      multi-homing solution.\n"
- title: Appendix C.  Incentives and Transition Arguments
  contents:
  - "Appendix C.  Incentives and Transition Arguments\n   The media has announced\
    \ the meltdown of the Internet and the\n   depletion of IPv4 addresses several\
    \ times, but the potential chaos\n   has been postponed and the general public\
    \ has lost interest in these\n   announcements.  Perhaps it could be worthwhile\
    \ to find other valuable\n   arguments that the general public could be interested\
    \ in, such as:\n   o  Not all endpoints need to be upgraded, only those that are\n\
    \      directly attached to the Internet, such as portable laptops, smart\n  \
    \    mobile phones, proxies, and DMZ/frontend endpoints.  But the most\n     \
    \ critical endpoints, the backend endpoints where enterprises keep\n      their\
    \ most critical business applications, do not need to be\n      upgraded.  These\
    \ endpoints should not be reached at all from the\n      Internet, only from the\
    \ private network.  And this functionality\n      can be achieved with the hIPv4\
    \ framework, since it is backwards\n      compatible with the current IPv4 stack.\
    \  Therefore, investments in\n      legacy applications used inside an ALOC realm\
    \ are preserved.\n   o  Mobility - it is estimated that the demand for applications\
    \ that\n      perform well over the wireless access network will increase.\n \
    \     Introduction of MPTCP and identifier/locator split schemes opens\n     \
    \ up new possibilities to create new solutions and applications that\n      are\
    \ optimized for mobility.  The hIPv4 framework requires an\n      upgrade of the\
    \ endpoint's stack; if possible, the hIPv4 stack\n      should also contain MPTCP\
    \ and identifier/locator split scheme\n      features.  Applications designed\
    \ for mobility could bring\n      competitive benefits.\n   o  The intermediate\
    \ routers in the network do not need to be upgraded\n      immediately; the current\
    \ forwarding plane can still be used.  The\n      benefit is that the current\
    \ network equipment can be preserved at\n      the service providers, enterprises,\
    \ and residences (except\n      middleboxes).  This means that the carbon footprint\
    \ is a lot lower\n      compared to other solutions.  Many enterprises do have\
    \ green\n      programs and many residential users are concerned with the global\n\
    \      warming issue.\n   o  The migration from IPv4 to IPv6 (currently defined\
    \ architecture)\n      will increase the RIB and FIB throughout DFZ.  Whether\
    \ it will\n      require a new upgrade of the forwarding plane as discussed in\n\
    \      [RFC4984] is unclear.  Most likely an upgrade is needed.  The\n      outcome\
    \ of deploying IPv4 and IPv6 concurrently is that the\n      routers need to have\
    \ larger memories for the RIB and FIB -- every\n      globally unique prefix is\
    \ installed in the routers that are\n      participating in the DFZ.  Since the\
    \ enterprise reserves one or\n      several RIB/FIB entries on every router in\
    \ the DFZ, it is\n      increasing the power consumption of the Internet, thus\
    \ increasing\n      the carbon footprint.  And many enterprises are committed\
    \ to green\n      programs.  If hIPv4 is deployed, the power consumption of the\n\
    \      Internet will not grow as much as in an IPv4 to IPv6 transition\n     \
    \ scenario.\n   o  Another issue: if the migration from IPv4 to IPv6 (currently\n\
    \      defined architecture) occurs, the routers in the DFZ most likely\n    \
    \  need to be upgraded to more expensive routers, as discussed in\n      [RFC4984].\
    \  In the wealthy part of the world, where a large\n      penetration of Internet\
    \ users is already present, the service\n      providers can pass the costs of\
    \ the upgrade along to their\n      subscribers more easily.  With a \"wealthy/high\
    \ penetration\" ratio\n      the cost will not grow so much that the subscribers\
    \ would abandon\n      the Internet.  But in the less wealthy part of the world,\
    \ where\n      there is usually a lower penetration of subscribers, the cost of\n\
    \      the upgrade cannot be accepted so easily -- a \"less wealthy/low\n    \
    \  penetration\" ratio could impose a dramatic increase of the cost\n      that\
    \ needs to be passed along to the subscribers.  And thus fewer\n      subscribers\
    \ could afford to get connected to the Internet.  For\n      the global enterprises\
    \ and the enterprises in the less wealthy\n      part of the world, this scenario\
    \ could mean less potential\n      customers and there could be situations when\
    \ the nomads of the\n      enterprises can't get connected to the Internet.  This\
    \ is also not\n      fair; every human being should have a fair chance to be able\
    \ to\n      enjoy the Internet experience -- and the wealthy part of the world\n\
    \      should take this right into consideration.  Many enterprises are\n    \
    \  committed to Corporate Social Responsibility programs.\n   Not only technical\
    \ and economical arguments can be found.  Other\n   arguments that the general\
    \ public is interested in and concerned\n   about can be found, for example, that\
    \ the Internet becomes greener\n   and more affordable for everyone, in contrast\
    \ with the current\n   forecast of the evolution of the Internet.\n"
- title: Appendix D.  Integration with CES Architectures
  contents:
  - "Appendix D.  Integration with CES Architectures\n   Because the hIPv4 framework\
    \ requires changes to the endpoint's stack,\n   it will take some time before\
    \ the migration of the current IPv4\n   architecture to the intermediate hIPv4\
    \ routing architecture is fully\n   completed.  If a hIPv4 proxy solution could\
    \ be used in front of\n   classical IPv4 endpoints, the threshold for early adopters\
    \ to start\n   to migrate towards the hIPv4 framework would be less questionable\
    \ and\n   the migration phase would also most likely be much shorter.\n   Therefore,\
    \ it should be investigated whether the hIPv4 framework can\n   be integrated\
    \ with Core-Edge Separation [CES] architectures.  In CES\n   architectures the\
    \ endpoints do not need to be modified.  The design\n   goal of a CES solution\
    \ is to minimize the PI-address entries in the\n   DFZ and to preserve the current\
    \ stack at the endpoints.  But a CES\n   solution requires a new mapping system\
    \ and also introduces a caching\n   mechanism in the map-and-encapsulate network\
    \ nodes.  Much debate\n   about scalability of a mapping system and the caching\
    \ mechanism has\n   been going on at the [RRG] list.  At the present time it is\
    \ unclear\n   how well both solutions will scale; research work on both topics\
    \ is\n   still in progress.\n   Since the CES architectures divide the address\
    \ spaces into two new\n   categories, one that is installed in the RIB of the\
    \ DFZ and one that\n   is installed in the local networks, there are to some degree\n\
    \   similarities between CES architectures and the hIPv4 framework.\n   Actually,\
    \ the invention of the IP and locator header swap\n   functionality was inspired\
    \ by [LISP].\n   In order to describe how these two architectures might be integrated,\n\
    \   some terminology definitions are needed:\n   CES-node:\n      A network node\
    \ installed in front of a local network that must\n      have the following characteristics:\n\
    \         o  Map-and-encapsulate ingress functionality\n         o  Map-and-encapsulate\
    \ egress functionality\n         o  Incorporate the hIPv4 stack\n         o  Routing\
    \ functionality, [RFC1812]\n         o  Being able to apply policy-based routing\
    \ on the ALOC field\n            in the locator header\n      The CES-node does\
    \ not include the MPTCP extension because it would\n      most likely put too\
    \ much of a burden on the CES-node to signal and\n      maintain MPTCP subflows\
    \ for the cached hIPv4 entries.\n   Consumer site:\n      A site that is not publishing\
    \ any services towards the Internet,\n      that is, there are no entries in DNS\
    \ for this site.  It is used by\n      local endpoints to establish outbound connectivity\
    \ -- endpoints\n      are initiating sessions from the site towards content sites.\n\
    \      Usually such sites are found at small enterprises and residences.\n   \
    \   PA-addresses are usually assigned to them.\n   Content site:\n      A site\
    \ that is publishing services towards the Internet, and which\n      usually does\
    \ have DNS entries.  Such a site is used by local\n      endpoints to establish\
    \ both inbound and outbound connectivity.\n      Large enterprises use PI-addresses,\
    \ while midsize/small\n      enterprises use either PI- or PA-address space.\n\
    \   The CES architectures aim to reduce the PI-address entries in the\n   DFZ.\
    \  Therefore, map-and-encapsulate egress functionality will be\n   installed in\
    \ front of the content sites.  It is likely that the node\n   containing map-and-encapsulate\
    \ egress functionality will also contain\n   map-and-encapsulate ingress functionality;\
    \ it is also a router, so\n   the node just needs to support the hIPv4 stack and\
    \ be able to apply\n   policy-based routing using the ALOC field of the locator\
    \ header to\n   become a CES-node.\n   It is possible that the large content providers\
    \ (LCPs) are not\n   willing to install map-and-encapsulate functionality in front\
    \ of\n   their sites.  If the caching mechanism is not fully reliable or if\n\
    \   the mapping lookup delay does have an impact on their clients' user\n   experience,\
    \ then most likely the LCPs will not adopt the CES\n   architecture.\n   In order\
    \ to convince a LCP to adopt the CES architecture, it should\n   provide a mechanism\
    \ to mitigate the caching and mapping lookup delay\n   risks.  One method is to\
    \ push the CES architectures to the edge --\n   the closer to the edge you add\
    \ new functionality, the better it will\n   scale.  That is, if the endpoint stack\
    \ is upgraded, the caching\n   mechanism is maintained by the endpoint itself.\
    \  The mapping\n   mechanism can be removed if the CES architecture's addressing\
    \ scheme\n   is replaced with the addressing scheme of hIPv4 when the CES solution\n\
    \   is integrated at the endpoints.  With this approach, the LCPs might\n   install\
    \ a CES-node in front of their sites.  Also, some endpoints at\n   the content\
    \ site might be upgraded with the hIPv4 stack.\n   If the LCP faces issues with\
    \ the caching or mapping mechanisms, the\n   provider can ask its clients to upgrade\
    \ their endpoint's stack to\n   ensure a proper service level.  At the same time,\
    \ the LCP promotes\n   the migration from the current routing architecture to\
    \ a new routing\n   architecture, not for the sake of the routing architecture\
    \ but\n   instead to ensure a proper service level -- you can say that a\n   business\
    \ model will promote the migration of a new routing\n   architecture.\n   The\
    \ hIPv4 framework proposes that the IPv4 addresses (ELOC) should no\n   longer\
    \ be globally unique; once the transition is completed, a more\n   regional allocation\
    \ can be deployed.  But this is only possible once\n   all endpoints (that are\
    \ establishing sessions to other ALOC realms)\n   have migrated to support the\
    \ hIPv4 framework.  Here the CES\n   architecture can speed up the re-usage of\
    \ IPv4 addresses; that is,\n   once an IPv4 address block has become an ELOC block\
    \ it can be re-used\n   in the other RIR regions, without the requirement that\
    \ all endpoints\n   in the Internet must first be upgraded.\n   As stated earlier,\
    \ the CES architecture aims to remove PI-addresses\n   from the DFZ, making the\
    \ content sites more or less the primary\n   target for the roll-out of a CES\
    \ solution.  At large content sites a\n   CES-node most likely will be installed.\
    \  To upgrade all endpoints\n   (that are providing services towards the Internet)\
    \ at a large content\n   site will take time, and it might be that the endpoints\
    \ at the\n   content site are upgraded only within their normal lifecycle process.\n\
    \   But if the size of the content site is small, the administrator\n   either\
    \ installs a CES-node or upgrades the endpoint's stack -- a\n   decision influenced\
    \ by availability, reliability, and economic\n   feasibility.\n   Once the content\
    \ sites have been upgraded, the PI-address entries\n   have been removed from\
    \ the DFZ.  Most likely also some endpoints at\n   the consumer sites have been\
    \ upgraded to support the hIPv4 stack --\n   especially if there have been issues\
    \ with the caches or mapping\n   delays that have influenced the service levels\
    \ at the LCPs.  Then,\n   the issue is how to keep track of the upgrade of the\
    \ content sites --\n   have they been migrated or not?  If the content sites or\
    \ content\n   endpoints have been migrated, the DNS records should have either\
    \ a\n   CES-node entry or ALOC entry for each A-record.  When the penetration\n\
    \   of CES solutions at content sites (followed up by CES-node/ALOC\n   records\
    \ in DNS) is high enough, the ISP can start to promote the\n   hIPv4 stack upgrade\
    \ at the consumer sites.\n   Once a PA-address block has been migrated it can\
    \ be released from\n   global allocation to a regional allocation.  Why would\
    \ an ISP then\n   push its customers to deploy hIPv4 stacks?  Because of the business\n\
    \   model -- it will be more expensive to stay in the current\n   architecture.\
    \  The depletion of IPv4 addresses will either cause more\n   NAT at the service\
    \ provider's network (operational expenditures will\n   increase because the network\
    \ will become more complex) or the ISP\n   should force its customers to migrate\
    \ to IPv6.  But the ISP could\n   lose customers to other ISPs that are offering\
    \ IPv4 services.\n   When PA-addresses have been migrated to the hIPv4 framework,\
    \ the ISP\n   will have a more independent routing domain (ALOC realm) with only\n\
    \   ALOC prefixes from other ISPs and ELOC prefixes from directly\n   attached\
    \ customers.  BGP churn from other ISPs is no longer received,\n   the amount\
    \ of alternative paths is reduced, and the ISP can better\n   control the growth\
    \ of the RIB at their ALOC realm.  The operational\n   and capital expenditures\
    \ should be lower than in the current routing\n   architecture.\n   To summarize,\
    \ the content providers might find the CES+hIPv4 solution\n   attractive.  It\
    \ will remove the forthcoming IPv4 address depletion\n   constraints without forcing\
    \ the consumers to switch to IPv6, and thus\n   the content providers can continue\
    \ to grow (reach more consumers).\n   The ISP might also find this solution attractive\
    \ because it should\n   reduce the capital and operational expenditures in the\
    \ long term.\n   Both the content providers and the ISPs are providing the foundation\n\
    \   of the Internet.  If both adopt this architecture, the consumers have\n  \
    \ to adopt.  Both providers might find business models to \"guide\" the\n   consumers\
    \ towards the new routing architecture.\n   Then, how will this affect the consumer\
    \ and content sites?\n   Residential users will need to upgrade their endpoints.\
    \  But it\n   doesn't really matter which IP version they use.  It is the\n  \
    \ availability and affordability of the Internet that matters most.\n   Enterprises\
    \ will be affected a little bit more.  The edge devices at\n   the enterprises'\
    \ local networks need to be upgraded -- edge nodes\n   such as AS border routers,\
    \ middleboxes, DNS, DHCP, and public nodes\n   -- but by installing a CES-node\
    \ in front of them, the upgrade process\n   is postponed and the legacy nodes\
    \ can be upgraded during their normal\n   lifecycle process.  The internal infrastructure\
    \ is preserved,\n   internal applications can still use IPv4, and all investment\
    \ in IPv4\n   skills is preserved.\n   Walkthrough of use cases:\n   1. A legacy\
    \ endpoint at a content site establishes a session to a\n      content site with\
    \ a hIPv4 upgraded endpoint.\n      When the legacy endpoint resolves the DNS\
    \ entry for the remote\n      endpoint (a hIPv4 upgraded endpoint), it receives\
    \ an ALOC record\n      in the DNS response.  The legacy endpoint ignores the\
    \ ALOC record.\n      Only the A-record is used to establish the session.  Next,\
    \ the\n      legacy endpoint initializes the session and a packet is sent\n  \
    \    towards the map-and-encapsulate ingress node, which needs to do a\n     \
    \ lookup at the CES mapping system (the assumption here is that no\n      cache\
    \ entry exists for the remote endpoint).  The mapping system\n      returns either\
    \ a CES-node prefix or an ALOC prefix for the lookup\n      -- since the requested\
    \ remote endpoint has been upgraded, the\n      mapping system returns an ALOC\
    \ prefix.\n      The CES-node will not use the CES encapsulation scheme for this\n\
    \      session.  Instead, the hIPv4 header scheme will be used and a /32\n   \
    \   entry will be created in the cache.  A /32 entry must be created;\n      it\
    \ is possible that not all endpoints at the remote site are\n      upgraded to\
    \ support the hIPv4 framework.  The /32 cache entry can\n      be replaced with\
    \ a shorter prefix in the cache if all endpoints\n      are upgraded at the remote\
    \ site.  To indicate this situation, a\n      subfield should be added for the\
    \ ALOC record in the mapping\n      system.\n      The CES-node must execute the\
    \ following steps for the egress\n      packets:\n      a. Verify IP and transport\
    \ header checksums.\n      b. Create the locator header and copy the value in\
    \ the destination\n         address field of the IP header to the ELOC field of\
    \ the locator\n         header.\n      c. Replace the destination address in the\
    \ IP header with the ALOC\n         prefix given in the cache.\n      d. Insert\
    \ the local CES-node prefix in the ALOC field of the\n         locator header.\n\
    \      e. Copy the transport protocol value of the IP header to the\n        \
    \ protocol field of the locator header and set the hIPv4 protocol\n         value\
    \ in the protocol field of the IP header.\n      f. Set the desired parameters\
    \ in the A-, I-, S-, VLB-, and L-\n         fields of the locator header.\n  \
    \    g. Set the FI-bits of the locator header to 00.\n      h. Decrease the TTL\
    \ value by one.\n      i. Calculate IP, locator, and transport protocol header\
    \ checksums.\n         Transport protocol header calculations do not include the\n\
    \         locator header fields.  When completed, the packet is\n         transmitted.\n\
    \      j. Because the size of the packet might exceed MTU due to the\n       \
    \  insertion of the locator header, and if MTU is exceeded, the\n         CES-node\
    \ should inform the source endpoint of the situation\n         with an ICMP message,\
    \ and the CES-node should apply\n         fragmentation of the hIPv4 packet.\n\
    \   2. A hIPv4-upgraded endpoint at a consumer/content site establishes a\n  \
    \    session to a content site with a CES-node in front of a legacy\n      endpoint.\n\
    \      The hIPv4 upgraded endpoint receives, in the DNS response, either\n   \
    \   an ALOC record or a CES-node record for the resolved destination.\n      From\
    \ the requesting hIPv4 endpoint's point of view, it really\n      doesn't matter\
    \ if the new record prefix is used to locate RBR-\n      nodes or CES-nodes in\
    \ the Internet -- the CES-node will act as a\n      hIPv4 proxy in front of the\
    \ remote legacy endpoint.  Thus the\n      hIPv4 endpoint assembles a hIPv4 packet\
    \ to initialize the session,\n      and when the packet arrives at the CES-node\
    \ it must execute the\n      following:\n      a. Verify that the received packet\
    \ uses the hIPv4 protocol value\n         in the protocol field of the IP header.\n\
    \      b. Verify IP, locator, and transport protocol header checksums.\n     \
    \    Transport protocol header verification does not include the\n         locator\
    \ header fields.\n      c. Replace the protocol field value of the IP header with\
    \ the\n         protocol field value of the locator header.\n      d. Replace\
    \ the destination address in the IP header with the ELOC\n         prefix of the\
    \ locator header.\n      e. Remove the locator header.\n      f. Create a cache\
    \ entry (unless an entry already exists) for\n         returning packets.  A /32\
    \ entry is required.  To optimize the\n         usage of cache entries, the CES-node\
    \ might ask the CES mapping\n         node whether all endpoints at the remote\
    \ site are upgraded or\n         not.  If upgraded, a shorter prefix can be used\
    \ in the cache.\n      g. Decrease the TTL value by one.\n      h. Calculate IP\
    \ and transport protocol header checksums.\n      i. Forward the packet according\
    \ to the destination address of the\n         IP header.\n   3. A hIPv4-enabled\
    \ endpoint with a regionally unique ELOC at a\n      consumer site establishes\
    \ a session to a consumer site with a\n      legacy endpoint.\n      In this use\
    \ case, the sessions will fail unless some mechanism is\n      invented and implemented\
    \ at the ISPs' map-and-encapsulate nodes.\n      The sessions will work inside\
    \ an ALOC realm since the classical\n      IPv4 framework is still valid.  Sessions\
    \ between ALOC realms will\n      fail.  Some applications establish sessions\
    \ between consumer\n      sites.  The most common are gaming and peer-to-peer\
    \ applications.\n      These communities have historically been in the forefront\
    \ of\n      adopting new technologies.  It is expected that they either\n    \
    \  develop workarounds to solve this issue or simply ask their\n      members\
    \ to upgrade their stacks.\n   4. A legacy endpoint at a consumer/content site\
    \ establishes a session\n      to a content site with a CES-node in front of a\
    \ legacy endpoint.\n      Assumed to be described in CES architecture documents.\n\
    \   5. A hIPv4-enabled endpoint at a consumer/content site establishes a\n   \
    \   session to a content site with a hIPv4-enabled endpoint.\n      See Section\
    \ 5.2.\n"
- title: Author's Address
  contents:
  - "Author's Address\n   Patrick Frejborg\n   EMail: pfrejborg@gmail.com\n"
