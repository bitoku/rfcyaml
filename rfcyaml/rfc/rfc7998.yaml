- title: __initial_text__
  contents:
  - ''
- title: Internet Architecture Board (IAB)                             P. Hoffman
  contents:
  - "Internet Architecture Board (IAB)                             P. Hoffman\n  \
    \          \"xml2rfc\" Version 3 Preparation Tool Description\n"
- title: Abstract
  contents:
  - "Abstract\n   This document describes some aspects of the \"prep tool\" that is\n\
    \   expected to be created when the new xml2rfc version 3 specification\n   is\
    \ deployed.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This document is not an Internet Standards Track specification;\
    \ it is\n   published for informational purposes.\n   This document is a product\
    \ of the Internet Architecture Board (IAB)\n   and represents information that\
    \ the IAB has deemed valuable to\n   provide for permanent record.  It represents\
    \ the consensus of the\n   Internet Architecture Board (IAB).  Documents approved\
    \ for\n   publication by the IAB are not a candidate for any level of Internet\n\
    \   Standard; see Section 2 of RFC 7841.\n   Information about the current status\
    \ of this document, any errata,\n   and how to provide feedback on it may be obtained\
    \ at\n   http://www.rfc-editor.org/info/rfc7998.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2016 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (http://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1.  Introduction  . . . . . . . . . . . . . . . . . . .\
    \ . . . . .   3\n   2.  xml2rfc v3 Prep Tool Usage Scenarios  . . . . . . . .\
    \ . . . .   4\n   3.  Internet-Draft Submission . . . . . . . . . . . . . . .\
    \ . . .   4\n   4.  Canonical RFC Preparation . . . . . . . . . . . . . . . .\
    \ . .   5\n   5.  What the v3 Prep Tool Does  . . . . . . . . . . . . . . . .\
    \ .   5\n     5.1.  XML Sanitization  . . . . . . . . . . . . . . . . . . . .\
    \   6\n       5.1.1.  XInclude Processing . . . . . . . . . . . . . . . . .  \
    \ 6\n       5.1.2.  DTD Removal . . . . . . . . . . . . . . . . . . . . .   6\n\
    \       5.1.3.  Processing Instruction Removal  . . . . . . . . . . .   6\n  \
    \     5.1.4.  Validity Check  . . . . . . . . . . . . . . . . . . .   6\n    \
    \   5.1.5.  Check \"anchor\"  . . . . . . . . . . . . . . . . . . .   6\n    \
    \ 5.2.  Defaults  . . . . . . . . . . . . . . . . . . . . . . . .   6\n      \
    \ 5.2.1.  \"version\" Insertion . . . . . . . . . . . . . . . . .   6\n      \
    \ 5.2.2.  \"seriesInfo\" Insertion  . . . . . . . . . . . . . . .   7\n      \
    \ 5.2.3.  <date> Insertion  . . . . . . . . . . . . . . . . . .   7\n       5.2.4.\
    \  \"prepTime\" Insertion  . . . . . . . . . . . . . . . .   7\n       5.2.5.\
    \  <ol> Group \"start\" Insertion  . . . . . . . . . . . .   7\n       5.2.6.\
    \  Attribute Default Value Insertion . . . . . . . . . .   7\n       5.2.7.  Section\
    \ \"toc\" attribute . . . . . . . . . . . . . . .   7\n       5.2.8.  \"removeInRFC\"\
    \ Warning Paragraph . . . . . . . . . . .   8\n     5.3.  Normalization . . .\
    \ . . . . . . . . . . . . . . . . . . .   8\n       5.3.1.  \"month\" Attribute\
    \ . . . . . . . . . . . . . . . . . .   8\n       5.3.2.  ASCII Attribute Processing\
    \  . . . . . . . . . . . . .   8\n       5.3.3.  \"title\" Conversion  . . . .\
    \ . . . . . . . . . . . . .   9\n     5.4.  Generation  . . . . . . . . . . .\
    \ . . . . . . . . . . . .   9\n       5.4.1.  \"expiresDate\" Insertion . . .\
    \ . . . . . . . . . . . .   9\n       5.4.2.  <boilerplate> Insertion . . . .\
    \ . . . . . . . . . . .   9\n         5.4.2.1.  Compare <rfc> \"submissionType\"\
    \ and <seriesInfo>\n                   \"stream\"  . . . . . . . . . . . . . .\
    \ . . . . . .   9\n         5.4.2.2.  \"Status of this Memo\" Insertion . . .\
    \ . . . . . .   9\n         5.4.2.3.  \"Copyright Notice\" Insertion  . . . .\
    \ . . . . . .  10\n       5.4.3.  <reference> \"target\" Insertion  . . . . .\
    \ . . . . . .  10\n       5.4.4.  <name> Slugification  . . . . . . . . . . .\
    \ . . . . .  10\n       5.4.5.  <reference> Sorting . . . . . . . . . . . . .\
    \ . . . .  10\n       5.4.6.  \"pn\" Numbering  . . . . . . . . . . . . . . .\
    \ . . . .  10\n       5.4.7.  <iref> Numbering  . . . . . . . . . . . . . . .\
    \ . . .  11\n       5.4.8.  <xref> Processing . . . . . . . . . . . . . . . .\
    \ . .  11\n         5.4.8.1.  \"derivedContent\" Insertion (with Content) . .\
    \ . .  11\n         5.4.8.2.  \"derivedContent\" Insertion (without Content) \
    \ . .  11\n       5.4.9.  <relref> Processing . . . . . . . . . . . . . . . .\
    \ .  12\n     5.5.  Inclusion . . . . . . . . . . . . . . . . . . . . . . . .\
    \  12\n       5.5.1.  <artwork> Processing  . . . . . . . . . . . . . . . .  12\n\
    \       5.5.2.  <sourcecode> Processing . . . . . . . . . . . . . . .  14\n  \
    \   5.6.  RFC Production Mode Cleanup . . . . . . . . . . . . . . .  14\n    \
    \   5.6.1.  <note> Removal  . . . . . . . . . . . . . . . . . . .  14\n      \
    \ 5.6.2.  <cref> Removal  . . . . . . . . . . . . . . . . . . .  15\n       5.6.3.\
    \  <link> Processing . . . . . . . . . . . . . . . . . .  15\n       5.6.4.  XML\
    \ Comment Removal . . . . . . . . . . . . . . . . .  15\n       5.6.5.  \"xml:base\"\
    \ and \"originalSrc\" Removal  . . . . . . . .  15\n       5.6.6.  Compliance\
    \ Check  . . . . . . . . . . . . . . . . . .  15\n     5.7.  Finalization  . .\
    \ . . . . . . . . . . . . . . . . . . . .  15\n       5.7.1.  \"scripts\" Insertion\
    \ . . . . . . . . . . . . . . . . .  16\n       5.7.2.  Pretty-Format . . . .\
    \ . . . . . . . . . . . . . . . .  16\n   6.  Additional Uses for the Prep Tool\
    \ . . . . . . . . . . . . . .  16\n   7.  Security Considerations . . . . . .\
    \ . . . . . . . . . . . . .  16\n   8.  Informative References  . . . . . . .\
    \ . . . . . . . . . . . .  17\n   IAB Members at the Time of Approval . . . .\
    \ . . . . . . . . . . .  18\n   Acknowledgements  . . . . . . . . . . . . . .\
    \ . . . . . . . . . .  18\n   Authors' Addresses  . . . . . . . . . . . . . .\
    \ . . . . . . . . .  18\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   As initially described in [RFC6949], the canonical format\
    \ (the data\n   that is the authorized, recognized, accepted, and archived version\
    \ of\n   the document) of the RFC Series has been plain text to date: it is\n\
    \   now changing to XML (using the xml2rfc v3 vocabulary [RFC7991]).\n   However,\
    \ most people will read RFCs in other formats, such as HTML,\n   PDF, ASCII text,\
    \ or other formats not yet in existence.  In order to\n   ensure as much uniformity\
    \ in text output as possible across formats\n   (and with the canonical XML itself),\
    \ there is a desire that the\n   translation from XML into the other formats will\
    \ be straightforward\n   syntactic translation.  To make that happen, a good amount\
    \ of data\n   will need to be in the XML format that is not there today.  That\
    \ data\n   will be added by a program called the \"prep tool\", which will often\n\
    \   run as a part of the xml2rfc process.\n   This document specifies the steps\
    \ that the prep tool will have to\n   take.  When changes to the xml2rfc v3 vocabulary\
    \ [RFC7991] are made,\n   this document is likely to be updated at the same time.\n\
    \   The details (particularly any vocabularies) described in this\n   document\
    \ are expected to change based on experience gained in\n   implementing the new\
    \ publication toolsets.  Revised documents will be\n   published capturing those\
    \ changes as the toolsets are completed.\n   Other implementers must not expect\
    \ those changes to remain backwards-\n   compatible with the details described\
    \ in this document.\n"
- title: 2.  xml2rfc v3 Prep Tool Usage Scenarios
  contents:
  - "2.  xml2rfc v3 Prep Tool Usage Scenarios\n   The prep tool will have several\
    \ settings:\n   o  Internet-Draft preparation\n   o  Canonical RFC preparation\n\
    \   There are only a few differences between the two settings: for\n   example,\
    \ the boilerplate output and the date output on the front\n   page.\n   Note that\
    \ this document only describes what the IETF-sponsored prep\n   tool does.  Others\
    \ might create their own work-alike prep tools for\n   their own formatting needs.\
    \  However, an output format developer does\n   not need to change the prep tool\
    \ in order to create their own\n   formatter: they only need to be able to consume\
    \ prepared text.  The\n   IETF-sponsored prep tool runs in two different modes:\
    \ \"I-D\" mode when\n   the tool is run during Internet-Draft submission and processing\
    \ and\n   \"RFC production mode\" when the tool is run by the RFC Production\n\
    \   Center while producing an RFC.\n   This tool is described as if it is a separate\
    \ tool so that we can\n   reason about its architectural properties.  In actual\
    \ implementation,\n   it might be a part of a larger suite of functionality.\n"
- title: 3.  Internet-Draft Submission
  contents:
  - "3.  Internet-Draft Submission\n   When the IETF draft submission tool accepts\
    \ xml2rfc version 3\n   vocabulary [RFC7991] (referred to as \"v3\" hereafter)\
    \ as an input\n   format, the submission tool runs the submitted file through\
    \ the prep\n   tool.  This is called \"I-D mode\" in this document.  If the tool\
    \ finds\n   no errors, it keeps two XML files: the submitted file and the prepped\n\
    \   file.\n   The prepped file provides a record of what a submitter was attesting\n\
    \   to at the time of submission.  It represents a self-contained record\n   of\
    \ what any external references resolved to at the time of\n   submission.\n  \
    \ The prepped file is used by the IETF formatters to create outputs\n   such as\
    \ HTML, PDF, and text (or the tools act in a way\n   indistinguishable from this).\
    \  The message sent out by the draft\n   submission tool includes a link to the\
    \ submitted XML as well as the\n   other outputs, including the prepped XML.\n\
    \   The prepped XML can be used by tools not yet developed to output new\n   formats\
    \ that have as similar output as possible to the current IETF\n   formatters.\
    \  For example, if the IETF creates a .mobi output renderer\n   later, it can\
    \ run that renderer on all of the prepped XML that has\n   been saved, ensuring\
    \ that the content of included external references\n   and all of the part numbers\
    \ and boilerplate will be the same as what\n   was produced by the previous IETF\
    \ formatters at the time the document\n   was first uploaded.\n"
- title: 4.  Canonical RFC Preparation
  contents:
  - "4.  Canonical RFC Preparation\n   During editing, the RPC will run the prep tool\
    \ in canonical RFC\n   production mode and make the results available to the authors\
    \ during\n   AUTH48 (see [PUB-PROCESS]) so they can see what the final output\n\
    \   would look like.  When the document has passed AUTH48 review, the RPC\n  \
    \ runs the prep tool in canonical RFC production mode one last time,\n   locks\
    \ down the canonicalized XML, runs the formatters for the\n   publication formats,\
    \ and publishes all of those.\n   This document assumes that the prep tool will\
    \ be used by the RPC in\n   the manner described in this document; they may use\
    \ something\n   different or with different configuration.\n   Similar to the\
    \ case for I-Ds, the prepped XML can be used later to\n   re-render the output\
    \ formats or to generate new formats.\n"
- title: 5.  What the v3 Prep Tool Does
  contents:
  - "5.  What the v3 Prep Tool Does\n   The steps listed here are in order of processing.\
    \  In all cases where\n   the prep tool would \"add\" an attribute or element,\
    \ if that attribute\n   or element already exists, the prep tool will check that\
    \ the\n   attribute or element has valid values.  If the value is incorrect,\n\
    \   the prep tool will warn with the old and new values, then replace the\n  \
    \ incorrect value with the new value.\n   Currently, the IETF uses a tool called\
    \ \"idnits\" [IDNITS] to check\n   text input to the Internet-Drafts posting process.\
    \ idnits indicates\n   if it encountered anything it considers an error and provides\
    \ text\n   describing all of the warnings and errors in a human-readable form.\n\
    \   The prep tool should probably check for as many of these errors and\n   warnings\
    \ as possible when it is processing the XML input.  For the\n   moment, tooling\
    \ might run idnits on the text output from the prepared\n   XML.  The list below\
    \ contains some of these errors and warnings, but\n   the deployed version of\
    \ the prep tool may contain additional steps to\n   include more or the checks\
    \ from idnits.\n"
- title: 5.1.  XML Sanitization
  contents:
  - "5.1.  XML Sanitization\n   These steps will ensure that the input document is\
    \ properly formatted\n   and that all XML processing has been performed.\n"
- title: 5.1.1.  XInclude Processing
  contents:
  - "5.1.1.  XInclude Processing\n   Process all <x:include> elements.  Note: XML\
    \ <x:include> elements may\n   include more <x:include> elements (with relative\
    \ references resolved\n   against the base URI potentially modified by a previously\
    \ inserted\n   xml:base attribute).  The tool may be configurable with a limit\
    \ on\n   the depth of recursion.\n"
- title: 5.1.2.  DTD Removal
  contents:
  - "5.1.2.  DTD Removal\n   Fully process any Document Type Definitions (DTDs) in\
    \ the input\n   document, then remove the DTD.  At a minimum, this entails processing\n\
    \   the entity references and includes for external files.\n"
- title: 5.1.3.  Processing Instruction Removal
  contents:
  - "5.1.3.  Processing Instruction Removal\n   Remove processing instructions.\n"
- title: 5.1.4.  Validity Check
  contents:
  - "5.1.4.  Validity Check\n   Check the input against the RELAX NG (RNG) in [RFC7991].\
    \  If the\n   input is not valid, give an error.\n"
- title: 5.1.5.  Check "anchor"
  contents:
  - "5.1.5.  Check \"anchor\"\n   Check all elements for \"anchor\" attributes.  If\
    \ any \"anchor\"\n   attribute begins with \"s-\", \"f-\", \"t-\", or \"i-\",\
    \ give an error.\n"
- title: 5.2.  Defaults
  contents:
  - "5.2.  Defaults\n   These steps will ensure that all default values have been\
    \ filled in\n   to the XML, in case the defaults change at a later date.  Steps\
    \ in\n   this section will not overwrite existing values in the input file.\n"
- title: 5.2.1.  "version" Insertion
  contents:
  - "5.2.1.  \"version\" Insertion\n   If the <rfc> element has a \"version\" attribute\
    \ with a value other\n   than \"3\", give an error.  If the <rfc> element has\
    \ no \"version\"\n   attribute, add one with the value \"3\".\n"
- title: 5.2.2.  "seriesInfo" Insertion
  contents:
  - "5.2.2.  \"seriesInfo\" Insertion\n   If the <front> element of the <rfc> element\
    \ does not already have a\n   <seriesInfo> element, add a <seriesInfo> element\
    \ with the name\n   attribute based on the mode in which the prep tool is running\n\
    \   (\"Internet-Draft\" for Draft mode and \"RFC\" for RFC production mode)\n\
    \   and a value that is the input filename minus any extension for\n   Internet-Drafts,\
    \ and is a number specified by the RFC Editor for\n   RFCs.\n"
- title: 5.2.3.  <date> Insertion
  contents:
  - "5.2.3.  <date> Insertion\n   If the <front> element in the <rfc> element does\
    \ not contain a <date>\n   element, add it and fill in the \"day\", \"month\"\
    , and \"year\" attributes\n   from the current date.  If the <front> element in\
    \ the <rfc> element\n   has a <date> element with \"day\", \"month\", and \"year\"\
    \ attributes, but\n   the date indicated is more than three days in the past or\
    \ is in the\n   future, give a warning.  If the <front> element in the <rfc> element\n\
    \   has a <date> element with some but not all of the \"day\", \"month\", and\n\
    \   \"year\" attributes, give an error.\n"
- title: 5.2.4.  "prepTime" Insertion
  contents:
  - "5.2.4.  \"prepTime\" Insertion\n   If the input document includes a \"prepTime\"\
    \ attribute of <rfc>, exit\n   with an error.\n   Fill in the \"prepTime\" attribute\
    \ of <rfc> with the current datetime.\n"
- title: 5.2.5.  <ol> Group "start" Insertion
  contents:
  - "5.2.5.  <ol> Group \"start\" Insertion\n   Add a \"start\" attribute to every\
    \ <ol> element containing a group that\n   does not already have a start.\n"
- title: 5.2.6.  Attribute Default Value Insertion
  contents:
  - "5.2.6.  Attribute Default Value Insertion\n   Fill in any default values for\
    \ attributes on elements, except\n   \"keepWithNext\" and \"keepWithPrevious\"\
    \ of <t>, and \"toc\" of <section>.\n   Some default values can be found in the\
    \ RELAX NG schema, while others\n   can be found in the prose describing the elements\
    \ in [RFC7991].\n"
- title: 5.2.7.  Section "toc" attribute
  contents:
  - "5.2.7.  Section \"toc\" attribute\n   For each <section>, modify the \"toc\"\
    \ attribute to be either \"include\"\n   or \"exclude\":\n   o  for sections that\
    \ have an ancestor of <boilerplate>, use \"exclude\"\n   o  else for sections\
    \ that have a descendant that has toc=\"include\",\n      use \"include\".  If\
    \ the ancestor section has toc=\"exclude\" in the\n      input, this is an error.\n\
    \   o  else for sections that are children of a section with\n      toc=\"exclude\"\
    , use \"exclude\".\n   o  else for sections that are deeper than rfc/@tocDepth,\
    \ use\n      \"exclude\"\n   o  else use \"include\"\n"
- title: 5.2.8.  "removeInRFC" Warning Paragraph
  contents:
  - "5.2.8.  \"removeInRFC\" Warning Paragraph\n   In I-D mode, if there is a <note>\
    \ or <section> element with a\n   \"removeInRFC\" attribute that has the value\
    \ \"true\", add a paragraph to\n   the top of the element with the text \"This\
    \ note is to be removed\n   before publishing as an RFC.\" or \"This section...\"\
    , unless a\n   paragraph consisting of that exact text already exists.\n"
- title: 5.3.  Normalization
  contents:
  - "5.3.  Normalization\n   These steps will ensure that ideas that can be expressed\
    \ in multiple\n   different ways in the input document are only found in one way\
    \ in the\n   prepared document.\n"
- title: 5.3.1.  "month" Attribute
  contents:
  - "5.3.1.  \"month\" Attribute\n   Normalize the values of \"month\" attributes\
    \ in all <date> elements in\n   <front> elements in <rfc> elements to numeric\
    \ values.\n"
- title: 5.3.2.  ASCII Attribute Processing
  contents:
  - "5.3.2.  ASCII Attribute Processing\n   In every <email>, <organization>, <street>,\
    \ <city>, <region>,\n   <country>, and <code> element, if there is an \"ascii\"\
    \ attribute and\n   the value of that attribute is the same as the content of\
    \ the\n   element, remove the \"ascii\" element and issue a warning about the\n\
    \   removal.\n   In every <author> element, if there is an \"asciiFullname\",\n\
    \   \"asciiInitials\", or \"asciiSurname\" attribute, check the content of\n \
    \  that element against its matching \"fullname\", \"initials\", or\n   \"surname\"\
    \ element (respectively).  If the two are the same, remove\n   the \"ascii*\"\
    \ element and issue a warning about the removal.\n"
- title: 5.3.3.  "title" Conversion
  contents:
  - "5.3.3.  \"title\" Conversion\n   For every <section>, <note>, <figure>, <references>,\
    \ and <texttable>\n   element that has a (deprecated) \"title\" attribute, remove\
    \ the \"title\"\n   attribute and insert a <name> element with the title from\
    \ the\n   attribute.\n"
- title: 5.4.  Generation
  contents:
  - "5.4.  Generation\n   These steps will generate new content, overriding existing\
    \ similar\n   content in the input document.  Some of these steps are important\n\
    \   enough that they specify a warning to be generated when the content\n   being\
    \ overwritten does not match the new content.\n"
- title: 5.4.1.  "expiresDate" Insertion
  contents:
  - "5.4.1.  \"expiresDate\" Insertion\n   If in I-D mode, fill in \"expiresDate\"\
    \ attribute of <rfc> based on the\n   <date> element of the document's <front>\
    \ element.\n"
- title: 5.4.2.  <boilerplate> Insertion
  contents:
  - "5.4.2.  <boilerplate> Insertion\n   Create a <boilerplate> element if it does\
    \ not exist.  If there are\n   any children of the <boilerplate> element, produce\
    \ a warning that\n   says \"Existing boilerplate being removed.  Other tools,\
    \ specifically\n   the draft submission tool, will treat this condition as an\
    \ error\" and\n   remove the existing children.\n"
- title: 5.4.2.1.  Compare <rfc> "submissionType" and <seriesInfo> "stream"
  contents:
  - "5.4.2.1.  Compare <rfc> \"submissionType\" and <seriesInfo> \"stream\"\n   Verify\
    \ that <rfc> \"submissionType\" and <seriesInfo> \"stream\" are the\n   same if\
    \ they are both present.  If either is missing, add it.  Note\n   that both have\
    \ a default value of \"IETF\".\n"
- title: 5.4.2.2.  "Status of this Memo" Insertion
  contents:
  - "5.4.2.2.  \"Status of this Memo\" Insertion\n   Add the \"Status of this Memo\"\
    \ section to the <boilerplate> element\n   with current values.  The application\
    \ will use the \"submissionType\",\n   and \"consensus\" attributes of the <rfc>\
    \ element, the <workgroup>\n   element, and the \"status\" and \"stream\" attributes\
    \ of the <seriesInfo>\n   element, to determine which boilerplate from [RFC7841]\
    \ to include, as\n   described in Appendix A of [RFC7991].\n"
- title: 5.4.2.3.  "Copyright Notice" Insertion
  contents:
  - "5.4.2.3.  \"Copyright Notice\" Insertion\n   Add the \"Copyright Notice\" section\
    \ to the <boilerplate> element.  The\n   application will use the \"ipr\" and\
    \ \"submissionType\" attributes of the\n   <rfc> element and the <date> element\
    \ to determine which portions and\n   which version of the Trust Legal Provisions\
    \ (TLP) to use, as\n   described in A.1 of [RFC7991].\n"
- title: 5.4.3.  <reference> "target" Insertion
  contents:
  - "5.4.3.  <reference> \"target\" Insertion\n   For any <reference> element that\
    \ does not already have a \"target\"\n   attribute, fill the target attribute\
    \ in if the element has one or\n   more <seriesinfo> child element(s) and the\
    \ \"name\" attribute of the\n   <seriesinfo> element is \"RFC\", \"Internet-Draft\"\
    , or \"DOI\" or other\n   value for which it is clear what the \"target\" should\
    \ be.  The\n   particular URLs for RFCs, Internet-Drafts, and Digital Object\n\
    \   Identifiers (DOIs) for this step will be specified later by the RFC\n   Editor\
    \ and the IESG.  These URLs might also be different before and\n   after the v3\
    \ format is adopted.\n"
- title: 5.4.4.  <name> Slugification
  contents:
  - "5.4.4.  <name> Slugification\n   Add a \"slugifiedName\" attribute to each <name>\
    \ element that does not\n   contain one; replace the attribute if it contains\
    \ a value that begins\n   with \"n-\".\n"
- title: 5.4.5.  <reference> Sorting
  contents:
  - "5.4.5.  <reference> Sorting\n   If the \"sortRefs\" attribute of the <rfc> element\
    \ is true, sort the\n   <reference> and <referencegroup> elements lexically by\
    \ the value of\n   the \"anchor\" attribute, as modified by the \"to\" attribute\
    \ of any\n   <displayreference> element.  The RFC Editor needs to determine what\n\
    \   the rules for lexical sorting are.  The authors of this document\n   acknowledge\
    \ that getting consensus on this will be a difficult task.\n"
- title: 5.4.6.  "pn" Numbering
  contents:
  - "5.4.6.  \"pn\" Numbering\n   Add \"pn\" attributes for all parts.  Parts are:\n\
    \   o  <section> in <middle>: pn='s-1.4.2'\n   o  <references>: pn='s-12' or pn='s-12.1'\n\
    \   o  <abstract>: pn='s-abstract'\n   o  <note>: pn='s-note-2'\n   o  <section>\
    \ in <boilerplate>: pn='s-boilerplate-1'\n   o  <table>: pn='t-3'\n   o  <figure>:\
    \ pn='f-4'\n   o  <artwork>, <aside>, <blockquote>, <dt>, <li>, <sourcecode>,\
    \ <t>:\n      pn='p-[section]-[counter]'\n"
- title: 5.4.7.  <iref> Numbering
  contents:
  - "5.4.7.  <iref> Numbering\n   In every <iref> element, create a document-unique\
    \ \"pn\" attribute.\n   The value of the \"pn\" attribute will start with 'i-',\
    \ and use the\n   item attribute, the subitem attribute (if it exists), and a\
    \ counter\n   to ensure uniqueness.  For example, the first instance of \"<iref\n\
    \   item='foo' subitem='bar'>\" will have the \"irefid\" attribute set to\n  \
    \ 'i-foo-bar-1'.\n"
- title: 5.4.8.  <xref> Processing
  contents:
  - '5.4.8.  <xref> Processing

    '
- title: 5.4.8.1.  "derivedContent" Insertion (with Content)
  contents:
  - "5.4.8.1.  \"derivedContent\" Insertion (with Content)\n   For each <xref> element\
    \ that has content, fill the \"derivedContent\"\n   with the element content,\
    \ having first trimmed the whitespace from\n   ends of content text.  Issue a\
    \ warning if the \"derivedContent\"\n   attribute already exists and has a different\
    \ value from what was\n   being filled in.\n"
- title: 5.4.8.2.  "derivedContent" Insertion (without Content)
  contents:
  - "5.4.8.2.  \"derivedContent\" Insertion (without Content)\n   For each <xref>\
    \ element that does not have content, fill the\n   \"derivedContent\" attribute\
    \ based on the \"format\" attribute.\n   o  For a value of \"counter\", the \"\
    derivedContent\" is set to the\n      section, figure, table, or ordered list\
    \ number of the element with\n      an anchor equal to the <xref> target.\n  \
    \ o  For format='default' and the \"target\" attribute points to a\n      <reference>\
    \ or <referencegroup> element, the \"derivedContent\" is\n      the value of the\
    \ \"target\" attribute (or the \"to\" attribute of a\n      <displayreference>\
    \ element for the targeted <reference>).\n   o  For format='default' and the \"\
    target\" attribute points to a\n      <section>, <figure>, or <table>, the \"\
    derivedContent\" is the name\n      of the thing pointed to, such as \"Section\
    \ 2.3\", \"Figure 12\", or\n      \"Table 4\".\n   o  For format='title', if the\
    \ target is a <reference> element, the\n      \"derivedContent\" attribute is\
    \ the name of the reference, extracted\n      from the <title> child of the <front>\
    \ child of the reference.\n   o  For format='title', if the target element has\
    \ a <name> child\n      element, the \"derivedContent\" attribute is the text\
    \ content of\n      that <name> element concatenated with the text content of\
    \ each\n      descendant node of <name> (that is, stripping out all of the XML\n\
    \      markup, leaving only the text).\n   o  For format='title', if the target\
    \ element does not contain a\n      <name> child element, the \"derivedContent\"\
    \ attribute is the value\n      of the \"target\" attribute with no other adornment.\
    \  Issue a\n      warning if the \"derivedContent\" attribute already exists and\
    \ has a\n      different value from what was being filled in.\n"
- title: 5.4.9.  <relref> Processing
  contents:
  - "5.4.9.  <relref> Processing\n   If any <relref> element's \"target\" attribute\
    \ refers to anything but a\n   <reference> element, give an error.\n   For each\
    \ <relref> element, fill in the \"derivedLink\" attribute.\n"
- title: 5.5.  Inclusion
  contents:
  - "5.5.  Inclusion\n   These steps will include external files into the output document.\n"
- title: 5.5.1.  <artwork> Processing
  contents:
  - "5.5.1.  <artwork> Processing\n   1.  If an <artwork> element has a \"src\" attribute\
    \ where no scheme is\n       specified, copy the \"src\" attribute value to the\
    \ \"originalSrc\"\n       attribute, and replace the \"src\" value with a URI\
    \ that uses the\n       \"file:\" scheme in a path relative to the file being\
    \ processed.\n       See Section 7 for warnings about this step.  This will likely\
    \ be\n       one of the most common authoring approaches.\n   2.  If an <artwork>\
    \ element has a \"src\" attribute with a \"file:\"\n       scheme, and if processing\
    \ the URL would cause the processor to\n       retrieve a file that is not in\
    \ the same directory, or a\n       subdirectory, as the file being processed,\
    \ give an error.  If the\n       \"src\" has any shellmeta strings (such as \"\
    `\", \"$USER\", and so on)\n       that would be processed, give an error.  Replace\
    \ the \"src\"\n       attribute with a URI that uses the \"file:\" scheme in a\
    \ path\n       relative to the file being processed.  This rule attempts to\n\
    \       prevent <artwork src='file:///etc/passwd'> and similar security\n    \
    \   issues.  See Section 7 for warnings about this step.\n   3.  If an <artwork>\
    \ element has a \"src\" attribute, and the element\n       has content, give an\
    \ error.\n   4.  If an <artwork> element has type='svg' and there is an \"src\"\
    \n       attribute, the data needs to be moved into the content of the\n     \
    \  <artwork> element.\n       *  If the \"src\" URI scheme is \"data:\", fill\
    \ the content of the\n          <artwork> element with that data and remove the\
    \ \"src\"\n          attribute.\n       *  If the \"src\" URI scheme is \"file:\"\
    , \"http:\", or \"https:\", fill\n          the content of the <artwork> element\
    \ with the resolved XML\n          from the URI in the \"src\" attribute.  If\
    \ there is no\n          \"originalSrc\" attribute, add an \"originalSrc\" attribute\
    \ with\n          the value of the URI and remove the \"src\" attribute.\n   \
    \    *  If the <artwork> element has an \"alt\" attribute, and the SVG\n     \
    \     does not have a <desc> element, add the <desc> element with\n          the\
    \ contents of the \"alt\" attribute.\n   5.  If an <artwork> element has type='binary-art',\
    \ the data needs to\n       be in an \"src\" attribute with a URI scheme of \"\
    data:\".  If the\n       \"src\" URI scheme is \"file:\", \"http:\", or \"https:\"\
    , resolve the\n       URL.  Replace the \"src\" attribute with a \"data:\" URI,\
    \ and add an\n       \"originalSrc\" attribute with the value of the URI.  For\
    \ the\n       \"http:\" and \"https:\" URI schemes, the mediatype of the \"data:\"\
    \n       URI will be the Content-Type of the HTTP response.  For the\n       \"\
    file:\" URI scheme, the mediatype of the \"data:\" URI needs to be\n       guessed\
    \ with heuristics (this is possibly a bad idea).  This also\n       fails for\
    \ content that includes binary images but uses a type\n       other than \"binary-art\"\
    .  Note: since this feature can't be used\n       for RFCs at the moment, this\
    \ entire feature might be\n   6.  If an <artwork> element does not have type='svg'\
    \ or\n       type='binary-art' and there is an \"src\" attribute, the data needs\n\
    \       to be moved into the content of the <artwork> element.  Note that\n  \
    \     this step assumes that all of the preferred types other than\n       \"\
    binary-art\" are text, which is possibly wrong.\n       *  If the \"src\" URI\
    \ scheme is \"data:\", fill the content of the\n          <artwork> element with\
    \ the correctly escaped form of that data\n          and remove the \"src\" attribute.\n\
    \       *  If the \"src\" URI scheme is \"file:\", \"http:\", or \"https:\", fill\n\
    \          the content of the <artwork> element with the correctly\n         \
    \ escaped form of the resolved text from the URI in the \"src\"\n          attribute.\
    \  If there is no \"originalSrc\" attribute, add an\n          \"originalSrc\"\
    \ attribute with the value of the URI and remove\n          the \"src\" attribute.\n"
- title: 5.5.2.  <sourcecode> Processing
  contents:
  - "5.5.2.  <sourcecode> Processing\n   1.  If a <sourcecode> element has a \"src\"\
    \ attribute where no scheme\n       is specified, copy the \"src\" attribute value\
    \ to the \"originalSrc\"\n       attribute and replace the \"src\" value with\
    \ a URI that uses the\n       \"file:\" scheme in a path relative to the file\
    \ being processed.\n       See Section 7 for warnings about this step.  This will\
    \ likely be\n       one of the most common authoring approaches.\n   2.  If a\
    \ <sourcecode> element has a \"src\" attribute with a \"file:\"\n       scheme,\
    \ and if processing the URL would cause the processor to\n       retrieve a file\
    \ that is not in the same directory, or a\n       subdirectory, as the file being\
    \ processed, give an error.  If the\n       \"src\" has any shellmeta strings\
    \ (such as \"`\", \"$USER\", and so on)\n       that would be processed, give\
    \ an error.  Replace the \"src\"\n       attribute with a URI that uses the \"\
    file:\" scheme in a path\n       relative to the file being processed.  This rule\
    \ attempts to\n       prevent <sourcecode src='file:///etc/passwd'> and similar\n\
    \       security issues.  See Section 7 for warnings about this step.\n   3. \
    \ If a <sourcecode> element has a \"src\" attribute, and the element\n       has\
    \ content, give an error.\n   4.  If a <sourcecode> element has a \"src\" attribute,\
    \ the data needs\n       to be moved into the content of the <sourcecode> element.\n\
    \       *  If the \"src\" URI scheme is \"data:\", fill the content of the\n \
    \         <sourcecode> element with that data and remove the \"src\"\n       \
    \   attribute.\n       *  If the \"src\" URI scheme is \"file:\", \"http:\", or\
    \ \"https:\", fill\n          the content of the <sourcecode> element with the\
    \ resolved XML\n          from the URI in the \"src\" attribute.  If there is\
    \ no\n          \"originalSrc\" attribute, add an \"originalSrc\" attribute with\n\
    \          the value of the URI and remove the \"src\" attribute.\n"
- title: 5.6.  RFC Production Mode Cleanup
  contents:
  - "5.6.  RFC Production Mode Cleanup\n   These steps provide extra cleanup of the\
    \ output document in RFC\n   production mode.\n"
- title: 5.6.1.  <note> Removal
  contents:
  - "5.6.1.  <note> Removal\n   In RFC production mode, if there is a <note> or <section>\
    \ element\n   with a \"removeInRFC\" attribute that has the value \"true\", remove\
    \ the\n   element.\n"
- title: 5.6.2.  <cref> Removal
  contents:
  - "5.6.2.  <cref> Removal\n   If in RFC production mode, remove all <cref> elements.\n"
- title: 5.6.3.  <link> Processing
  contents:
  - "5.6.3.  <link> Processing\n   1.  If in RFC production mode, remove all <link>\
    \ elements whose \"rel\"\n       attribute has the value \"alternate\".\n   2.\
    \  If in RFC production mode, check if there is a <link> element\n       with\
    \ the current ISSN for the RFC series (2070-1721); if not, add\n       <link rel=\"\
    item\" href=\"urn:issn:2070-1721\">.\n   3.  If in RFC production mode, check\
    \ if there is a <link> element\n       with a DOI for this RFC; if not, add one\
    \ of the form <link\n       rel=\"describedBy\" href=\"https://dx.doi.org/10.17487/rfcdd\"\
    > where\n       \"dd\" is the number of the RFC, such as\n       \"https://dx.doi.org/10.17487/rfc2109\"\
    .  The URI is described in\n       [RFC7669].  If there was already a <link> element\
    \ with a DOI for\n       this RFC, check that the \"href\" value has the right\
    \ format.  The\n       content of the href attribute is expected to change in\
    \ the\n       future.\n   4.  If in RFC production mode, check if there is a <link>\
    \ element\n       with the file name of the Internet-Draft that became this RFC\
    \ the\n       form <link rel=\"convertedFrom\"\n       href=\"https://datatracker.ietf.org/doc/draft-tttttttttt/\"\
    >.  If\n       one does not exist, give an error.\n"
- title: 5.6.4.  XML Comment Removal
  contents:
  - "5.6.4.  XML Comment Removal\n   If in RFC production mode, remove XML comments.\n"
- title: 5.6.5.  "xml:base" and "originalSrc" Removal
  contents:
  - "5.6.5.  \"xml:base\" and \"originalSrc\" Removal\n   If in RFC production mode,\
    \ remove all \"xml:base\" or \"originalSrc\"\n   attributes from all elements.\n"
- title: 5.6.6.  Compliance Check
  contents:
  - "5.6.6.  Compliance Check\n   If in RFC production mode, ensure that the result\
    \ is in full\n   compliance to the v3 schema, without any deprecated elements\
    \ or\n   attributes and give an error if any issues are found.\n"
- title: 5.7.  Finalization
  contents:
  - "5.7.  Finalization\n   These steps provide the finishing touches on the output\
    \ document.\n"
- title: 5.7.1.  "scripts" Insertion
  contents:
  - "5.7.1.  \"scripts\" Insertion\n   Determine all the characters used in the document\
    \ and fill in the\n   \"scripts\" attribute for <rfc>.\n"
- title: 5.7.2.  Pretty-Format
  contents:
  - "5.7.2.  Pretty-Format\n   Pretty-format the XML output.  (Note: there are many\
    \ tools that do an\n   adequate job.)\n"
- title: 6.  Additional Uses for the Prep Tool
  contents:
  - "6.  Additional Uses for the Prep Tool\n   There will be a need for Internet-Draft\
    \ authors who include files\n   from their local disk (such as for <artwork src=\"\
    mydrawing.svg\"/>) to\n   have the contents of those files inlined to their drafts\
    \ before\n   submitting them to the Internet-Draft processor.  (There is a\n \
    \  possibility that the Internet-Draft processor will allow XML files\n   and\
    \ accompanying files to be submitted at the same time, but this\n   seems troublesome\
    \ from a security, portability, and complexity\n   standpoint.)  For these users,\
    \ having a local copy of the prep tool\n   that has an option to just inline all\
    \ local files would be terribly\n   useful.  That option would be a proper subset\
    \ of the steps given in\n   Section 5.\n   A feature that might be useful in a\
    \ local prep tool would be the\n   inverse of the \"just inline\" option would\
    \ be \"extract all\".  This\n   would allow a user who has a v3 RFC or Internet-Draft\
    \ to dump all of\n   the <artwork> and <sourcecode> elements into local files\
    \ instead of\n   having to find each one in the XML.  This option might even do\
    \ as\n   much validation as possible on the extracted <sourcecode> elements.\n\
    \   This feature might also remove some of the features added by the prep\n  \
    \ tool (such as part numbers and \"slugifiedName\" attributes starting\n   with\
    \ \"n-\") in order to make the resulting file easier to edit.\n"
- title: 7.  Security Considerations
  contents:
  - "7.  Security Considerations\n   Steps in this document attempt to prevent the\
    \ <artwork> and\n   <sourcecode> entities from exposing the contents of files\
    \ outside the\n   directory in which the document being processed resides.  For\n\
    \   example, values starting with \"/\", \"./\", or \"../\" should generate\n\
    \   errors.\n   The security considerations in [RFC3470] apply here.  Specifically,\n\
    \   processing XML-external references can expose a prep-tool\n   implementation\
    \ to various threats by causing the implementation to\n   access external resources\
    \ automatically.  It is important to disallow\n   arbitrary access to such external\
    \ references within XML data from\n   untrusted sources.\n"
- title: 8.  Informative References
  contents:
  - "8.  Informative References\n   [IDNITS]   IETF Tools, \"Idnits Tool\",\n    \
    \          <https://tools.ietf.org/tools/idnits/>.\n   [PUB-PROCESS]\n       \
    \       RFC Editor, \"Publication Process\",\n              <https://www.rfc-editor.org/pubprocess/>.\n\
    \   [RFC3470]  Hollenbeck, S., Rose, M., and L. Masinter, \"Guidelines for\n \
    \             the Use of Extensible Markup Language (XML) within IETF\n      \
    \        Protocols\", BCP 70, RFC 3470, DOI 10.17487/RFC3470,\n              January\
    \ 2003, <http://www.rfc-editor.org/info/rfc3470>.\n   [RFC6949]  Flanagan, H.\
    \ and N. Brownlee, \"RFC Series Format\n              Requirements and Future\
    \ Development\", RFC 6949,\n              DOI 10.17487/RFC6949, May 2013,\n  \
    \            <http://www.rfc-editor.org/info/rfc6949>.\n   [RFC7669]  Levine,\
    \ J., \"Assigning Digital Object Identifiers to\n              RFCs\", RFC 7669,\
    \ DOI 10.17487/RFC7669, October 2015,\n              <http://www.rfc-editor.org/info/rfc7669>.\n\
    \   [RFC7841]  Halpern, J., Ed., Daigle, L., Ed., and O. Kolkman, Ed.,\n     \
    \         \"RFC Streams, Headers, and Boilerplates\", RFC 7841,\n            \
    \  DOI 10.17487/RFC7841, May 2016,\n              <http://www.rfc-editor.org/info/rfc7841>.\n\
    \   [RFC7991]  Hoffman, P., \"The \"xml2rfc\" Version 3 Vocabulary\",\n      \
    \        RFC 7991, DOI 10.17487/RFC7991, December 2016,\n              <http://www.rfc-editor.org/info/rfc7991>.\n"
- title: IAB Members at the Time of Approval
  contents:
  - "IAB Members at the Time of Approval\n   The IAB members at the time this memo\
    \ was approved were (in\n   alphabetical order):\n      Jari Arkko\n      Ralph\
    \ Droms\n      Ted Hardie\n      Joe Hildebrand\n      Russ Housley\n      Lee\
    \ Howard\n      Erik Nordmark\n      Robert Sparks\n      Andrew Sullivan\n  \
    \    Dave Thaler\n      Martin Thomson\n      Brian Trammell\n      Suzanne Woolf\n"
- title: Acknowledgements
  contents:
  - "Acknowledgements\n   Many people contributed valuable ideas to this document.\
    \  Special\n   thanks go to Robert Sparks for his in-depth review and contributions\n\
    \   early in the development of this document and to Julian Reschke for\n   his\
    \ help getting the document structured more clearly.\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Paul Hoffman\n   ICANN\n   Email: paul.hoffman@icann.org\n\
    \   Joe Hildebrand\n   Mozilla\n   Email: joe-ietf@cursive.net\n"
