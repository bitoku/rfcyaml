Abstract This document gives examples of Session Initiation Protocol (SIP) call flows.
Elements in these call flows include SIP User Agents and Clients, SIP Proxy and Redirect Servers.
Scenarios include SIP Registration and SIP session establishment.
Call flow diagrams and message details are shown.
The call flows shown in this document were developed in the design of a SIP IP communications network.
They represent an example minimum set of functionality.
It is the hope of the authors that this document will be useful for SIP implementers, designers, and protocol researchers alike and will help further the goal of a standard implementation of RFC 3261 [1].
These flows represent carefully checked and working group reviewed scenarios of the most basic examples as a companion to the specifications.
These call flows are based on the current version 2.0 of SIP in RFC 3261 [1] with SDP usage described in RFC 3264 [2].
Other RFCs also comprise the SIP standard but are not used in this set of basic call flows.
Call flow examples of SIP interworking with the PSTN through gateways are contained in a companion document, RFC 3666 [5].
General Assumptions A number of architecture, network, and protocol assumptions underlie the call flows in this document.
Note that these assumptions are not requirements.
They are outlined in this section so that they may be taken into consideration and to aid in the understanding of the call flow examples.
The authentication of SIP User Agents in these example call flows is performed using HTTP Digest as defined in [1] and [3].
Some Proxy Servers in these call flows insert Record Route headers into requests to ensure that they are in the signaling path for future message exchanges.
These flows show TCP, TLS, and UDP for transport.
See the discussion in RFC 3261 for details on the transport issues for SIP.
These messages can be SIP or PSTN signaling.
The arrow indicates the direction of message flow.
Messages with parentheses around their name represent optional messages.
Messages are identified in the Figures as F1, F2, etc.
This references the message details in the list that follows the Figure.
This document does not prescribe the flows precisely as they are shown, but rather the flows illustrate the principles for best practice.
They are best practices usages (orderings, syntax, selection of features for the purpose, handling of error) of SIP methods, headers and parameters.
The exact flows here must not be copied as is by an implementer due to specific incorrect characteristics that were introduced into the document for convenience and are listed below.
To sum up, the basic flows represent well reviewed examples of SIP usage, which are best common practice according to IETF consensus.
For simplicity in reading and editing the document, there are a number of differences between some of the examples and actual SIP messages.
For example, the HTTP Digest responses are not actual MD5 encodings.
Call IDs are often repeated, and CSeq counts often begin at 1.
Header fields are usually shown in the same order.
Usually only the minimum required header field set is shown, others that would normally be present such as Accept, Supported, Allow, etc are not shown.
SIP Registration Registration binds a particular device Contact URI with a SIP user Address of Record (AOR).
The request includes the user's contact list.
This flow shows the use of HTTP Digest for authentication using TLS transport.
TLS transport is used due to the lack of integrity protection in HTTP Digest and the danger of registration hijacking without it, as described in RFC 3261 [1].
The SIP server provides a challenge to Bob.
Bob enters her/his valid user ID and password.
Bob's SIP client encrypts the user information according to the challenge issued by the SIP server and sends the response to the SIP server.
The SIP server validates the user's credentials.
It registers the user in its contact database and returns a response (200 OK) to Bob's SIP client.
The response includes the user's current contact list in Contact headers.
The format of the authentication shown is HTTP digest.
It is assumed that Bob has not previously registered with this Server.
Message Details F1 REGISTER Bob   SIP Server REGISTER sips:ss2.biloxi.example.com SIP/2.0
/TLS client.biloxi.example.com:5061;branch z9hG4bKnashds7 Max Forwards: 70
Content Length: 0 F2 401 Unauthorized SIP Server
SIP/2.0/TLS client.biloxi.example.com:5061;branch z9hG4bKnashds7 ;received 192.0.2.201 From: Bob
1410948204 Call ID: 1j9FpLxk3uxtm8tn@biloxi.example.com CSeq:
Digest username "bob", realm "atlanta.example.com" nonce "ea9c8e88df84f1cec4341ae6cbe5a359
37GkEhwl6 Call ID: 1j9FpLxk3uxtm8tn@biloxi.example.com CSeq:
bob@client.biloxi.example.com>;expires 3600 Content Length: 0 2.2.
Bob sends a SIP REGISTER request to the SIP server.
Bob's request includes an updated contact list.
Since the user already has authenticated with the server, the user supplies authentication credentials with the request and is not challenged by the server.
The SIP server validates the user's credentials.
It registers the user in its contact database, updates the user's contact list, and returns a response (200 OK) to Bob's SIP client.
The response includes the user's current contact list in Contact headers.
Message Details F1 REGISTER Bob   SIP Server REGISTER sips:ss2.biloxi.example.com SIP/2.0
/TLS client.biloxi.example.com:5061;branch z9hG4bKnashds7 Max Forwards: 70
Digest username "bob", realm "atlanta.example.com", qop "auth", nonce "1cec4341ae6cbe5a359ea9c8e88df84f", opaque ""
response "71ba27c64bd01de719686aa4590d5824" Content Length: 0 F2 200 OK SIP Server
SIP/2.0/TLS client.biloxi.example.com:5061;branch z9hG4bKnashds7 ;received 192.0.2.201 From: Bob
34095828jh Call ID: 1j9FpLxk3uxtm8tn@biloxi.example.com CSeq:
4294967295 Content Length: 0 2.3.
Since the user already has authenticated with the server, the user supplies authentication credentials with the request and is not challenged by the server.
The SIP server validates the user's credentials.
The server returns a response (200 OK) which includes the user's current registration list in Contact headers.
Message Details F1 REGISTER Bob   SIP Server REGISTER sips:ss2.biloxi.example.com SIP/2.0
/TLS client.biloxi.example.com:5061;branch z9hG4bKnashds7 Max Forwards: 70
Digest username "bob", realm "atlanta.example.com", nonce "df84f1cec4341ae6cbe5ap359a9c8e88", opaque ""
, uri "sips:ss2.biloxi.example.com", response "aa7ab4678258377c6f7d4be6087e2f60" Content Length: 0 F2 200 OK SIP Server
SIP/2.0/TLS client.biloxi.example.com:5061;branch z9hG4bKnashds7 ;received 192.0.2.201 From: Bob
jqoiweu75 Call ID: 1j9FpLxk3uxtm8tn@biloxi.example.com CSeq:
4294967295 Content Length: 0 2.4.
Bob sends a SIP REGISTER request to the SIP server.
The request has an expiration period of 0 and applies to all existing contact locations.
Since the user already has authenticated with the server, the user supplies authentication credentials with the request and is not challenged by the server.
The SIP server validates the user's credentials.
It clears the user's contact list, and returns a response (200 OK) to Bob's SIP client.
Message Details F1 REGISTER Bob   SIP Server REGISTER sips:ss2.biloxi.example.com SIP/2.0
/TLS client.biloxi.example.com:5061;branch z9hG4bKnashds7 Max Forwards: 70
Digest username "bob", realm "atlanta.example.com", nonce "88df84f1cac4341aea9c8ee6cbe5a359", opaque ""
, uri "sips:ss2.biloxi.example.com", response "ff0437c51696f9a76244f0cf1dbabbea" Content Length: 0 F2 200 OK SIP Server
SIP/2.0/TLS client.biloxi.example.com:5061;branch z9hG4bKnashds7 ;received 192.0.2.201 From: Bob
1418nmdsrf Call ID: 1j9FpLxk3uxtm8tn@biloxi.example.com CSeq:
1 REGISTER Content Length: 0 2.5.
The SIP server provides a challenge to Bob.
Bob enters her/his user ID and password.
Bob's SIP client encrypts the user information according to the challenge issued by the SIP server and sends the response to the SIP server.
The SIP server attempts to validate the user's credentials, but they are not valid (the user's password does not match the password established for the user's account).
The server returns a response (401 Unauthorized) to Bob's SIP client.
Message Details F1 REGISTER Bob   SIP Server REGISTER sips:ss2.biloxi.example.com SIP/2.0
SIP/2.0/TLS client.biloxi.example.com:5061;branch z9hG4bKnashds7 ;received 192.0.2.201 From: Bob
Content Length: 0 F2 Unauthorized SIP Server
SIP/2.0/TLS client.biloxi.example.com:5061;branch z9hG4bKnashds7 ;received 192.0.2.201 From: Bob
1410948204 Call ID: 1j9FpLxk3uxtm8tn@biloxi.example.com CSeq:
Digest username "bob", realm "atlanta.example.com", nonce "f1cec4341ae6ca9c8e88df84be55a359
/   The response above encodes the incorrect password  / F4 401
1410948204 Call ID: 1j9FpLxk3uxtm8tn@biloxi.example.com CSeq:
This section details session establishment between two SIP User Agents (UAs): Alice and Bob.
Alice (sip:alice@atlanta.example.com) and Bob (sip:bob@biloxi.example.com) are assumed to be SIP phones or SIP enabled devices.
The successful calls show the initial signaling, the exchange of media information in the form of SDP payloads, the establishment of the media session, then finally the termination of the call.
HTTP Digest authentication is used by Proxy Servers to authenticate the caller Alice.
It is assumed that Bob has registered with Proxy Server Proxy 2 as per Section 2 to be able to receive the calls via the Proxy.
In this scenario, Alice completes a call to Bob directly.
Call ID: 3848276298220188511@atlanta.example.com CSeq: 1 INVITE Contact:
alice@client.atlanta.example.com;transport tcp> Content Type: application/sdp Content Length:
151 v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s
0 m audio 49172 RTP/AVP 0 a rtpmap:0
PCMU/8000 F2 180 Ringing Bob   Alice
SIP/2.0/TCP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
Call ID: 3848276298220188511@atlanta.example.com CSeq: 1 INVITE Contact:
<sip:bob@client.biloxi.example.com;transport tcp> Content Length: 0 F3 200
SIP/2.0/TCP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
Call ID: 3848276298220188511@atlanta.example.com CSeq: 1 INVITE Contact:
bob@client.biloxi.example.com;transport tcp> Content Type: application/sdp Content Length: 147 v 0 o bob 2890844527 2890844527
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F4 ACK Alice
1 ACK Content Length: 0
Note that the CSeq is NOT 2, since Alice and Bob maintain their own independent CSeq counts.
(The INVITE was request 1 generated by Alice, and the BYE is request 1 generated by Bob)
/ F5 BYE Bob   Alice BYE sip:alice@client.atlanta.example.com
/TCP client.biloxi.example.com:5060;branch z9hG4bKnashds7 Max Forwards: 70
9fxced76sl Call ID: 3848276298220188511@atlanta.example.com CSeq:
1 BYE Content Length: 0 F6 200
SIP/2.0/TCP client.biloxi.example.com:5060;branch z9hG4bKnashds7 ;received 192.0.2.201 From: Bob <sip:bob@biloxi.example.com>;tag 8321234356
9fxced76sl Call ID: 3848276298220188511@atlanta.example.com CSeq:
1 BYE Content Length: 0 3.2.
In this scenario, Alice completes a call to Bob using two proxies Proxy 1 and Proxy 2.
The initial INVITE (F1) contains a pre loaded Route header with the address of Proxy 1
(Proxy 1 is configured as a default outbound proxy for Alice).
The request does not contain the Authorization credentials Proxy 1 requires, so a 407 Proxy Authorization response is sent containing the challenge information.
A new INVITE (F4) is then sent containing the correct credentials and the call proceeds.
The call terminates when Bob disconnects by initiating a BYE message.
Proxy 1 inserts a Record Route header into the INVITE message to ensure that it is present in all subsequent message exchanges.
Proxy 2 also inserts itself into the Record Route header.
The ACK (F15) and BYE (F18) both have a Route header.
Message Details F1 INVITE Alice   Proxy 1 INVITE
SIP/2.0/TCP client.atlanta.example.com:5060;branch z9hG4bK74b43 Max Forwards: 70 Route:
Call ID: 3848276298220188511@atlanta.example.com CSeq: 1 INVITE Contact:
alice@client.atlanta.example.com;transport tcp> Content Type: application/sdp Content Length:
151 v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 /  Proxy 1 challenges Alice for authentication
/ F2 407 Proxy Authorization Required Proxy 1
SIP/2.0/TCP client.atlanta.example.com:5060;branch z9hG4bK74b43 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
3flal12sf Call ID: 3848276298220188511@atlanta.example.com CSeq: 1 INVITE Proxy Authenticate:
SIP/2.0/TCP client.atlanta.example.com:5060;branch z9hG4bK74b43 Max Forwards: 70
3flal12sf Call ID: 3848276298220188511@atlanta.example.com CSeq:
1 ACK Content Length: 0 /
Alice responds be re sending the INVITE with authentication credentials in it.
/ F4 INVITE Alice   Proxy 1
z9hG4bK74bf9 Max Forwards: 70 Route: <
Call ID: 3848276298220188511@atlanta.example.com CSeq: 2 INVITE Contact:
" Content Type: application/sdp Content Length: 151 v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s   c IN IP4 192.0.2.101 t 0
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 /  Proxy 1 accepts the credentials and forwards the INVITE to Proxy 2.
Client for Alice prepares to receive data on port 49172 from the network.
/ F5 INVITE Proxy 1   Proxy 2 INVITE
SIP/2.0/TCP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Max Forwards: 69 Record Route:
Call ID: 3848276298220188511@atlanta.example.com CSeq: 2 INVITE Contact:
alice@client.atlanta.example.com;transport tcp> Content Type: application/sdp Content Length:
151 v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 F6 100
SIP/2.0/TCP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
Call ID: 3848276298220188511@atlanta.example.com CSeq: 2 INVITE Content Length: 0 F7 INVITE Proxy 2
SIP/2.0/TCP ss1.atlanta.example.com:5060;branch z9hG4bK2d4790.1 ;received 192.0.2.111 Via:
SIP/2.0/TCP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Max Forwards: 68 Record Route:
Call ID: 3848276298220188511@atlanta.example.com CSeq: 2 INVITE Contact:
alice@client.atlanta.example.com;transport tcp> Content Type: application/sdp Content Length:
151 v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 F8 100 Trying Proxy 2   Proxy 1
SIP/2.0/TCP ss1.atlanta.example.com:5060;branch z9hG4bK2d4790.1 ;received 192.0.2.111 Via:
SIP/2.0/TCP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
Call ID: 3848276298220188511@atlanta.example.com CSeq: 2 INVITE Content Length: 0 F9 180 Ringing Bob   Proxy 2 SIP/2.0 180 Ringing
SIP/2.0/TCP ss2.biloxi.example.com:5060;branch z9hG4bK721e4.1 ;received 192.0.2.222 Via:
SIP/2.0/TCP ss1.atlanta.example.com:5060;branch z9hG4bK2d4790.1 ;received 192.0.2.111 Via:
SIP/2.0/TCP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Record Route: <sip:ss2.biloxi.example.com;lr>, <sip:ss1.atlanta.example.com;lr>
314159 Call ID: 3848276298220188511@atlanta.example.com Contact: <sip:
2 INVITE Content Length: 0 F10 180 Ringing Proxy 2   Proxy 1
SIP/2.0/TCP ss1.atlanta.example.com:5060;branch z9hG4bK2d4790.1 ;received 192.0.2.111 Via:
SIP/2.0/TCP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Record Route: <sip:ss2.biloxi.example.com;lr>, <sip:ss1.atlanta.example.com;lr>
314159 Call ID: 3848276298220188511@atlanta.example.com Contact: <sip:
2 INVITE Content Length: 0 F11 180 Ringing Proxy 1
SIP/2.0/TCP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Record Route: <sip:ss2.biloxi.example.com;lr>, <sip:ss1.atlanta.example.com;lr>
314159 Call ID: 3848276298220188511@atlanta.example.com Contact: <sip:
2 INVITE Content Length: 0 F12 200 OK Bob   Proxy 2
SIP/2.0/TCP ss2.biloxi.example.com:5060;branch z9hG4bK721e4.1 ;received 192.0.2.222 Via:
SIP/2.0/TCP ss1.atlanta.example.com:5060;branch z9hG4bK2d4790.1 ;received 192.0.2.111 Via:
SIP/2.0/TCP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Record Route: <sip:ss2.biloxi.example.com;lr>, <sip:ss1.atlanta.example.com;lr>
314159 Call ID: 3848276298220188511@atlanta.example.com CSeq: 2 INVITE Contact:
bob@client.biloxi.example.com;transport tcp> Content Type: application/sdp Content Length: 147 v 0 o bob 2890844527 2890844527
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F13 200
OK Proxy 2   Proxy 1
SIP/2.0/TCP ss1.atlanta.example.com:5060;branch z9hG4bK2d4790.1 ;received 192.0.2.111 Via:
SIP/2.0/TCP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Record Route: <sip:ss2.biloxi.example.com;lr>, <sip:ss1.atlanta.example.com;lr>
314159 Call ID: 3848276298220188511@atlanta.example.com CSeq: 2 INVITE Contact:
bob@client.biloxi.example.com;transport tcp> Content Type: application/sdp Content Length: 147 v 0 o bob 2890844527 2890844527
0 m audio 3456 RTP/AVP 0
SIP/2.0/TCP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Record Route: <sip:ss2.biloxi.example.com;lr>, <sip:ss1.atlanta.example.com;lr>
314159 Call ID: 3848276298220188511@atlanta.example.com CSeq: 2 INVITE Contact:
bob@client.biloxi.example.com;transport tcp> Content Type: application/sdp Content Length: 147 v 0 o bob 2890844527 2890844527
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F15 ACK Alice   Proxy 1
Max Forwards: 70 Route: <
314159 Call ID: 3848276298220188511@atlanta.example.com CSeq:
2 ACK Content Length: 0 F16 ACK Proxy 1   Proxy 2
SIP/2.0/TCP client.atlanta.example.com:5060;branch z9hG4bK74b76 ;received 192.0.2.101 Max Forwards: 69 Route: <
314159 Call ID: 3848276298220188511@atlanta.example.com CSeq:
2 ACK Content Length: 0 F17 ACK Proxy 2
SIP/2.0/TCP ss1.atlanta.example.com:5060;branch z9hG4bK2d4790.1 ;received 192.0.2.111 Via:
SIP/2.0/TCP client.atlanta.example.com:5060;branch z9hG4bK74b76 ;received 192.0.2.101 Max Forwards: 68
314159 Call ID: 3848276298220188511@atlanta.example.com CSeq:
2 ACK Content Length: 0
Alice and Bob maintain their own separate CSeq counts  / F18 BYE Bob   Proxy 2 BYE sip:alice@client.atlanta.example.com
/TCP client.biloxi.example.com:5060;branch z9hG4bKnashds7 Max Forwards: 70 Route: <
9fxced76sl Call ID: 3848276298220188511@atlanta.example.com CSeq:
1 BYE Content Length: 0
F19 BYE Proxy 2   Proxy 1
SIP/2.0/TCP client.biloxi.example.com:5060;branch z9hG4bKnashds7 ;received 192.0.2.201 Max Forwards: 69 Route: <
9fxced76sl Call ID: 3848276298220188511@atlanta.example.com CSeq:
1 BYE Content Length: 0
SIP/2.0/TCP ss2.biloxi.example.com:5060;branch z9hG4bK721e4.1 ;received 192.0.2.222
SIP/2.0/TCP client.biloxi.example.com:5060;branch z9hG4bKnashds7 ;received 192.0.2.201 Max Forwards: 68
9fxced76sl Call ID: 3848276298220188511@atlanta.example.com CSeq:
1 BYE Content Length: 0
F21 200 OK Alice   Proxy 1
SIP/2.0/TCP ss1.atlanta.example.com:5060;branch z9hG4bK2d4790.1 ;received 192.0.2.111 Via:
SIP/2.0/TCP ss2.biloxi.example.com:5060;branch z9hG4bK721e4.1 ;received 192.0.2.222
SIP/2.0/TCP client.biloxi.example.com:5060;branch z9hG4bKnashds7 ;received 192.0.2.201 From: Bob <sip:bob@biloxi.example.com>;tag 314159
9fxced76sl Call ID: 3848276298220188511@atlanta.example.com CSeq:
1 BYE Content Length: 0
F22 200 OK Proxy 1
SIP/2.0/TCP ss2.biloxi.example.com:5060;branch z9hG4bK721e4.1 ;received 192.0.2.222
SIP/2.0/TCP client.biloxi.example.com:5060;branch z9hG4bKnashds7 ;received 192.0.2.101 From: Bob <sip:
9fxced76sl Call ID: 3848276298220188511@atlanta.example.com CSeq:
1 BYE Content Length: 0
F23 200 OK Proxy 2
SIP/2.0/TCP client.biloxi.example.com:5060;branch z9hG4bKnashds7 ;received 192.0.2.201 From: Bob <sip:bob@biloxi.example.com>;tag 314159
9fxced76sl Call ID: 3848276298220188511@atlanta.example.com CSeq:
1 BYE Content Length: 0 3.3.
In this scenario, Alice completes a call to Bob using two proxies Proxy 1 and Proxy 2.
Alice has valid credentials in both domains.
Since the initial INVITE (F1) does not contain the Authorization credentials Proxy 1 requires, so a 407 Proxy Authorization response is sent containing the challenge information.
A new INVITE (F4) is then sent containing the correct credentials and the call proceeds after Proxy 2 challenges and receives valid credentials.
The call terminates when Bob disconnects by initiating a BYE message.
Proxy 1 inserts a Record Route header into the INVITE message to ensure that it is present in all subsequent message exchanges.
Proxy 2 also inserts itself into the Record Route header.
Message Details F1 INVITE Alice   Proxy 1 INVITE
Max Forwards: 70 Route: <
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <sip:alice@client.atlanta.example.com
> Content Type: application/sdp Content Length: 151 v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 /  Proxy 1 challenges Alice for authentication
/ F2 407 Proxy Authorization Required Proxy 1
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74b03 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Proxy Authenticate:
Digest realm "atlanta.example.com", qop "auth",
1 ACK Content Length: 0 /
Alice responds be re sending the INVITE with authentication credentials in it.
The same Call ID is used, so the CSeq is increased.
/ F4 INVITE Alice   Proxy 1
Max Forwards: 70 Route: <
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 2 INVITE Contact: <sip:alice@client.atlanta.example.com>
" Content Type: application/sdp Content Length: 151 v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s   c IN IP4 192.0.2.101 t 0
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 /  Proxy 1 accepts the credentials and forwards the INVITE to Proxy 2.
Client for Alice prepares to receive data on port 49172 from the network.
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74b21 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 2 INVITE Content Length: 0 F6 INVITE Proxy 1   Proxy 2 INVITE
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74b21 ;received 192.0.2.101 Max Forwards: 69 Record Route:
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 2 INVITE Contact: <sip:alice@client.atlanta.example.com
> Content Type: application/sdp Content Length: 151 v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 /  Proxy 2 challenges Alice for authentication
/ F7 407 Proxy Authorization Required Proxy 2   Proxy 1
SIP/2.0/UDP ss1.atlanta.example.com:5060;branch z9hG4bK230f2.1 ;received 192.0.2.111 Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74b21 ;received 192.0.2.101 From: Alice <sip:
Bob <sip:bob@biloxi.example.com>;tag 838209 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq:
Bob <sip:bob@biloxi.example.com>;tag 838209 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq:
2 ACK Content Length: 0 /  Proxy 1 forwards the challenge to Alice for authentication from Proxy 2  / F9 407 Proxy Authorization Required Proxy 1
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74b21 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
Bob <sip:bob@biloxi.example.com>;tag 838209 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq:
Bob <sip:bob@biloxi.example.com>;tag 838209 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq:
Alice responds be re sending the INVITE with authentication credentials for Proxy 1 AND Proxy 2.
F11 INVITE Alice   Proxy 1
/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 Max Forwards: 70
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 3 INVITE Contact: <sip:alice@client.atlanta.example.com>
" Content Type: application/sdp Content Length: 151 v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 /  Proxy 1 finds its credentials and authorizes Alice, forwarding the INVITE to Proxy.
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 3 INVITE Content Length: 0 F13 INVITE Proxy 1   Proxy 2 INVITE
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Max Forwards: 69 Record Route:
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 3 INVITE Contact: <sip:alice@client.atlanta.example.com>
" Content Type: application/sdp Content Length: 151 v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 /  Proxy 2 finds its credentials and authorizes Alice, forwarding the INVITE to Bob.
SIP/2.0/UDP ss1.atlanta.example.com:5060;branch z9hG4bK230f2.1 ;received 192.0.2.111 Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 3 INVITE Content Length: 0
SIP/2.0/UDP ss1.atlanta.example.com:5060;branch z9hG4bK230f2.1 ;received 192.0.2.111 Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Max Forwards: 68 Record Route:
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 3 INVITE Contact: <sip:alice@client.atlanta.example.com
> Content Type: application/sdp Content Length: 151 v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s
0 m audio 49172 RTP/AVP 0 a rtpmap:0
PCMU/8000 /  Bob answers the call immediately  /
SIP/2.0/UDP ss1.atlanta.example.com:5060;branch z9hG4bK230f2.1 ;received 192.0.2.111 Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Record Route:
9103874 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 3 INVITE Contact: <
sip:bob@client.biloxi.example.com> Content Type: application/sdp Content Length: 147 v 0 o bob 2890844527 2890844527 IN IP4 client.biloxi.example.com s
0 m audio 3456 RTP/AVP 0
a rtpmap:0 PCMU/8000 F17 200
OK Proxy 2   Proxy 1
SIP/2.0/UDP ss1.atlanta.example.com:5060;branch z9hG4bK230f2.1 ;received 192.0.2.111 Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Record Route:
9103874 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 3 INVITE Contact: <
sip:bob@client.biloxi.example.com> Content Type: application/sdp Content Length: 147 v 0 o bob 2890844527 2890844527 IN IP4 client.biloxi.example.com s
0 m audio 3456 RTP/AVP 0
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Record Route:
9103874 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 3 INVITE Contact: <
sip:bob@client.biloxi.example.com> Content Type: application/sdp Content Length: 147 v 0 o bob 2890844527 2890844527 IN IP4 client.biloxi.example.com s
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F19 ACK Alice   Proxy 1
/UDP client.atlanta.example.com:5060;branch z9hG4bK74b44 Max Forwards: 70 Route: <
9103874 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq:
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74b44 ;received 192.0.2.101 Max Forwards: 69 Route:
9103874 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq:
SIP/2.0/UDP ss1.atlanta.example.com:5060;branch z9hG4bK230f2.1 ;received 192.0.2.111 Via:
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74b44 ;received 192.0.2.101 Max Forwards: 68 From:
9103874 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq:
sip:bob@client.biloxi.example.com> Content Length: 0 3.4.
In this scenario, Alice completes a call to Bob via a Proxy Server.
Alice is configured for a primary SIP Proxy Server Proxy 1 and a secondary SIP Proxy Server Proxy 2 (Or is able to use DNS SRV records to locate Proxy 1 and Proxy 2).
Alice has valid credentials for both domains.
Proxy 1 is out of service and does not respond to INVITEs (it is reachable, but unresponsive).
Alice then completes the call to Bob using Proxy 2.
Message Details F1 INVITE Alice   Proxy 1 INVITE
Max Forwards: 70 Route: <
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <sip:alice@client.atlanta.example.com
> Content Type: application/sdp Content Length: 151 v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 F2 INVITE Alice   Proxy
1 Same as Message F1 F3 INVITE Alice   Proxy
1 Same as Message F1 F4 INVITE Alice   Proxy
1 Same as Message F1 F5 INVITE Alice   Proxy
1 Same as Message F1 F6 INVITE Alice   Proxy
1 Same as Message F1 F7 INVITE Alice   Proxy
1 Same as Message F1 /
Alice gives up on the unresponsive proxy  / F8 INVITE Alice   Proxy 2 INVITE sip:bob@biloxi.example.com
> Call ID: 4Fde34wkd11wsGFDs3@atlanta.example.com CSeq: 1 INVITE Contact: <sip:alice@client.atlanta.example.com
> Content Type: application/sdp Content Length: 151 v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 /  Proxy 2 challenges Alice for authentication
/ F9 407 Proxy Authorization Required Proxy 2
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74b8a ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
2421452 Call ID: 4Fde34wkd11wsGFDs3@atlanta.example.com CSeq:
ACK Alice   Proxy 2 ACK
2421452 Call ID: 4Fde34wkd11wsGFDs3@atlanta.example.com CSeq:
1 ACK Content Length: 0 /
Alice responds by re sending the INVITE with authentication credentials in it.
F11 INVITE Alice   Proxy 2
/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 Max Forwards: 70
> Call ID: 4Fde34wkd11wsGFDs3@atlanta.example.com CSeq: 2 INVITE Contact: <sip:alice@client.atlanta.example.com>
" Content Type: application/sdp Content Length: 151 v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s   c IN IP4 192.0.2.101 t 0
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 /  Proxy 2 accepts the credentials and forwards the INVITE to Bob.
Client for Alice prepares to receive data on port 49172 from the network.
/ F12 INVITE Proxy 2
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Max Forwards: 69 Record Route:
> Call ID: 4Fde34wkd11wsGFDs3@atlanta.example.com CSeq: 2 INVITE Contact: <sip:alice@client.atlanta.example.com
> Content Type: application/sdp Content Length: 151 v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 F13 100
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
> Call ID: 4Fde34wkd11wsGFDs3@atlanta.example.com CSeq: 2 INVITE Content Length: 0
F14 180 Ringing Bob   Proxy 2
SIP/2.0/UDP ss2.biloxi.example.com:5060;branch z9hG4bK721e4.1 ;received 192.0.2.222
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Record Route:
314159 Call ID: 4Fde34wkd11wsGFDs3@atlanta.example.com CSeq: 2 INVITE Contact: <
sip:bob@client.biloxi.example.com> Content Length: 0 F15 180 Ringing Proxy 2
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Record Route:
314159 Call ID: 4Fde34wkd11wsGFDs3@atlanta.example.com CSeq: 2 INVITE Contact: <
SIP/2.0/UDP ss2.biloxi.example.com:5060;branch z9hG4bK721e4.1 ;received 192.0.2.222
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Record Route:
314159 Call ID: 4Fde34wkd11wsGFDs3@atlanta.example.com CSeq: 2 INVITE Contact: <
sip:bob@client.biloxi.example.com> Content Type: application/sdp Content Length: 147 v 0 o bob 2890844527 2890844527 IN IP4 client.biloxi.example.com s
0 m audio 3456 RTP/AVP 0
a rtpmap:0 PCMU/8000 F17 200
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Record Route:
314159 Call ID: 4Fde34wkd11wsGFDs3@atlanta.example.com CSeq: 2 INVITE Contact: <
sip:bob@client.biloxi.example.com> Content Type: application/sdp Content Length: 147 v 0 o bob 2890844527 2890844527 IN IP4 client.biloxi.example.com s
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F18 ACK Alice   Proxy 2
Max Forwards: 70 Route: <
314159 Call ID: 4Fde34wkd11wsGFDs3@atlanta.example.com CSeq:
2 ACK Content Length: 0 F19 ACK Proxy 2   Bob ACK sip:bob@client.biloxi.example.com
;received 192.0.2.101 Max Forwards: 69
314159 Call ID: 4Fde34wkd11wsGFDs3@atlanta.example.com CSeq:
2 ACK Content Length: 0
Bob   Proxy 2 BYE sip:alice@client.atlanta.example.com
/UDP client.biloxi.example.com:5060;branch z9hG4bKnashds7 Max Forwards: 70 Route: <
1 BYE Content Length: 0
SIP/2.0/UDP client.biloxi.example.com:5060;branch z9hG4bKnashds7 ;received 192.0.2.201 Max Forwards: 69 From: Bob
1 BYE Content Length: 0
F22 200 OK Alice   Proxy 2
SIP/2.0/UDP ss2.biloxi.example.com:5060;branch z9hG4bK721e4.1 ;received 192.0.2.222
SIP/2.0/UDP client.biloxi.example.com:5060;branch z9hG4bKnashds7 ;received 192.0.2.201 From: Bob <sip:bob@biloxi.example.com>;tag
1 BYE Content Length: 0
F23 200 OK Proxy 2
SIP/2.0/UDP client.biloxi.example.com:5060;branch z9hG4bKnashds7 ;received 192.0.2.201 From: Bob <sip:bob@biloxi.example.com>;tag
1 BYE Content Length: 0 3.5.
The routing through the ALG is accomplished using a pre loaded Route header in the INVITE F1.
Note that the media stream setup is not end to end the ALG terminates both media streams and bridges them.
This is done by the ALG modifying the SDP in the INVITE (F1) and 200 OK (F10) messages, and possibly any 18x or ACK messages containing SDP.
In addition to firewall traversal, this Back to Back User Agent (B2BUA) could be used as part of an anonymizer service (in which all identifying information on Alice would be removed), or to perform codec media conversion, such as mu law to A law conversion of PCM on an international call.
Also note that Proxy 2 does not Record Route in this call flow.
/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 Max Forwards: 70
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <sip:alice@client.atlanta.example.com
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 /  Client for Alice prepares to receive data on port 49172 from the network.
/ F2 INVITE SIP ALG   Proxy 2
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Max Forwards: 69 Record Route:
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <sip:alice@client.atlanta.example.com>
m audio 2000 RTP/AVP 0 a rtpmap:0 PCMU/8000 F3 100 Trying
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Content Length: 0 /
SIP ALG prepares to proxy data from port 192.0.2.128/2000 to 192.0.2.101/49172.
Proxy 2 uses a Location Service function to determine where Bob is located.
Based upon location analysis the call is forwarded to Bob  / F4 INVITE Proxy 2
;received 192.0.2.128 Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Max Forwards: 68 Record Route:
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <sip:alice@client.atlanta.example.com
> Content Type: application/sdp Content Length: 150 v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s   c IN IP4 192.0.2.128 t 0 0
m audio 2000 RTP/AVP 0 a rtpmap:0 PCMU/8000 F5 100 Trying Proxy 2
;received 192.0.2.128 Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Content Length: 0 F6 180 Ringing Bob   Proxy
SIP/2.0/UDP ss2.biloxi.example.com:5060;branch z9hG4bK2d4790.1 ;received 192.0.2.222
;received 192.0.2.128 Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Record Route:
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <
sip:bob@client.biloxi.example.com> Content Length: 0 F7 180 Ringing Proxy 2
SIP ALG SIP/2.0 180 Ringing
;received 192.0.2.128 Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Record Route:
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <
sip:bob@client.biloxi.example.com> Content Length: 0 F8 180
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Record Route:
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <
sip:bob@client.biloxi.example.com> Content Length: 0 F9 200 OK Bob   Proxy 2
SIP/2.0/UDP ss2.biloxi.example.com:5060;branch z9hG4bK2d4790.1 ;received 192.0.2.222
;received 192.0.2.128 Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Record Route:
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <
sip:bob@client.biloxi.example.com> Content Type: application/sdp Content Length: 147 v 0 o bob 2890844527 2890844527 IN IP4 client.biloxi.example.com s
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F10 200
OK Proxy 2   SIP ALG
;received 192.0.2.128 Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Record Route:
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <
sip:bob@client.biloxi.example.com> Content Type: application/sdp Content Length: 147 v 0 o bob 2890844527 2890844527 IN IP4 client.biloxi.example.com s
0 m audio 3456 RTP/AVP 0
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Record Route:
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <
sip:bob@client.biloxi.example.com> Content Type: application/sdp Content Length: 147 v 0 o bob 2890844527 2890844527 IN IP4 client.biloxi.example.com s
0 m audio 1734 RTP/AVP 0 a rtpmap:0 PCMU/8000 /
The ALG prepares to proxy packets from 192.0.2.128/ 1734 to 192.0.2.201/3456
Max Forwards: 70 Route: <sip:alg1.atlanta.example.com;lr
1 ACK Content Length: 0
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bhh ;received 192.0.2.101 Max Forwards: 69
1 ACK Content Length: 0
z9hG4bK74be5 Max Forwards: 70 Route: <
2 BYE Content Length: 0
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74be5 ;received 192.0.2.101 Max Forwards: 69 From:
2 BYE Content Length: 0
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74be5 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
2 BYE Content Length: 0
F17 200 OK SIP ALG   Alice
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74be5 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
2 BYE Content Length: 0 3.6.
In this scenario, Alice places a call to Bob using first a Redirect server then a Proxy Server.
The INVITE message is first sent to the Redirect Server.
The Server returns a 302
Moved Temporarily response (F2) containing a Contact header with Bob's current SIP address.
Alice then generates a new INVITE and sends to Bob via the Proxy Server and the call proceeds normally.
In this example, no SDP is present in the INVITE, so the SDP is carried in the ACK message.
The call is terminated when Bob sends a BYE message.
Message Details F1 INVITE Alice
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <sip:alice@client.atlanta.example.com
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bKbf9f44 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
53fHlqlQ2 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact:
bob@chicago.example.com;transport tcp> Content Length: 0 F3 ACK Alice   Redirect Server ACK
53fHlqlQ2 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq:
1 ACK Content Length: 0 F4 INVITE Alice   Proxy 3 INVITE sip:bob@chicago.example.com
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 2 INVITE Contact:
alice@client.atlanta.example.com;transport tcp> Content Length: 0 F5 INVITE Proxy 3   Bob
SIP/2.0/TCP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Max Forwards: 69 Record Route:
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 2 INVITE Contact:
alice@client.atlanta.example.com;transport tcp> Content Length: 0 F6 100 Trying Proxy 3
SIP/2.0/TCP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 2 INVITE Content Length: 0 F7 180 Ringing Bob   Proxy 3
SIP/2.0/TCP ss3.chicago.example.com:5060;branch z9hG4bK721e.1 ;received 192.0.2.233
SIP/2.0/TCP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Record Route:
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 2 INVITE Contact:
SIP/2.0/TCP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Record Route: <sip:ss3.chicago.example.com;lr> From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 2 INVITE Contact:
0 F9 200 OK Bob   Proxy 3
SIP/2.0/TCP ss3.chicago.example.com:5060;branch z9hG4bK721e.1 ;received 192.0.2.233
SIP/2.0/TCP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Record Route:
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 2 INVITE Contact:
> Content Type: application/sdp Content Length: 148 v 0 o bob 2890844527 2890844527 IN IP4 client.chicago.example.com s   c IN IP4 192.0.2.100 t
0 0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F10 200
SIP/2.0/TCP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Record Route: <sip:ss3.chicago.example.com;lr> From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 2 INVITE Contact:
> Content Type: application/sdp Content Length: 148 v 0 o bob 2890844527 2890844527 IN IP4 client.chicago.example.com s   c IN IP4 192.0.2.100 t
0 0 m audio 3456 RTP/AVP 0 a rtpmap:0
PCMU/8000 /  ACK contains SDP of Alice since none present in INVITE  / F11 ACK Alice   Proxy 3 ACK sip:bob@client.chicago.example.com
z9hG4bK74bq9 Max Forwards: 70 Route: <sip:ss3.chicago.example.com;lr>
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq:
2 ACK Content Type: application/sdp Content Length: 151 v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 F12 ACK Proxy 3   Bob ACK sip:bob@client.chicago.example.com
SIP/2.0/TCP client.atlanta.example.com:5060;branch z9hG4bK74bq9 ;received 192.0.2.101 Max Forwards: 69
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq:
2 ACK Content Type: application/sdp Content Length: 151 v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s
0 m audio 49172 RTP/AVP 0
/ F13 BYE Bob   Proxy 3 BYE sip:alice@client.atlanta.example.com
/TCP client.chicago.example.com:5060;branch z9hG4bKfgaw2 Max Forwards: 70 Route: <
1 BYE Content Length: 0
SIP/2.0/TCP ss3.chicago.example.com:5060;branch z9hG4bK721e.1 ;received 192.0.2.100 Via:
/TCP client.chicago.example.com:5060;branch z9hG4bKfgaw2 Max Forwards
: 69 From: Bob <
1 BYE Content Length: 0
SIP/2.0/TCP ss3.chicago.example.com:5060;branch z9hG4bK721e.1 ;received 192.0.2.233
SIP/2.0/TCP client.chicago.example.com:5060;branch z9hG4bKfgaw2 ;received 192.0.2.100 From: Bob <sip:bob@biloxi.example.com>;tag 314159
1 BYE Content Length: 0
F16 200 OK Proxy 3
SIP/2.0/TCP client.chicago.example.com:5060;branch z9hG4bKfgaw2 ;received 192.0.2.100 From: Bob <sip:bob@biloxi.example.com>;tag 314159
1 BYE Content Length: 0 3.7.
This example shows a session in which the media changes midway through the session.
When Bob's IP address changes during the session, Bob sends a re INVITE containing a new Contact and SDP (version number incremented) information to A.
In this flow, the proxy does not Record Route so is not in the SIP messaging path after the initial exchange.
/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 Max Forwards: 70
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <sip:alice@client.atlanta.example.com
> Content Type: application/sdp Content Length: 151 v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 F2 INVITE Proxy 2
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Max Forwards: 69 From:
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <sip:alice@client.atlanta.example.com
> Content Type: application/sdp Content Length: 151 v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 F3 100
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Content Length: 0 F4 180
SIP/2.0/UDP ss2.biloxi.example.com:5060;branch z9hG4bK2d4790.1 ;received 192.0.2.222
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <
sip:bob@client.biloxi.example.com> Content Length: 0 F5 180 Ringing Proxy 2
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <
sip:bob@client.biloxi.example.com> Content Length: 0 F6 200 OK Bob   Proxy 2
SIP/2.0/UDP ss2.biloxi.example.com:5060;branch z9hG4bK2d4790.1 ;received 192.0.2.222
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <
sip:bob@client.biloxi.example.com> Content Type: application/sdp Content Length: 147 v 0 o bob 2890844527 2890844527 IN IP4 client.biloxi.example.com s
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F7 200
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <
sip:bob@client.biloxi.example.com> Content Type: application/sdp Content Length: 147 v 0 o bob 2890844527 2890844527 IN IP4 client.biloxi.example.com s
0 m audio 3456 RTP/AVP 0 a rtpmap:0 PCMU/8000 F8 ACK Alice
UDP client.atlanta.example.com:5060;branch z9hG4bK74b7b Max Forwards: 70
1 ACK Content Length: 0
Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 14 INVITE Contact:
<sip:bob@client.chicago.example.com> Content Type: application/sdp Content Length: 149 v 0 o bob 2890844527 2890844528 IN IP4 client.chicago.example.com s   c
IN IP4 192.0.2.100 t 0
0 m audio 47172 RTP/AVP 0 a rtpmap:0 PCMU/8000 F10 200
SIP/2.0/UDP client.chicago.example.com:5060;branch z9hG4bKlkld5l ;received 192.0.2.100 Max Forwards: 70 From: Bob
Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 14 INVITE Contact: <sip:alice@client.atlanta.example.com
> Content Type: application/sdp Content Length: 150 v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s
0 m audio 1000 RTP/AVP 0 a rtpmap:0 PCMU/8000 F11 ACK Bob   Alice ACK sip:alice@client.atlanta.example.com
/UDP client.chicago.example.com:5060;branch z9hG4bKlkldcc Max Forwards: 70
14 ACK Content Length: 0 /  New RTP stream established between Alice and Bob  /
Alice hangs up with Bob  / F12 BYE Alice
2 BYE Content Length: 0
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bo4 ;received 192.0.2.101 Max Forwards: 70 From:
2 BYE Content Length: 0 3.8.
In this scenario, Alice gives up on the call before Bob answers (sends a 200 OK response).
Alice sends a CANCEL (F9) since no final response had been received from Bob.
If a 200 OK to the INVITE had crossed with the CANCEL, Alice would have sent an ACK then a BYE to Bob in order to properly terminate the call.
Note that the CANCEL message is acknowledged with a 200 OK on a hop by hop basis, rather than end to end.
Message Details F1 INVITE Alice   Proxy 1 INVITE
/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 Max Forwards: 70 Route: <
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <sip:alice@client.atlanta.example.com>
" Content Type: application/sdp Content Length: 151 v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 / Client for Alice prepares to receive data on port 49172 from the network.
/ F2 INVITE Proxy 1   Proxy 2 INVITE
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Max Forwards: 69 Record Route:
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <sip:alice@client.atlanta.example.com
> Content Type: application/sdp Content Length: 151 v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 F3 100
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Content Length: 0 F4 INVITE Proxy 2
SIP/2.0/UDP ss1.atlanta.example.com:5060;branch z9hG4bK2d4790.1 ;received 192.0.2.111 Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Record Route:
<sip:ss2.biloxi.example.com;lr>, <sip:ss1.atlanta.example.com;lr> Max Forwards: 68
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <sip:alice@client.atlanta.example.com
> Content Type: application/sdp Content Length: 151 v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 F5 100 Trying Proxy 2   Proxy 1
SIP/2.0/UDP ss1.atlanta.example.com:5060;branch z9hG4bK2d4790.1 ;received 192.0.2.111 Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Content Length: 0 F6 180 Ringing Bob   Proxy
SIP/2.0/UDP ss2.biloxi.example.com:5060;branch z9hG4bK721e4.1 ;received 192.0.2.222
SIP/2.0/UDP ss1.atlanta.example.com:5060;branch z9hG4bK2d4790.1 ;received 192.0.2.111 Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Record Route:
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <
sip:bob@client.biloxi.example.com> Content Length: 0 F7 180
SIP/2.0/UDP ss1.atlanta.example.com:5060;branch z9hG4bK2d4790.1 ;received 192.0.2.111 Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Record Route:
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <
sip:bob@client.biloxi.example.com> Content Length: 0 F8 180
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Record Route:
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <
sip:bob@client.biloxi.example.com> Content Length: 0 F9 CANCEL
/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 Max Forwards: 70
<sip:ss1.atlanta.example.com;lr> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq:
1 CANCEL Content Length: 0 F10 200
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq:
1 CANCEL Content Length: 0
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq:
1 CANCEL Content Length: 0 F12 200
OK Proxy 2   Proxy 1
SIP/2.0/UDP ss1.atlanta.example.com:5060;branch z9hG4bK2d4790.1 ;received 192.0.2.111 From: Alice <sip:
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq:
1 CANCEL Content Length: 0
/UDP ss2.biloxi.example.com:5060;branch z9hG4bK721e4.1 Max Forwards: 70
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq:
1 CANCEL Content Length: 0
SIP/2.0/UDP ss2.biloxi.example.com:5060;branch z9hG4bK721e4.1 ;received 192.0.2.222 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq:
1 CANCEL Content Length: 0 F15 487 Request Terminated Bob   Proxy 2
SIP/2.0/UDP ss2.biloxi.example.com:5060;branch z9hG4bK721e4.1 ;received 192.0.2.222
SIP/2.0/UDP ss1.atlanta.example.com:5060;branch z9hG4bK2d4790.1 ;received 192.0.2.111 Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Content Length: 0
F16 ACK Proxy 2   Bob ACK sip:bob@client.biloxi.example.com
/UDP ss2.biloxi.example.com:5060;branch z9hG4bK721e4.1 Max Forwards: 70
1 ACK Content Length: 0 F17 487 Request Terminated Proxy 2   Proxy 1
SIP/2.0/UDP ss1.atlanta.example.com:5060;branch z9hG4bK2d4790.1 ;received 192.0.2.111 Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Content Length: 0 F18 ACK Proxy 1   Proxy 2 ACK
/UDP ss2.biloxi.example.com:5060;branch z9hG4bK721e4.1 Max Forwards: 70
1 ACK Content Length: 0 F19 487 Request Terminated Proxy 1
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE F20 ACK Alice   Proxy 1 ACK
/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 Max Forwards: 70
1 ACK Content Length: 0 3.9.
In this scenario, Bob is busy and sends a 486 Busy Here response to Alice's INVITE.
Note that the non 2xx response is acknowledged on a hop by hop basis instead of end to end.
Also note that many SIP UAs will not return a 486 response, as they have multiple line and other features.
Message Details F1 INVITE Alice   Proxy 1 INVITE
z9hG4bK74bf9 Max Forwards: 70 Route: <
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact:
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 / Client for Alice prepares to receive data on port 49172 from the network.
/ F2 INVITE Proxy 1   Proxy 2 INVITE
SIP/2.0/TCP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Max Forwards: 69 Record Route:
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact:
alice@client.atlanta.example.com;transport tcp> Content Type: application/sdp Content Length:
151 v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 F3 100
SIP/2.0/TCP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Content Length: 0 F4 INVITE Proxy 2
SIP/2.0/TCP ss1.atlanta.example.com:5060;branch z9hG4bK2d4790.1 ;received 192.0.2.111 Via:
SIP/2.0/TCP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Max Forwards: 68 Record Route:
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact:
alice@client.atlanta.example.com;transport tcp> Content Type: application/sdp Content Length:
151 v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 F5 100 Trying Proxy 2   Proxy 1
SIP/2.0/TCP ss1.atlanta.example.com:5060;branch z9hG4bK2d4790.1 ;received 192.0.2.111 Via:
SIP/2.0/TCP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Content Length: 0 F6 486 Busy Here
SIP/2.0/TCP ss2.biloxi.example.com:5060;branch z9hG4bK721e4.1 ;received 192.0.2.222 Via:
SIP/2.0/TCP ss1.atlanta.example.com:5060;branch z9hG4bK2d4790.1 ;received 192.0.2.111 Via:
SIP/2.0/TCP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Content Length: 0 F7 ACK Proxy 2
/TCP ss2.biloxi.example.com:5060;branch z9hG4bK721e4.1 Max Forwards: 70
1 ACK Content Length: 0 F8 486 Busy
SIP/2.0/TCP ss1.atlanta.example.com:5060;branch z9hG4bK2d4790.1 ;received 192.0.2.111 Via:
SIP/2.0/TCP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Content Length: 0 F9 ACK Proxy 1   Proxy 2 ACK
1 ACK Content Length: 0 F10 486 Busy
SIP/2.0/TCP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Content Length: 0 F11 ACK Alice   Proxy 1 ACK
In this example, there is no response from Bob to Alice's INVITE messages being re transmitted by Proxy 2.
After the sixth re transmission, Proxy 2 gives up and sends a 480 No Response to Alice.
Message Details F1 INVITE Alice   Proxy 1 INVITE
/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 Max Forwards: 70 Route: <
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <sip:alice@client.atlanta.example.com>
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 / Client for Alice prepares to receive data on port 49172 from the network.
/ F2 INVITE Proxy 1   Proxy 2 INVITE
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Max Forwards: 69 Record Route:
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <sip:alice@client.atlanta.example.com
> Content Type: application/sdp Content Length: 151 v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 F3 100
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Content Length: 0 F4 INVITE Proxy 2
SIP/2.0/UDP ss1.atlanta.example.com:5060;branch z9hG4bK2d4790.1 ;received 192.0.2.111 Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;
received 192.0.2.101 Max Forwards: 68 Record Route:
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <sip:alice@client.atlanta.example.com
> Content Type: application/sdp Content Length: 151 v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 F5 100 Trying Proxy 2   Proxy 1
SIP/2.0/UDP ss1.atlanta.example.com:5060;branch z9hG4bK2d4790.1 ;received 192.0.2.111 Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Content Length: 0 F6 INVITE Proxy 2   Bob Resend of Message F4 F7 INVITE Proxy 2   Bob Resend of Message F4 F8 INVITE Proxy 2   Bob Resend of Message F4 F9 INVITE Proxy 2   Bob Resend of Message F4 F10 INVITE Proxy 2   Bob Resend of Message F4 F11 INVITE Proxy 2   Bob Resend of Message F4 /
Proxy 2 gives up  / F12 480
No Response Proxy 2   Proxy 1 SIP/2.0 480
SIP/2.0/UDP ss1.atlanta.example.com:5060;branch z9hG4bK2d4790.1 ;received 192.0.2.111 Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Content Length: 0 F13 ACK Proxy 1   Proxy 2 ACK
1 ACK Content Length: 0 F14 480
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Content Length: 0 F15 ACK Alice   Proxy 1 ACK sip:bob@biloxi.example.com
/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 Max Forwards: 70
" Content Length: 0 3.11.
In this scenario, Bob initially sends a 180 Ringing response to Alice, indicating that alerting is taking place.
However, then a 480 Unavailable is then sent to Alice.
This response is acknowledged then proxied back to Alice.
Message Details F1 INVITE Alice   Proxy 1 INVITE
/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 Max Forwards: 70 Route: <
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <sip:alice@client.atlanta.example.com>
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 / Client for Alice prepares to receive data on port 49172 from the network.
/ F2 INVITE Proxy 1   Proxy 2 INVITE
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Max Forwards: 69 Record Route:
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <sip:alice@client.atlanta.example.com
> Content Type: application/sdp Content Length: 151 v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 F3 100
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Content Length: 0 F4 INVITE Proxy 2
SIP/2.0/UDP ss1.atlanta.example.com:5060;branch z9hG4bK2d4790.1 ;received 192.0.2.111 Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;
received 192.0.2.101 Max Forwards: 68 Record Route:
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <sip:alice@client.atlanta.example.com
> Content Type: application/sdp Content Length: 151 v 0 o alice 2890844526 2890844526 IN IP4 client.atlanta.example.com s
0 m audio 49172 RTP/AVP 0 a rtpmap:0 PCMU/8000 F5 100 Trying Proxy 2   Proxy 1
SIP/2.0/UDP ss1.atlanta.example.com:5060;branch z9hG4bK2d4790.1 ;received 192.0.2.111 Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
> Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Content Length: 0 F6 180 Ringing Bob   Proxy
SIP/2.0/UDP ss2.biloxi.example.com:5060;branch z9hG4bK721e4.1 ;received 192.0.2.222
SIP/2.0/UDP ss1.atlanta.example.com:5060;branch z9hG4bK2d4790.1 ;received 192.0.2.111 Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Record Route:
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <
sip:bob@client.biloxi.example.com> Content Length: 0 F7 180
SIP/2.0/UDP ss1.atlanta.example.com:5060;branch z9hG4bK2d4790.1 ;received 192.0.2.111 Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Record Route:
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <
sip:bob@client.biloxi.example.com> Content Length: 0 F8 180
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 Record Route:
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Contact: <
sip:bob@client.biloxi.example.com> Content Length: 0 F9 480 Temporarily Unavailable Bob   Proxy 2
SIP/2.0/UDP ss2.biloxi.example.com:5060;branch z9hG4bK721e4.1 ;received 192.0.2.222
SIP/2.0/UDP ss1.atlanta.example.com:5060;branch z9hG4bK2d4790.1 ;received 192.0.2.111 Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Content Length: 0 F10 ACK Proxy 2   Bob ACK sip:bob@client.biloxi.example.com
/UDP ss2.biloxi.example.com:5060;branch z9hG4bK721e4.1 Max Forwards: 70
0 F11 480 Temporarily Unavailable Proxy 2   Proxy 1
SIP/2.0/UDP ss1.atlanta.example.com:5060;branch z9hG4bK2d4790.1 ;received 192.0.2.111 Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Content Length: 0 F12 ACK Proxy 1   Proxy 2 ACK
1 ACK Content Length: 0 F13 480
SIP/2.0/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 ;received 192.0.2.101 From: Alice <sip:alice@atlanta.example.com>;tag 9fxced76sl
314159 Call ID: 2xTb9vxSit55XU7p8@atlanta.example.com CSeq: 1 INVITE Content Length: 0
F14 ACK Alice   Proxy 1 ACK
/UDP client.atlanta.example.com:5060;branch z9hG4bK74bf9 Max Forwards: 70
1 ACK Content Length: 0 4.
Security Considerations Since this document contains examples of SIP session establishment, the security considerations in RFC 3261 [1] apply.
RFC 3261 describes the basic threats including registration hijacking, server impersonation, message body tampering, session modifying or teardown, and denial of service and amplification attacks.
The use of HTTP Digest as shown in this document provides one way authentication and protection against replay attacks.
TLS transport is used in registration scenarios due to the lack of integrity protection in HTTP Digest and the danger of registration hijacking without it, as described in RFC 3261 [1].
A full discussion of the weaknesses of HTTP Digest is provided in RFC 3261 [1].
The use of TLS and the Secure SIP (sips)
URI scheme provides a better level of security including two way authentication.
S/MIME can provide end to end confidentiality and integrity protection of message bodies, as described in RFC 3261.
