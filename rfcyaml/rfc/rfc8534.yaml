- contents:
  - '        Explicit Tracking with Wildcard Routes in Multicast VPN

    '
  title: __initial_text__
- contents:
  - "Abstract\n   The base Multicast VPN (MVPN) specifications (RFCs 6513 and 6514)\n
    \  provide procedures to allow a multicast ingress node to invoke\n   \"explicit
    tracking\" for a multicast flow or set of flows, thus\n   learning the egress
    nodes for that flow or set of flows.  However,\n   the specifications are not
    completely clear about how the explicit\n   tracking procedures work in certain
    scenarios.  This document\n   provides the necessary clarifications.  It also
    specifies a new,\n   optimized explicit-tracking procedure.  This new procedure
    allows an\n   ingress node, by sending a single message, to request explicit\n
    \  tracking of each of a set of flows, where the set of flows is\n   specified
    using a wildcard mechanism.  This document updates RFCs\n   6514, 6625, 7524,
    7582, and 7900.\n"
  title: Abstract
- contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This
    document is a product of the Internet Engineering Task Force\n   (IETF).  It represents
    the consensus of the IETF community.  It has\n   received public review and has
    been approved for publication by the\n   Internet Engineering Steering Group (IESG).
    \ Further information on\n   Internet Standards is available in Section 2 of RFC
    7841.\n   Information about the current status of this document, any errata,\n
    \  and how to provide feedback on it may be obtained at\n   https://www.rfc-editor.org/info/rfc8534.\n"
  title: Status of This Memo
- contents:
  - "Copyright Notice\n   Copyright (c) 2019 IETF Trust and the persons identified
    as the\n   document authors.  All rights reserved.\n   This document is subject
    to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n
    \  (https://trustee.ietf.org/license-info) in effect on the date of\n   publication
    of this document.  Please review these documents\n   carefully, as they describe
    your rights and restrictions with respect\n   to this document.  Code Components
    extracted from this document must\n   include Simplified BSD License text as described
    in Section 4.e of\n   the Trust Legal Provisions and are provided without warranty
    as\n   described in the Simplified BSD License.\n"
  title: Copyright Notice
- contents:
  - "Table of Contents\n   1.  Introduction  . . . . . . . . . . . . . . . . . . .
    . . . . .   2\n     1.1.  Terminology . . . . . . . . . . . . . . . . . . . .
    . . .   5\n   2.  The Explicit-Tracking Flags . . . . . . . . . . . . . . . .
    .   5\n   3.  Match for Tracking versus Match for Reception . . . . . . . .   7\n
    \  4.  Ingress Node Initiation of Tracking . . . . . . . . . . . . .   9\n   5.
    \ Egress Node Response to the Match for Tracking  . . . . . . .  11\n     5.1.
    \ General Egress Node Procedures  . . . . . . . . . . . . .  11\n     5.2.  Responding
    to the LIR-pF Flag . . . . . . . . . . . . . .  12\n     5.3.  When the Egress
    Node Is an ABR or ASBR  . . . . . . . . .  15\n   6.  Ingress Node Handling of
    Received Leaf A-D Routes with\n       LIR-pF Set  . . . . . . . . . . . . . .
    . . . . . . . . . . .  16\n   7.  IANA Considerations . . . . . . . . . . . .
    . . . . . . . . .  17\n   8.  Security Considerations . . . . . . . . . . . .
    . . . . . . .  18\n   9.  References  . . . . . . . . . . . . . . . . . . . .
    . . . . .  19\n     9.1.  Normative References  . . . . . . . . . . . . . . .
    . . .  19\n     9.2.  Informative References  . . . . . . . . . . . . . . . .
    .  20\n   Acknowledgments . . . . . . . . . . . . . . . . . . . . . . . . .  20\n
    \  Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  21\n"
  title: Table of Contents
- contents:
  - "1.  Introduction\n   The base Multicast VPN (MVPN) specifications, [RFC6513]
    and\n   [RFC6514], define the \"Selective Provider Multicast Service Interface\n
    \  Auto-Discovery route\" (S-PMSI A-D route).\n   Per those RFCs, the S-PMSI A-D
    route contains a Network Layer\n   Reachability Information (NLRI) field that
    identifies a particular\n   multicast flow.  In the terminology of those RFCs,
    each flow is\n   denoted by (C-S,C-G), where C-S is an IP source address and C-G
    is an\n   IP multicast address, both in the address space of a VPN customer.\n
    \  The (C-S,C-G) of the multicast flow is encoded into the NLRI field.\n   An
    S-PMSI A-D route also carries a PMSI Tunnel attribute (PTA).\n   Typically, the
    PTA is used to identify a tunnel through the provider\n   backbone network (a
    \"P-tunnel\").\n   By originating an S-PMSI A-D route identifying a particular
    multicast\n   flow and a particular P-tunnel, a node is advertising the following:\n
    \     If the node has to transmit packets of the identified flow over\n      the
    backbone, it will transmit them through the identified tunnel.\n   [RFC6513] and
    [RFC6514] also define a procedure that allows an\n   ingress node of a particular
    multicast flow to determine the set of\n   egress nodes that have requested to
    receive that flow from that\n   ingress node.  The ability of an ingress node
    to identify the egress\n   nodes for a particular flow is known as \"explicit
    tracking\".  An\n   ingress node requests explicit tracking by setting a flag
    (the \"Leaf\n   Information Required\" flag, or LIR flag) in the PTA.  When an
    egress\n   node receives an S-PMSI A-D route with the LIR flag set, the egress\n
    \  node originates a Leaf A-D route whose NLRI field contains the NLRI\n   from
    the corresponding S-PMSI A-D route.  In this way, the egress\n   node advertises
    that it has requested to receive the particular flow\n   identified in the NLRI
    of that S-PMSI A-D route.\n   [RFC6513] and [RFC6514] also allow an ingress node
    to originate an\n   S-PMSI A-D route whose PTA has the LIR flag set but that does
    not\n   identify any P-tunnel.  This mechanism can be used when desired to do\n
    \  explicit tracking of a flow without at the same time binding that\n   flow
    to a particular P-tunnel.\n   [RFC6625] (and other RFCs that update it) extends
    the specification\n   of S-PMSI A-D routes and allows an S-PMSI A-D route to encode
    a\n   wildcard in its NLRI.  Either the C-S or the C-G or both can be\n   replaced
    by wildcards.  These routes are known as (C-*,C-S) S-PMSI\n   A-D routes, (C-S,C-*)
    S-PMSI A-D routes, or (C-*,C-*) S-PMSI A-D\n   routes, depending on whether the
    C-S or C-G or both have been\n   replaced by wildcards.  These routes are known
    jointly as \"wildcard\n   S-PMSI A-D routes\".\n   One purpose of this document
    is to clarify the way that the explicit\n   tracking procedures of [RFC6513] and
    [RFC6514] are applied when\n   wildcard S-PMSI A-D routes are used.\n   In addition,
    this document addresses the following scenario, which is\n   not addressed in
    [RFC6513], [RFC6514], or [RFC6625].  Suppose an\n   ingress node originates an
    S-PMSI A-D route whose NLRI specifies, for\n   example, (C-*,C-*) (i.e., both
    C-S and C-G are replaced by wildcards)\n   and whose PTA identifies a particular
    P-tunnel.  Now suppose that the\n   ingress node wants explicit tracking for each
    individual flow that it\n   transmits (following the procedures of [RFC6625])
    on that P-tunnel.\n   In this example, if the ingress node sets the LIR flag in
    the PTA of\n   the wildcard S-PMSI A-D route, each egress node that needs to receive\n
    \  a flow from the ingress node will respond with a Leaf A-D route whose\n   NLRI
    contains the (C-*,C-*) wildcard.  This allows the ingress node\n   to determine
    the set of egress nodes that are interested in receiving\n   flows from the ingress
    node.  However, it does not allow the ingress\n   node to determine exactly which
    flows are of interest to which egress\n   nodes.\n   If the ingress node needs
    to determine which egress nodes are\n   interested in receiving which flows, it
    needs to originate an S-PMSI\n   A-D route for each individual (C-S,C-G) flow
    that it is transmitting,\n   and it needs to set the LIR flag in the PTA of each
    such route.\n   However, since all the flows are being sent through the tunnel\n
    \  identified in the (C-*,C-*) S-PMSI A-D route, there is no need to\n   identify
    a tunnel in the PTA of each (C-S,C-G) S-PMSI A-D route.  Per\n   Section 5 of
    [RFC6514], the PTA of the (C-S,C-G) S-PMSI A-D routes\n   can specify \"no tunnel
    information present\".  This procedure allows\n   explicit tracking of individual
    flows, even though all those flows\n   are assigned to tunnels by wildcard S-PMSI
    A-D routes.\n   However, this procedure requires several clarifications:\n   o
    \ The procedures of [RFC6625] do not address the case of an S-PMSI\n      A-D
    route whose NLRI contains wildcards but whose PTA specifies\n      \"no tunnel
    information present\".\n   o  If it is desired to send a set of flows through
    the same tunnel\n      (where that tunnel is advertised in a wildcard S-PMSI A-D
    route),\n      but it is also desired to explicitly track each individual flow\n
    \     transmitted over that tunnel, one has to send an S-PMSI A-D route\n      (with
    the LIR flag set in the PTA) for each individual flow.  It\n      would be more
    optimal if the ingress node could just send a single\n      wildcard S-PMSI A-D
    route binding the set of flows to a particular\n      tunnel and have the egress
    nodes respond with Leaf A-D routes for\n      each individual flow.\n   o  [RFC6513]
    and [RFC6514] support the notion of \"segmented\n      P-tunnels\", where \"segmentation\"
    occurs at Autonomous System\n      Border Routers (ASBRs); [RFC7524] extends the
    notion of segmented\n      P-tunnels so that segmentation can occur at Area Border
    Routers\n      (ABRs).  One can think of a segmented P-tunnel as passing through\n
    \     a number of \"segmentation domains\".  In each segmentation domain,\n      a
    given P-tunnel has an ingress node and a set of egress nodes.\n      The explicit
    tracking procedures allow an ingress node of a\n      particular segmentation
    domain to determine, for a particular flow\n      or set of flows, the egress
    nodes of that segmentation domain.\n      This has given rise to two further problems:\n
    \     *  The explicit tracking procedures do not allow an ingress node\n         to
    \"see\" past the boundaries of the segmentation domain.\n      *  The prior specifications
    do not make it very clear whether a\n         segmented tunnel egress node, upon
    receiving an S-PMSI A-D\n         route whose PTA specifies \"no tunnel information
    present\", is\n         expected to forward the S-PMSI A-D route, with the same
    PTA, to\n         the next segmentation domain.\n      These problems are addressed
    in Section 5.3.\n   This document clarifies the procedures for originating and
    receiving\n   S-PMSI A-D routes and Leaf A-D routes.  This document also adds
    new\n   procedures to allow more efficient explicit tracking.  The procedures\n
    \  being clarified and/or extended are discussed in multiple places in\n   the
    documents being updated.\n"
  - contents:
    - "1.1.  Terminology\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\", \"SHALL\",
      \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"NOT RECOMMENDED\",
      \"MAY\", and\n   \"OPTIONAL\" in this document are to be interpreted as described
      in\n   BCP 14 [RFC2119] [RFC8174] when, and only when, they appear in all\n
      \  capitals, as shown here.\n"
    title: 1.1.  Terminology
  title: 1.  Introduction
- contents:
  - "2.  The Explicit-Tracking Flags\n   [RFC6514] defines one flag in the PTA, the
    \"Leaf Information\n   Required\" (LIR) flag, that is used for explicit tracking.\n
    \  This document defines a new flag in the Flags field of the PMSI\n   Tunnel
    attribute.  This new flag is known as the \"Leaf Information\n   Required per
    Flow\" flag (LIR-pF).  This flag may be set in the PTA of\n   a (C-*,C-*), (C-*,C-G),
    or (C-S,C-*) S-PMSI A-D route.  The\n   conditions under which it should be set
    by the originator of the\n   route are discussed in Section 4.  The significance
    of the flag in a\n   received wildcard S-PMSI A-D route is discussed in Sections
    5 and\n   5.2.\n   The LIR-pF flag may also be set in the PTA of a Leaf A-D route.
    \ The\n   conditions under which it should be set by the originator of the\n   route
    are discussed in Section 5.2.  The significance of the flag in\n   a received
    Leaf A-D route is discussed in Section 6.\n   Note that support for the LIR-pF
    flag is OPTIONAL.  This flag SHOULD\n   NOT be set in a route's PTA unless it
    is known that the flag is\n   supported by all the Provider Edge (PE) routers
    that are to receive\n   that route.  Typically, this might mean that the ability
    to set this\n   flag would be controlled by a configuration knob, and operators
    would\n   not set this knob unless they know that all the relevant PEs support\n
    \  this feature.  How this is known is outside the scope of this\n   document.\n
    \  This document only defines procedures for the LIR-pF flag when that\n   flag
    is in the PTA of a wildcard S-PMSI A-D route or a Leaf A-D\n   route.  In all
    other cases, the flag SHOULD be clear, and its value\n   SHOULD be ignored.  Use
    of the flag in these other cases is outside\n   the scope of this document.\n
    \  Section 5 of [RFC6514] lists a number of tunnel types.  We will refer\n   to
    these as \"6514-tunnel-types\".  Other tunnel types will be referred\n   to as
    \"non-6514-tunnel-types\".  This document specifies procedures\n   for using the
    LIR-pF flag with 6514-tunnel-types.  Procedures for\n   using the LIR-pF flag
    with non-6514-tunnel-types are outside the\n   scope of this document.\n   If
    it is desired to use a particular non-6514-tunnel-type in MVPN,\n   there needs
    to be a specification for how that tunnel type is used in\n   MVPN.  If it is
    desired to use that tunnel type along with the LIR-pF\n   flag, that specification
    (or a follow-on specification) will have to\n   specify the rules for using the
    LIR-pF flag with that tunnel type.\n   As an example, see [BIER-MVPN].  In the
    absence of such a\n   specification (or in the absence of support for such a\n
    \  specification):\n   o  the originator of a route that carries a PTA SHOULD
    NOT set the\n      LIR-pF flag in any PTA that specifies that tunnel type, and\n
    \  o  the receiver of a route that carries a PTA specifying that tunnel\n      type
    SHOULD treat the LIR-pF flag as if it were not set.\n   If the LIR-pF flag is
    set in the PTA of an S-PMSI A-D route, the\n   originator of that route MUST also
    set the LIR flag.  If the PTA of a\n   received wildcard S-PMSI A-D route has
    the LIR-pF flag set but does\n   not have the LIR flag set, the receiver MUST
    log the fact that the\n   flags appear to have been improperly set.  However,
    the route MUST\n   then be processed normally (as if both flags were set), as
    specified\n   in this document.\n   It is worth noting what will happen if the
    LIR-pF flag is set in the\n   PTA of, for example, a (C-*,C-*) S-PMSI A-D route
    originated by an\n   ingress node, but one or more of the egress nodes do not
    support the\n   LIR-pF flag:\n   1.  The ingress node will not be able to determine
    the complete set\n       of egress nodes that are expecting a particular multicast
    flow\n       from that ingress node.\n   2.  Depending upon the tunnel type, the
    ingress node may send a\n       particular multicast flow only to the egress nodes
    that do\n       support the LIR-pF flag.  From the perspective of egress nodes\n
    \      that do not support the LIR-pF flag, certain flows may appear to\n       be
    \"blackholed\".\n   It is also worth noting that it is possible for an ingress
    node that\n   sets the LIR-pF flag in an S-PMSI A-D route to detect the presence
    of\n   egress nodes that do not support this flag.\n   Since an ingress node that
    sets the LIR-pF flag is also required to\n   set the LIR flag, egress nodes that
    do not support the LIR-pF flag\n   will respond, as specified in [RFC6514], to
    the ingress node's\n   (C-*,C-*) S-PMSI A-D route with a Leaf A-D route.\n   As
    discussed in Section 5.2, any Leaf A-D route originated in\n   response to an
    S-PMSI A-D route that has the LIR-pF flag set will\n   carry a PTA whose LIR-pF
    flag is set.  If an ingress node receives a\n   Leaf A-D route whose Route Key
    field corresponds to the NLRI of an\n   S-PMSI A-D route whose PTA has the LIR-pF
    flag set, but the Leaf A-D\n   route lacks a PTA or has a PTA where the LIR-pF
    flag is clear, the\n   ingress node can infer that the egress node originating
    that Leaf A-D\n   route does not support the LIR-pF flag.  The software at the
    ingress\n   node MUST detect this and MUST have a way of alerting the operator\n
    \  that the deployment is not properly configured.\n"
  title: 2.  The Explicit-Tracking Flags
- contents:
  - "3.  Match for Tracking versus Match for Reception\n   Section 3.2 of [RFC6625]
    specifies a set of rules for finding the\n   S-PMSI A-D route that is the \"match
    for data reception\" (or more\n   simply, the \"match for reception\") of a given
    (C-S,C-G) or (C-*,C-G)\n   state.  These rules do not take into account the fact
    that some\n   S-PMSI A-D routes may not be carrying PTAs at all or may be carrying\n
    \  PTAs that do not identify any P-tunnel.  (A PTA that does not\n   identify
    any P-tunnel is one whose Tunnel Type field has been set to\n   \"no tunnel information
    present\", as specified in Section 5 of\n   [RFC6514].)\n   The rules for finding
    a \"match for reception\" in [RFC6625] are hereby\n   modified as follows:\n      When
    applying the rules of Sections 3.2.1 or 3.2.2 of [RFC6625],\n      it is REQUIRED
    to ignore any S-PMSI A-D route that has no PTA, or\n      whose PTA specifies
    \"no tunnel information present\".\n   There are other RFCs that update [RFC6625]
    and modify the rules for\n   finding a \"match for reception\".  See, e.g., [RFC7582]
    and [RFC7900].\n   When applying those modified rules, it is REQUIRED to ignore
    any\n   S-PMSI A-D route that has no PTA, or whose PTA specifies \"no tunnel\n
    \  information present\".\n   We also introduce a new notion, the \"match for
    tracking\":\n      For a given C-flow ((C-S,C-G) or (C-*,C-G)), the \"match for\n
    \     tracking\" is chosen as follows.  Ignore any S-PMSI A-D route that\n      has
    no PTA.  Also ignore any S-PMSI A-D route whose PTA specifies\n      \"no tunnel
    information present\" and has neither the LIR flag nor\n      the LIR-pF flag
    set.  (That is, *do not* ignore an S-PMSI A-D\n      route that has a PTA specifying
    \"no tunnel information present\"\n      unless its LIR and LIR-pF flags are both
    clear).  Then apply the\n      rules (from [RFC6625] and other documents that
    update it) for\n      finding the \"match for reception\".  The result (if any)
    is the\n      \"match for tracking\".\n      Note that the procedure for finding
    the match for tracking takes\n      into account S-PMSI A-D routes whose PTAs
    specify \"no tunnel\n      information present\" and that have either the LIR
    or LIR-pf flag\n      set.  The procedure for finding the match for reception
    ignores\n      such routes.\n   We will clarify this with a few examples.  In
    these examples, we\n   assume that there is only one segmentation domain.  In
    this case, the\n   ingress and egress nodes are PE routers.\n   Suppose a given
    PE router, PE1, has chosen PE2 as the \"upstream PE\"\n   [RFC6513] for a given
    flow (C-S1,C-G1).  And suppose PE1 has\n   installed the following two routes
    that were originated by PE2:\n   o  Route1: A (C-*,C-*) S-PMSI A-D route whose
    PTA specifies a tunnel.\n   o  Route2: A (C-S1,C-G1) S-PMSI A-D route whose PTA
    specifies \"no\n      tunnel information present\" and has the LIR flag set.\n
    \  Route1 is the match of (C-S1,C-G1) for reception, and Route2 is the\n   match
    of (C-S1,C-G1) for tracking.\n   Continuing this example, suppose:\n   o  PE1
    has chosen PE2 as the upstream PE for a different flow,\n      (C-S2,C-G2).\n
    \  o  PE2 has not originated an S-PMSI A-D route for (C-S2,C-G2).\n   In this
    case, PE1 would consider Route1 to be the match of\n   (C-S2,C-G2) for tracking
    as well as its match for reception.\n   Also note that if a match for tracking
    does not have the LIR flag or\n   the LIR-pF flag set, no explicit tracking information
    will be\n   generated.  See Section 5.\n   As another example, suppose PE1 has
    installed the following two\n   routes that were originated by PE2:\n   o  Route1:
    A (C-*,C-*) S-PMSI A-D route (irrespective of whether the\n      PTA specifies
    a tunnel).\n   o  Route2: A (C-S1,C-G1) S-PMSI A-D route whose PTA specifies a\n
    \     tunnel.\n   In this case, Route2 is both the \"match for reception\" and
    the \"match\n   for tracking\" for (C-S1,C-G1).\n   Note that for a particular
    C-flow, PE1's match for reception might be\n   the same route as its match for
    tracking, or its match for reception\n   might be a \"less specific\" route than
    its match for tracking.  But\n   its match for reception can never be a \"more
    specific\" route than its\n   match for tracking.\n"
  title: 3.  Match for Tracking versus Match for Reception
- contents:
  - "4.  Ingress Node Initiation of Tracking\n   An ingress node that needs to initiate
    explicit tracking for a\n   particular flow or set of flows can do so by performing
    one of the\n   following procedures:\n   1.  An ingress node can initiate explicit
    tracking for (C-S1,C-G1) by\n       originating an S-PMSI A-D route that identifies
    (C-S1,C-G1) in\n       its NLRI, including a PTA in that route, and setting the
    LIR flag\n       in that PTA.  The PTA may specify either a particular tunnel
    or\n       \"no tunnel information present\".\n       However, the PTA of the
    (C-S1,C-G1) S-PMSI A-D route SHOULD NOT\n       specify \"no tunnel information
    present\" unless the ingress node\n       also originates an A-D route carrying
    a PTA that specifies the\n       tunnel to be used for carrying (C-S1,C-G1) traffic.
    \ Such a route\n       could be an \"Inclusive Provider Multicast Service Interface
    Auto-\n       Discovery route\" (I-PMSI A-D route), a (C-*,C-G1) S-PMSI A-D\n
    \      route, a (C-S1,C-*) S-PMSI A-D route, or a (C-*,C-*) S-PMSI A-D\n       route.
    \ (There is no point in requesting explicit tracking for a\n       given flow
    if there is no tunnel on which the flow is being\n       carried.)\n       Note
    that if the ingress node originates a wildcard S-PMSI A-D\n       route carrying
    a PTA specifying the tunnel to be used for\n       carrying (C-S1,C-G1) traffic,
    and if that PTA has the LIR-pF flag\n       set, then explicit tracking for (C-S1,C-G1)
    is requested by that\n       S-PMSI A-D route.  In that case, the ingress node
    SHOULD NOT\n       originate a (C-S1,C-G1) S-PMSI A-D route whose PTA specifies
    \"no\n       tunnel information present\"; such a route would not provide any\n
    \      additional functionality.\n       To terminate explicit tracking that has
    been initiated by an\n       S-PMSI A-D route whose PTA specifies \"no tunnel
    information\n       present\", the ingress node withdraws the route.\n       To
    terminate explicit tracking that has been initiated by an\n       S-PMSI A-D route
    whose PTA specifies a tunnel, the ingress node\n       re-originates the route
    without the LIR flag set.\n   2.  The following procedure can be used if and only
    if it is known\n       that the egress nodes support the optional LIR-pF flag.
    \ If the\n       ingress node originates a wildcard S-PMSI A-D route, it can\n
    \      initiate explicit tracking for the individual flows that match\n       the
    wildcard route by setting the LIR-pF flag in the PTA of the\n       wildcard route.
    \ If an egress node needs to receive one or more\n       flows for which that
    wildcard route is a match for tracking, the\n       egress node will originate
    a Leaf A-D route for each such flow,\n       as specified in Section 5.2).\n       When
    following this procedure, the PTA of the S-PMSI A-D route\n       may specify
    either a tunnel or \"no tunnel information present\".\n       The choice between
    these two options is determined by\n       considerations that are outside the
    scope of this document.\n       To terminate explicit tracking that has been initiated
    by an\n       S-PMSI A-D route whose PTA specifies \"no tunnel information\n       present\",
    the ingress node withdraws the route.\n       To terminate explicit tracking that
    has been initiated by an\n       S-PMSI A-D route whose PTA specifies a tunnel,
    the ingress node\n       re-originates the route without either the LIR or LIR-pF
    flags\n       set.\n       Note that this procedure (Procedure 2 of Section 4)
    may not yield\n       the expected results if there are egress nodes that do not\n
    \      support the LIR-pF flag; hence, it SHOULD NOT be used in that\n       case.\n"
  title: 4.  Ingress Node Initiation of Tracking
- contents:
  - '5.  Egress Node Response to the Match for Tracking

    '
  - contents:
    - "5.1.  General Egress Node Procedures\n   There are four cases to consider:\n
      \  1.  With regard to a particular (C-S,C-G) or (C-*,C-G) multicast\n       state,
      the egress node's match for tracking is the same as its\n       match for reception,
      and neither the LIR nor the LIR-pF flags are\n       set.\n       In this case,
      the egress node does not originate a Leaf A-D route\n       in response to the
      match for reception/tracking, and there is no\n       explicit tracking of the
      flow.  This document specifies no new\n       procedures for this case.\n   2.
      \ With regard to a particular (C-S,C-G) or (C-*,C-G) multicast\n       state,
      the egress node's match for tracking is the same as its\n       match for reception,
      and the LIR flag is set, but the LIR-pF flag\n       is not set.\n       In
      this case, a Leaf A-D route is originated by the egress node,\n       corresponding
      to the S-PMSI A-D route that is the match for\n       reception/tracking.  Construction
      of the Leaf A-D route is as\n       specified in [RFC6514]; this document specifies
      no new procedures\n       for this case.\n   3.  With regard to a particular
      (C-S,C-G) or (C-*,C-G) multicast\n       state, the egress node's match for
      tracking is the same as its\n       match for reception, and LIR-pF is set.
      \ The egress node follows\n       whatever procedures are required by other
      specifications, based\n       on the match for reception.  However, any Leaf
      A-D route\n       originated by the egress node as a result MUST have the LIR-pF\n
      \      flag set in its PTA.  The egress node MUST also follow the\n       procedures
      of Section 5.2.\n   4.  With regard to a particular (C-S,C-G) or (C-*,C-G) multicast\n
      \      state, the egress node's match for tracking is *not* the same as\n       its
      match for reception.  This can only happen if the match for\n       tracking
      has a PTA specifying \"no tunnel information present\",\n       with either
      the LIR flag or the LIR-pF flag set.  In this case,\n       the egress node
      MUST respond, separately, to *both* the match for\n       tracking and the match
      for reception.\n       If a Leaf A-D route is originated in response to the
      match for\n       reception, the LIR-pF flag in the Leaf A-D route's PTA MUST
      have\n       the same value as the LIR-pF flag in the match for reception's\n
      \      PTA.  In all other respects, the procedures for responding to the\n       match
      for reception are not affected by this document.\n       If the match for tracking
      has the LIR flag set but the LIR-pF\n       flag is not set, then the behavior
      of the egress node is not\n       affected by the procedures of this document.\n
      \      If the match for tracking has the LIR-pF flag set, the egress\n       node
      MUST follow the procedures of Section 5.2.\n       Note that if the LIR flag
      is set in the PTA of the match for\n       reception, the egress node may need
      to originate one or more Leaf\n       A-D routes corresponding to the match
      for tracking, as well as\n       originating a Leaf A-D route corresponding
      to the match for\n       reception.\n"
    title: 5.1.  General Egress Node Procedures
  - contents:
    - "5.2.  Responding to the LIR-pF Flag\n   To respond to a match for tracking
      that has the LIR-pF flag set, an\n   egress node originates one or more Leaf
      A-D routes.\n   Suppose the egress node has multicast state for a (C-S,C-G)
      or a\n   (C-*,C-G) flow and has determined a particular S-PMSI A-D route,\n
      \  which has the LIR-pF flag set, to be the match for tracking for that\n   flow.
      \ Then if the egress node supports the LIR-pF flag, it MUST\n   originate a
      Leaf A-D route whose NLRI identifies that particular\n   flow.  Note that if
      a single S-PMSI A-D route (with wildcards) is the\n   match for tracking for
      multiple flows, the egress node may need to\n   originate multiple Leaf A-D
      routes, one for each such flow.  We say\n   that, from the perspective of a
      given egress node, a given S-PMSI A-D\n   route tracks the set of flows for
      which it is the match for tracking.\n   Each of the Leaf A-D routes originated
      in response to that S-PMSI A-D\n   route tracks a single such flow.\n   The
      NLRI of each Leaf A-D route that tracks a particular flow is\n   constructed
      as follows.  The Route Key field of the NLRI will have\n   the format shown
      in Figure 1 (as defined in Sections 4.3 and 4.4 of\n   [RFC6514]).\n                  +------------------------------------+\n
      \                 |      RD   (8 octets)               |\n                  +------------------------------------+\n
      \                 |  Multicast Source Length (1 octet) |\n                  +------------------------------------+\n
      \                 |  Multicast Source (Variable)       |\n                  +------------------------------------+\n
      \                 |  Multicast Group Length (1 octet)  |\n                  +------------------------------------+\n
      \                 |  Multicast Group (Variable)        |\n                  +------------------------------------+\n
      \                 |  Ingress PE's IP Address           |\n                  +------------------------------------+\n
      \                   Figure 1: NLRI of S-PMSI A-D Route\n   o  The \"ingress
      PE\" address is taken from the Originating Router\n      field of the NLRI of
      the S-PMSI A-D route that is the match for\n      tracking.  Section 2 of [RFC6515]
      explains how the receiver of a\n      Leaf A-D route determines the length of
      this field and the address\n      family of the PE's IP address.\n   o  The
      Multicast Source and Multicast Group fields respectively\n      specify a source
      address (S) and a group address(G) that together\n      identify the flow or
      flows being tracked by this Leaf A-D route.\n      If a (C-*,C-G) is being tracked
      by this Leaf A-D route, the\n      Multicast Source field is omitted, and the
      Multicast Source Length\n      field is set to 0.  In this case, the Leaf A-D
      route is known as a\n      \"wildcard Leaf A-D route\".\n   o  The Route Distinguisher
      (RD) field is set to the value of the RD\n      field from the NLRI of the S-PMSI
      A-D route.\n   The encoding of these Leaf A-D routes is similar to the encoding
      of\n   the Leaf A-D routes described in Section 6.2.2 of [RFC7524], which\n
      \  were designed for the support of \"global table multicast\".  However,\n
      \  that document sets the RD to either 0 or -1; following the procedures\n   of
      the present document, the RD will never be 0 or -1.  Therefore,\n   Leaf A-D
      routes constructed according to the procedures of this\n   section can always
      be distinguished from the Leaf A-D routes\n   constructed according to the procedures
      of Section 6.2.2 of\n   [RFC7524].  Also, Leaf A-D routes constructed according
      to the\n   procedures of this section are VPN-specific routes and will always\n
      \  carry an IP-address-specific Route Target, as specified in [RFC6514].\n   If
      a Leaf A-D route is originated as a response to a match for\n   tracking whose
      PTA specifies \"no tunnel information present\", the\n   Leaf A-D route MUST
      carry a PTA that specifies \"no tunnel information\n   present\".  The LIR-pF
      flag in this PTA MUST be set.\n   If an egress node originates multiple Leaf
      A-D routes in response to\n   a single S-PMSI A-D route, and that S-PMSI A-D
      route is later\n   withdrawn, then those Leaf A-D routes MUST also be withdrawn.\n
      \  Similarly, a Leaf A-D route needs to be withdrawn (either implicitly\n   or
      explicitly) if the egress node changes its Upstream Multicast Hop\n   (UMH)
      [RFC6513] for the flow that is identified in the Leaf A-D\n   route's NLRI,
      or if the egress node that originated the route no\n   longer needs to receive
      that flow.\n   It is possible that an egress node will acquire (C-S,C-G) state
      or\n   (C-*,C-G) state after it has already received the S-PMSI A-D that is\n
      \  the match for tracking for that state.  In this case, a Leaf A-D\n   route
      needs to be originated at that time, and the egress node must\n   remember that
      the new Leaf A-D route corresponds to that match for\n   tracking.\n   If a
      particular S-PMSI A-D route is a match for tracking but not a\n   match for
      reception, the LIR flag in its PTA is ignored if the LIR-pF\n   flag is set.\n
      \  When the match for tracking is the same as the match for reception,\n   the
      PTA of the match for tracking/reception will have specified a\n   tunnel type.
      \ Some of the rules for constructing the PTA of the Leaf\n   A-D route depend
      on the tunnel type, and some are independent of the\n   tunnel type.  No matter
      what the tunnel type is, the LIR-pF flag MUST\n   be set.\n   If the match for
      tracking/reception is a wildcard S-PMSI A-D route,\n   the egress node may originate
      a wildcard Leaf A-D route in response,\n   as well as originating one or more
      non-wildcard Leaf A-D routes.\n   Note that the LIR-pF flag MUST be set in the
      wildcard Leaf A-D route\n   as well as in the non-wildcard Leaf A-D routes.\n
      \  This document provides additional rules for constructing the PTA when\n   the
      tunnel type is a 6514-tunnel-type (see Section 2).\n   As discussed in Section
      2, if a non-6514-tunnel-type is being used,\n   then presumably there is a specification
      for how that tunnel type is\n   used in MVPN.  If it is desired to use that
      tunnel type along with\n   the LIR-pF flag, that specification (or a follow-on
      specification)\n   will have to specify the additional rules for constructing
      the PTA.\n   As an example, see [BIER-MVPN].\n   For 6514-tunnel-types, additional
      rules for constructing the PTA are\n   as follows:\n   o  If the tunnel type
      of the PTA attached to the match for tracking/\n      reception is Ingress Replication,
      the Leaf A-D route's PTA MAY\n      specify Ingress Replication.  In this case,
      the MPLS Label field\n      of the PTA MAY be a non-zero value.  If so, this
      label value will\n      be used by the ingress PE when it transmits, to the
      egress PE,\n      packets of the flow identified in the Leaf A-D route's NLRI.\n
      \     Alternatively, the egress PE MAY specify an MPLS label value of\n      zero,
      or it MAY specify a tunnel type of \"no tunnel information\n      present\".
      \ In either of these cases, when the ingress PE transmits\n      packets of
      the identified flow to the egress PE, it will use the\n      label that the
      egress PE specified in the PTA of the Leaf A-D\n      route that it originated
      in response to the LIR flag of the match\n      for reception.\n   o  If the
      tunnel type of the PTA attached to the match for tracking/\n      reception
      is any of the other 6514-tunnel-types, the PTA attached\n      to the Leaf A-D
      route MUST specify a tunnel type of \"no tunnel\n      information present\".\n
      \  It may happen that the tunnel type is a non-6514-tunnel type, but\n   either
      (a) there is no specification for how to use that tunnel type\n   with the LIR-pF
      flag or (b) there is such a specification, but the\n   egress node does not
      support it.  In that case, the egress node MUST\n   treat the match for tracking/reception
      as if it had the LIR-pF flag\n   clear.\n"
    title: 5.2.  Responding to the LIR-pF Flag
  - contents:
    - "5.3.  When the Egress Node Is an ABR or ASBR\n   When segmented P-tunnels are
      used, the ingress and egress nodes may\n   be ABRs or ASBRs.  An egress ABR/ASBR
      that receives and installs an\n   S-PMSI A-D route also forwards that route.
      \ If the received PTA of an\n   installed S-PMSI A-D route specifies a tunnel,
      the egress ABR/ASBR\n   MAY change the PTA before forwarding the route, in order
      to specify a\n   different tunnel type (as discussed in [RFC6514] and/or [RFC7524]).\n
      \  The egress ABR/ASBR may also need to originate a Leaf A-D route, as\n   specified
      in [RFC6514] and/or [RFC7524].\n   Suppose the S-PMSI A-D route as received
      has a PTA specifying a\n   tunnel and also has the LIR-pF flag set.  The egress
      ABR/ASBR\n   originates a corresponding Leaf A-D route for a given (C-S,C-G)
      only\n   if it knows that it needs to receive that flow.  It will know this
      by\n   virtue of receiving a corresponding Leaf A-D route from downstream.\n
      \  (In the case where the PTA specifies a tunnel but the LIR-pF flag is\n   not
      set, this document does not specify any new procedures.)\n   The procedures
      in the remainder of this section apply only when an\n   egress ABR/ASBR has
      installed an S-PMSI A-D route whose PTA as\n   received specifies \"no tunnel
      information present\" but has the LIR\n   flag or the LIR-pF flag set.\n   If
      the received PTA of the installed S-PMSI A-D route specifies \"no\n   tunnel
      information present\", the egress ABR/ASBR MUST pass the PTA\n   along unchanged
      when it forwards the S-PMSI A-D route.  (That is, a\n   PTA specifying \"no
      tunnel information present\" MUST NOT be changed\n   into a PTA specifying a
      tunnel.)  Furthermore, if the PTA specifies\n   \"no tunnel information present\",
      the LIR and LIR-pF flags in the PTA\n   MUST be passed along unchanged.\n   As
      a result of propagating such an S-PMSI A-D route, the egress ABR/\n   ASBR may
      receive one or more Leaf A-D routes that correspond to that\n   S-PMSI A-D route.
      \ These routes will be received carrying an\n   IP-address-specific Route Target
      (RT) Extended Community that\n   specifies the address of the egress ABR/ASBR.
      \ The egress ABR/ASBR\n   will propagate these Leaf A-D routes after changing
      the RT as\n   follows.  The Global Administrator field of the modified RT will
      be\n   set to the IP address taken either from the S-PMSI A-D route's\n   Next-Hop
      field [RFC6514] or its Segmented Point-to-Multipoint (P2MP)\n   Next-Hop Extended
      Community [RFC7524].  The address from the\n   Segmented P2MP Next-Hop Extended
      Community is used if that Extended\n   Community is present; otherwise, the
      address from the Next-Hop field\n   is used.\n   This procedure enables the
      ingress PE to explicitly track the egress\n   PEs for a given flow, even if
      segmented tunnels are being used.\n   However, cross-domain explicit tracking
      utilizes S-PMSI A-D routes\n   that do not specify tunnel information; therefore,
      it can only be\n   done when the S-PMSI A-D route that is a flow's match for
      tracking is\n   different from the S-PMSI A-D route that is that flow's match
      for\n   reception.\n"
    title: 5.3.  When the Egress Node Is an ABR or ASBR
  title: 5.  Egress Node Response to the Match for Tracking
- contents:
  - "6.  Ingress Node Handling of Received Leaf A-D Routes with LIR-pF Set\n   Consider
    the following situation:\n   o  An ingress node, call it N, receives a Leaf A-D
    route, call it L.\n   o  L carries an IP-address-specific RT identifying N.\n
    \  o  The Route Key field of L's NLRI is not identical to the NLRI of\n      any
    current I-PMSI or S-PMSI A-D route originated by N.\n   Per the procedures of
    [RFC6514] and [RFC7524], such a Leaf A-D route\n   does not cause any MVPN-specific
    action to be taken by N.\n   This document modifies those procedures in the case
    where there is a\n   current wildcard S-PMSI A-D route, originated by N, to which
    L is a\n   valid response according to the procedures of Section 5.2.  In this\n
    \  case, L MUST be processed by N.\n   Suppose that L's PTA specifies a tunnel
    type of Ingress Replication\n   and that it also specifies a non-zero MPLS label.
    \ Then if N needs to\n   send to L a packet belonging to the multicast flow or
    flows\n   identified in L's NLRI, N MUST use the specified label.\n   If L's PTA
    meets any of the following conditions:\n   o  It specifies a tunnel type of \"no
    tunnel information present\", or\n   o  It specifies a tunnel type of Ingress
    Replication, but specifies\n      an MPLS label of zero, or\n   o  It specifies
    any other 6514-tunnel-type,\n   then the action taken by N when it receives L
    is a local matter.  In\n   this case, the Leaf A-D route L provides N with explicit
    tracking\n   information for the flow identified by L's NLRI.  However, that\n
    \  information is for management/monitoring purposes and does not have\n   any
    direct effect on the flow of multicast traffic.\n   If L's PTA specifies a non-6514-tunnel-type
    not mentioned above,\n   presumably there is a specification for how MVPN uses
    that tunnel\n   type.  If the LIR-pF flag is to be used with that tunnel type,
    that\n   specification must specify the actions that N is to take upon\n   receiving
    L.  As an example, see [BIER-MVPN].  In the absence of such\n   a specification,
    the LIR-pF flag SHOULD BE ignored.  See Section 2\n   for further discussion of
    non-6514-tunnel-types.\n"
  title: 6.  Ingress Node Handling of Received Leaf A-D Routes with LIR-pF Set
- contents:
  - "7.  IANA Considerations\n   IANA has added the following entry to the \"P-Multicast
    Service\n   Interface (PMSI) Tunnel Attribute Flags\" registry under the \"Border\n
    \  Gateway Protocol (BGP) Parameters\" registry.  This registry is\n   defined
    in [RFC7902].  The entry appears as:\n   o  Value: 2\n   o  Name: Leaf Information
    Required per-Flow (LIR-pF)\n   o  Reference: RFC 8534\n"
  title: 7.  IANA Considerations
- contents:
  - "8.  Security Considerations\n   The Security Considerations of [RFC6513] and
    [RFC6514] apply.\n   By setting the LIR-pF flag in a single wildcard S-PMSI A-D
    route, a\n   large number of Leaf A-D routes can be elicited.  If this flag is
    set\n   when not desired (through either error or malfeasance), a significant\n
    \  increase in control plane overhead can result.  Properly protecting\n   the
    control plane should prevent this kind of attack.\n   In the event such an attack
    occurs, mitigating it is unfortunately\n   not very straightforward.  The ingress
    node can take note of the fact\n   that it is getting, in response to an S-PMSI
    A-D route that has\n   LIR-pF clear, one or more Leaf A-D routes that have LIR-pF
    set.  By\n   default, the reception of such a route MUST be logged.  However,
    it\n   is possible for such log entries to be \"false positives\" that\n   generate
    a lot of \"noise\" in the log; therefore, implementations\n   SHOULD have a knob
    to disable this logging.\n   In theory, if one or more Leaf A-D routes with LIR-pF
    set arrive in\n   response to an S-PMSI A-D route with LIR-pF clear, withdrawing
    the\n   S-PMSI A-D route could put a stop to the attack.  In practice, that\n
    \  is not likely to be a very good strategy, because:\n   o  Under normal operating
    conditions, there are some race conditions\n      that may cause the ingress node
    to think it is being attacked,\n      when in fact it is not.\n   o  If some egress
    nodes have a bug that causes them to set LIR-pF\n      when it should be clear,
    withdrawing the S-PMSI A-D route will\n      stop the flow of multicast data traffic
    to all the egress nodes,\n      causing an unnecessary customer-visible disruption.\n
    \  o  The same situation that caused the S-PMSI A-D route to be\n      originated
    in the first place will still exist after the S-PMSI\n      A-D route is withdrawn,
    so the route will just be re-originated.\n   In other words, any action that would
    ameliorate the effects of this\n   sort of attack would likely have a negative
    effect during normal\n   operation.  Therefore, it is really better to rely on
    security\n   mechanisms that protect the control plane generally than to have
    a\n   mechanism that is focused on this one particular type of attack.\n"
  title: 8.  Security Considerations
- contents:
  - '9.  References

    '
  - contents:
    - "9.1.  Normative References\n   [RFC2119]  Bradner, S., \"Key words for use
      in RFCs to Indicate\n              Requirement Levels\", BCP 14, RFC 2119,\n
      \             DOI 10.17487/RFC2119, March 1997,\n              <https://www.rfc-editor.org/info/rfc2119>.\n
      \  [RFC6513]  Rosen, E., Ed. and R. Aggarwal, Ed., \"Multicast in MPLS/\n              BGP
      IP VPNs\", RFC 6513, DOI 10.17487/RFC6513, February\n              2012, <https://www.rfc-editor.org/info/rfc6513>.\n
      \  [RFC6514]  Aggarwal, R., Rosen, E., Morin, T., and Y. Rekhter, \"BGP\n              Encodings
      and Procedures for Multicast in MPLS/BGP IP\n              VPNs\", RFC 6514,
      DOI 10.17487/RFC6514, February 2012,\n              <https://www.rfc-editor.org/info/rfc6514>.\n
      \  [RFC6515]  Aggarwal, R. and E. Rosen, \"IPv4 and IPv6 Infrastructure\n              Addresses
      in BGP Updates for Multicast VPN\", RFC 6515,\n              DOI 10.17487/RFC6515,
      February 2012,\n              <https://www.rfc-editor.org/info/rfc6515>.\n   [RFC6625]
      \ Rosen, E., Ed., Rekhter, Y., Ed., Hendrickx, W., and\n              R. Qiu,
      \"Wildcards in Multicast VPN Auto-Discovery\n              Routes\", RFC 6625,
      DOI 10.17487/RFC6625, May 2012,\n              <https://www.rfc-editor.org/info/rfc6625>.\n
      \  [RFC7524]  Rekhter, Y., Rosen, E., Aggarwal, R., Morin, T.,\n              Grosclaude,
      I., Leymann, N., and S. Saad, \"Inter-Area\n              Point-to-Multipoint
      (P2MP) Segmented Label Switched Paths\n              (LSPs)\", RFC 7524, DOI
      10.17487/RFC7524, May 2015,\n              <https://www.rfc-editor.org/info/rfc7524>.\n
      \  [RFC7902]  Rosen, E. and T. Morin, \"Registry and Extensions for\n              P-Multicast
      Service Interface Tunnel Attribute Flags\",\n              RFC 7902, DOI 10.17487/RFC7902,
      June 2016,\n              <https://www.rfc-editor.org/info/rfc7902>.\n   [RFC8174]
      \ Leiba, B., \"Ambiguity of Uppercase vs Lowercase in RFC\n              2119
      Key Words\", BCP 14, RFC 8174, DOI 10.17487/RFC8174,\n              May 2017,
      <https://www.rfc-editor.org/info/rfc8174>.\n"
    title: 9.1.  Normative References
  - contents:
    - "9.2.  Informative References\n   [BIER-MVPN]\n              Rosen, E., Sivakumar,
      M., Aldrin, S., Dolganow, A., and\n              T. Przygienda, \"Multicast
      VPN Using BIER\", Work in\n              Progress, draft-ietf-bier-mvpn-11,
      March 2018.\n   [RFC7582]  Rosen, E., Wijnands, IJ., Cai, Y., and A. Boers,\n
      \             \"Multicast Virtual Private Network (MVPN): Using\n              Bidirectional
      P-Tunnels\", RFC 7582, DOI 10.17487/RFC7582,\n              July 2015, <https://www.rfc-editor.org/info/rfc7582>.\n
      \  [RFC7900]  Rekhter, Y., Ed., Rosen, E., Ed., Aggarwal, R., Cai, Y.,\n              and
      T. Morin, \"Extranet Multicast in BGP/IP MPLS VPNs\",\n              RFC 7900,
      DOI 10.17487/RFC7900, June 2016,\n              <https://www.rfc-editor.org/info/rfc7900>.\n"
    title: 9.2.  Informative References
  title: 9.  References
- contents:
  - "Acknowledgments\n   The authors wish to thank Robert Kebler for his ideas and
    comments\n   and Stephane Litkowski and Benjamin Kaduk for their thorough reviews\n
    \  and useful suggestions.  We would also like to thank Mirja Kuhlewind\n   for
    her attention to the Security Considerations section.\n"
  title: Acknowledgments
- contents:
  - "Authors' Addresses\n   Andrew Dolganow\n   Nokia\n   438B Alexandra Rd #08-07/10\n
    \  Alexandra Technopark\n   119968\n   Singapore\n   Email: andrew.dolganow@nokia.com\n
    \  Jayant Kotalwar\n   Nokia\n   701 East Middlefield Rd\n   Mountain View, California
    \ 94043\n   United States of America\n   Email: jayant.kotalwar@nokia.com\n   Eric
    C. Rosen (editor)\n   Juniper Networks, Inc.\n   10 Technology Park Drive\n   Westford,
    Massachusetts  01886\n   United States of America\n   Email: erosen52@gmail.com\n
    \  Zhaohui Zhang\n   Juniper Networks, Inc.\n   10 Technology Park Drive\n   Westford,
    Massachusetts  01886\n   United States of America\n   Email: zzhang@juniper.net\n"
  title: Authors' Addresses
