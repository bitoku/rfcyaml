- contents:
  - '  OSPFv3 as a Provider Edge to Customer Edge (PE-CE) Routing Protocol

    '
  title: __initial_text__
- contents:
  - "Abstract\n   Many Service Providers (SPs) offer Virtual Private Network (VPN)\n
    \  services to their customers using a technique in which Customer Edge\n   (CE)
    routers are routing peers of Provider Edge (PE) routers.  The\n   Border Gateway
    Protocol (BGP) is used to distribute the customer's\n   routes across the provider's
    IP backbone network, and Multiprotocol\n   Label Switching (MPLS) is used to tunnel
    customer packets across the\n   provider's backbone.  Support currently exists
    for both IPv4 and IPv6\n   VPNs; however, only Open Shortest Path First version
    2 (OSPFv2) as\n   PE-CE protocol is specified.  This document extends those\n
    \  specifications to support OSPF version 3 (OSPFv3) as a PE-CE routing\n   protocol.
    \ The OSPFv3 PE-CE functionality is identical to that of\n   OSPFv2 except for
    the differences described in this document.\n"
  title: Abstract
- contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This
    document is a product of the Internet Engineering Task Force\n   (IETF).  It represents
    the consensus of the IETF community.  It has\n   received public review and has
    been approved for publication by the\n   Internet Engineering Steering Group (IESG).
    \ Further information on\n   Internet Standards is available in Section 2 of RFC
    5741.\n   Information about the current status of this document, any errata,\n
    \  and how to provide feedback on it may be obtained at\n   http://www.rfc-editor.org/info/rfc6565.\n"
  title: Status of This Memo
- contents:
  - "Copyright Notice\n   Copyright (c) 2012 IETF Trust and the persons identified
    as the\n   document authors.  All rights reserved.\n   This document is subject
    to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n
    \  (http://trustee.ietf.org/license-info) in effect on the date of\n   publication
    of this document.  Please review these documents\n   carefully, as they describe
    your rights and restrictions with respect\n   to this document.  Code Components
    extracted from this document must\n   include Simplified BSD License text as described
    in Section 4.e of\n   the Trust Legal Provisions and are provided without warranty
    as\n   described in the Simplified BSD License.\n   This document may contain
    material from IETF Documents or IETF\n   Contributions published or made publicly
    available before November\n   10, 2008.  The person(s) controlling the copyright
    in some of this\n   material may not have granted the IETF Trust the right to
    allow\n   modifications of such material outside the IETF Standards Process.\n
    \  Without obtaining an adequate license from the person(s) controlling\n   the
    copyright in such materials, this document may not be modified\n   outside the
    IETF Standards Process, and derivative works of it may\n   not be created outside
    the IETF Standards Process, except to format\n   it for publication as an RFC
    or to translate it into languages other\n   than English.\n"
  title: Copyright Notice
- contents:
  - "Table of Contents\n   1. Introduction ....................................................4\n
    \  2. Specification of Requirements ...................................4\n   3.
    Requirements ....................................................4\n      3.1.
    OSPFv3 Specificities .......................................5\n   4. BGP/OSPFv3
    Interaction Procedures for PE Routers ................5\n      4.1. VRFs and OSPFv3
    Instances ..................................5\n           4.1.1. Independent OSPFv3
    Instances in PEs .................6\n           4.1.2. OSPFv3 Domain Identifier
    ............................6\n      4.2. OSPFv3 Areas ...............................................7\n
    \     4.3. VRFs and Routes ............................................7\n           4.3.1.
    OSPFv3 Routes on PEs ................................8\n           4.3.2. VPN-IPv6
    Routes Received from MP-BGP ................9\n      4.4. BGP Extended Communities
    Attribute ........................12\n      4.5. Loop Prevention Techniques ................................14\n
    \          4.5.1. OSPFv3 Down Bit ....................................15\n           4.5.2.
    Other Possible Loops ...............................15\n   5. OSPFv3 Sham Links
    ..............................................15\n      5.1. Creating a Sham Link
    ......................................16\n      5.2. OSPF Protocol on Sham Link
    ................................16\n      5.3. OSPF Packet Forwarding on Sham
    Link .......................17\n   6. Multiple Address Family Support ................................17\n
    \  7. Security Considerations ........................................18\n   8.
    IANA Considerations ............................................18\n   9. Acknowledgments
    ................................................18\n   10. References ....................................................18\n
    \     10.1. Normative References .....................................18\n      10.2.
    Informative References ...................................19\n"
  title: Table of Contents
- contents:
  - "1.  Introduction\n   [RFC4364] offers Service Providers (SPs) a method for providing
    Layer\n   3 Virtual Private Network (VPN) services to subtending customer\n   networks.
    \ Using the procedures defined in [RFC4364], Provider Edge\n   (PE) routers separate
    customer VPN routing information into Virtual\n   Routing and Forwarding (VRF)
    tables.  The Border Gateway Protocol\n   (BGP) is used to disseminate customer
    network VPN routes between PE\n   VRFs configured in the same VPN.\n   The initial
    BGP/MPLS IP VPN specification enabled PE routers to learn\n   routes within customer
    sites through static routing, or through a\n   dynamic routing protocol instantiated
    on the PE-CE link.\n   Specifically, [RFC4364] (and its predecessor, [RFC2547])
    included\n   support for dynamic routing protocols such as BGP, RIP, and OSPFv2.\n
    \  The OSPFv2 as the Provider/Customer Edge Protocol specification\n   [RFC4577]
    further updates the operation of OSPFv2 as the PE-CE\n   routing protocol by detailing
    additional extensions to enable intra-\n   domain routing connectivity between
    OSPFv2-based customer sites.\n   While [RFC4364] was defined for IPv4-based networks,
    [RFC4659]\n   extends support to IPv6 VPNs.  It is expected that OSPFv3 will be\n
    \  used as the IGP for some IPv6 VPNs just as the OSPFv2 was used for\n   IPv4
    VPNs.  The advantages of using OSPFv3 as a PE-CE protocol are\n   the same as
    for the IPv4 VPN deployment.\n   This document defines the mechanisms required
    to enable the operation\n   of OSPFv3 as the PE-CE routing protocol.  In doing
    so, it reuses, and\n   extends where necessary, methods defined in [RFC4659] and
    [RFC4577].\n   This document also includes the specifications for maintaining
    intra-\n   domain routing connectivity between OSPFv3-based customer sites\n   across
    an SP backbone.\n   We presuppose familiarity with the contents of [RFC4364],
    [RFC4659],\n   [RFC4577], [RFC4576], [RFC5340], and [RFC2328].\n"
  title: 1.  Introduction
- contents:
  - "2.  Specification of Requirements\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\",
    \"SHALL\", \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"MAY\",
    and \"OPTIONAL\" in this\n   document are to be interpreted as described in [RFC2119].\n"
  title: 2.  Specification of Requirements
- contents:
  - "3.  Requirements\n   The benefits and considerations associated with deploying
    OSPFv3 as\n   the PE-CE routing protocol are similar to those described in\n   [RFC4577].
    \ The requirements described in Section 3 of [RFC4577]\n   remain semantically
    identical for the deployment of OSPFv3.\n   [RFC5340] describes the modifications
    required to OSPF to support\n   IPv6.  In that specification, many of the fundamental
    mechanisms\n   associated with OSPFv2 remain unchanged for OSPFv3.  Consequently,\n
    \  the operation of OSPFv3 as the PE-CE routing protocol is very similar\n   to
    OSPFv2 as the PE-CE protocol.\n"
  - contents:
    - "3.1.  OSPFv3 Specificities\n   Section 2 of [RFC5340] describes the differences
      between OSPFv3 and\n   OSPFv2.  Several of these changes will require modifications
      to the\n   architecture described in [RFC4577].  These differences and their\n
      \  corresponding impact to [RFC4577] are described below:\n      New LSA types:\n
      \     For an IPv6 VPN architecture where customers interface with\n      providers
      through OSPFv3, traditional BGP/OSPF interactions\n      specify that VPN-IPv6
      reachability information redistributed into\n      OSPFv3 will be expressed
      as AS-External OSPFv3 LSAs.  Instead, it\n      may be desirable to view these
      LSAs as inter-area-prefix LSAs.\n      The OSPF Route Type Extended Communities
      attribute defined in\n      [RFC4577] is extended to include OSPFv3 route types.
      \ These new\n      encodings are defined in Section 4.4.\n      Multiple instances
      over a link:\n      OSPFv3 operates on a per-link basis as opposed to OSPFv2,
      which\n      operates on a per-IP-subnet basis.  The support of multiple OSPFv3\n
      \     protocol instances on a link changes the architecture described in\n      [RFC4577].
      [RFC4577] specifies that each interface belongs to no\n      more than one OSPF
      instance.  For OSPFv3, multiple instances can\n      be established over a single
      interface and associated with the\n      same VRF.\n      In addition to establishing
      multiple OSPFv3 instances over a\n      single PE-CE link, multiple OSPFv3 instances
      can also be\n      established across a sham link.  This enables multiple OSPFv3\n
      \     instances associated with a VRF to independently establish intra-\n      area
      connectivity to other OSPFv3 instances attached to a remote\n      PE VRF.  Support
      for multiple OSPFv3 instances across the sham\n      link is described in Section
      5.\n"
    title: 3.1.  OSPFv3 Specificities
  title: 3.  Requirements
- contents:
  - '4.  BGP/OSPFv3 Interaction Procedures for PE Routers

    '
  - contents:
    - "4.1.  VRFs and OSPFv3 Instances\n   The relationship between VRFs, interfaces,
      and OSPFv3 instances on a\n   PE router is described in the following section.\n
      \  As defined in [RFC4364], a PE router can be configured with one or\n   more
      VRFs.  Each VRF configured on the PE corresponds to a customer\n   VPN and retains
      the destinations that are reachable within that VPN.\n   Each VRF may be associated
      with one or more interfaces, which allows\n   multiple sites to participate
      in the same VPN.  If OSPFv3 is\n   instantiated on an interface associated with
      a VRF, the VRF will be\n   populated with OSPFv3 routing information.\n   As
      OSPFv3 supports multiple instances on a single interface, it is\n   therefore
      possible that multiple customer sites can connect to the\n   same interface
      of a PE router (e.g., through a Layer 2 switch) using\n   distinct OSPFv3 instances.
      \ A PE interface can be associated with\n   only one VRF, and all OSPFv3 instances
      running on the same interface\n   MUST be associated with the same VRF.  Configurations
      where a PE\n   interface is associated with multiple VRFs are out of scope for
      this\n   document.\n"
    - contents:
      - "4.1.1.  Independent OSPFv3 Instances in PEs\n   Similar to [RFC4577], the
        PE must associate at least one OSPFv3\n   instance for each OSPFv3 domain
        to which it attaches, and each\n   instance of OSPFv3 MUST be associated with
        a single VRF.\n   The support of multiple PE-CE OSPFv3 instances per PE interface
        does\n   not change the paradigm that an OSPF instance can be associated with\n
        \  only a single VRF.  Furthermore, for each instance instantiated on\n   the
        interface, the PE establishes adjacencies with corresponding CEs\n   associated
        with the instance.  Note that although multiple instances\n   may populate
        a common VRF, they do not leak routes to one another,\n   unless configured
        to do so.\n"
      title: 4.1.1.  Independent OSPFv3 Instances in PEs
    - contents:
      - "4.1.2.  OSPFv3 Domain Identifier\n   The OSPFv3 Domain ID describes the administrative
        domain of the OSPF\n   instance that originated the route.  It has an AS-wide
        significance\n   and is one of the parameters used to determine whether a
        VPN-IPv6\n   route should be translated as an Inter-area-prefix LSA or External\n
        \  LSA.  Each OSPFv3 instance MUST have a primary Domain ID that is\n   transported
        along with the VPN-IPv6 route in a BGP attribute over the\n   VPN backbone.
        \ Each OSPFv3 instance may have a set of secondary\n   Domain IDs that applies
        to other OSPFv3 instances within its\n   administrative domain.\n   The primary
        Domain ID may either be configured or be set to a value\n   of NULL.  The
        secondary Domain IDs are only allowed if a non-NULL\n   primary Domain ID
        is configured.  The Domain ID MUST be configured on\n   a per-OSPFv3 instance
        basis.\n   The Domain ID is used to determine whether an incoming VPN-IPv6
        route\n   belongs to the same domain as the receiving OSPFv3 instance.  An\n
        \  incoming VPN-IPv6 route is said to belong to the same domain if a\n   non-NULL
        incoming Domain ID matches either the local primary or one\n   of the secondary
        Domain IDs.  If the local Domain ID and incoming\n   Domain ID are NULL, it
        is considered a match.\n"
      title: 4.1.2.  OSPFv3 Domain Identifier
    title: 4.1.  VRFs and OSPFv3 Instances
  - contents:
    - "4.2.  OSPFv3 Areas\n   Sections 4.1.4 and 4.2.3 of [RFC4577] describe the characteristics
      of\n   a PE router within an OSPFv2 domain.  The mechanisms and expected\n   behavior
      described in [RFC4577] are applicable to an OSPFv3 domain.\n"
    title: 4.2.  OSPFv3 Areas
  - contents:
    - "4.3.  VRFs and Routes\n   From the perspective of the CE, the PE appears as
      any other OSPFv3\n   neighbor.  There is no requirement for the CE to support
      any\n   mechanisms of IPv6 BGP/MPLS VPNs or for the CE to have any awareness\n
      \  of the VPNs, thereby enabling any OSPFv3 implementation to be used on\n   a
      CE.\n   Because the export and import policies might cause different routes\n
      \  to be installed in different VRFs of the same OSPFv3 domain, the VPN\n   backbone
      cannot be considered as a single router from the perspective\n   of the domain's
      CEs.  Rather, each CE should view its connected PE as\n   a separate router.\n
      \  The PE uses OSPFv3 to distribute routes to CEs, and MP-BGP [RFC4760]\n   to
      distribute VPN-IPv6 routes to other (remote) PE routers as defined\n   in [RFC4659].
      \ An IPv6 prefix installed in the VRF by OSPFv3 is\n   changed to a VPN-IPv6
      prefix by the addition of an 8-octet Route\n   Distinguisher (RD) as discussed
      in Section 2 of [RFC4659].  This VPN-\n   IPv6 route can then be redistributed
      into MP-BGP according to an\n   export policy that adds a Route Target (RT)
      Extended Communities\n   attribute to the Network Layer Reachability Information
      (NLRI)\n   [RFC4360].\n   Domain IDs are used to distinguish between OSPFv3
      instances.  When an\n   OSPFv3 distributed route is redistributed into MP-BGP,
      the Domain ID,\n   OSPFv3 Router ID, Area, OSPFv3 Route Type, and Options fields\n
      \  (External Route Type) are also carried in Extended Community\n   Attributes
      of the MP-BGP route.\n   A PE receiving a VPN-IPv6 NLRI from MP-BGP uses an
      import policy to\n   determine, based on the RT, whether the route is eligible
      to be\n   installed in one of its local VRFs.  The BGP decision process selects\n
      \  which of the eligible routes are to be installed in the associated\n   VRF,
      and the selected set of VPN-IPv6 routes are converted into IPv6\n   routes by
      removing the RD before installation.\n   An IPv6 route learned from MP-BGP and
      installed in a VRF might or\n   might not be redistributed into OSPFv3, depending
      on the local\n   configuration.  For example, the PE might be configured to
      advertise\n   only a default route to CEs of a particular OSPFv3 instance.\n
      \  Further, if the route is to be redistributed into multiple OSPFv3\n   instances,
      the route might be advertised using different LSA types in\n   different instances.\n
      \  If an IPv6 route learned from MP-BGP is to be redistributed into a\n   particular
      OSPFv3 instance, the OSPF Domain Identifier Extended\n   Communities attribute
      of the VPN-IPv6 route is used to determine\n   whether the OSPFv3 instance from
      which the route was learned is the\n   same as the OSPFv3 instance into which
      the route is to be\n   redistributed.\n"
    - contents:
      - "4.3.1.  OSPFv3 Routes on PEs\n   VRFs may be populated by both OSPFv3 routes
        from a CE or VPN-IPv6\n   routes from other PEs via MP-BGP.  OSPFv3 routes
        are installed in a\n   VRF using the OSPFv3 decision process.  They may be
        redistributed\n   into BGP and disseminated to other PEs participating in
        the VPN.  At\n   these remote PEs, the VPN-IPv6 routes may be imported into
        a VRF and\n   redistributed into the OSPFv3 instance(s) associated with that
        VRF.\n   As specified in [RFC4659], routes imported and exported into a VRF\n
        \  are controlled by the Route Target (RT) Extended Communities\n   attribute.
        \ OSPFv3 routes that are redistributed into BGP are given\n   an RT that corresponds
        to the VRF.  This RT is examined at remote\n   PEs.  In order to import a
        route, a VRF must have an import RT that\n   is identical to the route's RT.
        \ For routes that are eligible to be\n   imported into the VRF, the standard
        BGP decision process is used to\n   choose the \"best\" route(s).\n   When
        a route is advertised from a CE to a PE via OSPFv3 and that\n   route is installed
        in the VRF associated with the CE, the route is\n   advertised to other locally
        attached CEs under normal OSPFv3\n   procedures.\n   The route is also redistributed
        into MP-BGP to be advertised to\n   remote PEs.  The information necessary
        for accurate redistribution\n   back into OSPFv3 by the remote PEs is carried
        in the OSPF Route Type,\n   OSPF Domain ID, and OSPF Router ID Extended Communities
        attributes\n   (Section 4.4).  The relevant local OSPFv3 information encoded
        into\n   these attributes are as follows:\n      The Area ID of the PE-CE
        link.\n      The Route Type, as determined by the LSA type from which the
        route\n      was learned.\n      The Options fields (External metric-type).\n
        \     The Domain ID of the OSPFv3 process.  If no Domain ID is\n      configured,
        the NULL identifier is used.\n      The PE's Router ID associated with the
        OSPFv3 instance.\n   A Multi-Exit-Discriminator (MED) attribute SHOULD also
        be set to the\n   value of the OSPFv3 metric associated with the route plus
        1, when the\n   OSPFv3 route is redistributed into the MP-BGP.\n"
      title: 4.3.1.  OSPFv3 Routes on PEs
    - contents:
      - "4.3.2.  VPN-IPv6 Routes Received from MP-BGP\n   When a PE receives a valid
        VPN-IPv6 route from MP-BGP and has\n   identified an association with a local
        VRF, it must determine:\n      Whether a route to the corresponding IPv6 prefix
        is to be\n      installed in the VRF;\n      Whether the installed IPv6 route
        is to be redistributed to one or\n      more local OSPFv3 instances; and\n
        \     What OSPFv3 LSA type is to be used when advertising the route into\n
        \     each OSPFv3 instance.\n   An IPv6 route derived from a received VPN-IPv6
        route is not installed\n   in the associated local VRF if:\n      The BGP
        decision process identifies a better route to the\n      destination NLRI;
        or\n      A configured import policy prohibits the installation of the\n      route.\n
        \  The PE advertises the IPv6 route learned from MP-BGP to attached CEs\n
        \  via OSPFv3 if:\n      No configured filtering prohibits redistributing
        the route to\n      OSPFv3;\n      No configured policy blocks the route in
        favor of a less-specific\n      summary route; and\n      Redistribution of
        a BGP learned IPv6 route into OSPF is based on\n      local policy.\n   The
        subsequent sections discuss the advertisement of routes learned\n   from MP-BGP
        and the rules for determining to which LSA types and to\n   which CEs to advertise
        the routes.\n   When the PE sends an LSA to a CE, it sets the DN-bit in the
        LSA to\n   prevent looping.  The DN-bit is discussed in Section 4.5.1.\n"
      - contents:
        - "4.3.2.1.  OSPF Inter-Area Routes\n   A PE advertises an IPv6 route using
          an Inter-Area-Prefix (type\n   0x2003) LSA under the following circumstances:\n
          \     The OSPFv3 domain from which the IPv6 route was learned is the\n      same
          (as determined by the Domain ID) as the domain of the OSPFv3\n      instance
          into which it is to be redistributed; and\n      The IPv6 route was advertised
          to a remote PE in an Intra-Area-\n      Prefix (type 0x2009) OR an Inter-Area-Prefix
          (type 0x2003) LSA.\n   Note that under these rules, the PE represents itself
          as an Area\n   Border Router (ABR) regardless of whether or not the route
          is being\n   advertised into the same area number from which the remote
          PE learned\n   it (that is, whether the VPN-IPv6 route carries the same
          or different\n   area numbers).\n"
        title: 4.3.2.1.  OSPF Inter-Area Routes
      - contents:
        - "4.3.2.2.  OSPF Intra-Area Route\n   A route is advertised as an intra-area
          route using an Intra-Area-\n   Prefix (type 0x2009) LSA only when sham links
          are used, as described\n   in Section 5.  Otherwise, routes are advertised
          as either inter-area\n   (Section 4.3.2.1) or external / Not-So-Stubby Area
          (NSSA) (Section\n   4.3.2.3) routes.\n"
        title: 4.3.2.2.  OSPF Intra-Area Route
      - contents:
        - "4.3.2.3.  OSPF External Routes and NSSA Routes\n   A PE considers an IPv6
          route to be external under the following\n   circumstances:\n      The OSPFv3
          domain from which the route was learned is different\n      (as determined
          by the Domain ID) from the domain of the OSPFv3\n      instance into which
          it is redistributed; or\n      The OSPFv3 domain from which the route was
          learned is the same as\n      the domain of the OSPFv3 instance into which
          it is redistributed,\n      AND it was advertised to the remote PE in an
          AS-External-LSA (type\n      0x4005) or an NSSA-LSA (type 0x2007); or\n
          \     The route was not learned from an OSPFv3 instance.\n   To determine
          if the learned route is from a different domain, the\n   Domain ID associated
          with the VPN-IPv6 route (in the OSPF Domain ID\n   Extended Communities
          attribute or attributes) is compared with the\n   local OSPFv3 Domain ID,
          if configured.  Compared Domain IDs are\n   considered identical if:\n   1.
          \ All 8 bytes are identical; or\n   2.  Both Domain IDs are NULL (all zeroes).\n
          \  Note that if the VPN-IPv6 route does not have a Domain ID in its\n   attributes,
          or if the local OSPFv3 instance does not have a\n   configured Domain ID
          (i.e., in either case), the route is considered\n   to have a NULL Domain
          ID.\n   An IPv6 route that is determined to be external might or might not
          be\n   advertised to a connected CE, depending on the type of area to which\n
          \  the PE-CE link belongs and whether there is a configured policy\n   restricting
          its advertisement.\n   If there are multiple external routes to the same
          prefix, the\n   standard OSPFv3 decision process is used to select the \"best\"
          route.\n   If the external route is to be advertised and the area type of
          the\n   PE-CE link is NSSA, the PE advertises the route in an NSSA-LSA (type\n
          \  0x2007); otherwise, the external route is advertised in an\n   AS-External-LSA
          (type 0x4005).\n   The DN-bit of the LSA advertising the external route
          MUST be set, as\n   described in Section 4.5.1.\n   If the VPN-IPv6 route
          indicates a route Type-1 metric, the PE should\n   advertise the external
          route with that metric-type; otherwise, the\n   metric-type of the external
          IPv6 route is set to Type-2 by default.\n   Note that, by default, a PE
          should advertise an external route with a\n   Type-2 metric if the IPv6
          route's Domain ID is different than the\n   local OSPFv3 instance, unless
          specified otherwise by local policy.\n"
        title: 4.3.2.3.  OSPF External Routes and NSSA Routes
      title: 4.3.2.  VPN-IPv6 Routes Received from MP-BGP
    title: 4.3.  VRFs and Routes
  - contents:
    - "4.4.  BGP Extended Communities Attributes\n   OSPFv3 routes from one site are
      translated and delivered\n   transparently to the remote site as BGP VPN-IPv6
      routes.  The\n   original OSPFv3 routes carry OSPFv3-specific information that
      needs\n   to be communicated to the remote PE to ensure transparency.  BGP\n
      \  Extended Communities are used to carry the needed information to\n   enable
      the receiving side to reconstruct a database just as in the\n   OSPFv2 case.\n
      \  All OSPFv3 routes added to the VRF routing table on a PE router are\n   examined
      to create a corresponding VPN-IPv6 route in BGP.  Each of\n   the OSPFv3 routes
      MUST have the corresponding BGP Extended\n   Communities Attributes that contain
      and preserve the OSPFv3\n   information of the original OSPFv3 route.  The BGP
      Extended\n   Communities attributes defined in [RFC4577] are reused for\n   convenience.\n
      \  OSPF Domain Identifier Extended Communities Attribute\n   Each OSPFv3 Instance
      within a VRF MUST have a Domain ID.  The Domain\n   ID is configured per OSPFv3
      Instance.  The OSPFv3 Domain ID is a\n   6-byte number, and its default value
      is 0.  This attribute has a\n   2-byte type field, encoded with a value of 0x0005,
      0x0105, or 0x0205.\n        0                   1                   2                   3\n
      \       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \      |          Type Value           |    Domain Identifier          |\n       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \      |                     Domain Identifier Cont.                   |\n       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \        The OSPF Domain Identifier Extended Communities Attribute\n      OSPFv3
      Domain IDs field : 6 bytes\n      Each OSPFv3 Instance within a VRF MUST have
      a Domain ID and its\n      default value (if none is configured) is 0.  The
      Domain ID is\n      configured per OSPFv3 Instance.\n   OSPF Router ID Extended
      Communities Attribute\n   The OSPFv3 Router ID is a 32-bit number as in OSPFv2.
      \ This attribute\n   has a 2-byte type field, encoded with a value of 0x0107.\n
      \       0                   1                   2                   3\n        0
      1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \      |          Type Value           |          Router ID            |\n       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \      |       Router ID Cont.         |          UNUSED               |\n       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \            The OSPF Router ID Extended Communities Attribute\n      OSPFv3
      Router ID field : 4 bytes\n      The OSPFv3 Router ID is a 32-bit number as
      in OSPFv2.  Setting\n      this field is OPTIONAL, and its default value is
      0.\n   OSPF Route Type Extended Communities Attribute\n   The OSPF Route Type
      Extended Communities Attribute MUST be present.\n   It contains a 2-byte type
      field, encoded with a value of 0x0306.  The\n   remaining 6 bytes are divided
      into 3 fields, an Area Number, a Route\n   Type, and an Options field.\n        0
      \                  1                   2                   3\n        0 1 2
      3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \      |          Type Value           |         Area Number           |\n       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \      |      Area Number Cont.        |  Route Type   |    Options    |\n       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \           The OSPF Route Type Extended Communities Attribute\n      Area Number
      : 4 bytes\n      The area number indicates the 32-bit Area ID to which the route\n
      \     belongs.\n      Route Types : 1 byte\n      To accommodate OSPFv3 LSA
      types (as registered by [RFC5340]), the\n      Route Type field is encoded as
      follows:\n       Route Type  Route Type      LSA Type   Description\n         Code\n
      \      -----------------------------------------------------------\n         3
      \     Inter-area-prefix  0x2003   Inter-Area-Prefix-LSA\n         5      External
      \          0x4005   AS-External-LSA\n         7      NSSA               0x2007
      \  NSSA-LSA\n         1 or 2 Intra-area-prefix  0x2009   Intra-Area-Prefix-LSA\n
      \                         Route Type Field Encoding\n      Options : 1 byte\n
      \     The Options field indicates the options that are associated with\n      the
      OSPFv3 route.\n                         8   7   6   5   4   3   2   1\n                       +---+---+---+---+---+---+---+---+\n
      \                      |   |   |   |   |   |   |   | E |\n                       +---+---+---+---+---+---+---+---+\n
      \                       The OSPFv3 Route Options Field\n      The least significant
      bit (i.e., bit E) in this field designates\n      the external metric-type.
      \ If the bit is clear, the route carries\n      a Type-1 external metric; if
      the bit is set, the route carries a\n      Type-2 external metric.\n"
    title: 4.4.  BGP Extended Communities Attributes
  - contents:
    - "4.5.  Loop Prevention Techniques\n   In some topologies, it is possible for
      routing loops to occur due to\n   the nature and manner of route reachability
      propagation.  One such\n   example is the case of a dual-homed CE router connected
      to two PEs;\n   those PE routers would receive reachability information both
      through\n   their CE and their peer PE.  As there is transparent transport of\n
      \  OSPFv3 routes over the VPN backbone, it is not possible for the PE\n   routers
      to determine whether they are within a loop.\n   The loop scenarios in OSPFv3
      topologies are identical to those in the\n   OSPFv2 topologies described in
      Sections 4.2.5.1 and 4.2.5.2 of\n   [RFC4577].  Of the two loop prevention mechanisms
      described in the\n   aforementioned sections, only the DN-bit option will be
      supported in\n   the OSPFv3 implementation.\n"
    - contents:
      - "4.5.1.  OSPFv3 Down Bit\n   [RFC4576] describes the usage of the DN-bit for
        OSPFv2 and is\n   applicable for OSPFv3 for Inter-area-prefix LSAs, NSSA LSAs,
        and\n   External LSAs.  Similarly, the DN-bit MUST be set in Inter-area-\n
        \  prefix LSAs, NSSA LSAs, and AS-External LSAs, when these are\n   originated
        from a PE to a CE, to prevent those prefixes from being\n   re-advertised
        into BGP.  As in [RFC4577], any LSA with the DN-bit set\n   must not be used
        for route calculations on PE routers.\n   The DN-bit MUST be clear in all
        other LSA types.  The OSPFv3 DN-bit\n   format is described in Appendix A.4.1.1
        of [RFC5340].\n"
      title: 4.5.1.  OSPFv3 Down Bit
    - contents:
      - "4.5.2.  Other Possible Loops\n   The mechanism described in Section 4.5.1
        of this document is\n   sufficient to prevent looping if the DN-bit information
        attached to a\n   prefix is preserved in the OSPF domain.  As described in
        Section\n   4.2.5.3 of [RFC4577], caution must be exercised if mutual\n   redistribution
        that is performed on a PE causes loss of loop\n   prevention information.\n"
      title: 4.5.2.  Other Possible Loops
    title: 4.5.  Loop Prevention Techniques
  title: 4.  BGP/OSPFv3 Interaction Procedures for PE Routers
- contents:
  - "5.  OSPFv3 Sham Links\n   This section modifies the specification of OSPFv2 sham
    links (defined\n   in Section 4.2.7 of [RFC4577]) to support OSPFv3.  Support
    for OSPFv3\n   sham links is an OPTIONAL feature of this specification.\n   A
    sham link enables a VPN backbone to act as an intra-area link.  It\n   is needed
    when two sites are connected by an intra-area \"backdoor\"\n   link and the inter-area
    VPN backbone route would be less preferable\n   due to OSPF route preference rules.
    \ The figure below shows the\n   instantiation of a sham link between two VPN
    sites.\n                             (VPN backbone)\n        (site-1)      <--------
    sham link -------->      (site-2)\n         CE1 -------- PE1 -------- P ----------
    PE2 -------- CE2\n          |                                                   |\n
    \         |___________________________________________________|\n               <------------
    backdoor link -------------->\n                        (OSPF intra-area link)\n
    \                                Sham Link\n   Much of the operation of sham links
    remains semantically identical to\n   what was previously specified.  There are,
    however, several\n   differences that need to be defined to ensure the proper
    operation of\n   OSPFv3 sham links.\n   One of the primary differences between
    sham links for OSPFv3 and sham\n   links as specified in [RFC4577] is for configurations
    where multiple\n   OSPFv3 instances populate a VRF.  It may be desirable to provide\n
    \  separate intra-area links between these instances over the same sham\n   link.
    \ To achieve this, multiple OSPFv3 instances may be established\n   across the
    PE-PE sham link to provide intra-area connectivity between\n   PE-CE OSPFv3 instances.\n
    \  Note that even though multiple OSPFv3 instances may be associated\n   with
    a VRF, a sham link is still thought of as a relation between two\n   VRFs.\n   Another
    modification to OSPFv2 sham links is that OSPFv3 sham links\n   are now identified
    by 128-bit endpoint addresses.  Since sham link\n   endpoint addresses are now
    128 bits, they can no longer default to\n   the RouterID, which is a 32-bit number.
    \ Sham link endpoint addresses\n   MUST be configured.\n   Sham link endpoint
    addresses MUST be distributed by BGP as routeable\n   VPN IPv6 addresses, each
    with an IPv6 address prefix that is 128 bits\n   long.  As specified in Section
    4.2.7.1 of [RFC4577], these endpoint\n   addresses MUST NOT be advertised by OSPFv3;
    if there is no BGP route\n   to the sham link endpoint address, that address is
    to appear\n   unreachable, so that the sham link appears to be down.\n   If there
    is a BGP route to the remote sham link endpoint address, the\n   sham link appears
    to be up.  Conversely, if there is no BGP route to\n   the sham link endpoint
    address, the sham link appears to be down.\n"
  - contents:
    - "5.1.  Creating a Sham Link\n   The procedures for creating an OSPFv3 sham link
      are identical to\n   those specified in Section 4.2.7.2 of [RFC4577].  Note
      that the\n   creation of OSPFv3 sham links requires the configuration of both\n
      \  local and remote 128-bit sham link endpoint addresses.  The local\n   sham
      link endpoint address associated with a VRF MAY be used by all\n   OSPFv3 instances
      that are attached to that VRF.  The OSPFv3 PE-PE\n   \"link\" Instance ID in
      the protocol packet header is used to\n   demultiplex multiple OSPFv3 instance
      protocol packets exchanged over\n   the sham link.\n"
    title: 5.1.  Creating a Sham Link
  - contents:
    - "5.2.  OSPF Protocol on Sham Link\n   Much of the operation of OSPFv3 over a
      sham link is semantically the\n   same as the operation of OSPFv2 over a sham
      link, as described in\n   Section 4.2.7.3 of [RFC4577].  This includes the methodology
      for\n   sending and receiving OSPFv3 packets over sham links, as well as\n   Hello/Router
      Dead Intervals.  Furthermore, the procedures associated\n   with the assignment
      of sham link metrics adhere to those set forth\n   for OSPFv2.  OSPFv3 sham
      links are treated as on-demand circuits.\n   Although the operation of the OSPFv3
      protocol over the sham link is\n   the same as OSPFv2, multiple OSPFv3 instances
      may be instantiated\n   across this link.  By instantiating multiple instances
      across the\n   sham link, distinct intra-area connections can be established
      between\n   PE-PE OSPFv3 instances associated with the endpoint addresses.\n
      \  For example, if two OSPFv3 instances (O1, O2) attach to a VRF V1, and\n   on
      a remote PE, two other OSPFv3 instances (O3, O4) attach to a VRF\n   V2, it
      may be desirable to connect O1 and O3 with an intra-area link,\n   and O2 and
      O4 with an intra-area link.  This can be accomplished by\n   instantiating two
      OSPFv3 instances across the sham link, which\n   connects V1 and V2.  O1 and
      O3 can be mapped to one of the sham link\n   OSPFv3 instances; O2 and O4 can
      be mapped to the other sham link\n   OSPFv3 instance.\n"
    title: 5.2.  OSPF Protocol on Sham Link
  - contents:
    - "5.3.  OSPF Packet Forwarding on Sham Link\n   The rules associated with route
      redistribution, stated in Section\n   4.2.7.4 of [RFC4577], remain unchanged
      in this specification.\n   Specifically:\n      If the next-hop interface for
      a particular route is a sham link,\n      then the PE SHOULD NOT redistribute
      that route into BGP as a VPN-\n      IPv6 route.\n      Any other route advertised
      in an LSA that is transmitted over a\n      sham link MUST also be redistributed
      (by the PE flooding the LSA\n      over the sham link) into BGP.\n   When redistributing
      these LSAs into BGP, they are encoded with the\n   BGP Extended Communities
      Attributes, as defined in Section 4.4 of\n   this document.\n   When forwarding
      a packet, if the preferred route for that packet has\n   the sham link as its
      next-hop interface, then the packet MUST be\n   forwarded according to the corresponding
      BGP route (as defined in\n   [RFC4364] and [RFC4659]).\n"
    title: 5.3.  OSPF Packet Forwarding on Sham Link
  title: 5.  OSPFv3 Sham Links
- contents:
  - "6.  Multiple Address Family Support\n   The support of multiple address families
    (AFs) in OSPFv3 is described\n   in [RFC5838]. [RFC5838] differentiates between
    AFs by using reserved\n   ranges of Instance IDs for each AF.\n   The architecture
    described in this document is fully compatible with\n   [RFC5838].  The OSPFv3
    PE-CE protocol can support multiple address\n   families across a VPN backbone.
    \ All AFs redistributed from OSPFv3\n   into BGP on a PE MUST contain the BGP
    Extended Communities Attributes\n   as described in Section 4.4.\n"
  title: 6.  Multiple Address Family Support
- contents:
  - "7.  Security Considerations\n   The extensions described in this document are
    specific to the use of\n   OSPFv3 as the PE-CE protocol and do not introduce any
    new security\n   concerns other than those already defined in Section 6 of [RFC4577].\n"
  title: 7.  Security Considerations
- contents:
  - "8.  IANA Considerations\n   An early version of this document resulted in the
    allocation of\n   OSPFv3 Route Attributes (0x0004) entry in the BGP IPv6 Address\n
    \  Specific Extended Community.  This allocation is no longer required.\n   IANA
    has marked the OSPFv3 Route Attributes (0x0004) entry in the BGP\n   IPv6 Address
    Specific Extended Community registry as deprecated.  The\n   BGP Extended Communities
    Attributes in this document have already\n   been registered by IANA.\n"
  title: 8.  IANA Considerations
- contents:
  - "9.  Acknowledgments\n   The authors would like to thank Kelvin Upson, Seiko Okano,
    Matthew\n   Everett, Dr. Vineet Mehta, Paul Wells, and Marek Karasek for their\n
    \  support of this work.  Thanks to Peter Psenak, Abhay Roy, Acee\n   Lindem,
    Nick Weeds, Robert Hanzl, and Daniel Cohn for their Last Call\n   comments.  Special
    thanks to Stewart Bryant, Stephen Farrel, and Fred\n   Baker for their thorough
    review.\n"
  title: 9.  Acknowledgments
- contents:
  - '10.  References

    '
  - contents:
    - "10.1.  Normative References\n   [RFC2119]  Bradner, S., \"Key words for use
      in RFCs to Indicate\n              Requirement Levels\", BCP 14, RFC 2119, March
      1997.\n   [RFC2328]  Moy, J., \"OSPF Version 2\", STD 54, RFC 2328, April 1998.\n
      \  [RFC4360]  Sangli, S., Tappan, D., and Y. Rekhter, \"BGP Extended\n              Communities
      Attribute\", RFC 4360, February 2006.\n   [RFC4364]  Rosen, E. and Y. Rekhter,
      \"BGP/MPLS IP Virtual Private\n              Networks (VPNs)\", RFC 4364, February
      2006.\n   [RFC4576]  Rosen, E., Psenak, P., and P. Pillay-Esnault, \"Using a\n
      \             Link State Advertisement (LSA) Options Bit to Prevent\n              Looping
      in BGP/MPLS IP Virtual Private Networks (VPNs)\",\n              RFC 4576, June
      2006.\n   [RFC4577]  Rosen, E., Psenak, P., and P. Pillay-Esnault, \"OSPF as
      the\n              Provider/Customer Edge Protocol for BGP/MPLS IP Virtual\n
      \             Private Networks (VPNs)\", RFC 4577, June 2006.\n   [RFC4659]
      \ De Clercq, J., Ooms, D., Carugi, M., and F. Le Faucheur,\n              \"BGP-MPLS
      IP Virtual Private Network (VPN) Extension for\n              IPv6 VPN\", RFC
      4659, September 2006.\n   [RFC4760]  Bates, T., Chandra, R., Katz, D., and Y.
      Rekhter,\n              \"Multiprotocol Extensions for BGP-4\", RFC 4760, January\n
      \             2007.\n   [RFC5340]  Coltun, R., Ferguson, D., Moy, J., and A.
      Lindem, \"OSPF\n              for IPv6\", RFC 5340, July 2008.\n   [RFC5838]
      \ Lindem, A., Ed., Mirtorabi, S., Roy, A., Barnes, M., and\n              R.
      Aggarwal, \"Support of Address Families in OSPFv3\", RFC\n              5838,
      April 2010.\n"
    title: 10.1.  Normative References
  - contents:
    - "10.2.  Informative References\n   [RFC2547]  Rosen, E. and Y. Rekhter, \"BGP/MPLS
      VPNs\", RFC 2547, March\n              1999.\n"
    title: 10.2.  Informative References
  title: 10.  References
- contents:
  - "Authors' Addresses\n   Padma Pillay-Esnault\n   Cisco Systems\n   510 McCarty
    Blvd.\n   Milpitas, CA 95035\n   USA\n   EMail: ppe@cisco.com\n   Peter Moyer\n
    \  Pollere, Inc.\n   325M Sharon Park Drive #214\n   Menlo Park, CA 94025\n   USA\n
    \  EMail: pete@pollere.net\n   Jeff Doyle\n   Jeff Doyle and Associates\n   9878
    Teller Ct.\n   Westminster, CO 80021\n   USA\n   EMail: jdoyle@doyleassociates.net\n
    \  Emre Ertekin\n   Booz Allen Hamilton\n   5220 Pacific Concourse Drive\n   Los
    Angeles, CA 90045\n   USA\n   EMail: ertekin_emre@bah.com\n   Michael Lundberg\n
    \  Booz Allen Hamilton\n   8283 Greensboro Drive\n   McLean, VA 22102\n   USA\n
    \  EMail: lundberg_michael@bah.com\n"
  title: Authors' Addresses
