- title: __initial_text__
  contents:
  - '        Impact of BGP Filtering on Inter-Domain Routing Policies

    '
- title: Abstract
  contents:
  - "Abstract\n   This document describes how unexpected traffic flows can emerge\n\
    \   across an autonomous system as the result of other autonomous systems\n  \
    \ filtering or restricting the propagation of more-specific prefixes.\n   We provide\
    \ a review of the techniques to detect the occurrence of\n   this issue and defend\
    \ against it.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This document is not an Internet Standards Track specification;\
    \ it is\n   published for informational purposes.\n   This document is a product\
    \ of the Internet Engineering Task Force\n   (IETF).  It represents the consensus\
    \ of the IETF community.  It has\n   received public review and has been approved\
    \ for publication by the\n   Internet Engineering Steering Group (IESG).  Not\
    \ all documents\n   approved by the IESG are a candidate for any level of Internet\n\
    \   Standard; see Section 2 of RFC 5741.\n   Information about the current status\
    \ of this document, any errata,\n   and how to provide feedback on it may be obtained\
    \ at\n   http://www.rfc-editor.org/info/rfc7789.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2016 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (http://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.  Code Components\
    \ extracted from this document must\n   include Simplified BSD License text as\
    \ described in Section 4.e of\n   the Trust Legal Provisions and are provided\
    \ without warranty as\n   described in the Simplified BSD License.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1.  Introduction  . . . . . . . . . . . . . . . . . . .\
    \ . . . . .   2\n     1.1.  Terminology . . . . . . . . . . . . . . . . . . .\
    \ . . . .   3\n   2.  Unexpected Traffic Flows  . . . . . . . . . . . . . . .\
    \ . . .   4\n     2.1.  Local Filtering . . . . . . . . . . . . . . . . . . .\
    \ . .   4\n       2.1.1.  Unexpected Traffic Flows Caused by Local Filtering of\n\
    \               More-Specific Prefixes  . . . . . . . . . . . . . . .   5\n  \
    \   2.2.  Remote Filtering  . . . . . . . . . . . . . . . . . . . .   6\n    \
    \   2.2.1.  Unexpected Traffic Flows Caused by Remotely Triggered\n          \
    \     Filtering of More-Specific Prefixes . . . . . . . . .   7\n   3.  Techniques\
    \ to Detect Unexpected Traffic Flows Caused by\n       Filtering of More-Specific\
    \ Prefixes . . . . . . . . . . . . .   8\n     3.1.  Existence of Unexpected Traffic\
    \ Flows within an AS  . . .   8\n     3.2.  Contribution to the Existence of Unexpected\
    \ Traffic Flows\n           in Another AS . . . . . . . . . . . . . . . . . .\
    \ . . . .   9\n   4.  Techniques to Traffic Engineer Unexpected Flows . . . .\
    \ . . .  10\n     4.1.  Reactive Traffic Engineering  . . . . . . . . . . . .\
    \ . .  11\n     4.2.  Proactive Measures  . . . . . . . . . . . . . . . . . .\
    \ .  12\n       4.2.1.  Access Lists  . . . . . . . . . . . . . . . . . . . .\
    \  12\n       4.2.2.  Neighbor-Specific Forwarding  . . . . . . . . . . . .  13\n\
    \   5.  Conclusions . . . . . . . . . . . . . . . . . . . . . . . . .  14\n  \
    \ 6.  Security Considerations . . . . . . . . . . . . . . . . . . .  14\n   7.\
    \  References  . . . . . . . . . . . . . . . . . . . . . . . . .  14\n     7.1.\
    \  Normative References  . . . . . . . . . . . . . . . . . .  14\n     7.2.  Informative\
    \ References  . . . . . . . . . . . . . . . . .  15\n   Acknowledgements  . .\
    \ . . . . . . . . . . . . . . . . . . . . . .  16\n   Authors' Addresses  . .\
    \ . . . . . . . . . . . . . . . . . . . . .  16\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   It is common practice for network operators to propagate\
    \ a more-\n   specific prefix in the BGP routing system along with the less-\n\
    \   specific prefix that they originate.  It is also possible for some\n   Autonomous\
    \ Systems (ASes) to apply different policies to the more\n   specific and the\
    \ less-specific prefix.\n   Although BGP makes independent, policy-driven decisions\
    \ for the\n   selection of the best path to be used for a given IP prefix, routers\n\
    \   must forward packets using the longest-prefix-match rule, which\n   \"precedes\"\
    \ any BGP policy [RFC1812].  The existence of a prefix p\n   that is more specific\
    \ than a prefix p' in the Forwarding Information\n   Base (FIB) will let packets\
    \ whose destination matches p be forwarded\n   according to the next hop selected\
    \ as best for p (the more-specific\n   prefix).  This process takes place by disregarding\
    \ the policies\n   applied in the control plane for the selection of the best\
    \ next hop\n   for p'.  When an AS filters more-specific prefixes and forwards\n\
    \   packets according to the less-specific prefix, the discrepancy among\n   the\
    \ routing policies applied to the less and the more-specific\n   prefixes can\
    \ create unexpected traffic flows.  These may infringe on\n   the policies of\
    \ other ASes still holding a path towards the more-\n   specific prefix.\n   The\
    \ objective of this document is to shed light on possible side\n   effects associated\
    \ with more-specific prefix filtering.  Such actions\n   can be explained by traffic\
    \ engineering action, misconfiguration, or\n   malicious intent.  This document\
    \ presents examples of such side\n   effects and discusses approaches towards\
    \ solutions to the problem.\n   The rest of the document is organized as follows:\
    \ in Section 2 we\n   provide some scenarios in which the filtering of more-specific\n\
    \   prefixes leads to the creation of unexpected traffic flows; Section 3\n  \
    \ and Section 4 discuss some techniques that ASes can use for,\n   respectively,\
    \ detecting and reacting to unexpected traffic flows; and\n   the document concludes\
    \ in Section 5.\n"
- title: 1.1.  Terminology
  contents:
  - "1.1.  Terminology\n   More-specific prefix:  A prefix in the routing table with\
    \ an address\n      range that is covered by a shorter prefix also present in\
    \ the\n      routing table.\n   Less-specific prefix:  A prefix in the routing\
    \ table with an address\n      range partially covered by other prefixes.\n  \
    \ Customer-provider peering:  A peering arrangement in which a transit\n     \
    \ network provides connectivity to a customer in exchange of a fee,\n      as\
    \ derived from RFC 4384 [RFC4384].\n   Settlement-free peering:  A peering arrangement\
    \ in which two networks\n      agree on a settlement-free traffic exchange, typically\
    \ covering\n      only their customer traffic, as derived from RFC 4384 [RFC4384].\n\
    \   Selective advertisement:  The behavior of only advertising a self\n      originated\
    \ BGP path for a prefix over a strict subset of the\n      External BGP (eBGP)\
    \ sessions of the AS.\n   Selective propagation:  The behavior of only propagating\
    \ a BGP path\n      for a prefix over a strict subset of the eBGP sessions of\
    \ an AS.\n   Local filtering:  The behavior of explicitly ignoring a BGP path\n\
    \      received over an eBGP session.\n   Remote filtering:  The behavior of triggering\
    \ selective propagation\n      of a BGP path at a distant AS.  Note that this\
    \ is typically\n      achieved by tagging a self-originated path with BGP communities\n\
    \      defined by the distant AS.\n   Unexpected traffic flow:  Traffic flowing\
    \ between two neighboring\n      ASes of an AS, although the transit policy of\
    \ that AS is to not\n      provide connectivity between these two neighbors. \
    \ A traffic flow\n      across an AS between two of its transit providers or between\
    \ a\n      transit provider and one of its settlement-free peers are classic\n\
    \      examples of unexpected traffic flows.\n"
- title: 2.  Unexpected Traffic Flows
  contents:
  - "2.  Unexpected Traffic Flows\n   In this section, we describe how more-specific\
    \ prefix filtering can\n   lead to unexpected traffic flows in other, remote,\
    \ ASes.  We\n   differentiate cases in which the filtering is performed locally\
    \ from\n   those where the filtering is triggered remotely.\n"
- title: 2.1.  Local Filtering
  contents:
  - "2.1.  Local Filtering\n   Different reasons motivate local filtering, for example:\n\
    \   Traffic engineering:  An ISP can decide to filter more-specific\n      prefixes\
    \ when it wants to control their local outbound traffic\n      distribution using\
    \ only the policy applied to the less-specific\n      prefix.  Such a practice\
    \ was notably documented in a presentation\n      by Init7 [INIT7-RIPE63].\n \
    \  Enforcing contract compliance:  An ISP can decide to filter more-\n      specific\
    \ prefixes to enforce clauses of their peering agreements.\n      For instance,\
    \ a settlement-free peer of an ISP can use selective\n      advertisement of more-specific\
    \ prefixes to attract traffic to one\n      link.  If this practice is not allowed\
    \ by their peering agreement,\n      the ISP can filter the more-specific prefixes\
    \ to prevent it.\n   Memory preservation:  An ISP can decide to filter more-specific\n\
    \      prefixes in order to preserve FIB memory of their routers.\n   Figure 1\
    \ illustrates a scenario where one AS performs local filtering\n   due to outbound\
    \ traffic engineering.  The figure depicts AS64504 and\n   two of its neighboring\
    \ ASes, AS64502 and AS64505.  AS64504 has a\n   settlement-free peering with AS64502\
    \ and is a customer of AS64505.\n   AS64504 receives from AS64505 prefixes 2001:DB8::/32\
    \ and\n   2001:DB8::/34.  AS64504 only receives the less-specific prefix\n   2001:DB8::/32\
    \ from AS64502.\n                 ,-----.\n                /       \\\n      \
    \         ( AS64505 )\n                \\       /\n                 `--+--'\n\
    \    2001:DB8::/32 | |\n    2001:DB8::/34 v |\n                    |\n       \
    \          ,--+--.  2001:DB8::/32  ,-----.\n                /       \\       \
    \    <-- /       \\\n               ( AS64504 )-------------( AS64502 )\n    \
    \            \\       /               \\       /\n                 `-----'   \
    \              `-----'\n                         Figure 1: Local Filtering\n \
    \  Due to economic reasons, AS64504 might prefer to send traffic to\n   AS64502\
    \ instead of AS64505.  However, even if paths received from\n   AS64502 are given\
    \ a large local preference, routers in AS64504 will\n   still send traffic to\
    \ prefix 2001:DB8::/34 via neighbor AS64505.\n   This situation may push AS64504\
    \ to apply an inbound filter for the\n   more-specific prefix, 2001:DB8::/34,\
    \ on the session with AS64505.\n   After applying the filter, AS64504 will send\
    \ traffic for the more-\n   specific prefix to AS64502.\n"
- title: 2.1.1.  Unexpected Traffic Flows Caused by Local Filtering of More-
  contents:
  - "2.1.1.  Unexpected Traffic Flows Caused by Local Filtering of More-\n       \
    \ Specific Prefixes\n   In this section, we show how the decision of AS64504 to\
    \ perform local\n   filtering creates unexpected traffic flows in AS64502.  Figure\
    \ 2\n   shows the whole picture of the scenario where AS64501 is a customer\n\
    \   of AS64503 and AS64502.  AS64503 is a settlement-free peer with\n   AS64502.\
    \  AS64503 and AS64502 are customers of AS64505.  The AS\n   originating the two\
    \ prefixes, AS64501, performs selective\n   advertisement with the more-specific\
    \ prefix and only announces it to\n   AS64503.\n   After AS64504 locally filters\
    \ the more-specific prefix, traffic from\n   AS64504 to prefix 2001:DB8::/34 is\
    \ forwarded towards AS64502.\n   Because AS64502 receives the more-specific prefix\
    \ from AS64503,\n   traffic from AS64504 to 2001:DB8::/34 follows the path\n \
    \  AS64504-AS64502-AS64503-AS64501.  AS64502's BGP policies are\n   implemented\
    \ to avoid transporting traffic between AS64504 and\n   AS64503.  However, due\
    \ to the discrepancies of routes between the\n   more and the less-specific prefixes,\
    \ unexpected traffic flows between\n   AS64504 and AS64503 exist in AS64502's\
    \ network.\n                          ____,,................______\n         \
    \       _,.---''''                            `''---..._\n            ,-''   AS64505\
    \                                      `-.\n            [                    \
    \                                  /\n             -.._                      \
    \                       __.-'\n              .  `'---....______              \
    \  ______...---''\n            + |/32              `'''''''''''''''         |\n\
    \            | |/34               + |/32                  |\n            v | \
    \                 v |/34                  |\n              |                 \
    \   |                   ^ |\n              |                  ^ |/32         \
    \       | |/32\n              |                  + |                   + |/34\n\
    \       _,,---.:_               _,,---.._              _,,---.._\n     ,'    \
    \     `.           ,'         `.          ,'         `.\n    /  AS64504    \\\
    \     <-+ /  AS64502    \\        /  AS64503    \\\n    |             |_________|\
    \             |________|             |\n    |             |     /32 |        \
    \     |/32  /32|             |\n    '.           ,'          .           ,'  \
    \   /34 .           ,'\n      `.       ,'             `.       ,'  +->  <-+  `.\
    \       ,'\n        ``---''                 ``---''                ``---''\n \
    \                                   |                  ^ |\n                 \
    \                 ^ |2001:DB8::/32     | |2001:DB8::/32\n                    \
    \              | |                  + |2001:DB8::/34\n                       \
    \           + | _....---------...._|\n                                   ,-'AS64501\
    \            ``-.\n                                 /'                       \
    \   `.\n                                 `.                         _,\n     \
    \                              `-.._               _,,,'\n                   \
    \                     `''---------'''\n         Figure 2: Unexpected Traffic Flows\
    \ Due to Local Filtering\n"
- title: 2.2.  Remote Filtering
  contents:
  - "2.2.  Remote Filtering\n   ISPs can tag the BGP paths that they propagate to\
    \ neighboring ASes\n   with communities in order to tweak the propagation behavior\
    \ of the\n   ASes that handle these paths; see a paper from 2008 by Donnet and\n\
    \   Bonaventure [on_BGP_communities].  Some ISPs allow their customers to\n  \
    \ use such communities to let the receiving AS not export the path to\n   some\
    \ selected neighboring ASes.  By combining communities, the prefix\n   could be\
    \ advertised only to a given peer of the AS providing this\n   feature.  A network\
    \ operator can leverage remote filtering to, for\n   instance, limit the scope\
    \ of prefixes and hence perform more granular\n   inbound traffic engineering.\n\
    \   Figure 3 illustrates a scenario in which an AS uses BGP communities\n   to\
    \ command its provider to selectively propagate a more-specific\n   prefix.  Let\
    \ AS64501 be a customer of AS64502 and AS64503.  AS64501\n   originates prefix\
    \ 2001:DB8::/32, which it advertises to AS64502 and\n   AS64503.  AS64502 and\
    \ AS64503 are settlement-free peers.  Let AS64501\n   do selective advertisement\
    \ and only propagate 2001:DB8::/34 over\n   AS64503.  AS64503 would normally propagate\
    \ this prefix to its\n   customers, providers, and peers, including AS64502.\n\
    \   Let us consider that AS64501 decides to limit the scope of the more-\n   specific\
    \ prefix.  AS64501 can make this decision based on its traffic\n   engineering\
    \ strategy.  To achieve this, AS64501 can tag the more-\n   specific prefix with\
    \ a set of communities that leads AS64503 to only\n   propagate the path to AS64502.\n\
    \      ^     \\         /     ^       ^    \\         /    ^\n      |  /32 \\\
    \       / /32  |       | /32 \\       / /32 |\n               ,-----.        \
    \             ,-----.\n             ,'       `.                 ,'       `.\n\
    \            / AS64502   \\               / AS64503   \\\n           (       \
    \      )-------------(             )\n            \\           / /32       /32\
    \ \\           /\n             `.       ,'   ->       /34  `.       ,'\n     \
    \          '-----;              <-  /  '-----'\n                      \\     \
    \           /\n                    ^  \\              /    ^\n               \
    \     |   \\            /     |\n                    |    \\          /      |\n\
    \                    |     \\ ,-----.'       |  2001:DB8::/32\n              \
    \      |     ,'       `.      |  2001:DB8::/34\n      2001:DB8::/32 +--  / AS64501\
    \   \\   --+\n                        (             )\n                      \
    \   \\           /\n                          `.       ,'\n                  \
    \          '-----'\n                   Figure 3: Remote-Triggered Filtering\n"
- title: 2.2.1.  Unexpected Traffic Flows Caused by Remotely Triggered Filtering
  contents:
  - "2.2.1.  Unexpected Traffic Flows Caused by Remotely Triggered Filtering\n   \
    \     of More-Specific Prefixes\n   Figure 4 expands the scenario from Figure\
    \ 3 and includes other ASes\n   peering with AS64502 and AS64503.  Due to the\
    \ limitation on the scope\n   performed on the more-specific prefix, ASes that\
    \ are not customers of\n   AS64502 will not receive a path for 2001:DB8::/34.\
    \  These ASes will\n   forward packets destined to 2001:DB8::/34 according to\
    \ their routing\n   state for 2001:DB8::/32.  Let us assume that AS64505 is such\
    \ an AS\n   and that its best path towards 2001:DB8::/32 is through AS64502.\n\
    \   Packets sent towards 2001:DB8::1 by AS64505 will reach AS64502.\n   However,\
    \ in the data plane of the nodes of AS64502, the longest\n   prefix match for\
    \ 2001:DB8::1 is 2001:DB8::/34, which is reached\n   through AS64503, a settlement-free\
    \ peer of AS64502.  Since AS64505 is\n   not in the customer branch of AS64502,\
    \ traffic flows between two\n   noncustomer ASes in AS64502.\n               \
    \           ,-----.\n                        ,'       `.\n                   \
    \    / AS64505   \\\n                      (             )\n                 \
    \      \\           /\n                       ,`.       ,' \\\n              \
    \        /   '-----'    \\\n                     /   ^       ^    \\\n       \
    \             /32  |       | /32 '\n            ,-----.'     +       +      ,-----.\n\
    \          ,'       `.                 ,'       `.\n         / AS64502   \\  \
    \             / AS64503   \\\n        (             )-------------(          \
    \   )\n         \\           / /32       /32 \\           /\n          `.    \
    \   ,'  +->       /34  `.       ,'\n            '-----;              <-+ /  '-----'\n\
    \                   \\                /\n                 ^  \\              /\
    \    ^\n                 |   \\            /     |\n                 |    \\ \
    \         /      |\n                 |     \\ ,-----.'       |  2001:DB8::/32\n\
    \                 |     ,'       `.      |  2001:DB8::/34\n   2001:DB8::/32 +--+\
    \ / AS64501   \\  +--+\n                     (             )\n               \
    \       \\           /\n                       `.       ,'\n                 \
    \        '-----'\n   Figure 4: Unexpected Traffic Flows Due to Remote-Triggered\
    \ Filtering\n"
- title: 3.  Techniques to Detect Unexpected Traffic Flows Caused by Filtering of
  contents:
  - "3.  Techniques to Detect Unexpected Traffic Flows Caused by Filtering of\n  \
    \  More-Specific Prefixes\n"
- title: 3.1.  Existence of Unexpected Traffic Flows within an AS
  contents:
  - "3.1.  Existence of Unexpected Traffic Flows within an AS\n   To detect if unexpected\
    \ traffic flows are taking place in its\n   network, an ISP can monitor its traffic\
    \ data to check if it is\n   providing transit between two of its peers, although\
    \ its policy is\n   configured to not provide such transit.  IPFIX [RFC7011] is\
    \ an\n   example of a technology that can be used to export information\n   regarding\
    \ traffic flows across the network.  Traffic information must\n   be analyzed\
    \ under the perspective of the business relationships with\n   neighboring ASes\
    \ to detect the flows not fitting the policy.\n   Operators can use collection\
    \ systems that combine traffic statistics\n   with policy information for this\
    \ end.  See the pmacct project\n   [PMACCT] for an open-source application meeting\
    \ these requirements.\n   Note that the AS detecting the unexpected traffic flow\
    \ may simply\n   realize that its policy configuration is broken.  The first\n\
    \   recommended action upon detection of an unexpected traffic flow is to\n  \
    \ verify the correctness of the BGP configuration.\n   Once the local configuration\
    \ is confirmed correct, the operator\n   should check if the unexpected flow arose\
    \ due to filtering of BGP\n   paths for more-specific prefixes by neighboring\
    \ ASes.  This can be\n   performed in two steps.  First, the operator should check\
    \ whether the\n   neighboring AS originating the unexpected flow is forwarding\
    \ traffic\n   using a less-specific prefix that is announced to it by the affected\n\
    \   network.  The second step is to try to infer the reason why the\n   neighboring\
    \ AS does not use the more-specific path for forwarding,\n   i.e., finding why\
    \ the more-specific prefix was filtered.  Due to the\n   distributed nature and\
    \ restricted visibility of the steering of BGP\n   policies, this second step\
    \ does not identify the origin of the\n   problem with guaranteed accuracy.\n\
    \   For the first step, the operator should check if the destination\n   address\
    \ of the unexpected traffic flow is locally routed as per a\n   more-specific\
    \ prefix only received from noncustomer peers.  The\n   operator should also check\
    \ if there are paths to a less-specific\n   prefix received from a customer and\
    \ hence propagated to peers.  If\n   these two situations happen at the same time,\
    \ the neighboring AS at\n   the entry point of the unexpected flow is routing\
    \ the traffic based\n   on the less-specific prefix, although the ISP is actually\
    \ forwarding\n   the traffic via noncustomer links.\n   For the second step, one\
    \ can rely on human interaction or looking\n   glasses to find out whether local\
    \ filtering, remote filtering, or\n   selective propagation was performed on the\
    \ more-specific prefix.  No\n   openly available tools that can automatically\
    \ perform this operation\n   have been identified.\n"
- title: 3.2.  Contribution to the Existence of Unexpected Traffic Flows in
  contents:
  - "3.2.  Contribution to the Existence of Unexpected Traffic Flows in\n      Another\
    \ AS\n   It can be considered problematic to trigger unexpected traffic flows\n\
    \   in another AS.  It is thus advisable for an AS to assess the risks of\n  \
    \ filtering more-specific prefixes before implementing them by\n   obtaining as\
    \ much information as possible about its surrounding\n   routing environment.\n\
    \   There may be justifiable reasons for one ISP to perform filtering:\n   either\
    \ to enforce established policies or to provide prefix-\n   advertisement scoping\
    \ features to its customers.  These can vary from\n   troubleshooting purposes\
    \ to business-relationship implementations.\n   Restricting the use of these features\
    \ for the sake of avoiding the\n   creation of unexpected traffic flows is not\
    \ a practical option.\n   In order to assess the risk of filtering more-specific\
    \ prefixes, the\n   AS would need information on the routing policies and the\n\
    \   relationships among external ASes to detect if its actions could\n   trigger\
    \ the appearance of unexpected traffic flows.  With this\n   information, the\
    \ operator could detect other ASes receiving the more-\n   specific prefix from\
    \ noncustomer ASes while announcing the less-\n   specific prefix to other noncustomer\
    \ ASes.  If the filtering of the\n   more-specific prefix leads other ASes to\
    \ send traffic for the more-\n   specific prefix to these ASes, an unexpected\
    \ traffic flow can arise.\n   However, the information required for this operation\
    \ is difficult to\n   obtain since it is frequently considered confidential.\n"
- title: 4.  Techniques to Traffic Engineer Unexpected Flows
  contents:
  - "4.  Techniques to Traffic Engineer Unexpected Flows\n   Network operators can\
    \ adopt different approaches with respect to\n   unexpected traffic flows.  Note\
    \ that due to the complexity of inter-\n   domain routing policies, there is not\
    \ a single solution that can be\n   applied to all situations.  This section provides\
    \ potential solutions\n   that ISPs must evaluate against each particular case.\
    \  We classify\n   these actions according to whether they are proactive or reactive.\n\
    \   Reactive approaches are those in which the operator tries to detect\n   the\
    \ situations via monitoring and solve unexpected traffic flows\n   manually on\
    \ a case-by-case basis.\n   Anticipant or preventive approaches are those in which\
    \ the routing\n   system will not let the unexpected traffic flows actually take\
    \ place\n   when the scenario arises.\n   We use the scenario depicted in Figure\
    \ 5 to describe these two kinds\n   of approaches.  Since proactive approaches\
    \ can be complex to\n   implement and can lead to undesired effects, the reactive\
    \ approach is\n   the more reasonable recommendation to deal with unexpected flows.\n\
    \                         ____,,................______\n               _,.---''''\
    \                            `''---..._\n           ,-''   AS64505           \
    \                           `-.\n           [                                \
    \                      /\n            -.._                                   \
    \          __.-'\n             .  `'---....______                ______...---''\n\
    \           + |/32              `'''''''''''''''         |\n           | |/34\
    \               + |/32                  |\n           v |                  v |/34\
    \                  |\n             |                    |                   ^\
    \ |\n             |                  ^ |/32                | |/32\n          \
    \   |                  + |                   + |/34\n      _,,---.:_         \
    \      _,,---.._              _,,---.._\n    ,'         `.           ,'      \
    \   `.          ,'         `.\n   /  AS64504    \\     <-+ /  AS64502    \\  \
    \      /  AS64503    \\\n   |             |_________|             |        | \
    \            |\n   |             |     /32 |             |        |          \
    \   |\n   '.           ,'          .           ,'         .           ,'\n   \
    \  `.       ,'             `.       ,'            `.       ,'\n       ``---''\
    \                 ``---''                ``---''\n                           \
    \        |                  ^ |\n                                 ^ |2001:DB8::/32\
    \     | |2001:DB8::/32\n                                 | |                 \
    \ + |2001:DB8::/34\n                                 + | _....---------...._|\n\
    \                                  ,-'AS64501            ``-.\n              \
    \                  /'                          `.\n                          \
    \      `.                         _,\n                                  `-.._\
    \               _,,,'\n                                       `''---------'''\n\
    \        Figure 5: Traffic Engineering of Unexpected Traffic Flows -\n       \
    \                        Base Example\n"
- title: 4.1.  Reactive Traffic Engineering
  contents:
  - "4.1.  Reactive Traffic Engineering\n   An operator who detects unexpected traffic\
    \ flows originated by any of\n   the cases described in Section 2 can contact\
    \ the ASes that are likely\n   to have performed the propagation tweaks, inform\
    \ them of the\n   situation, and persuade them to change their behavior.\n   If\
    \ the situation remains, the operator can implement prefix filtering\n   in order\
    \ to stop the unexpected flows.  The operator can decide to\n   perform this action\
    \ over the session with the operator announcing the\n   more-specific prefix or\
    \ over the session with the neighboring AS from\n   which it is receiving the\
    \ traffic.  Each of these options carry a\n   different repercussion for the affected\
    \ AS.  We briefly describe the\n   two alternatives.\n   o  An operator can decide\
    \ to stop announcing the less-specific prefix\n      at the peering session with\
    \ the neighboring AS from which it is\n      receiving traffic to the more-specific\
    \ prefix.  In the example of\n      Figure 5, AS64502 would filter out the prefix\
    \ 2001:DB8::/32 from\n      the eBGP session with AS64504.  In this case, traffic\
    \ heading to\n      the prefix 2001:DB8::/32 from AS64501 would no longer traverse\n\
    \      AS64502.  AS64502 should evaluate if solving the issues originated\n  \
    \    by the unexpected traffic flows are worth the loss of this traffic\n    \
    \  share.\n   o  An operator can decide to filter out the more-specific prefix\
    \ at\n      the peering session over which it was received.  In the example of\n\
    \      Figure 5, AS64502 would filter out the incoming prefix\n      2001:DB8::/34\
    \ from the eBGP session with AS64505.  As a result,\n      the traffic destined\
    \ to that /32 would be forwarded by AS64502\n      along its link with AS64501,\
    \ despite the actions performed by\n      AS64501 to have this traffic coming\
    \ in through its link with\n      AS64503.  However, as AS64502 will no longer\
    \ know a route to the\n      more-specific prefix, it risks losing the traffic\
    \ share from\n      customers different from AS64501 to that prefix.  Furthermore,\n\
    \      this action can generate conflicts between AS64502 and AS64501,\n     \
    \ since AS64502 does not follow the routing information expressed by\n      AS64501\
    \ in its BGP announcements.\n   Note that it is possible that the behavior of\
    \ the neighboring AS\n   causing the unexpected traffic flows violates a contractual\
    \ agreement\n   between the two networks.\n"
- title: 4.2.  Proactive Measures
  contents:
  - '4.2.  Proactive Measures

    '
- title: 4.2.1.  Access Lists
  contents:
  - "4.2.1.  Access Lists\n   An operator could install access lists to prevent unexpected\
    \ traffic\n   flows from happening in the first place.  In the example of Figure\
    \ 5,\n   AS64502 would install an access list denying packets matching\n   2001:DB8::/34\
    \ associated with the interface connecting to AS64504.\n   As a result, traffic\
    \ destined to that prefix would be dropped despite\n   the existence of a valid\
    \ route towards 2001:DB8::/32.\n   The operational overhead of such a solution\
    \ is considered high, as\n   the operator would have to constantly adapt these\
    \ access lists to\n   accommodate inter-domain routing changes.  Moreover, this\
    \ technique\n   lets packets destined to a valid prefix be dropped while they\
    \ are\n   sent from a neighboring AS that may not know about the policy\n   conflict\
    \ and hence had no means to avoid the creation of unexpected\n   traffic flows.\
    \  For this reason, this technique can be considered\n   harmful.\n"
- title: 4.2.2.  Neighbor-Specific Forwarding
  contents:
  - "4.2.2.  Neighbor-Specific Forwarding\n   An operator can technically ensure that\
    \ traffic destined to a given\n   prefix will be forwarded from an entry point\
    \ of the network based\n   only on the set of paths that have been advertised\
    \ over that entry\n   point.\n   As an example, let us analyze the scenario of\
    \ Figure 5 from the point\n   of view of AS64502.  The edge router connecting\
    \ to the AS64504\n   forwards packets destined to prefix 2001:DB8::/34 towards\
    \ AS64505.\n   Likewise, it forwards packets destined to prefix 2001:DB8::/32\n\
    \   towards AS64501.  The router, however, only propagates the path of\n   the\
    \ less-specific prefix (2001:DB8::/32) to AS64504.  An operator\n   could implement\
    \ the necessary techniques to force the edge router to\n   forward packets coming\
    \ from AS64504 based only on the paths\n   propagated to AS64504.  Thus, the edge\
    \ router would forward packets\n   destined to 2001:DB8::/34 towards AS64501,\
    \ in which case no\n   unexpected traffic flow would occur.\n   Different techniques\
    \ could provide this functionality; however, their\n   technical implementation\
    \ can be complex to design and operate.  An\n   operator could, for instance,\
    \ employ VPN Routing and Forwarding (VRF)\n   tables [RFC4364] to store the routes\
    \ announced to a neighbor and\n   forward traffic exclusively based on those routes.\
    \  A presentation\n   from 2009 [on_BGP_RS_VPNs] describes the use of such an\
    \ architecture\n   for Internet routing and provides a description of its limitations.\n\
    \   In such architecture, packets received from a peer would be forwarded\n  \
    \ solely based on the paths that fit the path propagation policy for\n   that\
    \ peer and not based on the global routing table of the router.\n   As a result,\
    \ a more-specific path that would not be propagated to a\n   peer will not be\
    \ used to forward a packet from that peer, and the\n   unexpected flow will not\
    \ take place.  Packets will be forwarded based\n   on the policy-compliant, less-specific\
    \ prefix.  However, note that an\n   operator must make sure that all their routers\
    \ could support the\n   potential performance impact of this approach.\n   Note\
    \ that similar to the solution described in Section 4.1, this\n   approach could\
    \ create conflicts between AS64502 and AS64501, since\n   the traffic forwarding\
    \ performed by AS64502 goes against the policy\n   of AS64501.\n"
- title: 5.  Conclusions
  contents:
  - "5.  Conclusions\n   This document describes how filtering and selective propagation\
    \ of\n   more-specific prefixes can potentially create unexpected traffic\n  \
    \ flows across some ASes.  We provided examples of scenarios where\n   these practices\
    \ lead to unexpected traffic flows and introduce some\n   techniques for their\
    \ detection and prevention.  Although there are\n   reasonable situations in which\
    \ ASes could filter more-specific\n   prefixes, network operators are encouraged\
    \ to implement this type of\n   filter considering the cases described in this\
    \ document.  Operators\n   can implement monitoring systems to detect unexpected\
    \ traffic flows\n   and react to them according to their own policy.\n"
- title: 6.  Security Considerations
  contents:
  - "6.  Security Considerations\n   It is possible for an AS to use any of the methods\
    \ described in this\n   document to deliberately reroute traffic flowing through\
    \ another AS.\n   This document described the potential routing security issue\
    \ and\n   analyzed ways for operators to defend against it.\n   It must be noted\
    \ that, at the time of this document, there are no\n   existing or proposed tools\
    \ to automatically protect against such\n   behavior.  Operators can use network\
    \ monitoring and collection tools\n   to detect unexpected flows and deal with\
    \ them on a case-by-case\n   basis.\n"
- title: 7.  References
  contents:
  - '7.  References

    '
- title: 7.1.  Normative References
  contents:
  - "7.1.  Normative References\n   [RFC1812]  Baker, F., Ed., \"Requirements for\
    \ IP Version 4 Routers\",\n              RFC 1812, DOI 10.17487/RFC1812, June\
    \ 1995,\n              <http://www.rfc-editor.org/info/rfc1812>.\n   [RFC4364]\
    \  Rosen, E. and Y. Rekhter, \"BGP/MPLS IP Virtual Private\n              Networks\
    \ (VPNs)\", RFC 4364, DOI 10.17487/RFC4364, February\n              2006, <http://www.rfc-editor.org/info/rfc4364>.\n\
    \   [RFC4384]  Meyer, D., \"BGP Communities for Data Collection\", BCP 114,\n\
    \              RFC 4384, DOI 10.17487/RFC4384, February 2006,\n              <http://www.rfc-editor.org/info/rfc4384>.\n\
    \   [RFC7011]  Claise, B., Ed., Trammell, B., Ed., and P. Aitken,\n          \
    \    \"Specification of the IP Flow Information Export (IPFIX)\n             \
    \ Protocol for the Exchange of Flow Information\", STD 77,\n              RFC\
    \ 7011, DOI 10.17487/RFC7011, September 2013,\n              <http://www.rfc-editor.org/info/rfc7011>.\n"
- title: 7.2.  Informative References
  contents:
  - "7.2.  Informative References\n   [INIT7-RIPE63]\n              Kunzler, F., \"\
    How More Specifics increase your transit\n              bill (and ways to avoid\
    \ it)\", Reseaux IP Europeens\n              (RIPE) 63rd Meeting, October 2011,\n\
    \              <http://ripe63.ripe.net/presentations/48-How-more-\n          \
    \    specifics-increase-your-transit-bill-v0.2.pdf>.\n   [on_BGP_communities]\n\
    \              Donnet, B. and O. Bonaventure, \"On BGP Communities\", ACM\n  \
    \            SIGCOMM Computer Communication Review, Volume 38, Number\n      \
    \        2, pp. 55-59, DOI 10.1145/1355734.1355743, April 2008,\n            \
    \  <http://www.sigcomm.org/sites/default/files/ccr/\n              papers/2008/April/1355734-1355743.pdf>.\n\
    \   [on_BGP_RS_VPNs]\n              Vanbever, L., Francois, P., Bonaventure, O.,\
    \ and J.\n              Rexford, \"Customized BGP Route Selection Using BGP/MPLS\n\
    \              VPNs\", Cisco Systems, Routing Symposium, October 2009,\n     \
    \         <http://inl.info.ucl.ac.be/system/files/\n              Cisco_NAG_2009_ns_bgp.pdf>.\n\
    \   [PMACCT]   \"pmacct project: IP accounting iconoclasm\",\n              <http://www.pmacct.net>.\n"
- title: Acknowledgements
  contents:
  - "Acknowledgements\n   The authors would like to thank Wes George, Jon Mitchell,\
    \ Bruno\n   Decraene, and Job Snijders for their useful suggestions and comments.\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Camilo Cardona\n   IMDEA Networks/UC3M\n   Avenida del\
    \ Mar Mediterraneo, 22\n   Leganes  28919\n   Spain\n   Email: juancamilo.cardona@imdea.org\n\
    \   Pierre Francois\n   Cisco Systems\n   170 W. Tasman Drive\n   San Jose, CA\
    \  95134\n   United States\n   Email: pifranco@cisco.com\n   Paolo Lucente\n \
    \  Cisco Systems\n   170 W. Tasman Drive\n   San Jose, CA  95134\n   United States\n\
    \   Email: plucente@cisco.com\n"
