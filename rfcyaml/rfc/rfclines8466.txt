Abstract This document defines a YANG data model that can be used to configure
a Layer 2 provider provisioned VPN service.
It is up to a management system to take this as an input and generate specific configuration models to configure the different network elements to deliver the service.
How this configuration of network elements is done is out of scope for this document.
The YANG data model defined in this document includes support for point to point Virtual Private Wire Services (VPWSs) and multipoint Virtual Private LAN Services (VPLSs)
that use Pseudowires signaled using the Label Distribution Protocol (LDP) and the Border Gateway Protocol (BGP) as described in RFCs 4761 and 6624.
The YANG data model defined in this document conforms to the Network Management Datastore Architecture defined in RFC 8342.
This document defines a YANG data model for the Layer 2 VPN (L2VPN) service.
This model defines service configuration elements that can be used in communication protocols between customers and network operators.
Those elements can also be used as input to automated control and configuration applications and can generate specific configuration models to configure the different network elements to deliver the service.
How this configuration of network elements is done is out of scope for this document.
Further discussion of the way that services are modeled in YANG and the relationship between "customer service models" like the one described in this document and configuration models can be found in [RFC8309] and [RFC8199].
Sections 4 and 6 also provide more information on how this service model could be used and how it fits into the overall modeling architecture.
The YANG data model defined in this document includes support for point to point Virtual Private Wire Services (VPWSs) and multipoint Virtual Private LAN Services (VPLSs)
that use Pseudowires signaled using the Label Distribution Protocol (LDP) and the Border Gateway Protocol (BGP) as described in [RFC4761] and [RFC6624].
It also conforms to the Network Management Datastore Architecture (NMDA) [RFC8342].
The following terms are defined in [RFC6241] and are not redefined here:  client  configuration data  server  state data
The following terms are defined in [RFC7950] and are not redefined here:  augment  data model
The terminology for describing YANG data models is found in [RFC7950].
The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14
when, and only when, they appear in all capitals, as shown here.
Tree Diagrams Tree diagrams used in this document follow the notation defined in [RFC8340].
This document uses the following terms: Service Provider (SP):
The organization (usually a commercial undertaking) responsible for operating the network that offers VPN services to clients and customers.
Device:  Equipment that is dedicated to a particular customer and is directly connected to one or more PE devices via Attachment Circuits (ACs).
A CE is usually located at the customer premises and is usually dedicated to a single VPN, although it may support multiple VPNs if each one has separate ACs.
The CE devices can be routers, bridges, switches, or hosts.
Provider Edge (PE) Device:  Equipment managed by the SP that can support multiple VPNs for different customers and is directly connected to one or more CE devices via ACs.
A PE is usually located at an SP Point of Presence (POP) and is managed by the SP.
Virtual Private LAN Service (VPLS):
A VPLS is a provider service that emulates the full functionality of a traditional LAN.
A VPLS makes it possible to interconnect several LAN segments over a packet switched network (PSN) and makes the remote LAN segments behave as one single LAN.
Virtual Private Wire Service (VPWS):
A VPWS is a point to point circuit (i.e., link) connecting two CE devices.
The link is established as a logical Layer 2 circuit through a PSN.
The CE in the customer network is connected to a PE in the provider network via an AC: the AC is either a physical or logical circuit.
A VPWS differs from a VPLS in that the VPLS is point to multipoint while the VPWS is point to point.
In some implementations, a set of VPWSs is used to create a multi site L2VPN network.
A Pseudowire is an emulation of a native service over a PSN.
The native service may be ATM, Frame Relay, Ethernet, low rate Time Division Multiplexing (TDM), or Synchronous Optical Network / Synchronous Digital Hierarchy (SONET/SDH), while the PSN may be MPLS, IP (either IPv4 or IPv6), or Layer 2
Tunneling Protocol version 3 (L2TPv3).
MAC VRF:  A Virtual Routing and Forwarding table for Media Access Control (MAC) addresses on a PE.
It is sometimes also referred to as a Virtual Switching Instance (VSI).
UNI:  User to Network Interface.
The physical demarcation point between the customer's area of responsibility and the provider's area of responsibility.
NNI:  Network to Network Interface.
A reference point representing the boundary between two networks that are operated as separate administrative domains.
The two networks may belong to the same provider or to two different providers.
This document uses the following abbreviations: BSS:  Business Support System BUM:
Broadcast, Unknown Unicast, or Multicast CoS:
Class of Service LAG:  Link Aggregation Group LLDP:
Link Layer Discovery Protocol OAM:  Operations, Administration, and Maintenance OSS:  Operations Support System PDU:
Protocol Data Unit QoS:  Quality of Service 3.
The Layer 2 VPN Service Model A Layer 2 VPN (L2VPN) service is a collection of sites that are authorized to exchange traffic between each other over a shared infrastructure of a common technology.
The L2VPN Service Model (L2SM) described in this document provides a common understanding of how the corresponding L2VPN service is to be deployed over the shared infrastructure.
This document presents the L2SM using the YANG data modeling language [RFC7950] as a formal language that is both human readable and parsable by software for use with protocols such as the Network Configuration Protocol (NETCONF)
This service model is limited to VPWS
based VPNs and VPLS based VPNs as described in [RFC4761] and [RFC6624] and to Ethernet VPNs (EVPNs) as described in [RFC7432]
Layer 2 VPN Service Types From a technology perspective, a set of basic L2VPN service types include:  Point to point VPWSs that use
Pseudowires or L2TP signaled Pseudowires [RFC6074].
Multipoint VPLSs that use LDP signaled Pseudowires or L2TP signaled Pseudowires [RFC6074].
Multipoint VPLSs that use a BGP control plane as described in [RFC4761] and [RFC6624].
IP only LAN Services (IPLSs) that are a functional subset of VPLS services [RFC7436].
BGP MPLS based EVPN services as described in [RFC7432] and [RFC7209].
EVPN VPWSs as specified in [RFC8214].
Layer 2 VPN Physical Network Topology Figure 1 below depicts a typical SP's physical network topology.
Most SPs have deployed an IP, MPLS, or Segment Routing (SR)
Ingress Layer 2 service frames will be mapped to either an Ethernet Pseudowire (e.g., Pseudowire Emulation Edge to Edge (PWE3)) or a Virtual Extensible Local Area Network (VXLAN) PE to PE tunnel.
The details of these tunneling mechanisms are left to the provider's discretion and are not part of the L2SM.
An L2VPN provides end to end Layer 2 connectivity over this multi service core infrastructure between two or more customer locations or a collection of sites.
ACs are placed between CE devices and PE devices that backhaul Layer 2 service frames from the customer over the access network to the provider network or remote site.
The demarcation point (i.e., UNI) between the customer and the SP can be placed between either (1) customer nodes and the CE device or (2) the CE device and the PE device.
The actual bearer connection between the CE and the PE will be described in the L2SM.
The SP may also choose a "seamless MPLS" approach to expand the PWE3 or VXLAN tunnel between sites.
The SP may leverage Multiprotocol BGP (MP BGP) to autodiscover and signal the PWE3 or VXLAN tunnel endpoints.
Broadcast and multicast packets are sent to all participants in the same bridge domain.
Customer's View of the L2VPN 4.
The L2SM provides an abstracted interface to request, configure, and manage the components of an L2VPN service.
The model is used by a customer who purchases connectivity and other services from an SP to communicate with that SP.
A typical usage for this model is as an input to an orchestration layer that is responsible for translating it into configuration commands for the network elements that deliver/enable the service.
The network elements may be routers, but also servers (like Authentication, Authorization, and Accounting (AAA)) that are necessary within the network.
The configuration of network elements may be done using the Command Line Interface (CLI) or any other configuration (or "southbound") interface such as NETCONF [RFC6241] in combination with device  specific and protocol specific YANG data models.
This way of using the service model is illustrated in Figure 3 and is described in more detail in [RFC8309] and [RFC8199].
The split of the orchestration function between a "service orchestrator" and a "network orchestrator" is clarified in [RFC8309].
The usage of this service model is not limited to this example: it can be used by any component of the management system but not directly by network elements.
The usage and structure of this model should be compared to the Layer 3 VPN service model defined in [RFC8299].
Reference Architecture for the Use of the L2SM
The Metro Ethernet Forum (MEF)
[MEF 6] has also developed an architecture for network management and operations, but the work of the MEF embraces all aspects of lifecycle service orchestration, including billing, Service Level Agreements (SLAs), order management, and lifecycle management.
The IETF's work on service models is typically smaller and offers a simple, self contained service YANG module.
See [RFC8309] for more details.
Design of the Data Model
The L2SM is structured in a way that allows the provider to list multiple circuits of various service types for the same customer.
A circuit represents an end to end connection between two or more customer locations.
The YANG module is divided into two main containers: "vpn services" and "sites".
The "vpn svc" container under vpn services defines global parameters for the VPN service for a specific customer.
A site contains at least one network access
(i.e., site network accesses providing access to the sites, as defined in Section 5.3.2), and there may be multiple network accesses in the case of multihoming.
Site to network access attachment is done through a bearer with a Layer 2 connection on top.
The bearer refers to properties of the attachment that are below Layer 2, while the connection refers to Layer 2 protocol oriented properties.
The bearer may be allocated dynamically by the SP, and the customer may provide some constraints or parameters to drive the placement.
Authorization of traffic exchanges is done through what we call a VPN policy or VPN topology that defines routing exchange rules between sites.
End to end multi segment connectivity can be realized by using a combination of per site connectivity and per segment connectivity at different segments.
Figure 4 shows the overall structure of the YANG module:
string  rw site diversity {site diversity}?
rw vpn policy id    string
identityref  rw broadcast unknown unicast multicast {bum}?
rw mac loop prevention {mac loop prevention}?
date and time  ro actual site stop?
identityref  rw default ce vlan
rw site network accesses  rw site network access
d  rw access diversity {
rw oam 802.3ah link {oam 3ah}?
rw cfm 802.1 ag  [maid]
rw cos for cfm pdus?
identityref  rw broadcast unknown unicast multicast {bum}?
rw mac loop prevention {mac loop prevention}?
Overall Structure of the YANG Module 5.1.
The model defined in this document implements many features that allow implementations to be modular.
As an example, the Layer 2 protocol parameters (Section 5.3.2.2) proposed to the customer may also be enabled through features.
This model also defines some features for options that are more advanced, such as support for extranet VPNs (Section 5.2.4), site diversity (Section 5.3), and QoS (Section 5.10.2).
In addition, as for any YANG data model, this service model can be augmented to implement new behaviors or specific features.
For example, this model defines VXLAN [RFC7348] for Ethernet packet encapsulation; if VXLAN encapsulation does not fulfill all requirements for describing the service, new options can be added through augmentation.
The vpn service list item contains generic information about the VPN service.
id in the vpn service list refers to an internal reference for this VPN service.
This identifier is purely internal to the organization responsible for the VPN service.
The vpn service list is composed of the following characteristics: Customer information (customer name):  Used to identify the customer.
VPN service type (vpn svc type):  Used to indicate the VPN service type.
The identifier is an identity allowing any encoding for the local administration of the VPN service.
Note that another identity can be an extension of the base identity.
All sites in the L2VPN SHOULD be permitted to access the cloud by default.
The "cloud access" container provides parameters for authorization rules.
A cloud identifier is used to reference the target service.
This identifier is local to each administration.
Service topology (svc topo):  Used to identify the type of VPN service topology that is required.
Frame delivery service (frame delivery):  Defines the frame delivery support required for the L2VPN, e.g., multicast delivery, unicast delivery, or broadcast delivery.
Extranet VPN (extranet vpns):  Indicates that a particular VPN needs access to resources located in another VPN.
The "vpn svc type" parameter defines the service type for provider  provisioned L2VPNs.
The current version of the model supports six flavors:  Point to point VPWSs connecting two customer sites.
Point to point or point to multipoint VPWSs connecting a set of customer sites [RFC8214].
Multipoint VPLSs connecting a set of customer sites.
Multipoint VPLSs connecting one or more root sites and a set of leaf sites but preventing inter leaf site communication.
[RFC7432] connecting a set of customer sites.
EVPN VPWSs between two customer sites or a set of customer sites as specified in [RFC8214].
Other L2VPN service types could be included by augmentation.
Note that an Ethernet Private Line (EPL) service or an Ethernet Virtual Private Line (EVPL) service is an Ethernet Line
a point to point Ethernet Virtual Circuit (EVC) service, while an Ethernet Private LAN (EP LAN) service or an Ethernet Virtual Private LAN
(EVP LAN) service is an Ethernet LAN (E LAN) service [MEF 6] or a multipoint to multipoint EVC service.
The types of VPN service topologies discussed below can be used for configuration if needed.
The module described in this document currently supports any to any, Hub and Spoke (where Hubs can exchange traffic), and Hub and Spoke Disjoint (where Hubs cannot exchange traffic).
New topologies could be added by augmentation.
By default, the any to any VPN service topology is used.
Route Target Allocation A Layer 2 PE based VPN (such as a VPLS based VPN or an EVPN that uses BGP as its signaling protocol) can be built using Route Targets (RTs) as described in [RFC4364] and [RFC7432].
The management system is expected to automatically allocate a set of RTs upon receiving a VPN service creation request.
How the management system allocates RTs is out of scope for this document, but multiple ways could be envisaged, as described in Section 6.2.1.1 of [RFC8299].
Any to Any VPN Service Topology
In the any to any VPN service topology, all VPN sites can communicate with each other without any restrictions.
The management system that receives an any to any L2VPN service request through this model is expected to assign and then configure the MAC VRF and RTs on the appropriate PEs.
In the any to any case, a single RT is generally required, and every MAC VRF imports and exports this RT.
Hub and Spoke VPN Service Topology
In the Hub and Spoke VPN service topology,  all Spoke sites can communicate only with Hub sites (i.e., Spoke sites cannot communicate with each other).
Hubs can communicate with each other.
The management system that receives a Hub and Spoke L2VPN service request through this model is expected to assign and then configure the MAC VRF and RTs on the appropriate PEs.
In the Hub and Spoke case, two RTs are generally required (one RT for Hub routes and one RT for Spoke routes).
A Hub MAC VRF that connects Hub sites will export Hub routes with the Hub RT and will import Spoke routes through the Spoke RT.
It will also import the Hub RT to allow Hub to Hub communication.
A Spoke MAC VRF that connects Spoke sites will export Spoke routes with the Spoke RT and will import Hub routes through the Hub RT.
Hub and Spoke Disjoint VPN Service Topology
In the Hub and Spoke Disjoint VPN service topology,  all Spoke sites can communicate only with Hub sites (i.e., Spoke sites cannot communicate with each other).
Hubs cannot communicate with each other.
The management system that receives a Hub and Spoke Disjoint L2VPN service request through this model is expected to assign and then configure the VRF and RTs on the appropriate PEs.
In the Hub and Spoke Disjoint case, at least two RTs are required for Hubs and Spokes, respectively (at least one RT for Hub routes and at least one RT for Spoke routes).
A Hub VRF that connects Hub sites will export Hub routes with the Hub RT and will import Spoke routes through the Spoke RT.
A Spoke VRF that connects Spoke sites will export Spoke routes with the Spoke RT and will import Hub routes through the Hub RT.
The management system MUST take into account constraints on Hub and Spoke connections, as in the previous case.
Hub and Spoke Disjoint can also be seen as multiple Hub and Spoke VPNs (one per Hub) that share a common set of Spoke sites.
This model provides cloud access configuration through the cloud access container.
The usage of cloud access is targeted for public cloud access and Internet access.
The cloud access container provides parameters for authorization rules.
Note that this model considers that public cloud and public Internet access share some commonality
; therefore, it does not distinguish Internet access from cloud access.
If needed, a different label for Internet access could be added by augmentation.
Private cloud access may be addressed through the site container as described in Section 5.3, with usage consistent with sites of type "NNI".
A cloud identifier is used to reference the target service.
This identifier is local to each administration.
By default, all sites in the L2VPN SHOULD be permitted to access the cloud or the Internet.
If restrictions are required, a user MAY configure some limitations for some sites or nodes by using policies, i.e., the "permit site" or "deny site" leaf list.
The permit site leaf list defines the list of sites authorized for cloud access.
The deny site leaf list defines the list of sites denied for cloud access.
The model supports both "deny any except" and "permit any except" authorization.
How the restrictions will be configured on network elements is out of scope for this document.
Example of Cloud Access Configuration As shown in Figure 8, we configure the global VPN to access the Internet by creating a cloud access container pointing to the cloud identifier for the Internet service.
(This is illustrated in the XML [W3C.REC xml 20081126] below.)
No authorized sites will be configured, as all sites are required to be able to access the Internet.
yang:ietf l2vpn svc"> <vpn services> <vpn service
d> <cloud accesses> <cloud access> <cloud identifier>INTERNET</cloud
identifier> </cloud access> </cloud accesses> <ce vlan preservation
true</ce vlan preservation> <ce vlan cos preservation>
true</ce vlan cos preservation> </vpn service> </vpn services
If Site 1 and Site 2 require access to Cloud 1, a new cloud access container pointing to the cloud identifier of Cloud 1 will be created.
The permit site leaf list will be filled with a reference to Site 1 and Site 2. <?
yang:ietf l2vpn svc"> <vpn services> <vpn service
d> <cloud accesses> <cloud access
> <permit site>site1</permit site> <permit site>site2</permit site> </cloud access> </cloud accesses> <ce vlan preservation
true</ce vlan preservation> <ce vlan cos preservation>
true</ce vlan cos preservation> </vpn service> </vpn services
If all sites except Site 1 require access to Cloud 2, a new cloud access container pointing to the cloud identifier of Cloud 2 will be created.
The deny site leaf list will be filled with a reference to Site 1. <?
yang:ietf l2vpn svc"> <vpn services> <vpn service
d> <cloud accesses> <cloud access
>site1</deny site> </cloud access> </cloud accesses> <ce vlan preservation
true</ce vlan preservation> <ce vlan cos preservation>
true</ce vlan cos preservation> </vpn service> </vpn services> </l2vpn svc> 5.2.4.
There are some cases where a particular VPN needs access to resources (servers, hosts, etc.)
Those resources may be located in another VPN.
Example of Shared VPN Resources
As illustrated in Figure 9, VPN B has some resources on Site B that need to be made available to some customers/partners.
Specifically, VPN A must be able to access those VPN B resources.
Such a VPN connection scenario can be achieved via a VPN policy as defined in Section 5.5.2.2.
But there are some simple cases where a particular VPN (VPN A) needs access to all resources in another VPN (VPN B).
The model provides an easy way to set up this connection using the "extranet vpns" container.
The extranet vpns container defines a list of VPNs a particular VPN wants to access.
The extranet vpns container is used on customer VPNs accessing extranet resources in another VPN.
In Figure 9, in order to provide VPN A with access to VPN B, the extranet vpns container needs to be configured under VPN A with an entry corresponding to VPN B.
There is no service configuration requirement on VPN B. Readers
should note that even if there is no configuration requirement on VPN B, if VPN A lists VPN B as an extranet, all sites in VPN B will gain access to all sites in VPN A.
The "site role" leaf defines the role of the local VPN sites in the target extranet VPN service topology.
Site roles are defined in Section 5.4.
In the example below, VPN A accesses VPN B resources through an extranet connection.
A Spoke role is required for VPN A sites, as sites from VPN A must not be able to communicate with each other through the extranet VPN connection.
yang:ietf l2vpn svc"> <vpn services> <vpn service
>hub spoke</svc topo> <ce vlan preservation
true</ce vlan preservation> <ce vlan cos preservation>
> </vpn service> <vpn service
any to any</svc topo> <extranet vpns
<local sites role>spoke role</local sites role> </extranet vpn> </extranet vpns> <ce vlan preservation
true</ce vlan preservation> <ce vlan cos preservation>
true</ce vlan cos preservation> </vpn service> </vpn services
This model does not define how the extranet configuration will be achieved within the network.
Any VPN interconnection scenario that is more complex (e.g., only certain parts of sites on
VPN A accessing only certain parts of sites on VPN B) needs to be achieved using a VPN attachment as defined in Section 5.5.2 and, in particular, a VPN policy as defined in Section 5.5.2.2.
If a BUM (Broadcast, Unknown Unicast, or Multicast) frame delivery service is supported for an L2VPN, some global frame delivery parameters are required as input for the service request.
When a CE sends BUM packets, replication occurs at the ingress PE and three frame types need to be supported.
Users of this model will need to provide the flavors of trees that will be used by customers within the L2VPN (customer tree flavors).
The model defined in this document supports bidirectional, shared, and source based trees (and can be augmented to contain other tree types).
Multiple flavors of trees can be supported simultaneously.
BUM Frame Delivery Service Example Multicast group to port mappings can be created using the "rp group mappings" leaf.
Two group to port mapping methods are supported:  Static configuration of multicast Ethernet addresses and ports/interfaces.
A multicast control protocol based on Layer 2 technology that signals mappings of multicast addresses to ports/interfaces, such as the Generic Attribute Registration Protocol (GARP) / GARP Multicast Registration Protocol (GARP/GMRP)
A site represents a connection of a customer office to one or more VPN services.
Each site is associated with one or more locations.
Example: Customer Office and Two VPN Services
The provider uses the site container to store information regarding detailed implementation arrangements made with either the customer or peer operators at each interconnect location.
We restrict the L2SM to exterior interfaces (i.e., UNIs and NNIs) only, so all internal interfaces and the underlying topology are outside the scope of the L2SM.
Typically, the following characteristics of a site interface handoff need to be documented as part of the service design: Unique identifier (site id):  An arbitrary string to uniquely identify the site within the overall network infrastructure.
The format of "site id" is determined by the local administrator of the VPN service.
The customer can request one or more customer premises equipment entities from the SP for a particular site.
Management (management):  Defines the model of management for the site   for example, type, management transport, address.
This parameter determines the boundary between the SP and the customer, i.e., who has ownership of the CE device.
Allows easy retrieval of data about the nearest available resources.
Site diversity (site diversity):  Presents some parameters to support site diversity.
Site network accesses (site network accesses):
Defines the list of ports to the site and their properties   in particular, bearer, connection, and service parameters.
A site network access represents an Ethernet logical connection to a site.
A site may have multiple site network accesses.
Two Site Network Accesses for a Site Multiple site network accesses are used, for instance, in the case of multihoming.
Some other meshing cases may also include multiple site network accesses.
The site configuration is viewed as a global entity; we assume that it is mostly the management system's role to split the parameters between the different elements within the network.
For example, in the case of the site network access configuration, the management system needs to split the parameters between the PE configuration and the CE configuration.
The site may support single homed access or multihoming.
In the case of multihoming, the site can support multiple site network accesses.
Under each site network access, "vpn attachment" is defined; vpn attachment will describe the association between a given site network access and a given site, as well as the VPN to which that site will connect.
The information in the "location" sub container under a site container and in the "devices" container allows easy retrieval of data about the nearest available facilities and can be used for access topology planning.
It may also be used by other network orchestration components to choose the targeted upstream PE and downstream CE.
Location is expressed in terms of postal information.
More detailed information or other location information can be added by augmentation.
A site may be composed of multiple locations.
All the locations will need to be configured as part of the "locations" container and list.
A typical example of a multi location site is a headquarters office in a city, where the office is composed of multiple buildings.
Those buildings may be located in different parts of the city and may be linked by intra city fibers (a customer metropolitan area network).
This model does not represent connectivity between multiple locations of a site, because that connectivity is controlled by the customer.
In such a case, when connecting to a VPN service, the customer may ask for multihoming based on its distributed locations.
Two Site Network Accesses, Two Sites A customer may also request the use of some premises equipment entities (CEs) from the SP via the devices container.
Requesting a CE implies a provider managed or co managed model.
A particular device must be requested for a particular already configured location.
This would help the SP send the device to the appropriate postal address.
In a multi location site, a customer may, for example, request a CE for each location on the site where multihoming must be implemented.
In Figure 13, one device may be requested for the Manhattan location and one other for the Brooklyn location.
By using devices and locations, the user can influence the multihoming scenario they want to implement: single CE, dual CE, etc.
The L2SM includes a set of essential physical interface properties and Ethernet layer characteristics in the "site network accesses" container.
Some of these are critical implementation arrangements that require consent from both the customer and the provider.
As mentioned earlier, a site may be multihomed.
Each logical network access for a site is defined in the site network accesses container.
The site network access parameter defines how the site is connected on the network and is split into three main classes of parameters:  bearer:
defines requirements of the attachment (below Layer 2).
connection: defines Layer 2 protocol parameters of the attachment.
availability: defines the site's availability policy.
The availability parameters are defined in Section 5.8.
The site network access has a specific type (site network access type).
This document defines two types:  point to point: describes a point to point connection between the SP and the customer.
multipoint: describes a multipoint connection between the SP and the customer.
This site network access type may have an impact on the parameters offered to the customer, e.g., an SP might not offer MAC loop protection for multipoint accesses.
It is up to the provider to decide what parameters are supported for point to point
Multipoint accesses are out of scope for this document; some containers defined in the model may require extensions in order to work properly for multipoint accesses.
Bearer The "bearer" container defines the requirements for the site attachment (below Layer 2) to the provider network.
The bearer parameters will help to determine the access media to be used.
The "connection" container defines the Layer 2 protocol parameters of the attachment (e.g., vlan id or circuit id) and provides connectivity between customer Ethernet switches.
Depending on the management mode, it refers to PE CE LAN segment addressing or to CE to customer LAN segment addressing.
In any case, it describes the responsibility boundary between the provider and the customer.
For a customer managed site, it refers to the PE CE LAN segment connection.
For a provider managed site, it refers to the CE to customer LAN segment connection.
The "encapsulation type" parameter allows the user to select between Ethernet encapsulation (port based) or Ethernet VLAN encapsulation (VLAN based).
All of the allowed Ethernet interface types of service frames can be listed under "ether inf type", e.g., untagged interface, tagged interface, LAG interface.
Corresponding to "ether inf type", the connection container also presents three sets of link attributes: untagged interface, tagged interface, and optional LAG interface attributes.
These parameters are essential for the connection to be properly established between the CE devices and the PE devices.
The connection container also defines a Layer 2 Control Protocol (L2CP) attribute that allows control plane protocol interaction between the CE devices and the PE device.
For each untagged interface (untagged interface), there are basic configuration parameters like interface index and speed, interface MTU, auto negotiation and flow control settings, etc.
In addition, and based on mutual agreement, the customer and provider may decide to enable advanced features, such as LLDP, IEEE 802.3ah
[IEEE 802 3ah], or MAC loop detection/prevention at a UNI.
If loop avoidance is required, the attribute "uni loop prevention" must be set to "true".
If the tagged service is enabled on a logical unit on the connection at the interface, "encapsulation type" should be specified as the Ethernet VLAN encapsulation (if VLAN based) or VXLAN encapsulation, and "eth inf type" should be set to indicate a tagged interface.
In addition, "tagged interface type" should be specified in the "tagged interface" container to determine how tagging needs to be done.
The current model defines five ways to perform VLAN tagging:  priority tagged: SPs encapsulate and tag packets between the CE and the PE with the frame priority level.
dot1q vlan tagged: SPs encapsulate packets between the CE and the PE with one or a set of customer VLAN (CVLAN) IDs.
SPs encapsulate packets that enter their networks with multiple CVLAN IDs and a single VLAN tag with a single SP VLAN (SVLAN).
SPs encapsulate packets that enter their networks with unknown CVLANs and a single VLAN tag with a single SVLAN.
SPs encapsulate packets that enter their networks with a VXLAN Network Identifier (VNI) and a peer list.
The overall S tag for the Ethernet circuit and (if applicable)
C tag to SVC mapping
(where "SVC" stands for "Switched Virtual Circuit") have been placed in the "service" container.
For the qinq and qinany options, the S tag under "qinq" and "qinany" should match the S tag in the service container in most cases; however, VLAN translation is required for the S tag in certain deployments at the external facing interface or upstream PEs to "normalize" the outer VLAN tag to the service S tag into the network and translate back to the site's S tag in the opposite direction.
One example of this is with a Layer 2 aggregation switch along the path: the S tag for the SVC has been previously assigned to another service and thus cannot be used by this AC.
LAG Interface Sometimes, the customer may require multiple physical links bundled together to form a single, logical, point to point LAG connection to the SP.
Typically, the Link Aggregation Control Protocol (LACP) is used to dynamically manage adding or deleting member links of the aggregate group.
In general, a LAG allows for increased service bandwidth beyond the speed of a single physical link while providing graceful degradation as failure occurs, thus increasing availability.
In the L2SM, there is a set of attributes under "lag interface" related to link aggregation functionality.
The customer and provider first need to decide on whether LACP PDUs will be exchanged between the edge devices by specifying the "LACP state" as "on" or "off".
If LACP is to be enabled, then both parties need to further specify (1) whether LACP will be running in active or passive mode and (2)
the time interval and priority level of the LACP PDU.
The customer and provider can also determine the minimum aggregate bandwidth for a LAG to be considered as a valid path by specifying the optional "mini link num" attribute.
To enable fast detection of faulty links, micro BFD [RFC7130] ("BFD" stands for "Bidirectional Forwarding Detection") runs independent UDP sessions to monitor the status of each member link.
The customer and provider should agree on the BFD hello interval and hold time.
Each member link will be listed under the LAG interface with basic physical link properties.
Certain attributes, such as flow control, encapsulation type, allowed ingress Ethertype, and LLDP settings, are at the LAG level.
CVLAN ID to SVC Mapping
When more than one service is multiplexed onto the same interface, ingress service frames are conditionally transmitted through one of the L2VPN services based upon a pre arranged customer VLAN to SVC mapping.
Multiple CVLANs can be bundled across the same SVC.
The bundling type will determine how a group of CVLANs is bundled into one VPN service (i.e., VLAN bundling).
When applicable, "cvlan id to svc map"
contains the list of CVLANs that are mapped to the same service.
In most cases, this will be the VLAN access list for the inner 802.1Q tag [IEEE 802 1Q] (the C tag).
A VPN service can be set to preserve the CE VLAN ID and CE
VLAN CoS from the source site to the destination site.
This is required when the customer wants to use the VLAN header information between its two sites.
CE VLAN ID preservation and CE
VLAN CoS preservation are applied on each site network access within sites.
"Preservation" means that the value of the CE VLAN ID and/or CE VLAN CoS at the source site must be equal to the value at a destination site belonging to the same L2VPN service.
If all to one bundling is enabled (i.e., the bundling type is set to "all to one bundling"), then preservation applies to all ingress service frames.
If all to one bundling is disabled, then preservation applies to tagged ingress service frames having the CE VLAN ID.
The customer and the SP should arrange in advance whether or not to allow control plane protocol interaction between the CE devices and the PE device.
To provide seamless operation with multicast data transport, the transparent operation of Ethernet control protocols (e.g., the Spanning Tree Protocol (STP) [IEEE 802 1D]) can be employed by customers.
To support efficient dynamic transport, Ethernet multicast control frames (e.g., GARP/GMRP [IEEE 802 1D]) can be used between the CE and the PE.
However, solutions MUST NOT assume that all CEs are always running such protocols (typically in the case where a CE is a router and is not aware of Layer 2 details).
The destination MAC addresses of these L2CP PDUs fall within two reserved blocks specified by the IEEE 802.1 Working Group.
MAC addresses in these multicast ranges have special forwarding rules.
Bridge block of protocols: 01 80 C2 00 00 00 through 01 80 C2 00
00 0F  MRP block of protocols: 01 80 C2 00 00 20 through 01 80 C2 00 00
2F Layer 2 protocol tunneling allows SPs to pass subscriber Layer 2 control PDUs across the network without being interpreted and processed by intermediate network devices.
These L2CP PDUs are transparently encapsulated across the MPLS enabled core network in QinQ fashion.
The "L2CP control" container contains the list of commonly used L2CP protocols and parameters.
The SP can specify discard mode, peer mode, or tunnel mode actions for each individual protocol.
The advent of Ethernet as a wide area network technology brings the additional requirements of end to end service monitoring and fault management in the SP network, particularly in the area of service availability and Mean Time
Ethernet Service OAM in the L2SM refers to the combined protocol suites of IEEE 802.1ag
[IEEE 802 1ag] and ITU T Y.1731 [ITU T Y 1731].
Generally speaking, Ethernet Service OAM enables SPs to perform service continuity checks, fault isolation, and packet delay/jitter measurement at per customer and per site network access granularity.
The information collected from Ethernet Service OAM data sets is complementary to other higher layer IP/MPLS OSS tools to ensure that the required SLAs can be met.
The 802.1ag Connectivity Fault Management (CFM) functional model is structured with hierarchical Maintenance Domains (MDs), each assigned with a unique maintenance level.
Higher level MDs can be nested over lower level MDs.
However, the MDs cannot intersect.
The scope of each MD can be solely within a customer network or solely within the SP network.
An MD can interact between CEs and PEs (customer to  provider) or between PEs (provider to provider), or it can tunnel over another SP network.
Depending on the use case scenario, one or more Maintenance Entity Group End Points (MEPs) can be placed on the external facing interface, sending CFM PDUs towards the core network ("Up MEP") or downstream link ("Down MEP").
The "cfm 802.1 ag" sub container under "site network access" presents the CFM Maintenance Association (MA), i.e., Down MEP for the UNI MA.
For each MA, the user can define the Maintenance Association Identifier (MAID), MEP level, MEP direction, Remote MEP ID, CoS level of the CFM PDUs, Continuity Check Message (CCM) interval and hold time, alarm priority defect (i.e., the lowest priority defect that is allowed to generate a fault alarm), CCM priority type, etc.
ITU T Y.1731 Performance Monitoring (PM) provides essential network telemetry information that includes the measurement of Ethernet service frame delay, frame delay variation, frame loss, and frame throughput.
The delay/jitter measurement can be either one way or two way.
Typically, a Y.1731 PM probe sends a small amount of synthetic frames along with service frames to measure the SLA parameters.
The "y 1731" sub container under "site network access" contains a set of parameters to define the PM probe information, including MAID, local and Remote MEP ID, PM PDU type, message period and measurement interval, CoS level of the PM PDUs, loss measurement by synthetic or service frame options,
one way or two way delay measurement, PM frame size, and session type.
Site Roles A VPN has a particular service topology, as described in Section 5.2.2.
As a consequence, each site belonging to a VPN is assigned a particular role in this topology.
The site role leaf defines the role of the site in a particular VPN topology.
In the any to any VPN service topology, all sites MUST have the same role, which will be "any to any role".
In the Hub and Spoke VPN service topology or the Hub and Spoke  Disjoint VPN service topology, sites MUST have a Hub role or a Spoke role.
Site Belonging to Multiple VPNs 5.5.1.
A site may be part of one or more VPNs.
The "site vpn flavor" defines the way that the VPN multiplexing is done.
There are four possible types of external facing connections associated with an EVPN service and a site.
Therefore, the model supports four flavors:
site vpn flavor single: The site belongs to only one VPN.
The site belongs to multiple VPNs, and all the logical accesses of the sites belong to the same set of VPNs.
site vpn flavor nni: The site represents an NNI where two administrative domains belonging to the same or different providers interconnect.
site vpn flavor e2e: The site represents an end to end multi segment connection.
site vpn flavor single Figure 14
depicts a single VPN attachment.
The site connects to only one VPN.
shows a site connected to multiple VPNs.
Multi VPN Attachment In Figure 15, the New York office is multihomed.
Both logical accesses are using the same VPN attachment rules, and both are connected to VPN A and to
VPN B. Reaching VPN A or VPN B from the New York office will be done via MAC destination based forwarding.
Having the same destination reachable from the two VPNs may cause routing problems.
The customer administration's role in this case would be to ensure the appropriate mapping of its MAC addresses in each VPN.
See Sections 5.5.2 and 5.10.2 for more details.
See also Section 5.10.3 for details regarding support for BUM.
site vpn flavor nni A Network to Network Interface (NNI) scenario may be modeled using the sites container.
It is helpful for the SP to indicate that the requested VPN connection is not a regular site but rather is an NNI, as specific default device configuration parameters may be applied in the case of NNIs (e.g., Access Control Lists (ACLs), routing policies).
A NNI scenario that can be modeled using the sites container.
In order to connect its customer VPNs (VPN1 and VPN2) in SP B, SP A may request the creation of some site network accesses to SP B.
The site vpn flavor nni type will be used to inform SP B that this is an NNI and not a regular customer site.
An end to end (E2E) multi segment VPN connection to be constructed out of several connectivity segments may be modeled.
It is helpful for the SP to indicate that the requested VPN connection is not a regular site but rather is an end to end VPN connection, as specific default device configuration parameters may be applied in the case of site vpn flavor e2e (e.g., QoS configuration).
In order to establish a connection between Site 1 in SP A and Site 2 in SP B spanning multiple domains, SP A may request the creation of end to end connectivity to SP B.
The site vpn flavor e2e type will be used to indicate that this is an end to end connectivity setup and not a regular customer site.
Attaching a Site to a VPN
Due to the multiple site vpn flavors, the attachment of a site to an L2VPN is done at the site network access (logical access) level through the "vpn attachment" container.
The vpn attachment container is mandatory.
The model provides two ways to attach a site to a VPN:  By referencing the target VPN directly.
By referencing a VPN policy for attachments that are more complex.
These options allow the user to choose the flavor that provides the best fit.
Referencing a VPN Referencing a vpn id provides an easy way to attach a particular logical access to a VPN.
This is the best way in the case of a single VPN attachment.
, the site role setting must be added to express the role of the site in the target VPN service topology.
yang:ietf l2vpn svc"> <vpn services> <vpn service
true</ce vlan preservation> <ce vlan cos preservation>
> </vpn service> <vpn service
true</ce vlan preservation> <ce vlan cos preservation>
true</ce vlan cos preservation> </vpn service> </vpn services
> <sites> <site> <site id
> </locations> <management> <type>customer managed</type> </management
> <site network accesses> <site network access> <
> <service> <svc bandwidth> <bandwidth
bw per cos</type> <cir>450000000</cir> <cbs>20000000</cbs
> <eir>1000000000</eir> <ebs>200000000</ebs> </bandwidth> </svc bandwidth> <carrierscarrier
> <signaling type>bgp</signaling type> </carrierscarrier
> <svc mtu>1514</svc mtu> </service
> <site role>spoke role</site role> </vpn attachment> </site network access> <site network access> <
> <service> <svc bandwidth> <bandwidth
bw per cos</type> <cir>450000000</cir> <cbs>20000000</cbs
> <eir>1000000000</eir> <ebs>200000000</ebs> </bandwidth> </svc bandwidth> <carrierscarrier
> <signaling type>bgp</signaling type> </carrierscarrier
> <svc mtu>1514</svc mtu> </service
> <site role>spoke role</site role> </vpn attachment> </site network access
> </site network accesses> </site> </sites> </l2vpn svc
The example above describes a multi VPN case where a site (SITE 1) has two logical accesses (LA1 and LA2), attached to both VPNA and VPNB.
The "vpn policy" list helps express a multi VPN scenario where a logical access belongs to multiple VPNs.
As a site can belong to multiple VPNs, the vpn policy list may be composed of multiple entries.
A filter can be applied to specify that only some LANs at the site should be part of a particular VPN.
A site can be composed of multiple LAN segments, and each LAN segment can be connected to a different VPN.
Each time a site (or LAN) is attached to a VPN, the user must precisely describe its role (site role) within the target VPN service topology.
In Figure 17, Site 5 is part of two VPNs: VPN3 and VPN2.
It will play a Hub role in VPN2 and an any to any role in VPN3.
We can express such a multi VPN scenario as follows: <?
yang:ietf l2vpn svc"> <vpn services> <vpn service
true</ce vlan preservation> <ce vlan cos preservation>
> </vpn service> <vpn service
true</ce vlan preservation> <ce vlan cos preservation>
true</ce vlan cos preservation> </vpn service> </vpn services
> </locations> <management> <type>customer managed</type> </management
<vpn policies> <vpn policy> <vpn
id> <site role>any to any role</site role
> </vpn> </entries> </vpn policy> </vpn policies
> <site network accesses> <site network access> <
> </locations> <management> <type>customer managed</type> </management
> <site network accesses> <site network access> <
> <service> <svc bandwidth> <bandwidth
bw per cos</type> <cir>450000000</cir> <cbs>20000000</cbs
> <eir>1000000000</eir> <ebs>200000000</ebs> </bandwidth> </svc bandwidth> <carrierscarrier
> <signaling type>bgp</signaling type> </carrierscarrier
> <svc mtu>1514</svc mtu> </service
> <site role>spoke role</site role> </vpn attachment> </site network access> <site network access> <
> <service> <svc bandwidth> <bandwidth
bw per cos</type> <cir>450000000</cir> <cbs>20000000</cbs
> <eir>1000000000</eir> <ebs>200000000</ebs> </bandwidth> </svc bandwidth> <carrierscarrier
> <signaling type>bgp</signaling type> </carrierscarrier
> <svc mtu>1514</svc mtu> </service
> <site role>spoke role</site role> </vpn attachment> </site network access
> </site network accesses> </site> <vpn attachment> <
id> </vpn attachment> </site network access
> </site network accesses> </site> </sites> </l2vpn svc
Now, if a more granular VPN attachment is necessary, filtering can be used.
For example, if LAN1 from Site 5 must be attached to VPN2 as a Hub and LAN2 must be attached to VPN3, the following configuration can be used: <?
yang:ietf l2vpn svc"> <vpn services> <vpn service
true</ce vlan preservation> <ce vlan cos preservation>
> </vpn service> <vpn service
true</ce vlan preservation> <ce vlan cos preservation>
true</ce vlan cos preservation> </vpn service> </vpn services
> </locations> <management> <type>customer managed</type> </management
<vpn policies> <vpn policy> <vpn
id> <site role>any to any role</site role
> </vpn> </entries> </vpn policy> </vpn policies
> <site network accesses> <site network access> <
> <service> <svc bandwidth> <bandwidth
bw per cos</type> <cir>450000000</cir> <cbs>20000000</cbs
> <eir>1000000000</eir> <ebs>200000000</ebs> </bandwidth> </svc bandwidth> <carrierscarrier
> <signaling type>bgp</signaling type> </carrierscarrier
> <svc mtu>1514</svc mtu> </service
id> </vpn attachment> </site network access
> </site network accesses> </site> </sites> </l2vpn svc> 5.6.
Deciding Where to Connect the Site
The management system will have to determine where to connect each site network access of a particular site to the provider network (e.g., PE or aggregation switch).
This model defines parameters and constraints that can influence the meshing of the site network access.
The management system MUST honor all customer constraints, or, if a constraint is too strict and cannot be fulfilled, the management system MUST NOT provision the site and MUST provide the user with information regarding any constraints that could not be fulfilled.
How this information is provided is out of scope for this document.
Whether or not to relax the constraint would then be left up to the user.
Parameters such as site location (see Section 5.6.2) and access type (see Section 5.6.3) affect the service placement that the management system applies.
In addition to parameters and constraints, the management system's decision MAY be based on any other internal constraints that are left up to the SP, e.g., least load, distance.
In the case of provider management or co management, one or more devices have been ordered by the customer to a particular location that has already been configured.
The customer may force a particular site network access to be connected on a particular device that it ordered.
Example of a Constraint Applied to a Device In Figure 18, site network access#1 is associated with CE1 in the service request.
The SP must ensure the provisioning of this connection.
The location information provided in this model MAY be used by a management system to determine the target PE to mesh the site (SP side).
A particular location must be associated with each site network access when configuring it.
The SP MUST honor the termination of the access on the location associated with the site network access (customer side).
The "country code" in the site location should be expressed as an ISO 3166 code and is similar to the "country" label defined in [RFC4119].
The site network access location is determined by the "location flavor".
In the case of a provider managed or co managed site, the user is expected to configure a "device reference" (device case) that will bind the site network access to a particular device that the customer ordered.
As each device is already associated with a particular location, in such a case the location information is retrieved from the device location.
In the case of a customer managed site, the user is expected to configure a "location reference" (location case); this provides a reference to an existing configured location and will help with placement.
In Figure 19, Site 1 is a customer managed site with a location "L1", while Site 2 is a provider managed site for which a CE (CE#1) was ordered.
Site 2 is configured with "L2" as its location.
When configuring a site network access for Site 1, the user will need to reference location L1 so that the management system will know that the access will need to terminate on this location.
Then, for distance reasons, this management system may mesh Site 1 on a PE in the Philadelphia POP.
It may also take into account resources available on PEs to determine the exact target PE (e.g., least loaded).
For Site 2, the user is expected to configure the site network access with a device reference to CE#1 so that the management system will know that the access must terminate on the location of CE#1 and must be connected to CE#1.
For placement of the SP side of the access connection, in the case of the nearest PE used, it may mesh Site 2 on the Washington POP.
The management system needs to elect the access media to connect the site to the customer (for example, xDSL, leased line, Ethernet backhaul).
The customer may provide some parameters/constraints that will provide hints to the management system.
The bearer container information SHOULD be the first piece of information considered when making this decision:  The "requested type" parameter provides information about the media type that the customer would like to use.
If the "strict" leaf is equal to "true", this MUST be considered a strict constraint so that the management system cannot connect the site with another media type.
If the "strict" leaf is equal to "false" (default) and if the requested media type cannot be fulfilled, the management system can select another media type.
The supported media types SHOULD be communicated by the SP to the customer via a mechanism that is out of scope for this document.
The "always on" leaf defines a strict constraint: if set to "true", the management system MUST elect a media type that is "always on" (e.g., this means no dial in access type).
The "bearer reference" parameter is used in cases where the customer has already ordered a network connection to the SP apart from the L2VPN site and wants to reuse this connection.
The string used is an internal reference from the SP and describes the already available connection.
This is also a strict requirement that cannot be relaxed.
How the reference is given to the customer is out of scope for this document, but as an example, when the customer ordered the bearer (through a process that is out of scope for this model), the SP may have provided the bearer reference that can be used for provisioning services on top.
Any other internal parameters from the SP can also be used.
The management system MAY use other parameters, such as the requested "input svc bandwidth" and "output svc bandwidth", to help decide which access type to use.
Each site network access may have one or more constraints that would drive the placement of the access.
By default, the model assumes that there are no constraints, but allocation of a unique bearer per site network access is expected.
In order to help with the different placement scenarios, a site network access may be tagged using one or multiple group identifiers.
The group identifier is a string, so it can accommodate both explicit naming of a group of sites (e.g., "multihomed set1") and the use of a numbered identifier (e.g., 12345678).
The meaning of each group id is local to each customer administrator, and the management system MUST ensure that different customers can use the same group ids.
One or more group ids can also be defined at the site level; as a consequence, all site network accesses under the site MUST inherit the group ids of the site to which they belong.
When, in addition to the site group ids
some group ids are defined at the site network access level, the management system MUST consider the union of all groups (site level and site network access level) for this particular site network access.
For an already configured site network access, each constraint MUST be expressed against a targeted set of site network accesses.
This site network access (i.e., the already configured site network access) MUST never be taken into account in the targeted set of site network accesses   for example, "
My site network access S must not be connected on the same POP as the site network accesses that are part of Group 10.
The set of site network accesses against which the constraint is evaluated can be expressed as a list of groups, "all other accesses", or "all other groups".
The all other accesses option means that the current site network access constraint MUST be evaluated against all the other site network accesses belonging to the current site.
The all other groups option means that the constraint MUST be evaluated against all groups to which the current site network access does not belong.
The current model defines multiple constraint types:
pe diverse: The current site network access MUST NOT be connected to the same PE as the targeted site network accesses.
pop diverse: The current site network access MUST NOT be connected to the same POP as the targeted site network accesses.
linecard diverse: The current site network access MUST NOT be connected to the same linecard as the targeted site network  accesses.
Note that the customer can request linecard diverse for site network accesses, but the specific linecard identifier used should not be exposed to the customer.
bearer diverse: The current site network access MUST NOT use common bearer components compared to bearers used by the targeted site network accesses.
"bearer diverse" provides some level of diversity at the access level.
As an example, two bearer diverse site network accesses must not use the same Digital Subscriber Line Access Multiplexer (DSLAM), Broadband Access Switch (BAS), or Layer 2 switch.
The current site network access MUST be connected to the same PE as the targeted site network accesses.
same bearer: The current site network access MUST be connected using the same bearer as the targeted site network accesses.
These constraint types can be extended through augmentation.
Each constraint is expressed as "The site network access S must be <constraint type
(e.g., pe diverse, pop diverse) from these <target> site network accesses.
The group id used to target some site network accesses may be the same as the one used by the current site network access.
This eases the configuration of scenarios where a group of site network access points has a constraint between the access points in the group.
Route Distinguisher and Network Instance Allocation
The Route Distinguisher (RD) is a critical parameter of BGP based L2VPNs as described in [RFC4364] that provides the ability to distinguish common addressing plans in different VPNs.
As for Route Targets (RTs), a management system is expected to allocate a MAC VRF on the target PE and an RD for that MAC VRF; that RD MUST be unique across all MAC VRFs on the target PE.
If a MAC VRF already exists on the target PE and the MAC VRF fulfills the connectivity constraints for the site, there is no need to recreate another MAC VRF, and the site MAY be meshed within the existing MAC VRF.
How the management system checks to see if an existing MAC VRF fulfills the connectivity constraints for a site is out of scope for this document.
If no such MAC VRF exists on the target PE, the management system has to initiate the creation of a new MAC VRF on the target PE and has to allocate a new RD for the new MAC VRF.
The management system MAY apply a per VPN or per MAC VRF allocation policy for the RD, depending on the SP's policy.
In a per VPN allocation policy, all MAC VRFs (dispatched on multiple PEs) within a VPN will share the same RD value.
In a per MAC VRF model, all MAC VRFs should always have a unique RD value.
Some other allocation policies are also possible, and this document does not restrict the allocation policies to be used.
The allocation of RDs MAY be done in the same way as RTs.
The information provided in Section 5.2.2.1 could also be used in this scenario.
Note that an SP MAY configure a target PE for an automated allocation of RDs.
In this case, there will be no need for any backend system to allocate an RD value.
A site may be multihomed, meaning that it has multiple site network access points.
The placement constraints defined in Section 5.6 will help ensure physical diversity.
When the site network accesses are placed on the network, a customer may want to use a particular routing policy on those accesses.
The "site network access/availability" container defines parameters for site redundancy.
The "access priority" leaf defines a preference for a particular access.
This preference is used to model load balancing or primary/backup scenarios.
The higher the access priority value, the higher the preference will be.
The "redundancy mode" attribute is defined for a multihoming site and used to model single active and active/active scenarios.
It allows for multiple active paths in forwarding state and for load balancing options.
Figure 20 illustrates how the access priority attribute can be used.
In Figure 20, Hub#2 requires load sharing, so all the site network  accesses must use the same access priority value.
On the other hand, as Hub#1 requires a primary site network access and a backup site network access, a higher access priority setting will be configured on the primary site network access.
Scenarios that are more complex can also be modeled.
Let's consider a Hub site with five accesses to the network (A1, A2, A3, A4, and A5).
The customer wants to load share its traffic on A1 and A2 in the nominal situation.
If A1 and A2 fail, the customer wants to load share its traffic on A3 and A4; finally, if A1, A2, A3, and A4 are all down, the customer wants to use A5.
We can model this easily by configuring the following access priority values: A1 100, A2 100, A3 50, A4 50, A5 10.
The access priority scenario has some limitations.
An access priority scenario like the previous one with five accesses but with the constraint of having traffic load shared between A3 and A4 in the case where only A1 or A2 (not both) is down is not achievable.
But the access priority attribute defined will cover most of the deployment use cases, and if necessary the model can be extended via augmentation to support additional use cases.
The MTU of subscriber service frames can be derived from the physical interface MTU by default, or it can be specified under the "svc mtu" leaf if it is different than the default number.
The service container defines service parameters associated with the site.
The service bandwidth refers to the bandwidth requirement between the CE and the PE and can be represented using the Committed Information Rate (CIR), the Excess Information Rate (EIR), or the Peak Information Rate (PIR).
The requested bandwidth is expressed as ingress bandwidth and egress bandwidth.
The ingress or egress direction uses the customer site as the point of reference: "ingress direction bandwidth" refers to download bandwidth for the site, and "egress direction bandwidth" refers to upload bandwidth for the site.
The service bandwidth is only configurable at the site network access level (i.e., for the site network access associated with the site).
Using a different ingress and egress bandwidth will allow an SP to know if a customer allows for asymmetric bandwidth access like ADSL.
It can also be used to set the rate limit in a different way for uploads and downloads on symmetric bandwidth access.
The svc bandwidth parameter has a specific type.
This document defines four types:  bw per access: bandwidth is per connection or site network access, providing rate enforcement for all service frames at the interface that are associated with a particular network access.
bw per cos: bandwidth is per CoS, providing rate enforcement for all service frames for a given CoS with a specific cos id.
bw per svc: bandwidth is per site, providing rate enforcement for all service frames that are associated with a particular VPN service.
opaque bandwidth is the total bandwidth that is not associated with any particular cos id, VPN service identified with the vpn id, or site network access ID.
The svc bandwidth parameter must include a "cos id" parameter if the "type" is set to "bw per cos".
The cos id can be assigned based on either (1)
the IEEE 802.1p value [IEEE 802 1D] in the C tag or (2)
the Differentiated Services Code Point (DSCP) in the Ethernet frame header.
Service frames are metered against the bandwidth profile based on the cos id.
The svc bandwidth parameter must be associated with a specific "site network access id" parameter if the "type" is set to "bw per access".
Multiple bandwidths per cos id can be associated with the same site network access.
The svc bandwidth parameter must include a specific "vpn id" parameter if the "type" is set to "bw per svc".
Multiple bandwidths per cos id can be associated with the same EVPN service.
The model defines QoS parameters as an abstraction:  qos classification policy
: Defines a set of ordered rules to classify customer traffic.
qos profile: Provides a QoS scheduling profile to be applied.
QoS Classification QoS classification rules are handled by "qos classification policy".
qos classification policy is an ordered list of rules that match a flow or application and set the appropriate target CoS (target class id).
The user can define the match using a more specific flow definition (based on Layer 2 source and destination MAC addresses, cos, dscp, cos id, color id, etc.).
A "color id" will be assigned to a service frame to identify its QoS profile conformance.
A service frame is "green" if it is conformant with the "committed" rate of the bandwidth profile.
A service frame is "yellow" if it exceeds the "committed" rate but is conformant with the "excess" rate of the bandwidth profile.
Finally, a service frame is "red" if it is conformant with neither the "committed" rate nor the "excess" rate of the bandwidth profile.
When a flow definition is used, the user can use a target sites leaf list to identify the destination of a flow rather than using destination addresses.
In such a case, an association between the site abstraction and the MAC addresses used by this site must be done dynamically.
How this association is done is out of scope for this document.
The association of a site to an L2VPN is done through the vpn attachment container.
Therefore, the user can also employ the "target sites" leaf list and "vpn attachment" to identify the destination of a flow targeted to a specific VPN service.
A rule that does not have a "match" statement is considered a "match all" rule.
An SP may implement a default terminal classification rule if the customer does not provide it.
It will be up to the SP to determine its default target class.
This model defines some applications, but new application identities may be added through augmentation.
The exact meaning of each application identity is up to the SP, so it will be necessary for the SP to advise the customer on the usage of application matching.
A user can choose between the standard profile provided by the operator or a custom profile.
The QoS profile ("qos profile") defines the traffic scheduling policy to be used by the SP.
A custom QoS profile is defined as a list of CoS entries and associated properties.
The properties are as follows:  direction: Used to specify the direction to which the qos profile setting is applied.
This model supports the site to WAN direction ("site to wan"), the WAN to site direction ("wan to site"), and both directions ("bidirectional").
By default, "bidirectional" is used.
In the case of both directions, the provider should ensure scheduling according to the requested policy in both traffic directions (SP to customer and customer to SP).
As an example, a device scheduling policy may be implemented on both the PE side and the CE side of the WAN link.
In the case of the WAN to site direction, the provider should ensure scheduling from the SP network to the customer site.
As an example, a device scheduling policy may be implemented only on the PE side of the WAN link towards the customer.
Indicates whether policing should apply to one rate, two color or to two rate, three color.
Indicates how many bytes in the service frame header are excluded from rate enforcement.
frame delay: Used to define the latency constraint of the class.
The latency constraint can be expressed as the lowest possible latency or as a latency boundary expressed in milliseconds.
How this latency constraint will be fulfilled is up to the SP implementation: a strict priority queuing mechanism may be used on the access and in the core network, or a low latency routing path may be created for this traffic class.
Used to define the jitter constraint of the class.
The jitter constraint can be expressed as the lowest possible jitter or as a jitter boundary expressed in microseconds.
How this jitter constraint will be fulfilled is up to the SP implementation: a strict priority queuing mechanism may be used on the access and in the core network, or a jitter aware routing path may be created for this traffic class.
bandwidth: Used to define a guaranteed amount of bandwidth for the CoS.
It is expressed as a percentage.
The "guaranteed bw percent" parameter uses available bandwidth as a reference.
The available bandwidth should not fall below the CIR value defined under the input svc bandwidth or the output svc bandwidth.
When the "qos profile" container is implemented on the CE side, the output svc bandwidth is taken into account as a reference.
When it is implemented on the PE side, the input svc bandwidth is used.
By default, the bandwidth reservation is only guaranteed at the access level.
The user can use the "end to end" leaf to request an end to end bandwidth reservation, including across the MPLS transport network.
(In other words, the SP will activate something in the MPLS core to ensure that the bandwidth request from the customer will be fulfilled by the MPLS core as well.)
How this is done (e.g., RSVP TE reservation, controller reservation) is out of scope for this document.
In addition, due to network conditions, some constraints may not be completely fulfilled by the SP; in this case, the SP should advise the customer about the limitations.
How this communication is done is out of scope for this document.
The "broadcast unknown unicast multicast" container defines the type of site in the customer multicast service topology: source, receiver, or both.
These parameters will help the management system optimize the multicast service.
Multiple multicast group to port mappings can be created using the "multicast gp address mapping" list.
The "multicast gp address mapping" list defines the multicast group address and port LAG number.
Those parameters will help the SP select the appropriate association between an interface and a multicast group to fulfill the customer service requirement.
To ensure that a given frame is transparently transported, a whole Layer 2 multicast frame (whether for data or control) should not be altered from a CE to other CEs, except for the VLAN ID field.
VLAN IDs assigned by the SP can also be altered.
For point to point services, the provider only needs to deliver a single copy of each service frame to the remote PE, regardless of whether the destination MAC address of the incoming frame is unicast, multicast, or broadcast.
Therefore, all service frames should be delivered unconditionally.
BUM frame forwarding in multipoint to multipoint services, on the other hand, involves both local flooding to other ACs on the same PE and remote replication to all other PEs, thus consuming additional resources and core bandwidth.
Special BUM frame disposition rules can be implemented at external facing interfaces (UNIs or External NNIs (E NNIs)) to rate limit the BUM frames, in terms of the number of packets per second or bits per second.
The threshold can apply to all BUM traffic, or one threshold can be applied for each category of traffic.
The "management" sub container is intended for site management options, depending on device ownership and security access control.
Three common management models are as follows:
The provider has sole ownership of the CE device.
Only the provider has access to the CE.
The responsibility boundary between the SP and the customer is between the CE and the customer network.
This is the most common use case.
The customer has sole ownership of the CE device.
Only the customer has access to the CE.
In this model, the responsibility boundary between the SP and the customer is between the PE and the CE.
The provider has ownership of the CE device and is responsible for managing the CE.
However, the provider grants the customer access to the CE for some configuration/monitoring purposes.
In this co managed mode, the responsibility boundary is the same as for the provider managed model.
The selected management mode is specified under the "type" leaf.
The "address" leaf stores CE device management addressing information.
The "management transport" leaf is used to identify the transport protocol for management traffic: IPv4 or IPv6.
Additional security options may be derived based on the particular management model selected.
MAC Loop Protection MAC address flapping between different physical ports typically indicates a bridge loop condition in the customer network.
Misleading entries in the MAC cache table can cause service frames to circulate around the network indefinitely and saturate the links throughout the provider's network, affecting other services in the same network.
In the case of EVPNs, it also introduces massive BGP updates and control plane instability.
The SP may opt to implement a switching loop prevention mechanism at the external facing interfaces for multipoint to multipoint services by imposing a MAC address move threshold.
rate and prevention type options are listed in the "mac loop prevention" container.
The optional "mac addr limit" container contains the customer MAC address limit and information that describes the action taken when the limit is exceeded and the aging time for a MAC address.
When multiple services are provided on the same network element, the MAC address table (and the Routing Information Base space for MAC routes in the case of EVPNs) is a shared common resource.
SPs may impose a maximum number of MAC addresses learned from the customer for a single service instance by using the "mac addr limit" leaf and may use the "action" leaf to specify the action taken when the upper limit is exceeded: drop the packet, flood the packet, or simply send a warning log message.
For point to point services, if MAC learning is disabled, then the MAC address limit is not necessary.
In the case of Carriers' Carriers (CsC)
[RFC8299], a customer may want to build an MPLS service using an L2VPN to carry its traffic.
Provider backbone PE2 (vrf ISP1)
Service Using an L2VPN to Carry Traffic
In Figure 21, ISP1 resells an L2VPN service but has no core network infrastructure between its POPs.
ISP1 uses an L2VPN as the core network infrastructure (belonging to another provider) between its POPs.
In order to support CsC, the VPN service must indicate MPLS support by setting the "carrierscarrier" leaf to "true" in the vpn service list.
The link between CE1 ISP1/PE1 and CE2 ISP1/PE2 must also run an MPLS signaling protocol.
This configuration is done at the site level.
In this model, LDP or BGP can be used as the MPLS signaling protocol.
In the case of LDP, an IGP routing protocol MUST also be activated.
In the case of BGP signaling, BGP MUST also be configured as the routing protocol.
If CsC is enabled, the requested "svc mtu" leaf will refer to the MPLS MTU and not to the link MTU.
Defining NNIs and Inter AS Support An Autonomous System (AS) is a single network or group of networks that are controlled by a common system administration group and that use a single, clearly defined routing protocol.
In some cases, VPNs need to span different ASes in different geographical areas or span different SPs.
The connection between ASes is established by the SPs and is seamless to the customer.
Examples include:  A partnership between SPs (e.g., carrier, cloud) to extend their VPN services seamlessly.
An internal administrative boundary within a single SP (e.g., backhaul versus core versus data center).
NNIs have to be defined to extend the VPNs across multiple ASes.
[RFC4761] defines multiple flavors of VPN NNI implementations (e.g., VPLSs).
Each implementation has pros and cons; this topic is outside the scope of this document.
For example, in an inter AS option A (two ASes), AS Border Router (ASBR) peers are connected by multiple interfaces with at least one of those interfaces spanning the two ASes while being present in the same VPN.
In order for these ASBRs to signal label blocks, they associate each interface with a MAC VRF (VSI) (Section 2) and a BGP session.
As a result, traffic between devices in the back to back VPLS is Ethernet.
In this scenario, the VPNs are isolated from each other, and because the traffic is Ethernet, QoS mechanisms that operate on Ethernet traffic can be applied to achieve customer SLAs.
SP Network with Several NNIs Figure 22 illustrates an SP network called "My network" that has several NNIs.
This network uses NNIs to:
increase its footprint by relying on L2VPN partners.
connect its own data center services to the customer L2VPN.
enable the customer to access its private resources located in a private cloud owned by some CSPs.
Defining an NNI with the Option
NNI Defined with the Option
In option A, the two ASes are connected to each other with physical links on ASBRs.
For resiliency purposes, there may be multiple physical connections between the ASes.
A VPN connection   physical or logical (on top of physical)   is created for each VPN that needs to cross the AS boundary, thus providing a back to back VPLS model.
From a service model's perspective, this VPN connection can be seen as a site.
Let's say that AS B wants to extend some VPN connections for VPN C on AS A.
The administrator of AS B can use this service model to order a site on AS A.
All connection scenarios could be realized using the features of the current model.
As an example, Figure 23 shows two physical connections that have logical connections per VPN overlaid on them.
This could be seen as a multi VPN scenario.
Also, the administrator of AS B will be able to choose the appropriate routing protocol (e.g., External BGP (EBGP)) to dynamically exchange routes between ASes.
This document assumes that the option A NNI flavor SHOULD reuse the existing VPN site modeling.
Figure 24 illustrates an example where a customer wants its CSP A to attach its virtual network N to an existing L2VPN (VPN1) that it has from L2VPN
VPN1 Site 4 VM   Virtual Machine Figure 24:
NNI Defined with the Option A Flavor: Example 2
To create the VPN connectivity, the CSP or the customer may use the L2SM that SP B exposes.
We could consider that, as the NNI is shared, the physical connection (bearer) between CSP A and SP B already exists.
CSP A may request through a service model the creation of a new site with a single site network access (single homing is used in Figure 24).
As a placement constraint, CSP A may use the existing bearer reference it has from SP A to force the placement of the VPN NNI on the existing link.
The XML below illustrates a possible configuration request to SP B: <?
yang:ietf l2vpn svc"> <vpn profiles> <valid provider identifiers> <qos profile identifier> <
> </qos profile identifier> <qos profile identifier> <id>PLATINUM</id
</qos profile identifier> </valid provider identifiers> </vpn profiles> <vpn services
true</ce vlan preservation> <ce vlan cos preservation>
true</ce vlan cos preservation> </vpn service> </vpn services
> <sites> <site> <site id>CSP
> </location> </locations> <site vpn flavor>site vpn flavor
<site network accesses> <site network access> <
> <connection> <encapsulation type>vlan</encapsulation type> <eth inf type>tagged</eth inf type
> <tagged interface> <tagged inf type>dot1q</tagged inf type
> <dot1q vlan tagged> <cvlan id>17</cvlan id> </dot1q
> </connection> <service> <svc bandwidth> <bandwidth
bw per cos</type> <cir>450000000</cir> <cbs>20000000</cbs
> <eir>1000000000</eir> <ebs>200000000</ebs> </bandwidth> </svc bandwidth> <carrierscarrier
> <signaling type>bgp</signaling type> </carrierscarrier
> <site role>spoke role</site role> </vpn attachment> </site network access
> </site network accesses> <management> <type>customer managed</type
The case described above is different from a scenario using the cloud accesses container, as the cloud access provides a public cloud access while this example enables access to private resources located in a CSP network.
Defining an NNI with the Option B Flavor AS
NNI Defined with the Option B Flavor: Example 1
In option B, the two ASes are connected to each other with physical links on ASBRs.
For resiliency purposes, there may be multiple physical connections between the ASes.
The VPN "connection" between ASes is done by exchanging VPN routes through MP BGP [RFC4761].
There are multiple flavors of implementations of such an NNI.
The NNI is internal to the provider and is situated between a backbone and a data center.
There is enough trust between the domains to not filter the VPN routes.
So, all the VPN routes are exchanged.
RT filtering may be implemented to save some unnecessary route states.
The NNI is used between providers that agreed to exchange VPN routes for specific RTs only.
Each provider is authorized to use the RT values from the other provider.
The NNI is used between providers that agreed to exchange VPN routes for specific RTs only.
Each provider has its own RT scheme.
So, a customer spanning the two networks will have different RTs in each network for a particular VPN.
Case 1 does not require any service modeling, as the protocol enables the dynamic exchange of necessary VPN routes.
Case 2 requires that an RT filtering policy on ASBRs be maintained.
From a service modeling point of view, it is necessary to agree on the list of RTs to authorize.
In Case 3, both ASes need to agree on the VPN RT to exchange, as well as how to map a VPN RT from AS A to the corresponding RT in AS B (and vice versa).
Those modelings are currently out of scope for this document.
NNI Defined with the Option B Flavor: Example 2 Figure 26 shows an NNI connection between CSP A and SP network B.
The SPs do not trust each other and use different RT allocation policies.
So, in terms of implementation, the customer VPN has a different RT in each network
(RT A in CSP A and RT B in SP network B).
In order to connect the customer's virtual network in CSP A to the customer's L2VPN (VPN1) in SP network B, CSP A should request that SP network B open the customer VPN on the NNI (accept the appropriate RT).
Who does the RT translation depends on the agreement between the two SPs: SP B may permit CSP A to request VPN (RT) translation.
Defining an NNI with the Option C Flavor AS
NNI Defined with the Option C Flavor From a VPN service's perspective, the option C NNI is very similar to option B, as an MP BGP session is used to exchange VPN routes between the ASes.
The difference is that the forwarding plane and the control plane are on different nodes, so the MP BGP session is multihop between routing gateway (RGW) nodes.
From a VPN service's point of view, modeling options B and C will be configured identically.
Applicability of L2SM in Inter provider and Inter domain Orchestration
In the case where the ASes belong to different providers, one might imagine that providers would like to have fewer signaling sessions crossing the AS boundary and that the entities that terminate the sessions could be restricted to a smaller set of devices.
Two approaches can be taken: a.  Construct inter provider control connections to run only between the two border routers.
Allow end to end, multi segment connectivity to be constructed out of several connectivity segments, without maintaining an end to end control connection.
Inter provider control connections as described in approach (a) can be realized using the techniques provided in Section 5.16 (e.g., defining NNIs).
Multi segment connectivity as described in approach (b) can produce an inter AS solution that more closely resembles scheme (b) in Section 10 of [RFC4364].
It may be realized using "stitching" of per site connectivity and service segments at different domains, e.g., end to end connectivity between Site 1 and Site 3 spans multiple domains (e.g., metropolitan area networks) and can be constructed by stitching network access connectivity within Site 1 with SEG1, SEG3, and SEG4, and network access connectivity within Site 3 (as shown in Figure 28).
The assumption is that the service orchestration component in Figure 3 should have visibility into the complete abstract topology and resource availability.
This may rely on network planning.
Inter provider and Inter domain Orchestration Note that SEG1, SEG2, SEG3, SEG4, SEG5, and SEG6 can also be regarded as network access connectivity within a site and can be created as a normal site using the L2SM.
In Figure 28, we use BGP redistribution of L2VPN Network Layer Reachability Information (NLRI) instances from AS to neighboring AS.
First, the PE routers use BGP to redistribute L2VPN NLRIs to either an ASBR or a route reflector of which an ASBR is a client.
The ASBR then uses BGP to redistribute those L2VPN NLRIs to an ASBR in another AS, which in turn distributes them to the PE routers in that AS, or perhaps to another ASBR that in turn distributes them, and so on.
In this case, a PE can learn the address of an ASBR through which it could reach another PE to which it wishes to establish connectivity.
That is, a local PE will receive a BGP advertisement containing an L2VPN NLRI corresponding to an L2VPN instance in which the local PE has some attached members.
The BGP next hop for that L2VPN NLRI will be an ASBR of the local AS.
Then, rather than building a control connection all the way to the remote PE, it builds one only to the ASBR.
A connectivity segment can now be established from the PE to the ASBR.
The ASBR in turn can establish connectivity to the ASBR of the next AS and then stitch that connectivity to the connectivity from the PE as described in [RFC6073].
Repeating the process at each ASBR leads to a sequence of connectivity segments that, when stitched together, connect the two PEs.
Note that in the approach just described, the local PE may never learn the IP address of the remote PE.
the L2VPN NLRI advertised by the remote PE, which need not contain the remote PE address, and it learns the IP address of the ASBR that is the BGP next hop for that NLRI.
When this approach is used for VPLS or for full mesh VPWS, it leads to a full mesh of connectivity among the PEs, but it does not require a full mesh of control connections (LDP or L2TPv3 sessions).
Instead, the control connections within a single AS run among all the PEs of that AS and the ASBRs of the AS.
A single control connection between the ASBRs of adjacent ASes can be used to support as many AS to AS connectivity segments as may be needed.
Interaction with Other YANG Modules
As explained in Section 4, this service model is not intended to configure network elements; rather, it is instantiated in a management system.
The management system might follow modular design and comprise two different components: a.
The component instantiating the service model (let's call it the service component).
The component responsible for network element configuration (let's call it the configuration component).
In some cases, when a split is needed between the behavior and functions that a customer requests and the technology that the network operator has available to deliver the service [RFC8309], a new component can be separated out of the service component (let's call it the control component).
This component is responsible for network centric operation and is aware of many features such as topology, technology, and operator policy.
As an optional component, it can use the service model as input and is not required at all if the control component delegates its control operations to the configuration component.
In Section 7, we provide an example of translation of service provisioning requests to router configuration lines as an illustration.
In the YANG based ecosystem, it is expected that NETCONF and YANG will be used between the configuration component and network elements to configure the requested service on those elements.
In this framework, it is expected that YANG data models will be used to configure service components on network elements.
There will be a strong relationship between the abstracted view provided by this service model and the detailed configuration view that will be provided by specific configuration models for network elements such as those defined in [MPLS L2VPN YANG] and [EVPN YANG].
Service components that would need configuration of network elements in support of the service model defined in this document include:  Network instance definitions that include defined VPN policies.
Ethernet layer parameters (e.g., VLAN IDs).
Support for Ethernet Service OAM.
As explained in Section 4, this service model is intended to be instantiated at a management layer and is not intended to be used directly on network elements.
The management system serves as a central point of configuration of the overall service.
This section provides an example of how a management system can use this model to configure an L2VPN service on network elements.
This example provides a VPN service for three sites using point to point VPWS and a Hub and Spoke VPN service topology as shown in Figure 29.
Load balancing is not considered in this case.
Figure 29: Reference Network for Simple Example
The following XML describes the overall simplified service configuration of this VPN.
yang:ietf l2vpn svc"> <vpn services> <vpn service>
>hub spoke</svc topo> <ce vlan preservation
true</ce vlan preservation> <ce vlan cos preservation>
> </vpn service> <vpn service> <vpn id>12456488</vpn
>hub spoke</svc topo> <ce vlan preservation
true</ce vlan preservation> <ce vlan cos preservation>
true</ce vlan cos preservation> </vpn service> </vpn services
When receiving the request for provisioning the VPN service, the management system will internally (or through communication with another OSS component) allocate VPN RTs.
In this specific case, two RTs will be allocated (100:1 for Hubs and 100:2 for Spokes).
The output below describes the configuration of Spoke Site 1. <?
yang:ietf l2vpn svc"> <vpn services> <vpn service>
>hub spoke</svc topo> <ce vlan preservation
true</ce vlan preservation> <ce vlan cos preservation>
true</ce vlan cos preservation> </vpn service> </vpn services
> <sites> <site> <site id
> </location> </locations> <site network accesses> <site network access
<access diversity> <groups> <group> <group id>20</group
<encapsulation type>vlan</encapsulation type> <tagged interface
> <dot1q vlan tagged> <cvlan id>17</cvlan id> </dot1q
> </connection> <service> <svc bandwidth> <bandwidth
bw per cos</type> <cir>450000000</cir> <cbs>20000000</cbs
> <eir>1000000000</eir> <ebs>200000000</ebs> </bandwidth> </svc bandwidth> <carrierscarrier
> <signaling type>bgp</signaling type> </carrierscarrier
> <site role>spoke role</site role> </vpn attachment> </site network access
> </site network accesses> <management>
When receiving the request for provisioning Spoke Site 1, the management system MUST allocate network resources for this site.
It MUST first determine the target network elements to provision the access and, in particular, the PE router (or possibly an aggregation switch).
As described in Sections 5.3.1 and 5.6, the management system SHOULD use the location information and MUST use the access diversity constraint to find the appropriate PE.
In this case, we consider that Spoke Site 1 requires PE diversity with Hubs and that the management system will allocate PEs based on least distance.
Based on the location information, the management system finds the available PEs in the area closest to the customer and picks one that fits the access diversity constraint.
When the PE is chosen, the management system needs to allocate interface resources on the node.
One interface is selected from the PE's available pool of resources.
The management system can start provisioning the PE node using any means it wishes (e.g., NETCONF, CLI).
The management system will check to see if a VSI that fits its needs is already present.
If not, it will provision the VSI:
the RD will come from the internal allocation policy model, and the RTs will come from the vpn policy configuration of the site (i.e., the management system will allocate some RTs for the VPN).
As the site is a Spoke site (site role), the management system knows which RTs must be imported and exported.
As the site is provider managed, some management RTs may also be added (100:5000).
Standard provider VPN policies MAY also be added in the configuration.
Example of a generated PE configuration:
autodiscovery bgp signaling bgp ve
When the VSI has been provisioned, the management system can start configuring the access on the PE using the allocated interface information.
The tag or VLAN (e.g., service instance tag) is chosen by the management system.
One tag will be picked from an allocated subnet for the PE, and another will be used for the CE configuration.
LACP protocols will also be configured between the PE and the CE; in the case of the provider managed model, the choice is left to the SP.
This choice is independent of the LACP protocol chosen by the customer.
Example of a generated PE configuration: !
bridge domain 1 member Ethernet0/0 service instance 100 member vsi one !
l2 router id 198.51.100.1 !
interface Ethernet0/0 no ip address service instance
100 ethernet encapsulation dot1q 100 ! !
router bgp 1 bgp log neighbor changes neighbor 198.51.100.4
remote as 1 neighbor 198.51.100.4 update source Loopback0 !
address family l2vpn vpls neighbor 198.51.100.4 activate
extended neighbor 198.51.100.4 suppress signaling protocol ldp neighbor 2001
:db8::0a10:4 activate neighbor 2001:db8::0a10:4 send community extended exit address family !
the MAC VRF at the PE xconnect
vsi PE1 VPLS A !
As the CE router is not reachable at this stage, the management system can produce a complete CE configuration that can be manually uploaded to the node (e.g., before sending the CE to the customer premises at the appropriate postal address, as described in Section 5.3.1).
The CE configuration will be built in the same way as the PE configuration is built.
Based on (1) the CE type (vendor/model) allocated to the customer and (2) bearer information, the management system knows which interface must be configured on the CE.
PE CE link configuration is expected to be handled automatically using the SP's OSS, as both resources are managed internally.
CE to LAN interface parameters, such as dot1Q tags, are derived from the Ethernet connection, taking into account how the management system distributes dot1Q tags between the PE and the CE within the subnet.
This will allow a plug'n'play configuration to be produced for the CE.
Example of a generated CE configuration: interface Ethernet0/1 switchport trunk allowed vlan none switchport mode trunk service instance 100 ethernet encapsulation default l2protocol forward cdp xconnect 203.0.113.1 100 encapsulation mpls !
This YANG module imports typedefs from [RFC6991] and [RFC8341].
<CODE BEGINS> file "ietf l2vpn svc@2018 10 09.yang" module ietf l2vpn svc { yang version 1.1; namespace "urn:ietf:params:xml:ns:
yang:ietf l2vpn svc"; prefix l2vpn svc; import ietf inet types { prefix inet; } import ietf yang types { prefix yang; } import ietf netconf acm { prefix nacm; } organization "IETF L2SM Working Group."
Giuseppe Fioccola <mailto:giuseppe.fioccola@tim.it>"; description "This YANG module defines a generic service configuration model for Layer 2 VPN services common across all vendor implementations.
IETF Trust and the persons identified as authors of the code.
Redistribution and use in source and binary forms, with or without modification, is permitted pursuant to, and subject to the license terms contained in, the Simplified BSD License set forth in Section 4.c of the IETF Trust's Legal Provisions Relating to IETF Documents (https://trustee.ietf.org/license info).
This version of this YANG module is part of RFC 8466; see the RFC itself for full legal notices."; revision 2018 10 09 { description "Initial revision."; reference "RFC 8466: A YANG Data Model for Layer 2 Virtual Private Network
; } feature extranet vpn { description "Enables the support of extranet VPNs."
; } feature l2cp control { description "Enables the support of L2CP control."
; } feature input bw { description "Enables the support of input bandwidth in a VPN."
; } feature output bw { description "Enables the support of output bandwidth in a VPN."
; } feature uni list { description "Enables the support of a list of UNIs in a VPN."
; } feature cloud access { description "Allows the VPN to connect to a Cloud Service Provider (CSP) or an ISP."
} feature bearer reference { description "Enables support for the 'bearer reference' access constraint."
; } feature dot1q { description "
Enables the support of dot1Q.";
; } feature mac addr limit { description "Enables the MAC address limit capability in a VPN."
; } typedef svc id { type string; description "Defines the type of service component identifier."
; } typedef ccm priority type { type uint8 { range "0..7"
Peering is common for LACP and the Ethernet Local Management Interface (E LMI) and, occasionally, for LLDP.
For VPLSs and VPWSs, the subscriber can also request that the SP peer enable spanning tree."
; } enum tunnel { description "'tunnel' mode, i.e., pass to the egress or destination site.
In this case, BGP must also be configured as the routing protocol."
; } identity site vpn flavor { description "Base identity for the site VPN service flavor."
; } identity site vpn flavor single { base site vpn flavor; description "Identity for the site VPN service flavor.
Used when the site belongs to only one VPN."
; } identity site vpn flavor multi { base site vpn flavor; description "Identity for the site VPN service flavor.
Used when a logical connection of a site belongs to multiple VPNs."
; } identity site vpn flavor nni { base site vpn flavor; description "Identity for the site VPN service flavor.
Pseudowires or L2TP signaled Pseudowires."
; } identity bgp vpls { base service type; description "BGP based multipoint VPLS service type.
The base identity for the bundling type.
It supports multiple CE VLANs associated with an L2VPN service or all CE VLANs associated with an L2VPN service."
; } identity multi svc bundling { base bundling type; description "Identity for multi service bundling,
i.e., multiple CE VLAN IDs can be associated with an L2VPN service at a site."
bundling { base bundling type;
description "Identity for all to one bundling, i.e., all CE VLAN IDs are mapped to one L2VPN service."
} identity cos id pcp { base cos id;
; } identity any to any { base vpn topology; description "Identity for the any to any VPN topology."
; description "Indicates the aggregate health of the Remote MEPs."
; } identity remote mac error { base fault alarm defect type; description "Indicates that one or more of the Remote MEPs are reporting a failure in their Port Status TLVs or Interface Status TLVs."
; } identity remote invalid ccm { base fault alarm defect type; description "Indicates that at least one of the Remote MEP state machines is not receiving valid Continuity Check Messages (CCMs) from its Remote MEP."
; } identity unconditional { base frame delivery mode; description "Service frames are unconditionally delivered to the destination site."
; } identity unknown discard { base frame delivery mode; description "Service frames are conditionally delivered to the destination site.
The bearers should not use common elements."
; } identity pe diverse { base placement diversity; description "Identity for PE diversity."
; } identity pop diverse { base placement diversity; description "Identity for POP diversity."
; } identity linecard diverse { base placement diversity
; } identity qinq { base tagged inf type; description "Identity for the QinQ tagged interface."
; } identity dot1q { base tagged inf type; description "Identity for the dot1Q VLAN tagged interface."
description "Identity for the VXLAN tagged interface."
; } identity vpn policy filter type { description "Base identity for the filter type."
; } identity lan { base vpn policy filter type
} identity qos profile direction { description "Base identity for the QoS profile direction."
} identity customer application { description "Base identity for a customer application."
; } description "List of MAC addresses."
; } description "Container for the ACL."
The site only has receivers."
; } enum source only { description "The site only has sources."
The number of times to detect MAC duplication, where a 'duplicate MAC address' situation has occurred and the duplicate MAC address has been added to a list of duplicate MAC addresses.
It is a VLAN tag added into a frame."
; } leaf src mac { type yang:mac address; description "Source MAC."
; } leaf any { type empty; description "Allow all."
; } leaf vpn id { type svc id; description "Reference to the target VPN."
By default, the direction is bidirectional."
; } leaf policing { type identityref { base policing; } default "one rate two color"; description "The policing type can be either one rate, two color (1R2C) or two rate, three color (2R3C).
; } description "Delay constraint on the traffic class."
; } container frame jitter { choice flavor { case lowest { leaf use lowest jitter { type empty; description "The traffic class should use the path with the lowest jitter."
; } description "Jitter constraint on the traffic class."
By default, the signaling type is 'bgp'."
; } leaf list qos profile identifier { type string; description "Identification of the QoS profile to be used.
; } leaf list remote carrier identifier { type string; description "Identification of the remote carrier name to be used.
It can be an L2VPN partner, data center SP, or private CSP.
By default, all sites in the L2VPN MUST be authorized to access the cloud."
It supports unicast frame delivery, multicast frame delivery, and broadcast frame delivery."
; } leaf delivery mode { type identityref { base frame delivery mode; } default "unconditional"; description "Defines the frame delivery mode ('unconditional' (default), 'conditional', or 'discard').
By default, service frames are unconditionally delivered to the destination site."
In the any to any VPN service topology, the local sites must have the same role, which will be 'any to any role'.
In the Hub and Spoke VPN service topology or the Hub and Spoke Disjoint VPN service topology, the local sites must have a Hub role or a Spoke role."
If all to one bundling within a site is enabled, then preservation applies to all ingress service frames.
If all to one bundling is disabled, then preservation applies to tagged ingress service frames having CE VLAN IDs 1 through 4094."
; } leaf ce vlan cos preservation { type boolean; mandatory true; description "CE VLAN CoS preservation.
"Defines the way that the VPN multiplexing is done, e.g., whether the site belongs to a single VPN site or a multi VPN site.
By default, the site belongs to a single VPN."
If the transport is not specified, then the address should not be specified."
; } type inet:ip address; description "Management address."
; } description "Management configuration.
; } description "Device configurations."
; } leaf country code { type string; description "Country of the site.
; } description "Location of the site."
All site network accesses will inherit those group values."
An Ethernet LAN tag identifies a particular broadcast domain in a VPN."
; } description "List of filters used on the site.
This list can be augmented.
If used, it permits the splitting of site LANs among multiple VPNs.
The site LAN can be split based on either the LAN tag or the LAN prefix.
If no filter is used, all the LANs will be part of the same VPNs with the same role."
; } list vpn { key "vpn id"; leaf vpn id { type leafref { path "/l2vpn svc/vpn services/vpn service
Service parameters on the attachment."
; } uses site bum; uses site mac loop prevention; uses site acl; leaf actual site start { type yang:date and time; config false; description "This leaf is optional.
It indicates the date and time when the service at a particular site actually started."
; } leaf actual site stop { type yang:date and time; config false; description "This leaf is optional.
It indicates the date and time when the service at a particular site actually stopped."
; } leaf bundling type { type identityref { base bundling type; } default "one2one bundling"; description "Bundling type.
The 'remote carrier name' parameter must be configured
only when 'site vpn flavor' is set to 'site vpn flavor nni'.
If it is not set, it indicates that the customer does not know the remote carrier's name beforehand."
; } leaf always on { if feature "always on"; type boolean; default "true"; description "Request for an 'always on' access type.
; } description "Bearer specific parameters.
By default, the tag type is 'c vlan'."
; } leaf cvlan id { type uint16; mandatory true; description "VLAN identifier."
; } description "Container for QinAny."
Indicates that LLDP is supported."
; } container oam 802.3ah link { if feature "oam 3ah"; leaf enabled { type boolean; default "false"; description "Indicates whether or not to support OAM 802.3ah links."
LACP modes have active mode and passive mode ('false').
'Active mode' means initiating the auto speed negotiation and trying to form an Ethernet channel with the other end.
The range is from 0 to 65535.
Indicates whether LLDP is supported."
; } description "List of LAG interfaces."
; } description "Container of LAG interface attribute configurations."
; } list cvlan id to svc map { key "svc id"; leaf svc
id { type leafref { path "/l2vpn svc/vpn services/vpn service/
; } list cvlan id { key "vid"; leaf vid { type uint16; description "CVLAN ID."
; } description "List of CVLAN ID to SVC map configurations."
; } description "List of CVLAN ID to L2VPN service map configurations."
The level may be restricted in certain protocols (e.g., protocols in Layer 0 to Layer 7).
The non existence of this leaf means that no defects are to be reported."
; } leaf mep level { type uint32; description "Defines the MEP level.
By default, MEP up is used.
By default, the CCM interval is 10,000 milliseconds (10 seconds)."
; } leaf ccm holdtime { type uint32; units "milliseconds"; default "35000"; description "CCM hold time.
By default, 'fault alarm defect type' is set to 'remote invalid ccm'.
By default, the performance monitoring type is set to 'delay'.
The non existence of this leaf means that no measurements are to be reported."
; } leaf loss measurement { type boolean; default "false"; description "Indicates whether or not to enable loss measurement.
By default, delay measurement is not enabled."
; } leaf two way { type boolean; default "false"; description "Indicates whether delay measurement is two way ('true') or one way ('false').
By default, the session type is 'on demand'.
The non existence of this leaf means that no measurements are to be reported."
; } description "List of configured Y 1731 instances."
; } description "Container for Ethernet Service OAM."
The higher the access priority value, the higher the preference will be for the access in question."
; } description "Redundancy mode choice."
; } description "Container of available optional configurations."
; } container vpn attachment { choice attachment flavor { case vpn
id { leaf vpn id { type leafref { path "/l2vpn svc/vpn services/vpn service
id provides an easy way to attach a particular logical access to a VPN.
, the site role setting must be added to express the role of the site in the target VPN service topology."
; } type svc id; description "
Controls the bursty nature of the traffic.
It is equal to or less than the sum of the CIR and the EIR."
; } leaf pbs { type uint64; units "bps"; description "Peak Burst Size.
It is measured in bytes per second."
It is also known as the maximum transmission unit or maximum frame size.
When a frame is larger than the MTU, it is broken down, or fragmented, into smaller pieces by the network protocol to accommodate the MTU of the network.
; } uses site bum; uses site mac loop prevention; uses site acl; container mac addr limit { if feature "mac addr limit"; leaf limit number { type uint16; default "2"; description "
Maximum number of MAC addresses learned from the subscriber for a single service instance.
; } description "Container of site configurations."
The YANG module specified in this document defines a schema for data that is designed to be accessed via network management protocols such as NETCONF [RFC6241] or RESTCONF [RFC8040].
The lowest NETCONF layer is the secure transport layer, and the mandatory to implement secure transport is Secure Shell (SSH) [RFC6242].
The lowest RESTCONF layer is HTTPS, and the mandatory to implement secure transport is TLS [RFC8446].
The NETCONF access control model [RFC8341] provides the means to restrict access for particular NETCONF or RESTCONF users to a preconfigured subset of all available NETCONF or RESTCONF protocol operations and content.
There are a number of data nodes defined in this YANG module that are writable/creatable/deletable (i.e., config true, which is the default).
These data nodes may be considered sensitive or vulnerable in some network environments.
Write operations (e.g., edit config) to these data nodes without proper protection can have a negative effect on network operations.
These are the subtrees and data nodes and their sensitivity/vulnerability:
The entries in the list above include all of the VPN service configurations to which the customer subscribes and will use to indirectly create or modify the PE and CE device configurations.
Unexpected changes to these entries could lead to service disruptions and/or network misbehavior.
The entries in the list above include the customer site configurations.
As noted in the previous paragraph, unexpected changes to these entries could lead to service disruptions and/or network misbehavior.
Some of the readable data nodes in this YANG module may be considered sensitive or vulnerable in some network environments.
It is thus important to control
read access (e.g., via get, get config, or notification) to these data nodes.
These are the subtrees and data nodes and their sensitivity/vulnerability:
/l2vpn svc/vpn services/vpn service  /l2vpn svc/sites/site
The entries in the lists above include customer proprietary or confidential information, e.g., customer name, site location, services to which the customer subscribes.
When an SP collaborates with multiple customers, it has to ensure that a given customer can only view and modify its (the customer's) own service information.
The data model defines some security parameters that can be extended via augmentation as part of the customer service request; those parameters are described in Sections 5.12 and 5.13.
IANA Considerations IANA has assigned a new URI from the "IETF XML Registry" [RFC3688].
ietf l2vpn svc Registrant Contact:
N/A; the requested URI is an XML namespace IANA has assigned a new YANG module name in the "YANG Module Names" registry [RFC6020].
l2vpn svc reference: RFC 8466
