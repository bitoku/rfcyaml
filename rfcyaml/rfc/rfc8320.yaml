- contents:
  - '          LDP Extensions to Support Maximally Redundant Trees

    '
  title: __initial_text__
- contents:
  - "Abstract\n   This document specifies extensions to the Label Distribution Protocol\n
    \  (LDP) to support the creation of Label Switched Paths (LSPs) for\n   Maximally
    Redundant Trees (MRTs).  A prime use of MRTs is for unicast\n   and multicast
    IP/LDP Fast Reroute, which we will refer to as\n   \"MRT-FRR\".\n   The sole protocol
    extension to LDP is simply the ability to advertise\n   an MRT Capability.  This
    document describes that extension and the\n   associated behavior expected for
    Label Switching Routers (LSRs) and\n   Label Edge Routers (LERs) advertising the
    MRT Capability.\n   MRT-FRR uses LDP multi-topology extensions, so three multi-topology\n
    \  IDs have been allocated from the MPLS MT-ID space.\n"
  title: Abstract
- contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This
    document is a product of the Internet Engineering Task Force\n   (IETF).  It represents
    the consensus of the IETF community.  It has\n   received public review and has
    been approved for publication by the\n   Internet Engineering Steering Group (IESG).
    \ Further information on\n   Internet Standards is available in Section 2 of RFC
    7841.\n   Information about the current status of this document, any errata,\n
    \  and how to provide feedback on it may be obtained at\n   https://www.rfc-editor.org/info/rfc8320.\n"
  title: Status of This Memo
- contents:
  - "Copyright Notice\n   Copyright (c) 2018 IETF Trust and the persons identified
    as the\n   document authors.  All rights reserved.\n   This document is subject
    to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n
    \  (https://trustee.ietf.org/license-info) in effect on the date of\n   publication
    of this document.  Please review these documents\n   carefully, as they describe
    your rights and restrictions with respect\n   to this document.  Code Components
    extracted from this document must\n   include Simplified BSD License text as described
    in Section 4.e of\n   the Trust Legal Provisions and are provided without warranty
    as\n   described in the Simplified BSD License.\n"
  title: Copyright Notice
- contents:
  - "Table of Contents\n   1.  Introduction  . . . . . . . . . . . . . . . . . . .
    . . . . .   4\n   2.  Requirements Language . . . . . . . . . . . . . . . . .
    . . .   5\n   3.  Terminology . . . . . . . . . . . . . . . . . . . . . . . .
    .   5\n   4.  Overview of LDP Signaling Extensions for MRT  . . . . . . . .   6\n
    \    4.1.  MRT Capability Advertisement  . . . . . . . . . . . . . .   6\n       4.1.1.
    \ Interaction of MRT Capability and MT Capability . . .   7\n       4.1.2.  Interaction
    of LDP MRT Capability with IPv4 and IPv6    8\n     4.2.  Use of the Rainbow MRT
    MT-ID  . . . . . . . . . . . . . .   8\n     4.3.  MRT-Blue and MRT-Red FECs .
    . . . . . . . . . . . . . . .   8\n     4.4.  Interaction of MRT-Related LDP Advertisements
    with the\n           MRT Topology and Computations . . . . . . . . . . . . . .
    \  9\n   5.  LDP MRT FEC Advertisements  . . . . . . . . . . . . . . . . .  10\n
    \    5.1.  MRT-Specific Behavior . . . . . . . . . . . . . . . . . .  10\n       5.1.1.
    \ ABR Behavior and Use of the Rainbow FEC . . . . . . .  10\n       5.1.2.  Proxy-Node
    Attachment Router Behavior . . . . . . . .  11\n     5.2.  LDP Protocol Procedures
    in the Context of MRT Label\n           Distribution  . . . . . . . . . . . .
    . . . . . . . . . .  12\n       5.2.1.  LDP Peer in RFC 5036  . . . . . . . .
    . . . . . . . .  12\n       5.2.2.  Next Hop in RFC 5036  . . . . . . . . . .
    . . . . . .  13\n       5.2.3.  Egress LSR in RFC 5036  . . . . . . . . . . .
    . . . .  13\n       5.2.4.  Use of Rainbow FEC to Satisfy Label Mapping Existence\n
    \              Requirements in RFC 5036  . . . . . . . . . . . . . .  15\n       5.2.5.
    \ Validating FECs in the Routing Table  . . . . . . . .  15\n       5.2.6.  Recognizing
    New FECs  . . . . . . . . . . . . . . . .  15\n       5.2.7.  Not Propagating
    Rainbow FEC Label Mappings  . . . . .  15\n   6.  Security Considerations . .
    . . . . . . . . . . . . . . . . .  16\n   7.  Potential Restrictions on MRT-Related
    MT-ID Values Imposed by\n       RFC 6420  . . . . . . . . . . . . . . . . . .
    . . . . . . . .  16\n   8.  IANA Considerations . . . . . . . . . . . . . . .
    . . . . . .  17\n   9.  References  . . . . . . . . . . . . . . . . . . . . .
    . . . .  18\n     9.1.  Normative References  . . . . . . . . . . . . . . . .
    . .  18\n     9.2.  Informative References  . . . . . . . . . . . . . . . . .
    \ 19\n   Acknowledgements  . . . . . . . . . . . . . . . . . . . . . . . .  21\n
    \  Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  21\n"
  title: Table of Contents
- contents:
  - "1.  Introduction\n   This document describes the LDP signaling extensions and
    associated\n   behavior necessary to support the architecture that defines how
    IP/\n   LDP Fast Reroute can use MRTs [RFC7812].  The current document\n   provides
    a brief description of the MRT-FRR architecture, focusing on\n   the aspects most
    directly related to LDP signaling.  The complete\n   description and specification
    of the MRT-FRR architecture can be\n   found in [RFC7812].\n   At least one common
    standardized algorithm (e.g., the MRT Lowpoint\n   algorithm explained and fully
    documented in [RFC7811]) is required to\n   be deployed so that the routers supporting
    MRT computation\n   consistently compute the same MRTs.  LDP depends on an IGP
    for\n   computation of MRTs and alternates.  Extensions to OSPF are defined\n
    \  in [OSPF-MRT].  Extensions to IS-IS are defined in [IS-IS-MRT].\n   MRT can
    also be used to protect multicast traffic (signaled via PIM\n   or Multipoint
    LDP (mLDP)) using either global protection or local\n   protection as described
    in [ARCH].  An MRT path can be used to\n   provide node-protection for mLDP traffic
    via the mechanisms described\n   in [RFC7715]; an MRT path can also be used to
    provide link protection\n   for mLDP traffic.\n   For each destination, IP/LDP
    Fast Reroute with MRT (MRT-FRR) creates\n   two alternate destination-based trees
    separate from the shortest-path\n   forwarding used during stable operation.  LDP
    uses the multi-topology\n   extensions [RFC7307] to signal Forwarding Equivalency
    Classes (FECs)\n   for these two sets of forwarding trees, MRT-Blue and MRT-Red.\n
    \  In order to create MRT paths and support IP/LDP Fast Reroute, a new\n   capability
    extension is needed for LDP.  An LDP implementation\n   supporting MRT MUST also
    follow the rules described here for\n   originating and managing FECs related
    to MRT, as indicated by their\n   multi-topology ID.  Network reconvergence is
    described in [RFC7812]\n   and the worst-case network convergence time can be
    flooded via the\n   extension in [PARAM-SYNC].\n   IP/LDP Fast Reroute using MRTs
    can provide 100% coverage for link and\n   node failures in an arbitrary network
    topology where the failure\n   doesn't partition the network.  It can also be
    deployed\n   incrementally; an MRT Island is formed of connected supporting\n
    \  routers and the MRTs are computed inside that island.\n"
  title: 1.  Introduction
- contents:
  - "2.  Requirements Language\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\",
    \"SHALL\", \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"NOT
    RECOMMENDED\", \"MAY\", and\n   \"OPTIONAL\" in this document are to be interpreted
    as described in\n   BCP 14 [RFC2119] [RFC8174] when, and only when, they appear
    in all\n   capitals, as shown here.\n"
  title: 2.  Requirements Language
- contents:
  - "3.  Terminology\n   For ease of reading, some of the terminology defined in [RFC7812]
    is\n   repeated here.  Please refer to Section 3 of [RFC7812] for a more\n   complete
    list.\n   Redundant Trees (RTs):  A pair of trees where the path from any node\n
    \     X to the root R along the first tree is node-disjoint with the\n      path
    from the same node X to the root along the second tree.\n      Redundant trees
    can always be computed in 2-connected graphs.\n   Maximally Redundant Trees (MRTs):
    \ A pair of trees where the path\n      from any node X to the root R along the
    first tree and the path\n      from the same node X to the root along the second
    tree share the\n      minimum number of nodes and the minimum number of links.
    \ Each\n      such shared node is a cut-vertex.  Any shared links are cut-links.\n
    \     In graphs that are not 2-connected, it is not possible to compute\n      RTs.
    \ However, it is possible to compute MRTs.  MRTs are maximally\n      redundant
    in the sense that they are as redundant as possible\n      given the constraints
    of the network graph.\n   MRT-Red:  MRT-Red is used to describe one of the two
    MRTs; it is used\n      to describe the associated forwarding topology and MPLS
    Multi-\n      Topology Identifier (MT-ID).\n   MRT-Blue:  MRT-Blue is used to
    describe one of the two MRTs; it is\n      used to described the associated forwarding
    topology and MPLS\n      MT-ID.\n   Rainbow MRT:  It is useful to have an MPLS
    MT-ID that refers to the\n      multiple MRT forwarding topologies and to the
    default forwarding\n      topology.  This is referred to as the \"Rainbow MRT
    MPLS MT-ID\" and\n      is used by LDP to reduce signaling and permit the same
    label to\n      always be advertised to all peers for the same (MT-ID, Prefix).\n
    \  MRT Island:  The set of routers that support a particular MRT Profile\n      and
    the links connecting them that support MRT.\n   Island Border Router (IBR):  A
    router in the MRT Island that is\n      connected to a router not in the MRT Island,
    both of which are in\n      a common area or level.\n   Island Neighbor (IN):
    \ A router that is not in the MRT Island but is\n      adjacent to an IBR and
    in the same area/level as the IBR.\n   There are several places in this document
    where the construction\n   \"red(blue) FEC\" is used to cover the case of the
    red FEC and the case\n   of the blue FEC, independently.  As an example, consider
    the sentence\n   \"When the ABR requires best-area behavior for a red(blue) FEC,
    it\n   MUST withdraw any existing label mappings advertisements for the\n   corresponding
    Rainbow FEC and advertise label mappings for the\n   red(blue) FEC.\"  This sentence
    should be read as applying to red\n   FECs.  Then it should be read as applying
    to blue FECs.\n"
  title: 3.  Terminology
- contents:
  - "4.  Overview of LDP Signaling Extensions for MRT\n   Routers need to know which
    of their LDP neighbors support MRT.  This\n   is communicated using the MRT Capability
    Advertisement.  Supporting\n   MRT indicates several different aspects of behavior,
    as listed below.\n   1.  Sending and receiving multi-topology FEC elements, as
    defined in\n       [RFC7307].\n   2.  Understanding the Rainbow MRT MT-ID and
    applying the associated\n       labels to all relevant MT-IDs.\n   3.  Advertising
    the Rainbow MRT FEC to the appropriate neighbors for\n       the appropriate prefix.\n
    \  4.  If acting as LDP egress for a prefix in the default topology,\n       also
    acting as egress for the same prefix in MRT-Red and\n       MRT-Blue.\n   5.  For
    a FEC learned from a neighbor that does not support MRT,\n       originating FECs
    for MRT-Red and MRT-Blue with the same prefix.\n       This MRT Island egress
    behavior is to support an MRT Island that\n       does not include all routers
    in the area/level.\n"
  - contents:
    - "4.1.  MRT Capability Advertisement\n   A new MRT Capability Parameter TLV is
      defined in accordance with the\n   LDP Capability definition guidelines [RFC5561].\n
      \  The LDP MRT Capability can be advertised during LDP session\n   initialization
      or after the LDP session is established.\n   Advertisement of the MRT Capability
      indicates support of the\n   procedures for establishing the MRT-Blue and MRT-Red
      Label Switched\n   Paths (LSPs) detailed in this document.  If the peer has
      not\n   advertised the MRT Capability, then it indicates that LSR does not\n
      \  support MRT procedures.\n   If a router advertises the LDP MRT Capability
      to its peer, but the\n   peer has not advertised the MRT Capability, then the
      router MUST NOT\n   advertise MRT-related FEC-label bindings to that peer.\n
      \  The following is the format of the MRT Capability Parameter.\n      0                   1
      \                  2                   3\n      0 1 2 3 4 5 6 7 8 9 0 1 2 3
      4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \    |U|F| MRT Capability (0x050E)   |      Length (= 1)             |\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
      \    |S| Reserved    |\n     +-+-+-+-+-+-+-+-+\n                         MRT
      Capability TLV Format\n   Where:\n   U-bit:  The unknown TLV bit MUST be 1.
      \ A router that does not\n      recognize the MRT Capability TLV will silently
      ignore the TLV and\n      process the rest of the message as if the unknown
      TLV did not\n      exist.\n   F-bit:  The forward unknown TLV bit MUST be 0
      as required by\n      Section 3 of [RFC5561].\n   MRT Capability:  0x050E\n
      \  Length:  The length (in octets) of the TLV.  Its value is 1.\n   S-bit:  The
      State bit MUST be 1 if used in the LDP Initialization\n      message.  MAY be
      set to 0 or 1 in the dynamic Capability message\n      to advertise or withdraw
      the capability, respectively, as\n      described in [RFC5561].\n"
    - contents:
      - "4.1.1.  Interaction of MRT Capability and MT Capability\n   An LSR advertising
        the LDP MRT Capability MUST also advertise the LDP\n   Multi-Topology (MT)
        Capability.  If an LSR negotiates the LDP MRT\n   Capability with an LDP neighbor
        without also negotiating the LDP MT\n   Capability, the LSR MUST behave as
        if the LDP MRT Capability was not\n   negotiated and respond with the \"MRT
        Capability negotiated without MT\n   Capability\" status code in the LDP Notification
        message (defined in\n   the document).  The E-bit of this Notification should
        be set to 0 to\n   indicate that this is an Advisory Notification.  The LDP
        session\n   SHOULD NOT be terminated.\n"
      title: 4.1.1.  Interaction of MRT Capability and MT Capability
    - contents:
      - "4.1.2.  Interaction of LDP MRT Capability with IPv4 and IPv6\n   The MRT
        LDP Capability Advertisement does not distinguish between\n   IPv4 and IPv6
        address families.  An LSR that advertises the MRT LDP\n   Capability is expected
        to advertise MRT-related FEC-label bindings\n   for the same address families
        for which it advertises shortest-path\n   FEC-label bindings.  Therefore,
        an LSR advertising MRT LDP Capability\n   and shortest-path FEC-label bindings
        for IPv4 only (or IPv6 only)\n   would be expected to advertise MRT-related
        FEC-label binding for IPv4\n   only (or IPv6 only).  An LSR advertising the
        MRT LDP Capability and\n   shortest-path FEC-label bindings for BOTH IPv4
        and IPv6 is expected\n   to advertise MRT-related FEC-label bindings for BOTH
        IPv4 and IPv6.\n   In this scenario, advertising MRT-related FEC-label bindings
        only for\n   IPv4 only (or only for IPv6) is not supported.\n"
      title: 4.1.2.  Interaction of LDP MRT Capability with IPv4 and IPv6
    title: 4.1.  MRT Capability Advertisement
  - contents:
    - "4.2.  Use of the Rainbow MRT MT-ID\n   Section 10.1 of [RFC7812] describes
      the need for an Area Border\n   Router (ABR) to have different neighbors use
      different MPLS labels\n   when sending traffic to the ABR for the same FEC.
      \ More detailed\n   discussion of the Rainbow MRT MT-ID is provided in Section
      5.1.1.\n   Another use for the Rainbow MRT MT-ID is for an LSR to send the\n
      \  Rainbow MRT MT-ID with an IMPLICIT_NULL label to indicate\n   penultimate-hop-popping
      for all three types of FECs (shortest path,\n   red, and blue).  The EXPLICIT_NULL
      label advertised using the Rainbow\n   MRT MT-ID similarly applies to all the
      types of FECs.  Note that the\n   only scenario in which it is generally useful
      to advertise the\n   implicit or explicit null label for all three FEC types
      is when the\n   FEC refers to the LSR itself.  See Section 5.2.3 for more details.\n
      \  The value of the Rainbow MRT MPLS MT-ID (3945) has been assigned by\n   IANA
      from the MPLS MT-ID space.\n"
    title: 4.2.  Use of the Rainbow MRT MT-ID
  - contents:
    - "4.3.  MRT-Blue and MRT-Red FECs\n   To provide MRT support in LDP, the MT Prefix
      FEC is used.  [RFC7812]\n   defines the Default MRT Profile.  Section 8 specifies
      the values in\n   the \"MPLS Multi-Topology Identifiers\" registry for the MRT-Red
      and\n   MRT-Blue MPLS MT-IDs associated with the Default MRT Profile (3946\n
      \  and 3947).\n   As described in Section 8.1 of [RFC7812], when a new MRT Profile
      is\n   defined, new and unique values should be allocated from the \"MPLS\n
      \  Multi-Topology Identifiers\" registry, corresponding to the MRT-Red\n   and
      MRT-Blue MT-ID values for the new MRT Profile.\n   The MT Prefix FEC encoding
      is defined in [RFC7307] and is used\n   without alteration for advertising label
      mappings for MRT-Blue,\n   MRT-Red, and Rainbow MRT FECs.\n"
    title: 4.3.  MRT-Blue and MRT-Red FECs
  - contents:
    - "4.4.  Interaction of MRT-Related LDP Advertisements with the MRT\n      Topology
      and Computations\n   [RFC7811] and [RFC7812] describe how the MRT topology is
      created\n   based on information in IGP advertisements.  The MRT topology and\n
      \  computations rely on IGP advertisements.  The presence or absence of\n   MRT-related
      LDP advertisements does not affect the MRT topology or\n   the MRT-Red and MRT-Blue
      next hops computed for that topology.\n   As an example, consider a network
      where all nodes are running MRT IGP\n   extensions to determine the MRT topology,
      which is then used to\n   compute MRT-Red and MRT-Blue next hops.  The network
      operator also\n   configures the nodes in this network to exchange MRT-related
      LDP\n   advertisements in order to distribute MPLS labels corresponding to\n
      \  those MRT next hops.  Suppose that, due to a misconfiguration on one\n   particular
      link, the MRT-related LDP advertisements are not being\n   properly exchanged
      for that link.  Since the MRT-related IGP\n   advertisements for the link are
      still being distributed, the link is\n   still included in the MRT topology
      and computations.  In this\n   scenario, there will be missing MPLS forwarding
      entries corresponding\n   to paths that use the misconfigured link.\n   Note
      that the situation is analogous to the interaction of normal LDP\n   advertisements
      and IGP advertisements for shortest-path forwarding.\n   Deactivating the distribution
      of labels for normal shortest-path FECs\n   on a link does not change the topology
      on which the Shortest Path\n   First (SPF) algorithm is run by the IGP.\n   \"LDP
      IGP Synchronization\" [RFC5443] addresses the issue of the LDP\n   topology
      not matching the IGP topology by advertising the maximum IGP\n   cost on links
      where LDP is not fully operational.  This makes the IGP\n   topology match the
      LDP topology.  As described in Section 7.3.1 of\n   [RFC7812], MRT is designed
      to be compatible with the LDP IGP\n   synchronization mechanism.  When the IGP
      advertises the maximum cost\n   on a link where LDP is not fully operational,
      the link is excluded\n   from MRT Island formation, which prevents the MRT algorithm
      from\n   creating any paths using that link.\n"
    title: 4.4.  Interaction of MRT-Related LDP Advertisements with the MRT
  title: 4.  Overview of LDP Signaling Extensions for MRT
- contents:
  - "5.  LDP MRT FEC Advertisements\n   This sections describes how and when labels
    for MRT-Red and MRT-Blue\n   FECs are advertised.  In order to provide protection
    paths that are\n   immediately usable by the point of local repair in the event
    of a\n   failure, the associated LSPs need to be created before a failure\n   occurs.\n
    \  In this section, we will use the term \"shortest-path FEC\" to refer to\n   the
    usual FEC associated with the shortest-path destination-based\n   forwarding tree
    for a given prefix as determined by the IGP.  We will\n   use the terms \"red
    FEC\" and \"blue FEC\" to refer to FECs associated\n   with the MRT-Red and MRT-Blue
    destination-based forwarding trees for\n   a given prefix as determined by a particular
    MRT algorithm.\n   We first describe label distribution behavior specific to MRT.
    \ Then,\n   we provide the correct interpretation of several important concepts\n
    \  in [RFC5036] in the context of MRT FEC label distribution.\n   [RFC5036] specifies
    two different Label Distribution Control Modes\n   (Independent and Ordered),
    two different Label Retention Modes\n   (Conservative and Liberal), and two different
    Label Advertisement\n   Modes (Downstream Unsolicited and Downstream on Demand).
    \ The current\n   specification for LDP MRT requires that the same Label Distribution\n
    \  Control, Label Retention, and Label Advertisement modes be used for\n   the
    shortest-path FECs and the MRT FECs.\n"
  - contents:
    - '5.1.  MRT-Specific Behavior

      '
    - contents:
      - "5.1.1.  ABR Behavior and Use of the Rainbow FEC\n   Section 10.1 of [RFC7812]
        describes the need for an ABR to have\n   different neighbors use different
        MPLS labels when sending traffic to\n   the ABR for the same FEC.  The method
        to accomplish this using the\n   Rainbow MRT MT-ID is described in detail
        in [RFC7812].  Here we\n   provide a brief summary.  To those LDP peers in
        the same area as the\n   best route to the destination, the ABR advertises
        two different\n   labels corresponding to the MRT-Red and MRT-Blue forwarding
        trees for\n   the destination.  An LDP peer receiving these advertisements
        forwards\n   MRT traffic to the ABR using these two different labels, depending
        on\n   the FEC of the traffic.  We refer to this as \"best-area advertising\n
        \  and forwarding behavior\", which is identical to normal MRT behavior.\n
        \  For all other LDP peers supporting MRT, the ABR advertises a FEC-\n   label
        binding for the FEC, which is in the Rainbow MRT MT-ID, with\n   the label
        that corresponds to that FEC in the default forwarding tree\n   for the destination.
        \ An LDP peer receiving this advertisement\n   forwards MRT traffic to the
        ABR using this label, for both MRT-Red\n   and MRT-Blue traffic.  We refer
        to this as \"non-best-area advertising\n   and forwarding behavior\".\n   The
        use of the Rainbow-FEC by the ABR for non-best-area\n   advertisements is
        RECOMMENDED.  An ABR MAY advertise the label for\n   the default topology
        in separate MRT-Blue and MRT-Red advertisements.\n   An LSR advertising the
        MRT Capability MUST recognize the Rainbow MRT\n   MT-ID and associate the
        advertised label with the specific prefix\n   with the MRT-Red and MRT-Blue
        MT-IDs associated with all MRT Profiles\n   that advertise LDP as the forwarding
        mechanism.\n   Due to changes in topology or configuration, an ABR and a given
        LDP\n   peer may need to transition from best-area advertising and forwarding\n
        \  behavior to non-best-area behavior for a given destination, and vice\n
        \  versa.  When the ABR requires best-area behavior for a red(blue) FEC,\n
        \  it MUST withdraw any existing label mappings advertisements for the\n   corresponding
        Rainbow FEC and advertise label mappings for the\n   red(blue) FEC.  When
        the ABR requires non-best-area behavior for a\n   red(blue) FEC, it MUST withdraw
        any existing label mappings for both\n   red and blue FECs and advertise label
        mappings for the corresponding\n   Rainbow FEC label-binding.\n   In this
        transition, an ABR should never advertise a red(blue) FEC\n   before withdrawing
        the corresponding Rainbow FEC (or vice versa).\n   However, should this situation
        occur, the expected behavior of an LSR\n   receiving these conflicting advertisements
        is defined as follows:\n   -  If an LSR receives a label mapping advertisement
        for a Rainbow FEC\n      from an MRT LDP peer while it still retains a label
        mapping for\n      the corresponding red or blue FEC, the LSR MUST continue
        to use\n      the label mapping for the red or blue FEC, and it MUST send
        a\n      Label Release message corresponding to the Rainbow FEC label\n      advertisement.\n
        \  -  If an LSR receives a label mapping advertisement for a red or blue\n
        \     FEC while it still retains a label mapping for the corresponding\n      Rainbow
        FEC, the LSR MUST continue to use the label mapping for\n      the Rainbow
        FEC, and it MUST send a Label Release message\n      corresponding to the
        red or blue FEC label advertisement.\n"
      title: 5.1.1.  ABR Behavior and Use of the Rainbow FEC
    - contents:
      - "5.1.2.  Proxy-Node Attachment Router Behavior\n   Section 11.2 of [RFC7812]
        describes how MRT provides FRR protection\n   for multi-homed prefixes using
        calculations involving a named proxy-\n   node.  This covers the scenario
        where a prefix is originated by a\n   router in the same area as the MRT Island,
        but outside of the MRT\n   Island.  It also covers the scenario of a prefix
        being advertised by\n   multiple routers in the MRT Island.\n   In the named
        proxy-node calculation, each multi-homed prefix is\n   represented by a conceptual
        proxy-node that is attached to two real\n   proxy-node attachment routers.
        \ (A single proxy-node attachment\n   router is allowed in the case of a prefix
        advertised by a same area\n   router outside of the MRT Island, which is singly
        connected to the\n   MRT Island.)  All routers in the MRT Island perform the
        same\n   calculations to determine the same two proxy-node attachment routers\n
        \  for each multi-homed prefix.  Section 5.9 of [RFC7811] describes the\n
        \  procedure for identifying one proxy-node attachment router as \"red\"\n
        \  and one as \"blue\" with respect to the multi-homed prefix, and\n   computing
        the MRT red and blue next hops to reach those red and blue\n   proxy-node
        attachment routers.\n   In terms of LDP behavior, a red proxy-node attachment
        router for a\n   given prefix MUST originate a label mapping for the red FEC
        for that\n   prefix, while the blue proxy-node attachment router for a given\n
        \  prefix MUST originate a label mapping for the blue FEC for that\n   prefix.
        \ If the red(blue) proxy-node attachment router is an Island\n   Border Router
        (IBR), then when it receives a packet with the label\n   corresponding to
        the red(blue) FEC for a prefix, it MUST forward the\n   packet to the Island
        Neighbor (IN) whose cost was used in the\n   selection of the IBR as a proxy-node
        attachment router.  The IBR MUST\n   swap the incoming label for the outgoing
        label corresponding to the\n   shortest-path FEC for the prefix advertised
        by the IN.  In the case\n   where the IN does not support LDP, the IBR MUST
        pop the incoming\n   label and forward the packet to the IN.\n   If the proxy-node
        attachment router is not an IBR, then the packet\n   MUST be removed from
        the MRT forwarding topology and sent along the\n   interface(s) that caused
        the router to advertise the prefix.  This\n   interface might be out of the
        area/level/AS.\n"
      title: 5.1.2.  Proxy-Node Attachment Router Behavior
    title: 5.1.  MRT-Specific Behavior
  - contents:
    - "5.2.  LDP Protocol Procedures in the Context of MRT Label Distribution\n   [RFC5036]
      specifies the LDP label distribution procedures for\n   shortest-path FECs.
      \ In general, the same procedures can be applied\n   to the distribution of
      label mappings for red and blue FECs, provided\n   that the procedures are interpreted
      in the context of MRT FEC label\n   distribution.  The correct interpretation
      of several important\n   concepts in [RFC5036] in the context of MRT FEC label
      distribution is\n   provided below.\n"
    - contents:
      - "5.2.1.  LDP Peer in RFC 5036\n   In the context of distributing label mappings
        for red and blue FECs,\n   we restrict the LDP peer in [RFC5036] to mean LDP
        peers for which the\n   LDP MRT Capability has been negotiated.  In order
        to make this\n   distinction clear, in this document we will use the term
        \"MRT LDP\n   peer\" to refer to an LDP peer for which the LDP MRT Capability
        has\n   been negotiated.\n"
      title: 5.2.1.  LDP Peer in RFC 5036
    - contents:
      - "5.2.2.  Next Hop in RFC 5036\n   Several procedures in [RFC5036] use the
        next hop of a (shortest-path)\n   FEC to determine behavior.  The next hop
        of the shortest-path FEC is\n   based on the shortest-path forwarding tree
        to the prefix associated\n   with the FEC.  When the procedures of [RFC5036]
        are used to\n   distribute label mapping for red and blue FECs, the next hop
        for the\n   red(blue) FEC is based on the MRT-Red(Blue) forwarding tree to
        the\n   prefix associated with the FEC.\n   For example, Appendix A.1.7 of
        [RFC5036] specifies the response by an\n   LSR to a change in the next hop
        for a FEC.  For a shortest-path FEC,\n   the next hop may change as the result
        of the LSR running a shortest-\n   path computation on a modified IGP topology
        database.  For the red\n   and blue FECs, the red and blue next hops may change
        as the result of\n   the LSR running a particular MRT algorithm on a modified
        IGP topology\n   database.\n   As another example, Section 2.6.1.2 of [RFC5036]
        specifies that when\n   an LSR is using LSP Ordered Control, it may initiate
        the transmission\n   of a label mapping only for a (shortest-path) FEC for
        which it has a\n   label mapping for the FEC next hop, or for which the LSR
        is the\n   egress.  The FEC next hop for a shortest-path FEC is based on the\n
        \  shortest-path forwarding tree to the prefix associated with the FEC.\n
        \  In the context of distributing MRT LDP labels, this procedure is\n   understood
        to mean the following.  When an LSR is using LSP Ordered\n   Control, it may
        initiate the transmission of a label mapping only for\n   a red(blue) FEC
        for which it has a label mapping for the red(blue)\n   FEC next hop, or for
        which the LSR is the egress.  The red or blue\n   FEC next hop is based on
        the MRT-Red or Blue forwarding tree to the\n   prefix associated with the
        FEC.\n"
      title: 5.2.2.  Next Hop in RFC 5036
    - contents:
      - "5.2.3.  Egress LSR in RFC 5036\n   Procedures in [RFC5036] related to Ordered
        Control label distribution\n   mode rely on whether or not an LSR may act
        as an egress LSR for a\n   particular FEC in order to determine whether or
        not the LSR may\n   originate a label mapping for that FEC.  The status of
        being an\n   egress LSR for a particular FEC is also used in the loop detection\n
        \  procedures described in [RFC5036].  Section 2.6.1.2 of [RFC5036]\n   specifies
        the conditions under which an LSR may act as an egress LSR\n   with respect
        to a particular (shortest-path) FEC:\n   1.  The (shortest-path) FEC refers
        to the LSR itself (including one\n       of its directly attached interfaces).\n
        \  2.  The next hop router for the (shortest-path) FEC is outside of the\n
        \      Label Switching Network.\n   3.  (Shortest-path) FEC elements are reachable
        by crossing a routing\n       domain boundary.\n   The conditions for determining
        an egress LSR with respect to a red or\n   blue FEC need to be modified.  An
        LSR may act as an egress LSR with\n   respect to a particular red(blue) FEC
        under any of the following\n   conditions:\n   1.  The prefix associated with
        the red(blue) FEC refers to the LSR\n       itself (including one of its directly
        attached interfaces).\n   2.  The LSR is the red(blue) proxy-node attachment
        router with\n       respect to the multi-homed prefix associated with the
        red(blue)\n       FEC.  This includes the degenerate case of a single red
        and blue\n       proxy-node attachment router for a single-homed prefix.\n
        \  3.  The LSR is an ABR AND the MRT LDP peer requires non-best-area\n       advertising
        and forwarding behavior for the prefix associated\n       with the FEC.\n
        \  Note that condition 3 scopes an LSR's status as an egress LSR with\n   respect
        to a particular FEC to a particular MRT LDP peer.  Therefore,\n   the condition
        \"Is LSR egress for FEC?\" that occurs in several\n   procedures in [RFC5036]
        needs to be interpreted as \"Is LSR egress for\n   FEC with respect to Peer?\"\n
        \  Also note that there is no explicit condition that allows an LSR to\n   be
        classified as an egress LSR with respect to a red or blue FEC\n   based only
        on the primary next hop for the shortest-path FEC not\n   supporting LDP or
        not supporting LDP MRT Capability.  These\n   situations are covered by the
        proxy-node attachment router and ABR\n   conditions (conditions 2 and 3).
        \ In particular, an Island Border\n   Router is not the egress LSR for a red(blue)
        FEC unless it is also\n   the red(blue) proxy-node attachment router for that
        FEC.\n   Also note that, in general, a proxy-node attachment router for a\n
        \  given prefix should not advertise an implicit or explicit null label\n
        \  for the corresponding red or blue FEC, even though it may be an\n   egress
        LSR for the shortest-path FEC.  In general, the proxy-node\n   attachment
        router needs to forward red or blue traffic for that\n   prefix to a particular
        loop-free island neighbor, which may be\n   different from the shortest-path
        next hop.  The proxy-node attachment\n   router needs to receive the red or
        blue traffic with a non-null label\n   to correctly forward it.\n"
      title: 5.2.3.  Egress LSR in RFC 5036
    - contents:
      - "5.2.4.  Use of Rainbow FEC to Satisfy Label Mapping Existence\n        Requirements
        in RFC 5036\n   Several procedures in [RFC5036] require the LSR to determine
        if it\n   has previously received and retained a label mapping for a FEC from\n
        \  the next hop.  In the case of an LSR that has received and retained a\n
        \  label mapping for a Rainbow FEC from an ABR, the label mapping for\n   the
        Rainbow FEC satisfies the label mapping existence requirement for\n   the
        corresponding red and blue FECs.  Label mapping existence\n   requirements
        in the context of MRT LDP label distribution are\n   modified as: \"Has LSR
        previously received and retained a label\n   mapping for the red(blue) FEC
        (or the corresponding Rainbow FEC) from\n   the red(blue) next hop?\"\n   As
        an example, this behavior allows an LSR that has received and\n   retained
        a label mapping for the Rainbow FEC to advertise label\n   mappings for the
        corresponding red and blue FECs when operating in\n   Ordered Control label
        distribution mode.\n"
      title: 5.2.4.  Use of Rainbow FEC to Satisfy Label Mapping Existence
    - contents:
      - "5.2.5.  Validating FECs in the Routing Table\n   In [RFC5036], an LSR uses
        its routing table to validate prefixes\n   associated with shortest-path FECs.
        \ For example, Section 3.5.7.1 of\n   [RFC5036] specifies that \"an LSR receiving
        a Label Mapping message\n   from a downstream LSR for a Prefix SHOULD NOT
        use the label for\n   forwarding unless its routing table contains an entry
        that exactly\n   matches the FEC Element.\"  In the context of MRT FECs, a
        red or blue\n   FEC element matches a routing table entry if the corresponding\n
        \  shortest-path FEC element matches a routing table entry.\n"
      title: 5.2.5.  Validating FECs in the Routing Table
    - contents:
      - "5.2.6.  Recognizing New FECs\n   Appendix A.1.6 of [RFC5036] describes the
        response of an LSR to the\n   \"Recognize New FEC\" event, which occurs when
        an LSR learns a new\n   (shortest-path) FEC via the routing table.  In the
        context of MRT\n   FECs, if the MRT LDP Capability has been enabled, then
        when an LSR\n   learns a new shortest-path FEC, the LSR should generate \"Recognize\n
        \  New FEC\" events for the corresponding Red and Blue FECS in addition\n
        \  to the normally generated \"Recognize New FEC\" event for the shortest-\n
        \  path FEC\n"
      title: 5.2.6.  Recognizing New FECs
    - contents:
      - "5.2.7.  Not Propagating Rainbow FEC Label Mappings\n   A label mapping for
        the Rainbow FEC should only be originated by an\n   ABR under the conditions
        described in Section 5.1.1.  A neighbor of\n   the ABR that receives a label
        mapping for the Rainbow FEC MUST NOT\n   propagate a label mapping for that
        Rainbow FEC.\n"
      title: 5.2.7.  Not Propagating Rainbow FEC Label Mappings
    title: 5.2.  LDP Protocol Procedures in the Context of MRT Label Distribution
  title: 5.  LDP MRT FEC Advertisements
- contents:
  - "6.  Security Considerations\n   The labels distributed by the extensions in this
    document create\n   additional forwarding paths that do not follow shortest-path
    routes.\n   The transit label swapping operations defining these alternative\n
    \  forwarding paths are created during normal operations (before a\n   failure
    occurs).  Therefore, a malicious packet with an appropriate\n   label injected
    into the network from a compromised location would be\n   forwarded to a destination
    along a non-shortest path.  When this\n   technology is deployed, a network security
    design should not rely on\n   assumptions about potentially malicious traffic
    only following\n   shortest paths.\n   It should be noted that the creation of
    non-shortest forwarding paths\n   is not unique to MRT.  For example, RSVP-TE
    [RFC3209] can be used to\n   construct forwarding paths that do not follow the
    shortest path.\n"
  title: 6.  Security Considerations
- contents:
  - "7.  Potential Restrictions on MRT-Related MT-ID Values Imposed by\n    RFC 6420\n
    \  As discussed in the introduction, in addition to unicast-forwarding\n   applications,
    MRT can be used to provide disjoint trees for multicast\n   traffic distribution.
    \ In the case of PIM, this is accomplished by\n   using the MRT red and blue next
    hops as the PIM Reverse Path\n   Forwarding (RPF) topology, the collection of
    routes used by PIM to\n   perform the RPF operation when building source trees.
    \ The PIM Multi-\n   Topology ID (MT-ID) Join Attribute defined in Section 5.2
    of\n   [RFC6420] can be used to establish MRT-based multicast distribution\n   trees.
    \ [RFC6420] limits the values of the PIM MT-ID from 1 through\n   4095.\n   For
    the purpose of reducing management overhead and simplifying\n   troubleshooting,
    it is desirable to be able to use the same numerical\n   value for the PIM MT-ID
    as for the MPLS MT-ID for multicast and\n   unicast applications using MRT routes
    constructed using the same MRT\n   Profile.  In order to enable this simplification,
    the MPLS MT-ID\n   values assigned in this document fall in the range 1 through
    4095.\n   The \"MPLS Multi-Topology Identifiers\" registry reflects this by\n
    \  listing the values from 3948 through 3995 as for MRT-related MPLS\n   MT-ID
    values.  This allows for 51 MRT-related MPLS MT-ID values that\n   can be directly
    mapped to PIM MT-ID values, which accommodates 25 MRT\n   Profiles with red and
    blue MT-ID pairs, with one extra for the\n   Rainbow MPLS MT-ID value.  [RFC7307]
    designates the MT-ID range\n   6-3995 as \"Unassigned for future IGP topologies\".
    \ As shown in the\n   IANA Considerations, the guidance for the range 3948-3995
    has been\n   changed to \"Unassigned (for future MRT-related values)\".\n"
  title: 7.  Potential Restrictions on MRT-Related MT-ID Values Imposed by
- contents:
  - "8.  IANA Considerations\n   IANA has allocated a value for the new LDP Capability
    TLV from the\n   \"Label Distribution Protocol (LDP) Parameters\" registry under
    \"TLV\n   Type Name Space\": MRT Capability TLV (0x050E).\n    Value          Description
    \        Reference     Notes / Reg. Date\n    -------------  ------------------
    \ ------------  -----------------\n    0x050E         MRT Capability TLV  RFC
    8320\n   IANA has allocated a value for the new LDP Status Code from the\n   \"Label
    Distribution Protocol (LDP) Parameters\" registry under \"Status\n   Code Name
    Space\": MRT Capability negotiated without MT Capability\n   (0x00000034).  The
    Status Code E-bit is set to 0.\n   Value         E  Description         Reference
    \     Notes / Reg. Date\n   ------------- -  ------------------  ------------
    \  -----------------\n   0x00000034    0  MRT Capability      RFC 8320\n                    negotiated
    without\n                    MT Capability\n   IANA has allocated three values
    from the \"MPLS Multi-Topology\n   Identifiers\" registry [RFC7307]:\n      3945
    \ Rainbow MRT MPLS MT-ID\n      3946  Default Profile MRT-Red MPLS MT-ID\n      3947
    \ Default Profile MRT-Blue MPLS MT-ID\n   Also, IANA has changed the Purpose field
    of the \"MPLS Multi-Topology\n   Identifiers\" registry for MT-ID range 3948-3995
    to \"Unassigned (for\n   future MRT-related values)\".  The registration procedure
    for the\n   entire registry remains Standards Action [RFC8126].  The current\n
    \  registry is shown below:\n   Value         Purpose                                    Reference\n
    \  ------------  ----------------------                     ------------\n   0
    \            Default/standard topology                  [RFC7307]\n   1             IPv4
    in-band management                    [RFC7307]\n   2             IPv6 routing
    topology                      [RFC7307]\n   3             IPv4 multicast topology
    \                   [RFC7307]\n   4             IPv6 multicast topology                    [RFC7307]\n
    \  5             IPv6 in-band management                    [RFC7307]\n   6-3944
    \       Unassigned (for future IGP topologies)\n   3945          Rainbow MRT MPLS
    MT-ID                      RFC 8320\n   3946          Default Profile MRT-Red
    MPLS MT-ID          RFC 8320\n   3947          Default Profile MRT-Blue MPLS MT-ID
    \        RFC 8320\n   3948-3995     Unassigned (for future MRT-related values)
    \ RFC 8320\n   3996-4095     Reserved for Experimental Use              [RFC7307]\n
    \  4096-65534    Unassigned (for MPLS topologies)\n   65535         Wildcard Topology
    \                         [RFC7307]\n"
  title: 8.  IANA Considerations
- contents:
  - '9.  References

    '
  - contents:
    - "9.1.  Normative References\n   [RFC2119]  Bradner, S., \"Key words for use
      in RFCs to Indicate\n              Requirement Levels\", BCP 14, RFC 2119,\n
      \             DOI 10.17487/RFC2119, March 1997,\n              <https://www.rfc-editor.org/info/rfc2119>.\n
      \  [RFC5036]  Andersson, L., Ed., Minei, I., Ed., and B. Thomas, Ed.,\n              \"LDP
      Specification\", RFC 5036, DOI 10.17487/RFC5036,\n              October 2007,
      <https://www.rfc-editor.org/info/rfc5036>.\n   [RFC5561]  Thomas, B., Raza,
      K., Aggarwal, S., Aggarwal, R., and\n              JL. Le Roux, \"LDP Capabilities\",
      RFC 5561,\n              DOI 10.17487/RFC5561, July 2009,\n              <https://www.rfc-editor.org/info/rfc5561>.\n
      \  [RFC6420]  Cai, Y. and H. Ou, \"PIM Multi-Topology ID (MT-ID) Join\n              Attribute\",
      RFC 6420, DOI 10.17487/RFC6420, November 2011,\n              <https://www.rfc-editor.org/info/rfc6420>.\n
      \  [RFC7307]  Zhao, Q., Raza, K., Zhou, C., Fang, L., Li, L., and\n              D.
      King, \"LDP Extensions for Multi-Topology\", RFC 7307,\n              DOI 10.17487/RFC7307,
      July 2014,\n              <https://www.rfc-editor.org/info/rfc7307>.\n   [RFC7811]
      \ Enyedi, G., Csaszar, A., Atlas, A., Bowers, C., and\n              A. Gopalan,
      \"An Algorithm for Computing IP/LDP Fast\n              Reroute Using Maximally
      Redundant Trees (MRT-FRR)\",\n              RFC 7811, DOI 10.17487/RFC7811,
      June 2016,\n              <https://www.rfc-editor.org/info/rfc7811>.\n   [RFC7812]
      \ Atlas, A., Bowers, C., and G. Enyedi, \"An Architecture for\n              IP/LDP
      Fast Reroute Using Maximally Redundant Trees\n              (MRT-FRR)\", RFC
      7812, DOI 10.17487/RFC7812, June 2016,\n              <https://www.rfc-editor.org/info/rfc7812>.\n
      \  [RFC8126]  Cotton, M., Leiba, B., and T. Narten, \"Guidelines for\n              Writing
      an IANA Considerations Section in RFCs\", BCP 26,\n              RFC 8126, DOI
      10.17487/RFC8126, June 2017,\n              <https://www.rfc-editor.org/info/rfc8126>.\n
      \  [RFC8174]  Leiba, B., \"Ambiguity of Uppercase vs Lowercase in RFC\n              2119
      Key Words\", BCP 14, RFC 8174, DOI 10.17487/RFC8174,\n              May 2017,
      <https://www.rfc-editor.org/info/rfc8174>.\n"
    title: 9.1.  Normative References
  - contents:
    - "9.2.  Informative References\n   [ARCH]     Atlas, A., Kebler, R., Wijnands,
      IJ., Csaszar, A., and G.\n              Envedi, \"An Architecture for Multicast
      Protection Using\n              Maximally Redundant Trees\", Work in Progress,\n
      \             draft-atlas-rtgwg-mrt-mc-arch-02, July 2013.\n   [IS-IS-MRT]\n
      \             Li, Z., Wu, N., Zhao, Q., Atlas, A., Bowers, C., and\n              J.
      Tantsura, \"Intermediate System to Intermediate System\n              (IS-IS)
      Extensions for Maximally Redundant Trees (MRTs)\",\n              Work in Progress,
      draft-ietf-isis-mrt-03, June 2017.\n   [OSPF-MRT] Atlas, A., Hegde, S., Bowers,
      C., Tantsura, J., and Z. Li,\n              \"OSPF Extensions to Support Maximally
      Redundant Trees\",\n              Work in Progress, draft-ietf-ospf-mrt-03,
      June 2017.\n   [PARAM-SYNC]\n              Bryant, S., Atlas, A., and C. Bowers,
      \"Routing Timer\n              Parameter Synchronization\", Work in Progress,\n
      \             draft-ietf-rtgwg-routing-timer-param-sync-00, October\n              2017.\n
      \  [RFC3209]  Awduche, D., Berger, L., Gan, D., Li, T., Srinivasan, V.,\n              and
      G. Swallow, \"RSVP-TE: Extensions to RSVP for LSP\n              Tunnels\",
      RFC 3209, DOI 10.17487/RFC3209, December 2001,\n              <https://www.rfc-editor.org/info/rfc3209>.\n
      \  [RFC5443]  Jork, M., Atlas, A., and L. Fang, \"LDP IGP\n              Synchronization\",
      RFC 5443, DOI 10.17487/RFC5443, March\n              2009, <https://www.rfc-editor.org/info/rfc5443>.\n
      \  [RFC7715]  Wijnands, IJ., Ed., Raza, K., Atlas, A., Tantsura, J., and\n              Q.
      Zhao, \"Multipoint LDP (mLDP) Node Protection\",\n              RFC 7715, DOI
      10.17487/RFC7715, January 2016,\n              <https://www.rfc-editor.org/info/rfc7715>.\n"
    title: 9.2.  Informative References
  title: 9.  References
- contents:
  - "Acknowledgements\n   The authors would like to thank Ross Callon, Loa Andersson,
    Stewart\n   Bryant, Mach Chen, Greg Mirsky, Uma Chunduri, and Tony Przygienda
    for\n   their comments and suggestions.\n"
  title: Acknowledgements
- contents:
  - "Authors' Addresses\n   Alia Atlas\n   Juniper Networks\n   10 Technology Park
    Drive\n   Westford, MA  01886\n   United States of America\n   Email: akatlas@juniper.net\n
    \  Kishore Tiruveedhula\n   Juniper Networks\n   10 Technology Park Drive\n   Westford,
    MA  01886\n   United States of America\n   Email: kishoret@juniper.net\n   Chris
    Bowers\n   Juniper Networks\n   1194 N. Mathilda Ave.\n   Sunnyvale, CA  94089\n
    \  United States of America\n   Email: cbowers@juniper.net\n   Jeff Tantsura\n
    \  Individual\n   United States of America\n   Email: jefftant.ietf@gmail.com\n
    \  IJsbrand Wijnands\n   Cisco Systems, Inc.\n   Email: ice@cisco.com\n"
  title: Authors' Addresses
