- title: __initial_text__
  contents:
  - '                  Pseudowire Congestion Considerations

    '
- title: Abstract
  contents:
  - "Abstract\n   Pseudowires (PWs) have become a common mechanism for tunneling\n\
    \   traffic and may be found in unmanaged scenarios competing for network\n  \
    \ resources both with other PWs and with non-PW traffic, such as TCP/IP\n   flows.\
    \  Thus, it is worthwhile specifying under what conditions such\n   competition\
    \ is acceptable, i.e., the PW traffic does not\n   significantly harm other traffic\
    \ or contribute more than it should to\n   congestion.  We conclude that PWs transporting\
    \ responsive traffic\n   behave as desired without the need for additional mechanisms.\
    \  For\n   inelastic PWs (such as Time Division Multiplexing (TDM) PWs), we\n\
    \   derive a bound under which such PWs consume no more network capacity\n   than\
    \ a TCP flow.  For TDM PWs, we find that the level of congestion\n   at which\
    \ the PW can no longer deliver acceptable TDM service is never\n   significantly\
    \ greater, and is typically much lower, than this bound.\n   Therefore, as long\
    \ as the PW is shut down when it can no longer\n   deliver acceptable TDM service,\
    \ it will never do significantly more\n   harm than even a single TCP flow.  If\
    \ the TDM service does not\n   automatically shut down, a mechanism to block persistently\n\
    \   unacceptable TDM pseudowires is required.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This document is not an Internet Standards Track specification;\
    \ it is\n   published for informational purposes.\n   This document is a product\
    \ of the Internet Engineering Task Force\n   (IETF).  It represents the consensus\
    \ of the IETF community.  It has\n   received public review and has been approved\
    \ for publication by the\n   Internet Engineering Steering Group (IESG).  Not\
    \ all documents\n   approved by the IESG are a candidate for any level of Internet\n\
    \   Standard; see Section 2 of RFC 7841.\n   Information about the current status\
    \ of this document, any errata,\n   and how to provide feedback on it may be obtained\
    \ at\n   http://www.rfc-editor.org/info/rfc7893.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2016 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (http://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.  Code Components\
    \ extracted from this document must\n   include Simplified BSD License text as\
    \ described in Section 4.e of\n   the Trust Legal Provisions and are provided\
    \ without warranty as\n   described in the Simplified BSD License.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1.  Introduction  . . . . . . . . . . . . . . . . . . .\
    \ . . . . .   3\n   2.  Terminology . . . . . . . . . . . . . . . . . . . . .\
    \ . . . .   5\n   3.  PWs Comprising Elastic Flows  . . . . . . . . . . . . .\
    \ . . .   6\n   4.  PWs Comprising Inelastic Flows  . . . . . . . . . . . . .\
    \ . .   7\n   5.  Conclusions . . . . . . . . . . . . . . . . . . . . . . . .\
    \ .  19\n   6.  Security Considerations . . . . . . . . . . . . . . . . . . .\
    \  19\n   7.  Informative References  . . . . . . . . . . . . . . . . . . .  19\n\
    \   Appendix A.  Loss Probabilities for TDM PWs . . . . . . . . . . .  22\n  \
    \ Appendix B.  Effect of Packet Loss on Voice Quality for\n                Structure-Aware\
    \ TDM PWs  . . . . . . . . . . . . . .  23\n   Authors' Addresses  . . . . . .\
    \ . . . . . . . . . . . . . . . . .  27\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   A pseudowire (PW) (see [RFC3985]) is a construct for tunneling\
    \ a\n   native service, such as Ethernet or TDM, over a Packet Switched\n   Network\
    \ (PSN), such as IPv4, IPv6, or MPLS.  The PW packet\n   encapsulates a unit of\
    \ native service information by prepending the\n   headers required for transport\
    \ in the particular PSN (which must\n   include a demultiplexer field to distinguish\
    \ the different PWs) and\n   preferably the 4-byte Pseudowire Emulation Edge-to-Edge\
    \ (PWE3)\n   control word.\n   PWs have no bandwidth reservation or control mechanisms,\
    \ meaning that\n   when multiple PWs are transported in parallel, and/or in parallel\n\
    \   with other flows, there is no defined means for allocating resources\n   for\
    \ any particular PW, or for preventing the negative impact of a\n   particular\
    \ PW on neighboring flows.  The case where the service\n   provider network provisions\
    \ a PW with sufficient capacity is well\n   understood and will not be discussed\
    \ further here.  Concerns arise\n   when PWs share network capacity with elastic\
    \ or congestion-responsive\n   traffic, whether that capacity sharing was planned\
    \ by a service\n   provider or results from PW deployment by an end user.\n  \
    \ PWs are most often placed in MPLS tunnels, but we herein restrict\n   ourselves\
    \ to PWs in IPv4 or IPv6 PSNs; MPLS PSNs are beyond the scope\n   of this document.\
    \  There are several mechanisms that enable\n   transporting PWs over an IP infrastructure,\
    \ including:\n   o  UDP/IP encapsulations as defined for TDM PWs [RFC4553] [RFC5086]\n\
    \      [RFC5087],\n   o  PWs based on Layer 2 Tunneling Protocol (L2TPv3) [RFC3931],\n\
    \   o  MPLS PWs directly over IP according to RFC 4023 [RFC4023], and\n   o  MPLS\
    \ PWs over Generic Routing Encapsulation (GRE) over IP\n      according to RFC\
    \ 4023 [RFC4023].\n   Whenever PWs are transported over IP, they may compete for\
    \ network\n   resources with neighboring congestion-responsive flows (e.g., TCP\n\
    \   flows).  In this document, we study the effect of PWs on such\n   neighboring\
    \ flows, and discover that the negative impact of PW\n   traffic is generally\
    \ no worse than that of congestion-responsive\n   flows [RFC2914] [RFC5033].\n\
    \   At first glance, one may consider a PW transported over IP to be\n   considered\
    \ as a single flow, on par with a single TCP flow.  Were we\n   to accept this\
    \ tenet, we would require a PW to back off under\n   congestion to consume no\
    \ more bandwidth than a single TCP flow under\n   such conditions (see [RFC5348]).\
    \  However, since PWs may carry\n   traffic from many users, it makes more sense\
    \ to consider each PW to\n   be equivalent to multiple TCP flows.\n   The following\
    \ two sections consider PWs of two types:\n   Elastic Flows:\n      Section 3\
    \ concludes that the response to congestion of a PW\n      carrying elastic (e.g.,\
    \ TCP) flows is no different from the\n      aggregated behaviors of the individual\
    \ elastic flows, had they not\n      been encapsulated within a PW.\n   Inelastic\
    \ Flows:\n      Section 4 considers the case of inelastic constant bit rate (CBR)\n\
    \      TDM PWs [RFC4553] [RFC5086] [RFC5087] competing with TCP flows.\n     \
    \ Such PWs require a preset amount of bandwidth, that may be lower\n      or higher\
    \ than that consumed by an otherwise unconstrained TCP\n      flow under the same\
    \ network conditions.  In any case, such a PW is\n      unable to respond to congestion\
    \ in a TCP-like manner; although\n      admittedly the total bandwidth it consumes\
    \ remains constant and\n      does not increase to consume additional bandwidth\
    \ as TCP rates\n      back off.  For TDM services, we will show that TDM service\
    \ quality\n      degradation generally occurs before the TDM PW becomes TCP-\n\
    \      unfriendly.  For TDM services that do not automatically shut down\n   \
    \   when they persistently fail to comply with acceptable TDM service\n      criteria,\
    \ a transport circuit breaker [CIRCUIT-BREAKER] may be\n      employed as a last\
    \ resort to shut down a TDM pseudowire that can\n      no longer deliver acceptable\
    \ service.\n   Thus, in both cases, pseudowires will not inflict significant harm\
    \ on\n   neighboring TCP flows, as in one case they respond adequately to\n  \
    \ congestion, and in the other they would be shut down due to being\n   unable\
    \ to deliver acceptable service before harming neighboring\n   flows.\n   Note:\
    \ This document contains a large number of graphs that are\n   necessary for its\
    \ understanding, but could not be rendered in ASCII.\n   It is strongly suggested\
    \ that the PDF version be consulted.\n"
- title: 2.  Terminology
  contents:
  - "2.  Terminology\n   The following acronyms are used in this document:\n   AIS\
    \     Alarm Indication Signal (see [G775])\n   BER     Bit Error Rate [G826]\n\
    \   BW      Bandwidth\n   CBR     Constant Bit Rate\n   ES      Errored Second\
    \ [G826]\n   ESR     Errored Second Rate [G826]\n   GRE     Generic Routing Encapsulation\
    \ [RFC2784]\n   L2TPv3  Layer 2 Tunneling Protocol Version 3 [RFC3931]\n   MOS\
    \     Mean Opinion Score [P800]\n   MPLS    Multiprotocol Label Switching [RFC3031]\n\
    \   NSP     Native Service Processing [RFC3985]\n   PLR     Packet Loss Ratio\n\
    \   PSN     Packet Switched Network [RFC3985]\n   PW      Pseudowire [RFC3985]\n\
    \   SAToP   Structure-Agnostic TDM over Packet [RFC4553]\n   SES     Severely\
    \ Errored Seconds [G826]\n   SESR    Severely Errored Seconds Ratio [G826]\n \
    \  TCP     Transmission Control Protocol\n   TDM     Time Division Multiplexing\
    \ [G703]\n   UDP     User Datagram Protocol\n"
- title: 3.  PWs Comprising Elastic Flows
  contents:
  - "3.  PWs Comprising Elastic Flows\n   In this section, we consider Ethernet PWs\
    \ that primarily carry\n   congestion-responsive traffic.  We expand on the remark\
    \ in Section 8\n   (Congestion Control) of [RFC4553], and show that the desired\n\
    \   congestion avoidance behavior is automatically obtained and\n   additional\
    \ mechanisms are not needed.\n   Let us assume that an Ethernet PW aggregating\
    \ several TCP flows is\n   flowing alongside several TCP/IP flows.  Each Ethernet\
    \ PW packet\n   carries a single Ethernet frame that carries a single IP packet\
    \ that\n   carries a single TCP segment.  Thus, if congestion is signaled by an\n\
    \   intermediate router dropping a packet, a single end-user TCP/IP\n   packet\
    \ is dropped, whether or not that packet is encapsulated in the\n   PW.\n   The\
    \ result is that the individual TCP flows inside the PW experience\n   the same\
    \ drop probability as the non-PW TCP flows.  Thus, the\n   behavior of a TCP sender\
    \ (retransmitting the packet and appropriately\n   reducing its sending rate)\
    \ is the same for flows directly over IP and\n   for flows inside the PW.  In\
    \ other words, individual TCP flows are\n   neither rewarded nor penalized for\
    \ being carried over the PW.  An\n   elastic PW does not behave as a single TCP\
    \ flow, as it will consume\n   the aggregated bandwidth of its component flows;\
    \ yet if its component\n   TCP flows backs off by some percentage, the bandwidth\
    \ of the PW as a\n   whole will be reduced by the very same percentage, purely\
    \ due to the\n   combined effect of its component flows.\n   This is, of course,\
    \ precisely the desired behavior.  Were individual\n   TCP flows rewarded for\
    \ being carried over a PW, this would create an\n   incentive to create PWs for\
    \ no operational reason.  Were individual\n   flows penalized, there would be\
    \ a deterrence that could impede\n   pseudowire deployment.\n   There have been\
    \ proposals to add additional TCP-friendly mechanisms\n   to PWs, for example\
    \ by carrying PWs over DCCP.  In light of the above\n   arguments, it is clear\
    \ that this would force the PW down to the\n   bandwidth of a single flow, rather\
    \ than N flows, and penalize the\n   constituent TCP flows.  In addition, the\
    \ individual TCP flows would\n   still back off due to their endpoints being oblivious\
    \ to the fact\n   that they are carried over a PW.  This would further degrade\
    \ the\n   flow's throughput as compared to a non-PW-encapsulated flow, in\n  \
    \ contradiction to desirable behavior.\n   We have limited our treatment to the\
    \ case of TCP traffic carried by\n   Ethernet PWs (which are by far the most commonly\
    \ deployed packet-\n   carrying pseudowires), but it is not overly difficult to\
    \ show that\n   our result is equally valid for other PW types, such as ATM or\
    \ frame-\n   relay pseudowires.\n"
- title: 4.  PWs Comprising Inelastic Flows
  contents:
  - "4.  PWs Comprising Inelastic Flows\n   Inelastic PWs, such as TDM PWs [RFC4553]\
    \ [RFC5086] [RFC5087], are\n   potentially more problematic than the elastic PWs\
    \ of the previous\n   section.  As mentioned in Section 8 (Congestion Control)\
    \ of\n   [RFC4553], being constant bit rate (CBR), TDM PWs can't incrementally\n\
    \   respond to congestion in a TCP-like fashion.  On the other hand,\n   being\
    \ CBR, TDM PWs do not make things worse by attempting to capture\n   additional\
    \ bandwidth when neighboring TCP flows back off.\n   Since a TDM PW consumes a\
    \ constant amount of bandwidth, if the\n   bandwidth occupied by a TDM PW endangers\
    \ the network as a whole, it\n   might seem that the only recourse is to shut\
    \ it down, denying service\n   to all customers of the TDM native service.  Nonetheless,\
    \ under\n   certain conditions it may be possible to reduce the bandwidth\n  \
    \ consumption of an emulated TDM service.  A prevalent case is that of\n   a TDM\
    \ native service that carries voice channels that may not all be\n   active. \
    \ The ATM Adaptation Layer 2 (AAL2) mode of [RFC5087] (perhaps\n   along with\
    \ connection admission control) can enable bandwidth\n   adaptation, at the expense\
    \ of more sophisticated native service\n   processing (NSP).\n   In the following,\
    \ we will focus on structure-agnostic TDM PWs\n   [RFC4553] although similar analysis\
    \ can be readily applied to\n   structure-aware PWs (see Appendix B).  We will\
    \ show that, for many\n   cases of interest, a TDM PW, even when treated as a\
    \ single flow, will\n   behave in a reasonable manner without any additional mechanisms.\
    \  We\n   also show that, at the level of congestion when a TDM PW can no\n  \
    \ longer deliver acceptable TDM service, a single unconstrained TCP\n   flow would\
    \ typically still consume more capacity than a whole TDM PW.\n   Therefore, to\
    \ ensure that a TDM PW does not inflict significantly\n   more harm than a TCP\
    \ flow, it suffices to shut down a TDM PW that is\n   persistently unable to deliver\
    \ acceptable TDM service.  This shutting\n   down could be accomplished by employing\
    \ a managed transport circuit\n   breaker, by which we mean an automatic mechanism\
    \ for terminating an\n   unresponsive flow during persistently high levels of\
    \ congestion\n   [CIRCUIT-BREAKER].  Note that a transport circuit breaker is\
    \ intended\n   as a protection mechanism of last resort, just as an electrical\n\
    \   circuit breaker is only triggered when absolutely necessary.\n   For the avoidance\
    \ of doubt, the above does not say that a TDM PW\n   should be shut down when\
    \ it becomes TCP-unfriendly.  It merely says\n   that the act of shutting down\
    \ a TDM PW that can no longer deliver\n   acceptable TDM service ensures that\
    \ the PW does not contribute to\n   congestion significantly more than a TCP flow\
    \ would.  Also, note that\n   being unable to deliver acceptable TDM service for\
    \ a short amount of\n   time is insufficient justification for shutting down a\
    \ TDM PW.  While\n   TCP flows react within a round-trip time, service commissioning\
    \ and\n   decommissioning are generally time-consuming processes that should\n\
    \   only be undertaken when it becomes clear that the congestion is not\n   transient.\n\
    \   In order to quantitatively compare TDM PWs to TCP flows, we will\n   compare\
    \ the effect of TDM PW traffic with that of TCP traffic having\n   the same packet\
    \ size and delay.  This is potentially an overly\n   pessimistic comparison, as\
    \ TDM PW packets are frequently configured\n   to be short in order to minimize\
    \ latency, while TCP packets are free\n   to be much larger.\n   There are two\
    \ network parameters relevant to our discussion, namely\n   the one-way delay\
    \ (D) and the packet loss ratio (PLR).  The one-way\n   delay of a native TDM\
    \ service consists of the physical time-of-flight\n   plus 125 microseconds for\
    \ each TDM switch traversed, and is thus very\n   small as compared to typical\
    \ PSN network-crossing latencies.  Since\n   TDM services are designed with this\
    \ low latency in mind, emulated TDM\n   services are usually required to have\
    \ similar low end-to-end delay.\n   In our comparisons, we will only consider\
    \ one-way delays of a few\n   milliseconds.\n   Regarding packet loss, the relevant\
    \ RFCs specify actions to be\n   carried out upon detecting a lost packet.  Structure-agnostic\n\
    \   transport has no alternative to outputting an \"all-ones\" Alarm\n   Indication\
    \ Signal (AIS) pattern towards the TDM circuit, which, when\n   long enough in\
    \ duration, is recognized by the receiving TDM device as\n   a fault indication\
    \ (see Appendix A).  TDM standards (such as [G826])\n   place stringent limits\
    \ on the number of such faults tolerated.\n   Calculations presented in Appendix\
    \ A show that only loss\n   probabilities in the realm of fractions of a percent\
    \ are relevant for\n   structure-agnostic transport.  Structure-aware transport\
    \ regenerates\n   frame alignment signals, thus avoiding AIS indications resulting\
    \ from\n   infrequent packet loss.  Furthermore, for TDM circuits carrying voice\n\
    \   channels, the use of packet loss concealment algorithms is possible\n   (such\
    \ algorithms have been previously described for TDM PWs).\n   However, even structure-aware\
    \ transport ceases to provide a useful\n   service at about 2 percent loss probability.\
    \  Hence, in our\n   comparisons we will only consider PLRs of 1 or 2 percent.\n\
    \   TCP Friendly Rate Control (TFRC) [RFC5348] provides a simplified\n   formula\
    \ for TCP throughput as a function of round-trip delay and\n   packet loss ratio.\n\
    \                                    S\n       X     = ------------------------------------------------\n\
    \                 R  ( sqrt(2p/3) + 12 sqrt(3p/8) p (1+32p^2) )\n   where:\n \
    \     X is the average sending rate in bytes per second,\n      S is the segment\
    \ (packet payload) size in bytes,\n      R is the round-trip time in seconds,\n\
    \      p is the packet loss probability (i.e., PLR/100).\n   We can now compare\
    \ the bandwidth consumed by TDM pseudowires with\n   that of a TCP flow for a\
    \ given packet loss ratio and one-way end-to-\n   end delay (taken to be half\
    \ the round-trip delay R).  The results are\n   depicted in the accompanying figures\
    \ (available only in the PDF\n   version of this document).  In Figures 1 and\
    \ 2, we see the\n   conventional rate vs. packet loss plot for low-rate TDM (both\
    \ T1 and\n   E1) traffic, as well as TCP traffic with the same payload size (64\
    \ or\n   256 bytes respectively).  Since the TDM rates are constant (T1 and E1\n\
    \   having payload throughputs of 1.544 Mbps and 2.048 Mbps\n   respectively),\
    \ and Structure-Agnostic TDM over packet (SAToP) can\n   only faithfully emulate\
    \ a TDM service up to a PLR of about half a\n   percent, the T1 and E1 pseudowires\
    \ occupy line segments on the graph.\n   On the other hand, the TCP rate equation\
    \ produces rate curves\n   dependent on both one-way delay and packet loss.\n\
    \   For large packet sizes, short one-way delays, and low packet loss\n   ratios,\
    \ the TDM pseudowires typically consume much less bandwidth\n   than TCP would\
    \ under identical conditions.  For small packets, long\n   one-way delays, and\
    \ high packet loss ratios, TDM PWs potentially\n   consume more bandwidth, but\
    \ only marginally.  Furthermore, our\n   \"apples to apples\" comparison forced\
    \ the TCP traffic to use packets\n   of sizes smaller than would be typical.\n\
    \   Similarly, in Figures 3 and 4 we repeat the exercise for higher rate\n   E3\
    \ and T3 (rates 34.368 and 44.736 Mbps respectively) pseudowires,\n   allowing\
    \ delays and PLRs suitable for these signals.  We see that the\n   TDM pseudowires\
    \ consume much less bandwidth than TCP, for all\n   reasonable parameter combinations.\n\
    \   --------------------------------------------------------------------\n   I\
    \                                                                  I\n   I   \
    \                                                               I\n   I      \
    \                                                            I\n   I         \
    \                                                         I\n   I            \
    \ E1/T1 PWs vs. TCP for segment size 64B               I\n   I               \
    \                                                   I\n   I                  \
    \                                                I\n   I                     \
    \                                             I\n   I                        \
    \                                          I\n   I                     (only in\
    \ PDF version)                        I\n   I                                \
    \                                  I\n   I                                   \
    \                               I\n   I                                      \
    \                            I\n   I                                         \
    \                         I\n   I                                            \
    \                      I\n   --------------------------------------------------------------------\n\
    \             Figure 1: E1/T1 PWs vs. TCP for Segment Size 64B\n   --------------------------------------------------------------------\n\
    \   I                                                                  I\n   I\
    \                                                                  I\n   I   \
    \                                                               I\n   I      \
    \                                                            I\n   I         \
    \    E1/T1 PWs vs. TCP for segment size 256B              I\n   I            \
    \                                                      I\n   I               \
    \                                                   I\n   I                  \
    \                                                I\n   I                     \
    \                                             I\n   I                     (only\
    \ in PDF version)                        I\n   I                             \
    \                                     I\n   I                                \
    \                                  I\n   I                                   \
    \                               I\n   I                                      \
    \                            I\n   I                                         \
    \                         I\n   --------------------------------------------------------------------\n\
    \             Figure 2: E1/T1 PWs vs. TCP for Segment Size 256B\n   --------------------------------------------------------------------\n\
    \   I                                                                  I\n   I\
    \                                                                  I\n   I   \
    \                                                               I\n   I      \
    \                                                            I\n   I         \
    \    E3/T3 PWs vs. TCP for segment size 536B              I\n   I            \
    \                                                      I\n   I               \
    \                                                   I\n   I                  \
    \                                                I\n   I                     \
    \                                             I\n   I                     (only\
    \ in PDF version)                        I\n   I                             \
    \                                     I\n   I                                \
    \                                  I\n   I                                   \
    \                               I\n   I                                      \
    \                            I\n   I                                         \
    \                         I\n   --------------------------------------------------------------------\n\
    \             Figure 3: E3/T3 PWs vs. TCP for Segment Size 536B\n   --------------------------------------------------------------------\n\
    \   I                                                                  I\n   I\
    \                                                                  I\n   I   \
    \                                                               I\n   I      \
    \                                                            I\n   I         \
    \    E3/T3 PWs vs. TCP for segment size 1024B             I\n   I            \
    \                                                      I\n   I               \
    \                                                   I\n   I                  \
    \                                                I\n   I                     \
    \                                             I\n   I                     (only\
    \ in PDF version)                        I\n   I                             \
    \                                     I\n   I                                \
    \                                  I\n   I                                   \
    \                               I\n   I                                      \
    \                            I\n   I                                         \
    \                         I\n   --------------------------------------------------------------------\n\
    \            Figure 4: E3/T3 PWs vs. TCP for Segment Size 1024B\n   We can use\
    \ the TCP rate equation to determine the precise conditions\n   under which a\
    \ TDM PW consumes no more bandwidth than a TCP flow\n   between the same endpoints\
    \ under identical conditions.  Replacing the\n   round-trip delay with twice the\
    \ one-way delay D, setting the\n   bandwidth to that of the TDM service BW, and\
    \ the segment size to be\n   the TDM fragment (taking into account the PWE3 control\
    \ word), we\n   obtain the following condition for a TDM PW:\n              4\
    \ S\n       D < -----------\n             BW f(p)\n   where:\n      D is the one-way\
    \ delay,\n      S is the TDM segment size (packet excluding overhead) in bytes,\n\
    \      BW is the TDM service bandwidth in bits per second,\n      f(p) = sqrt(2p/3)\
    \ + 12 sqrt(3p/8) p (1+32p^2).\n   One may view this condition as defining a \"\
    friendly\" operating\n   envelope for a TDM PW, as a TDM PW that occupies no more\
    \ bandwidth\n   than a TCP flow causes no more congestion than that TCP flow.\
    \  Under\n   this condition, it is acceptable to place the TDM PW alongside\n\
    \   congestion-responsive traffic such as TCP.  On the other hand, were\n   the\
    \ TDM PW to consume significantly more bandwidth than a TCP flow,\n   it could\
    \ contribute disproportionately to congestion, and its mixture\n   with congestion-responsive\
    \ traffic might be inappropriate.  Note that\n   we are sidestepping any debate\
    \ over the validity of the TCP-\n   friendliness concept and merely saying that\
    \ there can be no question\n   that a TDM PW is acceptable if it causes no more\
    \ congestion than a\n   single TCP flow.\n   We derived this condition assuming\
    \ steady-state conditions, and thus\n   two caveats are in order.  First, the\
    \ condition does not specify how\n   to treat a TDM PW that initially satisfies\
    \ the condition, but is then\n   faced with a deteriorating network environment.\
    \  In such cases, one\n   additionally needs to analyze the reaction times of\
    \ the responsive\n   flows to congestion events.  Second, the derivation assumed\
    \ that the\n   TDM PW was competing with long-lived TCP flows, because under this\n\
    \   assumption it was straightforward to obtain a quantitative comparison\n  \
    \ with something widely considered to offer a safe response to\n   congestion.\
    \  Short-lived TCP flows may find themselves disadvantaged\n   as compared to\
    \ a long-lived TDM PW satisfying the above condition.\n   We see in Figures 5\
    \ and 6 that TDM pseudowires carrying T1 or E1\n   native services satisfy the\
    \ condition for all parameters of interest\n   for large packet sizes (e.g., S=512\
    \ bytes of TDM data).  For the\n   SAToP default of 256 bytes, as long as the\
    \ one-way delay is less than\n   10 milliseconds, the loss probability can exceed\
    \ 0.3 or 0.6 percent.\n   For packets containing 128 or 64 bytes, the constraints\
    \ are more\n   troublesome, but there are still parameter ranges where the TDM\
    \ PW\n   consumes less than a TCP flow under similar conditions.  Similarly,\n\
    \   Figures 7 and 8 demonstrate that E3 and T3 native services with the\n   SAToP\
    \ default of 1024 bytes of TDM per packet satisfy the condition\n   for a broad\
    \ spectrum of delays and PLRs.\n   --------------------------------------------------------------------\n\
    \   I                                                                  I\n   I\
    \                                                                  I\n   I   \
    \                                                               I\n   I      \
    \                                                            I\n   I         \
    \           T1 compatibility regions                      I\n   I            \
    \                                                      I\n   I               \
    \                                                   I\n   I                  \
    \                                                I\n   I                     \
    \                                             I\n   I                     (only\
    \ in PDF version)                        I\n   I                             \
    \                                     I\n   I                                \
    \                                  I\n   I                                   \
    \                               I\n   I                                      \
    \                            I\n   I                                         \
    \                         I\n   --------------------------------------------------------------------\n\
    \              Figure 5: TCP Compatibility Areas for T1 SAToP\n   --------------------------------------------------------------------\n\
    \   I                                                                  I\n   I\
    \                                                                  I\n   I   \
    \                                                               I\n   I      \
    \                                                            I\n   I         \
    \           E1 compatibility regions                      I\n   I            \
    \                                                      I\n   I               \
    \                                                   I\n   I                  \
    \                                                I\n   I                     \
    \                                             I\n   I                     (only\
    \ in PDF version)                        I\n   I                             \
    \                                     I\n   I                                \
    \                                  I\n   I                                   \
    \                               I\n   I                                      \
    \                            I\n   I                                         \
    \                         I\n   --------------------------------------------------------------------\n\
    \              Figure 6: TCP Compatibility Areas for E1 SAToP\n   --------------------------------------------------------------------\n\
    \   I                                                                  I\n   I\
    \                                                                  I\n   I   \
    \                                                               I\n   I      \
    \                                                            I\n   I         \
    \           E3 compatibility regions                      I\n   I            \
    \                                                      I\n   I               \
    \                                                   I\n   I                  \
    \                                                I\n   I                     \
    \                                             I\n   I                     (only\
    \ in PDF version)                        I\n   I                             \
    \                                     I\n   I                                \
    \                                  I\n   I                                   \
    \                               I\n   I                                      \
    \                            I\n   I                                         \
    \                         I\n   --------------------------------------------------------------------\n\
    \              Figure 7: TCP Compatibility Areas for E3 SAToP\n   --------------------------------------------------------------------\n\
    \   I                                                                  I\n   I\
    \                                                                  I\n   I   \
    \                                                               I\n   I      \
    \                                                            I\n   I         \
    \           T3 compatibility regions                      I\n   I            \
    \                                                      I\n   I               \
    \                                                   I\n   I                  \
    \                                                I\n   I                     \
    \                                             I\n   I                     (only\
    \ in PDF version)                        I\n   I                             \
    \                                     I\n   I                                \
    \                                  I\n   I                                   \
    \                               I\n   I                                      \
    \                            I\n   I                                         \
    \                         I\n   --------------------------------------------------------------------\n\
    \              Figure 8: TCP Compatibility Areas for T3 SAToP\n"
- title: 5.  Conclusions
  contents:
  - "5.  Conclusions\n   The figures presented in the previous section demonstrate\
    \ that TDM\n   service quality degradation generally occurs before the TDM PW\
    \ would\n   consume more bandwidth than a comparable TCP flow.  Thus, while TDM\n\
    \   PWs are unable to respond to congestion in a TCP-like fashion, TDM\n   PWs\
    \ that are able to deliver acceptable TDM service do not contribute\n   to congestion\
    \ significantly more than a TCP flow.\n   Combined with our earlier determination\
    \ that Ethernet PWs\n   automatically respond in a TCP-like fashion (see Section\
    \ 3), our\n   final conclusion is that PW-specific congestion-avoidance mechanisms\n\
    \   are generally not required.  This is true even for TDM PWs, assuming\n   that\
    \ the TDM management plane initiates service shutdown when service\n   parameters\
    \ are persistently below levels required by the relevant TDM\n   standards.  If\
    \ the TDM service does not automatically shut down, a\n   mechanism to block persistently\
    \ unacceptable TDM pseudowires is\n   required, or a transport circuit breaker\
    \ [CIRCUIT-BREAKER] may be\n   triggered as a last resort.\n"
- title: 6.  Security Considerations
  contents:
  - "6.  Security Considerations\n   This document does not introduce any new congestion-specific\n\
    \   mechanisms and thus does not introduce any new security\n   considerations\
    \ above those present for PWs in general.\n"
- title: 7.  Informative References
  contents:
  - "7.  Informative References\n   [CIRCUIT-BREAKER]\n              Fairhurst, G.,\
    \ \"Network Transport Circuit Breakers\", Work\n              in Progress, draft-ietf-tsvwg-circuit-breaker-15,\
    \ April\n              2016.\n   [G703]     ITU-T, \"Physical/electrical characteristics\
    \ of\n              hierarchical digital interfaces\", ITU Recommendation\n  \
    \            G.703, April 2016.\n   [G775]     ITU-T, \"Loss of Signal (LOS),\
    \ Alarm Indication Signal\n              (AIS) and Remote Defect Indication (RDI)\
    \ defect detection\n              and clearance criteria for PDH signals\",\n\
    \              ITU Recommendation G.775, October 1998.\n   [G826]     ITU-T, \"\
    Error Performance Parameters and Objectives for\n              International Constant\
    \ Bit Rate Digital Paths at or above\n              Primary Rate\", ITU Recommendation\
    \ G.826, December 2002.\n   [P50App1]  ITU-T, \"Telephone Transmission Quality,\
    \ Telephone\n              Installations, Local Line Networks: Appendix 1\",\n\
    \              ITU-T Recommendation P.50, February 1998.\n   [P800]     ITU-T,\
    \ \"Methods for subjective determination of\n              transmission quality\"\
    , ITU Recommendation P.800, June\n              1998.\n   [P862]     ITU-T, \"\
    Perceptual evaluation of speech quality (PESQ): An\n              objective method\
    \ for end-to-end speech quality assessment\n              of narrow-band telephone\
    \ networks and speech codecs\",\n              ITU Recommendation P.826, February\
    \ 2001.\n   [PACKET-LOSS]\n              Stein, J(Y). and I. Druker, \"The Effect\
    \ of Packet Loss on\n              Voice Quality for TDM over Pseudowires\", Work\
    \ in\n              Progress, draft-stein-pwe3-tdm-packetloss-01, December\n \
    \             2003.\n   [RFC2784]  Farinacci, D., Li, T., Hanks, S., Meyer, D.,\
    \ and P.\n              Traina, \"Generic Routing Encapsulation (GRE)\", RFC 2784,\n\
    \              DOI 10.17487/RFC2784, March 2000,\n              <http://www.rfc-editor.org/info/rfc2784>.\n\
    \   [RFC2914]  Floyd, S., \"Congestion Control Principles\", BCP 41,\n       \
    \       RFC 2914, DOI 10.17487/RFC2914, September 2000,\n              <http://www.rfc-editor.org/info/rfc2914>.\n\
    \   [RFC3031]  Rosen, E., Viswanathan, A., and R. Callon, \"Multiprotocol\n  \
    \            Label Switching Architecture\", RFC 3031,\n              DOI 10.17487/RFC3031,\
    \ January 2001,\n              <http://www.rfc-editor.org/info/rfc3031>.\n   [RFC3931]\
    \  Lau, J., Ed., Townsley, M., Ed., and I. Goyret, Ed.,\n              \"Layer\
    \ Two Tunneling Protocol - Version 3 (L2TPv3)\",\n              RFC 3931, DOI\
    \ 10.17487/RFC3931, March 2005,\n              <http://www.rfc-editor.org/info/rfc3931>.\n\
    \   [RFC3985]  Bryant, S., Ed. and P. Pate, Ed., \"Pseudo Wire Emulation\n   \
    \           Edge-to-Edge (PWE3) Architecture\", RFC 3985,\n              DOI 10.17487/RFC3985,\
    \ March 2005,\n              <http://www.rfc-editor.org/info/rfc3985>.\n   [RFC4023]\
    \  Worster, T., Rekhter, Y., and E. Rosen, Ed.,\n              \"Encapsulating\
    \ MPLS in IP or Generic Routing Encapsulation\n              (GRE)\", RFC 4023,\
    \ DOI 10.17487/RFC4023, March 2005,\n              <http://www.rfc-editor.org/info/rfc4023>.\n\
    \   [RFC4553]  Vainshtein, A., Ed. and YJ. Stein, Ed., \"Structure-\n        \
    \      Agnostic Time Division Multiplexing (TDM) over Packet\n              (SAToP)\"\
    , RFC 4553, DOI 10.17487/RFC4553, June 2006,\n              <http://www.rfc-editor.org/info/rfc4553>.\n\
    \   [RFC5033]  Floyd, S. and M. Allman, \"Specifying New Congestion\n        \
    \      Control Algorithms\", BCP 133, RFC 5033,\n              DOI 10.17487/RFC5033,\
    \ August 2007,\n              <http://www.rfc-editor.org/info/rfc5033>.\n   [RFC5086]\
    \  Vainshtein, A., Ed., Sasson, I., Metz, E., Frost, T., and\n              P.\
    \ Pate, \"Structure-Aware Time Division Multiplexed (TDM)\n              Circuit\
    \ Emulation Service over Packet Switched Network\n              (CESoPSN)\", RFC\
    \ 5086, DOI 10.17487/RFC5086, December 2007,\n              <http://www.rfc-editor.org/info/rfc5086>.\n\
    \   [RFC5087]  Stein, Y(J)., Shashoua, R., Insler, R., and M. Anavi,\n       \
    \       \"Time Division Multiplexing over IP (TDMoIP)\", RFC 5087,\n         \
    \     DOI 10.17487/RFC5087, December 2007,\n              <http://www.rfc-editor.org/info/rfc5087>.\n\
    \   [RFC5348]  Floyd, S., Handley, M., Padhye, J., and J. Widmer, \"TCP\n    \
    \          Friendly Rate Control (TFRC): Protocol Specification\",\n         \
    \     RFC 5348, DOI 10.17487/RFC5348, September 2008,\n              <http://www.rfc-editor.org/info/rfc5348>.\n"
- title: Appendix A.  Loss Probabilities for TDM PWs
  contents:
  - "Appendix A.  Loss Probabilities for TDM PWs\n   ITU-T Recommendation G.826 [G826]\
    \ specifies limits on the Errored\n   Second Ratio (ESR) and the Severely Errored\
    \ Second Ratio (SESR).  For\n   our purposes, we will simplify the definitions\
    \ and understand an\n   Errored Second (ES) to be a second of time during which\
    \ a TDM bit\n   error occurred or a defect indication was detected.  A Severely\n\
    \   Errored Second (SES) is an ES second during which the Bit Error Rate\n   (BER)\
    \ exceeded one in one thousand (10^-3).  Note that if the error\n   condition\
    \ AIS was detected according to the criteria of ITU-T\n   Recommendation G.775\
    \ [G775], an SES was considered to have occurred.\n   The respective ratios are\
    \ the fraction of ES or SES to the total\n   number of seconds in the measurement\
    \ interval.\n   All TDM signals run at 8000 frames per second (higher rate TDM\n\
    \   signals have longer frames).  So, assuming an integer number of TDM\n   frames\
    \ per TDM PW packet, the number of packets per second is given\n   by packets\
    \ per second = 8000 / (frames per packet).  Prevalent cases\n   are 1, 2, 4, and\
    \ 8 frames per packet, translating to 8000, 4000,\n   2000, and 1000 packets per\
    \ second, respectively.\n   For both E1 and T1 TDM circuits, G.826 allows an ESR\
    \ of 4% (0.04),\n   and an SESR of 0.2% (0.002).  For E3 and T3, the ESR must\
    \ be no more\n   than 7.5% (0.075), while the SESR is unchanged.  Focusing on\
    \ E1\n   circuits, the ESR of 4% translates (assuming the worst case of\n   isolated\
    \ exactly periodic packet loss) to a packet loss event no more\n   than every\
    \ 25 seconds.  However, once a packet is lost, another\n   packet lost in the\
    \ same second doesn't change the ESR, although it\n   may contribute to the ES\
    \ becoming an SES.  Thus for 1, 2, 4, and 8\n   frames per packet, the maximum\
    \ allowed packet loss probability is\n   0.0005%, 0.001%, 0.002%, and 0.004% respectively.\n\
    \   These extremely low allowed packet loss probabilities are only for\n   the\
    \ worst case scenario.  With tail-drop buffers, when packet loss is\n   above\
    \ 0.001%, it is likely that loss bursts will occur.  If the lost\n   packets are\
    \ sufficiently close together (we ignore the precise\n   details here), then the\
    \ permitted packet loss ratio increases by the\n   appropriate factor, without\
    \ G.826 being cognizant of any change.\n   Hence, the worst-case analysis is expected\
    \ to be extremely\n   pessimistic for real networks.  Next, we will consider the\
    \ opposite\n   extreme and assume that all packet loss events are in periodic\
    \ loss\n   bursts.  In order to minimize the ESR, we will assume that the burst\n\
    \   lasts no more than one second, and so we can afford to lose in each\n   burst\
    \ no more than the number of packets transmitted in one second.\n   As long as\
    \ such one-second bursts do not exceed four percent of the\n   time, we still\
    \ maintain the allowable ESR.  Hence, the maximum\n   permissible packet loss\
    \ ratio is 4%.  Of course, this estimate is\n   extremely optimistic, and furthermore\
    \ does not take into\n   consideration the SESR criteria.\n   As previously explained,\
    \ an SES is declared whenever AIS is detected.\n   There is a major difference\
    \ between structure-aware and structure-\n   agnostic transport in this regards.\
    \  When a packet is lost, SAToP\n   outputs an \"all-ones\" pattern to the TDM\
    \ circuit, which is\n   interpreted as AIS according to G.775 [G775].  For E1\
    \ circuits, G.775\n   specifies that AIS is detected when four consecutive TDM\
    \ frames have\n   no more than 2 alternations.  This means that if a PW packet\
    \ or\n   consecutive packets containing at least four frames are lost, and\n \
    \  four or more frames of \"all-ones\" output to the TDM circuit, an SES\n   will\
    \ be declared.  Thus burst packet loss, or packets containing a\n   large number\
    \ of TDM frames, lead SAToP to cause high SESR, which is\n   20 times more restricted\
    \ than ESR.  On the other hand, since\n   structure-aware transport regenerates\
    \ the correct frame alignment\n   pattern, even when the corresponding packet\
    \ has been lost, packet\n   loss will not cause declaration of SES.  This is the\
    \ main reason that\n   SAToP is much more vulnerable to packet loss than the structure-aware\n\
    \   methods.\n   For realistic networks, the maximum allowed packet loss for SAToP\n\
    \   will be intermediate between the extremely pessimistic estimates and\n   the\
    \ extremely optimistic ones.  In order to numerically gauge the\n   situation,\
    \ we have modeled the network as a four-state Markov model,\n   (corresponding\
    \ to a successfully received packet, a packet received\n   within a loss burst,\
    \ a packet lost within a burst, and a packet lost\n   when not within a burst).\
    \  This model is an extension of the widely\n   used Gilbert model.  We set the\
    \ transition probabilities in order to\n   roughly correspond to anecdotal evidence,\
    \ namely low background\n   isolated packet loss, and infrequent bursts wherein\
    \ most packets are\n   lost.  Such simulation shows that up to 0.5% average packet\
    \ loss may\n   occur and the recovered TDM still conforms to the G.826 ESR and\
    \ SESR\n   criteria.\n"
- title: Appendix B.  Effect of Packet Loss on Voice Quality for Structure-Aware
  contents:
  - "Appendix B.  Effect of Packet Loss on Voice Quality for Structure-Aware\n   \
    \          TDM PWs\n   Packet loss in voice traffic causes audio artifacts such\
    \ as choppy,\n   annoying, or even unintelligible speech.  The precise effect\
    \ of\n   packet loss on voice quality has been the subject of detailed study\n\
    \   in the Voice over IP (VoIP) community, but VoIP results are not\n   directly\
    \ applicable to TDM PWs.  This is because VoIP packets\n   typically contain over\
    \ 10 milliseconds of the speech signal, while\n   multichannel TDM packets may\
    \ contain only a single sample, or perhaps\n   a very small number of samples.\n\
    \   The effect of packet loss on TDM PWs has been previously reported\n   [PACKET-LOSS].\
    \  In that study, it was assumed that each packet\n   carried a single sample\
    \ of each TDM timeslot (although the extension\n   to multiple samples is relatively\
    \ straightforward and does not\n   drastically change the results).  Four sample\
    \ replacement algorithms\n   were compared, differing in the value used to replace\
    \ the lost\n   sample:\n   1.  Replacing every lost sample by a preselected constant\
    \ (e.g., zero\n       or \"AIS\" insertion).\n   2.  Replacing a lost sample by\
    \ the previous sample.\n   3.  Replacing a lost sample by linear interpolation\
    \ between the\n       previous and following samples.\n   4.  Replacing the lost\
    \ sample by STatistically Enhanced INterpolation\n       (STEIN).\n   Only the\
    \ first method is applicable to SAToP transport, as structure\n   awareness is\
    \ required in order to identify the individual voice\n   channels.  For structure-aware\
    \ transport, the loss of a packet is\n   typically identified by the receipt of\
    \ the following packet, and thus\n   the following sample is usually available.\
    \  The last algorithm posits\n   the Linear-Predictive Coding (LPC) speech generation\
    \ model and\n   derives lost samples based on available samples both before and\
    \ after\n   each lost sample.\n   The four algorithms were compared in a controlled\
    \ experiment in which\n   speech data was selected from English and American English\
    \ subsets of\n   the ITU-T P.50 Appendix 1 corpus [P50App1] and consisted of 16\n\
    \   speakers, eight male and eight female.  Each speaker spoke either\n   three\
    \ or four sentences, for a total of between seven and 15 seconds.\n   The selected\
    \ files were filtered to telephony quality using modified\n   IRS filtering and\
    \ down-sampled to 8 kHz.  Packet loss of 0, 0.25,\n   0.5, 0.75, 1, 2, 3, 4, and\
    \ 5 percent were simulated using a uniform\n   random number generator (bursty\
    \ packet loss was also simulated but is\n   not reported here).  For each file,\
    \ the four methods of lost sample\n   replacement were applied and the Mean Opinion\
    \ Score (MOS) was\n   estimated using PESQ [P862].  Figure 9 depicts the PESQ-derived\
    \ MOS\n   for each of the four replacement methods for packet drop\n   probabilities\
    \ up to 5%.\n   --------------------------------------------------------------------\n\
    \   I                                                                  I\n   I\
    \                                                                  I\n   I   \
    \                                                               I\n   I      \
    \                                                            I\n   I         \
    \                                                         I\n   I            \
    \                                                      I\n   I     PESQ-MOS as\
    \ a function of packet drop probability            I\n   I                   \
    \                                               I\n   I                      \
    \                                            I\n   I                         \
    \                                         I\n   I                            \
    \                                      I\n   I                     (only in PDF\
    \ version)                        I\n   I                                    \
    \                              I\n   I                                       \
    \                           I\n   I                                          \
    \                        I\n   I                                             \
    \                     I\n   I                                                \
    \                  I\n   I                                                   \
    \               I\n   I                                                      \
    \            I\n   --------------------------------------------------------------------\n\
    \    Figure 9: PESQ-Derived MOS as a Function of Packet-Drop Probability\n   For\
    \ all cases, the MOS resulting from the use of zero insertion is\n   less than\
    \ that obtained by replacing with the previous sample, which\n   in turn is less\
    \ than that of linear interpolation, which is slightly\n   less than that obtained\
    \ by statistical interpolation.\n   Unlike the artifacts that speech compression\
    \ methods may produce when\n   subject to buffer loss, packet loss here effectively\
    \ produces\n   additive white impulse noise.  The subjective impression is that\
    \ of\n   static noise on AM radio stations or crackling on old phonograph\n  \
    \ records.  For a given PESQ-derived MOS, this type of degradation is\n   more\
    \ acceptable to listeners than choppiness or tones common in VoIP.\n   If MOS>4\
    \ (full toll quality) is required, then the following packet\n   drop probabilities\
    \ are allowable:\n      zero insertion - 0.05%\n      previous sample - 0.25%\n\
    \      linear interpolation - 0.75%\n      STEIN - 2%\n   If MOS>3.75 (barely\
    \ perceptible quality degradation) is acceptable,\n   then the following packet\
    \ drop probabilities are allowable:\n      zero insertion - 0.1%\n      previous\
    \ sample - 0.75%\n      linear interpolation - 3%\n      STEIN - 6.5%\n   If MOS>3.5\
    \ (cell phone quality) is tolerable, then the following\n   packet drop probabilities\
    \ are allowable:\n      zero insertion - 0.4%\n      previous sample - 2%\n  \
    \    linear interpolation - 8%\n      STEIN - 14%\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Yaakov (Jonathan) Stein\n   RAD Data Communications\n\
    \   24 Raoul Wallenberg St., Bldg C\n   Tel Aviv  69719\n   Israel\n   Phone:\
    \ +972 (0)3 645-5389\n   Email: yaakov_s@rad.com\n   David L. Black\n   EMC Corporation\n\
    \   176 South St.\n   Hopkinton, MA  69719\n   United States\n   Phone: +1 (508)\
    \ 293-7953\n   Email: david.black@emc.com\n   Bob Briscoe\n   BT\n   Email: ietf@bobbriscoe.net\n\
    \   URI:   http://bobbriscoe.net/\n"
