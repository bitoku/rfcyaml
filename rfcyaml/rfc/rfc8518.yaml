- contents:
  - '       Selection of Loop-Free Alternates for Multi-Homed Prefixes

    '
  title: __initial_text__
- contents:
  - "Abstract\n   Deployment experience gained from implementing algorithms to\n   determine
    Loop-Free Alternates (LFAs) for multi-homed prefixes (MHPs)\n   has revealed some
    avenues for potential improvement.  This document\n   provides explicit inequalities
    that can be used to evaluate neighbors\n   as potential alternates for MHPs.  It
    also provides detailed criteria\n   for evaluating potential alternates for external
    prefixes advertised\n   by OSPF ASBRs.  This document updates Section 6 of RFC
    5286 by\n   expanding some of the routing aspects.\n"
  title: Abstract
- contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This
    document is a product of the Internet Engineering Task Force\n   (IETF).  It represents
    the consensus of the IETF community.  It has\n   received public review and has
    been approved for publication by the\n   Internet Engineering Steering Group (IESG).
    \ Further information on\n   Internet Standards is available in Section 2 of RFC
    7841.\n   Information about the current status of this document, any errata,\n
    \  and how to provide feedback on it may be obtained at\n   https://www.rfc-editor.org/info/rfc8518.\n"
  title: Status of This Memo
- contents:
  - "Copyright Notice\n   Copyright (c) 2019 IETF Trust and the persons identified
    as the\n   document authors.  All rights reserved.\n   This document is subject
    to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n
    \  (https://trustee.ietf.org/license-info) in effect on the date of\n   publication
    of this document.  Please review these documents\n   carefully, as they describe
    your rights and restrictions with respect\n   to this document.  Code Components
    extracted from this document must\n   include Simplified BSD License text as described
    in Section 4.e of\n   the Trust Legal Provisions and are provided without warranty
    as\n   described in the Simplified BSD License.\n"
  title: Copyright Notice
- contents:
  - "Table of Contents\n   1. Introduction ....................................................3\n
    \     1.1. Acronyms ...................................................4\n      1.2.
    Requirements Language ......................................4\n   2. LFA Inequalities
    for MHPs .......................................4\n   3. LFA Selection for MHPs
    ..........................................6\n      3.1. Improved Coverage with
    Simplified Approach to MHPs .........7\n      3.2. IS-IS ATT Bit Considerations
    ...............................9\n   4. LFA Selection for Multi-Homed External
    Prefixes ................10\n      4.1. IS-IS .....................................................10\n
    \     4.2. OSPF ......................................................10\n           4.2.1.
    Rules to Select Alternate ASBRs ....................10\n               4.2.1.1.
    Multiple ASBRs Belonging to Different Areas ..12\n               4.2.1.2. Type
    1 and Type 2 Costs ......................12\n               4.2.1.3. RFC1583Compatibility
    is Set to \"Enabled\" .....12\n               4.2.1.4. Type 7 Routes ................................13\n
    \          4.2.2. Inequalities to Be Applied for Alternate ASBR\n                  Selection
    ..........................................13\n               4.2.2.1. Forwarding
    Address Set to Non-zero Value .....13\n               4.2.2.2. ASBRs Advertising
    Type 1 and Type 2 Costs ....14\n   5. LFA Extended Procedures ........................................15\n
    \     5.1. Links with IGP MAX_METRIC .................................15\n      5.2.
    MT Considerations .........................................16\n   6. IANA Considerations
    ............................................16\n   7. Security Considerations
    ........................................17\n   8. References .....................................................17\n
    \     8.1. Normative References ......................................17\n      8.2.
    Informative References ....................................17\n   Acknowledgements
    ..................................................19\n   Contributors ......................................................19\n
    \  Authors' Addresses ................................................20\n"
  title: Table of Contents
- contents:
  - "1.  Introduction\n   A framework for the development of IP Fast Reroute (FRR)
    mechanisms\n   is detailed in [RFC5714].  The use of LFAs for IP FRR is specified
    in\n   [RFC5286].  If a prefix is advertised by more than one router, that\n   prefix
    is called a \"multi-homed prefix (MHP)\".  MHPs generally occur\n   for prefixes
    obtained from outside the routing domain by multiple\n   routers, for subnets
    on links where the subnet is announced from\n   multiple ends of the link, and
    for prefixes advertised by multiple\n   routers to provide resiliency.\n   Section
    6.1 of [RFC5286] describes a method to determine LFAs for\n   MHPs.  This document
    describes a procedure using explicit\n   inequalities that can be used by a computing
    router to evaluate a\n   neighbor as a potential alternate for an MHP.  The results
    obtained\n   are equivalent to those obtained using the method described in\n
    \  Section 6.1 of [RFC5286].\n   Section 6.3 of [RFC5286] discusses complications
    associated with\n   computing LFAs for MHPs in OSPF.  This document provides detailed\n
    \  criteria for evaluating potential alternates for external prefixes\n   advertised
    by OSPF ASBRs, as well as explicit inequalities.\n   This document also provides
    clarifications and additional\n   considerations to [RFC5286] to address a few
    coverage and operational\n   observations.  These observations are concerned with
    1) the IS-IS ATT\n   (attach) bit in the Level 1 (L1) area, 2) links provisioned
    with\n   MAX_METRIC (see Section 5.1) for traffic engineering (TE) purposes,\n
    \  and 3) multi-topology (MT) IGP deployments.  These are elaborated in\n   detail
    in Sections 3.2 and 5.\n   This specification uses the same terminology introduced
    in [RFC5714]\n   to represent LFA and builds on the notation for inequalities
    used in\n   [RFC5286] to compute LFAs for MHPs.\n"
  - contents:
    - "1.1.  Acronyms\n   AF      -  Address Family\n   ATT     -  IS-IS Attach Bit\n
      \  ECMP    -  Equal-Cost Multipath\n   FRR     -  Fast Reroute\n   IGP     -
      \ Interior Gateway Protocol\n   IS-IS   -  Intermediate System to Intermediate
      System\n   LFA     -  Loop-Free Alternate\n   LSP     -  Link State PDU (IS-IS)\n
      \  MHP     -  Multi-Homed Prefix\n   MT      -  Multi-Topology\n   OSPF    -
      \ Open Shortest Path First\n   SPF     -  Shortest Path First\n"
    title: 1.1.  Acronyms
  - contents:
    - "1.2.  Requirements Language\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\",
      \"SHALL\", \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"NOT
      RECOMMENDED\", \"MAY\", and\n   \"OPTIONAL\" in this document are to be interpreted
      as described in\n   BCP 14 [RFC2119] [RFC8174] when, and only when, they appear
      in all\n   capitals, as shown here.\n"
    title: 1.2.  Requirements Language
  title: 1.  Introduction
- contents:
  - "2.  LFA Inequalities for MHPs\n   This document proposes the following set of
    LFA inequalities for\n   selecting the most appropriate LFAs for MHPs.  Distance_opt(X,Y)\n
    \  (called \"D_opt(X,Y)\" in this document) is defined in [RFC5714] and is\n   nothing
    but the metric sum of the shortest path from X to Y.\n   Cost(X,Y), introduced
    in this document, is defined as the metric\n   value of prefix Y from the prefix
    advertising node X.  These LFAs can\n   be derived from the inequalities in [RFC5286]
    combined with the\n   observation that D_opt(N,P) = Min (D_opt(N,PO_i) + Cost(PO_i,P))
    over\n   all PO_i.\n   Link-Protecting LFAs:\n      A neighbor N can provide an
    LFA if and only if\n      D_opt(N,PO_i)+ Cost(PO_i,P) < D_opt(N,S) +\n                                    D_opt(S,PO_best)
    + Cost(PO_best,P)\n   Link-Protecting + Downstream-paths-only LFAs:\n      A subset
    of loop-free alternates are downstream paths that must\n      meet a more restrictive
    condition that is applicable to more\n      complex failure scenarios.\n      D_opt(N,PO_i)+
    Cost(PO_i,P) < D_opt(S,PO_best) + Cost(PO_best,P)\n   Node-Protecting LFAs:\n
    \     For an alternate next hop N to protect against node failure of a\n      primary
    neighbor E for MHP P, N must be loop-free with respect to\n      both E and MHP
    P.  In other words, N's path to MHP P must not go\n      through E (where N is
    the neighbor providing a loop-free\n      alternate).\n      D_opt(N,PO_i)+ Cost(PO_i,P)
    < D_opt(N,E) +\n                                    D_opt(E,PO_best) + Cost(PO_best,P)\n
    \     Where:\n      P           -  The MHP being evaluated for computing alternates\n
    \     S           -  The computing router\n      N           -  The alternate
    router being evaluated\n      E           -  The primary next hop on the shortest
    path from S to\n                     prefix P\n      PO_i        -  The specific
    prefix-originating router being\n                     evaluated\n      PO_best
    \    -  The prefix-originating router on the shortest path\n                     from
    the computing router S to prefix P\n      Cost(X,P)   -  The cost of reaching
    the prefix P from prefix\n                     originating node X\n      D_opt(X,Y)
    \ -  The distance on the shortest path from node X to\n                     node
    Y\n"
  title: 2.  LFA Inequalities for MHPs
- contents:
  - "3.  LFA Selection for MHPs\n   To compute a valid LFA for a given MHP P, a computing
    router S MUST,\n   for each alternate neighbor N, follow one of the appropriate\n
    \  procedures below once for each remote node that originated the prefix\n   P.\n
    \  Link-Protecting LFAs:\n   1.  If, in addition to being an alternate neighbor,
    N is also a\n       prefix originator of P,\n       A.  Select N as an LFA for
    prefix P (irrespective of the metric\n           advertised by N for the prefix
    P).\n   2.  Else, evaluate the link-protecting LFA inequality for P with N as\n
    \      the alternate neighbor.\n       A.  If the LFA inequality condition is
    met, select N as an LFA\n           for prefix P.\n       B.  Else, N is not an
    LFA for prefix P.\n   Link-Protecting + Downstream-paths-only LFAs:\n   1.  Evaluate
    the link-protecting + downstream-paths-only LFA\n       inequality for P with
    N as the alternate neighbor.\n       A.  If the LFA inequality condition is met,
    select N as an LFA\n           for prefix P.\n       B.  Else, N is not an LFA
    for prefix P.\n   Node-Protecting LFAs:\n   1.  If, in addition to being an alternate
    neighbor, N is also a\n       prefix originator of P,\n       A.  Select N as
    an LFA for prefix P (irrespective of the metric\n           advertised by N for
    the prefix P).\n   2.  Else, evaluate the appropriate node-protecting LFA inequality
    for\n       P with N as the alternate neighbor.\n       A.  If the LFA inequality
    condition is met, select N as an LFA\n           for prefix P.\n       B.  Else,
    N is not an LFA for prefix P.\n   If an alternate neighbor N is also one of the
    prefix originators of\n   prefix P, it is guaranteed that N will not loop back
    packets destined\n   for prefix P to computing router S.  Therefore, N MUST be
    chosen as a\n   valid LFA for prefix P without evaluating any of the inequalities
    in\n   Section 2 as long as a downstream-paths-only LFA is not desired.  To\n
    \  ensure such a neighbor N also provides a downstream-paths-only LFA,\n   router
    S MUST also evaluate the downstream-paths-only LFA inequality\n   specified in
    Section 2 for neighbor N and ensure router N satisfies\n   the inequality.\n   However,
    if N is not a prefix originator of P, the computing router\n   MUST evaluate one
    of the corresponding LFA inequalities defined in\n   Section 2 once for each remote
    node that originated the prefix.  If\n   the inequality is satisfied by the neighbor
    N, router S MUST choose\n   neighbor N as one of the valid LFAs for the prefix
    P.\n   For more specific rules, please refer to Section 4.\n"
  - contents:
    - "3.1.  Improved Coverage with Simplified Approach to MHPs\n   Section 6.1 of
      the LFA base specification [RFC5286] recommends that a\n   router computes the
      alternate next hop for an IGP MHP by considering\n   alternate paths via all
      routers that have announced that prefix.  The\n   same has been elaborated with
      appropriate inequalities in the\n   previous section.  However, Section 6.1
      of [RFC5286] also allows for\n   the router to simplify the MHP calculation
      by assuming that the MHP\n   is solely attached to the router that was its pre-failure
      optimal\n   point of attachment, at the expense of potentially lower coverage.\n
      \  If an implementation chooses to simplify the MHP calculation by\n   assuming
      that the MHP is solely attached to the router that was its\n   pre-failure optimal
      point of attachment, the procedure described in\n   this memo can potentially
      improve coverage for ECMP MHPs without\n   incurring extra computational cost.\n
      \  This document improves the above approach to provide loop-free\n   alternatives
      without any additional cost for ECMP MHPs as described\n   in the example network
      presented in Figure 1.  The approach specified\n   here may also be applicable
      for handling default routes as explained\n   in Section 3.2.\n                         5
      \  +---+  8   +---+  5  +---+\n                       +-----| S |------| A |-----|
      B |\n                       |     +---+      +---+     +---+\n                       |
      \      |                    |\n                       |     5 |                  5
      |\n                       |       |                    |\n                     +---+
      5 +---+   4 +---+  1    +---+\n                     | C |---| E |-----| M |-------|
      F |\n                     +---+   +---+     +---+       +---+\n                               |
      \  10           5    |\n                               +-----------P---------+\n
      \                  Figure 1: MHP with Same ECMP Next Hop\n   In Figure 1, a
      prefix P is advertised from both node E and node F.\n   With a simplified approach
      taken as specified in Section 6.1 of\n   [RFC5286], prefix P will get only a
      link-protecting LFA through the\n   neighbor C while a node-protection path
      is available through neighbor\n   A.  In this scenario, E and F both are pre-failure
      optimal points of\n   attachment and share the same primary next hop.  Hence,
      an\n   implementation MAY compare the kind of protection A provides to F\n   (link
      and node protection) with the kind of protection C provides to\n   E (link protection)
      and inherit the better alternative to prefix P.\n   In this case, the better
      alternative is A.\n   However, in the example network presented in Figure 2,
      prefix P has\n   an ECMP through both node E and node F with cost 20.  Though
      it has\n   two pre-failure optimal points of attachment, the primary next hop
      to\n   each pre-failure optimal point of attachment is different.  In this\n
      \  case, prefix P MUST inherit the corresponding LFAs of each primary\n   next
      hop calculated for the router advertising the same.  In\n   Figure 2, that would
      be the LFA for node E and node F, i.e., node N1\n   and node N2, respectively.\n
      \                                          4      +----+\n                               +------------------|
      N2 |\n                               |                  +----+\n                               |
      \                   | 4\n                        10   +---+         3      +---+\n
      \                     +------| S |----------------| B |\n                      |
      \     +---+                +---+\n                      |        |                    |\n
      \                     |     10 |                  1 |\n                      |
      \       |                    |\n                   +----+ 5  +---+        16
      \      +---+\n                   | N1 |----| E |-----------------| F |\n                   +----+
      \   +---+                 +---+\n                               |   10          16
      \   |\n                               +-----------P---------+\n                Figure
      2: MHP with Different ECMP Next Hops\n   In summary, if there are multiple pre-failure
      points of attachment\n   for an MHP, and the primary next hop of an MHP is the
      same as that of\n   the primary next hop of the router that was the pre-failure
      optimal\n   point of attachment, an implementation MAY provide a better\n   protection
      to the MHP without incurring any additional computation\n   cost.\n"
    title: 3.1.  Improved Coverage with Simplified Approach to MHPs
  - contents:
    - "3.2.  IS-IS ATT Bit Considerations\n   Per [RFC1195], a default route needs
      to be added in the Level 1 (L1)\n   router to the closest reachable Level 1
      / Level 2 (L1/L2) router in\n   the network advertising the ATT (attach) bit
      in its LSP-0 fragment.\n   All L1 routers in the area would do this during the
      decision process\n   with the next hop of the default route set to the adjacent
      router\n   through which the closest L1/L2 router is reachable.  The LFA base\n
      \  specification [RFC5286] does not specify any procedure for computing\n   LFA
      for a default route in the IS-IS L1 area.  This document\n   specifies that
      a node can consider a default route is being\n   advertised from the border
      L1/L2 router where the ATT bit is set and\n   can do LFA computation for that
      default route.  But, when multiple\n   ECMP L1/L2 routers are reachable in an
      L1 area, corresponding best\n   LFAs SHOULD be computed for each primary next
      hop associated with the\n   default route as this would be similar to the ECMP
      MHP example\n   described in Section 3.1.  Considerations specified in Sections
      3 and\n   3.1 are applicable for default routes if the default route is\n   considered
      an ECMP MHP.  Note that this document doesn't alter any\n   ECMP handling rules
      or computation of LFAs for ECMP in general as\n   laid out in [RFC5286].\n"
    title: 3.2.  IS-IS ATT Bit Considerations
  title: 3.  LFA Selection for MHPs
- contents:
  - "4.  LFA Selection for Multi-Homed External Prefixes\n   Redistribution of external
    routes into IGP is required 1) when two\n   different networks get merged into
    one or 2) during protocol\n   migrations.\n   During LFA calculation, alternate
    LFA next hops to reach the best\n   ASBR could be used as LFA for the routes redistributed
    via that ASBR.\n   When there is no LFA available to the best ASBR, it may be
    desirable\n   to consider the other ASBRs (referred to as \"alternate ASBRs\"\n
    \  hereafter) redistributing the external routes for LFA selection as\n   defined
    in [RFC5286] and leverage the advantage of having multiple\n   redistributing
    nodes in the network.\n"
  - contents:
    - "4.1.  IS-IS\n   LFA evaluation for multi-homed external prefixes in IS-IS is
      the same\n   as the multi-homed internal prefixes.  Inequalities described in\n
      \  Section 2 would also apply to multi-homed external prefixes.\n"
    title: 4.1.  IS-IS
  - contents:
    - "4.2.  OSPF\n   The LFA base specification [RFC5286] describes mechanisms to
      apply\n   inequalities to find the loop-free alternate neighbor.  Additional\n
      \  rules have to be applied in selecting the alternate ASBR for LFA\n   consideration
      due to the external route calculation rules imposed by\n   [RFC2328].\n   This
      document defines inequalities specifically for alternate loop-\n   free ASBR
      evaluation.  These inequalities are based on those in\n   [RFC5286].\n"
    - contents:
      - "4.2.1.  Rules to Select Alternate ASBRs\n   The process to select an alternate
        ASBR is best explained using the\n   rules below.  The process below is applied
        when a primary ASBR for\n   the concerned prefix is chosen and there is an
        alternate ASBR\n   originating the same prefix.\n   1.  If RFC1583Compatibility
        is disabled:\n       A.  If primary ASBR and alternate ASBR belong to intra-area\n
        \          non-backbone, go to step 2.\n       B.  If primary ASBR and alternate
        ASBR belong to intra-area\n           backbone and/or inter-area path, go
        to step 2.\n       C.  For other paths, skip this alternate ASBR and consider
        next\n           ASBR.\n   2.  Compare cost types (type 1 / type 2) advertised
        by alternate ASBR\n       and primary ASBR:\n       A.  If not the same type,
        skip alternate ASBR and consider next\n           ASBR.\n       B.  If the
        same, proceed to step 3.\n   3.  If cost types are type 1, compare costs advertised
        by alternate\n       ASBR and primary ASBR:\n       A.  If costs are the same,
        then program ECMP FRR and return.\n       B.  Else, go to step 5.\n   4.  If
        cost types are type 2, compare costs advertised by alternate\n       ASBR
        and primary ASBR:\n       A.  If costs are different, skip alternate ASBR
        and consider next\n           ASBR.\n       B.  If costs are the same, proceed
        to step 4C to compare costs to\n           reach ASBR/forwarding address.\n
        \      C.  If costs to reach ASBR/forwarding address are also the same,\n
        \          program ECMP FRR and return.\n       D.  If costs to reach ASBR/forwarding
        address are different, go\n           to step 5.\n   5.  Compare route types
        (type 5 and type 7) for alternate ASBR and\n       primary ASBR:\n       A.
        \ If route types are the same, check if route p-bit and\n           forwarding
        address field for routes from both ASBRs match.\n           If p-bit and forwarding
        address match, proceed to step 6.  If\n           not, skip this alternate
        ASBR and consider next ASBR.\n       B.  If route types are not the same,
        skip this alternate ASBR and\n           consider next alternate ASBR.\n   6.
        \ Apply inequality on alternate ASBR.\n"
      - contents:
        - "4.2.1.1.  Multiple ASBRs Belonging to Different Areas\n   When RFC1583Compatibility
          is set to \"disabled\", OSPF [RFC2328]\n   defines certain rules of preference
          to choose the ASBRs.  While\n   selecting an alternate ASBR for loop evaluation
          for LFA, these rules\n   should be applied to ensure that the alternate
          neighbor does not\n   cause looping.\n   When there are multiple ASBRs belonging
          to different areas\n   advertising the same prefix, pruning rules as defined
          in Section 16.4\n   of [RFC2328] are applied.  The alternate ASBRs pruned
          using these\n   rules are not considered for LFA evaluation.\n"
        title: 4.2.1.1.  Multiple ASBRs Belonging to Different Areas
      - contents:
        - "4.2.1.2.  Type 1 and Type 2 Costs\n   If there are multiple ASBRs not pruned
          via the rules described in\n   Section 4.2.1.1, the cost type advertised
          by the ASBRs is compared.\n   ASBRs advertising type 1 costs are preferred,
          and the type 2 costs\n   are pruned.  If two ASBRs advertise the same type
          2 cost, the\n   alternate ASBRs are considered along with their cost to
          reach the\n   ASBR/forwarding address for evaluation.  If the two ASBRs
          have the\n   same type 2 cost as well as the same cost to reach the ASBR,
          ECMP FRR\n   is programmed.  When there are multiple ASBRs advertising the
          same\n   type 2 cost for the prefix, primary Autonomous System (AS) external\n
          \  route calculation, as described in Section 16.4.1 of [RFC2328],\n   selects
          the route with the lowest type 2 cost.  ASBRs advertising a\n   different
          type 2 cost (higher cost) are not considered for LFA\n   evaluation.  Alternate
          ASBRs advertising a type 2 cost for the prefix\n   but not chosen as primary
          due to a higher cost to reach ASBR are\n   considered for LFA evaluation.
          \ The inequalities for evaluating\n   alternate ASBR for type 1 and type
          2 costs are same, as the alternate\n   ASBRs with different type 2 costs
          are pruned and the evaluation is\n   based on ASBRS with equal type 2 costs.\n"
        title: 4.2.1.2.  Type 1 and Type 2 Costs
      - contents:
        - "4.2.1.3.  RFC1583Compatibility is Set to \"Enabled\"\n   When RFC1583Compatibility
          is set to \"enabled\", multiple ASBRs\n   belonging to different areas advertising
          the same prefix are chosen\n   based on cost and hence are valid alternate
          ASBRs for the LFA\n   evaluation.  The inequalities described in Section
          4.2.2 are\n   applicable based on forwarding address and cost type advertised
          in\n   the external Link State Advertisement (LSA).\n"
        title: 4.2.1.3.  RFC1583Compatibility is Set to "Enabled"
      - contents:
        - "4.2.1.4.  Type 7 Routes\n   Type 5 routes always get preference over type
          7, and the alternate\n   ASBRs chosen for LFA calculation should belong
          to the same type.\n   Among type 7 routes, routes with the p-bit and forwarding
          address set\n   have a higher preference than routes without these attributes.\n
          \  Alternate ASBRs selected for LFA comparison should have the same\n   p-bit
          and forwarding address attributes.\n"
        title: 4.2.1.4.  Type 7 Routes
      title: 4.2.1.  Rules to Select Alternate ASBRs
    - contents:
      - "4.2.2.  Inequalities to Be Applied for Alternate ASBR Selection\n   The alternate
        ASBRs selected using the mechanism described in\n   Section 4.2.1 are evaluated
        for loop-free criteria using the\n   inequalities below.\n"
      - contents:
        - "4.2.2.1.  Forwarding Address Set to Non-zero Value\n   Similar to the inequalities
          defined in Section 2, the following\n   inequalities are defined when the
          forwarding address is a non-zero\n   value.\n   Link-Protecting LFAs:\n
          \     F_opt(N,PO_i)+ Cost(PO_i,P) < D_opt(N,S) +\n                                    F_opt(S,PO_best)
          + Cost(PO_best,P)\n   Link-Protecting + Downstream-paths-only LFAs:\n      F_opt(N,PO_i)+
          Cost(PO_i,P) < F_opt(S,PO_best) + Cost(PO_best,P)\n   Node-Protecting LFAs:\n
          \     F_opt(N,PO_i)+ Cost(PO_i,P) < D_opt(N,E) +\n                                    F_opt(E,PO_best)
          + Cost(PO_best,P)\n      Where:\n      P           -  The MHP being evaluated
          for computing alternates\n      S           -  The computing router\n      N
          \          -  The alternate router being evaluated\n      E           -
          \ The primary next hop on the shortest path from S to\n                     prefix
          P\n      PO_i        -  The specific prefix-originating router being\n                     evaluated\n
          \     PO_best     -  The prefix-originating router on the shortest path\n
          \                    from the computing router S to prefix P\n      Cost(X,Y)
          \  -  The external cost for Y as advertised by X\n      F_opt(X,Y)  -  The
          distance on the shortest path from node X to\n                     the forwarding
          address specified by ASBR Y\n      D_opt(X,Y)  -  The distance on the shortest
          path from node X to\n                     node Y\n"
        title: 4.2.2.1.  Forwarding Address Set to Non-zero Value
      - contents:
        - "4.2.2.2.  ASBRs Advertising Type 1 and Type 2 Costs\n   Similar to the
          inequalities defined in Section 2, the following\n   inequalities are defined
          for type 1 and type 2 costs.\n   Link-Protecting LFAs:\n      D_opt(N,PO_i)+
          Cost(PO_i,P) < D_opt(N,S) +\n                                    D_opt(S,PO_best)
          + Cost(PO_best,P)\n   Link-Protecting + Downstream-paths-only LFAs:\n      D_opt(N,PO_i)+
          Cost(PO_i,P) < D_opt(S,PO_best) + Cost(PO_best,P)\n   Node-Protecting LFAs:\n
          \     D_opt(N,PO_i)+ Cost(PO_i,P) < D_opt(N,E) +\n                                    D_opt(E,PO_best)
          + Cost(PO_best,P)\n      Where:\n      P           -  The MHP being evaluated
          for computing alternates\n      S           -  The computing router\n      N
          \          -  The alternate router being evaluated\n      E           -
          \ The primary next hop on the shortest path from S to\n                     prefix
          P\n      PO_i        -  The specific prefix-originating router being\n                     evaluated\n
          \     PO_best     -  The prefix-originating router on the shortest path\n
          \                    from the computing router S to prefix P\n      Cost(X,Y)
          \  -  The external cost for Y as advertised by X\n      D_opt(X,Y)  -  The
          distance on the shortest path from node X to\n                     node
          Y\n"
        title: 4.2.2.2.  ASBRs Advertising Type 1 and Type 2 Costs
      title: 4.2.2.  Inequalities to Be Applied for Alternate ASBR Selection
    title: 4.2.  OSPF
  title: 4.  LFA Selection for Multi-Homed External Prefixes
- contents:
  - "5.  LFA Extended Procedures\n   This section explains additional considerations
    to the LFA base\n   specification [RFC5286].\n"
  - contents:
    - "5.1.  Links with IGP MAX_METRIC\n   Sections 3.5 and 3.6 of [RFC5286] describe
      procedures for excluding\n   nodes and links from use in alternate paths based
      on the maximum link\n   metric.  If these procedures are strictly followed,
      there are\n   situations, described below, where the only potential alternate\n
      \  available that satisfies the basic loop-free condition will not be\n   considered
      as alternative.  This document refers to the maximum link\n   metric in IGPs
      as the MAX_METRIC.  MAX_METRIC is called \"maximum link\n   metric\" when defined
      for IS-IS in [RFC5305] and \"MaxLinkMetric\" when\n   defined for OSPF in [RFC6987].\n
      \                            +---+  10  +---+  10 +---+\n                             |
      S |------|N1 |-----|D1 |\n                             +---+      +---+     +---+\n
      \                              |                    |\n                            10
      |                 10 |\n                               |MAX_METRIC(N2 to S)
      |\n                               |                    |\n                               |
      \      +---+        |\n                               +-------|N2 |--------+\n
      \                                      +---+\n                                     10
      \ |\n                                       +---+\n                                       |D2
      |\n                                       +---+\n                    Figure
      3: Link with IGP MAX_METRIC\n   In the simple example network in Figure 3, all
      the links have a cost\n   of 10 in both directions, except for the link between
      S and N2.  The\n   S-N2 link has a cost of 10 in the forward direction, i.e.,
      from S to\n   N2, and a cost of MAX_METRIC (0xffffff /2^24 - 1 for IS-IS and
      0xffff\n   for OSPF) in the reverse direction, i.e., from N2 to S for a specific\n
      \  end-to-end TE requirement of the operator.  At node S, D1 is\n   reachable
      through N1 with a cost of 20, and D2 is reachable through\n   N2 with a cost
      of 20.  Even though neighbor N2 satisfies the basic\n   loop-free condition
      (inequality 1 of [RFC5286]) for D1, S's neighbor\n   N2 could be excluded as
      a potential alternative because of the\n   current exclusions specified in Sections
      3.5 and 3.6 of [RFC5286].\n   But, the primary traffic destined to D2 continues
      to use the link;\n   hence, irrespective of the reverse metric in this case,
      the same link\n   MAY be used as a potential LFA for D1.\n   Alternatively,
      the reverse metric of the link MAY be configured with\n   MAX_METRIC-1 so that
      the link can be used as an alternative while\n   meeting the operator's TE requirements
      and without having to update\n   the router to fix this particular issue.\n"
    title: 5.1.  Links with IGP MAX_METRIC
  - contents:
    - "5.2.  MT Considerations\n   Sections 6.2 and 6.3.2 of [RFC5286] state that
      multi-topology OSPF\n   and IS-IS are out of scope for that specification.  This
      memo\n   clarifies and describes the applicability.\n   In multi-topology IGP
      deployments, for each MT-ID, a separate\n   shortest path tree (SPT) is built
      with topology-specific adjacencies\n   so the LFA principles laid out in [RFC5286]
      are actually applicable\n   for MT IS-IS [RFC5120] LFA SPF.  The primary difference
      in this case\n   is identifying the eligible set of neighbors for each LFA\n
      \  computation; this is done per MT-ID.  The eligible set for each MT-ID\n   is
      determined by the presence of IGP adjacency from the source to the\n   neighboring
      node on that MT-ID apart from the administrative\n   restrictions and other
      checks laid out in [RFC5286].  The same is\n   also applicable for MT-OSPF [RFC4915]
      or different AFs in multi-\n   instance OSPFv3 [RFC5838].\n   However, for MT
      IS-IS, if a \"standard unicast topology\" is used with\n   MT-ID #0 [RFC5120]
      and both IPv4 [RFC5305] and IPv6 routes/AFs\n   [RFC5308] are present, then
      the condition of network congruency is\n   applicable for LFA computation as
      well.  Network congruency here\n   refers to having the same address families
      provisioned on all the\n   links and all the nodes of the network with MT-ID
      #0.  Here, with a\n   single-decision process, both IPv4 and IPv6 next hops
      are computed\n   for all the prefixes in the network.  Similarly, with one LFA\n
      \  computation from all eligible neighbors per [RFC5286], all potential\n   alternatives
      can be computed.\n"
    title: 5.2.  MT Considerations
  title: 5.  LFA Extended Procedures
- contents:
  - "6.  IANA Considerations\n   This document has no IANA actions.\n"
  title: 6.  IANA Considerations
- contents:
  - "7.  Security Considerations\n   The existing OSPF security considerations continue
    to apply, as do\n   the recommended manual key management mechanisms specified
    in\n   [RFC7474].  The existing security considerations for IS-IS also\n   continue
    to apply, as specified in [RFC5304] and [RFC5310] and\n   extended by [RFC7645]
    for Keying and Authentication for Routing\n   Protocols (KARP).  This document
    does not change any of the discussed\n   protocol specifications (i.e., [RFC1195],
    [RFC5120], [RFC2328], and\n   [RFC5838]); therefore, the security considerations
    of the LFA base\n   specification [RFC5286] continue to apply.\n"
  title: 7.  Security Considerations
- contents:
  - '8.  References

    '
  - contents:
    - "8.1.  Normative References\n   [RFC2119]  Bradner, S., \"Key words for use
      in RFCs to Indicate\n              Requirement Levels\", BCP 14, RFC 2119,\n
      \             DOI 10.17487/RFC2119, March 1997,\n              <https://www.rfc-editor.org/info/rfc2119>.\n
      \  [RFC5286]  Atlas, A., Ed. and A. Zinin, Ed., \"Basic Specification for\n
      \             IP Fast Reroute: Loop-Free Alternates\", RFC 5286,\n              DOI
      10.17487/RFC5286, September 2008,\n              <https://www.rfc-editor.org/info/rfc5286>.\n
      \  [RFC8174]  Leiba, B., \"Ambiguity of Uppercase vs Lowercase in RFC\n              2119
      Key Words\", BCP 14, RFC 8174, DOI 10.17487/RFC8174,\n              May 2017,
      <https://www.rfc-editor.org/info/rfc8174>.\n"
    title: 8.1.  Normative References
  - contents:
    - "8.2.  Informative References\n   [RFC1195]  Callon, R., \"Use of OSI IS-IS
      for routing in TCP/IP and\n              dual environments\", RFC 1195, DOI
      10.17487/RFC1195,\n              December 1990, <https://www.rfc-editor.org/info/rfc1195>.\n
      \  [RFC2328]  Moy, J., \"OSPF Version 2\", STD 54, RFC 2328,\n              DOI
      10.17487/RFC2328, April 1998,\n              <https://www.rfc-editor.org/info/rfc2328>.\n
      \  [RFC4915]  Psenak, P., Mirtorabi, S., Roy, A., Nguyen, L., and\n              P.
      Pillay-Esnault, \"Multi-Topology (MT) Routing in OSPF\",\n              RFC
      4915, DOI 10.17487/RFC4915, June 2007,\n              <https://www.rfc-editor.org/info/rfc4915>.\n
      \  [RFC5120]  Przygienda, T., Shen, N., and N. Sheth, \"M-ISIS: Multi\n              Topology
      (MT) Routing in Intermediate System to\n              Intermediate Systems (IS-ISs)\",
      RFC 5120,\n              DOI 10.17487/RFC5120, February 2008,\n              <https://www.rfc-editor.org/info/rfc5120>.\n
      \  [RFC5304]  Li, T. and R. Atkinson, \"IS-IS Cryptographic\n              Authentication\",
      RFC 5304, DOI 10.17487/RFC5304, October\n              2008, <https://www.rfc-editor.org/info/rfc5304>.\n
      \  [RFC5305]  Li, T. and H. Smit, \"IS-IS Extensions for Traffic\n              Engineering\",
      RFC 5305, DOI 10.17487/RFC5305, October\n              2008, <https://www.rfc-editor.org/info/rfc5305>.\n
      \  [RFC5308]  Hopps, C., \"Routing IPv6 with IS-IS\", RFC 5308,\n              DOI
      10.17487/RFC5308, October 2008,\n              <https://www.rfc-editor.org/info/rfc5308>.\n
      \  [RFC5310]  Bhatia, M., Manral, V., Li, T., Atkinson, R., White, R.,\n              and
      M. Fanto, \"IS-IS Generic Cryptographic\n              Authentication\", RFC
      5310, DOI 10.17487/RFC5310, February\n              2009, <https://www.rfc-editor.org/info/rfc5310>.\n
      \  [RFC5714]  Shand, M. and S. Bryant, \"IP Fast Reroute Framework\",\n              RFC
      5714, DOI 10.17487/RFC5714, January 2010,\n              <https://www.rfc-editor.org/info/rfc5714>.\n
      \  [RFC5838]  Lindem, A., Ed., Mirtorabi, S., Roy, A., Barnes, M., and\n              R.
      Aggarwal, \"Support of Address Families in OSPFv3\",\n              RFC 5838,
      DOI 10.17487/RFC5838, April 2010,\n              <https://www.rfc-editor.org/info/rfc5838>.\n
      \  [RFC6987]  Retana, A., Nguyen, L., Zinin, A., White, R., and\n              D.
      McPherson, \"OSPF Stub Router Advertisement\", RFC 6987,\n              DOI
      10.17487/RFC6987, September 2013,\n              <https://www.rfc-editor.org/info/rfc6987>.\n
      \  [RFC7474]  Bhatia, M., Hartman, S., Zhang, D., and A. Lindem, Ed.,\n              \"Security
      Extension for OSPFv2 When Using Manual Key\n              Management\", RFC
      7474, DOI 10.17487/RFC7474, April 2015,\n              <https://www.rfc-editor.org/info/rfc7474>.\n
      \  [RFC7645]  Chunduri, U., Tian, A., and W. Lu, \"The Keying and\n              Authentication
      for Routing Protocol (KARP) IS-IS Security\n              Analysis\", RFC 7645,
      DOI 10.17487/RFC7645, September 2015,\n              <https://www.rfc-editor.org/info/rfc7645>.\n"
    title: 8.2.  Informative References
  title: 8.  References
- contents:
  - "Acknowledgements\n   The authors acknowledge Alia Atlas and Salih K.A. for their
    useful\n   feedback and input.  Thanks to Stewart Bryant for being Document\n
    \  Shepherd and providing detailed review comments.  Thanks to Elwyn\n   Davies
    for reviewing and providing feedback as part of the Gen-ART\n   review.  Thanks
    to Alvaro Retana, Adam Roach, Ben Campbell, Benjamin\n   Kaduk, and sponsoring
    Routing Area Director Martin Vigoureux for\n   providing detailed feedback and
    suggestions.\n"
  title: Acknowledgements
- contents:
  - "Contributors\n   The following people contributed substantially to the content
    of this\n   document and should be considered coauthors:\n   Chris Bowers\n   Juniper
    Networks, Inc.\n   1194 N. Mathilda Ave.\n   Sunnyvale, CA  94089\n   United States
    of America\n   Email: cbowers@juniper.net\n   Bruno Decraene\n   Orange\n   France\n
    \  Email: bruno.decraene@orange.com\n"
  title: Contributors
- contents:
  - "Authors' Addresses\n   Pushpasis Sarkar (editor)\n   Arrcus, Inc.\n   Email:
    pushpasis.ietf@gmail.com\n   Uma Chunduri (editor)\n   Huawei USA\n   2330 Central
    Expressway\n   Santa Clara, CA  95050\n   United States of America\n   Email:
    uma.chunduri@huawei.com\n   Shraddha Hegde\n   Juniper Networks, Inc.\n   Electra,
    Exora Business Park\n   Bangalore, KA  560103\n   India\n   Email: shraddha@juniper.net\n
    \  Jeff Tantsura\n   Apstra, Inc.\n   Email: jefftant.ietf@gmail.com\n   Hannes
    Gredler\n   RtBrick, Inc.\n   Email: hannes@rtbrick.com\n"
  title: Authors' Addresses
