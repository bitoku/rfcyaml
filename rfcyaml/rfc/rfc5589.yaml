- title: __initial_text__
  contents:
  - '       Session Initiation Protocol (SIP) Call Control - Transfer

    '
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This document specifies an Internet Best Current Practices\
    \ for the\n   Internet Community, and requests discussion and suggestions for\n\
    \   improvements.  Distribution of this memo is unlimited.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2009 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\
    \ in effect on the date of\n   publication of this document (http://trustee.ietf.org/license-info).\n\
    \   Please review these documents carefully, as they describe your rights\n  \
    \ and restrictions with respect to this document.\n   This document may contain\
    \ material from IETF Documents or IETF\n   Contributions published or made publicly\
    \ available before November\n   10, 2008.  The person(s) controlling the copyright\
    \ in some of this\n   material may not have granted the IETF Trust the right to\
    \ allow\n   modifications of such material outside the IETF Standards Process.\n\
    \   Without obtaining an adequate license from the person(s) controlling\n   the\
    \ copyright in such materials, this document may not be modified\n   outside the\
    \ IETF Standards Process, and derivative works of it may\n   not be created outside\
    \ the IETF Standards Process, except to format\n   it for publication as an RFC\
    \ or to translate it into languages other\n   than English.\n"
- title: Abstract
  contents:
  - "Abstract\n   This document describes providing Call Transfer capabilities in\
    \ the\n   Session Initiation Protocol (SIP).  SIP extensions such as REFER and\n\
    \   Replaces are used to provide a number of transfer services including\n   blind\
    \ transfer, consultative transfer, and attended transfer.  This\n   work is part\
    \ of the SIP multiparty call control framework.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1. Overview ........................................................3\n\
    \   2. Actors and Roles ................................................3\n  \
    \ 3. Terminology .....................................................4\n   4.\
    \ Requirements ....................................................4\n   5. Using\
    \ REFER to Achieve Call Transfer ............................5\n   6. Basic Transfer\
    \ ..................................................6\n      6.1. Successful Transfer\
    \ ........................................8\n      6.2. Transfer with Dialog Reuse\
    \ ................................11\n      6.3. Failed Transfer ...........................................15\n\
    \           6.3.1. Target Busy ........................................16\n  \
    \         6.3.2. Transfer Target Does Not Answer ....................17\n   7.\
    \ Transfer with Consultation Hold ................................18\n      7.1.\
    \ Exposing Transfer Target ..................................18\n      7.2. Protecting\
    \ Transfer Target ................................19\n      7.3. Attended Transfer\
    \ .........................................24\n      7.4. Recovery When One Party\
    \ Does Not Support REFER ............28\n      7.5. Attended Transfer When Contact\
    \ URI Is Not Known to\n           Route to a User Agent .....................................29\n\
    \      7.6. Semi-Attended Transfer ....................................37\n  \
    \    7.7. Attended Transfer Fallback to Basic Transfer ..............42\n   8.\
    \ Transfer with Referred-By ......................................45\n   9. Transfer\
    \ as an Ad Hoc Conference ...............................49\n   10. Transfer with\
    \ Multiple Parties ................................52\n   11. Gateway Transfer\
    \ Issues .......................................54\n      11.1. Coerce Gateway\
    \ Hairpins to the Same Gateway ..............54\n      11.2. Consultative Turned\
    \ Blind Gateway Glare ..................55\n   12. Security Considerations .......................................55\n\
    \   13. Acknowledgments ...............................................56\n  \
    \ 14. References ....................................................56\n    \
    \  14.1. Normative References .....................................56\n      14.2.\
    \ Informative References ...................................57\n"
- title: 1.  Overview
  contents:
  - "1.  Overview\n   This document describes providing Call Transfer capabilities\
    \ and\n   requirements in SIP [RFC3261].  This work is part of the multiparty\n\
    \   call control framework [CC-FRMWRK].\n   The mechanisms discussed here are\
    \ most closely related to\n   traditional, basic, and consultation hold transfers.\n\
    \   This document details the use of the REFER method [RFC3515] and\n   Replaces\
    \ [RFC3891] header field to achieve call transfer.\n   A User Agent (UA) that\
    \ fully supports the transfer mechanisms\n   described in this document supports\
    \ REFER [RFC3515] and Replaces\n   [RFC3891] in addition to RFC 3261 [RFC3261].\
    \  A User Agent should use\n   a Contact URI that meets the requirements in Section\
    \ 8.1.1.8 of RFC\n   3261.  A compliant User Agent supports the Target-Dialog\
    \ header field\n   [RFC4538].\n"
- title: 2.  Actors and Roles
  contents:
  - "2.  Actors and Roles\n   There are three actors in a given transfer event, each\
    \ playing one of\n   the following roles:\n   Transferee:        the party being\
    \ transferred to the Transfer\n                      Target.\n   Transferor: \
    \       the party initiating the transfer.\n   Transfer Target:   the new party\
    \ being introduced into a call with\n                      the Transferee.\n \
    \  The following roles are used to describe transfer requirements and\n   scenarios:\n\
    \   Originator:        wishes to place a call to the Recipient.  This\n      \
    \                actor is the source of the first INVITE in a\n              \
    \        session, to either a Facilitator or a Screener.\n   Facilitator:    \
    \   receives a call or out-of-band request from the\n                      Originator,\
    \ establishes a call to the Recipient\n                      through the Screener,\
    \ and connects the Originator\n                      to the Recipient.  Typically,\
    \ a Facilitator acts\n                      on behalf of the Originator.\n   Screener:\
    \          receives a call ultimately intended for the\n                     \
    \ Recipient and transfers the calling party to the\n                      Recipient\
    \ if appropriate.  Typically, a Screener\n                      acts on behalf\
    \ of the Recipient.\n   Recipient:         the party to which the Originator is\
    \ ultimately\n                      connected.\n"
- title: 3.  Terminology
  contents:
  - "3.  Terminology\n   The key words \"MUST\", \"MUST NOT\", \"REQUIRED\", \"SHALL\"\
    , \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\", \"RECOMMENDED\", \"MAY\", and\
    \ \"OPTIONAL\" in this\n   document are to be interpreted as described in BCP\
    \ 14, RFC 2119\n   [RFC2119].\n"
- title: 4.  Requirements
  contents:
  - "4.  Requirements\n   1.  Any party in a SIP session must be able to transfer\
    \ any other\n       party in that session at any point in that session.\n   2.\
    \  The Transferor and the Transferee must not be removed from a\n       session\
    \ as part of a transfer transaction.\n            At first glance, requirement\
    \ 2 may seem to indicate\n            that the user experience in a transfer must\
    \ be\n            significantly different from what a current Private Branch\n\
    \            Exchange (PBX) or Centrex user expects.  As the call flows\n    \
    \        in this document show, this is not the case.  A client may\n        \
    \    preserve the current experience.  In fact, without\n            this requirement,\
    \ some forms of the current\n            experience (ringback on transfer failure,\n\
    \            for instance) will be lost.\n   3.  The Transferor must know whether\
    \ or not the transfer was\n       successful.\n   4.  The Transferee must be able\
    \ to replace an existing dialog with a\n       new dialog.\n   5.  The Transferor\
    \ and Transferee should indicate their support for\n       the primitives required\
    \ to achieve transfer.\n   6.  The Transferor should provide the Transfer Target\
    \ and Transferee\n       with information about the nature and progress of the\
    \ transfer\n       operation being attempted.\n            To meet this requirement,\
    \ the transfer operation can\n            be modeled as an ad hoc conference between\
    \ three\n            parties, as discussed in Section 9.\n"
- title: 5.  Using REFER to Achieve Call Transfer
  contents:
  - "5.  Using REFER to Achieve Call Transfer\n   A REFER [RFC3515] can be issued\
    \ by the Transferor to cause the\n   Transferee to issue an INVITE to the Transfer\
    \ Target.  Note that a\n   successful REFER transaction does not terminate the\
    \ session between\n   the Transferor and the Transferee.  If those parties wish\
    \ to\n   terminate their session, they must do so with a subsequent BYE\n   request.\
    \  The media negotiated between the transferee and the\n   Transfer Target is\
    \ not affected by the media that had been negotiated\n   between the Transferor\
    \ and the Transferee.  In particular, the INVITE\n   issued by the Transferee\
    \ will have the same Session Description\n   Protocol (SDP) body it would have\
    \ if the Transferee had initiated\n   that INVITE on its own.  Further, the disposition\
    \ of the media\n   streams between the Transferor and the Transferee is not altered\
    \ by\n   the REFER method.\n   Agents may alter a session's media through additional\
    \ signaling.  For\n   example, they may make use of the SIP hold re-INVITE [RFC3261]\
    \ or\n   conferencing extensions described in the conferencing framework\n   [RFC4353].\n\
    \   To perform the transfer, the Transferor and Transferee could reuse an\n  \
    \ existing dialog established by an INVITE to send the REFER.  This\n   would\
    \ result in a single dialog shared by two uses -- an invite usage\n   and a subscription\
    \ usage.  The call flows for this are shown in\n   detail in Section 6.2.  However,\
    \ the approach described in this\n   document is to avoid dialog reuse.  The issues\
    \ and difficulties\n   associated with dialog reuse are described in [RFC5057].\n\
    \   Motivations for reusing the existing dialog include:\n   1.  There was no\
    \ way to ensure that a REFER on a new dialog would\n       reach the particular\
    \ endpoint involved in a transfer.  Many\n       factors, including details of\
    \ implementations and changes in\n       proxy routing between an INVITE and a\
    \ REFER could cause the REFER\n       to be sent to the wrong place.  Sending\
    \ the REFER down the\n       existing dialog ensured it got to the endpoint to\
    \ which we were\n       already talking.\n   2.  It was unclear how to associate\
    \ an existing invite usage with a\n       REFER arriving on a new dialog, where\
    \ it was completely obvious\n       what the association was when the REFER came\
    \ on the INVITE\n       usage's dialog.\n   3.  There were concerns with authorizing\
    \ out-of-dialog REFERs.  The\n       authorization policy for REFER in most implementations\
    \ piggybacks\n       on the authorization policy for INVITE (which is, in most\
    \ cases,\n       based simply on \"I placed or answered this call\").\n   Globally\
    \ Routable UA URIs (GRUUs) [SIP-GRUU] can be used to address\n   problem 1.  Problem\
    \ 2 can be addressed using the Target-Dialog header\n   field defined in [RFC4538].\
    \  In the immediate term, this solution to\n   problem 2 allows the existing REFER\
    \ authorization policy to be\n   reused.\n   As a result, if the Transferee supports\
    \ the target-dialog extension\n   and the Transferor knows the Contact URI is\
    \ routable outside the\n   dialog, the REFER SHOULD be sent in a new dialog. \
    \ If the nature of\n   the Contact URI is not known or if support for the target-dialog\n\
    \   extension is not known, the REFER SHOULD be sent inside the existing\n   dialog.\
    \  A Transferee MUST be prepared to receive a REFER either\n   inside or outside\
    \ a dialog.  One way that a Transferor could know\n   that a Contact URI is routable\
    \ outside a dialog is by validation\n   (e.g., sending an OPTIONS and receiving\
    \ a response) or if it\n   satisfies the properties described in the GRUU specification\n\
    \   [SIP-GRUU].\n   This document does not prescribe the flows and examples precisely\
    \ as\n   they are shown, but rather the flows illustrate the principles for\n\
    \   best practice for the transfer feature.  The call flows represent\n   well-reviewed\
    \ examples of SIP usage to implement transfer with REFER,\n   which are Best Common\
    \ Practice according to IETF consensus.\n   In most of the following examples,\
    \ the Transferor is in the\n   atlanta.example.com domain, the Transferee is in\
    \ the\n   biloxi.example.com, and the Transfer Target is in the\n   chicago.example.com\
    \ domain.\n"
- title: 6.  Basic Transfer
  contents:
  - "6.  Basic Transfer\n   Basic Transfer consists of the Transferor providing the\
    \ Transfer\n   Target's contact to the Transferee.  The Transferee attempts to\n\
    \   establish a session using that contact and reports the results of\n   that\
    \ attempt to the Transferor.  The signaling relationship between\n   the Transferor\
    \ and Transferee is not terminated, so the call is\n   recoverable if the Transfer\
    \ Target cannot be reached.  Note that the\n   Transfer Target's contact information\
    \ has been exposed to the\n   Transferee.  The provided contact can be used to\
    \ make new calls in\n   the future.\n   The participants in a basic transfer SHOULD\
    \ indicate support for the\n   REFER and NOTIFY methods in Allow header fields\
    \ in INVITE, 200 OK to\n   INVITE, and OPTIONS messages.  Participants SHOULD\
    \ also indicate\n   support for Target-Dialog in the Supported header field.\n\
    \   The diagrams below show the first line of each message.  The first\n   column\
    \ of the figure shows the dialog used in that particular\n   message.  In these\
    \ diagrams, media is managed through re-INVITE\n   holds, but other mechanisms\
    \ (mixing multiple media streams at the UA\n   or using the conferencing extensions,\
    \ for example) are valid.\n   Selected message details are shown labeled as message\
    \ F1, F2, etc.\n   Each of the flows below shows the dialog between the Transferor\
    \ and\n   the Transferee remaining connected (on hold) during the REFER\n   process.\
    \  While this provides the greatest flexibility for recovery\n   from failure,\
    \ it is not necessary.  If the Transferor's agent does\n   not wish to participate\
    \ in the remainder of the REFER process and has\n   no intention of assisting\
    \ with recovery from transfer failure, it\n   could emit a BYE to the Transferee\
    \ as soon as the REFER transaction\n   completes.  This flow is sometimes known\
    \ as \"unattended transfer\" or\n   \"blind transfer\".\n   Figure 1 shows transfer\
    \ when the Transferee utilizes a GRUU and\n   supports the target-dialog extension\
    \ and indicates this to the\n   Transferor.  As a result, the Transferor sends\
    \ the REFER outside the\n   INVITE dialog.  The Transferee is able to match this\
    \ REFER to the\n   existing dialog using the Target-Dialog header field in the\
    \ refer\n   which references the existing dialog.\n"
- title: 6.1.  Successful Transfer
  contents:
  - "6.1.  Successful Transfer\n             Transferor           Transferee     \
    \        Transfer\n                  |                    |                  Target\n\
    \                  |          INVITE F1 |                    |\n          dialog1\
    \ |<-------------------|                    |\n                  |          200\
    \ OK F2 |                    |\n          dialog1 |------------------->|     \
    \               |\n                  |            ACK     |                  \
    \  |\n          dialog1 |<-------------------|                    |\n        \
    \          |  INVITE (hold)     |                    |\n          dialog1 |------------------->|\
    \                    |\n                  |  200 OK            |             \
    \       |\n          dialog1 |<-------------------|                    |\n   \
    \               |  ACK               |                    |\n          dialog1\
    \ |------------------->|                    |\n                  |  REFER F3 (Target-Dialog:1)\
    \             |\n          dialog2 |------------------->|                    |\n\
    \                  |  202 Accepted      |                    |\n          dialog2\
    \ |<-------------------|                    |\n                  | NOTIFY (100\
    \ Trying) F4                  |\n          dialog2 |<-------------------|    \
    \                |\n                  |            200 OK  |                 \
    \   |\n          dialog2 |------------------->|                    |\n       \
    \           |                    |  INVITE F5         |\n          dialog3 | \
    \                   |------------------->|\n                  |              \
    \      |  200 OK            |\n          dialog3 |                    |<-------------------|\n\
    \                  |                    |  ACK               |\n          dialog3\
    \ |                    |------------------->|\n                  |  NOTIFY (200\
    \ OK) F6|                    |\n          dialog2 |<-------------------|     \
    \               |\n                  |            200 OK  |                  \
    \  |\n          dialog2 |------------------->|                    |\n        \
    \          |  BYE               |                    |\n          dialog1 |------------------->|\
    \                    |\n                  |  200 OK            |             \
    \       |\n          dialog1 |<-------------------|                    |\n   \
    \               |                    |             BYE    |\n          dialog3\
    \ |                    |<-------------------|\n                  |           \
    \         |             200 OK |\n          dialog3 |                    |------------------->|\n\
    \   Figure 1: Basic Transfer Call Flow\n   F1 INVITE Transferee -> Transferor\n\
    \   INVITE sips:transferor@atlanta.example.com SIP/2.0\n   Via: SIP/2.0/TLS 192.0.2.4;branch=z9hG4bKnas432\n\
    \   Max-Forwards: 70\n   To: <sips:transferor@atlanta.example.com>\n   From: <sips:transferee@biloxi.example.com>;tag=7553452\n\
    \   Call-ID: 090459243588173445\n   CSeq: 29887 INVITE\n   Allow: INVITE, ACK,\
    \ CANCEL, OPTIONS, BYE, REFER, NOTIFY\n   Supported: replaces, gruu, tdialog\n\
    \   Contact: <sips:3ld812adkjw@biloxi.example.com;gr=3413kj2ha>\n   Content-Type:\
    \ application/sdp\n   Content-Length: ...\n   F2 200 OK Transferor -> Transferee\n\
    \   SIP/2.0 200 OK\n   Via: SIP/2.0/TLS 192.0.2.4;branch=z9hG4bKnas432\n   To:\
    \ <sips:transferor@atlanta.example.com>;tag=31kdl4i3k\n   From: <sips:transferee@biloxi.example.com>;tag=7553452\n\
    \   Call-ID: 090459243588173445\n   CSeq: 29887 INVITE\n   Allow: INVITE, ACK,\
    \ CANCEL, OPTIONS, BYE, REFER, NOTIFY\n   Supported: replaces, gruu, tdialog\n\
    \   Contact: <sips:4889445d8kjtk3@atlanta.example.com;gr=723jd2d>\n   Content-Type:\
    \ application/sdp\n   Content-Length: ...\n   F3 REFER Transferor -> Transferee\n\
    \   REFER sips:3ld812adkjw@biloxi.example.com;gr=3413kj2ha SIP/2.0\n   Via: SIP/2.0/TLS\
    \ pc33.atlanta.example.com;branch=z9hG4bKna9\n   Max-Forwards: 70\n   To: <sips:3ld812adkjw@biloxi.example.com;gr=3413kj2ha>\n\
    \   From: <sips:transferor@atlanta.example.com>;tag=1928301774\n   Call-ID: a84b4c76e66710\n\
    \   CSeq: 314159 REFER\n   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY\n\
    \   Supported: gruu, replaces, tdialog\n   Require: tdialog\n   Refer-To: <sips:transfertarget@chicago.example.com>\n\
    \   Target-Dialog: 090459243588173445;local-tag=7553452\n    ;remote-tag=31kdl4i3k\n\
    \   Contact: <sips:4889445d8kjtk3@atlanta.example.com;gr=723jd2d>\n   Content-Length:\
    \ 0\n   F4 NOTIFY Transferee -> Transferor\n   NOTIFY sips:4889445d8kjtk3@atlanta.example.com;gr=723jd2d\
    \ SIP/2.0\n   Via: SIP/2.0/TLS 192.0.2.4;branch=z9hG4bKnas432\n   Max-Forwards:\
    \ 70\n   To: <sips:transferor@atlanta.example.com>;tag=1928301774\n   From: <sips:3ld812adkjw@biloxi.example.com;gr=3413kj2ha>\n\
    \    ;tag=a6c85cf\n   Call-ID: a84b4c76e66710\n   CSeq: 73 NOTIFY\n   Contact:\
    \ <sips:3ld812adkjw@biloxi.example.com;gr=3413kj2ha>\n   Allow: INVITE, ACK, CANCEL,\
    \ OPTIONS, BYE, REFER, NOTIFY\n   Supported: replaces, tdialog\n   Event: refer\n\
    \   Subscription-State: active;expires=60\n   Content-Type: message/sipfrag\n\
    \   Content-Length: ...\n   SIP/2.0 100 Trying\n   F5 INVITE Transferee -> Transfer\
    \ Target\n   INVITE sips:transfertarget@chicago.example.com SIP/2.0\n   Via: SIP/2.0/TLS\
    \ 192.0.2.4;branch=z9hG4bKnas41234\n   Max-Forwards: 70\n   To: <sips:transfertarget@chicago.example.com>\n\
    \   From: <sips:transferee@biloxi.example.com>;tag=j3kso3iqhq\n   Call-ID: 90422f3sd23m4g56832034\n\
    \   CSeq: 521 REFER\n   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY\n\
    \   Supported: replaces, gruu, tdialog\n   Contact: <sips:3ld812adkjw@biloxi.example.com;gr=3413kj2ha>\n\
    \   Content-Type: application/sdp\n   Content-Length: ...\n   F6 NOTIFY Transferee\
    \ -> Transferor\n   NOTIFY sips:4889445d8kjtk3@atlanta.example.com;gr=723jd2d\
    \ SIP/2.0\n   Via: SIP/2.0/TLS 192.0.2.4;branch=z9hG4bKnas432\n   Max-Forwards:\
    \ 70\n   To: <sips:transferor@atlanta.example.com>;tag=1928301774\n   From: <sips:3ld812adkjw@biloxi.example.com;gr=3413kj2ha>\n\
    \    ;tag=a6c85cf\n   Call-ID: a84b4c76e66710\n   CSeq: 74 NOTIFY\n   Contact:\
    \ <sips:3ld812adkjw@biloxi.example.com;gr=3413kj2ha>\n   Allow: INVITE, ACK, CANCEL,\
    \ OPTIONS, BYE, REFER, NOTIFY\n   Supported: replaces, tdialog\n   Event: refer\n\
    \   Subscription-State: terminated;reason=noresource\n   Content-Type: message/sipfrag\n\
    \   Content-Length: ...\n   SIP/2.0 200 OK\n"
- title: 6.2.  Transfer with Dialog Reuse
  contents:
  - "6.2.  Transfer with Dialog Reuse\n   In this scenario, the Transferor does not\
    \ know the properties of the\n   Transferee's Contact URI or does not know that\
    \ the Transferee\n   supports the Target-Dialog header field.  As a result, the\
    \ REFER is\n   sent inside the INVITE dialog.\n             Transferor       \
    \    Transferee             Transfer\n                  |                    |\
    \                  Target\n                  |         INVITE F1  |          \
    \          |\n          dialog1 |<-------------------|                    |\n\
    \                  |         200 OK F2  |                    |\n          dialog1\
    \ |------------------->|                    |\n                  |           \
    \ ACK     |                    |\n          dialog1 |<-------------------|   \
    \                 |\n                  |  INVITE (hold)     |                \
    \    |\n          dialog1 |------------------->|                    |\n      \
    \            |  200 OK            |                    |\n          dialog1 |<-------------------|\
    \                    |\n                  |  ACK               |             \
    \       |\n          dialog1 |------------------->|                    |\n   \
    \               |  REFER F3          |                    |\n          dialog1\
    \ |------------------->|                    |\n                  |  202 Accepted\
    \      |                    |\n          dialog1 |<-------------------|      \
    \              |\n                  | NOTIFY (100 Trying) F4                 \
    \ |\n          dialog1 |<-------------------|                    |\n         \
    \         |            200 OK  |                    |\n          dialog1 |------------------->|\
    \                    |\n                  |                    |  INVITE F5  \
    \       |\n          dialog2 |                    |------------------->|\n   \
    \               |                    |  200 OK            |\n          dialog2\
    \ |                    |<-------------------|\n                  |           \
    \         |  ACK               |\n          dialog2 |                    |------------------->|\n\
    \                  |  NOTIFY (200 OK) F6|                    |\n          dialog1\
    \ |<-------------------|                    |\n                  |           \
    \ 200 OK  |                    |\n          dialog1 |------------------->|   \
    \                 |\n                  |  BYE               |                \
    \    |\n          dialog1 |------------------->|                    |\n      \
    \            |  200 OK            |                    |\n          dialog1 |<-------------------|\
    \                    |\n                  |                    |             BYE\
    \    |\n          dialog2 |                    |<-------------------|\n      \
    \            |                    |             200 OK |\n          dialog2 |\
    \                    |------------------->|\n   Figure 2: Transfer with Dialog\
    \ Reuse\n   F1 INVITE Transferee -> Transferor\n   INVITE sips:transferor@atlanta.example.com\
    \ SIP/2.0\n   Via: SIP/2.0/TLS 192.0.2.4;branch=z9hG4bKnas432\n   Max-Forwards:\
    \ 70\n   To: <sips:transferor@atlanta.example.com>\n   From: <sips:transferee@biloxi.example.com>;tag=7553452\n\
    \   Call-ID: 090459243588173445\n   CSeq: 29887 INVITE\n   Allow: INVITE, ACK,\
    \ CANCEL, OPTIONS, BYE, REFER, NOTIFY\n   Supported: replaces\n   Contact: <sips:transferee@192.0.2.4>\n\
    \   Content-Type: application/sdp\n   Content-Length: ...\n   F2 200 OK Transferor\
    \ -> Transferee\n   SIP/2.0 200 OK\n   Via: SIP/2.0/TLS 192.0.2.4;branch=z9hG4bKnas432\n\
    \   To: <sips:transferor@atlanta.example.com>;tag=31kdl4i3k\n   From: <sips:transferee@biloxi.example.com>;tag=7553452\n\
    \   Call-ID: 090459243588173445\n   CSeq: 29887 INVITE\n   Allow: INVITE, ACK,\
    \ CANCEL, OPTIONS, BYE, REFER, NOTIFY\n   Supported: gruu, replaces\n   Contact:\
    \ <sips:4889445d8kjtk3@atlanta.example.com;gr=723jd2d>\n   Content-Type: application/sdp\n\
    \   Content-Length: ...\n   F3 REFER Transferor -> Transferee\n   REFER sips:transferee@192.0.2.4\
    \ SIP/2.0\n   Via: SIP/2.0/TLS pc33.atlanta.example.com;branch=z9hG4bKna9\n  \
    \ Max-Forwards: 70\n   To: <sips:transferee@biloxi.example.com>;tag=7553452\n\
    \   From: <sips:transferor@atlanta.example.com>;tag=31kdl4i3k\n   Call-ID: 090459243588173445\n\
    \   CSeq: 314159 REFER\n   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY\n\
    \   Supported: replaces\n   Refer-To: <sips:transfertarget@chicago.example.com>\n\
    \   Contact: <sips:4889445d8kjtk3@atlanta.example.com;gr=723jd2d>\n   Content-Length:\
    \ 0\n   F4 NOTIFY Transferee -> Transferor\n   NOTIFY sips:4889445d8kjtk3@atlanta.example.com;gr=723jd2d\
    \ SIP/2.0\n   Via: SIP/2.0/TLS 192.0.2.4;branch=z9hG4bKnas432\n   Max-Forwards:\
    \ 70\n   To: <sips:transferor@atlanta.example.com>;tag=31kdl4i3k\n   From: <sips:transferee@biloxi.example.com>;tag=7553452\n\
    \   Call-ID: 090459243588173445\n   CSeq: 29888 INVITE\n   Contact: <sips:3ld812adkjw@biloxi.example.com;gr=3413kj2ha>\n\
    \   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY\n   Supported: replaces\n\
    \   Event: refer\n   Subscription-State: active;expires=60\n   Content-Type: message/sipfrag\n\
    \   Content-Length: ...\n   SIP/2.0 100 Trying\n   F5 INVITE Transferee -> Transfer\
    \ Target\n   INVITE sips:transfertarget@chicago.example.com SIP/2.0\n   Via: SIP/2.0/TLS\
    \ 192.0.2.4;branch=z9hG4bKnas41234\n   Max-Forwards: 70\n   To: <sips:transfertarget@chicago.example.com>\n\
    \   From: <sips:transferee@biloxi.example.com>;tag=j3kso3iqhq\n   Call-ID: 90422f3sd23m4g56832034\n\
    \   CSeq: 521 REFER\n   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY\n\
    \   Supported: replaces\n   Contact: <sips:transferee@192.0.2.4>\n   Content-Type:\
    \ application/sdp\n   Content-Length: ...\n   F6 NOTIFY Transferee -> Transferor\n\
    \   NOTIFY sips:4889445d8kjtk3@atlanta.example.com;gr=723jd2d SIP/2.0\n   Via:\
    \ SIP/2.0/TLS 192.0.2.4;branch=z9hG4bKnas432\n   Max-Forwards: 70\n   To: <sips:transferor@atlanta.example.com>;tag=31kdl4i3k\n\
    \   From: <sips:transferee@biloxi.example.com>;tag=7553452\n   Call-ID: 090459243588173445\n\
    \   CSeq: 29889 INVITE\n   Contact: <sips:3ld812adkjw@biloxi.example.com;gr=3413kj2ha>\n\
    \   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY\n   Supported: replaces\n\
    \   Event: refer\n   Subscription-State: terminated;reason=noresource\n   Content-Type:\
    \ message/sipfrag\n   Content-Length: ...\n   SIP/2.0 200 OK\n"
- title: 6.3.  Failed Transfer
  contents:
  - "6.3.  Failed Transfer\n   This section shows examples of failed transfer attempts.\
    \  After the\n   transfer failure occurs, the Transferor takes the Transferee\
    \ off hold\n   and resumes the session.\n"
- title: 6.3.1.  Target Busy
  contents:
  - "6.3.1.  Target Busy\n             Transferor           Transferee           \
    \  Transfer\n                  |                    |                  Target\n\
    \                  |                    |                    |\n             \
    \     |            INVITE  |                    |\n          dialog1 |<-------------------|\
    \                    |\n                  |            200 OK  |             \
    \       |\n          dialog1 |------------------->|                    |\n   \
    \               |            ACK     |                    |\n          dialog1\
    \ |<-------------------|                    |\n                  |  INVITE (hold)\
    \     |                    |\n          dialog1 |------------------->|       \
    \             |\n                  |  200 OK            |                    |\n\
    \          dialog1 |<-------------------|                    |\n             \
    \     |  ACK               |                    |\n          dialog1 |------------------->|\
    \                    |\n                  |  REFER (Target-Dialog:1)         \
    \       |\n          dialog2 |------------------->|                    |\n   \
    \               |  202 Accepted      |                    |\n          dialog2\
    \ |<-------------------|                    |\n                  | NOTIFY (100\
    \ Trying)|                    |\n          dialog2 |<-------------------|    \
    \                |\n                  |            200 OK  |                 \
    \   |\n          dialog2 |------------------->|                    |\n       \
    \           |                    |  INVITE            |\n          dialog3 | \
    \                   |------------------->|\n                  |              \
    \      |  486 Busy Here     |\n          dialog3 |                    |<-------------------|\n\
    \                  |                    |  ACK               |\n          dialog3\
    \ |                    |------------------->|\n                  | NOTIFY (486\
    \ Busy Here)                  |\n          dialog2 |<-------------------|    \
    \                |\n                  |            200 OK  |                 \
    \   |\n          dialog2 |------------------->|                    |\n       \
    \           |  INVITE (unhold)   |                    |\n          dialog1 |------------------->|\
    \                    |\n                  |  200 OK            |             \
    \       |\n          dialog1 |<-------------------|                    |\n   \
    \               |  ACK               |                    |\n          dialog1\
    \ |------------------->|                    |\n                  |  BYE      \
    \         |                    |\n          dialog1 |------------------->|   \
    \                 |\n                  |  200 OK            |                \
    \    |\n          dialog1 |<-------------------|                    |\n   Figure\
    \ 3: Failed Transfer - Target Busy\n"
- title: 6.3.2.  Transfer Target Does Not Answer
  contents:
  - "6.3.2.  Transfer Target Does Not Answer\n             Transferor           Transferee\
    \             Transfer\n                  |                    |             \
    \     Target\n                  |            INVITE  |                    |\n\
    \          dialog1 |<-------------------|                    |\n             \
    \     |            200 OK  |                    |\n          dialog1 |------------------->|\
    \                    |\n                  |            ACK     |             \
    \       |\n          dialog1 |<-------------------|                    |\n   \
    \               |  INVITE (hold)     |                    |\n          dialog1\
    \ |------------------->|                    |\n                  |  200 OK   \
    \         |                    |\n          dialog1 |<-------------------|   \
    \                 |\n                  |  ACK               |                \
    \    |\n          dialog1 |------------------->|                    |\n      \
    \            |  REFER             |                    |\n          dialog2 |------------------->|\
    \                    |\n                  |  202 Accepted      |             \
    \       |\n          dialog2 |<-------------------|                    |\n   \
    \               | NOTIFY (100 Trying)|                    |\n          dialog2\
    \ |<-------------------|                    |\n                  |           \
    \ 200 OK  |                    |\n          dialog2 |------------------->|   \
    \                 |\n                  |                    |  INVITE        \
    \    |\n          dialog3 |                    |------------------->|\n      \
    \            |                    |  180 Ringing       |\n          dialog3 |\
    \                    |<-------------------|\n                  |          (Transferee\
    \ gets tired of waiting)\n                  |                    |  CANCEL   \
    \         |\n          dialog3 |                    |------------------->|\n \
    \                 |                    |  200 OK (CANCEL)   |\n          dialog3\
    \ |                    |<-------------------|\n                  |           \
    \      487 Request Cancelled (INVITE)\n          dialog3 |                   \
    \ |<-------------------|\n                  |                    |  ACK      \
    \         |\n          dialog3 |                    |------------------->|\n \
    \                 |    NOTIFY (487 Request Cancelled)       |\n          dialog2\
    \ |<-------------------|                    |\n                  |           \
    \ 200 OK  |                    |\n          dialog2 |------------------->|   \
    \                 |\n                  |  INVITE (unhold)   |                \
    \    |\n          dialog1 |------------------->|                    |\n      \
    \            |  200 OK            |                    |\n          dialog1 |<-------------------|\
    \                    |\n                  |  ACK               |             \
    \       |\n          dialog1 |------------------->|                    |\n   \
    \               |  BYE               |                    |\n          dialog1\
    \ |------------------->|                    |\n                  |  200 OK   \
    \         |                    |\n          dialog1 |<-------------------|   \
    \                 |\n   Figure 4: Failed Transfer - Target Does Not Answer\n"
- title: 7.  Transfer with Consultation Hold
  contents:
  - "7.  Transfer with Consultation Hold\n   Transfer with consultation hold involves\
    \ a session between the\n   Transferor and the Transfer Target before the transfer\
    \ actually takes\n   place.  This is implemented with SIP Hold and Transfer as\
    \ described\n   above.\n   A nice feature is for the Transferor to let the target\
    \ know that the\n   session relates to an intended transfer.  Since many UAs render\
    \ the\n   display name in the From header field to the user, a consultation\n\
    \   INVITE could contain a string such as \"Incoming consultation from\n   Transferor\
    \ with intent to transfer Transferee\", where the display\n   names of the transferor\
    \ and transferee are included in the string.\n"
- title: 7.1.  Exposing Transfer Target
  contents:
  - "7.1.  Exposing Transfer Target\n   The Transferor places the Transferee on hold,\
    \ establishes a call with\n   the Transfer Target to alert them to the impending\
    \ transfer,\n   terminates the connection with the Transfer Target, then proceeds\n\
    \   with transfer as above.  This variation can be used to provide an\n   experience\
    \ similar to that expected by current PBX and Centrex users.\n   To (hopefully)\
    \ improve clarity, non-REFER transactions have been\n   collapsed into one indicator\
    \ with the arrow showing the direction of\n   the request.\n             Transferor\
    \           Transferee             Transfer\n                  |             \
    \       |                  Target\n                  |                    |  \
    \                  |\n          dialog1 | INVITE/200 OK/ACK  |               \
    \     |\n                  |<-------------------|                    |\n     \
    \     dialog1 | INVITE (hold)/200 OK/ACK                |\n                  |------------------->|\
    \                    |\n          dialog2 | INVITE/200 OK/ACK  |             \
    \       |\n                  |---------------------------------------->|\n   \
    \       dialog2 | BYE/200 OK         |                    |\n                \
    \  |---------------------------------------->|\n          dialog3 | REFER    \
    \          |                    |\n                  |------------------->|  \
    \                  |\n          dialog3 | 202 Accepted       |               \
    \     |\n                  |<-------------------|                    |\n     \
    \     dialog3 | NOTIFY (100 Trying)|                    |\n                  |<-------------------|\
    \                    |\n          dialog3 |            200 OK  |             \
    \       |\n                  |------------------->|                    |\n   \
    \       dialog4 |                    |  INVITE/200 OK/ACK |\n                \
    \  |                    |------------------->|\n          dialog3 | NOTIFY (200\
    \ OK)    |                    |\n                  |<-------------------|    \
    \                |\n          dialog3 |            200 OK  |                 \
    \   |\n                  |------------------->|                    |\n       \
    \   dialog1 | BYE/200 OK         |                    |\n                  |------------------->|\
    \                    |\n          dialog4 |                    |         BYE/200\
    \ OK |\n                  |                    |<-------------------|\n   Figure\
    \ 5: Transfer with Consultation Hold - Exposing Transfer Target\n"
- title: 7.2.  Protecting Transfer Target
  contents:
  - "7.2.  Protecting Transfer Target\n   The Transferor places the Transferee on\
    \ hold, establishes a call with\n   the Transfer Target and then reverses their\
    \ roles, transferring the\n   original Transfer Target to the original Transferee.\
    \  This has the\n   advantage of hiding information about the original Transfer\
    \ Target\n   from the original Transferee.  On the other hand, the Transferee's\n\
    \   experience is different than in current systems.  The Transferee is\n   effectively\
    \ \"called back\" by the Transfer Target.\n   One of the problems with this simplest\
    \ implementation of a target\n   protecting transfer is that the Transferee is\
    \ receiving a new call\n   from the Transfer Target.  Unless the Transferee's\
    \ agent has a\n   reliable way to associate this new call with the call it already\
    \ has\n   with the Transferor, it will have to alert the new call on another\n\
    \   appearance.  If this, or some other call-waiting-like UI were not\n   available,\
    \ the Transferee might be stuck returning a Busy-Here to the\n   Transfer Target,\
    \ effectively preventing the transfer.  There are many\n   ways that correlation\
    \ could be provided.  The dialog parameters could\n   be provided directly as\
    \ header parameters in the Refer-To URI, for\n   example.  The Replaces mechanism\
    \ [RFC3891] uses this approach and\n   solves this problem nicely.\n   For the\
    \ flow below, dialog1 means dialog identifier 1, and consists\n   of the parameters\
    \ of the Replaces header for dialog 1.  In [RFC3891],\n   this is the Call-ID,\
    \ To-tag, and From-tag.\n   Note that the Transferee's agent emits a BYE to the\
    \ Transferor's\n   agent as an immediate consequence of processing the Replaces\
    \ header.\n   The Transferor knows that both the Transferee and the Transfer Target\n\
    \   support the Replaces header from the Supported: replaces header\n   contained\
    \ in the 200 OK responses from both.\n   In this scenario, the Transferee utilizes\
    \ a GRUU as a Contact URI for\n   reasons discussed in Section 6.3.\n   Note that\
    \ the conventions used in the SIP Torture Test Messages\n   [RFC4475] document\
    \ are reused, specifically the <allOneLine> tag.\n             Transferor    \
    \       Transferee             Transfer\n                  |                 \
    \   |                  Target\n                  |                    |      \
    \              |\n        dialog1   | INVITE/200 OK/ACK F1 F2                \
    \ |\n                  |<-------------------|                    |\n        dialog1\
    \   | INVITE (hold)/200 OK/ACK                |\n                  |------------------->|\
    \                    |\n        dialog2   | INVITE/200 OK/ACK F3 F4          \
    \       |\n                  |---------------------------------------->|\n   \
    \     dialog2   | INVITE (hold)/200 OK/ACK                |\n                \
    \  |---------------------------------------->|\n        dialog3   | REFER (Target-Dialog:2,\
    \                 |\n                  |  Refer-To:sips:Transferee?Replaces=1)\
    \ F5|\n                  |---------------------------------------->|\n       \
    \ dialog3   | 202 Accepted       |                    |\n                  |<----------------------------------------|\n\
    \        dialog3   | NOTIFY (100 Trying)|                    |\n             \
    \     |<----------------------------------------|\n        dialog3   |       \
    \             |            200 OK  |\n                  |---------------------------------------->|\n\
    \        dialog4   |         INVITE (Replaces:dialog1)/200 OK/ACK F6\n       \
    \           |                    |<-------------------|\n        dialog1   | BYE/200\
    \ OK         |                    |\n                  |<-------------------|\
    \                    |\n        dialog3   | NOTIFY (200 OK)    |             \
    \       |\n                  |<----------------------------------------|\n   \
    \     dialog3   |                    |            200 OK  |\n                \
    \  |---------------------------------------->|\n        dialog2   | BYE/200 OK\
    \         |                    |\n                  |---------------------------------------->|\n\
    \                  |              (Transferee and target converse)\n        dialog4\
    \   |                    |  BYE/200 OK        |\n                  |         \
    \           |------------------->|\n   Figure 6: Transfer Protecting Transfer\
    \ Target\n   F1 INVITE Transferee -> Transferor\n   INVITE sips:transferor@atlanta.example.com\
    \ SIP/2.0\n   Via: SIP/2.0/TLS 192.0.2.4;branch=z9hG4bKnas432\n   Max-Forwards:\
    \ 70\n   To: <sips:transferor@atlanta.example.com>\n   From: <sips:transferee@biloxi.example.com>;tag=7553452\n\
    \   Call-ID: 090459243588173445\n   CSeq: 29887 INVITE\n   Allow: INVITE, ACK,\
    \ CANCEL, OPTIONS, BYE, REFER, NOTIFY\n   Supported: replaces, gruu\n   Contact:\
    \ <sips:3ld812adkjw@biloxi.example.com;gr=3413kj2ha>\n   Content-Type: application/sdp\n\
    \   Content-Length: ...\n   F2 200 OK Transferor -> Transferee\n   SIP/2.0 200\
    \ OK\n   Via: SIP/2.0/TLS 192.0.2.4;branch=z9hG4bKnas432\n   To: <sips:transferor@atlanta.example.com>;tag=31431\n\
    \   From: <sips:transferee@biloxi.example.com>;tag=7553452\n   Call-ID: 090459243588173445\n\
    \   CSeq: 29887 INVITE\n   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY\n\
    \   Supported: replaces, gruu, tdialog\n   Contact: <sips:4889445d8kjtk3@atlanta.example.com;gr=723jd2d>\n\
    \   Content-Type: application/sdp\n   Content-Length: ...\n   F3 INVITE Transferor\
    \ -> Transfer Target\n   INVITE sips:transfertarget@chicago.example.com SIP/2.0\n\
    \   Via: SIP/2.0/TLS pc33.atlanta.example.com;branch=z9hG4bKnas432\n   Max-Forwards:\
    \ 70\n   To: <sips:transfertarget@chicago.example.com>\n   From: <sips:transferor@atlanta.example.com>;tag=763231\n\
    \   Call-ID: 592435881734450904\n   CSeq: 29887 INVITE\n   Allow: INVITE, ACK,\
    \ CANCEL, OPTIONS, BYE, REFER, NOTIFY\n   Supported: gruu, replaces, tdialog\n\
    \   Require: replaces\n   Contact: <sips:4889445d8kjtk3@atlanta.example.com;gr=384i32lw3>\n\
    \   Content-Type: application/sdp\n   Content-Length: ...\n   F4 200 OK Transfer\
    \ Target -> Transferor\n   SIP/2.0 200 OK\n   Via: SIP/2.0/TLS pc33.atlanta.example.com;branch=z9hG4bKnas432\n\
    \    ;received=192.0.2.1\n   To: <sips:transfertarget@chicago.example.com>;tag=9m2n3wq\n\
    \   From: <sips:transferor@atlanta.example.com>;tag=763231\n   Call-ID: 592435881734450904\n\
    \   CSeq: 29887 INVITE\n   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY\n\
    \   Supported: replaces, gruu, tdialog\n   Contact: <sips:482n4z24kdg@chicago.example.com;gr=8594958>\n\
    \   Content-Type: application/sdp\n   Content-Length: ...\n   F5 REFER Transferor\
    \ -> Transfer Target\n   REFER sips:482n4z24kdg@chicago.example.com;gr=8594958\
    \ SIP/2.0\n   Via: SIP/2.0/TLS pc33.atlanta.example.com;branch=z9hG4bKnashds9\n\
    \   Max-Forwards: 70\n   To: <sips:482n4z24kdg@chicago.example.com;gr=8594958>\n\
    \   From: <sips:transferor@atlanta.example.com>;tag=1928301774\n   Call-ID: a84b4c76e66710\n\
    \   CSeq: 314159 REFER\n   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY\n\
    \   Supported: gruu, replaces, tdialog\n   Require: tdialog\n   <allOneLine>\n\
    \   Refer-To: <sips:3ld812adkjw@biloxi.example.com;gr=3413kj2ha\n   ?Replaces=090459243588173445%3Bto-tag%3D7553452%3Bfrom-tag%3D31431>\n\
    \   </allOneLine>\n   Target-Dialog: 592435881734450904;local-tag=9m2n3wq\n  \
    \  ;remote-tag=763231\n   Contact: <sips:4889445d8kjtk3@atlanta.example.com;gr=723jd2d>\n\
    \   Content-Length: 0\n   F6 INVITE Transfer Target -> Transferee\n   INVITE sips:3ld812adkjw@biloxi.example.com;gr=3413kj2ha\
    \ SIP/2.0\n   Via: SIP/2.0/TLS client.chicago.example.com;branch=z9hG4bKnaslu84\n\
    \   Max-Forwards: 70\n   To: <sips:3ld812adkjw@biloxi.example.com;gr=3413kj2ha>\n\
    \   From: <sips:transfertarget@chicago.example.com>;tag=341234\n   Call-ID: kmzwdle3dl3d08\n\
    \   CSeq: 41 INVITE\n   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY\n\
    \   Supported: gruu, replaces, tdialog\n   Contact: <sips:482n4z24kdg@chicago.example.com;gr=8594958>\n\
    \   Replaces: 090459243588173445;to-tag=7553452;from-tag=31431\n   Content-Type:\
    \ application/sdp\n   Content-Length: ...\n"
- title: 7.3.  Attended Transfer
  contents:
  - "7.3.  Attended Transfer\n   The Transferor places the Transferee on hold, establishes\
    \ a call with\n   the Transfer Target to alert them to the impending transfer,\
    \ places\n   the target on hold, then proceeds with transfer using an escaped\n\
    \   Replaces header field in the Refer-To header.  This is another common\n  \
    \ service expected by current PBX and Centrex users.\n   The Contact URI of the\
    \ Transfer Target SHOULD be used by the\n   Transferor as the Refer-To URI, unless\
    \ the URI is suspected or known\n   to not be routable outside the dialog.  Otherwise,\
    \ the Address of\n   Record (AOR) of the Transfer Target SHOULD be used.  That\
    \ is, the\n   same URI that the Transferor used to establish the session with\
    \ the\n   Transfer Target should be used.  In case the triggered INVITE is\n \
    \  routed to a different User Agent than the Transfer Target, the\n   Require:\
    \ replaces header field SHOULD be used in the triggered\n   INVITE.  (This is\
    \ to prevent an incorrect User Agent that does not\n   support Replaces from ignoring\
    \ the Replaces and answering the INVITE\n   without a dialog match.)\n   It is\
    \ possible that proxy/service routing may prevent the triggered\n   INVITE from\
    \ reaching the same User Agent.  If this occurs, the\n   triggered invite will\
    \ fail with a timeout, 403, 404, etc. error.  The\n   Transferee MAY then retry\
    \ the transfer with the Refer-To URI set to\n   the Contact URI.\n           \
    \  Transferor           Transferee             Transfer\n                  | \
    \                   |                  Target\n                  |           \
    \         |                    |\n         dialog1  | INVITE/200 OK/ACK F1 F2\
    \                 |\n                  |<-------------------|                \
    \    |\n         dialog1  | INVITE (hold)/200 OK/ACK                |\n      \
    \            |------------------->|                    |\n         dialog2  |\
    \ INVITE/200 OK/ACK F3 F4                 |\n                  |---------------------------------------->|\n\
    \         dialog2  | INVITE (hold)/200 OK/ACK                |\n             \
    \     |---------------------------------------->|\n         dialog3  | REFER (Target-Dialog:1,\
    \                 |\n                  |  Refer-To:sips:TransferTarget?Replaces=2)\
    \ F5\n                  |------------------->|                    |\n        \
    \ dialog3  | 202 Accepted       |                    |\n                  |<-------------------|\
    \                    |\n         dialog3  | NOTIFY (100 Trying)|             \
    \       |\n                  |<-------------------|                    |\n   \
    \      dialog3  |            200 OK  |                    |\n                \
    \  |------------------->|                    |\n         dialog4  |        INVITE\
    \ (Replaces:dialog2)/200 OK/ACK F6\n                  |                    |------------------->|\n\
    \         dialog2  | BYE/200 OK         |                    |\n             \
    \     |<----------------------------------------|\n         dialog3  | NOTIFY\
    \ (200 OK)    |                    |\n                  |<-------------------|\
    \                    |\n         dialog3  |            200 OK  |             \
    \       |\n                  |------------------->|                    |\n   \
    \      dialog1  | BYE/200 OK         |                    |\n                \
    \  |------------------->|                    |\n         dialog4  |          \
    \          |         BYE/200 OK |\n                  |                    |<-------------------|\n\
    \   Figure 7: Attended Transfer Call Flow\n   F1 INVITE Transferee -> Transferor\n\
    \   INVITE sips:transferor@atlanta.example.com SIP/2.0\n   Via: SIP/2.0/TLS 192.0.2.4;branch=z9hG4bKnas432\n\
    \   Max-Forwards: 70\n   To: <sips:transferor@atlanta.example.com>\n   From: <sips:transferee@biloxi.example.com>;tag=7553452\n\
    \   Call-ID: 090459243588173445\n   CSeq: 29887 INVITE\n   Allow: INVITE, ACK,\
    \ CANCEL, OPTIONS, BYE, REFER, NOTIFY\n   Supported: replaces, gruu, tdialog\n\
    \   Contact: <sips:3ld812adkjw@biloxi.example.com;gr=3413kj2ha>\n   Content-Type:\
    \ application/sdp\n   Content-Length: ...\n   F2 200 OK Transferor -> Transferee\n\
    \   SIP/2.0 200 OK\n   Via: SIP/2.0/TLS 192.0.2.4;branch=z9hG4bKnas432\n   To:\
    \ <sips:transferor@atlanta.example.com>;tag=31431\n   From: <sips:transferee@biloxi.example.com>;tag=7553452\n\
    \   Call-ID: 090459243588173445\n   CSeq: 29887 INVITE\n   Allow: INVITE, ACK,\
    \ CANCEL, OPTIONS, BYE, REFER, NOTIFY\n   Supported: replaces, gruu, tdialog\n\
    \   Contact: <sips:4889445d8kjtk3@atlanta.example.com;gr=723jd2d>\n   Content-Type:\
    \ application/sdp\n   Content-Length: ...\n   F3 INVITE Transferor -> Transfer\
    \ Target\n   INVITE sips:transfertarget@chicago.example.com SIP/2.0\n   Via: SIP/2.0/TLS\
    \ pc33.atlanta.example.com;branch=z9hG4bKnas432\n   Max-Forwards: 70\n   To: <sips:transfertarget@chicago.example.com>\n\
    \   From: <sips:transferor@atlanta.example.com>;tag=763231\n   Call-ID: 592435881734450904\n\
    \   CSeq: 29887 INVITE\n   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY\n\
    \   Supported: gruu, replaces, tdialog\n   Require: replaces\n   Contact: <sips:4889445d8kjtk3@atlanta.example.com;gr=384i32lw3>\n\
    \   Content-Type: application/sdp\n   Content-Length: ...\n   F4 200 OK Transfer\
    \ Target -> Transferor\n   SIP/2.0 200 OK\n   Via: SIP/2.0/TLS pc33.atlanta.example.com;branch=z9hG4bKnas432\n\
    \    ;received=192.0.2.1\n   To: <sips:transfertarget@chicago.example.com>;tag=9m2n3wq\n\
    \   From: <sips:transferor@atlanta.example.com>;tag=763231\n   Call-ID: 592435881734450904\n\
    \   CSeq: 29887 INVITE\n   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY\n\
    \   Supported: replaces, gruu\n   Contact: <sips:482n4z24kdg@chicago.example.com;gr=8594958>\n\
    \   Content-Type: application/sdp\n   Content-Length: ...\n   F5 REFER Transferor\
    \ -> Transferee\n   REFER sips:3ld812adkjw@biloxi.example.com;gr=3413kj2ha SIP/2.0\n\
    \   Via: SIP/2.0/TLS pc33.atlanta.example.com;branch=z9hG4bKnashds9\n   Max-Forwards:\
    \ 70\n   To: <sips:3ld812adkjw@biloxi.example.com;gr=3413kj2ha>\n   From: <sips:transferor@atlanta.example.com>;tag=1928301774\n\
    \   Call-ID: a84b4c76e66710\n   CSeq: 314159 REFER\n   Require: tdialog\n   <allOneLine>\n\
    \   Refer-To: <sips:482n4z24kdg@chicago.example.com;gr=8594958?\n   Replaces=592435881734450904%3Bto-tag%3D9m2n3wq%3Bfrom-tag3D763231>\n\
    \   </allOneLine>\n   Target-Dialog: 592435881734450904;local-tag=9m2n3wq\n  \
    \  ;remote-tag=763231\n   Contact: <sips:4889445d8kjtk3@atlanta.example.com;gr=723jd2d>\n\
    \   Content-Length: 0\n   F6 INVITE Transferee -> Transfer Target\n   INVITE sips:482n4z24kdg@chicago.example.com;gr=8594958\
    \ SIP/2.0\n   Via: SIP/2.0/TLS 192.0.2.4;branch=z9hG4bKnaslu82\n   Max-Forwards:\
    \ 70\n   To: <sips:482n4z24kdg@chicago.example.com;gr=8594958>\n   From: <sips:transferee@biloxi.example.com>;tag=954\n\
    \   Call-ID: kmzwdle3dl3d08\n   CSeq: 41 INVITE\n   Allow: INVITE, ACK, CANCEL,\
    \ OPTIONS, BYE, REFER, NOTIFY\n   Supported: gruu, replaces, tdialog\n   Contact:\
    \ <sips:3ld812adkjw@biloxi.example.com;gr=3413kj2ha>\n   Replaces: 592435881734450904;to-tag=9m2n3wq;from-tag=763231\n\
    \   Content-Type: application/sdp\n   Content-Length: ...\n"
- title: 7.4.  Recovery When One Party Does Not Support REFER
  contents:
  - "7.4.  Recovery When One Party Does Not Support REFER\n   If protecting or exposing\
    \ the Transfer Target is not a concern, it is\n   possible to complete a transfer\
    \ with consultation hold when only the\n   transferor and one other party support\
    \ REFER.  Note that a 405 Method\n   Not Allowed might be returned instead of\
    \ the 501 Not Implemented\n   response.\n             Transferor           Transferee\
    \             Transfer\n                  |                    |             \
    \     Target\n                  |                    |                    |\n\
    \         dialog1  | INVITE/200 OK/ACK  |                    |\n             \
    \     |<-------------------|                    |\n         dialog1  | INVITE\
    \ (hold)/200 OK/ACK                |\n                  |------------------->|\
    \                    |\n         dialog2  | INVITE/200 OK/ACK  |             \
    \       |\n                  |---------------------------------------->|\n   \
    \      dialog2  | INVITE (hold)/200 OK/ACK                |\n                \
    \  |---------------------------------------->|\n         dialog3  | REFER (Target-Dialog:1,\
    \                 |\n                  |    Refer-To:sips:TransferTarget?Replaces=2)\n\
    \                  |------------------->|                    |\n         dialog3\
    \  | 501 Not Implemented                     |\n                  |<-------------------|\
    \                    |\n         dialog4  | REFER (Refer-To:sips:Transferee?Replaces=dialog1)\n\
    \                  |---------------------------------------->|\n         dialog4\
    \  | 202 Accepted       |                    |\n                  |<----------------------------------------|\n\
    \         dialog4  | NOTIFY (100 Trying)|                    |\n             \
    \     |<----------------------------------------|\n         dialog4  |       \
    \             |            200 OK  |\n                  |---------------------------------------->|\n\
    \         dialog5  |             INVITE (Replaces:dialog1)/200 OK/ACK\n      \
    \            |                    |<-------------------|\n         dialog4  |\
    \ NOTIFY (200 OK)    |                    |\n                  |<----------------------------------------|\n\
    \         dialog4  |                    |            200 OK  |\n             \
    \     |---------------------------------------->|\n         dialog1  | BYE/200\
    \ OK         |                    |\n                  |<-------------------|\
    \                    |\n         dialog2  | BYE/200 OK         |             \
    \       |\n                  |---------------------------------------->|\n   \
    \      dialog5  |                    |  BYE/200 OK        |\n                \
    \  |                    |------------------->|\n   Figure 8: Recovery When One\
    \ Party Does Not Support REFER\n"
- title: 7.5.  Attended Transfer When Contact URI Is Not Known to Route to a
  contents:
  - "7.5.  Attended Transfer When Contact URI Is Not Known to Route to a\n      Unique\
    \ User Agent\n   It is a requirement of RFC 3261 that a Contact URI be globally\n\
    \   routable even outside the dialog.  However, due to RFC 2543 User\n   Agents\
    \ and some architectures (NAT/Firewall traversal, screening\n   proxies, Application\
    \ Layer Gateways (ALGs), etc.) this will not\n   always be the case.  As a result,\
    \ the method of attended transfer\n   shown in Figures 6, 7, and 8 SHOULD only\
    \ be used if the Contact URI\n   is known to be routable outside the dialog.\n\
    \   Figure 9 shows such a scenario where the Transfer Target Contact URI\n   is\
    \ not routable outside the dialog, so the triggered INVITE is sent\n   to the\
    \ AOR of the Transfer Target.\n          Transferor           Transferee  Screening\
    \       Transfer\n              |                  |           Proxy         Target\n\
    \              |                  |             |             |\n      dialog1\
    \ | INVITE/200 OK/ACK|             |             |\n              |<-----------------|\
    \             |             |\n      dialog1 | INVITE (hold)/200 OK/ACK      \
    \ |             |\n              |----------------->|             |          \
    \   |\n      dialog2 | INVITE/200 OK/ACK F1 F2        |             |\n      \
    \        |--------------------------------|------------>|\n      dialog2 | INVITE\
    \ (hold)/200 OK/ACK                     |\n              |--------------------------------|------------>|\n\
    \      dialog1 | REFER (Refer-To:sips:TargetAOR               |\n            \
    \  |         ?Replaces=dialog2&Require=replaces) F3\n              |----------------->|\
    \             |             |\n      dialog1 | 202 Accepted     |            \
    \ |             |\n              |<-----------------|             |          \
    \   |\n      dialog1 | NOTIFY (100 Trying)            |             |\n      \
    \        |<-----------------|             |             |\n      dialog1 |   \
    \       200 OK  |             |             |\n              |----------------->|\
    \             |             |\n      dialog4 |INVITE (Replaces:dialog2,Require:replaces)/200\
    \ OK/ACK F6\n              |                  |------------>|------------>|\n\
    \      dialog2 | BYE/200 OK       |             |             |\n            \
    \  |<-------------------------------|<------------|\n      dialog1 | NOTIFY (200\
    \ OK) F7             |             |\n              |<-----------------|     \
    \        |             |\n      dialog1 |          200 OK  |             |   \
    \          |\n              |----------------->|             |             |\n\
    \      dialog1 | BYE/200 OK       |             |             |\n            \
    \  |----------------->|             |             |\n      dialog3 |         \
    \         |             |  BYE/200 OK |\n              |                  |<------------|-------------|\n\
    \   Figure 9: Attended Transfer Call Flow with a Contact URI Not Known to\n  \
    \ Be Globally Routable\n   F1 INVITE Transferor -> Transfer Target\n   INVITE\
    \ sips:transfertarget@chicago.example.com SIP/2.0\n   Via: SIP/2.0/TLS pc33.atlanta.example.com;branch=z9hG4bK76\n\
    \   Max-Forwards: 70\n   To: <sips:transfertarget@chicago.example.com>\n   From:\
    \ <sips:transferor@atlanta.example.com>;tag=763231\n   Call-ID: 090459243588173445\n\
    \   CSeq: 29887 INVITE\n   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY\n\
    \   Supported: replaces\n   Contact: <sips:transferor@pc33.atlanta.example.com>\n\
    \   Content-Type: application/sdp\n   Content-Length: ...\n   F2 200 OK Transfer\
    \ Target -> Transferee\n   SIP/2.0 200 OK\n   Via: SIP/2.0/TLS pc33.atlanta.example.com;branch=z9hG4bKnas432\n\
    \    ;received=192.0.2.1\n   To: <sips:transfertarget@chicago.example.com>;tag=9m2n3wq\n\
    \   From: <sips:transferor@atlanta.example.com>;tag=763231\n   Call-ID: 090459243588173445\n\
    \   CSeq: 29887 INVITE\n   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY\n\
    \   Supported: replaces\n   Contact: <sips:transfertarget@client.chicago.example.com>\n\
    \   Content-Type: application/sdp\n   Content-Length: ...\n   F3 REFER Transferor\
    \ -> Transferee\n   REFER sips:transferee@192.0.2.4 SIP/2.0\n   Via: SIP/2.0/TLS\
    \ pc33.atlanta.example.com;branch=z9hG4bKnashds9\n   Max-Forwards: 70\n   To:\
    \ <sips:transferee@biloxi.example.com>;tag=a6c85cf\n   From: <sips:transferor@atlanta.example.com>;tag=1928301774\n\
    \   Call-ID: a84b4c76e66710\n   CSeq: 314160 REFER\n   <allOneLine>\n   Refer-To:\
    \ <sips:transfertarget@chicago.example.com?Replaces=\n   090459243588173445%3Bto-tag%3D9m2n3wq%3Bfrom-tag%3D763231\n\
    \   &Require=replaces>\n   <allOneLine>\n   Contact: <sips:transferor@pc33.atlanta.example.com>\n\
    \   Content-Length: 0\n   F4 INVITE Transferee -> Transfer Target\n   INVITE sips:transfertarget@chicago.example.com\
    \ SIP/2.0\n   Via: SIP/2.0/TLS 192.0.2.4;branch=z9hG4bKnaslu82\n   Max-Forwards:\
    \ 70\n   To: <sips:transfertarget@chicago.example.com>\n   From: <sips:transferee@biloxi.example.com>;tag=954\n\
    \   Call-ID: 20482817324945934422930\n   CSeq: 42 INVITE\n   Allow: INVITE, ACK,\
    \ CANCEL, OPTIONS, BYE, REFER, NOTIFY\n   Supported: replaces\n   Contact: <sips:transferee@192.0.2.4>\n\
    \   Replaces: 090459243588173445;to-tag=9m2n3wq;from-tag=763231\n   Require: replaces\n\
    \   Content-Type: application/sdp\n   Content-Length: ...\n   F5 NOTIFY Transferee\
    \ -> Transferor\n   NOTIFY sips:transferor@pc33.atlanta.com SIP/2.0\n   Via: SIP/2.0/TLS\
    \ 192.0.2.4;branch=z9hG4bKnas432\n   Max-Forwards: 70\n   To: <sips:transferor@atlanta.example.com>;tag=1928301774\n\
    \   From: <sips:transferee@biloxi.example.com>;tag=a6c85cf\n   Call-ID: a84b4c76e66710\n\
    \   CSeq: 76 NOTIFY\n   Contact: <sips:3ld812adkjw@biloxi.example.com;gr=3413kj2ha>\n\
    \   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY\n   Supported: replaces\n\
    \   Event: refer;id=98873867\n   Subscription-State: terminated;reason=noresource\n\
    \   Content-Type: message/sipfrag\n   Content-Length: ...\n   SIP/2.0 200 OK\n\
    \   Figure 10 shows a failure case in which the AOR URI fails to reach\n   the\
    \ Transfer Target.  As a result, the transfer is retried with the\n   Contact\
    \ URI, at which point it succeeds.\n   Note that there is still no guarantee that\
    \ the correct endpoint will\n   be reached, and the result of this second REFER\
    \ may also be a\n   failure.  In that case, the Transferor could fall back to\
    \ unattended\n   transfer or give up on the transfer entirely.  Since two REFERs\
    \ are\n   sent within the dialog creating two distinct subscriptions, the\n  \
    \ Transferee uses the 'id' parameter in the Event header field to\n   distinguish\
    \ notifications for the two subscriptions.\n          Transferor           Transferee\
    \  Screening      Transfer\n              |                  |           Proxy\
    \         Target\n              |                  |             |           \
    \  |\n      dialog1 | INVITE/200 OK/ACK|             |             |\n       \
    \       |<-----------------|             |             |\n      dialog1 | INVITE\
    \ (hold)/200 OK/ACK       |             |\n              |----------------->|\
    \             |             |\n      dialog2 | INVITE/200 OK/ACK F1 F2       \
    \ |             |\n              |--------------------------------|------------>|\n\
    \      dialog2 | INVITE (hold)/200 OK/ACK                     |\n            \
    \  |--------------------------------|------------>|\n      dialog1 | REFER (Refer-To:sips:TargetAOR?\
    \              |\n              |       Replaces=dialog2&Require=replaces) F3\
    \  |\n              |----------------->|             |             |\n      dialog1\
    \ | 202 Accepted     |             |             |\n              |<-----------------|\
    \             |             |\n      dialog1 | NOTIFY (100 Trying)           \
    \ |             |\n              |<-----------------|             |          \
    \   |\n      dialog1 |          200 OK  |             |             |\n      \
    \        |----------------->|             |             |\n      dialog3 |   \
    \               |INVITE (Replaces:dialog2,  |\n              |               \
    \   | Require:replaces)/403/ACK |\n              |                  |------------>|\
    \             |\n      dialog1 | NOTIFY (403 Forbidden) F4      |            \
    \ |\n              |<-----------------|             |             |\n      dialog1\
    \ |          200 OK  |             |             |\n              |----------------->|\
    \             |             |\n      dialog1 |REFER(Refer-To:sips:TargetContact?Replaces=dialog2)\
    \ F5\n              |----------------->|             |             |\n      dialog1\
    \ | 202 Accepted     |             |             |\n              |<-----------------|\
    \             |             |\n      dialog1 | NOTIFY (100 Trying)           \
    \ |             |\n              |<-----------------|             |          \
    \   |\n      dialog1 |          200 OK  |             |             |\n      \
    \        |----------------->|             |             |\n      dialog4 |   \
    \             INVITE (Replaces:dialog2)/200 OK/ACK F6\n              |       \
    \           |------------>|------------>|\n      dialog2 | BYE/200 OK       |\
    \             |             |\n              |<-------------------------------|<------------|\n\
    \      dialog1 | NOTIFY (200 OK) F7             |             |\n            \
    \  |<-----------------|             |             |\n      dialog1 |         \
    \ 200 OK  |             |             |\n              |----------------->|  \
    \           |             |\n      dialog1 | BYE/200 OK       |             |\
    \             |\n              |----------------->|             |            \
    \ |\n      dialog3 |                  |             |  BYE/200 OK |\n        \
    \      |                  |<------------|-------------|\n   Figure 10: Attended\
    \ Transfer Call Flow with Non-Routable Contact URI\n   and AOR Failure\n   F1\
    \ INVITE Transferor -> Transfer Target\n   INVITE sips:transfertarget@chicago.example.com\
    \ SIP/2.0\n   Via: SIP/2.0/TLS pc33.atlanta.example.com;branch=z9hG4bK76\n   Max-Forwards:\
    \ 70\n   To: <sips:transfertarget@chicago.example.com>\n   From: <sips:transferor@atlanta.example.com>;tag=763231\n\
    \   Call-ID: 090459243588173445\n   CSeq: 29887 INVITE\n   Allow: INVITE, ACK,\
    \ CANCEL, OPTIONS, BYE, REFER, NOTIFY\n   Supported: replaces\n   Contact: <sips:transferor@pc33.atlanta.example.com>\n\
    \   Content-Type: application/sdp\n   Content-Length: ...\n   F2 200 OK Transfer\
    \ Target -> Transferee\n   SIP/2.0 200 OK\n   Via: SIP/2.0/TLS pc33.atlanta.example.com;branch=z9hG4bKnas432\n\
    \    ;received=192.0.2.1\n   To: <sips:transfertarget@chicago.example.com>;tag=9m2n3wq\n\
    \   From: <sips:transferor@atlanta.example.com>;tag=763231\n   Call-ID: 090459243588173445\n\
    \   CSeq: 29887 INVITE\n   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY\n\
    \   Supported: replaces\n   Contact: <sips:transfertarget@client.chicago.example.com>\n\
    \   Content-Type: application/sdp\n   Content-Length: ...\n   F3 REFER Transferor\
    \ -> Transferee\n   REFER sips:transferee@192.0.2.4 SIP/2.0\n   Via: SIP/2.0/TLS\
    \ pc33.atlanta.example.com;branch=z9hG4bKnashds9\n   Max-Forwards: 70\n   To:\
    \ <sips:transferee@biloxi.example.com>;tag=a6c85cf\n   From: <sips:transferor@atlanta.example.com>;tag=1928301774\n\
    \   Call-ID: a84b4c76e66710\n   CSeq: 314159 REFER\n   <allOneLine>\n   Refer-To:\
    \ <sips:transfertarget@chicago.example.com?Replaces=\n   090459243588173445%3Bto-tag%3D9m2n3wq%3Bfrom-tag%3D763231\n\
    \   &Require=replaces>\n   </allOneLine>\n   Contact: <sips:transferor@pc33.atlanta.example.com>\n\
    \   Content-Length: 0\n   F4 NOTIFY Transferee -> Transferor\n   NOTIFY sips:transferor@pc33.atlanta.com\
    \ SIP/2.0\n   Via: SIP/2.0/TLS 192.0.2.4;branch=z9hG4bKnas432\n   Max-Forwards:\
    \ 70\n   To: <sips:transferor@atlanta.example.com>;tag=1928301774\n   From: <sips:transferee@biloxi.example.com>;tag=a6c85cf\n\
    \   Call-ID: a84b4c76e66710\n   CSeq: 74 NOTIFY\n   Contact: <sips:3ld812adkjw@biloxi.example.com;gr=3413kj2ha>\n\
    \   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY\n   Supported: replaces\n\
    \   Event: refer;id=314159\n   Subscription-State: terminated;reason=noresource\n\
    \   Content-Type: message/sipfrag\n   Content-Length: ...\n   SIP/2.0 403 Forbidden\n\
    \   F5 REFER Transferor -> Transferee\n   REFER sips:transferee@192.0.2.4 SIP/2.0\n\
    \   Via: SIP/2.0/TLS pc33.atlanta.example.com;branch=z9hG4bKnashds9\n   Max-Forwards:\
    \ 70\n   To: <sips:transferee@biloxi.example.com>;tag=a6c85cf\n   From: <sips:transferor@atlanta.example.com>;tag=1928301774\n\
    \   Call-ID: a84b4c76e66710\n   CSeq: 314160 REFER\n   <allOneLine>\n   Refer-To:\
    \ <sips:transfertarget@client.chicago.example.com\n   ?Replaces=090459243588173445%3Bto-tag%3D9m2n3wq\n\
    \   %3Bfrom-tag%3D763231>\n   </allOneLine>\n   Contact: <sips:transferor@pc33.atlanta.example.com>\n\
    \   Content-Length: 0\n   F6 INVITE Transferee -> Transfer Target\n   INVITE sips:transfertarget@client.chicago.example.com\
    \ SIP/2.0\n   Via: SIP/2.0/TLS 192.0.2.4;branch=z9hG4bKnaslu82\n   Max-Forwards:\
    \ 70\n   To: <sips:transfertarget@chicago.example.com>\n   From: <sips:transferee@biloxi.example.com>;tag=954\n\
    \   Call-ID: 20482817324945934422930\n   CSeq: 42 INVITE\n   Allow: INVITE, ACK,\
    \ CANCEL, OPTIONS, BYE, REFER, NOTIFY\n   Supported: replaces\n   Contact: <sips:transferee@192.0.2.4>\n\
    \   Replaces: 090459243588173445;to-tag=9m2n3wq;from-tag=763231\n   Content-Type:\
    \ application/sdp\n   Content-Length: ...\n   F7 NOTIFY Transferee -> Transferor\n\
    \   NOTIFY sips:transferor@pc33.atlanta.com SIP/2.0\n   Via: SIP/2.0/TLS 192.0.2.4;branch=z9hG4bKnas432\n\
    \   Max-Forwards: 70\n   To: <sips:transferor@atlanta.example.com>;tag=1928301774\n\
    \   From: <sips:transferee@biloxi.example.com>;tag=a6c85cf\n   Call-ID: a84b4c76e66710\n\
    \   CSeq: 76 NOTIFY\n   Contact: <sips:3ld812adkjw@biloxi.example.com;gr=3413kj2ha>\n\
    \   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY\n   Supported: replaces\n\
    \   Event: refer;id=314160\n   Subscription-State: terminated;reason=noresource\n\
    \   Content-Type: message/sipfrag\n   Content-Length: ...\n   SIP/2.0 200 OK\n\
    \   To prevent this scenario from happening, the Transfer Target SHOULD\n   use\
    \ a Contact URI that is routable outside the dialog, which will\n   result in\
    \ the call flow of Figure 7.\n"
- title: 7.6.  Semi-Attended Transfer
  contents:
  - "7.6.  Semi-Attended Transfer\n   In any of the consultation hold flows above,\
    \ the Transferor may\n   decide to terminate its attempt to contact the Transfer\
    \ Target before\n   that session is established.  Most frequently, that will be\
    \ the end\n   of the scenario, but in some circumstances, the Transferor may wish\n\
    \   to proceed with the transfer action.  For example, the Transferor may\n  \
    \ wish to complete the transfer knowing that the Transferee will end up\n   eventually\
    \ talking to the Transfer Target's voicemail service.  Some\n   PBX systems support\
    \ this feature, sometimes called \"semi-attended\n   transfer\", that is effectively\
    \ a hybrid between a fully attended\n   transfer and an unattended transfer. \
    \ A call flow is shown in Figure\n   11.  In this flow, the Transferor's User\
    \ Agent continues the transfer\n   as an attended transfer even after the Transferor\
    \ hangs up.  Note\n   that media must be played to the Transfer Target upon answer\
    \ --\n   otherwise, the Target may hang up and the resulting transfer\n   operation\
    \ will fail.\n             Transferor           Transferee            Transfer\n\
    \                  |                    |                 Target\n           \
    \       |                    |                    |\n         dialog1  | INVITE/200\
    \ OK/ACK F1 F2                 |\n                  |<-------------------|   \
    \                 |\n         dialog1  | INVITE (hold)/200 OK/ACK            \
    \    |\n                  |------------------->|                    |\n      \
    \   dialog2  | INVITE             |                    |\n                  |---------------------------------------->|\n\
    \         dialog2  |                    |       180 Ringing  |\n             \
    \     |<----------------------------------------|\n               Transferor hangs\
    \ up but wants transfer to continue\n                  |                    |\
    \                    |\n                  | User Agent continues transfer operation\
    \ |\n                  |                    |                    |\n         dialog2\
    \  |                    |           200 OK   |\n                  |<----------------------------------------|\n\
    \         dialog2  | ACK                |                    |\n             \
    \     |---------------------------------------->|\n         dialog2  | Media Played\
    \ to keep Target from hanging up\n                  |========================================>|\n\
    \         dialog3  | REFER (Target-Dialog:1,                 |\n             \
    \     |  Refer-To:sips:TransferTarget?Replaces=2)\n                  |------------------->|\
    \                    |\n         dialog3  | 202 Accepted       |             \
    \       |\n                  |<-------------------|                    |\n   \
    \      dialog3  | NOTIFY (100 Trying)|                    |\n                \
    \  |<-------------------|                    |\n         dialog3  |          \
    \  200 OK  |                    |\n                  |------------------->|  \
    \                  |\n         dialog4  |             INVITE (Replaces:dialog2)/200\
    \ OK/ACK\n                  |                    |------------------->|\n    \
    \     dialog2  | BYE/200 OK         |                    |\n                 \
    \ |<----------------------------------------|\n         dialog3  | NOTIFY (200\
    \ OK)    |                    |\n                  |<-------------------|    \
    \                |\n         dialog3  |            200 OK  |                 \
    \   |\n                  |------------------->|                    |\n       \
    \  dialog1  | BYE/200 OK         |                    |\n                  |------------------->|\
    \                    |\n         dialog4  |                    |         BYE/200\
    \ OK |\n                  |                    |<-------------------|\n   Figure\
    \ 11: Recommended Semi-Attended Transfer Call Flow\n   Two other possible semi-attended\
    \ transfer call flows are shown in\n   Figures 12 and 13.  However, these call\
    \ flows are NOT RECOMMENDED due\n   to race conditions.  In both of these flows,\
    \ when the Transferor\n   hangs up, the Transferor attempts to revert to unattended\
    \ transfer by\n   sending a CANCEL to the target.  This can result in two race\n\
    \   conditions.  One is that the target answers despite the CANCEL and\n   the\
    \ resulting unattended transfer fails.  This race condition can be\n   eliminated\
    \ by the Transferor waiting to send the REFER until the 487\n   response from\
    \ the target is returned.  Instead of a 487, a 200 OK may\n   be returned indicating\
    \ that the target has answered the consultation\n   call.  In this case, the call\
    \ flow in Figure 13 must be followed.  In\n   this flow, the Transferor must play\
    \ some kind of media to the Target\n   to prevent the Target from hanging up,\
    \ or the transfer will fail.\n   That is, the human at the Transfer Target will\
    \ hear silence from when\n   they answer (message F1) until the transfer completes\
    \ (F3 and they\n   are talking to the Transferee unless some media is played (F2)).\n\
    \   The second race condition occurs in Figure 12 if the Transfer Target\n   goes\
    \ \"off hook\" after the CANCEL is received and the 487 returned.\n   This may\
    \ result in a 486 Busy Here response to the unattended\n   transfer.\n   The recommended\
    \ call flow of Figure 11 does not utilize a CANCEL and\n   does not suffer from\
    \ these race conditions.\n             Transferor           Transferee       \
    \     Transfer\n                  |                    |                 Target\n\
    \                  |                    |                    |\n         dialog1\
    \  | INVITE/200 OK/ACK  |                    |\n                  |<-------------------|\
    \                    |\n         dialog1  | INVITE (hold)/200 OK/ACK         \
    \       |\n                  |------------------->|                    |\n   \
    \      dialog2  | INVITE                                  |\n                \
    \  |---------------------------------------->|\n         dialog2  | 180 Ringing\
    \                             |\n                  |<----------------------------------------|\n\
    \                  |                                         |\n             \
    \     |  Transferor gives up waiting            |\n                  |       \
    \                                  |\n         dialog2  | CANCEL             \
    \                     |\n                  |---------------------------------------->|\n\
    \         dialog2  | 200 OK                                  |\n             \
    \     |<----------------------------------------|\n         dialog2  | 487 Request\
    \ Terminated                  |\n                  |<----------------------------------------|\n\
    \         dialog2  | ACK                                     |\n             \
    \     |---------------------------------------->|\n         dialog3  | REFER (Target-Dialog:1)\
    \ F3              |\n                  |------------------->|                \
    \    |\n         dialog3  | 202 Accepted       |                    |\n      \
    \            |<-------------------|                    |\n         dialog3  |\
    \ NOTIFY (100 Trying)|                    |\n                  |<-------------------|\
    \                    |\n         dialog3  |            200 OK  |             \
    \       |\n                  |------------------->|                    |\n   \
    \      dialog4  |                INVITE/200 OK/ACK        |\n                \
    \  |                    |------------------->|\n         dialog3  | NOTIFY (200\
    \ OK)    |                    |\n                  |<-------------------|    \
    \                |\n         dialog3  |            200 OK  |                 \
    \   |\n                  |------------------->|                    |\n       \
    \  dialog1  | BYE/200 OK         |                    |\n                  |------------------->|\
    \                    |\n         dialog4  |                    |         BYE/200\
    \ OK |\n                  |                    |<-------------------|\n   Figure\
    \ 12: Semi-Attended Transfer as Blind Transfer Call Flow (Not\n   Recommended)\n\
    \             Transferor           Transferee            Transfer\n          \
    \        |                    |                 Target\n                  |  \
    \                  |                    |\n         dialog1  | INVITE/200 OK/ACK\
    \  |                    |\n                  |<-------------------|          \
    \          |\n         dialog1  | INVITE (hold)/200 OK/ACK                |\n\
    \                  |------------------->|                    |\n         dialog2\
    \  | INVITE                                  |\n                  |---------------------------------------->|\n\
    \         dialog2  | 180 Ringing                             |\n             \
    \     |<----------------------------------------|\n                  |       \
    \                                  |\n                  |Transferor gives up waiting\
    \ but Target answers\n                  |                                    \
    \     |\n         dialog2  | CANCEL                                  |\n     \
    \             |---------------------------------------->|\n         dialog2  |\
    \ 200 OK (CANCEL)                         |\n                  |<----------------------------------------|\n\
    \         dialog2  | 200 OK (INVITE) F1                      |\n             \
    \     |<----------------------------------------|\n         dialog2  | ACK   \
    \                                  |\n                  |---------------------------------------->|\n\
    \         dialog2  | INVITE (hold)/200 OK/ACK                |\n             \
    \     |---------------------------------------->|\n                  |  Tones\
    \ or media played avoid silence F2 |\n                  |========================================>|\n\
    \         dialog1  |REFER (Refer-To:sips:TransferTarget      |\n             \
    \     |                      ?Replaces=dialog2) |\n                  |------------------->|\
    \                    |\n         dialog1  | 202 Accepted       |             \
    \       |\n                  |<-------------------|                    |\n   \
    \      dialog1  | NOTIFY (100 Trying)|                    |\n                \
    \  |<-------------------|                    |\n         dialog1  |          \
    \  200 OK  |                    |\n                  |------------------->|  \
    \                  |\n         dialog3  |         INVITE (Replaces:dialog2)/200\
    \ OK/ACK F3\n                  |                    |------------------->|\n \
    \        dialog2  | BYE/200 OK         |                    |\n              \
    \    |<----------------------------------------|\n         dialog1  | NOTIFY (200\
    \ OK)    |                    |\n                  |<-------------------|    \
    \                |\n         dialog1  |            200 OK  |                 \
    \   |\n                  |------------------->|                    |\n       \
    \  dialog1  | BYE/200 OK         |                    |\n                  |------------------->|\
    \                    |\n         dialog3  |                    |         BYE/200\
    \ OK |\n                  |                    |<-------------------|\n   Figure\
    \ 13: Semi-Attended Transfer as Attended Transfer Call Flow (Not\n   Recommended)\n"
- title: 7.7.  Attended Transfer Fallback to Basic Transfer
  contents:
  - "7.7.  Attended Transfer Fallback to Basic Transfer\n   In this flow, an attempted\
    \ attended transfer fails so the Transferor\n   falls back to basic transfer.\n\
    \   The call flow in Figure 14 shows the use of Require: replaces in the\n   INVITE\
    \ sent by the Transferor to the Transfer Target in which the\n   Transferor's\
    \ intention at the time of sending the INVITE to the\n   Transfer Target was known\
    \ to be to complete an attended transfer.\n   Since the Target does not support\
    \ Replaces, the INVITE is rejected\n   with a 420 Bad Extension response, and\
    \ the Transferor switches from\n   attended transfer to basic transfer immediately.\n\
    \             Transferor           Transferee             Transfer\n         \
    \         |                    |                  Target\n                  |\
    \                    |                    |\n         dialog1  | INVITE/200 OK/ACK\
    \  |                    |\n                  |<-------------------|          \
    \          |\n         dialog1  |   OPTIONS/200 OK   |                    |\n\
    \                  |------------------->|                    |\n         dialog1\
    \  | INVITE (hold)/200 OK/ACK                |\n                  |------------------->|\
    \                    |\n         dialog2  | INVITE (Require:replaces)        \
    \       |\n                  |---------------------------------------->|\n   \
    \      dialog2  |                     420 Bad Extension   |\n                \
    \  |<----------------------------------------|\n         dialog2  |    ACK   \
    \                               |\n                  |---------------------------------------->|\n\
    \         dialog1  | REFER (Refer-To:sips:TransferTarget)    |\n             \
    \     |------------------->|                    |\n         dialog1  |    202\
    \ Accepted    |                    |\n                  |<-------------------|\
    \                    |\n         dialog1  | NOTIFY (100 Trying)|             \
    \       |\n                  |<-------------------|                    |\n   \
    \      dialog1  |            200 OK  |                    |\n                \
    \  |------------------->|                    |\n         dialog3  |          \
    \          |  INVITE/200 OK/ACK |\n                  |                    |------------------->|\n\
    \         dialog1  | NOTIFY (200 OK)    |                    |\n             \
    \     |<-------------------|                    |\n         dialog1  |       \
    \     200 OK  |                    |\n                  |------------------->|\
    \                    |\n         dialog1  | BYE/200 OK         |             \
    \       |\n                  |------------------->|                    |\n   \
    \      dialog3  |                    |         BYE/200 OK |\n                \
    \  |                    |<-------------------|\n   Figure 14: Attended Transfer\
    \ Fallback to Basic Transfer Using\n   Require:replaces\n   Figure 15 shows the\
    \ use of OPTIONS when the Transferee and Transfer\n   Target do not explicitly\
    \ indicate support for the REFER method and\n   Replaces header fields in Allow\
    \ and Supported header fields and the\n   Transferor did not have the intention\
    \ of performing an attended\n   transfer when the INVITE to the Target was sent.\
    \  In dialog1, the\n   Transferor determines, using OPTIONS, that the Transferee\
    \ does\n   support REFER and Replaces.  As a result, the Transferor begins the\n\
    \   attended transfer by placing the Transferee on hold and calling the\n   Transfer\
    \ Target.  Using an OPTIONS in dialog2, the Transferor\n   determines that the\
    \ target does not support either REFER or Replaces,\n   making attended transfer\
    \ impossible.  The Transferor then ends\n   dialog2 by sending a BYE then sends\
    \ a REFER to the Transferee using\n   the AOR URI of the Transfer Target.\n  \
    \           Transferor           Transferee             Transfer\n           \
    \       |                    |                  Target\n                  |  \
    \                  |                    |\n         dialog1  | INVITE/200 OK/ACK\
    \  |                    |\n                  |<-------------------|          \
    \          |\n         dialog1  |   OPTIONS/200 OK   |                    |\n\
    \                  |------------------->|                    |\n         dialog1\
    \  | INVITE (hold)/200 OK/ACK                |\n                  |------------------->|\
    \                    |\n         dialog2  | INVITE/200 OK/ACK  |             \
    \       |\n                  |---------------------------------------->|\n   \
    \      dialog2  | OPTIONS/200 OK     |                    |\n                \
    \  |---------------------------------------->|\n         dialog2  |    BYE/200\
    \ OK      |                    |\n                  |---------------------------------------->|\n\
    \         dialog3  |REFER (Target-Dialog:1,                  |\n             \
    \     |          Refer-To:sips:TransferTarget)  |\n                  |------------------->|\
    \                    |\n         dialog3  |    202 Accepted    |             \
    \       |\n                  |<-------------------|                    |\n   \
    \      dialog3  | NOTIFY (100 Trying)|                    |\n                \
    \  |<-------------------|                    |\n         dialog3  |          \
    \  200 OK  |                    |\n                  |------------------->|  \
    \                  |\n         dialog4  |                    |  INVITE/200 OK/ACK\
    \ |\n                  |                    |------------------->|\n         dialog3\
    \  | NOTIFY (200 OK)    |                    |\n                  |<-------------------|\
    \                    |\n         dialog3  |            200 OK  |             \
    \       |\n                  |------------------->|                    |\n   \
    \      dialog1  | BYE/200 OK         |                    |\n                \
    \  |------------------->|                    |\n         dialog4  |          \
    \          |         BYE/200 OK |\n                  |                    |<-------------------|\n\
    \   Figure 15: Attended Transfer Fallback to Basic Transfer\n"
- title: 8.  Transfer with Referred-By
  contents:
  - "8.  Transfer with Referred-By\n   In the previous examples, the Transfer Target\
    \ does not have\n   definitive information about what party initiated the transfer,\
    \ or,\n   in some cases, even that transfer is taking place.  The Referred-By\n\
    \   mechanism [RFC3892] provides a way for the Transferor to provide the\n   Transferee\
    \ with a way to let the Transfer Target know what party\n   initiated the transfer.\n\
    \   The simplest and least secure approach just involves the inclusion of\n  \
    \ the Referred-By header field in the REFER, which is then copied into\n   the\
    \ triggered INVITE.  However, a more secure mechanism involving the\n   Referred-By\
    \ security token, which is generated and signed by the\n   Transferor and passed\
    \ in a message body to the Transferee then to the\n   Transfer Target.\n   The\
    \ call flow in Figure 16 shows the Referred-By header field and\n   body in the\
    \ REFER F5 and triggered INVITE F6.  Note that the Secure/\n   Multipurpose Internet\
    \ Mail Extensions (S/MIME) signature is not shown\n   in the example below.  The\
    \ conventions used in the SIP Torture Test\n   Messages [RFC4475] document are\
    \ reused, specifically the <hex> and\n   <allOneLine> tags.\n             Transferor\
    \           Transferee             Transfer\n                  |             \
    \       |                  Target\n                  |                    |  \
    \                  |\n         dialog1  | INVITE/200 OK/ACK F1 F2            \
    \     |\n                  |<-------------------|                    |\n     \
    \    dialog1  | INVITE (hold)/200 OK/ACK                |\n                  |------------------->|\
    \                    |\n         dialog2  | INVITE/200 OK/ACK F3 F4          \
    \       |\n                  |---------------------------------------->|\n   \
    \      dialog2  | INVITE (hold)/200 OK/ACK                |\n                \
    \  |---------------------------------------->|\n         dialog3  | REFER (Target-Dialog:1,\
    \ Referred-By:Transferor,\n                  |  Refer-To:sips:TransferTarget?Replaces=2)\
    \ F5\n                  |------------------->|                    |\n        \
    \ dialog3  | 202 Accepted       |                    |\n                  |<-------------------|\
    \                    |\n         dialog3  | NOTIFY (100 Trying)|             \
    \       |\n                  |<-------------------|                    |\n   \
    \      dialog3  |            200 OK  |                    |\n                \
    \  |------------------->|                    |\n         dialog4  |        INVITE\
    \ (Replaces:dialog2,        |\n                  |         Referred-By:Transferor\
    \ )/200 OK/ACK F6\n                  |                    |------------------->|\n\
    \         dialog2  | BYE/200 OK         |                    |\n             \
    \     |<----------------------------------------|\n         dialog3  | NOTIFY\
    \ (200 OK)    |                    |\n                  |<-------------------|\
    \                    |\n         dialog3  |            200 OK  |             \
    \       |\n                  |------------------->|                    |\n   \
    \      dialog1  | BYE/200 OK         |                    |\n                \
    \  |------------------->|                    |\n         dialog4  |          \
    \          |         BYE/200 OK |\n                  |                    |<-------------------|\n\
    \   Figure 16: Attended Transfer Call Flow with Referred-By\n   F5 REFER Transferor\
    \ -> Transferee\n   REFER sips:3ld812adkjw@biloxi.example.com;gr=3413kj2ha SIP/2.0\n\
    \   Via: SIP/2.0/TLS pc33.atlanta.example.com;branch=z9hG4bK392039842\n   Max-Forwards:\
    \ 70\n   To: <sips:3ld812adkjw@biloxi.example.com;gr=3413kj2ha>\n   From: <sips:transferor@atlanta.example.com>;tag=1928301774\n\
    \   Call-ID: a84b4c76e66710\n   CSeq: 314160 REFER\n   <allOneLine>\n   Refer-To:\
    \ <sips:482n4z24kdg@chicago.example.com;gr=8594958\n   ?Replaces=090459243588173445%3Bto-tag%3D9m2n3wq%3Bfrom-tag\n\
    \   %3D763231&Require=replaces>\n   </allOneLine>\n   Supported: gruu, replaces,\
    \ tdialog\n   Require: tdialog\n   Referred-By: <sips:transferor@atlanta.example.com>\n\
    \    ;cid=\"20398823.2UWQFN309shb3@atlanta.example.com\"\n   Target-Dialog: 592435881734450904;local-tag=9m2n3wq;remote-tag=763231\n\
    \   Contact: <sips:4889445d8kjtk3@atlanta.example.com;gr=723jd2d>\n   Content-Type:\
    \ multipart/mixed; boundary=unique-boundary-1\n   Content-Length: ...\n   --unique-boundary-1\n\
    \   Content-ID: <20398823.2UWQFN309shb3@atlanta.example.com>\n   Content-Length:\
    \ 2961\n   Content-Type: multipart/signed;\n                protocol=\"application/pkcs-7-signature\"\
    ;\n                micalg=sha1;\n                boundary=\"----590F24D439B31E08745DEF0CD9397189\"\
    \n   ------590F24D439B31E08745DEF0CD9397189\n   Content-Type: message/sipfrag\n\
    \   Date: Thu, 18 Sep 2003 13:07:43 GMT\n   <allOneLine>\n   Refer-To: <sips:482n4z24kdg@chicago.example.com;gr=8594958\n\
    \   ?Replaces=090459243588173445%3B\n   to-tag%3D9m2n3wq%3Bfrom-tag%3D763231&Require=replaces>\n\
    \   </allOneLine>\n   Referred-By: <sips:transferor@atlanta.example.com>\n   \
    \ ;cid=\"20398823.2UWQFN309shb3@atlanta.example.com\"\n   ------590F24D439B31E08745DEF0CD9397189\n\
    \   Content-Type: application/pkcs-7-signature; name=\"smime.p7s\"\n   Content-Transfer-Encoding:\
    \ binary\n   Content-Disposition: attachment; filename=\"smime.p7s\"\n   <hex>3082088806092A86\n\
    \   4886F70D010702A082087930820875020101310B300906052B0E03021A050030\n   . . .\
    \ (Signature not shown)\n   8E63D306487A740A197A3970594CF47DD385643B1DC49FF767A3D2B428388966\n\
    \   79089AAD95767F</hex>\n   ------590F24D439B31E08745DEF0CD9397189--\n   --unique_boundary-1\n\
    \   F6 INVITE Transferee -> Transfer Target\n   INVITE sips:482n4z24kdg@chicago.example.com;gr=8594958\
    \ SIP/2.0\n   Via: SIP/2.0/TLS referee.example;branch=z9hG4bKffe209934aac\n  \
    \ To: <sips:482n4z24kdg@chicago.example.com;gr=8594958>\n   From: <sips:transferee@biloxi.example.com>;tag=2909034023\n\
    \   Call-ID: fe9023940-a3465@referee.example\n   CSeq: 889823409 INVITE\n   Max-Forwards:\
    \ 70\n   Contact: <sips:3ld812adkjw@biloxi.example.com;gr=3413kj2ha>\n   Referred-By:\
    \ <sips:transferor@atlanta.example.com>\n      ;cid=\"20398823.2UWQFN309shb3@atlanta.example.com\"\
    \n   Replaces:090459243588173445;to-tag=9m2n3wq;from-\n    tag=76323\n   Require:\
    \ replaces\n   Supported: gruu, replaces, tdialog\n   Content-Type: multipart/mixed;\
    \ boundary=my-boundary-9\n   Content-Length: ...\n   --my-boundary-9\n   Content-Type:\
    \ application/sdp\n   Content-Length: 156\n   v=0\n   o=referee 2890844526 2890844526\
    \ IN IP4 referee.example\n   s=Session SDP\n   c=IN IP4 referee.example\n   t=0\
    \ 0\n   m=audio 49172 RTP/AVP 0\n   a=rtpmap:0 PCMU/8000\n   --my-boundary-9\n\
    \   Content-Length: 2961\n   Content-Type: multipart/signed;\n               \
    \ protocol=\"application/pkcs-7-signature\";\n                micalg=sha1;\n \
    \               boundary=\"----590F24D439B31E08745DEF0CD9397189\"\n   ------590F24D439B31E08745DEF0CD9397189\n\
    \   Content-Type: message/sipfrag\n   Date: Thu, 18 Sep 2003 13:07:43 GMT\n  \
    \ <allOneLine>\n   Refer-To: <sips:transfertarget@chicago.example.com;\n   Replaces=090459243588173445%3B\n\
    \   to-tag%3D9m2n3wq%3Bfrom-tag%3D763231&Require=replaces>\n   </allOneLine>\n\
    \   Referred-By: <sips:transferor@atlanta.example.com>\n    ;cid=\"20398823.2UWQFN309shb3@atlanta.example.com\"\
    \n   ------590F24D439B31E08745DEF0CD9397189\n   Content-Type: application/pkcs-7-signature;\
    \ name=\"smime.p7s\"\n   Content-Transfer-Encoding: binary\n   Content-Disposition:\
    \ attachment; filename=\"smime.p7s\"\n   <hex>3082088806092A86\n   4886F70D010702A082087930820875020101310B300906052B0E03021A050030\n\
    \   . . .  (Signature not shown)\n   8E63D306487A740A197A3970594CF47DD385643B1DC49FF767A3D2B428388966\n\
    \   79089AAD95767F</hex>\n   ------590F24D439B31E08745DEF0CD9397189--\n   --my-boundary-9--\n"
- title: 9.  Transfer as an Ad Hoc Conference
  contents:
  - "9.  Transfer as an Ad Hoc Conference\n   In this flow, shown in Figure 17, Bob\
    \ does an attended transfer of\n   Alice to Carol.  In order to keep both Alice\
    \ and Carol fully informed\n   of the nature and state of the transfer operation,\
    \ Bob acts as a\n   focus [RFC4579] and hosts an ad hoc conference involving Alice,\
    \ Bob,\n   and Carol.  Alice and Carol subscribe to the conference package\n \
    \  [RFC4575] of Bob's focus, which allows them to know the exact status\n   of\
    \ the operation.  After the transfer operation is complete, Bob\n   deletes the\
    \ conference.\n   This call flow meets requirement 6 of Section 4.  NOTIFY messages\n\
    \   related to the refer package are indicated as NOTIFY (refer), while\n   NOTIFYs\
    \ related to the Conference Info package are indicated as\n   NOTIFY (Conf-Info).\n\
    \   Note that any type of semi-attended transfer in which media mixing or\n  \
    \ relaying could be implemented using this model.  In addition to\n   simply mixing,\
    \ the focus could introduce additional media signals\n   such as simulated ring\
    \ tone or on hold announcements to improve the\n   user experience.\n   Alice\
    \                  Bob                 Carol\n      |                    |   \
    \                 |\n      | INVITE             |                    |\n     \
    \ |------------------->|                    |\n      |   180 Ringing      |  \
    \                  |\n      |<-------------------|                    |\n    \
    \  |     200 OK         |                    |\n      |<-------------------| \
    \                   |\n      |        ACK         |                    |\n   \
    \   |------------------->|                    |\n      |        RTP         |\
    \                    |\n      |<==================>|                    |\n  \
    \    |                    |                    |\n   Bob places Alice on hold\
    \ and begins acting like a focus\n      |                    |               \
    \     |\n      | INVITE (hold) Contact:Conf-ID;isfocus   |\n      |<-------------------|\
    \                    |\n      |    200 OK          |                    |\n  \
    \    |------------------->|                    |\n      |        ACK         |\
    \                    |\n      |<-------------------|                    |\n  \
    \    |                    |                    |\n      | Alice subscribes to\
    \ the conference package\n      |                    |                    |\n\
    \      | SUBSCRIBE sip:Conf-ID                   |\n      |------------------->|\
    \                    |\n      |     200 OK         |                    |\n  \
    \    |<-------------------|                    |\n      | NOTIFY (Conf-Info) |\
    \                    |\n      |<-------------------|                    |\n  \
    \    |     200 OK         |                    |\n      |------------------->|\
    \                    |\n      |                    |                    |\n  \
    \    |       Bob begins consultation operation |\n      |                    |\
    \                    |\n      |INVITE Require:replaces Contact:Conf-ID;isfocus\n\
    \      |                    |------------------->|\n      |                  \
    \  |   180 Ringing      |\n      |                    |<-------------------|\n\
    \      |                    |     200 OK         |\n      |                  \
    \  |<-------------------|\n      |                    |       ACK          |\n\
    \      |                    |------------------->|\n      |                  \
    \  |        RTP         |\n      |                    |<==================>|\n\
    \      |                    |                    |\n      |Carol subscribes to\
    \ the conference package\n      |                - learns Bob is on hold  |\n\
    \      |                    |                    |\n      |                  \
    \  |SUBSCRIBE sip:Conf-ID\n      |                    |<-------------------|\n\
    \      |                    |      200 OK        |\n      |                  \
    \  |------------------->|\n      |                    | NOTIFY (Conf-Info) |\n\
    \      |                    |------------------->|\n      |                  \
    \  |      200 OK        |\n      |                    |<-------------------|\n\
    \      |                    |                    |\n      | Alice learns that\
    \ Bob is talking to Carol\n      |                    |                    |\n\
    \      | NOTIFY (Conf-Info) |                    |\n      |<-------------------|\
    \                    |\n      |     200 OK         |                    |\n  \
    \    |------------------->|                    |\n      |                    |\
    \  INVITE (hold)     |\n      |                    |------------------->|\n  \
    \    |                    |      200 OK        |\n      |                    |<-------------------|\n\
    \      |                    |      ACK           |\n      |                  \
    \  |------------------->|\n      |                    |                    |\n\
    \      | Alice learns that Carol is now on hold  |\n      |                  \
    \  |                    |\n      | NOTIFY (Conf-Info) |                    |\n\
    \      |<-------------------|                    |\n      |     200 OK       \
    \  |                    |\n      |------------------->|                    |\n\
    \      |                    |                    |\n      |           Bob begins\
    \ transfer operation |\n      |                    |                    |\n  \
    \    |     REFER Refer-To: Carol               |\n      |<-------------------|\
    \                    |\n      |     202 Accepted   |                    |\n  \
    \    |------------------->|                    |\n      | NOTIFY (Refer)     |\
    \                    |\n      |------------------->|                    |\n  \
    \    |     200 OK         |                    |\n      |<-------------------|\
    \                    |\n      |  INVITE Replaces:B-C Contact:Alice      |\n  \
    \    |---------------------------------------->|\n      |                 200\
    \ OK                  |\n      |<----------------------------------------|\n \
    \     |                   ACK                   |\n      |---------------------------------------->|\n\
    \      |                    RTP                  |\n      |<=======================================>|\n\
    \      |                    |       BYE          |\n      |                  \
    \  |<-------------------|\n      |                    |      200 OK        |\n\
    \      |                    |------------------->|\n      | NOTIFY (Refer)   \
    \  |                    |\n      |------------------->|                    |\n\
    \      |     200 OK         |                    |\n      |<-------------------|\
    \                    |\n      |                    |                    |\n  \
    \    | Bob terminates the ad-hoc conference    |\n      |                    |\
    \                    |\n      |       BYE          |                    |\n  \
    \    |<-------------------|                    |\n      |     200 OK         |\
    \                    |\n      |------------------->|                    |\n  \
    \    |                    | NOTIFY (Conf-Info) |\n      |                    |------------------->|\n\
    \      |                    |      200 OK        |\n      |                  \
    \  |<-------------------|\n      | NOTIFY (Conf-Info) |                    |\n\
    \      |<-------------------|                    |\n      |     200 OK       \
    \  |                    |\n      |------------------->|                    |\n\
    \   Figure 17: Attended Transfer as an Ad Hoc Conference\n"
- title: 10.  Transfer with Multiple Parties
  contents:
  - "10.  Transfer with Multiple Parties\n   In this example, shown in Figure 18,\
    \ the Originator places a call to\n   the Facilitator who reaches the Recipient\
    \ through the Screener.  The\n   Recipient's contact information is exposed to\
    \ the Facilitator and the\n   Originator.  This example is provided for clarification\
    \ of the\n   semantics of the REFER method only, and it should not be used as\
    \ the\n   design of an implementation.\n       Originator   Facilitator   Screener\
    \   Recipient\n      |            |            |          |\n   1  |INVITE/200\
    \ OK/ACK        |          |\"Get Fred for me!\"\n      |----------->|       \
    \     |          |     \"Right away!\"\n   2  |INVITE (hold)/200 OK/ACK |    \
    \      |\n      |<-----------|            |          |\n   2  |            |INVITE/200\
    \ OK/ACK      |\"I have a call\n      |            |----------->|          |from\
    \ Mary for Fred\"\n   2  |            |INVITE (hold)/200 OK/ACK   \"Hold please\"\
    \n      |            |<-----------|          |\n   3  |            |         \
    \   |INVITE/200 OK/ACK\n      |            |            |--------->|\"You have\
    \ a call\n      |            |            |          |from Mary\"\n      |   \
    \         |            |          |  \"Put her through\"\n   3  |            |\
    \            |INVITE (hold)/200 OK/ACK\n      |            |            |--------->|\n\
    \   4  |            |REFER       |          |\n      |            |<-----------|\
    \          |\n   4  |            |202 Accepted|          |\n      |          \
    \  |----------->|          |\n   4  |            |NOTIFY (100 Trying)    |\n \
    \     |            |----------->|          |\n   4  |            |200 OK     \
    \ |          |\n      |            |<-----------|          |\n   5  |        \
    \    |INVITE/200 OK/ACK      |\n      |            |---------------------->|\"\
    This is Fred\"\n   4  |            |NOTIFY (200 OK)        |  \"Please hold for\n\
    \      |            |----------->|          |              Mary\"\n   4  |   \
    \         |200 OK      |          |\n      |            |<-----------|       \
    \   |\n   2  |            |BYE/200 OK  |          |\n      |            |<-----------|\
    \          |\n   3  |            |            |BYE/200 OK|\n      |          \
    \  |            |--------->|\n   5  |            |INVITE (hold)/200 OK/ACK\n \
    \     |            |---------------------->|\n   6  |REFER       |           \
    \ |          |\n      |<-----------|            |          |\n   6  |202 Accepted|\
    \            |          |\n      |----------->|            |          |\n   6\
    \  |NOTIFY (100 Trying)      |          |\n      |----------->|            | \
    \         |\n   6  |200 OK      |            |          |\n      |<-----------|\
    \            |          |\n   7  |INVITE/200 OK/ACK        |          |\n    \
    \  |----------------------------------->| \"Hey Fred\"\n   6  |NOTIFY (200 OK)\
    \          |          |    \"Hello Mary\"\n      |----------->|            | \
    \         |\n   6  |200 OK      |            |          |\n      |<-----------|\
    \            |          |\n   1  |BYE/200 OK  |            |          |\n    \
    \  |<-----------|            |          |\n   5  |            |BYE/200 OK  | \
    \         |\n      |            |---------------------->|\n   7  |BYE/200 OK \
    \ |            |          |\n      |<-----------------------------------| \"See\
    \ you later\"\n   Figure 18: Transfer with Multiple Parties Example\n"
- title: 11.  Gateway Transfer Issues
  contents:
  - "11.  Gateway Transfer Issues\n   A gateway in SIP acts as a User Agent.  As a\
    \ result, the entire\n   preceding discussion and call flows apply equally well\
    \ to gateways as\n   native SIP endpoints.  However, there are some gateway-specific\n\
    \   issues that are documented in this section.  While this discussion\n   focuses\
    \ on the common cases involving Public Switched Telephone\n   Network (PSTN) gateways,\
    \ similar situations exist for other gateways,\n   such as H.323/SIP gateways.\n"
- title: 11.1.  Coerce Gateway Hairpins to the Same Gateway
  contents:
  - "11.1.  Coerce Gateway Hairpins to the Same Gateway\n   To illustrate how a hairpin\
    \ situation can occur in transfer, consider\n   this example.  The original call\
    \ dialog is setup with the Transferee\n   residing on the PSTN side of a SIP gateway.\
    \  The Transferor is a SIP\n   phone purely in the IP space.  The Transfer Target\
    \ is on the PSTN\n   side of a SIP gateway as well.  After completing the transfer,\n\
    \   (regardless of consultative or blind) the Transferee is in a call\n   with\
    \ the Transfer Target (both on the PSTN side of a gateway).  It is\n   often desirable\
    \ to remove the gateway(s) out of the loop.  This is\n   likely to only be possible\
    \ if both legs of the target call are on the\n   same gateway.  With both legs\
    \ on the same gateway, it may be able to\n   invoke the analogous transfer on\
    \ the PSTN side.  Then the target call\n   would not involve the gateway.\n  \
    \ So the problem is how to give the proxy enough information so that it\n   knows\
    \ to route the call to the same gateway.  With a simple single\n   call that hairpins,\
    \ the incoming and outgoing leg have the same\n   dialog.  The proxy should have\
    \ enough information to optimize the\n   routing.\n   In the consultative transfer\
    \ scenario, it is desirable to coerce the\n   consultative INVITE out the same\
    \ gateway as the original call to be\n   transferred.  However, there is no way\
    \ to relate the consultation\n   with the original call.  In the consultative\
    \ case, the target call\n   INVITE includes the Replaces header, which contains\
    \ dialog\n   information that can be used to relate it to the consultation.\n\
    \   However, there is no information that relates the target call to the\n   original.\n\
    \   In the blind transfer scenario, it is desirable to coerce the target\n   call\
    \ onto the same gateway as the original call.  However, the same\n   problem exists\
    \ in that the target-dialog cannot be related to the\n   original dialog.\n  \
    \ In either transfer scenario, it may be desirable to push the transfer\n   operation\
    \ onto the non-SIP side of the gateway.  Presumably, this is\n   not possible\
    \ unless all of the legs go out the same gateway.  If the\n   gateway supports\
    \ more than one trunk group, it might also be\n   necessary to get all of the\
    \ legs on the same trunk group in order to\n   perform the transfer on the non-SIP\
    \ side of the gateway.\n   Solutions to these gateway specific issues may involve\
    \ new extensions\n   to SIP in the future.\n"
- title: 11.2.  Consultative Turned Blind Gateway Glare
  contents:
  - "11.2.  Consultative Turned Blind Gateway Glare\n   In the consultative transfer\
    \ case turned blind, there is a glare-like\n   problem.  The Transferor initiates\
    \ the consultation INVITE, the\n   Transferor gets impatient and hangs up, transitioning\
    \ this to a blind\n   transfer.  The Transfer Target on the gateway (connected\
    \ through a\n   PSTN switch to a single line or dumb analog phone) rings.  The\
    \ user\n   answers the phone just after the CANCEL is received by the Transfer\n\
    \   Target.  The REFER and INVITE for the target call are sent.  The\n   Transferee\
    \ attempts to set up the call on the PSTN side, but gets\n   either a busy response\
    \ or lands in the users voicemail as the user\n   has the handset in hand and\
    \ off hook.\n   This is another example of a race condition that this call flow\
    \ can\n   cause.  The recommended behavior is to use the approach described in\n\
    \   Section 7.6.\n"
- title: 12.  Security Considerations
  contents:
  - "12.  Security Considerations\n   The call transfer flows shown in this document\
    \ are implemented using\n   the REFER and Replaces call control primitives in\
    \ SIP.  As such, the\n   security considerations detailed in the REFER [RFC3515]\
    \ and Replaces\n   [RFC3891] documents MUST be followed, which are briefly summarized\
    \ in\n   the following paragraphs.  This document addresses the issue of\n   protecting\
    \ the Address of Record URI of a Transfer Target in Sections\n   7.1 and 7.2.\n\
    \   Any REFER request MUST be appropriately authenticated and authorized\n   using\
    \ standard SIP mechanisms or else calls may be hijacked.  A User\n   Agent may\
    \ use local policy or human intervention in deciding whether\n   or not to accept\
    \ a REFER.  In generating NOTIFY responses based on\n   the outcome of the triggered\
    \ request, care should be taken in\n   constructing the message/sipfrag body to\
    \ ensure that no private\n   information is leaked.\n   An INVITE containing a\
    \ Replaces header field SHOULD only be accepted\n   if it has been properly authenticated\
    \ and authorized using standard\n   SIP mechanisms, and the requestor is authorized\
    \ to perform dialog\n   replacement.  Special care is needed if the replaced dialog\
    \ utilizes\n   additional media streams compared to the original dialog.  In this\n\
    \   case, the user MUST authorize the addition of new media streams in a\n   dialog\
    \ replacement.  For example, the same mechanism used to\n   authorize the addition\
    \ of a media stream in a re-INVITE could be\n   used.\n"
- title: 13.  Acknowledgments
  contents:
  - "13.  Acknowledgments\n   This document is a collaborative product of the SIP\
    \ working group.\n   Thanks to Rohan Mahy for his input on the use of Replaces\
    \ in\n   transfer.\n"
- title: 14.  References
  contents:
  - '14.  References

    '
- title: 14.1.  Normative References
  contents:
  - "14.1.  Normative References\n   [RFC2119]    Bradner, S., \"Key words for use\
    \ in RFCs to Indicate\n                Requirement Levels\", BCP 14, RFC 2119,\
    \ March 1997.\n   [RFC3261]    Rosenberg, J., Schulzrinne, H., Camarillo, G.,\
    \ Johnston,\n                A., Peterson, J., Sparks, R., Handley, M., and E.\n\
    \                Schooler, \"SIP: Session Initiation Protocol\", RFC 3261,\n \
    \               June 2002.\n   [RFC3515]    Sparks, R., \"The Session Initiation\
    \ Protocol (SIP) Refer\n                Method\", RFC 3515, April 2003.\n   [RFC3891]\
    \    Mahy, R., Biggs, B., and R. Dean, \"The Session\n                Initiation\
    \ Protocol (SIP) \"Replaces\" Header\", RFC 3891,\n                September 2004.\n\
    \   [RFC3892]    Sparks, R., \"The Session Initiation Protocol (SIP)\n       \
    \         Referred-By Mechanism\", RFC 3892, September 2004.\n   [RFC4538]   \
    \ Rosenberg, J., \"Request Authorization through Dialog\n                Identification\
    \ in the Session Initiation Protocol\n                (SIP)\", RFC 4538, June\
    \ 2006.\n"
- title: 14.2.  Informative References
  contents:
  - "14.2.  Informative References\n   [CC-FRMWRK]  Mahy, R., Sparks, R., Rosenberg,\
    \ J., Petrie, D., and A.\n                Johnston, \"A Call Control and Multi-party\
    \ usage\n                framework for the Session Initiation Protocol (SIP)\"\
    ,\n                Work in Progress, March 2009.\n   [RFC4353]    Rosenberg, J.,\
    \ \"A Framework for Conferencing with the\n                Session Initiation\
    \ Protocol (SIP)\", RFC 4353,\n                February 2006.\n   [RFC4475]  \
    \  Sparks, R., Hawrylyshen, A., Johnston, A., Rosenberg,\n                J.,\
    \ and H. Schulzrinne, \"Session Initiation Protocol\n                (SIP) Torture\
    \ Test Messages\", RFC 4475, May 2006.\n   [RFC4575]    Rosenberg, J., Schulzrinne,\
    \ H., and O. Levin, \"A Session\n                Initiation Protocol (SIP) Event\
    \ Package for Conference\n                State\", RFC 4575, August 2006.\n  \
    \ [RFC4579]    Johnston, A. and O. Levin, \"Session Initiation Protocol\n    \
    \            (SIP) Call Control - Conferencing for User Agents\",\n          \
    \      BCP 119, RFC 4579, August 2006.\n   [RFC5057]    Sparks, R., \"Multiple\
    \ Dialog Usages in the Session\n                Initiation Protocol\", RFC 5057,\
    \ November 2007.\n   [SIP-GRUU]   Rosenberg, J., \"Obtaining and Using Globally\
    \ Routable\n                User Agent (UA) URIs (GRUU) in the Session Initiation\n\
    \                Protocol (SIP)\", Work in Progress, October 2007.\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Robert Sparks\n   Tekelec\n   17210 Campbell Road\n  \
    \ Suite 250\n   Dallas, Texas  75252\n   USA\n   EMail: RjS@nostrum.com\n   Alan\
    \ Johnston (editor)\n   Avaya\n   St. Louis, MO\n   EMail: alan@sipstation.com\n\
    \   Daniel Petrie\n   SIPez LLC\n   Arlington, MA  02476\n   US\n   Phone: +1\
    \ 617 273 4000\n   EMail: dan.ietf@SIPez.com\n   URI:   http://www.SIPez.com/\n"
