- title: __initial_text__
  contents:
  - '         Usage and Applicability of BGP MPLS-Based Ethernet VPN

    '
- title: Abstract
  contents:
  - "Abstract\n   This document discusses the usage and applicability of BGP MPLS-based\n\
    \   Ethernet VPN (EVPN) in a simple and fairly common deployment\n   scenario.\
    \  The different EVPN procedures are explained in the example\n   scenario along\
    \ with the benefits and trade-offs of each option.  This\n   document is intended\
    \ to provide a simplified guide for the deployment\n   of EVPN networks.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This document is not an Internet Standards Track specification;\
    \ it is\n   published for informational purposes.\n   This document is a product\
    \ of the Internet Engineering Task Force\n   (IETF).  It represents the consensus\
    \ of the IETF community.  It has\n   received public review and has been approved\
    \ for publication by the\n   Internet Engineering Steering Group (IESG).  Not\
    \ all documents\n   approved by the IESG are candidates for any level of Internet\n\
    \   Standard; see Section 2 of RFC 7841.\n   Information about the current status\
    \ of this document, any errata,\n   and how to provide feedback on it may be obtained\
    \ at\n   https://www.rfc-editor.org/info/rfc8388.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2018 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (https://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.  Code Components\
    \ extracted from this document must\n   include Simplified BSD License text as\
    \ described in Section 4.e of\n   the Trust Legal Provisions and are provided\
    \ without warranty as\n   described in the Simplified BSD License.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1.  Introduction  . . . . . . . . . . . . . . . . . . .\
    \ . . . . .   3\n   2.  Terminology . . . . . . . . . . . . . . . . . . . . .\
    \ . . . .   4\n   3.  Use Case Scenario Description and Requirements  . . . .\
    \ . . .   5\n     3.1.  Service Requirements  . . . . . . . . . . . . . . . .\
    \ . .   5\n     3.2.  Why EVPN Is Chosen to Address This Use Case . . . . . .\
    \ .   7\n   4.  Provisioning Model  . . . . . . . . . . . . . . . . . . . . .\
    \   7\n     4.1.  Common Provisioning Tasks . . . . . . . . . . . . . . . .  \
    \ 8\n       4.1.1.  Non-Service-Specific Parameters . . . . . . . . . . .   8\n\
    \       4.1.2.  Service-Specific Parameters . . . . . . . . . . . . .   9\n  \
    \   4.2.  Service-Interface-Dependent Provisioning Tasks  . . . . .   9\n    \
    \   4.2.1.  VLAN-Based Service Interface EVI  . . . . . . . . . .  10\n      \
    \ 4.2.2.  VLAN Bundle Service Interface EVI . . . . . . . . . .  10\n       4.2.3.\
    \  VLAN-Aware Bundling Service Interface EVI . . . . . .  10\n   5.  BGP EVPN\
    \ NLRI Usage . . . . . . . . . . . . . . . . . . . . .  11\n   6.  MAC-Based Forwarding\
    \ Model Use Case . . . . . . . . . . . . .  11\n     6.1.  EVPN Network Startup\
    \ Procedures . . . . . . . . . . . . .  12\n     6.2.  VLAN-Based Service Procedures\
    \ . . . . . . . . . . . . . .  12\n       6.2.1.  Service Startup Procedures \
    \ . . . . . . . . . . . . .  13\n       6.2.2.  Packet Walk-Through . . . . .\
    \ . . . . . . . . . . . .  13\n     6.3.  VLAN Bundle Service Procedures  . .\
    \ . . . . . . . . . . .  17\n       6.3.1.  Service Startup Procedures  . . .\
    \ . . . . . . . . . .  17\n       6.3.2.  Packet Walk-Through . . . . . . . .\
    \ . . . . . . . . .  18\n     6.4.  VLAN-Aware Bundling Service Procedures  .\
    \ . . . . . . . .  18\n       6.4.1.  Service Startup Procedures  . . . . . .\
    \ . . . . . . .  18\n       6.4.2.  Packet Walk-Through . . . . . . . . . . .\
    \ . . . . . .  19\n   7.  MPLS-Based Forwarding Model Use Case  . . . . . . .\
    \ . . . . .  20\n     7.1.  Impact of MPLS-Based Forwarding on the EVPN Network\n\
    \           Startup . . . . . . . . . . . . . . . . . . . . . . . . .  21\n  \
    \   7.2.  Impact of MPLS-Based Forwarding on the VLAN-Based Service\n        \
    \   Procedures  . . . . . . . . . . . . . . . . . . . . . . .  21\n     7.3. \
    \ Impact of MPLS-Based Forwarding on the VLAN Bundle\n           Service Procedures\
    \  . . . . . . . . . . . . . . . . . . .  22\n     7.4.  Impact of MPLS-Based\
    \ Forwarding on the VLAN-Aware Service\n           Procedures  . . . . . . . .\
    \ . . . . . . . . . . . . . . .  22\n   8.  Comparison between MAC-Based and MPLS-Based\
    \ Egress Forwarding\n       Models  . . . . . . . . . . . . . . . . . . . . .\
    \ . . . . . .  23\n   9.  Traffic Flow Optimization . . . . . . . . . . . . .\
    \ . . . . .  24\n     9.1.  Control-Plane Procedures  . . . . . . . . . . . .\
    \ . . . .  24\n       9.1.1.  MAC Learning Options  . . . . . . . . . . . . .\
    \ . . .  24\n       9.1.2.  Proxy ARP/ND  . . . . . . . . . . . . . . . . . .\
    \ . .  25\n       9.1.3.  Unknown Unicast Flooding Suppression  . . . . . . .\
    \ .  25\n       9.1.4.  Optimization of Inter-Subnet Forwarding . . . . . . .\
    \  26\n     9.2.  Packet Walk-Through Examples  . . . . . . . . . . . . . .  27\n\
    \       9.2.1.  Proxy ARP Example for CE2-to-CE3 Traffic  . . . . . .  27\n  \
    \     9.2.2.  Flood Suppression Example for CE1-to-CE3 Traffic  . .  27\n    \
    \   9.2.3.  Optimization of Inter-subnet Forwarding Example for\n            \
    \   CE3-to-CE2 Traffic  . . . . . . . . . . . . . . . . .  28\n   10. Security\
    \ Considerations . . . . . . . . . . . . . . . . . . .  29\n   11. IANA Considerations\
    \ . . . . . . . . . . . . . . . . . . . . .  30\n   12. References  . . . . .\
    \ . . . . . . . . . . . . . . . . . . . .  30\n     12.1.  Normative References\
    \ . . . . . . . . . . . . . . . . . .  30\n     12.2.  Informative References\
    \ . . . . . . . . . . . . . . . . .  30\n   Acknowledgments . . . . . . . . .\
    \ . . . . . . . . . . . . . . . .  30\n   Contributors  . . . . . . . . . . .\
    \ . . . . . . . . . . . . . . .  31\n   Authors' Addresses  . . . . . . . . .\
    \ . . . . . . . . . . . . . .  31\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   This document complements [RFC7432] by discussing the applicability\n\
    \   of the technology in a simple and fairly common deployment scenario,\n   which\
    \ is described in Section 3.\n   After describing the topology and requirements\
    \ of the use case\n   scenario, Section 4 will describe the provisioning model.\n\
    \   Once the provisioning model is analyzed, Sections 5, 6, and 7 will\n   describe\
    \ the control-plane and data-plane procedures in the example\n   scenario for\
    \ the two potential disposition/forwarding models: MAC-\n   based and MPLS-based\
    \ models.  While both models can interoperate in\n   the same network, each one\
    \ has different trade-offs that are analyzed\n   in Section 8.\n   Finally, EVPN\
    \ provides some potential traffic flow optimization tools\n   that are also described\
    \ in Section 9 in the context of the example\n   scenario.\n"
- title: 2.  Terminology
  contents:
  - "2.  Terminology\n   The following terminology is used:\n   VID:  VLAN Identifier\n\
    \   CE:   Customer Edge (device)\n   EVI:  EVPN Instance\n   MAC-VRF:  A Virtual\
    \ Routing and Forwarding (VRF) table for Media\n         Access Control (MAC)\
    \ addresses on a Provider Edge (PE) router.\n   ES:   An Ethernet Segment is a\
    \ set of links through which a CE is\n         connected to one or more PEs. \
    \ Each ES is identified by an\n         Ethernet Segment Identifier (ESI) in the\
    \ control plane.\n   CE-VIDs:  The VLAN Identifier tags being used at CE1, CE2,\
    \ and CE3 to\n         tag customer traffic sent to the service provider EVPN\
    \ network.\n   CE1-MAC, CE2-MAC, and CE3-MAC:  The source MAC addresses \"behind\"\
    \n         each CE, respectively.  These MAC addresses can belong to the\n   \
    \      CEs themselves or to devices connected to the CEs.\n   CE1-IP, CE2-IP,\
    \ and CE3-IP:  The IP addresses associated with the\n         above MAC addresses\n\
    \   LACP: Link Aggregation Control Protocol\n   RD:   Route Distinguisher\n  \
    \ RT:   Route Target\n   PE:   Provider Edge (router)\n   AS:   Autonomous System\n\
    \   PE-IP:  The IP address of a given PE\n"
- title: 3.  Use Case Scenario Description and Requirements
  contents:
  - "3.  Use Case Scenario Description and Requirements\n   Figure 1 depicts the scenario\
    \ that will be referenced throughout the\n   rest of the document.\n         \
    \                   +--------------+\n                            |          \
    \    |\n          +----+     +----+ |              | +----+   +----+\n       \
    \   | CE1|-----|    | |              | |    |---| CE3|\n          +----+    /|\
    \ PE1| |   IP/MPLS    | | PE3|   +----+\n                   / +----+ |   Network\
    \    | +----+\n                  /         |              |\n                \
    \ /   +----+ |              |\n          +----+/    |    | |              |\n\
    \          | CE2|-----| PE2| |              |\n          +----+     +----+ | \
    \             |\n                            +--------------+\n              \
    \       Figure 1: EVPN Use Case Scenario\n   There are three PEs and three CEs\
    \ considered in this example: PE1,\n   PE2, and PE3, as well as CE1, CE2, and\
    \ CE3.  Broadcast domains must\n   be extended among the three CEs.\n"
- title: 3.1.  Service Requirements
  contents:
  - "3.1.  Service Requirements\n   The following service requirements are assumed\
    \ in this scenario:\n   o  Redundancy requirements:\n      -  CE2 requires multihoming\
    \ connectivity to PE1 and PE2, not only\n         for redundancy purposes but\
    \ also for adding more upstream/\n         downstream connectivity bandwidth to/from\
    \ the network.\n      -  Fast convergence.  For example, if the link between CE2\
    \ and PE1\n         goes down, a fast convergence mechanism must be supported\
    \ so\n         that PE3 can immediately send the traffic to PE2, irrespective\n\
    \         of the number of affected services and MAC addresses.\n   o  Service\
    \ interface requirements:\n      -  The service definition must be flexible in\
    \ terms of CE-VID-to-\n         broadcast-domain assignment in the core.\n   \
    \   -  The following three EVI services are required in this example:\n      \
    \   EVI100 uses VLAN-based service interfaces in the three CEs with\n        \
    \ a 1:1 VLAN-to-EVI mapping.  The CE-VIDs at the three CEs can be\n         the\
    \ same (for example, VID 100) or different at each CE (for\n         instance,\
    \ VID 101 in CE1, VID 102 in CE2, and VID 103 in CE3).\n         A single broadcast\
    \ domain needs to be created for EVI100 in any\n         case; therefore, CE-VIDs\
    \ will require translation at the egress\n         PEs if they are not consistent\
    \ across the three CEs.  The case\n         when the same CE-VID is used across\
    \ the three CEs for EVI100 is\n         referred to in [RFC7432] as the \"Unique\
    \ VLAN\" EVPN case.  This\n         term will be used throughout this document\
    \ too.\n         EVI200 uses VLAN bundle service interfaces in CE1, CE2, and CE3\n\
    \         based on an N:1 VLAN-to-EVI mapping.  The operator needs to\n      \
    \   preconfigure a range of CE-VIDs and its mapping to the EVI, and\n        \
    \ this mapping should be consistent in all the PEs (no\n         translation is\
    \ supported).  A single broadcast domain is\n         created for the customer.\
    \  The customer is responsible for\n         keeping the separation between users\
    \ in different CE-VIDs.\n         EVI300 uses VLAN-aware bundling service interfaces\
    \ in CE1, CE2,\n         and CE3.  As in the EVI200 case, an N:1 VLAN-to-EVI mapping\
    \ is\n         created at the ingress PEs; however, in this case, a separate\n\
    \         broadcast domain is required per CE-VID.  The CE-VIDs can be\n     \
    \    different (hence, CE-VID translation is required).\n   Note that in Section\
    \ 4.2.1, only EVI100 is used as an example of\n   VLAN-based service provisioning.\
    \  In Sections 6.2 and 7.2, 4k VLAN-\n   based EVIs (EVI1 to EVI4k) are used so\
    \ that the impact of MAC versus\n   MPLS disposition models in the control plane\
    \ can be evaluated.  In\n   the same way, EVI200 and EVI300 will be described\
    \ with a 4k:1 mapping\n   (CE-VIDs-to-EVI mapping) in Sections 6.3, 6.4, 7.3,\
    \ and 7.4.\n   o  Broadcast, Unknown Unicast, Multicast (BUM) optimization\n \
    \     requirements:\n      -  The solution must support ingress replication or\
    \ P2MP MPLS LSPs\n         on a per EVI service.  For example, we can use ingress\n\
    \         replication for EVI100 and EVI200, assuming those EVIs will not\n  \
    \       carry much BUM traffic.  On the contrary, if EVI300 is\n         presumably\
    \ carrying a significant amount of multicast traffic,\n         P2MP MPLS LSPs\
    \ can be used for this service.\n      -  The benefit of ingress replication compared\
    \ to P2MP LSPs is\n         that the core routers will not need to maintain any\
    \ multicast\n         states.\n"
- title: 3.2.  Why EVPN Is Chosen to Address This Use Case
  contents:
  - "3.2.  Why EVPN Is Chosen to Address This Use Case\n   Virtual Private LAN Service\
    \ (VPLS) solutions based on [RFC4761],\n   [RFC4762], and [RFC6074] cannot meet\
    \ the requirements in Section 3,\n   whereas EVPN can.\n   For example:\n   o\
    \  If CE2 has a single CE-VID (or a few CE-VIDs), the current VPLS\n      multihoming\
    \ solutions (based on load-balancing per CE-VID or\n      service) do not provide\
    \ the optimized link utilization required in\n      this example.  EVPN provides\
    \ the flow-based, load-balancing,\n      multihoming solution required in this\
    \ scenario to optimize the\n      upstream/downstream link utilization between\
    \ CE2 and PE1-PE2.\n   o  EVPN provides a fast convergence solution that is independent\
    \ of\n      the CE-VIDs in the multihomed PEs.  Upon failure on the link\n   \
    \   between CE2 and PE1, PE3 can immediately send the traffic to PE2\n      based\
    \ on a single notification message being sent by PE1.  This is\n      not possible\
    \ with VPLS solutions.\n   o  With regard to service interfaces and mapping to\
    \ broadcast\n      domains, while VPLS might meet the requirements for EVI100\
    \ and\n      EVI200, the VLAN-aware bundling service interfaces required by\n\
    \      EVI300 are not supported by the current VPLS tools.\n   The rest of the\
    \ document will describe how EVPN can be used to meet\n   the service requirements\
    \ described in Section 3 and even optimize the\n   network further by:\n   o \
    \ providing the user with an option to reduce (and even suppress)\n      ARP (Address\
    \ Resolution Protocol) flooding; and\n   o  supporting ARP termination and inter-subnet\
    \ forwarding.\n"
- title: 4.  Provisioning Model
  contents:
  - "4.  Provisioning Model\n   One of the requirements stated in [RFC7209] is the\
    \ ease of\n   provisioning.  BGP parameters and service context parameters should\n\
    \   be auto-provisioned so that the addition of a new MAC-VRF to the EVI\n   requires\
    \ a minimum number of single-sided provisioning touches.\n   However, this is\
    \ possible only in a limited number of cases.  This\n   section describes the\
    \ provisioning tasks required for the services\n   described in Section 3, i.e.,\
    \ EVI100 (VLAN-based service interfaces),\n   EVI200 (VLAN bundle service interfaces),\
    \ and EVI300 (VLAN-aware\n   bundling service interfaces).\n"
- title: 4.1.  Common Provisioning Tasks
  contents:
  - "4.1.  Common Provisioning Tasks\n   Regardless of the service interface type\
    \ (VLAN-based, VLAN bundle, or\n   VLAN-aware), the following subsections describe\
    \ the parameters to be\n   provisioned in the three PEs.\n"
- title: 4.1.1.  Non-Service-Specific Parameters
  contents:
  - "4.1.1.  Non-Service-Specific Parameters\n   The multihoming function in EVPN\
    \ requires the provisioning of certain\n   parameters that are not service specific\
    \ and that are shared by all\n   the MAC-VRFs in the node using the multihoming\
    \ capabilities.  In our\n   use case, these parameters are only provisioned or\
    \ auto-derived in\n   PE1 and PE2 and are listed below:\n   o  Ethernet Segment\
    \ Identifier (ESI): Only the ESI associated with\n      CE2 needs to be considered\
    \ in our example.  Single-homed CEs such\n      as CE1 and CE3 do not require\
    \ the provisioning of an ESI (the ESI\n      will be coded as zero in the BGP\
    \ Network Layer Reachability\n      Information (NLRI)).  In our example, a Link\
    \ Aggregation Group\n      (LAG) is used between CE2 and PE1-PE2 (since all-active\n\
    \      multihoming is a requirement); therefore, the ESI can be auto-\n      derived\
    \ from the LACP information as described in [RFC7432].  Note\n      that the ESI\
    \ must be unique across all the PEs in the network;\n      therefore, the auto-provisioning\
    \ of the ESI is recommended only in\n      case the CEs are managed by the operator.\
    \  Otherwise, the ESI\n      should be manually provisioned (Type 0, as in [RFC7432])\
    \ in order\n      to avoid potential conflicts.\n   o  ES-Import Route Target\
    \ (ES-Import RT): This is the RT that will be\n      sent by PE1 and PE2, along\
    \ with the ES route.  Regardless of how\n      the ESI is provisioned in PE1 and\
    \ PE2, the ES-Import RT must\n      always be auto-derived from the 6-byte MAC\
    \ address portion of the\n      ESI value.\n   o  Ethernet Segment Route Distinguisher\
    \ (ES RD): This is the RD to be\n      encoded in the ES route, and it is the\
    \ Ethernet Auto-Discovery\n      (A-D) route to be sent by PE1 and PE2 for the\
    \ CE2 ESI.  This RD\n      should always be auto-derived from the PE-IP address,\
    \ as described\n      in [RFC7432].\n   o  Multihoming type: The user must be\
    \ able to provision the\n      multihoming type to be used in the network.  In\
    \ our use case, the\n      multihoming type will be set to all-active for the\
    \ CE2 ESI.  This\n      piece of information is encoded in the ESI Label extended\n\
    \      community flags and is sent by PE1 and PE2 along with the Ethernet\n  \
    \    A-D route for the CE2 ESI.\n   In addition, the same LACP parameters will\
    \ be configured in PE1 and\n   PE2 for the ES so that CE2 can send frames to PE1\
    \ and PE2 as though\n   they were forming a single system.\n"
- title: 4.1.2.  Service-Specific Parameters
  contents:
  - "4.1.2.  Service-Specific Parameters\n   The following parameters must be provisioned\
    \ in PE1, PE2, and PE3 per\n   EVI service:\n   o  EVI Identifier: The global\
    \ identifier per EVI that is shared by\n      all the PEs that are part of the\
    \ EVI, i.e., PE1, PE2, and PE3 will\n      be provisioned with EVI100, 200, and\
    \ 300.  The EVI identifier can\n      be associated with (or be the same value\
    \ as) the EVI default\n      Ethernet Tag (4-byte default broadcast domain identifier\
    \ for the\n      EVI).  The Ethernet Tag is different from zero in the EVPN BGP\n\
    \      routes only if the service interface type (of the source PE) is a\n   \
    \   VLAN-aware bundle.\n   o  EVI Route Distinguisher (EVI RD): This RD is a unique\
    \ value across\n      all the MAC-VRFs in a PE.  Auto-derivation of this RD might\
    \ be\n      possible depending on the service interface type being used in the\n\
    \      EVI.  The next section discusses the specifics of each service\n      interface\
    \ type.\n   o  EVI Route Target(s) (EVI RT): One or more RTs can be provisioned\n\
    \      per MAC-VRF.  The RT(s) imported and exported can be equal or\n      different,\
    \ just as the RT(s) in IP-VPNs.  Auto-derivation of this\n      RT(s) might be\
    \ possible depending on the service interface type\n      being used in the EVI.\
    \  The next section discusses the specifics\n      of each service interface type.\n\
    \   o  CE-VID and port/LAG binding to EVI identifier or Ethernet Tag: For\n  \
    \    more information, please see Section 4.2.\n"
- title: 4.2.  Service-Interface-Dependent Provisioning Tasks
  contents:
  - "4.2.  Service-Interface-Dependent Provisioning Tasks\n   Depending on the service\
    \ interface type being used in the EVI, a\n   given CE-VID binding provision must\
    \ be specified.\n"
- title: 4.2.1.  VLAN-Based Service Interface EVI
  contents:
  - "4.2.1.  VLAN-Based Service Interface EVI\n   In our use case, EVI100 is a VLAN-based\
    \ service interface EVI.\n   EVI100 can be a \"unique-VLAN\" service if the CE-VID\
    \ being used for\n   this service in CE1, CE2, and CE3 is identical (for example,\
    \ VID\n   100).  In that case, the VID 100 binding must be provisioned in PE1,\n\
    \   PE2, and PE3 for EVI100 and the associated port or LAG.  The MAC-VRF\n   RD\
    \ and RT can be auto-derived from the CE-VID:\n   o  The auto-derived MAC-VRF\
    \ RD will be a Type 1 RD, as recommended in\n      [RFC7432], and it will be comprised\
    \ of [PE-IP]:[zero-padded-VID];\n      where [PE-IP] is the IP address of the\
    \ PE (a loopback address) and\n      [zero-padded-VID] is a 2-byte value where\
    \ the low-order 12 bits\n      are the VID (VID 100 in our example) and the high-order\
    \ 4 bits are\n      zero.\n   o  The auto-derived MAC-VRF RT will be composed\
    \ of [AS]:[zero-padded-\n      VID]; where [AS] is the Autonomous System that\
    \ the PE belongs to\n      and [zero-padded-VID] is a 2- or 4-byte value where\
    \ the low-order\n      12 bits are the VID (VID 100 in our example) and the high-order\n\
    \      bits are zero.  Note that auto-deriving the RT implies supporting\n   \
    \   a basic any-to-any topology in the EVI and using the same import\n      and\
    \ export RT in the EVI.\n   If EVI100 is not a \"unique-VLAN\" instance, each\
    \ individual CE-VID\n   must be configured in each PE, and MAC-VRF RDs and RTs\
    \ cannot be\n   auto-derived; hence, they must be provisioned by the user.\n"
- title: 4.2.2.  VLAN Bundle Service Interface EVI
  contents:
  - "4.2.2.  VLAN Bundle Service Interface EVI\n   Assuming EVI200 is a VLAN bundle\
    \ service interface EVI, and VIDs\n   200-250 are assigned to EVI200, the CE-VID\
    \ bundle 200-250 must be\n   provisioned on PE1, PE2, and PE3.  Note that this\
    \ model does not\n   allow CE-VID translation and the CEs must use the same CE-VIDs\
    \ for\n   EVI200.  No auto-derived EVI RDs or EVI RTs are possible.\n"
- title: 4.2.3.  VLAN-Aware Bundling Service Interface EVI
  contents:
  - "4.2.3.  VLAN-Aware Bundling Service Interface EVI\n   If EVI300 is a VLAN-aware\
    \ bundling service interface EVI, CE-VID\n   binding to EVI300 does not have to\
    \ match on the three PEs (only on\n   PE1 and PE2, since they are part of the\
    \ same ES).  For example, PE1\n   and PE2 CE-VID binding to EVI300 can be set\
    \ to the range 300-310 and\n   PE3 to 321-330.  Note that each individual CE-VID\
    \ will be assigned to\n   a different broadcast domain, which will be represented\
    \ by an\n   Ethernet Tag in the control plane.\n   Therefore, besides the CE-VID\
    \ bundle range bound to EVI300 in each\n   PE, associations between each individual\
    \ CE-VID and the corresponding\n   EVPN Ethernet Tag must be provisioned by the\
    \ user.  No auto-derived\n   EVI RDs/RTs are possible.\n"
- title: 5.  BGP EVPN NLRI Usage
  contents:
  - "5.  BGP EVPN NLRI Usage\n   [RFC7432] defines four different route types and\
    \ four different\n   extended communities.  However, not all the PEs in an EVPN\
    \ network\n   must generate and process all the different routes and extended\n\
    \   communities.  Table 1 shows the routes that must be exported and\n   imported\
    \ in the use case described in this document.  \"Export\", in\n   this context,\
    \ means that the PE must be capable of generating and\n   exporting a given route,\
    \ assuming there are no BGP policies to\n   prevent it.  In the same way, \"Import\"\
    \ means the PE must be capable\n   of importing and processing a given route,\
    \ assuming the right RTs and\n   policies.  \"N/A\" means neither import nor export\
    \ actions are\n   required.\n            +-----------------+---------------+---------------+\n\
    \            | BGP EVPN Routes | PE1-PE2       | PE3           |\n           \
    \ +-----------------+---------------+---------------+\n            | ES      \
    \        | Export/Import | N/A           |\n            | A-D per ESI     | Export/Import\
    \ | Import        |\n            | A-D per EVI     | Export/Import | Import  \
    \      |\n            | MAC             | Export/Import | Export/Import |\n  \
    \          | Inclusive Mcast | Export/Import | Export/Import |\n            +-----------------+---------------+---------------+\n\
    \            Table 1: Base EVPN Routes and Export/Import Actions\n   PE3 is required\
    \ to export only MAC and Inclusive Multicast (Mcast)\n   routes and be able to\
    \ import and process A-D routes as well as MAC\n   and Inclusive Multicast routes.\
    \  If PE3 did not support importing and\n   processing A-D routes per ESI and\
    \ per EVI, fast convergence and\n   aliasing functions (respectively) would not\
    \ be possible in this use\n   case.\n"
- title: 6.  MAC-Based Forwarding Model Use Case
  contents:
  - "6.  MAC-Based Forwarding Model Use Case\n   This section describes how the BGP\
    \ EVPN routes are exported and\n   imported by the PEs in our use case as well\
    \ as how traffic is\n   forwarded assuming that PE1, PE2, and PE3 support a MAC-based\n\
    \   forwarding model.  In order to compare the control- and data-plane\n   impact\
    \ in the two forwarding models (MAC-based and MPLS-based) and\n   different service\
    \ types, we will assume that CE1, CE2, and CE3 need\n   to exchange traffic for\
    \ up to 4k CE-VIDs.\n"
- title: 6.1.  EVPN Network Startup Procedures
  contents:
  - "6.1.  EVPN Network Startup Procedures\n   Before any EVI is provisioned in the\
    \ network, the following\n   procedures are required:\n   o  Infrastructure setup:\
    \ The proper MPLS infrastructure must be set\n      up among PE1, PE2, and PE3\
    \ so that the EVPN services can make use\n      of Point-to-Point (P2P) and P2MP\
    \ LSPs.  In addition to the MPLS\n      transport, PE1 and PE2 must be properly\
    \ configured with the same\n      LACP configuration to CE2.  Details are provided\
    \ in [RFC7432].\n      Once the LAG is properly set up, the ESI for the CE2 Ethernet\n\
    \      Segment (for example, ESI12) can be auto-generated by PE1 and PE2\n   \
    \   from the LACP information exchanged with CE2 (ESI Type 1), as\n      discussed\
    \ in Section 4.1.  Alternatively, the ESI can also be\n      manually provisioned\
    \ on PE1 and PE2 (ESI Type 0).  PE1 and PE2\n      will auto-configure a BGP policy\
    \ that will import any ES route\n      matching the auto-derived ES-Import RT\
    \ for ESI12.\n   o  Ethernet Segment route exchange and Designated Forwarder (DF)\n\
    \      election: PE1 and PE2 will advertise a BGP Ethernet Segment route\n   \
    \   for ESI12, where the ESI RD and ES-Import RT will be auto-\n      generated\
    \ as discussed in Section 4.1.1.  PE1 and PE2 will import\n      the ES routes\
    \ of each other and will run the DF election algorithm\n      for any existing\
    \ EVI (if any, at this point).  PE3 will simply\n      discard the route.  Note\
    \ that the DF election algorithm can\n      support service carving so that the\
    \ downstream BUM traffic from\n      the network to CE2 can be load-balanced across\
    \ PE1 and PE2 on a\n      per-service basis.\n   At the end of this process, the\
    \ network infrastructure is ready to\n   start deploying EVPN services.  PE1 and\
    \ PE2 are aware of the\n   existence of a shared Ethernet Segment, i.e., ESI12.\n"
- title: 6.2.  VLAN-Based Service Procedures
  contents:
  - "6.2.  VLAN-Based Service Procedures\n   Assuming that the EVPN network must carry\
    \ traffic among CE1, CE2, and\n   CE3 for up to 4k CE-VIDs, the service provider\
    \ can decide to\n   implement VLAN-based service interface EVIs to accomplish\
    \ it.  In\n   this case, each CE-VID will be individually mapped to a different\n\
    \   EVI.  While this means a total number of 4k MAC-VRFs are required per\n  \
    \ PE, the advantages of this approach are the auto-provisioning of most\n   of\
    \ the service parameters if no VLAN translation is needed (see\n   Section 4.2.1)\
    \ and great control over each individual customer\n   broadcast domain.  We assume\
    \ in this section that the range of EVIs\n   from 1 to 4k is provisioned in the\
    \ network.\n"
- title: 6.2.1.  Service Startup Procedures
  contents:
  - "6.2.1.  Service Startup Procedures\n   As soon as the EVIs are created in PE1,\
    \ PE2, and PE3, the following\n   control-plane actions are carried out:\n   o\
    \  Flooding tree setup per EVI (4k routes): Each PE will send one\n      Inclusive\
    \ Multicast Ethernet Tag route per EVI (up to 4k routes\n      per PE) so that\
    \ the flooding tree per EVI can be set up.  Note\n      that ingress replication\
    \ or P2MP LSPs can be optionally signaled\n      in the Provider Multicast Service\
    \ Interface (PMSI) Tunnel\n      attribute and the corresponding tree can be created.\n\
    \   o  Ethernet A-D routes per ESI (a set of routes for ESI12): A set of\n   \
    \   A-D routes with a total list of 4k RTs (one per EVI) for ESI12\n      will\
    \ be issued from PE1 and PE2 (it has to be a set of routes so\n      that the\
    \ total number of RTs can be conveyed).  As per [RFC7432],\n      each Ethernet\
    \ A-D route per ESI is differentiated from the other\n      routes in the set\
    \ by a different Route Distinguisher (ES RD).\n      This set will also include\
    \ ESI Label extended communities with the\n      active-standby flag set to zero\
    \ (all-active multihoming type) and\n      an ESI Label different from zero (used\
    \ for split-horizon\n      functions).  These routes will be imported by the three\
    \ PEs, since\n      the RTs match the locally configured EVI RTs.  The A-D routes\
    \ per\n      ESI will be used for fast convergence and split-horizon functions,\n\
    \      as discussed in [RFC7432].\n   o  Ethernet A-D routes per EVI (4k routes):\
    \ An A-D route per EVI will\n      be sent by PE1 and PE2 for ESI12.  Each individual\
    \ route includes\n      the corresponding EVI RT and an MPLS Label to be used\
    \ by PE3 for\n      the aliasing function.  These routes will be imported by the\
    \ three\n      PEs.\n"
- title: 6.2.2.  Packet Walk-Through
  contents:
  - "6.2.2.  Packet Walk-Through\n   Once the services are set up, the traffic can\
    \ start flowing.\n   Assuming there are no MAC addresses learned yet and that\
    \ MAC learning\n   at the access is performed in the data plane in our use case,\
    \ this is\n   the process followed upon receiving frames from each CE (for example,\n\
    \   EVI1).\n   BUM frame example from CE1:\n   a.  An ARP request with CE-VID=1\
    \ is issued from source MAC CE1-MAC\n       (MAC address coming from CE1 or from\
    \ a device connected to CE1)\n       to find the MAC address of CE3-IP.\n   b.\
    \  Based on the CE-VID, the frame is identified to be forwarded in\n       the\
    \ MAC-VRF-1 (EVI1) context.  A source MAC lookup is done in the\n       MAC FIB,\
    \ and the sender's CE1-IP is looked up in the proxy ARP\n       table within the\
    \ MAC-VRF-1 (EVI1) context.  If CE1-MAC/CE1-IP are\n       unknown in both tables,\
    \ three actions are carried out (assuming\n       the source MAC is accepted by\
    \ PE1):\n       1.  the forwarding state is added for the CE1-MAC associated with\n\
    \           the corresponding port and CE-VID;\n       2.  the ARP request is\
    \ snooped and the tuple CE1-MAC/CE1-IP is\n           added to the proxy ARP table;\
    \ and\n       3.  a BGP MAC Advertisement route is triggered from PE1\n      \
    \     containing the EVI1 RD and RT, ESI=0, Ethernet-Tag=0, and\n           CE1-MAC/CE1-IP,\
    \ along with an MPLS Label assigned to MAC-\n           VRF-1 from the PE1 Label\
    \ space.  Note that depending on the\n           implementation, the MAC FIB and\
    \ proxy ARP learning processes\n           can independently send two BGP MAC\
    \ advertisements instead of\n           one (one containing only the CE1-MAC and\
    \ another one\n           containing CE1-MAC/CE1-IP).\n       Since we assume\
    \ a MAC forwarding model, a label per MAC-VRF is\n       normally allocated and\
    \ signaled by the three PEs for MAC\n       Advertisement routes.  Based on the\
    \ RT, the route is imported by\n       PE2 and PE3, and the forwarding state plus\
    \ the ARP entry are\n       added to their MAC-VRF-1 context.  From this moment\
    \ on, any ARP\n       request from CE2 or CE3 destined to CE1-IP can be directly\n\
    \       replied to by PE1, PE2, or PE3, and ARP flooding for CE1-IP is\n     \
    \  not needed in the core.\n   c.  Since the ARP frame is a broadcast frame, it\
    \ is forwarded by PE1\n       using the Inclusive Multicast Tree for EVI1 (CE-VID=1\
    \ tag should\n       be kept if translation is required).  Depending on the type\
    \ of\n       tree, the label stack may vary.  For example, assuming ingress\n\
    \       replication, the packet is replicated to PE2 and PE3 with the\n      \
    \ downstream allocated labels and the P2P LSP transport labels.  No\n       other\
    \ labels are added to the stack.\n   d.  Assuming PE1 is the DF for EVI1 on ESI12,\
    \ the frame is locally\n       replicated to CE2.\n   e.  The MPLS-encapsulated\
    \ frame gets to PE2 and PE3.  Since PE2 is\n       non-DF for EVI1 on ESI12, and\
    \ there is no other CE connected to\n       PE2, the frame is discarded.  At PE3,\
    \ the frame is\n       de-encapsulated and the CE-VID is translated, if needed,\
    \ and\n       forwarded to CE3.\n   Any other type of BUM frame from CE1 would\
    \ follow the same\n   procedures.  BUM frames from CE3 would follow the same procedures\n\
    \   too.\n   BUM frame example from CE2:\n   a.  An ARP request with CE-VID=1\
    \ is issued from source MAC CE2-MAC to\n       find the MAC address of CE3-IP.\n\
    \   b.  CE2 will hash the frame and will forward it to, for example, PE2.\n  \
    \     Based on the CE-VID, the frame is identified to be forwarded in\n      \
    \ the EVI1 context.  A source MAC lookup is done in the MAC FIB and\n       the\
    \ sender's CE2-IP is looked up in the proxy ARP table within\n       the MAC-VRF-1\
    \ context.  If both are unknown, three actions are\n       carried out (assuming\
    \ the source MAC is accepted by PE2):\n       1.  the forwarding state is added\
    \ for the CE2-MAC associated with\n           the corresponding LAG/ESI and CE-VID;\n\
    \       2.  the ARP request is snooped and the tuple CE2-MAC/CE2-IP is\n     \
    \      added to the proxy ARP table; and\n       3.  a BGP MAC Advertisement route\
    \ is triggered from PE2\n           containing the EVI1 RD and RT, ESI=12, Ethernet-Tag=0,\
    \ and\n           CE2-MAC/CE2-IP, along with an MPLS Label assigned from the\n\
    \           PE2 Label space (one label per MAC-VRF).  Again, depending on\n  \
    \         the implementation, the MAC FIB and proxy ARP learning\n           processes\
    \ can independently send two BGP MAC advertisements\n           instead of one.\n\
    \       Note that since PE3 is not part of ESI12, it will install the\n      \
    \ forwarding state for CE2-MAC as long as the A-D routes for ESI12\n       are\
    \ also active on PE3.  On the contrary, PE1 is part of ESI12,\n       therefore\
    \ PE1 will not modify the forwarding state for CE2-MAC if\n       it has previously\
    \ learned CE2-MAC locally attached to ESI12.\n       Otherwise, it will add the\
    \ forwarding state for CE2-MAC\n       associated with the local ESI12 port.\n\
    \   c.  Assuming PE2 does not have the ARP information for CE3-IP yet,\n     \
    \  and since the ARP is a broadcast frame and PE2 is the non-DF for\n       EVI1\
    \ on ESI12, the frame is forwarded by PE2 in the Inclusive\n       Multicast Tree\
    \ for EVI1, thus adding the ESI Label for ESI12 at\n       the bottom of the stack.\
    \  The ESI Label has been previously\n       allocated and signaled by the A-D\
    \ routes for ESI12.  Note that,\n       as per [RFC7432], if the result of the\
    \ CE2 hashing is different\n       and the frame is sent to PE1, PE1 should add\
    \ the ESI Label too\n       (PE1 is the DF for EVI1 on ESI12).\n   d.  The MPLS-encapsulated\
    \ frame gets to PE1 and PE3.  PE1\n       de-encapsulates the Inclusive Multicast\
    \ Tree Label(s) and, based\n       on the ESI Label at the bottom of the stack,\
    \ it decides to not\n       forward the frame to the ESI12.  It will pop the ESI\
    \ Label and\n       will replicate it to CE1, since CE1 is not part of the ESI\n\
    \       identified by the ESI Label.  At PE3, the Inclusive Multicast\n      \
    \ Tree Label is popped and the frame forwarded to CE3.  If a P2MP\n       LSP\
    \ is used as the Inclusive Multicast Tree for EVI1, PE3 will\n       find an ESI\
    \ Label after popping the P2MP LSP Label.  The ESI\n       Label will simply be\
    \ popped, since CE3 is not part of ESI12.\n   Unicast frame example from CE3 to\
    \ CE1:\n   a.  A unicast frame with CE-VID=1 is issued from source MAC CE3-MAC\n\
    \       and destination MAC CE1-MAC (we assume PE3 has previously\n       resolved\
    \ an ARP request from CE3 to find the MAC of CE1-IP and\n       has added CE3-MAC/CE3-IP\
    \ to its proxy ARP table).\n   b.  Based on the CE-VID, the frame is identified\
    \ to be forwarded in\n       the EVI1 context.  A source MAC lookup is done in\
    \ the MAC FIB\n       within the MAC-VRF-1 context and this time, since we assume\n\
    \       CE3-MAC is known, no further actions are carried out as a result\n   \
    \    of the source lookup.  A destination MAC lookup is performed next\n     \
    \  and the label stack associated with the MAC CE1-MAC is found\n       (including\
    \ the label associated with MAC-VRF-1 in PE1 and the P2P\n       LSP Label to\
    \ get to PE1).  The unicast frame is then encapsulated\n       and forwarded to\
    \ PE1.\n   c.  At PE1, the packet is identified to be part of EVI1 and a\n   \
    \    destination MAC lookup is performed in the MAC-VRF-1 context.\n       The\
    \ labels are popped and the frame is forwarded to CE1 with\n       CE-VID=1.\n\
    \       Unicast frames from CE1 to CE3 or from CE2 to CE3 follow the same\n  \
    \     procedures described above.\n   Unicast frame example from CE3 to CE2:\n\
    \   a.  A unicast frame with CE-VID=1 is issued from source MAC CE3-MAC\n    \
    \   and destination MAC CE2-MAC (we assume PE3 has previously\n       resolved\
    \ an ARP request from CE3 to find the MAC of CE2-IP).\n   b.  Based on the CE-VID,\
    \ the frame is identified to be forwarded in\n       the MAC-VRF-1 context.  We\
    \ assume CE3-MAC is known.  A\n       destination MAC lookup is performed next\
    \ and PE3 finds CE2-MAC\n       associated with PE2 on ESI12, an Ethernet Segment\
    \ for which PE3\n       has two active A-D routes per ESI (from PE1 and PE2) and\
    \ two\n       active A-D routes for EVI1 (from PE1 and PE2).  Based on a\n   \
    \    hashing function for the frame, PE3 may decide to forward the\n       frame\
    \ using the label stack associated with PE2 (label received\n       from the MAC\
    \ Advertisement route) or the label stack associated\n       with PE1 (label received\
    \ from the A-D route per EVI for EVI1).\n       Either way, the frame is encapsulated\
    \ and sent to the remote PE.\n   c.  At PE2 (or PE1), the packet is identified\
    \ to be part of EVI1\n       based on the bottom label, and a destination MAC\
    \ lookup is\n       performed.  At either PE (PE2 or PE1), the FIB lookup yields\
    \ a\n       local ESI12 port to which the frame is sent.\n   Unicast frames from\
    \ CE1 to CE2 follow the same procedures.\n"
- title: 6.3.  VLAN Bundle Service Procedures
  contents:
  - "6.3.  VLAN Bundle Service Procedures\n   Instead of using VLAN-based interfaces,\
    \ the operator can choose to\n   implement VLAN bundle interfaces to carry the\
    \ traffic for the 4k\n   CE-VIDs among CE1, CE2, and CE3.  If that is the case,\
    \ the 4k CE-VIDs\n   can be mapped to the same EVI (for example, EVI200) at each\
    \ PE.  The\n   main advantage of this approach is the low control-plane overhead\n\
    \   (reduced number of routes and labels) and easiness of provisioning at\n  \
    \ the expense of no control over the customer broadcast domains, i.e.,\n   a single\
    \ Inclusive Multicast Tree for all the CE-VIDs and no CE-VID\n   translation in\
    \ the provider network.\n"
- title: 6.3.1.  Service Startup Procedures
  contents:
  - "6.3.1.  Service Startup Procedures\n   As soon as the EVI200 is created in PE1,\
    \ PE2, and PE3, the following\n   control-plane actions are carried out:\n   o\
    \  Flooding tree setup per EVI (one route): Each PE will send one\n      Inclusive\
    \ Multicast Ethernet Tag route per EVI (hence, only one\n      route per PE) so\
    \ that the flooding tree per EVI can be set up.\n      Note that ingress replication\
    \ or P2MP LSPs can optionally be\n      signaled in the PMSI Tunnel attribute\
    \ and the corresponding tree\n      can be created.\n   o  Ethernet A-D routes\
    \ per ESI (one route for ESI12): A single A-D\n      route for ESI12 will be issued\
    \ from PE1 and PE2.  This route will\n      include a single RT (RT for EVI200),\
    \ an ESI Label extended\n      community with the active-standby flag set to zero\
    \ (all-active\n      multihoming type), and an ESI Label different from zero (used\
    \ by\n      the non-DF for split-horizon functions).  This route will be\n   \
    \   imported by the three PEs, since the RT matches the locally\n      configured\
    \ EVI200 RT.  The A-D routes per ESI will be used for\n      fast convergence\
    \ and split-horizon functions, as described in\n      [RFC7432].\n   o  Ethernet\
    \ A-D routes per EVI (one route): An A-D route (EVI200)\n      will be sent by\
    \ PE1 and PE2 for ESI12.  This route includes the\n      EVI200 RT and an MPLS\
    \ Label to be used by PE3 for the aliasing\n      function.  This route will be\
    \ imported by the three PEs.\n"
- title: 6.3.2.  Packet Walk-Through
  contents:
  - "6.3.2.  Packet Walk-Through\n   The packet walk-through for the VLAN bundle case\
    \ is similar to the\n   one described for EVI1 in the VLAN-based case except for\
    \ the way the\n   CE-VID is handled by the ingress PE and the egress PE:\n   o\
    \  No VLAN translation is allowed and the CE-VIDs are kept untouched\n      from\
    \ CE to CE, i.e., the ingress CE-VID must be kept at the\n      imposition PE\
    \ and at the disposition PE.\n   o  The frame is identified to be forwarded in\
    \ the MAC-VRF-200 context\n      as long as its CE-VID belongs to the VLAN bundle\
    \ defined in the\n      PE1/PE2/PE3 port to CE1/CE2/CE3.  Our example is a special\
    \ VLAN\n      bundle case since the entire CE-VID range is defined in the ports;\n\
    \      therefore, any CE-VID would be part of EVI200.\n   Please refer to Section\
    \ 6.2.2 for more information about the control-\n   plane and forwarding-plane\
    \ interaction for BUM and unicast traffic\n   from the different CEs.\n"
- title: 6.4.  VLAN-Aware Bundling Service Procedures
  contents:
  - "6.4.  VLAN-Aware Bundling Service Procedures\n   The last potential service type\
    \ analyzed in this document is VLAN-\n   aware bundling.  When this type of service\
    \ interface is used to carry\n   the 4k CE-VIDs among CE1, CE2, and CE3, all the\
    \ CE-VIDs will be\n   mapped to the same EVI (for example, EVI300).  The difference,\n\
    \   compared to the VLAN bundle service type in the previous section, is\n   that\
    \ each incoming CE-VID will also be mapped to a different\n   \"normalized\" Ethernet\
    \ Tag in addition to EVI300.  If no translation\n   is required, the Ethernet\
    \ Tag will match the CE-VID.  Otherwise, a\n   translation between CE-VID and\
    \ Ethernet Tag will be needed at the\n   imposition PE and at the disposition\
    \ PE.  The main advantage of this\n   approach is the ability to control customer\
    \ broadcast domains while\n   providing a single EVI to the customer.\n"
- title: 6.4.1.  Service Startup Procedures
  contents:
  - "6.4.1.  Service Startup Procedures\n   As soon as the EVI300 is created in PE1,\
    \ PE2, and PE3, the following\n   control-plane actions are carried out:\n   o\
    \  Flooding tree setup per EVI per Ethernet Tag (4k routes): Each PE\n      will\
    \ send one Inclusive Multicast Ethernet Tag route per EVI and\n      per Ethernet\
    \ Tag (hence, 4k routes per PE) so that the flooding\n      tree per customer\
    \ broadcast domain can be set up.  Note that\n      ingress replication or P2MP\
    \ LSPs can optionally be signaled in the\n      PMSI Tunnel attribute and the\
    \ corresponding tree be created.  In\n      the described use case, since all\
    \ the CE-VIDs and Ethernet Tags\n      are defined on the three PEs, multicast\
    \ tree aggregation might\n      make sense in order to save forwarding states.\n\
    \   o  Ethernet A-D routes per ESI (one route for ESI12): A single A-D\n     \
    \ route for ESI12 will be issued from PE1 and PE2.  This route will\n      include\
    \ a single RT (RT for EVI300), an ESI Label extended\n      community with the\
    \ active-standby flag set to zero (all-active\n      multihoming type), and an\
    \ ESI Label different than zero (used by\n      the non-DF for split-horizon functions).\
    \  This route will be\n      imported by the three PEs, since the RT matches the\
    \ locally\n      configured EVI300 RT.  The A-D routes per ESI will be used for\n\
    \      fast convergence and split-horizon functions, as described in\n      [RFC7432].\n\
    \   o  Ethernet A-D routes per EVI: A single A-D route (EVI300) may be\n     \
    \ sent by PE1 and PE2 for ESI12 in case no CE-VID translation is\n      required.\
    \  This route includes the EVI300 RT and an MPLS Label to\n      be used by PE3\
    \ for the aliasing function.  This route will be\n      imported by the three\
    \ PEs.  Note that if CE-VID translation is\n      required, an A-D per EVI route\
    \ is required per Ethernet Tag (4k).\n"
- title: 6.4.2.  Packet Walk-Through
  contents:
  - "6.4.2.  Packet Walk-Through\n   The packet walk-through for the VLAN-aware case\
    \ is similar to the one\n   described before.  Compared to the other two cases,\
    \ VLAN-aware\n   services allow for CE-VID translation and for an N:1 CE-VID to\
    \ EVI\n   mapping.  Both things are not supported at once in either of the two\n\
    \   other service interfaces.  Some differences compared to the packet\n   walk-through\
    \ described in Section 6.2.2 are as follows:\n   o  At the ingress PE, the frames\
    \ are identified to be forwarded in\n      the EVI300 context as long as their\
    \ CE-VID belong to the range\n      defined in the PE port to the CE.  In addition\
    \ to it, CE-VID=x is\n      mapped to a \"normalized\" Ethernet-Tag=y at the MAC-VRF-300\
    \ (where\n      x and y might be equal if no translation is needed).  Qualified\n\
    \      learning is now required (a different bridge table is allocated\n     \
    \ within MAC-VRF-300 for each Ethernet Tag).  Potentially, the same\n      MAC\
    \ could be learned in two different Ethernet Tag bridge tables\n      of the same\
    \ MAC-VRF.\n   o  Any new locally learned MAC on the MAC-VRF-300/Ethernet-Tag=y\n\
    \      interface is advertised by the ingress PE in a MAC Advertisement\n    \
    \  route using the now Ethernet Tag field (Ethernet-Tag=y) so that\n      the\
    \ remote PE learns the MAC associated with the MAC-VRF-300/\n      Ethernet-Tag=y\
    \ FIB.  Note that the Ethernet Tag field is not used\n      in advertisements\
    \ of MACs learned on VLAN-based or VLAN-bundle\n      service interfaces.\n  \
    \ o  At the ingress PE, BUM frames are sent to the corresponding\n      flooding\
    \ tree for the particular Ethernet Tag they are mapped to.\n      Each individual\
    \ Ethernet Tag can have a different flooding tree\n      within the same EVI300.\
    \  For instance, Ethernet-Tag=y can use\n      ingress replication to get to the\
    \ remote PEs, whereas Ethernet-\n      Tag=z can use a P2MP LSP.\n   o  At the\
    \ egress PE, Ethernet-Tag=y (for a given broadcast domain\n      within MAC-VRF-300)\
    \ can be translated to egress CE-VID=x.  That is\n      not possible for VLAN\
    \ bundle interfaces.  It is possible for VLAN-\n      based interfaces, but it\
    \ requires a separate MAC-VRF per CE-VID.\n"
- title: 7.  MPLS-Based Forwarding Model Use Case
  contents:
  - "7.  MPLS-Based Forwarding Model Use Case\n   EVPN supports an alternative forwarding\
    \ model, usually referred to as\n   the MPLS-based forwarding or disposition model,\
    \ as opposed to the\n   MAC-based forwarding or disposition model described in\
    \ Section 6.\n   Using the MPLS-based forwarding model instead of the MAC-based\
    \ model\n   might have an impact on the following:\n   o  the number of forwarding\
    \ states required; and\n   o  the FIB where the forwarding states are handled\
    \ (MAC FIB or MPLS\n      Label FIB (LFIB)).\n   The MPLS-based forwarding model\
    \ avoids the destination MAC lookup at\n   the egress PE MAC FIB at the expense\
    \ of increasing the number of\n   next-hop forwarding states at the egress MPLS\
    \ LFIB.  This also has an\n   impact on the control plane and the label allocation\
    \ model, since an\n   MPLS-based disposition PE must send as many routes and labels\
    \ as\n   required next-hops in the egress MAC-VRF.  This concept is equivalent\n\
    \   to the forwarding models supported in IP-VPNs at the egress PE, where\n  \
    \ an IP lookup in the IP-VPN FIB may or may not be necessary depending\n   on\
    \ the available next-hop forwarding states in the LFIB.\n   The following subsections\
    \ highlight the impact on the control- and\n   data-plane procedures described\
    \ in Section 6 when an MPLS-based\n   forwarding model is used.\n   Note that\
    \ both forwarding models are compatible and interoperable in\n   the same network.\
    \  The implementation of either model in each PE is a\n   local decision to the\
    \ PE node.\n"
- title: 7.1.  Impact of MPLS-Based Forwarding on the EVPN Network Startup
  contents:
  - "7.1.  Impact of MPLS-Based Forwarding on the EVPN Network Startup\n   The MPLS-based\
    \ forwarding model has no impact on the procedures\n   explained in Section 6.1.\n"
- title: 7.2.  Impact of MPLS-Based Forwarding on the VLAN-Based Service
  contents:
  - "7.2.  Impact of MPLS-Based Forwarding on the VLAN-Based Service\n      Procedures\n\
    \   Compared to the MAC-based forwarding model, the MPLS-based forwarding\n  \
    \ model has no impact in terms of the number of routes when all the\n   service\
    \ interfaces are based on VLAN.  The differences for the use\n   case described\
    \ in this document are summarized in the following list:\n   o  Flooding tree\
    \ setup per EVI (4k routes per PE): There is no impact\n      when compared to\
    \ the MAC-based model.\n   o  Ethernet A-D routes per ESI (one set of routes for\
    \ ESI12 per PE):\n      There is no impact compared to the MAC-based model.\n\
    \   o  Ethernet A-D routes per EVI (4k routes per PE/ESI): There is no\n     \
    \ impact compared to the MAC-based model.\n   o  MAC Advertisement routes: Instead\
    \ of allocating and advertising\n      the same MPLS Label for all the new MACs\
    \ locally learned on the\n      same MAC-VRF, a different label must be advertised\
    \ per CE next-hop\n      or MAC so that no MAC FIB lookup is needed at the egress\
    \ PE.  In\n      general, this means that a different label (at least per CE)\
    \ must\n      be advertised, although the PE can decide to implement a label per\n\
    \      MAC if more granularity (hence, less scalability) is required in\n    \
    \  terms of forwarding states.  For example, if CE2 sends traffic\n      from\
    \ two different MACs to PE1, CE2-MAC1, and CE2-MAC2, the same\n      MPLS Label=x\
    \ can be re-used for both MAC advertisements, since\n      they both share the\
    \ same source ESI12.  It is up to the PE1\n      implementation to use a different\
    \ label per individual MAC within\n      the same ES (even if only one label per\
    \ ESI is enough).\n   o  PE1, PE2, and PE3 will not add forwarding states to the\
    \ MAC FIB\n      upon learning new local CE MAC addresses on the data plane but\n\
    \      will rather add forwarding states to the MPLS LFIB.\n"
- title: 7.3.  Impact of MPLS-Based Forwarding on the VLAN Bundle Service
  contents:
  - "7.3.  Impact of MPLS-Based Forwarding on the VLAN Bundle Service\n      Procedures\n\
    \   Compared to the MAC-based forwarding model, the MPLS-based forwarding\n  \
    \ model has no impact in terms of number of routes when all the service\n   interfaces\
    \ are VLAN bundle type.  The differences for the use case\n   described in this\
    \ document are summarized in the following list:\n   o  Flooding tree setup per\
    \ EVI (one route): There is no impact\n      compared to the MAC-based model.\n\
    \   o  Ethernet A-D routes per ESI (one route for ESI12 per PE): There is\n  \
    \    no impact compared to the MAC-based model.\n   o  Ethernet A-D routes per\
    \ EVI (one route per PE/ESI): There is no\n      impact compared to the MAC-based\
    \ model since no VLAN translation\n      is required.\n   o  MAC Advertisement\
    \ routes: Instead of allocating and advertising\n      the same MPLS Label for\
    \ all the new MACs locally learned on the\n      same MAC-VRF, a different label\
    \ must be advertised per CE next-hop\n      or MAC so that no MAC FIB lookup is\
    \ needed at the egress PE.  In\n      general, this means that a different label\
    \ (at least per CE) must\n      be advertised, although the PE can decide to implement\
    \ a label per\n      MAC if more granularity (hence, less scalability) is required\
    \ in\n      terms of forwarding states.  It is up to the PE1 implementation to\n\
    \      use a different label per individual MAC within the same ES (even\n   \
    \   if only one label per ESI is enough).\n   o  PE1, PE2, and PE3 will not add\
    \ forwarding states to the MAC FIB\n      upon learning new local CE MAC addresses\
    \ on the data plane, but\n      will rather add forwarding states to the MPLS\
    \ LFIB.\n"
- title: 7.4.  Impact of MPLS-Based Forwarding on the VLAN-Aware Service
  contents:
  - "7.4.  Impact of MPLS-Based Forwarding on the VLAN-Aware Service\n      Procedures\n\
    \   Compared to the MAC-based forwarding model, the MPLS-based forwarding\n  \
    \ model has no impact in terms of the number of A-D routes when all the\n   service\
    \ interfaces are of the VLAN-aware bundle type.  The\n   differences for the use\
    \ case described in this document are\n   summarized in the following list:\n\
    \   o  Flooding tree setup per EVI (4k routes per PE): There is no impact\n  \
    \    compared to the MAC-based model.\n   o  Ethernet A-D routes per ESI (one\
    \ route for ESI12 per PE): There is\n      no impact compared to the MAC-based\
    \ model.\n   o  Ethernet A-D routes per EVI (1 route per ESI or 4k routes per\
    \ PE/\n      ESI): PE1 and PE2 may send one route per ESI if no CE-VID\n     \
    \ translation is needed.  However, 4k routes are normally sent for\n      EVI300,\
    \ one per <ESI, Ethernet Tag ID> tuple.  This allows the\n      egress PE to find\
    \ out all the forwarding information in the MPLS\n      LFIB and even support\
    \ Ethernet Tag to CE-VID translation at the\n      egress.\n   o  MAC Advertisement\
    \ routes: Instead of allocating and advertising\n      the same MPLS Label for\
    \ all the new MACs locally learned on the\n      same MAC-VRF, a different label\
    \ must be advertised per CE next-hop\n      or MAC so that no MAC FIB lookup is\
    \ needed at the egress PE.  In\n      general, this means that a different label\
    \ (at least per CE) must\n      be advertised, although the PE can decide to implement\
    \ a label per\n      MAC if more granularity (hence, less scalability) is required\
    \ in\n      terms of forwarding states.  It is up to the PE1 implementation to\n\
    \      use a different label per individual MAC within the same ES.  Note\n  \
    \    that the Ethernet Tag will be set to a non-zero value for the MAC\n     \
    \ Advertisement routes.  The same MAC address can be announced with\n      a different\
    \ Ethernet Tag value.  This will make the advertising PE\n      install two different\
    \ forwarding states in the MPLS LFIB.\n   o  PE1, PE2, and PE3 will not add forwarding\
    \ states to the MAC FIB\n      upon learning new local CE MAC addresses on the\
    \ data plane but\n      will rather add forwarding states to the MPLS LFIB.\n"
- title: 8.  Comparison between MAC-Based and MPLS-Based Egress Forwarding Models
  contents:
  - "8.  Comparison between MAC-Based and MPLS-Based Egress Forwarding Models\n  \
    \ Both forwarding models are possible in a network deployment, and each\n   one\
    \ has its own trade-offs.\n   Both forwarding models can save A-D routes per EVI\
    \ when VLAN-aware\n   bundling services are deployed and no CE-VID translation\
    \ is required.\n   While this saves a significant amount of routes, customers\
    \ normally\n   require CE-VID translation; hence, we assume an A-D per EVI route\
    \ per\n   <ESI, Ethernet Tag> is needed.\n   The MAC-based model saves a significant\
    \ amount of MPLS Labels\n   compared to the MPLS-based forwarding model.  All\
    \ the MACs and A-D\n   routes for the same EVI can signal the same MPLS Label,\
    \ saving labels\n   from the local PE space.  A MAC FIB lookup at the egress PE\
    \ is\n   required in order to do so.\n   The MPLS-based forwarding model can save\
    \ forwarding states at the\n   egress PEs if labels per next-hop CE (as opposed\
    \ to per MAC) are\n   implemented.  No egress MAC lookup is required.  Also, a\
    \ different\n   label per next-hop CE per MAC-VRF is consumed, as opposed to a\
    \ single\n   label per MAC-VRF.\n   Table 2 summarizes the resource implementation\
    \ details of both\n   models.\n   +-----------------------------+-----------------+------------------+\n\
    \   | Resources                   | MAC-Based Model | MPLS-Based Model |\n   +-----------------------------+-----------------+------------------+\n\
    \   | MPLS Labels Consumed        | 1 per MAC-VRF   | 1 per CE/EVI     |\n   |\
    \ Egress PE Forwarding States | 1 per MAC       | 1 per Next-Hop   |\n   | Egress\
    \ PE Lookups           | 2 (MPLS+MAC)    | 1 (MPLS)         |\n   +-----------------------------+-----------------+------------------+\n\
    \   Table 2: Resource Comparison between MAC-Based and MPLS-Based Models\n   The\
    \ egress forwarding model is an implementation local to the egress\n   PE and\
    \ is independent of the model supported on the rest of the PEs;\n   i.e., in our\
    \ use case, PE1, PE2, and PE3 could have either egress\n   forwarding model without\
    \ any dependencies.\n"
- title: 9.  Traffic Flow Optimization
  contents:
  - "9.  Traffic Flow Optimization\n   In addition to the procedures described across\
    \ Sections 3 through 8,\n   EVPN [RFC7432] procedures allow for optimized traffic\
    \ handling in\n   order to minimize unnecessary flooding across the entire\n \
    \  infrastructure.  Optimization is provided through specific ARP\n   termination\
    \ and the ability to block unknown unicast flooding.\n   Additionally, EVPN procedures\
    \ allow for intelligent, close to the\n   source, inter-subnet forwarding and\
    \ solves the commonly known\n   suboptimal routing problem.  Besides the traffic\
    \ efficiency, ingress-\n   based inter-subnet forwarding also optimizes packet\
    \ forwarding rules\n   and implementation at the egress nodes as well.  Details\
    \ of these\n   procedures are outlined in Sections 9.1 and 9.2.\n"
- title: 9.1.  Control-Plane Procedures
  contents:
  - '9.1.  Control-Plane Procedures

    '
- title: 9.1.1.  MAC Learning Options
  contents:
  - "9.1.1.  MAC Learning Options\n   The fundamental premise of [RFC7432] is the\
    \ notion of a different\n   approach to MAC address learning compared to traditional\
    \ IEEE 802.1\n   bridge learning methods; specifically, EVPN differentiates between\n\
    \   data and control-plane-driven learning mechanisms.\n   Data-driven learning\
    \ implies that there is no separate communication\n   channel used to advertise\
    \ and propagate MAC addresses.  Rather, MAC\n   addresses are learned through\
    \ IEEE-defined bridge learning procedures\n   as well as by snooping on DHCP and\
    \ ARP requests.  As different MAC\n   addresses show up on different ports, the\
    \ Layer 2 (L2) FIB is\n   populated with the appropriate MAC addresses.\n   Control-plane-driven\
    \ learning implies a communication channel that\n   could be either a control-plane\
    \ protocol or a management-plane\n   mechanism.  In the context of EVPN, two different\
    \ learning procedures\n   are defined: local and remote procedures.\n   o  Local\
    \ learning defines the procedures used for learning the MAC\n      addresses of\
    \ network elements locally connected to a MAC-VRF.\n      Local learning could\
    \ be implemented through all three learning\n      procedures: control plane,\
    \ management plane, and data plane.\n      However, the expectation is that for\
    \ most of the use cases, local\n      learning through the data plane should be\
    \ sufficient.\n   o  Remote learning defines the procedures used for learning\
    \ MAC\n      addresses of network elements remotely connected to a MAC-VRF,\n\
    \      i.e., far-end PEs.  Remote learning procedures defined in\n      [RFC7432]\
    \ advocate using only control-plane learning, BGP\n      specifically.  Through\
    \ the use of BGP EVPN NLRIs, the remote PE\n      has the capability of advertising\
    \ all the MAC addresses present in\n      its local FIB.\n"
- title: 9.1.2.  Proxy ARP/ND
  contents:
  - "9.1.2.  Proxy ARP/ND\n   In EVPN, MAC addresses are advertised via the MAC/IP\
    \ Advertisement\n   route, as discussed in [RFC7432].  Optionally, an IP address\
    \ can be\n   advertised along with the MAC address advertisement.  However, there\n\
    \   are certain rules put in place in terms of IP address usage: if the\n   MAC/IP\
    \ Route contains an IP address, this particular IP address\n   correlates directly\
    \ with the advertised MAC address.  Such\n   advertisement allows us to build\
    \ a proxy ARP / Neighbor Discovery\n   (ND) table populated with the IP<->MAC\
    \ bindings received from all the\n   remote nodes.\n   Furthermore, based on these\
    \ bindings, a local MAC-VRF can now provide\n   proxy ARP/ND functionality for\
    \ all ARP requests and ND solicitations\n   directed to the IP address pool learned\
    \ through BGP.  Therefore, the\n   amount of unnecessary L2 flooding (ARP/ND requests/solicitations\
    \ in\n   this case) can be further reduced by the introduction of proxy ARP/ND\n\
    \   functionality across all EVI MAC-VRFs.\n"
- title: 9.1.3.  Unknown Unicast Flooding Suppression
  contents:
  - "9.1.3.  Unknown Unicast Flooding Suppression\n   Given that all locally learned\
    \ MAC addresses are advertised through\n   BGP to all remote PEs, suppressing\
    \ flooding of any unknown unicast\n   traffic towards the remote PEs is a feasible\
    \ network optimization.\n   The assumption in the use case is made that any network\
    \ device that\n   appears on a remote MAC-VRF will somehow signal its presence\
    \ to the\n   network.  This signaling can be done through, for example, gratuitous\n\
    \   ARPs.  Once the remote PE acknowledges the presence of the node in\n   the\
    \ MAC-VRF, it will do two things: install its MAC address in its\n   local FIB\
    \ and advertise this MAC address to all other BGP speakers\n   via EVPN NLRI.\
    \  Therefore, we can assume that any active MAC address\n   is propagated and\
    \ learned through the entire EVI.  Given that MAC\n   addresses become prepopulated\
    \ -- once nodes are alive on the network\n   -- there is no need to flood any\
    \ unknown unicast towards the remote\n   PEs.  If the owner of a given destination\
    \ MAC is active, the BGP\n   route will be present in the local RIB and FIB, assuming\
    \ that the BGP\n   import policies are successfully applied; otherwise, the owner\
    \ of\n   such destination MAC is not present on the network.\n   It is worth noting\
    \ that unknown unicast flooding must not be\n   suppressed unless (at least) one\
    \ of the following two statements is\n   given: a) control- or management-plane\
    \ learning is performed\n   throughout the entire EVI for all the MACs or b) all\
    \ the EVI-attached\n   devices signal their presence when they come up (Gratuitous\
    \ ARP\n   (GARP) packets or similar).\n"
- title: 9.1.4.  Optimization of Inter-Subnet Forwarding
  contents:
  - "9.1.4.  Optimization of Inter-Subnet Forwarding\n   In a scenario in which both\
    \ L2 and L3 services are needed over the\n   same physical topology, some interaction\
    \ between EVPN and IP-VPN is\n   required.  A common way of stitching the two\
    \ service planes is\n   through the use of an Integrated Routing and Bridging\
    \ (IRB)\n   interface, which allows for traffic to be either routed or bridged\n\
    \   depending on its destination MAC address.  If the destination MAC\n   address\
    \ is the one from the IRB interface, traffic needs to be passed\n   through a\
    \ routing module and potentially be either routed to a remote\n   PE or forwarded\
    \ to a local subnet.  If the destination MAC address is\n   not the one from the\
    \ IRB interface, the MAC-VRF follows standard\n   bridging procedures.\n   A typical\
    \ example of EVPN inter-subnet forwarding would be a scenario\n   in which multiple\
    \ IP subnets are part of a single or multiple EVIs,\n   and they all belong to\
    \ a single IP-VPN.  In such topologies, it is\n   desired that inter-subnet traffic\
    \ can be efficiently routed without\n   any tromboning effects in the network.\
    \  Due to the overlapping\n   physical and service topology in such scenarios,\
    \ all inter-subnet\n   connectivity will be locally routed through the IRB interface.\n\
    \   In addition to optimizing the traffic patterns in the network, local\n   inter-subnet\
    \ forwarding also greatly optimizes the amount of\n   processing needed to cross\
    \ the subnets.  Through EVPN MAC\n   advertisements, the local PE learns the real\
    \ destination MAC address\n   associated with the remote IP address and the inter-subnet\
    \ forwarding\n   can happen locally.  When the packet is received at the egress\
    \ PE, it\n   is directly mapped to an egress MAC-VRF and bypasses any egress\n\
    \   IP-VPN processing.\n   Please refer to [EVPN-INTERSUBNET] for more information\
    \ about the IP\n   inter-subnet forwarding procedures in EVPN.\n"
- title: 9.2.  Packet Walk-Through Examples
  contents:
  - "9.2.  Packet Walk-Through Examples\n   Assuming that the services are set up\
    \ according to Figure 1 in\n   Section 3, the following flow optimization processes\
    \ will take place\n   in terms of creating, receiving, and forwarding packets\
    \ across the\n   network.\n"
- title: 9.2.1.  Proxy ARP Example for CE2-to-CE3 Traffic
  contents:
  - "9.2.1.  Proxy ARP Example for CE2-to-CE3 Traffic\n   Using Figure 1 in Section\
    \ 3, consider EVI400 residing on PE1, PE2,\n   and PE3 connecting CE2 and CE3\
    \ networks.  Also, consider that PE1 and\n   PE2 are part of the all-active multihoming\
    \ ES for CE2, and that PE2\n   is elected designated forwarder for EVI400.  We\
    \ assume that all the\n   PEs implement the proxy ARP functionality in the MAC-VRF-400\
    \ context.\n   In this scenario, PE3 will not only advertise the MAC addresses\n\
    \   through the EVPN MAC Advertisement route but also IP addresses of\n   individual\
    \ hosts (i.e., /32 prefixes) behind CE3.  Upon receiving the\n   EVPN routes,\
    \ PE1 and PE2 will install the MAC addresses in the MAC-\n   VRF-400 FIB and,\
    \ based on the associated received IP addresses, PE1\n   and PE2 can now build\
    \ a proxy ARP table within the context of MAC-\n   VRF-400.\n   From the forwarding\
    \ perspective, when a node behind CE2 sends a frame\n   destined to a node behind\
    \ CE3, it will first send an ARP request to,\n   for example, PE2 (based on the\
    \ result of the CE2 hashing).  Assuming\n   that PE2 has populated its proxy ARP\
    \ table for all active nodes\n   behind the CE3, and that the IP address in the\
    \ ARP message matches\n   the entry in the table, PE2 will respond to the ARP\
    \ request with the\n   actual MAC address on behalf of the node behind CE3.\n\
    \   Once the nodes behind CE2 learn the actual MAC address of the nodes\n   behind\
    \ CE3, all the MAC-to-MAC communications between the two\n   networks will be\
    \ unicast.\n"
- title: 9.2.2.  Flood Suppression Example for CE1-to-CE3 Traffic
  contents:
  - "9.2.2.  Flood Suppression Example for CE1-to-CE3 Traffic\n   Using Figure 1 in\
    \ Section 3, consider EVI500 residing on PE1 and PE3\n   connecting CE1 and CE3\
    \ networks.  Consider that both PE1 and PE3 have\n   disabled unknown unicast\
    \ flooding for this specific EVI context.\n   Once the network devices behind\
    \ CE3 come online, they will learn\n   their MAC addresses and create local FIB\
    \ entries for these devices.\n   Note that local FIB entries could also be created\
    \ through either a\n   control or management plane between PE and CE as well.\
    \  Consequently,\n   PE3 will automatically create EVPN Type 2 MAC Advertisement\
    \ routes\n   and advertise all locally learned MAC addresses.  The routes will\n\
    \   also include the corresponding MPLS Label.\n   Given that PE1 automatically\
    \ learns and installs all MAC addresses\n   behind CE3, its MAC-VRF FIB will already\
    \ be prepopulated with the\n   respective next-hops and label assignments associated\
    \ with the MAC\n   addresses behind CE3.  As such, as soon as the traffic sent\
    \ by CE1 to\n   nodes behind CE3 is received into the context of EVI500, PE1 will\n\
    \   push the MPLS Label(s) onto the original Ethernet frame and send the\n   packet\
    \ to the MPLS network.  As usual, once PE3 receives this packet,\n   and depending\
    \ on the forwarding model, PE3 will either do a next-hop\n   lookup in the EVI500\
    \ context or just forward the traffic directly to\n   the CE3.  In the case that\
    \ PE1 MAC-VRF-500 does not have a MAC entry\n   for a specific destination that\
    \ CE1 is trying to reach, PE1 will drop\n   the frame since unknown unicast flooding\
    \ is disabled.\n   Based on the assumption that all the MAC entries behind the\
    \ CEs are\n   prepopulated through gratuitous ARP and/or DHCP requests, if one\n\
    \   specific MAC entry is not present in the MAC-VRF-500 FIB on PE1, the\n   owner\
    \ of that MAC is not alive on the network behind the CE3; hence,\n   the traffic\
    \ can be dropped at PE1 instead of flooding and consuming\n   network bandwidth.\n"
- title: 9.2.3.  Optimization of Inter-subnet Forwarding Example for CE3-to-CE2
  contents:
  - "9.2.3.  Optimization of Inter-subnet Forwarding Example for CE3-to-CE2\n    \
    \    Traffic\n   Using Figure 1 in Section 3, consider that there is an IP-VPN\
    \ 666\n   context residing on PE1, PE2, and PE3, which connects CE1, CE2, and\n\
    \   CE3 into a single IP-VPN domain.  Also consider that there are two\n   EVIs\
    \ present on the PEs, EVI600 and EVI60.  Each IP subnet is\n   associated with\
    \ a different MAC-VRF context.  Thus, there is a single\n   subnet (subnet 600)\
    \ between CE1 and CE3 that is established through\n   EVI600.  Similarly, there\
    \ is another subnet (subnet 60) between CE2\n   and CE3 that is established through\
    \ EVI60.  Since both subnets are\n   part of the same IP-VPN, there is a mapping\
    \ of each EVI (or\n   individual subnet) to a local IRB interface on the three\
    \ PEs.\n   If a node behind CE2 wants to communicate with a node on the same\n\
    \   subnet seating behind CE3, the communication flow will follow the\n   standard\
    \ EVPN procedures, i.e., FIB lookup within the PE1 (or PE2)\n   after adding the\
    \ corresponding EVPN label to the MPLS Label stack\n   (downstream label allocation\
    \ from PE3 for EVI60).\n   When it comes to crossing the subnet boundaries, the\
    \ ingress PE\n   implements local inter-subnet forwarding.  For example, when\
    \ a node\n   behind CE2 (EVI60) sends a packet to a node behind CE1 (EVI600),\
    \ the\n   destination IP address will be in the subnet 600, but the destination\n\
    \   MAC address will be the address of the source node's default gateway,\n  \
    \ which in this case will be an IRB interface on PE1 (connecting EVI60\n   to\
    \ IP-VPN 666).  Once PE1 sees the traffic destined to its own MAC\n   address,\
    \ it will route the packet to EVI600, i.e., it will change the\n   source MAC\
    \ address to the one of the IRB interface in EVI600 and\n   change the destination\
    \ MAC address to the address belonging to the\n   node behind CE1, which is already\
    \ populated in the MAC-VRF-600 FIB,\n   either through data- or control-plane\
    \ learning.\n   An important optimization to be noted is the local inter-subnet\n\
    \   forwarding in lieu of IP-VPN routing.  If the node from subnet 60\n   (behind\
    \ CE2) is sending a packet to the remote end-node on subnet 600\n   (behind CE3),\
    \ the mechanism in place still honors the local inter-\n   subnet (inter-EVI)\
    \ forwarding.\n   In our use case, therefore, when the node from subnet 60 behind\
    \ CE2\n   sends traffic to the node on subnet 600 behind CE3, the destination\n\
    \   MAC address is the PE1 MAC-VRF-60 IRB MAC address.  However, once the\n  \
    \ traffic locally crosses EVIs to EVI600 (via the IRB interface on\n   PE1), the\
    \ source MAC address is changed to that of the IRB interface\n   and the destination\
    \ MAC address is changed to the one advertised by\n   PE3 via EVPN and already\
    \ installed in MAC-VRF-600.  The rest of the\n   forwarding through PE1 is using\
    \ the MAC-VRF-600 forwarding context\n   and label space.\n   Another very relevant\
    \ optimization is due to the fact that traffic\n   between PEs is forwarded through\
    \ EVPN rather than through IP-VPN.  In\n   the example described above for traffic\
    \ from EVI60 on CE2 to EVI600\n   on CE3, there is no need for IP-VPN processing\
    \ on the egress PE3.\n   Traffic is forwarded either to the EVI600 context in\
    \ PE3 for further\n   MAC lookup and next-hop processing or directly to the node\
    \ behind\n   CE3, depending on the egress forwarding model being used.\n"
- title: 10.  Security Considerations
  contents:
  - "10.  Security Considerations\n   Please refer to the \"Security Considerations\"\
    \ section in [RFC7432].\n   The standards produced by the SIDR Working Group address\
    \ secure route\n   origin authentication (e.g., RFCs 6480 through 6493) and route\n\
    \   advertisement security (e.g., RFCs 8205 through 8211).  They protect\n   the\
    \ integrity and authenticity of IP address advertisements and ASN/\n   IP prefix\
    \ bindings.  This document and [RFC7432] use BGP to convey\n   other info (e.g.,\
    \ MAC addresses); thus, the protections offered by\n   the SIDR WG RFCs are not\
    \ applicable in this context.\n"
- title: 11.  IANA Considerations
  contents:
  - "11.  IANA Considerations\n   This document has no IANA actions.\n"
- title: 12.  References
  contents:
  - '12.  References

    '
- title: 12.1.  Normative References
  contents:
  - "12.1.  Normative References\n   [RFC7209]  Sajassi, A., Aggarwal, R., Uttaro,\
    \ J., Bitar, N.,\n              Henderickx, W., and A. Isaac, \"Requirements for\
    \ Ethernet\n              VPN (EVPN)\", RFC 7209, DOI 10.17487/RFC7209, May 2014,\n\
    \              <https://www.rfc-editor.org/info/rfc7209>.\n   [RFC7432]  Sajassi,\
    \ A., Ed., Aggarwal, R., Bitar, N., Isaac, A.,\n              Uttaro, J., Drake,\
    \ J., and W. Henderickx, \"BGP MPLS-Based\n              Ethernet VPN\", RFC 7432,\
    \ DOI 10.17487/RFC7432, February\n              2015, <https://www.rfc-editor.org/info/rfc7432>.\n"
- title: 12.2.  Informative References
  contents:
  - "12.2.  Informative References\n   [RFC4761]  Kompella, K., Ed. and Y. Rekhter,\
    \ Ed., \"Virtual Private\n              LAN Service (VPLS) Using BGP for Auto-Discovery\
    \ and\n              Signaling\", RFC 4761, DOI 10.17487/RFC4761, January 2007,\n\
    \              <https://www.rfc-editor.org/info/rfc4761>.\n   [RFC4762]  Lasserre,\
    \ M., Ed. and V. Kompella, Ed., \"Virtual Private\n              LAN Service (VPLS)\
    \ Using Label Distribution Protocol (LDP)\n              Signaling\", RFC 4762,\
    \ DOI 10.17487/RFC4762, January 2007,\n              <https://www.rfc-editor.org/info/rfc4762>.\n\
    \   [RFC6074]  Rosen, E., Davie, B., Radoaca, V., and W. Luo,\n              \"\
    Provisioning, Auto-Discovery, and Signaling in Layer 2\n              Virtual\
    \ Private Networks (L2VPNs)\", RFC 6074,\n              DOI 10.17487/RFC6074,\
    \ January 2011,\n              <https://www.rfc-editor.org/info/rfc6074>.\n  \
    \ [EVPN-INTERSUBNET]\n              Sajassi, A., Salam, S., Thoria, S., Drake,\
    \ J., Rabadan,\n              J., and L. Yong, \"Integrated Routing and Bridging\
    \ in\n              EVPN\", Work in Progress, draft-ietf-bess-evpn-inter-\n  \
    \            subnet-forwarding-03, February 2017.\n"
- title: Acknowledgments
  contents:
  - "Acknowledgments\n   The authors want to thank Giles Heron for his detailed review\
    \ of the\n   document.  We also thank Stefan Plug and Eric Wunan for their\n \
    \  comments.\n"
- title: Contributors
  contents:
  - "Contributors\n   The following people contributed substantially to the content\
    \ of this\n   document and should be considered coauthors:\n   Florin Balus\n\
    \   Keyur Patel\n   Aldrin Isaac\n   Truman Boyes\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Jorge Rabadan (editor)\n   Nokia\n   777 E. Middlefield\
    \ Road\n   Mountain View, CA 94043\n   United States America\n   Email: jorge.rabadan@nokia.com\n\
    \   Senad Palislamovic\n   Nokia\n   Email: senad.palislamovic@nokia.com\n   Wim\
    \ Henderickx\n   Nokia\n   Copernicuslaan 50\n   2018 Antwerp\n   Belgium\n  \
    \ Email: wim.henderickx@nokia.com\n   Ali Sajassi\n   Cisco\n   Email: sajassi@cisco.com\n\
    \   James Uttaro\n   AT&T\n   Email: uttaro@att.com\n"
