- title: __initial_text__
  contents:
  - "         Protocol Independent Multicast - Sparse Mode (PIM-SM)\n           Multicast\
    \ Routing Security Issues and Enhancements\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This memo provides information for the Internet community.\
    \  It does\n   not specify an Internet standard of any kind.  Distribution of\
    \ this\n   memo is unlimited.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (C) The Internet Society (2006).\n"
- title: Abstract
  contents:
  - "Abstract\n   This memo describes security threats for the larger (intra-domain\
    \ or\n   inter-domain) multicast routing infrastructures.  Only Protocol\n   Independent\
    \ Multicast - Sparse Mode (PIM-SM) is analyzed, in its\n   three main operational\
    \ modes: the traditional Any-Source Multicast\n   (ASM) model, the source-specific\
    \ multicast (SSM) model, and the ASM\n   model enhanced by the Embedded Rendezvous\
    \ Point (Embedded-RP)\n   group-to-RP mapping mechanism.  This memo also describes\
    \ enhancements\n   to the protocol operations that mitigate the identified threats.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1. Introduction ....................................................3\n\
    \   2. Terminology .....................................................4\n  \
    \ 3. Threats to Multicast Routing ....................................4\n    \
    \  3.1. Receiver-Based Attacks .....................................5\n      \
    \     3.1.1. Joins to Different Groups (Join Flooding) ...........5\n      3.2.\
    \ Source-Based Attacks .......................................7\n           3.2.1.\
    \ Sending Multicast to Empty Groups (Data Flooding) ...7\n           3.2.2. Disturbing\
    \ Existing Group by Sending to It\n                  (Group Integrity Violation)..........................8\n\
    \      3.3. Aggravating Factors to the Threats .........................9\n  \
    \         3.3.1. Distant RP/Source Problem ...........................9\n    \
    \       3.3.2. No Receiver Information in PIM Joins ...............10\n   4. Threat\
    \ Analysis ................................................10\n      4.1. Summary\
    \ of the Threats ....................................10\n      4.2. Enhancements\
    \ for Threat Mitigation ........................10\n   5. PIM Security Enhancements\
    \ ......................................11\n      5.1. Remote Routability Signalling\
    \ .............................11\n      5.2. Rate-Limiting Possibilities ...............................12\n\
    \      5.3. Specific Rate-limiting Suggestions ........................14\n  \
    \         5.3.1. Group Management Protocol Rate-Limiter .............14\n    \
    \       5.3.2. Source Transmission Rate-Limiter ...................14\n      \
    \     5.3.3. PIM Signalling Rate-Limiter ........................15\n        \
    \   5.3.4. Unicast-Decapsulation Rate-Limiter .................15\n          \
    \ 5.3.5. PIM Register Rate-Limiter ..........................15\n           5.3.6.\
    \ MSDP Source-Active Rate-Limiter ....................16\n      5.4. Passive Mode\
    \ for PIM ......................................16\n   6. Security Considerations\
    \ ........................................16\n   7. Acknowledgements ...............................................17\n\
    \   8. References .....................................................17\n  \
    \    8.1. Normative References ......................................17\n    \
    \  8.2. Informative References ....................................17\n   Appendix\
    \ A.  RPF Considers Interface, Not Neighbor ................19\n   Appendix B.\
    \  Return Routability Extensions ........................20\n     B.1.  Sending\
    \ PIM-Prune Messages Down the Tree ..................20\n     B.2.  Analysing\
    \ Multicast Group Traffic at DR ...................21\n     B.3.  Comparison of\
    \ the Above Approaches ........................21\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   This document describes security threats to the Protocol\
    \ Independent\n   Multicast - Sparse Mode (PIM-SM) multicast routing infrastructures\n\
    \   and suggests ways to make these architectures more resistant to the\n   described\
    \ threats.\n   Only attacks that have an effect on the multicast routing\n   infrastructures\
    \ (whether intra- or inter-domain) are considered.\n   \"On-link\" attacks where\
    \ the hosts specifically target the Designated\n   Router (DR) or other routers\
    \ on the link, or where hosts disrupt\n   other hosts on the same link, possibly\
    \ using group management\n   protocols, are discussed elsewhere (e.g., [10] and\
    \ [12]).  These\n   attacks are not discussed further in this document.\n   Similar\
    \ to unicast, the multicast payloads may need end-to-end\n   security.  Security\
    \ mechanisms to provide confidentiality,\n   authentication, and integrity are\
    \ described in other documents (e.g.,\n   [9]).  Attacks that these security mechanisms\
    \ protect against are not\n   discussed further in this document.\n   PIM builds\
    \ on a model where Reverse Path Forwarding (RPF) checking\n   is, among other\
    \ things, used to ensure loop-free properties of the\n   multicast distribution\
    \ trees.  As a side effect, this limits the\n   impact of an attacker using a\
    \ forged source address, which is often\n   used as a component in unicast-based\
    \ attacks.  However, a host can\n   still spoof an address within the same subnet,\
    \ or spoof the source of\n   a unicast-encapsulated PIM Register message, which\
    \ a host may send on\n   its own.\n   We consider PIM-SM [1] operating in the\
    \ traditional Any Source\n   Multicast (ASM) model (including the use of Multicast\
    \ Source\n   Discovery Protocol (MSDP) [2] for source discovery), in Source-\n\
    \   Specific Multicast [3] (SSM) model, and the Embedded-RP [4]\n   group-to-RP\
    \ mapping mechanism in ASM model.  Bidirectional-PIM [15]\n   is typically deployed\
    \ only in intra-domain and is similar to ASM but\n   without register messages.\
    \  Bidirectional-PIM is not finished as of\n   this writing, and its considerations\
    \ are not discussed further in\n   this document.\n"
- title: 2.  Terminology
  contents:
  - "2.  Terminology\n   ASM\n      \"ASM\" [6] is used to refer to the traditional\
    \ Any Source Multicast\n      model with multiple PIM domains and a signalling\
    \ mechanism (MSDP)\n      to exchange information about active sources between\
    \ them.\n   SSM\n      \"SSM\" [7] is used to refer to Source-Specific Multicast.\n\
    \   SSM channel\n      SSM channel (S, G) identifies the multicast delivery tree\n\
    \      associated with a source address S and a SSM destination address\n    \
    \  G.\n   Embedded-RP\n      \"Embedded-RP\" refers to the ASM model where the\
    \ Embedded-RP\n      mapping mechanism is used to find the Rendezvous Point (RP)\
    \ for a\n      group, and MSDP is not used.\n   Target Router\n      \"Target\
    \ Router\" is used to refer to either the RP processing a\n      packet (ASM or\
    \ Embedded-RP) or the DR that is receiving (Source,\n      Group) (or (S,G)) joins\
    \ (in all models).\n"
- title: 3.  Threats to Multicast Routing
  contents:
  - "3.  Threats to Multicast Routing\n   We make the broad assumption that the multicast\
    \ routing networks are\n   reasonably trusted.  That is, we assume that the multicast\
    \ routers\n   themselves are well-behaved, in the same sense that unicast routers\n\
    \   are expected to behave well.  While this assumption is not entirely\n   correct,\
    \ it simplifies the analysis of threat models.  The threats\n   caused by misbehaving\
    \ multicast routers (including fake multicast\n   routers) are not considered\
    \ in this memo; the generic threat model\n   would be similar to [5].  RP discovery\
    \ mechanisms like Bootstrap\n   Router (BSR) and Auto-RP are also considered out\
    \ of scope.\n   As the threats described in this memo are mainly Denial-of-Service\n\
    \   (DoS) attacks, it may be useful to note that the attackers will try\n   to\
    \ find a scarce resource anywhere in the control or data plane, as\n   described\
    \ in [5].\n   There are multiple threats relating to the use of host-to-router\n\
    \   signalling protocols -- such as Internet Group Management Protocol\n   (IGMP)\
    \ or Multicast Listener Discovery (MLD) -- but these are outside\n   the scope\
    \ of this memo.\n   PIM-SM can be abused in the cases where RPF checks are not\
    \ applicable\n   (in particular, in the stub LAN networks), as spoofing the on-link\n\
    \   traffic is very simple.  For example, a host could get elected to\n   become\
    \ DR for the subnet, but not perform any of its functions.  A\n   host can also\
    \ easily make PIM routers on the link stop forwarding\n   multicast by sending\
    \ PIM Assert messages.  This implies that a\n   willful attacker will be able\
    \ to circumvent many of the potential\n   rate-limiting functions performed at\
    \ the DR (as one can always send\n   the messages himself).  The PIM-SM specification,\
    \ however, states\n   that these messages should only be accepted from known PIM\
    \ neighbors;\n   if this is performed, the hosts would first have to establish\
    \ a PIM\n   adjacency with the router.  Typically, adjacencies are formed with\n\
    \   anyone on the link, so a willful attacker would have a high\n   probability\
    \ of success in forming a protocol adjacency.  These are\n   described at some\
    \ length in [1], but are also considered out of the\n   scope of this memo.\n"
- title: 3.1.  Receiver-Based Attacks
  contents:
  - "3.1.  Receiver-Based Attacks\n   These attacks are often referred to as control\
    \ plane attacks, and the\n   aim of the attacker is usually to increase the amount\
    \ of multicast\n   state information in routers above a manageable level.\n"
- title: 3.1.1.  Joins to Different Groups (Join Flooding)
  contents:
  - "3.1.1.  Joins to Different Groups (Join Flooding)\n   Join flooding occurs when\
    \ a host tries to join, once or a couple of\n   times, to a group or an SSM channel,\
    \ and the DR generates a PIM Join\n   to the Target Router.  The group/SSM channel\
    \ or the Target Router may\n   or may not exist.\n   An example of this is a host\
    \ trying to join different, non-existent\n   groups at a very rapid pace, trying\
    \ to overload the routers on the\n   path with an excessive amount of (*/S,G)\
    \ state (also referred to as\n   \"PIM State\"), or the Target Router with an\
    \ excessive number of\n   packets.\n   Note that even if a host joins to a group\
    \ multiple times, the DR only\n   sends one PIM Join message, without waiting\
    \ for any acknowledgement;\n   the next message is only sent after the PIM Join\
    \ timer expires or the\n   state changes at the DR.\n   This kind of joining causes\
    \ PIM state to be created, but this state\n   is relatively short-lived (260 seconds\
    \ by default, which is the\n   default time that the state is active at DR in\
    \ the absence of IGMP/\n   MLD Reports/Leaves).  Note that the host can join a\
    \ number of\n   different ASM groups or SSM channels with only one IGMPv3 [11]\
    \ or\n   MLDv2 [12] Report as the protocol allows multiple sources to be\n   included\
    \ in the same message, resulting in multiple PIM Joins from\n   one IGMPv3/MLDv2\
    \ message.\n   However, even short-lived state may be harmful when the intent\
    \ is to\n   cause as much state as possible.  The host can continue to send\n\
    \   IGMP/MLD Reports to these groups to make the state attack more\n   long-lived.\
    \  This results in:\n   o  ASM: An (*,G) join is sent to an intra-domain RP, causing\
    \ state on\n      that path; in turn, that RP joins to the DR of the source if\
    \ the\n      source is active.  If the source address was specified by the host\n\
    \      in the IGMPv3/MLDv2 Report, a (S,G) Join is sent directly to the\n    \
    \  DR of the source, as with SSM, below.\n   o  SSM: An (S,G) join is sent inter-domain\
    \ to the DR of the source S,\n      causing state on that path.  If the source\
    \ S does not exist, the\n      join goes to the closest router using longest prefix\
    \ matching on\n      the path to S as possible.\n   o  Embedded-RP: An (*,G) join\
    \ is sent towards an inter/intra-domain\n      RP embedded in the group G, causing\
    \ state on that path.  If the RP\n      does not exist, the join goes to the router\
    \ that is closest to the\n      RP address.  Similarly, an explicit (S,G) join\
    \ goes to the DR, as\n      with SSM above.\n   That is, SSM and Embedded-RP always\
    \ enable \"inter-domain\" state\n   creation.  ASM defaults to intra-domain, but\
    \ can be used for inter-\n   domain state creation as well.\n   If the source\
    \ or RP (only in case of Embedded-RP) does not exist, the\n   multicast routing\
    \ protocol does not have any means to remove the\n   distribution tree if the\
    \ joining host remains active.  The worst case\n   attack could be a host remaining\
    \ active to many different groups\n   (containing either imaginary source or RP).\
    \  Please note that the\n   imaginary RP problem is related to only Embedded-RP,\
    \ where the RP\n   address is extracted from the group address, G.\n   For example,\
    \ if the host is able to generate 100 IGMPv3 (S,G) joins a\n   second, each carrying\
    \ 10 sources, the amount of state after 260\n   seconds would be 260 000 state\
    \ entries -- and 100 packets per second\n   is still a rather easily achievable\
    \ number.\n"
- title: 3.2.  Source-Based Attacks
  contents:
  - "3.2.  Source-Based Attacks\n   These attacks are often referred to as \"data\
    \ plane\" attacks; however,\n   with traditional ASM and MSDP, these also include\
    \ an MSDP control\n   plane threat.\n"
- title: 3.2.1.  Sending Multicast to Empty Groups (Data Flooding)
  contents:
  - "3.2.1.  Sending Multicast to Empty Groups (Data Flooding)\n   Data flooding occurs\
    \ when a host sends data packets to a multicast\n   group or SSM channel for which\
    \ there are no real subscribers.\n   Note that since register encapsulation is\
    \ not subject to RPF checks,\n   the hosts can also craft and send these packets\
    \ themselves, also\n   spoofing the source address of the register messages unless\
    \ ingress\n   filtering [13] has been deployed [14].  That is, as the initial\
    \ data\n   registering is not subject to the same RPF checks as many other\n \
    \  multicast routing procedures, making control decisions based on that\n   data\
    \ leads to many potential threats.\n   Examples of this threat are a virus/worm\
    \ trying to propagate to\n   multicast addresses, an attacker trying to crash\
    \ routers with\n   excessive MSDP state, or an attacker wishing to overload the\
    \ RP with\n   encapsulated packets of different groups.  This results in:\n  \
    \ o  ASM: The DR register-encapsulates the packets in Register messages\n    \
    \  to the intra-domain RP, which may join to the source and issue a\n      Register-Stop,\
    \ but which continues to get the data.  A\n      notification about the active\
    \ source is sent (unless the group or\n      source is configured to be local)\
    \ inter-domain with MSDP and\n      propagated globally.\n   o  SSM: The DR receives\
    \ the data, but the data does not propagate\n      from the DR unless someone\
    \ joins the (S,G) channel.\n   o  Embedded-RP: The DR register-encapsulates the\
    \ packets to the\n      intra/inter-domain RP, which may join to the source and\
    \ issue a\n      Register-Stop.  Data continues to be encapsulated if different\n\
    \      groups are used.\n   This yields many potential attacks, especially if\
    \ at least parts of\n   the multicast forwarding functions are implemented on\
    \ a \"slow\" path\n   or CPU in the routers:\n   o  The MSDP control plane traffic\
    \ generated can cause a significant\n      amount of control and data traffic,\
    \ which may overload the routers\n      receiving it.  A thorough analysis of\
    \ MSDP vulnerabilities can be\n      found in [16] and is only related to the\
    \ ASM.  However, this is\n      the most serious threat at the moment, because\
    \ MSDP will flood the\n      multicast group information to all multicast domains\
    \ in Internet\n      including the multicast packet encapsulated to MSDP source-active\n\
    \      message.  This creates a lot of data and state to be shared by all\n  \
    \    multicast-enabled routers, and if the source remains active, the\n      flooding\
    \ will be repeated every 60 seconds by default.\n   o  As a large amount of data\
    \ is forwarded on the multicast tree, if\n      multicast forwarding is performed\
    \ on CPU, it may be a serious\n      performance bottleneck, and a way to perform\
    \ DoS on the path.\n      Similarly, the DR must always be capable of processing\
    \ (and\n      discarding, if necessary) the multicast packets received from the\n\
    \      source.  These are potentially present in every model.\n   o  If the encapsulation\
    \ is performed on software, it may be a\n      performance bottleneck, and a way\
    \ to perform DoS on the DR.\n      Similarly, if the decapsulation is performed\
    \ on software, it may\n      be a performance bottleneck, and a way to perform\
    \ DoS on the RP.\n      Note: the decapsulator may know (based on access configuration,\
    \ a\n      rate limit, or something else) that it doesn't need to decapsulate\n\
    \      the packet, avoiding bottlenecks.  These threats are related to\n     \
    \ ASM and Embedded-RP.\n"
- title: 3.2.2.  Disturbing Existing Group by Sending to It (Group Integrity
  contents:
  - "3.2.2.  Disturbing Existing Group by Sending to It (Group Integrity\n       \
    \ Violation)\n   Group integrity violation occurs when a host sends packets to\
    \ a group\n   or SSM channel, which already exists, to disturb the users of the\n\
    \   existing group/SSM channel.\n   The SSM service model prevents injection of\
    \ packets to (S,G)\n   channels, avoiding this problem.  However, if the source\
    \ address can\n   be spoofed to be a topologically-correct address, it's possible\
    \ to\n   get the packet into the distribution tree.  Typically only hosts that\n\
    \   are on-link with the source are able to perform this, so it is not\n   really\
    \ relevant in the scope of this memo.\n   With ASM and Embedded-RP, sources can\
    \ inject forged traffic through\n   RPs, which provide the source discovery for\
    \ the group.  The RPs send\n   the traffic over the shared tree towards receivers\
    \ (routers with\n   (*,G) state).  DR then forwards the forged traffic to receivers\n\
    \   unless the legitimate recipients are able to filter out unwanted\n   sources,\
    \ e.g., using Multicast Source Filters (MSF) API [8].\n   Typically this is not\
    \ used or supported by the applications using\n   these protocols.\n   Note that\
    \ with ASM and Embedded-RP, the RP may exert some form of\n   control on who can\
    \ send to a group, as the first packets are\n   register-encapsulated in register\
    \ packets to the RP.  If the RP drops\n   the packet based on an access list,\
    \ a rate limit, or something else,\n   it doesn't get injected to an existing\
    \ group.  However, if the DR has\n   existing (*,G) state, the data will also\
    \ be forwarded on those\n   interfaces.\n   With ASM, this \"source control\"\
    \ is distributed across all the PIM\n   domains, which significantly decreases\
    \ its applicability.\n   Embedded-RP enables easier control because source discovery\
    \ is done\n   through a single RP per group.\n   As a result, in addition to possible\
    \ local disturbance, the RP\n   decapsulates the register packets and forwards\
    \ them to the receivers\n   in the multicast distribution tree, resulting in an\
    \ integrity\n   violation.\n"
- title: 3.3.  Aggravating Factors to the Threats
  contents:
  - "3.3.  Aggravating Factors to the Threats\n   This section describes a few factors\
    \ that aggravate the threats\n   described in Sections 3.1 and 3.2.  These could\
    \ also be viewed as\n   individual threats on their own.\n"
- title: 3.3.1.  Distant RP/Source Problem
  contents:
  - "3.3.1.  Distant RP/Source Problem\n   In the shared tree model, if the RP or\
    \ a source is distant\n   (topologically), then joins will travel to the distant\
    \ RP or source\n   and keep the state information in the path active, even if\
    \ the data\n   is being delivered locally.\n   Note that this problem will be\
    \ exacerbated if the RP/source space is\n   global; if a router is registering\
    \ to a RP/source that is not in the\n   local domain (say, fielded by the site's\
    \ direct provider), then the\n   routing domain is flat.\n   Also note that PIM\
    \ assumes that the addresses used in PIM messages\n   are valid.  However, there\
    \ is no way to ensure this, and using non-\n   existent S or G in (*,G) or (S,G)\
    \ messages will cause the signalling\n   to be set up, even though one cannot\
    \ reach the address.\n   This will be analyzed at more length in Section 5.1.\n"
- title: 3.3.2.  No Receiver Information in PIM Joins
  contents:
  - "3.3.2.  No Receiver Information in PIM Joins\n   Only DRs, which are directly\
    \ connected to receivers, know the exact\n   receiver information (e.g., IP address).\
    \  PIM does not forward that\n   information further in the multicast distribution\
    \ tree.  Therefore,\n   individual routers (e.g., domain edge routers) are not\
    \ able to make\n   policy decisions on who can be connected to the distribution\
    \ tree.\n"
- title: 4.  Threat Analysis
  contents:
  - '4.  Threat Analysis

    '
- title: 4.1.  Summary of the Threats
  contents:
  - "4.1.  Summary of the Threats\n   Trying to summarize the severity of the major\
    \ classes of threats with\n   respect to each multicast usage model, we have a\
    \ matrix of resistance\n   to different kinds of threats:\n                 +----------------+------------------+-----------------+\n\
    \                 | Forged Join    |   Being a Source | Group Integrity |\n  \
    \ +-------------+----------------+------------------+-----------------+\n   |\
    \ ASM         |    bad 1)      |      very bad    |   bad/mediocre  |\n   +-------------+----------------+------------------+-----------------+\n\
    \   | SSM         |    bad         |     very good    |    very good    |\n  \
    \ +-------------+----------------+------------------+-----------------+\n   |\
    \ Embedded-RP |    bad 1),2)   | good/mediocre 3) |      good       |\n   +-------------+----------------+------------------+-----------------+\n\
    \   Notes:\n   1) In ASM, the host can directly join also (S,G) groups with\n\
    \      IGMPv3/MLDv2 and thus have the same characteristics as SSM (also\n    \
    \  allows inter-domain state to be created).\n   2) allows inter-domain shared\
    \ state to be created.\n   3) Embedded-RP allows a host to determine the RP for\
    \ a given group\n      (or set of groups), which in turn allows that host to mount\
    \ a PIM\n      register attack.  In this case, the host can mount the attack\n\
    \      without implementing any of the PIM register machinery.\n"
- title: 4.2.  Enhancements for Threat Mitigation
  contents:
  - "4.2.  Enhancements for Threat Mitigation\n   There are several desirable actions\
    \ (\"requirements\") that could be\n   considered to mitigate these threats; these\
    \ are listed below.  A few\n   more concrete suggestions are presented later in\
    \ the section.\n   o  Inter-domain MSDP (ASM) should be retired to avoid attacks;\
    \ or, if\n      this is not reasonable, the DRs should rate-limit the register\n\
    \      encapsulation (note that the hosts can circumvent this).  More\n      importantly,\
    \ the RPs should rate-limit the register decapsulation\n      especially from\
    \ different sources, or MSDP must rate-limit the\n      MSDP data generation for\
    \ new sources.\n   o  DRs should rate-limit PIM Joins and Prunes somehow; there\
    \ are\n      multiple ways this should be considered (i.e., depending on which\n\
    \      variables are taken into consideration).\n   o  DRs could rate-limit register\
    \ encapsulation somehow; there are\n      multiple ways to perform this.  Note\
    \ that the hosts can avoid this\n      by performing the register encapsulation\
    \ themselves if so\n      inclined.\n   o  RPs could rate-limit register decapsulation\
    \ somehow; there are\n      multiple ways to perform this.  Note that if the source\
    \ of the\n      unicast packets is spoofed by the host, this may have an effect\
    \ on\n      how (for example) rate-limiters behave.\n   o  RPs should rate-limit\
    \ the MSDP SA messages coming from MSDP peers.\n   o  RPs could limit or even\
    \ disable the SA cache size.  However, this\n      could have negative effects\
    \ on normal operation.\n   o  RPs should provide good interfaces to reject packets\
    \ that are not\n      interesting; for example, if an Embedded-RP group is not\n\
    \      configured to be allowed in the RP, the register encapsulated\n      packets\
    \ would not even be decapsulated.\n   o  DRs could rate-limit the multicast traffic\
    \ somehow to reduce the\n      disturbing possibilities; there are multiple possibilities\
    \ how\n      exactly this should be considered.\n   o  DRs should rate-limit the\
    \ number of groups/SSM channels that can\n      be created by a given source,\
    \ S.\n"
- title: 5.  PIM Security Enhancements
  contents:
  - "5.  PIM Security Enhancements\n   This section includes more in-depth description\
    \ of the above-\n   mentioned functions for rate-limiting, etc., as well as a\
    \ description\n   of the remote routability signalling issue.\n"
- title: 5.1.  Remote Routability Signalling
  contents:
  - "5.1.  Remote Routability Signalling\n   As described in Section 3.3.1, non-existent\
    \ DRs or RPs may cause some\n   problems when setting up multicast state.  There\
    \ seem to be a couple\n   of different approaches to mitigate this, especially\
    \ if rate-limiting\n   is not extensively deployed.\n   With ASM and Embedded-RP,\
    \ Register message delivery could be ensured\n   somehow.  For example:\n    \
    \  1) At the very least, receiving an ICMP unreachable message (of\n         any\
    \ flavor) should cause the DR to stop the Register packets,\n         as the RP\
    \ will not be receiving them anyway.  (However, one\n         should note that\
    \ easy spoofing of such ICMP messages could\n         cause a DoS on legitimate\
    \ traffic.)\n      2) An additional method could be implementing a timer on the\
    \ DRs\n         so that unless nothing is heard back from the RP within a\n  \
    \       defined time period, the flow of Register messages would stop.\n     \
    \    (Currently, the RPs are not required to answer back, unless\n         they\
    \ want to join to the source.)\n      3) An extreme case would be performing some\
    \ form of return\n         routability check prior to starting the register messages:\n\
    \         first, a packet would be sent to the RP, testing its existence\n   \
    \      and willingness to serve, and also proving to the RP that the\n       \
    \  sender of the \"bubble\" and the sender of the registers are the\n        \
    \ same and the source address is not forged.  (That is, the RP\n         would\
    \ insert a cookie in the bubble, and it would have to be\n         present in\
    \ the register message.)\n   It would be desirable to have some kind of state\
    \ management for PIM\n   Joins (and other messages) as well; for example, a \"\
    Join Ack\" that\n   could be used to ensure that the path to the source/RP actually\n\
    \   exists.  However, this is very difficult, if not impossible, with the\n  \
    \ current architecture: PIM messages are sent hop-by-hop, and there is\n   not\
    \ enough information to trace back the replies, for example, to\n   notify the\
    \ routers in the middle to release the corresponding state\n   or to notify the\
    \ DR that the path did not exist.\n   Appendix B discusses this receiver-based\
    \ remote routability\n   signalling in more detail.\n"
- title: 5.2.  Rate-Limiting Possibilities
  contents:
  - "5.2.  Rate-Limiting Possibilities\n   There seem to be many ways to implement\
    \ rate-limiting (for\n   signalling, data encapsulation, and multicast traffic)\
    \ at the DRs or\n   RPs.  The best approach likely depends on the threat model;\
    \ for\n   example, factors in the evaluation may include:\n   o  Whether the host\
    \ is willfully malicious, uncontrolled (e.g.,\n      virus/worm), or a regular\
    \ user just doing something wrong.\n   o  Whether the threat is aimed towards\
    \ a single group, a single RP\n      handling the group, or the (multicast) routing\
    \ infrastructure in\n      general.\n   o  Whether the host on a subnet is spoofing\
    \ its address (but still as\n      one that fulfills the RPF checks of the DR).\n\
    \   o  Whether the host may generate the PIM join (and similar) messages\n   \
    \   itself to avoid rate-limiters at the DR, if possible.\n   o  Whether unicast\
    \ RPF checks are applied on the link (i.e., whether\n      the host can send register-encapsulated\
    \ register-messages on its\n      own).\n   o  Whether blocking the misbehaving\
    \ host on a subnet is allowed to\n      also block other, legitimate hosts on\
    \ the same subnet.\n   o  Whether these mechanisms would cause false positives\
    \ on links with\n      only properly working hosts if many of them are receivers\
    \ or\n      senders.\n   As should be obvious, there are many different scenarios\
    \ here that\n   seem to call for different kinds of solutions.\n   For example,\
    \ the rate-limiting could be performed based on:\n   1.  multicast address, or\
    \ the RP where the multicast address maps to\n   2.  source address\n   3.  the\
    \ (source address, multicast address) pair (or the RP that maps\n       to the\
    \ multicast address)\n   4.  data rate, in case of rate-limiting the source\n\
    \   5.  everything (multicast groups and sources would not be\n       distinguished\
    \ at all)\n   In the above, we assume that rate-limiting would be performed per-\n\
    \   interface (on DRs) if a more fine-grained filter is not being used.\n   It\
    \ should be noted that some of the rate-limiting functions can be\n   used as\
    \ a tool for DoS against legitimate multicast users.\n   Therefore, several parameters\
    \ for rate-limiting should be used to\n   prevent such operation.\n"
- title: 5.3.  Specific Rate-limiting Suggestions
  contents:
  - "5.3.  Specific Rate-limiting Suggestions\n   These suggestions take two forms:\
    \ limiters designed to be run on all\n   the edge networks, preventing or limiting\
    \ an attack in the first\n   place, and the limiters designed to be run at the\
    \ border of PIM\n   domains or at the RPs, which should provide protection in\
    \ case edge-\n   based limiting fails or was not implemented, or when additional\n\
    \   control is required.\n   Almost none of the suggested rate-limiters take legitimate\
    \ users into\n   account.  That is, being able to allow some hosts on a link to\n\
    \   transmit/receive, while disallowing others, is very challenging to do\n  \
    \ right, because the attackers can easily circumvent such systems.\n   Therefore,\
    \ the intent is to limit the damage to only one link, one\n   DR, or one RP --\
    \ and avoid the more global effects on the Internet\n   multicast architecture.\n\
    \   Also, it is possible to perform white-listing of groups, sources, or\n   (S,G)\
    \ pairs from the rate-limiters so that packets related to these\n   are not counted\
    \ towards the limits.  This is useful for handling an\n   aggressive but legitimate\
    \ source without modifying the limiting\n   parameters for all the traffic, for\
    \ example.\n"
- title: 5.3.1.  Group Management Protocol Rate-Limiter
  contents:
  - "5.3.1.  Group Management Protocol Rate-Limiter\n   A Group Management Protocol\
    \ rate-limiter is a token-bucket-based\n   rate-limiter to all Group Management\
    \ Protocols (IGMP, MLD) that would\n   limit the average rate of accepted groups\
    \ or sources on the specific\n   interface, with a bucket of depth of G_DEPTH,\
    \ refilling at G_RATE\n   tokens per second.  Example values could be G_RATE=1\
    \ and G_DEPTH=20.\n   Note that, e.g., an IGMPv3 join with two included sources\
    \ for one\n   group would count as two groups/sources.\n   This would be the first-order\
    \ defense against state-creation attacks\n   from the hosts.  However, as it cannot\
    \ be guaranteed that all the\n   routers would implement something like this,\
    \ other kinds of\n   protections would be useful as well.  This harms legitimate\
    \ receivers\n   on the same link as an attacker.\n"
- title: 5.3.2.  Source Transmission Rate-Limiter
  contents:
  - "5.3.2.  Source Transmission Rate-Limiter\n   A source transmission rate-limiter\
    \ is a token-bucket-based rate-\n   limiter that would limit the multicast data\
    \ transmission (excluding\n   link-local groups) on a specific interface with\
    \ a bucket of depth of\n   GSEND_DEPTH, refilling at GSEND_RATE tokens per second.\
    \  Example\n   values could be GSEND_RATE=10 and GSEND_DEPTH=20.\n   This would\
    \ be the first-order defense against data flooding attacks.\n   However, as it\
    \ cannot be guaranteed that all routers would implement\n   something like this,\
    \ and as the RP (if SSM is not used) could be\n   loaded from multiple senders,\
    \ additional protections are needed as\n   well.  This harms legitimate senders\
    \ on the same link as an attacker.\n   This does not prevent a host from sending\
    \ a lot of traffic to the\n   same group -- an action that would harm only the\
    \ DR and the RP of the\n   group, is similar to unicast DoS attacks against one\
    \ source, and is\n   not considered critical to the overall security.\n"
- title: 5.3.3.  PIM Signalling Rate-Limiter
  contents:
  - "5.3.3.  PIM Signalling Rate-Limiter\n   A PIM signalling rate-limiter is a token-bucket-based\
    \ rate-limiter\n   that would limit all multicast PIM messaging, either through\
    \ a\n   specific interface or globally on the router, with a bucket of depth\n\
    \   of PIM_DEPTH, refilling at PIM_RATE tokens per second.  Example\n   values\
    \ could be PIM_RATE=1000 and PIM_DEPTH=10000.\n   This would be second-order defense\
    \ against PIM state attacks when\n   IGMP/MLD rate-limiters haven't been implemented\
    \ or haven't been\n   effective.  This limiter might not need to be active by\
    \ default, as\n   long as the values are configurable.  The main applicability\
    \ for this\n   filter would be at a border of PIM domain in case PIM state attacks\n\
    \   are detected.  This harms legitimate receivers as well.\n"
- title: 5.3.4.  Unicast-Decapsulation Rate-Limiter
  contents:
  - "5.3.4.  Unicast-Decapsulation Rate-Limiter\n   A unicast-decapsulation rate-limiter\
    \ is a simple decapsulation rate-\n   limiter that would protect the CPU usage\
    \ in the router by limiting\n   the packets per second (depending on the router\
    \ architecture) and\n   disregarding the source of the registers.  This could\
    \ also be an\n   additional check to be used before decapsulation and checking\
    \ the\n   group to throttle the worst of the decapsulation CPU consumption.\n\
    \   This limit should have to be quite high, and would hamper the\n   existing\
    \ legitimate sessions as well.\n"
- title: 5.3.5.  PIM Register Rate-Limiter
  contents:
  - "5.3.5.  PIM Register Rate-Limiter\n   A PIM Register rate-limiter is a token-bucket-based\
    \ rate-limiter that\n   would limit register decapsulation of PIM Register messages\
    \ with a\n   bucket of depth of REG_DEPTH, refilling at REG_RATE tokens per\n\
    \   second.  If the router has restarted recently, a larger initial\n   bucket\
    \ should be used.  Example values could be REG_RATE=1 and\n   REG_DEPTH=10 (or\
    \ REG_DEPTH=500 after restart).\n   This would be second-order defense against\
    \ data flooding: if the DRs\n   would not implement appropriate limiters, or if\
    \ the total number of\n   flooded groups rises too high, the RP should be able\
    \ to limit the\n   rate with which new groups are created.  This does not harm\n\
    \   legitimate senders, as long as their groups have already been\n   created.\n"
- title: 5.3.6.  MSDP Source-Active Rate-Limiter
  contents:
  - "5.3.6.  MSDP Source-Active Rate-Limiter\n   A MSDP source-active rate-limiter\
    \ is a token-bucket-based, source-\n   based rate-limiter, that would limit new\
    \ groups per source with a\n   bucket of depth of SAG_DEPTH, refilling at SAG_RATE\
    \ tokens per\n   second.  Example values could be SAG_RATE=1 and SAG_DEPTH=10.\n\
    \   This would be second-order defense, at both the MSDP SA sending and\n   receiving\
    \ sites, against data flooding and MSDP vulnerabilities in\n   particular.  The\
    \ specific threat being addressed here is a source (or\n   multiple different\
    \ sources) trying to \"probe\" (e.g., virus or worm)\n   different multicast addresses.\
    \ [16] discusses different MSDP attack\n   prevention mechanisms at length.\n"
- title: 5.4.  Passive Mode for PIM
  contents:
  - "5.4.  Passive Mode for PIM\n   As described in the last paragraph of Section\
    \ 3, hosts are also able\n   to form PIM adjacencies and send disrupting traffic\
    \ unless great care\n   is observed at the routers.  This stems from the fact\
    \ that most\n   implementations require that stub LANs with only one PIM router\
    \ must\n   also have PIM enabled (to enable PIM processing of the sourced data,\n\
    \   etc.)  Such stub networks however do not require to actually run the\n   PIM\
    \ protocol on the link.  Therefore, such implementations should\n   provide an\
    \ option to specify that the interface is \"passive\" with\n   regard to PIM:\
    \ no PIM packets are sent or processed (if received),\n   but hosts can still\
    \ send and receive multicast on that interface.\n"
- title: 6.  Security Considerations
  contents:
  - "6.  Security Considerations\n   This memo analyzes the security of PIM routing\
    \ infrastructures in\n   some detail and proposes enhancements to mitigate the\
    \ observed\n   threats.\n   This document does not discuss adding (strong) authentication\
    \ to the\n   multicast protocols.  The PIM-SM specification [1] describes the\n\
    \   application of IPsec for routing authentication; note that being able\n  \
    \ to authenticate the register messages and to prevent illegitimate\n   users\
    \ from establishing PIM adjacencies seem to be the two most\n   important goals.\
    \  The IGMPv3 specification [11] describes the use of\n   IPsec for group management\
    \ (IPsec for MLDv2 may be applied\n   similarly), which is out of scope for this\
    \ memo.  However, note that\n   being able to control the group memberships might\
    \ reduce the\n   receiver-based attacks.\n   However, one should keep in mind\
    \ two caveats: authentication alone\n   might not be sufficient, especially if\
    \ the user or the host stack\n   (consider a worm propagation scenario) cannot\
    \ be expected to \"behave\n   well\"; and adding such authentication likely provides\
    \ new attack\n   vectors, e.g., in the form of a CPU DoS attack with an excessive\n\
    \   amount of cryptographic operations.\n"
- title: 7.  Acknowledgements
  contents:
  - "7.  Acknowledgements\n   Kamil Sarac discussed \"return routability\" issues\
    \ at length.  Stig\n   Venaas and Bharat Joshi provided feedback to improve the\
    \ document\n   quality.  Bill Fenner and Russ Housley provided useful comments\n\
    \   during the IESG evaluation.\n"
- title: 8.  References
  contents:
  - '8.  References

    '
- title: 8.1.  Normative References
  contents:
  - "8.1.  Normative References\n   [1]   Fenner, B., Handley, M., Holbrook, H., and\
    \ I. Kouvelas,\n         \"Protocol Independent Multicast - Sparse Mode (PIM-SM):\n\
    \         Protocol Specification (Revised)\", RFC 4601, August 2006.\n   [2] \
    \  Fenner, B. and D. Meyer, \"Multicast Source Discovery Protocol\n         (MSDP)\"\
    , RFC 3618, October 2003.\n   [3]   Holbrook, H. and B. Cain, \"Source-Specific\
    \ Multicast for IP\",\n         RFC 4607, August 2006.\n   [4]   Savola, P. and\
    \ B. Haberman, \"Embedding the Rendezvous Point\n         (RP) Address in an IPv6\
    \ Multicast Address\", RFC 3956,\n         November 2004.\n   [5]   Barbir, A.,\
    \ Murphy, S., and Y. Yang, \"Generic Threats to\n         Routing Protocols\"\
    , RFC 4593, July 2006.\n"
- title: 8.2.  Informative References
  contents:
  - "8.2.  Informative References\n   [6]   Deering, S., \"Host extensions for IP\
    \ multicasting\", STD 5,\n         RFC 1112, August 1989.\n   [7]   Bhattacharyya,\
    \ S., \"An Overview of Source-Specific Multicast\n         (SSM)\", RFC 3569,\
    \ July 2003.\n   [8]   Thaler, D., Fenner, B., and B. Quinn, \"Socket Interface\n\
    \         Extensions for Multicast Source Filters\", RFC 3678,\n         January\
    \ 2004.\n   [9]   Hardjono, T. and B. Weis, \"The Multicast Group Security\n \
    \        Architecture\", RFC 3740, March 2004.\n   [10]  Daley, G. and G. Kurup,\
    \ \"Trust Models and Security in Multicast\n         Listener Discovery\", Work\
    \ in Progress, July 2004.\n   [11]  Cain, B., Deering, S., Kouvelas, I., Fenner,\
    \ B., and A.\n         Thyagarajan, \"Internet Group Management Protocol, Version\
    \ 3\",\n         RFC 3376, October 2002.\n   [12]  Vida, R. and L. Costa, \"Multicast\
    \ Listener Discovery Version 2\n         (MLDv2) for IPv6\", RFC 3810, June 2004.\n\
    \   [13]  Ferguson, P. and D. Senie, \"Network Ingress Filtering:\n         Defeating\
    \ Denial of Service Attacks which employ IP Source\n         Address Spoofing\"\
    , BCP 38, RFC 2827, May 2000.\n   [14]  Baker, F. and P. Savola, \"Ingress Filtering\
    \ for Multihomed\n         Networks\", BCP 84, RFC 3704, March 2004.\n   [15]\
    \  Handley, M., \"Bi-directional Protocol Independent Multicast\n         (BIDIR-PIM)\"\
    , Work in Progress, October 2005.\n   [16]  Rajvaidya, P., Ramachandran, K., and\
    \ K. Almeroth, \"Detection\n         and Deflection of DoS Attacks Against the\
    \ Multicast Source\n         Discovery Protocol\", UCSB Technical Report, May\
    \ 2003.\n"
- title: Appendix A.  RPF Considers Interface, Not Neighbor
  contents:
  - "Appendix A.  RPF Considers Interface, Not Neighbor\n   In most current implementations,\
    \ the RPF check considers only the\n   incoming interface, and not the upstream\
    \ neighbor (RPF neighbor).\n   This can result in accepting packets from the \"\
    wrong\" RPF neighbor\n   (the neighbor is \"wrong\" since, while the RPF check\
    \ succeeds and the\n   packet is forwarded, the unicast policy would not have\
    \ forwarded the\n   packet).\n   This is a problem in the media where more than\
    \ two routers can\n   connect to, in particular, Ethernet-based Internet Exchanges.\n\
    \   Therefore, any neighbor on such a link could inject any PIM\n   signalling\
    \ as long as a route matching the address used in the\n   signalling is going\
    \ through the interface.\n   Note that for PIM signalling to be accepted, a PIM\
    \ adjacency must\n   have been established.  However, typically, this does not\
    \ help much\n   against willful attackers, as PIM adjacencies are usually formed\
    \ with\n   anyone on the link.  Still, the requirement is that the neighbor has\n\
    \   enabled PIM in the concerned interface.  That is, in most cases, the\n   threat\
    \ is limited to attackers within the operators in the exchange,\n   not third\
    \ parties.  On the other hand, data plane forwarding has no\n   such checks --\
    \ and having such checks would require that one look at\n   the link-layer addresses\
    \ used.  That is, this checking is not as\n   feasible as one might hope.\n"
- title: Appendix B.  Return Routability Extensions
  contents:
  - "Appendix B.  Return Routability Extensions\n   The multicast state information\
    \ is built from the receiver side, and\n   it can be currently pruned only by\
    \ the receiver-side DR.  If the RP\n   or the source for the group is non-existent,\
    \ the state can't be\n   pruned by the DR without return routability extensions\
    \ to provide\n   such information.  There might also be a need to remove the state\
    \ in\n   some cases when there is no multicast traffic sent to that group.\n \
    \  This section discusses the alternative ways to remove the unused\n   state\
    \ information in the routers, so that it can't be used in state-\n   based DoS\
    \ attacks.  Note that rate-limiting PIM Joins gives some\n   protection against\
    \ the state attacks.\n"
- title: B.1.  Sending PIM-Prune Messages Down the Tree
  contents:
  - "B.1.  Sending PIM-Prune Messages Down the Tree\n   When a router discovers the\
    \ non-existence of the RP or the source, it\n   can create a PIM-Prune message\
    \ and send it back to the join\n   originator.  However, since it does not know\
    \ the unicast IP address\n   of join originator DR, it cannot directly unicast\
    \ it to that router.\n   A possible alternative is to use a link-local multicast\
    \ group address\n   (e.g., all-pim routers local multicast address) to pass this\n\
    \   information back toward the joining DR.  Since the routers from this\n   current\
    \ router all the way back to the joining DR have forwarding\n   state entry for\
    \ the group, they can use this state information to see\n   how to forward the\
    \ PIM-Prune message back.\n   Each on-tree router, in addition to forwarding the\
    \ PIM-Prune message,\n   can also prune the state from its state tables.  This\
    \ way, the PIM-\n   Prune message will go back to the DR by following the multicast\n\
    \   forwarding state information created so far.  In addition, if we use\n   some\
    \ sort of RPF checks during this process, we can also make it more\n   difficult\
    \ to inject such PIM-Prune messages maliciously.\n   A potential abuse scenario\
    \ may involve an attacker that has access to\n   a router on the direct path and\
    \ can send such PIM-Prune messages down\n   the tree branch so as to prune the\
    \ branch from the tree.  But such an\n   attacker can currently achieve the same\
    \ effect by sending a PIM-Prune\n   message toward the source from the same point\
    \ on the tree.  So, the\n   proposed mechanism does not really aggravate the situation.\n\
    \   One visible overhead in this new scenario might be that someone can\n   send\
    \ bogus join messages to create redundant PIM-Join and PIM-Prune\n   messages\
    \ in the network.\n"
- title: B.2.  Analyzing Multicast Group Traffic at DR
  contents:
  - "B.2.  Analyzing Multicast Group Traffic at DR\n   Another possible way to remove\
    \ the unused state information would be\n   to analyze individual group traffic\
    \ at the DR and if there is no\n   multicast traffic for a certain group within\
    \ a certain time limit,\n   the state should be removed.  In here, if the receiver\
    \ is malicious\n   and wants to create states in the network, then it can send\
    \ joins to\n   different groups and create states on routers for each of these\n\
    \   different groups until the DR decides that the groups are inactive\n   and\
    \ initiates the prune process.  In addition, during the prune\n   process, the\
    \ routers will again process all these prune messages and\n   therefore will be\
    \ spending time.\n"
- title: B.3.  Comparison of the Above Approaches
  contents:
  - "B.3.  Comparison of the Above Approaches\n   Both of these solutions have the\
    \ same problem of renewing the\n   multicast state information.  The DR shouldn't\
    \ permanently block the\n   state building for that group, but should restrict\
    \ the PIM Joins if\n   it notices that the receiver is abusing the system.  One\
    \ additional\n   option is to block the PIM Joins to the non-existent source/RP\
    \ for a\n   certain time.\n   In the first approach (sending PIM-Prunes down the\
    \ tree), part of the\n   goal was to prune the states in the routers much sooner\
    \ than in the\n   second approach.  (That is, the goal is to make sure that the\
    \ routers\n   will not be keeping unnecessary states for long time.)\n   The second\
    \ approach works also for DoS attacks related to the\n   existing source/RP addresses,\
    \ could be more quickly implemented and\n   deployed in the network, and does\
    \ not have any relationship with the\n   other deployments (no need to change\
    \ all PIM routers).\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Pekka Savola\n   CSC/FUNET\n   Espoo\n   Finland\n   EMail:\
    \ psavola@funet.fi\n   Rami Lehtonen\n   TeliaSonera\n   Hataanpaan valtatie 20\n\
    \   Tampere 33100\n   Finland\n   EMail: rami.lehtonen@teliasonera.com\n   David\
    \ Meyer\n   EMail: dmm@1-4-5.net\n"
- title: Full Copyright Statement
  contents:
  - "Full Copyright Statement\n   Copyright (C) The Internet Society (2006).\n   This\
    \ document is subject to the rights, licenses and restrictions\n   contained in\
    \ BCP 78, and except as set forth therein, the authors\n   retain all their rights.\n\
    \   This document and the information contained herein are provided on an\n  \
    \ \"AS IS\" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS\n  \
    \ OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY AND THE INTERNET\n   ENGINEERING\
    \ TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS OR IMPLIED,\n   INCLUDING BUT NOT\
    \ LIMITED TO ANY WARRANTY THAT THE USE OF THE\n   INFORMATION HEREIN WILL NOT\
    \ INFRINGE ANY RIGHTS OR ANY IMPLIED\n   WARRANTIES OF MERCHANTABILITY OR FITNESS\
    \ FOR A PARTICULAR PURPOSE.\n"
- title: Intellectual Property
  contents:
  - "Intellectual Property\n   The IETF takes no position regarding the validity or\
    \ scope of any\n   Intellectual Property Rights or other rights that might be\
    \ claimed to\n   pertain to the implementation or use of the technology described\
    \ in\n   this document or the extent to which any license under such rights\n\
    \   might or might not be available; nor does it represent that it has\n   made\
    \ any independent effort to identify any such rights.  Information\n   on the\
    \ procedures with respect to rights in RFC documents can be\n   found in BCP 78\
    \ and BCP 79.\n   Copies of IPR disclosures made to the IETF Secretariat and any\n\
    \   assurances of licenses to be made available, or the result of an\n   attempt\
    \ made to obtain a general license or permission for the use of\n   such proprietary\
    \ rights by implementers or users of this\n   specification can be obtained from\
    \ the IETF on-line IPR repository at\n   http://www.ietf.org/ipr.\n   The IETF\
    \ invites any interested party to bring to its attention any\n   copyrights, patents\
    \ or patent applications, or other proprietary\n   rights that may cover technology\
    \ that may be required to implement\n   this standard.  Please address the information\
    \ to the IETF at\n   ietf-ipr@ietf.org.\n"
- title: Acknowledgement
  contents:
  - "Acknowledgement\n   Funding for the RFC Editor function is provided by the IETF\n\
    \   Administrative Support Activity (IASA).\n"
