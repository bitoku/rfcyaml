- title: __initial_text__
  contents:
  - ''
- title: Independent Submission                                         M. Mohali
  contents:
  - 'Independent Submission                                         M. Mohali

    '
- title: Mapping and Interworking of Diversion Information between Diversion and
  contents:
  - "Mapping and Interworking of Diversion Information between Diversion and\n  History-Info\
    \ Header Fields in the Session Initiation Protocol (SIP)\n"
- title: Abstract
  contents:
  - "Abstract\n   Although the SIP History-Info header field described in RFC 7044\
    \ is\n   the solution adopted in IETF, the non-standard Diversion header field\n\
    \   described, as Historic, in RFC 5806 is nevertheless already\n   implemented\
    \ and used for conveying call-diversion-related information\n   in Session Initiation\
    \ Protocol (SIP) signaling.\n   RFC 7044 obsoletes the original RFC 4244 and redefines\
    \ the History-\n   Info header field for capturing the history information in\
    \ requests.\n   Since the Diversion header field is used in existing network\n\
    \   implementations for the transport of call diversion information, its\n   interworking\
    \ with the SIP History-Info standardized solution is\n   needed.  This document\
    \ describes a recommended interworking guideline\n   between the Diversion header\
    \ field and the History-Info header field\n   to handle call diversion information.\
    \  This work is intended to\n   enable the migration from non-standard implementations\
    \ toward IETF\n   specification-based implementations.\n   This document obsoletes\
    \ RFC 6044, which describes the interworking\n   between the Diversion header\
    \ field defined in RFC 5806 and the\n   obsoleted History-Info header field defined\
    \ on RFC 4244.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This document is not an Internet Standards Track specification;\
    \ it is\n   published for informational purposes.\n   This is a contribution to\
    \ the RFC Series, independently of any other\n   RFC stream.  The RFC Editor has\
    \ chosen to publish this document at\n   its discretion and makes no statement\
    \ about its value for\n   implementation or deployment.  Documents approved for\
    \ publication by\n   the RFC Editor are not a candidate for any level of Internet\n\
    \   Standard; see Section 2 of RFC 5741.\n   Information about the current status\
    \ of this document, any errata,\n   and how to provide feedback on it may be obtained\
    \ at\n   http://www.rfc-editor.org/info/rfc7544.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2015 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (http://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1. Introduction ....................................................4\n\
    \      1.1. Overview ...................................................4\n  \
    \    1.2. Background .................................................4\n    \
    \  1.3. From RFC 4244 to RFC 7044 ..................................5\n   2. Problem\
    \ Statement ...............................................5\n   3. Interworking\
    \ Recommendations ....................................7\n      3.1. General Recommendations\
    \ ....................................7\n      3.2. Privacy Considerations .....................................8\n\
    \      3.3. Headers in SIP Method .....................................10\n  \
    \    3.4. SIP Network/Terminal Using Diversion Header Field\n           to SIP\
    \ Network/Terminal Using History-Info Header Field ...10\n      3.5. SIP Network/Terminal\
    \ Using History-Info Header\n           Field to SIP Network/Terminal Using Diversion\n\
    \           Header Field ..............................................12\n  \
    \ 4. Reminder of the Syntax for Header Fields .......................13\n    \
    \  4.1. History-Info Header Field Syntax ..........................13\n      4.2.\
    \ Diversion Header Field Syntax .............................16\n   5. Diversion\
    \ Header Field to History-Info Header Field ............16\n   6. History-Info\
    \ Header Field to Diversion Header Field ............20\n   7. Examples .......................................................22\n\
    \     7.1.  Example with Diversion Header Field Changed into\n           History-Info\
    \ Header Field .................................22\n     7.2.  Example with History-Info\
    \ Header Field Changed into\n           Diversion Header Field ....................................22\n\
    \     7.3.  Example with Two SIP Networks Using History-Info Header\n        \
    \   Field Interworking with a SIP Network Using Diversion\n           Header Field\
    \ ..............................................22\n     7.4.  Additional Interworking\
    \ Cases .............................24\n   8. Backward Compatibility .........................................26\n\
    \   9. Security Considerations ........................................26\n  \
    \ 10. References ....................................................26\n    \
    \  10.1. Normative References .....................................26\n      10.2.\
    \ Informative References ...................................27\n   Appendix A.\
    \  Interworking between Diversion Header Field and\n                Voicemail\
    \ URI ........................................29\n     A.1.  Diversion Header\
    \ Field to Voicemail URI ...................29\n     A.2.  Voicemail URI to Diversion\
    \ Header Field ...................29\n   Acknowledgements ..................................................30\n\
    \   Author's Address ..................................................30\n"
- title: 1.  Introduction
  contents:
  - '1.  Introduction

    '
- title: 1.1.  Overview
  contents:
  - "1.1.  Overview\n   For some services based on VoIP (Voice over IP) services (e.g.,\n\
    \   voicemail, Interactive Voice Recognition (IVR), or automatic call\n   distribution),\
    \ it is helpful for the called SIP user agent to\n   identify from whom and why\
    \ the session was diverted.  For this\n   information to be used by various service\
    \ providers or by\n   applications, it needs to pass through the network.  This\
    \ is possible\n   with two different SIP header fields: the History-Info header\
    \ field\n   defined in [RFC7044] and the historic Diversion header field defined\n\
    \   in [RFC5806].  Both of these header fields are able to transport\n   diversion\
    \ information in SIP signaling.\n   Although the Diversion header field is not\
    \ standardized, it has been\n   widely implemented.  Therefore, it is useful to\
    \ have guidelines to\n   make this header field interwork with the standard History-Info\n\
    \   header field.\n   Note that new implementation and deployment of the Diversion\
    \ header\n   field are strongly discouraged.\n   This document provides a mechanism\
    \ for the translation of header\n   field content between the Diversion header\
    \ field and the History-Info\n   header field.\n   This document obsoletes [RFC6044].\n"
- title: 1.2.  Background
  contents:
  - "1.2.  Background\n   The obsoleted History-Info header field [RFC4244] and its\
    \ extension\n   for forming SIP service URIs (including Voicemail URI) [RFC4458]\
    \ used\n   to be recommended by IETF to convey redirection information.  They\n\
    \   also used to be recommended in the Communication Diversion (CDIV)\n   3GPP\
    \ specification [TS_24.604].\n   The Diversion header field was originally described\
    \ in a document\n   that was submitted to the SIP Working Group and was eventually\n\
    \   published as an Independent Submission as [RFC5806] for the\n   historical\
    \ record; it serves as a reference for this RFC.\n   This header field contains\
    \ a list of diverting URIs and associated\n   information providing specific information\
    \ as the reason for the call\n   diversion.  Most of the first SIP-based implementations\
    \ have\n   implemented the Diversion header field when no standard solution was\n\
    \   ready to deploy.  The IETF has standardized the History-Info header\n   field\
    \ partly because it can transport general history information.\n   This allows\
    \ the receiving party to determine how and why the session\n   is received.  As\
    \ the History-Info header field may contain further\n   information than call\
    \ diversion information, it is critical to avoid\n   losing information and to\
    \ be able to extract the relevant data using\n   the retargeting cause URI parameter\
    \ described in [RFC4458] for the\n   transport of the call forwarding reason.\n\
    \   The Diversion header field and the History-Info header field have\n   different\
    \ syntaxes, which are described in this document.  Note that\n   the main difference\
    \ is that the History-Info header field is a\n   chronological writing header\
    \ whereas the Diversion header field\n   applies a reverse chronology (i.e., the\
    \ first diversion entry read\n   corresponds to the last diverting user).\n  \
    \ Appendix A provides an interworking guideline between the Diversion\n   header\
    \ field and the Voicemail URI, which is another way to convey\n   diversion information\
    \ without using the History-Info header field.\n   The Voicemail URI is defined\
    \ in [RFC4458].\n"
- title: 1.3.  From RFC 4244 to RFC 7044
  contents:
  - "1.3.  From RFC 4244 to RFC 7044\n   The details of why and how [RFC4244] was\
    \ obsoleted by [RFC7044] are\n   provided in Section 16 of [RFC7044].\n   The\
    \ main changes for implementation of the History-Info header field\n   are as\
    \ follows:\n   1.  The header field parameters \"mp\", \"rc\", and \"np\" were\
    \ added to\n       capture the specific method by which a target is determined.\n\
    \   2.  A way to indicate a gap in the History-Info header field was\n       added\
    \ by using a \"0\" in the index.\n   3.  To apply privacy, entries were anonymized\
    \ rather than removed.\n   4.  Many SHOULDs were changed into MUSTs to have a\
    \ more reliable\n       header.\n   Backward-compatibility aspects are discussed\
    \ in Section 8 of this\n   document.\n"
- title: 2.  Problem Statement
  contents:
  - "2.  Problem Statement\n   This section provides the baseline terminology used\
    \ in the rest of\n   the document and defines the scope of interworking between\
    \ the\n   Diversion header field and the History-Info header field.\n   There\
    \ are many ways in which SIP signaling can be used to modify a\n   session destination\
    \ before it is established and many reasons for\n   doing so.  The behavior of\
    \ the SIP entities that will have to further\n   process the session downstream\
    \ will sometimes vary depending on the\n   reasons that led to changing the destination,\
    \ for example, whether it\n   is for a simple proxy to route the session or for\
    \ an application\n   server (AS) to provide a supplementary service.  The Diversion\
    \ header\n   field and the History-Info header field differ in the approach and\n\
    \   scope of addressing this problem.\n   For clarity, the following vocabulary\
    \ is used in this document:\n   o  Retarget/redirect: these terms refer to the\
    \ process of a Proxy\n      Server/User Agent Client (UAC) changing a Request-URI\
    \ (Section 7.1\n      of [RFC3261]) in a request and thus changing the target\
    \ of the\n      request.  This includes changing the Request-URI due to a location\n\
    \      service lookup and redirect processing.  This also includes\n      internal\
    \ (to a proxy/SIP intermediary) changes of the URI prior to\n      forwarding\
    \ of the request.  The term \"retarget\" is defined in\n      [RFC7044].\n   o\
    \  Call forwarding/call diversion/communication diversion: these\n      terms\
    \ are equivalent and refer to the Communications Diversion\n      (CDIV) supplementary\
    \ services, based on the ISDN Communication\n      diversion supplementary services\
    \ and defined in 3GPP [TS_24.604].\n      They are applicable to entities that\
    \ are intended to modify the\n      original destination of an IP multimedia session\
    \ during or prior\n      to the session establishment.\n   This document does\
    \ not intend to describe when or how History-Info or\n   Diversion header fields\
    \ should be used.  Hereafter is provided\n   clarification on the context in which\
    \ the interworking is required.\n   The Diversion header field has exactly the\
    \ same scope as the call\n   diversion service, and each header field entry reflects\
    \ a call\n   diversion invocation.  The Diversion header field is used for\n \
    \  recording call forwarding information that could be useful to network\n   entities\
    \ downstream.  Today, this SIP header field is implemented by\n   several manufacturers\
    \ and deployed in networks.\n   The History-Info header field is used to store\
    \ all retargeting\n   information, including call diversion information.  As such,\
    \ the\n   History-Info header field [RFC7044] is used to convey call-diversion-\n\
    \   related information by using a cause URI parameter [RFC4458] in the\n   relevant\
    \ entry.\n   Note, however, that the use of cause URI parameter [RFC4458] in a\n\
    \   History-Info entry for a call diversion is specific to the 3GPP\n   specification\
    \ [TS_24.604].  [RFC4458] focuses on retargeting toward a\n   voicemail server\
    \ and does not specify whether the cause URI parameter\n   should be added in\
    \ a URI for other cases.  As a consequence,\n   implementations that do not use\
    \ the cause URI parameter for call\n   forwarding information are not considered\
    \ for the mapping described\n   in this document.  Nevertheless, some recommendations\
    \ are given in\n   the next sections on how to avoid the loss of non-mapped information\n\
    \   at the boundary between a network region using the History-Info\n   header\
    \ field and one using the Diversion header field.\n   [RFC7044] defines three\
    \ header field parameters: \"rc\", \"mp\", and\n   \"np\".  The header field parameters\
    \ \"rc\" and \"mp\" indicate the\n   mechanism by which a new target for a request\
    \ is determined.  The\n   header field \"np\" reflects that the target has not\
    \ changed.  All\n   parameters contain an index whose value refers to the hi-index\
    \ of the\n   hi-entry, which contains a hi-targeted-to-uri that represents the\n\
    \   Request-URI that was retargeted.\n   Since both header fields address call\
    \ forwarding needs, diverting\n   information could be mixed up or be inconsistent\
    \ if both are present\n   in an uncoordinated fashion in the INVITE request. \
    \ So, Diversion and\n   History-Info header fields must not independently coexist\
    \ in the same\n   session signaling.  This document addresses how to convert\n\
    \   information between the Diversion header field and the History-Info\n   header\
    \ field and when and how to preserve both header fields to cover\n   additional\
    \ cases.\n   For the transportation of consistent diversion information\n   downstream,\
    \ it is necessary to make the two header fields interwork.\n   Interworking between\
    \ the Diversion header field and the History-Info\n   header field is introduced\
    \ in Sections 5 and 6.  Since the\n   coexistence scenario may vary from one use\
    \ case to another,\n   guidelines regarding interaction of header fields are proposed\
    \ in\n   Section 3.\n"
- title: 3.  Interworking Recommendations
  contents:
  - '3.  Interworking Recommendations

    '
- title: 3.1.  General Recommendations
  contents:
  - "3.1.  General Recommendations\n   Interworking function (IWF):\n      In a normal\
    \ case, the network topology assumption is that the\n      interworking described\
    \ in this document should be performed by a\n      specific SIP border device\
    \ that is aware, by configuration, that\n      it is at the border between two\
    \ regions, one using the History-\n      Info header field and one using the Diversion\
    \ header field.\n   As the History-Info header field is a standard solution, a\
    \ network\n   using the Diversion header field must be able to provide information\n\
    \   to a network using the History-Info header field.  In this case, to\n   avoid\
    \ coexistence of header fields, it is required to replace, as\n   often as possible,\
    \ the Diversion header field with the History-Info\n   header field in the INVITE\
    \ request during the interworking.\n   Since, the History-Info header field has\
    \ a wider scope than the\n   Diversion header field, it may be used for needs\
    \ and services other\n   than call diversion.  In addition, to trace call diversion\n\
    \   information, the History-Info header field also acts as a session\n   history\
    \ and can store all successive Request-URI values.\n   Consequently, even if it\
    \ should be better to remove the History-Info\n   header field after the creation\
    \ of the Diversion header field to\n   avoid confusion, the History-Info header\
    \ field must remain unmodified\n   in the SIP signaling if it contains supplementary\
    \ (non-diversion)\n   information.  It is possible to have History-Info header\
    \ fields that\n   do not have values that can be mapped into the Diversion header\n\
    \   field.  In this case, no interworking with the Diversion header field\n  \
    \ should be performed, and it must be defined per implementation what\n   to do\
    \ in this case.  This point is out of the scope of this document.\n   In conclusion,\
    \ it is recommended to have local policies minimizing\n   the loss of information\
    \ and find the best way to keep it up to the\n   terminating user agent.\n   The\
    \ following sections describe the basic use cases.  Additional\n   interworking\
    \ cases are described in Section 7.4.\n"
- title: 3.2.  Privacy Considerations
  contents:
  - "3.2.  Privacy Considerations\n   When a SIP message is forwarded to a domain\
    \ for which the SIP\n   intermediary is not responsible, a Privacy Service at\
    \ the boundary of\n   the domain applies the appropriate privacy based on the\
    \ value of the\n   Privacy header field in the message header or in the privacy\n\
    \   parameter within the concerned header:\n   1.  For the History-Info header\
    \ field, it is the Privacy header field\n       included as the \"headers\" component\
    \ of the hi-targeted-to-uri in\n       the individual hi-entries with the priv-value\
    \ \"history\".\n   2.  For the Diversion header field, it is the diversion-privacy\n\
    \       parameter \"privacy\" in each Diversion header field.\n   For the History-Info\
    \ header field, as recommended in [RFC7044]:\n   o  If there is a Privacy header\
    \ field in the message header of a\n      request with a priv-value of \"header\"\
    \ or \"history\", then all the\n      hi-targeted-to-uris (in the hi-entries associated\
    \ with the domain\n      for which the SIP intermediary is responsible) are anonymized\
    \ by\n      the Privacy Service.  The Privacy Service must change any\n      hi-targeted-to-uri\
    \ in these hi-entries that have not been\n      anonymized to the anonymous SIP\
    \ URI \"anonymous@anonymous.invalid\"\n      as recommended in Sections 4.1.1.2\
    \ and 4.1.1.3 of [RFC3323].\n   o  If there is a Privacy header field in the \"\
    headers\" component of a\n      hi-targeted-to-uri with a priv-value of \"history\"\
    , then all the\n      concerned hi-entries must be anonymized as described above\
    \ prior\n      to forwarding.\n   The Privacy Service must remove the Privacy\
    \ header field from the\n   \"headers\" component of the hi-targeted-to-uris of\
    \ the concerned\n   hi-entries and the priv-value of \"history\" from the Privacy\
    \ header\n   field in the message header of the request prior to forwarding. \
    \ If\n   there are no remaining priv-values in the Privacy header field, the\n\
    \   Privacy Service must remove the Privacy header field from the\n   request.\n\
    \   For the Diversion header field:\n   o  If there is a Privacy header field\
    \ in the message header of a\n      request with a priv-value of \"header\", then\
    \ all the addresses in\n      the Diversion header fields (associated with the\
    \ domain for which\n      the SIP intermediary is responsible) are anonymized\
    \ by the Privacy\n      Service by changing the address to the anonymous SIP URI\n\
    \      \"anonymous@anonymous.invalid\" as recommended in Sections 4.1.1.2\n  \
    \    and 4.1.1.3 of [RFC3323] prior to forwarding.\n   o  For each Diversion header\
    \ field or each entry in the Diversion\n      header field, if there is a diversion-privacy\
    \ parameter with a\n      value set to \"full\", \"uri\", or \"name\", then the\
    \ concerned\n      Diversion header field address must be anonymized as described\n\
    \      above prior to forwarding.\n   In the concerned Diversion header field\
    \ entries, the diversion-\n   privacy parameter must be removed from the header.\n\
    \   The privacy information interworking as described in Sections 5 and 6\n  \
    \ must only be considered within a trusted domain that ensures correct\n   application\
    \ of the privacy requirements.\n"
- title: 3.3.  Headers in SIP Method
  contents:
  - "3.3.  Headers in SIP Method\n   The recommended interworking presented in this\
    \ document should apply\n   only for INVITE requests.\n   In 3xx responses:\n\
    \      Both History-Info and Diversion header fields could be present in\n   \
    \   3xx responses.\n      When a proxy wants to interwork with a network supporting\
    \ the\n      other header field, it should apply the interworking between\n  \
    \    Diversion header field and History-Info header field in the 3xx\n      response.\n\
    \      When a recursing proxy redirects an initial INVITE after receiving\n  \
    \    a 3xx response, it should add as a last entry either a Diversion\n      header\
    \ field or a History-Info header field (according to its\n      capabilities)\
    \ in the forwarded INVITE.  Local policies could apply\n      regarding whether\
    \ or not to send the received header field in the\n      next INVITE.\n   In SIP\
    \ responses other than 100:\n      All SIP responses where the History-Info header\
    \ field could be\n      present are not used for the call forwarding service and\
    \ should\n      not be changed into the Diversion header field.  The destination\n\
    \      network must be transparent to the received History-Info header\n     \
    \ field.\n   Note: The following mapping is inspired by the ISDN User Part (ISUP)\n\
    \   to SIP interworking described in [TS_29.163].\n"
- title: 3.4.  SIP Network/Terminal Using Diversion Header Field to SIP Network/
  contents:
  - "3.4.  SIP Network/Terminal Using Diversion Header Field to SIP Network/\n   \
    \   Terminal Using History-Info Header Field\n   When the Diversion header field\
    \ is used to create a History-Info\n   header field, the Diversion header field\
    \ must be removed in the\n   outgoing INVITE.  It is assumed that all the information\
    \ present in\n   the Diversion header field is transferred in the History-Info\
    \ header\n   field.\n   If a History-Info header field is also present in the\
    \ incoming INVITE\n   (in addition to the Diversion header field), the Diversion\
    \ header\n   field and History-Info header field present must be mixed, and only\n\
    \   the diversion information not yet present in the History-Info header\n   field\
    \ must be inserted as a last entry (most recent) in the existing\n   History-Info\
    \ header field, following the creation process recommended\n   in [RFC7044].\n\
    \   As an example, this could be the case of an INVITE coming from\n   network_2\
    \ using the Diversion header field but previously passed\n   through network_1\
    \ using the History-Info header field (or the\n   network_2 uses History-Info\
    \ header field to transport successive URI\n   information) and going to network_3\
    \ using the History-Info header\n   field.\n                       IWF*      \
    \                            IWF*\n     network_1          |                network_2\
    \            |network_3\n    History-Info        |                 Diversion \
    \          |using\n                        |                                 \
    \    |History-\n                        |                                    \
    \ |Info\n"
- title: UA A    P1     AS B     |       P2     AS C    UA C   AS D    |     UA E
  contents:
  - 'UA A    P1     AS B     |       P2     AS C    UA C   AS D    |     UA E

    '
- title: '|       |       |       |       |       |       |     |       |        |'
  contents:
  - '|       |       |       |       |       |       |     |       |        |

    '
- title: '|INVITE |       |       |       |       |       |     |       |        |'
  contents:
  - '|INVITE |       |       |       |       |       |     |       |        |

    '
- title: '|------>|       |       |       |       |       |     |       |        |'
  contents:
  - '|------>|       |       |       |       |       |     |       |        |

    '
- title: '|       |       |       |       |       |       |     |       |        |'
  contents:
  - '|       |       |       |       |       |       |     |       |        |

    '
- title: '|       |INVITE |       |       |       |       |     |       |        |'
  contents:
  - '|       |INVITE |       |       |       |       |     |       |        |

    '
- title: '|       |------>|       |       |       |       |     |       |        |'
  contents:
  - '|       |------>|       |       |       |       |     |       |        |

    '
- title: '|       |Supported: histinfo    |       |       |     |       |        |'
  contents:
  - '|       |Supported: histinfo    |       |       |     |       |        |

    '
- title: '|       | History-Info:         |       |       |     |       |        |'
  contents:
  - '|       | History-Info:         |       |       |     |       |        |

    '
- title: '|       | <sip:proxyP1>;index=1,|       |       |     |       |        |'
  contents:
  - '|       | <sip:proxyP1>;index=1,|       |       |     |       |        |

    '
- title: '|       | <sip:userB>;index=1.1;rc=1    |       |     |       |        |'
  contents:
  - '|       | <sip:userB>;index=1.1;rc=1    |       |     |       |        |

    '
- title: '|       |       |       |       |       |       |     |       |        |'
  contents:
  - '|       |       |       |       |       |       |     |       |        |

    '
- title: '|       |       |INVITE |       |       |       |     |       |        |'
  contents:
  - '|       |       |INVITE |       |       |       |     |       |        |

    '
- title: '|       |       |------>|       |       |       |     |       |        |'
  contents:
  - '|       |       |------>|       |       |       |     |       |        |

    '
- title: '|       |       |History-Info:  |       |       |     |       |        |'
  contents:
  - '|       |       |History-Info:  |       |       |     |       |        |

    '
- title: '|       |       |<sip:proxyP1>;index=1, |       |     |       |        |'
  contents:
  - '|       |       |<sip:proxyP1>;index=1, |       |     |       |        |

    '
- title: '|       |       |<sip:userB>;index=1.1;rc=1,    |     |       |        |'
  contents:
  - '|       |       |<sip:userB>;index=1.1;rc=1,    |     |       |        |

    '
- title: '|       |       |<sip:userC;cause=302>;index=1.1.1;mp=1.1     |        |'
  contents:
  - "|       |       |<sip:userC;cause=302>;index=1.1.1;mp=1.1     |        |\n  \
    \ In this case, the incoming INVITE contains a Diversion header field\n   and\
    \ a History-Info header field.  Therefore, as recommended in this\n   document,\
    \ it is necessary to create, for network_3, a single History-\n   Info header\
    \ field gathering existing information from both the\n   History-Info and the\
    \ Diversion header fields received.  Anyway, it is\n   required that network_2\
    \ (i.e., IWF) remove the Diversion header field\n   when the message is going\
    \ to a network not using the Diversion header\n   field.  Then, network_3 could\
    \ use call forwarding information that is\n   present in a single header field\
    \ and add its own diversion\n   information if necessary.\n   Notes:\n   1.  If\
    \ a network is not able either to use only one header field each\n       time\
    \ or to maintain both header fields up to date, the\n       chronological order\
    \ cannot be certified.\n   2.  It is not possible to have only a Diversion header\
    \ field when the\n       History-Info header field contains more than call diversion\n\
    \       information.  If previous policy recommendations are applied, the\n  \
    \     chronological order is respected as Diversion entries are\n       inserted\
    \ at the end of the History-Info header field taking into\n       account the\
    \ Diversion internal chronology.\n"
- title: 3.5.  SIP Network/Terminal Using History-Info Header Field to SIP
  contents:
  - "3.5.  SIP Network/Terminal Using History-Info Header Field to SIP\n      Network/Terminal\
    \ Using Diversion Header Field\n   When the History-Info header field is interpreted\
    \ to create a\n   Diversion header field, some precautions must be taken.\n  \
    \ If the History-Info header field contains only call forwarding\n   information,\
    \ then it must be deleted after the interworking.\n   If the History-Info header\
    \ field contains other information, then\n   only the information of concern to\
    \ the diverting user must be used to\n   create entries in the Diversion header\
    \ field, and the History-Info\n   header field must be kept as received in the\
    \ INVITE and forwarded\n   downstream.\n   Note: The History-Info header field\
    \ could be used for reasons other\n   than call diversion services, for example,\
    \ by a service that needs to\n   know if a specific AS has yet been invoked in\
    \ the signaling path.  If\n   the call is later forwarded to a network using the\
    \ History-Info\n   header field, it would be better not to lose history information\
    \ due\n   to passing though the network that only supports the Diversion header\n\
    \   field.  A recommended solution must not disrupt the standard\n   behavior,\
    \ and networks that do not implement the History-Info header\n   field must be\
    \ transparent to a received History-Info header field.\n   If a Diversion header\
    \ field is present in the incoming INVITE (in\n   addition to the History-Info\
    \ header field), only diversion\n   information present in the History-Info header\
    \ field but not in the\n   Diversion header field must be inserted from the last\
    \ entry (most\n   recent) into the existing Diversion header field as recommended\
    \ in\n   [RFC5806].\n   Note that the chronological order could not be certified.\
    \  If\n   previous policy recommendations are respected, this case should not\n\
    \   happen.\n   Forking case:\n      The History-Info header field enables the\
    \ recording of sequential\n      forking for the same served user.  During an\
    \ interworking from the\n      History-Info header field to the Diversion header\
    \ field, the\n      History-Info entries containing a forking situation (with\
    \ an\n      incremented \"index\" parameter) could possibly be mapped if they\n\
    \      contain a call forwarding \"cause\" parameter.  The interworking\n    \
    \  entity could choose to create only a Diversion entry or not apply\n      the\
    \ interworking.  The choice could be done according a local\n      policy.\n \
    \  The same logic is applied for an interworking with Voicemail URI (see\n   Appendix\
    \ A).\n"
- title: 4.  Reminder of the Syntax for Header Fields
  contents:
  - '4.  Reminder of the Syntax for Header Fields

    '
- title: 4.1.  History-Info Header Field Syntax
  contents:
  - "4.1.  History-Info Header Field Syntax\n   The ABNF syntax [RFC5234] for the\
    \ History-Info header field and\n   header field parameters is as follows.\n \
    \  History-Info       = \"History-Info\" HCOLON hi-entry *(COMMA hi-entry)\n \
    \  hi-entry           = hi-targeted-to-uri *(SEMI hi-param)\n   hi-targeted-to-uri\
    \ = name-addr\n   hi-param           = hi-index/hi-target-param/hi-extension\n\
    \   hi-index           = \"index\" EQUAL index-val\n   index-val          =  number\
    \ *(\".\" number)\n   number             =  [ %x31-39 *DIGIT ] DIGIT\n   hi-target-param\
    \    = rc-param / mp-param / np-param\n   rc-param           = \"rc\" EQUAL index-val\n\
    \   mp-param           = \"mp\" EQUAL index-val\n   np-param           = \"np\"\
    \ EQUAL index-val\n   hi-extension       = generic-param\n   The ABNF definitions\
    \ for \"generic-param\", \"name-addr\", \"HCOLON\",\n   \"COMMA\", \"SEMI\", and\
    \ \"EQUAL\" are from [RFC3261].\n   The History-Info header field is specified\
    \ in [RFC7044].  The top-\n   most History-Info entry (first in the list) corresponds\
    \ to the oldest\n   history information.\n   Cause URI parameter:\n      A hi-entry\
    \ may contain a cause URI parameter expressing the\n      diversion reason.  This\
    \ cause URI parameter is defined in\n      [RFC4458].  The ABNF grammar [RFC5234]\
    \ for the cause-param\n      parameter is shown below as it has been subject to\
    \ Erratum ID 1409\n      [Err1409] for [RFC4458].  The Status-Code is defined\
    \ in [RFC3261].\n      cause-param = \"cause=\" Status-Code\n      The cause-param\
    \ parameter is a SIP/SIPS URI parameter and should\n      be inserted in the History-Info\
    \ entry (URI) of the diverted-to\n      user in case of call diversion as recommended\
    \ in the 3GPP CDIV\n      specification [TS_24.604].  The cause values used in\
    \ the cause-\n      param for the diverting reason are listed in [RFC4458].  Because\n\
    \      it is a parameter dedicated to call forwarding service, its\n      presence\
    \ is used to determine that a hi-entry is a diverting user.\n      More precisely,\
    \ each diverting user is located in the hi-entry\n      before the one containing\
    \ a cause-param with cause value as listed\n      in [RFC4458].\n   Reason header\
    \ field:\n      The Reason header field defined in [RFC3326] should be escaped\
    \ in\n      the hi-entry of the diverting user when the call diversion is due\n\
    \      to a received SIP response.  The Reason header field contains a\n     \
    \ cause parameter set to the true SIP response code received\n      (Status-Code).\n\
    \      Therefore, in case of call diversion due to a SIP response, both\n    \
    \  cause parameters should be used.  The complexity is that these\n      parameters\
    \ could be used at the same time in the History-Info\n      header field but not\
    \ in the same hi-entry and not with the same\n      meaning.  Only the cause-param\
    \ is dedicated to call diversion\n      service.  The 'cause' Reason header field\
    \ parameter is not taken\n      into account in the mapping with a Diversion header\
    \ field.\n   Target URI parameter:\n      [RFC4458] also defines the 'target'\
    \ URI parameter, which could be\n      inserted in a Request-URI and consequently\
    \ in the\n      hi-targeted-to-uri.  This parameter is used to keep the diverting\n\
    \      user address in the downstream INVITE request in Voicemail URI\n      implementation.\
    \  As this information is already present in the hi-\n      entries, the 'target'\
    \ URI parameter is not taken into account\n      regarding the interworking with\
    \ the Diversion header field.  From\n      the Diversion header field, it could\
    \ be possible to create the\n      'target' URI parameter in the hi-entries and/or\
    \ in the Request-\n      URI, but this possibility is based on local policies\
    \ not described\n      in this document.\n   Privacy header field:\n      A Privacy\
    \ header field as defined in [RFC3323] could also be\n      embedded in hi-entries\
    \ with the 'history' value defined in\n      [RFC7044].\n   Index header field\
    \ parameter:\n      The index parameter is a string of digits, separated by dots,\
    \ to\n      indicate the number of forward hops and retargets.\n   Note: A history\
    \ entry could contain the \"gr\" parameter.  Regardless\n   of the rules concerning\
    \ the \"gr\" parameter defined in [TS_24.604],\n   which must be applied, this\
    \ parameter has no impact on the mapping\n   and must only be copied with the\
    \ served user address.\n   Missing entry:\n      If the request clearly has a\
    \ gap in the hi-entry (i.e., the last\n      hi-entry and Request-URI differ),\
    \ the entity adding a hi-entry\n      must add a single index with a value of\
    \ \"0\" (i.e., the non-\n      negative integer zero) prior to adding the appropriate\
    \ index for\n      the action to be taken (e.g., Index=1.1.2.0.1).  Prior to any\n\
    \      application usage of the History-Info header field parameters, the\n  \
    \    SIP entity that processes the hi-entries must evaluate the\n      hi-entries\
    \ and determine if there are any gaps in them.\n   \"histinfo\" option tag:\n\
    \      According to [RFC7044], a proxy that receives a Request with the\n    \
    \  \"histinfo\" option tag in the Supported header field should return\n     \
    \ captured History-Info in subsequent, provisional, and final\n      responses\
    \ to the Request.  The behavior depends upon whether or\n      not the local policy\
    \ supports the capture of History-Info.\n   Example:\n   History-Info:\n   <sip:diverting_user1_addr?Privacy=none&Reason=SIP%3Bcause%3D302>;\n\
    \   index=1,\n   <sip:diverting_user2_addr;cause=480?Privacy=history>;index=1.1;mp=1,\n\
    \   <sip:last_diversion_target;cause=486>;index=1.1.1;mp=1.1\n"
- title: 4.2.  Diversion Header Field Syntax
  contents:
  - "4.2.  Diversion Header Field Syntax\n   The following text is restating the exact\
    \ syntax that the production\n   rules in [RFC5806] define, but using ABNF [RFC5234]:\n\
    \    Diversion           = \"Diversion\" HCOLON diversion-params\n           \
    \                          *(COMMA diversion-params)\n    diversion-params   \
    \ = name-addr *(SEMI (diversion-reason /\n                          diversion-counter\
    \ / diversion-limit /\n                          diversion-privacy / diversion-screen\
    \ /\n                          diversion-extension))\n    diversion-reason   \
    \ = \"reason\" EQUAL (\"unknown\" / \"user-busy\" /\n                        \
    \  \"no-answer\" / \"unavailable\" / \"unconditional\"\n                     \
    \     / \"time-of-day\" / \"do-not-disturb\" /\n                          \"deflection\"\
    \ / \"follow-me\" / \"out-of-service\"\n                          / \"away\" /\
    \ token / quoted-string)\n    diversion-counter   = \"counter\" EQUAL 1*2DIGIT\n\
    \    diversion-limit     = \"limit\" EQUAL 1*2DIGIT\n    diversion-privacy   =\
    \ \"privacy\" EQUAL (\"full\" / \"name\" / \"uri\" /\n                       \
    \   \"off\" / token / quoted-string)\n    diversion-screen    = \"screen\" EQUAL\
    \ (\"yes\" / \"no\" / token /\n                          quoted-string)\n    diversion-extension\
    \ = token [EQUAL (token / quoted-string)]\n   Note: The Diversion header field\
    \ could be used in the comma-separated\n   format as described below and in a\
    \ header-separated format.  Both\n   formats could be combined in a received INVITE\
    \ as recommended in\n   [RFC3261].\n   Example:\n   Diversion:\n   <sip:diverting_user2_addr>;reason=user-busy;counter=1;privacy=full,\n\
    \   <sip:diverting_user1_addr>;reason=unconditional;counter=1;privacy=off\n"
- title: 5.  Diversion Header Field to History-Info Header Field
  contents:
  - "5.  Diversion Header Field to History-Info Header Field\n   The following text\
    \ is valid only if no History-Info header field is\n   present in the INVITE request.\
    \  If at least one History-Info header\n   field is present, the interworking\
    \ function must adapt its behavior\n   to respect the chronological order.  For\
    \ more information, see\n   Section 3.\n   Concerning the privacy information\
    \ in the Diversion header field, the\n   following mapping only applies within\
    \ a trusted domain; for other\n   domains, see the privacy considerations in Section\
    \ 3.2.\n   For N Diversion entries, N+1 History-Info entries must be created.\n\
    \   To create the History-Info entries in the same order as during a\n   session\
    \ establishment, the Diversion entries must be mapped from the\n   bottom-most\
    \ to the top-most.  Each Diversion entry shall be mapped\n   into a History-Info\
    \ entry.  An additional History-Info entry (the\n   last one) must be created\
    \ with the diverted-to party address present\n   in the Request-URI of the received\
    \ INVITE.  The mapping is described\n   in the table below.\n   The first entry\
    \ created in the History-Info header field contains:\n   o  a hi-targeted-to-uri\
    \ with the name-addr parameter of the bottom-\n      most Diversion header field.\n\
    \   o  if a privacy parameter is present in the bottom-most Diversion\n      entry,\
    \ then a Privacy header field must be escaped in the History-\n      Info header\
    \ field as described in the table below.\n   o  a hi-index set to 1.\n   For each\
    \ of the following Diversion entries (from bottom to top), the\n   History-Info\
    \ entries are created as follows (from top to bottom):\n Source              \
    \                     Destination\n Diversion header component:              History-Info\
    \ header component:\n =======================================================================\n\
    \ name-addr                                hi-targeted-to-uri\n =======================================================================\n\
    \ reason of the previous                   cause URI parameter\n Diversion entry\
    \                          A cause-param \"cause\" is\n                      \
    \                    added in each hi-entry\n                                \
    \          (except the first one)\n \"unknown\"----------------------------------404\
    \ (default 'cause' value)\n \"unconditional\"----------------------------302\n\
    \ \"user-busy\"--------------------------------486\n \"no-answer\"--------------------------------408\n\
    \ \"deflection \"------------------------------480 or 487\n \"unavailable\"------------------------------503\n\
    \ \"time-of-day\"------------------------------404 (default)\n \"do-not-disturb\"\
    ---------------------------404 (default)\n \"follow-me\"--------------------------------404\
    \ (default)\n \"out-of-service\"---------------------------404 (default)\n \"\
    away\"-------------------------------------404 (default)\n ======================================================================\n\
    \ counter                                  hi-index\n \"1\" or parameter ------------------------The\
    \ previous created index\n not present                              is extended\
    \ with \".1\"\n Superior to \"1\" -------------------------Create N-1 placeholder\
    \ History\n (i.e., N)                                entry with the previous index\n\
    \                                          extended with \".1\"\n            \
    \                              Then the History-Info header\n                \
    \                          created with the Diversion\n                      \
    \                    entry with the previous index\n                         \
    \                 extended with \".1\"\n ======================================================================\n\
    \ privacy                                  Privacy header escaped in the\n   \
    \                                       hi-targeted-to-uri\n \"full\"-----------------------------------\"\
    history\"\n \"Off\"------------------------------------Privacy header field\n\
    \                                          absent or \"none\"\n \"name\"-----------------------------------\"\
    history\"\n \"uri\"------------------------------------\"history\"\n ======================================================================\n\
    \                                          hi-target-param\n                 \
    \                         An mp-param \"mp\" is added in\n                   \
    \                       each created hi-entry\n                              \
    \            (except the first one)\n                                        \
    \  The \"mp\" parameter is set to\n                                          the\
    \ index value of the\n                                          preceding hi-entry.\n\
    \ =======================================================================\n  \
    \ A last History-Info entry is created and contains:\n   o  a hi-targeted-to-uri\
    \ with the Request-URI of the INVITE request.\n   o  a cause-param from the top-most\
    \ Diversion entry, mapped from the\n      diversion-reason as described above.\n\
    \   o  an index set to the previous created index extended with a new\n      level\
    \ \".1\" added at the end.\n   o  a hi-target-param set to \"mp\" equals to the\
    \ index value of the\n      previous hi-entry.\n   Notes:\n   1.  For other optional\
    \ Diversion parameters, there is no\n       recommendation as the History-Info\
    \ header field does not provide\n       equivalent parameters.\n   2.  For values\
    \ of the diversion-reason that are mapped with a\n       recommended default value,\
    \ it could also be possible to choose\n       another value.  The cause-param\
    \ URI parameter offers fewer\n       possible values than the diversion-reason\
    \ parameter.  However, it\n       has been considered that the cause-param values\
    \ list was\n       sufficient to implement CDIV service as defined in 3GPP\n \
    \      [TS_24.604] as it covers a large portion of cases.\n   3.  The Diversion\
    \ header field can contain a \"tel\" URI as defined in\n       [RFC3966] in the\
    \ name-addr parameter.  The History-Info header\n       field can also contain\
    \ an address that is a \"tel\" URI, but if\n       this hi-entry has to be completed\
    \ with either a SIP header field\n       (e.g., Reason or Privacy) or a SIP URI\
    \ parameter (e.g., 'cause'\n       or 'target'), the \"tel\" URI must be converted\
    \ into a SIP URI.\n       [RFC3261] gives an indication as to the mapping between\
    \ sip: and\n       tel: URIs, but in this particular case, it is difficult to\
    \ assign\n       a valid hostport as the diversion occurred in a previous network\n\
    \       and a valid hostport is difficult to determine.  So, it is\n       suggested\
    \ that in case of \"tel\" URI in the Diversion header\n       field, the History-Info\
    \ header field should be created with a SIP\n       URI with user=phone and a\
    \ domain set to \"unknown.invalid\".\n   4.  The Diversion header field allows\
    \ carrying of a counter that\n       retains the information about the number\
    \ of successive\n       redirections.  History-Info does not have an equivalent\
    \ because\n       to trace and count the number of diversions, it is necessary\
    \ to\n       count the cause parameter containing a value associated to a call\n\
    \       diversion listed in [RFC4458].  Reading the index value is not\n     \
    \  enough.  With the use of the \"placeholder\" entry the History-Info\n     \
    \  header field, entries can reflect the real number of diversions\n       that\
    \ occurred, thanks to the cause-param.\n   Example of placeholder entry in the\
    \ History-Info header field:\n      <sip:unknown@unknown.invalid;cause=xxx>;index=1.1\n\
    \      <sip:bob_addr;cause=404>;index=1.1.1;mp=1.1\n   \"cause=xxx\" reflects\
    \ the diverting reason of a previous diverting\n   user.  For a placeholder hi-entry,\
    \ the value \"404\" must be taken for\n   the cause-param and so, located in the\
    \ next hi-entry.\n   For recommendations for local policies regarding the coexistence\
    \ of\n   header fields in the INVITE request, see Sections 3 and 7.4.\n"
- title: 6.  History-Info Header Field to Diversion Header Field
  contents:
  - "6.  History-Info Header Field to Diversion Header Field\n   Concerning the privacy\
    \ information for the History-Info header field,\n   the following mapping only\
    \ applies within a trusted domain; for other\n   domains, see the privacy considerations\
    \ in Section 3.2.\n   To create the Diversion entries in the same order as during\
    \ a session\n   establishment, the History-Info entries must be mapped from the\
    \ top-\n   most to the bottom-most.  The first History-Info header field entry\n\
    \   selected will be mapped into the last Diversion header field entry\n   and\
    \ so on.  One Diversion header field entry must be created for each\n   History-Info\
    \ entry that has cause-param with a value listed in\n   [RFC4458].\n   Diversion\
    \ information:\n   The definitions of \"Target_entry\" and \"Diverting_entry\"\
    \ are included\n   below to help readers understand the mapping of the History-Info\n\
    \   header field.\n   The diversion information can be identified by finding the\
    \ following\n   hi-entries:\n   o  Target_entry: hi-entries containing a cause-param\
    \ URI parameter\n      with a value listed in [RFC4458] will contain the diversion\
    \ reason\n      and the address of the target of the concerned call forwarding.\n\
    \      Per [RFC7044], these hi-entries may also contain a hi-target-param\n  \
    \    set to \"mp\".\n   o  Diverting_entry: For each previously identified hi-entry:\n\
    \      *  If there is an \"mp\" header field parameter, the hi-entry whose\n \
    \        hi-index matches the value of the hi-target-param \"mp\" will\n     \
    \    contain the diverting party address, its possible privacy, and/\n       \
    \  or SIP reason when the retargeting has been caused by a\n         received\
    \ SIP response.\n      *  If there is no \"mp\" header field parameter, the information\
    \ of\n         the diverting party address, privacy and/or SIP reason will be\n\
    \         found in the hi-entry that precede this identified hi-entry.\n   Note:\
    \ Per [RFC7044], all retargeting entries must point to a hi-entry\n   that contains\
    \ an \"mp\" parameter, but for backward-compatibility\n   reasons, it may be absent\
    \ from some of the received hi-entries.  See\n   Section 8 for more information\
    \ on backward compatibility.\n   The History-Info header field must be mapped\
    \ into the Diversion\n   header field as follows:\n   Source                 \
    \                   Destination\n   History-Info header component:           \
    \ Diversion header component:\n   =====================================================================\n\
    \   hi-targeted-to-uri                        name-addr\n   of the Diverting_entry.\n\
    \   =====================================================================\n  \
    \ cause-param                               reason\n   of the Target_entry\n \
    \  404---------------------------------------\"unknown\" (default value)\n   302---------------------------------------\"\
    unconditional\"\n   486---------------------------------------\"user-busy\"\n\
    \   408---------------------------------------\"no-answer\"\n   480 or 487--------------------------------\"\
    deflection \"\n   503---------------------------------------\"unavailable\"\n\
    \   =====================================================================\n  \
    \ hi-index                                  counter\n   Mandatory parameter for-------------------The\
    \ counter is set to \"1\".\n   History-Info reflecting\n   the chronological order\n\
    \   of the information.\n   =====================================================================\n\
    \   Privacy header field escaped              privacy\n   in the hi-targeted-to-uri\n\
    \   of the Diverting_entry\n   \"history\"----------------------------------\"\
    full\"\n   Privacy header field ----------------------\"Off\"\n   Absent or \"\
    none\"\n   =====================================================================\n\
    \   Note: For other optional History-Info parameters, there is no\n   recommendation\
    \ as the Diversion header field does not provide\n   equivalent parameters.\n\
    \   For recommendations for local policies regarding the coexistence of\n   header\
    \ fields in the INVITE request, see Section 3.\n"
- title: 7.  Examples
  contents:
  - '7.  Examples

    '
- title: 7.1.  Example with Diversion Header Field Changed into History-Info
  contents:
  - "7.1.  Example with Diversion Header Field Changed into History-Info\n      Header\
    \ Field\n   INVITE sip:last_diverting_target\n   Diversion:\n   <sip:diverting_user3_address>;reason=unconditional;counter=1;\n\
    \   privacy=off,\n   <sip:diverting_user2_address>;reason=user-busy;counter=1;\n\
    \   privacy=full,\n   <sip:diverting_user1_address>;reason=no-answer;counter=1;\n\
    \   privacy=off\n   Mapped into:\n   History-Info:\n   <sip:diverting_user1_address?Privacy=none>;index=1,\n\
    \   <sip:diverting_user2_address;\n   cause=408?Privacy=history>;index=1.1;mp=1,\n\
    \   <sip:diverting_user3_address;\n   cause=486?Privacy=none>;index=1.1.1;mp=1.1,\n\
    \   <sip:last_diverting_target;cause=302>;index=1.1.1.1;mp=1.1.1\n"
- title: 7.2.  Example with History-Info Header Field Changed into Diversion
  contents:
  - "7.2.  Example with History-Info Header Field Changed into Diversion\n      Header\
    \ Field\n   INVITE sip:last_diverting_target; cause=486\n   History-Info:\n  \
    \ <sip:diverting_user1_address?Privacy=history>;index=1,\n   <sip:diverting_user2_address;cause=302?Privacy=none>;index=1.1;mp=1,\n\
    \   <sip:last_diverting_target;cause=486>;index=1.1.1;mp=1.1\n   Mapped into:\n\
    \   Diversion:\n   <sip:diverting_user2_address>;reason=user-busy;counter=1;privacy=off,\n\
    \   <sip:diverting_user1_address>;reason=unconditional;counter=1;privacy=\n  \
    \ full\n"
- title: 7.3.  Example with Two SIP Networks Using History-Info Header Field
  contents:
  - "7.3.  Example with Two SIP Networks Using History-Info Header Field\n      Interworking\
    \ with a SIP Network Using Diversion Header Field\n   A -> P1 -> B -> C -> P2\
    \ -> D-> E\n   A, B, C, D and E are users.\n   B, C and D have call forwarding\
    \ service invoked.\n   P1 and P2 are proxies.\n   Only relevant information is\
    \ shown on the following call flow.\n                          IWF*          \
    \                      IWF*\n     SIP network using     |           SIP network\
    \ using       |SIP net.\n       History-Info        |                Diversion\
    \          |using\n                           |                              \
    \  History-Info\n                           |                                \
    \   |\n   UA A    P1     AS B     |      P2     AS C    UA C   AS D   |    UA\
    \ E\n   |       |       |       |      |       |       |     |      |       |\n\
    \   |INV B  |       |       |      |       |       |     |      |       |\n  \
    \ |------>|       |       |      |       |       |     |      |       |\n   |\
    \       |       |       |      |       |       |     |      |       |\n   |  \
    \     |INV B  |       |      |       |       |     |      |       |\n   |    \
    \   |------>|       |      |       |       |     |      |       |\n   |      \
    \ |Supported: histinfo   |       |       |     |      |       |\n   |       |\
    \ History-Info:        |       |       |     |      |       |\n   |       | <sip:proxyP1>;index=1,\
    \       |       |     |      |       |\n   |       | <sip:userB>;index=1.1;rc=1\
    \   |       |     |      |       |\n   |       |       |       |      |      \
    \ |       |     |      |       |\n   |       |       |INV C  |      |       |\
    \       |     |      |       |\n   |       |       |------>|      |       |  \
    \     |     |      |       |\n   |       |       |History-Info: |       |    \
    \   |     |      |       |\n   |       |       <sip:proxyP1>;index=1, |      \
    \ |     |      |       |\n   |       |       <sip:userB>;index=1.1;rc=1,    |\
    \     |      |       |\n   |       |       <sip:proxyP2;cause=302>;index=1.1.1;mp=1.1\
    \  |       |\n   |       |       |       |      |       |       |     |      |\
    \       |\n   |       |       |       |INV C |       |       |     |      |  \
    \     |\n   |       |       |       |----->|       |       |     |      |    \
    \   |\n   |       |       | Diversion:   |       |       |     |      |      \
    \ |\n   |       |     <sip:userB>;reason=unconditional;counter=1;privacy=off|\n\
    \   |       |       |       |History-Info: |       |     |      |       |\n  \
    \ |       |       |       <sip:proxyP1>;index=1, |     |      |       |\n   |\
    \       |       |       <sip:userB>;index=1.1;rc=1,  |      |       |\n   |  \
    \     |       |       <sip:proxyP2;cause=302>;index=1.1.1;mp=1.1  |\n   |    \
    \   |       |       |      |       |       |     |      |       |\n   |      \
    \ |       |       |      |INV C  |       |     |      |       |\n   |       |\
    \       |       |      |------>|       |     |      |       |\n   |       |  \
    \     |       |     No modification of Diversion header   |\n   |       |    \
    \   |       |      |       |       |     |      |       |\n   |       |      \
    \ |       |      |       |INV C  |     |      |       |\n   |       |       |\
    \       |      |       |------>|     |      |       |\n   |       |       |  \
    \     |      |       |       |     |      |       |\n   |       |       |    \
    \   |      |       |<--180-|     |      |       |\n   |       |       |      \
    \ |      |       |       |     |      |       |\n   |       |       |       |\
    \      |  No response timer expires |       |\n   |       |       |       |  \
    \    |       |---INV D --->|      |       |\n   |       |       |Diversion:  \
    \                        |      |       |\n   |       |     <sip:userC>;reason=no-answer;counter=1;privacy=full,\
    \  |\n   |       |     <sip:userB>;reason=unconditional;counter=1;privacy=off|\n\
    \   |       |       |    History-Info:                   |      |       |\n  \
    \ |       |       |    <sip:proxyP1>;index=1,          |      |       |\n   |\
    \       |       |    <sip:userB>;index=1.1;rc=1,     |      |       |\n   |  \
    \     |       |    <sip:proxyP2;cause=302>;index=1.1.1;mp=1.1     |\n   |    \
    \   |       |       |      |       |       |     |      |       |\n   |      \
    \ |       |       |      |       |       |     |INV E |       |\n   |       |\
    \       |       |      |       |       |     |----->|       |\n   |       |  \
    \     |Diversion:                                 |       |\n   |       |    \
    \ <sip:userD>;reason=time-of-day;counter=1;privacy=off, |\n   |       |     <sip:userC>;reason=no-answer;counter=1;privacy=full,\
    \  |\n   |       |     <sip:userB>;reason=unconditional;counter=1;privacy=off|\n\
    \   |       |       |     History-Info:                         |       |\n  \
    \ |       |       |     <sip:proxyP1>;index=1,                |       |\n   |\
    \       |       |     <sip:userB>;index=1.1;rc=1,           |       |\n   |  \
    \     |       |     <sip:proxyP2;cause=302>;index=1.1.1;mp=1.1    |\n   |    \
    \   |       |       |      |       |       |     |      |       |\n   |      \
    \ |       |       |      |       |       |     |      | INV E |\n   |       |\
    \       |       |      |       |       |     |      |------>|\n   |       |  \
    \ History-Info:      |       |       |     |      |       |\n   |       |   <sip:proxyP1>;index=1,\
    \     |       |     |      |       |\n   |       |   <sip:userB>;index=1.1;rc=1,\
    \        |     |      |       |\n   |       |   <sip:proxyP2;cause=302>;index=1.1.1;mp=1.1,\
    \     |       |\n   |       |   <sip:userC ?Privacy=history>;index=1.1.1.0.1,\
    \   |       |\n   |<sip:userD;cause=408?Privacy=none>;index=1.1.1.0.1.1;mp=1.1.1.0.1,\
    \ |\n   |       |<sip:userE;cause=404>;index=1.1.1.0.1.1.1;mp=1.1.1.0.1.1   |\n\
    \   |       |       |       |      |       |       |     |       |      |\n  \
    \ |       |       |       |      |       |       |     |       |      |\n   Note:\
    \ The IWF is an interworking function that could be a stand-alone\n   equipment\
    \ not defined in this document (it could be a proxy).\n"
- title: 7.4.  Additional Interworking Cases
  contents:
  - "7.4.  Additional Interworking Cases\n   Even for particular cases in which both\
    \ header fields could coexist,\n   it should be the responsibility of the network\
    \ local policy to make\n   it work together.  This section describes some situations\
    \ and some\n   recommendations on behavior.\n   In the case where there is one\
    \ network that includes different nodes,\n   some of them supporting the Diversion\
    \ header field and other ones\n   supporting the History-Info header field, there\
    \ is a problem when any\n   node handling a message does not know the next node\
    \ that will handle\n   the message.  This case can occur when the network has\
    \ new and old\n   nodes, the older ones using the Diversion header field and the\
    \ most\n   recent using the History-Info header field.\n   While a network replacement\
    \ may be occurring, there will be a time\n   when both nodes coexist in the network.\
    \  If the different nodes are\n   being used to support different subscriber types\
    \ due to different\n   node capabilities, then the problem is more important.\
    \  In this case,\n   there is a need to pass both the History-Info header field\
    \ and the\n   Diversion header field within the core network.\n   These header\
    \ fields need to be equivalent to ensure that, whatever\n   the node receiving\
    \ the message, the correct diversion information is\n   received.  This requires\
    \ that, whatever the received header field,\n   there is a requirement to be able\
    \ to compare the header fields and to\n   convert the header fields.  Depending\
    \ upon the node capability, it\n   may be possible to make assumptions as to how\
    \ this is handled.\n   o  If it is known that the older Diversion header field\
    \ supporting\n      nodes does not pass on any received History-Info header field,\n\
    \      then the interworking becomes easier.  If a message is received\n     \
    \ with only Diversion header fields, then it has originated from an\n      old\
    \ node.  The equivalent History-Info entries can be created, and\n      these\
    \ can then be passed as well as the Diversion header field.\n   o  If the node\
    \ creates a new History-Info header field for a call\n      diversion, then an\
    \ additional Diversion header field must be\n      created.\n   o  If the next\
    \ node is an old node, then the Diversion header field\n      will be used by\
    \ that node, and the History-Info entries will be\n      removed from the message\
    \ when it is passed on.\n   o  If the next node is a new node, then the presence\
    \ of both the\n      Diversion header field and History-Info header field means\
    \ that\n      interworking has already occurred and the Diversion and History-\n\
    \      Info entries must be considered equivalent.\n   o  If both nodes pass on\
    \ both the History-Info header field and\n      Diversion header field but only\
    \ actively use one, then both types\n      of nodes need to perform the interworking\
    \ and must maintain\n      equivalence between the header fields.  This will eventually\n\
    \      result in the use of the Diversion header field being deprecated\n    \
    \  when all nodes in the network support the History-Info header\n      field.\n\
    \   o  If a gap is identified in the History-Info header field by a node\n   \
    \   that would create a new entry, it shall add a single index with a\n      value\
    \ of \"0\" prior to adding the appropriate index for the action\n      to be taken.\n"
- title: 8.  Backward Compatibility
  contents:
  - "8.  Backward Compatibility\n   Issues with backward compatibility are due to\
    \ the evolution of the\n   History-Info header field from [RFC4244] to [RFC7044],\
    \ as described\n   in Section 1.3 of this document.  Backward compatibility is\
    \ taken\n   into account throughout this document for the interworking with the\n\
    \   Diversion header field.  More details are provided in the \"Backwards\n  \
    \ Compatibility\" section of [RFC7044].\n"
- title: 9.  Security Considerations
  contents:
  - "9.  Security Considerations\n   The security considerations in [RFC7044] and\
    \ [RFC5806] apply.\n   The privacy considerations described in Section 3.2 apply.\n\
    \   The use of the Diversion header field or History-Info header field\n   requires\
    \ application of the requested privacy and integrity requested\n   by each diverting\
    \ user or entity.  Without integrity, the requested\n   privacy functions could\
    \ be downgraded or eliminated, potentially\n   exposing identity information.\
    \  Without confidentiality,\n   eavesdroppers on the network (or any intermediaries\
    \ between the user\n   and the Privacy Service) could see the very personal information\
    \ that\n   the user has asked the Privacy Service to obscure.  Unauthorized\n\
    \   insertion and deletion/modification of those header fields can\n   provide\
    \ misleading information to users and applications.  A SIP\n   entity that can\
    \ provide a redirection reason in a History-Info header\n   field or Diversion\
    \ header field should be able to suppress this in\n   accordance with privacy\
    \ requirements of the user concerned.\n"
- title: 10.  References
  contents:
  - '10.  References

    '
- title: 10.1.  Normative References
  contents:
  - "10.1.  Normative References\n   [RFC3261]  Rosenberg, J., Schulzrinne, H., Camarillo,\
    \ G., Johnston,\n              A., Peterson, J., Sparks, R., Handley, M., and\
    \ E.\n              Schooler, \"SIP: Session Initiation Protocol\", RFC 3261,\n\
    \              DOI 10.17487/RFC3261, June 2002,\n              <http://www.rfc-editor.org/info/rfc3261>.\n\
    \   [RFC3323]  Peterson, J., \"A Privacy Mechanism for the Session\n         \
    \     Initiation Protocol (SIP)\", RFC 3323,\n              DOI 10.17487/RFC3323,\
    \ November 2002,\n              <http://www.rfc-editor.org/info/rfc3323>.\n  \
    \ [RFC3326]  Schulzrinne, H., Oran, D., and G. Camarillo, \"The Reason\n     \
    \         Header Field for the Session Initiation Protocol (SIP)\",\n        \
    \      RFC 3326, DOI 10.17487/RFC3326, December 2002,\n              <http://www.rfc-editor.org/info/rfc3326>.\n\
    \   [RFC3966]  Schulzrinne, H., \"The tel URI for Telephone Numbers\",\n     \
    \         RFC 3966, DOI 10.17487/RFC3966, December 2004,\n              <http://www.rfc-editor.org/info/rfc3966>.\n\
    \   [RFC4244]  Barnes, M., Ed., \"An Extension to the Session Initiation\n   \
    \           Protocol (SIP) for Request History Information\", RFC 4244,\n    \
    \          DOI 10.17487/RFC4244, November 2005,\n              <http://www.rfc-editor.org/info/rfc4244>.\n\
    \   [RFC5806]  Levy, S. and M. Mohali, Ed., \"Diversion Indication in\n      \
    \        SIP\", RFC 5806, DOI 10.17487/RFC5806, March 2010,\n              <http://www.rfc-editor.org/info/rfc5806>.\n\
    \   [RFC7044]  Barnes, M., Audet, F., Schubert, S., van Elburg, J., and\n    \
    \          C. Holmberg, \"An Extension to the Session Initiation\n           \
    \   Protocol (SIP) for Request History Information\", RFC 7044,\n            \
    \  DOI 10.17487/RFC7044, February 2014,\n              <http://www.rfc-editor.org/info/rfc7044>.\n"
- title: 10.2.  Informative References
  contents:
  - "10.2.  Informative References\n   [Err1409]  RFC Errata, Erratum ID 1409, RFC\
    \ 4458.\n   [RFC4458]  Jennings, C., Audet, F., and J. Elwell, \"Session\n   \
    \           Initiation Protocol (SIP) URIs for Applications such as\n        \
    \      Voicemail and Interactive Voice Response (IVR)\", RFC 4458,\n         \
    \     DOI 10.17487/RFC4458, April 2006,\n              <http://www.rfc-editor.org/info/rfc4458>.\n\
    \   [RFC5234]  Crocker, D., Ed. and P. Overell, \"Augmented BNF for Syntax\n \
    \             Specifications: ABNF\", STD 68, RFC 5234,\n              DOI 10.17487/RFC5234,\
    \ January 2008,\n              <http://www.rfc-editor.org/info/rfc5234>.\n   [RFC6044]\
    \  Mohali, M., \"Mapping and Interworking of Diversion\n              Information\
    \ between Diversion and History-Info Headers in\n              the Session Initiation\
    \ Protocol (SIP)\", RFC 6044,\n              DOI 10.17487/RFC6044, October 2010,\n\
    \              <http://www.rfc-editor.org/info/rfc6044>.\n   [TS_24.604]\n   \
    \           3rd Generation Partnership Project, \"Communication\n            \
    \  Diversion (CDIV) using IP Multimedia (IM) Core Network\n              (CN)\
    \ subsystem; Protocol specification\", Release 13.1,\n              3GPP TS 24.604,\
    \ June 2015.\n   [TS_29.163]\n              3rd Generation Partnership Project,\
    \ \"Interworking between\n              the IP Multimedia (IM) Core Network (CN)\
    \ subsystem and\n              Circuit Switched (CS) networks\", Release 13.2,\
    \ 3GPP TS\n              29.163, June 2015.\n"
- title: Appendix A.  Interworking between Diversion Header Field and Voicemail
  contents:
  - "Appendix A.  Interworking between Diversion Header Field and Voicemail\n    \
    \         URI\n   Voicemail URI is a mechanism described in [RFC4458] to provide\
    \ a\n   simple way to transport only one redirecting user address and the\n  \
    \ reason why the diversion occurred in the Request-URI of the INVITE\n   request.\
    \  This mechanism is mainly used for call diversion to a\n   voicemail.\n"
- title: A.1.  Diversion Header Field to Voicemail URI
  contents:
  - "A.1.  Diversion Header Field to Voicemail URI\n   Received:\n   Diversion: userA-address;reason=user-busy;counter=1;privacy=full\n\
    \   Sent (Voicemail URI created in the R-URI line of the INVITE):\n   sip: voicemail@example.com;target=userA-address;cause=486\
    \ SIP/2.0\n   Mapping of the Redirection Reason is the same as for History-Info\n\
    \   header field with a default value set to 404.\n   If the Diversion header\
    \ field contains more than one Diversion entry,\n   the choice of the redirecting\
    \ user information inserted in the URI is\n   in charge of the network local policy.\
    \  For example, the choice\n   criterion of the redirecting information inserted\
    \ in the URI could be\n   the destination of forwarded INVITE request (whether\
    \ or note the\n   voicemail serves this user).\n   Note: This interworking could\
    \ be done in addition to the interworking\n   of the Diversion header field into\
    \ the History-Info header field.\n"
- title: A.2.  Voicemail URI to Diversion Header Field
  contents:
  - "A.2.  Voicemail URI to Diversion Header Field\n   In case of real voicemail,\
    \ this way of interworking should not\n   happen.  However, if for any reason\
    \ it occurs, it is recommended to\n   do it as follows:\n   Received:\n   INVITE\
    \ sip: voicemail@example.com;\\\n   target=sip:+33145454500%40example.com;user=phone;\\\
    \n   cause=302 SIP/2.0\n   Sent in the forwarded INVITE:\n   Diversion: sip:+33145454500%40example.com;user=phone;\n\
    \   reason=unconditional;counter=1\n"
- title: Acknowledgements
  contents:
  - "Acknowledgements\n   The author would like to acknowledge the constructive feedback\
    \ and\n   support provided by Steve Norreys, Jan Van Geel, Martin Dolly,\n   Francisco\
    \ Silva, Guiseppe Sciortino, Cinza Amenta, Christer Holmberg,\n   Ian Elz, Jean-Francois\
    \ Mule, Mary Barnes, Francois Audet, Erick\n   Sasaki, Shida Schubert, Joel M.\
    \ Halpern, Bob Braden, Robert Sparks,\n   Merci a Lionel Morand, and Xavier Marjou\
    \ et Philippe Fouquart.\n"
- title: Author's Address
  contents:
  - "Author's Address\n   Marianne Mohali\n   Orange\n   38-40 rue du General Leclerc\n\
    \   Issy-Les-Moulineaux Cedex 9  92794\n   France\n   Phone: +33 1 45 29 45 14\n\
    \   Email: marianne.mohali@orange.com\n"
