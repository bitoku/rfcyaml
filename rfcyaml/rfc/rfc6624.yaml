- title: __initial_text__
  contents:
  - "             Layer 2 Virtual Private Networks Using BGP for\n               \
    \       Auto-Discovery and Signaling\n"
- title: Abstract
  contents:
  - "Abstract\n   Layer 2 Virtual Private Networks (L2VPNs) based on Frame Relay or\
    \ ATM\n   circuits have been around a long time; more recently, Ethernet VPNs,\n\
    \   including Virtual Private LAN Service, have become popular.\n   Traditional\
    \ L2VPNs often required a separate Service Provider\n   infrastructure for each\
    \ type and yet another for the Internet and IP\n   VPNs.  In addition, L2VPN provisioning\
    \ was cumbersome.  This document\n   presents a new approach to the problem of\
    \ offering L2VPN services\n   where the L2VPN customer's experience is virtually\
    \ identical to that\n   offered by traditional L2VPNs, but such that a Service\
    \ Provider can\n   maintain a single network for L2VPNs, IP VPNs, and the Internet,\
    \ as\n   well as a common provisioning methodology for all services.\n"
- title: Status of This Memo
  contents:
  - "Status of This Memo\n   This document is not an Internet Standards Track specification;\
    \ it is\n   published for informational purposes.\n   This document is a product\
    \ of the Internet Engineering Task Force\n   (IETF).  It represents the consensus\
    \ of the IETF community.  It has\n   received public review and has been approved\
    \ for publication by the\n   Internet Engineering Steering Group (IESG).  Not\
    \ all documents\n   approved by the IESG are a candidate for any level of Internet\n\
    \   Standard; see Section 2 of RFC 5741.\n   Information about the current status\
    \ of this document, any errata,\n   and how to provide feedback on it may be obtained\
    \ at\n   http://www.rfc-editor.org/info/rfc6624.\n"
- title: Copyright Notice
  contents:
  - "Copyright Notice\n   Copyright (c) 2012 IETF Trust and the persons identified\
    \ as the\n   document authors.  All rights reserved.\n   This document is subject\
    \ to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n\
    \   (http://trustee.ietf.org/license-info) in effect on the date of\n   publication\
    \ of this document.  Please review these documents\n   carefully, as they describe\
    \ your rights and restrictions with respect\n   to this document.  Code Components\
    \ extracted from this document must\n   include Simplified BSD License text as\
    \ described in Section 4.e of\n   the Trust Legal Provisions and are provided\
    \ without warranty as\n   described in the Simplified BSD License.\n"
- title: Table of Contents
  contents:
  - "Table of Contents\n   1. Introduction ....................................................3\n\
    \      1.1. Terminology ................................................6\n  \
    \         1.1.1. Conventions Used in This Document ...................6\n    \
    \  1.2. Advantages of Layer 2 VPNs .................................6\n      \
    \     1.2.1. Separation of Administrative Responsibilities .......7\n        \
    \   1.2.2. Migrating from Traditional Layer 2 VPNs .............7\n          \
    \ 1.2.3. Privacy of Routing ..................................7\n           1.2.4.\
    \ Layer 3 Independence ................................7\n           1.2.5. PE\
    \ Scaling ..........................................8\n           1.2.6. Ease\
    \ of Configuration ...............................8\n      1.3. Advantages of\
    \ Layer 3 VPNs .................................9\n           1.3.1. Layer 2 Independence\
    \ ................................9\n           1.3.2. SP Routing as Added Value\
    \ ..........................10\n           1.3.3. Class of Service ...................................10\n\
    \      1.4. Multicast Routing .........................................10\n  \
    \ 2. Operation of a Layer 2 VPN .....................................11\n    \
    \  2.1. Network Topology ..........................................11\n      2.2.\
    \ Configuration .............................................13\n           2.2.1.\
    \ CE Configuration ...................................14\n           2.2.2. PE\
    \ Configuration ...................................15\n           2.2.3. Adding\
    \ a New Site ..................................15\n           2.2.4. Deleting\
    \ a Site ....................................16\n           2.2.5. Managing CE\
    \ ID Mappings ............................16\n           2.2.6. Managing Label\
    \ Blocks ..............................16\n      2.3. Operations, Administration,\
    \ and Maintenance (OAM) .........17\n   3. PE Information Exchange ........................................17\n\
    \      3.1. Circuit Status Vector .....................................19\n  \
    \    3.2. Generalizing the VPN Topology .............................20\n   4.\
    \ Layer 2 Interworking ...........................................21\n   5. Packet\
    \ Transport ...............................................22\n      5.1. Layer\
    \ 2 MTU ...............................................22\n      5.2. Layer 2\
    \ Frame Format ......................................22\n      5.3. IP-Only Layer\
    \ 2 Interworking ..............................23\n   6. Security Considerations\
    \ ........................................23\n   7. IANA Considerations ............................................23\n\
    \   8. Acknowledgments ................................................24\n  \
    \ 9. Contributors ...................................................24\n   10.\
    \ References ....................................................24\n      10.1.\
    \ Normative References .....................................24\n      10.2. Informative\
    \ References ...................................25\n"
- title: 1.  Introduction
  contents:
  - "1.  Introduction\n   The earliest Virtual Private Networks (VPNs) were based\
    \ on Layer 2\n   circuits: X.25, Frame Relay, and ATM (see [Kosiur]).  More recently,\n\
    \   multipoint VPNs based on Ethernet Virtual Local Area Networks (VLANs)\n  \
    \ and Virtual Private LAN Service (VPLS) [RFC4761][RFC4762] have become\n   quite\
    \ popular.  In contrast, the VPNs described in this document are\n   point-to-point,\
    \ and usually called Virtual Private Wire Service\n   (VPWS).  All of these come\
    \ under the classification of Layer 2 VPNs\n   (L2VPNs), as the customer-to-Service-Provider\
    \ hand-off is at Layer 2.\n   There are at least two factors that adversely affected\
    \ the cost of\n   offering L2VPNs.  The first is that the easiest way to offer\
    \ an L2VPN\n   of a given type of Layer 2 was over an infrastructure of the same\n\
    \   type.  This approach required that the Service Provider build a\n   separate\
    \ infrastructure for each Layer 2 encapsulation, e.g., an ATM\n   infrastructure\
    \ for ATM VPNs, an Ethernet infrastructure for Ethernet\n   VPNs, etc.  In addition,\
    \ a separate infrastructure was needed for the\n   Internet and IP VPNs [RFC4364],\
    \ and possibly yet another for voice\n   services.  Going down this path meant\
    \ a proliferation of networks.\n   The other is that each of these networks had\
    \ different provisioning\n   methodologies.  Furthermore, the provisioning of\
    \ an L2VPN was fairly\n   complex.  It is important to distinguish between a single\
    \ Layer 2\n   circuit, which connects two customer sites, and a Layer 2 VPN, which\n\
    \   is a set of circuits that connect sites belonging to the same\n   customer.\
    \  The fact that two different circuits belonged to the same\n   VPN was typically\
    \ known only to the provisioning system, not to the\n   switches offering the\
    \ service; this complicated the setting up, and\n   subsequently, the troubleshooting,\
    \ of an L2VPN.  Also, each switch\n   offering the service had to be provisioned\
    \ with the address of every\n   other switch in the same VPN, requiring, in the\
    \ case of full-mesh VPN\n   connectivity, provisioning proportional to the square\
    \ of the number\n   of sites.  This made full-mesh L2VPN connectivity prohibitively\n\
    \   expensive for the Service Provider (SP) and thus also for customers.\n   Finally,\
    \ even setting up an individual circuit often required the\n   provisioning of\
    \ every switch along the path.\n   Of late, there has been much progress in network\
    \ \"convergence\",\n   whereby Layer 2 traffic, Internet traffic, and IP VPN traffic\
    \ can be\n   carried over a single, consolidated network infrastructure based\
    \ on\n   IP/MPLS tunnels; this is made possible by techniques such as those\n\
    \   described in [RFC4448], [RFC4618], [RFC4619], and [RFC4717] for Layer\n  \
    \ 2 traffic and in [RFC4364] for IP VPN traffic.  This development goes\n   a\
    \ long way toward addressing the problem of network proliferation.\n   This document\
    \ goes one step further and shows how a Service Provider\n   can offer Layer 2\
    \ VPNs using protocol and provisioning methodologies\n   similar to that used\
    \ for VPLS [RFC4761] and IP VPNs [RFC4364],\n   thereby achieving a significant\
    \ degree of operational convergence as\n   well.  In particular, all of these\
    \ methodologies include the notion\n   of a VPN identifier that serves to unify\
    \ components of a given VPN\n   and the concept of auto-discovery, which simplifies\
    \ the provisioning\n   of dense VPN topologies (for example, a full mesh).  In\
    \ addition,\n   similar techniques are used in all of the above-mentioned VPN\n\
    \   technologies to offer inter-AS and inter-provider VPNs (i.e., VPNs\n   whose\
    \ sites are connected to multiple Autonomous Systems (ASes) or\n   Service Providers).\n\
    \   Technically, the approach proposed here uses the concepts and\n   solution\
    \ described in [RFC4761], which describes a method for VPLS, a\n   particular\
    \ form of a Layer 2 VPN.  That document, in turn, borrowed\n   much from [RFC4364],\
    \ including the use of BGP for auto-discovery and\n   \"demultiplexor\" (see below)\
    \ exchange and the concepts of Route\n   Distinguishers to make VPN advertisements\
    \ unique and Route Targets to\n   control VPN topology.  In addition, all three\
    \ documents share the\n   idea that routers not directly connected to VPN customers\
    \ should\n   carry no VPN state, restricting the provisioning of individual\n\
    \   connections to just the edge devices.  This is achieved using tunnels\n  \
    \ to carry the data, with a demultiplexor that identifies individual\n   VPN circuits.\
    \  These tunnels could be based on MPLS, GRE, or any\n   other tunnel technology\
    \ that offers a demultiplexing field; the\n   signaling of these tunnels is outside\
    \ the scope of this document.\n   The specific approach taken here is to use an\
    \ MPLS label as the\n   demultiplexor.\n   Layer 2 VPNs typically require that\
    \ all sites in the VPN connect to\n   the SP with the same Layer 2 encapsulation.\
    \  To ease this\n   restriction, this document proposes a limited form of Layer\
    \ 2\n   interworking, by restricting the Layer 3 protocol to IP only (see\n  \
    \ Section 4).\n   It may be instructive to compare the approach described in [RFC4447]\n\
    \   and [RFC6074] (these are the IETF-approved technologies for the\n   functions\
    \ described in this document, albeit using two separate\n   protocols) with the\
    \ one described here.  To comply with IETF\n   standards, it is recommended that\
    \ devices implementing the solution\n   described in this document also implement\
    \ the approach in [RFC4447]\n   and [RFC6074].\n   The rest of this section discusses\
    \ the relative merits of Layer 2 and\n   Layer 3 VPNs.  Section 2 describes the\
    \ operation of a Layer 2 VPN.\n   Section 3 describes PE information exchange.\
    \  Section 4 describes IP-\n   only Layer 2 interworking.  Section 5 describes\
    \ how the L2 packets\n   are transported across the SP network.\n"
- title: 1.1.  Terminology
  contents:
  - "1.1.  Terminology\n   The terminology used is from [RFC4761] and [RFC4364]; it\
    \ is briefly\n   repeated here.  A \"customer\" is a customer of a Service Provider\n\
    \   seeking to interconnect their various \"sites\" (each an independent\n   network)\
    \ at Layer 2 through the Service Provider's network, while\n   maintaining privacy\
    \ of communication and address space.  The device\n   in a customer site that\
    \ connects to a Service Provider router is\n   termed the CE (customer edge) device;\
    \ this device may be a router or\n   a switch.  The Service Provider router to\
    \ which a CE connects is\n   termed a PE (provider edge).  A router in the Service\
    \ Provider's\n   network that doesn't connect directly to any CE is termed P\n\
    \   (\"provider\" device).  Every pair of PEs is connected by a \"tunnel\";\n\
    \   within a tunnel, VPN data is distinguished by a \"demultiplexor\",\n   which\
    \ in this document is an MPLS label.\n   Each CE within a VPN is assigned a CE\
    \ ID, a number that uniquely\n   identifies a CE within an L2VPN.  More accurately,\
    \ the CE ID\n   identifies a physical connection from the CE device to the PE,\
    \ since\n   a CE may be connected to multiple PEs (or multiply connected to a\n\
    \   PE); in such a case, the CE would have a CE ID for each connection.\n   A\
    \ CE may also be part of many L2VPNs; it would need one (or more) CE\n   ID(s)\
    \ for each L2VPN of which it is a member.  The number space for\n   CE IDs is\
    \ scoped to a given VPN.\n   In the case of inter-provider L2VPNs, there needs\
    \ to be some\n   coordination of allocation of CE IDs.  One solution is to allocate\n\
    \   ranges for each SP.  Other solutions may be forthcoming.\n   Within each physical\
    \ connection from a CE to a PE, there may be\n   multiple virtual circuits.  These\
    \ will be referred to as Attachment\n   Circuits (ACs), following [RFC3985]. \
    \ Similarly, the entity that\n   connects two attachment circuits across the Service\
    \ Provider network\n   is called a pseudowire (PW).\n"
- title: 1.1.1.  Conventions Used in This Document
  contents:
  - "1.1.1.  Conventions Used in This Document\n   The key words \"MUST\", \"MUST\
    \ NOT\", \"REQUIRED\", \"SHALL\", \"SHALL NOT\",\n   \"SHOULD\", \"SHOULD NOT\"\
    , \"RECOMMENDED\", \"MAY\", and \"OPTIONAL\" in this\n   document are to be interpreted\
    \ as described in [RFC2119].\n"
- title: 1.2.  Advantages of Layer 2 VPNs
  contents:
  - "1.2.  Advantages of Layer 2 VPNs\n   A Layer 2 VPN is one where a Service Provider\
    \ provides Layer 2\n   connectivity to the customer.  The Service Provider does\
    \ not\n   participate in the customer's Layer 3 network, especially in the\n \
    \  routing, resulting in several advantages to the SP as a whole and to\n   PE\
    \ routers in particular.\n"
- title: 1.2.1.  Separation of Administrative Responsibilities
  contents:
  - "1.2.1.  Separation of Administrative Responsibilities\n   In a Layer 2 VPN, the\
    \ Service Provider is responsible for Layer 2\n   connectivity; the customer is\
    \ responsible for Layer 3 connectivity,\n   which includes routing.  If the customer\
    \ says that host x in site A\n   cannot reach host y in site B, the Service Provider\
    \ need only\n   demonstrate that site A is connected to site B.  The details of\
    \ how\n   routes for host y reach host x are the customer's responsibility.\n\
    \   Another important factor is that once a PE provides Layer 2\n   connectivity\
    \ to its connected CE, its job is done.  A misbehaving CE\n   can at worst flap\
    \ its interface, but route flaps in the customer\n   network have little effect\
    \ on the SP network.  On the other hand, a\n   misbehaving CE in a Layer 3 VPN\
    \ can flap its routes, leading to\n   instability of the PE router or even the\
    \ entire SP network.  Thus,\n   when offering a Layer 3 VPN, an SP should proactively\
    \ protect itself\n   from Layer 3 instability in the CE network.\n"
- title: 1.2.2.  Migrating from Traditional Layer 2 VPNs
  contents:
  - "1.2.2.  Migrating from Traditional Layer 2 VPNs\n   Since \"traditional\" Layer\
    \ 2 VPNs (i.e., real Frame Relay circuits\n   connecting sites) are indistinguishable\
    \ from tunnel-based VPNs from\n   the customer's point of view, migrating from\
    \ one to the other raises\n   few issues.  Layer 3 VPNs, on the other hand, require\
    \ a considerable\n   redesign of the customer's Layer 3 routing architecture.\n\
    \   Furthermore, with Layer 3 VPNs, special care has to be taken that\n   routes\
    \ within the traditional VPN are not preferred over the Layer 3\n   VPN routes\
    \ (the so-called \"backdoor routing\" problem, whose solution\n   requires protocol\
    \ changes that are somewhat ad hoc).\n"
- title: 1.2.3.  Privacy of Routing
  contents:
  - "1.2.3.  Privacy of Routing\n   In an L2VPN, the privacy of customer routing is\
    \ a natural fallout of\n   the fact that the Service Provider does not participate\
    \ in routing.\n   The SP routers need not do anything special to keep customer\
    \ routes\n   separate from other customers or from the Internet; there is no need\n\
    \   for per-VPN routing tables and the additional complexity this imposes\n  \
    \ on PE routers.\n"
- title: 1.2.4.  Layer 3 Independence
  contents:
  - "1.2.4.  Layer 3 Independence\n   Since the Service Provider simply provides Layer\
    \ 2 connectivity, the\n   customer can run any Layer 3 protocols they choose.\
    \  If the SP were\n   participating in customer routing, it would be vital that\
    \ the\n   customer and SP both use the same Layer 3 protocol(s) and routing\n\
    \   protocols.\n   Note that IP-only Layer 2 interworking doesn't have this benefit\
    \ as\n   it restricts the Layer 3 to IP only.\n"
- title: 1.2.5.  PE Scaling
  contents:
  - "1.2.5.  PE Scaling\n   In the Layer 2 VPN scheme described below, each PE transmits\
    \ a single\n   small chunk of information about every CE that the PE is connected\
    \ to\n   every other PE.  That means that each PE need only maintain a single\n\
    \   chunk of information from each CE in each VPN and keep a single\n   \"route\"\
    \ to every site in every VPN.  This means that both the\n   Forwarding Information\
    \ Base and the Routing Information Base scale\n   well with the number of sites\
    \ and number of VPNs.  Furthermore, the\n   scaling properties are independent\
    \ of the customer: the only germane\n   quantity is the total number of VPN sites.\n\
    \   This is to be contrasted with Layer 3 VPNs, where each CE in a VPN\n   may\
    \ have an arbitrary number of routes that need to be carried by the\n   SP.  This\
    \ leads to two issues.  First, both the information stored at\n   each PE and\
    \ the number of routes installed by the PE for a CE in a\n   VPN can be (in principle)\
    \ unbounded, which means in practice that a\n   PE must restrict itself to installing\
    \ routes associated with the VPNs\n   of which it is currently a member.  Second,\
    \ a CE can send a large\n   number of routes to its PE, which means that the PE\
    \ must protect\n   itself against such a condition.  Thus, the SP must enforce\
    \ limits on\n   the number of routes accepted from a CE; this, in turn, requires\
    \ the\n   PE router to offer such control.\n   The scaling issues of Layer 3 VPNs\
    \ come into sharp focus at a BGP\n   route reflector (RR).  An RR cannot keep\
    \ all the advertised routes in\n   every VPN since the number of routes will be\
    \ too large.  The\n   following solutions/extensions are needed to address this\
    \ issue:\n   1.  RRs could be partitioned so that each RR services a subset of\n\
    \       VPNs so that no single RR has to carry all the routes.\n   2.  An RR could\
    \ use a preconfigured list of Route Targets for its\n       inbound route filtering.\
    \  The RR may choose to perform Route\n       Target Filtering, described in [RFC4684].\n"
- title: 1.2.6.  Ease of Configuration
  contents:
  - "1.2.6.  Ease of Configuration\n   Configuring traditional Layer 2 VPNs with dense\
    \ topologies was a\n   burden primarily because of the O(n*n) nature of the task.\
    \  If there\n   are n CEs in a Frame Relay VPN, say full-mesh connected, n*(n-1)/2\n\
    \   DLCI (Data Link Connection Identifier) Permanent Virtual Circuits\n   (PVCs)\
    \ must be provisioned across the SP network.  At each CE, (n-1)\n   DLCIs must\
    \ be configured to reach each of the other CEs.\n   Furthermore, when a new CE\
    \ is added, n new DLCI PVCs must be\n   provisioned; also, each existing CE must\
    \ be updated with a new DLCI\n   to reach the new CE.  Finally, each PVC requires\
    \ state in every\n   transit switch.\n   In our proposal, PVCs are tunneled across\
    \ the SP network.  The\n   tunnels used are provisioned independently of the L2VPNs,\
    \ using\n   signaling protocols (in the case of MPLS, LDP or RSVP - Traffic\n\
    \   Engineering (RSVP-TE) can be used), or set up by configuration; the\n   number\
    \ of tunnels is independent of the number of L2VPNs.  This\n   reduces a large\
    \ part of the provisioning burden.\n   Furthermore, we assume that DLCIs at the\
    \ CE edge are relatively cheap\n   and that VPN labels in the SP network are cheap.\
    \  This allows the SP\n   to \"overprovision\" VPNs, for example, allocate 50\
    \ CEs to a VPN when\n   only 20 are needed.  With this overprovisioning, adding\
    \ a new CE to a\n   VPN requires configuring just the new CE and its associated\
    \ PE;\n   existing CEs and their PEs need not be reconfigured.  Note that if\n\
    \   DLCIs at the CE edge are expensive, e.g., if these DLCIs are\n   provisioned\
    \ across a switched network, one could provision them as\n   and when needed,\
    \ at the expense of extra configuration.  This need\n   not still result in extra\
    \ state in the SP network, i.e., an\n   intelligent implementation can allow overprovisioning\
    \ of the pool of\n   VPN labels.\n"
- title: 1.3.  Advantages of Layer 3 VPNs
  contents:
  - "1.3.  Advantages of Layer 3 VPNs\n   Layer 3 VPNs ([RFC4364] in particular) offer\
    \ a good solution when the\n   customer traffic is wholly IP, customer routing\
    \ is reasonably simple,\n   and the customer sites connect to the SP with a variety\
    \ of Layer 2\n   technologies.\n"
- title: 1.3.1.  Layer 2 Independence
  contents:
  - "1.3.1.  Layer 2 Independence\n   One major restriction in a Layer 2 VPN is that\
    \ the Layer 2 media with\n   which the various sites of a single VPN connect to\
    \ the SP must be\n   uniform.  On the other hand, the various sites of a Layer\
    \ 3 VPN can\n   connect to the SP with any supported media; for example, some\
    \ sites\n   may connect with Frame Relay circuits and others with Ethernet.\n\
    \   This restriction of Layer 2 VPN is alleviated by the IP-only Layer 2\n   interworking\
    \ proposed in this document.  This comes at the cost of\n   losing the Layer 3\
    \ independence.\n   A corollary to this is that the number of sites that can be\
    \ in a\n   Layer 2 VPN is determined by the number of Layer 2 circuits that the\n\
    \   Layer 2 technology provides.  For example, if the Layer 2 technology\n   is\
    \ Frame Relay with 2-octet DLCIs, a CE can at most connect to about\n   a thousand\
    \ other CEs in a VPN.\n"
- title: 1.3.2.  SP Routing as Added Value
  contents:
  - "1.3.2.  SP Routing as Added Value\n   Another problem with Layer 2 VPNs is that\
    \ the CE router in a VPN must\n   be able to deal with having N routing peers,\
    \ where N is the number of\n   sites in the VPN.  This can be alleviated by manipulating\
    \ the\n   topology of the VPN.  For example, a hub-and-spoke VPN architecture\n\
    \   means that only one CE router (the hub) need deal with N neighbors.\n   However,\
    \ in a Layer 3 VPN, a CE router need only deal with one\n   neighbor, the PE router.\
    \  Thus, the SP can offer Layer 3 VPNs as a\n   value-added service to its customers.\n\
    \   Moreover, with Layer 2 VPNs, it is up to a customer to build and\n   operate\
    \ the whole network.  With Layer 3 VPNs, a customer is just\n   responsible for\
    \ building and operating routing within each site,\n   which is likely to be much\
    \ simpler than building and operating\n   routing for the whole VPN.  That, in\
    \ turn, makes Layer 3 VPNs more\n   suitable for customers who don't have sufficient\
    \ routing expertise,\n   again allowing the SP to provide added value.\n   As\
    \ mentioned later, multicast routing and forwarding is another\n   value-added\
    \ service that an SP can offer.\n"
- title: 1.3.3.  Class of Service
  contents:
  - "1.3.3.  Class of Service\n   Class-of-Service (CoS) issues have been addressed\
    \ for Layer 3 VPNs.\n   Since the PE router has visibility into the network Layer\
    \ (IP), the\n   PE router can take on the tasks of CoS classification and routing.\n\
    \   This restriction on Layer 2 VPNs is again eased in the case of IP-\n   only\
    \ Layer 2 interworking, as the PE router has visibility into the\n   network Layer\
    \ (IP).\n"
- title: 1.4.  Multicast Routing
  contents:
  - "1.4.  Multicast Routing\n   There are two aspects to multicast routing that we\
    \ will consider.  On\n   the protocol front, supporting IP multicast in a Layer\
    \ 3 VPN requires\n   PE routers to participate in the multicast routing instance\
    \ of the\n   customer and thus keep some related state information.\n   In the\
    \ Layer 2 VPN case, the CE routers run native multicast routing\n   directly.\
    \  The SP network just provides pipes to connect the CE\n   routers; PEs are unaware\
    \ whether the CEs run multicast or not and\n   thus do not have to participate\
    \ in multicast protocols or keep\n   multicast state information.\n   On the forwarding\
    \ front, in a Layer 3 VPN, CE routers do not\n   replicate multicast packets;\
    \ thus, the CE-PE link carries only one\n   copy of a multicast packet.  Whether\
    \ replication occurs at the\n   ingress PE or somewhere within the SP network\
    \ depends on the\n   sophistication of the Layer 3 VPN multicast solution.  The\
    \ simple\n   solution where a PE replicates packets for each of its CEs may place\n\
    \   considerable burden on the PE.  More complex solutions may require\n   VPN\
    \ multicast state in the SP network but may significantly reduce\n   the traffic\
    \ in the SP network by delaying packet replication until\n   needed.\n   In a\
    \ Layer 2 VPN, packet replication occurs at the CE.  This has the\n   advantage\
    \ of distributing the burden of replication among the CEs\n   rather than focusing\
    \ it on the PE to which they are attached and thus\n   will scale better.  However,\
    \ the CE-PE link will need to carry\n   multiple copies of multicast packets.\
    \  However, in the case of\n   Virtual Private LAN Service (a specific type of\
    \ L2VPN; see\n   [RFC4761]), the CE-PE link need transport only one copy of a\n\
    \   multicast packet.\n   Thus, just as in the case of unicast routing, the SP\
    \ has the choice\n   to offer a value-added service (multicast routing and forwarding)\
    \ at\n   some cost (multicast state and packet replication) using a Layer 3\n\
    \   VPN or to keep it simple and use a Layer 2 VPN.\n"
- title: 2.  Operation of a Layer 2 VPN
  contents:
  - "2.  Operation of a Layer 2 VPN\n   The following simple example of a customer\
    \ with four sites connected\n   to three PE routers in a Service Provider network\
    \ will hopefully\n   illustrate the various aspects of the operation of a Layer\
    \ 2 VPN.\n   For simplicity, we assume that a full-mesh topology is desired.\n\
    \   In what follows, Frame Relay serves as the Layer 2 media, and each CE\n  \
    \ has multiple DLCIs to its PE, each connecting to another CE in the\n   VPN.\
    \  If the Layer 2 media were ATM, then each CE would have multiple\n   VPIs/VCIs\
    \ (Virtual Path Identifiers/Virtual Channel Identifiers) to\n   connect to other\
    \ CEs.  For Point-to-Point Protocol (PPP) and Cisco\n   High-Level Data Link Control\
    \ (HDLC), each CE would have multiple\n   physical interfaces to connect to other\
    \ CEs.  In the case of IP-only\n   Layer 2 interworking, each CE could have a\
    \ mix of one or more of the\n   above Layer 2 media to connect to other CEs.\n"
- title: 2.1.  Network Topology
  contents:
  - "2.1.  Network Topology\n   Consider a Service Provider network with edge routers\
    \ PE0, PE1, and\n   PE2.  Assume that PE0 and PE1 are IGP neighbors, and PE2 is\
    \ more than\n   one hop away from PE0.\n   Suppose that a customer C has four\
    \ sites S0, S1, S2, and S3, that C\n   wants to connect via the Service Provider's\
    \ network using Frame\n   Relay.  Site S0 has CE0 and CE1 both connected to PE0.\
    \  Site S1 has\n   CE2 connected to PE0.  Site S2 has CE3 connected to PE1 and\
    \ CE4\n   connected to PE2.  Site S3 has CE5 connected to PE2.  (See Figure 1\n\
    \   below.)  Suppose further that C wants to \"overprovision\" each current\n\
    \   site, in expectation that the number of sites will grow to at least\n   10\
    \ in the near future.  However, CE4 is only provisioned with nine\n   DLCIs. \
    \ (Note that the signaling mechanism discussed in Section 3.2\n   of [RFC4761]\
    \ will allow a site to grow in terms of connectivity to\n   other sites at a later\
    \ point of time at the cost of additional\n   signaling, i.e., overprovisioning\
    \ is not a must but a\n   recommendation).\n   Finally, suppose that the CEs have\
    \ been provisioned with DLCIs as per\n   the following:\n      CE#  |  Provisioned\
    \ DLCIs\n     --------------------------------------------------------\n     \
    \   0  |  100 through 109\n        1  |  200 through 209\n        2  |  100 through\
    \ 109\n        3  |  200 through 209\n        4  |  107, 209, 265, 301, 414, 555,\
    \ 654, 777, and 888\n        5  |  417 through 426\n           S0            \
    \                                       S3\n     ..............              \
    \                         ..............\n     .            .                \
    \                       .            .\n     .    +-----+ .                  \
    \                     .            .\n     .    | CE0 |-----------+          \
    \                   .   +-----+  .\n     .    +-----+ .         |            \
    \                 .   | CE5 |  .\n     .            .         |              \
    \               .   +--+--+  .\n     .    +-----+ .         |                \
    \             .      |     .\n     .    | CE1 |-------+   |                  \
    \           .......|......\n     .    +-----+ .     |   |                    \
    \               /\n     .            .     |   |                             \
    \     /\n     ..............     |   |                                 /\n   \
    \                     |   |         SP Network             /\n               \
    \    .....|...|.............................../.....\n                   .   \
    \ |   |                              /     .\n                   .  +-+---+-+\
    \       +-------+           /      .\n                   .  |  PE0  |-------|\
    \   P   |--        |       .\n                   .  +-+---+-+       +-------+\
    \  \\       |       .\n                   .   /    \\                     \\ \
    \ +---+---+   .\n                   .  |      -----+                --|  PE2 \
    \ |   .\n                   .  |           |                  +---+---+   .\n\
    \                   .  |       +---+---+                 /        .\n        \
    \           .  |       |  PE1  |                /         .\n                \
    \   .  |       +---+---+               /          .\n                   .  | \
    \           \\                 /           .\n                   ...|.............|.............../.............\n\
    \                      |             |              /\n                      |\
    \             |             /\n                      |             |         \
    \   /\n          S1          |             |    S2     /\n     ..............\
    \   |     ........|........../......\n     .            .   |     .       |  \
    \       |      .\n     .    +-----+ .   |     .    +--+--+   +--+--+   .\n   \
    \  .    | CE2 |-----+     .    | CE3 |   | CE4 |   .\n     .    +-----+ .    \
    \     .    +-----+   +-----+   .\n     .            .         .              \
    \          .\n     ..............         ..........................\n       \
    \             Figure 1: Example Network Topology\n"
- title: 2.2.  Configuration
  contents:
  - "2.2.  Configuration\n   The following sub-sections detail the configuration that\
    \ is needed to\n   provision the above VPN.  For the purpose of exposition, we\
    \ assume\n   that the customer will connect to the SP with Frame Relay circuits.\n\
    \   While we focus primarily on the configuration that an SP has to do,\n   we\
    \ touch upon the configuration requirements of CEs as well.  The\n   main point\
    \ of contact in CE-PE configuration is that both must agree\n   on the DLCIs that\
    \ will be used on the interface connecting them.\n   If the PE-CE connection is\
    \ Frame Relay, it is recommended to run Link\n   Management Interface (LMI) between\
    \ the PE and CE.  For the case of\n   ATM VCs, Operations, Administration, and\
    \ Maintenance (OAM) cells may\n   be used.  For PPP and Cisco HDLC, keepalives\
    \ may be used directly\n   between CEs; however, in this case, PEs would not have\
    \ visibility as\n   to the liveness of customers circuits.\n   In the case of\
    \ IP-only Layer 2 interworking, if CE1, attached to PE0,\n   connects to CE3,\
    \ attached to PE1, via an L2VPN circuit, the Layer 2\n   media between CE1 and\
    \ PE0 is independent of the Layer 2 media between\n   CE3 and PE1.  Each side\
    \ will run its own Layer-2-specific link\n   management protocol, e.g., LMI, Link\
    \ Control Protocol (LCP), etc.\n   PE0 will inform PE1 about the status of its\
    \ local circuit to CE1 via\n   the circuit status vector TLV defined in Section\
    \ 3.1.  Similarly, PE1\n   will inform PE0 about the status of its local circuit\
    \ to CE3.\n"
- title: 2.2.1.  CE Configuration
  contents:
  - "2.2.1.  CE Configuration\n   Each CE that belongs to a VPN is given a \"CE ID\"\
    .  CE IDs must be\n   unique in the context of a VPN.  For the example, we assume\
    \ that the\n   CE ID for CE-k is k.\n   Each CE is configured to communicate with\
    \ its corresponding PE with\n   the set of DLCIs given above, for example, CE0\
    \ is configured with\n   DLCIs 100 through 109.  In general, a CE is configured\
    \ with a list of\n   circuits, all with the same Layer 2 encapsulation type, e.g.,\
    \ DLCIs,\n   VCIs, physical PPP interface, etc.  (IP-only Layer 2 interworking\n\
    \   allows a mix of Layer 2 encapsulation types.)  The size of this list/\n  \
    \ set determines the number of remote CEs with which a given CE can\n   communicate.\
    \  Denote the size of this list/set as the CE's range.  A\n   CE's range must\
    \ be at least the number of remote CEs that the CE will\n   connect to in a given\
    \ VPN; if the range exceeds this, then the CE is\n   overprovisioned, in anticipation\
    \ of growth of the VPN.\n   Each CE also \"knows\" which DLCI connects it to every\
    \ other CE.  The\n   methodology followed in this example is to use the CE ID\
    \ of the other\n   CE as an index into the DLCI list this CE has (with zero-based\n\
    \   indexing, i.e., 0 is the first index).  For example, CE0 is connected\n  \
    \ to CE3 through its fourth DLCI, 103; CE4 is connected to CE2 by the\n   third\
    \ DLCI in its list, namely 265.  This is just the methodology\n   used in the\
    \ description here; the actual methodology used to pick the\n   DLCI to be used\
    \ is a local matter.  The key factor is that CE-k may\n   communicate with CE-m\
    \ using a different DLCI from the DLCI that CE-m\n   uses to communicate to CE-k,\
    \ i.e., the SP network effectively acts as\n   a giant Frame Relay switch.  This\
    \ is very important, as it decouples\n   the DLCIs used at each CE site, making\
    \ for much simpler provisioning.\n"
- title: 2.2.2.  PE Configuration
  contents:
  - "2.2.2.  PE Configuration\n   Each PE is configured with the VPNs in which it\
    \ participates.  Each\n   VPN is associated with one or more Route Target communities\
    \ [RFC4360]\n   that serve to define the topology of the VPN.  For each VPN, the\
    \ PE\n   must determine a Route Distinguisher (RD) to use; this may either be\n\
    \   configured or chosen by the PE.  RDs do not have to be unique across\n   the\
    \ VPN.  For each CE attached to the PE in a given VPN, the PE must\n   know the\
    \ set of virtual circuits (DLCI, VCI/VPI, or VLAN) connecting\n   it to the CE\
    \ and a CE ID identifying the CE within the VPN.  CE IDs\n   must be unique in\
    \ the context of a given VPN.\n"
- title: 2.2.3.  Adding a New Site
  contents:
  - "2.2.3.  Adding a New Site\n   The first step in adding a new site to a VPN is\
    \ to pick a new CE ID.\n   If all current members of the VPN are overprovisioned,\
    \ i.e., their\n   range includes the new CE ID, adding the new site is a purely\
    \ local\n   task.  Otherwise, the sites whose range doesn't include the new CE\
    \ ID\n   and that wish to communicate directly with the new CE must have their\n\
    \   ranges increased by allocating additional local circuits to\n   incorporate\
    \ the new CE ID.\n   The next step is ensuring that the new site has the required\n\
    \   connectivity.  This usually requires adding a new virtual circuit\n   between\
    \ the PE and CE; in most cases, this configuration is limited\n   to the PE in\
    \ question.\n   The rest of the configuration is a local matter between the new\
    \ CE\n   and the PE to which it is attached.  At this point, the PE can signal\n\
    \   to other PEs that it has a new site in the VPN by advertising a BGP\n   Layer\
    \ 2 route, and traffic connectivity will be set up.\n   It bears repeating that\
    \ the key to making additions easy is\n   overprovisioning and the algorithm for\
    \ mapping a CE ID to a DLCI that\n   is used for connecting to the corresponding\
    \ CE.  However, what is\n   being overprovisioned is the number of DLCIs/VCIs\
    \ that connect the CE\n   to the PE.  This is a local matter between the PE and\
    \ CE; it does not\n   affect other PEs or CEs.\n"
- title: 2.2.4.  Deleting a Site
  contents:
  - "2.2.4.  Deleting a Site\n   Deleting a site consists first of removing the CE\
    \ ID of the site from\n   the configuration of the PE to which the site is attached.\
    \  The PE\n   will then signal to other PEs that it no longer has access to that\n\
    \   site by withdrawing its previously advertised BGP Layer 2 route.\n   Connectivity\
    \ to the deleted site will cease.\n   The next steps are bookkeeping: decommissioning\
    \ the attachment\n   circuit from the PE to the CE that corresponds to the site\
    \ being\n   removed and noting that the CE ID is now free for future allocation.\n\
    \   Note that each PE is now (further) overprovisioned; one may choose to\n  \
    \ actively \"reap\" CE IDs if desired.\n"
- title: 2.2.5.  Managing CE ID Mappings
  contents:
  - "2.2.5.  Managing CE ID Mappings\n   In the data plane, an attachment circuit,\
    \ identified say by a DLCI,\n   is mapped to a label via the control plane abstraction\
    \ of a CE ID.\n   At the egress PE, the label is mapped back to an attachment\
    \ circuit\n   via the same CE ID.  It is up to the VPN administrator\n   o  to\
    \ provision attachment circuits (e.g., DLCIs);\n   o  to allocate CE IDs; and\n\
    \   o  to keep a clear mapping of CE IDs to attachment circuits (and\n      reflect\
    \ this in PE configurations).\n   The PEs manage the mappings between attachment\
    \ circuits and labels,\n   i.e., the data plane mappings.\n   Note that in the\
    \ N-to-one modes listed in Table 1, a single\n   attachment circuit may correspond\
    \ to several Layer 2 virtual\n   circuits.  Nevertheless, there is a one-to-one\
    \ mapping between an\n   attachment circuit and a CE ID (and thus a label).\n"
- title: 2.2.6.  Managing Label Blocks
  contents:
  - "2.2.6.  Managing Label Blocks\n   Label blocks and label values are managed by\
    \ the PEs.  As sites get\n   added and removed, labels are allocated and released.\
    \  The easiest\n   way to manage these is to use fixed-size label blocks rather\
    \ than\n   variable-size blocks, although the signaling described here supports\n\
    \   either.  If an implementation uses fixed-size blocks, then allocating\n  \
    \ a label for a new site may requiring allocating a new block;\n   similarly,\
    \ freeing a label may require freeing a block.\n   If the implementation requires\
    \ fixed-size blocks, there is probably a\n   default block size, but the implementation\
    \ SHOULD allow the\n   administrator to choose a size.  Larger label block sizes\
    \ mean more\n   potential \"wasted\" labels but less signaling overhead, a trade-off\n\
    \   that the administrator might want to control.\n   Also, as sites get added\
    \ and deleted, a PE may receive packets with a\n   label that reflects a site\
    \ that has been deleted locally but not yet\n   processed by remote PEs or that\
    \ reflects a new site added remotely\n   but not processed locally.  In either\
    \ of these cases, the PE SHOULD\n   silently discard the packet; it may choose\
    \ to log the event once for\n   each such label, but not for every such packet.\n"
- title: 2.3.  Operations, Administration, and Maintenance (OAM)
  contents:
  - "2.3.  Operations, Administration, and Maintenance (OAM)\n   Many Layer 2 mediums\
    \ have OAM mechanisms.  For example, the PPP has\n   Echo Request and Echo Reply\
    \ messages; Frame Relay has the Local\n   Management Interface.  Among other things,\
    \ OAM is used for\n   troubleshooting and as keepalives.\n   There are two ways\
    \ to carry OAM information across Layer 2 VPNs.  The\n   first is to convey OAM\
    \ packets as any other Layer 2 packets across\n   the VPN.  This is the most general\
    \ method; it maintains full Layer 2\n   transparency and preserves all OAM information.\
    \  The other method\n   applies only to the link liveness aspect of OAM; it consists\
    \ of\n   transmitting the status of each attachment circuit across the control\n\
    \   plane using the circuit status vector (Section 3.1).  This method is\n   the\
    \ only one applicable to Layer 2 Interworking VPNs (Section 4),\n   since OAM\
    \ packets are not IP frames and thus cannot be transmitted\n   across such Layer\
    \ 2 VPNs.\n"
- title: 3.  PE Information Exchange
  contents:
  - "3.  PE Information Exchange\n   When a PE is configured with all the required\
    \ information for a CE,\n   it advertises to other PEs the fact that it is participating\
    \ in a VPN\n   via BGP messages, as per [RFC4761], Section 3.  BGP was chosen\
    \ as the\n   means for exchanging L2VPN information for two reasons: it offers\n\
    \   mechanisms for both auto-discovery and signaling, and it allows for\n   operational\
    \ convergence, as explained in Section 1.  A bonus for\n   using BGP is a robust\
    \ inter-AS solution for L2VPNs.\n   There are two modifications to the formatting\
    \ of messages.  The first\n   is that the set of Encaps Types carried in the L2-info\
    \ extended\n   community has been expanded to include those from Table 1.  The\
    \ value\n   of the Encaps Type field identifies the Layer 2 encapsulation, e.g.,\n\
    \   ATM, Frame Relay, etc.\n   +-----------+-------------------------------------------+-----------+\n\
    \   | Encaps    | Description                               | Reference |\n  \
    \ | Type      |                                           |           |\n   +-----------+-------------------------------------------+-----------+\n\
    \   | 0         | Reserved                                  | -         |\n  \
    \ |           |                                           |           |\n   |\
    \ 1         | Frame Relay                               | RFC 4446  |\n   |  \
    \         |                                           |           |\n   | 2  \
    \       | ATM AAL5 SDU VCC transport                | RFC 4446  |\n   |      \
    \     |                                           |           |\n   | 3      \
    \   | ATM transparent cell transport            | RFC 4816  |\n   |          \
    \ |                                           |           |\n   | 4         |\
    \ Ethernet (VLAN) Tagged Mode               | RFC 4448  |\n   |           |  \
    \                                         |           |\n   | 5         | Ethernet\
    \ Raw Mode                         | RFC 4448  |\n   |           |           \
    \                                |           |\n   | 6         | Cisco HDLC  \
    \                              | RFC 4618  |\n   |           |               \
    \                            |           |\n   | 7         | PPP             \
    \                          | RFC 4618  |\n   |           |                   \
    \                        |           |\n   | 8         | SONET/SDH Circuit Emulation\
    \ Service       | RFC 4842  |\n   |           |                              \
    \             |           |\n   | 9         | ATM n-to-one VCC cell transport\
    \           | RFC 4717  |\n   |           |                                  \
    \         |           |\n   | 10        | ATM n-to-one VPC cell transport    \
    \       | RFC 4717  |\n   |           |                                      \
    \     |           |\n   | 11        | IP Layer 2 Transport                   \
    \   | RFC 3032  |\n   |           |                                          \
    \ |           |\n   | 15        | Frame Relay Port mode                     |\
    \ RFC 4619  |\n   |           |                                           |  \
    \         |\n   | 17        | Structure-agnostic E1 over packet         | RFC\
    \ 4553  |\n   |           |                                           |      \
    \     |\n   | 18        | Structure-agnostic T1 (DS1) over packet   | RFC 4553\
    \  |\n   |           |                                           |           |\n\
    \   | 19        | VPLS                                      | RFC 4761  |\n  \
    \ |           |                                           |           |\n   |\
    \ 20        | Structure-agnostic T3 (DS3) over packet   | RFC 4553  |\n   |  \
    \         |                                           |           |\n   | 21 \
    \       | Nx64kbit/s Basic Service using            | RFC 5086  |\n   |      \
    \     | Structure-aware                           |           |\n   |        \
    \   |                                           |           |\n   | 25       \
    \ | Frame Relay DLCI                          | RFC 4619  |\n   |           |\
    \                                           |           |\n   | 40        | Structure-agnostic\
    \ E3 over packet         | RFC 4553  |\n   |           |                     \
    \                      |           |\n   | 41 (1)    | Octet-aligned payload for\
    \                 | RFC 4553  |\n   |           | Structure-agnostic DS1 circuits\
    \           |           |\n   |           |                                  \
    \         |           |\n   | 42 (2)    | E1 Nx64kbit/s with CAS using       \
    \       | RFC 5086  |\n   |           | Structure-aware                      \
    \     |           |\n   |           |                                        \
    \   |           |\n   | 43        | DS1 (ESF) Nx64kbit/s with CAS using      \
    \ | RFC 5086  |\n   |           | Structure-aware                           |\
    \           |\n   |           |                                           |  \
    \         |\n   | 44        | DS1 (SF) Nx64kbit/s with CAS using        | RFC\
    \ 5086  |\n   |           | Structure-aware                           |      \
    \     |\n   +-----------+-------------------------------------------+-----------+\n\
    \                           Table 1: Encaps Types\n   Note (1): Allocation of\
    \ a separate code point for Encaps Type\n   eliminates the need for Time Division\
    \ Multiplexer (TDM) payload size.\n   Note (2): Having separate code points for\
    \ Encaps Types 42-44 allows\n   specifying the trunk framing (i.e., E1, T1 ESF,\
    \ or T1 SF) with\n   Channel Associated Signaling (CAS).\n   The second is the\
    \ introduction of TLVs (Type-Length-Value triplets)\n   in the VPLS NLRI (Network\
    \ Layer Reachability Information).  L2VPN\n   TLVs can be added to extend the\
    \ information carried in the NLRI,\n   using the format shown in Figure 2.  In\
    \ L2VPN TLVs, Type is 1 octet,\n   and Length is 2 octets and represents the size\
    \ of the Value field in\n   bits.  L2VPN TLVs, if present, occur as the last element\
    \ of a VPLS\n   NLRI.  The length of the NLRI includes the total length of the\
    \ TLVs,\n   including their headers.\n      0                   1            \
    \       2                   3\n      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0\
    \ 1 2 3 4 5 6 7 8 9 0 1\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \     |     Type      |            Length             |     Value     |\n    \
    \ +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n     | Value\
    \ (continued, if needed) ...                              |\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\
    \                         Figure 2: Format of TLVs\n"
- title: 3.1.  Circuit Status Vector
  contents:
  - "3.1.  Circuit Status Vector\n   This sub-TLV carries the status of an L2VPN PVC\
    \ between a pair of\n   PEs.  Note that an L2VPN PVC is bidirectional, composed\
    \ of two\n   simplex connections going in opposite directions.  A simplex\n  \
    \ connection consists of three segments: 1) the local access circuit\n   between\
    \ the source CE and the ingress PE, 2) the tunnel Label\n   Switched Path (LSP)\
    \ between the ingress and egress PEs, and 3) the\n   access circuit between the\
    \ egress PE and the destination CE.\n   To monitor the status of a PVC, a PE needs\
    \ to monitor the status of\n   both simplex connections.  Since it knows the status\
    \ of its access\n   circuit and the status of the tunnel towards the remote PE,\
    \ it can\n   inform the remote PE of these two.  Similarly, the remote PE can\n\
    \   inform the status of its access circuit to its local CE and the\n   status\
    \ of the tunnel to the first PE.  Combining the local and the\n   remote information,\
    \ a PE can determine the status of a PVC.\n   The basic unit of advertisement\
    \ in L2VPN for a given CE is a label\n   block.  Each label within a label block\
    \ corresponds to a PVC on the\n   CE.  The local status information for all PVCs\
    \ corresponding to a\n   label block is advertised along with the NLRI for the\
    \ label block\n   using the status vector TLV.  The Type field of this TLV is\
    \ 1.  The\n   Length field of the TLV specifies the length of the value field\
    \ in\n   bits.  The Value field of this TLV is a bit-vector, each bit of which\n\
    \   indicates the status of the PVC associated with the corresponding\n   label\
    \ in the label block.  Bit value 0 corresponds to the PVC\n   associated with\
    \ the first label in the label block and indicates that\n   the local circuit\
    \ and the tunnel LSP to the remote PE is up, while a\n   value of 1 indicates\
    \ that either or both of them are down.  The Value\n   field is padded to the\
    \ nearest octet boundary.\n   A PE can determine the status of a PVC from one\
    \ of its CEs to a\n   remote CE as follows.  Say PE A has CE n in VPN X, and PE\
    \ A gets an\n   advertisement from PE B for remote CE m also in VPN X; this\n\
    \   advertisement includes a label block and a circuit status vector.  To\n  \
    \ determine which label to use for CE m, PE A must determine the index\n   corresponding\
    \ to CE m in the label block that PE B advertised.  The\n   status of the PVC\
    \ between CE n and CE m can be obtained by looking at\n   the bit in the circuit\
    \ status vector corresponding to this index.\n                   +----------+-----------------------+\n\
    \                   | TLV Type |      Description      |\n                   +----------+-----------------------+\n\
    \                   |     1    | Circuit Status Vector |\n                   +----------+-----------------------+\n\
    \                            Table 2: TLV Types\n"
- title: 3.2.  Generalizing the VPN Topology
  contents:
  - "3.2.  Generalizing the VPN Topology\n   In the above, we assumed for simplicity\
    \ that the VPN was a full mesh.\n   To allow for more general VPN topologies,\
    \ a mechanism based on\n   filtering of BGP extended communities can be used.\n"
- title: 4.  Layer 2 Interworking
  contents:
  - "4.  Layer 2 Interworking\n   As defined so far in this document, all CE-PE connections\
    \ for a given\n   Layer 2 VPN must use the same Layer 2 encapsulation, e.g., they\
    \ must\n   all be Frame Relay.  This is often a burdensome restriction.  One\n\
    \   answer is to use an existing Layer 2 interworking mechanism, for\n   example,\
    \ Frame Relay-ATM interworking.\n   In this document, we take a different approach:\
    \ we postulate that the\n   network Layer is IP and base Layer 2 interworking\
    \ on that.  Thus, one\n   can choose between pure Layer 2 VPNs, with a stringent\
    \ Layer 2\n   restriction but with Layer 3 independence, or Layer 2 interworking\n\
    \   VPNs, where there is no restriction on Layer 2, but Layer 3 must be\n   IP.\
    \  Of course, a PE may choose to implement Frame Relay-ATM\n   interworking. \
    \ For example, an ATM Layer 2 VPN could have some CEs\n   connect via Frame Relay\
    \ links, if their PE could translate Frame\n   Relay to ATM transparently to the\
    \ rest of the VPN.  This would be\n   private to the CE-PE connection, and such\
    \ a course is outside the\n   scope of this document.\n   For Layer 2 interworking\
    \ as defined here, when an IP packet arrives\n   at a PE, its Layer 2 address\
    \ is noted, then all Layer 2 overhead is\n   stripped, leaving just the IP packet.\
    \  Next, a VPN label is added,\n   and the packet is encapsulated in the PE-PE\
    \ tunnel (as required by\n   the tunnel technology).  Finally, the packet is forwarded.\
    \  Note that\n   the forwarding decision is made on the basis of the Layer 2\n\
    \   information, not the IP header.  At the egress, the VPN label\n   determines\
    \ to which CE the packet must be sent and over which virtual\n   circuit; from\
    \ this, the egress PE can also determine the Layer 2\n   encapsulation to place\
    \ on the packet once the VPN label is stripped.\n   An added benefit of restricting\
    \ interworking to IP only as the Layer\n   3 technology is that the provider's\
    \ network can provide IP Diffserv\n   or any other IP-based QoS mechanism to the\
    \ L2VPN customer.  The\n   ingress PE can set up IP/TCP/UDP-based classifiers\
    \ to do Diffserv\n   marking and other functions like policing and shaping on\
    \ the L2\n   circuits of the VPN customer.  Note the division of labor: the CE\n\
    \   determines the destination CE and encodes that in the Layer 2\n   address.\
    \  The ingress PE thus determines the egress PE and VPN label\n   based on the\
    \ Layer 2 address supplied by the CE, but the ingress PE\n   can choose the tunnel\
    \ to reach the egress PE (in the case that there\n   are different tunnels for\
    \ each CoS/Diffserv code point) or the CoS\n   bits to place in the tunnel (in\
    \ the case where a single tunnel\n   carries multiple CoS/Diffserv code points)\
    \ based on its own\n   classification of the packet.\n"
- title: 5.  Packet Transport
  contents:
  - "5.  Packet Transport\n   When a packet arrives at a PE from a CE in a Layer 2\
    \ VPN, the Layer 2\n   address of the packet identifies to which remote attachment\
    \ circuit\n   (and thus remote CE) the packet is destined.  The procedure outlined\n\
    \   above installs a route that maps the Layer 2 address to a tunnel\n   (which\
    \ identifies the PE to which the destination CE is attached) and\n   a VPN label\
    \ (which identifies the destination AC).  If the egress PE\n   is the same as\
    \ the ingress PE, no tunnel or VPN label is needed.\n   The packet may then be\
    \ modified (depending on the Layer 2\n   encapsulation).  In case of IP-only Layer\
    \ 2 interworking, the Layer 2\n   header is completely stripped off up to the\
    \ IP header.  Then, a VPN\n   label and tunnel encapsulation are added as specified\
    \ by the route\n   described above, and the packet is sent to the egress PE.\n\
    \   If the egress PE is the same as the ingress, the packet \"arrives\"\n   with\
    \ no labels.  Otherwise, the packet arrives with the VPN label,\n   which is used\
    \ to determine which CE is the destination CE.  The\n   packet is restored to\
    \ a fully formed Layer 2 packet and then sent to\n   the CE.\n"
- title: 5.1.  Layer 2 MTU
  contents:
  - "5.1.  Layer 2 MTU\n   This document requires that the Layer 2 MTU configured\
    \ on all the\n   access circuits connecting CEs to PEs in an L2VPN be the same.\
    \  This\n   can be ensured by passing the configured Layer 2 MTU in the Layer2-\n\
    \   info extended community when advertising L2VPN label blocks.  On\n   receiving\
    \ an L2VPN label block from remote PEs in a VPN, the MTU\n   value carried in\
    \ the Layer2-info extended community should be\n   compared against the configured\
    \ value for the VPN.  If they don't\n   match, then the label block should be\
    \ ignored.\n   The MTU on the Layer 2 access links MUST be chosen such that the\
    \ size\n   of the L2 frames plus the L2VPN header does not exceed the MTU of the\n\
    \   SP network.  Layer 2 frames that exceed the MTU after encapsulation\n   MUST\
    \ be dropped.  For the case of IP-only Layer 2 interworking, the\n   IP MTU on\
    \ the Layer 2 access link must be chosen such that the size\n   of the IP packet\
    \ and the L2VPN header does not exceed the MTU of the\n   SP network.\n"
- title: 5.2.  Layer 2 Frame Format
  contents:
  - "5.2.  Layer 2 Frame Format\n   The modification to the Layer 2 frame depends\
    \ on the Layer 2 type.\n   This document requires that the encapsulation methods\
    \ used in\n   transporting Layer 2 frames over tunnels be the same as described\
    \ in\n   [RFC4448], [RFC4618], [RFC4619], and [RFC4717], except in the case of\n\
    \   IP-only Layer 2 Interworking, which is described next.\n"
- title: 5.3.  IP-Only Layer 2 Interworking
  contents:
  - "5.3.  IP-Only Layer 2 Interworking\n         +-----------------------------------+\n\
    \         | PSN Transport |  VPN  |    IP     |     VPN label is the\n       \
    \  |     Header    | Label |  Packet   |     demultiplexing field\n         +-----------------------------------+\n\
    \          Figure 3: Format of IP-Only Layer 2 Interworking Packet\n   At the\
    \ ingress PE, an L2 frame's L2 header is completely stripped off\n   and is carried\
    \ over as an IP packet within the SP network (Figure 3).\n   The forwarding decision\
    \ is still based on the L2 address of the\n   incoming L2 frame.  At the egress\
    \ PE, the IP packet is encapsulated\n   back in an L2 frame and transported over\
    \ to the destination CE.  The\n   forwarding decision at the egress PE is based\
    \ on the VPN label as\n   before.  The L2 technology between egress PE and CE\
    \ is independent of\n   the L2 technology between ingress PE and CE.\n"
- title: 6.  Security Considerations
  contents:
  - "6.  Security Considerations\n   RFC 4761 [RFC4761], on which this document is\
    \ based, has a detailed\n   discussion of security considerations.  As in RFC\
    \ 4761, the focus\n   here is the privacy of customer VPN data (as opposed to\n\
    \   confidentiality, integrity, or authentication of said data); to\n   achieve\
    \ the latter, one can use the methods suggested in RFC 4761.\n   The techniques\
    \ described in RFC 4761 for securing the control plane\n   and protecting the\
    \ forwarding path apply equally to L2VPNs, as do the\n   remarks regarding multi-AS\
    \ operation.  The mitigation strategies and\n   the analogies with RFC 4364 [RFC4364]\
    \ also apply here.\n   RFC 4761 perhaps should have discussed Denial-of-Service\
    \ attacks\n   based on the fact that VPLS PEs have to learn Media Access Control\n\
    \   (MAC) addresses and replicate packets (for flooding and multicast).\n   However,\
    \ those considerations don't apply here, as neither of those\n   actions are required\
    \ of PEs implementing the procedures in this\n   document.\n"
- title: 7.  IANA Considerations
  contents:
  - "7.  IANA Considerations\n   IANA has created two new registries: the first is\
    \ for the one-octet\n   Encaps Type field of the L2-info extended community. \
    \ The name of the\n   registry is \"BGP Layer 2 Encapsulation Types\"; the values\
    \ already\n   allocated are in Table 1 of Section 3.  The allocation policy for\
    \ new\n   entries up to and including value 127 is \"Expert Review\" [RFC5226].\n\
    \   The allocation policy for values 128 through 251 is \"First Come First\n \
    \  Served\".  The values from 252 through 255 are for \"Experimental Use\".\n\
    \   The second registry is for the one-octet Type field of the TLVs of\n   the\
    \ VPLS NLRI.  The name of the registry is \"BGP L2 TLV Types\"; the\n   sole allocated\
    \ value is in Table 2 of Section 3.  The allocation\n   policy for new entries\
    \ up to and including value 127 is \"Expert\n   Review\".  The allocation policy\
    \ for values 128 through 251 is \"First\n   Come First Served\".  The values from\
    \ 252 through 255 are for\n   \"Experimental Use\".\n"
- title: 8.  Acknowledgments
  contents:
  - "8.  Acknowledgments\n   The authors would like to thank Chaitanya Kodeboyina,\
    \ Dennis\n   Ferguson, Der-Hwa Gan, Dave Katz, Nischal Sheth, John Stewart, and\n\
    \   Paul Traina for the enlightening discussions that helped shape the\n   ideas\
    \ presented here.  The authors also thank Ross Callon for his\n   valuable comments.\n\
    \   The idea of using extended communities for more general connectivity\n   of\
    \ a Layer 2 VPN was a contribution by Yakov Rekhter, who also gave\n   many useful\
    \ comments on the text.  Many thanks to him.\n"
- title: 9.  Contributors
  contents:
  - "9.  Contributors\n   The following individuals contributed to this document.\n\
    \   Manoj Leelanivas, Juniper Networks\n   Quaizar Vohra, Juniper Networks\n \
    \  Javier Achirica, Consultant\n   Ronald Bonica, Juniper Networks\n   Dave Cooper,\
    \ Global Crossing\n   Chris Liljenstolpe, Telstra\n   Eduard Metz, KPN Dutch Telecom\n\
    \   Hamid Ould-Brahim, Nortel\n   Chandramouli Sargor\n   Himanshu Shah, Ciena\n\
    \   Vijay Srinivasan\n   Zhaohui Zhang, Juniper Networks\n"
- title: 10.  References
  contents:
  - '10.  References

    '
- title: 10.1.  Normative References
  contents:
  - "10.1.  Normative References\n   [RFC2119]  Bradner, S., \"Key words for use in\
    \ RFCs to Indicate\n              Requirement Levels\", BCP 14, RFC 2119, March\
    \ 1997.\n   [RFC4360]  Sangli, S., Tappan, D., and Y. Rekhter, \"BGP Extended\n\
    \              Communities Attribute\", RFC 4360, February 2006.\n   [RFC4364]\
    \  Rosen, E. and Y. Rekhter, \"BGP/MPLS IP Virtual Private\n              Networks\
    \ (VPNs)\", RFC 4364, February 2006.\n   [RFC4446]  Martini, L., \"IANA Allocations\
    \ for Pseudowire Edge to Edge\n              Emulation (PWE3)\", BCP 116, RFC\
    \ 4446, April 2006.\n   [RFC4448]  Martini, L., Rosen, E., El-Aawar, N., and G.\
    \ Heron,\n              \"Encapsulation Methods for Transport of Ethernet over\
    \ MPLS\n              Networks\", RFC 4448, April 2006.\n   [RFC4618]  Martini,\
    \ L., Rosen, E., Heron, G., and A. Malis,\n              \"Encapsulation Methods\
    \ for Transport of PPP/High-Level\n              Data Link Control (HDLC) over\
    \ MPLS Networks\", RFC 4618,\n              September 2006.\n   [RFC4619]  Martini,\
    \ L., Kawa, C., and A. Malis, \"Encapsulation\n              Methods for Transport\
    \ of Frame Relay over Multiprotocol\n              Label Switching (MPLS) Networks\"\
    , RFC 4619,\n              September 2006.\n   [RFC4717]  Martini, L., Jayakumar,\
    \ J., Bocci, M., El-Aawar, N.,\n              Brayley, J., and G. Koleyni, \"\
    Encapsulation Methods for\n              Transport of Asynchronous Transfer Mode\
    \ (ATM) over MPLS\n              Networks\", RFC 4717, December 2006.\n   [RFC4761]\
    \  Kompella, K. and Y. Rekhter, \"Virtual Private LAN Service\n              (VPLS)\
    \ Using BGP for Auto-Discovery and Signaling\",\n              RFC 4761, January\
    \ 2007.\n   [RFC5226]  Narten, T. and H. Alvestrand, \"Guidelines for Writing\
    \ an\n              IANA Considerations Section in RFCs\", BCP 26, RFC 5226,\n\
    \              May 2008.\n"
- title: 10.2.  Informative References
  contents:
  - "10.2.  Informative References\n   [Kosiur]   Kosiur, D., \"Building and Managing\
    \ Virtual Private\n              Networks\", Wiley Computer Publishing, 1998.\n\
    \   [RFC3985]  Bryant, S. and P. Pate, \"Pseudo Wire Emulation Edge-to-\n    \
    \          Edge (PWE3) Architecture\", RFC 3985, March 2005.\n   [RFC4447]  Martini,\
    \ L., Rosen, E., El-Aawar, N., Smith, T., and G.\n              Heron, \"Pseudowire\
    \ Setup and Maintenance Using the Label\n              Distribution Protocol (LDP)\"\
    , RFC 4447, April 2006.\n   [RFC4684]  Marques, P., Bonica, R., Fang, L., Martini,\
    \ L., Raszuk,\n              R., Patel, K., and J. Guichard, \"Constrained Route\n\
    \              Distribution for Border Gateway Protocol/MultiProtocol\n      \
    \        Label Switching (BGP/MPLS) Internet Protocol (IP) Virtual\n         \
    \     Private Networks (VPNs)\", RFC 4684, November 2006.\n   [RFC4762]  Lasserre,\
    \ M. and V. Kompella, \"Virtual Private LAN Service\n              (VPLS) Using\
    \ Label Distribution Protocol (LDP) Signaling\",\n              RFC 4762, January\
    \ 2007.\n   [RFC6074]  Rosen, E., Davie, B., Radoaca, V., and W. Luo,\n      \
    \        \"Provisioning, Auto-Discovery, and Signaling in Layer 2\n          \
    \    Virtual Private Networks (L2VPNs)\", RFC 6074,\n              January 2011.\n"
- title: Authors' Addresses
  contents:
  - "Authors' Addresses\n   Kireeti Kompella\n   Juniper Networks\n   1194 N. Mathilda\
    \ Ave.\n   Sunnyvale, CA  94089\n   USA\n   EMail: kireeti@juniper.net\n   Bhupesh\
    \ Kothari\n   Cisco Systems\n   3750 Cisco Way\n   San Jose, CA  95134\n   USA\n\
    \   EMail: bhupesh@cisco.com\n   Rao Cherukuri\n   Juniper Networks\n   1194 N.\
    \ Mathilda Ave.\n   Sunnyvale, CA  94089\n   USA\n   EMail: cherukuri@juniper.net\n"
