- contents:
  - '               LDP Downstream-on-Demand in Seamless MPLS

    '
  title: __initial_text__
- contents:
  - "Abstract\n   Seamless MPLS design enables a single IP/MPLS network to scale over\n
    \  core, metro, and access parts of a large packet network\n   infrastructure
    using standardized IP/MPLS protocols.  One of the key\n   goals of Seamless MPLS
    is to meet requirements specific to access\n   networks including high number
    of devices, device position in network\n   topology, and compute and memory constraints
    that limit the amount of\n   state access devices can hold.  This can be achieved
    with LDP\n   Downstream-on-Demand (DoD) label advertisement.  This document\n
    \  describes LDP DoD use cases and lists required LDP DoD procedures in\n   the
    context of Seamless MPLS design.\n   In addition, a new optional TLV type in the
    LDP Label Request message\n   is defined for fast-up convergence.\n"
  title: Abstract
- contents:
  - "Status of This Memo\n   This is an Internet Standards Track document.\n   This
    document is a product of the Internet Engineering Task Force\n   (IETF).  It represents
    the consensus of the IETF community.  It has\n   received public review and has
    been approved for publication by the\n   Internet Engineering Steering Group (IESG).
    \ Further information on\n   Internet Standards is available in Section 2 of RFC
    5741.\n   Information about the current status of this document, any errata,\n
    \  and how to provide feedback on it may be obtained at\n   http://www.rfc-editor.org/info/rfc7032.\n"
  title: Status of This Memo
- contents:
  - "Copyright Notice\n   Copyright (c) 2013 IETF Trust and the persons identified
    as the\n   document authors.  All rights reserved.\n   This document is subject
    to BCP 78 and the IETF Trust's Legal\n   Provisions Relating to IETF Documents\n
    \  (http://trustee.ietf.org/license-info) in effect on the date of\n   publication
    of this document.  Please review these documents\n   carefully, as they describe
    your rights and restrictions with respect\n   to this document.  Code Components
    extracted from this document must\n   include Simplified BSD License text as described
    in Section 4.e of\n   the Trust Legal Provisions and are provided without warranty
    as\n   described in the Simplified BSD License.\n"
  title: Copyright Notice
- contents:
  - "Table of Contents\n   1. Introduction ....................................................4\n
    \  2. Reference Topologies ............................................6\n      2.1.
    Access Topologies with Static Routing ......................6\n      2.2. Access
    Topologies with Access IGP .........................10\n   3. LDP DoD Use Cases
    ..............................................11\n      3.1. Initial Network Setup
    .....................................12\n           3.1.1. AN with Static Routing
    .............................12\n           3.1.2. AN with Access IGP .................................13\n
    \     3.2. Service Provisioning and Activation .......................14\n      3.3.
    Service Changes and Decommissioning .......................16\n      3.4. Service
    Failure ...........................................17\n      3.5. Network Transport
    Failure .................................17\n           3.5.1. General Notes ......................................17\n
    \          3.5.2. AN Failure .........................................18\n           3.5.3.
    AN/AGN Link Failure ................................19\n           3.5.4. AGN
    Failure ........................................20\n           3.5.5. AGN Network-Side
    Reachability Failure ..............20\n   4. LDP DoD Procedures .............................................20\n
    \     4.1. LDP Label Distribution Control and Retention Modes ........21\n      4.2.
    LDP DoD Session Negotiation ...............................23\n      4.3. Label
    Request Procedures ..................................23\n           4.3.1. Access
    LSR/ABR Label Request .......................23\n           4.3.2. Label Request
    Retry ................................24\n      4.4. Label Withdraw ............................................25\n
    \     4.5. Label Release .............................................26\n      4.6.
    Local-Repair ..............................................27\n   5. LDP Extension
    for LDP DoD Fast-Up Convergence ..................27\n   6. IANA Considerations
    ............................................29\n      6.1. LDP TLV Type ..............................................29\n
    \  7. Security Considerations ........................................29\n      7.1.
    LDP DoD Native Security Properties ........................30\n      7.2. Data-Plane
    Security .......................................31\n      7.3. Control-Plane Security
    ....................................31\n   8. Acknowledgements ...............................................32\n
    \  9. References .....................................................33\n      9.1.
    Normative References ......................................33\n      9.2. Informative
    References ....................................33\n"
  title: Table of Contents
- contents:
  - "1.  Introduction\n   Seamless MPLS design [SEAMLESS-MPLS] enables a single IP/MPLS
    network\n   to scale over core, metro, and access parts of a large packet network\n
    \  infrastructure using standardized IP/MPLS protocols.  One of the key\n   goals
    of Seamless MPLS is to meet requirements specific to access\n   including high
    number of devices, device position in network\n   topology, and compute and memory
    constraints that limit the amount of\n   state access devices can hold.\n   In
    general, MPLS Label Switching Routers (LSRs) implement either LDP\n   or RSVP
    for MPLS label distribution.\n   The focus of this document is on LDP, as Seamless
    MPLS design does\n   not include a requirement for general-purpose explicit traffic\n
    \  engineering and bandwidth reservation.  This document concentrates on\n   the
    unicast connectivity only.  Multicast connectivity is a subject\n   for further
    study.\n   In Seamless MPLS design [SEAMLESS-MPLS], IP/MPLS protocol\n   optimization
    is possible due to relatively simple access network\n   topologies.  Examples
    of such topologies involving access nodes (ANs)\n   and aggregation nodes (AGNs)
    include:\n   a.  A single AN homed to a single AGN.\n   b.  A single AN dual-homed
    to two AGNs.\n   c.  Multiple ANs daisy-chained via a hub-AN to a single AGN.\n
    \  d.  Multiple ANs daisy-chained via a hub-AN to two AGNs.\n   e.  Two ANs dual-homed
    to two AGNs.\n   f.  Multiple ANs chained in a ring and dual-homed to two AGNs.\n
    \  The amount of IP Routing Information Base (RIB) and Forwarding\n   Information
    Base (FIB) state on ANs can be easily controlled in the\n   listed access topologies
    by using simple IP routing configuration\n   with either static routes or dedicated
    access IGP.  Note that in all\n   of the above topologies, AGNs act as the access
    area border routers\n   (access ABRs) connecting the access topology to the rest
    of the\n   network.  Hence, in many cases, it is sufficient for ANs to have a\n
    \  default route pointing towards AGNs in order to achieve complete\n   network
    connectivity from ANs to the network.\n   However, the amount of MPLS forwarding
    state requires additional\n   consideration.  In general, MPLS routers implement
    LDP Downstream\n   Unsolicited (LDP DU) label advertisements [RFC5036] and advertise\n
    \  MPLS labels for all valid routes in their RIB tables.  This is seen\n   as
    an inadequate approach for ANs, which require a small subset of\n   the total
    routes (and associated labels) based on the required\n   connectivity for the
    provisioned services.  Although filters can be\n   applied to those LDP DU label
    advertisements, it is not seen as a\n   suitable tool to facilitate any-to-any
    AN-driven connectivity between\n   access and the rest of the MPLS network.\n
    \  This document describes an AN-driven \"subscription model\" for label\n   distribution
    in the access network.  The approach relies on the\n   standard LDP DoD label
    advertisements as specified in [RFC5036].  LDP\n   DoD enables on-demand label
    distribution ensuring that only required\n   labels are requested, provided, and
    installed.  Procedures described\n   in this document are equally applicable to
    LDP IPv4 and IPv6 address\n   families.  For simplicity, the document provides
    examples based on\n   the LDP IPv4 address family.\n   The following sections
    describe a set of reference access topologies\n   considered for LDP DoD usage
    and their associated IP routing\n   configurations, followed by LDP DoD use cases
    and LDP DoD procedures\n   in the context of Seamless MPLS design.\n   The key
    words \"MUST\", \"MUST NOT\", \"REQUIRED\", \"SHALL\", \"SHALL NOT\",\n   \"SHOULD\",
    \"SHOULD NOT\", \"RECOMMENDED\", \"MAY\", and \"OPTIONAL\" in this\n   document
    are to be interpreted as described in [RFC2119].\n"
  title: 1.  Introduction
- contents:
  - "2.  Reference Topologies\n   LDP DoD use cases are described in the context of
    a generic reference\n   end-to-end network topology based on Seamless MPLS design\n
    \  [SEAMLESS-MPLS] as shown in Figure 1.\n                 +-------+  +-------+
    \ +------+  +------+\n              ---+ AGN11 +--+ AGN21 +--+ ABR1 +--+ LSR1
    +--> to LSR/AGN\n   +--------+/   +-------+  +-------+  +------+  +------+\n   |
    Access |             \\/                   \\/\n   | Network|             /\\
    \                  /\\\n   +--------+    +-------+  +-------+  +------+  +------+\n
    \            \\---+ AGN12 +--+ AGN22 +--+ ABR2 +--+ LSR2 +--> to LSR/AGN\n                 +-------+
    \ +-------+  +------+  +------+\n      static routes\n      or access IGP        IGP
    area             IGP area\n     <----Access----><--Aggregation Domain--><----Core----->\n
    \    <------------------------- MPLS ---------------------->\n       Figure 1:
    Seamless MPLS End-to-End Reference Network Topology\n   The access network is
    either single- or dual-homed to AGN1x, with\n   either a single parallel link
    or multiple parallel links to AGN1x.\n   Seamless MPLS access network topologies
    can range from a single- or\n   dual-homed access node to a chain or ring of access
    nodes, and it can\n   use either static routing or access IGP (IS-IS or OSPF).
    \ The\n   following sections describe reference access topologies in more\n   detail.\n"
  - contents:
    - "2.1.  Access Topologies with Static Routing\n   In most cases, access nodes
      connect to the rest of the network using\n   very simple topologies.  Here,
      static routing is sufficient to\n   provide the required IP connectivity.  The
      following topologies are\n   considered for use with static routing and LDP
      DoD:\n   a.  [I1] topology - a single AN homed to a single AGN.\n   b.  [I]
      topology - multiple ANs daisy-chained to a single AGN.\n   c.  [V] topology
      - a single AN dual-homed to two AGNs.\n   d.  [U2] topology - two ANs dual-homed
      to two AGNs.\n   e.  [Y] topology - multiple ANs daisy-chained to two AGNs.\n
      \  The reference static routing and LDP configuration for [V] access\n   topology
      is shown in Figure 2.  The same static routing and LDP\n   configuration also
      applies to the [I1] topology.\n          +----+                        +-------+\n
      \         |AN1 +------------------------+ AGN11 +-------\n          |    +-------\\
      \   /-----------+       +-\\    /\n          +----+        \\  /            +-------+
      \ \\  /\n                         \\/                         \\/\n                         /\\
      \                        /\\\n          +----+        /  \\            +-------+
      \ /  \\\n          |AN2 +-------/    \\-----------+ AGN12 +-/    \\\n          |
      \   +------------------------+       +-------\n          +----+                        +-------+\n
      \         --(u)->                        <-(d)--\n             <----- static
      routing -------> <------ IGP ------>\n                                            <----
      LDP DU ----->\n             <--------- LDP DoD ----------> <-- labeled BGP -->\n
      \     (u) static routes: 0/0 default, (optional) /32 routes\n      (d) static
      routes: AN loopbacks\n             Figure 2: [V] Access Topology with Static
      Routes\n   In line with the Seamless MPLS design, static routes configured on\n
      \  AGN1x and pointing towards the access network are redistributed in\n   either
      IGP or BGP labeled IP routes [RFC3107].\n   The reference static routing and
      LDP configuration for [U2] access\n   topology is shown in Figure 3.\n             +----+
      \                       +-------+\n       (d1)  |AN1 +------------------------+
      AGN11 +-------\n        |    |    +                        +       +-\\    /\n
      \       v    +-+--+                        +-------+  \\  /\n               |
      \                                      \\/\n               |                                       /\\\n
      \       ^    +-+--+                        +-------+  /  \\\n        |    |AN2
      +                        + AGN12 +-/    \\\n       (d2)  |    +------------------------+
      \      +-------\n             +----+                        +-------+\n             --(u)->
      \                       <-(d)--\n                <----- static routing ------->
      <------ IGP ------>\n                                               <---- LDP
      DU ----->\n                <--------- LDP DoD ----------> <-- labeled BGP -->\n
      \   (u)  static route 0/0 default, (optional) /32 routes\n    (d)  static route
      for AN loopbacks\n    (d1) static route for AN2 loopback and 0/0 default with\n
      \        lower preference\n    (d2) static route for AN1 loopback and 0/0 default
      with\n         lower preference\n             Figure 3: [U2] Access Topology
      with Static Routes\n   The reference static routing and LDP configuration for
      [Y] access\n   topology is shown in Figure 4.  The same static routing and LDP\n
      \  configuration also applies to the [I] topology.\n                                       +-------+\n
      \                                      |       |---/\n                                  /----+
      AGN11 |\n    +----+   +----+   +----+     /     |       |---\\\n    |    |   |
      \   |   |    +----/      +-------+\n    |ANn +...|AN2 +---+AN1 |\n    |    |
      \  |    |   |    +----\\      +-------+\n    +----+   +----+   +----+     \\
      \    |       |---/\n                                  \\----+ AGN12 |\n           <-(d2)--
      \ <-(d1)--          |       |---\\\n    --(u)-> --(u)->   --(u)->          +-------+\n
      \                                      <-(d)--\n        <------- static routing
      --------> <------ IGP ------>\n                                          <----
      LDP DU ----->\n        <----------- LDP DoD -----------> <-- labeled BGP -->\n
      \    (u)  static routes: 0/0 default, (optional) /32 routes\n     (d)  static
      routes: AN loopbacks [1..n]\n     (d1) static routes: AN loopbacks [2..n]\n
      \    (d2) static routes: AN loopbacks [3..n]\n             Figure 4: [Y] Access
      Topology with Static Routes\n   Note that in all of the above topologies, parallel
      Equal-Cost\n   Multipath (ECMP) (or Layer 2 Link Aggregation Group (L2 LAG))
      links\n   can be used between the nodes.\n   ANs support Inter-area LDP [RFC5283]
      in order to use the IP default\n   route to match the LDP Forwarding Equivalence
      Class (FEC) advertised\n   by AGN1x and other ANs.\n"
    title: 2.1.  Access Topologies with Static Routing
  - contents:
    - "2.2.  Access Topologies with Access IGP\n   A dedicated access IGP instance
      is used in the access network to\n   perform the internal routing between AGN1x
      and connected AN devices.\n   Examples of such an IGP could be IS-IS, OSPFv2
      and v3, or RIPv2 and\n   RIPng.  This access IGP instance is distinct from the
      IGP of the\n   aggregation domain.\n   The following topologies are considered
      for use with access IGP\n   routing and LDP DoD:\n   a.  [U] topology - multiple
      ANs chained in an open ring and dual-\n       homed to two AGNs.\n   b.  [Y]
      topology - multiple ANs daisy-chained via a hub-AN to two\n       AGNs.\n   The
      reference access IGP and LDP configuration for [U] access\n   topology is shown
      in Figure 5.\n                                       +-------+\n        +-----+
      \  +-----+   +----+     |       +---/\n        | AN3 |---| AN2 |---|AN1 +-----+
      AGN11 |\n        +-----+   +-----+   +----+     |       +---\\\n           .
      \                          +-------+\n           .\n           .                           +-------+\n
      \       +-----+   +-----+   +----+     |       +---/\n        |ANn-2|---|ANn-1|---|ANn
      +-----+ AGN12 |\n        +-----+   +-----+   +----+     |       +---\\\n                                       +-------+\n
      \       <---------- access IGP ------------> <------ IGP ------>\n                                             <----
      LDP DU ----->\n        <------------ LDP DoD -------------> <-- labeled BGP
      -->\n               Figure 5: [U] Access Topology with Access IGP\n   The reference
      access IGP and LDP configuration for [Y] access\n   topology is shown in Figure
      6.\n                                           +-------+\n                                           |
      \      |---/\n                                      /----+ AGN11 |2\n        +----+
      \  +----+   +----+     /     |       |---\\\n        |    |   |    |   |    +----/
      \     +-------+\n        |ANn +...|AN2 +---+AN1 |\n        |    |   |    |   |
      \   +----\\      +-------+\n        +----+   +----+   +----+     \\     |       |---/\n
      \                                     \\----+ AGN12 |\n                                           |
      \      |---\\\n                                           +-------+\n        <----------
      access IGP ------------> <------ IGP ------>\n                                             <----
      LDP DU ----->\n        <------------ LDP DoD -------------> <-- labeled BGP
      -->\n               Figure 6: [Y] Access Topology with Access IGP\n   Note that
      in all of the above topologies, parallel ECMP (or L2 LAG)\n   links can be used
      between the nodes.\n   In both of the above topologies, ANs (ANn ... AN1) and
      AGN1x share\n   the access IGP and advertise their IPv4 and IPv6 loopbacks and
      link\n   addresses.  AGN1x advertises a default route into the access IGP.\n
      \  ANs support Inter-area LDP [RFC5283] in order to use the IP default\n   route
      for matching the LDP FECs advertised by AGN1x or other ANs.\n"
    title: 2.2.  Access Topologies with Access IGP
  title: 2.  Reference Topologies
- contents:
  - "3.  LDP DoD Use Cases\n   LDP DoD use cases described in this document are based
    on the\n   Seamless MPLS scenarios listed in Seamless MPLS design\n   [SEAMLESS-MPLS].
    \ This section illustrates these use cases focusing\n   on services provisioned
    on the access nodes and clarifies expected\n   LDP DoD operation on the AN and
    AGN1x devices.  Two representative\n   service types are used to illustrate the
    service use cases: MPLS\n   Pseudowire Edge-to-Edge (PWE3) [RFC4447] and BGP/MPLS
    IP VPN\n   [RFC4364].\n   Described LDP DoD operations apply equally to all reference
    access\n   topologies described in Section 2.  Operations that are specific to\n
    \  certain access topologies are called out explicitly.\n   References to upstream
    and downstream nodes are made in line with the\n   definition of upstream and
    downstream LSRs [RFC3031].\n"
  - contents:
    - "3.1.  Initial Network Setup\n   An access node is commissioned without any
      services provisioned on\n   it.  The AN can request labels for loopback addresses
      of any AN, AGN,\n   or other nodes within the Seamless MPLS network for operational
      and\n   management purposes.  It is assumed that AGN1x has the required\n   IP/MPLS
      configuration for network-side connectivity in line with\n   Seamless MPLS design
      [SEAMLESS-MPLS].\n   LDP sessions are configured between adjacent ANs and AGN1x
      using\n   their respective loopback addresses.\n"
    - contents:
      - "3.1.1.  AN with Static Routing\n   If access static routing is used, ANs
        are provisioned with the\n   following static IP routing entries (topology
        references from\n   Section 2 are listed in square brackets):\n   a.  [I1,
        V, U2] - Static default route 0/0 pointing to links\n       connected to AGN1x.
        \ Requires support for Inter-area LDP\n       [RFC5283].\n   b.  [U2] - Static
        /32 routes pointing to the other AN.  Lower\n       preference static default
        route 0/0 pointing to links connected\n       to the other AN.  Requires support
        for Inter-area LDP [RFC5283].\n   c.  [I, Y] - Static default route 0/0 pointing
        to links leading\n       towards AGN1x.  Requires support for Inter-area LDP
        [RFC5283].\n   d.  [I, Y] - Static /32 routes to all ANs in the daisy-chain
        pointing\n       to links towards those ANs.\n   e.  [I1, V, U2] - Optional
        - Static /32 routes for specific nodes\n       within the Seamless MPLS network,
        pointing to links connected to\n       AGN1x.\n   f.  [I, Y] - Optional -
        Static /32 routes for specific nodes within\n       the Seamless MPLS network,
        pointing to links leading towards\n       AGN1x.\n   The upstream AN/AGN1x
        requests labels over an LDP DoD session(s) from\n   downstream AN/AGN1x for
        configured static routes if those static\n   routes are configured with an
        LDP DoD request policy and if they are\n   pointing to a next hop selected
        by routing.  It is expected that all\n   configured /32 static routes to be
        used for LDP DoD are configured\n   with such a policy on an AN/AGN1x.\n   The
        downstream AN/AGN1x responds to the Label Request from the\n   upstream AN/AGN1x
        with a label mapping if the requested route is\n   present in its RIB and
        there is a valid label binding from its\n   downstream neighbor or if it is
        the egress node.  In such a case, the\n   downstream AN/AGN1x installs the
        advertised label as an incoming\n   label in its label information base (LIB)
        and its label forwarding\n   information base (LFIB).  The upstream AN/AGN1x
        also installs the\n   received label as an outgoing label in its LIB and LFIB.
        \ If the\n   downstream AN/AGN1x does have the route present in its RIB, but
        does\n   not have a valid label binding from its downstream neighbor, it\n
        \  forwards the request to its downstream neighbor.\n   In order to facilitate
        ECMP and IP Fast Reroute (IPFRR) Loop-Free\n   Alternate (LFA) local-repair
        [RFC5286], the upstream AN/AGN1x also\n   sends LDP DoD Label Requests to
        alternate next hops per its RIB, and\n   installs received labels as alternate
        entries in its LIB and LFIB.\n   The AGN1x on the network side can use BGP
        labeled IP routes [RFC3107]\n   in line with the Seamless MPLS design [SEAMLESS-MPLS].
        \ In such a\n   case, AGN1x will redistribute its static routes pointing to
        local ANs\n   into BGP labeled IP routes to facilitate network-to-access traffic\n
        \  flows.  Likewise, to facilitate access-to-network traffic flows,\n   AGN1x
        will respond to access-originated LDP DoD Label Requests with\n   label mappings
        based on its BGP labeled IP routes reachability for\n   requested FECs.\n"
      title: 3.1.1.  AN with Static Routing
    - contents:
      - "3.1.2.  AN with Access IGP\n   If access IGP is used, an AN(s) advertises
        its loopbacks over the\n   access IGP with configured metrics.  The AGN1x
        advertises a default\n   route over the access IGP.\n   Routers request labels
        over LDP DoD session(s) according to their\n   needs for MPLS connectivity
        (via Label Switching Paths (LSPs)).  In\n   particular, if AGNs, as per Seamless
        MPLS design [SEAMLESS-MPLS],\n   redistribute routes from the IGP into BGP
        labeled IP routes\n   [RFC3107], they request labels over LDP DoD session(s)
        for those\n   routes.\n   Identical to the static route case, the downstream
        AN/AGN1x responds\n   to the Label Request from the upstream AN/AGN1x with
        a label mapping\n   (if the requested route is present in its RIB and there
        is a valid\n   label binding from its downstream neighbor), and installs the\n
        \  advertised label as an incoming label in its LIB and LFIB.  The\n   upstream
        AN/AGN1x also installs the received label as an outgoing\n   label in its
        LIB and LFIB.\n   Identical to the static route case, in order to facilitate
        ECMP and\n   IPFRR LFA local-repair, the upstream AN/AGN1x also sends LDP
        DoD\n   Label Requests to alternate next hops per its RIB, and it installs\n
        \  received labels as alternate entries in its LIB and LFIB.\n   The AGN1x
        on the network side can use labeled BGP [RFC3107] in line\n   with Seamless
        MPLS design [SEAMLESS-MPLS].  In such a case, AGN1x\n   will redistribute
        routes received over the access IGP (and pointing\n   to local ANs), into
        BGP labeled IP routes to facilitate network-to-\n   access traffic flows.
        \ Likewise, to facilitate access-to-network\n   traffic flows, the AGN1x will
        respond to access-originated LDP DoD\n   Label Requests with label mappings
        based on its BGP labeled IP routes\n   reachability for requested FECs.\n"
      title: 3.1.2.  AN with Access IGP
    title: 3.1.  Initial Network Setup
  - contents:
    - "3.2.  Service Provisioning and Activation\n   Following the initial setup phase
      described in Section 3.1, a\n   specific access node, referred to as AN*, is
      provisioned with a\n   network service.  AN* relies on LDP DoD to request the
      required MPLS\n   LSP(s) label(s) from the downstream AN/AGN1x node(s).  Note
      that LDP\n   DoD operations are service agnostic; that is, they are the same\n
      \  independently of the services provisioned on the AN*.\n   For illustration
      purposes, two service types are described: MPLS PWE3\n   [RFC4447] service and
      BGP/MPLS IPVPN [RFC4364].\n   MPLS PWE3 service: For description simplicity,
      it is assumed that a\n   single segment pseudowire is signaled using targeted
      LDP (tLDP)\n   FEC128 (0x80), and it is provisioned with the pseudowire ID and
      the\n   loopback IPv4 address of the destination node.  The following IP/MPLS\n
      \  operations need to be completed on the AN* to successfully establish\n   such
      PWE3 service:\n   a.  LSP labels for destination /32 FEC (outgoing label) and
      the local\n       /32 loopback (incoming label) need to be signaled using LDP
      DoD.\n   b.  A tLDP session over an associated TCP/IP connection needs to be\n
      \      established to the PWE3 destination Provider Edge (PE).  This is\n       triggered
      either by an explicit tLDP session configuration on the\n       AN* or automatically
      at the time of provisioning the PWE3\n       instance.\n   c.  Local and remote
      PWE3 labels for specific FEC128 PW ID need to be\n       signaled using tLDP
      and PWE3 signaling procedures [RFC4447].\n   d.  Upon successful completion
      of the above operations, AN* programs\n       its RIB/LIB and LFIB tables and
      activates the MPLS PWE3 service.\n   Note: Only minimum operations applicable
      to service connectivity have\n   been listed.  Other non-IP/non-MPLS connectivity
      operations that are\n   required for successful service provisioning and activation
      are out\n   of scope in this document.\n   BGP/MPLS IPVPN service: For description
      simplicity, it is assumed\n   that the AN* is provisioned with a unicast IPv4
      IPVPN service (VPNv4\n   for short) [RFC4364].  The following IP/MPLS operations
      need to be\n   completed on the AN* to successfully establish VPNv4 service:\n
      \  a.  BGP peering sessions with associated TCP/IP connections need to\n       be
      established with the remote destination VPNv4 PEs or Route\n       Reflectors.\n
      \  b.  Based on configured BGP policies, VPNv4 BGP Network Layer\n       Reachability
      Information (NLRI) needs to be exchanged between AN*\n       and its BGP peers.\n
      \  c.  Based on configured BGP policies, VPNv4 routes need to be\n       installed
      in the AN* VPN Routing and Forwarding (VRF) RIB and\n       FIB, with corresponding
      BGP next hops.\n   d.  LSP labels for destination BGP next-hop /32 FEC (outgoing
      label)\n       and the local /32 loopback (incoming label) need to be signaled\n
      \      using LDP DoD.\n   e.  Upon successful completion of above operations,
      AN* programs its\n       RIB/LIB and LFIB tables, and activates the BGP/MPLS
      IPVPN\n       service.\n   Note: Only minimum operations applicable to service
      connectivity have\n   been listed.  Other non-IP/-MPLS connectivity operations
      that are\n   required for successful service provisioning are out of scope in
      this\n   document.\n   To establish an LSP for destination /32 FEC for any of
      the above\n   services, AN* looks up its local routing table for a matching
      route\n   and selects the best next hop(s) and associated outgoing link(s).\n
      \  If a label for this /32 FEC is not already installed based on the\n   configured
      static route with LDP DoD request policy or access IGP RIB\n   entry, AN* sends
      an LDP DoD label mapping request.  A downstream\n   AN/AGN1x LSR(s) checks its
      RIB for presence of the requested /32 and\n   associated valid outgoing label
      binding, and if both are present,\n   replies with its label for this FEC and
      installs this label as\n   incoming in its LIB and LFIB.  Upon receiving the
      label mapping, the\n   AN* accepts this label based on the exact route match
      of the\n   advertised FEC and route entry in its RIB or based on the longest\n
      \  match in line with Inter-area LDP [RFC5283].  If the AN* accepts the\n   label,
      it installs it as an outgoing label in its LIB and LFIB.\n   In access topologies
      [V] and [Y], if AN* is dual-homed to two AGN1x\n   and routing entries for these
      AGN1x's are configured as equal-cost\n   paths, AN* sends LDP DoD Label Requests
      to both AGN1x devices and\n   installs all received labels in its LIB and LFIB.\n
      \  In order for AN* to implement IPFRR LFA local-repair, AN* also sends\n   LDP
      DoD Label Requests to alternate next hops per its RIB, and\n   installs received
      labels as alternate entries in its LIB and LFIB.\n   When forwarding PWE3 or
      VPNv4 packets, AN* chooses the LSP label\n   based on the locally configured
      static /32 or default route or\n   default route signaled via access IGP.  If
      a route is reachable via\n   multiple interfaces to AGN1x nodes and the route
      has multiple equal-\n   cost paths, AN* implements ECMP functionality.  This
      involves AN*\n   using a hash-based load-balancing mechanism and sending the
      PWE3 or\n   VPNv4 packets in a flow-aware manner with appropriate LSP labels
      via\n   all equal-cost links.\n   The ECMP mechanism is applicable in an equal
      manner to parallel links\n   between two network elements and multiple paths
      towards the\n   destination.  The traffic demand is distributed over the available\n
      \  paths.\n   The AGN1x on the network side can use labeled BGP [RFC3107] in
      line\n   with Seamless MPLS design [SEAMLESS-MPLS].  In such a case, the AGN1x\n
      \  will redistribute its static routes (or routes received from the\n   access
      IGP) pointing to local ANs into BGP labeled IP routes to\n   facilitate network-to-access
      traffic flows.  Likewise, to facilitate\n   access-to-network traffic flows,
      the AGN1x will respond to access-\n   originated LDP DoD Label Requests with
      label mappings based on its\n   BGP labeled IP routes reachability for requested
      FECs.\n"
    title: 3.2.  Service Provisioning and Activation
  - contents:
    - "3.3.  Service Changes and Decommissioning\n   Whenever the AN* service gets
      decommissioned or changed and\n   connectivity to a specific destination is
      no longer required, the\n   associated MPLS LSP label resources are to be released
      on AN*.\n   MPLS PWE3 service: If the PWE3 service gets decommissioned and it
      is\n   the last PWE3 to a specific destination node, the tLDP session is no\n
      \  longer needed and is to be terminated (automatically or by\n   configuration).
      \ The MPLS LSP(s) to that destination is no longer\n   needed either.\n   BGP/MPLS
      IPVPN service: Deletion of a specific VPNv4 (VRF) instance\n   via local or
      remote reconfiguration can result in a specific BGP next\n   hop(s) no longer
      being needed.  The MPLS LSP(s) to that destination\n   is no longer needed either.\n
      \  In all of the above cases, the following operations related to LDP\n   DoD
      apply:\n   o  If the /32 FEC label for the aforementioned destination node was\n
      \     originally requested based on either tLDP session configuration\n      and
      default route or required BGP next hop and default route, AN*\n      deletes
      the label from its LIB and LFIB, and releases it from the\n      downstream
      AN/AGN1x by using LDP DoD procedures.\n   o  If the /32 FEC label was originally
      requested based on the static\n      /32 route configuration with LDP DoD request
      policy, the label is\n      retained by AN*.\n"
    title: 3.3.  Service Changes and Decommissioning
  - contents:
    - "3.4.  Service Failure\n   A service instance can stop being operational due
      to a local or\n   remote service failure event.\n   In general, unless the service
      failure event modifies required MPLS\n   connectivity, there is no impact on
      the LDP DoD operation.\n   If the service failure event does modify the required
      MPLS\n   connectivity, LDP DoD operations apply as described in Sections 3.2\n
      \  and 3.3.\n"
    title: 3.4.  Service Failure
  - contents:
    - "3.5.  Network Transport Failure\n   A number of different network events can
      impact services on AN*.  The\n   following sections describe network event types
      that impact LDP DoD\n   operation on AN and AGN1x nodes.\n"
    - contents:
      - "3.5.1.  General Notes\n   If service on any of the ANs is affected by any
        network failure and\n   there is no network redundancy, the service goes into
        a failure\n   state.  Upon recovery from network failure, the service is to
        be\n   re-established automatically.\n   The following additional LDP-related
        functions need to be supported\n   to comply with Seamless MPLS [SEAMLESS-MPLS]
        fast service restoration\n   requirements:\n   a.  Local-repair: AN and AGN1x
        support local-repair for adjacent link\n       or node failure for access-to-network,
        network-to-access, and\n       access-to-access traffic flows.  Local-repair
        is to be\n       implemented by using either IPFRR LDP LFA, simple ECMP, or\n
        \      primary/backup switchover upon failure detection.\n   b.  LDP session
        protection: LDP sessions are configured with LDP\n       session protection
        to avoid delay upon the recovery from link\n       failure.  LDP session protection
        ensures that FEC label binding\n       is maintained in the control plane
        as long as the LDP session\n       stays up.\n   c.  IGP-LDP synchronization:
        If access IGP is used, LDP sessions\n       between ANs, and between ANs and
        AGN1x, are configured with IGP-\n       LDP synchronization to avoid unnecessary
        traffic loss in case the\n       access IGP converged before LDP and there
        is no LDP label binding\n       to the best downstream next hop.\n"
      title: 3.5.1.  General Notes
    - contents:
      - "3.5.2.  AN Failure\n   If the AN fails, adjacent AN/AGN1x nodes remove all
        routes pointing\n   to the failed node from their RIB tables (including /32
        loopback\n   belonging to the failed AN and any other routes reachable via
        the\n   failed AN).  In turn, this triggers the removal of associated\n   outgoing
        /32 FEC labels from their LIB and LFIB tables.\n   If access IGP is used,
        the AN failure will be propagated via IGP link\n   updates across the access
        topology.\n   If a specific /32 FEC(s) is no longer reachable from those\n
        \  ANs/AGN1x's, they also send LDP Label Withdraw messages to their\n   upstream
        LSRs to notify them about the failure, and remove the\n   associated incoming
        label(s) from their LIB and LFIB tables.\n   Upstream LSRs, upon receiving
        a Label Withdraw, remove the signaled\n   labels from their LIB/LFIB tables,
        and propagate LDP Label Withdraws\n   across their upstream LDP DoD sessions.\n
        \  In the [U] topology, there may be an alternative path to routes\n   previously
        reachable via the failed AN.  In this case, adjacent\n   AN/AGN1x pairs invoke
        local-repair (IPFRR LFA, ECMP) and switch over\n   to an alternate next hop
        to reach those routes.\n   AGN1x is notified about the AN failure via access
        IGP (if used)\n   and/or cascaded LDP DoD Label Withdraw(s).  AGN1x implements
        all\n   relevant global-repair IP/MPLS procedures to propagate the AN failure\n
        \  towards the core network.  This involves removing associated routes\n   (in
        the access IGP case) and labels from its LIB and LFIB tables, and\n   propagating
        the failure on the network side using labeled BGP and/or\n   core IGP/LDP
        DU procedures.\n   Upon the AN coming back up, adjacent AN/AGN1x nodes automatically
        add\n   routes pointing to recovered links based on the configured static\n
        \  routes or access IGP adjacency and link state updates.  This is then\n
        \  followed by LDP DoD label signaling and subsequent binding and\n   installation
        of labels in LIB and LFIB tables.\n"
      title: 3.5.2.  AN Failure
    - contents:
      - "3.5.3.  AN/AGN Link Failure\n   Depending on the access topology and the
        failed link location,\n   different cases apply to the network operation after
        AN link failure\n   (topology references from Section 2 in square brackets):\n
        \  a.  [all] - link failed, but at least one ECMP parallel link remains.\n
        \      Nodes on both sides of the failed link stop using the failed link\n
        \      immediately (local-repair) and keep using the remaining ECMP\n       parallel
        links.\n   b.  [I1, I, Y] - link failed, and there are no ECMP or alternative\n
        \      links and paths.  Nodes on both sides of the failed link remove\n       routes
        pointing to the failed link immediately from the RIB,\n       remove associated
        labels from their LIB and LFIB tables, and send\n       LDP Label Withdraw(s)
        to their upstream LSRs.\n   c.  [U2, U, V, Y] - link failed, but at least
        one ECMP or alternate\n       path remains.  The AN/AGN1x node stops using
        the failed link and\n       immediately switches over (local-repair) to the
        remaining ECMP\n       path or alternate path.  The AN/AGN1x removes affected
        next hops\n       and labels.  If there is an AGN1x terminating the failed
        link, it\n       immediately removes routes pointing to the failed link from
        the\n       RIB, removes any associated labels from the LIB and LFIB tables,\n
        \      and propagates the failure on the network side using labeled BGP\n
        \      and/or core IGP procedures.\n   If access IGP is used, AN/AGN1x link
        failure will be propagated via\n   IGP link updates across the access topology.\n
        \  LDP DoD will also propagate the link failure by sending Label\n   Withdraws
        to upstream AN/AGN1x nodes, and Label Release messages to\n   downstream AN/AGN1x
        nodes.\n"
      title: 3.5.3.  AN/AGN Link Failure
    - contents:
      - "3.5.4.  AGN Failure\n   If an AGN1x fails adjacent access then, depending
        on the access\n   topology, the following cases apply to the network operation\n
        \  (topology references from Section 2 are shown in square brackets):\n   a.
        \ [I1, I] - ANs are isolated from the network - An AN adjacent to\n       the
        failure immediately removes routes pointing to the failed\n       AGN1x from
        the RIB, removes associated labels from the LIB and\n       LFIB tables, and
        sends LDP Label Withdraw message(s) to its\n       upstream neighbors.  If
        access IGP is used, an IGP link update is\n       sent.\n   b.  [U2, U, V,
        Y] - at least one ECMP or alternate path remains.  AN\n       adjacent to
        failed AGN1x stops using the failed link and\n       immediately switches
        over (local-repair) to the remaining ECMP\n       path or alternate path by
        following LDP [RFC5036] procedures.\n       (Appendix A.1.7 \"Detect Change
        in FEC Next Hop\")\n   Network-side procedures for handling AGN1x failure
        have been\n   described in Seamless MPLS [SEAMLESS-MPLS].\n"
      title: 3.5.4.  AGN Failure
    - contents:
      - "3.5.5.  AGN Network-Side Reachability Failure\n   If AGN1x loses network
        reachability to a specific destination or set\n   of network-side destinations,
        AGN1x sends LDP Label Withdraw messages\n   to its upstream ANs, withdrawing
        labels for all affected /32 FECs.\n   Upon receiving those messages, ANs remove
        those labels from their LIB\n   and LFIB tables, and use alternative LSPs
        instead (if available) as\n   part of global-repair.\n   If access IGP is
        used, and AGN1x gets completely isolated from the\n   core network, it stops
        advertising the default route 0/0 into the\n   access IGP.\n"
      title: 3.5.5.  AGN Network-Side Reachability Failure
    title: 3.5.  Network Transport Failure
  title: 3.  LDP DoD Use Cases
- contents:
  - "4.  LDP DoD Procedures\n   All LDP Downstream-on-Demand implementations follow
    the Label\n   Distribution Protocol as specified in [RFC5036].  This section does\n
    \  not update [RFC5036] procedures, but illustrates LDP DoD operations\n   in
    the context of use cases identified in Section 3 in this document,\n   for information
    only.\n   In the MPLS architecture [RFC3031], network traffic flows from the\n
    \  upstream LSR to the downstream LSR.  The use cases in this document\n   rely
    on the downstream assignment of labels, where labels are\n   assigned by the downstream
    LSR and signaled to the upstream LSR as\n   shown in Figure 7.\n                    +----------+
    \     +------------+\n                    | upstream |      | downstream |\n              ------+
    \  LSR    +------+    LSR     +----\n          traffic   |          |      |            |
    \ address\n          source    +----------+      +------------+  (/32 for IPv4)\n
    \                                                     traffic\n                   label
    distribution for IPv4 FEC    destination\n                     <-------------------------\n
    \                           traffic flow\n                     ------------------------->\n
    \                Figure 7: LDP Label Assignment Direction\n"
  - contents:
    - "4.1.  LDP Label Distribution Control and Retention Modes\n   The LDP specification
      [RFC5036] defines two modes for label\n   distribution control, following the
      definitions in the MPLS\n   architecture [RFC3031]:\n   o  Independent mode:
      An LSR recognizes a particular FEC and makes a\n      decision to bind a label
      to the FEC independently from\n      distributing that label binding to its
      label distribution peers.\n      A new FEC is recognized whenever a new route
      becomes valid on the\n      LSR.\n   o  Ordered mode: An LSR needs to bind a
      label to a particular FEC if\n      it knows how to forward packets for that
      FEC (i.e., it has a route\n      corresponding to that FEC) and if it has already
      received at least\n      one Label Request message from an upstream LSR.\n   Using
      independent label distribution control with LDP DoD and access\n   static routing
      would prevent the access LSRs from propagating label\n   binding failure along
      the access topology, making it impossible for\n   an upstream LSR to be notified
      about the downstream failure and for\n   an application using the LSP to switch
      over to an alternate path,\n   even if such a path exists.\n   The LDP specification
      [RFC5036] defines two modes for label\n   retention, following the definitions
      in the MPLS architecture\n   [RFC3031]:\n   o  Conservative label retention
      mode: If operating in DoD mode, an\n      LSR will request label mappings only
      from the next-hop LSR\n      according to routing.  The main advantage of the
      conservative\n      label retention mode is that only the labels that are required
      for\n      the forwarding of data are allocated and maintained.  This is\n      particularly
      important in LSRs where the label space is inherently\n      limited, such as
      in an ATM switch.  A disadvantage of the\n      conservative label retention
      mode is that if routing changes the\n      next hop for a given destination,
      a new label must be obtained\n      from the new next hop before labeled packets
      can be forwarded.\n   o  Liberal label retention mode: When operating in DoD
      mode with\n      liberal label retention mode, an LSR might choose to request
      label\n      mappings for all known prefixes from all peer LSRs.  The main\n
      \     advantage of the liberal label retention mode is that reaction to\n      routing
      changes can be quick because labels already exist.  The\n      main disadvantage
      of the liberal label retention mode is that\n      unneeded label mappings are
      distributed and maintained.\n   Note that the conservative label retention mode
      would prevent LSRs\n   from requesting and maintaining label mappings for any
      backup routes\n   that are not used for forwarding.  In turn, this would prevent
      the\n   access LSRs (AN and AGN1x nodes) from implementing any local\n   protection
      schemes that rely on using alternate next hops in case of\n   the primary next-hop
      failure.  Such schemes include IPFRR LFA if\n   access IGP is used, or a primary
      and backup static route\n   configuration.  Using LDP DoD in combination with
      liberal label\n   retention mode allows the LSR to request labels for the specific
      FEC\n   from primary next-hop LSR(s) and the alternate next-hop LSR(s) for\n
      \  this FEC.\n   Note that even though LDP DoD operates in a liberal label retention\n
      \  mode, if used with access IGP and if no LFA exists, the LDP DoD will\n   introduce
      additional delay in traffic restoration as the labels for\n   the new next hop
      will be requested only after the access IGP\n   convergence.\n   Adhering to
      the overall design goals of Seamless MPLS\n   [SEAMLESS-MPLS], specifically
      achieving a large network scale without\n   compromising fast service restoration,
      all access LSRs (AN and AGN1x\n   nodes) use LDP DoD advertisement mode with:\n
      \  o  Ordered label distribution control: enables propagation of label\n      binding
      failure within the access topology.\n   o  Liberal label retention mode: enables
      pre-programming of alternate\n      next hops with associated FEC labels.\n
      \  In Seamless MPLS [SEAMLESS-MPLS], an AGN1x acts as an access ABR\n   connecting
      access and metro domains.  To enable failure propagation\n   between those domains,
      the access ABR implements ordered label\n   distribution control when redistributing
      routes/FECs between the\n   access side (using LDP DoD and static or access
      IGP) and the network\n   side (using labeled BGP [RFC3107] or core IGP with
      LDP Downstream\n   Unsolicited label advertisements).\n"
    title: 4.1.  LDP Label Distribution Control and Retention Modes
  - contents:
    - "4.2.  LDP DoD Session Negotiation\n   An access LSR/ABR proposes the DoD label
      advertisement by setting the\n   \"A\" value to 1 in the Common Session Parameters
      TLV of the\n   Initialization message.  The rules for negotiating the label\n
      \  advertisement mode are specified in the LDP specification [RFC5036].\n   To
      establish a DoD session between the two access LSR/ABRs, both\n   propose the
      DoD label advertisement mode in the Initialization\n   message.  If the access
      LSR only supports LDP DoD and the access ABR\n   proposes the Downstream Unsolicited
      mode, the access LSR sends a\n   Notification message with status \"Session
      Rejected/Parameters\n   Advertisement Mode\" and then closes the LDP session
      as specified in\n   the LDP specification [RFC5036].\n   If an access LSR is
      acting in an active role, it re-attempts the LDP\n   session immediately.  If
      the access LSR receives the same Downstream\n   Unsolicited mode again, it follows
      the exponential backoff algorithm\n   as defined in the LDP specification [RFC5036]
      with a delay of 15\n   seconds and subsequent delays growing to a maximum delay
      of 2\n   minutes.\n   In case a PWE3 service is required between the adjacent
      access\n   LSR/ABR, and LDP DoD has been negotiated for IPv4 and IPv6 FECs,
      the\n   same LDP session is used for PWE3 FECs.  Even if the LDP DoD label\n
      \  advertisement has been negotiated for IPv4 and IPv6 LDP FECs as\n   described
      earlier, the LDP session uses a Downstream Unsolicited\n   label advertisement
      for PWE3 FECs as specified in PWE3 LDP [RFC4447].\n"
    title: 4.2.  LDP DoD Session Negotiation
  - contents:
    - '4.3.  Label Request Procedures

      '
    - contents:
      - "4.3.1.  Access LSR/ABR Label Request\n   The upstream access LSR/ABR will
        request label bindings from an\n   adjacent downstream access LSR/ABR based
        on the following trigger\n   events:\n   a.  An access LSR/ABR is configured
        with /32 static route with LDP\n       DoD Label Request policy in line with
        the initial network setup\n       use case described in Section 3.1.\n   b.
        \ An access LSR/ABR is configured with a service in line with\n       service
        use cases described in Sections 3.2 and 3.3.\n   c.  Configuration with access
        static routes: An access LSR/ABR link\n       to an adjacent node comes up,
        and an LDP DoD session is\n       established.  In this case, the access LSR
        sends Label Request\n       messages for all /32 static routes configured
        with an LDP DoD\n       policy and all /32 routes related to provisioned services
        that\n       are covered by the default route.\n   d.  Configuration with
        access IGP: An access LSR/ABR link to an\n       adjacent node comes up, and
        an LDP DoD session is established.\n       In this case, the access LSR sends
        Label Request messages for all\n       /32 routes learned over the access
        IGP and all /32 routes related\n       to provisioned services that are covered
        by access IGP routes.\n   e.  In all above cases, requests are sent to any
        next-hop LSRs and\n       alternate LSRs.\n   The downstream access LSR/ABR
        will respond with a Label Mapping\n   message with a non-null label if any
        of the below conditions are met:\n   a.  Downstream access LSR/ABR: The requested
        FEC is an IGP or static\n       route, and there is an LDP label already learned
        from the next-\n       next-hop downstream LSR (by LDP DoD or LDP DU).  If
        there is no\n       label for the requested FEC and there is an LDP DoD session
        to\n       the next-next-hop downstream LSR, the downstream LSR sends a\n
        \      Label Request message for the same FEC to the next-next-hop\n       downstream
        LSR.  In such a case, the downstream LSR will respond\n       back to the
        requesting upstream access LSR only after getting a\n       label from the
        next-next-hop downstream LSR peer.\n   b.  Downstream access ABR only: The
        requested FEC is a BGP labeled IP\n       routes [RFC3107], and this BGP route
        is the best selected for\n       this FEC.\n   The downstream access LSR/ABR
        can respond with a label mapping with\n   an explicit-null or implicit-null
        label if it is acting as an egress\n   for the requested FEC, or it can respond
        with a \"No Route\"\n   notification if no route exists.\n"
      title: 4.3.1.  Access LSR/ABR Label Request
    - contents:
      - "4.3.2.  Label Request Retry\n   Following the LDP specification [RFC5036],
        if an access LSR/ABR\n   receives a \"No Route\" notification in response
        to its Label Request\n   message, it retries using an exponential backoff
        algorithm similar to\n   the backoff algorithm mentioned in the LDP session
        negotiation\n   described in Section 4.2.\n   If there is no response to the
        Label Request message sent, the LDP\n   specification [RFC5036] (Section A.1.1)
        states that the LSR does not\n   send another request for the same label to
        the peer and mandates that\n   a duplicate Label Request be considered a protocol
        error and be\n   dropped by the receiving LSR by sending a Notification message.\n
        \  Thus, if there is no response from the downstream peer, the access\n   LSR/ABR
        does not send a duplicate Label Request message.\n   If the static route corresponding
        to the FEC gets deleted or if the\n   DoD request policy is modified to reject
        the FEC before receiving the\n   Label Mapping message, then the access LSR/ABR
        sends a Label Abort\n   message to the downstream LSR.\n   To address the
        case of slower convergence resulting from described\n   LDP behavior in line
        with the LDP specification [RFC5036], a new LDP\n   TLV extension is proposed
        and described in Section 5.\n"
      title: 4.3.2.  Label Request Retry
    title: 4.3.  Label Request Procedures
  - contents:
    - "4.4.  Label Withdraw\n   If an MPLS label on the downstream access LSR/ABR
      is no longer valid,\n   the downstream access LSR/ABR withdraws this FEC/label
      binding from\n   the upstream access LSR/ABR with the Label Withdraw message
      [RFC5036]\n   with a specified label TLV or with an empty label TLV.\n   The
      downstream access LSR/ABR withdraws a label for a specific FEC in\n   the following
      cases:\n   a.  If an LDP DoD ingress label is associated with an outgoing label\n
      \      assigned by a labeled BGP route and this route is withdrawn.\n   b.  If
      an LDP DoD ingress label is associated with an outgoing label\n       assigned
      by LDP (DoD or DU), and the IGP route is withdrawn from\n       the RIB or the
      downstream LDP session is lost.\n   c.  If an LDP DoD ingress label is associated
      with an outgoing label\n       assigned by LDP (DoD or DU) and the outgoing
      label is withdrawn\n       by the downstream LSR.\n   d.  If an LDP DoD ingress
      label is associated with an outgoing label\n       assigned by LDP (DoD or DU),
      the next hop in the route has\n       changed, and\n       *  there is no LDP
      session to the new next hop.  To minimize the\n          probability of this,
      the access LSR/ABR implements LDP-IGP\n          synchronization procedures
      as specified in [RFC5443].\n       *  there is an LDP session but no label from
      a downstream LSR.\n          See note below.\n   e.  If an access LSR/ABR is
      configured with a policy to reject\n       exporting label mappings to an upstream
      LSR.\n   The upstream access LSR/ABR responds to the Label Withdraw message\n
      \  with the Label Release message [RFC5036].\n   After sending the Label Release
      message to the downstream access\n   LSR/ABR, the upstream access LSR/ABR resends
      the Label Request\n   message, assuming the upstream access LSR/ABR still requires
      the\n   label.\n   The downstream access LSR/ABR withdraws a label if the local
      route\n   configuration (e.g., /32 loopback) is deleted.\n   Note: For any events
      inducing next-hop change, a downstream access\n   LSR/ABR attempts to converge
      the LSP locally before withdrawing the\n   label from an upstream access LSR/ABR.
      \ For example, if the next hop\n   changes for a particular FEC and if the new
      next hop allocates labels\n   by the LDP DoD session, then the downstream access
      LSR/ABR sends a\n   Label Request on the new next-hop session.  If the downstream
      access\n   LSR/ABR doesn't get a label mapping for some duration, then and only\n
      \  then does the downstream access LSR/ABR withdraw the upstream label.\n"
    title: 4.4.  Label Withdraw
  - contents:
    - "4.5.  Label Release\n   If an access LSR/ABR no longer needs a label for a
      FEC, it sends a\n   Label Release message [RFC5036] to the downstream access
      LSR/ABR with\n   or without the label TLV.\n   If an upstream access LSR/ABR
      receives an unsolicited label mapping\n   on a DoD session, it releases the
      label by sending a Label Release\n   message.\n   The access LSR/ABR sends a
      Label Release message to the downstream\n   LSR in the following cases:\n   a.
      \ If it receives a Label Withdraw from the downstream access\n       LSR/ABR.\n
      \  b.  If the /32 static route with LDP DoD Label Request policy is\n       deleted.\n
      \  c.  If the service gets decommissioned and there is no corresponding\n       /32
      static route with LDP DoD Label Request policy configured.\n   d.  If the next
      hop in the route has changed and the label does not\n       point to the best
      or alternate next hop.\n   e.  If it receives a Label Withdraw from a downstream
      DoD session.\n"
    title: 4.5.  Label Release
  - contents:
    - "4.6.  Local-Repair\n   To support local-repair with ECMP and IPFRR LFA, the
      access LSR/ABR\n   requests labels on both the best next-hop and the alternate
      next-hop\n   LDP DoD sessions, as specified in the Label Request procedures
      in\n   Section 4.3.  If remote LFA is enabled, the access LSR/ABR needs a\n
      \  label from its alternate next hop toward the PQ node and needs a\n   label
      from the remote PQ node toward its FEC/destination [RLFA].  If\n   the access
      LSR/ABR doesn't already know those labels, it requests\n   them.\n   This will
      enable the access LSR/ABR to pre-program the alternate\n   forwarding path with
      the alternate label(s) and invoke the IPFRR LFA\n   switchover procedure if
      the primary next-hop link fails.\n"
    title: 4.6.  Local-Repair
  title: 4.  LDP DoD Procedures
- contents:
  - "5.  LDP Extension for LDP DoD Fast-Up Convergence\n   In some conditions, the
    exponential backoff algorithm usage described\n   in Section 4.3.2 can result
    in a wait time that is longer than\n   desired to get a successful LDP label-to-route
    mapping.  An example\n   is when a specific route is unavailable on the downstream
    LSR when\n   the label mapping request from the upstream is received, but later\n
    \  comes back.  In such a case, using the exponential backoff algorithm\n   can
    result in a max delay wait time before the upstream LSR sends\n   another LDP
    Label Request.\n   This section describes an extension to the LDP DoD procedure
    to\n   address fast-up convergence, and as such is to be treated as a\n   normative
    reference.  The downstream and upstream LSRs SHOULD\n   implement this extension
    if fast-up convergence is desired.\n   The extension consists of the upstream
    LSR indicating to the\n   downstream LSR that the Label Request SHOULD be queued
    on the\n   downstream LSR until the requested route is available.\n   To implement
    this behavior, a new Optional Parameter is defined for\n   use in the Label Request
    message:\n                  Optional Parameter      Length     Value\n                  Queue
    Request TLV         0      see below\n      0                   1                   2
    \                  3\n      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4
    5 6 7 8 9 0 1\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
    \    |1|0|  Queue Request (0x0971)   |         Length (0x00)         |\n     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n
    \    U-bit = 1\n       Unknown TLV bit.  Upon receipt of an unknown TLV, due to
    the\n       U-bit being set (=1), the unknown TLV MUST be silently ignored\n       and
    the rest of the message processed as if the unknown TLV\n       did not exist.
    \ In case the requested route is not available,\n       the downstream LSR MUST
    ignore this unknown TLV and send a\n       \"No Route\" notification back.  This
    ensures backward\n       compatibility.\n     F-bit = 0\n       Forward unknown
    TLV bit.  This bit applies only when the U-bit is\n       set and the LDP message
    containing the unknown TLV is to be\n       forwarded.  Due to the F-bit being
    clear (=0), the unknown TLV is\n       not forwarded with the message.\n     Type
    = 0x0971\n       Queue Request TLV (allocated by IANA).\n     Length = 0x00\n
    \      Specifies the length of the Value field in octets.\n   The specified operation
    is as follows.\n   To benefit from the fast-up convergence improvement, the upstream
    LSR\n   sends a Label Request message with a Queue Request TLV.\n   If the downstream
    LSR supports the Queue Request TLV, it verifies if\n   a route is available; if
    so, it replies with a label mapping as per\n   existing LDP procedures.  If the
    route is not available, the\n   downstream LSR queues the request and replies
    as soon as the route\n   becomes available.  In the meantime, it does not send
    a \"No Route\"\n   notification back.  When sending a Label Request with the Queue\n
    \  Request TLV, the upstream LSR does not retry the Label Request\n   message
    if it does not receive a reply from its downstream peer.\n   If the upstream LSR
    wants to abort an outstanding Label Request while\n   the Label Request is queued
    in the downstream LSR, the upstream LSR\n   sends a Label Abort Request message,
    making the downstream LSR remove\n   the original request from the queue and send
    back a Label Request\n   Aborted notification [RFC5036].\n   If the downstream
    LSR does not support the Queue Request TLV, and the\n   requested route is not
    available, it ignores this unknown TLV and\n   sends a \"No Route\" notification
    back, in line with [RFC5036].  In\n   this case, the upstream LSR invokes the
    exponential backoff algorithm\n   described in Section 4.3.2, following the LDP
    specification\n   [RFC5036].\n   This procedure ensures backward compatibility.\n"
  title: 5.  LDP Extension for LDP DoD Fast-Up Convergence
- contents:
  - '6.  IANA Considerations

    '
  - contents:
    - "6.1.  LDP TLV Type\n   This document uses a new Optional Parameter, Queue Request
      TLV, in\n   the Label Request message defined in Section 5.  IANA already\n
      \  maintains a registry of LDP parameters called the \"TLV Type Name\n   Space\"
      registry, as defined by RFC 5036.  The following assignment\n   has been made:\n
      \                         TLV type  Description\n                          0x0971
      \   Queue Request TLV\n"
    title: 6.1.  LDP TLV Type
  title: 6.  IANA Considerations
- contents:
  - "7.  Security Considerations\n   MPLS LDP DoD deployment in the access network
    is subject to the same\n   security threats as any MPLS LDP deployment.  It is
    recommended that\n   baseline security measures be considered, as described in
    \"Security\n   Framework for MPLS and GMPLS Networks\" [RFC5920] and the LDP\n
    \  specification [RFC5036] including ensuring authenticity and integrity\n   of
    LDP messages, as well as protection against spoofing and denial-\n   of-service
    attacks.\n   Some deployments require increased measures of network security if
    a\n   subset of access nodes are placed in locations with lower levels of\n   physical
    security, e.g., street cabinets (common practice for Very\n   high bit-rate Digital
    Subscriber Line (VDSL) access).  In such cases,\n   it is the responsibility of
    the system designer to take into account\n   the physical security measures (environmental
    design, mechanical or\n   electronic access control, intrusion detection) as well
    as monitoring\n   and auditing measures (configuration and Operating System changes,\n
    \  reloads, route advertisements).\n   But even with all this in mind, the designer
    still needs to consider\n   network security risks and adequate measures arising
    from the lower\n   level of physical security of those locations.\n"
  - contents:
    - "7.1.  LDP DoD Native Security Properties\n   MPLS LDP DoD operation is request
      driven, and unsolicited label\n   mappings are not accepted by upstream LSRs
      by design.  This\n   inherently limits the potential of an unauthorized third
      party\n   injecting unsolicited label mappings on the wire.\n   This native
      security property enables an ABR LSR to act as a gateway\n   to the MPLS network
      and to control the requests coming from any\n   access LSR and prevent cases
      when the access LSR attempts to get\n   access to an unauthorized FEC or remote
      LSR after being compromised.\n   In the event that an access LSR gets compromised
      and manages to\n   advertise a FEC belonging to another LSR (e.g., in order
      to 'steal'\n   third-party data flows, or breach the privacy of a VPN), such
      an\n   access LSR would also have to influence the routing decision for\n   affected
      FECs on the ABR LSR to attract the flows.  The following\n   measures need to
      be considered on an ABR LSR to prevent such an event\n   from occurring:\n   a.
      \ Access with static routes: An access LSR cannot influence ABR LSR\n       routing
      decisions due to the static nature of routing\n       configuration, a native
      property of the design.\n   b.  Access with IGP - access FEC \"stealing\": If
      the compromised\n       access LSR is a leaf in the access topology (leaf node
      in\n       topologies I1, I, V, Y described earlier), this will not have any\n
      \      adverse effect, due to the leaf IGP metrics being configured on\n       the
      ABR LSR.  If the compromised access LSR is a transit LSR in\n       the access
      topology (transit node in topologies I, Y, U), it is\n       only possible for
      this access LSR to attract traffic destined to\n       the nodes upstream from
      it.  Such a 'man-in-the-middle attack'\n       can quickly be detected by upstream
      access LSRs not receiving\n       traffic and by the LDP TCP session being lost.\n
      \  c.  Access with IGP - network FEC \"stealing\": The compromised access\n
      \      LSR can use IGP to advertise a \"stolen\" FEC prefix belonging to\n       the
      network side.  This case can be prevented by giving a better\n       administrative
      preference to the BGP labeled IP routes versus\n       access IGP routes.\n
      \  In summary, the native properties of MPLS in access design with LDP\n   DoD
      prevent a number of security attacks and make their detection\n   quick and
      straightforward.\n   The following two sections describe other security considerations\n
      \  applicable to general MPLS deployments in the access network.\n"
    title: 7.1.  LDP DoD Native Security Properties
  - contents:
    - "7.2.  Data-Plane Security\n   Data-plane security risks applicable to the access
      MPLS network\n   include:\n   a.  Labeled packets from a specific access LSR
      that are sent to an\n       unauthorized destination.\n   b.  Unlabeled packets
      that are sent by an access LSR to remote\n       network nodes.\n   The following
      mechanisms apply to MPLS access design with LDP DoD\n   that address listed
      data-plane security risks:\n   1.  addressing (a): Access and ABR LSRs do not
      accept labeled packets\n       over a particular data link, unless from the
      access or ABR LSR\n       perspective this data link is known to attach to a
      trusted system\n       based on control-plane security as described in Section
      7.3 and\n       the top label has been distributed to the upstream neighbor
      by\n       the receiving access or ABR LSR.\n   2.  addressing (a) - The ABR
      LSR restricts network reachability for\n       access devices to a subset of
      remote network LSRs, based on\n       control-plane security as described in
      Section 7.3, FEC filters,\n       and routing policy.\n   3.  addressing (a):
      Control-plane authentication as described in\n       Section 7.3 is used.\n
      \  4.  addressing (b): The ABR LSR restricts IP network reachability to\n       and
      from the access LSR.\n"
    title: 7.2.  Data-Plane Security
  - contents:
    - "7.3.  Control-Plane Security\n   Similar to Inter-AS MPLS/VPN deployments [RFC4364],
      control-plane\n   security is a prerequisite for data-plane security.\n   To
      ensure control-plane security access, LDP DoD sessions are\n   established only
      with LDP peers that are considered trusted from the\n   local LSR perspective,
      meaning they are reachable over a data link\n   that is known to attach to a
      trusted system based on employed\n   authentication mechanism(s) on the local
      LSR.\n   The security of LDP sessions is analyzed in the LDP specification\n
      \  [RFC5036] and in [RFC6952] (\"Analysis of BGP, LDP, PCEP, and MSDP\n   Issues
      According to the Keying and Authentication for Routing\n   Protocols (KARP)
      Design Guide\").  Both documents state that LDP is\n   subject to two different
      types of attacks: spoofing and denial-of-\n   service attacks.\n   The threat
      of spoofed LDP Hello messages can be reduced by following\n   guidelines listed
      in the LDP specification [RFC5036]: accepting Basic\n   Hellos only on interfaces
      connected to trusted LSRs, ignoring Basic\n   Hellos that are not addressed
      to all routers in this subnet multicast\n   group, and using access lists.  LDP
      Hello messages can also be\n   secured using an optional Cryptographic Authentication
      TLV as\n   specified in \"LDP Hello Cryptographic Authentication\" [CRYPTO-AUTH]\n
      \  that further reduces the threat of spoofing during the LDP discovery\n   phase.\n
      \  Spoofing during the LDP session communication phase can be prevented\n   by
      using the TCP Authentication Option (TCP-AO) [RFC5925], which uses\n   a stronger
      hashing algorithm, e.g., SHA1 as compared to the\n   traditionally used MD5
      authentication.  TCP-AO is recommended as\n   being more secure as compared
      to the TCP/IP MD5 authentication option\n   [RFC5925].\n   The threat of a denial-of-service
      attack targeting a well-known UDP\n   port for LDP discovery or a TCP port for
      LDP session establishment\n   can be reduced by following the guidelines listed
      in [RFC5036] and in\n   [RFC6952].\n   Access IGP (if used) and any routing
      protocols used in the access\n   network for signaling service routes also need
      to be secured\n   following best practices in routing protocol security.  Refer
      to the\n   KARP IS-IS security analysis document [KARP-ISIS] and to [RFC6863]\n
      \  (\"Analysis of OSPF Security According to the Keying and\n   Authentication
      for Routing Protocols (KARP) Design Guide\") for\n   further analysis of security
      properties of IS-IS and OSPF IGP routing\n   protocols.\n"
    title: 7.3.  Control-Plane Security
  title: 7.  Security Considerations
- contents:
  - "8.  Acknowledgements\n   The authors would like to thank Nischal Sheth, Nitin
    Bahadur, Nicolai\n   Leymann, George Swallow, Geraldine Calvignac, Ina Minei,
    Eric Gray,\n   and Lizhong Jin for their suggestions and review.  Additional thanks\n
    \  go to Adrian Farrel for thorough pre-publication review, and to\n   Stephen
    Kent for review and guidance specifically for the security\n   section.\n"
  title: 8.  Acknowledgements
- contents:
  - '9.  References

    '
  - contents:
    - "9.1.  Normative References\n   [RFC2119]  Bradner, S., \"Key words for use
      in RFCs to Indicate\n              Requirement Levels\", BCP 14, RFC 2119, March
      1997.\n   [RFC3031]  Rosen, E., Viswanathan, A., and R. Callon, \"Multiprotocol\n
      \             Label Switching Architecture\", RFC 3031, January 2001.\n   [RFC4364]
      \ Rosen, E. and Y. Rekhter, \"BGP/MPLS IP Virtual Private\n              Networks
      (VPNs)\", RFC 4364, February 2006.\n   [RFC4447]  Martini, L., Rosen, E., El-Aawar,
      N., Smith, T., and G.\n              Heron, \"Pseudowire Setup and Maintenance
      Using the Label\n              Distribution Protocol (LDP)\", RFC 4447, April
      2006.\n   [RFC5036]  Andersson, L., Minei, I., and B. Thomas, \"LDP\n              Specification\",
      RFC 5036, October 2007.\n   [RFC5283]  Decraene, B., Le Roux, JL., and I. Minei,
      \"LDP Extension\n              for Inter-Area Label Switched Paths (LSPs)\",
      RFC 5283,\n              July 2008.\n"
    title: 9.1.  Normative References
  - contents:
    - "9.2.  Informative References\n   [CRYPTO-AUTH]\n              Zheng, L., Chen,
      M., and M. Bhatia, \"LDP Hello\n              Cryptographic Authentication\",
      Work in Progress, August\n              2013.\n   [KARP-ISIS]\n              Chunduri,
      U., Tian, A., and W. Lu, \"KARP IS-IS security\n              analysis\", Work
      in Progress, March 2013.\n   [RFC3107]  Rekhter, Y. and E. Rosen, \"Carrying
      Label Information in\n              BGP-4\", RFC 3107, May 2001.\n   [RFC5286]
      \ Atlas, A. and A. Zinin, \"Basic Specification for IP Fast\n              Reroute:
      Loop-Free Alternates\", RFC 5286, September 2008.\n   [RFC5443]  Jork, M., Atlas,
      A., and L. Fang, \"LDP IGP\n              Synchronization\", RFC 5443, March
      2009.\n   [RFC5920]  Fang, L., \"Security Framework for MPLS and GMPLS\n              Networks\",
      RFC 5920, July 2010.\n   [RFC5925]  Touch, J., Mankin, A., and R. Bonica, \"The
      TCP\n              Authentication Option\", RFC 5925, June 2010.\n   [RFC6863]
      \ Hartman, S. and D. Zhang, \"Analysis of OSPF Security\n              According
      to the Keying and Authentication for Routing\n              Protocols (KARP)
      Design Guide\", RFC 6863, March 2013.\n   [RFC6952]  Jethanandani, M., Patel,
      K., and L. Zheng, \"Analysis of\n              BGP, LDP, PCEP, and MSDP Issues
      According to the Keying\n              and Authentication for Routing Protocols
      (KARP) Design\n              Guide\", RFC 6952, May 2013.\n   [RLFA]     Bryant,
      S., Filsfils, C., Previdi, S., Shand, M., and N.\n              So, \"Remote
      LFA FRR\", Work in Progress, May 2013.\n   [SEAMLESS-MPLS]\n              Leymann,
      N., Ed., Decraene, B., Filsfils, C.,\n              Konstantynowicz, M., Ed.,
      and D. Steinberg, \"Seamless MPLS\n              Architecture\", Work in Progress,
      July 2013.\n"
    title: 9.2.  Informative References
  title: 9.  References
- contents:
  - "Authors' Addresses\n   Thomas Beckhaus (editor)\n   Deutsche Telekom AG\n   Heinrich-Hertz-Strasse
    3-7\n   Darmstadt  64307\n   Germany\n   Phone: +49 6151 58 12825\n   EMail: thomas.beckhaus@telekom.de\n
    \  Bruno Decraene\n   Orange\n   38-40 rue du General Leclerc\n   Issy Moulineaux
    cedex 9  92794\n   France\n   EMail: bruno.decraene@orange.com\n   Kishore Tiruveedhula\n
    \  Juniper Networks\n   10 Technology Park Drive\n   Westford, Massachusetts  01886\n
    \  USA\n   Phone: 1-(978)-589-8861\n   EMail: kishoret@juniper.net\n   Maciek
    Konstantynowicz (editor)\n   Cisco Systems, Inc.\n   10 New Square Park, Bedfont
    Lakes\n   London\n   United Kingdom\n   EMail: maciek@cisco.com\n   Luca Martini\n
    \  Cisco Systems, Inc.\n   9155 East Nichols Avenue, Suite 400\n   Englewood,
    CO  80112\n   USA\n   EMail: lmartini@cisco.com\n"
  title: Authors' Addresses
